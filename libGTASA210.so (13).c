yPtr->m_transform;
      z = v9->m_translate.z;
      CCamera::CalculateGroundHeight(unsigned int)::fGroundHeightTop = z + m_pColModel->m_boxBound.m_vecMax.z;
      v12 = colPoint.m_vecPosition.z;
      if ( (float)(m_pColModel->m_boxBound.m_vecMax.x - m_pColModel->m_boxBound.m_vecMin.x) <= 120.0
        && (float)(m_pColModel->m_boxBound.m_vecMax.y - m_pColModel->m_boxBound.m_vecMin.y) <= 120.0 )
      {
        CCamera::CalculateGroundHeight(unsigned int)::fGroundHeightBase = z;
        v12 = m_pColModel->m_boxBound.m_vecMin.z + z;
      }
      CCamera::CalculateGroundHeight(unsigned int)::fGroundHeightBase = v12;
      if ( v12 < 0.0 )
        CCamera::CalculateGroundHeight(unsigned int)::fGroundHeightBase = 0.0;
    }
    v13 = this->m_pMat;
    if ( v13 )
      p_m_transform = (CSimpleTransform *)&v13->tx;
    v14 = *(_QWORD *)&p_m_transform->m_translate.x;
    CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.z = p_m_transform->m_translate.z;
    *(_QWORD *)&CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.x = v14;
  }
  v15 = &CCamera::CalculateGroundHeight(unsigned int)::fGroundHeight;
  if ( nBoundBoxPos != 1 )
    v15 = &CCamera::CalculateGroundHeight(unsigned int)::fGroundHeightBase;
  if ( nBoundBoxPos == 2 )
    v15 = &CCamera::CalculateGroundHeight(unsigned int)::fGroundHeightTop;
  return *v15;
}
// 952EEC: using guessed type char `guard variable for'CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation;

//----- (003DC7D0) --------------------------------------------------------
void __fastcall CCamera::Process(CCamera *this)
{
  float32x2_t v1; // d0
  float32x2_t d3_0; // d3
  float32x2_t v3; // d4
  float32x2_t v4; // d9
  float32x2_t v5; // d10
  float32x2_t v6; // d11
  CSimpleTransform *p_m_transform; // r10
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  _BOOL4 m_bLookingAtPlayer; // r0
  __int64 v12; // d16
  bool v13; // zf
  CEntity **p_pTargetEntity; // r11
  CPlayerPed *PlayerPed; // r0
  int ActiveCam; // r0
  char *v17; // r1
  CEntity *pTargetEntity; // r0
  CEntity **v19; // r1
  char *v20; // r0
  CEntity **v21; // r1
  CEntity *v22; // r0
  float m_fTimeToFadeOut; // s0
  float *p_m_fFloatingFade; // r0
  float v25; // s2
  float v26; // s4
  float m_fFloatingFade; // s2
  int v28; // r1
  float v29; // s0
  float v30; // s4
  float v31; // s2
  int v32; // r0
  char v33; // r2
  float v34; // s16
  char v35; // r5
  float ATanOfXY; // s18
  float *v37; // r1
  float v38; // s2
  float v39; // s0
  UInt32 v40; // r1
  CCam *v41; // r0
  float y; // s2
  float x; // s0
  float i; // s0
  int v45; // r5
  int v46; // r1
  char *v47; // r0
  __int64 v48; // d16
  __int64 v49; // d16
  RwReal v50; // s0
  RwReal v51; // s4
  __int64 v52; // kr00_8
  UInt32 m_uiTransitionDuration; // r0
  float m_fFractionInterToStopMovingTarget; // s24
  float v55; // s22
  float m_fFractionInterToStopCatchUpTarget; // s2
  float v57; // s0
  float v58; // s0
  __int64 v59; // d16
  __int64 v60; // d16
  float v61; // s0
  float v62; // s2
  float v63; // s4
  RwReal v64; // s0
  __int64 v65; // d16
  float v66; // s0
  float *v67; // r0
  RwReal v68; // s0
  float m_fFractionInterToStopMoving; // s0
  float m_fFractionInterToStopCatchUp; // s2
  float v71; // r0
  int v72; // r1
  float v73; // s2
  float *v74; // r0
  float v75; // s22
  float v76; // s2
  float v77; // s0
  float v78; // s20
  float v79; // r5
  float *v80; // r0
  float v81; // s4
  RwReal v82; // s6
  RwReal v83; // s10
  float j; // s6
  float v85; // s18
  __int64 v86; // d16
  float *p_m_fFOVWhenInterPol; // r9
  float v88; // s2
  float v89; // s0
  __int64 v90; // d16
  float v91; // s24
  float v92; // s0
  CVector *p_m_vecSourceWhenInterPol; // r6
  float v94; // s22
  float v95; // s0
  RwReal v96; // s8
  _BOOL4 v97; // r0
  float v98; // s2
  float v99; // s24
  float v100; // s0
  float v101; // s2
  float v102; // r8
  float v103; // s28
  float v104; // r0
  CVector *p_m_vecUpWhenInterPol; // r5
  float v106; // s0
  float v107; // s2
  float v108; // s6
  __int64 v109; // d16
  float z; // s20
  __int64 v111; // d17
  float v112; // s4
  float v113; // s2
  float v114; // s24
  __int64 v115; // d16
  int Mode; // r0
  bool v117; // zf
  float v118; // s18
  float v119; // s20
  int v120; // r0
  bool v121; // zf
  float v122; // r5
  float v123; // s18
  float v124; // s20
  float v125; // s22
  float v126; // r0
  float v127; // r1
  float v128; // r2
  float v129; // r3
  float v130; // r6
  float v131; // r5
  float v132; // r0
  float m_fCamShakeForce; // s24
  float v134; // s20
  unsigned int v135; // r0
  float *p_tz; // r8
  float *p_ty; // r5
  float v138; // s0
  float v139; // s4
  float v140; // s8
  int v141; // r0
  char v142; // r0
  float ty; // r1
  float tz; // r2
  float v145; // s0
  __int64 v146; // kr08_8
  float tx; // r2
  CVector *p_m_PreviousCameraPosition; // lr
  float v149; // r1
  RwReal *p_z; // r12
  float v151; // r0
  RwReal *p_y; // r6
  float v153; // s6
  float v154; // s2
  float v155; // s0
  float v156; // s8
  float v157; // s4
  float v158; // s10
  float v159; // s0
  float m_CameraSpeedSoFar; // s2
  __int64 v161; // kr10_8
  float v162; // s0
  int v163; // r1
  float v164; // s0
  char *v165; // r0
  int v166; // r2
  bool v167; // zf
  __int64 v168; // d16
  int v169; // r1
  int v170; // r2
  int v171; // r3
  bool v172; // zf
  int v173; // r3
  bool v174; // zf
  CMatrix *v175; // r0
  float xy; // s4
  float yy; // s2
  float v178; // s0
  float m_heading; // r4
  float v180; // r5
  float v181; // s16
  CCam *v182; // r1
  CCam *v183; // r0
  __int64 v184; // d16
  CMatrix *v185; // r2
  const CVector *p_m_translate; // r0
  CEntity **k; // [sp+28h] [bp-F0h]
  CCam *Cams; // [sp+2Ch] [bp-ECh]
  CColPoint v189; // [sp+30h] [bp-E8h] BYREF
  CEntity *refEntityPtr; // [sp+60h] [bp-B8h] BYREF
  float fFOV; // [sp+64h] [bp-B4h] BYREF
  CVector TheTargetToLookAt; // [sp+68h] [bp-B0h] BYREF
  CVector m_vecPosition; // [sp+78h] [bp-A0h] BYREF
  CVector v2; // [sp+88h] [bp-90h] BYREF
  CVector v195; // [sp+98h] [bp-80h] BYREF
  CVector TheSource; // [sp+A8h] [bp-70h] BYREF

  ResetMadeInvisibleObjects();
  p_m_transform = &this->m_transform;
  fFOV = 1.0;
  m_pMat = this->m_pMat;
  this->m_bJust_Switched = 0;
  p_tx = &this->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  m_bLookingAtPlayer = this->m_bLookingAtPlayer;
  v12 = *(_QWORD *)&p_tx->m_translate.x;
  v13 = !m_bLookingAtPlayer;
  this->m_RealPreviousCameraPosition.z = p_tx->m_translate.z;
  *(_QWORD *)&this->m_RealPreviousCameraPosition.x = v12;
  if ( !m_bLookingAtPlayer )
    v13 = !this->m_bTargetJustBeenOnTrain;
  if ( !v13 || this->WhoIsInControlOfTheCamera == 2 )
    CCamera::UpdateTargetEntity(this);
  p_pTargetEntity = &this->pTargetEntity;
  if ( !this->pTargetEntity )
  {
    PlayerPed = FindPlayerPed(-1);
    *p_pTargetEntity = PlayerPed;
    CEntity::RegisterReference(PlayerPed, &this->pTargetEntity);
  }
  ActiveCam = this->ActiveCam;
  v17 = (char *)this + 528 * ActiveCam;
  if ( !*((_DWORD *)v17 + 217) )
  {
    pTargetEntity = this->pTargetEntity;
    v19 = (CEntity **)(v17 + 868);
    *v19 = pTargetEntity;
    CEntity::RegisterReference(pTargetEntity, v19);
    LOBYTE(ActiveCam) = this->ActiveCam;
  }
  v20 = (char *)this + 16 * (((ActiveCam & 1) == 0) | (32 * ((ActiveCam & 1) == 0)));
  if ( !*((_DWORD *)v20 + 217) )
  {
    v21 = (CEntity **)(v20 + 868);
    v22 = *p_pTargetEntity;
    *v21 = *p_pTargetEntity;
    CEntity::RegisterReference(v22, v21);
  }
  CCamera::CamControl(this);
  CCamera::ProcessScriptedCommands(&TheCamera);
  if ( this->m_bFading )
  {
    if ( this->m_iFadingDirection )
    {
      if ( this->m_iFadingDirection == 1 )
      {
        m_fTimeToFadeOut = this->m_fTimeToFadeOut;
        if ( m_fTimeToFadeOut == 0.0 )
        {
          this->m_fFloatingFade = 0.0;
          p_m_fFloatingFade = &this->m_fFloatingFade;
LABEL_26:
          v28 = 0;
          m_fFloatingFade = 0.0;
          this->m_bFading = 0;
LABEL_29:
          *(_DWORD *)p_m_fFloatingFade = v28;
          goto LABEL_30;
        }
        p_m_fFloatingFade = &this->m_fFloatingFade;
        m_fFloatingFade = this->m_fFloatingFade
                        + (float)((float)((float)(CTimer::ms_fTimeStep / -50.0) * 255.0) / m_fTimeToFadeOut);
        this->m_fFloatingFade = m_fFloatingFade;
        if ( m_fFloatingFade <= 0.0 )
          goto LABEL_26;
      }
      else
      {
        m_fFloatingFade = this->m_fFloatingFade;
      }
LABEL_30:
      CDraw::FadeValue = (unsigned int)m_fFloatingFade;
      goto LABEL_31;
    }
    p_m_fFloatingFade = &this->m_fFloatingFade;
    v25 = this->m_fFloatingFade;
    if ( v25 >= 255.0 )
      this->m_bFading = 0;
    v26 = this->m_fTimeToFadeOut;
    if ( v26 == 0.0 )
    {
      *p_m_fFloatingFade = 255.0;
    }
    else
    {
      m_fFloatingFade = v25 + (float)((float)((float)(CTimer::ms_fTimeStep / 50.0) * 255.0) / v26);
      *p_m_fFloatingFade = m_fFloatingFade;
      if ( m_fFloatingFade < 255.0 )
        goto LABEL_30;
    }
    m_fFloatingFade = 255.0;
    v28 = 1132396544;
    goto LABEL_29;
  }
LABEL_31:
  if ( this->m_bMusicFading )
    CCamera::ProcessMusicFade(this);
  if ( this->m_WideScreenOn )
  {
    if ( this->m_bWantsToSwitchWidescreenOff )
    {
      v29 = 0.0;
      *(_WORD *)&this->m_bWantsToSwitchWidescreenOff = 0;
      v30 = 0.0;
      v31 = 0.0;
    }
    else
    {
      v31 = 1.0;
      v29 = 30.0;
      v30 = this->Cams[this->ActiveCam].FOV * 0.3;
    }
    this->m_fFOV_Wide_Screen = v30;
    this->m_ScreenReductionPercentage = v29;
    this->m_fWideScreenReductionAmount = v31;
  }
  RwCameraSetNearClipPlane(Scene.camera, 0.3);
  v32 = this->ActiveCam;
  v33 = 0;
  v34 = 0.0;
  v35 = 0;
  ATanOfXY = 0.0;
  v37 = (float *)((char *)this + 528 * v32);
  v38 = v37[183];
  v39 = v37[182];
  if ( v39 == 0.0 )
    v33 = 1;
  if ( ((unsigned __int8)v33 & (v38 == 0.0)) == 0 )
  {
    ATanOfXY = CGeneral::GetATanOfXY(v39, v38);
    v32 = this->ActiveCam;
  }
  CCam::Process(&this->Cams[v32]);
  Cams = this->Cams;
  v41 = &this->Cams[this->ActiveCam];
  y = v41->Front.y;
  x = v41->Front.x;
  if ( x == 0.0 )
    v35 = 1;
  if ( ((unsigned __int8)v35 & (y == 0.0)) == 0 )
    v34 = CGeneral::GetATanOfXY(x, y);
  if ( this->m_uiTransitionState )
  {
    v40 = this->m_uiTimeTransitionStart + this->m_uiTransitionDuration;
    if ( CTimer::m_snTimeInMilliseconds > v40 )
    {
      this->m_vecDoingSpecialInterPolation = 0;
      this->m_uiTransitionState = 0;
      this->m_bWaitForInterpolToFinish = 0;
    }
  }
  if ( this->m_bUseNearClipScript )
    RwCameraSetNearClipPlane(Scene.camera, this->m_fNearClipScript);
  for ( i = v34 - ATanOfXY; i >= 3.1416; i = i + -6.2832 )
    ;
  for ( ; i < -3.1416; i = i + 6.2832 )
    ;
  v45 = 0;
  if ( fabsf(i) > 0.3 )
    this->m_bJust_Switched = 1;
  if ( this->Cams[this->ActiveCam].DirectionWasLooking != 3 && (*(_BYTE *)&(*p_pTargetEntity)->m_info & 7) == 2 )
    v45 = 1;
  if ( this->m_shakeEndTime >= (float)CTimer::m_snTimeInMilliseconds )
    CCamera::ProcessShake(this, *(float *)&v40);
  if ( !(v45 | (this->m_uiTransitionState == 0)) )
  {
    v5.n64_u32[0] = 1.0;
    v52 = *(_QWORD *)&this->m_uiTimeTransitionStart;
    m_uiTransitionDuration = CTimer::m_snTimeInMilliseconds - v52;
    if ( CTimer::m_snTimeInMilliseconds - (unsigned int)v52 >= HIDWORD(v52) )
      m_uiTransitionDuration = this->m_uiTransitionDuration;
    m_fFractionInterToStopMovingTarget = this->m_fFractionInterToStopMovingTarget;
    v1.n64_f32[0] = (float)m_uiTransitionDuration / (float)this->m_uiTransitionDurationTargetCoors;
    v55 = (float)m_uiTransitionDuration / (float)this->m_uiTransitionDuration;
    v1.n64_u64[0] = vmin_f32(v1, v5).n64_u64[0];
    if ( v1.n64_f32[0] <= m_fFractionInterToStopMovingTarget )
    {
      if ( m_fFractionInterToStopMovingTarget == 0.0 )
        v58 = 0.0;
      else
        v58 = (float)(m_fFractionInterToStopMovingTarget - v1.n64_f32[0]) / m_fFractionInterToStopMovingTarget;
      v61 = 0.5 - (float)(cosf(v58 * 3.1416) * 0.5);
      v62 = (float)(this->m_cvecTargetSpeedAtStartInter.y * v61) + this->m_cvecStartingTargetForInterPol.y;
      v63 = (float)(this->m_cvecTargetSpeedAtStartInter.x * v61) + this->m_cvecStartingTargetForInterPol.x;
      v64 = (float)(v61 * this->m_cvecTargetSpeedAtStartInter.z) + this->m_cvecStartingTargetForInterPol.z;
      this->m_vecTargetWhenInterPol.y = v62;
      this->m_vecTargetWhenInterPol.x = v63;
      v65 = *(_QWORD *)&this->m_vecTargetWhenInterPol.x;
      this->m_vecTargetWhenInterPol.z = v64;
      TheTargetToLookAt.z = this->m_vecTargetWhenInterPol.z;
      *(_QWORD *)&TheTargetToLookAt.x = v65;
    }
    else
    {
      m_fFractionInterToStopCatchUpTarget = this->m_fFractionInterToStopCatchUpTarget;
      if ( m_fFractionInterToStopCatchUpTarget == 0.0 )
        v57 = 1.0;
      else
        v57 = (float)(v1.n64_f32[0] - m_fFractionInterToStopMovingTarget) / m_fFractionInterToStopCatchUpTarget;
      v66 = 0.5 - (float)(cosf(v57 * 3.1416) * 0.5);
      if ( m_fFractionInterToStopMovingTarget == 0.0 )
      {
        this->m_vecTargetWhenInterPol.z = this->m_cvecStartingTargetForInterPol.z;
        *(_QWORD *)&this->m_vecTargetWhenInterPol.x = *(_QWORD *)&this->m_cvecStartingTargetForInterPol.x;
      }
      v67 = (float *)((char *)this + 528 * this->ActiveCam);
      v62 = this->m_vecTargetWhenInterPol.y + (float)(v66 * (float)(v67[165] - this->m_vecTargetWhenInterPol.y));
      v63 = this->m_vecTargetWhenInterPol.x + (float)(v66 * (float)(v67[164] - this->m_vecTargetWhenInterPol.x));
      v68 = this->m_vecTargetWhenInterPol.z + (float)(v66 * (float)(v67[166] - this->m_vecTargetWhenInterPol.z));
      TheTargetToLookAt.y = v62;
      TheTargetToLookAt.x = v63;
      TheTargetToLookAt.z = v68;
    }
    m_fFractionInterToStopMoving = this->m_fFractionInterToStopMoving;
    if ( v55 <= m_fFractionInterToStopMoving )
    {
      if ( m_fFractionInterToStopMoving == 0.0 )
        v92 = 0.0;
      else
        v92 = (float)(m_fFractionInterToStopMoving - v55) / m_fFractionInterToStopMoving;
      p_m_vecSourceWhenInterPol = &this->m_vecSourceWhenInterPol;
      v94 = 0.5 - (float)(cosf(v92 * 3.1416) * 0.5);
      v95 = (float)(this->m_cvecSourceSpeedAtStartInter.x * v94) + this->m_cvecStartingSourceForInterPol.x;
      v96 = (float)(v94 * this->m_cvecSourceSpeedAtStartInter.z) + this->m_cvecStartingSourceForInterPol.z;
      v97 = this->m_bLookingAtPlayer;
      v98 = (float)(this->m_cvecSourceSpeedAtStartInter.y * v94) + this->m_cvecStartingSourceForInterPol.y;
      this->m_vecSourceWhenInterPol.x = v95;
      this->m_vecSourceWhenInterPol.z = v96;
      this->m_vecSourceWhenInterPol.y = v98;
      v85 = TheTargetToLookAt.x;
      k = &this->pTargetEntity;
      if ( v97 )
      {
        v99 = TheTargetToLookAt.y;
        v100 = v95 - TheTargetToLookAt.x;
        v101 = v98 - TheTargetToLookAt.y;
        if ( sqrtf((float)(v100 * v100) + (float)(v101 * v101)) < 1.3 )
        {
          v102 = CGeneral::GetATanOfXY(v100, v101);
          v103 = cosf(v102);
          v104 = sinf(v102);
          p_m_vecSourceWhenInterPol->x = TheTargetToLookAt.x + (float)(v103 * 1.3);
          this->m_vecSourceWhenInterPol.y = v99 + (float)(v104 * 1.3);
        }
      }
      else
      {
        v99 = TheTargetToLookAt.y;
      }
      p_m_vecUpWhenInterPol = &this->m_vecUpWhenInterPol;
      v106 = this->m_fStartingFOVForInterPol + (float)(v94 * this->m_fFOVSpeedAtStartInter);
      v107 = (float)(v94 * this->m_cvecUpSpeedAtStartInter.z) + this->m_cvecStartingUpForInterPol.z;
      v108 = (float)(v94 * this->m_cvecUpSpeedAtStartInter.y) + this->m_cvecStartingUpForInterPol.y;
      if ( v106 == 0.0 )
        v106 = 1.0;
      p_m_vecUpWhenInterPol->x = (float)(v94 * this->m_cvecUpSpeedAtStartInter.x) + this->m_cvecStartingUpForInterPol.x;
      this->m_vecUpWhenInterPol.z = v107;
      this->m_vecUpWhenInterPol.y = v108;
      this->m_fFOVWhenInterPol = v106;
      v109 = *(_QWORD *)&p_m_vecSourceWhenInterPol->x;
      TheSource.z = this->m_vecSourceWhenInterPol.z;
      z = TheSource.z;
      *(_QWORD *)&TheSource.x = v109;
      v195.z = TheTargetToLookAt.z - TheSource.z;
      v195.x = v85 - *(float *)&v109;
      v195.y = v99 - *((float *)&v109 + 1);
      v111 = *(_QWORD *)&this->m_vecTargetWhenInterPol.x;
      this->SourceDuringInter.z = TheSource.z;
      this->TargetDuringInter.z = this->m_vecTargetWhenInterPol.z;
      *(_QWORD *)&this->SourceDuringInter.x = v109;
      *(_QWORD *)&this->TargetDuringInter.x = v111;
      this->UpDuringInter.z = this->m_vecUpWhenInterPol.z;
      v112 = *(float *)&v109 - this->TargetDuringInter.x;
      v113 = *((float *)&v109 + 1) - this->TargetDuringInter.y;
      *(_QWORD *)&this->UpDuringInter.x = *(_QWORD *)&p_m_vecUpWhenInterPol->x;
      this->FOVDuringInter = v106;
      v114 = this->TargetDuringInter.z;
      this->m_fBetaDuringInterPol = CGeneral::GetATanOfXY(v112, v113);
      this->m_fAlphaDuringInterPol = CGeneral::GetATanOfXY(sqrtf((float)(v112 * v112) + (float)(v113 * v113)), z - v114);
      CVector::Normalise(&v195);
      p_m_fFOVWhenInterPol = &this->m_fFOVWhenInterPol;
      if ( this->m_bLookingAtPlayer )
      {
        v2.x = 0.0;
        v2.y = 0.0;
        v2.z = 1.0;
      }
      else
      {
        v115 = *(_QWORD *)&p_m_vecUpWhenInterPol->x;
        v2.z = this->m_vecUpWhenInterPol.z;
        *(_QWORD *)&v2.x = v115;
      }
      CVector::Normalise(&v2);
    }
    else
    {
      if ( v55 > 1.0 || v55 <= m_fFractionInterToStopMoving )
      {
        v85 = TheTargetToLookAt.x;
LABEL_115:
        v118 = v63 - v85;
        v119 = v62 - TheTargetToLookAt.y;
        v189.m_vecPosition.x = CGeneral::GetATanOfXY(
                                 sqrtf((float)(v118 * v118) + (float)(v119 * v119)),
                                 m_fFractionInterToStopMoving - TheTargetToLookAt.z);
        refEntityPtr = COERCE_CENTITY_(CGeneral::GetATanOfXY(v118, v119));
        CCam::KeepTrackOfTheSpeed(
          &this->Cams[this->ActiveCam],
          &TheSource,
          &TheTargetToLookAt,
          &v2,
          &v189.m_vecPosition.x,
          (float *)&refEntityPtr,
          &fFOV);
        goto LABEL_116;
      }
      m_fFractionInterToStopCatchUp = this->m_fFractionInterToStopCatchUp;
      if ( m_fFractionInterToStopCatchUp != 0.0 )
        v5.n64_f32[0] = (float)(v55 - m_fFractionInterToStopMoving) / m_fFractionInterToStopCatchUp;
      v71 = cosf(v5.n64_f32[0] * 3.1416);
      v72 = this->ActiveCam;
      v73 = v71;
      v74 = (float *)((char *)this + 528 * v72);
      v75 = 0.5 - (float)(v73 * 0.5);
      v76 = this->m_vecSourceWhenInterPol.y + (float)(v75 * (float)(v74[186] - this->m_vecSourceWhenInterPol.y));
      v77 = this->m_vecSourceWhenInterPol.x + (float)(v75 * (float)(v74[185] - this->m_vecSourceWhenInterPol.x));
      v78 = this->m_vecSourceWhenInterPol.z + (float)(v75 * (float)(v74[187] - this->m_vecSourceWhenInterPol.z));
      TheSource.y = v76;
      TheSource.x = v77;
      TheSource.z = v78;
      if ( this->m_bLookingAtPlayer
        && sqrtf(
             (float)((float)(v77 - TheTargetToLookAt.x) * (float)(v77 - TheTargetToLookAt.x))
           + (float)((float)(v76 - TheTargetToLookAt.y) * (float)(v76 - TheTargetToLookAt.y))) < 1.3 )
      {
        v79 = CGeneral::GetATanOfXY(v77 - TheTargetToLookAt.x, v76 - TheTargetToLookAt.y);
        v77 = TheTargetToLookAt.x + (float)(cosf(v79) * 1.3);
        v76 = TheTargetToLookAt.y + (float)(sinf(v79) * 1.3);
        TheSource.x = v77;
        TheSource.y = v76;
        v72 = this->ActiveCam;
      }
      v80 = (float *)((char *)this + 528 * v72);
      v81 = this->m_fFOVWhenInterPol + (float)(v75 * (float)(v80[127] - this->m_fFOVWhenInterPol));
      fFOV = v81;
      v1.n64_u32[1] = LODWORD(this->m_vecUpWhenInterPol.z);
      v82 = this->m_vecUpWhenInterPol.x + (float)(v75 * (float)(v80[191] - this->m_vecUpWhenInterPol.x));
      v83 = v1.n64_f32[1] + (float)(v75 * (float)(v80[193] - v1.n64_f32[1]));
      v2.y = this->m_vecUpWhenInterPol.y + (float)(v75 * (float)(v80[192] - this->m_vecUpWhenInterPol.y));
      v2.x = v82;
      v2.z = v83;
      for ( j = v80[122] - this->m_fBetaWhenInterPol; j >= 3.1416; j = j + -6.2832 )
        ;
      for ( k = &this->pTargetEntity; j < -3.1416; j = j + 6.2832 )
        ;
      v85 = TheTargetToLookAt.x;
      v86 = *(_QWORD *)&TheSource.x;
      p_m_fFOVWhenInterPol = &this->m_fFOVWhenInterPol;
      v195.x = TheTargetToLookAt.x - v77;
      v195.y = TheTargetToLookAt.y - v76;
      v195.z = TheTargetToLookAt.z - v78;
      this->SourceDuringInter.z = TheSource.z;
      *(_QWORD *)&this->SourceDuringInter.x = v86;
      *(_QWORD *)&this->TargetDuringInter.x = *(_QWORD *)&TheTargetToLookAt.x;
      v88 = v76 - this->TargetDuringInter.y;
      v89 = v77 - this->TargetDuringInter.x;
      this->TargetDuringInter.z = TheTargetToLookAt.z;
      v90 = *(_QWORD *)&v2.x;
      this->UpDuringInter.z = v2.z;
      *(_QWORD *)&this->UpDuringInter.x = v90;
      this->FOVDuringInter = v81;
      v91 = this->TargetDuringInter.z;
      this->m_fBetaDuringInterPol = CGeneral::GetATanOfXY(v89, v88);
      this->m_fAlphaDuringInterPol = CGeneral::GetATanOfXY(sqrtf((float)(v89 * v89) + (float)(v88 * v88)), v78 - v91);
      CVector::Normalise(&v195);
      if ( this->m_bLookingAtPlayer )
      {
        v2.x = 0.0;
        v2.y = 0.0;
        v2.z = 1.0;
      }
    }
    Mode = (unsigned __int16)this->Cams[this->ActiveCam].Mode;
    v117 = Mode == 1;
    if ( Mode != 1 )
      v117 = Mode == 37;
    if ( v117 )
    {
      CVector::Normalise(&v195);
      m_vecPosition.y = 0.0;
      m_vecPosition.x = -1.0;
      m_vecPosition.z = 0.0;
      CrossProduct(&v189.m_vecPosition, &v195, &m_vecPosition);
    }
    else
    {
      CVector::Normalise(&v195);
      CVector::Normalise(&v2);
      CrossProduct(&v189.m_vecPosition, &v195, &v2);
      m_vecPosition = v189.m_vecPosition;
      CVector::Normalise(&m_vecPosition);
      CrossProduct(&v189.m_vecPosition, &m_vecPosition, &v195);
    }
    v2 = v189.m_vecPosition;
    CVector::Normalise(&v2);
    m_fFractionInterToStopMoving = TheSource.z;
    p_pTargetEntity = k;
    v62 = TheSource.y;
    v63 = TheSource.x;
    fFOV = *p_m_fFOVWhenInterPol;
    goto LABEL_115;
  }
  v46 = this->ActiveCam;
  v47 = (char *)this + 528 * v46;
  v48 = *(_QWORD *)(v47 + 740);
  TheSource.z = *((RwReal *)v47 + 187);
  *(_QWORD *)&TheSource.x = v48;
  v49 = *(_QWORD *)(v47 + 764);
  v2.z = *((RwReal *)v47 + 193);
  *(_QWORD *)&v2.x = v49;
  if ( this->m_bMoveCamToAvoidGeom )
  {
    TheSource.x = this->m_vecClearGeometryVec.x + TheSource.x;
    TheSource.y = this->m_vecClearGeometryVec.y + TheSource.y;
    TheSource.z = this->m_vecClearGeometryVec.z + TheSource.z;
    v50 = *((float *)v47 + 164) - TheSource.x;
    v51 = *((float *)v47 + 166) - TheSource.z;
    v195.y = *((float *)v47 + 165) - TheSource.y;
    v195.x = v50;
    v195.z = v51;
    CVector::Normalise(&v195);
    CrossProduct(&v189.m_vecPosition, &v195, &v2);
    CVector::Normalise(&v189.m_vecPosition);
    CrossProduct(&m_vecPosition, &v189.m_vecPosition, &v195);
    v2 = m_vecPosition;
    CVector::Normalise(&v2);
    v46 = this->ActiveCam;
  }
  else
  {
    v59 = *((_QWORD *)v47 + 91);
    v195.z = *((RwReal *)v47 + 184);
    *(_QWORD *)&v195.x = v59;
    v60 = *(_QWORD *)(v47 + 764);
    v2.z = *((RwReal *)v47 + 193);
    *(_QWORD *)&v2.x = v60;
  }
  fFOV = this->Cams[v46].FOV;
LABEL_116:
  if ( this->m_uiTransitionState && !this->m_bLookingAtVector && this->m_bLookingAtPlayer )
  {
    v120 = CCullZones::CamStairsForPlayer();
    v121 = v120 == 0;
    if ( !v120 )
      v121 = !this->m_bPlayerIsInGarage;
    if ( v121 )
    {
      refEntityPtr = 0;
      v185 = (*p_pTargetEntity)->m_pMat;
      p_m_translate = (const CVector *)&v185->tx;
      if ( !v185 )
        p_m_translate = &(*p_pTargetEntity)->m_transform.m_translate;
      if ( CWorld::ProcessLineOfSight(p_m_translate, &TheSource, &v189, &refEntityPtr, 1, 0, 0, 1, 0, 1, 1, 0) == 1 )
      {
        TheSource = v189.m_vecPosition;
        RwCameraSetNearClipPlane(Scene.camera, 0.05);
      }
    }
  }
  if ( CMBlur::Drunkness > 0.0 )
  {
    v122 = (float)(DrunkRotation * 3.1416) / 180.0;
    v123 = CMBlur::Drunkness * -0.02;
    v124 = cosf(v122);
    v125 = sinf(v122);
    TheSource.x = TheSource.x + (float)(v123 * v124);
    TheSource.z = TheSource.z + (float)(v123 * v125);
    CVector::Normalise(&v2);
    v2.x = v2.x + (float)(v124 * (float)(CMBlur::Drunkness * 0.05));
    v2.y = (float)(v125 * (float)(CMBlur::Drunkness * 0.05)) + v2.y;
    CVector::Normalise(&v2);
    CVector::Normalise(&v195);
    v195.x = v195.x + (float)(v124 * (float)(CMBlur::Drunkness * -0.1));
    v195.y = (float)(v125 * (float)(CMBlur::Drunkness * -0.1)) + v195.y;
    CVector::Normalise(&v195);
    CrossProduct(&v189.m_vecPosition, &v195, &v2);
    m_vecPosition = v189.m_vecPosition;
    CVector::Normalise(&m_vecPosition);
    CrossProduct(&v189.m_vecPosition, &m_vecPosition, &v195);
    v2 = v189.m_vecPosition;
    CVector::Normalise(&v2);
    DrunkRotation = DrunkRotation + 5.0;
  }
  CrossProduct(&v189.m_vecPosition, &v2, &v195);
  v4.n64_u32[0] = 0;
  v6.n64_u32[0] = 2.0;
  v126 = v189.m_vecPosition.x;
  v127 = v189.m_vecPosition.y;
  v128 = v189.m_vecPosition.z;
  v129 = v195.x;
  this->m_cameraMatrix.xz = v2.x;
  v130 = v195.y;
  v131 = v2.y;
  this->m_cameraMatrix.xx = v126;
  this->m_cameraMatrix.yx = v127;
  this->m_cameraMatrix.zx = v128;
  this->m_cameraMatrix.yz = v131;
  v132 = v195.z;
  this->m_cameraMatrix.xy = v129;
  this->m_cameraMatrix.yy = v130;
  this->m_cameraMatrix.zy = v132;
  this->m_cameraMatrix.zz = v2.z;
  *(CVector *)&this->m_cameraMatrix.tx = TheSource;
  m_fCamShakeForce = this->m_fCamShakeForce;
  v134 = (float)(CTimer::m_snTimeInMilliseconds - this->m_uiCamShakeStart) * -0.00028;
  v135 = rand();
  v1.n64_f32[0] = m_fCamShakeForce + v134;
  p_tz = &this->m_cameraMatrix.tz;
  p_ty = &this->m_cameraMatrix.ty;
  v138 = vmax_f32(vmin_f32(v1, v6), v4).n64_f32[0];
  v139 = this->m_cameraMatrix.ty + (float)((float)(v138 * 0.1) * (float)(((unsigned __int8)v135 >> 4) - 7));
  v140 = this->m_cameraMatrix.tz + (float)((float)(v138 * 0.1) * (float)(int)(((v135 >> 8) & 0xF) - 7));
  this->m_cameraMatrix.tx = this->m_cameraMatrix.tx + (float)((float)(v138 * 0.1) * (float)(int)((v135 & 0xF) - 7));
  this->m_cameraMatrix.ty = v139;
  this->m_cameraMatrix.tz = v140;
  if ( (float)(v138 * 0.1) > 0.0 && this->m_BlurType != 1 )
  {
    v141 = (int)(float)(v138 * 255.0) + 25;
    if ( v141 >= 150 )
      v141 = 150;
    this->m_imotionBlurAddAlpha = v141;
  }
  if ( this->Cams[this->ActiveCam].Mode == 16 && FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_pMat->zz < 0.2 )
  {
    this->m_motionBlur = 240;
    *(_QWORD *)&this->m_BlurBlue = 0xFF000000FFLL;
    *(_QWORD *)&this->m_BlurRed = 0x1000000FFLL;
    v142 = 1;
LABEL_135:
    CCamera::Process(void)::bBlurSet = v142;
    goto LABEL_136;
  }
  if ( CCamera::Process(void)::bBlurSet )
  {
    v142 = 0;
    goto LABEL_135;
  }
LABEL_136:
  CDraw::SetFOV(fFOV, this->m_WideScreenOn);
  CCamera::CalculateDerivedValues(this, 0, 1);
  CCamera::CopyCameraMatrixToRWCam(this, 0);
  ty = this->m_cameraMatrix.ty;
  tz = this->m_cameraMatrix.tz;
  this->m_vecGameCamPos.x = this->m_cameraMatrix.tx;
  this->m_vecGameCamPos.y = ty;
  this->m_vecGameCamPos.z = tz;
  CCamera::UpdateSoundDistances(this);
  if ( !CCutsceneMgr::ms_running || CCutsceneMgr::ms_useLodMultiplier )
    v145 = 70.0 / CDraw::ms_fFOV;
  else
    v145 = 1.0;
  this->LODDistMultiplier = v145 * (float)(CRenderer::ms_lodDistScale * 0.8);
  this->GenerationDistMultiplier = v145 * 0.875;
  RwCameraSetFarClipPlane(Scene.camera, (float)(int)(float)(Scene.camera->farPlane * 100.0) / 100.0);
  v146 = *(_QWORD *)&this->m_pRwCamera->nearPlane;
  CDraw::ms_fNearClipZ = this->m_pRwCamera->nearPlane;
  CDraw::ms_fFarClipZ = *((float *)&v146 + 1);
  if ( this->m_bJustInitalised || this->m_bJust_Switched == 1 )
  {
    tx = this->m_cameraMatrix.tx;
    p_m_PreviousCameraPosition = &this->m_PreviousCameraPosition;
    v149 = this->m_cameraMatrix.ty;
    p_z = &this->m_PreviousCameraPosition.z;
    v151 = this->m_cameraMatrix.tz;
    p_y = &this->m_PreviousCameraPosition.y;
    v153 = tx;
    v154 = v149;
    this->m_bJustInitalised = 0;
    v155 = v151;
    this->m_PreviousCameraPosition.x = tx;
    v156 = v149;
    this->m_PreviousCameraPosition.y = v149;
    v157 = v151;
    this->m_PreviousCameraPosition.z = v151;
    v158 = tx;
  }
  else
  {
    v158 = this->m_cameraMatrix.tx;
    p_y = &this->m_PreviousCameraPosition.y;
    v157 = *p_tz;
    p_z = &this->m_PreviousCameraPosition.z;
    v156 = *p_ty;
    p_m_PreviousCameraPosition = &this->m_PreviousCameraPosition;
    v151 = *p_tz;
    v155 = this->m_PreviousCameraPosition.z;
    v149 = *p_ty;
    v154 = this->m_PreviousCameraPosition.y;
    tx = v158;
    v153 = this->m_PreviousCameraPosition.x;
  }
  v159 = (float)((float)((float)(v158 - v153) * (float)(v158 - v153))
               + (float)((float)(v156 - v154) * (float)(v156 - v154)))
       + (float)((float)(v157 - v155) * (float)(v157 - v155));
  m_CameraSpeedSoFar = this->m_CameraSpeedSoFar;
  v161 = *(_QWORD *)&this->m_iWorkOutSpeedThisNumFrames;
  this->m_iNumFramesSoFar = HIDWORD(v161) + 1;
  v162 = m_CameraSpeedSoFar + sqrtf(v159);
  this->m_CameraSpeedSoFar = v162;
  if ( HIDWORD(v161) + 1 == (_DWORD)v161 )
  {
    this->m_CameraSpeedSoFar = 0.0;
    this->m_iNumFramesSoFar = 0;
    this->m_CameraAverageSpeed = v162 / (float)(HIDWORD(v161) + 1);
  }
  p_m_PreviousCameraPosition->x = tx;
  *p_y = v149;
  *p_z = v151;
  v163 = this->ActiveCam;
  v164 = this->Orientation + 3.1416;
  v165 = (char *)this + 528 * v163;
  v166 = *((_DWORD *)v165 + 100);
  v167 = v166 == 3;
  if ( v166 != 3 )
    v167 = *((unsigned __int16 *)v165 + 191) == 37;
  if ( !v167 )
  {
    v168 = *((_QWORD *)v165 + 94);
    *((_DWORD *)v165 + 187) = *((_DWORD *)v165 + 190);
    *(_QWORD *)(v165 + 740) = v168;
    this->Orientation = v164;
  }
  if ( this->m_uiTransitionState )
  {
    v169 = v163 & 1;
    v170 = v169 ^ 1;
    v171 = *((_DWORD *)&this->Cams[0].CamTargetEntity + 4 * (v169 ^ 1 | (32 * (v169 ^ 1))));
    v172 = v171 == 0;
    if ( v171 )
    {
      p_y = (RwReal *)*p_pTargetEntity;
      v172 = *p_pTargetEntity == 0;
    }
    if ( !v172 && (*((_BYTE *)p_y + 58) & 7) == 3 )
    {
      v173 = *(_BYTE *)(v171 + 58) & 7;
      v174 = v173 == 2;
      if ( v173 != 2 )
        v174 = *((unsigned __int16 *)v165 + 191) == 37;
      if ( !v174 && this->Cams[v170].DirectionWasLooking != 3 )
      {
        v182 = &Cams[v169];
        v183 = &Cams[v170];
        v184 = *(_QWORD *)&v182->SourceBeforeLookBehind.x;
        v183->Source.z = v182->SourceBeforeLookBehind.z;
        *(_QWORD *)&v183->Source.x = v184;
        this->Orientation = v164;
      }
    }
  }
  this->m_bMoveCamToAvoidGeom = 0;
  this->m_bCameraJustRestored = 0;
  v175 = this->m_pMat;
  if ( v175 )
  {
    p_m_transform = (CSimpleTransform *)&v175->tx;
    xy = v175->xy;
    yy = v175->yy;
    v178 = v175->zy * 0.4;
  }
  else
  {
    m_heading = this->m_transform.m_heading;
    v180 = sinf(m_heading);
    yy = cosf(m_heading);
    v178 = 0.0;
    LODWORD(xy) = LODWORD(v180) ^ 0x80000000;
  }
  v181 = v178 + p_m_transform->m_translate.z;
  if ( CWaterLevel::GetWaterLevel(
         p_m_transform->m_translate.x + (float)(xy * 0.4),
         (float)(yy * 0.4) + p_m_transform->m_translate.y,
         v181,
         &v189.m_vecPosition.x,
         1,
         0) == 1
    && v189.m_vecPosition.x >= (float)(v181 + -0.6) )
  {
    v3.n64_f32[0] = v189.m_vecPosition.x - v181;
    d3_0.n64_u32[0] = 0;
    LODWORD(CWeather::WaterDepth) = vmax_f32(v3, d3_0).n64_u32[0];
    if ( v189.m_vecPosition.x <= (float)(v181 + 0.6) )
      v4.n64_f32[0] = (float)((float)(v181 - (float)(v189.m_vecPosition.x + -0.6)) / -1.2) + 1.0;
    else
      v4.n64_u32[0] = 1.0;
  }
  CWeather::UnderWaterness = v4.n64_f32[0];
}
// 3DCBAC: variable 'v40' is possibly undefined
// 3DCCFE: variable 'v1' is possibly undefined
// 3DCCFE: variable 'v5' is possibly undefined
// 3DD742: variable 'v6' is possibly undefined
// 3DD750: variable 'v4' is possibly undefined
// 3DDB2E: variable 'v3' is possibly undefined
// 3DDB2E: variable 'd3_0' is possibly undefined

//----- (003DDCB0) --------------------------------------------------------
void __fastcall CCamera::UpdateTargetEntity(CCamera *this)
{
  CEntity **p_pTargetEntity; // r4
  CEntity *pTargetEntity; // r0
  _BOOL4 v4; // r5
  CPlayerPed *PlayerPed; // r0
  bool v6; // zf
  CPlayerPed *v7; // r0
  CPlayerPed *v8; // r0
  CTask *SimplestActiveTask; // r0
  CPlayerPed *v10; // r0
  int v11; // r8
  CVehicle *PlayerVehicle; // r0
  __int16 v13; // r2
  CPlayerPed *pPed; // r1
  const CVehicle *m_pMyVehicle; // r0
  int CanPedOpenLocks; // r0
  int v17; // r6
  CPlayerPed *v18; // r1
  ePedState m_nPedState; // r0
  int v20; // r3
  CPlayerPed *v21; // r0
  CEntity *v22; // r0
  CPlayerPed *v23; // r0
  ePedState v24; // r0
  CPlayerPed *v25; // r0
  CPlayerPed *v26; // r0
  int v27; // r0
  bool v28; // zf
  CPlayerPed *v29; // r0
  int ActiveCam; // r1
  CEntity *v31; // r0
  char *v32; // r3
  CEntity *v33; // r2
  char *v34; // r1

  this->m_bPlayerWasOnBike = 0;
  p_pTargetEntity = &this->pTargetEntity;
  pTargetEntity = this->pTargetEntity;
  if ( pTargetEntity
    && (*(_BYTE *)&pTargetEntity->m_info & 7) == 2
    && (float)((float)((float)(pTargetEntity[1].m_transform.m_translate.z * pTargetEntity[1].m_transform.m_translate.z)
                     + (float)(pTargetEntity[1].m_transform.m_heading * pTargetEntity[1].m_transform.m_heading))
             + (float)(*(float *)&pTargetEntity[1].m_pMat * *(float *)&pTargetEntity[1].m_pMat)) > 0.3 )
  {
    this->m_bPlayerWasOnBike = 1;
  }
  if ( this->WhoIsInControlOfTheCamera == 2 )
  {
    if ( (unsigned int)(this->m_iModeObbeCamIsInForCar - 7) > 1 )
      goto LABEL_15;
    v4 = FindPlayerPed(-1)->m_nPedState == PED_ARRESTED;
    if ( !FindPlayerVehicle(-1, 0) )
    {
      if ( *p_pTargetEntity )
        CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
      PlayerPed = FindPlayerPed(-1);
      *p_pTargetEntity = PlayerPed;
      CEntity::RegisterReference(PlayerPed, p_pTargetEntity);
    }
  }
  else
  {
    v4 = 0;
  }
  v6 = !v4;
  if ( !v4 )
    v6 = !this->m_bLookingAtPlayer;
  if ( !v6 )
  {
LABEL_15:
    if ( !this->m_uiTransitionState )
      goto LABEL_18;
  }
  if ( *p_pTargetEntity && !this->m_bTargetJustBeenOnTrain )
    return;
LABEL_18:
  if ( FindPlayerVehicle(-1, 0)
    && (CGameLogic::IsCoopGameGoingOn()
     || (v7 = FindPlayerPed(-1), !CTaskManager::GetSimplestActiveTask(&v7->m_pPedIntelligence->m_taskManager))
     || (v8 = FindPlayerPed(-1),
         SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&v8->m_pPedIntelligence->m_taskManager),
         (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 1022)) )
  {
    if ( *p_pTargetEntity )
      CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
    v11 = 0;
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    *p_pTargetEntity = PlayerVehicle;
    CEntity::RegisterReference(PlayerVehicle, p_pTargetEntity);
  }
  else
  {
    if ( *p_pTargetEntity )
      CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
    v10 = FindPlayerPed(-1);
    *p_pTargetEntity = v10;
    CEntity::RegisterReference(v10, p_pTargetEntity);
    if ( FindPlayerPed(-1)->m_nPedState == PED_ENTER_CAR
      || FindPlayerPed(-1)->m_nPedState == PED_CARJACK
      || FindPlayerPed(-1)->m_nPedState == PED_OPEN_DOOR )
    {
      v11 = 1;
    }
    else
    {
      ActiveCam = this->ActiveCam;
      v31 = this->pTargetEntity;
      v32 = (char *)this + 528 * ActiveCam;
      v33 = (CEntity *)*((_DWORD *)v32 + 217);
      if ( v31 != v33 )
      {
        if ( v33 )
        {
          CEntity::CleanUpOldReference(*((CEntity **)v32 + 217), (CEntity **)v32 + 217);
          ActiveCam = this->ActiveCam;
          v31 = this->pTargetEntity;
        }
        v34 = (char *)this + 528 * ActiveCam;
        *((_DWORD *)v34 + 217) = v31;
        CEntity::RegisterReference(v31, (CEntity **)v34 + 217);
      }
      v11 = 0;
    }
  }
  v13 = CWorld::PlayerInFocus;
  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  if ( pPed && (m_pMyVehicle = pPed->m_pMyVehicle) != 0 )
  {
    CanPedOpenLocks = CVehicle::CanPedOpenLocks(m_pMyVehicle, pPed);
    v17 = 0;
    v13 = CWorld::PlayerInFocus;
    if ( !CanPedOpenLocks )
      v17 = 1;
  }
  else
  {
    v17 = 1;
  }
  v18 = CWorld::Players[v13].pPed;
  m_nPedState = v18->m_nPedState;
  v20 = m_nPedState ^ 0x3B | v17;
  if ( !((v20 != 0) | v11) && this->m_nCarZoom )
  {
    if ( *p_pTargetEntity )
    {
      CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
      v13 = CWorld::PlayerInFocus;
      v18 = CWorld::Players[CWorld::PlayerInFocus].pPed;
    }
    v21 = (CPlayerPed *)v18->m_pMyVehicle;
    *p_pTargetEntity = v21;
    if ( !CWorld::Players[v13].pPed->m_pMyVehicle )
    {
      v21 = FindPlayerPed(-1);
      *p_pTargetEntity = v21;
    }
    CEntity::RegisterReference(v21, p_pTargetEntity);
    v18 = CWorld::Players[CWorld::PlayerInFocus].pPed;
    m_nPedState = v18->m_nPedState;
  }
  if ( m_nPedState == PED_CARJACK )
  {
    if ( !v17 )
    {
LABEL_46:
      if ( !v11 && this->m_nCarZoom )
      {
        if ( *p_pTargetEntity )
        {
          CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
          v18 = CWorld::Players[CWorld::PlayerInFocus].pPed;
        }
        v22 = v18->m_pMyVehicle;
        *p_pTargetEntity = v22;
        CEntity::RegisterReference(v22, p_pTargetEntity);
        v18 = CWorld::Players[CWorld::PlayerInFocus].pPed;
      }
      if ( !v18->m_pMyVehicle )
      {
        if ( *p_pTargetEntity )
          CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
        v23 = FindPlayerPed(-1);
        *p_pTargetEntity = v23;
        CEntity::RegisterReference(v23, p_pTargetEntity);
        v18 = CWorld::Players[CWorld::PlayerInFocus].pPed;
      }
    }
  }
  else if ( !v17 && m_nPedState == PED_OPEN_DOOR )
  {
    goto LABEL_46;
  }
  v24 = v18->m_nPedState;
  if ( v24 == PED_EXIT_CAR )
  {
    if ( *p_pTargetEntity )
      CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
    v25 = FindPlayerPed(-1);
    *p_pTargetEntity = v25;
    CEntity::RegisterReference(v25, p_pTargetEntity);
    v24 = CWorld::Players[CWorld::PlayerInFocus].pPed->m_nPedState;
  }
  if ( v24 == PED_DRAGGED_FROM_CAR )
  {
    if ( *p_pTargetEntity )
      CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
    v26 = FindPlayerPed(-1);
    *p_pTargetEntity = v26;
    CEntity::RegisterReference(v26, p_pTargetEntity);
  }
  v27 = *(_BYTE *)&(*p_pTargetEntity)->m_info & 7;
  v28 = v27 == 2;
  if ( v27 == 2 )
    v28 = this->m_nCarZoom == 0;
  if ( v28 && FindPlayerPed(-1)->m_nPedState == PED_ARRESTED )
  {
    if ( *p_pTargetEntity )
      CEntity::CleanUpOldReference(*p_pTargetEntity, p_pTargetEntity);
    v29 = FindPlayerPed(-1);
    *p_pTargetEntity = v29;
    sub_196050(v29, p_pTargetEntity);
  }
}

//----- (003DE0DC) --------------------------------------------------------
void __fastcall CCamera::ProcessScriptedCommands(CCamera *this)
{
  float *p_m_vectorMoveEndTime; // r0
  float v3; // s16
  float v4; // s0
  float m_vectorMoveStartTime; // s2
  _BOOL4 m_bVectorMoveSmoothEnds; // r0
  float x; // s18
  float v8; // s0
  float v9; // r0
  float y; // s2
  float v11; // s4
  float v12; // s6
  float v13; // s8
  float z; // s10
  float v15; // s12
  float m_vectorTrackEndTime; // s0
  float m_vectorTrackStartTime; // s2
  _BOOL4 m_bVectorTrackSmoothEnds; // r0
  float v19; // s18
  float v20; // s0
  float v21; // r0
  float v22; // s2
  float v23; // s4
  float v24; // s6
  float v25; // s8
  float v26; // s10
  float v27; // s12
  float m_FOVLerpEndTime; // s0
  float m_FOVLerpStartTime; // s2
  _BOOL4 m_bFOVLerpSmoothEnds; // r0
  float v31; // s0
  float v32; // s2
  float m_FOVLerpStart; // s16
  float v34; // s0

  p_m_vectorMoveEndTime = &this->m_vectorMoveEndTime;
  v3 = (float)CTimer::m_snTimeInMilliseconds;
  v4 = *p_m_vectorMoveEndTime;
  if ( *p_m_vectorMoveEndTime >= (float)CTimer::m_snTimeInMilliseconds )
  {
    m_vectorMoveStartTime = this->m_vectorMoveStartTime;
    m_bVectorMoveSmoothEnds = this->m_bVectorMoveSmoothEnds;
    x = this->m_vectorMoveFrom.x;
    this->m_bVectorMoveScript = 1;
    v8 = (float)(v3 - m_vectorMoveStartTime) / (float)(v4 - m_vectorMoveStartTime);
    if ( m_bVectorMoveSmoothEnds )
    {
      v9 = sinf((float)((float)(270.0 - (float)(v8 * 180.0)) * 3.1416) / 180.0);
      y = this->m_vectorMoveFrom.y;
      v11 = (float)(v9 + 1.0) * 0.5;
      v8 = this->m_vectorMoveTo.y - y;
      v12 = v11 * (float)(this->m_vectorMoveTo.x - x);
      v13 = v11;
    }
    else
    {
      v13 = v8;
      y = this->m_vectorMoveFrom.y;
      v11 = this->m_vectorMoveTo.y - y;
      v12 = v8 * (float)(this->m_vectorMoveTo.x - x);
    }
    z = this->m_vectorMoveFrom.z;
    v15 = this->m_vectorMoveTo.z - z;
    this->m_VectorMoveScript.x = x + v12;
    this->m_VectorMoveScript.y = y + (float)(v8 * v11);
    this->m_VectorMoveScript.z = z + (float)(v13 * v15);
  }
  else if ( this->m_bPersistCamPos )
  {
    this->m_bVectorMoveScript = 1;
  }
  m_vectorTrackEndTime = this->m_vectorTrackEndTime;
  if ( m_vectorTrackEndTime >= v3 )
  {
    m_vectorTrackStartTime = this->m_vectorTrackStartTime;
    m_bVectorTrackSmoothEnds = this->m_bVectorTrackSmoothEnds;
    v19 = this->m_vectorTrackFrom.x;
    this->m_bVectorTrackScript = 1;
    v20 = (float)(v3 - m_vectorTrackStartTime) / (float)(m_vectorTrackEndTime - m_vectorTrackStartTime);
    if ( m_bVectorTrackSmoothEnds )
    {
      v21 = sinf((float)((float)(270.0 - (float)(v20 * 180.0)) * 3.1416) / 180.0);
      v22 = this->m_vectorTrackFrom.y;
      v23 = (float)(v21 + 1.0) * 0.5;
      v20 = this->m_vectorTrackTo.y - v22;
      v24 = v23 * (float)(this->m_vectorTrackTo.x - v19);
      v25 = v23;
    }
    else
    {
      v25 = v20;
      v22 = this->m_vectorTrackFrom.y;
      v23 = this->m_vectorTrackTo.y - v22;
      v24 = v20 * (float)(this->m_vectorTrackTo.x - v19);
    }
    v26 = this->m_vectorTrackFrom.z;
    v27 = this->m_vectorTrackTo.z - v26;
    this->m_VectorTrackScript.x = v19 + v24;
    this->m_VectorTrackScript.y = v22 + (float)(v20 * v23);
    this->m_VectorTrackScript.z = v26 + (float)(v25 * v27);
  }
  else if ( this->m_bPersistCamLookAt )
  {
    this->m_bVectorTrackScript = 1;
  }
  m_FOVLerpEndTime = this->m_FOVLerpEndTime;
  if ( m_FOVLerpEndTime >= v3 )
  {
    m_FOVLerpStartTime = this->m_FOVLerpStartTime;
    m_bFOVLerpSmoothEnds = this->m_bFOVLerpSmoothEnds;
    v31 = m_FOVLerpEndTime - m_FOVLerpStartTime;
    v32 = v3 - m_FOVLerpStartTime;
    m_FOVLerpStart = this->m_FOVLerpStart;
    this->m_bFOVScript = 1;
    v34 = v32 / v31;
    if ( m_bFOVLerpSmoothEnds )
      v34 = (float)(sinf((float)((float)(270.0 - (float)(v34 * 180.0)) * 3.1416) / 180.0) + 1.0) * 0.5;
    this->m_MyFOV = m_FOVLerpStart + (float)(v34 * (float)(this->m_FOVLerpEnd - m_FOVLerpStart));
  }
  else if ( this->m_bPersistFOV )
  {
    this->m_bFOVScript = 1;
  }
}

//----- (003DE3DC) --------------------------------------------------------
void __fastcall CCamera::ProcessFade(CCamera *this)
{
  float v1; // s0
  float *v2; // r1
  float *p_m_fFloatingFade; // r1
  float m_fFloatingFade; // s2
  float m_fTimeToFadeOut; // s4
  float v6; // s2

  if ( this->m_bFading )
  {
    if ( !this->m_iFadingDirection )
    {
      p_m_fFloatingFade = &this->m_fFloatingFade;
      m_fFloatingFade = this->m_fFloatingFade;
      if ( m_fFloatingFade >= 255.0 )
        this->m_bFading = 0;
      m_fTimeToFadeOut = this->m_fTimeToFadeOut;
      if ( m_fTimeToFadeOut == 0.0 )
      {
        *p_m_fFloatingFade = 255.0;
      }
      else
      {
        v6 = m_fFloatingFade + (float)((float)((float)(CTimer::ms_fTimeStep / 50.0) * 255.0) / m_fTimeToFadeOut);
        *p_m_fFloatingFade = v6;
        if ( v6 < 255.0 )
          goto LABEL_15;
      }
      v6 = 255.0;
      *p_m_fFloatingFade = 255.0;
      goto LABEL_15;
    }
    if ( this->m_iFadingDirection == 1 )
    {
      v1 = this->m_fTimeToFadeOut;
      if ( v1 == 0.0 )
      {
        this->m_fFloatingFade = 0.0;
        v2 = &this->m_fFloatingFade;
LABEL_12:
        v6 = 0.0;
        this->m_bFading = 0;
        *v2 = 0.0;
        goto LABEL_15;
      }
      v2 = &this->m_fFloatingFade;
      v6 = this->m_fFloatingFade + (float)((float)((float)(CTimer::ms_fTimeStep / -50.0) * 255.0) / v1);
      this->m_fFloatingFade = v6;
      if ( v6 <= 0.0 )
        goto LABEL_12;
    }
    else
    {
      v6 = this->m_fFloatingFade;
    }
LABEL_15:
    CDraw::FadeValue = (unsigned int)v6;
  }
}

//----- (003DE4FC) --------------------------------------------------------
void __fastcall CCamera::ProcessMusicFade(CCamera *this)
{
  float m_fTimeToWaitToFadeMusic; // s0
  float m_fTimeToFadeMusic; // s0
  float *p_m_fFloatingFadeMusic; // r0
  float v5; // s0
  float m_fFloatingFadeMusic; // s0
  float v7; // s2
  float v8; // s0
  int v9; // r1

  if ( this->m_bMusicFading )
  {
    m_fTimeToWaitToFadeMusic = this->m_fTimeToWaitToFadeMusic;
    if ( m_fTimeToWaitToFadeMusic > 0.0 )
    {
      this->m_fTimeToWaitToFadeMusic = m_fTimeToWaitToFadeMusic + (float)(CTimer::ms_fTimeStep / -50.0);
      goto LABEL_19;
    }
    if ( this->m_iMusicFadingDirection == 1 )
    {
      m_fTimeToFadeMusic = this->m_fTimeToFadeMusic;
      if ( m_fTimeToFadeMusic <= 0.0 )
      {
        this->m_fFloatingFadeMusic = 1.0;
        p_m_fFloatingFadeMusic = &this->m_fFloatingFadeMusic;
      }
      else
      {
        p_m_fFloatingFadeMusic = &this->m_fFloatingFadeMusic;
        v5 = this->m_fFloatingFadeMusic + (float)((float)(CTimer::ms_fTimeStep / 50.0) / m_fTimeToFadeMusic);
        this->m_fFloatingFadeMusic = v5;
        if ( v5 < 1.0 )
          goto LABEL_19;
      }
      *(_WORD *)&this->m_bMusicFading = 0;
      v9 = 1065353216;
    }
    else
    {
      if ( this->m_iFadingDirection )
        goto LABEL_19;
      p_m_fFloatingFadeMusic = &this->m_fFloatingFadeMusic;
      m_fFloatingFadeMusic = this->m_fFloatingFadeMusic;
      if ( m_fFloatingFadeMusic <= 0.0 )
      {
        m_fFloatingFadeMusic = 0.0;
        *(_WORD *)&this->m_bMusicFading = 256;
        *p_m_fFloatingFadeMusic = 0.0;
      }
      v7 = this->m_fTimeToFadeMusic;
      if ( v7 <= 0.0 )
      {
        *p_m_fFloatingFadeMusic = 0.0;
      }
      else
      {
        v8 = m_fFloatingFadeMusic + (float)((float)(CTimer::ms_fTimeStep / -50.0) / v7);
        *p_m_fFloatingFadeMusic = v8;
        if ( v8 > 0.0 )
        {
LABEL_19:
          if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
          {
            CAudioEngine::SetMusicFaderScalingFactor(&AudioEngine, this->m_fFloatingFadeMusic);
            sub_1906AC(&AudioEngine, this->m_fFloatingFadeMusic);
          }
          return;
        }
      }
      v9 = 0;
    }
    *(_DWORD *)p_m_fFloatingFadeMusic = v9;
    goto LABEL_19;
  }
}

//----- (003DE65C) --------------------------------------------------------
void __fastcall CCamera::ProcessWideScreenOn(CCamera *this)
{
  float v1; // s0
  float v2; // s4
  float v3; // s2

  if ( this->m_bWantsToSwitchWidescreenOff )
  {
    v1 = 0.0;
    *(_WORD *)&this->m_bWantsToSwitchWidescreenOff = 0;
    v2 = 0.0;
    v3 = 0.0;
  }
  else
  {
    v3 = 1.0;
    v1 = 30.0;
    v2 = this->Cams[this->ActiveCam].FOV * 0.3;
  }
  this->m_fFOV_Wide_Screen = v2;
  this->m_ScreenReductionPercentage = v1;
  this->m_fWideScreenReductionAmount = v3;
}

//----- (003DE6AC) --------------------------------------------------------
void __fastcall CCamera::ProcessShake(CCamera *this)
{
  if ( this->m_shakeEndTime >= (float)CTimer::m_snTimeInMilliseconds )
    CCamera::ProcessShake(this, COERCE_FLOAT((CCamera *)&this->m_shakeEndTime));
}

//----- (003DE6D8) --------------------------------------------------------
void __fastcall CCamera::StoreValuesDuringInterPol(
        CCamera *this,
        CVector *TheSource,
        CVector *TheTarget,
        CVector *TheUp,
        float *TheFOV)
{
  __int64 v6; // d16
  __int64 v7; // d16
  CVector *p_TargetDuringInter; // r0
  __int64 v9; // d16
  float y; // s0
  float z; // s16
  float v12; // s2
  float v13; // s20
  float v14; // r1
  float v15; // s18

  v6 = *(_QWORD *)&TheSource->x;
  this->SourceDuringInter.z = TheSource->z;
  *(_QWORD *)&this->SourceDuringInter.x = v6;
  v7 = *(_QWORD *)&TheTarget->x;
  this->TargetDuringInter.z = TheTarget->z;
  p_TargetDuringInter = &this->TargetDuringInter;
  *(_QWORD *)&p_TargetDuringInter->x = v7;
  v9 = *(_QWORD *)&TheUp->x;
  this->UpDuringInter.z = TheUp->z;
  *(_QWORD *)&this->UpDuringInter.x = v9;
  y = this->TargetDuringInter.y;
  this->FOVDuringInter = *TheFOV;
  z = TheSource->z;
  v12 = TheSource->x - p_TargetDuringInter->x;
  v13 = this->TargetDuringInter.z;
  v14 = TheSource->y - y;
  v15 = sqrtf((float)(v12 * v12) + (float)(v14 * v14));
  this->m_fBetaDuringInterPol = CGeneral::GetATanOfXY(v12, v14);
  this->m_fAlphaDuringInterPol = CGeneral::GetATanOfXY(v15, z - v13);
}

//----- (003DE784) --------------------------------------------------------
void __fastcall CCamera::CalculateDerivedValues(CCamera *this, bool bMirror, bool bUpdateOrientation)
{
  _BOOL4 v5; // r8
  float xy; // s16
  float yy; // s18
  float v8; // s0
  CMatrix v9; // [sp+0h] [bp-68h] BYREF

  v5 = bUpdateOrientation;
  Invert(&v9, &this->m_cameraMatrix);
  CMatrix::operator=(&this->m_matInverse, &v9);
  CMatrix::~CMatrix(&v9);
  CCamera::CalculateFrustumPlanes(this, bMirror);
  xy = this->m_cameraMatrix.xy;
  if ( xy == 0.0 && (yy = this->m_cameraMatrix.yy, yy == 0.0) )
  {
    xy = 0.0001;
    this->m_cameraMatrix.xy = 0.0001;
  }
  else
  {
    yy = this->m_cameraMatrix.yy;
    if ( v5 )
      this->Orientation = atan2f(this->m_cameraMatrix.xy, yy);
  }
  this->CamFrontXNorm = xy;
  this->CamFrontYNorm = yy;
  v8 = sqrtf((float)(xy * xy) + (float)(yy * yy));
  if ( v8 == 0.0 )
  {
    this->CamFrontXNorm = 1.0;
  }
  else
  {
    this->CamFrontXNorm = xy / v8;
    this->CamFrontYNorm = yy / v8;
  }
}

//----- (003DE860) --------------------------------------------------------
void __fastcall CCamera::CopyCameraMatrixToRWCam(CCamera *this, bool bMirrorCam)
{
  _BOOL4 v3; // r8
  char *parent; // r5
  __int64 *v5; // r9
  __int64 *v6; // r6
  char v7; // r0
  char v8; // r0
  char v9; // r0
  char v10; // r0
  __int64 *v11; // r0
  float32x2_t v12; // d16
  unsigned __int64 v13; // d1
  __int64 v14; // d16
  __int64 *v15; // r1
  float32x2_t v16; // d16
  unsigned __int64 v17; // d2
  __int64 v18; // d16
  float32x2_t v19; // d16
  unsigned __int64 v20; // d2
  __int64 v21; // d16
  float32x2_t v22; // d16
  unsigned __int64 v23; // d2
  __int64 v24; // d16
  __int64 v25; // d16
  __int64 v26; // d16
  __int64 v27; // d16
  __int64 v28; // d16

  v3 = bMirrorCam;
  parent = (char *)this->m_pRwCamera->object.object.parent;
  v5 = (__int64 *)(parent + 16);
  if ( !bMirrorCam )
    CMatrix::UpdateMatrix(&this->m_cameraMatrixOld, (RwMatrix *)(parent + 16));
  *((_DWORD *)parent + 16) = LODWORD(this->m_cameraMatrix.tx);
  v6 = (__int64 *)(parent + 64);
  *((_DWORD *)parent + 17) = LODWORD(this->m_cameraMatrix.ty);
  *((_DWORD *)parent + 18) = LODWORD(this->m_cameraMatrix.tz);
  *((_DWORD *)parent + 12) = LODWORD(this->m_cameraMatrix.xy);
  *((_DWORD *)parent + 13) = LODWORD(this->m_cameraMatrix.yy);
  *((_DWORD *)parent + 14) = LODWORD(this->m_cameraMatrix.zy);
  *((_DWORD *)parent + 8) = LODWORD(this->m_cameraMatrix.xz);
  *((_DWORD *)parent + 9) = LODWORD(this->m_cameraMatrix.yz);
  *((_DWORD *)parent + 10) = LODWORD(this->m_cameraMatrix.zz);
  *((_DWORD *)parent + 4) = LODWORD(this->m_cameraMatrix.xx);
  *((_DWORD *)parent + 5) = LODWORD(this->m_cameraMatrix.yx);
  *((_DWORD *)parent + 6) = LODWORD(this->m_cameraMatrix.zx);
  v7 = `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans;
  __dmb(0xBu);
  if ( (v7 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans) )
  {
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.x = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.y = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.z = -99999.0;
    _cxa_guard_release((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans);
  }
  v8 = `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt;
  __dmb(0xBu);
  if ( (v8 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt) )
  {
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.x = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.y = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.z = -99999.0;
    _cxa_guard_release((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt);
  }
  v9 = `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp;
  __dmb(0xBu);
  if ( (v9 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp) )
  {
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.x = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.y = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.z = -99999.0;
    _cxa_guard_release((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp);
  }
  v10 = `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight;
  __dmb(0xBu);
  if ( (v10 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight) )
  {
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.x = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.y = -99999.0;
    CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.z = -99999.0;
    _cxa_guard_release((__guard *)&`guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight);
  }
  v11 = (__int64 *)(parent + 48);
  v12.n64_u64[0] = vsub_f32(
                     *(float32x2_t *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.y,
                     *(float32x2_t *)(parent + 68)).n64_u64[0];
  v13 = vmul_f32(v12, v12).n64_u64[0];
  if ( (float)((float)((float)((float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.x
                                     - *((float *)parent + 16))
                             * (float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.x
                                     - *((float *)parent + 16)))
                     + *(float *)&v13)
             + *((float *)&v13 + 1)) < 1.0e-10 )
  {
    v14 = *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.x;
    *((_DWORD *)parent + 18) = LODWORD(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.z);
    *v6 = v14;
  }
  v15 = (__int64 *)(parent + 32);
  v16.n64_u64[0] = vsub_f32(
                     *(float32x2_t *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.y,
                     *(float32x2_t *)(parent + 52)).n64_u64[0];
  v17 = vmul_f32(v16, v16).n64_u64[0];
  if ( (float)((float)((float)((float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.x
                                     - *((float *)parent + 12))
                             * (float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.x
                                     - *((float *)parent + 12)))
                     + *(float *)&v17)
             + *((float *)&v17 + 1)) < 1.0e-10 )
  {
    v18 = *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.x;
    *((_DWORD *)parent + 14) = LODWORD(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.z);
    *v11 = v18;
  }
  v19.n64_u64[0] = vsub_f32(
                     *(float32x2_t *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.y,
                     *(float32x2_t *)(parent + 36)).n64_u64[0];
  v20 = vmul_f32(v19, v19).n64_u64[0];
  if ( (float)((float)((float)((float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.x - *((float *)parent + 8))
                             * (float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.x - *((float *)parent + 8)))
                     + *(float *)&v20)
             + *((float *)&v20 + 1)) < 1.0e-10 )
  {
    v21 = *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.x;
    *((_DWORD *)parent + 10) = LODWORD(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.z);
    *v15 = v21;
  }
  v22.n64_u64[0] = vsub_f32(
                     *(float32x2_t *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.y,
                     *(float32x2_t *)(parent + 20)).n64_u64[0];
  v23 = vmul_f32(v22, v22).n64_u64[0];
  if ( (float)((float)((float)((float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.x
                                     - *((float *)parent + 4))
                             * (float)(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.x
                                     - *((float *)parent + 4)))
                     + *(float *)&v23)
             + *((float *)&v23 + 1)) < 1.0e-10 )
  {
    v24 = *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.x;
    *((_DWORD *)parent + 6) = LODWORD(CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.z);
    *v5 = v24;
  }
  v25 = *v6;
  CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.z = *((RwReal *)parent + 18);
  *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans.x = v25;
  v26 = *v11;
  CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.z = *((RwReal *)parent + 14);
  *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt.x = v26;
  v27 = *v15;
  CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.z = *((RwReal *)parent + 10);
  *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp.x = v27;
  v28 = *v5;
  CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.z = *((RwReal *)parent + 6);
  *(_QWORD *)&CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight.x = v28;
  RwMatrixUpdate((RwMatrix *)(parent + 16));
  RwFrameUpdateObjects((RwFrame_0 *)parent);
  RwFrameOrthoNormalize((RwFrame_0 *)parent);
  if ( this->m_bResetOldMatrix && !v3 )
  {
    CMatrix::UpdateMatrix(&this->m_cameraMatrixOld, (RwMatrix *)(parent + 16));
    this->m_bResetOldMatrix = 0;
  }
}
// 952F04: using guessed type char `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraTrans;
// 952F14: using guessed type char `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraAt;
// 952F24: using guessed type char `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraUp;
// 952F34: using guessed type char `guard variable for'CCamera::CopyCameraMatrixToRWCam(bool)::gLastRWCameraRight;

//----- (003DEBD8) --------------------------------------------------------
void __fastcall CCamera::UpdateSoundDistances(CCamera *this)
{
  float v2; // s0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  float v5; // s4
  float v6; // s6
  float x; // s8
  float v8; // s0
  UInt32 v9; // r5
  float SoundDistUpAsRead; // s16
  CEntity *refEntityPtr; // [sp+1Ch] [bp-4Ch] BYREF
  CColPoint colPoint; // [sp+20h] [bp-48h] BYREF
  CVector vecStart; // [sp+4Ch] [bp-1Ch] BYREF

  v2 = 5.0;
  switch ( this->Cams[this->ActiveCam].Mode )
  {
    case 7:
    case 8:
    case 0x10:
    case 0x22:
    case 0x27:
    case 0x28:
    case 0x29:
    case 0x2A:
    case 0x2B:
    case 0x2D:
    case 0x2E:
    case 0x33:
    case 0x34:
      v2 = 5.0;
      if ( (*(_BYTE *)&this->pTargetEntity->m_info & 7) == 3 )
        v2 = 0.5;
      break;
    default:
      break;
  }
  m_pMat = this->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &this->m_transform;
  v5 = v2 * this->m_cameraMatrix.yy;
  v6 = v2 * this->m_cameraMatrix.xy;
  x = p_tx->m_translate.x;
  v8 = (float)(v2 * this->m_cameraMatrix.zy) + p_tx->m_translate.z;
  v9 = CTimer::m_FrameCounter % 0xC;
  vecStart.y = v5 + p_tx->m_translate.y;
  vecStart.x = v6 + x;
  vecStart.z = v8;
  if ( CTimer::m_FrameCounter % 0xC )
  {
    SoundDistUpAsRead = this->SoundDistUpAsRead;
  }
  else
  {
    SoundDistUpAsRead = 20.0;
    this->SoundDistUpAsReadOld = this->SoundDistUpAsRead;
    if ( CWorld::ProcessVerticalLine(&vecStart, v8 + 20.0, &colPoint, &refEntityPtr, 1, 0, 0, 0, 1, 0, 0) )
      SoundDistUpAsRead = colPoint.m_vecPosition.z - vecStart.z;
    this->SoundDistUpAsRead = SoundDistUpAsRead;
  }
  this->SoundDistUp = (float)((float)((float)(int)(v9 + 1) / 6.0) * SoundDistUpAsRead)
                    + (float)((float)(1.0 - (float)((float)(int)(v9 + 1) / 6.0)) * this->SoundDistUpAsReadOld);
}

//----- (003DED48) --------------------------------------------------------
void __fastcall CCamera::CalculateMirroredMatrix(
        CCamera *this,
        CVector MirrorNormal,
        float MirrorV,
        CMatrix *pMat,
        CMatrix *pResult)
{
  float tx; // s2
  float ty; // s4
  float tz; // s6
  float v8; // s10
  float v9; // s10
  float xy; // s2
  float yy; // s4
  float zy; // s6
  float v13; // s10
  float v14; // s10
  float v15; // s6
  float v16; // s4
  float v17; // s2
  float xz; // s10
  float yz; // s12
  float zz; // s1
  float v21; // s3
  float v22; // s3
  float v23; // s8
  float v24; // s0
  float v25; // s10

  tx = pMat->tx;
  ty = pMat->ty;
  tz = pMat->tz;
  v8 = (float)((float)((float)(tx * MirrorNormal.x) + (float)(ty * MirrorNormal.y)) + (float)(tz * MirrorNormal.z))
     - MirrorV;
  v9 = v8 + v8;
  pResult->tx = tx - (float)(v9 * MirrorNormal.x);
  pResult->ty = ty - (float)(v9 * MirrorNormal.y);
  pResult->tz = tz - (float)(v9 * MirrorNormal.z);
  xy = pMat->xy;
  yy = pMat->yy;
  zy = pMat->zy;
  v13 = (float)((float)(xy * MirrorNormal.x) + (float)(yy * MirrorNormal.y)) + (float)(zy * MirrorNormal.z);
  v14 = v13 + v13;
  v15 = zy - (float)(v14 * MirrorNormal.z);
  v16 = yy - (float)(v14 * MirrorNormal.y);
  v17 = xy - (float)(v14 * MirrorNormal.x);
  pResult->xy = v17;
  pResult->yy = v16;
  pResult->zy = v15;
  xz = pMat->xz;
  yz = pMat->yz;
  zz = pMat->zz;
  v21 = (float)((float)(xz * MirrorNormal.x) + (float)(yz * MirrorNormal.y)) + (float)(zz * MirrorNormal.z);
  v22 = v21 + v21;
  v23 = xz - (float)(v22 * MirrorNormal.x);
  v24 = yz - (float)(v22 * MirrorNormal.y);
  v25 = zz - (float)(v22 * MirrorNormal.z);
  pResult->xz = v23;
  pResult->yz = v24;
  pResult->zz = v25;
  pResult->xx = (float)(v15 * v24) - (float)(v16 * v25);
  pResult->yx = (float)(v17 * v25) - (float)(v15 * v23);
  pResult->zx = (float)(v23 * v16) - (float)(v17 * v24);
}

//----- (003DEE6C) --------------------------------------------------------
void __fastcall CCamera::SetCameraUpForMirror(CCamera *this)
{
  CMatrix *p_m_cameraMatrix; // r5
  float xy; // s0
  float yy; // s2
  float v5; // s4
  RenderQueue *v6; // r1
  unsigned __int8 *mainWorkPointer; // r2
  RenderQueue *v8; // r1
  RenderQueue *v9; // r4
  __int64 v10; // kr00_8
  unsigned int *p_mainPointer; // r0
  unsigned int v12; // r2
  CMatrix v13; // [sp+0h] [bp-58h] BYREF

  p_m_cameraMatrix = &this->m_cameraMatrix;
  CMatrix::operator=(&StoreMatrixForMirror, &this->m_cameraMatrix);
  CMatrix::operator=(p_m_cameraMatrix, &this->m_matMirror);
  CCamera::CopyCameraMatrixToRWCam(this, 1);
  Invert(&v13, p_m_cameraMatrix);
  CMatrix::operator=(&this->m_matInverse, &v13);
  CMatrix::~CMatrix(&v13);
  CCamera::CalculateFrustumPlanes(this, 1);
  xy = this->m_cameraMatrix.xy;
  if ( xy == 0.0 )
  {
    yy = this->m_cameraMatrix.yy;
    if ( yy == 0.0 )
    {
      xy = 0.0001;
      this->m_cameraMatrix.xy = 0.0001;
    }
  }
  else
  {
    yy = this->m_cameraMatrix.yy;
  }
  this->CamFrontXNorm = xy;
  this->CamFrontYNorm = yy;
  v5 = sqrtf((float)(yy * yy) + (float)(xy * xy));
  if ( v5 == 0.0 )
  {
    this->CamFrontXNorm = 1.0;
  }
  else
  {
    this->CamFrontXNorm = xy / v5;
    this->CamFrontYNorm = yy / v5;
  }
  v6 = renderQueue;
  mainWorkPointer = renderQueue->mainWorkPointer;
  renderQueue->curQueueingCommand = rqSetWindingOrder;
  *(_DWORD *)mainWorkPointer = 41;
  v6->mainWorkPointer += 4;
  v8 = renderQueue;
  *(_DWORD *)renderQueue->mainWorkPointer = 1;
  v8->mainWorkPointer += 4;
  v9 = renderQueue;
  if ( renderQueue->useMutex )
    OS_MutexObtain(renderQueue->commandMutex);
  v10 = *(_QWORD *)&v9->mainPointer;
  p_mainPointer = (unsigned int *)&v9->mainPointer;
  __dmb(0xBu);
  do
    v12 = __ldrex(p_mainPointer);
  while ( __strex(v12 + HIDWORD(v10) - v10, p_mainPointer) );
  __dmb(0xBu);
  if ( v9->useMutex )
    OS_MutexRelease(v9->commandMutex);
  if ( !v9->multiThread )
    RenderQueue::Process(v9);
  if ( v9->mainPointer + 1024 > v9->queueEnd )
    RenderQueue::Flush(v9);
}

//----- (003DEFDC) --------------------------------------------------------
void __fastcall CCamera::RestoreCameraAfterMirror(CCamera *this)
{
  float xy; // s0
  float yy; // s2
  float v4; // s4
  RenderQueue *v5; // r1
  unsigned __int8 *mainWorkPointer; // r2
  RenderQueue *v7; // r1
  RenderQueue *v8; // r4
  __int64 v9; // kr00_8
  unsigned int *p_mainPointer; // r0
  unsigned int v11; // r2
  CMatrix v12; // [sp+0h] [bp-50h] BYREF

  CPlaceable::SetMatrix(this, &StoreMatrixForMirror);
  CCamera::CopyCameraMatrixToRWCam(this, 1);
  Invert(&v12, &this->m_cameraMatrix);
  CMatrix::operator=(&this->m_matInverse, &v12);
  CMatrix::~CMatrix(&v12);
  CCamera::CalculateFrustumPlanes(this, 0);
  xy = this->m_cameraMatrix.xy;
  if ( xy == 0.0 )
  {
    yy = this->m_cameraMatrix.yy;
    if ( yy == 0.0 )
    {
      xy = 0.0001;
      this->m_cameraMatrix.xy = 0.0001;
    }
  }
  else
  {
    yy = this->m_cameraMatrix.yy;
  }
  this->CamFrontXNorm = xy;
  this->CamFrontYNorm = yy;
  v4 = sqrtf((float)(yy * yy) + (float)(xy * xy));
  if ( v4 == 0.0 )
  {
    this->CamFrontXNorm = 1.0;
  }
  else
  {
    this->CamFrontXNorm = xy / v4;
    this->CamFrontYNorm = yy / v4;
  }
  v5 = renderQueue;
  mainWorkPointer = renderQueue->mainWorkPointer;
  renderQueue->curQueueingCommand = rqSetWindingOrder;
  *(_DWORD *)mainWorkPointer = 41;
  v5->mainWorkPointer += 4;
  v7 = renderQueue;
  *(_DWORD *)renderQueue->mainWorkPointer = 0;
  v7->mainWorkPointer += 4;
  v8 = renderQueue;
  if ( renderQueue->useMutex )
    OS_MutexObtain(renderQueue->commandMutex);
  v9 = *(_QWORD *)&v8->mainPointer;
  p_mainPointer = (unsigned int *)&v8->mainPointer;
  __dmb(0xBu);
  do
    v11 = __ldrex(p_mainPointer);
  while ( __strex(v11 + HIDWORD(v9) - v9, p_mainPointer) );
  __dmb(0xBu);
  if ( v8->useMutex )
    OS_MutexRelease(v8->commandMutex);
  if ( !v8->multiThread )
    RenderQueue::Process(v8);
  if ( v8->mainPointer + 1024 > v8->queueEnd )
    RenderQueue::Flush(v8);
}

//----- (003DF138) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CCamera::DealWithMirrorBeforeConstructRenderList(
        CCamera *this,
        _BOOL4 bMirrorActive,
        CVector MirrorNormal,
        float MirrorV,
        CMatrix *pMatrix)
{
  CMatrix *p_m_matMirror; // r5
  float yz; // s8
  float yy; // s10
  float xy; // s12
  float ty; // s5
  float tx; // s11
  float xz; // s6
  float zy; // s16
  float tz; // s3
  float zz; // s13
  float v16; // s1
  float v17; // s14
  float v18; // s1
  float v19; // s0
  float v20; // s14
  float v21; // s0
  float v22; // s7
  float v23; // s12
  float v24; // s10
  float v25; // s8
  float v26; // s6
  float v27; // s14
  CMatrix v28; // [sp+0h] [bp-78h] BYREF

  this->m_bMirrorActive = bMirrorActive;
  if ( bMirrorActive )
  {
    if ( pMatrix )
    {
      p_m_matMirror = &this->m_matMirror;
      CMatrix::operator=(&this->m_matMirror, pMatrix);
    }
    else
    {
      yz = this->m_cameraMatrix.yz;
      yy = this->m_cameraMatrix.yy;
      xy = this->m_cameraMatrix.xy;
      ty = this->m_cameraMatrix.ty;
      tx = this->m_cameraMatrix.tx;
      xz = this->m_cameraMatrix.xz;
      zy = this->m_cameraMatrix.zy;
      p_m_matMirror = &this->m_matMirror;
      tz = this->m_cameraMatrix.tz;
      zz = this->m_cameraMatrix.zz;
      v16 = (float)((float)(xy * MirrorNormal.x) + (float)(yy * MirrorNormal.y)) + (float)(zy * MirrorNormal.z);
      v17 = (float)((float)(xz * MirrorNormal.x) + (float)(yz * MirrorNormal.y)) + (float)(zz * MirrorNormal.z);
      v18 = v16 + v16;
      v19 = (float)((float)((float)(tx * MirrorNormal.x) + (float)(ty * MirrorNormal.y)) + (float)(tz * MirrorNormal.z))
          - MirrorV;
      v20 = v17 + v17;
      v21 = v19 + v19;
      v22 = zy - (float)(v18 * MirrorNormal.z);
      v23 = xy - (float)(v18 * MirrorNormal.x);
      v24 = yy - (float)(v18 * MirrorNormal.y);
      v25 = yz - (float)(v20 * MirrorNormal.y);
      v26 = xz - (float)(v20 * MirrorNormal.x);
      this->m_matMirror.zy = v22;
      v27 = zz - (float)(v20 * MirrorNormal.z);
      this->m_matMirror.yy = v24;
      this->m_matMirror.xy = v23;
      this->m_matMirror.tz = tz - (float)(v21 * MirrorNormal.z);
      this->m_matMirror.ty = ty - (float)(v21 * MirrorNormal.y);
      this->m_matMirror.tx = tx - (float)(v21 * MirrorNormal.x);
      this->m_matMirror.zz = v27;
      this->m_matMirror.yz = v25;
      this->m_matMirror.xz = v26;
      this->m_matMirror.zx = (float)(v24 * v26) - (float)(v23 * v25);
      this->m_matMirror.yx = (float)(v23 * v27) - (float)(v22 * v26);
      this->m_matMirror.xx = (float)(v22 * v25) - (float)(v24 * v27);
    }
    Invert(&v28, p_m_matMirror);
    CMatrix::operator=(&this->m_matMirrorInverse, &v28);
    CMatrix::~CMatrix(&v28);
  }
}
// 3DF138: fragmented variable at 0:r2.8,8:^80.4 may be wrong
// 3DF138: variables would overlap: 0:r2.8,8:^80.4 and ^80.4

//----- (003DF2FC) --------------------------------------------------------
void __fastcall CCamera::SetToSphereMap(CCamera *this, float radius)
{
  this->m_sphereMapRadius = radius * radius;
}

//----- (003DF310) --------------------------------------------------------
void __fastcall CCamera::CalculateFrustumPlanes(CCamera *this, bool bMirrored)
{
  _BOOL4 v3; // r8
  float v4; // r6
  float v5; // r5
  float v6; // r0
  CVector *m_vecFrustumNormals; // r3
  float screenWidth; // s2
  float screenHeight; // s6
  float v10; // s2
  RwReal v11; // s0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r0
  float y; // s2
  float z; // s4
  float v16; // s2
  float v17; // s0
  float v18; // s6
  float *v19; // r0
  CMatrix *v20; // r1
  CSimpleTransform *p_m_transform; // r0
  float v22; // s2

  v3 = bMirrored;
  v4 = (float)(CDraw::ms_fFOV * 0.017453) * 0.5;
  v5 = cosf(v4);
  v6 = sinf(v4);
  this->m_vecFrustumNormals[1].z = 0.0;
  m_vecFrustumNormals = this->m_vecFrustumNormals;
  this->m_vecFrustumNormals[0].z = 0.0;
  this->m_vecFrustumNormals[0].x = v5;
  this->m_vecFrustumNormals[1].y = -v6;
  this->m_vecFrustumNormals[0].y = -v6;
  this->m_vecFrustumNormals[1].x = -v5;
  screenWidth = (float)RsGlobal.screenWidth;
  screenHeight = (float)RsGlobal.screenHeight;
  this->m_vecFrustumNormals[2].x = 0.0;
  this->m_vecFrustumNormals[3].x = 0.0;
  v10 = screenHeight / screenWidth;
  v11 = -(float)(v6 * v10);
  this->m_vecFrustumNormals[2].y = v11;
  this->m_vecFrustumNormals[3].z = v5 * v10;
  this->m_vecFrustumNormals[3].y = v11;
  this->m_vecFrustumNormals[2].z = -(float)(v5 * v10);
  if ( v3 )
  {
    TransformVectors(this->m_vecFrustumWorldNormals_Mirror, 4, &this->m_cameraMatrix, m_vecFrustumNormals);
    m_pMat = this->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    y = this->m_vecFrustumWorldNormals_Mirror[1].y;
    this->m_fFrustumPlaneOffsets_Mirror[0] = (float)((float)(this->m_vecFrustumWorldNormals_Mirror[0].x
                                                           * p_tx->m_translate.x)
                                                   + (float)(this->m_vecFrustumWorldNormals_Mirror[0].y
                                                           * p_tx->m_translate.y))
                                           + (float)(this->m_vecFrustumWorldNormals_Mirror[0].z * p_tx->m_translate.z);
    this->m_fFrustumPlaneOffsets_Mirror[1] = (float)((float)(this->m_vecFrustumWorldNormals_Mirror[1].x
                                                           * p_tx->m_translate.x)
                                                   + (float)(y * p_tx->m_translate.y))
                                           + (float)(this->m_vecFrustumWorldNormals_Mirror[1].z * p_tx->m_translate.z);
    this->m_fFrustumPlaneOffsets_Mirror[2] = (float)((float)(this->m_vecFrustumWorldNormals_Mirror[2].x
                                                           * p_tx->m_translate.x)
                                                   + (float)(this->m_vecFrustumWorldNormals_Mirror[2].y
                                                           * p_tx->m_translate.y))
                                           + (float)(this->m_vecFrustumWorldNormals_Mirror[2].z * p_tx->m_translate.z);
    z = p_tx->m_translate.z;
    v16 = this->m_vecFrustumWorldNormals_Mirror[3].y * p_tx->m_translate.y;
    v17 = this->m_vecFrustumWorldNormals_Mirror[3].x * p_tx->m_translate.x;
    v18 = this->m_vecFrustumWorldNormals_Mirror[3].z;
    v19 = &this->m_fFrustumPlaneOffsets_Mirror[3];
  }
  else
  {
    TransformVectors(this->m_vecFrustumWorldNormals, 4, &this->m_cameraMatrix, m_vecFrustumNormals);
    v20 = this->m_pMat;
    p_m_transform = (CSimpleTransform *)&v20->tx;
    if ( !v20 )
      p_m_transform = &this->m_transform;
    v22 = this->m_vecFrustumWorldNormals[1].y;
    this->m_fFrustumPlaneOffsets[0] = (float)((float)(this->m_vecFrustumWorldNormals[0].x * p_m_transform->m_translate.x)
                                            + (float)(this->m_vecFrustumWorldNormals[0].y * p_m_transform->m_translate.y))
                                    + (float)(this->m_vecFrustumWorldNormals[0].z * p_m_transform->m_translate.z);
    this->m_fFrustumPlaneOffsets[1] = (float)((float)(this->m_vecFrustumWorldNormals[1].x * p_m_transform->m_translate.x)
                                            + (float)(v22 * p_m_transform->m_translate.y))
                                    + (float)(this->m_vecFrustumWorldNormals[1].z * p_m_transform->m_translate.z);
    this->m_fFrustumPlaneOffsets[2] = (float)((float)(this->m_vecFrustumWorldNormals[2].x * p_m_transform->m_translate.x)
                                            + (float)(this->m_vecFrustumWorldNormals[2].y * p_m_transform->m_translate.y))
                                    + (float)(this->m_vecFrustumWorldNormals[2].z * p_m_transform->m_translate.z);
    z = p_m_transform->m_translate.z;
    v16 = this->m_vecFrustumWorldNormals[3].y * p_m_transform->m_translate.y;
    v17 = this->m_vecFrustumWorldNormals[3].x * p_m_transform->m_translate.x;
    v18 = this->m_vecFrustumWorldNormals[3].z;
    v19 = &this->m_fFrustumPlaneOffsets[3];
  }
  *v19 = (float)(v17 + v16) + (float)(v18 * z);
}

//----- (003DF60C) --------------------------------------------------------
bool __fastcall CCamera::TryToStartNewCamMode(CCamera *this, Int32 MovieCamMode)
{
  bool v2; // r5
  CVehicle *PlayerVehicle; // r0
  CEntity *v4; // r6
  CMatrix *m_pMat; // r1
  CVehicle *v6; // r0
  CMatrix *v7; // r1
  float *p_tx; // r2
  CMatrix *v9; // r1
  const CVector *p_m_translate; // r0
  float GroundZFor3DCoord; // r0
  float v12; // s18
  float v13; // s20
  float v14; // s22
  const CVector *PlayerSpeed; // r0
  float v16; // s2
  float RoofZFor3DCoord; // r0
  float v18; // s18
  float v19; // s20
  float v20; // s22
  const CVector *v21; // r0
  __int64 v22; // d16
  CEntity *v23; // r0
  float *v24; // r6
  float v25; // s2
  float v26; // r0
  __int64 v27; // d16
  CEntity *v28; // r0
  float *v29; // r6
  float *v30; // r0
  CEntity *v31; // r1
  CVehiclePool *v32; // r11
  int32 m_nSize; // r0
  int v34; // r6
  int i; // r4
  CPool<CVehicle,CHeli>::StorageType *m_aStorage; // r5
  uint8 *v37; // r9
  CEntity *v38; // r10
  CVehicle *v39; // r0
  bool v40; // zf
  int v41; // r1
  uint8 *v42; // r0
  int v43; // r9
  float *v44; // r1
  int v45; // r0
  float v46; // s20
  int v47; // r1
  float x; // s22
  int v49; // r0
  float v50; // s24
  float y; // s26
  int v52; // r0
  float32x2_t v53; // d16
  unsigned __int64 v54; // d1
  float v55; // s20
  float xy; // s22
  float v57; // s20
  CVehicle *v58; // r0
  float v59; // s22
  float v60; // s24
  float *v61; // r5
  CVehiclePool *v62; // r10
  int32 v63; // r4
  float32x2_t v64; // d8
  float32x2_t v65; // d9
  float v66; // s20
  float v67; // s22
  float32x2_t v68; // d16
  unsigned __int64 v69; // d1
  float v70; // s16
  float32x2_t v71; // d9
  float32x2_t v72; // d10
  float32x2_t *v73; // r0
  unsigned __int64 v74; // d2
  float v75; // r6
  float v76; // s22
  __int64 v77; // kr00_8
  float z; // s20
  float v79; // r0
  float v80; // r0
  float v81; // r6
  float v82; // s24
  __int64 v83; // kr08_8
  float v84; // s22
  float v85; // r0
  float v86; // r0
  float v87; // s0
  float v88; // s0
  CEntity *v89; // r0
  CEntity *v90; // r0
  CEntity *v91; // r0
  CEntity *v92; // r0
  CEntity *v93; // r0
  CEntity *v94; // r0
  CEntity *v95; // r0
  float *v96; // r4
  float v97; // s0
  CEntity *v98; // r1
  const CVector *v99; // r0
  RwReal v100; // r2
  float v101; // r5
  float v102; // s20
  __int64 v103; // kr10_8
  float v104; // r0
  const CVector *v105; // r0
  RwReal v106; // r2
  float v107; // r5
  float v108; // s20
  __int64 v109; // kr18_8
  float v110; // r0
  float v111; // s18
  float32x2_t v112; // d16
  unsigned __int64 v113; // d1
  float v114; // s0
  float v115; // s16
  float32x2_t v116; // d16
  unsigned __int64 v117; // d1
  float v118; // s0
  int v119; // r11
  int v120; // r9
  CPool<CVehicle,CHeli>::StorageType *v121; // r4
  uint8 *v122; // r5
  CEntity *v123; // r6
  CVehicle *v124; // r0
  bool v125; // zf
  int v126; // r1
  int v127; // r8
  int v128; // r4
  int v129; // r1
  float *v130; // r0
  float v131; // s20
  int v132; // r0
  int v133; // r1
  float v134; // s22
  float v135; // s24
  float v136; // s26
  int v137; // r0
  float32x2_t v138; // d16
  unsigned __int64 v139; // d1
  float v140; // s20
  float v141; // s22
  float v142; // s20
  CVehicle *v143; // r0
  float v144; // s22
  float v145; // s24
  const CMatrix *v146; // r1
  const CVector *v147; // r0
  int v148; // r2
  float *p_x; // r1
  const CVector *v150; // r1
  float *v151; // r4
  float v152; // s16
  float32x2_t v153; // d16
  unsigned __int64 v154; // d1
  float v155; // s0
  float v156; // s18
  float32x2_t v157; // d9
  float32x2_t v158; // d10
  float v159; // s22
  float v160; // s24
  float32x2_t v161; // d16
  unsigned __int64 v162; // d1
  float v163; // s18
  float32x2_t v164; // d10
  float32x2_t v165; // d11
  float32x2_t *v166; // r0
  unsigned __int64 v167; // d1
  __int64 v168; // d16
  CEntity *PlayerEntity; // r0
  __int64 v170; // d16
  CEntity *v171; // r0
  float *v172; // r5
  uint8 *v174; // [sp+1Ch] [bp-94h]
  CVector *v175; // [sp+1Ch] [bp-94h]
  CVector v; // [sp+28h] [bp-88h] BYREF
  float pWaterZ; // [sp+38h] [bp-78h] BYREF
  bool v179; // [sp+3Eh] [bp-72h] BYREF
  bool pBool; // [sp+3Fh] [bp-71h] BYREF
  CVector v181; // [sp+40h] [bp-70h] BYREF
  CVector vecEnd; // [sp+50h] [bp-60h] BYREF

  v2 = 0;
  switch ( MovieCamMode )
  {
    case 0:
      v2 = 0;
      PlayerVehicle = FindPlayerVehicle(-1, 0);
      v4 = PlayerVehicle;
      if ( PlayerVehicle )
      {
        if ( PlayerVehicle->m_baseVehicleType == 5 && this->pTargetEntity->m_nModelIndex != 460 )
          return 0;
        v2 = 0;
        if ( PlayerVehicle->m_nModelIndex != 432 )
        {
          m_pMat = FindPlayerVehicle(-1, 0)->m_pMat;
          v.y = -2.3;
          v.x = -1.4;
          v.z = 0.3;
          Multiply3x3(&v181, m_pMat, &v);
          vecEnd = v181;
          v6 = FindPlayerVehicle(-1, 0);
          v7 = v6->m_pMat;
          p_tx = &v7->tx;
          if ( !v7 )
            p_tx = &v6->m_transform.m_translate.x;
          vecEnd.x = *p_tx + vecEnd.x;
          vecEnd.y = p_tx[1] + vecEnd.y;
          vecEnd.z = p_tx[2] + vecEnd.z;
          FindPlayerVehicle(-1, 0);
          v9 = v4->m_pMat;
          p_m_translate = (const CVector *)&v9->tx;
          if ( !v9 )
            p_m_translate = &v4->m_transform.m_translate;
          if ( CWorld::GetIsLineOfSightClear(p_m_translate, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
          {
            CCamera::TakeControl(this, v4, 14, 2, 2);
            return 1;
          }
        }
      }
      return v2;
    case 1:
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      *(_QWORD *)&v181.x = *(_QWORD *)&FindPlayerSpeed(-1)->x;
      v181.z = 0.0;
      CVector::Normalise(&v181);
      vecEnd.x = (float)(v181.y * 3.0) + (float)((float)(v181.x * 20.0) + vecEnd.x);
      vecEnd.y = (float)((float)(v181.y * 20.0) + vecEnd.y) - (float)(v181.x * 3.0);
      vecEnd.z = (float)((float)(v181.z * 20.0) + vecEnd.z) + 0.0;
      if ( FindPlayerVehicle(-1, 0)
        && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5
        && this->pTargetEntity->m_nModelIndex != 460 )
      {
        return 0;
      }
      GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(vecEnd.x, vecEnd.y, vecEnd.z + 5.0, &pBool, 0);
      if ( pBool
        || (GroundZFor3DCoord = CWorld::FindRoofZFor3DCoord(vecEnd.x, vecEnd.y, vecEnd.z + -5.0, &pBool), pBool) )
      {
        vecEnd.z = GroundZFor3DCoord + 1.5;
      }
      FindPlayerCoors(&v, -1);
      v2 = 0;
      if ( CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
      {
        FindPlayerCoors(&v, -1);
        v12 = v.x - vecEnd.x;
        v13 = v.y - vecEnd.y;
        v14 = sqrtf((float)((float)(v12 * v12) + (float)(v13 * v13)) + 0.0);
        if ( v14 <= 40.0 )
        {
          if ( v14 < 4.5 )
            return 0;
          goto LABEL_204;
        }
        PlayerSpeed = FindPlayerSpeed(-1);
        v2 = 0;
        if ( v14 >= 4.5
          && (float)((float)((float)(v12 * PlayerSpeed->x) + (float)(v13 * PlayerSpeed->y))
                   + (float)(PlayerSpeed->z * 0.0)) <= 0.0 )
        {
          goto LABEL_204;
        }
      }
      return v2;
    case 2:
      if ( FindPlayerVehicle(-1, 0)
        && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5
        && this->pTargetEntity->m_nModelIndex != 460 )
      {
        return 0;
      }
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      *(_QWORD *)&v181.x = *(_QWORD *)&FindPlayerSpeed(-1)->x;
      v181.z = 0.0;
      CVector::Normalise(&v181);
      v16 = (float)((float)((float)(v181.z * 16.0) + vecEnd.z) + 0.0) + 5.0;
      vecEnd.x = (float)(v181.y * 2.5) + (float)((float)(v181.x * 16.0) + vecEnd.x);
      vecEnd.y = (float)((float)(v181.y * 16.0) + vecEnd.y) - (float)(v181.x * 2.5);
      vecEnd.z = (float)((float)(v181.z * 16.0) + vecEnd.z) + 0.0;
      RoofZFor3DCoord = CWorld::FindGroundZFor3DCoord(vecEnd.x, vecEnd.y, v16, &pBool, 0);
      if ( pBool || (RoofZFor3DCoord = CWorld::FindRoofZFor3DCoord(vecEnd.x, vecEnd.y, vecEnd.z + -5.0, &pBool), pBool) )
        vecEnd.z = RoofZFor3DCoord + 0.5;
      FindPlayerCoors(&v, -1);
      v2 = 0;
      if ( !CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        return v2;
      FindPlayerCoors(&v, -1);
      v18 = v.x - vecEnd.x;
      v19 = v.y - vecEnd.y;
      v20 = sqrtf((float)((float)(v18 * v18) + (float)(v19 * v19)) + 0.0);
      if ( v20 <= 29.0 )
      {
        if ( v20 < 2.0 )
          return 0;
      }
      else
      {
        v21 = FindPlayerSpeed(-1);
        v2 = 0;
        if ( v20 < 2.0 || (float)((float)((float)(v18 * v21->x) + (float)(v19 * v21->y)) + (float)(v21->z * 0.0)) > 0.0 )
          return v2;
      }
      v168 = *(_QWORD *)&vecEnd.x;
      this->m_vecFixedModeSource.z = vecEnd.z;
      this->m_vecFixedModeUpOffSet.x = 0.0;
      this->m_vecFixedModeUpOffSet.y = 0.0;
      this->m_vecFixedModeUpOffSet.z = 0.0;
      this->m_bGarageFixedCamPositionSet = 0;
      *(_QWORD *)&this->m_vecFixedModeSource.x = v168;
      PlayerEntity = FindPlayerEntity(-1);
      CCamera::TakeControl(this, PlayerEntity, 15, 2, 2);
      RwCameraSetNearClipPlane(Scene.camera, 0.15);
      goto LABEL_205;
    case 3:
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      v2 = 0;
      *(_QWORD *)&v181.x = *(_QWORD *)&FindPlayerSpeed(-1)->x;
      v181.z = 0.0;
      CVector::Normalise(&v181);
      vecEnd.x = (float)(v181.y * 8.0) + (float)((float)(v181.x * 30.0) + vecEnd.x);
      vecEnd.y = (float)((float)(v181.y * 30.0) + vecEnd.y) - (float)(v181.x * 8.0);
      vecEnd.z = (float)((float)((float)(v181.z * 30.0) + vecEnd.z) + 0.0) + 16.0;
      FindPlayerCoors(&v, -1);
      if ( !CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        return v2;
      v22 = *(_QWORD *)&vecEnd.x;
      this->m_vecFixedModeSource.z = vecEnd.z;
      this->m_vecFixedModeUpOffSet.x = 0.0;
      this->m_vecFixedModeUpOffSet.y = 0.0;
      this->m_vecFixedModeUpOffSet.z = 0.0;
      this->m_bGarageFixedCamPositionSet = 0;
      *(_QWORD *)&this->m_vecFixedModeSource.x = v22;
      v23 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v23, 15, 2, 2);
      v24 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
      if ( CWaterLevel::GetWaterLevel(v24[185], v24[186], v24[187], &v.x, 1, 0) && v.x >= v24[187] )
        return 0;
      RwCameraSetNearClipPlane(Scene.camera, 0.15);
      return 1;
    case 5:
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      *(_QWORD *)&v181.x = *(_QWORD *)&FindPlayerSpeed(-1)->x;
      v181.z = 0.0;
      CVector::Normalise(&v181);
      v25 = (float)((float)((float)(v181.z * 30.0) + vecEnd.z) + 0.0) + 5.0;
      vecEnd.x = (float)((float)(v181.x * 30.0) + vecEnd.x) - (float)(v181.y * 6.0);
      vecEnd.y = (float)(v181.x * 6.0) + (float)((float)(v181.y * 30.0) + vecEnd.y);
      vecEnd.z = (float)((float)(v181.z * 30.0) + vecEnd.z) + 0.0;
      v26 = CWorld::FindGroundZFor3DCoord(vecEnd.x, vecEnd.y, v25, &pBool, 0);
      if ( pBool || (v26 = CWorld::FindRoofZFor3DCoord(vecEnd.x, vecEnd.y, vecEnd.z + -5.0, &pBool), pBool) )
        vecEnd.z = v26 + 3.5;
      FindPlayerCoors(&v, -1);
      v2 = 0;
      if ( !CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        return v2;
      v27 = *(_QWORD *)&vecEnd.x;
      this->m_vecFixedModeSource.z = vecEnd.z;
      this->m_vecFixedModeUpOffSet.x = 0.0;
      this->m_vecFixedModeUpOffSet.y = 0.0;
      this->m_vecFixedModeUpOffSet.z = 0.0;
      this->m_bGarageFixedCamPositionSet = 0;
      *(_QWORD *)&this->m_vecFixedModeSource.x = v27;
      v28 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v28, 15, 2, 2);
      v29 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
      if ( !CWaterLevel::GetWaterLevel(v29[185], v29[186], v29[187], &v.x, 1, 0) )
        return 1;
      v30 = v29 + 187;
      goto LABEL_207;
    case 6:
      v31 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v31, 16, 2, 2);
      return 1;
    case 7:
      v2 = 0;
      if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel < WANTED_LEVEL1 || !FindPlayerVehicle(-1, 0) )
        return v2;
      if ( FindPlayerVehicle(-1, 0)
        && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5
        && this->pTargetEntity->m_nModelIndex != 460 )
      {
        return 0;
      }
      v32 = CPools::ms_pVehiclePool;
      m_nSize = CPools::ms_pVehiclePool->m_nSize;
      if ( !m_nSize )
        return 0;
      v34 = m_nSize - 1;
      for ( i = 2604 * m_nSize; ; i -= 2604 )
      {
        if ( (v32->m_aFlags[v34] & 0x80u) == 0 )
        {
          m_aStorage = v32->m_aStorage;
          v37 = v32->m_aStorage[i / 0xA2Cu];
          v38 = (CEntity *)(v37 - 2604);
          if ( v37 != (uint8 *)&elf_hash_bucket[588] && !*(_DWORD *)&(*m_aStorage)[i - 1164] )
          {
            v39 = FindPlayerVehicle(-1, 0);
            v40 = v38 == v39;
            LOWORD(v41) = -2600;
            if ( v38 != v39 )
              v40 = *(v37 - 1536) << 31 == 0;
            HIWORD(v41) = -1;
            if ( !v40 )
            {
              v42 = &(*m_aStorage)[v41];
              v43 = (int)&(*m_aStorage)[v41 + i];
              if ( (*(_BYTE *)(v43 + 54) & 0xF8) == 24 )
              {
                v174 = v42 + 16;
                v44 = (float *)&(*m_aStorage)[v41 + i];
                v45 = *(_DWORD *)&v42[i + 16];
                if ( v45 )
                  v44 = (float *)(v45 + 48);
                v46 = *v44;
                FindPlayerCoors(&vecEnd, -1);
                v47 = v43;
                x = vecEnd.x;
                v49 = *(_DWORD *)&v174[i];
                if ( v49 )
                  v47 = v49 + 48;
                v50 = *(float *)(v47 + 4);
                FindPlayerCoors(&vecEnd, -1);
                y = vecEnd.y;
                FindPlayerCoors(&vecEnd, -1);
                v52 = *(_DWORD *)&v174[i];
                if ( v52 )
                  v43 = v52 + 48;
                v53.n64_u64[0] = vsub_f32(*(float32x2_t *)&vecEnd.y, *(float32x2_t *)(v43 + 4)).n64_u64[0];
                v54 = vmul_f32(v53, v53).n64_u64[0];
                if ( sqrtf(
                       (float)((float)((float)(vecEnd.x - *(float *)v43) * (float)(vecEnd.x - *(float *)v43))
                             + *(float *)&v54)
                     + *((float *)&v54 + 1)) < 30.0 )
                {
                  v55 = v46 - x;
                  xy = FindPlayerVehicle(-1, 0)->m_pMat->xy;
                  if ( (float)((float)(v55 * xy) + (float)((float)(v50 - y) * FindPlayerVehicle(-1, 0)->m_pMat->yy)) < 0.0 )
                  {
                    v57 = *(float *)(*(_DWORD *)&v174[i] + 16);
                    v58 = FindPlayerVehicle(-1, 0);
                    v59 = *(float *)(*(_DWORD *)&v174[i] + 20);
                    v60 = v58->m_pMat->xy;
                    if ( (float)((float)(v57 * v60) + (float)(v59 * FindPlayerVehicle(-1, 0)->m_pMat->yy)) > 0.8 )
                    {
                      CCamera::TakeControl(this, v38, 18, 2, 2);
                      v61 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
                      if ( !CWaterLevel::GetWaterLevel(v61[185], v61[186], v61[187], &vecEnd.x, 1, 0)
                        || vecEnd.x < v61[187] )
                      {
                        break;
                      }
                    }
                  }
                }
              }
            }
          }
        }
        --v34;
        v2 = 0;
        if ( v34 == -1 )
          return v2;
      }
      return 1;
    case 8:
      v2 = 0;
      if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel < WANTED_LEVEL1 || !FindPlayerVehicle(-1, 0) )
        return v2;
      v62 = CPools::ms_pVehiclePool;
      v63 = CPools::ms_pVehiclePool->m_nSize;
      if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
      {
        v2 = 0;
        if ( this->pTargetEntity->m_nModelIndex != 460 || !v63 )
          return v2;
      }
      else if ( !v63 )
      {
        return 0;
      }
      v119 = 2604 * v63;
      v120 = v63 - 1;
      while ( 2 )
      {
        if ( (v62->m_aFlags[v120] & 0x80u) != 0 )
          goto LABEL_174;
        v121 = v62->m_aStorage;
        v122 = v62->m_aStorage[v119 / 0xA2Cu];
        v123 = (CEntity *)(v122 - 2604);
        if ( v122 == (uint8 *)&elf_hash_bucket[588] || *(_DWORD *)&(*v121)[v119 - 1164] )
          goto LABEL_174;
        v124 = FindPlayerVehicle(-1, 0);
        v125 = v123 == v124;
        LOWORD(v126) = -2600;
        if ( v123 != v124 )
          v125 = *(v122 - 1536) << 31 == 0;
        HIWORD(v126) = -1;
        if ( v125 )
          goto LABEL_174;
        v127 = (int)&(*v121)[v126 + 16];
        v128 = (int)&(*v121)[v126 + v119];
        v129 = *(_DWORD *)(v127 + v119);
        v130 = (float *)v128;
        if ( v129 )
          v130 = (float *)(v129 + 48);
        v131 = *v130;
        FindPlayerCoors(&vecEnd, -1);
        v132 = *(_DWORD *)(v127 + v119);
        v133 = v128;
        v134 = vecEnd.x;
        if ( v132 )
          v133 = v132 + 48;
        v135 = *(float *)(v133 + 4);
        FindPlayerCoors(&vecEnd, -1);
        v136 = vecEnd.y;
        FindPlayerCoors(&vecEnd, -1);
        v137 = *(_DWORD *)(v127 + v119);
        v175 = (CVector *)v128;
        if ( v137 )
          v128 = v137 + 48;
        v138.n64_u64[0] = vsub_f32(*(float32x2_t *)&vecEnd.y, *(float32x2_t *)(v128 + 4)).n64_u64[0];
        v139 = vmul_f32(v138, v138).n64_u64[0];
        if ( sqrtf(
               (float)((float)((float)(vecEnd.x - *(float *)v128) * (float)(vecEnd.x - *(float *)v128)) + *(float *)&v139)
             + *((float *)&v139 + 1)) >= 30.0 )
          goto LABEL_174;
        v140 = v131 - v134;
        v141 = FindPlayerVehicle(-1, 0)->m_pMat->xy;
        if ( (float)((float)(v140 * v141) + (float)((float)(v135 - v136) * FindPlayerVehicle(-1, 0)->m_pMat->yy)) >= 0.0 )
          goto LABEL_174;
        v142 = *(float *)(*(_DWORD *)(v127 + v119) + 16);
        v143 = FindPlayerVehicle(-1, 0);
        v144 = *(float *)(*(_DWORD *)(v127 + v119) + 20);
        v145 = v143->m_pMat->xy;
        if ( (float)((float)(v142 * v145) + (float)(v144 * FindPlayerVehicle(-1, 0)->m_pMat->yy)) <= 0.8 )
          goto LABEL_174;
        v146 = *(const CMatrix **)(v127 + v119);
        v.y = -2.3;
        v.x = -1.4;
        v.z = 0.3;
        Multiply3x3(&v181, v146, &v);
        vecEnd = v181;
        v147 = v175;
        v148 = *(_DWORD *)(v127 + v119);
        p_x = &v175->x;
        if ( v148 )
          p_x = (float *)(v148 + 48);
        vecEnd.x = *p_x + v181.x;
        vecEnd.y = p_x[1] + v181.y;
        vecEnd.z = p_x[2] + v181.z;
        v150 = *(const CVector **)(v127 + v119);
        v2 = 0;
        if ( v150 )
          v147 = v150 + 4;
        if ( CWorld::GetIsLineOfSightClear(v147, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        {
          CCamera::TakeControl(this, v123, 14, 2, 2);
          v151 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
          if ( !CWaterLevel::GetWaterLevel(v151[185], v151[186], v151[187], &v181.x, 1, 0) || v181.x < v151[187] )
            return 1;
LABEL_174:
          --v120;
          v119 -= 2604;
          v2 = 0;
          if ( v120 == -1 )
            return v2;
          continue;
        }
        return v2;
      }
    case 15:
      v2 = 0;
      if ( !FindPlayerVehicle(-1, 0) )
        return v2;
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      *(_QWORD *)&v181.x = *(_QWORD *)&FindPlayerSpeed(-1)->x;
      v181.z = 0.0;
      CVector::Normalise(&v181);
      vecEnd.x = (float)(v181.x * 34.0) + vecEnd.x;
      vecEnd.y = (float)(v181.y * 34.0) + vecEnd.y;
      vecEnd.z = (float)(v181.z * 34.0) + vecEnd.z;
      FindPlayerCoors(&v, -1);
      vecEnd.z = v.z + 0.5;
      if ( FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
        vecEnd.z = vecEnd.z + 1.0;
      FindPlayerCoors(&v, -1);
      v2 = 0;
      if ( !CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        return v2;
      FindPlayerCoors(&v, -1);
      v64.n64_u64[0] = *(unsigned __int64 *)&vecEnd.y;
      v65.n64_u64[0] = *(unsigned __int64 *)&v.y;
      v66 = vecEnd.x;
      v67 = v.x;
      FindPlayerCoors(&v, -1);
      v68.n64_u64[0] = vsub_f32(v65, v64).n64_u64[0];
      v69 = vmul_f32(v68, v68).n64_u64[0];
      v70 = sqrtf((float)((float)((float)(v67 - v66) * (float)(v67 - v66)) + *(float *)&v69) + *((float *)&v69 + 1));
      if ( v70 <= 44.0 )
      {
        if ( v70 < 3.0 )
          return 0;
        goto LABEL_204;
      }
      v71.n64_u64[0] = *(unsigned __int64 *)&vecEnd.x;
      v72.n64_u64[0] = *(unsigned __int64 *)&v.x;
      v73 = (float32x2_t *)FindPlayerSpeed(-1);
      v2 = 0;
      if ( v70 >= 3.0 )
      {
        v74 = vmul_f32(vsub_f32(v72, v71), (float32x2_t)v73->n64_u64[0]).n64_u64[0];
        if ( (float)((float)(*(float *)&v74 + *((float *)&v74 + 1)) + (float)(v73[1].n64_f32[0] * 0.0)) <= 0.0 )
          goto LABEL_204;
      }
      return v2;
    case 16:
      v2 = 0;
      if ( FindPlayerVehicle(-1, 0) )
      {
        FindPlayerCoors(&v181, -1);
        vecEnd = v181;
        *(_QWORD *)&v181.x = *(_QWORD *)&FindPlayerSpeed(-1)->x;
        v181.z = 0.0;
        CVector::Normalise(&v181);
        v75 = CGeneral::GetATanOfXY(v181.x, v181.y) + 1.0472;
        v76 = cosf(v75);
        v77 = *(_QWORD *)&v181.x;
        z = v181.z;
        v79 = sinf(v75);
        v181.x = v76 + *(float *)&v77;
        v181.y = v79 + *((float *)&v77 + 1);
        v181.z = z + 0.0;
        CVector::Normalise(&v181);
        vecEnd.x = (float)(v181.x * 30.0) + vecEnd.x;
        vecEnd.y = (float)(v181.y * 30.0) + vecEnd.y;
        vecEnd.z = (float)(v181.z * 30.0) + vecEnd.z;
        FindPlayerCoors(&v, -1);
        pBool = 0;
        vecEnd.z = v.z + -5.5;
        v80 = CWorld::FindRoofZFor3DCoord(vecEnd.x, vecEnd.y, v.z + -5.5, &pBool);
        pWaterZ = v80;
        if ( pBool )
        {
          vecEnd.z = v80 + 0.5;
        }
        else if ( CWaterLevel::GetWaterLevelNoWaves(vecEnd.x, vecEnd.y, vecEnd.z, &pWaterZ, 0, 0) )
        {
          v152 = fHeliMinHeightAboveWater;
          if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
            v152 = fSeaplaneMinHeightAboveWater;
          if ( vecEnd.z < (float)(v152 + pWaterZ) )
            vecEnd.z = v152 + pWaterZ;
        }
        FindPlayerCoors(&v, -1);
        v2 = 0;
        if ( CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        {
          FindPlayerCoors(&v, -1);
          v2 = 0;
          v153.n64_u64[0] = vsub_f32(*(float32x2_t *)&v.y, *(float32x2_t *)&vecEnd.y).n64_u64[0];
          v154 = vmul_f32(v153, v153).n64_u64[0];
          v155 = sqrtf(
                   (float)((float)((float)(v.x - vecEnd.x) * (float)(v.x - vecEnd.x)) + *(float *)&v154)
                 + *((float *)&v154 + 1));
          if ( v155 <= 50.0 && v155 >= 3.0 )
            goto LABEL_204;
        }
      }
      return v2;
    case 17:
      v2 = 0;
      if ( !FindPlayerVehicle(-1, 0) )
        return v2;
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      *(_QWORD *)&v181.x = *(_QWORD *)&FindPlayerSpeed(-1)->x;
      v181.z = 0.0;
      CVector::Normalise(&v181);
      v81 = CGeneral::GetATanOfXY(v181.x, v181.y) + 3.3161;
      v82 = cosf(v81);
      v83 = *(_QWORD *)&v181.x;
      v84 = v181.z;
      v85 = sinf(v81);
      v181.x = v82 + *(float *)&v83;
      v181.y = v85 + *((float *)&v83 + 1);
      v181.z = v84 + 0.0;
      CVector::Normalise(&v181);
      vecEnd.x = (float)(v181.x * 25.0) + vecEnd.x;
      vecEnd.y = (float)(v181.y * 25.0) + vecEnd.y;
      vecEnd.z = (float)(v181.z * 25.0) + vecEnd.z;
      FindPlayerCoors(&v, -1);
      pBool = 0;
      vecEnd.z = v.z + -1.0;
      v86 = CWorld::FindRoofZFor3DCoord(vecEnd.x, vecEnd.y, v.z + -1.0, &pBool);
      pWaterZ = v86;
      if ( pBool )
      {
        vecEnd.z = v86 + 0.5;
      }
      else if ( CWaterLevel::GetWaterLevelNoWaves(vecEnd.x, vecEnd.y, vecEnd.z, &pWaterZ, 0, 0) )
      {
        v156 = fHeliMinHeightAboveWater;
        if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
          v156 = fSeaplaneMinHeightAboveWater;
        if ( vecEnd.z < (float)(v156 + pWaterZ) )
          vecEnd.z = v156 + pWaterZ;
      }
      FindPlayerCoors(&v, -1);
      v2 = 0;
      if ( !CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        return v2;
      FindPlayerCoors(&v, -1);
      v157.n64_u64[0] = *(unsigned __int64 *)&vecEnd.y;
      v158.n64_u64[0] = *(unsigned __int64 *)&v.y;
      v159 = vecEnd.x;
      v160 = v.x;
      FindPlayerCoors(&v, -1);
      v161.n64_u64[0] = vsub_f32(v158, v157).n64_u64[0];
      v162 = vmul_f32(v161, v161).n64_u64[0];
      v163 = sqrtf((float)((float)((float)(v160 - v159) * (float)(v160 - v159)) + *(float *)&v162) + *((float *)&v162 + 1));
      if ( v163 <= 50.0 )
      {
        if ( v163 < 2.0 )
          return 0;
        goto LABEL_204;
      }
      v164.n64_u64[0] = *(unsigned __int64 *)&vecEnd.x;
      v165.n64_u64[0] = *(unsigned __int64 *)&v.x;
      v166 = (float32x2_t *)FindPlayerSpeed(-1);
      v2 = 0;
      if ( v163 >= 2.0 )
      {
        v167 = vmul_f32(vsub_f32(v165, v164), (float32x2_t)v166->n64_u64[0]).n64_u64[0];
        if ( (float)((float)(*(float *)&v167 + *((float *)&v167 + 1)) + (float)(v166[1].n64_f32[0] * 0.0)) <= 0.0 )
        {
LABEL_204:
          v170 = *(_QWORD *)&vecEnd.x;
          this->m_vecFixedModeSource.z = vecEnd.z;
          this->m_vecFixedModeUpOffSet.x = 0.0;
          this->m_vecFixedModeUpOffSet.y = 0.0;
          this->m_vecFixedModeUpOffSet.z = 0.0;
          this->m_bGarageFixedCamPositionSet = 0;
          *(_QWORD *)&this->m_vecFixedModeSource.x = v170;
          v171 = FindPlayerEntity(-1);
          CCamera::TakeControl(this, v171, 15, 2, 2);
LABEL_205:
          v172 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
          if ( !CWaterLevel::GetWaterLevel(v172[185], v172[186], v172[187], &v.x, 1, 0) )
            return 1;
          v30 = v172 + 187;
LABEL_207:
          v97 = v.x;
          return v97 < *v30;
        }
      }
      return v2;
    case 18:
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      if ( FindPlayerVehicle(-1, 0) )
      {
        v87 = -23.0;
        if ( FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
          v87 = 23.0;
      }
      else
      {
        v87 = -23.0;
      }
      vecEnd.z = v87 + vecEnd.z;
      v99 = FindPlayerSpeed(-1);
      v100 = v99->z;
      *(_QWORD *)&v181.x = *(_QWORD *)&v99->x;
      v181.z = v100;
      v101 = CGeneral::GetATanOfXY(v181.x, v181.y) + 2.5307;
      v102 = cosf(v101);
      v103 = *(_QWORD *)&v181.x;
      v104 = sinf(v101);
      v181.x = v102 + *(float *)&v103;
      v181.z = 0.0;
      v181.y = v104 + *((float *)&v103 + 1);
      CVector::Normalise(&v181);
      v179 = 0;
      vecEnd.x = (float)(v181.x * 15.0) + vecEnd.x;
      vecEnd.y = (float)(v181.y * 15.0) + vecEnd.y;
      vecEnd.z = (float)(v181.z * 15.0) + vecEnd.z;
      pWaterZ = CWorld::FindGroundZFor3DCoord(vecEnd.x, vecEnd.y, vecEnd.z, &v179, 0);
      if ( pWaterZ == 1.0 )
      {
        if ( vecEnd.z < 1.0 )
          vecEnd.z = 1.5;
      }
      else if ( CWaterLevel::GetWaterLevelNoWaves(vecEnd.x, vecEnd.y, vecEnd.z, &pWaterZ, 0, 0) )
      {
        v111 = fHeliMinHeightAboveWater;
        if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
          v111 = fSeaplaneMinHeightAboveWater;
        if ( vecEnd.z < (float)(v111 + pWaterZ) )
          vecEnd.z = v111 + pWaterZ;
      }
      FindPlayerCoors(&v, -1);
      v2 = 0;
      if ( CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
      {
        FindPlayerCoors(&v, -1);
        v2 = 0;
        v112.n64_u64[0] = vsub_f32(*(float32x2_t *)&v.y, *(float32x2_t *)&vecEnd.y).n64_u64[0];
        v113 = vmul_f32(v112, v112).n64_u64[0];
        v114 = sqrtf(
                 (float)((float)((float)(v.x - vecEnd.x) * (float)(v.x - vecEnd.x)) + *(float *)&v113)
               + *((float *)&v113 + 1));
        if ( v114 <= 57.0 && v114 >= 1.0 )
          goto LABEL_204;
      }
      return v2;
    case 19:
      FindPlayerCoors(&v181, -1);
      vecEnd = v181;
      if ( FindPlayerVehicle(-1, 0) )
      {
        v88 = -1.0;
        if ( FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
          v88 = 4.0;
      }
      else
      {
        v88 = -1.0;
      }
      vecEnd.z = v88 + vecEnd.z;
      v105 = FindPlayerSpeed(-1);
      v106 = v105->z;
      *(_QWORD *)&v181.x = *(_QWORD *)&v105->x;
      v181.z = v106;
      v107 = CGeneral::GetATanOfXY(v181.x, v181.y) + 0.48869;
      v108 = cosf(v107);
      v109 = *(_QWORD *)&v181.x;
      v110 = sinf(v107);
      v181.x = v108 + *(float *)&v109;
      v181.z = 0.0;
      v181.y = v110 + *((float *)&v109 + 1);
      CVector::Normalise(&v181);
      v179 = 0;
      vecEnd.x = (float)(v181.x * 12.5) + vecEnd.x;
      vecEnd.y = (float)(v181.y * 12.5) + vecEnd.y;
      vecEnd.z = (float)(v181.z * 12.5) + vecEnd.z;
      pWaterZ = CWorld::FindGroundZFor3DCoord(vecEnd.x, vecEnd.y, vecEnd.z, &v179, 0);
      if ( pWaterZ == 1.0 )
      {
        if ( vecEnd.z < 1.0 )
          vecEnd.z = 1.5;
      }
      else if ( CWaterLevel::GetWaterLevelNoWaves(vecEnd.x, vecEnd.y, vecEnd.z, &pWaterZ, 0, 0) )
      {
        v115 = fHeliMinHeightAboveWater;
        if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5 )
          v115 = fSeaplaneMinHeightAboveWater;
        if ( vecEnd.z < (float)(v115 + pWaterZ) )
          vecEnd.z = v115 + pWaterZ;
      }
      FindPlayerCoors(&v, -1);
      v2 = 0;
      if ( CWorld::GetIsLineOfSightClear(&v, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
      {
        FindPlayerCoors(&v, -1);
        v2 = 0;
        v116.n64_u64[0] = vsub_f32(*(float32x2_t *)&v.y, *(float32x2_t *)&vecEnd.y).n64_u64[0];
        v117 = vmul_f32(v116, v116).n64_u64[0];
        v118 = sqrtf(
                 (float)((float)((float)(v.x - vecEnd.x) * (float)(v.x - vecEnd.x)) + *(float *)&v117)
               + *((float *)&v117 + 1));
        if ( v118 <= 36.0 && v118 >= 2.0 )
          goto LABEL_204;
      }
      return v2;
    case 20:
      v2 = 0;
      if ( !CCam::Process_DW_HeliChaseCam(&this->Cams[this->ActiveCam], 0) )
        return v2;
      v89 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v89, 56, 2, 2);
      goto LABEL_116;
    case 21:
      v2 = 0;
      if ( !CCam::Process_DW_CamManCam(&this->Cams[this->ActiveCam], 0) )
        return v2;
      v90 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v90, 57, 2, 2);
      goto LABEL_116;
    case 22:
      v2 = 0;
      if ( !CCam::Process_DW_BirdyCam(&this->Cams[this->ActiveCam], 0) )
        return v2;
      v91 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v91, 58, 2, 2);
      goto LABEL_116;
    case 23:
      v2 = 0;
      if ( !CCam::Process_DW_PlaneSpotterCam(&this->Cams[this->ActiveCam], 0) )
        return v2;
      v92 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v92, 59, 2, 2);
      goto LABEL_116;
    case 24:
    case 25:
      v2 = 0;
      TheCamera.m_bUseNearClipScript = 0;
      return v2;
    case 26:
      v2 = 0;
      if ( !CCam::Process_DW_PlaneCam1(&this->Cams[this->ActiveCam], 0) )
        return v2;
      v93 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v93, 62, 2, 2);
      goto LABEL_116;
    case 27:
      v2 = 0;
      if ( !CCam::Process_DW_PlaneCam2(&this->Cams[this->ActiveCam], 0) )
        return v2;
      v94 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v94, 63, 2, 2);
      goto LABEL_116;
    case 28:
      v2 = 0;
      if ( !CCam::Process_DW_PlaneCam3(&this->Cams[this->ActiveCam], 0) )
        return v2;
      v95 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v95, 64, 2, 2);
LABEL_116:
      v96 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
      if ( !CWaterLevel::GetWaterLevel(v96[185], v96[186], v96[187], &vecEnd.x, 1, 0) )
        return 1;
      v30 = v96 + 187;
      v97 = vecEnd.x;
      return v97 < *v30;
    case 29:
      v98 = FindPlayerEntity(-1);
      CCamera::TakeControl(this, v98, 18, 2, 2);
      return 1;
    default:
      return v2;
  }
}
// 2E: using guessed type __int16 word_2E;
// 54: using guessed type int dword_54;
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003E1348) --------------------------------------------------------
int CameraObscuredByWaterLevel()
{
  int v0; // r4
  float *v1; // r5
  float pWaterZ[3]; // [sp+Ch] [bp-Ch] BYREF

  v0 = 0;
  v1 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
  if ( CWaterLevel::GetWaterLevel(v1[185], v1[186], v1[187], pWaterZ, 1, 0) == 1 && pWaterZ[0] >= v1[187] )
    return 1;
  return v0;
}
// 3E1348: using guessed type float pWaterZ[3];

//----- (003E139E) --------------------------------------------------------
void __fastcall CCamera::RenderMotionBlur(CCamera *this)
{
  int m_BlurType; // r12

  m_BlurType = this->m_BlurType;
  if ( m_BlurType )
    CMBlur::MotionBlurRender(
      this->m_pRwCamera,
      this->m_BlurRed,
      this->m_BlurGreen,
      this->m_BlurBlue,
      this->m_motionBlur,
      m_BlurType,
      this->m_imotionBlurAddAlpha);
}

//----- (003E13CE) --------------------------------------------------------
void __fastcall CCamera::SetCamCutSceneOffSet(CCamera *this, const CVector *CamCutSceneOffset)
{
  __int64 v2; // d16

  v2 = *(_QWORD *)&CamCutSceneOffset->x;
  this->m_vecCutSceneOffset.z = CamCutSceneOffset->z;
  *(_QWORD *)&this->m_vecCutSceneOffset.x = v2;
}

//----- (003E13E2) --------------------------------------------------------
void __fastcall CCamera::SetCameraDirectlyInFrontForFollowPed_CamOnAString(CCamera *this)
{
  CPlayerPed *PlayerPed; // r0

  this->m_bCamDirectlyInFront = 1;
  PlayerPed = FindPlayerPed(-1);
  if ( PlayerPed )
    this->m_PedOrientForBehindOrInFront = CGeneral::GetATanOfXY(PlayerPed->m_pMat->xy, PlayerPed->m_pMat->yy);
}

//----- (003E140C) --------------------------------------------------------
void __fastcall CCamera::SetCameraDirectlyBehindForFollowPed_ForAPed_CamOnAString(CCamera *this, CPed *pPed)
{
  int ActiveCam; // r1
  char *v5; // r2
  CEntity *v6; // r0
  CEntity **p_CamTargetEntity; // r1

  if ( pPed )
  {
    this->m_bLookingAtPlayer = 0;
    this->m_bCamDirectlyBehind = 1;
    ActiveCam = TheCamera.ActiveCam;
    TheCamera.pTargetEntity = pPed;
    v5 = (char *)&TheCamera + 528 * TheCamera.ActiveCam;
    v6 = (CEntity *)*((_DWORD *)v5 + 217);
    if ( v6 )
    {
      CEntity::CleanUpOldReference(v6, (CEntity **)v5 + 217);
      ActiveCam = TheCamera.ActiveCam;
    }
    p_CamTargetEntity = &TheCamera.Cams[ActiveCam].CamTargetEntity;
    *p_CamTargetEntity = pPed;
    CEntity::RegisterReference(pPed, p_CamTargetEntity);
    this->m_PedOrientForBehindOrInFront = CGeneral::GetATanOfXY(pPed->m_pMat->xy, pPed->m_pMat->yy);
  }
}

//----- (003E148C) --------------------------------------------------------
void __fastcall CCamera::SetCameraDirectlyInFrontForFollowPed_ForAPed_CamOnAString(CCamera *this, CPed *pPed)
{
  int ActiveCam; // r1
  char *v5; // r2
  CEntity *v6; // r0
  CEntity **p_CamTargetEntity; // r1

  if ( pPed )
  {
    this->m_bLookingAtPlayer = 0;
    ActiveCam = TheCamera.ActiveCam;
    TheCamera.pTargetEntity = pPed;
    v5 = (char *)&TheCamera + 528 * TheCamera.ActiveCam;
    v6 = (CEntity *)*((_DWORD *)v5 + 217);
    if ( v6 )
    {
      CEntity::CleanUpOldReference(v6, (CEntity **)v5 + 217);
      ActiveCam = TheCamera.ActiveCam;
    }
    p_CamTargetEntity = &TheCamera.Cams[ActiveCam].CamTargetEntity;
    *p_CamTargetEntity = pPed;
    CEntity::RegisterReference(pPed, p_CamTargetEntity);
    this->m_bCamDirectlyInFront = 1;
    this->m_PedOrientForBehindOrInFront = CGeneral::GetATanOfXY(pPed->m_pMat->xy, pPed->m_pMat->yy);
  }
}

//----- (003E150C) --------------------------------------------------------
void __fastcall CCamera::SetFadeColour(CCamera *this, UInt8 RedFade, UInt8 GreenFade, UInt8 BlueFade)
{
  this->m_FadeTargetIsSplashScreen = (GreenFade ^ 2 | RedFade ^ 2 | BlueFade ^ 2) == 0;
  CDraw::FadeGreen = GreenFade;
  CDraw::FadeRed = RedFade;
  CDraw::FadeBlue = BlueFade;
}

//----- (003E1568) --------------------------------------------------------
void __fastcall CCamera::SetNewPlayerWeaponMode(CCamera *this, Int16 Mode, Int16 MinZoom, Int16 MaxZoom)
{
  this->PlayerWeaponMode.MaxZoom = MaxZoom;
  this->PlayerWeaponMode.Mode = Mode;
  this->PlayerWeaponMode.MinZoom = MinZoom;
  this->PlayerWeaponMode.Duration = 0.0;
}

//----- (003E157C) --------------------------------------------------------
bool __fastcall CCamera::IsTargetingActive(CCamera *this, CPlayerPed *pPlayerPed)
{
  bool result; // r0
  int v3; // r1

  if ( pPlayerPed && ((*((_BYTE *)pPlayerPed->m_pPlayerData + 52) & 8) != 0 || pPlayerPed->m_pEntLockOnTarget) )
    return 1;
  v3 = (unsigned __int16)this->PlayerWeaponMode.Mode - 7;
  result = 1;
  switch ( v3 )
  {
    case 0:
    case 1:
    case 27:
    case 38:
    case 39:
    case 44:
    case 58:
      return result;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (003E15E8) --------------------------------------------------------
void __fastcall CCamera::SetParametersForScriptInterpolation(
        CCamera *this,
        float PercentageInterToStopMoving,
        float PercentageInterToCatchUp,
        UInt32 TimeForInterPolation)
{
  this->m_fScriptTimeForInterPolation = TimeForInterPolation;
  this->m_bScriptParametersSetForInterPol = 1;
  this->m_fScriptPercentageInterToCatchUp = PercentageInterToCatchUp / 100.0;
  this->m_fScriptPercentageInterToStopMoving = PercentageInterToStopMoving / 100.0;
}

//----- (003E161C) --------------------------------------------------------
void __fastcall CCamera::SetRwCamera(CCamera *this, RwCamera_0 *pRwCamera)
{
  this->m_pRwCamera = pRwCamera;
  CMatrix::Attach(&this->m_viewMatrix, &pRwCamera->viewMatrix, 0);
  sub_19A608(this->m_pRwCamera);
}

//----- (003E163E) --------------------------------------------------------
void __fastcall CCamera::SetWideScreenOn(CCamera *this)
{
  *(_WORD *)&this->m_bWantsToSwitchWidescreenOff = 256;
}

//----- (003E1648) --------------------------------------------------------
void __fastcall CCamera::SetZoomValueFollowPedScript(CCamera *this, Int16 ZoomVal)
{
  if ( (unsigned __int16)ZoomVal <= 2u )
    LODWORD(this->m_fPedZoomValueScript) = dword_616830[ZoomVal];
  this->m_bUseScriptZoomValuePed = 1;
}
// 616830: using guessed type _DWORD dword_616830[4];

//----- (003E1668) --------------------------------------------------------
void __fastcall CCamera::SetZoomValueCamStringScript(CCamera *this, Int16 ZoomVal)
{
  int v3; // r5
  CEntity *CamTargetEntity; // r0
  unsigned __int32 v5; // r0
  int v6; // r0

  v3 = ZoomVal;
  CamTargetEntity = this->Cams[0].CamTargetEntity;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) == 2 )
  {
    v5 = CVehicle::GetVehicleAppearance((const CVehicle *)CamTargetEntity) - 1;
    if ( v5 > 4 )
      v6 = 0;
    else
      v6 = dword_616840[v5];
    if ( (unsigned __int16)v3 <= 2u )
      this->m_fCarZoomValueScript = (*off_6679B0[v3])[v6];
    this->m_bUseScriptZoomValueCar = 1;
  }
  else
  {
    if ( (unsigned __int16)ZoomVal <= 2u )
      LODWORD(this->m_fPedZoomValueScript) = dword_616830[ZoomVal];
    this->m_bUseScriptZoomValuePed = 1;
  }
}
// 616830: using guessed type _DWORD dword_616830[4];
// 616840: using guessed type _DWORD dword_616840[5];
// 6679B0: using guessed type float (*off_6679B0[3])[5];

//----- (003E16DC) --------------------------------------------------------
void __fastcall CCamera::StartCooperativeCamMode(CCamera *this)
{
  this->m_bCooperativeCamMode = 1;
  CGameLogic::n2PlayerPedInFocus = 2;
}

//----- (003E16F4) --------------------------------------------------------
void __fastcall CCamera::StopCooperativeCamMode(CCamera *this)
{
  this->m_bCooperativeCamMode = 0;
  CGameLogic::n2PlayerPedInFocus = 2;
}

//----- (003E170C) --------------------------------------------------------
void __fastcall CCamera::AllowShootingWith2PlayersInCar(CCamera *this, bool bArg)
{
  this->m_bAllowShootingWith2PlayersInCar = bArg;
}

//----- (003E1714) --------------------------------------------------------
void __fastcall CCamera::TakeControl(
        CCamera *this,
        CEntity *NewTarget,
        int CamMode,
        Int16 CamSwitchStyle,
        int WhoIsTakingControl)
{
  CEntity *PlayerVehicle; // r5
  bool v8; // zf
  Int16 v9; // r9
  int v10; // r0
  CEntity *pTargetEntity; // r0

  PlayerVehicle = NewTarget;
  v8 = WhoIsTakingControl == 2;
  v9 = CamMode;
  if ( WhoIsTakingControl == 2 )
    v8 = this->WhoIsInControlOfTheCamera == 1;
  if ( !v8 || this->m_bForceCinemaCam )
  {
    this->WhoIsInControlOfTheCamera = WhoIsTakingControl;
    if ( NewTarget )
    {
      if ( !CamMode )
      {
        v10 = *(_BYTE *)&this->pTargetEntity->m_info & 7;
        if ( v10 == 3 )
        {
          v9 = 4;
        }
        else
        {
          v9 = 0;
          if ( v10 == 2 )
            v9 = 18;
        }
      }
    }
    else if ( FindPlayerVehicle(-1, 0) )
    {
      PlayerVehicle = FindPlayerVehicle(-1, 0);
    }
    else
    {
      PlayerVehicle = CWorld::Players[CWorld::PlayerInFocus].pPed;
    }
    this->m_bLookingAtVector = 0;
    pTargetEntity = this->pTargetEntity;
    if ( pTargetEntity )
      CEntity::CleanUpOldReference(pTargetEntity, &this->pTargetEntity);
    this->pTargetEntity = PlayerVehicle;
    CEntity::RegisterReference(PlayerVehicle, &this->pTargetEntity);
    this->m_iTypeOfSwitch = CamSwitchStyle;
    this->m_iModeToGoTo = v9;
    this->m_bLookingAtPlayer = 0;
    this->m_bStartInterScript = 1;
    sub_19846C(-1);
  }
}

//----- (003E17F4) --------------------------------------------------------
void __fastcall CCamera::TakeControlNoEntity(
        CCamera *this,
        const CVector *TargetCoors,
        Int16 CamSwitchStyle,
        int WhoIsTakingControl)
{
  bool v4; // zf
  __int64 v5; // d16

  v4 = WhoIsTakingControl == 2;
  if ( WhoIsTakingControl == 2 )
    v4 = this->WhoIsInControlOfTheCamera == 1;
  if ( !v4 )
  {
    this->WhoIsInControlOfTheCamera = WhoIsTakingControl;
    this->m_iModeToGoTo = 15;
    *(_WORD *)&this->m_bLookingAtPlayer = 256;
    v5 = *(_QWORD *)&TargetCoors->x;
    this->m_vecFixedModeVector.z = TargetCoors->z;
    this->m_iTypeOfSwitch = CamSwitchStyle;
    this->m_bStartInterScript = 1;
    *(_QWORD *)&this->m_vecFixedModeVector.x = v5;
  }
}

//----- (003E1838) --------------------------------------------------------
void __fastcall CCamera::TakeControlAttachToEntity(
        CCamera *this,
        CEntity *NewTarget,
        CEntity *AttachEntity,
        CVector *vecOffset,
        CVector *vecLookAt,
        float fTilt,
        Int16 CamSwitchStyle,
        int WhoIsTakingControl)
{
  bool v9; // zf
  CEntity *PlayerVehicle; // r8
  CEntity *pTargetEntity; // r0
  __int64 v14; // d16
  __int64 v15; // d16
  CEntity *pAttachedEntity; // r0

  v9 = WhoIsTakingControl == 2;
  if ( WhoIsTakingControl == 2 )
    v9 = this->WhoIsInControlOfTheCamera == 1;
  PlayerVehicle = AttachEntity;
  if ( !v9 )
  {
    this->WhoIsInControlOfTheCamera = WhoIsTakingControl;
    if ( AttachEntity )
    {
      if ( NewTarget )
      {
LABEL_6:
        pTargetEntity = this->pTargetEntity;
        if ( pTargetEntity )
          CEntity::CleanUpOldReference(pTargetEntity, &this->pTargetEntity);
        this->pTargetEntity = NewTarget;
        CEntity::RegisterReference(NewTarget, &this->pTargetEntity);
        this->m_bLookingAtVector = 0;
        goto LABEL_15;
      }
    }
    else if ( FindPlayerVehicle(-1, 0) )
    {
      PlayerVehicle = FindPlayerVehicle(-1, 0);
      if ( NewTarget )
        goto LABEL_6;
    }
    else
    {
      PlayerVehicle = CWorld::Players[CWorld::PlayerInFocus].pPed;
      if ( NewTarget )
        goto LABEL_6;
    }
    this->m_bLookingAtVector = 1;
    if ( vecLookAt->x == vecOffset->x && vecLookAt->y == vecOffset->y && vecLookAt->z == vecOffset->z )
    {
      this->m_vecAttachedCamLookAt.x = 0.0;
      this->m_vecAttachedCamLookAt.y = 0.0;
      this->m_vecAttachedCamLookAt.z = 0.0;
    }
    else
    {
      v14 = *(_QWORD *)&vecLookAt->x;
      this->m_vecAttachedCamLookAt.z = vecLookAt->z;
      *(_QWORD *)&this->m_vecAttachedCamLookAt.x = v14;
    }
LABEL_15:
    if ( vecOffset->x == 0.0 && vecOffset->z == 0.0 )
    {
      this->m_vecAttachedCamOffset.x = 0.0;
      this->m_vecAttachedCamOffset.y = 0.0;
      this->m_vecAttachedCamOffset.z = 2.0;
    }
    else
    {
      v15 = *(_QWORD *)&vecOffset->x;
      this->m_vecAttachedCamOffset.z = vecOffset->z;
      *(_QWORD *)&this->m_vecAttachedCamOffset.x = v15;
    }
    pAttachedEntity = this->pAttachedEntity;
    this->m_fAttachedCamAngle = fTilt;
    if ( pAttachedEntity )
      CEntity::CleanUpOldReference(pAttachedEntity, &this->pAttachedEntity);
    this->pAttachedEntity = PlayerVehicle;
    CEntity::RegisterReference(PlayerVehicle, &this->pAttachedEntity);
    this->m_iTypeOfSwitch = CamSwitchStyle;
    this->m_iModeToGoTo = 47;
    this->m_bLookingAtPlayer = 0;
    this->m_bStartInterScript = 1;
    sub_19846C(-1);
  }
}

//----- (003E19EC) --------------------------------------------------------
void __fastcall CCamera::TakeControlWithSpline(CCamera *this, Int16 CamSwitchStyle)
{
  this->m_bLookingAtPlayer = 0;
  this->m_iModeToGoTo = 17;
  this->m_bLookingAtVector = 0;
  this->m_bcutsceneFinished = 0;
  this->m_iTypeOfSwitch = CamSwitchStyle;
  this->m_bStartInterScript = 1;
}

//----- (003E1A0A) --------------------------------------------------------
void __fastcall CCamera::UpdateAimingCoors(CCamera *this, const CVector *NewAimingCoors)
{
  __int64 v2; // d16

  v2 = *(_QWORD *)&NewAimingCoors->x;
  this->m_cvecAimingTargetCoors.z = NewAimingCoors->z;
  *(_QWORD *)&this->m_cvecAimingTargetCoors.x = v2;
}

//----- (003E1A20) --------------------------------------------------------
void __fastcall CCam::DoCamBump(CCam *this, float fBumpHorz, float fBumpVert)
{
  float *p_m_fCamBumpedHorz; // r0
  uint32 v4; // r3

  p_m_fCamBumpedHorz = &this->m_fCamBumpedHorz;
  v4 = CTimer::m_snTimeInMilliseconds;
  *p_m_fCamBumpedHorz = fBumpHorz;
  p_m_fCamBumpedHorz[1] = fBumpVert;
  *((_DWORD *)p_m_fCamBumpedHorz + 2) = v4;
}

//----- (003E1A34) --------------------------------------------------------
void __fastcall CCamera::SetCamCollisionVarDataSet(int32 id)
{
  if ( gCurCamColVars != id )
  {
    gCurCamColVars = id;
    gCurDistForCam = 1.0;
    gpCamColVars = &gCamColVars[id];
  }
}

//----- (003E1A88) --------------------------------------------------------
void __fastcall CCamera::SetNearClipBasedOnPedCollision(CCamera *this, float nearestDist)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d3

  v3.n64_u32[0] = LODWORD(gpCamColVars->clippingDistance);
  v2.n64_f32[0] = v3.n64_f32[0]
                + (float)((float)((float)(sqrtf(nearestDist) / gPedClipDist) * 0.25) * (float)(0.3 - v3.n64_f32[0]));
  sub_191890(Scene.camera, vmax_f32(v2, v3).n64_f32[0]);
}
// 3E1ACA: variable 'v2' is possibly undefined
// 3E1ACA: variable 'v3' is possibly undefined

//----- (003E1AE8) --------------------------------------------------------
bool __fastcall CCamera::IsExtraEntityToIgnore(CCamera *this, CEntity *pEntity)
{
  int32 m_numExtrasEntitysToIgnore; // r2
  int32 i; // r3

  m_numExtrasEntitysToIgnore = this->m_numExtrasEntitysToIgnore;
  if ( m_numExtrasEntitysToIgnore < 1 )
    return 0;
  for ( i = 0; i < m_numExtrasEntitysToIgnore; ++i )
  {
    if ( this->m_pExtrasEntitysToIgnore[i] == pEntity )
      return 1;
  }
  return 0;
}

//----- (003E1B12) --------------------------------------------------------
bool __fastcall CCamera::ConsiderPedAsDucking(CCamera *this, CPed *pPed)
{
  CTaskSimpleDuck *TaskDuck; // r1
  bool result; // r0

  TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
  if ( !TaskDuck )
    return 0;
  result = 0;
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 && !TaskDuck->m_bIsAborting )
    return 1;
  return result;
}

//----- (003E1B44) --------------------------------------------------------
void __fastcall CCamera::VectorMoveLinear(CCamera *this, CVector *pTo, CVector *pFrom, float time, bool bSetSmoothEnds)
{
  float v5; // s2
  __int64 v6; // d16
  __int64 v7; // d16

  v5 = (float)CTimer::m_snTimeInMilliseconds + time;
  this->m_vectorMoveStartTime = (float)CTimer::m_snTimeInMilliseconds;
  this->m_vectorMoveEndTime = v5;
  v6 = *(_QWORD *)&pFrom->x;
  this->m_vectorMoveFrom.z = pFrom->z;
  *(_QWORD *)&this->m_vectorMoveFrom.x = v6;
  v7 = *(_QWORD *)&pTo->x;
  this->m_vectorMoveTo.z = pTo->z;
  this->m_bVectorMoveSmoothEnds = bSetSmoothEnds;
  *(_QWORD *)&this->m_vectorMoveTo.x = v7;
}

//----- (003E1BA0) --------------------------------------------------------
void __fastcall CCamera::VectorTrackLinear(
        CCamera *this,
        CVector *pTo,
        CVector *pFrom,
        float time,
        bool bSetSmoothEnds)
{
  float v5; // s2
  __int64 v6; // d16
  __int64 v7; // d16

  v5 = (float)CTimer::m_snTimeInMilliseconds + time;
  this->m_vectorTrackStartTime = (float)CTimer::m_snTimeInMilliseconds;
  this->m_vectorTrackEndTime = v5;
  v6 = *(_QWORD *)&pFrom->x;
  this->m_vectorTrackFrom.z = pFrom->z;
  *(_QWORD *)&this->m_vectorTrackFrom.x = v6;
  v7 = *(_QWORD *)&pTo->x;
  this->m_vectorTrackTo.z = pTo->z;
  this->m_bVectorTrackSmoothEnds = bSetSmoothEnds;
  *(_QWORD *)&this->m_vectorTrackTo.x = v7;
}

//----- (003E1BFC) --------------------------------------------------------
void __fastcall CCamera::AddShake(
        CCamera *this,
        float durationMs,
        float scaleShake,
        float twitchFreq,
        float twitchScale,
        float dummy)
{
  float v6; // s2

  this->m_CurShakeCam = 1;
  this->m_DegreeHandShake = 1.0;
  v6 = (float)CTimer::m_snTimeInMilliseconds + durationMs;
  this->m_shakeStartTime = (float)CTimer::m_snTimeInMilliseconds;
  this->m_shakeEndTime = v6;
}

//----- (003E1C38) --------------------------------------------------------
void __fastcall CCamera::AddShakeSimple(CCamera *this, float durationMs, int32 shakeCamId, float degreeOfShake)
{
  float v4; // s2

  this->m_CurShakeCam = shakeCamId;
  this->m_DegreeHandShake = degreeOfShake;
  v4 = (float)CTimer::m_snTimeInMilliseconds + durationMs;
  this->m_shakeStartTime = (float)CTimer::m_snTimeInMilliseconds;
  this->m_shakeEndTime = v4;
}

//----- (003E1C70) --------------------------------------------------------
void __fastcall CCamera::LerpFOV(CCamera *this, float from, float to, float time, bool bSetSmoothEnds)
{
  float v5; // s0

  v5 = (float)CTimer::m_snTimeInMilliseconds;
  this->m_FOVLerpStart = from;
  this->m_FOVLerpEnd = to;
  this->m_bFOVLerpSmoothEnds = bSetSmoothEnds;
  this->m_FOVLerpStartTime = v5;
  this->m_FOVLerpEndTime = v5 + time;
}

//----- (003E1CB4) --------------------------------------------------------
void __fastcall CCamera::ProcessVectorTrackLinear(CCamera *this)
{
  float *p_m_vectorTrackEndTime; // r0
  float v3; // s0
  float v4; // s2
  float m_vectorTrackStartTime; // s4
  _BOOL4 m_bVectorTrackSmoothEnds; // r0
  float x; // s16
  float v8; // s0
  float v9; // r0
  float y; // s2
  float v11; // s4
  float v12; // s6
  float v13; // s8
  float z; // s10
  float v15; // s12

  p_m_vectorTrackEndTime = &this->m_vectorTrackEndTime;
  v3 = (float)CTimer::m_snTimeInMilliseconds;
  v4 = *p_m_vectorTrackEndTime;
  if ( *p_m_vectorTrackEndTime >= (float)CTimer::m_snTimeInMilliseconds )
  {
    m_vectorTrackStartTime = this->m_vectorTrackStartTime;
    m_bVectorTrackSmoothEnds = this->m_bVectorTrackSmoothEnds;
    x = this->m_vectorTrackFrom.x;
    this->m_bVectorTrackScript = 1;
    v8 = (float)(v3 - m_vectorTrackStartTime) / (float)(v4 - m_vectorTrackStartTime);
    if ( m_bVectorTrackSmoothEnds )
    {
      v9 = sinf((float)((float)(270.0 - (float)(v8 * 180.0)) * 3.1416) / 180.0);
      y = this->m_vectorTrackFrom.y;
      v11 = (float)(v9 + 1.0) * 0.5;
      v8 = this->m_vectorTrackTo.y - y;
      v12 = v11 * (float)(this->m_vectorTrackTo.x - x);
      v13 = v11;
    }
    else
    {
      v13 = v8;
      y = this->m_vectorTrackFrom.y;
      v11 = this->m_vectorTrackTo.y - y;
      v12 = v8 * (float)(this->m_vectorTrackTo.x - x);
    }
    z = this->m_vectorTrackFrom.z;
    v15 = this->m_vectorTrackTo.z - z;
    this->m_VectorTrackScript.x = x + v12;
    this->m_VectorTrackScript.y = y + (float)(v8 * v11);
    this->m_VectorTrackScript.z = z + (float)(v13 * v15);
  }
  else if ( this->m_bPersistCamLookAt )
  {
    this->m_bVectorTrackScript = 1;
  }
}

//----- (003E1DFC) --------------------------------------------------------
void __fastcall CCamera::ProcessVectorTrackLinear(CCamera *this, float t)
{
  CVector *p_m_vectorTrackFrom; // r1
  _BOOL4 m_bVectorTrackSmoothEnds; // r0
  float x; // s16
  float v7; // r0
  float y; // s2
  float v9; // s4
  float v10; // s6
  float v11; // s8
  float z; // s10
  float v13; // s12

  p_m_vectorTrackFrom = &this->m_vectorTrackFrom;
  m_bVectorTrackSmoothEnds = this->m_bVectorTrackSmoothEnds;
  x = p_m_vectorTrackFrom->x;
  this->m_bVectorTrackScript = 1;
  if ( m_bVectorTrackSmoothEnds )
  {
    v7 = sinf((float)((float)(270.0 - (float)(t * 180.0)) * 3.1416) / 180.0);
    y = this->m_vectorTrackFrom.y;
    v9 = (float)(v7 + 1.0) * 0.5;
    t = this->m_vectorTrackTo.y - y;
    v10 = v9 * (float)(this->m_vectorTrackTo.x - x);
    v11 = v9;
  }
  else
  {
    v11 = t;
    y = this->m_vectorTrackFrom.y;
    v9 = this->m_vectorTrackTo.y - y;
    v10 = (float)(this->m_vectorTrackTo.x - x) * t;
  }
  z = this->m_vectorTrackFrom.z;
  v13 = this->m_vectorTrackTo.z - z;
  this->m_VectorTrackScript.x = x + v10;
  this->m_VectorTrackScript.y = y + (float)(t * v9);
  this->m_VectorTrackScript.z = z + (float)(v11 * v13);
}

//----- (003E1EFC) --------------------------------------------------------
void __fastcall CCamera::ProcessVectorMoveLinear(CCamera *this)
{
  float *p_m_vectorMoveEndTime; // r0
  float v3; // s0
  float v4; // s2
  float m_vectorMoveStartTime; // s4
  _BOOL4 m_bVectorMoveSmoothEnds; // r0
  float x; // s16
  float v8; // s0
  float v9; // r0
  float y; // s2
  float v11; // s4
  float v12; // s6
  float v13; // s8
  float z; // s10
  float v15; // s12

  p_m_vectorMoveEndTime = &this->m_vectorMoveEndTime;
  v3 = (float)CTimer::m_snTimeInMilliseconds;
  v4 = *p_m_vectorMoveEndTime;
  if ( *p_m_vectorMoveEndTime >= (float)CTimer::m_snTimeInMilliseconds )
  {
    m_vectorMoveStartTime = this->m_vectorMoveStartTime;
    m_bVectorMoveSmoothEnds = this->m_bVectorMoveSmoothEnds;
    x = this->m_vectorMoveFrom.x;
    this->m_bVectorMoveScript = 1;
    v8 = (float)(v3 - m_vectorMoveStartTime) / (float)(v4 - m_vectorMoveStartTime);
    if ( m_bVectorMoveSmoothEnds )
    {
      v9 = sinf((float)((float)(270.0 - (float)(v8 * 180.0)) * 3.1416) / 180.0);
      y = this->m_vectorMoveFrom.y;
      v11 = (float)(v9 + 1.0) * 0.5;
      v8 = this->m_vectorMoveTo.y - y;
      v12 = v11 * (float)(this->m_vectorMoveTo.x - x);
      v13 = v11;
    }
    else
    {
      v13 = v8;
      y = this->m_vectorMoveFrom.y;
      v11 = this->m_vectorMoveTo.y - y;
      v12 = v8 * (float)(this->m_vectorMoveTo.x - x);
    }
    z = this->m_vectorMoveFrom.z;
    v15 = this->m_vectorMoveTo.z - z;
    this->m_VectorMoveScript.x = x + v12;
    this->m_VectorMoveScript.y = y + (float)(v8 * v11);
    this->m_VectorMoveScript.z = z + (float)(v13 * v15);
  }
  else if ( this->m_bPersistCamPos )
  {
    this->m_bVectorMoveScript = 1;
  }
}

//----- (003E2044) --------------------------------------------------------
void __fastcall CCamera::ProcessVectorMoveLinear(CCamera *this, float t)
{
  CVector *p_m_vectorMoveFrom; // r1
  _BOOL4 m_bVectorMoveSmoothEnds; // r0
  float x; // s16
  float v7; // r0
  float y; // s2
  float v9; // s4
  float v10; // s6
  float v11; // s8
  float z; // s10
  float v13; // s12

  p_m_vectorMoveFrom = &this->m_vectorMoveFrom;
  m_bVectorMoveSmoothEnds = this->m_bVectorMoveSmoothEnds;
  x = p_m_vectorMoveFrom->x;
  this->m_bVectorMoveScript = 1;
  if ( m_bVectorMoveSmoothEnds )
  {
    v7 = sinf((float)((float)(270.0 - (float)(t * 180.0)) * 3.1416) / 180.0);
    y = this->m_vectorMoveFrom.y;
    v9 = (float)(v7 + 1.0) * 0.5;
    t = this->m_vectorMoveTo.y - y;
    v10 = v9 * (float)(this->m_vectorMoveTo.x - x);
    v11 = v9;
  }
  else
  {
    v11 = t;
    y = this->m_vectorMoveFrom.y;
    v9 = this->m_vectorMoveTo.y - y;
    v10 = (float)(this->m_vectorMoveTo.x - x) * t;
  }
  z = this->m_vectorMoveFrom.z;
  v13 = this->m_vectorMoveTo.z - z;
  this->m_VectorMoveScript.x = x + v10;
  this->m_VectorMoveScript.y = y + (float)(t * v9);
  this->m_VectorMoveScript.z = z + (float)(v11 * v13);
}

//----- (003E2150) --------------------------------------------------------
void __fastcall CCamera::ProcessShake(CCamera *this, float time)
{
  int ActiveCam; // r8
  CHandShaker *v4; // r5
  float *p_m_DegreeHandShake; // r1
  float z; // s18
  char *v7; // r6
  CVector *v8; // r4
  float v9; // s16
  __int64 v10; // d16
  __int64 v11; // d16
  __int64 v12; // d16
  CVector v13; // [sp+0h] [bp-60h] BYREF
  CVector v14; // [sp+10h] [bp-50h] BYREF
  CVector v15; // [sp+20h] [bp-40h] BYREF

  ActiveCam = this->ActiveCam;
  if ( !CCamera::ProcessShake(float)::gInitShakeCams )
  {
    CCamera::ProcessShake(float)::gInitShakeCams = 1;
    gHandShaker[1].motion.y = 0.0002;
    gHandShaker[1].motion.z = 0.0001;
    gHandShaker[1].slow.x = 1.3;
    gHandShaker[1].slow.y = 1.3;
    gHandShaker[1].slow.z = 1.4;
    *(_QWORD *)&gHandShaker[1].lim.x = 0x3CA3D70A3CA3D70ALL;
    *(_QWORD *)&gHandShaker[1].lim.z = 0x3951B7173C23D70ALL;
    gHandShaker[1].scaleReactionMin = 0.3;
    gHandShaker[1].scaleReactionMax = 1.0;
    gHandShaker[1].twitchFreq = 15;
    gHandShaker[1].twitchVel = 0.001;
    gHandShaker[2].lim.x = 0.02;
    gHandShaker[2].lim.y = 0.02;
    gHandShaker[2].lim.z = 0.04;
    gHandShaker[2].motion.x = 0.0002;
    gHandShaker[2].motion.y = 0.0002;
    gHandShaker[2].motion.z = 0.0001;
    gHandShaker[2].slow.x = 1.3;
    gHandShaker[2].slow.y = 1.3;
    gHandShaker[2].slow.z = 1.4;
    gHandShaker[2].scaleReactionMin = 0.3;
    gHandShaker[2].scaleReactionMax = 1.0;
    gHandShaker[2].twitchFreq = 20;
    gHandShaker[2].twitchVel = 0.001;
    *(_QWORD *)&gHandShaker[3].lim.x = 0x3CA3D70A3CA3D70ALL;
    *(_QWORD *)&gHandShaker[3].lim.z = 0x3951B7173C23D70ALL;
    gHandShaker[3].motion.y = 0.0002;
    gHandShaker[3].motion.z = 0.0001;
    gHandShaker[3].slow.x = 1.3;
    gHandShaker[3].slow.y = 1.3;
    gHandShaker[3].slow.z = 1.4;
    gHandShaker[3].scaleReactionMin = 0.3;
    gHandShaker[3].scaleReactionMax = 1.0;
    gHandShaker[3].twitchFreq = 10;
    gHandShaker[3].twitchVel = 0.0005;
    *(_QWORD *)&gHandShaker[4].lim.x = 0x3CA3D70A3CA3D70ALL;
    *(_QWORD *)&gHandShaker[4].lim.z = 0x3951B7173C23D70ALL;
    gHandShaker[4].motion.y = 0.0002;
    gHandShaker[4].motion.z = 0.0001;
    gHandShaker[4].slow.x = 1.3;
    gHandShaker[4].slow.y = 1.3;
    gHandShaker[4].slow.z = 1.4;
    gHandShaker[4].scaleReactionMin = 0.3;
    gHandShaker[4].scaleReactionMax = 1.0;
    gHandShaker[4].twitchFreq = 20;
    gHandShaker[4].twitchVel = 0.002;
    *(_QWORD *)&gHandShaker[5].lim.x = 0x3CA3D70A3CA3D70ALL;
    *(_QWORD *)&gHandShaker[5].lim.z = 0x3951B7173C23D70ALL;
    gHandShaker[5].motion.y = 0.0002;
    gHandShaker[5].motion.z = 0.0001;
    gHandShaker[5].slow.x = 1.3;
    gHandShaker[5].slow.y = 1.3;
    gHandShaker[5].slow.z = 1.4;
    gHandShaker[5].scaleReactionMin = 0.3;
    gHandShaker[5].scaleReactionMax = 1.0;
    gHandShaker[5].twitchFreq = 2;
    gHandShaker[5].twitchVel = 0.003;
  }
  v4 = &gHandShaker[this->m_CurShakeCam];
  CHandShaker::Process(v4, this->m_DegreeHandShake);
  p_m_DegreeHandShake = &this->m_DegreeHandShake;
  z = v4->ang.z;
  v7 = (char *)this + 528 * ActiveCam;
  v8 = (CVector *)(v7 + 728);
  v9 = *p_m_DegreeHandShake;
  Multiply3x3(&v15, (const CVector *)(v7 + 728), &v4->resultMat);
  v10 = *(_QWORD *)&v15.x;
  *((_DWORD *)v7 + 184) = LODWORD(v15.z);
  *((_QWORD *)v7 + 91) = v10;
  CVector::Normalise((CVector *)(v7 + 728));
  *((_DWORD *)v7 + 192) = 0;
  *((float *)v7 + 191) = sinf(z * v9);
  *((float *)v7 + 193) = cosf(z * v9);
  CrossProduct(&v14, (const CVector *)(v7 + 728), (const CVector *)(v7 + 764));
  CVector::Normalise(&v14);
  CrossProduct(&v13, &v14, (const CVector *)(v7 + 728));
  v11 = *(_QWORD *)&v13.x;
  *((_DWORD *)v7 + 193) = LODWORD(v13.z);
  *(_QWORD *)(v7 + 764) = v11;
  if ( *((float *)v7 + 182) == 0.0 && *((float *)v7 + 183) == 0.0 )
  {
    v8->x = 0.0001;
    *((_DWORD *)v7 + 183) = 953267991;
  }
  CrossProduct(&v13, (const CVector *)(v7 + 728), (const CVector *)(v7 + 764));
  v14 = v13;
  CVector::Normalise(&v14);
  CrossProduct(&v13, &v14, v8);
  v12 = *(_QWORD *)&v13.x;
  *((_DWORD *)v7 + 193) = LODWORD(v13.z);
  *(_QWORD *)(v7 + 764) = v12;
}
// 952FB8: using guessed type char CCamera::ProcessShake(float)::gInitShakeCams;

//----- (003E23C0) --------------------------------------------------------
void __fastcall CCamera::ProcessFOVLerp(CCamera *this)
{
  float *p_m_FOVLerpEndTime; // r0
  float v3; // s0
  float v4; // s2
  float m_FOVLerpStartTime; // s4
  _BOOL4 m_bFOVLerpSmoothEnds; // r0
  float m_FOVLerpStart; // s16
  float v8; // s0

  p_m_FOVLerpEndTime = &this->m_FOVLerpEndTime;
  v3 = (float)CTimer::m_snTimeInMilliseconds;
  v4 = *p_m_FOVLerpEndTime;
  if ( *p_m_FOVLerpEndTime >= (float)CTimer::m_snTimeInMilliseconds )
  {
    m_FOVLerpStartTime = this->m_FOVLerpStartTime;
    m_bFOVLerpSmoothEnds = this->m_bFOVLerpSmoothEnds;
    m_FOVLerpStart = this->m_FOVLerpStart;
    this->m_bFOVScript = 1;
    v8 = (float)(v3 - m_FOVLerpStartTime) / (float)(v4 - m_FOVLerpStartTime);
    if ( m_bFOVLerpSmoothEnds )
      v8 = (float)(sinf((float)((float)(270.0 - (float)(v8 * 180.0)) * 3.1416) / 180.0) + 1.0) * 0.5;
    this->m_MyFOV = m_FOVLerpStart + (float)(v8 * (float)(this->m_FOVLerpEnd - m_FOVLerpStart));
  }
  else if ( this->m_bPersistFOV )
  {
    this->m_bFOVScript = 1;
  }
}

//----- (003E2494) --------------------------------------------------------
void __fastcall CCamera::ProcessFOVLerp(CCamera *this, float t)
{
  float *p_m_FOVLerpStart; // r1
  _BOOL4 m_bFOVLerpSmoothEnds; // r0
  float v6; // s16

  p_m_FOVLerpStart = &this->m_FOVLerpStart;
  m_bFOVLerpSmoothEnds = this->m_bFOVLerpSmoothEnds;
  v6 = *p_m_FOVLerpStart;
  this->m_bFOVScript = 1;
  if ( m_bFOVLerpSmoothEnds )
    t = (float)(sinf((float)((float)(270.0 - (float)(t * 180.0)) * 3.1416) / 180.0) + 1.0) * 0.5;
  this->m_MyFOV = v6 + (float)(t * (float)(this->m_FOVLerpEnd - v6));
}

//----- (003E2520) --------------------------------------------------------
float __fastcall CCamera::GetRoughDistanceToGround(CCamera *this)
{
  return this->Cams[this->ActiveCam].Source.z - CCamera::CalculateGroundHeight(this, 0);
}

//----- (003E254C) --------------------------------------------------------
float __fastcall GetNearestDistanceOfPedSphereToCameraNearClip(CPed *pPed)
{
  float32x2_t v1; // d3
  float32x2_t v2; // d6
  CPedModelInfo *v3; // r4
  float *v4; // r0
  int v5; // r1
  float *p_x; // r2

  v3 = (CPedModelInfo *)CModelInfo::ms_modelInfoPtrs[pPed->m_nModelIndex];
  CPedModelInfo::AnimatePedColModelSkinnedWorld(v3, (RpClump_0 *)pPed->m_pRwObject);
  v5 = 0;
  v1.n64_u32[0] = 1232348144;
  do
  {
    p_x = &v3->m_pHitColModel->m_pColData->m_pSphereArray[v5++].m_vecCentre.x;
    v4 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
    v2.n64_f32[0] = (float)((float)((float)((float)((float)(*p_x * v4[182]) + (float)(p_x[1] * v4[183]))
                                          + (float)(p_x[2] * v4[184]))
                                  - (float)((float)((float)(v4[182] * v4[185]) + (float)(v4[183] * v4[186]))
                                          + (float)(v4[184] * v4[187])))
                          - p_x[3])
                  - Scene.camera->nearPlane;
    v1.n64_u64[0] = vmin_f32(v2, v1).n64_u64[0];
  }
  while ( v5 != 12 );
  return v1.n64_f32[0];
}
// 3E25F2: variable 'v2' is possibly undefined
// 3E25F2: variable 'v1' is possibly undefined

//----- (003E2610) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CCam::GetCoreDataForDWCineyCamMode(
        CCam *this,
        CEntity **pEntity,
        CVehicle **pVehicle,
        CVector *dst,
        CVector *src,
        CVector *targetUp,
        CVector *targetRight,
        CVector *targetForward,
        CVector *targetMotion,
        float *targetVel,
        CVector *targetAngMotion,
        float *targetAngVel,
        CColSphere *sph)
{
  CVehicle *CamTargetEntity; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r6
  __int64 v17; // d16
  __int64 v18; // d16
  CMatrix *v19; // r1
  RwReal xz; // s4
  RwReal yz; // s0
  RwReal zz; // s2
  CMatrix *v23; // r0
  RwReal xx; // s4
  float yx; // s0
  RwReal zx; // s2
  float m_heading; // r5
  float v28; // r8
  float *v29; // r2
  CColSphere *v30; // r10
  CMatrix *v31; // r0
  RwReal xy; // s4
  float yy; // s2
  RwReal zy; // s0
  float v35; // r6
  float v36; // r10
  unsigned int v37; // r0
  CVehicle *v38; // r0
  float v39; // s0
  float v40; // s2
  CVehicle *v41; // r0
  float v42; // s0
  float v43; // s2
  CVehicle *v44; // r1
  float m_fRadius; // r4
  CVector v46; // [sp+8h] [bp-28h] BYREF

  CamTargetEntity = (CVehicle *)this->CamTargetEntity;
  *pEntity = CamTargetEntity;
  *pVehicle = CamTargetEntity;
  m_pMat = CamTargetEntity->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &CamTargetEntity->m_transform;
  v17 = *(_QWORD *)&p_tx->m_translate.x;
  dst->z = p_tx->m_translate.z;
  *(_QWORD *)&dst->x = v17;
  v18 = *(_QWORD *)&DWCineyCamLastPos.x;
  src->z = DWCineyCamLastPos.z;
  *(_QWORD *)&src->x = v18;
  v19 = (*pVehicle)->m_pMat;
  if ( v19 )
  {
    xz = v19->xz;
    yz = v19->yz;
    zz = v19->zz;
  }
  else
  {
    yz = 0.0;
    zz = 1.0;
    xz = 0.0;
  }
  targetUp->x = xz;
  targetUp->y = yz;
  targetUp->z = zz;
  v23 = (*pVehicle)->m_pMat;
  if ( v23 )
  {
    xx = v23->xx;
    yx = v23->yx;
    zx = v23->zx;
  }
  else
  {
    m_heading = (*pVehicle)->m_transform.m_heading;
    v28 = cosf(m_heading);
    yx = sinf(m_heading);
    zx = 0.0;
    xx = v28;
  }
  v30 = sph;
  v29 = targetAngVel;
  targetRight->x = xx;
  targetRight->y = yx;
  targetRight->z = zx;
  v31 = (*pVehicle)->m_pMat;
  if ( v31 )
  {
    xy = v31->xy;
    yy = v31->yy;
    zy = v31->zy;
  }
  else
  {
    v35 = (*pVehicle)->m_transform.m_heading;
    v36 = sinf(v35);
    yy = cosf(v35);
    v37 = LODWORD(v36) ^ 0x80000000;
    v29 = targetAngVel;
    v30 = sph;
    xy = *(float *)&v37;
    zy = 0.0;
  }
  targetForward->x = xy;
  targetForward->y = yy;
  targetForward->z = zy;
  v38 = *pVehicle;
  *(_QWORD *)&targetMotion->x = *(_QWORD *)&(*pVehicle)->m_vecMoveSpeed.x;
  v39 = targetMotion->x * targetMotion->x;
  v40 = targetMotion->y * targetMotion->y;
  targetMotion->z = v38->m_vecMoveSpeed.z;
  *targetVel = sqrtf((float)(v39 + v40) + (float)(targetMotion->z * targetMotion->z));
  v41 = *pVehicle;
  *(_QWORD *)&targetAngMotion->x = *(_QWORD *)&(*pVehicle)->m_vecTurnSpeed.x;
  v42 = targetAngMotion->x * targetAngMotion->x;
  v43 = targetAngMotion->y * targetAngMotion->y;
  targetAngMotion->z = v41->m_vecTurnSpeed.z;
  *v29 = sqrtf((float)(v42 + v43) + (float)(targetAngMotion->z * targetAngMotion->z));
  v44 = *pVehicle;
  m_fRadius = CModelInfo::ms_modelInfoPtrs[(*pVehicle)->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  CEntity::GetBoundCentre(&v46, v44);
  CColSphere::Set(v30, m_fRadius, &v46, 0, 0, 0xFFu);
}
// 3E2610: variables would overlap: ^54.4 and ^54.8

//----- (003E27C0) --------------------------------------------------------
void __fastcall CCam::CacheLastSettingsDWCineyCam(CCam *this)
{
  __int64 v2; // d16
  __int64 v3; // d16
  __int64 v4; // d16
  CVector v5; // [sp+0h] [bp-18h] BYREF

  v2 = *(_QWORD *)&this->Up.x;
  DWCineyCamLastUp.z = this->Up.z;
  *(_QWORD *)&DWCineyCamLastUp.x = v2;
  CrossProduct(&v5, &this->Front, &this->Up);
  DWCineyCamLastRight = v5;
  v3 = *(_QWORD *)&this->Front.x;
  DWCineyCamLastFwd.z = this->Front.z;
  *(_QWORD *)&DWCineyCamLastFwd.x = v3;
  DWCineyCamLastFov = this->FOV;
  DWCineyCamLastNearClip = Scene.camera->nearPlane;
  v4 = *(_QWORD *)&this->Source.x;
  DWCineyCamLastPos.z = this->Source.z;
  *(_QWORD *)&DWCineyCamLastPos.x = v4;
}

//----- (003E2870) --------------------------------------------------------
void __fastcall CHandShaker::SetDefaults(CHandShaker *this)
{
  RwReal *p_y; // r0
  int v3; // r0
  float y; // s16
  float v5; // s18
  int v6; // r0
  float z; // s20
  float v8; // s22
  int v9; // r0

  *(_QWORD *)&this->ang.x = 0LL;
  *(_QWORD *)&this->ang.z = 0x3CA3D70A00000000LL;
  p_y = &this->lim.y;
  *(_QWORD *)p_y = 0x3C23D70A3CA3D70ALL;
  *((_QWORD *)p_y + 1) = 0x3951B7173951B717LL;
  this->motion.z = 0.0001;
  this->slow.x = 1.3;
  this->slow.y = 1.3;
  this->slow.z = 1.4;
  this->scaleReactionMin = 0.3;
  this->scaleReactionMax = 1.0;
  *(_QWORD *)&this->twitchFreq = 0x3A83126F00000014LL;
  v3 = rand();
  y = this->motion.y;
  v5 = (float)v3;
  v6 = rand();
  z = this->motion.z;
  v8 = (float)v6;
  v9 = rand();
  this->vel.x = (float)((float)(v5 * 4.6566e-10) * 0.0002) + 0.0;
  this->vel.y = (float)(y * (float)(v8 * 4.6566e-10)) + 0.0;
  this->vel.z = (float)(z * (float)((float)v9 * 4.6566e-10)) + 0.0;
}

//----- (003E296C) --------------------------------------------------------
void __fastcall CHandShaker::Reset(CHandShaker *this)
{
  float x; // s16
  int v3; // r0
  float y; // s18
  float v5; // s20
  int v6; // r0
  float z; // s22
  float v8; // s24
  int v9; // r0

  x = this->motion.x;
  this->ang.x = 0.0;
  this->ang.y = 0.0;
  this->ang.z = 0.0;
  v3 = rand();
  y = this->motion.y;
  v5 = (float)v3;
  v6 = rand();
  z = this->motion.z;
  v8 = (float)v6;
  v9 = rand();
  this->vel.x = (float)(x * (float)(v5 * 4.6566e-10)) + 0.0;
  this->vel.y = (float)(y * (float)(v8 * 4.6566e-10)) + 0.0;
  this->vel.z = (float)(z * (float)((float)v9 * 4.6566e-10)) + 0.0;
}

//----- (003E29F4) --------------------------------------------------------
void __fastcall CCam::Finalise_DW_CineyCams(
        CCam *this,
        CVector *pSrc,
        CVector *pDst,
        float roll,
        float fov,
        float nearClip,
        float degreeShake)
{
  CVector *p_Front; // r4
  RwReal v10; // s2
  RwReal v12; // s4
  __int64 v13; // d8
  CVector *p_Up; // r10
  __int64 v15; // d16
  CVector *p_Source; // r11
  __int64 v17; // d16
  __int64 v18; // d16
  float z; // s18
  __int64 v20; // d16
  __int64 v21; // d16
  __int64 v22; // d16
  __int64 v23; // d16
  CVector v24; // [sp+0h] [bp-60h] BYREF
  CVector v25; // [sp+10h] [bp-50h] BYREF
  CVector v26; // [sp+20h] [bp-40h] BYREF

  p_Front = &this->Front;
  v10 = pDst->y - pSrc->y;
  v12 = pDst->z - pSrc->z;
  this->Front.x = pDst->x - pSrc->x;
  this->Front.y = v10;
  this->Front.z = v12;
  CVector::Normalise(&this->Front);
  v13 = *(_QWORD *)&pSrc->x;
  this->Source.z = pSrc->z;
  this->Up.y = 0.0;
  this->Up.z = cosf(roll);
  p_Up = &this->Up;
  this->Up.x = sinf(roll);
  *(_QWORD *)&this->Source.x = v13;
  CrossProduct(&v25, p_Front, &this->Up);
  CVector::Normalise(&v25);
  CrossProduct(&v26, &v25, p_Front);
  v15 = *(_QWORD *)&v26.x;
  p_Source = &this->Source;
  this->Up.z = v26.z;
  *(_QWORD *)&this->Up.x = v15;
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v26, p_Front, &this->Up);
  v25 = v26;
  CVector::Normalise(&v25);
  CrossProduct(&v26, &v25, p_Front);
  v17 = *(_QWORD *)&v26.x;
  this->Up.z = v26.z;
  *(_QWORD *)&p_Up->x = v17;
  this->FOV = fov;
  RwCameraSetNearClipPlane(Scene.camera, 0.4);
  v18 = *(_QWORD *)&p_Up->x;
  DWCineyCamLastUp.z = this->Up.z;
  *(_QWORD *)&DWCineyCamLastUp.x = v18;
  CrossProduct(&v26, p_Front, &this->Up);
  DWCineyCamLastRight = v26;
  DWCineyCamLastFwd = *p_Front;
  DWCineyCamLastFov = this->FOV;
  DWCineyCamLastNearClip = Scene.camera->nearPlane;
  DWCineyCamLastPos.z = this->Source.z;
  *(_QWORD *)&DWCineyCamLastPos.x = *(_QWORD *)&p_Source->x;
  gLastFrameProcessedDWCineyCam = CTimer::m_FrameCounter;
  CHandShaker::Process(gHandShaker, degreeShake);
  z = gHandShaker[0].ang.z;
  Multiply3x3(&v26, p_Front, &gHandShaker[0].resultMat);
  v20 = *(_QWORD *)&v26.x;
  p_Front->z = v26.z;
  *(_QWORD *)&p_Front->x = v20;
  CVector::Normalise(p_Front);
  v21 = *(_QWORD *)&pSrc->x;
  this->Source.z = pSrc->z;
  *(_QWORD *)&p_Source->x = v21;
  this->Up.y = 0.0;
  this->Up.x = sinf(z * degreeShake);
  this->Up.z = cosf(z * degreeShake);
  CrossProduct(&v24, p_Front, &this->Up);
  v25 = v24;
  CVector::Normalise(&v25);
  CrossProduct(&v24, &v25, p_Front);
  v22 = *(_QWORD *)&v24.x;
  this->Up.z = v24.z;
  *(_QWORD *)&p_Up->x = v22;
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v24, p_Front, &this->Up);
  v25 = v24;
  CVector::Normalise(&v25);
  CrossProduct(&v24, &v25, p_Front);
  v23 = *(_QWORD *)&v24.x;
  this->Up.z = v24.z;
  *(_QWORD *)&p_Up->x = v23;
}

//----- (003E2CD4) --------------------------------------------------------
void __fastcall CHeliCamSettings::RandomiseABit(CHeliCamSettings *this)
{
  this->heliSpeed = this->heliSpeed * (float)((float)((float)((float)rand() * 4.6566e-10) * 1.4) + 0.1);
  this->behindStart = this->behindStart * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + 0.5);
  this->heliHeight = this->heliHeight * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + 0.5);
  this->heliOutSideOfVehicle = this->heliOutSideOfVehicle
                             * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + 0.5);
  this->zoomInTime = this->zoomInTime * (float)((float)((float)((float)rand() * 4.6566e-10) * 1.5) + 0.5);
}

//----- (003E2DB8) --------------------------------------------------------
void __fastcall CHeliCamSettings::Reset(CHeliCamSettings *this)
{
  int32 gLockDestHeliTimeoutDefault; // r1
  float v2; // s0
  int32 gDefaultFramesOutOfSightBeforeWeLoseTheCar; // r3

  gLockDestHeliTimeoutDefault = this->gLockDestHeliTimeoutDefault;
  v2 = this->zoomFOVStart - this->zoomFOVEnd;
  gDefaultFramesOutOfSightBeforeWeLoseTheCar = this->gDefaultFramesOutOfSightBeforeWeLoseTheCar;
  this->gbHeliCollided = 0;
  this->gbLockDest = 0;
  this->gbWeLostTheCar = 0;
  this->gbNoZoom = 0;
  this->gZoomBackOut = 0;
  this->gFramesBeenOutOfSight = gDefaultFramesOutOfSightBeforeWeLoseTheCar;
  this->gLockDestTimeOut = gLockDestHeliTimeoutDefault;
  this->gZoomOutFOV = v2;
}

//----- (003E2DF0) --------------------------------------------------------
void __fastcall CHeliCamSettings::SetDefault(CHeliCamSettings *this)
{
  this->heliRollScale = 0.0;
  this->heliClip = 10.0;
  this->gLockDestHeliTimeoutDefault = 30;
  this->numAttemptsToFindAValidOne = 8;
  this->timeToZoomOut = 0.75;
  this->gZoomBackOutSpeed = 4000;
  this->gbLockDest = 0;
  this->gbHeliCollided = 0;
  this->gbWeLostTheCar = 0;
  this->gbNoZoom = 0;
  *(_QWORD *)&this->zoomInTime = 0x428C00003D4CCCCDLL;
  *(_QWORD *)&this->zoomFOVEnd = 0x3F80000041B00000LL;
  *(_QWORD *)&this->heliSpeed = 0x41F0000042480000LL;
  *(_QWORD *)&this->heliHeight = 0x42480000425C0000LL;
  this->gLockDestTimeOut = 30;
  this->gDefaultFramesOutOfSightBeforeWeLoseTheCar = 60;
  this->gFramesBeenOutOfSight = 60;
  this->gHeliDistFOVZoomMore = 100.0;
  this->gHeliDistFOVZoomMoreMax = 110.0;
  this->gLessFOV = 10.0;
  this->gLenToCarToPushCameraOut = 5.0;
  this->gRadiusOfSphereAroundHeli = 12.0;
  this->gZoomOutFOV = 48.0;
  this->gZoomBackOut = 0;
}

//----- (003E2EB0) --------------------------------------------------------
int __fastcall CCam::IsTimeToExitThisDWCineyCamMode(
        CCam *this,
        int32 camId,
        CVector *pSrc,
        CVector *pDst,
        float t,
        int bLineOfSightCheck)
{
  unsigned int v6; // r4
  int result; // r0
  float32x2_t v8; // d16
  unsigned __int64 v9; // d1
  float v10; // s0
  _BOOL4 v11; // r5
  int v12; // r6
  int v13; // r0
  CEntity *refEntityPtr; // [sp+20h] [bp-40h] BYREF
  CColPoint colPoint; // [sp+24h] [bp-3Ch] BYREF

  v6 = camId - 20;
  if ( gbExitCam[camId - 20] )
    return 1;
  v8.n64_u64[0] = vsub_f32(*(float32x2_t *)&pDst->y, *(float32x2_t *)&pSrc->y).n64_u64[0];
  v9 = vmul_f32(v8, v8).n64_u64[0];
  v10 = sqrtf(
          (float)((float)((float)(pDst->x - pSrc->x) * (float)(pDst->x - pSrc->x)) + *(float *)&v9)
        + *((float *)&v9 + 1));
  v11 = v10 < gMovieCamMinDist[v6] || v10 > gMovieCamMaxDist[v6];
  v12 = 0;
  if ( bLineOfSightCheck == 1 )
  {
    CWorld::pIgnoreEntity = this->CamTargetEntity;
    v13 = CWorld::ProcessLineOfSight(pDst, pSrc, &colPoint, &refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
    CWorld::pIgnoreEntity = 0;
    v12 = v13;
  }
  if ( v6 > 8 )
    return 0;
  result = 1;
  if ( !(v11 | v12) && CTimer::m_snTimeInMilliseconds <= gDWCineyCamEndTime )
    return 0;
  return result;
}

//----- (003E2FBC) --------------------------------------------------------
float __fastcall WaveFunc(float val, float min, float max, float freq)
{
  return sub_18F634((float)((float)((float)((float)((float)(val - min) / (float)(max - min)) * freq) * 360.0) * 3.1416) / 180.0);
}

//----- (003E3008) --------------------------------------------------------
bool __fastcall CCam::IsTargetInWater(CCam *this, const CVector *CamPos)
{
  return 0;
}

//----- (003E300C) --------------------------------------------------------
CVector *__fastcall CCam::DoAverageOnVector(CVector *retstr, CCam *this, const CVector *ThingToAverage)
{
  retstr->x = 0.0;
  retstr->y = 0.0;
  retstr->z = 0.0;
  return retstr;
}

//----- (003E3018) --------------------------------------------------------
Int8 __fastcall CCamera::ShouldPedControlsBeRelative(CCamera *this)
{
  return 1;
}

//----- (003E301C) --------------------------------------------------------
bool __fastcall CCam::ProcessArrestCamTwo(CCam *this)
{
  return 1;
}

//----- (003E3020) --------------------------------------------------------
void __fastcall CClock::Initialise(uint32 nMillisecondsPerGameMinute)
{
  CClock::ms_nMillisecondsPerGameMinute = nMillisecondsPerGameMinute;
  CClock::ms_nGameClockMonths = 1;
  CClock::ms_nGameClockDays = 1;
  CClock::ms_nGameClockHours = 12;
  CClock::ms_nGameClockMinutes = 0;
  CClock::ms_nGameClockSeconds = 0;
  CClock::bClockHasBeenStored = 0;
  CClock::CurrentDay = 4;
  CClock::ms_nLastClockTick = CTimer::m_snTimeInMilliseconds;
}

//----- (003E30C0) --------------------------------------------------------
void __fastcall CClock::SetGameClock(uint8 nHours, uint8 nMinutes, uint8 nDay)
{
  unsigned __int8 v3; // r1
  int v4; // r1
  char v5; // r2
  __int64 v6; // r2
  uint8 v7; // r0

  CClock::ms_nGameClockHours = nHours;
  CClock::ms_nGameClockMinutes = nMinutes;
  CClock::ms_nLastClockTick = CTimer::m_snTimeInMilliseconds;
  if ( nDay )
  {
    CClock::CurrentDay = nDay;
    ++CClock::ms_nGameClockDays;
  }
  CClock::ms_nGameClockSeconds = 0;
  if ( nMinutes >= 0x3Cu )
  {
    v3 = nMinutes - 60;
    *(_DWORD *)&nHours = nHours + v3 / 0x3Cu + 1;
    CClock::ms_nGameClockHours = nHours;
    CClock::ms_nGameClockMinutes = v3 % 0x3Cu;
  }
  LOBYTE(v4) = CClock::ms_nGameClockDays;
  if ( nHours >= 0x18u )
  {
    v5 = 23 - nHours;
    if ( (unsigned __int8)(23 - nHours) <= 0xE8u )
      v5 = -24;
    v6 = 2863311531LL * (unsigned __int8)(v5 + nHours);
    v4 = CClock::ms_nGameClockDays + (HIDWORD(v6) >> 4) + 1;
    CClock::ms_nGameClockDays += (HIDWORD(v6) >> 4) + 1;
    CClock::ms_nGameClockHours = nHours - 24 * (HIDWORD(v6) >> 4) - 24;
  }
  v7 = CClock::ms_nGameClockMonths;
  if ( (unsigned __int8)v4 > 0x1Fu )
  {
    v7 = CClock::ms_nGameClockMonths + 1;
    CClock::ms_nGameClockDays = 1;
    ++CClock::ms_nGameClockMonths;
  }
  if ( v7 > 0xCu )
    CClock::ms_nGameClockMonths = 1;
}

//----- (003E3210) --------------------------------------------------------
void CClock::NormaliseGameClock()
{
  uint8 v0; // r1
  unsigned int v1; // r0
  unsigned __int8 v2; // r1
  int v3; // r1
  char v4; // r2
  __int64 v5; // r2
  uint8 v6; // r0

  v0 = CClock::ms_nGameClockMinutes;
  if ( CClock::ms_nGameClockSeconds >= 0x3Cu )
  {
    v0 = CClock::ms_nGameClockMinutes + (unsigned __int16)(CClock::ms_nGameClockSeconds - 60) / 0x3Cu + 1;
    CClock::ms_nGameClockMinutes = v0;
    CClock::ms_nGameClockSeconds = (unsigned __int16)(CClock::ms_nGameClockSeconds - 60) % 0x3Cu;
  }
  LOBYTE(v1) = CClock::ms_nGameClockHours;
  if ( v0 >= 0x3Cu )
  {
    v2 = v0 - 60;
    v1 = CClock::ms_nGameClockHours + v2 / 0x3Cu + 1;
    CClock::ms_nGameClockHours += v2 / 0x3Cu + 1;
    CClock::ms_nGameClockMinutes = v2 % 0x3Cu;
  }
  LOBYTE(v3) = CClock::ms_nGameClockDays;
  if ( (unsigned __int8)v1 >= 0x18u )
  {
    v4 = 23 - v1;
    if ( (unsigned __int8)(23 - v1) <= 0xE8u )
      v4 = -24;
    v5 = 2863311531LL * (unsigned __int8)(v4 + v1);
    v3 = CClock::ms_nGameClockDays + (HIDWORD(v5) >> 4) + 1;
    CClock::ms_nGameClockDays += (HIDWORD(v5) >> 4) + 1;
    CClock::ms_nGameClockHours = v1 - 24 * (HIDWORD(v5) >> 4) - 24;
  }
  v6 = CClock::ms_nGameClockMonths;
  if ( (unsigned __int8)v3 > 0x1Fu )
  {
    v6 = CClock::ms_nGameClockMonths + 1;
    CClock::ms_nGameClockDays = 1;
    ++CClock::ms_nGameClockMonths;
  }
  if ( v6 > 0xCu )
    CClock::ms_nGameClockMonths = 1;
}

//----- (003E3360) --------------------------------------------------------
uint32 __fastcall CClock::GetGameClockMinutesUntil(uint8 nHours, uint8 nMinutes)
{
  unsigned int v2; // r0
  unsigned int v3; // r2

  v2 = nMinutes + 60 * nHours;
  v3 = CClock::ms_nGameClockMinutes + 60 * CClock::ms_nGameClockHours;
  if ( v2 < v3 )
    v2 += 1440;
  return v2 - v3;
}

//----- (003E3394) --------------------------------------------------------
bool __fastcall CClock::GetIsTimeInRange(uint8 nStartHour, uint8 nEndHour)
{
  unsigned int v2; // r2
  bool result; // r0

  v2 = nStartHour;
  if ( nStartHour <= nEndHour )
    return (unsigned int)CClock::ms_nGameClockHours >= nStartHour && (unsigned int)CClock::ms_nGameClockHours < nEndHour;
  result = 1;
  if ( CClock::ms_nGameClockHours < v2 && (unsigned int)CClock::ms_nGameClockHours >= nEndHour )
    return 0;
  return result;
}

//----- (003E33C8) --------------------------------------------------------
void CClock::Update()
{
  int v0; // r4
  uint32 v1; // r1
  int v2; // r2
  uint8 v3; // r4
  uint8 v4; // r2
  uint8 v5; // r0

  v0 = 0;
  v1 = CTimer::m_snTimeInMilliseconds;
  if ( (int)(CTimer::m_snTimeInMilliseconds - CClock::ms_nLastClockTick) > (int)CClock::ms_nMillisecondsPerGameMinute )
    v0 = 1;
  v2 = CCheat::m_aCheatsActive[18];
  if ( CCheat::m_aCheatsActive[18] )
    v2 = 1;
  if ( v2 | v0 && !((CCheat::m_aCheatsActive[64] | CCheat::m_aCheatsActive[63]) << 24) )
  {
    v3 = CClock::ms_nGameClockMinutes;
    if ( !CCheat::m_aCheatsActive[18] )
      v1 = CClock::ms_nLastClockTick + CClock::ms_nMillisecondsPerGameMinute;
    CClock::ms_nLastClockTick = v1;
    ++CClock::ms_nGameClockMinutes;
    if ( (unsigned __int8)(v3 + 1) >= 0x3Cu )
    {
      CClock::ms_nGameClockMinutes = 0;
      if ( ++CClock::ms_nGameClockHours >= 0x18u )
      {
        CClock::ms_nGameClockHours = 0;
        ++CClock::ms_nGameClockDays;
        v4 = CClock::CurrentDay + 1;
        if ( CClock::CurrentDay == 7 )
          v4 = 1;
        CClock::CurrentDay = v4;
        CStats::IncrementStat(0x86u, 1.0);
        if ( CClock::ms_nGameClockDays >= (unsigned int)CClock::daysInMonth[CClock::ms_nGameClockMonths - 1] )
        {
          v5 = CClock::ms_nGameClockMonths + 1;
          if ( (unsigned __int8)(CClock::ms_nGameClockMonths + 1) > 0xCu )
            v5 = 1;
          CClock::ms_nGameClockMonths = v5;
          CClock::ms_nGameClockDays = 1;
        }
      }
    }
  }
  CClock::ms_nGameClockSeconds = 60
                               * (CTimer::m_snTimeInMilliseconds - CClock::ms_nLastClockTick)
                               / CClock::ms_nMillisecondsPerGameMinute;
}
// 3C: using guessed type void *off_3C;

//----- (003E3544) --------------------------------------------------------
void CClock::StoreClock()
{
  CClock::bClockHasBeenStored = 1;
  CClock::ms_Stored_nGameClockMonths = CClock::ms_nGameClockMonths;
  CClock::ms_Stored_nGameClockHours = CClock::ms_nGameClockHours;
  CClock::ms_Stored_nGameClockDays = CClock::ms_nGameClockDays;
  CClock::ms_Stored_nGameClockMinutes = CClock::ms_nGameClockMinutes;
  CClock::ms_Stored_nGameClockSeconds = CClock::ms_nGameClockSeconds;
}

//----- (003E35E8) --------------------------------------------------------
void CClock::RestoreClock()
{
  CClock::ms_nGameClockMonths = CClock::ms_Stored_nGameClockMonths;
  CClock::ms_nGameClockDays = CClock::ms_Stored_nGameClockDays;
  CClock::ms_nGameClockHours = CClock::ms_Stored_nGameClockHours;
  CClock::ms_nGameClockMinutes = CClock::ms_Stored_nGameClockMinutes;
  CClock::ms_nGameClockSeconds = CClock::ms_Stored_nGameClockSeconds;
}

//----- (003E367C) --------------------------------------------------------
void __fastcall CClock::OffsetClockByADay(Bool bForward)
{
  uint8 v1; // r1
  uint8 v2; // r0
  uint8 v3; // r0
  uint8 v4; // r3

  v1 = CClock::ms_nGameClockDays;
  if ( bForward )
  {
    ++CClock::ms_nGameClockDays;
    if ( (unsigned __int8)(v1 + 1) > (unsigned int)CClock::daysInMonth[CClock::ms_nGameClockMonths - 1] )
    {
      v2 = CClock::ms_nGameClockMonths + 1;
      if ( (unsigned __int8)(CClock::ms_nGameClockMonths + 1) > 0xCu )
        v2 = 1;
      CClock::ms_nGameClockMonths = v2;
      CClock::ms_nGameClockDays = 1;
    }
    v3 = CClock::CurrentDay + 1;
    CClock::CurrentDay = v3;
    if ( v3 > 7u )
      v3 = 1;
  }
  else
  {
    if ( !--CClock::ms_nGameClockDays )
    {
      v4 = CClock::ms_nGameClockMonths - 1;
      if ( CClock::ms_nGameClockMonths == 1 )
        v4 = 12;
      CClock::ms_nGameClockMonths = v4;
      CClock::ms_nGameClockDays = CClock::daysInMonth[v4 - 1];
    }
    v3 = --CClock::CurrentDay;
    if ( !CClock::CurrentDay )
      v3 = 7;
  }
  CClock::CurrentDay = v3;
}

//----- (003E376C) --------------------------------------------------------
void __fastcall CControllerConfigManager::MakeControllerActionsBlank(CControllerConfigManager *this)
{
  eContSetOrder *p_m_uiSetOrder; // r6
  e_ControllerAction i; // r5
  eContSetOrder *v4; // r6
  e_ControllerAction j; // r5
  eContSetOrder *v6; // r6
  e_ControllerAction k; // r5
  eContSetOrder *v8; // r6
  e_ControllerAction m; // r5

  p_m_uiSetOrder = &this->ConfigurationForAction[0][0].m_uiSetOrder;
  for ( i = PED_FIREWEAPON; i != NUM_OF_CONTROLLER_ACTIONS; ++i )
  {
    *((_DWORD *)p_m_uiSetOrder - 1) = 1056;
    *p_m_uiSetOrder = NO_ORDER_SET;
    CControllerConfigManager::ResetSettingOrder(this, i);
    p_m_uiSetOrder += 8;
  }
  v4 = &this->ConfigurationForAction[0][1].m_uiSetOrder;
  for ( j = PED_FIREWEAPON; j != NUM_OF_CONTROLLER_ACTIONS; ++j )
  {
    *((_DWORD *)v4 - 1) = 1056;
    *v4 = NO_ORDER_SET;
    CControllerConfigManager::ResetSettingOrder(this, j);
    v4 += 8;
  }
  v6 = &this->ConfigurationForAction[0][2].m_uiSetOrder;
  for ( k = PED_FIREWEAPON; k != NUM_OF_CONTROLLER_ACTIONS; ++k )
  {
    *((_DWORD *)v6 - 1) = 0;
    *v6 = NO_ORDER_SET;
    CControllerConfigManager::ResetSettingOrder(this, k);
    v6 += 8;
  }
  v8 = &this->ConfigurationForAction[0][3].m_uiSetOrder;
  for ( m = PED_FIREWEAPON; m != NUM_OF_CONTROLLER_ACTIONS; ++m )
  {
    *((_DWORD *)v8 - 1) = 0;
    *v8 = NO_ORDER_SET;
    CControllerConfigManager::ResetSettingOrder(this, m);
    v8 += 8;
  }
}

//----- (003E3814) --------------------------------------------------------
void __fastcall CControllerConfigManager::ClearSettingsAssociatedWithAction(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        eControllerType ArrayToEnter)
{
  bool *v3; // r3

  if ( (unsigned int)ArrayToEnter <= JOY_STICK )
  {
    v3 = &this->m_bJoyJustInitialised + 32 * Action + 8 * ArrayToEnter;
    *((_DWORD *)v3 + 3653) = 0;
    *((_DWORD *)v3 + 3652) = *(&off_616CBC + ArrayToEnter);
  }
  CControllerConfigManager::ResetSettingOrder(this, Action);
}
// 616CBC: using guessed type void *off_616CBC;

//----- (003E3850) --------------------------------------------------------
eJOY_BUTTONS __fastcall CControllerConfigManager::GetJoyButtonJustUp(CControllerConfigManager *this)
{
  int m_NewJoyState; // r1

  m_NewJoyState = this->m_NewJoyState;
  if ( (m_NewJoyState & 1) != 0 )
  {
    if ( (m_NewJoyState & 2) != 0 )
      goto LABEL_3;
  }
  else
  {
    if ( LOBYTE(this->m_OldJoyState) << 31 )
      return 1;
    if ( (m_NewJoyState & 2) != 0 )
    {
LABEL_3:
      if ( (m_NewJoyState & 4) != 0 )
        goto LABEL_4;
      goto LABEL_24;
    }
  }
  if ( (this->m_OldJoyState & 2) != 0 )
    return 2;
  if ( (m_NewJoyState & 4) != 0 )
  {
LABEL_4:
    if ( (m_NewJoyState & 8) != 0 )
      goto LABEL_5;
    goto LABEL_27;
  }
LABEL_24:
  if ( (this->m_OldJoyState & 4) != 0 )
    return 3;
  if ( (m_NewJoyState & 8) != 0 )
  {
LABEL_5:
    if ( (m_NewJoyState & 0x10) != 0 )
      goto LABEL_6;
    goto LABEL_30;
  }
LABEL_27:
  if ( (this->m_OldJoyState & 8) != 0 )
    return 4;
  if ( (m_NewJoyState & 0x10) != 0 )
  {
LABEL_6:
    if ( (m_NewJoyState & 0x20) != 0 )
      goto LABEL_7;
    goto LABEL_33;
  }
LABEL_30:
  if ( (this->m_OldJoyState & 0x10) != 0 )
    return 5;
  if ( (m_NewJoyState & 0x20) != 0 )
  {
LABEL_7:
    if ( (m_NewJoyState & 0x40) != 0 )
      goto LABEL_8;
    goto LABEL_36;
  }
LABEL_33:
  if ( (this->m_OldJoyState & 0x20) != 0 )
    return 6;
  if ( (m_NewJoyState & 0x40) != 0 )
  {
LABEL_8:
    if ( (m_NewJoyState & 0x80) != 0 )
      goto LABEL_9;
    goto LABEL_39;
  }
LABEL_36:
  if ( (this->m_OldJoyState & 0x40) != 0 )
    return 7;
  if ( (m_NewJoyState & 0x80) != 0 )
  {
LABEL_9:
    if ( (m_NewJoyState & 0x100) != 0 )
      goto LABEL_10;
    goto LABEL_42;
  }
LABEL_39:
  if ( (this->m_OldJoyState & 0x80) != 0 )
    return 8;
  if ( (m_NewJoyState & 0x100) != 0 )
  {
LABEL_10:
    if ( (m_NewJoyState & 0x200) != 0 )
      goto LABEL_11;
    goto LABEL_45;
  }
LABEL_42:
  if ( BYTE1(this->m_OldJoyState) << 31 )
    return 9;
  if ( (m_NewJoyState & 0x200) != 0 )
  {
LABEL_11:
    if ( (m_NewJoyState & 0x400) != 0 )
      goto LABEL_12;
    goto LABEL_48;
  }
LABEL_45:
  if ( (this->m_OldJoyState & 0x200) != 0 )
    return 10;
  if ( (m_NewJoyState & 0x400) != 0 )
  {
LABEL_12:
    if ( (m_NewJoyState & 0x800) != 0 )
      goto LABEL_13;
    goto LABEL_51;
  }
LABEL_48:
  if ( (this->m_OldJoyState & 0x400) != 0 )
    return 11;
  if ( (m_NewJoyState & 0x800) != 0 )
  {
LABEL_13:
    if ( (m_NewJoyState & 0x1000) != 0 )
      goto LABEL_14;
    goto LABEL_54;
  }
LABEL_51:
  if ( (this->m_OldJoyState & 0x800) != 0 )
    return 12;
  if ( (m_NewJoyState & 0x1000) != 0 )
  {
LABEL_14:
    if ( (m_NewJoyState & 0x2000) != 0 )
      goto LABEL_15;
LABEL_57:
    if ( (this->m_OldJoyState & 0x2000) != 0 )
      return 14;
    if ( (m_NewJoyState & 0x4000) != 0 )
      goto LABEL_16;
    goto LABEL_60;
  }
LABEL_54:
  if ( (this->m_OldJoyState & 0x1000) != 0 )
    return 13;
  if ( (m_NewJoyState & 0x2000) == 0 )
    goto LABEL_57;
LABEL_15:
  if ( (m_NewJoyState & 0x4000) != 0 )
  {
LABEL_16:
    if ( (m_NewJoyState & 0x8000) != 0 )
      return 0;
    goto LABEL_63;
  }
LABEL_60:
  if ( (this->m_OldJoyState & 0x4000) != 0 )
    return 15;
  if ( (m_NewJoyState & 0x8000) != 0 )
    return 0;
LABEL_63:
  if ( (this->m_OldJoyState & 0x8000) != 0 )
    return 16;
  else
    return 0;
}

//----- (003E3978) --------------------------------------------------------
eJOY_BUTTONS __fastcall CControllerConfigManager::GetJoyButtonJustDown(CControllerConfigManager *this)
{
  int m_NewJoyState; // r1

  m_NewJoyState = this->m_NewJoyState;
  if ( (m_NewJoyState & 1) != 0 )
  {
    if ( !(LOBYTE(this->m_OldJoyState) << 31) )
      return 1;
    if ( (m_NewJoyState & 2) == 0 )
    {
LABEL_3:
      if ( (m_NewJoyState & 4) == 0 )
        goto LABEL_4;
      goto LABEL_24;
    }
  }
  else if ( (m_NewJoyState & 2) == 0 )
  {
    goto LABEL_3;
  }
  if ( (this->m_OldJoyState & 2) == 0 )
    return 2;
  if ( (m_NewJoyState & 4) == 0 )
  {
LABEL_4:
    if ( (m_NewJoyState & 8) == 0 )
      goto LABEL_5;
    goto LABEL_27;
  }
LABEL_24:
  if ( (this->m_OldJoyState & 4) == 0 )
    return 3;
  if ( (m_NewJoyState & 8) == 0 )
  {
LABEL_5:
    if ( (m_NewJoyState & 0x10) == 0 )
      goto LABEL_6;
    goto LABEL_30;
  }
LABEL_27:
  if ( (this->m_OldJoyState & 8) == 0 )
    return 4;
  if ( (m_NewJoyState & 0x10) == 0 )
  {
LABEL_6:
    if ( (m_NewJoyState & 0x20) == 0 )
      goto LABEL_7;
    goto LABEL_33;
  }
LABEL_30:
  if ( (this->m_OldJoyState & 0x10) == 0 )
    return 5;
  if ( (m_NewJoyState & 0x20) == 0 )
  {
LABEL_7:
    if ( (m_NewJoyState & 0x40) == 0 )
      goto LABEL_8;
    goto LABEL_36;
  }
LABEL_33:
  if ( (this->m_OldJoyState & 0x20) == 0 )
    return 6;
  if ( (m_NewJoyState & 0x40) == 0 )
  {
LABEL_8:
    if ( (m_NewJoyState & 0x80) == 0 )
      goto LABEL_9;
    goto LABEL_39;
  }
LABEL_36:
  if ( (this->m_OldJoyState & 0x40) == 0 )
    return 7;
  if ( (m_NewJoyState & 0x80) == 0 )
  {
LABEL_9:
    if ( (m_NewJoyState & 0x100) == 0 )
      goto LABEL_10;
    goto LABEL_42;
  }
LABEL_39:
  if ( (this->m_OldJoyState & 0x80) == 0 )
    return 8;
  if ( (m_NewJoyState & 0x100) == 0 )
  {
LABEL_10:
    if ( (m_NewJoyState & 0x200) == 0 )
      goto LABEL_11;
    goto LABEL_45;
  }
LABEL_42:
  if ( !(BYTE1(this->m_OldJoyState) << 31) )
    return 9;
  if ( (m_NewJoyState & 0x200) == 0 )
  {
LABEL_11:
    if ( (m_NewJoyState & 0x400) == 0 )
      goto LABEL_12;
    goto LABEL_48;
  }
LABEL_45:
  if ( (this->m_OldJoyState & 0x200) == 0 )
    return 10;
  if ( (m_NewJoyState & 0x400) == 0 )
  {
LABEL_12:
    if ( (m_NewJoyState & 0x800) == 0 )
      goto LABEL_13;
    goto LABEL_51;
  }
LABEL_48:
  if ( (this->m_OldJoyState & 0x400) == 0 )
    return 11;
  if ( (m_NewJoyState & 0x800) == 0 )
  {
LABEL_13:
    if ( (m_NewJoyState & 0x1000) == 0 )
      goto LABEL_14;
    goto LABEL_54;
  }
LABEL_51:
  if ( (this->m_OldJoyState & 0x800) == 0 )
    return 12;
  if ( (m_NewJoyState & 0x1000) == 0 )
  {
LABEL_14:
    if ( (m_NewJoyState & 0x2000) == 0 )
      goto LABEL_15;
LABEL_57:
    if ( (this->m_OldJoyState & 0x2000) == 0 )
      return 14;
    if ( (m_NewJoyState & 0x4000) == 0 )
      goto LABEL_16;
    goto LABEL_60;
  }
LABEL_54:
  if ( (this->m_OldJoyState & 0x1000) == 0 )
    return 13;
  if ( (m_NewJoyState & 0x2000) != 0 )
    goto LABEL_57;
LABEL_15:
  if ( (m_NewJoyState & 0x4000) == 0 )
  {
LABEL_16:
    if ( (m_NewJoyState & 0x8000) == 0 )
      return 0;
    goto LABEL_63;
  }
LABEL_60:
  if ( (this->m_OldJoyState & 0x4000) == 0 )
    return 15;
  if ( (m_NewJoyState & 0x8000) == 0 )
    return 0;
LABEL_63:
  if ( (this->m_OldJoyState & 0x8000) != 0 )
    return 0;
  else
    return 16;
}

//----- (003E3AA0) --------------------------------------------------------
void __fastcall CControllerConfigManager::SaveSettings(CControllerConfigManager *this, int FileHandle)
{
  bool v3; // cc
  unsigned __int8 pData[4]; // [sp+4h] [bp-14h] BYREF

  if ( FileHandle )
  {
    *(_DWORD *)pData = 0;
    do
    {
      CFileMgr::Write(FileHandle, pData, 4);
      CFileMgr::Write(
        FileHandle,
        (unsigned __int8 *)&ControlsManager.m_bStickL_X_Rgh_Lft_MovementBothDown[32 * *(_DWORD *)pData - 5824],
        8);
      v3 = (*(_DWORD *)pData)++ < 181;
    }
    while ( v3 );
    *(_DWORD *)pData = 0;
    do
    {
      CFileMgr::Write(FileHandle, pData, 4);
      CFileMgr::Write(
        FileHandle,
        (unsigned __int8 *)&ControlsManager.m_bStickL_X_Rgh_Lft_MovementBothDown[32 * *(_DWORD *)pData - 5816],
        8);
      v3 = (*(_DWORD *)pData)++ < 181;
    }
    while ( v3 );
    *(_DWORD *)pData = 0;
    do
    {
      CFileMgr::Write(FileHandle, pData, 4);
      CFileMgr::Write(
        FileHandle,
        (unsigned __int8 *)&ControlsManager.m_bStickL_X_Rgh_Lft_MovementBothDown[32 * *(_DWORD *)pData - 5808],
        8);
      v3 = (*(_DWORD *)pData)++ < 181;
    }
    while ( v3 );
    *(_DWORD *)pData = 0;
    do
    {
      CFileMgr::Write(FileHandle, pData, 4);
      CFileMgr::Write(
        FileHandle,
        (unsigned __int8 *)&ControlsManager.m_bStickL_X_Rgh_Lft_MovementBothDown[32 * *(_DWORD *)pData - 5800],
        8);
      v3 = (*(_DWORD *)pData)++ < 181;
    }
    while ( v3 );
  }
}

//----- (003E3BA8) --------------------------------------------------------
bool __fastcall CControllerConfigManager::LoadSettings(CControllerConfigManager *this, int FileHandle)
{
  int v3; // r6
  int v4; // r6
  int v5; // r6
  int v6; // r6
  int v7; // r5
  int i; // r5
  int j; // r5
  int k; // r5
  int buffer; // [sp+4h] [bp-4Ch] BYREF
  unsigned __int8 pData[4]; // [sp+8h] [bp-48h] BYREF

  buffer = 0;
  if ( !FileHandle )
    return 1;
  CFileMgr::ReadBytes(FileHandle, pData, 29);
  if ( !strncmp((const char *)pData, (const char *)TopLineEmptyFile, 0x1Au) )
    return 1;
  CFileMgr::Seek(FileHandle, 0, 0);
  OS_FileRead((OSFile)FileHandle, &buffer, 4);
  if ( buffer < 8 )
    return 1;
  *(_DWORD *)pData = 0;
  v3 = -1;
  while ( 1 )
  {
    OS_FileRead((OSFile)FileHandle, pData, 4);
    if ( ++v3 != *(_DWORD *)pData )
      break;
    CFileMgr::Seek(FileHandle, 8, 1);
    if ( v3 >= 181 )
    {
      v4 = -1;
      while ( 1 )
      {
        OS_FileRead((OSFile)FileHandle, pData, 4);
        if ( ++v4 != *(_DWORD *)pData )
          break;
        CFileMgr::Seek(FileHandle, 8, 1);
        if ( v4 >= 181 )
        {
          v5 = -1;
          while ( 1 )
          {
            OS_FileRead((OSFile)FileHandle, pData, 4);
            if ( ++v5 != *(_DWORD *)pData )
              break;
            CFileMgr::Seek(FileHandle, 8, 1);
            if ( v5 >= 181 )
            {
              v6 = -1;
              while ( 1 )
              {
                OS_FileRead((OSFile)FileHandle, pData, 4);
                if ( ++v6 != *(_DWORD *)pData )
                  break;
                CFileMgr::Seek(FileHandle, 8, 1);
                if ( v6 >= 181 )
                {
                  v7 = 0;
                  CFileMgr::Seek(FileHandle, 4, 0);
                  CControllerConfigManager::MakeControllerActionsBlank(&ControlsManager);
                  do
                  {
                    CFileMgr::Seek(FileHandle, 4, 1);
                    OS_FileRead((OSFile)FileHandle, ControlsManager.ConfigurationForAction[v7++], 8);
                  }
                  while ( v7 != 182 );
                  for ( i = 0; i != 182; ++i )
                  {
                    CFileMgr::Seek(FileHandle, 4, 1);
                    OS_FileRead((OSFile)FileHandle, &ControlsManager.ConfigurationForAction[i][1], 8);
                  }
                  for ( j = 0; j != 182; ++j )
                  {
                    CFileMgr::Seek(FileHandle, 4, 1);
                    OS_FileRead((OSFile)FileHandle, &ControlsManager.ConfigurationForAction[j][2], 8);
                  }
                  for ( k = 0; k != 182; ++k )
                  {
                    CFileMgr::Seek(FileHandle, 4, 1);
                    OS_FileRead((OSFile)FileHandle, &ControlsManager.ConfigurationForAction[k][3], 8);
                  }
                  if ( !ControlsManager.ConfigurationForAction[0][3].m_uiActionInitiator )
                    CControllerConfigManager::InitDefaultControlConfigJoyPad(&ControlsManager, 0x20u);
                  return 1;
                }
              }
              return 0;
            }
          }
          return 0;
        }
      }
      return 0;
    }
  }
  return 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003E3DD0) --------------------------------------------------------
void __fastcall CControllerConfigManager::InitDefaultControlConfigJoyPad(
        CControllerConfigManager *this,
        UInt32 NumButtons)
{
  bool v3; // zf
  UInt32 v4; // r2
  UInt32 v5; // r1
  int v6; // r6
  UInt32 v7; // r3
  int v8; // r0
  eContSetOrder v9; // r0
  UInt32 v10; // r5
  UInt32 v11; // r2
  UInt32 v12; // r12
  int v13; // r1
  UInt32 v14; // r3
  int v15; // r0
  int v16; // r6
  eContSetOrder v17; // r0
  int v18; // r5
  UInt32 v19; // r2
  UInt32 v20; // r0
  UInt32 v21; // r1
  UInt32 v22; // r12
  eContSetOrder v23; // r0
  UInt32 v24; // r2
  UInt32 v25; // r1
  int v26; // r6
  UInt32 v27; // r3
  int v28; // r0
  eContSetOrder v29; // r0
  UInt32 v30; // r5
  UInt32 v31; // r2
  UInt32 v32; // r12
  int v33; // r1
  UInt32 v34; // r3
  int v35; // r0
  int v36; // r6
  eContSetOrder v37; // r0
  int v38; // r5
  UInt32 v39; // r2
  UInt32 v40; // r0
  UInt32 v41; // r1
  UInt32 v42; // r12
  eContSetOrder v43; // r0
  UInt32 v44; // r5
  UInt32 v45; // r2
  UInt32 v46; // r12
  int v47; // r1
  UInt32 v48; // r3
  int v49; // r0
  int v50; // r6
  eContSetOrder v51; // r0
  int v52; // r5
  UInt32 v53; // r2
  UInt32 v54; // r0
  UInt32 v55; // r1
  UInt32 v56; // r12
  eContSetOrder v57; // r0
  UInt32 v58; // r5
  UInt32 v59; // r2
  UInt32 v60; // r12
  int v61; // r1
  UInt32 v62; // r3
  int v63; // r0
  int v64; // r6
  eContSetOrder v65; // r0
  int v66; // r5
  UInt32 v67; // r2
  UInt32 v68; // r0
  UInt32 v69; // r1
  UInt32 v70; // r12
  eContSetOrder v71; // r0
  UInt32 v72; // r2
  UInt32 v73; // r1
  int v74; // r6
  UInt32 v75; // r3
  int v76; // r0
  eContSetOrder v77; // r0
  UInt32 v78; // r5
  UInt32 v79; // r2
  UInt32 v80; // r12
  int v81; // r1
  UInt32 v82; // r3
  int v83; // r0
  int v84; // r6
  eContSetOrder v85; // r0
  int v86; // r5
  UInt32 v87; // r2
  UInt32 v88; // r0
  UInt32 v89; // r1
  UInt32 v90; // r12
  eContSetOrder v91; // r0
  UInt32 v92; // r5
  UInt32 v93; // r2
  UInt32 v94; // r1
  int v95; // r6
  UInt32 v96; // r3
  int v97; // r0
  int v98; // r9
  eContSetOrder v99; // r0
  int v100; // r5
  UInt32 v101; // r0
  UInt32 v102; // r1
  UInt32 v103; // r3
  int v104; // r6
  int v105; // r2
  eContSetOrder v106; // r0
  UInt32 v107; // r2
  UInt32 v108; // r0
  UInt32 v109; // r1
  UInt32 v110; // r6
  eContSetOrder v111; // r0
  UInt32 v112; // r5
  UInt32 v113; // r2
  UInt32 v114; // r12
  int v115; // r1
  UInt32 v116; // r3
  int v117; // r0
  int v118; // r6
  eContSetOrder v119; // r0
  int v120; // r5
  UInt32 v121; // r2
  UInt32 v122; // r0
  UInt32 v123; // r1
  UInt32 v124; // r12
  eContSetOrder v125; // r0
  UInt32 v126; // r5
  UInt32 v127; // r2
  UInt32 v128; // r12
  int v129; // r1
  UInt32 v130; // r3
  int v131; // r0
  int v132; // r6
  eContSetOrder v133; // r0
  int v134; // r5
  UInt32 v135; // r2
  UInt32 v136; // r0
  UInt32 v137; // r1
  UInt32 v138; // r12
  eContSetOrder v139; // r0
  UInt32 v140; // r5
  UInt32 v141; // r2
  UInt32 v142; // r1
  int v143; // r6
  UInt32 v144; // r3
  int v145; // r0
  int v146; // r9
  eContSetOrder v147; // r0
  int v148; // r5
  UInt32 v149; // r0
  UInt32 v150; // r1
  UInt32 v151; // r3
  int v152; // r6
  int v153; // r2
  eContSetOrder v154; // r0
  UInt32 v155; // r2
  UInt32 v156; // r0
  UInt32 v157; // r1
  UInt32 v158; // r6
  eContSetOrder v159; // r0
  UInt32 v160; // r5
  UInt32 v161; // r2
  UInt32 v162; // r1
  int v163; // r6
  UInt32 v164; // r3
  int v165; // r0
  int v166; // r9
  eContSetOrder v167; // r0
  int v168; // r5
  UInt32 v169; // r0
  UInt32 v170; // r1
  UInt32 v171; // r3
  int v172; // r6
  int v173; // r2
  eContSetOrder v174; // r0
  UInt32 v175; // r2
  UInt32 v176; // r0
  UInt32 v177; // r1
  UInt32 v178; // r6
  eContSetOrder v179; // r0
  int v180; // r9
  UInt32 v181; // r6
  UInt32 v182; // r2
  UInt32 v183; // r12
  int v184; // r1
  UInt32 v185; // r3
  int v186; // r0
  int v187; // r6
  eContSetOrder v188; // r0
  UInt32 v189; // r2
  UInt32 v190; // r0
  UInt32 v191; // r1
  UInt32 v192; // r5
  eContSetOrder v193; // r0
  UInt32 v194; // r6
  int v195; // r5
  UInt32 v196; // r1
  UInt32 v197; // r2
  UInt32 v198; // r3
  int v199; // r0
  int v200; // r0
  int v201; // r1
  UInt32 m_uiActionInitiator; // r2
  UInt32 v203; // r1
  int v204; // r6
  UInt32 v205; // r3
  int v206; // r0
  eContSetOrder v207; // r0
  UInt32 v208; // r5
  UInt32 v209; // r2
  UInt32 v210; // r12
  int v211; // r1
  UInt32 v212; // r3
  int v213; // r0
  int v214; // r6
  eContSetOrder v215; // r0
  int v216; // r5
  UInt32 v217; // r2
  UInt32 v218; // r0
  UInt32 v219; // r1
  UInt32 v220; // r12
  eContSetOrder v221; // r0
  UInt32 v222; // r2
  UInt32 v223; // r1
  int v224; // r6
  UInt32 v225; // r3
  int v226; // r0
  eContSetOrder v227; // r0
  UInt32 v228; // r5
  UInt32 v229; // r2
  UInt32 v230; // r12
  int v231; // r1
  UInt32 v232; // r3
  int v233; // r0
  int v234; // r6
  eContSetOrder v235; // r0
  int v236; // r5
  UInt32 v237; // r2
  UInt32 v238; // r0
  UInt32 v239; // r1
  UInt32 v240; // r12
  eContSetOrder v241; // r0
  UInt32 v242; // r5
  UInt32 v243; // r2
  UInt32 v244; // r12
  int v245; // r1
  UInt32 v246; // r3
  int v247; // r0
  int v248; // r6
  eContSetOrder v249; // r0
  int v250; // r5
  UInt32 v251; // r2
  UInt32 v252; // r0
  UInt32 v253; // r1
  UInt32 v254; // r12
  eContSetOrder v255; // r0
  UInt32 v256; // r5
  UInt32 v257; // r2
  UInt32 v258; // r12
  int v259; // r1
  UInt32 v260; // r3
  int v261; // r0
  int v262; // r6
  eContSetOrder v263; // r0
  int v264; // r5
  UInt32 v265; // r2
  UInt32 v266; // r0
  UInt32 v267; // r1
  UInt32 v268; // r12
  eContSetOrder v269; // r0
  UInt32 v270; // r2
  UInt32 v271; // r1
  int v272; // r6
  UInt32 v273; // r3
  int v274; // r0
  eContSetOrder v275; // r0
  UInt32 v276; // r5
  UInt32 v277; // r2
  UInt32 v278; // r12
  int v279; // r1
  UInt32 v280; // r3
  int v281; // r0
  int v282; // r6
  eContSetOrder v283; // r0
  int v284; // r5
  UInt32 v285; // r2
  UInt32 v286; // r0
  UInt32 v287; // r1
  UInt32 v288; // r12
  eContSetOrder v289; // r0
  UInt32 v290; // r5
  UInt32 v291; // r2
  UInt32 v292; // r1
  int v293; // r6
  UInt32 v294; // r3
  int v295; // r0
  int v296; // r9
  eContSetOrder v297; // r0
  int v298; // r5
  UInt32 v299; // r0
  UInt32 v300; // r1
  UInt32 v301; // r3
  int v302; // r6
  int v303; // r2
  eContSetOrder v304; // r0
  UInt32 v305; // r2
  UInt32 v306; // r0
  UInt32 v307; // r1
  UInt32 v308; // r6
  eContSetOrder v309; // r0
  UInt32 v310; // r5
  UInt32 v311; // r2
  UInt32 v312; // r12
  int v313; // r1
  UInt32 v314; // r3
  int v315; // r0
  int v316; // r6
  eContSetOrder v317; // r0
  int v318; // r5
  UInt32 v319; // r2
  UInt32 v320; // r0
  UInt32 v321; // r1
  UInt32 v322; // r12
  eContSetOrder v323; // r0
  UInt32 v324; // r5
  UInt32 v325; // r2
  UInt32 v326; // r12
  int v327; // r1
  UInt32 v328; // r3
  int v329; // r0
  int v330; // r6
  eContSetOrder v331; // r0
  int v332; // r5
  UInt32 v333; // r2
  UInt32 v334; // r0
  UInt32 v335; // r1
  UInt32 v336; // r12
  eContSetOrder v337; // r0
  UInt32 v338; // r2
  UInt32 v339; // r1
  int v340; // r6
  UInt32 v341; // r3
  int v342; // r0
  eContSetOrder v343; // r0
  UInt32 v344; // r5
  UInt32 v345; // r2
  UInt32 v346; // r1
  int v347; // r6
  UInt32 v348; // r3
  int v349; // r0
  int v350; // r9
  eContSetOrder v351; // r0
  int v352; // r5
  UInt32 v353; // r0
  UInt32 v354; // r1
  UInt32 v355; // r3
  int v356; // r6
  int v357; // r2
  eContSetOrder v358; // r0
  UInt32 v359; // r2
  UInt32 v360; // r0
  UInt32 v361; // r1
  UInt32 v362; // r6
  eContSetOrder v363; // r0
  UInt32 v364; // r5
  UInt32 v365; // r2
  UInt32 v366; // r1
  int v367; // r6
  UInt32 v368; // r3
  int v369; // r0
  int v370; // r9
  eContSetOrder v371; // r0
  int v372; // r5
  UInt32 v373; // r0
  UInt32 v374; // r1
  UInt32 v375; // r3
  int v376; // r6
  int v377; // r2
  eContSetOrder v378; // r0
  UInt32 v379; // r2
  UInt32 v380; // r0
  UInt32 v381; // r1
  UInt32 v382; // r6
  eContSetOrder v383; // r0
  int v384; // r8
  UInt32 v385; // r2
  int v386; // r6
  UInt32 v387; // r12
  int v388; // r1
  UInt32 v389; // r3
  int v390; // r0
  eContSetOrder v391; // r0
  UInt32 v392; // r2
  UInt32 v393; // r0
  UInt32 v394; // r1
  UInt32 v395; // r5

  this->m_bJoyJustInitialised = 1;
  if ( NumButtons >= 0x10 )
    LOBYTE(NumButtons) = 16;
  v3 = AllValidWinJoys.JoyStickNum[0].wVendorID == 13351;
  if ( AllValidWinJoys.JoyStickNum[0].wVendorID == 13351 )
    v3 = AllValidWinJoys.JoyStickNum[0].wProductID == 4496;
  if ( !v3 )
  {
    switch ( NumButtons & 0x1F )
    {
      case 1u:
        goto LABEL_486;
      case 2u:
        goto LABEL_461;
      case 3u:
        goto LABEL_436;
      case 4u:
        goto LABEL_427;
      case 5u:
        goto LABEL_410;
      case 6u:
        goto LABEL_393;
      case 7u:
        goto LABEL_368;
      case 8u:
        goto LABEL_351;
      case 9u:
        goto LABEL_342;
      case 0xAu:
        goto LABEL_325;
      case 0xBu:
      case 0xCu:
        goto LABEL_308;
      case 0xDu:
        goto LABEL_291;
      case 0xEu:
        goto LABEL_282;
      case 0xFu:
        goto LABEL_265;
      case 0x10u:
        CControllerConfigManager::ResetSettingOrder(this, CONVERSATION_NO);
        m_uiActionInitiator = this->ConfigurationForAction[48][1].m_uiActionInitiator;
        v3 = this->ConfigurationForAction[48][0].m_uiActionInitiator == 1056;
        v203 = this->ConfigurationForAction[48][3].m_uiActionInitiator;
        v204 = 1;
        v205 = this->ConfigurationForAction[48][2].m_uiActionInitiator;
        this->ConfigurationForAction[48][3].m_uiActionInitiator = 16;
        v206 = 0;
        if ( !v3 )
        {
          v206 = 1;
          v204 = 2;
        }
        if ( m_uiActionInitiator == 1056 )
          v204 = v206;
        if ( v205 )
          ++v204;
        v207 = v204 + 1;
        if ( v203 )
          v207 = v204 + 2;
        this->ConfigurationForAction[48][3].m_uiSetOrder = v207;
LABEL_265:
        CControllerConfigManager::ResetSettingOrder(this, GROUP_CONTROL_BWD);
        v208 = this->ConfigurationForAction[50][0].m_uiActionInitiator;
        v209 = this->ConfigurationForAction[50][1].m_uiActionInitiator;
        v210 = this->ConfigurationForAction[50][3].m_uiActionInitiator;
        v211 = 1;
        v212 = this->ConfigurationForAction[50][2].m_uiActionInitiator;
        this->ConfigurationForAction[50][3].m_uiActionInitiator = 15;
        v213 = 0;
        if ( v208 != 1056 )
        {
          v213 = 1;
          v211 = 2;
        }
        v214 = 0;
        if ( v209 == 1056 )
          v211 = v213;
        if ( v212 )
          ++v211;
        v215 = v211 + 1;
        v216 = 1;
        if ( v210 )
          v215 = v211 + 2;
        this->ConfigurationForAction[50][3].m_uiSetOrder = v215;
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_RADIO_STATION_DOWN);
        v217 = this->ConfigurationForAction[27][0].m_uiActionInitiator;
        v218 = this->ConfigurationForAction[27][1].m_uiActionInitiator;
        v219 = this->ConfigurationForAction[27][2].m_uiActionInitiator;
        v220 = this->ConfigurationForAction[27][3].m_uiActionInitiator;
        this->ConfigurationForAction[27][3].m_uiActionInitiator = 15;
        if ( v217 != 1056 )
        {
          v214 = 1;
          v216 = 2;
        }
        if ( v218 == 1056 )
          v216 = v214;
        if ( v219 )
          ++v216;
        v221 = v216 + 1;
        if ( v220 )
          v221 = v216 + 2;
        this->ConfigurationForAction[27][3].m_uiSetOrder = v221;
LABEL_282:
        CControllerConfigManager::ResetSettingOrder(this, CONVERSATION_YES);
        v222 = this->ConfigurationForAction[47][1].m_uiActionInitiator;
        v3 = this->ConfigurationForAction[47][0].m_uiActionInitiator == 1056;
        v223 = this->ConfigurationForAction[47][3].m_uiActionInitiator;
        v224 = 1;
        v225 = this->ConfigurationForAction[47][2].m_uiActionInitiator;
        this->ConfigurationForAction[47][3].m_uiActionInitiator = 14;
        v226 = 0;
        if ( !v3 )
        {
          v226 = 1;
          v224 = 2;
        }
        if ( v222 == 1056 )
          v224 = v226;
        if ( v225 )
          ++v224;
        v227 = v224 + 1;
        if ( v223 )
          v227 = v224 + 2;
        this->ConfigurationForAction[47][3].m_uiSetOrder = v227;
LABEL_291:
        CControllerConfigManager::ResetSettingOrder(this, GROUP_CONTROL_FWD);
        v228 = this->ConfigurationForAction[49][0].m_uiActionInitiator;
        v229 = this->ConfigurationForAction[49][1].m_uiActionInitiator;
        v230 = this->ConfigurationForAction[49][3].m_uiActionInitiator;
        v231 = 1;
        v232 = this->ConfigurationForAction[49][2].m_uiActionInitiator;
        this->ConfigurationForAction[49][3].m_uiActionInitiator = 13;
        v233 = 0;
        if ( v228 != 1056 )
        {
          v233 = 1;
          v231 = 2;
        }
        v234 = 0;
        if ( v229 == 1056 )
          v231 = v233;
        if ( v232 )
          ++v231;
        v235 = v231 + 1;
        v236 = 1;
        if ( v230 )
          v235 = v231 + 2;
        this->ConfigurationForAction[49][3].m_uiSetOrder = v235;
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_RADIO_STATION_UP);
        v237 = this->ConfigurationForAction[26][0].m_uiActionInitiator;
        v238 = this->ConfigurationForAction[26][1].m_uiActionInitiator;
        v239 = this->ConfigurationForAction[26][2].m_uiActionInitiator;
        v240 = this->ConfigurationForAction[26][3].m_uiActionInitiator;
        this->ConfigurationForAction[26][3].m_uiActionInitiator = 13;
        if ( v237 != 1056 )
        {
          v234 = 1;
          v236 = 2;
        }
        if ( v238 == 1056 )
          v236 = v234;
        if ( v239 )
          ++v236;
        v241 = v236 + 1;
        if ( v240 )
          v241 = v236 + 2;
        this->ConfigurationForAction[26][3].m_uiSetOrder = v241;
LABEL_308:
        CControllerConfigManager::ResetSettingOrder(this, PED_LOOKBEHIND);
        v242 = this->ConfigurationForAction[14][0].m_uiActionInitiator;
        v243 = this->ConfigurationForAction[14][1].m_uiActionInitiator;
        v244 = this->ConfigurationForAction[14][3].m_uiActionInitiator;
        v245 = 1;
        v246 = this->ConfigurationForAction[14][2].m_uiActionInitiator;
        this->ConfigurationForAction[14][3].m_uiActionInitiator = 11;
        v247 = 0;
        if ( v242 != 1056 )
        {
          v247 = 1;
          v245 = 2;
        }
        v248 = 0;
        if ( v243 == 1056 )
          v245 = v247;
        if ( v246 )
          ++v245;
        v249 = v245 + 1;
        v250 = 1;
        if ( v244 )
          v249 = v245 + 2;
        this->ConfigurationForAction[14][3].m_uiSetOrder = v249;
        CControllerConfigManager::ResetSettingOrder(this, TOGGLE_SUBMISSIONS);
        v251 = this->ConfigurationForAction[30][0].m_uiActionInitiator;
        v252 = this->ConfigurationForAction[30][1].m_uiActionInitiator;
        v253 = this->ConfigurationForAction[30][2].m_uiActionInitiator;
        v254 = this->ConfigurationForAction[30][3].m_uiActionInitiator;
        this->ConfigurationForAction[30][3].m_uiActionInitiator = 11;
        if ( v251 != 1056 )
        {
          v248 = 1;
          v250 = 2;
        }
        if ( v252 == 1056 )
          v250 = v248;
        if ( v253 )
          ++v250;
        v255 = v250 + 1;
        if ( v254 )
          v255 = v250 + 2;
        this->ConfigurationForAction[30][3].m_uiSetOrder = v255;
LABEL_325:
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_HORN);
        v256 = this->ConfigurationForAction[29][0].m_uiActionInitiator;
        v257 = this->ConfigurationForAction[29][1].m_uiActionInitiator;
        v258 = this->ConfigurationForAction[29][3].m_uiActionInitiator;
        v259 = 1;
        v260 = this->ConfigurationForAction[29][2].m_uiActionInitiator;
        this->ConfigurationForAction[29][3].m_uiActionInitiator = 10;
        v261 = 0;
        if ( v256 != 1056 )
        {
          v261 = 1;
          v259 = 2;
        }
        v262 = 0;
        if ( v257 == 1056 )
          v259 = v261;
        if ( v260 )
          ++v259;
        v263 = v259 + 1;
        v264 = 1;
        if ( v258 )
          v263 = v259 + 2;
        this->ConfigurationForAction[29][3].m_uiSetOrder = v263;
        CControllerConfigManager::ResetSettingOrder(this, PED_DUCK);
        v265 = this->ConfigurationForAction[15][0].m_uiActionInitiator;
        v266 = this->ConfigurationForAction[15][1].m_uiActionInitiator;
        v267 = this->ConfigurationForAction[15][2].m_uiActionInitiator;
        v268 = this->ConfigurationForAction[15][3].m_uiActionInitiator;
        this->ConfigurationForAction[15][3].m_uiActionInitiator = 10;
        if ( v265 != 1056 )
        {
          v262 = 1;
          v264 = 2;
        }
        if ( v266 == 1056 )
          v264 = v262;
        if ( v267 )
          ++v264;
        v269 = v264 + 1;
        if ( v268 )
          v269 = v264 + 2;
        this->ConfigurationForAction[15][3].m_uiSetOrder = v269;
LABEL_342:
        CControllerConfigManager::ResetSettingOrder(this, CAMERA_CHANGE_VIEW_ALL_SITUATIONS);
        v270 = this->ConfigurationForAction[11][1].m_uiActionInitiator;
        v3 = this->ConfigurationForAction[11][0].m_uiActionInitiator == 1056;
        v271 = this->ConfigurationForAction[11][3].m_uiActionInitiator;
        v272 = 1;
        v273 = this->ConfigurationForAction[11][2].m_uiActionInitiator;
        this->ConfigurationForAction[11][3].m_uiActionInitiator = 9;
        v274 = 0;
        if ( !v3 )
        {
          v274 = 1;
          v272 = 2;
        }
        if ( v270 == 1056 )
          v272 = v274;
        if ( v273 )
          ++v272;
        v275 = v272 + 1;
        if ( v271 )
          v275 = v272 + 2;
        this->ConfigurationForAction[11][3].m_uiSetOrder = v275;
LABEL_351:
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_HANDBRAKE);
        v276 = this->ConfigurationForAction[31][0].m_uiActionInitiator;
        v277 = this->ConfigurationForAction[31][1].m_uiActionInitiator;
        v278 = this->ConfigurationForAction[31][3].m_uiActionInitiator;
        v279 = 1;
        v280 = this->ConfigurationForAction[31][2].m_uiActionInitiator;
        this->ConfigurationForAction[31][3].m_uiActionInitiator = 8;
        v281 = 0;
        if ( v276 != 1056 )
        {
          v281 = 1;
          v279 = 2;
        }
        v282 = 0;
        if ( v277 == 1056 )
          v279 = v281;
        if ( v280 )
          ++v279;
        v283 = v279 + 1;
        v284 = 1;
        if ( v278 )
          v283 = v279 + 2;
        this->ConfigurationForAction[31][3].m_uiSetOrder = v283;
        CControllerConfigManager::ResetSettingOrder(this, PED_LOCK_TARGET);
        v285 = this->ConfigurationForAction[45][0].m_uiActionInitiator;
        v286 = this->ConfigurationForAction[45][1].m_uiActionInitiator;
        v287 = this->ConfigurationForAction[45][2].m_uiActionInitiator;
        v288 = this->ConfigurationForAction[45][3].m_uiActionInitiator;
        this->ConfigurationForAction[45][3].m_uiActionInitiator = 8;
        if ( v285 != 1056 )
        {
          v282 = 1;
          v284 = 2;
        }
        if ( v286 == 1056 )
          v284 = v282;
        if ( v287 )
          ++v284;
        v289 = v284 + 1;
        if ( v288 )
          v289 = v284 + 2;
        this->ConfigurationForAction[45][3].m_uiSetOrder = v289;
LABEL_368:
        CControllerConfigManager::ResetSettingOrder(this, PED_ANSWER_PHONE);
        v290 = this->ConfigurationForAction[16][0].m_uiActionInitiator;
        v291 = this->ConfigurationForAction[16][1].m_uiActionInitiator;
        v292 = this->ConfigurationForAction[16][3].m_uiActionInitiator;
        v293 = 1;
        v294 = this->ConfigurationForAction[16][2].m_uiActionInitiator;
        this->ConfigurationForAction[16][3].m_uiActionInitiator = 7;
        v295 = 0;
        if ( v290 != 1056 )
        {
          v295 = 1;
          v293 = 2;
        }
        v296 = 0;
        if ( v291 == 1056 )
          v293 = v295;
        if ( v294 )
          ++v293;
        v297 = v293 + 1;
        if ( v292 )
          v297 = v293 + 2;
        v298 = 1;
        this->ConfigurationForAction[16][3].m_uiSetOrder = v297;
        CControllerConfigManager::ResetSettingOrder(this, PED_FIREWEAPON_ALT);
        v299 = this->ConfigurationForAction[1][2].m_uiActionInitiator;
        v300 = this->ConfigurationForAction[1][1].m_uiActionInitiator;
        v301 = this->ConfigurationForAction[1][3].m_uiActionInitiator;
        this->ConfigurationForAction[1][3].m_uiActionInitiator = 7;
        v302 = 1;
        v303 = 0;
        if ( this->ConfigurationForAction[1][0].m_uiActionInitiator != 1056 )
        {
          v303 = 1;
          v302 = 2;
        }
        if ( v300 == 1056 )
          v302 = v303;
        if ( v299 )
          ++v302;
        v304 = v302 + 1;
        if ( v301 )
          v304 = v302 + 2;
        this->ConfigurationForAction[1][3].m_uiSetOrder = v304;
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_FIREWEAPON_ALT);
        v305 = this->ConfigurationForAction[19][0].m_uiActionInitiator;
        v306 = this->ConfigurationForAction[19][1].m_uiActionInitiator;
        v307 = this->ConfigurationForAction[19][2].m_uiActionInitiator;
        v308 = this->ConfigurationForAction[19][3].m_uiActionInitiator;
        this->ConfigurationForAction[19][3].m_uiActionInitiator = 7;
        if ( v305 != 1056 )
        {
          v296 = 1;
          v298 = 2;
        }
        if ( v306 == 1056 )
          v298 = v296;
        if ( v307 )
          ++v298;
        v309 = v298 + 1;
        if ( v308 )
          v309 = v298 + 2;
        this->ConfigurationForAction[19][3].m_uiSetOrder = v309;
LABEL_393:
        CControllerConfigManager::ResetSettingOrder(this, PED_CYCLE_WEAPON_RIGHT);
        v310 = this->ConfigurationForAction[2][0].m_uiActionInitiator;
        v311 = this->ConfigurationForAction[2][1].m_uiActionInitiator;
        v312 = this->ConfigurationForAction[2][3].m_uiActionInitiator;
        v313 = 1;
        v314 = this->ConfigurationForAction[2][2].m_uiActionInitiator;
        this->ConfigurationForAction[2][3].m_uiActionInitiator = 6;
        v315 = 0;
        if ( v310 != 1056 )
        {
          v315 = 1;
          v313 = 2;
        }
        v316 = 0;
        if ( v311 == 1056 )
          v313 = v315;
        if ( v314 )
          ++v313;
        v317 = v313 + 1;
        v318 = 1;
        if ( v312 )
          v317 = v313 + 2;
        this->ConfigurationForAction[2][3].m_uiSetOrder = v317;
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_LOOKRIGHT);
        v319 = this->ConfigurationForAction[35][0].m_uiActionInitiator;
        v320 = this->ConfigurationForAction[35][1].m_uiActionInitiator;
        v321 = this->ConfigurationForAction[35][2].m_uiActionInitiator;
        v322 = this->ConfigurationForAction[35][3].m_uiActionInitiator;
        this->ConfigurationForAction[35][3].m_uiActionInitiator = 6;
        if ( v319 != 1056 )
        {
          v316 = 1;
          v318 = 2;
        }
        if ( v320 == 1056 )
          v318 = v316;
        if ( v321 )
          ++v318;
        v323 = v318 + 1;
        if ( v322 )
          v323 = v318 + 2;
        this->ConfigurationForAction[35][3].m_uiSetOrder = v323;
LABEL_410:
        CControllerConfigManager::ResetSettingOrder(this, PED_CYCLE_WEAPON_LEFT);
        v324 = this->ConfigurationForAction[3][0].m_uiActionInitiator;
        v325 = this->ConfigurationForAction[3][1].m_uiActionInitiator;
        v326 = this->ConfigurationForAction[3][3].m_uiActionInitiator;
        v327 = 1;
        v328 = this->ConfigurationForAction[3][2].m_uiActionInitiator;
        this->ConfigurationForAction[3][3].m_uiActionInitiator = 5;
        v329 = 0;
        if ( v324 != 1056 )
        {
          v329 = 1;
          v327 = 2;
        }
        v330 = 0;
        if ( v325 == 1056 )
          v327 = v329;
        if ( v328 )
          ++v327;
        v331 = v327 + 1;
        v332 = 1;
        if ( v326 )
          v331 = v327 + 2;
        this->ConfigurationForAction[3][3].m_uiSetOrder = v331;
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_LOOKLEFT);
        v333 = this->ConfigurationForAction[34][0].m_uiActionInitiator;
        v334 = this->ConfigurationForAction[34][1].m_uiActionInitiator;
        v335 = this->ConfigurationForAction[34][2].m_uiActionInitiator;
        v336 = this->ConfigurationForAction[34][3].m_uiActionInitiator;
        this->ConfigurationForAction[34][3].m_uiActionInitiator = 5;
        if ( v333 != 1056 )
        {
          v330 = 1;
          v332 = 2;
        }
        if ( v334 == 1056 )
          v332 = v330;
        if ( v335 )
          ++v332;
        v337 = v332 + 1;
        if ( v336 )
          v337 = v332 + 2;
        this->ConfigurationForAction[34][3].m_uiSetOrder = v337;
LABEL_427:
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_ENTER_EXIT);
        v338 = this->ConfigurationForAction[10][1].m_uiActionInitiator;
        v3 = this->ConfigurationForAction[10][0].m_uiActionInitiator == 1056;
        v339 = this->ConfigurationForAction[10][3].m_uiActionInitiator;
        v340 = 1;
        v341 = this->ConfigurationForAction[10][2].m_uiActionInitiator;
        this->ConfigurationForAction[10][3].m_uiActionInitiator = 4;
        v342 = 0;
        if ( !v3 )
        {
          v342 = 1;
          v340 = 2;
        }
        if ( v338 == 1056 )
          v340 = v342;
        if ( v341 )
          ++v340;
        v343 = v340 + 1;
        if ( v339 )
          v343 = v340 + 2;
        this->ConfigurationForAction[10][3].m_uiSetOrder = v343;
LABEL_436:
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_BRAKE);
        v344 = this->ConfigurationForAction[25][0].m_uiActionInitiator;
        v345 = this->ConfigurationForAction[25][1].m_uiActionInitiator;
        v346 = this->ConfigurationForAction[25][3].m_uiActionInitiator;
        v347 = 1;
        v348 = this->ConfigurationForAction[25][2].m_uiActionInitiator;
        this->ConfigurationForAction[25][3].m_uiActionInitiator = 3;
        v349 = 0;
        if ( v344 != 1056 )
        {
          v349 = 1;
          v347 = 2;
        }
        v350 = 0;
        if ( v345 == 1056 )
          v347 = v349;
        if ( v348 )
          ++v347;
        v351 = v347 + 1;
        if ( v346 )
          v351 = v347 + 2;
        v352 = 1;
        this->ConfigurationForAction[25][3].m_uiSetOrder = v351;
        CControllerConfigManager::ResetSettingOrder(this, PED_JUMPING);
        v353 = this->ConfigurationForAction[12][2].m_uiActionInitiator;
        v354 = this->ConfigurationForAction[12][1].m_uiActionInitiator;
        v355 = this->ConfigurationForAction[12][3].m_uiActionInitiator;
        this->ConfigurationForAction[12][3].m_uiActionInitiator = 3;
        v356 = 1;
        v357 = 0;
        if ( this->ConfigurationForAction[12][0].m_uiActionInitiator != 1056 )
        {
          v357 = 1;
          v356 = 2;
        }
        if ( v354 == 1056 )
          v356 = v357;
        if ( v353 )
          ++v356;
        v358 = v356 + 1;
        if ( v355 )
          v358 = v356 + 2;
        this->ConfigurationForAction[12][3].m_uiSetOrder = v358;
        CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_IN);
        v359 = this->ConfigurationForAction[8][0].m_uiActionInitiator;
        v360 = this->ConfigurationForAction[8][1].m_uiActionInitiator;
        v361 = this->ConfigurationForAction[8][2].m_uiActionInitiator;
        v362 = this->ConfigurationForAction[8][3].m_uiActionInitiator;
        this->ConfigurationForAction[8][3].m_uiActionInitiator = 3;
        if ( v359 != 1056 )
        {
          v350 = 1;
          v352 = 2;
        }
        if ( v360 == 1056 )
          v352 = v350;
        if ( v361 )
          ++v352;
        v363 = v352 + 1;
        if ( v362 )
          v363 = v352 + 2;
        this->ConfigurationForAction[8][3].m_uiSetOrder = v363;
LABEL_461:
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_ACCELERATE);
        v364 = this->ConfigurationForAction[24][0].m_uiActionInitiator;
        v365 = this->ConfigurationForAction[24][1].m_uiActionInitiator;
        v366 = this->ConfigurationForAction[24][3].m_uiActionInitiator;
        v367 = 1;
        v368 = this->ConfigurationForAction[24][2].m_uiActionInitiator;
        this->ConfigurationForAction[24][3].m_uiActionInitiator = 2;
        v369 = 0;
        if ( v364 != 1056 )
        {
          v369 = 1;
          v367 = 2;
        }
        v370 = 0;
        if ( v365 == 1056 )
          v367 = v369;
        if ( v368 )
          ++v367;
        v371 = v367 + 1;
        if ( v366 )
          v371 = v367 + 2;
        v372 = 1;
        this->ConfigurationForAction[24][3].m_uiSetOrder = v371;
        CControllerConfigManager::ResetSettingOrder(this, PED_SPRINT);
        v373 = this->ConfigurationForAction[13][2].m_uiActionInitiator;
        v374 = this->ConfigurationForAction[13][1].m_uiActionInitiator;
        v375 = this->ConfigurationForAction[13][3].m_uiActionInitiator;
        this->ConfigurationForAction[13][3].m_uiActionInitiator = 2;
        v376 = 1;
        v377 = 0;
        if ( this->ConfigurationForAction[13][0].m_uiActionInitiator != 1056 )
        {
          v377 = 1;
          v376 = 2;
        }
        if ( v374 == 1056 )
          v376 = v377;
        if ( v373 )
          ++v376;
        v378 = v376 + 1;
        if ( v375 )
          v378 = v376 + 2;
        this->ConfigurationForAction[13][3].m_uiSetOrder = v378;
        CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_OUT);
        v379 = this->ConfigurationForAction[9][0].m_uiActionInitiator;
        v380 = this->ConfigurationForAction[9][1].m_uiActionInitiator;
        v381 = this->ConfigurationForAction[9][2].m_uiActionInitiator;
        v382 = this->ConfigurationForAction[9][3].m_uiActionInitiator;
        this->ConfigurationForAction[9][3].m_uiActionInitiator = 2;
        if ( v379 != 1056 )
        {
          v370 = 1;
          v372 = 2;
        }
        if ( v380 == 1056 )
          v372 = v370;
        if ( v381 )
          ++v372;
        v383 = v372 + 1;
        if ( v382 )
          v383 = v372 + 2;
        this->ConfigurationForAction[9][3].m_uiSetOrder = v383;
LABEL_486:
        v384 = 0;
        CControllerConfigManager::ResetSettingOrder(this, PED_FIREWEAPON);
        v385 = this->ConfigurationForAction[0][1].m_uiActionInitiator;
        v386 = 1;
        v3 = this->ConfigurationForAction[0][0].m_uiActionInitiator == 1056;
        v387 = this->ConfigurationForAction[0][3].m_uiActionInitiator;
        v388 = 1;
        v389 = this->ConfigurationForAction[0][2].m_uiActionInitiator;
        this->ConfigurationForAction[0][3].m_uiActionInitiator = 1;
        v390 = 0;
        if ( !v3 )
        {
          v390 = 1;
          v388 = 2;
        }
        if ( v385 == 1056 )
          v388 = v390;
        if ( v389 )
          ++v388;
        v391 = v388 + 1;
        if ( v387 )
          v391 = v388 + 2;
        this->ConfigurationForAction[0][3].m_uiSetOrder = v391;
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_FIREWEAPON);
        v392 = this->ConfigurationForAction[18][0].m_uiActionInitiator;
        v393 = this->ConfigurationForAction[18][1].m_uiActionInitiator;
        v394 = this->ConfigurationForAction[18][2].m_uiActionInitiator;
        v395 = this->ConfigurationForAction[18][3].m_uiActionInitiator;
        this->ConfigurationForAction[18][3].m_uiActionInitiator = 1;
        if ( v392 != 1056 )
        {
          v384 = 1;
          v386 = 2;
        }
        if ( v393 == 1056 )
          v386 = v384;
        if ( v394 )
          ++v386;
        v200 = v386 + 1;
        v201 = 15212;
        if ( v395 )
          v200 = v386 + 2;
        goto LABEL_502;
      default:
        return;
    }
  }
  switch ( NumButtons & 0x1F )
  {
    case 1u:
      goto LABEL_246;
    case 2u:
      goto LABEL_229;
    case 3u:
      goto LABEL_204;
    case 4u:
      goto LABEL_179;
    case 5u:
      goto LABEL_162;
    case 6u:
      goto LABEL_145;
    case 7u:
      goto LABEL_120;
    case 8u:
      goto LABEL_103;
    case 9u:
      goto LABEL_94;
    case 0xAu:
      goto LABEL_77;
    case 0xBu:
    case 0xCu:
      goto LABEL_60;
    case 0xDu:
      goto LABEL_43;
    case 0xEu:
      goto LABEL_34;
    case 0xFu:
      goto LABEL_17;
    case 0x10u:
      CControllerConfigManager::ResetSettingOrder(this, CONVERSATION_NO);
      v4 = this->ConfigurationForAction[48][1].m_uiActionInitiator;
      v3 = this->ConfigurationForAction[48][0].m_uiActionInitiator == 1056;
      v5 = this->ConfigurationForAction[48][3].m_uiActionInitiator;
      v6 = 1;
      v7 = this->ConfigurationForAction[48][2].m_uiActionInitiator;
      this->ConfigurationForAction[48][3].m_uiActionInitiator = 16;
      v8 = 0;
      if ( !v3 )
      {
        v8 = 1;
        v6 = 2;
      }
      if ( v4 == 1056 )
        v6 = v8;
      if ( v7 )
        ++v6;
      v9 = v6 + 1;
      if ( v5 )
        v9 = v6 + 2;
      this->ConfigurationForAction[48][3].m_uiSetOrder = v9;
LABEL_17:
      CControllerConfigManager::ResetSettingOrder(this, GROUP_CONTROL_BWD);
      v10 = this->ConfigurationForAction[50][0].m_uiActionInitiator;
      v11 = this->ConfigurationForAction[50][1].m_uiActionInitiator;
      v12 = this->ConfigurationForAction[50][3].m_uiActionInitiator;
      v13 = 1;
      v14 = this->ConfigurationForAction[50][2].m_uiActionInitiator;
      this->ConfigurationForAction[50][3].m_uiActionInitiator = 15;
      v15 = 0;
      if ( v10 != 1056 )
      {
        v15 = 1;
        v13 = 2;
      }
      v16 = 0;
      if ( v11 == 1056 )
        v13 = v15;
      if ( v14 )
        ++v13;
      v17 = v13 + 1;
      v18 = 1;
      if ( v12 )
        v17 = v13 + 2;
      this->ConfigurationForAction[50][3].m_uiSetOrder = v17;
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_RADIO_STATION_DOWN);
      v19 = this->ConfigurationForAction[27][0].m_uiActionInitiator;
      v20 = this->ConfigurationForAction[27][1].m_uiActionInitiator;
      v21 = this->ConfigurationForAction[27][2].m_uiActionInitiator;
      v22 = this->ConfigurationForAction[27][3].m_uiActionInitiator;
      this->ConfigurationForAction[27][3].m_uiActionInitiator = 15;
      if ( v19 != 1056 )
      {
        v16 = 1;
        v18 = 2;
      }
      if ( v20 == 1056 )
        v18 = v16;
      if ( v21 )
        ++v18;
      v23 = v18 + 1;
      if ( v22 )
        v23 = v18 + 2;
      this->ConfigurationForAction[27][3].m_uiSetOrder = v23;
LABEL_34:
      CControllerConfigManager::ResetSettingOrder(this, CONVERSATION_YES);
      v24 = this->ConfigurationForAction[47][1].m_uiActionInitiator;
      v3 = this->ConfigurationForAction[47][0].m_uiActionInitiator == 1056;
      v25 = this->ConfigurationForAction[47][3].m_uiActionInitiator;
      v26 = 1;
      v27 = this->ConfigurationForAction[47][2].m_uiActionInitiator;
      this->ConfigurationForAction[47][3].m_uiActionInitiator = 14;
      v28 = 0;
      if ( !v3 )
      {
        v28 = 1;
        v26 = 2;
      }
      if ( v24 == 1056 )
        v26 = v28;
      if ( v27 )
        ++v26;
      v29 = v26 + 1;
      if ( v25 )
        v29 = v26 + 2;
      this->ConfigurationForAction[47][3].m_uiSetOrder = v29;
LABEL_43:
      CControllerConfigManager::ResetSettingOrder(this, GROUP_CONTROL_FWD);
      v30 = this->ConfigurationForAction[49][0].m_uiActionInitiator;
      v31 = this->ConfigurationForAction[49][1].m_uiActionInitiator;
      v32 = this->ConfigurationForAction[49][3].m_uiActionInitiator;
      v33 = 1;
      v34 = this->ConfigurationForAction[49][2].m_uiActionInitiator;
      this->ConfigurationForAction[49][3].m_uiActionInitiator = 13;
      v35 = 0;
      if ( v30 != 1056 )
      {
        v35 = 1;
        v33 = 2;
      }
      v36 = 0;
      if ( v31 == 1056 )
        v33 = v35;
      if ( v34 )
        ++v33;
      v37 = v33 + 1;
      v38 = 1;
      if ( v32 )
        v37 = v33 + 2;
      this->ConfigurationForAction[49][3].m_uiSetOrder = v37;
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_RADIO_STATION_UP);
      v39 = this->ConfigurationForAction[26][0].m_uiActionInitiator;
      v40 = this->ConfigurationForAction[26][1].m_uiActionInitiator;
      v41 = this->ConfigurationForAction[26][2].m_uiActionInitiator;
      v42 = this->ConfigurationForAction[26][3].m_uiActionInitiator;
      this->ConfigurationForAction[26][3].m_uiActionInitiator = 13;
      if ( v39 != 1056 )
      {
        v36 = 1;
        v38 = 2;
      }
      if ( v40 == 1056 )
        v38 = v36;
      if ( v41 )
        ++v38;
      v43 = v38 + 1;
      if ( v42 )
        v43 = v38 + 2;
      this->ConfigurationForAction[26][3].m_uiSetOrder = v43;
LABEL_60:
      CControllerConfigManager::ResetSettingOrder(this, PED_LOOKBEHIND);
      v44 = this->ConfigurationForAction[14][0].m_uiActionInitiator;
      v45 = this->ConfigurationForAction[14][1].m_uiActionInitiator;
      v46 = this->ConfigurationForAction[14][3].m_uiActionInitiator;
      v47 = 1;
      v48 = this->ConfigurationForAction[14][2].m_uiActionInitiator;
      this->ConfigurationForAction[14][3].m_uiActionInitiator = 11;
      v49 = 0;
      if ( v44 != 1056 )
      {
        v49 = 1;
        v47 = 2;
      }
      v50 = 0;
      if ( v45 == 1056 )
        v47 = v49;
      if ( v48 )
        ++v47;
      v51 = v47 + 1;
      v52 = 1;
      if ( v46 )
        v51 = v47 + 2;
      this->ConfigurationForAction[14][3].m_uiSetOrder = v51;
      CControllerConfigManager::ResetSettingOrder(this, TOGGLE_SUBMISSIONS);
      v53 = this->ConfigurationForAction[30][0].m_uiActionInitiator;
      v54 = this->ConfigurationForAction[30][1].m_uiActionInitiator;
      v55 = this->ConfigurationForAction[30][2].m_uiActionInitiator;
      v56 = this->ConfigurationForAction[30][3].m_uiActionInitiator;
      this->ConfigurationForAction[30][3].m_uiActionInitiator = 11;
      if ( v53 != 1056 )
      {
        v50 = 1;
        v52 = 2;
      }
      if ( v54 == 1056 )
        v52 = v50;
      if ( v55 )
        ++v52;
      v57 = v52 + 1;
      if ( v56 )
        v57 = v52 + 2;
      this->ConfigurationForAction[30][3].m_uiSetOrder = v57;
LABEL_77:
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_HORN);
      v58 = this->ConfigurationForAction[29][0].m_uiActionInitiator;
      v59 = this->ConfigurationForAction[29][1].m_uiActionInitiator;
      v60 = this->ConfigurationForAction[29][3].m_uiActionInitiator;
      v61 = 1;
      v62 = this->ConfigurationForAction[29][2].m_uiActionInitiator;
      this->ConfigurationForAction[29][3].m_uiActionInitiator = 10;
      v63 = 0;
      if ( v58 != 1056 )
      {
        v63 = 1;
        v61 = 2;
      }
      v64 = 0;
      if ( v59 == 1056 )
        v61 = v63;
      if ( v62 )
        ++v61;
      v65 = v61 + 1;
      v66 = 1;
      if ( v60 )
        v65 = v61 + 2;
      this->ConfigurationForAction[29][3].m_uiSetOrder = v65;
      CControllerConfigManager::ResetSettingOrder(this, PED_DUCK);
      v67 = this->ConfigurationForAction[15][0].m_uiActionInitiator;
      v68 = this->ConfigurationForAction[15][1].m_uiActionInitiator;
      v69 = this->ConfigurationForAction[15][2].m_uiActionInitiator;
      v70 = this->ConfigurationForAction[15][3].m_uiActionInitiator;
      this->ConfigurationForAction[15][3].m_uiActionInitiator = 10;
      if ( v67 != 1056 )
      {
        v64 = 1;
        v66 = 2;
      }
      if ( v68 == 1056 )
        v66 = v64;
      if ( v69 )
        ++v66;
      v71 = v66 + 1;
      if ( v70 )
        v71 = v66 + 2;
      this->ConfigurationForAction[15][3].m_uiSetOrder = v71;
LABEL_94:
      CControllerConfigManager::ResetSettingOrder(this, CAMERA_CHANGE_VIEW_ALL_SITUATIONS);
      v72 = this->ConfigurationForAction[11][1].m_uiActionInitiator;
      v3 = this->ConfigurationForAction[11][0].m_uiActionInitiator == 1056;
      v73 = this->ConfigurationForAction[11][3].m_uiActionInitiator;
      v74 = 1;
      v75 = this->ConfigurationForAction[11][2].m_uiActionInitiator;
      this->ConfigurationForAction[11][3].m_uiActionInitiator = 9;
      v76 = 0;
      if ( !v3 )
      {
        v76 = 1;
        v74 = 2;
      }
      if ( v72 == 1056 )
        v74 = v76;
      if ( v75 )
        ++v74;
      v77 = v74 + 1;
      if ( v73 )
        v77 = v74 + 2;
      this->ConfigurationForAction[11][3].m_uiSetOrder = v77;
LABEL_103:
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_HANDBRAKE);
      v78 = this->ConfigurationForAction[31][0].m_uiActionInitiator;
      v79 = this->ConfigurationForAction[31][1].m_uiActionInitiator;
      v80 = this->ConfigurationForAction[31][3].m_uiActionInitiator;
      v81 = 1;
      v82 = this->ConfigurationForAction[31][2].m_uiActionInitiator;
      this->ConfigurationForAction[31][3].m_uiActionInitiator = 8;
      v83 = 0;
      if ( v78 != 1056 )
      {
        v83 = 1;
        v81 = 2;
      }
      v84 = 0;
      if ( v79 == 1056 )
        v81 = v83;
      if ( v82 )
        ++v81;
      v85 = v81 + 1;
      v86 = 1;
      if ( v80 )
        v85 = v81 + 2;
      this->ConfigurationForAction[31][3].m_uiSetOrder = v85;
      CControllerConfigManager::ResetSettingOrder(this, PED_LOCK_TARGET);
      v87 = this->ConfigurationForAction[45][0].m_uiActionInitiator;
      v88 = this->ConfigurationForAction[45][1].m_uiActionInitiator;
      v89 = this->ConfigurationForAction[45][2].m_uiActionInitiator;
      v90 = this->ConfigurationForAction[45][3].m_uiActionInitiator;
      this->ConfigurationForAction[45][3].m_uiActionInitiator = 8;
      if ( v87 != 1056 )
      {
        v84 = 1;
        v86 = 2;
      }
      if ( v88 == 1056 )
        v86 = v84;
      if ( v89 )
        ++v86;
      v91 = v86 + 1;
      if ( v90 )
        v91 = v86 + 2;
      this->ConfigurationForAction[45][3].m_uiSetOrder = v91;
LABEL_120:
      CControllerConfigManager::ResetSettingOrder(this, PED_ANSWER_PHONE);
      v92 = this->ConfigurationForAction[16][0].m_uiActionInitiator;
      v93 = this->ConfigurationForAction[16][1].m_uiActionInitiator;
      v94 = this->ConfigurationForAction[16][3].m_uiActionInitiator;
      v95 = 1;
      v96 = this->ConfigurationForAction[16][2].m_uiActionInitiator;
      this->ConfigurationForAction[16][3].m_uiActionInitiator = 7;
      v97 = 0;
      if ( v92 != 1056 )
      {
        v97 = 1;
        v95 = 2;
      }
      v98 = 0;
      if ( v93 == 1056 )
        v95 = v97;
      if ( v96 )
        ++v95;
      v99 = v95 + 1;
      if ( v94 )
        v99 = v95 + 2;
      v100 = 1;
      this->ConfigurationForAction[16][3].m_uiSetOrder = v99;
      CControllerConfigManager::ResetSettingOrder(this, PED_FIREWEAPON_ALT);
      v101 = this->ConfigurationForAction[1][2].m_uiActionInitiator;
      v102 = this->ConfigurationForAction[1][1].m_uiActionInitiator;
      v103 = this->ConfigurationForAction[1][3].m_uiActionInitiator;
      this->ConfigurationForAction[1][3].m_uiActionInitiator = 7;
      v104 = 1;
      v105 = 0;
      if ( this->ConfigurationForAction[1][0].m_uiActionInitiator != 1056 )
      {
        v105 = 1;
        v104 = 2;
      }
      if ( v102 == 1056 )
        v104 = v105;
      if ( v101 )
        ++v104;
      v106 = v104 + 1;
      if ( v103 )
        v106 = v104 + 2;
      this->ConfigurationForAction[1][3].m_uiSetOrder = v106;
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_FIREWEAPON_ALT);
      v107 = this->ConfigurationForAction[19][0].m_uiActionInitiator;
      v108 = this->ConfigurationForAction[19][1].m_uiActionInitiator;
      v109 = this->ConfigurationForAction[19][2].m_uiActionInitiator;
      v110 = this->ConfigurationForAction[19][3].m_uiActionInitiator;
      this->ConfigurationForAction[19][3].m_uiActionInitiator = 7;
      if ( v107 != 1056 )
      {
        v98 = 1;
        v100 = 2;
      }
      if ( v108 == 1056 )
        v100 = v98;
      if ( v109 )
        ++v100;
      v111 = v100 + 1;
      if ( v110 )
        v111 = v100 + 2;
      this->ConfigurationForAction[19][3].m_uiSetOrder = v111;
LABEL_145:
      CControllerConfigManager::ResetSettingOrder(this, PED_CYCLE_WEAPON_RIGHT);
      v112 = this->ConfigurationForAction[2][0].m_uiActionInitiator;
      v113 = this->ConfigurationForAction[2][1].m_uiActionInitiator;
      v114 = this->ConfigurationForAction[2][3].m_uiActionInitiator;
      v115 = 1;
      v116 = this->ConfigurationForAction[2][2].m_uiActionInitiator;
      this->ConfigurationForAction[2][3].m_uiActionInitiator = 6;
      v117 = 0;
      if ( v112 != 1056 )
      {
        v117 = 1;
        v115 = 2;
      }
      v118 = 0;
      if ( v113 == 1056 )
        v115 = v117;
      if ( v116 )
        ++v115;
      v119 = v115 + 1;
      v120 = 1;
      if ( v114 )
        v119 = v115 + 2;
      this->ConfigurationForAction[2][3].m_uiSetOrder = v119;
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_LOOKRIGHT);
      v121 = this->ConfigurationForAction[35][0].m_uiActionInitiator;
      v122 = this->ConfigurationForAction[35][1].m_uiActionInitiator;
      v123 = this->ConfigurationForAction[35][2].m_uiActionInitiator;
      v124 = this->ConfigurationForAction[35][3].m_uiActionInitiator;
      this->ConfigurationForAction[35][3].m_uiActionInitiator = 6;
      if ( v121 != 1056 )
      {
        v118 = 1;
        v120 = 2;
      }
      if ( v122 == 1056 )
        v120 = v118;
      if ( v123 )
        ++v120;
      v125 = v120 + 1;
      if ( v124 )
        v125 = v120 + 2;
      this->ConfigurationForAction[35][3].m_uiSetOrder = v125;
LABEL_162:
      CControllerConfigManager::ResetSettingOrder(this, PED_CYCLE_WEAPON_LEFT);
      v126 = this->ConfigurationForAction[3][0].m_uiActionInitiator;
      v127 = this->ConfigurationForAction[3][1].m_uiActionInitiator;
      v128 = this->ConfigurationForAction[3][3].m_uiActionInitiator;
      v129 = 1;
      v130 = this->ConfigurationForAction[3][2].m_uiActionInitiator;
      this->ConfigurationForAction[3][3].m_uiActionInitiator = 5;
      v131 = 0;
      if ( v126 != 1056 )
      {
        v131 = 1;
        v129 = 2;
      }
      v132 = 0;
      if ( v127 == 1056 )
        v129 = v131;
      if ( v130 )
        ++v129;
      v133 = v129 + 1;
      v134 = 1;
      if ( v128 )
        v133 = v129 + 2;
      this->ConfigurationForAction[3][3].m_uiSetOrder = v133;
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_LOOKLEFT);
      v135 = this->ConfigurationForAction[34][0].m_uiActionInitiator;
      v136 = this->ConfigurationForAction[34][1].m_uiActionInitiator;
      v137 = this->ConfigurationForAction[34][2].m_uiActionInitiator;
      v138 = this->ConfigurationForAction[34][3].m_uiActionInitiator;
      this->ConfigurationForAction[34][3].m_uiActionInitiator = 5;
      if ( v135 != 1056 )
      {
        v132 = 1;
        v134 = 2;
      }
      if ( v136 == 1056 )
        v134 = v132;
      if ( v137 )
        ++v134;
      v139 = v134 + 1;
      if ( v138 )
        v139 = v134 + 2;
      this->ConfigurationForAction[34][3].m_uiSetOrder = v139;
LABEL_179:
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_BRAKE);
      v140 = this->ConfigurationForAction[25][0].m_uiActionInitiator;
      v141 = this->ConfigurationForAction[25][1].m_uiActionInitiator;
      v142 = this->ConfigurationForAction[25][3].m_uiActionInitiator;
      v143 = 1;
      v144 = this->ConfigurationForAction[25][2].m_uiActionInitiator;
      this->ConfigurationForAction[25][3].m_uiActionInitiator = 4;
      v145 = 0;
      if ( v140 != 1056 )
      {
        v145 = 1;
        v143 = 2;
      }
      v146 = 0;
      if ( v141 == 1056 )
        v143 = v145;
      if ( v144 )
        ++v143;
      v147 = v143 + 1;
      if ( v142 )
        v147 = v143 + 2;
      v148 = 1;
      this->ConfigurationForAction[25][3].m_uiSetOrder = v147;
      CControllerConfigManager::ResetSettingOrder(this, PED_JUMPING);
      v149 = this->ConfigurationForAction[12][2].m_uiActionInitiator;
      v150 = this->ConfigurationForAction[12][1].m_uiActionInitiator;
      v151 = this->ConfigurationForAction[12][3].m_uiActionInitiator;
      this->ConfigurationForAction[12][3].m_uiActionInitiator = 4;
      v152 = 1;
      v153 = 0;
      if ( this->ConfigurationForAction[12][0].m_uiActionInitiator != 1056 )
      {
        v153 = 1;
        v152 = 2;
      }
      if ( v150 == 1056 )
        v152 = v153;
      if ( v149 )
        ++v152;
      v154 = v152 + 1;
      if ( v151 )
        v154 = v152 + 2;
      this->ConfigurationForAction[12][3].m_uiSetOrder = v154;
      CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_IN);
      v155 = this->ConfigurationForAction[8][0].m_uiActionInitiator;
      v156 = this->ConfigurationForAction[8][1].m_uiActionInitiator;
      v157 = this->ConfigurationForAction[8][2].m_uiActionInitiator;
      v158 = this->ConfigurationForAction[8][3].m_uiActionInitiator;
      this->ConfigurationForAction[8][3].m_uiActionInitiator = 4;
      if ( v155 != 1056 )
      {
        v146 = 1;
        v148 = 2;
      }
      if ( v156 == 1056 )
        v148 = v146;
      if ( v157 )
        ++v148;
      v159 = v148 + 1;
      if ( v158 )
        v159 = v148 + 2;
      this->ConfigurationForAction[8][3].m_uiSetOrder = v159;
LABEL_204:
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_ACCELERATE);
      v160 = this->ConfigurationForAction[24][0].m_uiActionInitiator;
      v161 = this->ConfigurationForAction[24][1].m_uiActionInitiator;
      v162 = this->ConfigurationForAction[24][3].m_uiActionInitiator;
      v163 = 1;
      v164 = this->ConfigurationForAction[24][2].m_uiActionInitiator;
      this->ConfigurationForAction[24][3].m_uiActionInitiator = 3;
      v165 = 0;
      if ( v160 != 1056 )
      {
        v165 = 1;
        v163 = 2;
      }
      v166 = 0;
      if ( v161 == 1056 )
        v163 = v165;
      if ( v164 )
        ++v163;
      v167 = v163 + 1;
      if ( v162 )
        v167 = v163 + 2;
      v168 = 1;
      this->ConfigurationForAction[24][3].m_uiSetOrder = v167;
      CControllerConfigManager::ResetSettingOrder(this, PED_SPRINT);
      v169 = this->ConfigurationForAction[13][2].m_uiActionInitiator;
      v170 = this->ConfigurationForAction[13][1].m_uiActionInitiator;
      v171 = this->ConfigurationForAction[13][3].m_uiActionInitiator;
      this->ConfigurationForAction[13][3].m_uiActionInitiator = 3;
      v172 = 1;
      v173 = 0;
      if ( this->ConfigurationForAction[13][0].m_uiActionInitiator != 1056 )
      {
        v173 = 1;
        v172 = 2;
      }
      if ( v170 == 1056 )
        v172 = v173;
      if ( v169 )
        ++v172;
      v174 = v172 + 1;
      if ( v171 )
        v174 = v172 + 2;
      this->ConfigurationForAction[13][3].m_uiSetOrder = v174;
      CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_OUT);
      v175 = this->ConfigurationForAction[9][0].m_uiActionInitiator;
      v176 = this->ConfigurationForAction[9][1].m_uiActionInitiator;
      v177 = this->ConfigurationForAction[9][2].m_uiActionInitiator;
      v178 = this->ConfigurationForAction[9][3].m_uiActionInitiator;
      this->ConfigurationForAction[9][3].m_uiActionInitiator = 3;
      if ( v175 != 1056 )
      {
        v166 = 1;
        v168 = 2;
      }
      if ( v176 == 1056 )
        v168 = v166;
      if ( v177 )
        ++v168;
      v179 = v168 + 1;
      if ( v178 )
        v179 = v168 + 2;
      this->ConfigurationForAction[9][3].m_uiSetOrder = v179;
LABEL_229:
      v180 = 0;
      CControllerConfigManager::ResetSettingOrder(this, PED_FIREWEAPON);
      v181 = this->ConfigurationForAction[0][0].m_uiActionInitiator;
      v182 = this->ConfigurationForAction[0][1].m_uiActionInitiator;
      v183 = this->ConfigurationForAction[0][3].m_uiActionInitiator;
      v184 = 1;
      v185 = this->ConfigurationForAction[0][2].m_uiActionInitiator;
      this->ConfigurationForAction[0][3].m_uiActionInitiator = 2;
      v186 = 0;
      if ( v181 != 1056 )
      {
        v186 = 1;
        v184 = 2;
      }
      v187 = 1;
      if ( v182 == 1056 )
        v184 = v186;
      if ( v185 )
        ++v184;
      v188 = v184 + 1;
      if ( v183 )
        v188 = v184 + 2;
      this->ConfigurationForAction[0][3].m_uiSetOrder = v188;
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_FIREWEAPON);
      v189 = this->ConfigurationForAction[18][0].m_uiActionInitiator;
      v190 = this->ConfigurationForAction[18][1].m_uiActionInitiator;
      v191 = this->ConfigurationForAction[18][2].m_uiActionInitiator;
      v192 = this->ConfigurationForAction[18][3].m_uiActionInitiator;
      this->ConfigurationForAction[18][3].m_uiActionInitiator = 2;
      if ( v189 != 1056 )
      {
        v180 = 1;
        v187 = 2;
      }
      if ( v190 == 1056 )
        v187 = v180;
      if ( v191 )
        ++v187;
      v193 = v187 + 1;
      if ( v192 )
        v193 = v187 + 2;
      this->ConfigurationForAction[18][3].m_uiSetOrder = v193;
LABEL_246:
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_ENTER_EXIT);
      v194 = this->ConfigurationForAction[10][0].m_uiActionInitiator;
      v195 = 1;
      v196 = this->ConfigurationForAction[10][3].m_uiActionInitiator;
      v197 = this->ConfigurationForAction[10][1].m_uiActionInitiator;
      v198 = this->ConfigurationForAction[10][2].m_uiActionInitiator;
      this->ConfigurationForAction[10][3].m_uiActionInitiator = 1;
      v199 = 0;
      if ( v194 != 1056 )
      {
        v199 = 1;
        v195 = 2;
      }
      if ( v197 == 1056 )
        v195 = v199;
      if ( v198 )
        ++v195;
      v3 = v196 == 0;
      v200 = v195 + 1;
      v201 = 14956;
      if ( !v3 )
        v200 = v195 + 2;
LABEL_502:
      *(_DWORD *)(&this->m_bJoyJustInitialised + v201) = v200;
      break;
    default:
      return;
  }
}

//----- (003E5274) --------------------------------------------------------
void __fastcall CControllerConfigManager::ReinitControls(CControllerConfigManager *this)
{
  CMouseControllerState v1; // [sp+4h] [bp-1Ch] BYREF

  CControllerConfigManager::MakeControllerActionsBlank(&ControlsManager);
  CControllerConfigManager::InitDefaultControlConfiguration(&ControlsManager);
  CMousePointerStateHelper::GetMouseSetUp(&v1, &MousePointerStateHelper);
  CControllerConfigManager::InitDefaultControlConfigMouse(&ControlsManager, &v1, 0);
}

//----- (003E52B0) --------------------------------------------------------
void __fastcall CControllerConfigManager::InitDefaultControlConfiguration(CControllerConfigManager *this)
{
  UInt32 m_uiActionInitiator; // r0
  int v3; // r11
  int v4; // r0
  int v5; // r1
  eContSetOrder v6; // r0
  UInt32 v7; // r0
  int v8; // r0
  int v9; // r1
  eContSetOrder v10; // r0
  UInt32 v11; // r0
  int v12; // r0
  int v13; // r1
  eContSetOrder v14; // r0
  UInt32 v15; // r0
  int v16; // r0
  int v17; // r1
  eContSetOrder v18; // r0
  LANGUAGE m_PrefsKeyboardLanguage; // r9
  int v20; // r3
  int v21; // r2
  CControllerConfig *v22; // r1
  eContSetOrder v23; // r0
  CControllerConfig *v24; // r8
  CControllerConfig *v25; // r10
  UInt32 v26; // r4
  UInt32 v27; // r0
  UInt32 v28; // r2
  UInt32 v29; // r3
  bool v30; // zf
  UInt32 v31; // r5
  int v32; // r1
  eContSetOrder v33; // r6
  LANGUAGE v34; // r4
  int v35; // r6
  int v36; // r9
  int v37; // r5
  int v38; // r2
  eContSetOrder v39; // r0
  CControllerConfigManager *v40; // r4
  UInt32 v41; // r2
  UInt32 v42; // r0
  UInt32 v43; // r1
  int v44; // r3
  int v45; // r6
  eContSetOrder v46; // r1
  UInt32 v47; // r1
  UInt32 v48; // r0
  int v49; // r1
  int v50; // r2
  eContSetOrder v51; // r0
  int v52; // r2
  UInt32 v53; // r2
  UInt32 v54; // r0
  UInt32 v55; // r1
  int v56; // r3
  int v57; // r6
  eContSetOrder v58; // r1
  UInt32 v59; // r1
  UInt32 v60; // r0
  int v61; // r1
  int v62; // r2
  eContSetOrder v63; // r0
  UInt32 v64; // r0
  eContSetOrder v65; // r0
  CControllerConfig *v66; // r6
  CControllerConfig *v67; // r10
  UInt32 v68; // r2
  UInt32 v69; // r0
  UInt32 v70; // r1
  int v71; // r3
  int v72; // r4
  eContSetOrder v73; // r1
  UInt32 v74; // r3
  UInt32 v75; // r0
  UInt32 v76; // r1
  int v77; // r2
  int v78; // r4
  eContSetOrder v79; // r1
  UInt32 v80; // r0
  int v81; // r0
  int v82; // r1
  eContSetOrder v83; // r0
  UInt32 v84; // r3
  bool v85; // zf
  UInt32 v86; // r1
  int v87; // r0
  UInt32 v88; // r2
  int v89; // r5
  eContSetOrder v90; // r0
  UInt32 v91; // r3
  UInt32 v92; // r0
  UInt32 v93; // r1
  int v94; // r2
  int v95; // r6
  eContSetOrder v96; // r1
  UInt32 v97; // r0
  int v98; // r0
  int v99; // r1
  eContSetOrder v100; // r0
  UInt32 v101; // r2
  UInt32 v102; // r3
  UInt32 v103; // r1
  int v104; // r0
  int v105; // r6
  eContSetOrder v106; // r0
  UInt32 v107; // r1
  UInt32 v108; // r0
  int v109; // r6
  UInt32 v110; // r2
  int v111; // r3
  eContSetOrder v112; // r0
  UInt32 v113; // r2
  UInt32 v114; // r0
  UInt32 v115; // r1
  int v116; // r3
  int v117; // r6
  eContSetOrder v118; // r1
  UInt32 v119; // r1
  UInt32 v120; // r0
  int v121; // r6
  UInt32 v122; // r2
  int v123; // r3
  eContSetOrder v124; // r0
  UInt32 v125; // r1
  UInt32 v126; // r0
  int v127; // r6
  UInt32 v128; // r2
  int v129; // r3
  eContSetOrder v130; // r0
  UInt32 v131; // r1
  UInt32 v132; // r0
  int v133; // r6
  UInt32 v134; // r2
  int v135; // r3
  eContSetOrder v136; // r0
  UInt32 v137; // r1
  UInt32 v138; // r0
  int v139; // r6
  UInt32 v140; // r2
  int v141; // r3
  eContSetOrder v142; // r0
  UInt32 v143; // r0
  int v144; // r2
  int v145; // r1
  eContSetOrder v146; // r0
  UInt32 v147; // r2
  UInt32 v148; // r0
  UInt32 v149; // r1
  int v150; // r3
  int v151; // r6
  eContSetOrder v152; // r0
  UInt32 v153; // r0
  int v154; // r0
  int v155; // r1
  eContSetOrder v156; // r0
  UInt32 v157; // r2
  UInt32 v158; // r3
  UInt32 v159; // r1
  int v160; // r0
  int v161; // r6
  eContSetOrder v162; // r0
  UInt32 v163; // r0
  int v164; // r0
  int v165; // r1
  eContSetOrder v166; // r0
  UInt32 v167; // r2
  UInt32 v168; // r3
  UInt32 v169; // r1
  int v170; // r0
  int v171; // r6
  eContSetOrder v172; // r0
  UInt32 v173; // r3
  UInt32 v174; // r0
  UInt32 v175; // r1
  int v176; // r3
  int v177; // r6
  eContSetOrder v178; // r0
  UInt32 v179; // r3
  UInt32 v180; // r0
  UInt32 v181; // r1
  int v182; // r3
  int v183; // r6
  eContSetOrder v184; // r0
  UInt32 v185; // r3
  UInt32 v186; // r0
  UInt32 v187; // r1
  int v188; // r3
  int v189; // r6
  eContSetOrder v190; // r0
  UInt32 v191; // r3
  UInt32 v192; // r0
  UInt32 v193; // r1
  int v194; // r3
  int v195; // r6
  eContSetOrder v196; // r0
  UInt32 v197; // r0
  int v198; // r0
  int v199; // r1
  eContSetOrder v200; // r0
  UInt32 v201; // r0
  int v202; // r3
  int v203; // r6
  eContSetOrder v204; // r0
  UInt32 v205; // r1
  UInt32 v206; // r0
  int v207; // r6
  UInt32 v208; // r2
  int v209; // r3
  eContSetOrder v210; // r0
  UInt32 v211; // r1
  UInt32 v212; // r0
  int v213; // r6
  UInt32 v214; // r2
  int v215; // r3
  eContSetOrder v216; // r0
  UInt32 v217; // r1
  UInt32 v218; // r0
  int v219; // r6
  UInt32 v220; // r2
  int v221; // r3
  eContSetOrder v222; // r0
  UInt32 v223; // r1
  UInt32 v224; // r0
  int v225; // r6
  UInt32 v226; // r2
  int v227; // r3
  eContSetOrder v228; // r0
  UInt32 v229; // r1
  UInt32 v230; // r0
  int v231; // r6
  UInt32 v232; // r2
  int v233; // r3
  eContSetOrder v234; // r0
  UInt32 v235; // r1
  UInt32 v236; // r0
  int v237; // r6
  UInt32 v238; // r2
  int v239; // r3
  eContSetOrder v240; // r0
  UInt32 v241; // r1
  UInt32 v242; // r0
  int v243; // r6
  UInt32 v244; // r2
  int v245; // r3
  eContSetOrder v246; // r0
  UInt32 v247; // r1
  UInt32 v248; // r0
  int v249; // r6
  UInt32 v250; // r2
  int v251; // r3
  eContSetOrder v252; // r0
  UInt32 v253; // r0
  int v254; // r0
  int v255; // r1
  eContSetOrder v256; // r0
  LANGUAGE v257; // r10
  int v258; // r2
  int v259; // r0
  CControllerConfig *v260; // r9
  eContSetOrder v261; // r0
  CControllerConfig *v262; // r2
  CControllerConfig *v263; // r8
  CControllerConfigManager *v264; // r5
  UInt32 v265; // r4
  UInt32 v266; // r1
  UInt32 v267; // r0
  UInt32 v268; // r2
  int v269; // r3
  int v270; // r6
  eContSetOrder v271; // r0
  UInt32 v272; // r3
  UInt32 v273; // r0
  UInt32 v274; // r1
  int v275; // r2
  int v276; // r6
  eContSetOrder v277; // r1
  UInt32 v278; // r0
  int v279; // r0
  int v280; // r1
  eContSetOrder v281; // r0
  UInt32 v282; // r1
  int v283; // r3
  int v284; // r1
  CControllerConfig *v285; // r10
  eContSetOrder v286; // r0
  CControllerConfig *v287; // r8
  bool v288; // zf
  CControllerConfig *v289; // r4
  UInt32 v290; // r1
  UInt32 v291; // r0
  int v292; // r6
  UInt32 v293; // r2
  int v294; // r3
  eContSetOrder v295; // r0
  UInt32 v296; // r3
  UInt32 v297; // r0
  UInt32 v298; // r1
  int v299; // r2
  int v300; // r6
  eContSetOrder v301; // r1
  UInt32 v302; // r0
  int v303; // r0
  int v304; // r1
  eContSetOrder v305; // r0
  UInt32 v306; // r1
  int v307; // r1
  UInt32 v308; // r3
  UInt32 v309; // r2
  int v310; // r5
  UInt32 v311; // r1
  int v312; // r3
  UInt32 v313; // r0
  eContSetOrder v314; // r1
  int v315; // r10
  int v316; // r1
  int v317; // r0
  eContSetOrder v318; // r0
  UInt32 v319; // r0
  int v320; // r5
  int v321; // r3
  eContSetOrder v322; // r0
  UInt32 v323; // r0
  int v324; // r0
  int v325; // r1
  eContSetOrder v326; // r0
  UInt32 v327; // r0
  int v328; // r5
  int v329; // r3
  eContSetOrder v330; // r0
  UInt32 v331; // r3
  UInt32 v332; // r0
  UInt32 v333; // r1
  int v334; // r3
  int v335; // r5
  eContSetOrder v336; // r0
  UInt32 v337; // r0
  int v338; // r0
  int v339; // r1
  eContSetOrder v340; // r0
  UInt32 v341; // r3
  UInt32 v342; // r0
  UInt32 v343; // r1
  int v344; // r2
  int v345; // r4
  eContSetOrder v346; // r1
  UInt32 v347; // r0
  int v348; // r5
  int v349; // r3
  eContSetOrder v350; // r0
  UInt32 v351; // r0
  int v352; // r0
  int v353; // r1
  eContSetOrder v354; // r0
  UInt32 v355; // r0
  int v356; // r5
  int v357; // r3
  eContSetOrder v358; // r0
  UInt32 v359; // r0
  int v360; // r0
  int v361; // r1
  eContSetOrder v362; // r0
  UInt32 v363; // r3
  bool v364; // zf
  UInt32 v365; // r0
  int v366; // r2
  UInt32 v367; // r1
  int v368; // r5
  eContSetOrder v369; // r1
  UInt32 v370; // r1
  UInt32 v371; // r0
  int v372; // r5
  UInt32 v373; // r2
  int v374; // r3
  eContSetOrder v375; // r0
  UInt32 v376; // r1
  UInt32 v377; // r0
  int v378; // r5
  UInt32 v379; // r2
  int v380; // r3
  eContSetOrder v381; // r0
  UInt32 v382; // r1
  UInt32 v383; // r0
  int v384; // r5
  UInt32 v385; // r2
  int v386; // r3
  eContSetOrder v387; // r0
  UInt32 v388; // r0
  int v389; // r0
  int v390; // r1
  eContSetOrder v391; // r0
  UInt32 v392; // r0
  int v393; // r0
  int v394; // r1
  eContSetOrder v395; // r0
  UInt32 v396; // r0
  int v397; // r2
  int v398; // r1
  eContSetOrder v399; // r0
  UInt32 v400; // r0
  int v401; // r5
  int v402; // r3
  eContSetOrder v403; // r0
  UInt32 v404; // r3
  UInt32 v405; // r0
  UInt32 v406; // r1
  int v407; // r3
  int v408; // r5
  eContSetOrder v409; // r0
  int v410; // r1
  UInt32 v411; // r0
  int v412; // r0
  eContSetOrder v413; // r0
  UInt32 v414; // r2
  UInt32 v415; // r3
  UInt32 v416; // r1
  int v417; // r0
  int v418; // r5
  eContSetOrder v419; // r0
  UInt32 v420; // r1
  UInt32 v421; // r0
  int v422; // r5
  UInt32 v423; // r2
  int v424; // r3
  eContSetOrder v425; // r0
  UInt32 v426; // r5
  UInt32 v427; // r1
  UInt32 v428; // r0
  int v429; // r6
  UInt32 v430; // r2
  int v431; // r3
  eContSetOrder v432; // r0
  e_ControllerAction v433; // r5
  CControllerConfig *v434; // r11
  CControllerConfig *v435; // r2
  bool *v436; // r1
  int v437; // r4
  UInt32 v438; // r0
  UInt32 v439; // r6
  UInt32 v440; // r3
  int v441; // r1
  int v442; // r6
  int v443; // r1
  CControllerConfig *v444; // [sp+0h] [bp-58h]
  CControllerConfig *v445; // [sp+0h] [bp-58h]
  CControllerConfig *v446; // [sp+4h] [bp-54h]
  CControllerConfig *v447; // [sp+4h] [bp-54h]
  CControllerConfig *v448; // [sp+8h] [bp-50h]
  CControllerConfig *v449; // [sp+8h] [bp-50h]
  CControllerConfig *v450; // [sp+Ch] [bp-4Ch]
  CControllerConfig *v451; // [sp+Ch] [bp-4Ch]
  CControllerConfig *v452; // [sp+10h] [bp-48h]
  CControllerConfig *v453; // [sp+10h] [bp-48h]
  CControllerConfig *v454; // [sp+14h] [bp-44h]
  CControllerConfig *v455; // [sp+14h] [bp-44h]
  CControllerConfig *v456; // [sp+18h] [bp-40h]
  CControllerConfig *v457; // [sp+1Ch] [bp-3Ch]
  CControllerConfig *v458; // [sp+20h] [bp-38h]
  CControllerConfig *v459; // [sp+20h] [bp-38h]
  CControllerConfig *v460; // [sp+24h] [bp-34h]
  CControllerConfig *v461; // [sp+24h] [bp-34h]
  CControllerConfig *v462; // [sp+28h] [bp-30h]
  CControllerConfig *v463; // [sp+2Ch] [bp-2Ch]
  CControllerConfig *v464; // [sp+30h] [bp-28h]
  CControllerConfig *v465; // [sp+34h] [bp-24h]
  CControllerConfig *v466; // [sp+34h] [bp-24h]
  CControllerConfigManager *v467; // [sp+38h] [bp-20h]

  CControllerConfigManager::ResetSettingOrder(this, GO_FORWARD);
  m_uiActionInitiator = this->ConfigurationForAction[4][0].m_uiActionInitiator;
  v3 = 1;
  this->ConfigurationForAction[4][0].m_uiActionInitiator = 1019;
  v30 = m_uiActionInitiator == 1056;
  v4 = 0;
  v5 = 1;
  if ( !v30 )
  {
    v4 = 1;
    v5 = 2;
  }
  if ( this->ConfigurationForAction[4][1].m_uiActionInitiator == 1056 )
    v5 = v4;
  if ( this->ConfigurationForAction[4][2].m_uiActionInitiator )
    ++v5;
  v6 = v5 + 1;
  if ( this->ConfigurationForAction[4][3].m_uiActionInitiator )
    v6 = v5 + 2;
  this->ConfigurationForAction[4][0].m_uiSetOrder = v6;
  CControllerConfigManager::ResetSettingOrder(this, GO_BACK);
  v7 = this->ConfigurationForAction[5][0].m_uiActionInitiator;
  this->ConfigurationForAction[5][0].m_uiActionInitiator = 1020;
  v30 = v7 == 1056;
  v8 = 0;
  v9 = 1;
  if ( !v30 )
  {
    v8 = 1;
    v9 = 2;
  }
  if ( this->ConfigurationForAction[5][1].m_uiActionInitiator == 1056 )
    v9 = v8;
  if ( this->ConfigurationForAction[5][2].m_uiActionInitiator )
    ++v9;
  v10 = v9 + 1;
  if ( this->ConfigurationForAction[5][3].m_uiActionInitiator )
    v10 = v9 + 2;
  this->ConfigurationForAction[5][0].m_uiSetOrder = v10;
  CControllerConfigManager::ResetSettingOrder(this, GO_LEFT);
  v11 = this->ConfigurationForAction[6][0].m_uiActionInitiator;
  this->ConfigurationForAction[6][0].m_uiActionInitiator = 1021;
  v30 = v11 == 1056;
  v12 = 0;
  v13 = 1;
  if ( !v30 )
  {
    v12 = 1;
    v13 = 2;
  }
  if ( this->ConfigurationForAction[6][1].m_uiActionInitiator == 1056 )
    v13 = v12;
  if ( this->ConfigurationForAction[6][2].m_uiActionInitiator )
    ++v13;
  v14 = v13 + 1;
  if ( this->ConfigurationForAction[6][3].m_uiActionInitiator )
    v14 = v13 + 2;
  this->ConfigurationForAction[6][0].m_uiSetOrder = v14;
  CControllerConfigManager::ResetSettingOrder(this, GO_RIGHT);
  v15 = this->ConfigurationForAction[7][0].m_uiActionInitiator;
  this->ConfigurationForAction[7][0].m_uiActionInitiator = 1022;
  v30 = v15 == 1056;
  v16 = 0;
  v17 = 1;
  if ( !v30 )
  {
    v16 = 1;
    v17 = 2;
  }
  if ( this->ConfigurationForAction[7][1].m_uiActionInitiator == 1056 )
    v17 = v16;
  if ( this->ConfigurationForAction[7][2].m_uiActionInitiator )
    ++v17;
  v18 = v17 + 1;
  if ( this->ConfigurationForAction[7][3].m_uiActionInitiator )
    v18 = v17 + 2;
  this->ConfigurationForAction[7][0].m_uiSetOrder = v18;
  m_PrefsKeyboardLanguage = FrontEndMenuManager.m_PrefsKeyboardLanguage;
  CControllerConfigManager::ResetSettingOrder(this, CONVERSATION_YES);
  v20 = 1;
  v21 = 0;
  v22 = this->ConfigurationForAction[47];
  if ( this->ConfigurationForAction[47][0].m_uiActionInitiator != 1056 )
  {
    v21 = 1;
    v20 = 2;
  }
  if ( this->ConfigurationForAction[47][1].m_uiActionInitiator == 1056 )
    v20 = v21;
  if ( this->ConfigurationForAction[47][2].m_uiActionInitiator )
    ++v20;
  v23 = v20 + 1;
  if ( this->ConfigurationForAction[47][3].m_uiActionInitiator )
    v23 = v20 + 2;
  v463 = &this->ConfigurationForAction[7][3];
  v465 = &this->ConfigurationForAction[7][1];
  v464 = this->ConfigurationForAction[7];
  v450 = &this->ConfigurationForAction[6][3];
  v467 = this;
  v452 = &this->ConfigurationForAction[6][2];
  v24 = &this->ConfigurationForAction[6][1];
  v454 = this->ConfigurationForAction[6];
  v457 = &this->ConfigurationForAction[5][3];
  v460 = &this->ConfigurationForAction[5][1];
  v458 = this->ConfigurationForAction[5];
  v446 = &this->ConfigurationForAction[4][3];
  v448 = &this->ConfigurationForAction[4][2];
  v25 = &this->ConfigurationForAction[4][1];
  v444 = this->ConfigurationForAction[4];
  v462 = &this->ConfigurationForAction[7][2];
  v456 = &this->ConfigurationForAction[5][2];
  if ( m_PrefsKeyboardLanguage == LANGUAGE_GERMAN )
  {
    v22->m_uiActionInitiator = 90;
    this->ConfigurationForAction[47][0].m_uiSetOrder = v23;
    CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_IN);
    v26 = this->ConfigurationForAction[8][0].m_uiActionInitiator;
    v27 = this->ConfigurationForAction[8][2].m_uiActionInitiator;
    v28 = this->ConfigurationForAction[8][1].m_uiActionInitiator;
    v29 = this->ConfigurationForAction[8][3].m_uiActionInitiator;
    this->ConfigurationForAction[8][1].m_uiActionInitiator = 89;
    v30 = v26 == 1056;
  }
  else
  {
    v22->m_uiActionInitiator = 89;
    this->ConfigurationForAction[47][0].m_uiSetOrder = v23;
    CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_IN);
    v27 = this->ConfigurationForAction[8][2].m_uiActionInitiator;
    v28 = this->ConfigurationForAction[8][1].m_uiActionInitiator;
    v29 = this->ConfigurationForAction[8][3].m_uiActionInitiator;
    v31 = this->ConfigurationForAction[8][0].m_uiActionInitiator;
    v467->ConfigurationForAction[8][1].m_uiActionInitiator = 88;
    v30 = v31 == 1056;
  }
  v32 = 0;
  if ( !v30 )
  {
    v32 = 1;
    v3 = 2;
  }
  if ( v28 == 1056 )
    v3 = v32;
  if ( v27 )
    ++v3;
  v33 = v3 + 1;
  if ( v29 )
    v33 = v3 + 2;
  v467->ConfigurationForAction[8][1].m_uiSetOrder = v33;
  v34 = FrontEndMenuManager.m_PrefsKeyboardLanguage;
  CControllerConfigManager::ResetSettingOrder(v467, GO_FORWARD);
  v35 = 1;
  v36 = 0;
  v37 = 1;
  v38 = 0;
  if ( v444->m_uiActionInitiator != 1056 )
  {
    v38 = 1;
    v35 = 2;
  }
  if ( v25->m_uiActionInitiator == 1056 )
    v35 = v38;
  if ( v448->m_uiActionInitiator )
    ++v35;
  v39 = v35 + 1;
  if ( v446->m_uiActionInitiator )
    v39 = v35 + 2;
  if ( v34 == LANGUAGE_FRENCH )
  {
    v25->m_uiActionInitiator = 90;
    v40 = v467;
    v467->ConfigurationForAction[4][1].m_uiSetOrder = v39;
    CControllerConfigManager::ResetSettingOrder(v467, GO_LEFT);
    v41 = v24->m_uiActionInitiator;
    v30 = v454->m_uiActionInitiator == 1056;
    v42 = v450->m_uiActionInitiator;
    v43 = v452->m_uiActionInitiator;
    v44 = 0;
    v24->m_uiActionInitiator = 81;
    v45 = 1;
    if ( !v30 )
    {
      v44 = 1;
      v45 = 2;
    }
    if ( v41 == 1056 )
      v45 = v44;
    if ( v43 )
      ++v45;
    v46 = v45 + 1;
    if ( v42 )
      v46 = v45 + 2;
    v467->ConfigurationForAction[6][1].m_uiSetOrder = v46;
    CControllerConfigManager::ResetSettingOrder(v467, PED_CYCLE_WEAPON_LEFT);
    v47 = v467->ConfigurationForAction[3][0].m_uiActionInitiator;
    v48 = v467->ConfigurationForAction[3][2].m_uiActionInitiator;
    v467->ConfigurationForAction[3][0].m_uiActionInitiator = 65;
    v30 = v47 == 1056;
    v49 = 0;
    v50 = 1;
    if ( !v30 )
    {
      v49 = 1;
      v50 = 2;
    }
    if ( v467->ConfigurationForAction[3][1].m_uiActionInitiator == 1056 )
      v50 = v49;
    if ( v48 )
      ++v50;
    v51 = v50 + 1;
    if ( v467->ConfigurationForAction[3][3].m_uiActionInitiator )
      v51 = v50 + 2;
    v467->ConfigurationForAction[3][0].m_uiSetOrder = v51;
    CControllerConfigManager::ResetSettingOrder(v467, PED_SNIPER_ZOOM_OUT);
    v52 = 87;
  }
  else
  {
    v25->m_uiActionInitiator = 87;
    v40 = v467;
    v467->ConfigurationForAction[4][1].m_uiSetOrder = v39;
    CControllerConfigManager::ResetSettingOrder(v467, GO_LEFT);
    v53 = v24->m_uiActionInitiator;
    v30 = v454->m_uiActionInitiator == 1056;
    v54 = v450->m_uiActionInitiator;
    v55 = v452->m_uiActionInitiator;
    v56 = 0;
    v24->m_uiActionInitiator = 65;
    v57 = 1;
    if ( !v30 )
    {
      v56 = 1;
      v57 = 2;
    }
    if ( v53 == 1056 )
      v57 = v56;
    if ( v55 )
      ++v57;
    v58 = v57 + 1;
    if ( v54 )
      v58 = v57 + 2;
    v467->ConfigurationForAction[6][1].m_uiSetOrder = v58;
    CControllerConfigManager::ResetSettingOrder(v467, PED_CYCLE_WEAPON_LEFT);
    v59 = v467->ConfigurationForAction[3][0].m_uiActionInitiator;
    v60 = v467->ConfigurationForAction[3][2].m_uiActionInitiator;
    v467->ConfigurationForAction[3][0].m_uiActionInitiator = 81;
    v30 = v59 == 1056;
    v61 = 0;
    v62 = 1;
    if ( !v30 )
    {
      v61 = 1;
      v62 = 2;
    }
    if ( v467->ConfigurationForAction[3][1].m_uiActionInitiator == 1056 )
      v62 = v61;
    if ( v60 )
      ++v62;
    v63 = v62 + 1;
    if ( v467->ConfigurationForAction[3][3].m_uiActionInitiator )
      v63 = v62 + 2;
    v467->ConfigurationForAction[3][0].m_uiSetOrder = v63;
    CControllerConfigManager::ResetSettingOrder(v467, PED_SNIPER_ZOOM_OUT);
    v52 = 90;
  }
  v64 = v40->ConfigurationForAction[9][1].m_uiActionInitiator;
  v40->ConfigurationForAction[9][1].m_uiActionInitiator = v52;
  if ( v40->ConfigurationForAction[9][0].m_uiActionInitiator != 1056 )
  {
    v36 = 1;
    v37 = 2;
  }
  if ( v64 == 1056 )
    v37 = v36;
  if ( v40->ConfigurationForAction[9][2].m_uiActionInitiator )
    ++v37;
  v65 = v37 + 1;
  if ( v40->ConfigurationForAction[9][3].m_uiActionInitiator )
    v65 = v37 + 2;
  v451 = &v40->ConfigurationForAction[9][1];
  v455 = v40->ConfigurationForAction[9];
  v447 = &v40->ConfigurationForAction[3][3];
  v445 = v40->ConfigurationForAction[3];
  v449 = &v40->ConfigurationForAction[9][2];
  v453 = &v40->ConfigurationForAction[9][3];
  v66 = &v40->ConfigurationForAction[3][1];
  v467->ConfigurationForAction[9][1].m_uiSetOrder = v65;
  v67 = &v40->ConfigurationForAction[3][2];
  CControllerConfigManager::ResetSettingOrder(v467, GO_BACK);
  v68 = v460->m_uiActionInitiator;
  v30 = v458->m_uiActionInitiator == 1056;
  v69 = v457->m_uiActionInitiator;
  v70 = v456->m_uiActionInitiator;
  v71 = 0;
  v460->m_uiActionInitiator = 83;
  v72 = 1;
  if ( !v30 )
  {
    v71 = 1;
    v72 = 2;
  }
  if ( v68 == 1056 )
    v72 = v71;
  if ( v70 )
    ++v72;
  v73 = v72 + 1;
  if ( v69 )
    v73 = v72 + 2;
  v467->ConfigurationForAction[5][1].m_uiSetOrder = v73;
  CControllerConfigManager::ResetSettingOrder(v467, GO_RIGHT);
  v74 = v465->m_uiActionInitiator;
  v30 = v464->m_uiActionInitiator == 1056;
  v75 = v463->m_uiActionInitiator;
  v76 = v462->m_uiActionInitiator;
  v77 = 0;
  v465->m_uiActionInitiator = 68;
  v78 = 1;
  if ( !v30 )
  {
    v77 = 1;
    v78 = 2;
  }
  if ( v74 == 1056 )
    v78 = v77;
  if ( v76 )
    ++v78;
  v79 = v78 + 1;
  if ( v75 )
    v79 = v78 + 2;
  v467->ConfigurationForAction[7][1].m_uiSetOrder = v79;
  CControllerConfigManager::ResetSettingOrder(v467, PED_CYCLE_WEAPON_RIGHT);
  v80 = v467->ConfigurationForAction[2][0].m_uiActionInitiator;
  v467->ConfigurationForAction[2][0].m_uiActionInitiator = 69;
  v30 = v80 == 1056;
  v81 = 0;
  v82 = 1;
  if ( !v30 )
  {
    v81 = 1;
    v82 = 2;
  }
  if ( v467->ConfigurationForAction[2][1].m_uiActionInitiator == 1056 )
    v82 = v81;
  if ( v467->ConfigurationForAction[2][2].m_uiActionInitiator )
    ++v82;
  v83 = v82 + 1;
  if ( v467->ConfigurationForAction[2][3].m_uiActionInitiator )
    v83 = v82 + 2;
  v467->ConfigurationForAction[2][0].m_uiSetOrder = v83;
  CControllerConfigManager::ResetSettingOrder(v467, PED_CYCLE_WEAPON_RIGHT);
  v84 = v467->ConfigurationForAction[2][1].m_uiActionInitiator;
  v85 = v467->ConfigurationForAction[2][0].m_uiActionInitiator == 1056;
  v86 = v467->ConfigurationForAction[2][2].m_uiActionInitiator;
  v87 = 0;
  v88 = v467->ConfigurationForAction[2][3].m_uiActionInitiator;
  v467->ConfigurationForAction[2][1].m_uiActionInitiator = 1039;
  if ( !v85 )
    v87 = 1;
  v89 = 1;
  if ( !v85 )
    v89 = 2;
  if ( v84 == 1056 )
    v89 = v87;
  if ( v86 )
    ++v89;
  v90 = v89 + 1;
  if ( v88 )
    v90 = v89 + 2;
  v467->ConfigurationForAction[2][1].m_uiSetOrder = v90;
  CControllerConfigManager::ResetSettingOrder(v467, PED_CYCLE_WEAPON_LEFT);
  v91 = v66->m_uiActionInitiator;
  v92 = v447->m_uiActionInitiator;
  v93 = v67->m_uiActionInitiator;
  v30 = v445->m_uiActionInitiator == 1056;
  v66->m_uiActionInitiator = 1027;
  v94 = 0;
  v95 = 1;
  if ( !v30 )
  {
    v94 = 1;
    v95 = 2;
  }
  if ( v91 == 1056 )
    v95 = v94;
  if ( v93 )
    ++v95;
  v96 = v95 + 1;
  if ( v92 )
    v96 = v95 + 2;
  v467->ConfigurationForAction[3][1].m_uiSetOrder = v96;
  CControllerConfigManager::ResetSettingOrder(v467, PED_FIREWEAPON);
  v97 = v467->ConfigurationForAction[0][0].m_uiActionInitiator;
  v467->ConfigurationForAction[0][0].m_uiActionInitiator = 1038;
  v30 = v97 == 1056;
  v98 = 0;
  v99 = 1;
  if ( !v30 )
  {
    v98 = 1;
    v99 = 2;
  }
  if ( v467->ConfigurationForAction[0][1].m_uiActionInitiator == 1056 )
    v99 = v98;
  if ( v467->ConfigurationForAction[0][2].m_uiActionInitiator )
    ++v99;
  v100 = v99 + 1;
  if ( v467->ConfigurationForAction[0][3].m_uiActionInitiator )
    v100 = v99 + 2;
  v467->ConfigurationForAction[0][0].m_uiSetOrder = v100;
  CControllerConfigManager::ResetSettingOrder(v467, PED_FIREWEAPON);
  v101 = v467->ConfigurationForAction[0][3].m_uiActionInitiator;
  v102 = v467->ConfigurationForAction[0][1].m_uiActionInitiator;
  v103 = v467->ConfigurationForAction[0][2].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[0][0].m_uiActionInitiator == 1056;
  v467->ConfigurationForAction[0][1].m_uiActionInitiator = 1049;
  v104 = 0;
  v105 = 1;
  if ( !v30 )
  {
    v104 = 1;
    v105 = 2;
  }
  if ( v102 == 1056 )
    v105 = v104;
  if ( v103 )
    ++v105;
  v106 = v105 + 1;
  if ( v101 )
    v106 = v105 + 2;
  v467->ConfigurationForAction[0][1].m_uiSetOrder = v106;
  CControllerConfigManager::ResetSettingOrder(v467, PED_SNIPER_ZOOM_IN);
  v107 = v467->ConfigurationForAction[8][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[8][0].m_uiActionInitiator == 1056;
  v108 = v467->ConfigurationForAction[8][2].m_uiActionInitiator;
  v109 = 1;
  v110 = v467->ConfigurationForAction[8][3].m_uiActionInitiator;
  v467->ConfigurationForAction[8][0].m_uiActionInitiator = 1017;
  v111 = 0;
  if ( !v30 )
  {
    v111 = 1;
    v109 = 2;
  }
  if ( v107 == 1056 )
    v109 = v111;
  if ( v108 )
    ++v109;
  v112 = v109 + 1;
  if ( v110 )
    v112 = v109 + 2;
  v467->ConfigurationForAction[8][0].m_uiSetOrder = v112;
  CControllerConfigManager::ResetSettingOrder(v467, PED_SNIPER_ZOOM_OUT);
  v113 = v451->m_uiActionInitiator;
  v30 = v455->m_uiActionInitiator == 1056;
  v114 = v453->m_uiActionInitiator;
  v115 = v449->m_uiActionInitiator;
  v116 = 0;
  v455->m_uiActionInitiator = 1018;
  v117 = 1;
  if ( !v30 )
  {
    v116 = 1;
    v117 = 2;
  }
  if ( v113 == 1056 )
    v117 = v116;
  if ( v115 )
    ++v117;
  v118 = v117 + 1;
  if ( v114 )
    v118 = v117 + 2;
  v467->ConfigurationForAction[9][0].m_uiSetOrder = v118;
  CControllerConfigManager::ResetSettingOrder(v467, PED_FIREWEAPON_ALT);
  v119 = v467->ConfigurationForAction[1][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[1][0].m_uiActionInitiator == 1056;
  v120 = v467->ConfigurationForAction[1][2].m_uiActionInitiator;
  v121 = 1;
  v122 = v467->ConfigurationForAction[1][3].m_uiActionInitiator;
  v467->ConfigurationForAction[1][0].m_uiActionInitiator = 92;
  v123 = 0;
  if ( !v30 )
  {
    v123 = 1;
    v121 = 2;
  }
  if ( v119 == 1056 )
    v121 = v123;
  if ( v120 )
    ++v121;
  v124 = v121 + 1;
  if ( v122 )
    v124 = v121 + 2;
  v467->ConfigurationForAction[1][0].m_uiSetOrder = v124;
  CControllerConfigManager::ResetSettingOrder(v467, GROUP_CONTROL_FWD);
  v125 = v467->ConfigurationForAction[49][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[49][0].m_uiActionInitiator == 1056;
  v126 = v467->ConfigurationForAction[49][2].m_uiActionInitiator;
  v127 = 1;
  v128 = v467->ConfigurationForAction[49][3].m_uiActionInitiator;
  v467->ConfigurationForAction[49][0].m_uiActionInitiator = 71;
  v129 = 0;
  if ( !v30 )
  {
    v129 = 1;
    v127 = 2;
  }
  if ( v125 == 1056 )
    v127 = v129;
  if ( v126 )
    ++v127;
  v130 = v127 + 1;
  if ( v128 )
    v130 = v127 + 2;
  v467->ConfigurationForAction[49][0].m_uiSetOrder = v130;
  CControllerConfigManager::ResetSettingOrder(v467, GROUP_CONTROL_BWD);
  v131 = v467->ConfigurationForAction[50][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[50][0].m_uiActionInitiator == 1056;
  v132 = v467->ConfigurationForAction[50][2].m_uiActionInitiator;
  v133 = 1;
  v134 = v467->ConfigurationForAction[50][3].m_uiActionInitiator;
  v467->ConfigurationForAction[50][0].m_uiActionInitiator = 72;
  v135 = 0;
  if ( !v30 )
  {
    v135 = 1;
    v133 = 2;
  }
  if ( v131 == 1056 )
    v133 = v135;
  if ( v132 )
    ++v133;
  v136 = v133 + 1;
  if ( v134 )
    v136 = v133 + 2;
  v467->ConfigurationForAction[50][0].m_uiSetOrder = v136;
  CControllerConfigManager::ResetSettingOrder(v467, CONVERSATION_NO);
  v137 = v467->ConfigurationForAction[48][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[48][0].m_uiActionInitiator == 1056;
  v138 = v467->ConfigurationForAction[48][2].m_uiActionInitiator;
  v139 = 1;
  v140 = v467->ConfigurationForAction[48][3].m_uiActionInitiator;
  v467->ConfigurationForAction[48][0].m_uiActionInitiator = 78;
  v141 = 0;
  if ( !v30 )
  {
    v141 = 1;
    v139 = 2;
  }
  if ( v137 == 1056 )
    v139 = v141;
  if ( v138 )
    ++v139;
  v142 = v139 + 1;
  if ( v140 )
    v142 = v139 + 2;
  v467->ConfigurationForAction[48][0].m_uiSetOrder = v142;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_ENTER_EXIT);
  v143 = v467->ConfigurationForAction[10][1].m_uiActionInitiator;
  v467->ConfigurationForAction[10][1].m_uiActionInitiator = 70;
  v144 = 1;
  v145 = 0;
  if ( v467->ConfigurationForAction[10][0].m_uiActionInitiator != 1056 )
  {
    v145 = 1;
    v144 = 2;
  }
  if ( v143 == 1056 )
    v144 = v145;
  if ( v467->ConfigurationForAction[10][2].m_uiActionInitiator )
    ++v144;
  v146 = v144 + 1;
  if ( v467->ConfigurationForAction[10][3].m_uiActionInitiator )
    v146 = v144 + 2;
  v467->ConfigurationForAction[10][1].m_uiSetOrder = v146;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_ENTER_EXIT);
  v147 = v467->ConfigurationForAction[10][3].m_uiActionInitiator;
  v148 = v467->ConfigurationForAction[10][1].m_uiActionInitiator;
  v149 = v467->ConfigurationForAction[10][2].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[10][0].m_uiActionInitiator == 1056;
  v467->ConfigurationForAction[10][0].m_uiActionInitiator = 1045;
  v150 = 0;
  v151 = 1;
  if ( !v30 )
  {
    v150 = 1;
    v151 = 2;
  }
  if ( v148 == 1056 )
    v151 = v150;
  if ( v149 )
    ++v151;
  v152 = v151 + 1;
  if ( v147 )
    v152 = v151 + 2;
  v467->ConfigurationForAction[10][0].m_uiSetOrder = v152;
  CControllerConfigManager::ResetSettingOrder(v467, CAMERA_CHANGE_VIEW_ALL_SITUATIONS);
  v153 = v467->ConfigurationForAction[11][0].m_uiActionInitiator;
  v467->ConfigurationForAction[11][0].m_uiActionInitiator = 86;
  v30 = v153 == 1056;
  v154 = 0;
  v155 = 1;
  if ( !v30 )
  {
    v154 = 1;
    v155 = 2;
  }
  if ( v467->ConfigurationForAction[11][1].m_uiActionInitiator == 1056 )
    v155 = v154;
  if ( v467->ConfigurationForAction[11][2].m_uiActionInitiator )
    ++v155;
  v156 = v155 + 1;
  if ( v467->ConfigurationForAction[11][3].m_uiActionInitiator )
    v156 = v155 + 2;
  v467->ConfigurationForAction[11][0].m_uiSetOrder = v156;
  CControllerConfigManager::ResetSettingOrder(v467, CAMERA_CHANGE_VIEW_ALL_SITUATIONS);
  v157 = v467->ConfigurationForAction[11][3].m_uiActionInitiator;
  v158 = v467->ConfigurationForAction[11][1].m_uiActionInitiator;
  v159 = v467->ConfigurationForAction[11][2].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[11][0].m_uiActionInitiator == 1056;
  v467->ConfigurationForAction[11][1].m_uiActionInitiator = 1015;
  v160 = 0;
  v161 = 1;
  if ( !v30 )
  {
    v160 = 1;
    v161 = 2;
  }
  if ( v158 == 1056 )
    v161 = v160;
  if ( v159 )
    ++v161;
  v162 = v161 + 1;
  if ( v157 )
    v162 = v161 + 2;
  v467->ConfigurationForAction[11][1].m_uiSetOrder = v162;
  CControllerConfigManager::ResetSettingOrder(v467, PED_JUMPING);
  v163 = v467->ConfigurationForAction[12][0].m_uiActionInitiator;
  v467->ConfigurationForAction[12][0].m_uiActionInitiator = 1046;
  v30 = v163 == 1056;
  v164 = 0;
  v165 = 1;
  if ( !v30 )
  {
    v164 = 1;
    v165 = 2;
  }
  if ( v467->ConfigurationForAction[12][1].m_uiActionInitiator == 1056 )
    v165 = v164;
  if ( v467->ConfigurationForAction[12][2].m_uiActionInitiator )
    ++v165;
  v166 = v165 + 1;
  if ( v467->ConfigurationForAction[12][3].m_uiActionInitiator )
    v166 = v165 + 2;
  v467->ConfigurationForAction[12][0].m_uiSetOrder = v166;
  CControllerConfigManager::ResetSettingOrder(v467, PED_JUMPING);
  v167 = v467->ConfigurationForAction[12][3].m_uiActionInitiator;
  v168 = v467->ConfigurationForAction[12][1].m_uiActionInitiator;
  v169 = v467->ConfigurationForAction[12][2].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[12][0].m_uiActionInitiator == 1056;
  v467->ConfigurationForAction[12][1].m_uiActionInitiator = 1050;
  v170 = 0;
  v171 = 1;
  if ( !v30 )
  {
    v170 = 1;
    v171 = 2;
  }
  if ( v168 == 1056 )
    v171 = v170;
  if ( v169 )
    ++v171;
  v172 = v171 + 1;
  if ( v167 )
    v172 = v171 + 2;
  v467->ConfigurationForAction[12][1].m_uiSetOrder = v172;
  CControllerConfigManager::ResetSettingOrder(v467, PED_SPRINT);
  v173 = v467->ConfigurationForAction[13][0].m_uiActionInitiator;
  v174 = v467->ConfigurationForAction[13][2].m_uiActionInitiator;
  v175 = v467->ConfigurationForAction[13][3].m_uiActionInitiator;
  v467->ConfigurationForAction[13][0].m_uiActionInitiator = 32;
  v30 = v173 == 1056;
  v176 = 0;
  v177 = 1;
  if ( !v30 )
  {
    v176 = 1;
    v177 = 2;
  }
  if ( v467->ConfigurationForAction[13][1].m_uiActionInitiator == 1056 )
    v177 = v176;
  if ( v174 )
    ++v177;
  v178 = v177 + 1;
  if ( v175 )
    v178 = v177 + 2;
  v467->ConfigurationForAction[13][0].m_uiSetOrder = v178;
  CControllerConfigManager::ResetSettingOrder(v467, PED_DUCK);
  v179 = v467->ConfigurationForAction[15][0].m_uiActionInitiator;
  v180 = v467->ConfigurationForAction[15][2].m_uiActionInitiator;
  v181 = v467->ConfigurationForAction[15][3].m_uiActionInitiator;
  v467->ConfigurationForAction[15][0].m_uiActionInitiator = 67;
  v30 = v179 == 1056;
  v182 = 0;
  v183 = 1;
  if ( !v30 )
  {
    v182 = 1;
    v183 = 2;
  }
  if ( v467->ConfigurationForAction[15][1].m_uiActionInitiator == 1056 )
    v183 = v182;
  if ( v180 )
    ++v183;
  v184 = v183 + 1;
  if ( v181 )
    v184 = v183 + 2;
  v467->ConfigurationForAction[15][0].m_uiSetOrder = v184;
  CControllerConfigManager::ResetSettingOrder(v467, PED_ANSWER_PHONE);
  v185 = v467->ConfigurationForAction[16][0].m_uiActionInitiator;
  v186 = v467->ConfigurationForAction[16][2].m_uiActionInitiator;
  v187 = v467->ConfigurationForAction[16][3].m_uiActionInitiator;
  v467->ConfigurationForAction[16][0].m_uiActionInitiator = 1043;
  v30 = v185 == 1056;
  v188 = 0;
  v189 = 1;
  if ( !v30 )
  {
    v188 = 1;
    v189 = 2;
  }
  if ( v467->ConfigurationForAction[16][1].m_uiActionInitiator == 1056 )
    v189 = v188;
  if ( v186 )
    ++v189;
  v190 = v189 + 1;
  if ( v187 )
    v190 = v189 + 2;
  v467->ConfigurationForAction[16][0].m_uiSetOrder = v190;
  CControllerConfigManager::ResetSettingOrder(v467, PED_WALK);
  v191 = v467->ConfigurationForAction[17][0].m_uiActionInitiator;
  v192 = v467->ConfigurationForAction[17][2].m_uiActionInitiator;
  v193 = v467->ConfigurationForAction[17][3].m_uiActionInitiator;
  v467->ConfigurationForAction[17][0].m_uiActionInitiator = 1051;
  v30 = v191 == 1056;
  v194 = 0;
  v195 = 1;
  if ( !v30 )
  {
    v194 = 1;
    v195 = 2;
  }
  if ( v467->ConfigurationForAction[17][1].m_uiActionInitiator == 1056 )
    v195 = v194;
  if ( v192 )
    ++v195;
  v196 = v195 + 1;
  if ( v193 )
    v196 = v195 + 2;
  v467->ConfigurationForAction[17][0].m_uiSetOrder = v196;
  CControllerConfigManager::ResetSettingOrder(v467, PED_LOCK_TARGET);
  v197 = v467->ConfigurationForAction[45][0].m_uiActionInitiator;
  v467->ConfigurationForAction[45][0].m_uiActionInitiator = 1014;
  v30 = v197 == 1056;
  v198 = 0;
  v199 = 1;
  if ( !v30 )
  {
    v198 = 1;
    v199 = 2;
  }
  if ( v467->ConfigurationForAction[45][1].m_uiActionInitiator == 1056 )
    v199 = v198;
  if ( v467->ConfigurationForAction[45][2].m_uiActionInitiator )
    ++v199;
  v200 = v199 + 1;
  if ( v467->ConfigurationForAction[45][3].m_uiActionInitiator )
    v200 = v199 + 2;
  v467->ConfigurationForAction[45][0].m_uiSetOrder = v200;
  CControllerConfigManager::ResetSettingOrder(v467, PED_LOCK_TARGET);
  v201 = v467->ConfigurationForAction[45][1].m_uiActionInitiator;
  v467->ConfigurationForAction[45][1].m_uiActionInitiator = 1044;
  v202 = 0;
  v203 = 1;
  if ( v467->ConfigurationForAction[45][0].m_uiActionInitiator != 1056 )
  {
    v202 = 1;
    v203 = 2;
  }
  if ( v201 == 1056 )
    v203 = v202;
  if ( v467->ConfigurationForAction[45][2].m_uiActionInitiator )
    ++v203;
  v204 = v203 + 1;
  if ( v467->ConfigurationForAction[45][3].m_uiActionInitiator )
    v204 = v203 + 2;
  v467->ConfigurationForAction[45][1].m_uiSetOrder = v204;
  CControllerConfigManager::ResetSettingOrder(v467, PED_1RST_PERSON_LOOK_LEFT);
  v205 = v467->ConfigurationForAction[32][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[32][0].m_uiActionInitiator == 1056;
  v206 = v467->ConfigurationForAction[32][2].m_uiActionInitiator;
  v207 = 1;
  v208 = v467->ConfigurationForAction[32][3].m_uiActionInitiator;
  v467->ConfigurationForAction[32][0].m_uiActionInitiator = 1031;
  v209 = 0;
  if ( !v30 )
  {
    v209 = 1;
    v207 = 2;
  }
  if ( v205 == 1056 )
    v207 = v209;
  if ( v206 )
    ++v207;
  v210 = v207 + 1;
  if ( v208 )
    v210 = v207 + 2;
  v467->ConfigurationForAction[32][0].m_uiSetOrder = v210;
  CControllerConfigManager::ResetSettingOrder(v467, PED_1RST_PERSON_LOOK_RIGHT);
  v211 = v467->ConfigurationForAction[33][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[33][0].m_uiActionInitiator == 1056;
  v212 = v467->ConfigurationForAction[33][2].m_uiActionInitiator;
  v213 = 1;
  v214 = v467->ConfigurationForAction[33][3].m_uiActionInitiator;
  v467->ConfigurationForAction[33][0].m_uiActionInitiator = 1034;
  v215 = 0;
  if ( !v30 )
  {
    v215 = 1;
    v213 = 2;
  }
  if ( v211 == 1056 )
    v213 = v215;
  if ( v212 )
    ++v213;
  v216 = v213 + 1;
  if ( v214 )
    v216 = v213 + 2;
  v467->ConfigurationForAction[33][0].m_uiSetOrder = v216;
  CControllerConfigManager::ResetSettingOrder(v467, PED_1RST_PERSON_LOOK_UP);
  v217 = v467->ConfigurationForAction[51][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[51][0].m_uiActionInitiator == 1056;
  v218 = v467->ConfigurationForAction[51][2].m_uiActionInitiator;
  v219 = 1;
  v220 = v467->ConfigurationForAction[51][3].m_uiActionInitiator;
  v467->ConfigurationForAction[51][0].m_uiActionInitiator = 1029;
  v221 = 0;
  if ( !v30 )
  {
    v221 = 1;
    v219 = 2;
  }
  if ( v217 == 1056 )
    v219 = v221;
  if ( v218 )
    ++v219;
  v222 = v219 + 1;
  if ( v220 )
    v222 = v219 + 2;
  v467->ConfigurationForAction[51][0].m_uiSetOrder = v222;
  CControllerConfigManager::ResetSettingOrder(v467, PED_1RST_PERSON_LOOK_DOWN);
  v223 = v467->ConfigurationForAction[52][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[52][0].m_uiActionInitiator == 1056;
  v224 = v467->ConfigurationForAction[52][2].m_uiActionInitiator;
  v225 = 1;
  v226 = v467->ConfigurationForAction[52][3].m_uiActionInitiator;
  v467->ConfigurationForAction[52][0].m_uiActionInitiator = 1036;
  v227 = 0;
  if ( !v30 )
  {
    v227 = 1;
    v225 = 2;
  }
  if ( v223 == 1056 )
    v225 = v227;
  if ( v224 )
    ++v225;
  v228 = v225 + 1;
  if ( v226 )
    v228 = v225 + 2;
  v467->ConfigurationForAction[52][0].m_uiSetOrder = v228;
  CControllerConfigManager::ResetSettingOrder(v467, PED_CENTER_CAMERA_BEHIND_PLAYER);
  v229 = v467->ConfigurationForAction[44][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[44][0].m_uiActionInitiator == 1056;
  v230 = v467->ConfigurationForAction[44][2].m_uiActionInitiator;
  v231 = 1;
  v232 = v467->ConfigurationForAction[44][3].m_uiActionInitiator;
  v467->ConfigurationForAction[44][0].m_uiActionInitiator = 35;
  v233 = 0;
  if ( !v30 )
  {
    v233 = 1;
    v231 = 2;
  }
  if ( v229 == 1056 )
    v231 = v233;
  if ( v230 )
    ++v231;
  v234 = v231 + 1;
  if ( v232 )
    v234 = v231 + 2;
  v467->ConfigurationForAction[44][0].m_uiSetOrder = v234;
  CControllerConfigManager::ResetSettingOrder(v467, PED_LOOKBEHIND);
  v235 = v467->ConfigurationForAction[14][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[14][0].m_uiActionInitiator == 1056;
  v236 = v467->ConfigurationForAction[14][2].m_uiActionInitiator;
  v237 = 1;
  v238 = v467->ConfigurationForAction[14][3].m_uiActionInitiator;
  v467->ConfigurationForAction[14][0].m_uiActionInitiator = 1028;
  v239 = 0;
  if ( !v30 )
  {
    v239 = 1;
    v237 = 2;
  }
  if ( v235 == 1056 )
    v237 = v239;
  if ( v236 )
    ++v237;
  v240 = v237 + 1;
  if ( v238 )
    v240 = v237 + 2;
  v467->ConfigurationForAction[14][0].m_uiSetOrder = v240;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_STEER_UP);
  v241 = v467->ConfigurationForAction[22][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[22][0].m_uiActionInitiator == 1056;
  v242 = v467->ConfigurationForAction[22][2].m_uiActionInitiator;
  v243 = 1;
  v244 = v467->ConfigurationForAction[22][3].m_uiActionInitiator;
  v467->ConfigurationForAction[22][0].m_uiActionInitiator = 1019;
  v245 = 0;
  if ( !v30 )
  {
    v245 = 1;
    v243 = 2;
  }
  if ( v241 == 1056 )
    v243 = v245;
  if ( v242 )
    ++v243;
  v246 = v243 + 1;
  if ( v244 )
    v246 = v243 + 2;
  v467->ConfigurationForAction[22][0].m_uiSetOrder = v246;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_STEER_DOWN);
  v247 = v467->ConfigurationForAction[23][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[23][0].m_uiActionInitiator == 1056;
  v248 = v467->ConfigurationForAction[23][2].m_uiActionInitiator;
  v249 = 1;
  v250 = v467->ConfigurationForAction[23][3].m_uiActionInitiator;
  v467->ConfigurationForAction[23][0].m_uiActionInitiator = 1020;
  v251 = 0;
  if ( !v30 )
  {
    v251 = 1;
    v249 = 2;
  }
  if ( v247 == 1056 )
    v249 = v251;
  if ( v248 )
    ++v249;
  v252 = v249 + 1;
  if ( v250 )
    v252 = v249 + 2;
  v467->ConfigurationForAction[23][0].m_uiSetOrder = v252;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_RADIO_STATION_UP);
  v253 = v467->ConfigurationForAction[26][0].m_uiActionInitiator;
  v467->ConfigurationForAction[26][0].m_uiActionInitiator = 1013;
  v30 = v253 == 1056;
  v254 = 0;
  v255 = 1;
  if ( !v30 )
  {
    v254 = 1;
    v255 = 2;
  }
  if ( v467->ConfigurationForAction[26][1].m_uiActionInitiator == 1056 )
    v255 = v254;
  if ( v467->ConfigurationForAction[26][2].m_uiActionInitiator )
    ++v255;
  v256 = v255 + 1;
  if ( v467->ConfigurationForAction[26][3].m_uiActionInitiator )
    v256 = v255 + 2;
  v467->ConfigurationForAction[26][0].m_uiSetOrder = v256;
  v257 = FrontEndMenuManager.m_PrefsKeyboardLanguage;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_STEER_LEFT);
  v258 = 1;
  v259 = 0;
  if ( v467->ConfigurationForAction[20][0].m_uiActionInitiator != 1056 )
  {
    v259 = 1;
    v258 = 2;
  }
  v260 = v467->ConfigurationForAction[26];
  if ( v467->ConfigurationForAction[20][1].m_uiActionInitiator == 1056 )
    v258 = v259;
  if ( v467->ConfigurationForAction[20][2].m_uiActionInitiator )
    ++v258;
  v261 = v258 + 1;
  if ( v467->ConfigurationForAction[20][3].m_uiActionInitiator )
    v261 = v258 + 2;
  v466 = &v467->ConfigurationForAction[20][1];
  v262 = v467->ConfigurationForAction[20];
  v459 = &v467->ConfigurationForAction[26][3];
  v461 = &v467->ConfigurationForAction[26][2];
  v263 = &v467->ConfigurationForAction[26][1];
  if ( v257 == LANGUAGE_FRENCH )
  {
    v262->m_uiActionInitiator = 81;
    v264 = v467;
    v467->ConfigurationForAction[20][0].m_uiSetOrder = v261;
    CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_LOOKLEFT);
    v265 = v467->ConfigurationForAction[34][0].m_uiActionInitiator;
    v266 = v467->ConfigurationForAction[34][1].m_uiActionInitiator;
    v267 = v467->ConfigurationForAction[34][2].m_uiActionInitiator;
    v268 = v467->ConfigurationForAction[34][3].m_uiActionInitiator;
    v467->ConfigurationForAction[34][0].m_uiActionInitiator = 65;
    v269 = 0;
    v270 = 1;
    if ( v265 != 1056 )
    {
      v269 = 1;
      v270 = 2;
    }
    if ( v266 == 1056 )
      v270 = v269;
    if ( v267 )
      ++v270;
    v271 = v270 + 1;
    if ( v268 )
      v271 = v270 + 2;
    v467->ConfigurationForAction[34][0].m_uiSetOrder = v271;
    CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_RADIO_STATION_UP);
    v272 = v263->m_uiActionInitiator;
    v30 = v260->m_uiActionInitiator == 1056;
    v273 = v459->m_uiActionInitiator;
    v274 = v461->m_uiActionInitiator;
    v275 = 0;
    v263->m_uiActionInitiator = 96;
    v276 = 1;
    if ( !v30 )
    {
      v275 = 1;
      v276 = 2;
    }
    if ( v272 == 1056 )
      v276 = v275;
    if ( v274 )
      ++v276;
    v277 = v276 + 1;
    if ( v273 )
      v277 = v276 + 2;
    v467->ConfigurationForAction[26][1].m_uiSetOrder = v277;
    CControllerConfigManager::ResetSettingOrder(v467, TOGGLE_SUBMISSIONS);
    v278 = v467->ConfigurationForAction[30][0].m_uiActionInitiator;
    v467->ConfigurationForAction[30][0].m_uiActionInitiator = 233;
    v30 = v278 == 1056;
    v279 = 0;
    v280 = 1;
    if ( !v30 )
    {
      v279 = 1;
      v280 = 2;
    }
    if ( v467->ConfigurationForAction[30][1].m_uiActionInitiator == 1056 )
      v280 = v279;
    if ( v467->ConfigurationForAction[30][2].m_uiActionInitiator )
      ++v280;
    v281 = v280 + 1;
    if ( v467->ConfigurationForAction[30][3].m_uiActionInitiator )
      v281 = v280 + 2;
    v467->ConfigurationForAction[30][0].m_uiSetOrder = v281;
    CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_ACCELERATE);
    v282 = v467->ConfigurationForAction[24][0].m_uiActionInitiator;
    v283 = 1;
    v467->ConfigurationForAction[24][0].m_uiActionInitiator = 90;
    v30 = v282 == 1056;
    v284 = 0;
    if ( !v30 )
    {
      v284 = 1;
      v283 = 2;
    }
    v285 = &v467->ConfigurationForAction[30][3];
    if ( v467->ConfigurationForAction[24][1].m_uiActionInitiator == 1056 )
      v283 = v284;
    if ( v467->ConfigurationForAction[24][2].m_uiActionInitiator )
      ++v283;
    v286 = v283 + 1;
    v287 = &v467->ConfigurationForAction[30][2];
    v288 = v467->ConfigurationForAction[24][3].m_uiActionInitiator == 0;
    v289 = &v467->ConfigurationForAction[30][1];
  }
  else
  {
    v262->m_uiActionInitiator = 65;
    v264 = v467;
    v467->ConfigurationForAction[20][0].m_uiSetOrder = v261;
    CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_LOOKLEFT);
    v290 = v467->ConfigurationForAction[34][1].m_uiActionInitiator;
    v30 = v467->ConfigurationForAction[34][0].m_uiActionInitiator == 1056;
    v291 = v467->ConfigurationForAction[34][2].m_uiActionInitiator;
    v292 = 1;
    v293 = v467->ConfigurationForAction[34][3].m_uiActionInitiator;
    v467->ConfigurationForAction[34][0].m_uiActionInitiator = 81;
    v294 = 0;
    if ( !v30 )
    {
      v294 = 1;
      v292 = 2;
    }
    if ( v290 == 1056 )
      v292 = v294;
    if ( v291 )
      ++v292;
    v295 = v292 + 1;
    if ( v293 )
      v295 = v292 + 2;
    v467->ConfigurationForAction[34][0].m_uiSetOrder = v295;
    CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_RADIO_STATION_UP);
    v296 = v263->m_uiActionInitiator;
    v30 = v260->m_uiActionInitiator == 1056;
    v297 = v459->m_uiActionInitiator;
    v298 = v461->m_uiActionInitiator;
    v299 = 0;
    v263->m_uiActionInitiator = 52;
    v300 = 1;
    if ( !v30 )
    {
      v299 = 1;
      v300 = 2;
    }
    if ( v296 == 1056 )
      v300 = v299;
    if ( v298 )
      ++v300;
    v301 = v300 + 1;
    if ( v297 )
      v301 = v300 + 2;
    v467->ConfigurationForAction[26][1].m_uiSetOrder = v301;
    CControllerConfigManager::ResetSettingOrder(v467, TOGGLE_SUBMISSIONS);
    v302 = v467->ConfigurationForAction[30][0].m_uiActionInitiator;
    v467->ConfigurationForAction[30][0].m_uiActionInitiator = 50;
    v30 = v302 == 1056;
    v303 = 0;
    v304 = 1;
    if ( !v30 )
    {
      v303 = 1;
      v304 = 2;
    }
    if ( v467->ConfigurationForAction[30][1].m_uiActionInitiator == 1056 )
      v304 = v303;
    if ( v467->ConfigurationForAction[30][2].m_uiActionInitiator )
      ++v304;
    v305 = v304 + 1;
    if ( v467->ConfigurationForAction[30][3].m_uiActionInitiator )
      v305 = v304 + 2;
    v467->ConfigurationForAction[30][0].m_uiSetOrder = v305;
    CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_ACCELERATE);
    v306 = v467->ConfigurationForAction[24][0].m_uiActionInitiator;
    v283 = 1;
    v467->ConfigurationForAction[24][0].m_uiActionInitiator = 87;
    v30 = v306 == 1056;
    v307 = 0;
    if ( !v30 )
    {
      v307 = 1;
      v283 = 2;
    }
    v287 = &v467->ConfigurationForAction[30][2];
    if ( v467->ConfigurationForAction[24][1].m_uiActionInitiator == 1056 )
      v283 = v307;
    if ( v467->ConfigurationForAction[24][2].m_uiActionInitiator )
      ++v283;
    v286 = v283 + 1;
    v285 = &v467->ConfigurationForAction[30][3];
    v288 = v467->ConfigurationForAction[24][3].m_uiActionInitiator == 0;
    v289 = &v467->ConfigurationForAction[30][1];
  }
  if ( !v288 )
    v286 = v283 + 2;
  v467->ConfigurationForAction[24][0].m_uiSetOrder = v286;
  CControllerConfigManager::ResetSettingOrder(v467, TOGGLE_SUBMISSIONS);
  v308 = v264->ConfigurationForAction[30][0].m_uiActionInitiator;
  v309 = v289->m_uiActionInitiator;
  v310 = 1;
  v30 = v308 == 1056;
  v311 = v287->m_uiActionInitiator;
  v312 = 0;
  v313 = v285->m_uiActionInitiator;
  v289->m_uiActionInitiator = 1025;
  if ( !v30 )
  {
    v312 = 1;
    v310 = 2;
  }
  if ( v309 == 1056 )
    v310 = v312;
  if ( v311 )
    ++v310;
  v314 = v310 + 1;
  if ( v313 )
    v314 = v310 + 2;
  v315 = 0;
  v467->ConfigurationForAction[30][1].m_uiSetOrder = v314;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_FIREWEAPON);
  v316 = 1;
  v317 = 0;
  if ( v467->ConfigurationForAction[18][0].m_uiActionInitiator != 1056 )
  {
    v317 = 1;
    v316 = 2;
  }
  if ( v467->ConfigurationForAction[18][1].m_uiActionInitiator == 1056 )
    v316 = v317;
  if ( v467->ConfigurationForAction[18][2].m_uiActionInitiator )
    ++v316;
  v318 = v316 + 1;
  if ( v467->ConfigurationForAction[18][3].m_uiActionInitiator )
    v318 = v316 + 2;
  v467->ConfigurationForAction[18][0].m_uiSetOrder = v318;
  v467->ConfigurationForAction[18][0].m_uiActionInitiator = 1050;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_FIREWEAPON);
  v319 = v467->ConfigurationForAction[18][1].m_uiActionInitiator;
  v467->ConfigurationForAction[18][1].m_uiActionInitiator = 1051;
  v320 = 1;
  v321 = 0;
  if ( v467->ConfigurationForAction[18][0].m_uiActionInitiator != 1056 )
  {
    v321 = 1;
    v320 = 2;
  }
  if ( v319 == 1056 )
    v320 = v321;
  if ( v467->ConfigurationForAction[18][2].m_uiActionInitiator )
    ++v320;
  v322 = v320 + 1;
  if ( v467->ConfigurationForAction[18][3].m_uiActionInitiator )
    v322 = v320 + 2;
  v467->ConfigurationForAction[18][1].m_uiSetOrder = v322;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_FIREWEAPON_ALT);
  v323 = v467->ConfigurationForAction[19][0].m_uiActionInitiator;
  v467->ConfigurationForAction[19][0].m_uiActionInitiator = 1049;
  v30 = v323 == 1056;
  v324 = 0;
  v325 = 1;
  if ( !v30 )
  {
    v324 = 1;
    v325 = 2;
  }
  if ( v467->ConfigurationForAction[19][1].m_uiActionInitiator == 1056 )
    v325 = v324;
  if ( v467->ConfigurationForAction[19][2].m_uiActionInitiator )
    ++v325;
  v326 = v325 + 1;
  if ( v467->ConfigurationForAction[19][3].m_uiActionInitiator )
    v326 = v325 + 2;
  v467->ConfigurationForAction[19][0].m_uiSetOrder = v326;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_FIREWEAPON_ALT);
  v327 = v467->ConfigurationForAction[19][1].m_uiActionInitiator;
  v467->ConfigurationForAction[19][1].m_uiActionInitiator = 1038;
  v328 = 1;
  v329 = 0;
  if ( v467->ConfigurationForAction[19][0].m_uiActionInitiator != 1056 )
  {
    v329 = 1;
    v328 = 2;
  }
  if ( v327 == 1056 )
    v328 = v329;
  if ( v467->ConfigurationForAction[19][2].m_uiActionInitiator )
    ++v328;
  v330 = v328 + 1;
  if ( v467->ConfigurationForAction[19][3].m_uiActionInitiator )
    v330 = v328 + 2;
  v467->ConfigurationForAction[19][1].m_uiSetOrder = v330;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_BRAKE);
  v331 = v467->ConfigurationForAction[25][0].m_uiActionInitiator;
  v332 = v467->ConfigurationForAction[25][2].m_uiActionInitiator;
  v333 = v467->ConfigurationForAction[25][3].m_uiActionInitiator;
  v467->ConfigurationForAction[25][0].m_uiActionInitiator = 83;
  v30 = v331 == 1056;
  v334 = 0;
  v335 = 1;
  if ( !v30 )
  {
    v334 = 1;
    v335 = 2;
  }
  if ( v467->ConfigurationForAction[25][1].m_uiActionInitiator == 1056 )
    v335 = v334;
  if ( v332 )
    ++v335;
  v336 = v335 + 1;
  if ( v333 )
    v336 = v335 + 2;
  v467->ConfigurationForAction[25][0].m_uiSetOrder = v336;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_STEER_RIGHT);
  v337 = v467->ConfigurationForAction[21][0].m_uiActionInitiator;
  v467->ConfigurationForAction[21][0].m_uiActionInitiator = 68;
  v30 = v337 == 1056;
  v338 = 0;
  v339 = 1;
  if ( !v30 )
  {
    v338 = 1;
    v339 = 2;
  }
  if ( v467->ConfigurationForAction[21][1].m_uiActionInitiator == 1056 )
    v339 = v338;
  if ( v467->ConfigurationForAction[21][2].m_uiActionInitiator )
    ++v339;
  v340 = v339 + 1;
  if ( v467->ConfigurationForAction[21][3].m_uiActionInitiator )
    v340 = v339 + 2;
  v467->ConfigurationForAction[21][0].m_uiSetOrder = v340;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_STEER_LEFT);
  v341 = v466->m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[20][0].m_uiActionInitiator == 1056;
  v342 = v467->ConfigurationForAction[20][3].m_uiActionInitiator;
  v343 = v467->ConfigurationForAction[20][2].m_uiActionInitiator;
  v344 = 0;
  v466->m_uiActionInitiator = 1021;
  v345 = 1;
  if ( !v30 )
  {
    v344 = 1;
    v345 = 2;
  }
  if ( v341 == 1056 )
    v345 = v344;
  if ( v343 )
    ++v345;
  v346 = v345 + 1;
  if ( v342 )
    v346 = v345 + 2;
  v467->ConfigurationForAction[20][1].m_uiSetOrder = v346;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_STEER_RIGHT);
  v347 = v467->ConfigurationForAction[21][1].m_uiActionInitiator;
  v467->ConfigurationForAction[21][1].m_uiActionInitiator = 1022;
  v348 = 1;
  v349 = 0;
  if ( v467->ConfigurationForAction[21][0].m_uiActionInitiator != 1056 )
  {
    v349 = 1;
    v348 = 2;
  }
  if ( v347 == 1056 )
    v348 = v349;
  if ( v467->ConfigurationForAction[21][2].m_uiActionInitiator )
    ++v348;
  v350 = v348 + 1;
  if ( v467->ConfigurationForAction[21][3].m_uiActionInitiator )
    v350 = v348 + 2;
  v467->ConfigurationForAction[21][1].m_uiSetOrder = v350;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_HORN);
  v351 = v467->ConfigurationForAction[29][0].m_uiActionInitiator;
  v467->ConfigurationForAction[29][0].m_uiActionInitiator = 1044;
  v30 = v351 == 1056;
  v352 = 0;
  v353 = 1;
  if ( !v30 )
  {
    v352 = 1;
    v353 = 2;
  }
  if ( v467->ConfigurationForAction[29][1].m_uiActionInitiator == 1056 )
    v353 = v352;
  if ( v467->ConfigurationForAction[29][2].m_uiActionInitiator )
    ++v353;
  v354 = v353 + 1;
  if ( v467->ConfigurationForAction[29][3].m_uiActionInitiator )
    v354 = v353 + 2;
  v467->ConfigurationForAction[29][0].m_uiSetOrder = v354;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_HORN);
  v355 = v467->ConfigurationForAction[29][1].m_uiActionInitiator;
  v467->ConfigurationForAction[29][1].m_uiActionInitiator = 72;
  v356 = 1;
  v357 = 0;
  if ( v467->ConfigurationForAction[29][0].m_uiActionInitiator != 1056 )
  {
    v357 = 1;
    v356 = 2;
  }
  if ( v355 == 1056 )
    v356 = v357;
  if ( v467->ConfigurationForAction[29][2].m_uiActionInitiator )
    ++v356;
  v358 = v356 + 1;
  if ( v467->ConfigurationForAction[29][3].m_uiActionInitiator )
    v358 = v356 + 2;
  v467->ConfigurationForAction[29][1].m_uiSetOrder = v358;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_HANDBRAKE);
  v359 = v467->ConfigurationForAction[31][0].m_uiActionInitiator;
  v467->ConfigurationForAction[31][0].m_uiActionInitiator = 32;
  v30 = v359 == 1056;
  v360 = 0;
  v361 = 1;
  if ( !v30 )
  {
    v360 = 1;
    v361 = 2;
  }
  if ( v467->ConfigurationForAction[31][1].m_uiActionInitiator == 1056 )
    v361 = v360;
  if ( v467->ConfigurationForAction[31][2].m_uiActionInitiator )
    ++v361;
  v362 = v361 + 1;
  if ( v467->ConfigurationForAction[31][3].m_uiActionInitiator )
    v362 = v361 + 2;
  v467->ConfigurationForAction[31][0].m_uiSetOrder = v362;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_HANDBRAKE);
  v363 = v467->ConfigurationForAction[31][1].m_uiActionInitiator;
  v364 = v467->ConfigurationForAction[31][0].m_uiActionInitiator == 1056;
  v365 = v467->ConfigurationForAction[31][3].m_uiActionInitiator;
  v366 = 0;
  v367 = v467->ConfigurationForAction[31][2].m_uiActionInitiator;
  v467->ConfigurationForAction[31][1].m_uiActionInitiator = 1050;
  if ( !v364 )
    v366 = 1;
  v368 = 1;
  if ( !v364 )
    v368 = 2;
  if ( v363 == 1056 )
    v368 = v366;
  if ( v367 )
    ++v368;
  v369 = v368 + 1;
  if ( v365 )
    v369 = v368 + 2;
  v467->ConfigurationForAction[31][1].m_uiSetOrder = v369;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_LOOKRIGHT);
  v370 = v467->ConfigurationForAction[35][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[35][0].m_uiActionInitiator == 1056;
  v371 = v467->ConfigurationForAction[35][2].m_uiActionInitiator;
  v372 = 1;
  v373 = v467->ConfigurationForAction[35][3].m_uiActionInitiator;
  v467->ConfigurationForAction[35][0].m_uiActionInitiator = 69;
  v374 = 0;
  if ( !v30 )
  {
    v374 = 1;
    v372 = 2;
  }
  if ( v370 == 1056 )
    v372 = v374;
  if ( v371 )
    ++v372;
  v375 = v372 + 1;
  if ( v373 )
    v375 = v372 + 2;
  v467->ConfigurationForAction[35][0].m_uiSetOrder = v375;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_TURRETLEFT);
  v376 = v467->ConfigurationForAction[38][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[38][0].m_uiActionInitiator == 1056;
  v377 = v467->ConfigurationForAction[38][2].m_uiActionInitiator;
  v378 = 1;
  v379 = v467->ConfigurationForAction[38][3].m_uiActionInitiator;
  v467->ConfigurationForAction[38][0].m_uiActionInitiator = 1031;
  v380 = 0;
  if ( !v30 )
  {
    v380 = 1;
    v378 = 2;
  }
  if ( v376 == 1056 )
    v378 = v380;
  if ( v377 )
    ++v378;
  v381 = v378 + 1;
  if ( v379 )
    v381 = v378 + 2;
  v467->ConfigurationForAction[38][0].m_uiSetOrder = v381;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_TURRETRIGHT);
  v382 = v467->ConfigurationForAction[39][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[39][0].m_uiActionInitiator == 1056;
  v383 = v467->ConfigurationForAction[39][2].m_uiActionInitiator;
  v384 = 1;
  v385 = v467->ConfigurationForAction[39][3].m_uiActionInitiator;
  v467->ConfigurationForAction[39][0].m_uiActionInitiator = 1034;
  v386 = 0;
  if ( !v30 )
  {
    v386 = 1;
    v384 = 2;
  }
  if ( v382 == 1056 )
    v384 = v386;
  if ( v383 )
    ++v384;
  v387 = v384 + 1;
  if ( v385 )
    v387 = v384 + 2;
  v467->ConfigurationForAction[39][0].m_uiSetOrder = v387;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_TURRETUP);
  v388 = v467->ConfigurationForAction[40][0].m_uiActionInitiator;
  v467->ConfigurationForAction[40][0].m_uiActionInitiator = 1029;
  v30 = v388 == 1056;
  v389 = 0;
  v390 = 1;
  if ( !v30 )
  {
    v389 = 1;
    v390 = 2;
  }
  if ( v467->ConfigurationForAction[40][1].m_uiActionInitiator == 1056 )
    v390 = v389;
  if ( v467->ConfigurationForAction[40][2].m_uiActionInitiator )
    ++v390;
  v391 = v390 + 1;
  if ( v467->ConfigurationForAction[40][3].m_uiActionInitiator )
    v391 = v390 + 2;
  v467->ConfigurationForAction[40][0].m_uiSetOrder = v391;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_TURRETDOWN);
  v392 = v467->ConfigurationForAction[41][0].m_uiActionInitiator;
  v467->ConfigurationForAction[41][0].m_uiActionInitiator = 1036;
  v30 = v392 == 1056;
  v393 = 0;
  v394 = 1;
  if ( !v30 )
  {
    v393 = 1;
    v394 = 2;
  }
  if ( v467->ConfigurationForAction[41][1].m_uiActionInitiator == 1056 )
    v394 = v393;
  if ( v467->ConfigurationForAction[41][2].m_uiActionInitiator )
    ++v394;
  v395 = v394 + 1;
  if ( v467->ConfigurationForAction[41][3].m_uiActionInitiator )
    v395 = v394 + 2;
  v467->ConfigurationForAction[41][0].m_uiSetOrder = v395;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_TURRETUP);
  v396 = v467->ConfigurationForAction[40][1].m_uiActionInitiator;
  v467->ConfigurationForAction[40][1].m_uiActionInitiator = 1016;
  v397 = 1;
  v398 = 0;
  if ( v467->ConfigurationForAction[40][0].m_uiActionInitiator != 1056 )
  {
    v398 = 1;
    v397 = 2;
  }
  if ( v396 == 1056 )
    v397 = v398;
  if ( v467->ConfigurationForAction[40][2].m_uiActionInitiator )
    ++v397;
  v399 = v397 + 1;
  if ( v467->ConfigurationForAction[40][3].m_uiActionInitiator )
    v399 = v397 + 2;
  v467->ConfigurationForAction[40][1].m_uiSetOrder = v399;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_TURRETDOWN);
  v400 = v467->ConfigurationForAction[41][1].m_uiActionInitiator;
  v467->ConfigurationForAction[41][1].m_uiActionInitiator = 1014;
  v401 = 1;
  v402 = 0;
  if ( v467->ConfigurationForAction[41][0].m_uiActionInitiator != 1056 )
  {
    v402 = 1;
    v401 = 2;
  }
  if ( v400 == 1056 )
    v401 = v402;
  if ( v467->ConfigurationForAction[41][2].m_uiActionInitiator )
    ++v401;
  v403 = v401 + 1;
  if ( v467->ConfigurationForAction[41][3].m_uiActionInitiator )
    v403 = v401 + 2;
  v467->ConfigurationForAction[41][1].m_uiSetOrder = v403;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_RADIO_TRACK_SKIP);
  v404 = v467->ConfigurationForAction[28][0].m_uiActionInitiator;
  v405 = v467->ConfigurationForAction[28][2].m_uiActionInitiator;
  v406 = v467->ConfigurationForAction[28][3].m_uiActionInitiator;
  v467->ConfigurationForAction[28][0].m_uiActionInitiator = 1005;
  v30 = v404 == 1056;
  v407 = 0;
  v408 = 1;
  if ( !v30 )
  {
    v407 = 1;
    v408 = 2;
  }
  if ( v467->ConfigurationForAction[28][1].m_uiActionInitiator == 1056 )
    v408 = v407;
  if ( v405 )
    ++v408;
  v409 = v408 + 1;
  if ( v406 )
    v409 = v408 + 2;
  v467->ConfigurationForAction[28][0].m_uiSetOrder = v409;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_RADIO_STATION_DOWN);
  v410 = 1;
  v411 = v467->ConfigurationForAction[27][0].m_uiActionInitiator;
  v467->ConfigurationForAction[27][0].m_uiActionInitiator = 1014;
  v30 = v411 == 1056;
  v412 = 0;
  if ( !v30 )
  {
    v412 = 1;
    v410 = 2;
  }
  if ( v467->ConfigurationForAction[27][1].m_uiActionInitiator == 1056 )
    v410 = v412;
  if ( v467->ConfigurationForAction[27][2].m_uiActionInitiator )
    ++v410;
  v413 = v410 + 1;
  if ( v467->ConfigurationForAction[27][3].m_uiActionInitiator )
    v413 = v410 + 2;
  v467->ConfigurationForAction[27][0].m_uiSetOrder = v413;
  CControllerConfigManager::ResetSettingOrder(v467, VEHICLE_RADIO_STATION_DOWN);
  v414 = v467->ConfigurationForAction[27][3].m_uiActionInitiator;
  v415 = v467->ConfigurationForAction[27][1].m_uiActionInitiator;
  v416 = v467->ConfigurationForAction[27][2].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[27][0].m_uiActionInitiator == 1056;
  v467->ConfigurationForAction[27][1].m_uiActionInitiator = 82;
  v417 = 0;
  v418 = 1;
  if ( !v30 )
  {
    v417 = 1;
    v418 = 2;
  }
  if ( v415 == 1056 )
    v418 = v417;
  if ( v416 )
    ++v418;
  v419 = v418 + 1;
  if ( v414 )
    v419 = v418 + 2;
  v467->ConfigurationForAction[27][1].m_uiSetOrder = v419;
  CControllerConfigManager::ResetSettingOrder(v467, PED_CYCLE_TARGET_LEFT);
  v420 = v467->ConfigurationForAction[42][1].m_uiActionInitiator;
  v30 = v467->ConfigurationForAction[42][0].m_uiActionInitiator == 1056;
  v421 = v467->ConfigurationForAction[42][2].m_uiActionInitiator;
  v422 = 1;
  v423 = v467->ConfigurationForAction[42][3].m_uiActionInitiator;
  v467->ConfigurationForAction[42][0].m_uiActionInitiator = 91;
  v424 = 0;
  if ( !v30 )
  {
    v424 = 1;
    v422 = 2;
  }
  if ( v420 == 1056 )
    v422 = v424;
  if ( v421 )
    ++v422;
  v425 = v422 + 1;
  if ( v423 )
    v425 = v422 + 2;
  v467->ConfigurationForAction[42][0].m_uiSetOrder = v425;
  CControllerConfigManager::ResetSettingOrder(v467, PED_CYCLE_TARGET_RIGHT);
  v426 = v467->ConfigurationForAction[43][0].m_uiActionInitiator;
  v427 = v467->ConfigurationForAction[43][1].m_uiActionInitiator;
  v428 = v467->ConfigurationForAction[43][2].m_uiActionInitiator;
  v429 = 1;
  v430 = v467->ConfigurationForAction[43][3].m_uiActionInitiator;
  v467->ConfigurationForAction[43][0].m_uiActionInitiator = 93;
  v431 = 0;
  if ( v426 != 1056 )
  {
    v431 = 1;
    v429 = 2;
  }
  if ( v427 == 1056 )
    v429 = v431;
  if ( v428 )
    ++v429;
  v432 = v429 + 1;
  v433 = widget_camera;
  if ( v430 )
    v432 = v429 + 2;
  v467->ConfigurationForAction[43][0].m_uiSetOrder = v432;
  v434 = &v467->ConfigurationForAction[59][3];
  do
  {
    CControllerConfigManager::ResetSettingOrder(v467, v433);
    v435 = &v434[v315];
    v436 = &v467->m_bJoyJustInitialised + v315 * 8;
    v437 = 1;
    v438 = v434[v315].m_uiActionInitiator;
    v439 = v434[v315 - 3].m_uiActionInitiator;
    v440 = v434[v315 - 2].m_uiActionInitiator;
    v315 += 4;
    v441 = *((_DWORD *)v436 + 4128);
    v30 = v439 == 1056;
    v442 = 0;
    v435[-3].m_uiActionInitiator = 1008;
    if ( !v30 )
    {
      v442 = 1;
      v437 = 2;
    }
    if ( v440 == 1056 )
      v437 = v442;
    if ( v441 )
      ++v437;
    v443 = v437 + 1;
    ++v433;
    if ( v438 )
      v443 = v437 + 2;
    v435[-3].m_uiSetOrder = v443;
  }
  while ( v433 != NUM_OF_CONTROLLER_ACTIONS );
  *(_QWORD *)v467->m_bStickL_X_Rgh_Lft_MovementBothDown = 0LL;
  *(_QWORD *)v467->m_bStickR_X_Rgh_Lft_MovementBothDown = 0LL;
}

//----- (003E714C) --------------------------------------------------------
void __fastcall CControllerConfigManager::InitDefaultControlConfigMouse(
        CControllerConfigManager *this,
        const CMouseControllerState *MouseSetUp,
        bool bMouseControls)
{
  UInt32 m_uiActionInitiator; // r5
  UInt32 v4; // r12
  int v5; // r3
  UInt32 v6; // r8
  int v7; // r6
  int v8; // r4
  UInt32 v9; // lr
  UInt32 v10; // r8
  eContSetOrder v11; // r5
  int v12; // r2
  UInt32 v13; // r4
  eContSetOrder v14; // r2
  UInt32 v15; // r5
  UInt32 v16; // r12
  UInt32 v17; // r6
  UInt32 v18; // r8
  int v19; // r6
  int v20; // r4
  UInt32 v21; // lr
  UInt32 v22; // r8
  eContSetOrder v23; // r5
  int v24; // r3
  UInt32 v25; // r4
  int v26; // r2
  eContSetOrder v27; // r3
  UInt32 v28; // r5
  UInt32 v29; // r12
  UInt32 v30; // r6
  UInt32 v31; // r8
  int v32; // r6
  int v33; // r4
  UInt32 v34; // lr
  UInt32 v35; // r8
  eContSetOrder v36; // r5
  int v37; // r3
  UInt32 v38; // r4
  int v39; // r2
  eContSetOrder v40; // r3
  bool v41; // zf
  UInt32 v42; // r5
  UInt32 v43; // r3
  UInt32 v44; // r4
  int v45; // r6
  int v46; // r2
  eContSetOrder v47; // r4
  UInt32 v48; // r2
  int v49; // r5
  int v50; // r8
  int v51; // r4
  int v52; // r1
  eContSetOrder v53; // r2
  int v54; // r5
  UInt32 v55; // r2
  UInt32 v56; // r4
  int v57; // r3
  eContSetOrder v58; // r2
  int v59; // r5
  UInt32 v60; // r2
  UInt32 v61; // r4
  int v62; // r3
  eContSetOrder v63; // r2
  UInt32 v64; // r2
  UInt32 v65; // r3
  UInt32 v66; // r5
  int v67; // r4
  int v68; // r6
  eContSetOrder v69; // r3
  UInt32 v70; // r6
  UInt32 v71; // r2
  UInt32 v72; // r3
  UInt32 v73; // r4
  eContSetOrder v74; // r2

  if ( MouseSetUp->m_bLeftButton )
  {
    m_uiActionInitiator = this->ConfigurationForAction[0][1].m_uiActionInitiator;
    v4 = this->ConfigurationForAction[18][3].m_uiActionInitiator;
    v5 = 1;
    v6 = this->ConfigurationForAction[0][2].m_uiActionInitiator;
    v41 = this->ConfigurationForAction[0][0].m_uiActionInitiator == 1056;
    this->MouseFoundInitSet = 1;
    v7 = 0;
    this->ConfigurationForAction[0][2].m_uiActionInitiator = 1;
    v8 = 1;
    v9 = this->ConfigurationForAction[18][2].m_uiActionInitiator;
    this->ConfigurationForAction[18][2].m_uiActionInitiator = 1;
    if ( !v41 )
    {
      v7 = 1;
      v8 = 2;
    }
    if ( m_uiActionInitiator == 1056 )
      v8 = v7;
    if ( v6 )
      ++v8;
    v10 = this->ConfigurationForAction[18][1].m_uiActionInitiator;
    v11 = v8 + 1;
    v12 = 0;
    if ( this->ConfigurationForAction[0][3].m_uiActionInitiator )
      v11 = v8 + 2;
    v13 = this->ConfigurationForAction[18][0].m_uiActionInitiator;
    this->ConfigurationForAction[0][2].m_uiSetOrder = v11;
    if ( v13 != 1056 )
    {
      v12 = 1;
      v5 = 2;
    }
    if ( v10 == 1056 )
      v5 = v12;
    if ( v9 )
      ++v5;
    v14 = v5 + 1;
    if ( v4 )
      v14 = v5 + 2;
    this->ConfigurationForAction[18][2].m_uiSetOrder = v14;
  }
  if ( MouseSetUp->m_bRightButton )
  {
    v15 = this->ConfigurationForAction[45][1].m_uiActionInitiator;
    v16 = this->ConfigurationForAction[37][3].m_uiActionInitiator;
    v17 = this->ConfigurationForAction[45][0].m_uiActionInitiator;
    v18 = this->ConfigurationForAction[45][2].m_uiActionInitiator;
    this->ConfigurationForAction[45][2].m_uiActionInitiator = 3;
    v41 = v17 == 1056;
    v19 = 0;
    v20 = 1;
    v21 = this->ConfigurationForAction[37][2].m_uiActionInitiator;
    this->ConfigurationForAction[37][2].m_uiActionInitiator = 3;
    if ( !v41 )
    {
      v19 = 1;
      v20 = 2;
    }
    if ( v15 == 1056 )
      v20 = v19;
    if ( v18 )
      ++v20;
    v22 = this->ConfigurationForAction[37][1].m_uiActionInitiator;
    v23 = v20 + 1;
    v24 = 0;
    if ( this->ConfigurationForAction[45][3].m_uiActionInitiator )
      v23 = v20 + 2;
    v25 = this->ConfigurationForAction[37][0].m_uiActionInitiator;
    v26 = 1;
    this->ConfigurationForAction[45][2].m_uiSetOrder = v23;
    if ( v25 != 1056 )
    {
      v24 = 1;
      v26 = 2;
    }
    if ( v22 == 1056 )
      v26 = v24;
    if ( v21 )
      ++v26;
    v27 = v26 + 1;
    if ( v16 )
      v27 = v26 + 2;
    this->ConfigurationForAction[37][2].m_uiSetOrder = v27;
  }
  if ( MouseSetUp->m_bMiddleButton )
  {
    v28 = this->ConfigurationForAction[36][1].m_uiActionInitiator;
    v29 = this->ConfigurationForAction[14][3].m_uiActionInitiator;
    v30 = this->ConfigurationForAction[36][0].m_uiActionInitiator;
    v31 = this->ConfigurationForAction[36][2].m_uiActionInitiator;
    this->ConfigurationForAction[36][2].m_uiActionInitiator = 2;
    v41 = v30 == 1056;
    v32 = 0;
    v33 = 1;
    v34 = this->ConfigurationForAction[14][2].m_uiActionInitiator;
    this->ConfigurationForAction[14][2].m_uiActionInitiator = 2;
    if ( !v41 )
    {
      v32 = 1;
      v33 = 2;
    }
    if ( v28 == 1056 )
      v33 = v32;
    if ( v31 )
      ++v33;
    v35 = this->ConfigurationForAction[14][1].m_uiActionInitiator;
    v36 = v33 + 1;
    v37 = 0;
    if ( this->ConfigurationForAction[36][3].m_uiActionInitiator )
      v36 = v33 + 2;
    v38 = this->ConfigurationForAction[14][0].m_uiActionInitiator;
    v39 = 1;
    this->ConfigurationForAction[36][2].m_uiSetOrder = v36;
    if ( v38 != 1056 )
    {
      v37 = 1;
      v39 = 2;
    }
    if ( v35 == 1056 )
      v39 = v37;
    if ( v34 )
      ++v39;
    v40 = v39 + 1;
    if ( v29 )
      v40 = v39 + 2;
    this->ConfigurationForAction[14][2].m_uiSetOrder = v40;
  }
  v41 = MouseSetUp->m_bWheelMovedUp == 0;
  if ( !MouseSetUp->m_bWheelMovedUp )
    v41 = MouseSetUp->m_bWheelMovedDown == 0;
  if ( !v41 )
  {
    v42 = this->ConfigurationForAction[3][1].m_uiActionInitiator;
    v41 = this->ConfigurationForAction[3][0].m_uiActionInitiator == 1056;
    v43 = this->ConfigurationForAction[2][2].m_uiActionInitiator;
    v44 = this->ConfigurationForAction[3][2].m_uiActionInitiator;
    this->ConfigurationForAction[3][2].m_uiActionInitiator = 4;
    v45 = 0;
    v46 = 1;
    this->ConfigurationForAction[2][2].m_uiActionInitiator = 5;
    if ( !v41 )
    {
      v45 = 1;
      v46 = 2;
    }
    if ( v42 == 1056 )
      v46 = v45;
    if ( v44 )
      ++v46;
    v47 = v46 + 1;
    if ( this->ConfigurationForAction[3][3].m_uiActionInitiator )
      v47 = v46 + 2;
    v48 = this->ConfigurationForAction[2][1].m_uiActionInitiator;
    this->ConfigurationForAction[3][2].m_uiSetOrder = v47;
    v49 = 1;
    v50 = 0;
    v51 = 0;
    if ( this->ConfigurationForAction[2][0].m_uiActionInitiator != 1056 )
    {
      v51 = 1;
      v49 = 2;
    }
    v52 = 1;
    if ( v48 == 1056 )
      v49 = v51;
    if ( v43 )
      ++v49;
    v53 = v49 + 1;
    if ( this->ConfigurationForAction[2][3].m_uiActionInitiator )
      v53 = v49 + 2;
    v54 = 1;
    this->ConfigurationForAction[2][2].m_uiSetOrder = v53;
    v55 = this->ConfigurationForAction[26][1].m_uiActionInitiator;
    v56 = this->ConfigurationForAction[26][2].m_uiActionInitiator;
    this->ConfigurationForAction[26][2].m_uiActionInitiator = 4;
    v57 = 0;
    if ( this->ConfigurationForAction[26][0].m_uiActionInitiator != 1056 )
    {
      v57 = 1;
      v54 = 2;
    }
    if ( v55 == 1056 )
      v54 = v57;
    if ( v56 )
      ++v54;
    v58 = v54 + 1;
    if ( this->ConfigurationForAction[26][3].m_uiActionInitiator )
      v58 = v54 + 2;
    v59 = 1;
    this->ConfigurationForAction[26][2].m_uiSetOrder = v58;
    v60 = this->ConfigurationForAction[27][1].m_uiActionInitiator;
    v61 = this->ConfigurationForAction[27][2].m_uiActionInitiator;
    this->ConfigurationForAction[27][2].m_uiActionInitiator = 5;
    v62 = 0;
    if ( this->ConfigurationForAction[27][0].m_uiActionInitiator != 1056 )
    {
      v62 = 1;
      v59 = 2;
    }
    if ( v60 == 1056 )
      v59 = v62;
    if ( v61 )
      ++v59;
    v63 = v59 + 1;
    if ( this->ConfigurationForAction[27][3].m_uiActionInitiator )
      v63 = v59 + 2;
    this->ConfigurationForAction[27][2].m_uiSetOrder = v63;
    v64 = this->ConfigurationForAction[8][3].m_uiActionInitiator;
    v65 = this->ConfigurationForAction[8][1].m_uiActionInitiator;
    v66 = this->ConfigurationForAction[8][2].m_uiActionInitiator;
    this->ConfigurationForAction[8][2].m_uiActionInitiator = 4;
    v67 = 1;
    v68 = 0;
    if ( this->ConfigurationForAction[8][0].m_uiActionInitiator != 1056 )
    {
      v68 = 1;
      v67 = 2;
    }
    if ( v65 == 1056 )
      v67 = v68;
    if ( v66 )
      ++v67;
    v69 = v67 + 1;
    if ( v64 )
      v69 = v67 + 2;
    this->ConfigurationForAction[8][2].m_uiSetOrder = v69;
    v70 = this->ConfigurationForAction[9][0].m_uiActionInitiator;
    v71 = this->ConfigurationForAction[9][1].m_uiActionInitiator;
    v72 = this->ConfigurationForAction[9][3].m_uiActionInitiator;
    v73 = this->ConfigurationForAction[9][2].m_uiActionInitiator;
    this->ConfigurationForAction[9][2].m_uiActionInitiator = 5;
    if ( v70 != 1056 )
    {
      v50 = 1;
      v52 = 2;
    }
    if ( v71 == 1056 )
      v52 = v50;
    if ( v73 )
      ++v52;
    v74 = v52 + 1;
    if ( v72 )
      v74 = v52 + 2;
    this->ConfigurationForAction[9][2].m_uiSetOrder = v74;
  }
}

//----- (003E7532) --------------------------------------------------------
void __fastcall CControllerConfigManager::SetControllerKeyAssociatedWithAction(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        Int32 RwKeyCode,
        eControllerType ControllerArraytoEnter)
{
  bool *v8; // r0
  int v9; // r1
  int v10; // r2
  int v11; // r3
  _DWORD *v12; // r5
  int v13; // r0
  int v14; // r6
  bool v15; // zf
  int v16; // r0
  int v17; // r2

  CControllerConfigManager::ResetSettingOrder(this, Action);
  v8 = &this->m_bJoyJustInitialised + 32 * Action;
  v9 = *((_DWORD *)v8 + 3658);
  v10 = *((_DWORD *)v8 + 3656);
  v11 = *((_DWORD *)v8 + 3654);
  v12 = v8 + 14608;
  v13 = *((_DWORD *)v8 + 3652);
  v14 = 0;
  v12[2 * ControllerArraytoEnter] = RwKeyCode;
  v15 = v13 == 1056;
  v16 = 1;
  if ( !v15 )
  {
    v14 = 1;
    v16 = 2;
  }
  if ( v11 == 1056 )
    v16 = v14;
  if ( v10 )
    ++v16;
  v17 = v16 + 1;
  if ( v9 )
    v17 = v16 + 2;
  v12[2 * ControllerArraytoEnter + 1] = v17;
}

//----- (003E759E) --------------------------------------------------------
void __fastcall CControllerConfigManager::SetMouseButtonAssociatedWithAction(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        Int32 MouseAction)
{
  bool *v3; // r0
  int v4; // lr
  int v5; // r4
  int v6; // r1
  int v7; // r3
  bool v8; // zf
  int v9; // r2
  int v10; // r4
  int v11; // r1

  v3 = &this->m_bJoyJustInitialised + 32 * Action;
  v4 = *((_DWORD *)v3 + 3658);
  v5 = *((_DWORD *)v3 + 3652);
  v6 = *((_DWORD *)v3 + 3654);
  v7 = *((_DWORD *)v3 + 3656);
  *((_DWORD *)v3 + 3656) = MouseAction;
  v8 = v5 == 1056;
  v9 = 0;
  v10 = 1;
  if ( !v8 )
  {
    v9 = 1;
    v10 = 2;
  }
  if ( v6 == 1056 )
    v10 = v9;
  if ( v7 )
    ++v10;
  v11 = v10 + 1;
  if ( v4 )
    v11 = v10 + 2;
  *((_DWORD *)v3 + 3657) = v11;
}

//----- (003E75FC) --------------------------------------------------------
void __fastcall CControllerConfigManager::InitialiseControllerActionNameArray(CControllerConfigManager *this)
{
  GxtChar *v2; // r5
  int i; // r6
  GxtChar v4[52]; // [sp+0h] [bp-68h] BYREF

  AsciiToGxtChar((const Char *)"PED_LOOKBEHIND", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[14], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_CYCLE_WEAPON_LEFT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[3], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_CYCLE_WEAPON_RIGHT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[2], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_LOCK_TARGET", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[45], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_JUMPING", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[12], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_SPRINT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[13], v4, 0x28u);
  AsciiToGxtChar((const Char *)"SNEAK_ABOUT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[17], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_CYCLE_TARGET_LEFT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[42], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_CYCLE_TARGET_RIGHT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[43], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_LOCK_TARGET", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[45], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_CENTER_CAMERA_BEHIND_PLAYER", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[44], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_LOOKBEHIND", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[36], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_DUCK", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[15], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_ANSWER_PHONE", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[16], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_STEERLEFT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[20], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_STEERRIGHT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[21], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_STEERUP", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[22], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_STEERDOWN", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[23], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_LOOKLEFT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[34], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_LOOKRIGHT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[35], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_MOUSELOOK", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[37], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_HORN", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[29], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_HANDBRAKE", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[31], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_ACCELERATE", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[24], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_BRAKE", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[25], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_RADIO_STATION_UP", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[26], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_RADIO_STATION_DOWN", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[27], v4, 0x28u);
  AsciiToGxtChar((const Char *)"TOGGLE_SUBMISSIONS", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[30], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_SNIPER_ZOOM_IN", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[8], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_SNIPER_ZOOM_OUT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[9], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_1RST_PERSON_LOOK_LEFT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[32], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_1RST_PERSON_LOOK_RIGHT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[33], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_1RST_PERSON_LOOK_UP", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[51], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_1RST_PERSON_LOOK_DOWN", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[52], v4, 0x28u);
  AsciiToGxtChar((const Char *)"SHOW_MOUSE_POINTER_TOGGLE", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[57], v4, 0x28u);
  AsciiToGxtChar((const Char *)"CAMERA_CHANGE_VIEW_ALL_SITUATIONS", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[11], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_FIREWEAPON", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[0], v4, 0x28u);
  AsciiToGxtChar((const Char *)"PED_FIREWEAPON_ALT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[1], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_FIREWEAPON", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[18], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_FIREWEAPON_ALT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[19], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_ENTER_EXIT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[10], v4, 0x28u);
  AsciiToGxtChar((const Char *)"CONVERSATION_NO", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[48], v4, 0x28u);
  AsciiToGxtChar((const Char *)"CONVERSATION_YES", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[47], v4, 0x28u);
  AsciiToGxtChar((const Char *)"GROUP_CONTROL_FWD", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[49], v4, 0x28u);
  AsciiToGxtChar((const Char *)"GROUP_CONTROL_BWD", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[50], v4, 0x28u);
  AsciiToGxtChar((const Char *)"GO_LEFT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[6], v4, 0x28u);
  AsciiToGxtChar((const Char *)"GO_RIGHT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[7], v4, 0x28u);
  AsciiToGxtChar((const Char *)"GO_FORWARD", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[4], v4, 0x28u);
  AsciiToGxtChar((const Char *)"GO_BACK", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[5], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_TURRETLEFT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[38], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_TURRETRIGHT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[39], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_TURRETUP", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[40], v4, 0x28u);
  AsciiToGxtChar((const Char *)"VEHICLE_TURRETDOWN", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[41], v4, 0x28u);
  AsciiToGxtChar((const Char *)"NETWORK_TALK", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[46], v4, 0x28u);
  AsciiToGxtChar((const Char *)"TOGGLE_DPAD", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[54], v4, 0x28u);
  AsciiToGxtChar((const Char *)"SWITCH_DEBUG_CAM_ON", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[55], v4, 0x28u);
  AsciiToGxtChar((const Char *)"TAKE_SCREEN_SHOT", v4);
  CMessages::GxtStringCopy(this->m_arrControllerActionName[56], v4, 0x28u);
  v2 = this->m_arrControllerActionName[59];
  for ( i = 0; i != 123; ++i )
  {
    AsciiToGxtChar((const Char *)off_6679C0[i], v4);
    CMessages::GxtStringCopy(v2, v4, 0x28u);
    v2 += 40;
  }
}
// 6679C0: using guessed type char *off_6679C0[96];

//----- (003E7C9C) --------------------------------------------------------
void __fastcall CControllerConfigManager::StoreMouseButtonState(
        CControllerConfigManager *this,
        eMouseButtons MouseButton,
        bool ButtonState)
{
  switch ( MouseButton )
  {
    case LEFT_MS_BUTTON:
      CPad::PCTempMouseControllerState.m_bLeftButton = ButtonState;
      break;
    case MIDDLE_MS_BUTTON:
      CPad::PCTempMouseControllerState.m_bMiddleButton = ButtonState;
      break;
    case RIGHT_MS_BUTTON:
      CPad::PCTempMouseControllerState.m_bRightButton = ButtonState;
      break;
    case WHEEL_MS_UP:
      CPad::PCTempMouseControllerState.m_bWheelMovedUp = ButtonState;
      break;
    case WHEEL_MS_DOWN:
      CPad::PCTempMouseControllerState.m_bWheelMovedDown = ButtonState;
      break;
    case FIRST_MS_X_BUTTON:
      CPad::PCTempMouseControllerState.m_bMsFirstXButton = ButtonState;
      break;
    case SECOND_MS_X_BUTTON:
      CPad::PCTempMouseControllerState.m_bMsSecondXButton = ButtonState;
      break;
  }
}

//----- (003E7D14) --------------------------------------------------------
void __fastcall CControllerConfigManager::UpdateJoyInConfigMenus_ButtonDown(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        int PadNumber)
{
  CPad *Pad; // r0
  bool v6; // zf

  if ( ButtonPress )
  {
    Pad = CPad::GetPad(PadNumber);
    if ( Pad )
    {
      switch ( ButtonPress )
      {
        case 5:
          Pad->PCTempJoyState.LeftShoulder2 = 255;
          break;
        case 6:
          Pad->PCTempJoyState.RightShoulder2 = 255;
          break;
        case 7:
          Pad->PCTempJoyState.LeftShoulder1 = 255;
          break;
        case 8:
          Pad->PCTempJoyState.RightShoulder1 = 255;
          break;
        case 9:
          Pad->PCTempJoyState.Select = 255;
          break;
        case 10:
          Pad->PCTempJoyState.ShockButtonL = 255;
          break;
        case 11:
          Pad->PCTempJoyState.ShockButtonR = 255;
          break;
        case 12:
          if ( PadNumber == 1 )
            Pad->PCTempJoyState.Start = 255;
          break;
        case 13:
          Pad->PCTempJoyState.DPadUp = 255;
          break;
        case 14:
          Pad->PCTempJoyState.DPadRight = 255;
          break;
        case 15:
          Pad->PCTempJoyState.DPadDown = 255;
          break;
        case 16:
          Pad->PCTempJoyState.DPadLeft = 255;
          break;
        default:
          break;
      }
      v6 = AllValidWinJoys.JoyStickNum[0].wVendorID == 13351;
      if ( AllValidWinJoys.JoyStickNum[0].wVendorID == 13351 )
        v6 = AllValidWinJoys.JoyStickNum[0].wProductID == 4496;
      if ( !v6 )
      {
        switch ( ButtonPress )
        {
          case 1:
            goto LABEL_24;
          case 2:
            goto LABEL_26;
          case 3:
            goto LABEL_27;
          case 4:
            goto LABEL_28;
        }
      }
      switch ( ButtonPress )
      {
        case 1:
LABEL_28:
          Pad->PCTempJoyState.ButtonTriangle = 255;
          break;
        case 2:
LABEL_24:
          Pad->PCTempJoyState.ButtonCircle = 255;
          break;
        case 3:
LABEL_26:
          Pad->PCTempJoyState.ButtonCross = 255;
          break;
        case 4:
LABEL_27:
          Pad->PCTempJoyState.ButtonSquare = 255;
          break;
        default:
          return;
      }
    }
  }
}

//----- (003E7E04) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonDown(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType)
{
  int v5; // r0
  _BOOL4 v7; // r1
  int v8; // r2
  int v9; // r6
  bool v10; // zf
  int v11; // r2
  int v12; // r11
  CPad *Pad; // r9
  CPlayerPed *PlayerPed; // r0
  int v15; // r6
  CControllerState *p_PCTempKeyState; // r10
  bool *v17; // r0
  bool *v18; // r0
  __int16 v19; // r1

  v5 = 0;
  if ( ControllerType == MOUSE )
    v5 = 1;
  v7 = ButtonPress == 0;
  v8 = 0;
  v9 = 0;
  if ( ControllerType == JOY_STICK )
    v8 = 1;
  if ( (unsigned int)ControllerType > OPTIONAL_EXTRA_KEY )
    v9 = 1;
  if ( (ButtonPress != 1056) | v9 )
  {
    v11 = v8 & v7;
    v10 = v11 == 0;
    if ( !v11 )
      v10 = (v5 & v7) == 0;
    if ( v10 )
    {
      v12 = 0;
      Pad = CPad::GetPad(0);
      if ( FindPlayerVehicle(-1, 0) )
      {
        PlayerPed = FindPlayerPed(-1);
        if ( PlayerPed )
        {
          v12 = 0;
          if ( PlayerPed->m_nPedState == PED_DRIVING && !Pad->DisablePlayerControls )
            v12 = 1;
        }
        else
        {
          v12 = 0;
        }
      }
      v15 = 0;
      switch ( TheCamera.Cams[TheCamera.ActiveCam].Mode )
      {
        case 7:
        case 8:
        case 0x10:
        case 0x22:
        case 0x2E:
        case 0x33:
          v15 = 1;
          break;
        default:
          break;
      }
      if ( (unsigned int)ControllerType < MOUSE )
      {
        p_PCTempKeyState = &CPad::GetPad(0)->PCTempKeyState;
        if ( !Pad )
          return;
      }
      else if ( ControllerType == MOUSE )
      {
        p_PCTempKeyState = &CPad::GetPad(0)->PCTempMouseState;
        if ( !Pad )
          return;
      }
      else if ( ControllerType == JOY_STICK )
      {
        p_PCTempKeyState = &CPad::GetPad(0)->PCTempJoyState;
        if ( !Pad )
          return;
      }
      else
      {
        p_PCTempKeyState = 0;
        if ( !Pad )
          return;
      }
      if ( v12 == 1 )
      {
        CControllerConfigManager::AffectControllerStateOn_ButtonDown_Driving(
          this,
          ButtonPress,
          ControllerType,
          p_PCTempKeyState);
        v17 = &this->m_bJoyJustInitialised + 8 * ControllerType;
      }
      else
      {
        CControllerConfigManager::AffectControllerStateOn_ButtonDown_FirstAndThirdPersonOnly(
          this,
          ButtonPress,
          ControllerType,
          p_PCTempKeyState);
        v17 = &this->m_bJoyJustInitialised + 8 * ControllerType;
        if ( v15 == 1 )
        {
          if ( *((_DWORD *)v17 + 3716) == ButtonPress )
            p_PCTempKeyState->ButtonSquare = 255;
          if ( *((_DWORD *)v17 + 3724) == ButtonPress )
            p_PCTempKeyState->ButtonCross = 255;
          if ( *((_DWORD *)v17 + 3772) == ButtonPress )
            p_PCTempKeyState->ShockButtonL = 255;
          goto LABEL_60;
        }
        if ( *((_DWORD *)v17 + 3764) == ButtonPress )
          p_PCTempKeyState->ShockButtonR = 255;
        if ( *((_DWORD *)v17 + 3748) == ButtonPress )
          p_PCTempKeyState->ButtonSquare = 255;
        if ( *((_DWORD *)v17 + 3780) == ButtonPress )
          p_PCTempKeyState->LeftShoulder1 = 255;
        if ( *((_DWORD *)v17 + 3676) == ButtonPress )
          p_PCTempKeyState->LeftShoulder2 = 255;
        if ( *((_DWORD *)v17 + 3668) == ButtonPress )
          p_PCTempKeyState->RightShoulder2 = 255;
        if ( *((_DWORD *)v17 + 3756) == ButtonPress )
          p_PCTempKeyState->ButtonCross = 255;
        if ( *((_DWORD *)v17 + 3772) == ButtonPress )
          p_PCTempKeyState->ShockButtonL = 255;
        if ( FrontEndMenuManager.m_ControlMethod == 1 && *((_DWORD *)v17 + 4004) == ButtonPress )
          p_PCTempKeyState->LeftShoulder1 = 255;
      }
      if ( *((_DWORD *)v17 + 3732) == ButtonPress )
        p_PCTempKeyState->ButtonTriangle = 255;
LABEL_60:
      v18 = &this->m_bJoyJustInitialised + 8 * ControllerType;
      if ( *((_DWORD *)v18 + 3740) == ButtonPress )
        p_PCTempKeyState->Select = 255;
      if ( *((_DWORD *)v18 + 4036) == ButtonPress )
      {
        if ( p_PCTempKeyState->DPadRight )
          *(_DWORD *)&p_PCTempKeyState->DPadLeft = 0;
        else
          p_PCTempKeyState->DPadLeft = 255;
      }
      if ( *((_DWORD *)v18 + 4028) == ButtonPress )
      {
        if ( p_PCTempKeyState->DPadLeft )
        {
          v19 = 0;
          p_PCTempKeyState->DPadLeft = 0;
        }
        else
        {
          v19 = 255;
        }
        p_PCTempKeyState->DPadRight = v19;
      }
      if ( *((_DWORD *)v18 + 4020) == ButtonPress )
        p_PCTempKeyState->m_bChatIndicated = 255;
    }
  }
}

//----- (003E809C) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonDown_Driving(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType,
        CControllerState *ControllerToUpdate)
{
  bool *v4; // r12
  bool *v5; // r4
  bool *v6; // r4
  bool *v7; // r4
  bool *v8; // r0

  v4 = &this->m_bJoyJustInitialised + 8 * ControllerType;
  if ( *((_DWORD *)v4 + 3796) == ButtonPress )
    ControllerToUpdate->ButtonCircle = 255;
  if ( *((_DWORD *)v4 + 3804) == ButtonPress )
    ControllerToUpdate->LeftShoulder1 = 255;
  if ( *((_DWORD *)v4 + 3940) == ButtonPress )
  {
    ControllerToUpdate->RightShoulder2 = 255;
    ControllerToUpdate->LeftShoulder2 = 255;
  }
  if ( *((_DWORD *)v4 + 3924) == ButtonPress )
    ControllerToUpdate->LeftShoulder2 = 255;
  if ( *((_DWORD *)v4 + 3932) == ButtonPress )
    ControllerToUpdate->RightShoulder2 = 255;
  if ( *((_DWORD *)v4 + 3948) == ButtonPress )
    ControllerToUpdate->m_bVehicleMouseLook = 255;
  if ( *((_DWORD *)v4 + 3884) == ButtonPress )
    ControllerToUpdate->ShockButtonL = 255;
  if ( *((_DWORD *)v4 + 3900) == ButtonPress )
    ControllerToUpdate->RightShoulder1 = 255;
  if ( *((_DWORD *)v4 + 3844) == ButtonPress )
    ControllerToUpdate->ButtonCross = 255;
  if ( *((_DWORD *)v4 + 3852) == ButtonPress )
    ControllerToUpdate->ButtonSquare = 255;
  if ( *((_DWORD *)v4 + 3828) == ButtonPress )
  {
    if ( this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickY = 0;
      this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickY = -128;
    }
  }
  if ( *((_DWORD *)v4 + 3836) == ButtonPress )
  {
    if ( this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickY = 0;
      this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickY = 128;
    }
  }
  if ( *((_DWORD *)v4 + 3812) == ButtonPress )
  {
    if ( this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickX = 0;
      this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickX = -128;
    }
  }
  if ( *((_DWORD *)v4 + 3820) == ButtonPress )
  {
    if ( this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickX = 0;
      this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickX = 128;
    }
  }
  if ( *((_DWORD *)v4 + 3860) == ButtonPress )
    ControllerToUpdate->DPadUp = 255;
  if ( *((_DWORD *)v4 + 3868) == ButtonPress )
    ControllerToUpdate->DPadDown = 255;
  if ( *((_DWORD *)v4 + 3876) == ButtonPress )
    ControllerToUpdate->m_bRadioTrackSkip = 255;
  if ( *((_DWORD *)v4 + 3892) == ButtonPress )
    ControllerToUpdate->ShockButtonR = 255;
  if ( *((_DWORD *)v4 + 3956) == ButtonPress )
  {
    v5 = &this->m_bStickR_X_Rgh_Lft_MovementBothDown[ControllerType];
    if ( ControllerToUpdate->RightStickX == 128 || *v5 )
    {
      ControllerToUpdate->RightStickX = 0;
      *v5 = 1;
    }
    else
    {
      ControllerToUpdate->RightStickX = -128;
    }
  }
  if ( *((_DWORD *)v4 + 3964) == ButtonPress )
  {
    v6 = &this->m_bStickR_X_Rgh_Lft_MovementBothDown[ControllerType];
    if ( (unsigned __int16)ControllerToUpdate->RightStickX == 65408 || *v6 )
    {
      ControllerToUpdate->RightStickX = 0;
      *v6 = 1;
    }
    else
    {
      ControllerToUpdate->RightStickX = 128;
    }
  }
  if ( *((_DWORD *)v4 + 3972) == ButtonPress )
  {
    v7 = &this->m_bStickR_Up_Dwn_MovementBothDown[ControllerType];
    if ( (unsigned __int16)ControllerToUpdate->RightStickY == 65408 || *v7 )
    {
      ControllerToUpdate->RightStickY = 0;
      *v7 = 1;
    }
    else
    {
      ControllerToUpdate->RightStickY = 128;
    }
  }
  if ( *((_DWORD *)v4 + 3980) == ButtonPress )
  {
    v8 = &this->m_bStickR_Up_Dwn_MovementBothDown[ControllerType];
    if ( ControllerToUpdate->RightStickY == 128 || *v8 )
    {
      ControllerToUpdate->RightStickY = 0;
      *v8 = 1;
    }
    else
    {
      ControllerToUpdate->RightStickY = -128;
    }
  }
}

//----- (003E82E0) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonDown_VehicleAndThirdPersonOnly(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType,
        CControllerState *ControllerToUpdate)
{
  if ( this->ConfigurationForAction[10][ControllerType].m_uiActionInitiator == ButtonPress )
    ControllerToUpdate->ButtonTriangle = 255;
}

//----- (003E82F4) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonDown_FirstAndThirdPersonOnly(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType,
        CControllerState *ControllerToUpdate)
{
  bool *v8; // r0
  int16 v9; // r2
  bool *v10; // r2
  bool *v11; // r2
  bool *v12; // r2
  bool *v13; // r0

  CPad::GetPad(0);
  v8 = &this->m_bJoyJustInitialised + 8 * ControllerType;
  if ( *((_DWORD *)v8 + 3652) == ButtonPress )
    ControllerToUpdate->ButtonCircle = 255;
  if ( *((_DWORD *)v8 + 3660) == ButtonPress )
    ControllerToUpdate->LeftShoulder1 = 255;
  if ( *((_DWORD *)v8 + 4012) == ButtonPress )
    ControllerToUpdate->RightShoulder1 = 255;
  if ( *((_DWORD *)v8 + 3684) == ButtonPress )
  {
    if ( this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickY = 0;
      this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickY = -128;
    }
  }
  if ( *((_DWORD *)v8 + 3692) == ButtonPress )
  {
    if ( this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickY = 0;
      this->m_bStickL_Up_Dwn_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickY = 128;
    }
  }
  if ( *((_DWORD *)v8 + 3700) == ButtonPress )
  {
    if ( this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickX = 0;
      this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickX = -128;
    }
  }
  if ( *((_DWORD *)v8 + 3708) == ButtonPress )
  {
    if ( this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] )
    {
      ControllerToUpdate->LeftStickX = 0;
      this->m_bStickL_X_Rgh_Lft_MovementBothDown[ControllerType] = 1;
    }
    else
    {
      ControllerToUpdate->LeftStickX = 128;
    }
  }
  if ( *((_DWORD *)v8 + 3788) == ButtonPress )
    ControllerToUpdate->m_bPedWalk = 255;
  if ( *((_DWORD *)v8 + 4044) == ButtonPress )
  {
    if ( ControllerToUpdate->DPadDown )
    {
      v9 = 0;
      ControllerToUpdate->DPadDown = 0;
    }
    else
    {
      v9 = 255;
    }
    ControllerToUpdate->DPadUp = v9;
  }
  if ( *((_DWORD *)v8 + 4052) == ButtonPress )
  {
    if ( ControllerToUpdate->DPadUp )
      *(_DWORD *)&ControllerToUpdate->DPadUp = 0;
    else
      ControllerToUpdate->DPadDown = 255;
  }
  if ( *((_DWORD *)v8 + 3908) == ButtonPress )
  {
    v10 = &this->m_bStickR_X_Rgh_Lft_MovementBothDown[ControllerType];
    if ( ControllerToUpdate->RightStickX == 128 || *v10 )
    {
      ControllerToUpdate->RightStickX = 0;
      *v10 = 1;
    }
    else
    {
      ControllerToUpdate->RightStickX = -128;
    }
  }
  if ( *((_DWORD *)v8 + 3916) == ButtonPress )
  {
    v11 = &this->m_bStickR_X_Rgh_Lft_MovementBothDown[ControllerType];
    if ( (unsigned __int16)ControllerToUpdate->RightStickX == 65408 || *v11 )
    {
      ControllerToUpdate->RightStickX = 0;
      *v11 = 1;
    }
    else
    {
      ControllerToUpdate->RightStickX = 128;
    }
  }
  if ( FrontEndMenuManager.m_ControlMethod == 1 )
  {
    if ( *((_DWORD *)v8 + 4060) == ButtonPress )
    {
      v12 = &this->m_bStickR_Up_Dwn_MovementBothDown[ControllerType];
      if ( (unsigned __int16)ControllerToUpdate->RightStickY == 65408 || *v12 )
      {
        ControllerToUpdate->RightStickY = 0;
        *v12 = 1;
      }
      else
      {
        ControllerToUpdate->RightStickY = 128;
      }
    }
    if ( *((_DWORD *)v8 + 4068) == ButtonPress )
    {
      v13 = &this->m_bStickR_Up_Dwn_MovementBothDown[ControllerType];
      if ( ControllerToUpdate->RightStickY == 128 || *v13 )
      {
        ControllerToUpdate->RightStickY = 0;
        *v13 = 1;
      }
      else
      {
        ControllerToUpdate->RightStickY = -128;
      }
    }
  }
}

//----- (003E84E0) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonDown_FirstPersonOnly(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType,
        CControllerState *ControllerToUpdate)
{
  bool *v4; // r0

  v4 = &this->m_bJoyJustInitialised + 8 * ControllerType;
  if ( *((_DWORD *)v4 + 3716) == ButtonPress )
    ControllerToUpdate->ButtonSquare = 255;
  if ( *((_DWORD *)v4 + 3724) == ButtonPress )
    ControllerToUpdate->ButtonCross = 255;
  if ( *((_DWORD *)v4 + 3772) == ButtonPress )
    ControllerToUpdate->ShockButtonL = 255;
}

//----- (003E8510) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonDown_ThirdPersonOnly(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType,
        CControllerState *ControllerToUpdate)
{
  bool *v4; // r0

  v4 = &this->m_bJoyJustInitialised + 8 * ControllerType;
  if ( *((_DWORD *)v4 + 3764) == ButtonPress )
    ControllerToUpdate->ShockButtonR = 255;
  if ( *((_DWORD *)v4 + 3748) == ButtonPress )
    ControllerToUpdate->ButtonSquare = 255;
  if ( *((_DWORD *)v4 + 3780) == ButtonPress )
    ControllerToUpdate->LeftShoulder1 = 255;
  if ( *((_DWORD *)v4 + 3676) == ButtonPress )
    ControllerToUpdate->LeftShoulder2 = 255;
  if ( *((_DWORD *)v4 + 3668) == ButtonPress )
    ControllerToUpdate->RightShoulder2 = 255;
  if ( *((_DWORD *)v4 + 3756) == ButtonPress )
    ControllerToUpdate->ButtonCross = 255;
  if ( *((_DWORD *)v4 + 3772) == ButtonPress )
    ControllerToUpdate->ShockButtonL = 255;
  if ( FrontEndMenuManager.m_ControlMethod == 1 && *((_DWORD *)v4 + 4004) == ButtonPress )
    ControllerToUpdate->LeftShoulder1 = 255;
}

//----- (003E859C) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonDown_AllStates(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType,
        CControllerState *ControllerToUpdate)
{
  bool *v4; // r0
  int16 v5; // r2

  v4 = &this->m_bJoyJustInitialised + 8 * ControllerType;
  if ( *((_DWORD *)v4 + 3740) == ButtonPress )
    ControllerToUpdate->Select = 255;
  if ( *((_DWORD *)v4 + 4036) == ButtonPress )
  {
    if ( ControllerToUpdate->DPadRight )
      *(_DWORD *)&ControllerToUpdate->DPadLeft = 0;
    else
      ControllerToUpdate->DPadLeft = 255;
  }
  if ( *((_DWORD *)v4 + 4028) == ButtonPress )
  {
    if ( ControllerToUpdate->DPadLeft )
    {
      v5 = 0;
      ControllerToUpdate->DPadLeft = 0;
    }
    else
    {
      v5 = 255;
    }
    ControllerToUpdate->DPadRight = v5;
  }
  if ( *((_DWORD *)v4 + 4020) == ButtonPress )
    ControllerToUpdate->m_bChatIndicated = 255;
}

//----- (003E85EE) --------------------------------------------------------
Int32 __fastcall CControllerConfigManager::GetControllerKeyAssociatedWithAction(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        eControllerType ControllerArraytoEnter)
{
  return this->ConfigurationForAction[Action][ControllerArraytoEnter].m_uiActionInitiator;
}

//----- (003E8600) --------------------------------------------------------
void __fastcall CControllerConfigManager::UpdateJoyInConfigMenus_ButtonUp(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        int PadNumber)
{
  CPad *Pad; // r0
  bool v6; // zf

  if ( ButtonPress )
  {
    Pad = CPad::GetPad(PadNumber);
    if ( Pad )
    {
      switch ( ButtonPress )
      {
        case 5:
          Pad->PCTempJoyState.LeftShoulder2 = 0;
          break;
        case 6:
          Pad->PCTempJoyState.RightShoulder2 = 0;
          break;
        case 7:
          Pad->PCTempJoyState.LeftShoulder1 = 0;
          break;
        case 8:
          Pad->PCTempJoyState.RightShoulder1 = 0;
          break;
        case 9:
          Pad->PCTempJoyState.Select = 0;
          break;
        case 10:
          Pad->PCTempJoyState.ShockButtonL = 0;
          break;
        case 11:
          Pad->PCTempJoyState.ShockButtonR = 0;
          break;
        case 12:
          if ( PadNumber == 1 )
            Pad->PCTempJoyState.Start = 0;
          break;
        case 13:
          Pad->PCTempJoyState.DPadUp = 0;
          break;
        case 14:
          Pad->PCTempJoyState.DPadRight = 0;
          break;
        case 15:
          Pad->PCTempJoyState.DPadDown = 0;
          break;
        case 16:
          Pad->PCTempJoyState.DPadLeft = 0;
          break;
        default:
          break;
      }
      v6 = AllValidWinJoys.JoyStickNum[0].wVendorID == 13351;
      if ( AllValidWinJoys.JoyStickNum[0].wVendorID == 13351 )
        v6 = AllValidWinJoys.JoyStickNum[0].wProductID == 4496;
      if ( !v6 )
      {
        switch ( ButtonPress )
        {
          case 1:
            goto LABEL_24;
          case 2:
            goto LABEL_26;
          case 3:
            goto LABEL_27;
          case 4:
            goto LABEL_28;
        }
      }
      switch ( ButtonPress )
      {
        case 1:
LABEL_28:
          Pad->PCTempJoyState.ButtonTriangle = 0;
          break;
        case 2:
LABEL_24:
          Pad->PCTempJoyState.ButtonCircle = 0;
          break;
        case 3:
LABEL_26:
          Pad->PCTempJoyState.ButtonCross = 0;
          break;
        case 4:
LABEL_27:
          Pad->PCTempJoyState.ButtonSquare = 0;
          break;
        default:
          return;
      }
    }
  }
}

//----- (003E86F0) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonUp(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType)
{
  char v5; // r0
  CControllerState *p_PCTempKeyState; // r9
  char v8; // r0
  char v9; // r1
  unsigned __int8 v10; // r0
  __int32 v11; // r1
  int v12; // r6
  bool v13; // zf
  bool *v14; // r0

  v5 = 0;
  if ( (unsigned int)ControllerType > OPTIONAL_EXTRA_KEY )
    v5 = 1;
  p_PCTempKeyState = 0;
  v8 = v5 | (ButtonPress != 1056);
  v9 = ControllerType ^ 3 | ButtonPress;
  if ( ControllerType ^ 3 | ButtonPress )
    v9 = 1;
  v10 = v8 & v9;
  v11 = ControllerType ^ 2 | ButtonPress;
  v12 = v10 & (v11 != 0);
  if ( (unsigned int)ControllerType < MOUSE )
  {
    p_PCTempKeyState = &CPad::GetPad(0)->PCTempKeyState;
    goto LABEL_11;
  }
  if ( ControllerType != MOUSE )
  {
    if ( ControllerType == JOY_STICK )
    {
      p_PCTempKeyState = &CPad::GetPad(0)->PCTempJoyState;
      if ( v12 != 1 )
        return;
      goto LABEL_14;
    }
LABEL_11:
    if ( v12 != 1 )
      return;
    goto LABEL_14;
  }
  p_PCTempKeyState = &CPad::GetPad(0)->PCTempMouseState;
  if ( v12 != 1 )
    return;
LABEL_14:
  if ( CPad::GetPad(0) )
  {
    v13 = gMobileMenu.screenStack.numEntries == 0;
    if ( !gMobileMenu.screenStack.numEntries )
      v13 = gMobileMenu.pendingScreen == 0;
    if ( v13 )
    {
      v14 = &this->m_bJoyJustInitialised + 8 * ControllerType;
      if ( *((_DWORD *)v14 + 4020) == ButtonPress )
        p_PCTempKeyState->m_bChatIndicated = 0;
      if ( *((_DWORD *)v14 + 3948) == ButtonPress )
        p_PCTempKeyState->m_bVehicleMouseLook = 0;
    }
  }
}

//----- (003E87B4) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectControllerStateOn_ButtonUp_All_Player_States(
        CControllerConfigManager *this,
        RwInt32 ButtonPress,
        eControllerType ControllerType,
        CControllerState *ControllerToUpdate)
{
  bool *v4; // r0

  v4 = &this->m_bJoyJustInitialised + 8 * ControllerType;
  if ( *((_DWORD *)v4 + 4020) == ButtonPress )
    ControllerToUpdate->m_bChatIndicated = 0;
  if ( *((_DWORD *)v4 + 3948) == ButtonPress )
    ControllerToUpdate->m_bVehicleMouseLook = 0;
}

//----- (003E87D8) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectPadFromKeyBoard(CControllerConfigManager *this)
{
  unsigned int v2; // r9
  RsKeyCodes_0 *v3; // r4
  int v4; // r10
  RwInt32 v5; // r5
  OSKeyboardKey v6; // r0
  RwInt32 v7; // r6
  OSKeyboardKey v8; // r0
  OSKeyboardKey v9; // r0
  OSKeyboardKey v10; // r0
  CPad *v11; // r5
  bool v12; // zf
  CPad *Pad; // r6
  bool v14; // zf

  if ( CPad::m_bMapPadOneToPadTwo )
  {
    v2 = 1;
  }
  else
  {
    v2 = (int)gMobileMenu.pendingScreen | gMobileMenu.screenStack.numEntries;
    if ( (int)gMobileMenu.pendingScreen | gMobileMenu.screenStack.numEntries )
      v2 = 1;
  }
  v3 = (RsKeyCodes_0 *)&this->ConfigurationForAction[0][1];
  v4 = 182;
  do
  {
    v5 = *((_DWORD *)v3 - 2);
    v6 = RsKeyToOSWKey((RsKeyCodes_0)v5);
    if ( v6 != KK_MAX && !((LIB_KeyboardIsDown(v6) == 0) | v2) )
      CControllerConfigManager::AffectControllerStateOn_ButtonDown(this, v5, KEYBOARD);
    v7 = *v3;
    v8 = RsKeyToOSWKey(*v3);
    if ( v8 != KK_MAX && !((LIB_KeyboardIsDown(v8) == 0) | v2) )
      CControllerConfigManager::AffectControllerStateOn_ButtonDown(this, v7, OPTIONAL_EXTRA_KEY);
    v9 = RsKeyToOSWKey((RsKeyCodes_0)v5);
    if ( v9 == KK_MAX || !LIB_KeyboardIsDown(v9) )
    {
      Pad = CPad::GetPad(0);
      if ( v5 != 1056 && CPad::GetPad(0) )
      {
        v14 = gMobileMenu.screenStack.numEntries == 0;
        if ( !gMobileMenu.screenStack.numEntries )
          v14 = gMobileMenu.pendingScreen == 0;
        if ( v14 )
        {
          if ( this->ConfigurationForAction[46][0].m_uiActionInitiator == v5 )
            Pad->PCTempKeyState.m_bChatIndicated = 0;
          if ( this->ConfigurationForAction[37][0].m_uiActionInitiator == v5 )
            Pad->PCTempKeyState.m_bVehicleMouseLook = 0;
        }
      }
    }
    else
    {
      v10 = RsKeyToOSWKey((RsKeyCodes_0)v7);
      if ( v10 == KK_MAX || !LIB_KeyboardIsDown(v10) )
      {
        v11 = CPad::GetPad(0);
        if ( v7 != 1056 )
        {
          if ( CPad::GetPad(0) )
          {
            v12 = gMobileMenu.screenStack.numEntries == 0;
            if ( !gMobileMenu.screenStack.numEntries )
              v12 = gMobileMenu.pendingScreen == 0;
            if ( v12 )
            {
              if ( this->ConfigurationForAction[46][1].m_uiActionInitiator == v7 )
                v11->PCTempKeyState.m_bChatIndicated = 0;
              if ( this->ConfigurationForAction[37][1].m_uiActionInitiator == v7 )
                v11->PCTempKeyState.m_bVehicleMouseLook = 0;
            }
          }
        }
      }
    }
    v3 += 8;
    --v4;
  }
  while ( v4 );
}

//----- (003E8964) --------------------------------------------------------
bool __fastcall CControllerConfigManager::GetIsKeyboardKeyDown(
        CControllerConfigManager *this,
        RsKeyCodes_0 RwKeyCodeToCheck)
{
  OSKeyboardKey v2; // r0

  v2 = RsKeyToOSWKey(RwKeyCodeToCheck);
  return v2 != KK_MAX && LIB_KeyboardIsDown(v2) != 0;
}

//----- (003E8984) --------------------------------------------------------
void __fastcall CControllerConfigManager::AffectPadFromMouse(CControllerConfigManager *this)
{
  CControllerConfig *v1; // r6
  CControllerConfig *v2; // r8
  CControllerConfigManager **v3; // r9
  int v4; // r10
  CControllerConfigManager *IsMouseButtonUp; // r0
  RsKeyCodes_0 m_uiActionInitiator; // r4
  _BOOL4 IsMouseButtonDown; // r0
  CControllerConfigManager *v8; // r5
  bool v9; // zf

  v1 = &this->ConfigurationForAction[0][2];
  v2 = &this->ConfigurationForAction[46][2];
  v3 = (CControllerConfigManager **)&this->ConfigurationForAction[37][2];
  v4 = 0;
  IsMouseButtonUp = (CControllerConfigManager *)&gMobileMenu_ptr;
  do
  {
    m_uiActionInitiator = v1[v4].m_uiActionInitiator;
    IsMouseButtonDown = CControllerConfigManager::GetIsMouseButtonDown(IsMouseButtonUp, m_uiActionInitiator);
    IsMouseButtonUp = (CControllerConfigManager *)CControllerConfigManager::GetIsMouseButtonUp(
                                                    (CControllerConfigManager *)IsMouseButtonDown,
                                                    m_uiActionInitiator);
    if ( IsMouseButtonUp == (CControllerConfigManager *)((char *)&dword_0 + 1) )
    {
      IsMouseButtonUp = (CControllerConfigManager *)CPad::GetPad(0);
      v8 = IsMouseButtonUp;
      if ( m_uiActionInitiator )
      {
        IsMouseButtonUp = (CControllerConfigManager *)CPad::GetPad(0);
        if ( IsMouseButtonUp )
        {
          IsMouseButtonUp = (CControllerConfigManager *)gMobileMenu.screenStack.numEntries;
          v9 = gMobileMenu.screenStack.numEntries == 0;
          if ( !gMobileMenu.screenStack.numEntries )
          {
            IsMouseButtonUp = (CControllerConfigManager *)gMobileMenu.pendingScreen;
            v9 = gMobileMenu.pendingScreen == 0;
          }
          if ( v9 )
          {
            if ( v2->m_uiActionInitiator == m_uiActionInitiator )
              v8->m_arrControllerActionName[3][4] = 0;
            IsMouseButtonUp = *v3;
            if ( *v3 == (CControllerConfigManager *)m_uiActionInitiator )
            {
              IsMouseButtonUp = 0;
              v8->m_arrControllerActionName[3][6] = 0;
            }
          }
        }
      }
    }
    v4 += 4;
  }
  while ( v4 != 728 );
}
// 0: using guessed type int dword_0;

//----- (003E8A14) --------------------------------------------------------
bool __fastcall CControllerConfigManager::GetIsMouseButtonDown(
        CControllerConfigManager *this,
        RsKeyCodes_0 RwKeyCodeToCheck)
{
  bool result; // r0

  switch ( RwKeyCodeToCheck )
  {
    case 1:
      CPad::GetPad(0);
      if ( !CPad::NewMouseControllerState.m_bLeftButton )
        goto LABEL_4;
      result = 1;
      break;
    case 2:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bMiddleButton != 0;
      break;
    case 3:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bRightButton != 0;
      break;
    case 4:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bWheelMovedUp != 0;
      break;
    case 5:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bWheelMovedDown != 0;
      break;
    case 6:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bMsFirstXButton != 0;
      break;
    case 7:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bMsSecondXButton != 0;
      break;
    default:
LABEL_4:
      result = 0;
      break;
  }
  return result;
}

//----- (003E8AFC) --------------------------------------------------------
bool __fastcall CControllerConfigManager::GetIsMouseButtonUp(
        CControllerConfigManager *this,
        RsKeyCodes_0 RwKeyCodeToCheck)
{
  bool result; // r0

  switch ( RwKeyCodeToCheck )
  {
    case 1:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bLeftButton )
        goto LABEL_4;
      result = 1;
      break;
    case 2:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bMiddleButton == 0;
      break;
    case 3:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bRightButton == 0;
      break;
    case 4:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bWheelMovedUp == 0;
      break;
    case 5:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bWheelMovedDown == 0;
      break;
    case 6:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bMsFirstXButton == 0;
      break;
    case 7:
      CPad::GetPad(0);
      result = CPad::NewMouseControllerState.m_bMsSecondXButton == 0;
      break;
    default:
LABEL_4:
      result = 0;
      break;
  }
  return result;
}

//----- (003E8BE4) --------------------------------------------------------
void __fastcall CControllerConfigManager::ClearSimButtonPressCheckers(CControllerConfigManager *this)
{
  bool *m_bStickL_X_Rgh_Lft_MovementBothDown; // r0

  m_bStickL_X_Rgh_Lft_MovementBothDown = this->m_bStickL_X_Rgh_Lft_MovementBothDown;
  *(_QWORD *)m_bStickL_X_Rgh_Lft_MovementBothDown = 0LL;
  *((_QWORD *)m_bStickL_X_Rgh_Lft_MovementBothDown + 1) = 0LL;
}

//----- (003E8BF4) --------------------------------------------------------
bool __fastcall CControllerConfigManager::GetIsKeyboardKeyJustDown(
        CControllerConfigManager *this,
        RsKeyCodes_0 RwKeyCodeToCheck)
{
  OSKeyboardKey v2; // r0

  v2 = RsKeyToOSWKey(RwKeyCodeToCheck);
  return v2 != KK_MAX && LIB_KeyboardPressed(v2) != 0;
}

//----- (003E8C14) --------------------------------------------------------
bool __fastcall CControllerConfigManager::GetIsMouseButtonJustUp(
        CControllerConfigManager *this,
        RsKeyCodes_0 RwKeyCodeToCheck)
{
  bool result; // r0

  switch ( RwKeyCodeToCheck )
  {
    case 1:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bLeftButton )
        goto LABEL_15;
      CPad::GetPad(0);
      result = CPad::OldMouseControllerState.m_bLeftButton != 0;
      break;
    case 2:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bRightButton )
        goto LABEL_15;
      CPad::GetPad(0);
      result = CPad::OldMouseControllerState.m_bRightButton != 0;
      break;
    case 3:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bMiddleButton )
        goto LABEL_15;
      CPad::GetPad(0);
      result = CPad::OldMouseControllerState.m_bMiddleButton != 0;
      break;
    case 4:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bWheelMovedUp )
        goto LABEL_15;
      CPad::GetPad(0);
      result = CPad::OldMouseControllerState.m_bWheelMovedUp != 0;
      break;
    case 5:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bWheelMovedDown )
        goto LABEL_15;
      CPad::GetPad(0);
      result = CPad::OldMouseControllerState.m_bWheelMovedDown != 0;
      break;
    case 6:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bMsFirstXButton )
        goto LABEL_15;
      CPad::GetPad(0);
      result = CPad::OldMouseControllerState.m_bMsFirstXButton != 0;
      break;
    case 7:
      CPad::GetPad(0);
      if ( CPad::NewMouseControllerState.m_bMsSecondXButton )
        goto LABEL_15;
      CPad::GetPad(0);
      result = CPad::OldMouseControllerState.m_bMsSecondXButton != 0;
      break;
    default:
LABEL_15:
      result = 0;
      break;
  }
  return result;
}

//----- (003E8D98) --------------------------------------------------------
void __fastcall CControllerConfigManager::DeleteMatchingCommonControls(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  bool *v7; // r4

  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
  {
    if ( KeyToBeChecked == 1056 )
      return;
  }
  else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
  {
    return;
  }
  v7 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
  if ( *((_DWORD *)v7 + 3740) == KeyToBeChecked )
  {
    *((_DWORD *)v7 + 3740) = *(&off_616CBC + ControllerTypeToBeChecked);
    *((_DWORD *)v7 + 3741) = 0;
    CControllerConfigManager::ResetSettingOrder(this, CAMERA_CHANGE_VIEW_ALL_SITUATIONS);
  }
  if ( *((_DWORD *)v7 + 4020) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 4020) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 4021) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, NETWORK_TALK);
  }
  if ( *((_DWORD *)v7 + 4092) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 4092) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 4093) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, SWITCH_DEBUG_CAM_ON);
  }
  if ( *((_DWORD *)v7 + 4084) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 4084) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 4085) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, TOGGLE_DPAD);
  }
  if ( *((_DWORD *)v7 + 4100) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 4100) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 4101) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, TAKE_SCREEN_SHOT);
  }
  if ( *((_DWORD *)v7 + 4108) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 4108) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 4109) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, SHOW_MOUSE_POINTER_TOGGLE);
  }
}
// 3E8DCE: conditional instruction was optimized away because r3.4<4u
// 616CBC: using guessed type void *off_616CBC;

//----- (003E8EE4) --------------------------------------------------------
bool __fastcall CControllerConfigManager::GetIsKeyBlank(
        CControllerConfigManager *this,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
    return KeyToBeChecked == 1056;
  if ( ControllerTypeToBeChecked == MOUSE )
    return KeyToBeChecked == 0;
  return ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked;
}

//----- (003E8F14) --------------------------------------------------------
void __fastcall CControllerConfigManager::DeleteMatching3rdPersonControls(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  bool *v8; // r4
  Int8 m_ControlMethod; // r2
  bool v10; // zf

  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
  {
    if ( KeyToBeChecked == 1056 )
      return;
  }
  else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
  {
    return;
  }
  v8 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
  if ( *((_DWORD *)v8 + 3700) == KeyToBeChecked )
  {
    *((_DWORD *)v8 + 3700) = *(&off_616CBC + ControllerTypeToBeChecked);
    *((_DWORD *)v8 + 3701) = 0;
    CControllerConfigManager::ResetSettingOrder(this, GO_LEFT);
  }
  if ( *((_DWORD *)v8 + 3708) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3708) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3709) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, GO_RIGHT);
  }
  if ( *((_DWORD *)v8 + 4044) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 4044) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 4045) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, GROUP_CONTROL_FWD);
  }
  if ( *((_DWORD *)v8 + 4052) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 4052) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 4053) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, GROUP_CONTROL_BWD);
  }
  if ( *((_DWORD *)v8 + 4036) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 4036) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 4037) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, CONVERSATION_NO);
  }
  if ( *((_DWORD *)v8 + 4028) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 4028) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 4029) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, CONVERSATION_YES);
  }
  if ( *((_DWORD *)v8 + 3676) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3676) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3677) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_CYCLE_WEAPON_LEFT);
  }
  if ( *((_DWORD *)v8 + 3668) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3668) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3669) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_CYCLE_WEAPON_RIGHT);
  }
  if ( *((_DWORD *)v8 + 3748) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3748) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3749) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_JUMPING);
  }
  if ( *((_DWORD *)v8 + 3756) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3756) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3757) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_SPRINT);
  }
  if ( *((_DWORD *)v8 + 3764) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3764) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3765) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_LOOKBEHIND);
  }
  if ( *((_DWORD *)v8 + 3772) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3772) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3773) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_DUCK);
  }
  if ( *((_DWORD *)v8 + 3780) == KeyToBeChecked )
  {
    m_ControlMethod = FrontEndMenuManager.m_ControlMethod;
    if ( FrontEndMenuManager.m_ControlMethod != 1 )
      m_ControlMethod = 0;
    v10 = FrontEndMenuManager.m_ControlMethod == 0;
    if ( FrontEndMenuManager.m_ControlMethod )
      v10 = ((Action != PED_FIREWEAPON_ALT) & (unsigned __int8)m_ControlMethod) == 1;
    if ( v10 )
    {
      if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
      {
        *((_DWORD *)v8 + 3780) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v8 + 3781) = 0;
      }
      CControllerConfigManager::ResetSettingOrder(this, PED_ANSWER_PHONE);
    }
  }
  if ( *((_DWORD *)v8 + 3788) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 3788) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 3789) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_WALK);
  }
  if ( FrontEndMenuManager.m_ControlMethod == 1 && *((_DWORD *)v8 + 4004) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v8 + 4004) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v8 + 4005) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_CENTER_CAMERA_BEHIND_PLAYER);
  }
}
// 3E8F4C: conditional instruction was optimized away because r3.4<4u
// 616CBC: using guessed type void *off_616CBC;

//----- (003E9240) --------------------------------------------------------
void __fastcall CControllerConfigManager::DeleteMatching1rst3rdPersonControls(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  bool *v7; // r4
  _BOOL4 v8; // r2
  int m_ControlMethod; // r1
  bool v10; // zf

  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
  {
    if ( KeyToBeChecked == 1056 )
      return;
  }
  else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
  {
    return;
  }
  v7 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
  if ( *((_DWORD *)v7 + 3660) == KeyToBeChecked )
  {
    v8 = Action != PED_ANSWER_PHONE;
    m_ControlMethod = (unsigned __int8)FrontEndMenuManager.m_ControlMethod;
    if ( FrontEndMenuManager.m_ControlMethod != 1 )
      m_ControlMethod = 0;
    v10 = FrontEndMenuManager.m_ControlMethod == 0;
    if ( FrontEndMenuManager.m_ControlMethod )
      v10 = (m_ControlMethod & v8) == 1;
    if ( v10 )
    {
      *((_DWORD *)v7 + 3660) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3661) = 0;
      CControllerConfigManager::ResetSettingOrder(this, PED_FIREWEAPON_ALT);
    }
  }
  if ( *((_DWORD *)v7 + 3652) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3652) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3653) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_FIREWEAPON);
  }
  if ( *((_DWORD *)v7 + 4012) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 4012) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 4013) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_LOCK_TARGET);
  }
  if ( *((_DWORD *)v7 + 3684) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3684) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3685) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, GO_FORWARD);
  }
  if ( *((_DWORD *)v7 + 3692) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3692) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3693) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, GO_BACK);
  }
  if ( FrontEndMenuManager.m_ControlMethod == 1 )
  {
    if ( *((_DWORD *)v7 + 3908) == KeyToBeChecked )
    {
      if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
      {
        *((_DWORD *)v7 + 3908) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v7 + 3909) = 0;
      }
      CControllerConfigManager::ResetSettingOrder(this, PED_1RST_PERSON_LOOK_LEFT);
    }
    if ( *((_DWORD *)v7 + 3916) == KeyToBeChecked )
    {
      if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
      {
        *((_DWORD *)v7 + 3916) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v7 + 3917) = 0;
      }
      CControllerConfigManager::ResetSettingOrder(this, PED_1RST_PERSON_LOOK_RIGHT);
    }
    if ( *((_DWORD *)v7 + 4068) == KeyToBeChecked )
    {
      if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
      {
        *((_DWORD *)v7 + 4068) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v7 + 4069) = 0;
      }
      CControllerConfigManager::ResetSettingOrder(this, PED_1RST_PERSON_LOOK_DOWN);
    }
    if ( *((_DWORD *)v7 + 4060) == KeyToBeChecked )
    {
      if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
      {
        *((_DWORD *)v7 + 4060) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v7 + 4061) = 0;
      }
      CControllerConfigManager::ResetSettingOrder(this, PED_1RST_PERSON_LOOK_UP);
    }
  }
}
// 3E929C: conditional instruction was optimized away because r3.4<4u
// 616CBC: using guessed type void *off_616CBC;

//----- (003E9454) --------------------------------------------------------
void __fastcall CControllerConfigManager::DeleteMatchingVehicleControls(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  bool *v7; // r4

  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
  {
    if ( KeyToBeChecked == 1056 )
      return;
  }
  else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
  {
    return;
  }
  v7 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
  if ( *((_DWORD *)v7 + 3804) == KeyToBeChecked )
  {
    *((_DWORD *)v7 + 3804) = *(&off_616CBC + ControllerTypeToBeChecked);
    *((_DWORD *)v7 + 3805) = 0;
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_FIREWEAPON_ALT);
  }
  if ( *((_DWORD *)v7 + 3796) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3796) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3797) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_FIREWEAPON);
  }
  if ( *((_DWORD *)v7 + 3812) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3812) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3813) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_STEER_LEFT);
  }
  if ( *((_DWORD *)v7 + 3820) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3820) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3821) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_STEER_RIGHT);
  }
  if ( *((_DWORD *)v7 + 3828) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3828) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3829) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_STEER_UP);
  }
  if ( *((_DWORD *)v7 + 3836) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3836) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3837) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_STEER_DOWN);
  }
  if ( *((_DWORD *)v7 + 3844) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3844) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3845) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_ACCELERATE);
  }
  if ( *((_DWORD *)v7 + 3852) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3852) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3853) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_BRAKE);
  }
  if ( *((_DWORD *)v7 + 3860) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3860) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3861) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_RADIO_STATION_UP);
  }
  if ( *((_DWORD *)v7 + 3868) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3868) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3869) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_RADIO_STATION_DOWN);
  }
  if ( *((_DWORD *)v7 + 3876) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3876) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3877) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_RADIO_TRACK_SKIP);
  }
  if ( *((_DWORD *)v7 + 3884) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3884) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3885) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_HORN);
  }
  if ( *((_DWORD *)v7 + 3892) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3892) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3893) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, TOGGLE_SUBMISSIONS);
  }
  if ( *((_DWORD *)v7 + 3900) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3900) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3901) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_HANDBRAKE);
  }
  if ( *((_DWORD *)v7 + 3924) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3924) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3925) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_LOOKLEFT);
  }
  if ( *((_DWORD *)v7 + 3932) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3932) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3933) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_LOOKRIGHT);
  }
  if ( *((_DWORD *)v7 + 3940) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3940) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3941) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_LOOKBEHIND);
  }
  if ( *((_DWORD *)v7 + 3948) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3948) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3949) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_MOUSELOOK);
  }
  if ( *((_DWORD *)v7 + 3956) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3956) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3957) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_TURRETLEFT);
  }
  if ( *((_DWORD *)v7 + 3964) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3964) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3965) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_TURRETRIGHT);
  }
  if ( *((_DWORD *)v7 + 3972) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3972) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3973) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_TURRETUP);
  }
  if ( *((_DWORD *)v7 + 3980) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3980) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3981) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, VEHICLE_TURRETDOWN);
  }
}
// 3E948A: conditional instruction was optimized away because r3.4<4u
// 616CBC: using guessed type void *off_616CBC;

//----- (003E9880) --------------------------------------------------------
void __fastcall CControllerConfigManager::DeleteMatchingVehicle_3rdPersonControls(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  bool *v4; // lr

  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
  {
    if ( KeyToBeChecked == 1056 )
      return;
    goto LABEL_5;
  }
  if ( (ControllerTypeToBeChecked == MOUSE || ControllerTypeToBeChecked == JOY_STICK) && KeyToBeChecked )
  {
LABEL_5:
    v4 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
    if ( *((_DWORD *)v4 + 3732) == KeyToBeChecked )
    {
      *((_DWORD *)v4 + 3732) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v4 + 3733) = 0;
      CControllerConfigManager::ResetSettingOrder(this, VEHICLE_ENTER_EXIT);
    }
  }
}
// 3E98A4: conditional instruction was optimized away because r3.4<4u
// 616CBC: using guessed type void *off_616CBC;

//----- (003E98D4) --------------------------------------------------------
void __fastcall CControllerConfigManager::DeleteMatching1rstPersonControls(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  bool *v7; // r4

  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
  {
    if ( KeyToBeChecked == 1056 )
      return;
  }
  else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
  {
    return;
  }
  v7 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
  if ( *((_DWORD *)v7 + 3716) == KeyToBeChecked )
  {
    *((_DWORD *)v7 + 3716) = *(&off_616CBC + ControllerTypeToBeChecked);
    *((_DWORD *)v7 + 3717) = 0;
    CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_IN);
  }
  if ( *((_DWORD *)v7 + 3724) == KeyToBeChecked )
  {
    if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
    {
      *((_DWORD *)v7 + 3724) = *(&off_616CBC + ControllerTypeToBeChecked);
      *((_DWORD *)v7 + 3725) = 0;
    }
    CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_OUT);
  }
}
// 3E9906: conditional instruction was optimized away because r3.4<4u
// 616CBC: using guessed type void *off_616CBC;

//----- (003E9964) --------------------------------------------------------
void __fastcall CControllerConfigManager::DeleteMatchingActionInitiators(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        RwInt32 KeyToBeChecked,
        eControllerType ControllerTypeToBeChecked)
{
  e_ControllerAction v8; // r1
  bool *v9; // r0
  _DWORD *v10; // r1
  e_ControllerAction v11; // r1
  bool *v12; // r9
  bool *v13; // r9
  e_ControllerAction v14; // r1
  e_ControllerAction v15; // r1
  CControllerConfigManager *v16; // r0
  RwInt32 v17; // r2
  eControllerType v18; // r3

  if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
  {
    if ( KeyToBeChecked == 1056 )
      return;
  }
  else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
  {
    return;
  }
  switch ( Action )
  {
    case PED_FIREWEAPON:
    case PED_FIREWEAPON_ALT:
    case GO_FORWARD:
    case GO_BACK:
    case GO_LEFT:
    case GO_RIGHT:
    case PED_SNIPER_ZOOM_IN:
    case PED_SNIPER_ZOOM_OUT:
    case PED_1RST_PERSON_LOOK_LEFT:
    case PED_1RST_PERSON_LOOK_RIGHT:
    case PED_LOCK_TARGET:
    case PED_1RST_PERSON_LOOK_UP:
    case PED_1RST_PERSON_LOOK_DOWN:
      CControllerConfigManager::DeleteMatchingCommonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
      {
        if ( KeyToBeChecked == 1056 )
          goto LABEL_43;
      }
      else if ( ControllerTypeToBeChecked == MOUSE )
      {
        if ( !KeyToBeChecked )
        {
          CControllerConfigManager::DeleteMatching1rst3rdPersonControls(this, Action, 0, MOUSE);
          CControllerConfigManager::DeleteMatching3rdPersonControls(this, Action, 0, MOUSE);
          return;
        }
      }
      else if ( ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
      {
        CControllerConfigManager::DeleteMatching1rst3rdPersonControls(
          this,
          Action,
          KeyToBeChecked,
          ControllerTypeToBeChecked);
        CControllerConfigManager::DeleteMatching3rdPersonControls(
          this,
          Action,
          KeyToBeChecked,
          ControllerTypeToBeChecked);
        if ( !KeyToBeChecked )
          return;
        goto LABEL_47;
      }
      v12 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
      if ( *((_DWORD *)v12 + 3716) == KeyToBeChecked )
      {
        *((_DWORD *)v12 + 3716) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v12 + 3717) = 0;
        CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_IN);
      }
      if ( *((_DWORD *)v12 + 3724) == KeyToBeChecked )
      {
        *((_DWORD *)v12 + 3724) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v12 + 3725) = 0;
        CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_OUT);
      }
LABEL_43:
      CControllerConfigManager::DeleteMatching1rst3rdPersonControls(
        this,
        Action,
        KeyToBeChecked,
        ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatching3rdPersonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
      {
        if ( KeyToBeChecked == 1056 )
          return;
      }
      else if ( !KeyToBeChecked )
      {
        return;
      }
LABEL_47:
      v9 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
      if ( *((_DWORD *)v9 + 3732) == KeyToBeChecked )
      {
        if ( (unsigned int)ControllerTypeToBeChecked > JOY_STICK )
          goto LABEL_65;
        v10 = v9 + 14928;
        goto LABEL_64;
      }
      return;
    case PED_CYCLE_WEAPON_RIGHT:
    case PED_CYCLE_WEAPON_LEFT:
    case PED_JUMPING:
    case PED_SPRINT:
    case PED_LOOKBEHIND:
    case PED_DUCK:
    case PED_ANSWER_PHONE:
    case PED_WALK:
    case PED_CYCLE_TARGET_LEFT:
    case PED_CYCLE_TARGET_RIGHT:
    case PED_CENTER_CAMERA_BEHIND_PLAYER:
    case CONVERSATION_YES:
    case CONVERSATION_NO:
    case GROUP_CONTROL_FWD:
    case GROUP_CONTROL_BWD:
      CControllerConfigManager::DeleteMatchingCommonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatching1rst3rdPersonControls(
        this,
        Action,
        KeyToBeChecked,
        ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatching3rdPersonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
      {
        if ( KeyToBeChecked == 1056 )
          return;
      }
      else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
      {
        return;
      }
      v9 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
      if ( *((_DWORD *)v9 + 3732) == KeyToBeChecked )
      {
        v10 = v9 + 14928;
        goto LABEL_64;
      }
      return;
    case VEHICLE_ENTER_EXIT:
      CControllerConfigManager::DeleteMatchingCommonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatching1rst3rdPersonControls(
        this,
        VEHICLE_ENTER_EXIT,
        KeyToBeChecked,
        ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatching3rdPersonControls(
        this,
        VEHICLE_ENTER_EXIT,
        KeyToBeChecked,
        ControllerTypeToBeChecked);
      v16 = this;
      v17 = KeyToBeChecked;
      v18 = ControllerTypeToBeChecked;
      goto LABEL_69;
    case CAMERA_CHANGE_VIEW_ALL_SITUATIONS:
    case NETWORK_TALK:
    case TOGGLE_DPAD:
    case SWITCH_DEBUG_CAM_ON:
    case TAKE_SCREEN_SHOT:
    case SHOW_MOUSE_POINTER_TOGGLE:
      CControllerConfigManager::DeleteMatchingCommonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
      {
        if ( KeyToBeChecked == 1056 )
          goto LABEL_57;
      }
      else if ( ControllerTypeToBeChecked == MOUSE )
      {
        if ( !KeyToBeChecked )
        {
          CControllerConfigManager::DeleteMatching1rst3rdPersonControls(this, Action, 0, MOUSE);
          CControllerConfigManager::DeleteMatching3rdPersonControls(this, Action, 0, MOUSE);
          v16 = this;
          v17 = 0;
          v18 = MOUSE;
LABEL_69:
          CControllerConfigManager::DeleteMatchingVehicleControls(v16, v15, v17, v18);
          return;
        }
      }
      else if ( ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
      {
        CControllerConfigManager::DeleteMatching1rst3rdPersonControls(
          this,
          Action,
          KeyToBeChecked,
          ControllerTypeToBeChecked);
        CControllerConfigManager::DeleteMatching3rdPersonControls(
          this,
          Action,
          KeyToBeChecked,
          ControllerTypeToBeChecked);
        CControllerConfigManager::DeleteMatchingVehicleControls(this, v11, KeyToBeChecked, ControllerTypeToBeChecked);
        if ( !KeyToBeChecked )
          return;
        goto LABEL_61;
      }
      v13 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
      if ( *((_DWORD *)v13 + 3716) == KeyToBeChecked )
      {
        *((_DWORD *)v13 + 3716) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v13 + 3717) = 0;
        CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_IN);
      }
      if ( *((_DWORD *)v13 + 3724) == KeyToBeChecked )
      {
        *((_DWORD *)v13 + 3724) = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v13 + 3725) = 0;
        CControllerConfigManager::ResetSettingOrder(this, PED_SNIPER_ZOOM_OUT);
      }
LABEL_57:
      CControllerConfigManager::DeleteMatching1rst3rdPersonControls(
        this,
        Action,
        KeyToBeChecked,
        ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatching3rdPersonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatchingVehicleControls(this, v14, KeyToBeChecked, ControllerTypeToBeChecked);
      if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
      {
        if ( KeyToBeChecked == 1056 )
          return;
      }
      else if ( !KeyToBeChecked )
      {
        return;
      }
LABEL_61:
      v9 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
      if ( *((_DWORD *)v9 + 3732) != KeyToBeChecked )
        return;
      if ( (unsigned int)ControllerTypeToBeChecked <= JOY_STICK )
      {
        v10 = v9 + 14928;
        goto LABEL_64;
      }
      goto LABEL_65;
    case VEHICLE_FIREWEAPON:
    case VEHICLE_FIREWEAPON_ALT:
    case VEHICLE_STEER_LEFT:
    case VEHICLE_STEER_RIGHT:
    case VEHICLE_STEER_UP:
    case VEHICLE_STEER_DOWN:
    case VEHICLE_ACCELERATE:
    case VEHICLE_BRAKE:
    case VEHICLE_RADIO_STATION_UP:
    case VEHICLE_RADIO_STATION_DOWN:
    case VEHICLE_RADIO_TRACK_SKIP:
    case VEHICLE_HORN:
    case TOGGLE_SUBMISSIONS:
    case VEHICLE_HANDBRAKE:
    case VEHICLE_LOOKLEFT:
    case VEHICLE_LOOKRIGHT:
    case VEHICLE_LOOKBEHIND:
    case VEHICLE_MOUSELOOK:
    case VEHICLE_TURRETLEFT:
    case VEHICLE_TURRETRIGHT:
    case VEHICLE_TURRETUP:
    case VEHICLE_TURRETDOWN:
      CControllerConfigManager::DeleteMatchingCommonControls(this, Action, KeyToBeChecked, ControllerTypeToBeChecked);
      CControllerConfigManager::DeleteMatchingVehicleControls(this, v8, KeyToBeChecked, ControllerTypeToBeChecked);
      if ( (unsigned int)ControllerTypeToBeChecked < MOUSE )
      {
        if ( KeyToBeChecked == 1056 )
          return;
      }
      else if ( ControllerTypeToBeChecked != MOUSE && ControllerTypeToBeChecked != JOY_STICK || !KeyToBeChecked )
      {
        return;
      }
      v9 = &this->m_bJoyJustInitialised + 8 * ControllerTypeToBeChecked;
      if ( *((_DWORD *)v9 + 3732) == KeyToBeChecked )
      {
        v10 = v9 + 14928;
LABEL_64:
        *v10 = *(&off_616CBC + ControllerTypeToBeChecked);
        *((_DWORD *)v9 + 3733) = 0;
LABEL_65:
        CControllerConfigManager::ResetSettingOrder(this, VEHICLE_ENTER_EXIT);
      }
      break;
    default:
      return;
  }
}
// 3E9AB8: conditional instruction was optimized away because r5.4<4u
// 3E9B24: conditional instruction was optimized away because r5.4<4u
// 3E9B50: conditional instruction was optimized away because r5.4<4u
// 3E9B7E: conditional instruction was optimized away because r5.4<4u
// 3E9BBE: conditional instruction was optimized away because r5.4==3
// 3E9C0C: conditional instruction was optimized away because r5.4<4u
// 3E9C3A: conditional instruction was optimized away because r5.4<4u
// 3E9C84: conditional instruction was optimized away because r5.4==3
// 3E9A16: variable 'v8' is possibly undefined
// 3E9B00: variable 'v11' is possibly undefined
// 3E9C78: variable 'v14' is possibly undefined
// 3E9D3C: variable 'v15' is possibly undefined
// 616CBC: using guessed type void *off_616CBC;

//----- (003E9D60) --------------------------------------------------------
eACTION_TYPE __fastcall CControllerConfigManager::GetActionType(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  if ( (unsigned int)Action <= SHOW_MOUSE_POINTER_TOGGLE )
    return dword_616CD0[Action];
  else
    return 6;
}
// 616CD0: using guessed type _DWORD dword_616CD0[60];

//----- (003E9D78) --------------------------------------------------------
void __fastcall CControllerConfigManager::ResetSettingOrder(CControllerConfigManager *this, e_ControllerAction Action)
{
  int v2; // r8
  int v3; // r10
  bool *v4; // r5
  int v5; // r4
  int v6; // r9
  int *v7; // r2
  int v8; // r0
  bool v9; // zf
  int v10; // r11
  bool v11; // zf
  int v12; // r3
  bool *v13; // r2
  int v14; // r6
  int v15; // r12
  int v16; // r3
  int v17; // r5
  int v18; // r1
  int v19; // r5
  int v20; // r3
  _BOOL4 v21; // r0
  int v22; // lr
  int v23; // r1
  int v24; // r6
  int v25; // r2
  int v26; // r0
  int v27; // r1
  int v28; // r12
  int v29; // r2
  bool v30; // zf
  _BOOL4 v31; // r0
  char *v32; // [sp+0h] [bp-2Ch]
  int *v33; // [sp+4h] [bp-28h]
  int *v34; // [sp+8h] [bp-24h]
  int *v35; // [sp+Ch] [bp-20h]

  v4 = &this->m_bJoyJustInitialised + 32 * Action;
  v33 = (int *)(v4 + 14636);
  v5 = 1;
  v34 = (int *)(v4 + 14628);
  v6 = 0;
  v35 = (int *)(v4 + 14620);
  v7 = (int *)(v4 + 14612);
  v32 = (char *)(v4 + 14612);
  do
  {
    v8 = *v7;
    v9 = v5 == *v7;
    if ( v5 != *v7 )
    {
      v3 = *v35;
      v9 = v5 == *v35;
    }
    if ( !v9 )
    {
      v10 = *v34;
      v11 = v5 == *v34;
      if ( v5 != *v34 )
      {
        v2 = *v33;
        v11 = v5 == *v33;
      }
      if ( !v11 )
      {
        v12 = 0;
        v13 = v4;
        if ( v8 <= v5 )
          v12 = 1;
        v14 = 0;
        v15 = v12 | (v8 == 0);
        v16 = 0;
        v17 = 0;
        v18 = v3;
        if ( !v15 )
          v6 = 0;
        if ( v3 <= v5 )
          v16 = 1;
        if ( !v3 )
          v17 = 1;
        v19 = v17 | v16;
        v20 = 1;
        if ( v19 )
          v20 = v6;
        if ( v3 > v5 )
          v14 = 1;
        if ( v3 )
          v18 = 1;
        v21 = v8 != 0 && v8 > v5;
        v22 = v21 | v18 & v14;
        if ( v19 )
        {
          v4 = v13;
        }
        else
        {
          v4 = v13;
          if ( !v15 )
          {
            v22 = v21;
            if ( v3 < *(_DWORD *)&v13[8 * v6 + 14612] )
              v6 = 1;
            v20 = v6;
          }
        }
        v23 = 0;
        v24 = 0;
        if ( !v10 )
          v23 = 1;
        v25 = *v34;
        v26 = (v10 <= v5) | v23;
        v27 = v20;
        if ( !v26 )
          v27 = 2;
        if ( v10 > v5 )
          v24 = 1;
        if ( v10 )
          v25 = 1;
        v28 = v22 | v25 & v24;
        if ( !v26 && v22 )
        {
          v28 = v22;
          if ( v10 < *(_DWORD *)&v4[8 * v20 + 14612] )
            v20 = 2;
          v27 = v20;
        }
        v29 = 0;
        v6 = v27;
        if ( !v2 )
          v29 = 1;
        if ( (v2 <= v5) | v29 || (v6 = 3, !v28) )
        {
          v31 = v2 > v5;
          v2 = v2 != 0;
          v30 = (v31 & v2 | v28) == 0;
        }
        else
        {
          if ( v2 < *(_DWORD *)&v4[8 * v27 + 14612] )
            v27 = 3;
          v30 = v28 == 0;
          v6 = v27;
        }
        v7 = (int *)v32;
        if ( !v30 )
          *(_DWORD *)&v4[8 * v6 + 14612] = v5;
      }
    }
    ++v5;
  }
  while ( v5 != 5 );
}
// 3E9DF8: variable 'v3' is possibly undefined
// 3E9ED2: variable 'v2' is possibly undefined

//----- (003E9F38) --------------------------------------------------------
GxtChar *__fastcall CControllerConfigManager::GetControllerSettingTextWithOrderNumber(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        eContSetOrder OrderSet)
{
  bool *v3; // r3
  eControllerType v4; // r2
  unsigned int v6; // r0
  Int32 *v7; // r4
  GxtChar *v8; // r0
  Int32 v9; // r1
  GxtChar *v10; // r4

  v3 = &this->m_bJoyJustInitialised + 32 * Action;
  if ( *((_DWORD *)v3 + 3653) == OrderSet )
  {
    v4 = KEYBOARD;
    return CControllerConfigManager::GetControllerSettingTextKeyBoard(this, Action, v4);
  }
  if ( *((_DWORD *)v3 + 3655) == OrderSet )
  {
    v4 = OPTIONAL_EXTRA_KEY;
    return CControllerConfigManager::GetControllerSettingTextKeyBoard(this, Action, v4);
  }
  if ( *((_DWORD *)v3 + 3657) == OrderSet )
  {
    v6 = *((_DWORD *)v3 + 3656) - 1;
    if ( v6 <= 6 )
      return sub_18A500(&TheText, (const unsigned __int8 *)off_667BB0[v6]);
    return 0;
  }
  if ( *((_DWORD *)v3 + 3659) != OrderSet || !*((_DWORD *)v3 + 3658) )
    return 0;
  v7 = (Int32 *)(v3 + 14632);
  v8 = CText::Get(&TheText, "FEC_JBO");
  v9 = *v7;
  v10 = CControllerConfigManager::GetControllerSettingTextJoystick(e_ControllerAction)::NewStringWithNumber;
  CMessages::InsertNumberInString(
    v8,
    v9,
    -1,
    -1,
    -1,
    -1,
    -1,
    CControllerConfigManager::GetControllerSettingTextJoystick(e_ControllerAction)::NewStringWithNumber);
  return v10;
}
// 667BB0: using guessed type char *off_667BB0[7];

//----- (003E9FF0) --------------------------------------------------------
GxtChar *__fastcall CControllerConfigManager::GetControllerSettingTextKeyBoard(
        CControllerConfigManager *this,
        e_ControllerAction Action,
        eControllerType ArrayToEnter)
{
  GxtChar *v3; // r5
  bool *v4; // r0
  unsigned int v5; // r2
  const char *v7; // r1
  _DWORD *v8; // r4
  GxtChar *v9; // r0
  int v10; // r0
  GxtChar *v11; // r0
  GxtChar *v12; // r0
  GxtChar *v13; // r0
  GxtChar *v14; // r0
  GxtChar *v15; // r0
  GxtChar *v16; // r0
  GxtChar *v17; // r0
  GxtChar *v18; // r0
  GxtChar *v19; // r0
  GxtChar *v20; // r0

  v3 = 0;
  v4 = &this->m_bJoyJustInitialised + 32 * Action + 8 * ArrayToEnter;
  *(_DWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[48] = 0;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[40] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[44] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[32] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[36] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[24] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[28] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[16] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[20] = 0LL;
  *(_QWORD *)CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[4] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[8] = 0LL;
  *(_QWORD *)&CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[12] = 0LL;
  v5 = *((_DWORD *)v4 + 3652);
  if ( v5 == 1056 )
    return v3;
  if ( v5 > 0xFF )
  {
    switch ( v5 )
    {
      case 0x3E9u:
      case 0x3EAu:
      case 0x3EBu:
      case 0x3ECu:
      case 0x3EDu:
      case 0x3EEu:
      case 0x3EFu:
      case 0x3F0u:
      case 0x3F1u:
      case 0x3F2u:
      case 0x3F3u:
      case 0x3F4u:
        v8 = v4 + 14608;
        v9 = CText::Get(&TheText, "FEC_FNC");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v9,
          *v8 - 1000,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x3F5u:
        v7 = "FEC_IRT";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3F6u:
        v7 = "FEC_DLL";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3F7u:
        v7 = "FEC_HME";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3F8u:
        v7 = "FEC_END";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3F9u:
        v7 = "FEC_PGU";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3FAu:
        v7 = "FEC_PGD";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3FBu:
        v7 = "FEC_UPA";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3FCu:
        v7 = "FEC_DWA";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3FDu:
        v7 = "FEC_LFA";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3FEu:
        v7 = "FEC_RFA";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x3FFu:
        v7 = "FEC_FWS";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x400u:
        v7 = "FECSTAR";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x401u:
        v7 = "FEC_PLS";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x402u:
        v7 = "FEC_MIN";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x403u:
        v7 = "FEC_DOT";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x404u:
        v11 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v11,
          1,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x405u:
        v12 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v12,
          2,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x406u:
        v13 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v13,
          3,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x407u:
        v14 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v14,
          4,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x408u:
        v15 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v15,
          5,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x409u:
        v7 = "FEC_NLK";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x40Au:
        v16 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v16,
          6,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x40Bu:
        v17 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v17,
          7,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x40Cu:
        v18 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v18,
          8,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x40Du:
        v19 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v19,
          9,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x40Eu:
        v20 = CText::Get(&TheText, "FEC_NMN");
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber;
        CMessages::InsertNumberInString(
          v20,
          0,
          -1,
          -1,
          -1,
          -1,
          -1,
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::NewStringWithNumber);
        return v3;
      case 0x40Fu:
        v7 = "FEC_ETR";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x410u:
        v7 = "FEC_SLK";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x411u:
        v7 = "FEC_PSB";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x412u:
        v7 = "FEC_BSP";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x413u:
        v7 = "FEC_TAB";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x414u:
        v7 = "FEC_CLK";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x415u:
        v7 = "FEC_RTN";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x416u:
        v7 = "FEC_LSF";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x417u:
        v7 = "FEC_RSF";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x418u:
        v7 = "FEC_SFT";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x419u:
        v7 = "FEC_LCT";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x41Au:
        v7 = "FEC_RCT";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x41Bu:
        v7 = "FEC_LAL";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x41Cu:
        v7 = "FEC_RAL";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x41Du:
        v7 = "FEC_LWD";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x41Eu:
        v7 = "FEC_RWD";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      case 0x41Fu:
        v7 = "FEC_WRC";
        return sub_18A500(&TheText, (const unsigned __int8 *)v7);
      default:
        return 0;
    }
  }
  if ( (unsigned __int8)v5 == 32 )
  {
    v7 = "FEC_SPC";
  }
  else
  {
    if ( (unsigned __int8)v5 != 42 )
    {
      if ( (unsigned __int8)v5 == 94 && FrontEndMenuManager.m_PrefsKeyboardLanguage == LANGUAGE_GERMAN )
      {
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText;
        *(_DWORD *)CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText = 124;
      }
      else
      {
        v10 = CFont::character_code(v5);
        CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[0] = v10;
        if ( !v10 )
          CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[0] = CFont::character_code(0x23u);
        v3 = CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText;
        CControllerConfigManager::GetControllerSettingTextKeyBoard(e_ControllerAction,eControllerType)::ActionText[1] = 0;
      }
      return v3;
    }
    v7 = "FEC_AST";
  }
  return sub_18A500(&TheText, (const unsigned __int8 *)v7);
}

//----- (003EA610) --------------------------------------------------------
GxtChar *__fastcall CControllerConfigManager::GetControllerSettingTextMouse(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  UInt32 v2; // r0

  v2 = this->ConfigurationForAction[Action][2].m_uiActionInitiator - 1;
  if ( v2 <= 6 )
    return sub_18A500(&TheText, (const unsigned __int8 *)off_667BB0[v2]);
  else
    return 0;
}
// 667BB0: using guessed type char *off_667BB0[7];

//----- (003EA640) --------------------------------------------------------
GxtChar *__fastcall CControllerConfigManager::GetControllerSettingTextJoystick(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  bool *v2; // r0
  Int32 *v3; // r4
  GxtChar *v4; // r0
  Int32 v5; // r1
  GxtChar *v6; // r4

  v2 = &this->m_bJoyJustInitialised + 32 * Action;
  if ( !*((_DWORD *)v2 + 3658) )
    return 0;
  v3 = (Int32 *)(v2 + 14632);
  v4 = CText::Get(&TheText, "FEC_JBO");
  v5 = *v3;
  v6 = CControllerConfigManager::GetControllerSettingTextJoystick(e_ControllerAction)::NewStringWithNumber;
  CMessages::InsertNumberInString(
    v4,
    v5,
    -1,
    -1,
    -1,
    -1,
    -1,
    CControllerConfigManager::GetControllerSettingTextJoystick(e_ControllerAction)::NewStringWithNumber);
  return v6;
}

//----- (003EA698) --------------------------------------------------------
GxtChar *__fastcall CControllerConfigManager::GetFirstKeyboardControllerText(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  bool *v4; // r0
  eControllerType v5; // r2

  CControllerConfigManager::ResetSettingOrder(this, Action);
  v4 = &this->m_bJoyJustInitialised + 32 * Action;
  if ( *((_DWORD *)v4 + 3653) )
  {
    v5 = KEYBOARD;
    return CControllerConfigManager::GetControllerSettingTextKeyBoard(this, Action, v5);
  }
  if ( *((_DWORD *)v4 + 3655) )
  {
    v5 = OPTIONAL_EXTRA_KEY;
    return CControllerConfigManager::GetControllerSettingTextKeyBoard(this, Action, v5);
  }
  return 0;
}

//----- (003EA6CC) --------------------------------------------------------
UInt32 __fastcall CControllerConfigManager::GetNumOfSettingsForAction(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  bool *v2; // r0
  int v3; // r3
  int v4; // lr
  int v5; // r12
  int v6; // r2
  UInt32 v7; // r1
  UInt32 result; // r0

  v2 = &this->m_bJoyJustInitialised + 32 * Action;
  v3 = *((_DWORD *)v2 + 3652);
  v4 = *((_DWORD *)v2 + 3654);
  v5 = *((_DWORD *)v2 + 3656);
  v6 = *((_DWORD *)v2 + 3658);
  v7 = 0;
  result = 1;
  if ( v3 != 1056 )
  {
    v7 = 1;
    result = 2;
  }
  if ( v4 == 1056 )
    result = v7;
  if ( v5 )
    ++result;
  if ( v6 )
    ++result;
  return result;
}

//----- (003EA71C) --------------------------------------------------------
void __fastcall CControllerConfigManager::GetGxtStringOfCommandKeys(
        CControllerConfigManager *this,
        UInt16 KeyIndex,
        GxtChar *pStringToFill,
        UInt16 MaximumLength)
{
  e_ControllerAction v7; // r4
  bool *v8; // r0
  Int32 *v9; // r4
  GxtChar *v10; // r0
  GxtChar *ControllerSettingTextKeyBoard; // r6
  UInt32 v12; // r0
  UInt16 GxtStringLength; // r0
  unsigned int v14; // r0

  v7 = KeyIndex;
  if ( FrontEndMenuManager.m_ControlMethod )
  {
    v8 = &this->m_bJoyJustInitialised + 32 * KeyIndex;
    if ( *((_DWORD *)v8 + 3658) )
    {
LABEL_3:
      v9 = (Int32 *)(v8 + 14632);
      ControllerSettingTextKeyBoard = CControllerConfigManager::GetControllerSettingTextJoystick(e_ControllerAction)::NewStringWithNumber;
      v10 = CText::Get(&TheText, "FEC_JBO");
      CMessages::InsertNumberInString(
        v10,
        *v9,
        -1,
        -1,
        -1,
        -1,
        -1,
        CControllerConfigManager::GetControllerSettingTextJoystick(e_ControllerAction)::NewStringWithNumber);
      goto LABEL_8;
    }
  }
  else
  {
    v12 = this->ConfigurationForAction[KeyIndex][2].m_uiActionInitiator - 1;
    if ( v12 <= 6 )
    {
      ControllerSettingTextKeyBoard = CText::Get(&TheText, (const unsigned __int8 *)off_667BB0[v12]);
      if ( ControllerSettingTextKeyBoard )
        goto LABEL_8;
    }
  }
  ControllerSettingTextKeyBoard = CControllerConfigManager::GetControllerSettingTextKeyBoard(this, v7, KEYBOARD);
  if ( ControllerSettingTextKeyBoard )
    goto LABEL_8;
  ControllerSettingTextKeyBoard = CControllerConfigManager::GetControllerSettingTextKeyBoard(
                                    this,
                                    v7,
                                    OPTIONAL_EXTRA_KEY);
  if ( ControllerSettingTextKeyBoard )
    goto LABEL_8;
  v8 = &this->m_bJoyJustInitialised + 32 * v7;
  if ( *((_DWORD *)v8 + 3658) )
    goto LABEL_3;
  v14 = *((_DWORD *)v8 + 3656) - 1;
  if ( v14 > 6 || (ControllerSettingTextKeyBoard = CText::Get(&TheText, (const unsigned __int8 *)off_667BB0[v14])) == 0 )
  {
    ControllerSettingTextKeyBoard = 0;
    GxtStringLength = 0;
    goto LABEL_9;
  }
LABEL_8:
  GxtStringLength = CMessages::GetGxtStringLength(ControllerSettingTextKeyBoard);
LABEL_9:
  sub_196244(pStringToFill, ControllerSettingTextKeyBoard, MaximumLength - GxtStringLength);
}
// 667BB0: using guessed type char *off_667BB0[7];

//----- (003EA850) --------------------------------------------------------
void __fastcall CControllerConfigManager::UpdateJoyButtonState(CControllerConfigManager *this, int PadID)
{
  bool *v2; // r1

  v2 = &this->m_bJoyJustInitialised + 17 * PadID;
  *(_QWORD *)(v2 + 14572) = 0LL;
  *(_QWORD *)(v2 + 14580) = 0LL;
  v2[14588] = 0;
  v2[14572] = this->m_NewJoyState & 1;
  v2[14573] = (this->m_NewJoyState & 2) != 0;
  v2[14574] = (this->m_NewJoyState & 4) != 0;
  v2[14575] = (this->m_NewJoyState & 8) != 0;
  v2[14576] = (this->m_NewJoyState & 0x10) != 0;
  v2[14577] = (this->m_NewJoyState & 0x20) != 0;
  v2[14578] = (this->m_NewJoyState & 0x40) != 0;
  v2[14579] = (this->m_NewJoyState & 0x80) != 0;
  v2[14580] = BYTE1(this->m_NewJoyState) & 1;
  v2[14581] = (this->m_NewJoyState & 0x200) != 0;
  v2[14582] = (this->m_NewJoyState & 0x400) != 0;
  v2[14583] = (this->m_NewJoyState & 0x800) != 0;
  v2[14584] = (this->m_NewJoyState & 0x1000) != 0;
  v2[14585] = (this->m_NewJoyState & 0x2000) != 0;
  v2[14586] = (this->m_NewJoyState & 0x4000) != 0;
  v2[14587] = (this->m_NewJoyState & 0x8000) != 0;
  v2[14588] = HIWORD(this->m_NewJoyState) & 1;
}

//----- (003EA936) --------------------------------------------------------
bool __fastcall CControllerConfigManager::GetIsActionAButtonCombo(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  return 0;
}

//----- (003EA93C) --------------------------------------------------------
GxtChar *__fastcall CControllerConfigManager::GetButtonComboText(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  if ( Action == VEHICLE_LOOKBEHIND )
    return sub_18A500(&TheText, "FEC_LBC");
  else
    return 0;
}

//----- (003EA95C) --------------------------------------------------------
Int32 __fastcall CControllerConfigManager::GetMouseButtonAssociatedWithAction(
        CControllerConfigManager *this,
        e_ControllerAction Action)
{
  return this->ConfigurationForAction[Action][2].m_uiActionInitiator;
}

//----- (003EA968) --------------------------------------------------------
void __fastcall CCrime::ReportCrime(eCrimeType CrimeType, CEntity *pVictim, CPed *pCommitedby)
{
  bool bPoliceDontReallyCare; // r8
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r5
  CSimpleTransform *p_tx; // r1
  __int64 v10; // d16
  CMatrix *v11; // r0
  unsigned __int32 v12; // r3
  float v13; // s0
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v15; // r0
  bool v16; // zf
  CPlayerPed *v17; // r0
  Int32 v18; // r1
  CPlayerPed *v19; // r0
  GxtChar *v20; // r0
  CVector Pos; // [sp+8h] [bp-28h] BYREF

  if ( pCommitedby && pCommitedby->m_nPedType <= 1u )
  {
    if ( pVictim && (*(_BYTE *)&pVictim->m_info & 7) == 3 )
    {
      bPoliceDontReallyCare = CPedType::PoliceDontCareAboutCrimesAgainstPedType(*(_DWORD *)&pVictim[23].numLodChildren);
      if ( CrimeType == CRIME_NONE )
        return;
    }
    else
    {
      bPoliceDontReallyCare = 0;
      if ( CrimeType == CRIME_NONE )
        return;
    }
    if ( CrimeType == CRIME_HIT_PED
      && (*(_BYTE *)&pVictim->m_info & 7) == 3
      && IsPedPointerValid((CPed *)pVictim)
      && pCommitedby->m_pPlayerData->m_Wanted->m_WantedLevel == WANTED_CLEAN
      && (BYTE2(pVictim[19].m_transform.m_heading) & 0x80) != 0 )
    {
      if ( ((int)pVictim[18].m_pMat & 0xFFFFFFFE) != 54 )
      {
        v20 = CText::Get(&TheText, "GOODBOY");
        CMessages::AddBigMessage(v20, 0x1388u, 0);
        CWorld::Players[CWorld::PlayerInFocus].Score += 50;
      }
    }
    else
    {
      m_pMat = pCommitedby->m_pMat;
      p_m_transform = &pCommitedby->m_transform;
      p_tx = &pCommitedby->m_transform;
      if ( m_pMat )
        p_tx = (CSimpleTransform *)&m_pMat->tx;
      v10 = *(_QWORD *)&p_tx->m_translate.x;
      Pos.z = p_tx->m_translate.z;
      *(_QWORD *)&Pos.x = v10;
      if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_fMultiplier >= 0.0 )
      {
        v11 = pCommitedby->m_pMat;
        v12 = CrimeType - 12;
        if ( v11 )
          p_m_transform = (CSimpleTransform *)&v11->tx;
        if ( v12 > 8 )
          v13 = 14.0;
        else
          v13 = flt_616DC0[v12];
        if ( CWanted::WorkOutPolicePresence(p_m_transform->m_translate, v13)
          || (unsigned int)CrimeType <= CRIME_COP_SET_ON_FIRE
          && ((1 << CrimeType) & 0x6030) != 0
          && CLocalisation::GermanGame() )
        {
          PlayerPed = FindPlayerPed(-1);
          CWanted::RegisterCrime_Immediately(
            PlayerPed->m_pPlayerData->m_Wanted,
            CrimeType,
            &Pos,
            (u_native)pVictim,
            bPoliceDontReallyCare);
          v15 = FindPlayerPed(-1);
          CWanted::SetWantedLevelNoDrop(v15->m_pPlayerData->m_Wanted, 1);
        }
        else
        {
          v19 = FindPlayerPed(-1);
          CWanted::RegisterCrime(
            v19->m_pPlayerData->m_Wanted,
            CrimeType,
            &Pos,
            (u_native)pVictim,
            bPoliceDontReallyCare);
        }
      }
      v16 = CrimeType == CRIME_STAB_COP;
      if ( CrimeType != CRIME_STAB_COP )
        v16 = CrimeType == CRIME_SHOOT_COP;
      if ( v16 )
      {
        v17 = FindPlayerPed(-1);
        v18 = 2;
      }
      else
      {
        if ( CrimeType != CRIME_HIT_COP )
          return;
        v17 = FindPlayerPed(-1);
        v18 = 1;
      }
      CPlayerPed::SetWantedLevelNoDrop(v17, v18);
    }
  }
}
// 616DC0: using guessed type float flt_616DC0[12];

//----- (003EAB38) --------------------------------------------------------
float __fastcall CCrime::FindImmediateDetectionRange(eCrimeType CrimeType)
{
  unsigned __int32 v1; // r0

  v1 = CrimeType - 12;
  if ( v1 <= 8 )
    return flt_616DC0[v1];
  else
    return 14.0;
}
// 616DC0: using guessed type float flt_616DC0[12];

//----- (003EAB58) --------------------------------------------------------
void CDebug::DebugInitTextBuffer()
{
  CDebug::ms_nCurrentTextLine = 0;
}

//----- (003EAB6C) --------------------------------------------------------
uint32 *GetReturnAddress()
{
  return 0;
}

//----- (003EAB70) --------------------------------------------------------
uint32 *GetStackPointer()
{
  return 0;
}

//----- (003EAB74) --------------------------------------------------------
void __fastcall CDirectory::CDirectory(CDirectory *this)
{
  this->m_pDirInfo = 0;
  this->m_size = 0;
  this->m_number = 0;
}

//----- (003EAB7E) --------------------------------------------------------
void __fastcall CDirectory::CDirectory(CDirectory *this, int32 size)
{
  unsigned int v3; // r0
  int v4; // r2

  v4 = (unsigned __int64)(unsigned int)size >> 27;
  v3 = 32 * size;
  this->m_size = size;
  this->m_number = 0;
  if ( !is_mul_ok(0x20u, size) )
    v4 = 1;
  if ( v4 )
    v3 = -1;
  this->m_pDirInfo = (CDirectory::DirectoryInfo *)operator new[](v3);
  this->m_bOwnBuffer = 1;
}

//----- (003EABAC) --------------------------------------------------------
void __fastcall CDirectory::~CDirectory(CDirectory *this)
{
  CDirectory::DirectoryInfo *m_pDirInfo; // r0

  m_pDirInfo = this->m_pDirInfo;
  if ( m_pDirInfo )
  {
    if ( this->m_bOwnBuffer )
      operator delete[](m_pDirInfo);
  }
}

//----- (003EABC4) --------------------------------------------------------
void __fastcall CDirectory::Init(CDirectory *this, int32 size, void *pBuffer)
{
  this->m_pDirInfo = (CDirectory::DirectoryInfo *)pBuffer;
  this->m_size = size;
  this->m_number = 0;
  this->m_bOwnBuffer = 0;
}

//----- (003EABD0) --------------------------------------------------------
void __fastcall CDirectory::AddItem(CDirectory *this, const CDirectory::DirectoryInfo *dirInfo)
{
  __int64 v2; // kr00_8
  unsigned __int8 *v3; // r1
  __int64 v4; // d16
  __int64 v5; // d17
  CDirectory::DirectoryInfo *v6; // r0
  __int64 v7; // d18
  __int64 v8; // d19

  v2 = *(_QWORD *)&this->m_size;
  if ( SHIDWORD(v2) >= (int)v2 )
  {
    sub_19D820("Too many objects without modelinfo structures");
  }
  else
  {
    this->m_number = HIDWORD(v2) + 1;
    v4 = *(_QWORD *)&dirInfo->posn;
    v5 = *(_QWORD *)dirInfo->name;
    v3 = &dirInfo->name[8];
    v6 = &this->m_pDirInfo[HIDWORD(v2)];
    v7 = *(_QWORD *)v3;
    v8 = *((_QWORD *)v3 + 1);
    *(_QWORD *)&v6->posn = v4;
    *(_QWORD *)v6->name = v5;
    v6 = (CDirectory::DirectoryInfo *)((char *)v6 + 16);
    *(_QWORD *)&v6->posn = v7;
    *(_QWORD *)v6->name = v8;
  }
}

//----- (003EAC00) --------------------------------------------------------
void __fastcall CDirectory::ReadDirFile(CDirectory *this, const unsigned __int8 *pFilename)
{
  void *v3; // r5
  bool i; // zf
  __int64 v5; // kr00_8
  __int64 v6; // d17
  CDirectory::DirectoryInfo *v7; // r0
  __int64 v8; // d18
  __int64 v9; // d19
  int buffer; // [sp+4h] [bp-44h] BYREF
  unsigned __int8 pData[4]; // [sp+8h] [bp-40h] BYREF
  char v12; // [sp+Ch] [bp-3Ch]
  _QWORD v13[4]; // [sp+10h] [bp-38h] BYREF

  v3 = (void *)CFileMgr::OpenFile(pFilename, (const unsigned __int8 *)&dword_3EACB8);
  v12 = 0;
  *(_DWORD *)pData = 0;
  CFileMgr::ReadBytes((u_native)v3, pData, 4);
  OS_FileRead(v3, &buffer, 4);
  for ( i = buffer-- == 0; !i; --buffer )
  {
    OS_FileRead(v3, v13, 32);
    v5 = *(_QWORD *)&this->m_size;
    if ( SHIDWORD(v5) >= (int)v5 )
    {
      puts("Too many objects without modelinfo structures");
    }
    else
    {
      this->m_number = HIDWORD(v5) + 1;
      v6 = v13[1];
      v7 = &this->m_pDirInfo[HIDWORD(v5)];
      v8 = v13[2];
      v9 = v13[3];
      *(_QWORD *)&v7->posn = v13[0];
      *(_QWORD *)v7->name = v6;
      v7 = (CDirectory::DirectoryInfo *)((char *)v7 + 16);
      *(_QWORD *)&v7->posn = v8;
      *(_QWORD *)v7->name = v9;
    }
    i = buffer == 0;
  }
  CFileMgr::CloseFile((u_native)v3);
}
// 3EACB8: using guessed type int dword_3EACB8;
// 3EAC00: using guessed type _QWORD var_38[4];

//----- (003EACC4) --------------------------------------------------------
bool __fastcall CDirectory::WriteDirFile(CDirectory *this, const unsigned __int8 *pFilename)
{
  u_native v3; // r5
  int32 v4; // r6

  v3 = CFileMgr::OpenFileForWriting(pFilename);
  v4 = CFileMgr::Write(v3, (unsigned __int8 *)this->m_pDirInfo, 32 * this->m_number);
  CFileMgr::CloseFile(v3);
  return v4 == 32 * this->m_number;
}

//----- (003EACFC) --------------------------------------------------------
CDirectory::DirectoryInfo *__fastcall CDirectory::FindItem(CDirectory *this, const unsigned __int8 *pFilename)
{
  int32 m_number; // r6
  CDirectory::DirectoryInfo *m_pDirInfo; // r4
  int32 v5; // r5

  m_number = this->m_number;
  if ( m_number < 1 )
    return 0;
  m_pDirInfo = this->m_pDirInfo;
  v5 = 0;
  while ( strcasecmp((const char *)m_pDirInfo->name, (const char *)pFilename) )
  {
    ++v5;
    ++m_pDirInfo;
    if ( v5 >= m_number )
      return 0;
  }
  return m_pDirInfo;
}

//----- (003EAD2E) --------------------------------------------------------
bool __fastcall CDirectory::FindItem(CDirectory *this, const unsigned __int8 *pFilename, uint32 *posn, uint32 *size)
{
  int32 m_number; // r5
  int v8; // r6
  uint16 *i; // r4

  m_number = this->m_number;
  if ( m_number < 1 )
    return 0;
  v8 = 0;
  for ( i = &this->m_pDirInfo->size; strcasecmp((const char *)i + 4, (const char *)pFilename); i += 16 )
  {
    if ( ++v8 >= m_number )
      return 0;
  }
  if ( i == (uint16 *)&byte_4 )
    return 0;
  *size = *i;
  *posn = *((_DWORD *)i - 1);
  return 1;
}
// 4: using guessed type char byte_4;

//----- (003EAD7E) --------------------------------------------------------
bool __fastcall CDirectory::FindItem(CDirectory *this, uint32 key, uint32 *posn, uint32 *size)
{
  int v8; // r5
  int32 v9; // r4

  if ( this->m_number < 1 )
    return 0;
  v8 = 0;
  v9 = 0;
  while ( CKeyGen::GetUppercaseKey(this->m_pDirInfo[v8].name) != key )
  {
    ++v9;
    ++v8;
    if ( v9 >= this->m_number )
      return 0;
  }
  *size = this->m_pDirInfo[v8].size;
  *posn = this->m_pDirInfo[v8].posn;
  return 1;
}

//----- (003EADD4) --------------------------------------------------------
void __fastcall CDummy::CDummy(CDummy *this)
{
  int v1; // r0

  CEntity::CEntity(this);
  *(_BYTE *)(v1 + 58) = *(_BYTE *)(v1 + 58) & 0xF8 | 5;
  *(_DWORD *)v1 = &off_667BD4;
}
// 3EADDE: variable 'v1' is possibly undefined
// 667BD4: using guessed type void *;

//----- (003EAE00) --------------------------------------------------------
void __fastcall CDummy::~CDummy(CDummy *this)
{
  CDummyPool *v1; // r1
  int v2; // r0
  int v3; // r0

  CEntity::~CEntity(this);
  v1 = CPools::ms_pDummyPool;
  v3 = -286331153 * ((signed int)(v2 - (unsigned int)CPools::ms_pDummyPool->m_aStorage) >> 2);
  CPools::ms_pDummyPool->m_aFlags[v3] |= 0x80u;
  if ( v3 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v3;
}
// 3EAE14: variable 'v2' is possibly undefined

//----- (003EAE38) --------------------------------------------------------
void __fastcall CDummy::operator delete(void *pVoid)
{
  CDummyPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pDummyPool;
  v2 = -286331153 * ((signed int)((int)pVoid - (unsigned int)CPools::ms_pDummyPool->m_aStorage) >> 2);
  CPools::ms_pDummyPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (003EAE68) --------------------------------------------------------
void *__fastcall CDummy::operator new(size_t nSize)
{
  int v1; // lr
  CDummyPool *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pDummyPool;
  result = (void *)CPools::ms_pDummyPool->m_nFreeIndex;
  m_nSize = (void *)CPools::ms_pDummyPool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (003EAECC) --------------------------------------------------------
bool __fastcall IsDummyPointerValid(CDummy *pDummy)
{
  int v1; // r0
  bool result; // r0

  result = pDummy
        && (v1 = (char *)pDummy - (char *)CPools::ms_pDummyPool->m_aStorage, v1 >= -59)
        && -286331153 * (v1 >> 2) <= CPools::ms_pDummyPool->m_nSize;
  return result;
}

//----- (003EAF00) --------------------------------------------------------
bool __fastcall IsDummyPointerValid_NotInWorld(CDummy *pDummy)
{
  bool result; // r0
  int v2; // r2

  if ( !pDummy )
    return 0;
  v2 = (char *)pDummy - (char *)CPools::ms_pDummyPool->m_aStorage;
  result = 0;
  if ( v2 >= -59 && -286331153 * (v2 >> 2) <= CPools::ms_pDummyPool->m_nSize )
    return 1;
  return result;
}

//----- (003EAF40) --------------------------------------------------------
void __fastcall CEntity::CEntity(CEntity *this)
{
  CPlaceable::CPlaceable(this);
  this->m_info = (CEntity::CEntityInfo)32;
  *(_DWORD *)&this->m_nFlags = 134217856;
  this->m_nScanCode = 0;
  this->m_nModelIndex = -1;
  this->m_pRwObject = 0;
  *(_WORD *)&this->m_iplIndex = 0;
  this->_vptr$CPlaceable = (int (**)(void))&off_667C38;
  this->RandomSeed = rand();
  this->pReferences = 0;
  this->m_pLastRenderedLink = 0;
  *(_WORD *)&this->numLodChildren = 0;
  this->m_pLod = 0;
}
// 667C38: using guessed type void *;

//----- (003EAF88) --------------------------------------------------------
void __fastcall CEntity::~CEntity(CEntity *this)
{
  CEntity *m_pLod; // r1
  int (**v3)(void); // r0

  m_pLod = this->m_pLod;
  v3 = (int (**)(void))&off_667C38;
  this->_vptr$CPlaceable = (int (**)(void))&off_667C38;
  if ( m_pLod )
  {
    --m_pLod->numLodChildren;
    v3 = this->_vptr$CPlaceable;
  }
  ((void (__fastcall *)(CEntity *))v3[9])(this);
  CEntity::ResolveReferences(this);
  sub_18E218(this);
}
// 667C38: using guessed type void *off_667C38;

//----- (003EAFC8) --------------------------------------------------------
void __fastcall CEntity::~CEntity(CEntity *this)
{
  CEntity *m_pLod; // r1
  int (**v3)(void); // r0
  void *v4; // r0

  m_pLod = this->m_pLod;
  v3 = (int (**)(void))&off_667C38;
  this->_vptr$CPlaceable = (int (**)(void))&off_667C38;
  if ( m_pLod )
  {
    --m_pLod->numLodChildren;
    v3 = this->_vptr$CPlaceable;
  }
  ((void (__fastcall *)(CEntity *))v3[9])(this);
  CEntity::ResolveReferences(this);
  CPlaceable::~CPlaceable(this);
  sub_191374(v4);
}
// 3EB002: variable 'v4' is possibly undefined
// 667C38: using guessed type void *off_667C38;

//----- (003EB00C) --------------------------------------------------------
void __fastcall CEntity::SetModelIndex(CEntity *this, uint32 index)
{
  (*((void (__fastcall **)(CEntity *, uint32))this->_vptr$CPlaceable + 7))(this, index);
  (*((void (__fastcall **)(CEntity *))this->_vptr$CPlaceable + 8))(this);
}

//----- (003EB028) --------------------------------------------------------
void __fastcall CEntity::SetModelIndexNoCreate(CEntity *this, uint32 index)
{
  CBaseModelInfo *v3; // r5
  int HasPreRenderEffects; // r0
  CEntity::CFlags *p_m_nFlags; // r1
  uint32 bdummy; // r2
  unsigned int v7; // r0
  uint16 m_flags; // r3

  v3 = CModelInfo::ms_modelInfoPtrs[index];
  this->m_nModelIndex = index;
  HasPreRenderEffects = CEntity::HasPreRenderEffects(this);
  p_m_nFlags = &this->m_nFlags;
  bdummy = this->m_nFlags.bdummy;
  v7 = *(_DWORD *)&this->m_nFlags & 0xFFDFFFFF | (HasPreRenderEffects << 21);
  *(_DWORD *)&this->m_nFlags = v7;
  m_flags = v3->m_flags;
  if ( (m_flags & 2) != 0 )
  {
    v7 |= 0x4000u;
    *(_DWORD *)p_m_nFlags = v7;
    this->m_nFlags.bdummy = bdummy;
    m_flags = v3->m_flags;
  }
  if ( (m_flags & 0x40) == 0 )
  {
    *(_DWORD *)p_m_nFlags = v7 & 0xF7FFFFFF;
    this->m_nFlags.bdummy = bdummy;
  }
  if ( (*((int (__fastcall **)(CBaseModelInfo *))v3->_vptr$CBaseModelInfo + 2))(v3)
    && *(__int16 *)((*((int (__fastcall **)(CBaseModelInfo *))v3->_vptr$CBaseModelInfo + 2))(v3) + 40) >= 0
    && (*(_WORD *)((*((int (__fastcall **)(CBaseModelInfo *))v3->_vptr$CBaseModelInfo + 2))(v3) + 40) & 0x7800) == 12288 )
  {
    sub_19B744(this);
  }
}

//----- (003EB0B0) --------------------------------------------------------
bool __fastcall CEntity::HasPreRenderEffects(CEntity *this)
{
  int m_nModelIndex; // r2
  int v3; // r5
  int v4; // r3
  CBaseModelInfo *v5; // r0
  int v6; // r4
  bool v7; // r1
  bool v8; // zf
  int v10; // r0
  int v11; // r0
  CBaseModelInfo *v12; // r4
  int32 v13; // r5

  m_nModelIndex = this->m_nModelIndex;
  v3 = 0;
  v4 = 0;
  v5 = CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
  v6 = v5->m_flags & 0x7800;
  v7 = 1;
  if ( v6 != 2048 )
    v3 = 1;
  if ( v6 == 4096 )
    v4 = 1;
  v8 = v6 == 18432;
  if ( v6 != 18432 )
    v8 = v4 == v3;
  if ( !v8 )
  {
    if ( m_nModelIndex != MI_COLLECTABLE1
      && m_nModelIndex != MI_MONEY
      && m_nModelIndex != MI_CARMINE
      && m_nModelIndex != MI_NAUTICALMINE
      && m_nModelIndex != MI_BRIEFCASE
      && ((unsigned int)(unsigned __int16)m_nModelIndex - 342 > 3 || (unsigned __int16)m_nModelIndex == 343)
      && m_nModelIndex != MI_BEACHBALL
      && m_nModelIndex != MI_MAGNOCRANE_HOOK
      && m_nModelIndex != MI_WRECKING_BALL
      && m_nModelIndex != MI_CRANE_MAGNET
      && m_nModelIndex != MI_MINI_MAGNET
      && m_nModelIndex != MI_CRANE_HARNESS
      && m_nModelIndex != MI_WINDSOCK
      && m_nModelIndex != MI_FLARE
      && ((*(_BYTE *)&this->m_info & 7) != 4
       || (v10 = (*((int (__fastcall **)(CBaseModelInfo *))v5->_vptr$CBaseModelInfo + 2))(v5)) == 0
       || (*(_WORD *)(v10 + 40) & 0x7000 | 0x800) != 10240)
      && ((*(_BYTE *)&this->m_info & 7) != 4 || !(LOBYTE(this[5].m_pRwObject) << 31))
      && !CTrafficLights::IsMITrafficLight(this->m_nModelIndex) )
    {
      v11 = this->m_nModelIndex;
      if ( v11 != MI_SINGLESTREETLIGHTS1
        && v11 != MI_SINGLESTREETLIGHTS2
        && v11 != MI_SINGLESTREETLIGHTS3
        && v11 != MI_DOUBLESTREETLIGHTS )
      {
        v12 = CModelInfo::ms_modelInfoPtrs[v11];
        if ( !v12->m_num2dEffects )
          return 0;
        v13 = 0;
        while ( CBaseModelInfo::Get2dEffect(v12, v13)->m_type )
        {
          ++v13;
          v7 = 0;
          if ( v13 >= v12->m_num2dEffects )
            return v7;
        }
      }
    }
    return 1;
  }
  return v7;
}

//----- (003EB2A0) --------------------------------------------------------
void __fastcall CEntity::CreateEffects(CEntity *this)
{
  CEntity *v1; // r5
  int m_nModelIndex; // r2
  CBaseModelInfo *v3; // r4
  int m_num2dEffects; // r6
  int32 v5; // r11
  C2dEffect *v6; // r10
  RwObject_0 *m_pRwObject; // r0
  RwMatrix *v8; // r0
  RwReal v9; // s0
  RwReal v10; // s4
  const CMatrix *m_pMat; // r1
  __int64 v12; // d16
  float v13; // r5
  float v14; // r8
  unsigned __int8 *textTabPtr; // r6
  int NumLinesFromFlags; // r4
  int NumLettersFromFlags; // r9
  uint8 PaletteIDFromFlags; // r0
  int32 v19; // r2
  float v20; // r0
  RpAtomic_0 *RoadsignAtomic; // r6
  RwFrame_0 *parent; // r8
  const CMatrix *v23; // r1
  __int64 v24; // d16
  const CMatrix *v25; // r1
  RwReal v26; // r1
  RwReal v27; // r2
  const CMatrix *v28; // r1
  unsigned int v29; // r1
  int v30; // r0
  CMatrix *v31; // r4
  float x; // s20
  float y; // s22
  float z; // s24
  float v35; // s26
  float m_heading; // s0
  RwReal m_shadowSize; // r1
  RwReal v38; // r2
  const CMatrix *v39; // r1
  float v40; // s17
  float v41; // s19
  float m_lodDistance; // s28
  float m_size; // s30
  float v44; // s23
  float v45; // s21
  float v46; // s26
  float v47; // s0
  RwReal v48; // r1
  RwReal v49; // r2
  const CMatrix *v50; // r1
  int32 v51; // r0
  uint8 *v52; // r0
  int v53; // r1
  __int64 parentMat; // [sp+0h] [bp-140h]
  uint8 nPalID; // [sp+10h] [bp-130h]
  unsigned int v56; // [sp+50h] [bp-F0h]
  unsigned int v57; // [sp+54h] [bp-ECh]
  unsigned int v58; // [sp+58h] [bp-E8h]
  int v59; // [sp+5Ch] [bp-E4h]
  CBaseModelInfo *v60; // [sp+60h] [bp-E0h]
  CEntity::CFlags *p_m_nFlags; // [sp+68h] [bp-D8h]
  const CSimpleTransform *p_m_transform; // [sp+6Ch] [bp-D4h]
  RwV3d_0 v64; // [sp+70h] [bp-D0h] BYREF
  CVector v65; // [sp+80h] [bp-C0h] BYREF
  RwV3d_0 v66; // [sp+90h] [bp-B0h] BYREF
  RwV3d_0 v67; // [sp+A0h] [bp-A0h] BYREF
  RwV3d_0 result; // [sp+B0h] [bp-90h] BYREF
  CVector v; // [sp+C0h] [bp-80h] BYREF
  CVector v70[9]; // [sp+D0h] [bp-70h] BYREF

  v1 = this;
  m_nModelIndex = this->m_nModelIndex;
  p_m_nFlags = &this->m_nFlags;
  *(_DWORD *)&this->m_nFlags &= ~0x1000000u;
  v3 = CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
  m_num2dEffects = v3->m_num2dEffects;
  if ( v3->m_num2dEffects )
  {
    p_m_transform = &this->m_transform;
    v5 = 0;
    v56 = (unsigned int)&CClock::ms_nGameClockHours;
    v58 = (unsigned int)&CClock::ms_nGameClockHours;
    v57 = (unsigned int)&CClock::ms_nGameClockHours;
    v59 = v3->m_num2dEffects;
    v60 = CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
    do
    {
      v6 = CBaseModelInfo::Get2dEffect(v3, v5);
      switch ( v6->m_type )
      {
        case 0u:
          *(_DWORD *)p_m_nFlags |= 0x200000u;
          break;
        case 1u:
          m_pRwObject = v1->m_pRwObject;
          if ( m_pRwObject )
            v8 = (RwMatrix *)((char *)m_pRwObject->parent + 16);
          else
            v8 = 0;
          Fx_c::CreateEntityFx(&g_fx, v1, (unsigned __int8 *)&v6->attr.l.m_colour, &v6->m_posn, v8);
          break;
        case 3u:
          if ( v6->attr.q.m_type == 5 )
            CScriptsForBrains::RequestAttractorScriptBrainWithThisName(
              &CTheScripts::ScriptsForBrains,
              v6->attr.q.m_scriptName);
          break;
        case 6u:
          v9 = v6->attr.l.m_coronaSize + v6->m_posn.x;
          v10 = v6->attr.q.m_useDir.z + v6->m_posn.z;
          v67.y = v6->attr.l.m_shadowSize + v6->m_posn.y;
          v67.x = v9;
          v67.z = v10;
          m_pMat = v1->m_pMat;
          if ( m_pMat )
          {
            v12 = *(_QWORD *)&v6->m_posn.x;
            v.z = v6->m_posn.z;
            *(_QWORD *)&v.x = v12;
            operator*(v70, m_pMat, &v);
            result = (RwV3d_0)v70[0];
          }
          else
          {
            TransformPoint(&result, p_m_transform, &v6->m_posn);
          }
          v25 = v1->m_pMat;
          if ( v25 )
          {
            v = (CVector)v67;
            operator*(v70, v25, &v);
            v66 = (RwV3d_0)v70[0];
          }
          else
          {
            TransformPoint(&v66, p_m_transform, &v67);
          }
          v67 = v66;
          if ( (v6->attr.q.m_scriptName[2] & 4) != 0 )
          {
            v29 = v6->attr.q.m_scriptName[1];
            v30 = CClock::ms_nGameClockDays;
            if ( v6->attr.q.m_scriptName[0] > v29 && CClock::ms_nGameClockHours < v29 )
              v30 = CClock::ms_nGameClockDays - 1;
            srand((v30 - 1) & (unsigned int)v1);
          }
          v31 = v1->m_pMat;
          x = result.x;
          y = result.y;
          z = result.z;
          v35 = v6->attr.q.m_queueDir.x;
          if ( v31 )
            m_heading = atan2f(COERCE_FLOAT(LODWORD(v31->xy) ^ 0x80000000), v31->yy);
          else
            m_heading = v1->m_transform.m_heading;
          v40 = v67.y;
          v41 = v67.z;
          m_lodDistance = v6->attr.l.m_lodDistance;
          m_size = v6->attr.l.m_size;
          v44 = v6->attr.q.m_forwardDir.x;
          v45 = v35 + (float)((float)(m_heading * 180.0) / 3.1416);
          v46 = v67.x;
          if ( v31 )
            v47 = atan2f(COERCE_FLOAT(LODWORD(v31->xy) ^ 0x80000000), v31->yy);
          else
            v47 = v1->m_transform.m_heading;
          v51 = CEntryExitManager::AddOne(
                  x,
                  y,
                  z,
                  v45,
                  m_lodDistance,
                  m_size,
                  0.0,
                  v46,
                  v40,
                  v41,
                  v44 + (float)((float)(v47 * 180.0) / 3.1416),
                  v6->attr.e.areacode,
                  v6->attr.i.m_seed | (v6->attr.q.m_scriptName[2] << 8),
                  v6->attr.i.m_status,
                  v6->attr.q.m_scriptName[0],
                  v6->attr.q.m_scriptName[1],
                  0,
                  v6->attr.e.cTitle);
          m_num2dEffects = v59;
          v3 = v60;
          if ( v51 != -1 )
          {
            v52 = (CEntryExitManager::mp_poolEntryExits->m_aFlags[v51] & 0x80u) != 0 ? 0 : CEntryExitManager::mp_poolEntryExits->m_aStorage[v51];
            v53 = *((_DWORD *)v52 + 14);
            if ( v53 )
            {
              if ( (*(_BYTE *)(v53 + 49) & 0x40) == 0 )
                *((_WORD *)v52 + 24) &= ~0x4000u;
            }
          }
          v1 = this;
          break;
        case 7u:
          *(_DWORD *)p_m_nFlags |= 0x1000000u;
          v14 = v6->attr.l.m_lodDistance;
          v13 = v6->attr.q.m_queueDir.x;
          textTabPtr = v6->attr.rs.textTabPtr;
          v56 = v6->attr.l.m_flags | v56 & 0xFFFF0000;
          NumLinesFromFlags = C2dEffect::Roadsign_GetNumLinesFromFlags(v6->attr.rs._anon_0.rsFlags);
          v58 = v58 & 0xFFFF0000 | v6->attr.l.m_flags;
          NumLettersFromFlags = C2dEffect::Roadsign_GetNumLettersFromFlags(v6->attr.rs._anon_0.rsFlags);
          v57 = v57 & 0xFFFF0000 | v6->attr.l.m_flags;
          PaletteIDFromFlags = C2dEffect::Roadsign_GetPaletteIDFromFlags(v6->attr.rs._anon_0.rsFlags);
          LODWORD(parentMat) = textTabPtr + 16;
          HIDWORD(parentMat) = textTabPtr + 32;
          v19 = NumLinesFromFlags;
          nPalID = PaletteIDFromFlags;
          v20 = v13;
          v1 = this;
          v3 = v60;
          RoadsignAtomic = CCustomRoadsignMgr::CreateRoadsignAtomic(
                             v20,
                             v14,
                             v19,
                             textTabPtr,
                             parentMat,
                             textTabPtr + 48,
                             NumLettersFromFlags,
                             nPalID);
          parent = (RwFrame_0 *)RoadsignAtomic->object.object.parent;
          RwFrameSetIdentity(parent);
          RwFrameRotate(parent, &CEntity::CreateEffects(void)::axisZ, v6->attr.l.m_shadowSize, rwCOMBINEREPLACE);
          RwFrameRotate(parent, &CEntity::CreateEffects(void)::axisX, v6->attr.l.m_size, rwCOMBINEPOSTCONCAT);
          RwFrameRotate(parent, &CEntity::CreateEffects(void)::axisY, v6->attr.l.m_coronaSize, rwCOMBINEPOSTCONCAT);
          v70[0] = v6->m_posn;
          RwFrameTranslate(parent, v70, rwCOMBINEPOSTCONCAT);
          RwFrameUpdateObjects(parent);
          v6->attr.rs.m_rsAtomic = RoadsignAtomic;
          m_num2dEffects = v59;
          break;
        case 0xAu:
          v23 = v1->m_pMat;
          if ( v23 )
          {
            v24 = *(_QWORD *)&v6->m_posn.x;
            v.z = v6->m_posn.z;
            *(_QWORD *)&v.x = v24;
            operator*(v70, v23, &v);
            result = (RwV3d_0)v70[0];
          }
          else
          {
            TransformPoint(&result, p_m_transform, &v6->m_posn);
          }
          v26 = v6->attr.l.m_lodDistance;
          v27 = v6->attr.l.m_size;
          LODWORD(v66.x) = v6->attr.t.Index;
          v66.y = v26;
          v66.z = v27;
          v28 = v1->m_pMat;
          if ( v28 )
          {
            v = (CVector)v66;
            operator*(v70, v28, &v);
            v67 = (RwV3d_0)v70[0];
          }
          else
          {
            TransformPoint(&v67, p_m_transform, &v66);
          }
          m_shadowSize = v6->attr.l.m_shadowSize;
          v38 = v6->attr.q.m_useDir.z;
          v65.x = v6->attr.l.m_coronaSize;
          v65.y = m_shadowSize;
          v65.z = v38;
          v39 = v1->m_pMat;
          if ( v39 )
          {
            v = v65;
            operator*(v70, v39, &v);
            v66 = (RwV3d_0)v70[0];
          }
          else
          {
            TransformPoint(&v66, p_m_transform, &v65);
          }
          v48 = v6->attr.q.m_forwardDir.y;
          v49 = v6->attr.q.m_forwardDir.z;
          LODWORD(v64.x) = v6->attr.rs.textTabPtr;
          v64.y = v48;
          v64.z = v49;
          v50 = v1->m_pMat;
          if ( v50 )
          {
            v = (CVector)v64;
            operator*(v70, v50, &v);
            v65 = v70[0];
          }
          else
          {
            TransformPoint(&v65, p_m_transform, &v64);
          }
          CEscalators::AddOne(
            (const CVector *)&result,
            (const CVector *)&v67,
            (const CVector *)&v66,
            &v65,
            v6->attr.q.m_type == 0,
            v1);
          break;
        default:
          break;
      }
      ++v5;
    }
    while ( m_num2dEffects != v5 );
  }
}

//----- (003EB7B0) --------------------------------------------------------
void __fastcall CEntity::DestroyEffects(CEntity *this)
{
  CEntity *v1; // r4
  CBaseModelInfo *v2; // r5
  int m_num2dEffects; // r6
  CVector *v4; // r11
  int32 v5; // r10
  C2dEffect *v6; // r8
  const CMatrix *m_pMat; // r1
  __int64 v8; // d16
  RpAtomic_0 *m_rsAtomic; // r9
  CVector *v10; // r4
  RwFrame_0 *parent; // r11
  int32 NearestEntryExit; // r0
  uint8 *v13; // r1
  const CSimpleTransform *p_m_transform; // [sp+4h] [bp-5Ch]
  RwV3d_0 result; // [sp+18h] [bp-48h] BYREF
  CVector v; // [sp+28h] [bp-38h] BYREF
  RwV3d_0 v18; // [sp+38h] [bp-28h] BYREF

  v1 = this;
  v2 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
  m_num2dEffects = v2->m_num2dEffects;
  if ( v2->m_num2dEffects )
  {
    p_m_transform = &this->m_transform;
    v4 = (CVector *)&v18;
    v5 = 0;
    do
    {
      v6 = CBaseModelInfo::Get2dEffect(v2, v5);
      switch ( v6->m_type )
      {
        case 1u:
          Fx_c::DestroyEntityFx(&g_fx, v1);
          break;
        case 3u:
          if ( v6->attr.q.m_type == 5 )
            CScriptsForBrains::MarkAttractorScriptBrainWithThisNameAsNoLongerNeeded(
              &CTheScripts::ScriptsForBrains,
              v6->attr.q.m_scriptName);
          break;
        case 6u:
          m_pMat = v1->m_pMat;
          if ( m_pMat )
          {
            v8 = *(_QWORD *)&v6->m_posn.x;
            v.z = v6->m_posn.z;
            *(_QWORD *)&v.x = v8;
            operator*(v4, m_pMat, &v);
            result = v18;
          }
          else
          {
            TransformPoint(&result, p_m_transform, &v6->m_posn);
          }
          *(_QWORD *)&v18.x = *(_QWORD *)&result.x;
          NearestEntryExit = CEntryExitManager::FindNearestEntryExit((const CVector2D *)v4, 1.5, -1);
          if ( NearestEntryExit != -1 )
          {
            if ( (CEntryExitManager::mp_poolEntryExits->m_aFlags[NearestEntryExit] & 0x80u) != 0 )
              v13 = 0;
            else
              v13 = CEntryExitManager::mp_poolEntryExits->m_aStorage[NearestEntryExit];
            if ( (*((_WORD *)v13 + 24) & 0x2000) != 0 )
              *((_WORD *)v13 + 24) |= 0x8000u;
            else
              CEntryExitManager::DeleteOne(NearestEntryExit);
          }
          break;
        case 7u:
          m_rsAtomic = v6->attr.rs.m_rsAtomic;
          if ( m_rsAtomic )
          {
            v10 = v4;
            parent = (RwFrame_0 *)m_rsAtomic->object.object.parent;
            if ( parent )
            {
              RpAtomicSetFrame(v6->attr.rs.m_rsAtomic, 0);
              RwFrameDestroy(parent);
            }
            RpAtomicDestroy(m_rsAtomic);
            v4 = v10;
            v6->attr.rs.m_rsAtomic = 0;
            v1 = this;
          }
          break;
        default:
          break;
      }
      ++v5;
    }
    while ( m_num2dEffects != v5 );
  }
}

//----- (003EB90C) --------------------------------------------------------
void __fastcall CEntity::CreateRwObject(CEntity *this)
{
  int m_nFlags; // r0
  CEntity::CFlags *p_m_nFlags; // r6
  int m_nModelIndex; // r2
  CBaseModelInfo *v5; // r9
  RwObject_0 *v6; // r0
  int type; // r0
  CPtrListDoubleLink *v8; // r0
  CPtrNode *m_pHead; // r1
  RpClump_0 *m_pLod; // r0
  bool v11; // zf
  CAnimBlendAssociation *FirstAssociation; // r8
  CAnimBlendAssociation *v13; // r0
  RpAtomic_0 *m_pRwObject; // r0

  p_m_nFlags = &this->m_nFlags;
  m_nFlags = (int)this->m_nFlags;
  if ( (m_nFlags & 0x80) != 0 )
  {
    m_nModelIndex = this->m_nModelIndex;
    v5 = CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
    if ( (m_nFlags & 0x200) != 0 )
    {
      CDamageAtomicModelInfo::m_bCreateDamagedVersion = 1;
      v6 = (RwObject_0 *)(*((int (__fastcall **)(CBaseModelInfo *))v5->_vptr$CBaseModelInfo + 11))(v5);
      CDamageAtomicModelInfo::m_bCreateDamagedVersion = 0;
    }
    else
    {
      v6 = (RwObject_0 *)(*((int (__fastcall **)(CBaseModelInfo *))v5->_vptr$CBaseModelInfo + 11))(CModelInfo::ms_modelInfoPtrs[m_nModelIndex]);
    }
    this->m_pRwObject = v6;
    if ( v6 )
    {
      if ( (*(_BYTE *)&this->m_info & 7) == 1 )
        ++gBuildings;
      if ( this->m_pMat )
        CMatrix::UpdateRwMatrix(this->m_pMat, (RwMatrix *)((char *)v6->parent + 16));
      else
        CSimpleTransform::UpdateRwMatrix(&this->m_transform, (RwMatrix *)((char *)v6->parent + 16));
      type = this->m_pRwObject->type;
      if ( type == 2 )
      {
        if ( HIBYTE(v5->m_flags) << 31 )
        {
          if ( (*(_BYTE *)&this->m_info & 7) == 4 )
          {
            if ( !LODWORD(this[3].m_transform.m_translate.x) )
              CPhysical::AddToMovingList((CPhysical *)this);
            (*((void (__fastcall **)(CEntity *, _DWORD))this->_vptr$CPlaceable + 5))(this, 0);
          }
          else
          {
            v8 = (CPtrListDoubleLink *)CPtrNodeDoubleLink::operator new(0xCu);
            v8->m_pHead = (CPtrNode *)this;
            v8[2].m_pHead = 0;
            m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
            v8[1].m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
            if ( m_pHead )
              m_pHead[1].m_pVoid = v8;
            CWorld::ms_listMovingEntityPtrs.m_pHead = (CPtrNode *)v8;
          }
          m_pLod = (RpClump_0 *)this->m_pLod;
          v11 = m_pLod == 0;
          if ( m_pLod )
          {
            m_pLod = (RpClump_0 *)m_pLod->cameraList.link.next;
            v11 = m_pLod == 0;
          }
          if ( !v11 && m_pLod->object.type == 2 )
          {
            FirstAssociation = RpAnimBlendClumpGetFirstAssociation(m_pLod);
            if ( FirstAssociation )
            {
              v13 = RpAnimBlendClumpGetFirstAssociation((RpClump_0 *)this->m_pRwObject);
              if ( v13 )
                CAnimBlendAssociation::SetCurrentTime(v13, FirstAssociation->m_fCurrentTime);
            }
          }
        }
      }
      else if ( type == 1 && CTagManager::IsTag(this) )
      {
        CTagManager::ResetAlpha(this);
      }
      CBaseModelInfo::AddRef(v5);
      this->m_pLastRenderedLink = CStreaming::AddEntity(this);
      CEntity::CreateEffects(this);
      m_pRwObject = (RpAtomic_0 *)this->m_pRwObject;
      if ( m_pRwObject->object.object.type != 1 )
        m_pRwObject = GetFirstAtomic((RpClump_0 *)m_pRwObject);
      if ( !CCustomBuildingRenderer::IsCBPCPipelineAttached(m_pRwObject) )
        *(_DWORD *)p_m_nFlags |= 0x10000000u;
    }
  }
}

//----- (003EBA80) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CEntity::AttachToRwObject(CEntity *this, RwObject_0 *pObj, bool bUpdateMatrix)
{
  CEntity *v3; // r4
  RwObject_0 *v4; // r1
  int v5; // r1
  RwObject_0 *m_pRwObject; // r1
  _BYTE *v7; // r1
  CPtrListDoubleLink *v8; // r0
  CPtrNode *m_pHead; // r1

  v3 = this;
  if ( (*(_BYTE *)&this->m_nFlags & 0x80) != 0 )
  {
    this->m_pRwObject = v4;
    if ( v4 )
    {
      if ( bUpdateMatrix )
      {
        this = (CEntity *)this->m_pMat;
        if ( !this )
        {
          CPlaceable::AllocateMatrix(v3);
          CSimpleTransform::UpdateMatrix(&v3->m_transform, v3->m_pMat);
          *(_QWORD *)&this = *(_QWORD *)&v3->m_pMat;
        }
        CMatrix::UpdateMatrix((CMatrix *)this, (RwMatrix *)(*(_DWORD *)(v5 + 4) + 16));
        m_pRwObject = v3->m_pRwObject;
      }
      if ( *v7 == 2 && HIBYTE(CModelInfo::ms_modelInfoPtrs[v3->m_nModelIndex]->m_flags) << 31 )
      {
        if ( (*(_BYTE *)&v3->m_info & 7) == 4 )
        {
          if ( !LODWORD(v3[3].m_transform.m_translate.x) )
            CPhysical::AddToMovingList((CPhysical *)v3);
          (*((void (__fastcall **)(CEntity *, _DWORD))v3->_vptr$CPlaceable + 5))(v3, 0);
        }
        else
        {
          v8 = (CPtrListDoubleLink *)CPtrNodeDoubleLink::operator new(0xCu);
          v8->m_pHead = (CPtrNode *)v3;
          v8[2].m_pHead = 0;
          m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
          v8[1].m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
          if ( m_pHead )
            m_pHead[1].m_pVoid = v8;
          CWorld::ms_listMovingEntityPtrs.m_pHead = (CPtrNode *)v8;
        }
      }
      CBaseModelInfo::AddRef(CModelInfo::ms_modelInfoPtrs[v3->m_nModelIndex]);
      v3->m_pLastRenderedLink = CStreaming::AddEntity(v3);
      CEntity::CreateEffects(v3);
    }
  }
}
// 3EBA80: variables would overlap: r0.4 and r0.8

//----- (003EBB54) --------------------------------------------------------
void __fastcall CEntity::DetachFromRwObject(CEntity *this)
{
  int m_nModelIndex; // r0
  unsigned __int8 *v3; // r5
  CPtrNode *m_pHead; // r0
  _DWORD *m_pVoid; // r1
  CPtrNode *m_pNext; // r1

  if ( this->m_pRwObject )
  {
    CBaseModelInfo::RemoveRef(CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]);
    CStreaming::RemoveEntity(this->m_pLastRenderedLink);
    m_nModelIndex = this->m_nModelIndex;
    this->m_pLastRenderedLink = 0;
    v3 = (unsigned __int8 *)CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
    if ( (*(int (__fastcall **)(unsigned __int8 *))(*(_DWORD *)v3 + 20))(v3) == 5
      && v3[41] << 31
      && (*(_BYTE *)&this->m_info & 7) != 4
      && CWorld::ms_listMovingEntityPtrs.m_pHead )
    {
      m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
      while ( m_pHead->m_pVoid != this )
      {
        m_pHead = m_pHead->m_pNext;
        if ( !m_pHead )
          goto LABEL_17;
      }
      if ( CWorld::ms_listMovingEntityPtrs.m_pHead == m_pHead )
        CWorld::ms_listMovingEntityPtrs.m_pHead = m_pHead->m_pNext;
      m_pVoid = m_pHead[1].m_pVoid;
      if ( m_pVoid )
        m_pVoid[1] = m_pHead->m_pNext;
      m_pNext = m_pHead->m_pNext;
      if ( m_pNext )
        m_pNext[1].m_pVoid = m_pHead[1].m_pVoid;
      CPtrNodeDoubleLink::operator delete(m_pHead);
    }
LABEL_17:
    CEntity::DestroyEffects(this);
  }
  this->m_pRwObject = 0;
}

//----- (003EBBFC) --------------------------------------------------------
void __fastcall CEntity::DeleteRwObject(CEntity *this)
{
  RpClump_0 *m_pRwObject; // r5
  int type; // r0
  RwFrame_0 *parent; // r6
  RpAtomic_0 *FirstAtomic; // r0
  int m_nModelIndex; // r1
  CEntity::CEntityInfo m_info; // r0
  unsigned __int8 *v8; // r5
  CPtrNode *m_pHead; // r0
  _DWORD *m_pVoid; // r1
  CPtrNode *m_pNext; // r1

  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  if ( m_pRwObject )
  {
    type = m_pRwObject->object.type;
    if ( type == 2 )
    {
      FirstAtomic = GetFirstAtomic(m_pRwObject);
      if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
        RpClumpForAllAtomics(m_pRwObject, AtomicRemoveAnimFromSkinCB, 0);
      RpClumpDestroy(m_pRwObject);
    }
    else if ( type == 1 )
    {
      parent = (RwFrame_0 *)m_pRwObject->object.parent;
      RpAtomicDestroy((RpAtomic_0 *)m_pRwObject);
      RwFrameDestroy(parent);
    }
    m_nModelIndex = this->m_nModelIndex;
    this->m_pRwObject = 0;
    CBaseModelInfo::RemoveRef(CModelInfo::ms_modelInfoPtrs[m_nModelIndex]);
    CStreaming::RemoveEntity(this->m_pLastRenderedLink);
    m_info = this->m_info;
    this->m_pLastRenderedLink = 0;
    if ( (*(_BYTE *)&m_info & 7) == 1 )
      --gBuildings;
    v8 = (unsigned __int8 *)CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
    if ( (*(int (__fastcall **)(unsigned __int8 *))(*(_DWORD *)v8 + 20))(v8) == 5
      && v8[41] << 31
      && (*(_BYTE *)&this->m_info & 7) != 4
      && CWorld::ms_listMovingEntityPtrs.m_pHead )
    {
      m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
      while ( m_pHead->m_pVoid != this )
      {
        m_pHead = m_pHead->m_pNext;
        if ( !m_pHead )
          goto LABEL_27;
      }
      if ( CWorld::ms_listMovingEntityPtrs.m_pHead == m_pHead )
        CWorld::ms_listMovingEntityPtrs.m_pHead = m_pHead->m_pNext;
      m_pVoid = m_pHead[1].m_pVoid;
      if ( m_pVoid )
        m_pVoid[1] = m_pHead->m_pNext;
      m_pNext = m_pHead->m_pNext;
      if ( m_pNext )
        m_pNext[1].m_pVoid = m_pHead[1].m_pVoid;
      CPtrNodeDoubleLink::operator delete(m_pHead);
    }
LABEL_27:
    CEntity::DestroyEffects(this);
    sub_193E3C(this);
  }
}

//----- (003EBD20) --------------------------------------------------------
CRect *__fastcall CEntity::GetBoundRect(CRect *retstr, const CEntity *this)
{
  CColModel *m_pColModel; // r0
  __int64 v5; // d16
  __int64 v6; // d16
  CMatrix *m_pMat; // r1
  float x; // s2
  float v9; // s16
  float v10; // s18
  RwReal y; // s0
  bool v12; // fzf
  bool v13; // fnf
  float v14; // s20
  float v15; // s22
  CMatrix *v16; // r1
  __int64 v17; // kr00_8
  bool v18; // fnf
  RwReal v19; // r0
  CMatrix *v20; // r1
  __int64 v21; // kr08_8
  bool v22; // fnf
  CMatrix *v23; // r1
  CRect *result; // r0
  __int64 v25; // kr10_8
  bool v26; // fnf
  RwV3d_0 v27; // [sp+0h] [bp-78h] BYREF
  RwV3d_0 v28; // [sp+10h] [bp-68h] BYREF
  RwV3d_0 v29; // [sp+20h] [bp-58h] BYREF
  CVector v; // [sp+30h] [bp-48h] BYREF
  CVector v31; // [sp+40h] [bp-38h] BYREF

  *(_QWORD *)&retstr->left = 0xC974240049742400LL;
  *(_QWORD *)&retstr->right = 0x49742400C9742400LL;
  m_pColModel = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
  v5 = *(_QWORD *)&m_pColModel->m_boxBound.m_vecMin.x;
  v29.z = m_pColModel->m_boxBound.m_vecMin.z;
  *(_QWORD *)&v29.x = v5;
  v6 = *(_QWORD *)&m_pColModel->m_boxBound.m_vecMax.x;
  v28.z = m_pColModel->m_boxBound.m_vecMax.z;
  *(_QWORD *)&v28.x = v6;
  m_pMat = this->m_pMat;
  if ( m_pMat )
  {
    v = (CVector)v29;
    operator*(&v31, m_pMat, &v);
    v27 = v31.RwV3d_0;
  }
  else
  {
    TransformPoint(&v27, &this->m_transform, &v29);
  }
  x = v27.x;
  v9 = 1000000.0;
  v10 = -1000000.0;
  y = v27.y;
  v12 = v27.x == -1000000.0;
  v13 = v27.x < -1000000.0;
  v14 = 1000000.0;
  v15 = -1000000.0;
  if ( v27.x < 1000000.0 )
  {
    retstr->left = v27.x;
    v9 = x;
  }
  if ( !v13 && !v12 )
  {
    retstr->right = x;
    v10 = x;
  }
  if ( y < 1000000.0 )
  {
    retstr->bottom = y;
    v14 = y;
  }
  if ( y > -1000000.0 )
  {
    retstr->top = y;
    v15 = y;
  }
  v16 = this->m_pMat;
  if ( v16 )
  {
    v = (CVector)v28;
    operator*(&v31, v16, &v);
    v27 = v31.RwV3d_0;
  }
  else
  {
    TransformPoint(&v27, &this->m_transform, &v28);
  }
  v17 = *(_QWORD *)&v27.x;
  v18 = v10 < v27.x;
  if ( v9 > v27.x )
  {
    retstr->left = v27.x;
    v9 = *(float *)&v17;
  }
  if ( v18 )
  {
    LODWORD(retstr->right) = v17;
    v10 = *(float *)&v17;
  }
  if ( v14 > *((float *)&v17 + 1) )
  {
    retstr->bottom = *((float *)&v17 + 1);
    v14 = *((float *)&v17 + 1);
  }
  if ( v15 < *((float *)&v17 + 1) )
  {
    retstr->top = *((float *)&v17 + 1);
    v15 = *((float *)&v17 + 1);
  }
  v19 = v29.x;
  v29.x = v28.x;
  v28.x = v19;
  v20 = this->m_pMat;
  if ( v20 )
  {
    v = (CVector)v29;
    operator*(&v31, v20, &v);
    v27 = v31.RwV3d_0;
  }
  else
  {
    TransformPoint(&v27, &this->m_transform, &v29);
  }
  v21 = *(_QWORD *)&v27.x;
  v22 = v10 < v27.x;
  if ( v9 > v27.x )
  {
    retstr->left = v27.x;
    v9 = *(float *)&v21;
  }
  if ( v22 )
  {
    LODWORD(retstr->right) = v21;
    v10 = *(float *)&v21;
  }
  if ( v14 > *((float *)&v21 + 1) )
  {
    retstr->bottom = *((float *)&v21 + 1);
    v14 = *((float *)&v21 + 1);
  }
  if ( v15 < *((float *)&v21 + 1) )
  {
    retstr->top = *((float *)&v21 + 1);
    v15 = *((float *)&v21 + 1);
  }
  v23 = this->m_pMat;
  if ( v23 )
  {
    v = (CVector)v28;
    operator*(&v31, v23, &v);
    result = (CRect *)LODWORD(v31.z);
    v27 = v31.RwV3d_0;
  }
  else
  {
    TransformPoint(&v27, &this->m_transform, &v28);
  }
  v25 = *(_QWORD *)&v27.x;
  v26 = v10 < v27.x;
  if ( v9 > v27.x )
    retstr->left = v27.x;
  if ( v26 )
    LODWORD(retstr->right) = v25;
  if ( v14 > *((float *)&v25 + 1) )
    retstr->bottom = *((float *)&v25 + 1);
  if ( v15 < *((float *)&v25 + 1) )
    retstr->top = *((float *)&v25 + 1);
  return result;
}

//----- (003EBF8C) --------------------------------------------------------
CVector *__fastcall CEntity::GetBoundCentre(CVector *retstr, const CEntity *this)
{
  CBaseModelInfo *v4; // r0
  CMatrix *m_pMat; // r1
  const RwV3d_0 *p_m_vecCentre; // r2
  __int64 v7; // d16
  __int64 v8; // d16
  CVector *result; // r0
  CVector v10; // [sp+0h] [bp-28h] BYREF
  CVector v11; // [sp+10h] [bp-18h] BYREF

  v4 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
  m_pMat = this->m_pMat;
  p_m_vecCentre = &v4->m_pColModel->m_sphereBound.m_vecCentre;
  if ( m_pMat )
  {
    v7 = *(_QWORD *)&p_m_vecCentre->x;
    v10.z = v4->m_pColModel->m_sphereBound.m_vecCentre.z;
    *(_QWORD *)&v10.x = v7;
    operator*(&v11, m_pMat, &v10);
    v8 = *(_QWORD *)&v11.x;
    result = (CVector *)LODWORD(v11.z);
    retstr->z = v11.z;
    *(_QWORD *)&retstr->x = v8;
  }
  else
  {
    TransformPoint(retstr, &this->m_transform, p_m_vecCentre);
  }
  return result;
}

//----- (003EBFE4) --------------------------------------------------------
void __fastcall CEntity::GetBoundCentre(const CEntity *this, CVector *centre)
{
  CMatrix *m_pMat; // r1
  CSphere *p_m_sphereBound; // r2
  __int64 v5; // d16
  __int64 v6; // d16
  CVector v7; // [sp+0h] [bp-28h] BYREF
  CVector v8; // [sp+10h] [bp-18h] BYREF

  m_pMat = this->m_pMat;
  p_m_sphereBound = &CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound;
  if ( m_pMat )
  {
    v5 = *(_QWORD *)&p_m_sphereBound->m_vecCentre.x;
    v7.z = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_vecCentre.z;
    *(_QWORD *)&v7.x = v5;
    operator*(&v8, m_pMat, &v7);
    v6 = *(_QWORD *)&v8.x;
    centre->z = v8.z;
    *(_QWORD *)&centre->x = v6;
  }
  else
  {
    sub_194114(centre, &this->m_transform, &p_m_sphereBound->m_vecCentre);
  }
}

//----- (003EC038) --------------------------------------------------------
void __fastcall CEntity::UpdateRwFrame(CEntity *this)
{
  RwObject_0 *m_pRwObject; // r0

  m_pRwObject = this->m_pRwObject;
  if ( m_pRwObject )
    sub_1928A8((RwFrame_0 *)m_pRwObject->parent);
}

//----- (003EC046) --------------------------------------------------------
void __fastcall CEntity::UpdateRpHAnim(CEntity *this)
{
  RpAtomic_0 *FirstAtomic; // r0
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r0

  FirstAtomic = GetFirstAtomic((RpClump_0 *)this->m_pRwObject);
  if ( FirstAtomic
    && j_RpSkinGeometryGetSkin(FirstAtomic->geometry)
    && !(*((unsigned __int8 *)&this->m_nFlags + 2) >> 7) )
  {
    AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)this->m_pRwObject);
    sub_19FF4C(AnimHierarchyFromSkinClump);
  }
}

//----- (003EC07C) --------------------------------------------------------
void __fastcall CEntity::UpdateAnim(CEntity *this)
{
  int m_nFlags; // r1
  CEntity::CFlags *p_m_nFlags; // r5
  RpClump_0 *m_pRwObject; // r0
  int v5; // r0
  bool v6; // zf
  unsigned int v7; // r3
  CMatrix *m_pMat; // r1
  CSphere *p_m_sphereBound; // r2
  __int64 v10; // d16
  RwV3d_0 v11; // [sp+0h] [bp-38h] BYREF
  CVector v; // [sp+10h] [bp-28h] BYREF
  CVector v13; // [sp+20h] [bp-18h] BYREF

  p_m_nFlags = &this->m_nFlags;
  m_nFlags = (int)this->m_nFlags;
  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  *(_DWORD *)p_m_nFlags = m_nFlags & 0xFF7FFFFF;
  if ( m_pRwObject && m_pRwObject->object.type == 2 && RpAnimBlendClumpGetFirstAssociation(m_pRwObject) )
  {
    v5 = *(_BYTE *)&this->m_info & 7;
    v6 = v5 == 4;
    if ( v5 == 4 )
      v6 = LOBYTE(this[5].m_pMat) == 4;
    if ( v6 )
    {
      sub_195C90((RpClump_0 *)this->m_pRwObject, CTimer::ms_fTimeStepNonClipped / 50.0, 1);
    }
    else
    {
      v7 = *(_DWORD *)p_m_nFlags;
      if ( (*(_DWORD *)p_m_nFlags & 0x20000) == 0 )
      {
        m_pMat = this->m_pMat;
        p_m_sphereBound = &CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound;
        if ( m_pMat )
        {
          v10 = *(_QWORD *)&p_m_sphereBound->m_vecCentre.x;
          v.z = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_vecCentre.z;
          *(_QWORD *)&v.x = v10;
          operator*(&v13, m_pMat, &v);
          v11 = v13.RwV3d_0;
        }
        else
        {
          TransformPoint(&v11, &this->m_transform, &p_m_sphereBound->m_vecCentre);
        }
        v7 = *(_DWORD *)p_m_nFlags & 0xFFFDFFFF | (!CCamera::IsSphereVisible(
                                                      &TheCamera,
                                                      (const CVector *)&v11,
                                                      CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius) << 17);
        *(_DWORD *)p_m_nFlags = v7;
      }
      RpAnimBlendClumpUpdateAnimations((RpClump_0 *)this->m_pRwObject, CTimer::ms_fTimeStep / 50.0, (v7 & 0x20000) == 0);
    }
  }
}

//----- (003EC198) --------------------------------------------------------
bool __fastcall CEntity::GetIsOnScreen(CEntity *this)
{
  CMatrix *m_pMat; // r1
  CSphere *p_m_sphereBound; // r2
  __int64 v4; // d16
  RwV3d_0 v6; // [sp+0h] [bp-38h] BYREF
  CVector v; // [sp+10h] [bp-28h] BYREF
  CVector v8; // [sp+20h] [bp-18h] BYREF

  m_pMat = this->m_pMat;
  p_m_sphereBound = &CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound;
  if ( m_pMat )
  {
    v4 = *(_QWORD *)&p_m_sphereBound->m_vecCentre.x;
    v.z = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_vecCentre.z;
    *(_QWORD *)&v.x = v4;
    operator*(&v8, m_pMat, &v);
    v6 = v8.RwV3d_0;
  }
  else
  {
    TransformPoint(&v6, &this->m_transform, &p_m_sphereBound->m_vecCentre);
  }
  return CCamera::IsSphereVisible(
           &TheCamera,
           (const CVector *)&v6,
           CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius);
}

//----- (003EC214) --------------------------------------------------------
bool __fastcall CEntity::DoesNotCollideWithFlyers(CEntity *this)
{
  int v1; // r3
  int v2; // r2
  unsigned int m_flags; // r0
  _BOOL4 v4; // r0

  v1 = 0;
  v2 = 0;
  m_flags = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_flags;
  if ( (m_flags & 0x7800) != 2048 )
    v1 = 1;
  if ( (m_flags & 0x7800) == 4096 )
    v2 = 1;
  if ( v2 != v1 )
    return (m_flags >> 10) & 1;
  else
    LOBYTE(v4) = 1;
  return v4;
}

//----- (003EC250) --------------------------------------------------------
RpMaterial_0 *__fastcall MaterialUpdateUVAnimCB(RpMaterial_0 *material, void *data)
{
  if ( RpMaterialUVAnimExists(material) )
  {
    RpMaterialUVAnimAddAnimTime(material, CTimer::ms_fTimeStep / 50.0);
    RpMaterialUVAnimApplyUpdate(material);
  }
  return material;
}

//----- (003EC28C) --------------------------------------------------------
void __fastcall CEntity::PreRender(CEntity *this)
{
  RpAtomic_0 *v1; // r4
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  CBaseModelInfo *v6; // r6
  int v7; // r5
  uint16 m_flags; // r0
  bool v9; // zf
  RpGeometry_0 *Effects; // r0
  bool v11; // zf
  unsigned int m_alpha; // r0
  char v13; // r0
  int v14; // r2
  int v15; // r1
  int v16; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v20; // d16
  float32x2_t v21; // d0
  int v22; // r0
  int m_nModelIndex; // r1
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  CMatrix *v26; // r0
  RwMatrix *v27; // r1
  RwObject_0 *v28; // r0
  int v29; // r0
  int v30; // r1
  int v31; // r2
  CEntity *v32; // r0
  CMatrix *v33; // r0
  CSimpleTransform *v34; // r1
  __int64 v35; // d16
  float Red; // s16
  CMatrix *v37; // r0
  CSimpleTransform *v38; // r2
  __int64 v39; // d16
  float Green; // s16
  int v41; // r0
  int v42; // r0
  CMatrix *v43; // r1
  CSimpleTransform *v44; // r0
  CSimpleTransform *v45; // r4
  CMatrix *v46; // r1
  CSimpleTransform *v47; // r0
  float x; // s16
  float y; // s18
  float z; // s20
  float xx; // s26
  float yx; // s24
  float zx; // s22
  CMatrix *v54; // r0
  CMatrix *v55; // r1
  CSimpleTransform *v56; // r0
  CSimpleTransform *v57; // r1
  float32x2_t v58; // d16
  unsigned __int64 v59; // d1
  __int64 v60; // d16
  CMatrix *v61; // r1
  CSimpleTransform *v62; // r0
  CSimpleTransform *v63; // r1
  float32x2_t v64; // d16
  unsigned __int64 v65; // d1
  __int64 v66; // d16
  CVector Length; // [sp+0h] [bp-A0h] BYREF
  CVector pCoors; // [sp+48h] [bp-58h] BYREF

  v6 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
  v7 = (*((int (__fastcall **)(CBaseModelInfo *))v6->_vptr$CBaseModelInfo + 2))(v6);
  if ( v6->m_num2dEffects )
    CEntity::ProcessLightsForEntity(this);
  m_flags = v6->m_flags;
  if ( (m_flags & 1) == 0 )
  {
    v6->m_flags = m_flags | 1;
    v9 = v7 == 0;
    if ( v7 )
    {
      v1 = *(RpAtomic_0 **)(v7 + 52);
      v9 = v1 == 0;
    }
    if ( !v9 )
    {
      Effects = (RpGeometry_0 *)RpMatFXAtomicQueryEffects(v1);
      v11 = Effects == 0;
      if ( Effects )
      {
        Effects = v1->geometry;
        v11 = Effects == 0;
      }
      if ( !v11 )
        RpGeometryForAllMaterials(Effects, MaterialUpdateUVAnimCB, 0);
    }
    m_alpha = v6->m_alpha;
    if ( m_alpha > 0xEE )
      v13 = -1;
    else
      v13 = m_alpha + 16;
    v6->m_alpha = v13;
  }
  if ( (*((_BYTE *)&this->m_nFlags + 2) & 0x20) == 0 )
    return;
  if ( v7 )
  {
    v14 = 0;
    v15 = 0;
    v16 = *(_WORD *)(v7 + 40) & 0x7800;
    if ( v16 != 2048 )
      v14 = 1;
    if ( v16 == 4096 )
      v15 = 1;
    if ( v15 == v14 && ((*(_BYTE *)&this->m_info & 7) != 4 || ((int)this[5].m_pRwObject & 0x40) == 0) )
    {
      m_pMat = this->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &this->m_transform;
      p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        p_m_transform = &TheCamera.m_transform;
      v20.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.x, *(float32x2_t *)&p_tx->m_translate.x).n64_u64[0];
      v21.n64_u64[0] = vmul_f32(v20, v20).n64_u64[0];
      v3.n64_f32[0] = CObject::fDistToNearestTree;
      v21.n64_f32[0] = sqrtf(v21.n64_f32[0] + v21.n64_f32[1]);
      v2.n64_u64[0] = vmin_f32(v3, v21).n64_u64[0];
      CObject::fDistToNearestTree = v2.n64_f32[0];
      CEntity::ModifyMatrixForTreeInWind(this);
    }
  }
  v22 = *(_BYTE *)&this->m_info & 7;
  if ( v22 != 5 )
  {
    if ( v22 != 4 )
    {
      if ( v22 == 1 && v7 && (*(_WORD *)(v7 + 40) & 0x7800) == 18432 )
        CEntity::ModifyMatrixForCrane(this);
      return;
    }
    m_nModelIndex = this->m_nModelIndex;
    if ( m_nModelIndex == MI_COLLECTABLE1 )
    {
      CPickups::DoCollectableEffects(this);
LABEL_44:
      m_pRwObject = this->m_pRwObject;
      if ( m_pRwObject )
      {
        parent = (char *)m_pRwObject->parent;
        v26 = this->m_pMat;
        v27 = (RwMatrix *)(parent + 16);
        if ( v26 )
          CMatrix::UpdateRwMatrix(v26, v27);
        else
          CSimpleTransform::UpdateRwMatrix(&this->m_transform, v27);
        v28 = this->m_pRwObject;
        if ( v28 )
          RwFrameUpdateObjects((RwFrame_0 *)v28->parent);
      }
      goto LABEL_50;
    }
    if ( m_nModelIndex == MI_MONEY )
    {
      CPickups::DoMoneyEffects(this);
      goto LABEL_44;
    }
    if ( m_nModelIndex != MI_CARMINE && m_nModelIndex != MI_NAUTICALMINE && m_nModelIndex != MI_BRIEFCASE )
    {
      if ( (unsigned __int16)m_nModelIndex == 345 )
      {
        v33 = this->m_pMat;
        v34 = (CSimpleTransform *)&v33->tx;
        if ( !v33 )
          v34 = &this->m_transform;
        v35 = *(_QWORD *)&v34->m_translate.x;
        pCoors.z = v34->m_translate.z;
        *(_QWORD *)&pCoors.x = v35;
        Red = (float)(rand() & 0xF) * 0.0625;
        CShadows::StoreShadowToBeRendered(
          2u,
          gpShadowExplosionTex,
          &pCoors,
          8.0,
          0.0,
          0.0,
          -8.0,
          255,
          (unsigned int)(float)(Red * 200.0),
          (unsigned int)(float)(Red * 160.0),
          (unsigned int)(float)(Red * 120.0),
          20.0,
          0,
          1.0,
          0,
          0);
        memset(&Length, 0, sizeof(Length));
        CPointLights::AddLight(0, pCoors, Length, 8.0, Red, Red * 0.8, Red * 0.6, 0, 1, 0);
        CCoronas::RegisterCorona(
          (u_native)this,
          0,
          (unsigned int)(float)(Red * 255.0),
          (unsigned int)(float)(Red * 220.0),
          (unsigned int)(float)(Red * 190.0),
          0xFFu,
          &pCoors,
          Red * 6.0,
          300.0,
          gpCoronaTexture[0],
          0,
          1u,
          0,
          0,
          0.0,
          0,
          1.5,
          0,
          15.0,
          0,
          0);
        goto LABEL_50;
      }
      if ( m_nModelIndex == MI_FLARE )
      {
        v37 = this->m_pMat;
        v38 = (CSimpleTransform *)&v37->tx;
        if ( !v37 )
          v38 = &this->m_transform;
        v39 = *(_QWORD *)&v38->m_translate.x;
        pCoors.z = v38->m_translate.z;
        *(_QWORD *)&pCoors.x = v39;
        v4.n64_u32[0] = 0.5;
        v2.n64_f32[0] = (float)(rand() & 0xF) * 0.0625;
        Green = vmax_f32(v2, v4).n64_f32[0];
        CShadows::StoreShadowToBeRendered(
          2u,
          gpShadowExplosionTex,
          &pCoors,
          8.0,
          0.0,
          0.0,
          -8.0,
          255,
          (unsigned int)(float)(Green * 200.0),
          (unsigned int)(float)(Green * 200.0),
          (unsigned int)(float)(Green * 200.0),
          20.0,
          0,
          1.0,
          0,
          0);
        memset(&Length, 0, sizeof(Length));
        CPointLights::AddLight(0, pCoors, Length, 32.0, Green, Green, Green, 0, 1, 0);
        CCoronas::RegisterCorona(
          (u_native)this,
          0,
          (unsigned int)(float)(Green * 255.0),
          (unsigned int)(float)(Green * 255.0),
          (unsigned int)(float)(Green * 255.0),
          0xFFu,
          &pCoors,
          Green * 6.0,
          300.0,
          gpCoronaTexture[0],
          0,
          1u,
          0,
          0,
          0.0,
          0,
          1.5,
          0,
          15.0,
          0,
          0);
        goto LABEL_50;
      }
      v41 = (*((int (__fastcall **)(CBaseModelInfo *))CModelInfo::ms_modelInfoPtrs[m_nModelIndex]->_vptr$CBaseModelInfo
             + 2))(CModelInfo::ms_modelInfoPtrs[m_nModelIndex]);
      if ( v41 && (*(_WORD *)(v41 + 40) & 0x7000 | 0x800) == 10240 )
      {
        if ( (CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_flags & 0x7800) != 10240 )
        {
          CGlass::AskForObjectToBeRenderedInGlass(this);
          *(_DWORD *)&this->m_nFlags &= ~0x80u;
        }
        goto LABEL_50;
      }
      if ( !(LOBYTE(this[5].m_pRwObject) << 31) )
      {
        v42 = (unsigned __int16)this->m_nModelIndex;
        if ( v42 == 344 )
        {
          v45 = &this->m_transform;
          v46 = this->m_pMat;
          v47 = &this->m_transform;
          if ( v46 )
            v47 = (CSimpleTransform *)&v46->tx;
          if ( sqrtf(
                 (float)(this[1].m_transform.m_translate.z * this[1].m_transform.m_translate.z)
               + (float)(this[1].m_transform.m_heading * this[1].m_transform.m_heading)) > 0.03 )
          {
            x = v47->m_translate.x;
            y = v47->m_translate.y;
            z = v47->m_translate.z;
            xx = TheCamera.m_cameraMatrix.xx;
            yx = TheCamera.m_cameraMatrix.yx;
            zx = TheCamera.m_cameraMatrix.zx;
            if ( !CWaterLevel::GetWaterLevelNoWaves(v47->m_translate.x, y, z, &pCoors.x, 0, 0) )
              goto LABEL_99;
            v54 = this->m_pMat;
            if ( v54 )
              v45 = (CSimpleTransform *)&v54->tx;
            if ( v45->m_translate.z > pCoors.x )
LABEL_99:
              CMotionBlurStreaks::RegisterStreak(
                (u_native)this,
                0xFFu,
                0xA0u,
                0x64u,
                0xFFu,
                COERCE__DWORD_(x - (float)(xx * 0.07)),
                y - (float)(yx * 0.07),
                z - (float)(zx * 0.07),
                (float)(xx * 0.07) + x,
                (float)(yx * 0.07) + y);
          }
        }
        else if ( v42 == 342 )
        {
          v43 = this->m_pMat;
          v44 = (CSimpleTransform *)&v43->tx;
          if ( !v43 )
            v44 = &this->m_transform;
          if ( sqrtf(
                 (float)(this[1].m_transform.m_translate.z * this[1].m_transform.m_translate.z)
               + (float)(this[1].m_transform.m_heading * this[1].m_transform.m_heading)) > 0.03 )
            CMotionBlurStreaks::RegisterStreak(
              (u_native)this,
              0x64u,
              0x64u,
              0x64u,
              0xFFu,
              COERCE__DWORD_(v44->m_translate.x - (float)(TheCamera.m_cameraMatrix.xx * 0.07)),
              v44->m_translate.y - (float)(TheCamera.m_cameraMatrix.yx * 0.07),
              v44->m_translate.z - (float)(TheCamera.m_cameraMatrix.zx * 0.07),
              (float)(TheCamera.m_cameraMatrix.xx * 0.07) + v44->m_translate.x,
              (float)(TheCamera.m_cameraMatrix.yx * 0.07) + v44->m_translate.y);
        }
        else if ( (__int16)v42 == MI_BEACHBALL )
        {
          v55 = this->m_pMat;
          v56 = (CSimpleTransform *)&v55->tx;
          if ( !v55 )
            v56 = &this->m_transform;
          v57 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
          if ( !TheCamera.m_pMat )
            v57 = &TheCamera.m_transform;
          v58.n64_u64[0] = vsub_f32(*(float32x2_t *)&v57->m_translate.y, *(float32x2_t *)&v56->m_translate.y).n64_u64[0];
          v59 = vmul_f32(v58, v58).n64_u64[0];
          if ( sqrtf(
                 (float)((float)((float)(v57->m_translate.x - v56->m_translate.x)
                               * (float)(v57->m_translate.x - v56->m_translate.x))
                       + *(float *)&v59)
               + *((float *)&v59 + 1)) < 50.0 )
          {
            v60 = *(_QWORD *)&v56->m_translate.x;
            pCoors.z = v56->m_translate.z;
            *(_QWORD *)&pCoors.x = v60;
            CShadows::StoreShadowToBeRendered(
              1u,
              gpShadowPedTex,
              &pCoors,
              0.4,
              0.0,
              0.0,
              -0.4,
              CTimeCycle::m_CurrentColours.m_nShadowStrength,
              CTimeCycle::m_CurrentColours.m_nShadowStrength,
              CTimeCycle::m_CurrentColours.m_nShadowStrength,
              CTimeCycle::m_CurrentColours.m_nShadowStrength,
              20.0,
              0,
              1.0,
              0,
              0);
          }
        }
        else if ( (__int16)v42 == MI_MAGNOCRANE_HOOK
               || (__int16)v42 == MI_WRECKING_BALL
               || (__int16)v42 == MI_CRANE_MAGNET
               || (__int16)v42 == MI_MINI_MAGNET
               || (__int16)v42 == MI_CRANE_HARNESS )
        {
          v61 = this->m_pMat;
          v62 = (CSimpleTransform *)&v61->tx;
          if ( !v61 )
            v62 = &this->m_transform;
          v63 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
          if ( !TheCamera.m_pMat )
            v63 = &TheCamera.m_transform;
          v64.n64_u64[0] = vsub_f32(*(float32x2_t *)&v63->m_translate.y, *(float32x2_t *)&v62->m_translate.y).n64_u64[0];
          v65 = vmul_f32(v64, v64).n64_u64[0];
          if ( sqrtf(
                 (float)((float)((float)(v63->m_translate.x - v62->m_translate.x)
                               * (float)(v63->m_translate.x - v62->m_translate.x))
                       + *(float *)&v65)
               + *((float *)&v65 + 1)) < 110.0 )
          {
            v66 = *(_QWORD *)&v62->m_translate.x;
            pCoors.z = v62->m_translate.z;
            *(_QWORD *)&pCoors.x = v66;
            CShadows::StoreShadowToBeRendered(
              1u,
              gpShadowPedTex,
              &pCoors,
              2.0,
              0.0,
              0.0,
              -2.0,
              128,
              0x80u,
              0x80u,
              0x80u,
              50.0,
              0,
              1.0,
              0,
              0);
          }
        }
        else if ( (__int16)v42 == MI_WINDSOCK )
        {
          CEntity::BuildWindSockMatrix(this);
        }
        goto LABEL_50;
      }
      CPickups::DoPickUpEffects(this);
      goto LABEL_44;
    }
    if ( LOBYTE(this[5].m_pRwObject) << 31 )
    {
      CPickups::DoMineEffects(this);
      goto LABEL_44;
    }
  }
LABEL_50:
  v29 = this->m_nModelIndex;
  if ( v29 == MI_TRAFFICLIGHTS )
  {
    CTrafficLights::DisplayActualLight(this);
    *(_QWORD *)&Length.y = 1053609165LL;
    v30 = 1077755773;
    v31 = 1041663787;
LABEL_52:
    v32 = this;
LABEL_60:
    CShadows::StoreShadowForPole(v32, *(float *)&v30, *(float *)&v31, 0.0, 16.0, Length.y, LODWORD(Length.z));
    return;
  }
  if ( v29 == MI_TRAFFICLIGHTS_VERTICAL )
  {
LABEL_54:
    CTrafficLights::DisplayActualLight(this);
    return;
  }
  if ( v29 == MI_TRAFFICLIGHTS_MIAMI )
  {
    CTrafficLights::DisplayActualLight(this);
    *(_QWORD *)&Length.y = 1053609165LL;
    v30 = 1083829125;
LABEL_59:
    v32 = this;
    v31 = 0;
    goto LABEL_60;
  }
  if ( v29 == MI_TRAFFICLIGHTS_TWOVERTICAL )
  {
    CTrafficLights::DisplayActualLight(this);
    *(_QWORD *)&Length.y = 1053609165LL;
    v30 = 1089476755;
    goto LABEL_59;
  }
  if ( v29 == MI_TRAFFICLIGHTS_3
    || v29 == MI_TRAFFICLIGHTS_4
    || v29 == MI_TRAFFICLIGHTS_GAY
    || v29 == MI_TRAFFICLIGHTS_5 )
  {
    goto LABEL_54;
  }
  if ( v29 == MI_SINGLESTREETLIGHTS1 )
  {
    *(_QWORD *)&Length.y = 1053609165LL;
    v30 = 1061058249;
    goto LABEL_59;
  }
  if ( v29 == MI_SINGLESTREETLIGHTS2 )
  {
    *(_QWORD *)&Length.y = 1053609165LL;
    v30 = 1026564293;
    goto LABEL_59;
  }
  if ( v29 == MI_SINGLESTREETLIGHTS3 )
  {
    *(_QWORD *)&Length.y = 1053609165LL;
    v30 = 1066552787;
    v31 = 1041529569;
    goto LABEL_52;
  }
  if ( v29 == MI_DOUBLESTREETLIGHTS )
  {
    CShadows::StoreShadowForPole(this, 0.0, -0.048, 0.0, 16.0, 0.4, 0);
    return;
  }
  if ( v29 == MI_TRAFFICLIGHTS_VEGAS )
  {
    CTrafficLights::DisplayActualLight(this);
    *(_QWORD *)&Length.y = 1053609165LL;
    v30 = 1089470464;
    v31 = 1045220557;
    goto LABEL_52;
  }
}
// 3EC848: conditional instruction was optimized away because r0.4==4
// 3EC2DE: variable 'v1' is possibly undefined
// 3EC394: variable 'v3' is possibly undefined
// 3EC79C: variable 'v2' is possibly undefined
// 3EC79C: variable 'v4' is possibly undefined
// 678190: using guessed type __int16 *MI_BEACHBALL_ptr[2];

//----- (003ECDF0) --------------------------------------------------------
void __fastcall CEntity::ModifyMatrixForTreeInWind(CEntity *this)
{
  RwObject_0 *m_pRwObject; // r0
  float *parent; // r5
  float v4; // s16
  int *v5; // r1
  float v6; // s18
  float v7; // s0
  uint32 v8; // r0
  float v9; // s0
  float v10; // s2
  float v11; // s0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2
  RwObject_0 *v14; // r0

  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
  {
    m_pRwObject = this->m_pRwObject;
    if ( m_pRwObject )
    {
      parent = (float *)m_pRwObject->parent;
      v4 = CWeather::Wind;
      if ( CWeather::Wind >= 0.5 )
      {
        v8 = this->RandomSeed + 8 * CTimer::m_snTimeInMilliseconds;
        v9 = (float)((this->RandomSeed + 8 * (_WORD)CTimer::m_snTimeInMilliseconds) & 0xFFF) * 0.00024414;
        v7 = CWeather::Wind
           * (float)((float)((float)(WindTabel[((unsigned __int8)(v8 >> 12) + 1) & 0xF] * v9)
                           + (float)((float)(WindTabel[(unsigned __int16)v8 >> 12] * (float)(1.0 - v9)) + 1.0))
                   * 0.015);
      }
      else
      {
        v5 = dword_3ECF94;
        if ( CWeather::Wind < 0.2 )
          v5 = &dword_3ECF94[1];
        v6 = *(float *)v5;
        v7 = v6 * sinf((float)(((_WORD)CTimer::m_snTimeInMilliseconds + (_WORD)this) & 0xFFF) * 0.0015332);
      }
      parent[12] = v7;
      if ( (CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_flags & 0x7800) == 4096 )
      {
        v7 = v7 + (float)(v4 * 0.03);
        parent[12] = v7;
      }
      v10 = CWeather::WindDir.x * v7;
      v11 = CWeather::WindDir.y * v7;
      parent[12] = v10;
      parent[13] = v11;
      m_pMat = this->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &this->m_transform;
      CWindModifiers::FindWindModifier(p_tx->m_translate, parent + 12, parent + 13);
      v14 = this->m_pRwObject;
      if ( v14 )
        sub_1928A8((RwFrame_0 *)v14->parent);
    }
  }
}
// 3ECF94: using guessed type int dword_3ECF94[2];

//----- (003ECFA8) --------------------------------------------------------
void __fastcall CEntity::ModifyMatrixForCrane(CEntity *this)
{
  RwObject_0 *m_pRwObject; // r0
  RwObject_0 *v3; // r0
  CMatrix v4; // [sp+0h] [bp-50h] BYREF

  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
  {
    m_pRwObject = this->m_pRwObject;
    if ( m_pRwObject )
    {
      CMatrix::CMatrix(&v4, (RwMatrix *)((char *)m_pRwObject->parent + 16), 0);
      CMatrix::SetRotateZOnly(&v4, (float)(CTimer::m_snTimeInMilliseconds & 0x3FF) * 0.0061328);
      CMatrix::UpdateRW(&v4);
      v3 = this->m_pRwObject;
      if ( v3 )
        RwFrameUpdateObjects((RwFrame_0 *)v3->parent);
      CMatrix::~CMatrix(&v4);
    }
  }
}

//----- (003ED02C) --------------------------------------------------------
void __fastcall CEntity::PreRenderForGlassWindow(CEntity *this)
{
  if ( (CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_flags & 0x7800) != 10240 )
  {
    CGlass::AskForObjectToBeRenderedInGlass(this);
    *(_DWORD *)&this->m_nFlags &= ~0x80u;
  }
}

//----- (003ED064) --------------------------------------------------------
void __fastcall CEntity::BuildWindSockMatrix(CEntity *this)
{
  RwReal x; // r5
  RwReal y; // r9
  CMatrix *m_pMat; // r0
  RwReal z; // r8
  RwReal v6; // r6
  CMatrix *v7; // r0
  RwReal v8; // r6
  CMatrix *v9; // r0
  RwReal v10; // r6
  CMatrix *v11; // r0
  RwReal v12; // r6
  CMatrix *v13; // r0
  RwReal v14; // r6
  CMatrix *v15; // r0
  RwReal v16; // r6
  CMatrix *v17; // r0
  CMatrix *v18; // r0
  CMatrix *v19; // r0
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  CMatrix *v22; // r0
  RwMatrix *v23; // r1
  RwObject_0 *v24; // r0
  CVector v1; // [sp+4h] [bp-54h] BYREF
  CVector v26; // [sp+10h] [bp-48h] BYREF
  CVector v27; // [sp+20h] [bp-38h] BYREF
  CVector v28; // [sp+30h] [bp-28h] BYREF

  v28.z = 0.1;
  v28.x = -(float)(CWeather::WindDir.x + 0.01);
  v28.y = -(float)(CWeather::WindDir.y + 0.01);
  CVector::Normalise(&v28);
  v1.x = 0.0;
  v1.y = 0.0;
  v1.z = 1.0;
  CrossProduct(&v26, &v1, &v28);
  v27 = v26;
  CVector::Normalise(&v27);
  CrossProduct(&v26, &v28, &v27);
  x = v26.x;
  y = v26.y;
  m_pMat = this->m_pMat;
  z = v26.z;
  v6 = v27.x;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    m_pMat = this->m_pMat;
  }
  m_pMat->xx = v6;
  v7 = this->m_pMat;
  v8 = v27.y;
  if ( !v7 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v7 = this->m_pMat;
  }
  v7->yx = v8;
  v9 = this->m_pMat;
  v10 = v27.z;
  if ( !v9 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v9 = this->m_pMat;
  }
  v9->zx = v10;
  v11 = this->m_pMat;
  v12 = v28.x;
  if ( !v11 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v11 = this->m_pMat;
  }
  v11->xy = v12;
  v13 = this->m_pMat;
  v14 = v28.y;
  if ( !v13 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v13 = this->m_pMat;
  }
  v13->yy = v14;
  v15 = this->m_pMat;
  v16 = v28.z;
  if ( !v15 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v15 = this->m_pMat;
  }
  v15->zy = v16;
  v17 = this->m_pMat;
  if ( !v17 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v17 = this->m_pMat;
  }
  v17->xz = x;
  v18 = this->m_pMat;
  if ( !v18 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v18 = this->m_pMat;
  }
  v18->yz = y;
  v19 = this->m_pMat;
  if ( !v19 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v19 = this->m_pMat;
  }
  v19->zz = z;
  m_pRwObject = this->m_pRwObject;
  if ( m_pRwObject )
  {
    parent = (char *)m_pRwObject->parent;
    v22 = this->m_pMat;
    v23 = (RwMatrix *)(parent + 16);
    if ( v22 )
      CMatrix::UpdateRwMatrix(v22, v23);
    else
      CSimpleTransform::UpdateRwMatrix(&this->m_transform, v23);
    v24 = this->m_pRwObject;
    if ( v24 )
      RwFrameUpdateObjects((RwFrame_0 *)v24->parent);
  }
}

//----- (003ED1FC) --------------------------------------------------------
void __fastcall CEntity::RenderEffects(CEntity *this)
{
  CBaseModelInfo *v1; // r8
  int m_num2dEffects; // r6
  int32 v3; // r5
  C2dEffect *v4; // r0
  RpAtomic_0 *m_rsAtomic; // r0
  CSimpleTransform *p_tx; // r1

  if ( *((unsigned __int8 *)&this->m_nFlags + 3) << 31 )
  {
    v1 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
    m_num2dEffects = v1->m_num2dEffects;
    if ( v1->m_num2dEffects )
    {
      v3 = 0;
      do
      {
        v4 = CBaseModelInfo::Get2dEffect(v1, v3);
        if ( v4->m_type == 7 )
        {
          m_rsAtomic = v4->attr.rs.m_rsAtomic;
          p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
          if ( !TheCamera.m_pMat )
            p_tx = &TheCamera.m_transform;
          CCustomRoadsignMgr::RenderRoadsignAtomic(m_rsAtomic, &p_tx->m_translate);
        }
        ++v3;
      }
      while ( m_num2dEffects != v3 );
    }
  }
}

//----- (003ED25C) --------------------------------------------------------
void __fastcall CEntity::Render(CEntity *this)
{
  RwObject_0 *m_pRwObject; // r0
  int m_nModelIndex; // r0
  RwObject_0 *v4; // r0
  CBaseModelInfo *v5; // r10
  int m_num2dEffects; // r4
  int32 v7; // r6
  C2dEffect *v8; // r0
  RpAtomic_0 *m_rsAtomic; // r0
  CSimpleTransform *p_tx; // r1
  int v11; // r0
  void *value; // [sp+4h] [bp-1Ch] BYREF

  m_pRwObject = this->m_pRwObject;
  if ( m_pRwObject )
  {
    if ( m_pRwObject->type == 1 && CTagManager::IsTag(this) )
    {
      sub_1A0B78((RpAtomic_0 *)this->m_pRwObject);
    }
    else
    {
      value = 0;
      m_nModelIndex = this->m_nModelIndex;
      if ( m_nModelIndex == MI_JELLYFISH || m_nModelIndex == MI_JELLYFISH01 )
      {
        RwRenderStateGet(rwRENDERSTATEALPHATESTFUNCTIONREF, &value);
        RwRenderStateSet(rwRENDERSTATEALPHATESTFUNCTIONREF, 0);
      }
      v4 = this->m_pRwObject;
      *(_DWORD *)&this->m_nFlags |= 0x2000u;
      if ( v4->type == 1 )
        (*(void (**)(void))&v4[9].type)();
      else
        RpClumpRender((RpClump_0 *)v4);
      CStreaming::RenderEntity(this->m_pLastRenderedLink);
      if ( *((unsigned __int8 *)&this->m_nFlags + 3) << 31 )
      {
        v5 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
        m_num2dEffects = v5->m_num2dEffects;
        if ( v5->m_num2dEffects )
        {
          v7 = 0;
          do
          {
            v8 = CBaseModelInfo::Get2dEffect(v5, v7);
            if ( v8->m_type == 7 )
            {
              m_rsAtomic = v8->attr.rs.m_rsAtomic;
              p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
              if ( !TheCamera.m_pMat )
                p_tx = &TheCamera.m_transform;
              CCustomRoadsignMgr::RenderRoadsignAtomic(m_rsAtomic, &p_tx->m_translate);
            }
            ++v7;
          }
          while ( m_num2dEffects != v7 );
        }
      }
      v11 = this->m_nModelIndex;
      if ( v11 == MI_JELLYFISH || v11 == MI_JELLYFISH01 )
        RwRenderStateSet(rwRENDERSTATEALPHATESTFUNCTIONREF, value);
      *(_DWORD *)&this->m_nFlags &= ~0x2000u;
    }
  }
}

//----- (003ED388) --------------------------------------------------------
bool __fastcall CEntity::GetIsTouching(const CEntity *this, CEntity *pEntity)
{
  CMatrix *m_pMat; // r1
  CSphere *p_m_sphereBound; // r2
  __int64 v6; // d16
  CMatrix *v7; // r1
  CSphere *v8; // r2
  __int64 v9; // d16
  float32x2_t v10; // d16
  CColModel *m_pColModel; // r1
  unsigned __int64 v12; // d3
  float m_fRadius; // s4
  RwV3d_0 v15; // [sp+0h] [bp-48h] BYREF
  RwV3d_0 result; // [sp+10h] [bp-38h] BYREF
  CVector v; // [sp+20h] [bp-28h] BYREF
  CVector v18; // [sp+30h] [bp-18h] BYREF

  m_pMat = this->m_pMat;
  p_m_sphereBound = &CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound;
  if ( m_pMat )
  {
    v6 = *(_QWORD *)&p_m_sphereBound->m_vecCentre.x;
    v.z = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_vecCentre.z;
    *(_QWORD *)&v.x = v6;
    operator*(&v18, m_pMat, &v);
    result = v18.RwV3d_0;
  }
  else
  {
    TransformPoint(&result, &this->m_transform, &p_m_sphereBound->m_vecCentre);
  }
  v7 = pEntity->m_pMat;
  v8 = &CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex]->m_pColModel->m_sphereBound;
  if ( v7 )
  {
    v9 = *(_QWORD *)&v8->m_vecCentre.x;
    v.z = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex]->m_pColModel->m_sphereBound.m_vecCentre.z;
    *(_QWORD *)&v.x = v9;
    operator*(&v18, v7, &v);
    v15 = v18.RwV3d_0;
  }
  else
  {
    TransformPoint(&v15, &pEntity->m_transform, &v8->m_vecCentre);
  }
  v10.n64_u64[0] = vsub_f32(*(float32x2_t *)&result.y, *(float32x2_t *)&v15.y).n64_u64[0];
  m_pColModel = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex]->m_pColModel;
  v12 = vmul_f32(v10, v10).n64_u64[0];
  m_fRadius = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  return (float)((float)((float)((float)(result.x - v15.x) * (float)(result.x - v15.x)) + *(float *)&v12)
               + *((float *)&v12 + 1)) < (float)((float)(m_fRadius + m_pColModel->m_sphereBound.m_fRadius)
                                               * (float)(m_fRadius + m_pColModel->m_sphereBound.m_fRadius));
}

//----- (003ED48C) --------------------------------------------------------
bool __fastcall CEntity::GetIsTouching(const CEntity *this, const CVector *centre, float radius)
{
  CMatrix *m_pMat; // r1
  CSphere *p_m_sphereBound; // r2
  __int64 v8; // d16
  float y; // s8
  float z; // s10
  float m_fRadius; // s6
  RwV3d_0 v13; // [sp+0h] [bp-40h] BYREF
  CVector v; // [sp+10h] [bp-30h] BYREF
  CVector v15; // [sp+20h] [bp-20h] BYREF

  m_pMat = this->m_pMat;
  p_m_sphereBound = &CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound;
  if ( m_pMat )
  {
    v8 = *(_QWORD *)&p_m_sphereBound->m_vecCentre.x;
    v.z = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_vecCentre.z;
    *(_QWORD *)&v.x = v8;
    operator*(&v15, m_pMat, &v);
    v13 = v15.RwV3d_0;
  }
  else
  {
    TransformPoint(&v13, &this->m_transform, &p_m_sphereBound->m_vecCentre);
  }
  y = centre->y;
  z = centre->z;
  m_fRadius = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  v13.x = v13.x - centre->x;
  v13.y = v13.y - y;
  return (float)((float)((float)(v13.z - z) * (float)(v13.z - z))
               + (float)((float)(v13.x * v13.x) + (float)(v13.y * v13.y))) < (float)((float)(m_fRadius + radius)
                                                                                   * (float)(m_fRadius + radius));
}

//----- (003ED55C) --------------------------------------------------------
bool __fastcall CEntity::IsVisible(CEntity *this)
{
  CMatrix *m_pMat; // r1
  CSphere *p_m_sphereBound; // r2
  __int64 v5; // d16
  RwV3d_0 v6; // [sp+0h] [bp-38h] BYREF
  CVector v; // [sp+10h] [bp-28h] BYREF
  CVector v8; // [sp+20h] [bp-18h] BYREF

  if ( !this->m_pRwObject || (*(_BYTE *)&this->m_nFlags & 0x80) == 0 )
    return 0;
  m_pMat = this->m_pMat;
  p_m_sphereBound = &CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound;
  if ( m_pMat )
  {
    v5 = *(_QWORD *)&p_m_sphereBound->m_vecCentre.x;
    v.z = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_vecCentre.z;
    *(_QWORD *)&v.x = v5;
    operator*(&v8, m_pMat, &v);
    v6 = v8.RwV3d_0;
  }
  else
  {
    TransformPoint(&v6, &this->m_transform, &p_m_sphereBound->m_vecCentre);
  }
  return CCamera::IsSphereVisible(
           &TheCamera,
           (const CVector *)&v6,
           CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius);
}

//----- (003ED5E8) --------------------------------------------------------
bool __fastcall CEntity::GetIsBoundingBoxOnScreen(CEntity *this)
{
  CColModel *m_pColModel; // r0
  double v3; // d16
  double v4; // d16
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r8
  CMatrix *v7; // r1
  CMatrix *v8; // r1
  RwV3d_0 v10; // [sp+0h] [bp-B8h] BYREF
  CMatrix output; // [sp+10h] [bp-A8h] BYREF
  double v12; // [sp+58h] [bp-60h] BYREF
  RwReal z; // [sp+60h] [bp-58h]
  double v14; // [sp+64h] [bp-54h]
  RwReal v15; // [sp+6Ch] [bp-4Ch]
  RwV3d_0 v16; // [sp+70h] [bp-48h] BYREF
  RwV3d_0 pResult; // [sp+80h] [bp-38h] BYREF
  unsigned int v18; // [sp+8Ch] [bp-2Ch]
  unsigned int v19; // [sp+90h] [bp-28h]
  unsigned int v20; // [sp+94h] [bp-24h]
  CVector v; // [sp+98h] [bp-20h] BYREF

  m_pColModel = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
  v3 = *(double *)&m_pColModel->m_boxBound.m_vecMin.x;
  z = m_pColModel->m_boxBound.m_vecMin.z;
  v12 = v3;
  v4 = *(double *)&m_pColModel->m_boxBound.m_vecMax.x;
  v15 = m_pColModel->m_boxBound.m_vecMax.z;
  v14 = v4;
  m_pMat = this->m_pMat;
  if ( m_pMat )
  {
    output.m_pRwMat = 0;
    output.m_owner = 0;
    Invert(m_pMat, &output);
    TransformVectors(&pResult, 2, &output, TheCamera.m_vecFrustumWorldNormals);
    CMatrix::~CMatrix(&output);
    p_m_transform = &this->m_transform;
  }
  else
  {
    p_m_transform = &this->m_transform;
    memset(&output, 0, 16);
    CSimpleTransform::Invert((CSimpleTransform *)&output, &this->m_transform);
    TransformVectors(&pResult, 2, (const CSimpleTransform *)&output, TheCamera.m_vecFrustumWorldNormals);
  }
  v16.x = *((RwReal *)&v12 + 3 * (LODWORD(pResult.x) >> 31));
  v16.y = *((RwReal *)&v12 + 3 * (LODWORD(pResult.y) >> 31) + 1);
  v16.z = *((RwReal *)&v12 + 3 * (LODWORD(pResult.z) >> 31) + 2);
  v7 = this->m_pMat;
  if ( v7 )
  {
    v = (CVector)v16;
    operator*((CVector *)&output, v7, &v);
    v10.z = output.zx;
    *(_QWORD *)&v10.x = *(_QWORD *)&output.xx;
  }
  else
  {
    TransformPoint(&v10, p_m_transform, &v16);
  }
  v16 = v10;
  if ( (float)((float)((float)(TheCamera.m_vecFrustumWorldNormals[0].x * v10.x)
                     + (float)(TheCamera.m_vecFrustumWorldNormals[0].y * v10.y))
             + (float)(TheCamera.m_vecFrustumWorldNormals[0].z * v10.z)) <= TheCamera.m_fFrustumPlaneOffsets[0]
    || TheCamera.m_bMirrorActive
    && (float)((float)((float)(v10.x * TheCamera.m_vecFrustumWorldNormals_Mirror[0].x)
                     + (float)(v10.y * TheCamera.m_vecFrustumWorldNormals_Mirror[0].y))
             + (float)(v10.z * TheCamera.m_vecFrustumWorldNormals_Mirror[0].z)) <= TheCamera.m_fFrustumPlaneOffsets_Mirror[0] )
  {
    v16.x = *((RwReal *)&v12 + 3 * (v18 >> 31));
    v16.y = *((RwReal *)&v12 + 3 * (v19 >> 31) + 1);
    v16.z = *((RwReal *)&v12 + 3 * (v20 >> 31) + 2);
    v8 = this->m_pMat;
    if ( v8 )
    {
      v = (CVector)v16;
      operator*((CVector *)&output, v8, &v);
      v10.z = output.zx;
      *(_QWORD *)&v10.x = *(_QWORD *)&output.xx;
    }
    else
    {
      TransformPoint(&v10, p_m_transform, &v16);
    }
    v16 = v10;
    if ( (float)((float)((float)(TheCamera.m_vecFrustumWorldNormals[1].x * v10.x)
                       + (float)(TheCamera.m_vecFrustumWorldNormals[1].y * v10.y))
               + (float)(TheCamera.m_vecFrustumWorldNormals[1].z * v10.z)) <= TheCamera.m_fFrustumPlaneOffsets[1]
      || TheCamera.m_bMirrorActive
      && (float)((float)((float)(v10.x * TheCamera.m_vecFrustumWorldNormals_Mirror[1].x)
                       + (float)(v10.y * TheCamera.m_vecFrustumWorldNormals_Mirror[1].y))
               + (float)(v10.z * TheCamera.m_vecFrustumWorldNormals_Mirror[1].z)) <= TheCamera.m_fFrustumPlaneOffsets_Mirror[1] )
    {
      return 1;
    }
  }
  ++numBBfailed;
  return 0;
}

//----- (003ED8D8) --------------------------------------------------------
void __fastcall CEntity::Add(CEntity *this)
{
  _BYTE v2[24]; // [sp+0h] [bp-18h] BYREF

  (*((void (__fastcall **)(_BYTE *, CEntity *))this->_vptr$CPlaceable + 10))(v2, this);
  (*((void (__fastcall **)(CEntity *, _BYTE *))this->_vptr$CPlaceable + 3))(this, v2);
}

//----- (003ED8FC) --------------------------------------------------------
void __fastcall CEntity::Add(CEntity *this, const CRect *unclippedRect)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d2
  float32x2_t v4; // d4
  float top; // s16
  float right; // s18
  float v8; // s20
  float v9; // s0
  float v10; // r8
  float v11; // r6
  float v12; // r5
  int v13; // s0
  int v14; // r0
  int v15; // r8
  int v16; // r4
  int v17; // r11
  CPtrNode *v18; // r0
  int v19; // r1
  int v20; // r1
  CRepeatSector *p_m_dummyPtrListArray; // r10
  CSector *v22; // r0
  int v23; // r0
  CPtrNode *v24; // r0
  bool v25; // cc
  int v26; // r2
  int v27; // s0
  int v28; // s2
  int v29; // r8
  int v30; // r10
  CPtrListSingleLink *v31; // r6
  int v32; // r4
  CPtrNode *v33; // r0
  int v34; // [sp+0h] [bp-68h]
  int v35; // [sp+4h] [bp-64h]
  int v36; // [sp+8h] [bp-60h]

  top = unclippedRect->top;
  right = 2999.0;
  v2.n64_u32[0] = LODWORD(unclippedRect->left);
  v3.n64_u32[0] = LODWORD(unclippedRect->bottom);
  v4.n64_u32[0] = -985956352;
  LODWORD(v8) = vmax_f32(v3, v4).n64_u32[0];
  LODWORD(v9) = vmax_f32(v2, v4).n64_u32[0];
  if ( top > 3000.0 )
    top = 2999.0;
  if ( unclippedRect->right < 3000.0 )
    right = unclippedRect->right;
  if ( *((unsigned __int8 *)&this->m_nFlags + 1) << 31 )
  {
    v28 = (int)(float)((float)(v9 / 200.0) + 15.0);
    v29 = (int)(float)((float)(top / 200.0) + 15.0);
    v30 = (int)(float)((float)(v8 / 200.0) + 15.0);
    if ( v30 <= v29 )
    {
      v27 = (int)(float)((float)(right / 200.0) + 15.0);
      v31 = &CWorld::ms_aLodPtrLists[30 * v30];
      do
      {
        v32 = v28;
        if ( v28 <= v27 )
        {
          do
          {
            v33 = (CPtrNode *)CPtrNodeSingleLink::operator new(8u);
            v33->m_pVoid = this;
            v25 = v32 < v27;
            v33->m_pNext = (CPtrNode *)v31[v32];
            v31[v32++].m_pHead = v33;
          }
          while ( v25 );
        }
        v31 += 30;
        v25 = v30++ < v29;
      }
      while ( v25 );
    }
  }
  else
  {
    v10 = floorf((float)(v9 / 50.0) + 60.0);
    v11 = floorf((float)(v8 / 50.0) + 60.0);
    v12 = floorf((float)(right / 50.0) + 60.0);
    v34 = (int)floorf((float)(top / 50.0) + 60.0);
    v36 = (int)v11;
    if ( (int)v11 <= v34 )
    {
      v13 = (int)v12;
      v35 = (int)v10;
      do
      {
        if ( v35 <= v13 )
        {
          v14 = 0;
          if ( v36 > 0 )
            v14 = v36;
          if ( v14 >= 119 )
            v14 = 119;
          v15 = v35;
          v16 = 120 * v14;
          v17 = (unsigned __int8)(16 * v36);
          do
          {
            switch ( *(_BYTE *)&this->m_info & 7 )
            {
              case 1:
                v18 = (CPtrNode *)CPtrNodeSingleLink::operator new(8u);
                v19 = 0;
                v18->m_pVoid = this;
                if ( v15 > 0 )
                  v19 = v15;
                if ( v19 >= 119 )
                  v19 = 119;
                v20 = v19 + v16;
                v18->m_pNext = CWorld::ms_aSectors[v20].m_buildingPtrListArray.m_pHead;
                CWorld::ms_aSectors[v20].m_buildingPtrListArray.m_pHead = v18;
                goto LABEL_33;
              case 2:
                p_m_dummyPtrListArray = &CWorld::ms_aRepeatSectors[v15 & 0xF | v17];
                break;
              case 3:
                v22 = (CSector *)&CWorld::ms_aRepeatSectors[v15 & 0xF | v17];
                goto LABEL_29;
              case 4:
                p_m_dummyPtrListArray = (CRepeatSector *)&CWorld::ms_aRepeatSectors[v15 & 0xF | v17].m_ptrListArray[2];
                break;
              case 5:
                v23 = 0;
                if ( v15 > 0 )
                  v23 = v15;
                if ( v23 >= 119 )
                  v23 = 119;
                v22 = &CWorld::ms_aSectors[v23 + v16];
LABEL_29:
                p_m_dummyPtrListArray = (CRepeatSector *)&v22->m_dummyPtrListArray;
                break;
              default:
                p_m_dummyPtrListArray = 0;
                break;
            }
            v24 = (CPtrNode *)CPtrNodeDoubleLink::operator new(0xCu);
            v24->m_pVoid = this;
            v24[1].m_pVoid = 0;
            v24->m_pNext = p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead;
            if ( p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead )
              p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead[1].m_pVoid = v24;
            p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead = v24;
LABEL_33:
            v25 = v15++ < v13;
          }
          while ( v25 );
        }
        v26 = v36++;
      }
      while ( v26 < v34 );
    }
  }
}
// 3ED936: variable 'v3' is possibly undefined
// 3ED936: variable 'v4' is possibly undefined
// 3ED93A: variable 'v2' is possibly undefined

//----- (003EDBE8) --------------------------------------------------------
void __fastcall CEntity::Remove(CEntity *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  float v5; // s16
  float v6; // s18
  float v7; // s20
  float v8; // s0
  float v9; // r8
  float v10; // r6
  float v11; // r5
  int v12; // s0
  int v13; // r10
  int v14; // r0
  int v15; // r9
  int v16; // r11
  int v17; // r0
  int v18; // r8
  int v19; // r0
  int v20; // r1
  CPtrNode *v21; // r2
  CPtrNode *v22; // r3
  CPtrNode *v23; // r6
  CPtrNode *v24; // r0
  CRepeatSector *p_m_dummyPtrListArray; // r1
  CSector *v26; // r0
  int v27; // r0
  CPtrNode *v28; // r0
  _DWORD *m_pVoid; // r1
  CPtrNode *m_pNext; // r1
  bool v31; // cc
  int v32; // s0
  int v33; // s2
  int v34; // r10
  int v35; // r8
  int v36; // r0
  int v37; // r9
  int v38; // r1
  CPtrNode *m_pHead; // r2
  CPtrNode *v40; // r3
  CPtrNode *v41; // r6
  CPtrNode *v42; // r0
  int v43; // [sp+4h] [bp-74h]
  int v44; // [sp+8h] [bp-70h]
  int v45; // [sp+14h] [bp-64h]
  float v46; // [sp+20h] [bp-58h] BYREF
  float v47; // [sp+24h] [bp-54h]
  float v48; // [sp+28h] [bp-50h]
  float v49; // [sp+2Ch] [bp-4Ch]

  (*((void (__fastcall **)(float *, CEntity *))this->_vptr$CPlaceable + 10))(&v46, this);
  v5 = v47;
  v6 = 2999.0;
  v1.n64_f32[0] = v46;
  v3.n64_f32[0] = v49;
  if ( v47 > 3000.0 )
    v5 = 2999.0;
  if ( v48 < 3000.0 )
    v6 = v48;
  v2.n64_u32[0] = -985956352;
  LODWORD(v7) = vmax_f32(v3, v2).n64_u32[0];
  LODWORD(v8) = vmax_f32(v1, v2).n64_u32[0];
  if ( *((unsigned __int8 *)&this->m_nFlags + 1) << 31 )
  {
    v33 = (int)(float)((float)(v8 / 200.0) + 15.0);
    v34 = (int)(float)((float)(v7 / 200.0) + 15.0);
    v45 = (int)(float)((float)(v5 / 200.0) + 15.0);
    if ( v34 <= v45 )
    {
      v32 = (int)(float)((float)(v6 / 200.0) + 15.0);
      do
      {
        if ( v33 <= v32 )
        {
          v35 = 30 * v34;
          v36 = v33;
          do
          {
            v37 = v36;
            v38 = v36 + v35;
            m_pHead = CWorld::ms_aLodPtrLists[v36 + v35].m_pHead;
            if ( m_pHead )
            {
              v40 = 0;
              v41 = CWorld::ms_aLodPtrLists[v36 + v35].m_pHead;
              while ( 1 )
              {
                v42 = v41;
                if ( v41->m_pVoid == this )
                  break;
                v41 = v41->m_pNext;
                v40 = v42;
                if ( !v41 )
                  goto LABEL_69;
              }
              if ( m_pHead == v41 )
              {
                CWorld::ms_aLodPtrLists[v38] = (CPtrListSingleLink)m_pHead->m_pNext;
              }
              else if ( v40 )
              {
                v40->m_pNext = v41->m_pNext;
              }
              CPtrNodeSingleLink::operator delete(v41);
            }
LABEL_69:
            v36 = v37 + 1;
          }
          while ( v37 < v32 );
        }
        v31 = v34++ < v45;
      }
      while ( v31 );
    }
  }
  else
  {
    v9 = floorf((float)(v8 / 50.0) + 60.0);
    v10 = floorf((float)(v7 / 50.0) + 60.0);
    v11 = floorf((float)(v6 / 50.0) + 60.0);
    v13 = (int)v10;
    v43 = (int)floorf((float)(v5 / 50.0) + 60.0);
    if ( (int)v10 <= v43 )
    {
      v12 = (int)v11;
      v44 = (int)v9;
      do
      {
        if ( v44 <= v12 )
        {
          v14 = 0;
          if ( v13 > 0 )
            v14 = v13;
          if ( v14 >= 119 )
            v14 = 119;
          v15 = 120 * v14;
          v16 = (unsigned __int8)(16 * v13);
          v17 = v44;
          do
          {
            v18 = v17;
            switch ( *(_BYTE *)&this->m_info & 7 )
            {
              case 1:
                v19 = 0;
                if ( v18 > 0 )
                  v19 = v18;
                if ( v19 >= 119 )
                  v19 = 119;
                v20 = v19 + v15;
                v21 = CWorld::ms_aSectors[v19 + v15].m_buildingPtrListArray.m_pHead;
                if ( !v21 )
                  goto LABEL_51;
                v22 = 0;
                v23 = CWorld::ms_aSectors[v20].m_buildingPtrListArray.m_pHead;
                while ( 1 )
                {
                  v24 = v23;
                  if ( v23->m_pVoid == this )
                    break;
                  v23 = v23->m_pNext;
                  v22 = v24;
                  if ( !v23 )
                    goto LABEL_51;
                }
                if ( v21 == v23 )
                {
                  CWorld::ms_aSectors[v20].m_buildingPtrListArray.m_pHead = v21->m_pNext;
                  CPtrNodeSingleLink::operator delete(v23);
                }
                else
                {
                  if ( v22 )
                    v22->m_pNext = v23->m_pNext;
                  CPtrNodeSingleLink::operator delete(v23);
                }
                goto LABEL_51;
              case 2:
                p_m_dummyPtrListArray = &CWorld::ms_aRepeatSectors[v17 & 0xF | v16];
                goto LABEL_39;
              case 3:
                v26 = (CSector *)&CWorld::ms_aRepeatSectors[v17 & 0xF | v16];
                goto LABEL_38;
              case 4:
                p_m_dummyPtrListArray = (CRepeatSector *)&CWorld::ms_aRepeatSectors[v17 & 0xF | v16].m_ptrListArray[2];
                goto LABEL_39;
              case 5:
                v27 = 0;
                if ( v18 > 0 )
                  v27 = v18;
                if ( v27 >= 119 )
                  v27 = 119;
                v26 = &CWorld::ms_aSectors[v27 + v15];
LABEL_38:
                p_m_dummyPtrListArray = (CRepeatSector *)&v26->m_dummyPtrListArray;
                goto LABEL_39;
              default:
                p_m_dummyPtrListArray = 0;
LABEL_39:
                if ( !p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead )
                  goto LABEL_51;
                v28 = p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead;
                break;
            }
            while ( v28->m_pVoid != this )
            {
              v28 = v28->m_pNext;
              if ( !v28 )
                goto LABEL_51;
            }
            if ( p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead == v28 )
              p_m_dummyPtrListArray->m_ptrListArray[0].m_pHead = v28->m_pNext;
            m_pVoid = v28[1].m_pVoid;
            if ( m_pVoid )
              m_pVoid[1] = v28->m_pNext;
            m_pNext = v28->m_pNext;
            if ( m_pNext )
              m_pNext[1].m_pVoid = v28[1].m_pVoid;
            CPtrNodeDoubleLink::operator delete(v28);
LABEL_51:
            v17 = v18 + 1;
          }
          while ( v18 < v12 );
        }
        v31 = v13++ < v43;
      }
      while ( v31 );
    }
  }
}
// 3EDC3E: variable 'v3' is possibly undefined
// 3EDC3E: variable 'v2' is possibly undefined
// 3EDC42: variable 'v1' is possibly undefined

//----- (003EDF5C) --------------------------------------------------------
bool __fastcall CEntity::LivesInThisNonOverlapSector(CEntity *this, Int32 x, Int32 y)
{
  unsigned __int64 v3; // r4
  float v4; // s16
  float v5; // s18
  float v6; // r6
  float v8[18]; // [sp+0h] [bp-48h] BYREF

  v3 = __PAIR64__(y, x);
  (*((void (__fastcall **)(float *))this->_vptr$CPlaceable + 10))(v8);
  v4 = v8[1];
  v5 = v8[3];
  v6 = floorf((float)((float)((float)(v8[0] + v8[2]) * 0.5) / 50.0) + 60.0);
  return v3 == __PAIR64__((int)floorf((float)((float)((float)(v5 + v4) * 0.5) / 50.0) + 60.0), (int)v6);
}

//----- (003EE000) --------------------------------------------------------
float __fastcall CEntity::GetDistanceFromCentreOfMassToBaseOfModel(CEntity *this)
{
  int m_pRwObject_high; // r1
  CColModel *m_pColModel; // r0
  float result; // r0

  if ( (*(_BYTE *)&this->m_info & 7) == 2 && (m_pRwObject_high = SHIBYTE(this[19].m_pRwObject), m_pRwObject_high >= 0) )
    m_pColModel = &CVehicle::m_aSpecialColModel[m_pRwObject_high];
  else
    m_pColModel = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
  LODWORD(result) = LODWORD(m_pColModel->m_boxBound.m_vecMin.z) ^ 0x80000000;
  return result;
}

//----- (003EE044) --------------------------------------------------------
CColModel *__fastcall CEntity::GetColModel(CEntity *this)
{
  int m_pRwObject_high; // r1

  if ( (*(_BYTE *)&this->m_info & 7) == 2 && (m_pRwObject_high = SHIBYTE(this[19].m_pRwObject), m_pRwObject_high >= 0) )
    return &CVehicle::m_aSpecialColModel[m_pRwObject_high];
  else
    return CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
}

//----- (003EE084) --------------------------------------------------------
void __fastcall CEntity::SetupBigBuilding(CEntity *this)
{
  int m_nModelIndex; // r1

  m_nModelIndex = this->m_nModelIndex;
  *(_DWORD *)&this->m_nFlags = *(_DWORD *)&this->m_nFlags & 0xFFFEFEFE | 0x10100;
  CModelInfo::ms_modelInfoPtrs[m_nModelIndex]->m_flags |= 0x20u;
}

//----- (003EE0BC) --------------------------------------------------------
void __fastcall CEntity::ModifyMatrixForBannerInWind(CEntity *this)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r1
  unsigned int v4; // r1
  float v5; // s0
  float *v6; // r6
  float v7; // s12
  int *v8; // r1
  float v9; // s0
  float v10; // s8
  float v11; // s0
  float v12; // s8
  float v13; // s0
  float v14; // s6
  float v15; // s16
  float v16; // s18
  const CVector *p_xy; // r6
  CMatrix *v18; // r0
  CMatrix *v19; // r0
  RwReal x; // r5
  CMatrix *v21; // r0
  RwReal y; // r5
  CMatrix *v23; // r0
  RwReal z; // r5
  CMatrix *v25; // r0
  RwReal v26; // r5
  CMatrix *v27; // r0
  RwReal v28; // r5
  CMatrix *v29; // r0
  RwReal v30; // r5
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  CMatrix *v33; // r0
  RwMatrix *v34; // r1
  RwObject_0 *v35; // r0
  CVector v36; // [sp+0h] [bp-48h] BYREF
  CVector v2; // [sp+Ch] [bp-3Ch] BYREF
  CVector v38; // [sp+18h] [bp-30h] BYREF

  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
  {
    m_pMat = this->m_pMat;
    p_m_transform = &this->m_transform;
    if ( m_pMat )
      p_m_transform = (CSimpleTransform *)&m_pMat->tx;
    v4 = ((unsigned int)(float)(p_m_transform->m_translate.x + p_m_transform->m_translate.y) << 10)
       + 16 * CTimer::m_snTimeInMilliseconds;
    v5 = (float)(v4 & 0x7F0);
    v6 = &BannerWindTabel[((unsigned __int8)(v4 >> 11) + 1) & 0x1F];
    v7 = BannerWindTabel[(unsigned __int16)v4 >> 11];
    v8 = dword_3EE318;
    v9 = v5 * 0.00048828;
    v10 = 1.0 - v9;
    v11 = *v6 * v9;
    v12 = v7 * v10;
    if ( CWeather::Wind < 0.8 )
      v8 = &dword_3EE318[1];
    v13 = v11 + v12;
    v14 = *(float *)v8;
    if ( CWeather::Wind < 0.1 )
      v14 = 0.2;
    v15 = v14 * v13;
    v16 = sqrtf(1.0 - (float)(v15 * v15));
    if ( m_pMat )
    {
      p_xy = (const CVector *)&m_pMat->xy;
    }
    else
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      m_pMat = this->m_pMat;
      p_xy = (const CVector *)&m_pMat->xy;
      if ( !m_pMat )
      {
        CPlaceable::AllocateMatrix(this);
        CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
        m_pMat = this->m_pMat;
      }
    }
    CrossProduct(&v38, p_xy, (const CVector *)&m_pMat->xz);
    v38.z = 0.0;
    CVector::Normalise(&v38);
    v2.z = v16;
    v2.x = v15 * v38.x;
    v2.y = v15 * v38.y;
    v18 = this->m_pMat;
    if ( !v18 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v18 = this->m_pMat;
    }
    CrossProduct(&v36, (const CVector *)&v18->xy, &v2);
    v38 = v36;
    v19 = this->m_pMat;
    x = v36.x;
    if ( !v19 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v19 = this->m_pMat;
    }
    v19->xx = x;
    v21 = this->m_pMat;
    y = v38.y;
    if ( !v21 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v21 = this->m_pMat;
    }
    v21->yx = y;
    v23 = this->m_pMat;
    z = v38.z;
    if ( !v23 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v23 = this->m_pMat;
    }
    v23->zx = z;
    v25 = this->m_pMat;
    v26 = v2.x;
    if ( !v25 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v25 = this->m_pMat;
    }
    v25->xz = v26;
    v27 = this->m_pMat;
    v28 = v2.y;
    if ( !v27 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v27 = this->m_pMat;
    }
    v27->yz = v28;
    v29 = this->m_pMat;
    v30 = v2.z;
    if ( !v29 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v29 = this->m_pMat;
    }
    v29->zz = v30;
    m_pRwObject = this->m_pRwObject;
    if ( m_pRwObject )
    {
      parent = (char *)m_pRwObject->parent;
      v33 = this->m_pMat;
      v34 = (RwMatrix *)(parent + 16);
      if ( v33 )
        CMatrix::UpdateRwMatrix(v33, v34);
      else
        CSimpleTransform::UpdateRwMatrix(&this->m_transform, v34);
      v35 = this->m_pRwObject;
      if ( v35 )
        RwFrameUpdateObjects((RwFrame_0 *)v35->parent);
    }
  }
}
// 3EE318: using guessed type int dword_3EE318[2];

//----- (003EE324) --------------------------------------------------------
void __fastcall CEntity::SetRwObjectAlpha(CEntity *this, int32 nAlpha)
{
  RpClump_0 *m_pRwObject; // r0
  int type; // r1
  RpGeometry_0 *next; // r0

  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  if ( m_pRwObject )
  {
    type = m_pRwObject->object.type;
    if ( type == 2 )
    {
      sub_18E410(m_pRwObject, SetAtomicAlpha, (void *)nAlpha);
    }
    else if ( type == 1 )
    {
      next = (RpGeometry_0 *)m_pRwObject->cameraList.link.next;
      next->flags |= 0x40u;
      sub_198134(next, SetCompAlphaCB, (void *)nAlpha);
    }
  }
}

//----- (003EE35C) --------------------------------------------------------
RpAtomic_0 *__fastcall SetAtomicAlpha(RpAtomic_0 *pAtomic, void *data)
{
  RpGeometry_0 *geometry; // r0

  geometry = pAtomic->geometry;
  geometry->flags |= 0x40u;
  RpGeometryForAllMaterials(geometry, SetCompAlphaCB, data);
  return pAtomic;
}

//----- (003EE380) --------------------------------------------------------
bool __fastcall IsEntityPointerValid(CEntity *pEntity)
{
  bool result; // r0

  if ( !pEntity )
    return 0;
  switch ( *(_BYTE *)&pEntity->m_info & 7 )
  {
    case 1:
      result = sub_193D54((CBuilding *)pEntity);
      break;
    case 2:
      result = sub_1959A4((CVehicle *)pEntity);
      break;
    case 3:
      result = sub_19C144((CPed *)pEntity);
      break;
    case 4:
      result = sub_190EE8((CObject *)pEntity);
      break;
    case 5:
      result = sub_199F64((CDummy *)pEntity);
      break;
    case 6:
      result = 1;
      break;
    default:
      return 0;
  }
  return result;
}

//----- (003EE3B8) --------------------------------------------------------
CVector *__fastcall CEntity::FindTriggerPointCoors(CVector *retstr, CEntity *this, Int32 ArgIndex)
{
  CBaseModelInfo *v6; // r4
  int32 m_num2dEffects; // r11
  int32 v8; // r6
  C2dEffect *v9; // r5
  int m_type; // r0
  bool v11; // zf
  CVector *result; // r0
  CMatrix *m_pMat; // r1

  v6 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
  m_num2dEffects = v6->m_num2dEffects;
  if ( v6->m_num2dEffects )
  {
    v8 = 0;
    while ( 1 )
    {
      v9 = CBaseModelInfo::Get2dEffect(v6, v8);
      m_type = v9->m_type;
      v11 = m_type == 8;
      if ( m_type == 8 )
        v11 = v9->attr.t.Index == ArgIndex;
      if ( v11 )
        break;
      if ( ++v8 >= m_num2dEffects )
        goto LABEL_7;
    }
    m_pMat = this->m_pMat;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      m_pMat = this->m_pMat;
    }
    return operator*(retstr, m_pMat, &v9->m_posn);
  }
  else
  {
LABEL_7:
    result = 0;
    retstr->x = 0.0;
    retstr->y = 0.0;
    retstr->z = 0.0;
  }
  return result;
}

//----- (003EE43C) --------------------------------------------------------
void __fastcall CEntity::CalculateBBProjection(
        CEntity *this,
        CVector *pPoint1,
        CVector *pPoint2,
        CVector *pPoint3,
        float *a5)
{
  float32x2_t v5; // d1
  float32x2_t v6; // d2
  float32x2_t v7; // d3
  float32x2_t v8; // d4
  float32x2_t v9; // d5
  CMatrix *m_pMat; // r0
  float xx; // s16
  float v16; // s16
  float yx; // s18
  float v18; // s16
  float xy; // s18
  float v20; // s18
  float yy; // s20
  float v22; // s16
  float v23; // s18
  float xz; // s20
  float v25; // s20
  float yz; // s22
  CColModel *m_pColModel; // r1
  float v28; // s0
  float v29; // s20
  float v30; // s22
  float v31; // s8
  float v32; // s16
  float v33; // s2
  float v34; // s0
  float v35; // s2
  float v36; // s18
  float v37; // s18
  CSimpleTransform *p_m_transform; // r5
  float v39; // r6
  CSimpleTransform *p_tx; // r1
  float x; // s28
  float y; // s26
  float z; // s30
  float v44; // s25
  CMatrix *v45; // r0
  float v46; // s19
  float v47; // s18
  float v48; // s23
  float v49; // s22
  float v50; // s18
  float v51; // s18
  float v52; // s24
  float v53; // s22
  float v54; // s22
  float v55; // s20
  float v56; // s24
  float v57; // s24
  float v58; // s29
  float v59; // s27
  float v60; // s0
  float *p_xz; // r0
  float v62; // s4
  float v63; // s2
  float v64; // s8
  float v65; // s6
  float v66; // s10
  float v67; // s14
  float v68; // s8
  float v69; // s2
  float v70; // s12
  float v71; // s1
  float v72; // s14
  float v73; // s9
  float v74; // s3
  float v75; // s6
  float v76; // s10
  float v77; // s4
  float v78; // s12
  float v79; // s0
  CMatrix *v80; // r0
  RwReal v81; // r0
  float v82; // s18
  float v83; // s0
  float v84; // s0
  float v85; // s0
  float v86; // r6
  CSimpleTransform *v87; // r1
  float v88; // s28
  float v89; // s26
  float v90; // s30
  float v91; // s25
  CMatrix *v92; // r0
  float v93; // s19
  float v94; // s18
  float v95; // s20
  float v96; // s24
  float v97; // s18
  float v98; // r6
  CSimpleTransform *v99; // r1
  float v100; // s28
  float v101; // s26
  float v102; // s30
  float v103; // s25
  CMatrix *v104; // r0
  float v105; // s19
  float v106; // s18
  float v107; // s16
  float v108; // s24
  float v109; // s18
  float v110; // s21
  float v111; // s24
  float v112; // s21
  float v113; // s24
  float v114; // s17
  float v115; // s24
  float v116; // s17
  float v117; // s24
  float v118; // s0
  float v119; // s0
  float v120; // s0
  float v121; // s0
  float v122; // s0
  float v123; // s0
  CVector v124; // [sp+4h] [bp-6Ch] BYREF

  m_pMat = this->m_pMat;
  if ( m_pMat )
  {
    xx = m_pMat->xx;
LABEL_4:
    v16 = xx * xx;
LABEL_5:
    yx = m_pMat->yx;
    goto LABEL_6;
  }
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  xx = m_pMat->xx;
  if ( m_pMat )
    goto LABEL_4;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  v16 = xx * m_pMat->xx;
  if ( m_pMat )
    goto LABEL_5;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  yx = m_pMat->yx;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    m_pMat = this->m_pMat;
  }
LABEL_6:
  v18 = v16 + (float)(yx * m_pMat->yx);
  if ( m_pMat )
  {
    xy = m_pMat->xy;
LABEL_9:
    v20 = xy * xy;
LABEL_10:
    yy = m_pMat->yy;
    goto LABEL_11;
  }
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  xy = m_pMat->xy;
  if ( m_pMat )
    goto LABEL_9;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  v20 = xy * m_pMat->xy;
  if ( m_pMat )
    goto LABEL_10;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  yy = m_pMat->yy;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    m_pMat = this->m_pMat;
  }
LABEL_11:
  v22 = sqrtf(v18);
  v23 = sqrtf(v20 + (float)(yy * m_pMat->yy));
  if ( m_pMat )
  {
    xz = m_pMat->xz;
LABEL_14:
    v25 = xz * xz;
LABEL_15:
    yz = m_pMat->yz;
    goto LABEL_16;
  }
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  xz = m_pMat->xz;
  if ( m_pMat )
    goto LABEL_14;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  v25 = xz * m_pMat->xz;
  if ( m_pMat )
    goto LABEL_15;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  m_pMat = this->m_pMat;
  yz = m_pMat->yz;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    m_pMat = this->m_pMat;
  }
LABEL_16:
  m_pColModel = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
  v28 = sqrtf(v25 + (float)(yz * m_pMat->yz));
  v6.n64_f32[0] = -m_pColModel->m_boxBound.m_vecMin.y;
  v9.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMax.y);
  v5.n64_f32[0] = -m_pColModel->m_boxBound.m_vecMin.x;
  v8.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMax.x);
  v7.n64_f32[0] = -m_pColModel->m_boxBound.m_vecMin.z;
  v29 = vmax_f32(v9, v6).n64_f32[0];
  v30 = vmax_f32(v8, v5).n64_f32[0];
  v5.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMax.z);
  v31 = v22 * v30;
  v32 = vmax_f32(v5, v7).n64_f32[0];
  v33 = v28 * v32;
  v34 = (float)(v23 * v29) + (float)(v23 * v29);
  v35 = v33 + v33;
  if ( (float)(v31 + v31) > v34 )
  {
    if ( m_pMat )
    {
      v36 = m_pMat->xx;
    }
    else
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      m_pMat = this->m_pMat;
      v36 = m_pMat->xx;
      if ( !m_pMat )
      {
        CPlaceable::AllocateMatrix(this);
        CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
        m_pMat = this->m_pMat;
      }
    }
    p_m_transform = &this->m_transform;
    v39 = m_pMat->yx;
    v124.y = v39;
    v124.x = v36;
    v124.z = 0.0;
    p_tx = &this->m_transform;
    if ( m_pMat )
      p_tx = (CSimpleTransform *)&m_pMat->tx;
    x = p_tx->m_translate.x;
    y = p_tx->m_translate.y;
    z = p_tx->m_translate.z;
    CVector::Normalise(&v124);
    v44 = v30 * v36;
    v45 = this->m_pMat;
    v46 = v30 * 0.0;
    v47 = v124.y;
    v48 = v30 * v39;
    if ( v45 )
    {
      v49 = v124.x;
      v50 = v124.y * v45->yy;
    }
    else
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v45 = this->m_pMat;
      v49 = v124.x;
      v50 = v47 * v45->yy;
      if ( !v45 )
      {
        CPlaceable::AllocateMatrix(this);
        CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
        v45 = this->m_pMat;
        v83 = v49 * v45->xy;
        v49 = v124.x;
        v51 = v29 * (float)(v50 + v83);
        if ( !v45 )
        {
          CPlaceable::AllocateMatrix(this);
          CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
          v45 = this->m_pMat;
          v52 = v124.y;
          v53 = v49 * v45->yy;
          if ( !v45 )
          {
            CPlaceable::AllocateMatrix(this);
            CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
            v45 = this->m_pMat;
            v84 = v52 * v45->xy;
            v52 = v124.y;
            v54 = v29 * (float)(v53 - v84);
            if ( !v45 )
            {
              CPlaceable::AllocateMatrix(this);
              CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
              v45 = this->m_pMat;
              v55 = v124.x;
              v56 = v52 * v45->yz;
              if ( !v45 )
              {
                CPlaceable::AllocateMatrix(this);
                CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
                v45 = this->m_pMat;
                v85 = v55 * v45->xz;
                v55 = v124.x;
                v57 = v32 * (float)(v56 + v85);
                if ( !v45 )
                {
                  CPlaceable::AllocateMatrix(this);
                  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
                  v45 = this->m_pMat;
                  v58 = v124.y;
                  v59 = v55 * v45->yz;
                  if ( !v45 )
                  {
                    CPlaceable::AllocateMatrix(this);
                    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
                    v45 = this->m_pMat;
                  }
                  goto LABEL_35;
                }
LABEL_34:
                v58 = v124.y;
                v59 = v55 * v45->yz;
LABEL_35:
                v60 = x - v44;
                p_xz = &v45->xz;
                v62 = v44 + x;
                v63 = z - v46;
                v64 = v46 + z;
                v65 = y - v48;
                v66 = v48 + y;
                goto LABEL_36;
              }
LABEL_33:
              v57 = v32 * (float)(v56 + (float)(v55 * v45->xz));
              goto LABEL_34;
            }
LABEL_32:
            v55 = v124.x;
            v56 = v52 * v45->yz;
            goto LABEL_33;
          }
LABEL_31:
          v54 = v29 * (float)(v53 - (float)(v52 * v45->xy));
          goto LABEL_32;
        }
LABEL_30:
        v52 = v124.y;
        v53 = v49 * v45->yy;
        goto LABEL_31;
      }
    }
    v51 = v29 * (float)(v50 + (float)(v49 * v45->xy));
    goto LABEL_30;
  }
  if ( v34 > v35 )
  {
    if ( m_pMat )
    {
      v37 = m_pMat->xy;
    }
    else
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      m_pMat = this->m_pMat;
      v37 = m_pMat->xy;
      if ( !m_pMat )
      {
        CPlaceable::AllocateMatrix(this);
        CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
        m_pMat = this->m_pMat;
      }
    }
    p_m_transform = &this->m_transform;
    v86 = m_pMat->yy;
    v124.y = v86;
    v124.x = v37;
    v124.z = 0.0;
    v87 = &this->m_transform;
    if ( m_pMat )
      v87 = (CSimpleTransform *)&m_pMat->tx;
    v88 = v87->m_translate.x;
    v89 = v87->m_translate.y;
    v90 = v87->m_translate.z;
    CVector::Normalise(&v124);
    v91 = v29 * v37;
    v92 = this->m_pMat;
    v93 = v29 * 0.0;
    v94 = v124.y;
    v95 = v29 * v86;
    if ( v92 )
    {
      v96 = v124.x;
      v97 = v124.y * v92->yx;
    }
    else
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v92 = this->m_pMat;
      v96 = v124.x;
      v97 = v94 * v92->yx;
      if ( !v92 )
      {
        CPlaceable::AllocateMatrix(this);
        CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
        v92 = this->m_pMat;
        v118 = v96 * v92->xx;
        v96 = v124.x;
        v51 = v30 * (float)(v97 + v118);
        if ( !v92 )
        {
          CPlaceable::AllocateMatrix(this);
          CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
          v92 = this->m_pMat;
          v110 = v96 * v92->yx;
          v111 = v124.y;
          if ( !v92 )
          {
            CPlaceable::AllocateMatrix(this);
            CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
            v92 = this->m_pMat;
            v119 = v111 * v92->xx;
            v111 = v124.y;
            v54 = v30 * (float)(v110 - v119);
            if ( !v92 )
            {
              CPlaceable::AllocateMatrix(this);
              CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
              v92 = this->m_pMat;
              v112 = v124.x;
              v113 = v111 * v92->yz;
              if ( !v92 )
              {
                CPlaceable::AllocateMatrix(this);
                CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
                v92 = this->m_pMat;
                v120 = v112 * v92->xz;
                v112 = v124.x;
                v57 = v32 * (float)(v113 + v120);
                if ( !v92 )
                {
                  CPlaceable::AllocateMatrix(this);
                  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
                  v92 = this->m_pMat;
                  v58 = v124.y;
                  v59 = v112 * v92->yz;
                  if ( !v92 )
                  {
                    CPlaceable::AllocateMatrix(this);
                    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
                    v92 = this->m_pMat;
                  }
                  goto LABEL_76;
                }
LABEL_75:
                v58 = v124.y;
                v59 = v112 * v92->yz;
LABEL_76:
                v60 = v88 - v91;
                p_xz = &v92->xz;
                v62 = v91 + v88;
                v63 = v90 - v93;
                v64 = v93 + v90;
                v65 = v89 - v95;
                v66 = v95 + v89;
                goto LABEL_36;
              }
LABEL_74:
              v57 = v32 * (float)(v113 + (float)(v112 * v92->xz));
              goto LABEL_75;
            }
LABEL_73:
            v112 = v124.x;
            v113 = v111 * v92->yz;
            goto LABEL_74;
          }
LABEL_72:
          v54 = v30 * (float)(v110 - (float)(v111 * v92->xx));
          goto LABEL_73;
        }
LABEL_71:
        v110 = v96 * v92->yx;
        v111 = v124.y;
        goto LABEL_72;
      }
    }
    v51 = v30 * (float)(v97 + (float)(v96 * v92->xx));
    goto LABEL_71;
  }
  if ( m_pMat )
  {
    v82 = m_pMat->xz;
  }
  else
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    m_pMat = this->m_pMat;
    v82 = m_pMat->xz;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      m_pMat = this->m_pMat;
    }
  }
  p_m_transform = &this->m_transform;
  v98 = m_pMat->yz;
  v124.y = v98;
  v124.x = v82;
  v124.z = 0.0;
  v99 = &this->m_transform;
  if ( m_pMat )
    v99 = (CSimpleTransform *)&m_pMat->tx;
  v100 = v99->m_translate.x;
  v101 = v99->m_translate.y;
  v102 = v99->m_translate.z;
  CVector::Normalise(&v124);
  v103 = v32 * v82;
  v104 = this->m_pMat;
  v105 = v32 * 0.0;
  v106 = v124.y;
  v107 = v32 * v98;
  if ( v104 )
  {
    v108 = v124.x;
    v109 = v124.y * v104->yx;
LABEL_78:
    v51 = v30 * (float)(v109 + (float)(v108 * v104->xx));
LABEL_79:
    v114 = v108 * v104->yx;
    v115 = v124.y;
LABEL_80:
    v54 = v30 * (float)(v114 - (float)(v115 * v104->xx));
LABEL_81:
    v116 = v124.x;
    v117 = v115 * v104->yy;
LABEL_82:
    v57 = v29 * (float)(v117 + (float)(v116 * v104->xy));
    goto LABEL_83;
  }
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  v104 = this->m_pMat;
  v108 = v124.x;
  v109 = v106 * v104->yx;
  if ( v104 )
    goto LABEL_78;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  v104 = this->m_pMat;
  v121 = v108 * v104->xx;
  v108 = v124.x;
  v51 = v30 * (float)(v109 + v121);
  if ( v104 )
    goto LABEL_79;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  v104 = this->m_pMat;
  v114 = v108 * v104->yx;
  v115 = v124.y;
  if ( v104 )
    goto LABEL_80;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  v104 = this->m_pMat;
  v122 = v115 * v104->xx;
  v115 = v124.y;
  v54 = v30 * (float)(v114 - v122);
  if ( v104 )
    goto LABEL_81;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  v104 = this->m_pMat;
  v116 = v124.x;
  v117 = v115 * v104->yy;
  if ( v104 )
    goto LABEL_82;
  CPlaceable::AllocateMatrix(this);
  CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
  v104 = this->m_pMat;
  v123 = v116 * v104->xy;
  v116 = v124.x;
  v57 = v29 * (float)(v117 + v123);
  if ( !v104 )
  {
    CPlaceable::AllocateMatrix(this);
    CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
    v104 = this->m_pMat;
    v58 = v124.y;
    v59 = v116 * v104->yy;
    if ( !v104 )
    {
      CPlaceable::AllocateMatrix(this);
      CSimpleTransform::UpdateMatrix(&this->m_transform, this->m_pMat);
      v104 = this->m_pMat;
    }
    goto LABEL_84;
  }
LABEL_83:
  v58 = v124.y;
  v59 = v116 * v104->yy;
LABEL_84:
  v60 = v100 - v103;
  p_xz = &v104->xy;
  v62 = v103 + v100;
  v63 = v102 - v105;
  v64 = v105 + v102;
  v65 = v101 - v107;
  v66 = v107 + v101;
  v32 = v29;
LABEL_36:
  v67 = fabsf(v57) + fabsf(v51);
  v68 = v64 + (float)(v67 * v124.z);
  v69 = v63 - (float)(v67 * v124.z);
  v70 = fabsf(v54) + fabsf(v32 * (float)(v59 - (float)(v58 * *p_xz)));
  v71 = v124.y * v67;
  v72 = v124.x * v67;
  v73 = v70 * 0.0;
  v74 = v124.x * v70;
  v75 = v65 - v71;
  v76 = v66 + v71;
  v77 = v62 + v72;
  v78 = v124.y * v70;
  v79 = v60 - v72;
  pPoint1->x = v77 - v78;
  pPoint1->y = v76 + v74;
  pPoint1->z = v68 - v73;
  pPoint2->x = v78 + v77;
  pPoint2->y = v76 - v74;
  pPoint2->z = v73 + v68;
  pPoint3->x = v78 + v79;
  pPoint3->y = v75 - v74;
  pPoint3->z = v73 + v69;
  *a5 = v79 - v78;
  a5[1] = v74 + v75;
  a5[2] = v69 - v73;
  v80 = this->m_pMat;
  if ( v80 )
    p_m_transform = (CSimpleTransform *)&v80->tx;
  v81 = p_m_transform->m_translate.z;
  a5[2] = v81;
  pPoint3->z = v81;
  pPoint2->z = v81;
  pPoint1->z = v81;
}
// 3EE544: variable 'v9' is possibly undefined
// 3EE544: variable 'v6' is possibly undefined
// 3EE548: variable 'v8' is possibly undefined
// 3EE548: variable 'v5' is possibly undefined
// 3EE558: variable 'v7' is possibly undefined

//----- (003EEDA4) --------------------------------------------------------
C2dEffect *__fastcall CEntity::GetRandom2dEffect(CEntity *this, int32 effectType, bool8 mustBeFree)
{
  int v5; // r9
  CBaseModelInfo *v6; // r6
  int32 v7; // r4
  int v8; // r11
  C2dEffect *v9; // r5
  const CPedAttractorManager *PedAttractorManager; // r0
  _BOOL4 HasEmptySlot; // r0
  _DWORD v13[39]; // [sp+4h] [bp-9Ch]

  v5 = mustBeFree;
  v6 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex];
  if ( !v6->m_num2dEffects )
    return 0;
  v7 = 0;
  v8 = 0;
  do
  {
    v9 = CBaseModelInfo::Get2dEffect(v6, v7);
    if ( v9->m_type != effectType )
      goto LABEL_10;
    if ( v5 )
    {
      PedAttractorManager = GetPedAttractorManager();
      HasEmptySlot = CPedAttractorManager::HasEmptySlot(PedAttractorManager, v9, this);
      if ( v8 <= 31 && HasEmptySlot )
LABEL_9:
        v13[v8++] = v9;
    }
    else if ( v8 <= 31 )
    {
      goto LABEL_9;
    }
LABEL_10:
    ++v7;
  }
  while ( v7 < v6->m_num2dEffects );
  if ( v8 )
    return (C2dEffect *)v13[(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)v8)];
  return 0;
}
// 3EEDA4: using guessed type _DWORD var_9C[39];

//----- (003EEE64) --------------------------------------------------------
RpMaterial_0 *__fastcall SetCompAlphaCB(RpMaterial_0 *pMaterial, void *pData)
{
  pMaterial->color._anon_0._anon_0.alpha = (unsigned __int8)pData;
  return pMaterial;
}

//----- (003EEE68) --------------------------------------------------------
void *__fastcall CEntryInfoNode::operator new(size_t nSize)
{
  int v1; // lr
  CEntryInfoNodePool *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEntryInfoNodePool;
  result = (void *)CPools::ms_pEntryInfoNodePool->m_nFreeIndex;
  m_nSize = (void *)CPools::ms_pEntryInfoNodePool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (003EEECC) --------------------------------------------------------
void __fastcall CEntryInfoNode::operator delete(void *pVoid)
{
  CEntryInfoNodePool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEntryInfoNodePool;
  v2 = -858993459 * ((signed int)((int)pVoid - (unsigned int)CPools::ms_pEntryInfoNodePool->m_aStorage) >> 2);
  CPools::ms_pEntryInfoNodePool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (003EEEFC) --------------------------------------------------------
void __fastcall CEntryInfoList::Flush(CEntryInfoList *this)
{
  CEntryInfoNode *m_pHead; // r1
  CEntryInfoNode *i; // r3
  CEntryInfoNode *m_pNext; // r2
  CEntryInfoNode *m_pPrevious; // r1
  CEntryInfoNode *v5; // r1
  CEntryInfoNodePool *v6; // r1
  int v7; // r3

  m_pHead = this->m_pHead;
  if ( this->m_pHead )
  {
    for ( i = this->m_pHead; ; i = m_pNext )
    {
      m_pNext = i->m_pNext;
      if ( m_pHead == i )
        this->m_pHead = m_pNext;
      m_pPrevious = i->m_pPrevious;
      if ( m_pPrevious )
        m_pPrevious->m_pNext = i->m_pNext;
      v5 = i->m_pNext;
      if ( v5 )
        v5->m_pPrevious = i->m_pPrevious;
      v6 = CPools::ms_pEntryInfoNodePool;
      v7 = -858993459 * (((char *)i - (char *)CPools::ms_pEntryInfoNodePool->m_aStorage) >> 2);
      CPools::ms_pEntryInfoNodePool->m_aFlags[v7] |= 0x80u;
      if ( v7 < v6->m_nFreeIndex )
        v6->m_nFreeIndex = v7;
      if ( !m_pNext )
        break;
      m_pHead = this->m_pHead;
    }
  }
}

//----- (003EEF64) --------------------------------------------------------
unsigned __int8 *__fastcall CFileLoader::LoadLine(u_native fid)
{
  unsigned __int8 *result; // r0
  unsigned __int8 v2; // r2
  unsigned __int8 *v3; // r0
  int v4; // t1
  char v5; // t1

  if ( !CFileMgr::ReadLine(fid, CFileLoader::ms_line, 512) )
    return 0;
  CheckForPump();
  v2 = CFileLoader::ms_line[0];
  if ( CFileLoader::ms_line[0] )
  {
    v3 = &CFileLoader::ms_line[1];
    do
    {
      if ( v2 < 0x20u )
      {
        *(v3 - 1) = 32;
      }
      else if ( v2 == 44 )
      {
        *(v3 - 1) = 32;
      }
      v4 = *v3++;
      v2 = v4;
    }
    while ( v4 );
  }
  result = (unsigned __int8 *)&numBBfailed + 3;
  do
    v5 = *++result;
  while ( (unsigned __int8)(v5 - 1) < 0x20u );
  return result;
}

//----- (003EEFD8) --------------------------------------------------------
unsigned __int8 *__fastcall CFileLoader::LoadLine(uint8 **ppData, int32 *size)
{
  uint8 v2; // r2
  uint8 *v3; // r12
  int *i; // lr
  uint8 v5; // t1
  unsigned int v6; // r3
  bool v7; // zf
  unsigned __int8 *result; // r0
  char v10; // t1

  if ( *size < 1 )
    return 0;
  v2 = **ppData;
  if ( !v2 )
    return 0;
  v3 = *ppData + 1;
  for ( i = PC_Scratch; ; i = (int *)((char *)i + 1) )
  {
    v6 = v2;
    v7 = v2 == 0;
    if ( v2 )
      v7 = v2 == 10;
    if ( v7 )
      break;
    if ( v2 == 44 )
      v2 = 32;
    if ( v6 < 0x20 )
      v2 = 32;
    *(_BYTE *)i = v2;
    if ( (*size)-- < 2 )
    {
      i = (int *)((char *)i + 1);
      goto LABEL_16;
    }
    v5 = *v3++;
    v2 = v5;
  }
  --v3;
LABEL_16:
  *ppData = v3 + 1;
  *(_BYTE *)i = 0;
  result = (unsigned __int8 *)&algn_A887BF;
  do
    v10 = *++result;
  while ( (unsigned __int8)(v10 - 1) < 0x20u );
  return result;
}
// A887BF: using guessed type char;

//----- (003EF064) --------------------------------------------------------
RpClump_0 *__fastcall CFileLoader::LoadAtomicFile2Return(const unsigned __int8 *pFilename)
{
  RwStream_0 *v1; // r4
  RpClump_0 *v2; // r5

  v1 = RwStreamOpen(rwSTREAMFILENAME, rwSTREAMREAD, pFilename);
  v2 = 0;
  if ( RwStreamFindChunk(v1, 0x10u, 0, 0) )
    v2 = RpClumpStreamRead(v1);
  RwStreamClose(v1, 0);
  return v2;
}

//----- (003EF096) --------------------------------------------------------
void __fastcall GetNameAndDamage(const unsigned __int8 *pName, unsigned __int8 *pObjName, bool *bIsDamageModel)
{
  size_t v6; // r0
  size_t v7; // r4
  size_t v8; // r6
  int v9; // r2
  int v10; // r1
  bool v11; // zf
  const unsigned __int8 *v12; // r0
  int v13; // r1
  bool v14; // zf
  const unsigned __int8 *v15; // r0
  int v16; // r1
  bool v17; // zf

  v6 = strlen((const char *)pName);
  v7 = v6 - 3;
  v8 = v6 - 4;
  v9 = pName[v6 - 4];
  v10 = pName[v6 - 3];
  v11 = v9 == 95;
  if ( v9 == 95 )
    v11 = v10 == 100;
  if ( v11 )
  {
    v12 = &pName[v6];
    v13 = *(v12 - 2);
    v14 = v13 == 97;
    if ( v13 == 97 )
      v14 = *(v12 - 1) == 109;
    if ( v14 )
    {
      *bIsDamageModel = 1;
      strncpy((char *)pObjName, (const char *)pName, v8);
      pObjName[v8] = 0;
      return;
    }
    goto LABEL_14;
  }
  if ( v10 != 95 )
    goto LABEL_14;
  v15 = &pName[v6];
  v16 = *(v15 - 2) | 0x20;
  v17 = v16 == 108;
  if ( v16 == 108 )
    v17 = *(v15 - 1) == 48;
  if ( !v17 )
  {
LABEL_14:
    *bIsDamageModel = 0;
    sub_19B9DC((char *)pObjName, (const char *)pName);
    return;
  }
  *bIsDamageModel = 0;
  strncpy((char *)pObjName, (const char *)pName, v7);
  pObjName[v7] = 0;
}

//----- (003EF130) --------------------------------------------------------
RpAtomic_0 *__fastcall CFileLoader::SetRelatedModelInfoCB(RpAtomic_0 *pAtomic, void *data)
{
  int v4; // r6
  const unsigned __int8 *FrameNodeName; // r0
  CDamageAtomicModelInfo *v6; // r0
  RwFrame_0 *v7; // r0
  bool bIsDamageModel; // [sp+6h] [bp-2Ah] BYREF
  unsigned __int8 pObjName[8]; // [sp+7h] [bp-29h] BYREF

  v4 = (*((int (__fastcall **)(CBaseModelInfo *))CModelInfo::ms_modelInfoPtrs[gpRelatedModelInfoIndex]->_vptr$CBaseModelInfo
        + 2))(CModelInfo::ms_modelInfoPtrs[gpRelatedModelInfoIndex]);
  FrameNodeName = GetFrameNodeName((RwFrame_0 *)pAtomic->object.object.parent);
  GetNameAndDamage(FrameNodeName, pObjName, &bIsDamageModel);
  CVisibilityPlugins::SetAtomicRenderCallback(pAtomic, 0);
  if ( bIsDamageModel )
  {
    v6 = (CDamageAtomicModelInfo *)(*(int (__fastcall **)(int))(*(_DWORD *)v4 + 12))(v4);
    CDamageAtomicModelInfo::SetDamagedAtomic(v6, pAtomic);
  }
  else
  {
    (*(void (__fastcall **)(int, RpAtomic_0 *))(*(_DWORD *)v4 + 64))(v4, pAtomic);
  }
  RpClumpRemoveAtomic((RpClump_0 *)data, pAtomic);
  v7 = RwFrameCreate();
  RpAtomicSetFrame(pAtomic, v7);
  CVisibilityPlugins::SetModelInfoIndex(pAtomic, gpRelatedModelInfoIndex);
  return pAtomic;
}
// 3EF130: using guessed type unsigned __int8 pObjName[8];

//----- (003EF1EC) --------------------------------------------------------
bool __fastcall CFileLoader::LoadAtomicFile(RwStream_0 *pStream, uint32 index)
{
  int v4; // r0
  int v5; // r4
  int v6; // r8
  RpClump_0 *v7; // r0
  RpClump_0 *v8; // r6
  int v9; // r0

  v4 = (*((int (__fastcall **)(CBaseModelInfo *))CModelInfo::ms_modelInfoPtrs[index]->_vptr$CBaseModelInfo + 2))(CModelInfo::ms_modelInfoPtrs[index]);
  v5 = v4;
  if ( v4 && *(__int16 *)(v4 + 40) <= -1 )
  {
    CVehicleModelInfo::UseCommonVehicleTexDicationary();
    v6 = 1;
  }
  else
  {
    v6 = 0;
  }
  if ( !RwStreamFindChunk(pStream, 0x10u, 0, 0) )
    goto LABEL_8;
  v7 = RpClumpStreamRead(pStream);
  v8 = v7;
  if ( v7 )
  {
    gpRelatedModelInfoIndex = index;
    RpClumpForAllAtomics(v7, CFileLoader::SetRelatedModelInfoCB, v7);
    RpClumpDestroy(v8);
LABEL_8:
    v9 = *(_DWORD *)(v5 + 52);
    if ( v9 )
    {
      LOBYTE(v9) = 1;
      if ( v6 == 1 )
      {
        CVehicleModelInfo::StopUsingCommonVehicleTexDicationary();
        LOBYTE(v9) = 1;
      }
    }
    return v9;
  }
  if ( v6 == 1 )
    CVehicleModelInfo::StopUsingCommonVehicleTexDicationary();
  LOBYTE(v9) = 0;
  return v9;
}

//----- (003EF290) --------------------------------------------------------
bool __fastcall CFileLoader::LoadClumpFile(RwStream_0 *pStream, uint32 index)
{
  CBaseModelInfo *v4; // r8
  int v5; // r6
  bool v6; // r4
  RpClump_0 *v7; // r4
  RpClump_0 *v8; // r10
  RwFrame_0 *v9; // r4
  RpClump_0 *v10; // r0
  RpClump_0 *v11; // r6
  RwFrame_0 *v12; // r0

  v4 = CModelInfo::ms_modelInfoPtrs[index];
  v5 = (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 5))(v4);
  if ( (v4->m_flags & 0x200) != 0 )
  {
    v8 = RpClumpCreate();
    v9 = RwFrameCreate();
    v8->object.parent = v9;
    while ( RwStreamFindChunk(pStream, 0x10u, 0, 0) )
    {
      v10 = RpClumpStreamRead(pStream);
      v11 = v10;
      if ( !v10 )
        return 0;
      v12 = _rwFrameCloneAndLinkClones((RwFrame_0 *)v10->object.parent);
      RwFrameAddChild(v9, v12);
      RpClumpForAllAtomics(v11, ClumpAtomicCloneAndAttach, v8);
      RpClumpDestroy(v11);
    }
    (*((void (__fastcall **)(CBaseModelInfo *, RpClump_0 *))v4->_vptr$CBaseModelInfo + 17))(v4, v8);
    return 1;
  }
  v6 = 0;
  if ( RwStreamFindChunk(pStream, 0x10u, 0, 0) )
  {
    if ( v5 == 6 )
    {
      CCollisionPlugin::SetModelInfo((CClumpModelInfo *)v4);
      CVehicleModelInfo::UseCommonVehicleTexDicationary();
      v7 = RpClumpStreamRead(pStream);
      CCollisionPlugin::SetModelInfo(0);
      CVehicleModelInfo::StopUsingCommonVehicleTexDicationary();
      if ( !v7 )
        return 0;
    }
    else
    {
      v7 = RpClumpStreamRead(pStream);
      if ( !v7 )
        return 0;
    }
    (*((void (__fastcall **)(CBaseModelInfo *, RpClump_0 *))v4->_vptr$CBaseModelInfo + 17))(v4, v7);
    if ( index == 508 )
      LOBYTE(v4[1].m_pColModel) = 2;
    return 1;
  }
  return v6;
}

//----- (003EF394) --------------------------------------------------------
RpAtomic_0 *__fastcall ClumpAtomicCloneAndAttach(RpAtomic_0 *atomic, void *pData)
{
  RpAtomic_0 *v4; // r6

  v4 = RpAtomicClone(atomic);
  RpAtomicSetFrame(v4, *((RwFrame_0 **)atomic->object.object.parent + 40));
  RpClumpAddAtomic((RpClump_0 *)pData, v4);
  return atomic;
}

//----- (003EF3C4) --------------------------------------------------------
bool __fastcall CFileLoader::StartLoadClumpFile(RwStream_0 *pStream, uint32 index)
{
  int v3; // r5
  bool v4; // r4

  v3 = (*((int (__fastcall **)(CBaseModelInfo *))CModelInfo::ms_modelInfoPtrs[index]->_vptr$CBaseModelInfo + 5))(CModelInfo::ms_modelInfoPtrs[index]);
  if ( !RwStreamFindChunk(pStream, 0x10u, 0, 0) )
    return 0;
  if ( v3 != 6 )
    return sub_18BEB4(pStream);
  CVehicleModelInfo::UseCommonVehicleTexDicationary();
  v4 = RpClumpGtaStreamRead1(pStream);
  CVehicleModelInfo::StopUsingCommonVehicleTexDicationary();
  return v4;
}

//----- (003EF414) --------------------------------------------------------
bool __fastcall CFileLoader::FinishLoadClumpFile(RwStream_0 *pStream, uint32 index)
{
  RpClump_0 *v4; // r5

  if ( (*((int (__fastcall **)(CBaseModelInfo *))CModelInfo::ms_modelInfoPtrs[index]->_vptr$CBaseModelInfo + 5))(CModelInfo::ms_modelInfoPtrs[index]) == 6 )
  {
    CVehicleModelInfo::UseCommonVehicleTexDicationary();
    v4 = RpClumpGtaStreamRead2(pStream);
    CVehicleModelInfo::StopUsingCommonVehicleTexDicationary();
    if ( v4 )
    {
LABEL_3:
      (*((void (__fastcall **)(CBaseModelInfo *, RpClump_0 *))CModelInfo::ms_modelInfoPtrs[index]->_vptr$CBaseModelInfo
       + 17))(
        CModelInfo::ms_modelInfoPtrs[index],
        v4);
      return 1;
    }
  }
  else
  {
    v4 = RpClumpGtaStreamRead2(pStream);
    if ( v4 )
      goto LABEL_3;
  }
  return 0;
}

//----- (003EF470) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
bool __fastcall CFileLoader::LoadCollisionFile(uint8 *pBuffer, uint32 size, uint8 level)
{
  CBaseModelInfo *ModelInfo; // r6
  int v4; // r2
  int v5; // r11
  char v6; // r8
  __int64 v7; // d17
  uint8 *v8; // r4
  uint32 v9; // r10
  unsigned int v10; // r2
  uint32 m_hashKey; // r5
  const unsigned __int8 *v12; // r2
  const unsigned __int8 *v13; // r3
  CColModel *m_pColModel; // r5
  int v15; // r0
  __int16 v17; // [sp+Ch] [bp-3Ch]
  __int64 pString; // [sp+10h] [bp-38h] BYREF
  _QWORD v19[2]; // [sp+18h] [bp-30h]

  v17 = level;
  if ( size >= 9 )
  {
    ModelInfo = 0;
    do
    {
      v4 = *(_DWORD *)pBuffer;
      v5 = *((_DWORD *)pBuffer + 1);
      if ( *(int *)pBuffer > 877416258 )
      {
        if ( v4 == 877416259 )
        {
          v6 = 3;
        }
        else
        {
          if ( v4 != 1280069443 )
            return 1;
          v6 = 0;
        }
      }
      else if ( v4 == 843861827 )
      {
        v6 = 1;
      }
      else
      {
        if ( v4 != 860639043 )
          return 1;
        v6 = 2;
      }
      v7 = *((_QWORD *)pBuffer + 2);
      v8 = pBuffer + 32;
      v9 = size - 32;
      pString = *((_QWORD *)pBuffer + 1);
      v19[0] = v7;
      *(_QWORD *)((char *)v19 + 6) = *(_QWORD *)(pBuffer + 22);
      v10 = *((unsigned __int16 *)pBuffer + 15);
      if ( v10 <= 0x4E1F )
        ModelInfo = CModelInfo::ms_modelInfoPtrs[v10];
      if ( ModelInfo
        && (m_hashKey = ModelInfo->m_hashKey, m_hashKey == CKeyGen::GetUppercaseKey((const unsigned __int8 *)&pString))
        || (ModelInfo = CModelInfo::GetModelInfo(
                          (const unsigned __int8 *)&pString,
                          *(__int16 *)&CColStore::ms_pColPool->m_aStorage[v17][34],
                          *(__int16 *)&CColStore::ms_pColPool->m_aStorage[v17][36])) != 0 )
      {
        if ( (ModelInfo->m_flags & 0x80) != 0 )
        {
          m_pColModel = ModelInfo->m_pColModel;
          if ( !m_pColModel )
          {
            m_pColModel = (CColModel *)CColModel::operator new(0x30u);
            CColModel::CColModel(m_pColModel);
            CBaseModelInfo::SetColModel(ModelInfo, m_pColModel, 1);
          }
          v15 = v6 & 3;
          switch ( v15 )
          {
            case 1:
              CFileLoader::LoadCollisionModelVer2(v8, v5 - 24, m_pColModel, v13);
              break;
            case 2:
              CFileLoader::LoadCollisionModelVer3(v8, v5 - 24, m_pColModel, v13);
              break;
            case 3:
              CFileLoader::LoadCollisionModelVer4(v8, v5 - 24, m_pColModel, v13);
              break;
            default:
              CFileLoader::LoadCollisionModel(v8, m_pColModel, v12);
              break;
          }
          m_pColModel->m_level = v17;
          if ( (*((int (__fastcall **)(CBaseModelInfo *))ModelInfo->_vptr$CBaseModelInfo + 5))(ModelInfo) == 1 )
            CPlantMgr::SetPlantFriendlyFlagInAtomicMI((CAtomicModelInfo *)ModelInfo);
        }
      }
      else
      {
        ModelInfo = 0;
      }
      size = v9 + 24 - v5;
      pBuffer = &v8[v5 - 24];
    }
    while ( size > 8 );
  }
  return 1;
}
// 3EF470: variables would overlap: r2.1 and r2.2
// 3EF470: using guessed type _QWORD anonymous_0[2];

//----- (003EF620) --------------------------------------------------------
void __fastcall CFileLoader::LoadCollisionModel(uint8 *p, CColModel *colModel, const unsigned __int8 *pColModelName)
{
  __int64 v5; // d16
  __int64 v6; // d16
  __int64 v7; // d16
  CCollisionData *v8; // r11
  uint8 *v9; // r9
  int v10; // r1
  CColSphere *m_pSphereArray; // r0
  int m_nNoOfSpheres; // r1
  unsigned int v13; // r4
  int i; // r9
  int v15; // r0
  uint8 *v16; // r10
  int v17; // r1
  uint8 *v18; // r6
  CColBox *v19; // r0
  int m_nNoOfBoxes; // r1
  int v21; // r6
  unsigned int v22; // r4
  int v23; // r9
  uint8 *v24; // r10
  CollisionVector *v25; // r0
  __int64 v26; // d16
  int v27; // r1
  int v28; // r2
  uint8 *v29; // r5
  __int64 v30; // d16
  int v31; // r3
  __int16 m_nNoOfTriangles; // r1
  char *v33; // r10
  int v34; // t1
  CColTriangle *m_pTriangleArray; // r0
  unsigned int v36; // r2
  int j; // r12
  __int64 v38; // kr00_8
  char v39; // r1
  char v40; // r6
  char *v41; // r0
  char v42; // r0
  bool v43; // zf

  colModel->m_sphereBound.m_fRadius = *(float *)p;
  v5 = *(_QWORD *)(p + 4);
  colModel->m_sphereBound.m_vecCentre.z = *((RwReal *)p + 3);
  *(_QWORD *)&colModel->m_sphereBound.m_vecCentre.x = v5;
  v6 = *((_QWORD *)p + 2);
  colModel->m_boxBound.m_vecMin.z = *((RwReal *)p + 6);
  *(_QWORD *)&colModel->m_boxBound.m_vecMin.x = v6;
  v7 = *(_QWORD *)(p + 28);
  colModel->m_boxBound.m_vecMax.z = *((RwReal *)p + 9);
  *(_QWORD *)&colModel->m_boxBound.m_vecMax.x = v7;
  v8 = (CCollisionData *)operator new(0x34u);
  CCollisionData::CCollisionData(v8);
  colModel->m_pColData = v8;
  v9 = p + 44;
  v10 = *((_DWORD *)p + 10);
  v8->m_nNoOfSpheres = v10;
  if ( v10 << 16 < 1 )
  {
    v8->m_pSphereArray = 0;
  }
  else
  {
    if ( v8->m_pSphereArray )
    {
      (*((void (**)(void))RwEngineInstance + 76))();
      LOWORD(v10) = v8->m_nNoOfSpheres;
    }
    m_pSphereArray = (CColSphere *)CMemoryMgr::Malloc(20 * (__int16)v10);
    m_nNoOfSpheres = v8->m_nNoOfSpheres;
    v8->m_pSphereArray = m_pSphereArray;
    if ( m_nNoOfSpheres >= 1 )
    {
      v13 = 0;
      for ( i = 1; ; ++i )
      {
        CColSphere::Set(
          &m_pSphereArray[v13 / 0x14],
          *(float *)&p[v13 + 44],
          (const CVector *)&p[v13 + 48],
          p[v13 + 60],
          p[v13 + 61],
          p[v13 + 63]);
        if ( i >= v8->m_nNoOfSpheres )
          break;
        m_pSphereArray = v8->m_pSphereArray;
        v13 += 20;
      }
      v9 = &p[v13 + 64];
    }
  }
  v16 = v9 + 4;
  v15 = *(_DWORD *)v9;
  v8->_anon_0.m_nNoOfLines = *(_DWORD *)v9;
  if ( v15 << 24 < 1 )
  {
    v8->_anon_1.m_pLineArray = 0;
  }
  else
  {
    v15 = (char)v15;
    if ( (char)v15 >= 1 )
    {
      if ( (char)v15 <= 1 )
        v15 = 1;
      v16 = &v9[(24 * v15) | 4];
    }
  }
  v8->_anon_1.m_pLineArray = 0;
  v8->_anon_0.m_nNoOfLines = 0;
  v18 = v16 + 4;
  v17 = *(_DWORD *)v16;
  v8->m_nNoOfBoxes = *(_DWORD *)v16;
  if ( v17 << 16 < 1 )
  {
    v8->m_pBoxArray = 0;
  }
  else
  {
    if ( v8->m_pBoxArray )
    {
      (*((void (**)(void))RwEngineInstance + 76))();
      LOWORD(v17) = v8->m_nNoOfBoxes;
    }
    v19 = (CColBox *)CMemoryMgr::Malloc(28 * (__int16)v17);
    m_nNoOfBoxes = v8->m_nNoOfBoxes;
    v8->m_pBoxArray = v19;
    if ( m_nNoOfBoxes >= 1 )
    {
      CColBox::Set(v19, (const CVector *)(v16 + 4), (const CVector *)(v16 + 16), v16[28], v16[29], v16[31]);
      if ( v8->m_nNoOfBoxes < 2 )
      {
        v18 = v16 + 32;
      }
      else
      {
        v21 = 1;
        v22 = 0;
        do
        {
          CColBox::Set(
            &v8->m_pBoxArray[v22 / 0x1C + 1],
            (const CVector *)&v16[v22 + 32],
            (const CVector *)&v16[v22 + 44],
            v16[v22 + 56],
            v16[v22 + 57],
            v16[v22 + 59]);
          ++v21;
          v22 += 28;
        }
        while ( v21 < v8->m_nNoOfBoxes );
        v18 = &v16[v22 + 32];
      }
    }
  }
  v24 = v18 + 4;
  v23 = *(_DWORD *)v18;
  if ( *(int *)v18 < 1 )
  {
    v8->m_pTriCompressedVectorArray = 0;
  }
  else
  {
    if ( v8->m_pTriCompressedVectorArray )
      (*((void (**)(void))RwEngineInstance + 76))();
    v25 = (CollisionVector *)CMemoryMgr::Malloc(6 * v23);
    v8->m_pTriCompressedVectorArray = v25;
    v26 = *(_QWORD *)v24;
    v25->z = *((RwReal *)v18 + 3);
    *(_QWORD *)&v25->x = v26;
    if ( v23 != 1 )
    {
      v27 = v23 - 1;
      v28 = 1;
      do
      {
        v29 = &v18[v28 * 12];
        --v27;
        v30 = *(_QWORD *)&v18[v28 * 12 + 4];
        v31 = (int)&v8->m_pTriCompressedVectorArray[v28++];
        *(_DWORD *)(v31 + 8) = *((_DWORD *)v29 + 3);
        *(_QWORD *)v31 = v30;
      }
      while ( v27 );
    }
    v24 = &v18[12 * v23 + 4];
  }
  v34 = *(_DWORD *)v24;
  v33 = (char *)(v24 + 4);
  m_nNoOfTriangles = v34;
  v8->m_nNoOfTriangles = v34;
  if ( v34 << 16 < 1 )
  {
    v8->m_pTriangleArray = 0;
  }
  else
  {
    if ( v8->m_pTriangleArray )
    {
      (*((void (**)(void))RwEngineInstance + 76))();
      m_nNoOfTriangles = v8->m_nNoOfTriangles;
    }
    m_pTriangleArray = (CColTriangle *)CMemoryMgr::Malloc(16 * m_nNoOfTriangles);
    v8->m_pTriangleArray = m_pTriangleArray;
    if ( v8->m_nNoOfTriangles < 1 )
    {
      LOWORD(j) = 0;
    }
    else
    {
      v36 = 0;
      for ( j = 1; ; ++j )
      {
        v38 = *(_QWORD *)&v33[v36 + 4];
        v39 = v33[v36 + 15];
        v40 = v33[v36 + 12];
        m_pTriangleArray[v36 / 0x10].m_nIndex1 = *(_DWORD *)&v33[v36];
        v41 = (char *)&m_pTriangleArray[v36 / 0x10];
        *(_QWORD *)(v41 + 4) = v38;
        v41[12] = v40;
        v41[13] = v39;
        if ( j >= v8->m_nNoOfTriangles )
          break;
        m_pTriangleArray = v8->m_pTriangleArray;
        v36 += 16;
      }
    }
    v8->m_nNoOfTriangles = j;
  }
  v42 = *((_BYTE *)v8 + 7);
  v8->m_pTriCompressedShadVectorArray = 0;
  v8->m_pShadTriangleArray = 0;
  *((_BYTE *)v8 + 7) = v42 & 0xFB;
  colModel->m_pColData->m_nNoOfShadTriangleVerts = 0;
  v43 = v8->m_nNoOfSpheres == 0;
  if ( !v8->m_nNoOfSpheres )
    v43 = v8->m_nNoOfBoxes == 0;
  if ( !v43 || v8->m_nNoOfTriangles )
    *((_BYTE *)colModel + 41) |= 1u;
}

//----- (003EF934) --------------------------------------------------------
void __fastcall CFileLoader::LoadCollisionModelVer2(
        uint8 *pData,
        uint32 size,
        CColModel *colModel,
        const unsigned __int8 *pColModelName)
{
  uint8 *v7; // r0
  unsigned __int8 v8; // r0
  __int64 v9; // d17
  char v10; // r1
  __int64 v11; // d16
  __int64 v12; // d17
  __int64 v13; // d18
  CCollisionData *v14; // r9
  CCollisionData *v15; // r10
  CColSphere *v16; // r1
  CColBox *v17; // r1
  CColLine *v18; // r1
  int v19; // r5
  int v20; // r6
  CColTriangle *v21; // r0
  char *v22; // r12
  int v23; // r2
  int v24; // r3
  CColTriangle *v25; // r1
  char *v26; // r5
  int v27; // r5
  int32 NoVectors; // r6
  CollisionVector *v29; // r0
  float *p_y; // r2
  __int16 *v31; // r1
  int v32; // r3
  CBoundingBox v33; // [sp+0h] [bp-68h] BYREF
  int16 v34; // [sp+28h] [bp-40h]
  int16 v35; // [sp+2Ah] [bp-3Eh]
  int16 v36; // [sp+2Ch] [bp-3Ch]
  int8 v37; // [sp+2Eh] [bp-3Ah]
  unsigned __int8 v38; // [sp+30h] [bp-38h]
  CColSphere *v39; // [sp+34h] [bp-34h]
  CColBox *v40; // [sp+38h] [bp-30h]
  CColLine *v41; // [sp+3Ch] [bp-2Ch]
  int v42; // [sp+40h] [bp-28h]
  int v43; // [sp+44h] [bp-24h]

  CBoundingBox::CBoundingBox(&v33);
  qmemcpy(v7, pData, 0x4Cu);
  v8 = v38;
  v9 = *(_QWORD *)&v33.m_sphereBound.m_vecCentre.z;
  v10 = *((_BYTE *)colModel + 41);
  *(_QWORD *)&colModel->m_sphereBound.m_vecCentre.x = *(_QWORD *)&v33.m_sphereBound.m_vecCentre.x;
  *(_QWORD *)&colModel->m_sphereBound.m_vecCentre.z = v9;
  v11 = *(_QWORD *)&v33.m_boxBound.m_vecMin.x;
  v12 = *(_QWORD *)&v33.m_boxBound.m_vecMin.z;
  v13 = *(_QWORD *)&v33.m_boxBound.m_vecMax.y;
  *((_BYTE *)colModel + 41) = ((v8 & 2) != 0) | v10 & 0xFE;
  *(_QWORD *)&colModel->m_boxBound.m_vecMin.x = v11;
  *(_QWORD *)&colModel->m_boxBound.m_vecMin.z = v12;
  *(_QWORD *)&colModel->m_boxBound.m_vecMax.y = v13;
  if ( size != 76 )
  {
    v14 = (CCollisionData *)CMemoryMgr::Malloc(size - 24);
    colModel->m_pColData = v14;
    qmemcpy(&v14[1], pData + 76, size - 76);
    v15 = v14 - 1;
    colModel->m_pColData->m_nNoOfSpheres = v34;
    colModel->m_pColData->m_nNoOfBoxes = v35;
    colModel->m_pColData->_anon_0.m_nNoOfLines = v37;
    colModel->m_pColData->m_nNoOfTriangles = v36;
    *((_BYTE *)colModel->m_pColData + 7) &= ~1u;
    *((_BYTE *)colModel->m_pColData + 7) &= ~4u;
    *((_BYTE *)colModel->m_pColData + 7) = (v38 >> 2) & 2 | *((_BYTE *)colModel->m_pColData + 7) & 0xFD;
    v16 = v39;
    if ( v39 )
      v16 = (CColSphere *)((char *)v15 + (_DWORD)v39);
    colModel->m_pColData->m_pSphereArray = v16;
    v17 = v40;
    if ( v40 )
      v17 = (CColBox *)((char *)v15 + (_DWORD)v40);
    colModel->m_pColData->m_pBoxArray = v17;
    v18 = v41;
    if ( v41 )
      v18 = (CColLine *)((char *)v15 + (_DWORD)v41);
    colModel->m_pColData->_anon_1.m_pLineArray = v18;
    v19 = v43;
    if ( v43 )
    {
      v20 = v36;
      v21 = (CColTriangle *)malloc(16 * v36);
      if ( v20 >= 1 )
      {
        v22 = (char *)v15 + v19;
        v23 = 0;
        v24 = 8;
        do
        {
          v25 = &v21[v23];
          *(_DWORD *)((char *)v21 + v24 - 8) = *(unsigned __int16 *)&v22[v23 * 8];
          v26 = &v22[v23 * 8];
          ++v23;
          --v20;
          v25->m_nIndex2 = *((unsigned __int16 *)v26 + 1);
          *(int32 *)((char *)&v21->m_nIndex1 + v24) = *((unsigned __int16 *)v26 + 2);
          v24 += 16;
          v25->m_nSurfaceType = v26[6];
          v25->m_nLighting = v26[7];
        }
        while ( v20 );
      }
    }
    else
    {
      v21 = 0;
    }
    colModel->m_pColData->m_pTriangleArray = v21;
    v27 = v42;
    if ( v42 )
    {
      NoVectors = CCollisionData::GetNoVectors(colModel->m_pColData);
      v29 = (CollisionVector *)malloc(12 * NoVectors);
      if ( NoVectors >= 1 )
      {
        p_y = &v29->y;
        v31 = (int16 *)((char *)&v15->m_nNoOfBoxes + v27);
        do
        {
          --NoVectors;
          *(p_y - 1) = (float)*(v31 - 1) * 0.0078125;
          *p_y = (float)*v31 * 0.0078125;
          v32 = v31[1];
          v31 += 3;
          p_y[1] = (float)v32 * 0.0078125;
          p_y += 3;
        }
        while ( NoVectors );
      }
    }
    else
    {
      v29 = 0;
    }
    colModel->m_pColData->m_pTriCompressedVectorArray = v29;
    colModel->m_pColData->m_modelSec = (int32 *)((char *)&v14[-1] + v43 - 4);
    colModel->m_pColData->m_pTrianglePlaneArray = 0;
    *((_BYTE *)colModel->m_pColData + 7) &= ~4u;
    colModel->m_pColData->m_pTriCompressedShadVectorArray = 0;
    colModel->m_pColData->m_pShadTriangleArray = 0;
    colModel->m_pColData->m_nNoOfShadTriangles = 0;
    colModel->m_pColData->m_nNoOfShadTriangleVerts = 0;
    *((_BYTE *)colModel + 41) |= 6u;
  }
}
// 3EF950: variable 'v7' is possibly undefined

//----- (003EFC38) --------------------------------------------------------
void __fastcall CFileLoader::LoadCollisionModelVer3(
        uint8 *pData,
        uint32 size,
        CColModel *colModel,
        const unsigned __int8 *pColModelName)
{
  uint8 *v7; // r0
  unsigned int v8; // r5
  unsigned int v9; // r0
  unsigned int v10; // r1
  int v11; // r4
  unsigned int v12; // r2
  unsigned __int8 v13; // r0
  int v14; // r5
  __int64 v15; // d17
  char v16; // r1
  __int64 v17; // d16
  __int64 v18; // d17
  __int64 v19; // d18
  size_t v20; // r6
  CCollisionData *v21; // r9
  CollisionVector **p_m_pTriCompressedShadVectorArray; // r8
  CColSphere *v23; // r1
  CColBox *v24; // r1
  CColLine *v25; // r1
  int v26; // r4
  int v27; // r6
  CColTriangle *v28; // r0
  char *v29; // r12
  int v30; // r2
  int v31; // r3
  CColTriangle *v32; // r1
  char *v33; // r5
  int v34; // r4
  int v35; // r6
  CColTriangle *v36; // r0
  char *v37; // r12
  int v38; // r2
  int v39; // r3
  CColTriangle *v40; // r1
  char *v41; // r5
  int v42; // r4
  int32 NoVectors; // r6
  CollisionVector *v44; // r0
  float *p_y; // r2
  char *v46; // r1
  int v47; // r3
  int v48; // r4
  int32 NoShadVectors; // r6
  CollisionVector *v50; // r0
  float *v51; // r2
  char *v52; // r1
  int v53; // r3
  CCollisionData *m_pColData; // r0
  char v55; // r1
  char v56; // r2
  int v57; // r2
  CCollisionData *v58; // r0
  int m_nNoOfShadTriangles; // r2
  int32 *p_m_nIndex2; // r6
  unsigned int v61; // r3
  unsigned int v62; // r5
  __int64 v63; // kr00_8
  CBoundingBox v64; // [sp+0h] [bp-70h] BYREF
  int16 v65; // [sp+28h] [bp-48h]
  int16 v66; // [sp+2Ah] [bp-46h]
  int16 v67; // [sp+2Ch] [bp-44h]
  int8 v68; // [sp+2Eh] [bp-42h]
  unsigned __int8 v69; // [sp+30h] [bp-40h]
  CColSphere *v70; // [sp+34h] [bp-3Ch]
  CColBox *v71; // [sp+38h] [bp-38h]
  CColLine *v72; // [sp+3Ch] [bp-34h]
  int v73; // [sp+40h] [bp-30h]
  int v74; // [sp+44h] [bp-2Ch]
  int32 v75; // [sp+4Ch] [bp-24h]
  int v76; // [sp+50h] [bp-20h]
  int v77; // [sp+54h] [bp-1Ch]

  CBoundingBox::CBoundingBox(&v64);
  qmemcpy(v7, pData, 0x58u);
  v8 = v69;
  v9 = v69;
  v10 = v69 & 0xFD | (2 * ((v69 >> 1) & 1));
  v69 = v69 & 0xFD | (2 * ((v69 & 2) != 0));
  v11 = (v8 >> 2) & 1;
  if ( v11 != ((v9 >> 2) & 1) )
  {
    BitfieldError("Bitfield Error:(%s %d) GetEndianBitfield(val,0x1,2)", "../Core/FileLoader.cpp", 1124);
    v10 = v69;
  }
  v12 = v10 & 0xFB | (4 * v11);
  v69 = v10 & 0xFB | (4 * ((v8 & 4) != 0));
  if ( ((v8 >> 3) & 1) != ((v10 >> 3) & 1) )
  {
    BitfieldError("Bitfield Error:(%s %d) GetEndianBitfield(val,0x1,3)", "../Core/FileLoader.cpp", 1125);
    v12 = v69;
  }
  v13 = v12 & 0xF7 | (8 * ((v8 & 8) != 0));
  v69 = v13;
  v14 = (v8 >> 4) & 1;
  if ( v14 != ((v12 >> 4) & 1) )
  {
    BitfieldError("Bitfield Error:(%s %d) GetEndianBitfield(val,0x1,4)", "../Core/FileLoader.cpp", 1126);
    v13 = v69;
  }
  v15 = *(_QWORD *)&v64.m_sphereBound.m_vecCentre.z;
  v69 = v13 & 0xEF | (16 * v14);
  v16 = *((_BYTE *)colModel + 41);
  *(_QWORD *)&colModel->m_sphereBound.m_vecCentre.x = *(_QWORD *)&v64.m_sphereBound.m_vecCentre.x;
  *(_QWORD *)&colModel->m_sphereBound.m_vecCentre.z = v15;
  v17 = *(_QWORD *)&v64.m_boxBound.m_vecMin.x;
  v18 = *(_QWORD *)&v64.m_boxBound.m_vecMin.z;
  v19 = *(_QWORD *)&v64.m_boxBound.m_vecMax.y;
  v20 = size - 88;
  *((_BYTE *)colModel + 41) = ((v13 & 2) != 0) | v16 & 0xFE;
  *(_QWORD *)&colModel->m_boxBound.m_vecMin.x = v17;
  *(_QWORD *)&colModel->m_boxBound.m_vecMin.z = v18;
  *(_QWORD *)&colModel->m_boxBound.m_vecMax.y = v19;
  if ( size != 88 )
  {
    v21 = (CCollisionData *)CMemoryMgr::Malloc(size - 36);
    colModel->m_pColData = v21;
    qmemcpy(&v21[1], pData + 88, v20);
    p_m_pTriCompressedShadVectorArray = &v21[-2].m_pTriCompressedShadVectorArray;
    colModel->m_pColData->m_nNoOfSpheres = v65;
    colModel->m_pColData->m_nNoOfBoxes = v66;
    colModel->m_pColData->_anon_0.m_nNoOfLines = v68;
    colModel->m_pColData->m_nNoOfTriangles = v67;
    *((_BYTE *)colModel->m_pColData + 7) &= ~1u;
    *((_BYTE *)colModel->m_pColData + 7) = (v69 >> 2) & 2 | *((_BYTE *)colModel->m_pColData + 7) & 0xFD;
    colModel->m_pColData->m_nNoOfShadTriangles = v75;
    v23 = v70;
    if ( v70 )
      v23 = (CColSphere *)((char *)p_m_pTriCompressedShadVectorArray + (_DWORD)v70);
    colModel->m_pColData->m_pSphereArray = v23;
    v24 = v71;
    if ( v71 )
      v24 = (CColBox *)((char *)p_m_pTriCompressedShadVectorArray + (_DWORD)v71);
    colModel->m_pColData->m_pBoxArray = v24;
    v25 = v72;
    if ( v72 )
      v25 = (CColLine *)((char *)p_m_pTriCompressedShadVectorArray + (_DWORD)v72);
    colModel->m_pColData->_anon_1.m_pLineArray = v25;
    v26 = v74;
    if ( v74 )
    {
      v27 = v67;
      v28 = (CColTriangle *)malloc(16 * v67);
      if ( v27 >= 1 )
      {
        v29 = (char *)p_m_pTriCompressedShadVectorArray + v26;
        v30 = 0;
        v31 = 8;
        do
        {
          v32 = &v28[v30];
          *(_DWORD *)((char *)v28 + v31 - 8) = *(unsigned __int16 *)&v29[v30 * 8];
          v33 = &v29[v30 * 8];
          ++v30;
          --v27;
          v32->m_nIndex2 = *((unsigned __int16 *)v33 + 1);
          *(int32 *)((char *)&v28->m_nIndex1 + v31) = *((unsigned __int16 *)v33 + 2);
          v31 += 16;
          v32->m_nSurfaceType = v33[6];
          v32->m_nLighting = v33[7];
        }
        while ( v27 );
      }
    }
    else
    {
      v28 = 0;
    }
    colModel->m_pColData->m_pTriangleArray = v28;
    v34 = v77;
    if ( v77 )
    {
      v35 = v75;
      v36 = (CColTriangle *)malloc(16 * v75);
      if ( v35 >= 1 )
      {
        v37 = (char *)p_m_pTriCompressedShadVectorArray + v34;
        v38 = 0;
        v39 = 8;
        do
        {
          v40 = &v36[v38];
          *(_DWORD *)((char *)v36 + v39 - 8) = *(unsigned __int16 *)&v37[v38 * 8];
          v41 = &v37[v38 * 8];
          ++v38;
          --v35;
          v40->m_nIndex2 = *((unsigned __int16 *)v41 + 1);
          *(int32 *)((char *)&v36->m_nIndex1 + v39) = *((unsigned __int16 *)v41 + 2);
          v39 += 16;
          v40->m_nSurfaceType = v41[6];
          v40->m_nLighting = v41[7];
        }
        while ( v35 );
      }
    }
    else
    {
      v36 = 0;
    }
    colModel->m_pColData->m_pShadTriangleArray = v36;
    v42 = v73;
    if ( v73 )
    {
      NoVectors = CCollisionData::GetNoVectors(colModel->m_pColData);
      v44 = (CollisionVector *)malloc(12 * NoVectors);
      if ( NoVectors >= 1 )
      {
        p_y = &v44->y;
        v46 = (char *)p_m_pTriCompressedShadVectorArray + v42 + 2;
        do
        {
          --NoVectors;
          *(p_y - 1) = (float)*((__int16 *)v46 - 1) * 0.0078125;
          *p_y = (float)*(__int16 *)v46 * 0.0078125;
          v47 = *((__int16 *)v46 + 1);
          v46 += 6;
          p_y[1] = (float)v47 * 0.0078125;
          p_y += 3;
        }
        while ( NoVectors );
      }
    }
    else
    {
      v44 = 0;
    }
    colModel->m_pColData->m_pTriCompressedVectorArray = v44;
    v48 = v76;
    if ( v76 )
    {
      NoShadVectors = CCollisionData::GetNoShadVectors(colModel->m_pColData);
      v50 = (CollisionVector *)malloc(12 * NoShadVectors);
      if ( NoShadVectors >= 1 )
      {
        v51 = &v50->y;
        v52 = (char *)p_m_pTriCompressedShadVectorArray + v48 + 2;
        do
        {
          --NoShadVectors;
          *(v51 - 1) = (float)*((__int16 *)v52 - 1) * 0.0078125;
          *v51 = (float)*(__int16 *)v52 * 0.0078125;
          v53 = *((__int16 *)v52 + 1);
          v52 += 6;
          v51[1] = (float)v53 * 0.0078125;
          v51 += 3;
        }
        while ( NoShadVectors );
      }
    }
    else
    {
      v50 = 0;
    }
    colModel->m_pColData->m_pTriCompressedShadVectorArray = v50;
    colModel->m_pColData->m_modelSec = (int32 *)((char *)&v21[-1] + v74 - 16);
    m_pColData = colModel->m_pColData;
    v55 = *((_BYTE *)m_pColData + 7);
    v56 = v55 & 0xFB;
    if ( v75 > 0 )
      v56 = v55 | 4;
    if ( !v76 )
      v56 = v55 & 0xFB;
    if ( !v77 )
      v56 = v55 & 0xFB;
    *((_BYTE *)m_pColData + 7) = v56;
    v57 = 0;
    v58 = colModel->m_pColData;
    if ( (*((_BYTE *)v58 + 7) & 4) != 0 )
    {
      m_nNoOfShadTriangles = v58->m_nNoOfShadTriangles;
      if ( m_nNoOfShadTriangles )
      {
        if ( m_nNoOfShadTriangles < 1 )
        {
          v57 = 1;
        }
        else
        {
          p_m_nIndex2 = &v58->m_pShadTriangleArray->m_nIndex2;
          v61 = 0;
          do
          {
            v62 = *(p_m_nIndex2 - 1);
            v63 = *(_QWORD *)p_m_nIndex2;
            p_m_nIndex2 += 4;
            if ( v62 > v61 )
              v61 = v62;
            if ( (unsigned int)v63 > v61 )
              v61 = v63;
            if ( HIDWORD(v63) > v61 )
              v61 = HIDWORD(v63);
            --m_nNoOfShadTriangles;
          }
          while ( m_nNoOfShadTriangles );
          v57 = v61 + 1;
        }
      }
      else
      {
        v57 = 0;
      }
    }
    v58->m_nNoOfShadTriangleVerts = v57;
    colModel->m_pColData->m_pTrianglePlaneArray = 0;
    *((_BYTE *)colModel + 41) |= 6u;
  }
}
// 3EFC54: variable 'v7' is possibly undefined

//----- (003F00D0) --------------------------------------------------------
void __fastcall CFileLoader::LoadCollisionModelVer4(
        uint8 *pData,
        uint32 size,
        CColModel *colModel,
        const unsigned __int8 *pColModelName)
{
  uint8 *v7; // r0
  __int64 v8; // d17
  __int64 v9; // d17
  __int64 v10; // d18
  CCollisionData *v11; // r9
  int32 *p_m_nNoOfShadTriangleVerts; // r10
  CColSphere *v13; // r1
  CColBox *v14; // r1
  CColLine *v15; // r1
  int v16; // r5
  int v17; // r6
  CColTriangle *v18; // r0
  char *v19; // r12
  int v20; // r2
  int v21; // r3
  CColTriangle *v22; // r1
  char *v23; // r5
  int v24; // r5
  int v25; // r6
  CColTriangle *v26; // r0
  char *v27; // r12
  int v28; // r2
  int v29; // r3
  CColTriangle *v30; // r1
  char *v31; // r5
  int v32; // r5
  int32 NoVectors; // r6
  CollisionVector *v34; // r0
  float *p_y; // r2
  char *v36; // r1
  int v37; // r3
  int v38; // r5
  int32 NoShadVectors; // r6
  CollisionVector *v40; // r0
  float *v41; // r2
  char *v42; // r1
  int v43; // r3
  CCollisionData *m_pColData; // r0
  char v45; // r1
  char v46; // r2
  int v47; // r2
  CCollisionData *v48; // r0
  int m_nNoOfShadTriangles; // r2
  int32 *p_m_nIndex2; // r6
  unsigned int v51; // r3
  unsigned int v52; // r5
  __int64 v53; // kr00_8
  CBoundingBox v54; // [sp+0h] [bp-78h] BYREF
  int16 v55; // [sp+28h] [bp-50h]
  int16 v56; // [sp+2Ah] [bp-4Eh]
  int16 v57; // [sp+2Ch] [bp-4Ch]
  int8 v58; // [sp+2Eh] [bp-4Ah]
  unsigned __int8 v59; // [sp+30h] [bp-48h]
  CColSphere *v60; // [sp+34h] [bp-44h]
  CColBox *v61; // [sp+38h] [bp-40h]
  CColLine *v62; // [sp+3Ch] [bp-3Ch]
  int v63; // [sp+40h] [bp-38h]
  int v64; // [sp+44h] [bp-34h]
  int32 v65; // [sp+4Ch] [bp-2Ch]
  int v66; // [sp+50h] [bp-28h]
  int v67; // [sp+54h] [bp-24h]

  CBoundingBox::CBoundingBox(&v54);
  qmemcpy(v7, pData, 0x5Cu);
  v8 = *(_QWORD *)&v54.m_sphereBound.m_vecCentre.z;
  *(_QWORD *)&colModel->m_sphereBound.m_vecCentre.x = *(_QWORD *)&v54.m_sphereBound.m_vecCentre.x;
  *(_QWORD *)&colModel->m_sphereBound.m_vecCentre.z = v8;
  v9 = *(_QWORD *)&v54.m_boxBound.m_vecMin.z;
  v10 = *(_QWORD *)&v54.m_boxBound.m_vecMax.y;
  *(_QWORD *)&colModel->m_boxBound.m_vecMin.x = *(_QWORD *)&v54.m_boxBound.m_vecMin.x;
  *(_QWORD *)&colModel->m_boxBound.m_vecMin.z = v9;
  *(_QWORD *)&colModel->m_boxBound.m_vecMax.y = v10;
  *((_BYTE *)colModel + 41) = ((v59 & 2) != 0) | *((_BYTE *)colModel + 41) & 0xFE;
  if ( size != 92 )
  {
    v11 = (CCollisionData *)CMemoryMgr::Malloc(size - 40);
    colModel->m_pColData = v11;
    qmemcpy(&v11[1], pData + 92, size - 92);
    p_m_nNoOfShadTriangleVerts = &v11[-2].m_nNoOfShadTriangleVerts;
    colModel->m_pColData->m_nNoOfSpheres = v55;
    colModel->m_pColData->m_nNoOfBoxes = v56;
    colModel->m_pColData->_anon_0.m_nNoOfLines = v58;
    colModel->m_pColData->m_nNoOfTriangles = v57;
    *((_BYTE *)colModel->m_pColData + 7) &= ~1u;
    *((_BYTE *)colModel->m_pColData + 7) = (v59 >> 2) & 2 | *((_BYTE *)colModel->m_pColData + 7) & 0xFD;
    colModel->m_pColData->m_nNoOfShadTriangles = v65;
    v13 = v60;
    if ( v60 )
      v13 = (CColSphere *)((char *)p_m_nNoOfShadTriangleVerts + (_DWORD)v60);
    colModel->m_pColData->m_pSphereArray = v13;
    v14 = v61;
    if ( v61 )
      v14 = (CColBox *)((char *)p_m_nNoOfShadTriangleVerts + (_DWORD)v61);
    colModel->m_pColData->m_pBoxArray = v14;
    v15 = v62;
    if ( v62 )
      v15 = (CColLine *)((char *)p_m_nNoOfShadTriangleVerts + (_DWORD)v62);
    colModel->m_pColData->_anon_1.m_pLineArray = v15;
    v16 = v64;
    if ( v64 )
    {
      v17 = v57;
      v18 = (CColTriangle *)malloc(16 * v57);
      if ( v17 >= 1 )
      {
        v19 = (char *)p_m_nNoOfShadTriangleVerts + v16;
        v20 = 0;
        v21 = 8;
        do
        {
          v22 = &v18[v20];
          *(_DWORD *)((char *)v18 + v21 - 8) = *(unsigned __int16 *)&v19[v20 * 8];
          v23 = &v19[v20 * 8];
          ++v20;
          --v17;
          v22->m_nIndex2 = *((unsigned __int16 *)v23 + 1);
          *(int32 *)((char *)&v18->m_nIndex1 + v21) = *((unsigned __int16 *)v23 + 2);
          v21 += 16;
          v22->m_nSurfaceType = v23[6];
          v22->m_nLighting = v23[7];
        }
        while ( v17 );
      }
    }
    else
    {
      v18 = 0;
    }
    colModel->m_pColData->m_pTriangleArray = v18;
    v24 = v67;
    if ( v67 )
    {
      v25 = v65;
      v26 = (CColTriangle *)malloc(16 * v65);
      if ( v25 >= 1 )
      {
        v27 = (char *)p_m_nNoOfShadTriangleVerts + v24;
        v28 = 0;
        v29 = 8;
        do
        {
          v30 = &v26[v28];
          *(_DWORD *)((char *)v26 + v29 - 8) = *(unsigned __int16 *)&v27[v28 * 8];
          v31 = &v27[v28 * 8];
          ++v28;
          --v25;
          v30->m_nIndex2 = *((unsigned __int16 *)v31 + 1);
          *(int32 *)((char *)&v26->m_nIndex1 + v29) = *((unsigned __int16 *)v31 + 2);
          v29 += 16;
          v30->m_nSurfaceType = v31[6];
          v30->m_nLighting = v31[7];
        }
        while ( v25 );
      }
    }
    else
    {
      v26 = 0;
    }
    colModel->m_pColData->m_pShadTriangleArray = v26;
    v32 = v63;
    if ( v63 )
    {
      NoVectors = CCollisionData::GetNoVectors(colModel->m_pColData);
      v34 = (CollisionVector *)malloc(12 * NoVectors);
      if ( NoVectors >= 1 )
      {
        p_y = &v34->y;
        v36 = (char *)p_m_nNoOfShadTriangleVerts + v32 + 2;
        do
        {
          --NoVectors;
          *(p_y - 1) = (float)*((__int16 *)v36 - 1) * 0.0078125;
          *p_y = (float)*(__int16 *)v36 * 0.0078125;
          v37 = *((__int16 *)v36 + 1);
          v36 += 6;
          p_y[1] = (float)v37 * 0.0078125;
          p_y += 3;
        }
        while ( NoVectors );
      }
    }
    else
    {
      v34 = 0;
    }
    colModel->m_pColData->m_pTriCompressedVectorArray = v34;
    v38 = v66;
    if ( v66 )
    {
      NoShadVectors = CCollisionData::GetNoShadVectors(colModel->m_pColData);
      v40 = (CollisionVector *)malloc(12 * NoShadVectors);
      if ( NoShadVectors >= 1 )
      {
        v41 = &v40->y;
        v42 = (char *)p_m_nNoOfShadTriangleVerts + v38 + 2;
        do
        {
          --NoShadVectors;
          *(v41 - 1) = (float)*((__int16 *)v42 - 1) * 0.0078125;
          *v41 = (float)*(__int16 *)v42 * 0.0078125;
          v43 = *((__int16 *)v42 + 1);
          v42 += 6;
          v41[1] = (float)v43 * 0.0078125;
          v41 += 3;
        }
        while ( NoShadVectors );
      }
    }
    else
    {
      v40 = 0;
    }
    colModel->m_pColData->m_pTriCompressedShadVectorArray = v40;
    m_pColData = colModel->m_pColData;
    v45 = *((_BYTE *)m_pColData + 7);
    v46 = v45 & 0xFB;
    if ( v65 > 0 )
      v46 = v45 | 4;
    if ( !v66 )
      v46 = v45 & 0xFB;
    if ( !v67 )
      v46 = v45 & 0xFB;
    *((_BYTE *)m_pColData + 7) = v46;
    v47 = 0;
    colModel->m_pColData->m_modelSec = (int32 *)((char *)&v11[-1] + v64 - 20);
    v48 = colModel->m_pColData;
    if ( (*((_BYTE *)v48 + 7) & 4) != 0 )
    {
      m_nNoOfShadTriangles = v48->m_nNoOfShadTriangles;
      if ( m_nNoOfShadTriangles )
      {
        if ( m_nNoOfShadTriangles < 1 )
        {
          v47 = 1;
        }
        else
        {
          p_m_nIndex2 = &v48->m_pShadTriangleArray->m_nIndex2;
          v51 = 0;
          do
          {
            v52 = *(p_m_nIndex2 - 1);
            v53 = *(_QWORD *)p_m_nIndex2;
            p_m_nIndex2 += 4;
            if ( v52 > v51 )
              v51 = v52;
            if ( (unsigned int)v53 > v51 )
              v51 = v53;
            if ( HIDWORD(v53) > v51 )
              v51 = HIDWORD(v53);
            --m_nNoOfShadTriangles;
          }
          while ( m_nNoOfShadTriangles );
          v47 = v51 + 1;
        }
      }
      else
      {
        v47 = 0;
      }
    }
    v48->m_nNoOfShadTriangleVerts = v47;
    colModel->m_pColData->m_pTrianglePlaneArray = 0;
    *((_BYTE *)colModel + 41) |= 6u;
  }
}
// 3F00EC: variable 'v7' is possibly undefined

//----- (003F0400) --------------------------------------------------------
void __fastcall CFileLoader::LoadBoundingBox(uint8 *p, CBoundingBox *boundingBox)
{
  __int64 v2; // d16
  __int64 v3; // d16
  __int64 v4; // d16

  boundingBox->m_sphereBound.m_fRadius = *(float *)p;
  v2 = *(_QWORD *)(p + 4);
  boundingBox->m_sphereBound.m_vecCentre.z = *((RwReal *)p + 3);
  *(_QWORD *)&boundingBox->m_sphereBound.m_vecCentre.x = v2;
  v3 = *((_QWORD *)p + 2);
  boundingBox->m_boxBound.m_vecMin.z = *((RwReal *)p + 6);
  *(_QWORD *)&boundingBox->m_boxBound.m_vecMin.x = v3;
  v4 = *(_QWORD *)(p + 28);
  boundingBox->m_boxBound.m_vecMax.z = *((RwReal *)p + 9);
  *(_QWORD *)&boundingBox->m_boxBound.m_vecMax.x = v4;
}

//----- (003F043A) --------------------------------------------------------
CColTriangle *__fastcall CSerializedColTriangle::Fixup(CSerializedColTriangle *fromArray, int num)
{
  int v2; // r4
  CColTriangle *result; // r0
  int v5; // r1
  int v6; // r2
  CColTriangle *v7; // r6
  CSerializedColTriangle *v8; // r3

  v2 = num;
  result = (CColTriangle *)malloc(16 * num);
  if ( v2 >= 1 )
  {
    v5 = 0;
    v6 = 8;
    do
    {
      v7 = &result[v5];
      *(_DWORD *)((char *)result + v6 - 8) = fromArray[v5].m_nIndex1;
      v8 = &fromArray[v5++];
      --v2;
      v7->m_nIndex2 = v8->m_nIndex2;
      *(int32 *)((char *)&result->m_nIndex1 + v6) = v8->m_nIndex3;
      v6 += 16;
      v7->m_nSurfaceType = v8->m_nSurfaceType;
      v7->m_nLighting = v8->m_nLighting;
    }
    while ( v2 );
  }
  return result;
}

//----- (003F0488) --------------------------------------------------------
CollisionVector *__fastcall TranslationCollisionVectorFixup(CompressedVector *v, int num)
{
  int v2; // r4
  CollisionVector *result; // r0
  RwReal *p_y; // r1
  CompressedFloat *v6; // r2
  int v7; // r3

  v2 = num;
  result = (CollisionVector *)malloc(12 * num);
  if ( v2 >= 1 )
  {
    p_y = &result->y;
    v6 = &v->y;
    do
    {
      --v2;
      *(p_y - 1) = (float)*(v6 - 1) * 0.0078125;
      *p_y = (float)*v6 * 0.0078125;
      v7 = v6[1];
      v6 += 3;
      p_y[1] = (float)v7 * 0.0078125;
      p_y += 3;
    }
    while ( v2 );
  }
  return result;
}

//----- (003F04F8) --------------------------------------------------------
CEntity *__fastcall CFileLoader::LoadObjectInstance(const unsigned __int8 *pLine)
{
  const unsigned __int8 *v1; // r1
  CFileObjectInstance v3; // [sp+24h] [bp-54h] BYREF
  char v4; // [sp+4Fh] [bp-29h] BYREF

  sscanf(
    (const char *)pLine,
    "%d %s %d %f %f %f %f %f %f %f %d",
    &v3.instanceIndex,
    &v4,
    &v3._anon_0,
    &v3,
    &v3.posy,
    &v3.posz,
    &v3.quatx,
    &v3.quaty,
    &v3.quatz,
    &v3.quatw,
    &v3.lodIndex);
  return CFileLoader::LoadObjectInstance(&v3, v1);
}
// 3F0550: variable 'v1' is possibly undefined
// 3F04F8: using guessed type CFileObjectInstance var_54;

//----- (003F059C) --------------------------------------------------------
CEntity *__fastcall CFileLoader::LoadObjectInstance(CFileObjectInstance *pObject, const unsigned __int8 *pName)
{
  int32 instanceIndex; // r0
  CBaseModelInfo *v4; // r8
  float v5; // s0
  CBuilding *v6; // r5
  CBaseModelInfo *v7; // r0
  int v8; // r0
  float quatx; // s0
  float quaty; // s2
  bool v11; // zf
  float v12; // s4
  CMatrix *v13; // r0
  CMatrix **p_m_pMat; // r9
  __int64 v15; // d17
  __int64 v16; // kr00_8
  float posz; // r0
  float *p_tz; // r1
  int32 areaCodeAndFlags; // r0
  CMatrix *v20; // r0
  CColModel *m_pColModel; // r4
  CRect *BoundingBox; // r0
  int p_tx; // r2
  float quatz; // s16
  float v26; // r0
  float v27; // s0
  CMatrix *m_pMat; // r0
  CQuaternion v29; // [sp+0h] [bp-38h] BYREF

  instanceIndex = pObject->instanceIndex;
  v4 = CModelInfo::ms_modelInfoPtrs[instanceIndex];
  if ( !v4 )
    return 0;
  if ( instanceIndex == 17886 )
  {
    if ( fabsf(pObject->posx + -2264.0) < 0.01 )
      pObject->posx = pObject->posx + 2.0;
  }
  else
  {
    if ( instanceIndex == 10442 )
    {
      if ( fabsf(pObject->posx + 2573.2) >= 0.01 )
        goto LABEL_14;
      v5 = -0.2;
      goto LABEL_13;
    }
    if ( instanceIndex == 791 && fabsf(pObject->posx + 607.88) < 0.01 )
    {
      v5 = -2.0;
LABEL_13:
      pObject->posz = pObject->posz + v5;
    }
  }
LABEL_14:
  if ( (unsigned __int16)v4->m_dynamicIndex == 0xFFFF )
  {
    if ( (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 5))(v4) == 5 && HIBYTE(v4->m_flags) << 31 )
    {
      v6 = (CBuilding *)CBuilding::operator new(0x3Cu);
      CBuilding::CBuilding(v6);
      v6->_vptr$CPlaceable = (int (**)(void))&off_66201C;
    }
    else
    {
      v6 = (CBuilding *)CBuilding::operator new(0x3Cu);
      CBuilding::CBuilding(v6);
    }
    (*((void (__fastcall **)(CBuilding *, int32))v6->_vptr$CPlaceable + 7))(v6, pObject->instanceIndex);
    if ( (v4->m_flags & 0x10) != 0 )
      *(_DWORD *)&v6->m_nFlags |= 0x10000u;
    if ( v4->m_lodDistance >= 2.0 )
      goto LABEL_28;
    goto LABEL_27;
  }
  v6 = (CBuilding *)CDummy::operator new(0x3Cu);
  CDummyObject::CDummyObject((CDummyObject *)v6);
  (*((void (__fastcall **)(CBuilding *, int32))v6->_vptr$CPlaceable + 7))(v6, pObject->instanceIndex);
  if ( (*(_BYTE *)&v6->m_info & 7) == 4 )
  {
    v7 = CModelInfo::ms_modelInfoPtrs[v6->m_nModelIndex];
    v8 = (*((int (__fastcall **)(CBaseModelInfo *))v7->_vptr$CBaseModelInfo + 2))(v7);
    if ( v8 )
    {
      if ( (*(_WORD *)(v8 + 40) & 0x7000 | 0x800) == 10240
        && (CModelInfo::ms_modelInfoPtrs[v6->m_nModelIndex]->m_flags & 0x7800) != 10240 )
      {
LABEL_27:
        *(_DWORD *)&v6->m_nFlags &= ~0x80u;
      }
    }
  }
LABEL_28:
  quatx = pObject->quatx;
  quaty = pObject->quaty;
  if ( fabsf(quatx) > 0.05 )
    goto LABEL_33;
  if ( quaty == 0.0 )
    goto LABEL_70;
  v11 = quatx == 0.0;
  if ( quatx != 0.0 )
    v11 = (pObject->_anon_0.areaCodeAndFlags & 0x200) == 0;
  if ( v11 )
  {
LABEL_70:
    quatz = pObject->quatz;
    v26 = acosf(pObject->quatw);
    if ( quatz >= 0.0 )
      v27 = v26 * -2.0;
    else
      v27 = v26 + v26;
    p_m_pMat = &v6->m_pMat;
    m_pMat = v6->m_pMat;
    if ( m_pMat )
      CMatrix::SetRotateZOnly(m_pMat, v27);
    else
      v6->m_transform.m_heading = v27;
  }
  else
  {
LABEL_33:
    v12 = -pObject->quatz;
    pObject->quatx = -quatx;
    pObject->quaty = -quaty;
    pObject->quatz = v12;
    CPlaceable::AllocateStaticMatrix(v6);
    p_m_pMat = &v6->m_pMat;
    v13 = v6->m_pMat;
    if ( !v13 )
    {
      CPlaceable::AllocateMatrix(v6);
      CSimpleTransform::UpdateMatrix(&v6->m_transform, v6->m_pMat);
      v13 = v6->m_pMat;
    }
    v15 = *(_QWORD *)&pObject->quatz;
    *(_QWORD *)&v29.x = *(_QWORD *)&pObject->quatx;
    *(_QWORD *)&v29.z = v15;
    CMatrix::SetRotate(v13, &v29);
  }
  v16 = *(_QWORD *)&pObject->posx;
  posz = pObject->posz;
  if ( *p_m_pMat )
  {
    *(_QWORD *)&(*p_m_pMat)->tx = v16;
    p_tz = &(*p_m_pMat)->tz;
  }
  else
  {
    *(_QWORD *)&v6->m_transform.m_translate.x = v16;
    p_tz = &v6->m_transform.m_translate.z;
  }
  *p_tz = posz;
  areaCodeAndFlags = pObject->_anon_0.areaCodeAndFlags;
  if ( (areaCodeAndFlags & 0x400) != 0 )
  {
    *(_DWORD *)&v6->m_nFlags |= 0x100000u;
    areaCodeAndFlags = pObject->_anon_0.areaCodeAndFlags;
  }
  if ( (areaCodeAndFlags & 0x800) != 0 )
  {
    *(_DWORD *)&v6->m_nFlags |= 0x40000000u;
    areaCodeAndFlags = pObject->_anon_0.areaCodeAndFlags;
  }
  if ( (areaCodeAndFlags & 0x1000) != 0 )
  {
    *(_DWORD *)&v6->m_nFlags |= 0x80000000;
    areaCodeAndFlags = pObject->_anon_0.areaCodeAndFlags;
  }
  if ( (areaCodeAndFlags & 0x100) != 0 )
  {
    *(_DWORD *)&v6->m_nFlags |= 0x20000000u;
    areaCodeAndFlags = pObject->_anon_0.areaCodeAndFlags;
  }
  v6->m_areaCode = areaCodeAndFlags;
  v6->m_pLod = (CEntity *)pObject->lodIndex;
  if ( pObject->instanceIndex == MI_TRAINCROSSING )
  {
    if ( !*p_m_pMat )
    {
      CPlaceable::AllocateMatrix(v6);
      CSimpleTransform::UpdateMatrix(&v6->m_transform, *p_m_pMat);
    }
    CPlaceable::AllocateStaticMatrix(v6);
    v20 = *p_m_pMat;
    if ( !*p_m_pMat )
    {
      CPlaceable::AllocateMatrix(v6);
      CSimpleTransform::UpdateMatrix(&v6->m_transform, *p_m_pMat);
      v20 = *p_m_pMat;
    }
    CObject::SetMatrixForTrainCrossing(v20, 1.3509);
  }
  m_pColModel = CModelInfo::ms_modelInfoPtrs[v6->m_nModelIndex]->m_pColModel;
  if ( m_pColModel )
  {
    if ( *((unsigned __int8 *)m_pColModel + 41) << 31 )
    {
      if ( m_pColModel->m_level )
      {
        (*((void (__fastcall **)(CQuaternion *, CBuilding *))v6->_vptr$CPlaceable + 10))(&v29, v6);
        BoundingBox = CColStore::GetBoundingBox(m_pColModel->m_level);
        if ( v29.x < BoundingBox->left )
          BoundingBox->left = v29.x;
        if ( v29.z > BoundingBox->right )
          BoundingBox->right = v29.z;
        if ( v29.w < BoundingBox->bottom )
          BoundingBox->bottom = v29.w;
        if ( v29.y > BoundingBox->top )
          BoundingBox->top = v29.y;
      }
    }
    else
    {
      *(_DWORD *)&v6->m_nFlags &= ~1u;
    }
    p_tx = (int)&(*p_m_pMat)->tx;
    if ( !*p_m_pMat )
      p_tx = (int)&v6->m_transform;
    if ( (float)(*(float *)(p_tx + 8) + v4->m_pColModel->m_boxBound.m_vecMin.z) < 0.0 )
      *(_DWORD *)&v6->m_nFlags |= 0x100000u;
  }
  return v6;
}
// 66201C: using guessed type void *;

//----- (003F09D8) --------------------------------------------------------
void __fastcall CFileLoader::LoadCarGenerator(CFileCarGenerator *pFileCarGen, int32 level)
{
  int CarGenerator; // r0

  CarGenerator = CTheCarGenerators::CreateCarGenerator(
                   pFileCarGen->m_x,
                   pFileCarGen->m_y,
                   pFileCarGen->m_z,
                   (float)(pFileCarGen->m_r * 180.0) / 3.1416,
                   pFileCarGen->m_modelID,
                   pFileCarGen->m_col1,
                   pFileCarGen->m_col2,
                   pFileCarGen->m_flagVal & 1,
                   pFileCarGen->m_alarmChance,
                   pFileCarGen->m_lockedChance,
                   pFileCarGen->m_minDelay,
                   pFileCarGen->m_maxDelay,
                   level,
                   pFileCarGen->m_flagVal & 2);
  if ( CarGenerator >= 0 )
    sub_18DF84(&CTheCarGenerators::CarGeneratorArray[(unsigned __int16)CarGenerator]);
}

//----- (003F0A70) --------------------------------------------------------
CollisionVector *__fastcall NormalCollisionVectorFixup(CompressedVector *v, int num)
{
  int v2; // r4
  CollisionVector *result; // r0
  RwReal *p_y; // r1
  CompressedFloat *v6; // r2
  int v7; // r3

  v2 = num;
  result = (CollisionVector *)malloc(12 * num);
  if ( v2 >= 1 )
  {
    p_y = &result->y;
    v6 = &v->y;
    do
    {
      --v2;
      *(p_y - 1) = (float)*(v6 - 1) * 0.00024414;
      *p_y = (float)*v6 * 0.00024414;
      v7 = v6[1];
      v6 += 3;
      p_y[1] = (float)v7 * 0.00024414;
      p_y += 3;
    }
    while ( v2 );
  }
  return result;
}

//----- (003F0AE0) --------------------------------------------------------
CColTrianglePlane *__fastcall CSerializedColTrianglePlane::Fixup(CSerializedColTrianglePlane *fromArray, int num)
{
  int v2; // r4
  CColTrianglePlane *result; // r0
  RwReal *p_z; // r2
  int v6; // r3

  v2 = num;
  result = (CColTrianglePlane *)malloc(20 * num);
  if ( v2 >= 1 )
  {
    p_z = &result->m_compressedNormal.z;
    v6 = 0;
    do
    {
      --v2;
      *(p_z - 2) = (float)fromArray[v6].m_compressedNormal.x * 0.00024414;
      *(p_z - 1) = (float)fromArray[v6].m_compressedNormal.y * 0.00024414;
      *p_z = (float)fromArray[v6].m_compressedNormal.z * 0.00024414;
      p_z[1] = (float)fromArray[v6].m_compressedNormalOffset;
      p_z += 5;
      result[v6].m_nPrincipalAxis = fromArray[v6].m_nPrincipalAxis;
      ++v6;
    }
    while ( v2 );
  }
  return result;
}

//----- (003F0B74) --------------------------------------------------------
void CFileMgr::Initialise()
{
  unsigned __int8 *ArchiveName; // r4
  ZIPFile *v1; // r0
  unsigned __int8 *v2; // r4
  ZIPFile *v3; // r0

  ArchiveName = OS_FileGetArchiveName(OSFA_DataMain);
  v1 = ZIP_FileCreate(ArchiveName);
  if ( v1 )
    ZIP_AddStorage(v1);
  free(ArchiveName);
  v2 = OS_FileGetArchiveName(OSFA_DataPatch);
  v3 = ZIP_FileCreate(v2);
  if ( v3 )
    ZIP_AddStorage(v3);
  free(v2);
  if ( OS_ServiceAppCommand("IsAmazonBuild", (const unsigned __int8 *)&byte_61CADE) )
    AddAmazonFiles(0);
  CFileMgr::fileDataArea = OSFDA_Storage_0;
}
// 61CADE: using guessed type char byte_61CADE;

//----- (003F0BE4) --------------------------------------------------------
void __fastcall CFileMgr::ChangeDir(const unsigned __int8 *pDirName)
{
  const unsigned __int8 *v1; // r4
  int v2; // r0
  int v3; // t1

  v1 = pDirName;
  CFileMgr::fileDataArea = OSFDA_Storage_0;
  v2 = *pDirName;
  if ( v2 == 92 )
  {
    strcpy((char *)CFileMgr::ms_dirName, (const char *)CFileMgr::ms_rootDirName);
    v3 = *++v1;
    v2 = v3;
  }
  if ( v2 )
  {
    strcat((char *)CFileMgr::ms_dirName, (const char *)v1);
    if ( v1[strlen((const char *)v1) - 1] != 92 )
      *(_WORD *)&CFileMgr::ms_dirName[strlen((const char *)CFileMgr::ms_dirName)] = 92;
  }
}

//----- (003F0C54) --------------------------------------------------------
void __fastcall CFileMgr::SetDir(const unsigned __int8 *pDirName)
{
  CFileMgr::fileDataArea = OSFDA_Storage_0;
  strcpy((char *)CFileMgr::ms_dirName, (const char *)CFileMgr::ms_rootDirName);
  if ( *pDirName )
  {
    strcat((char *)CFileMgr::ms_dirName, (const char *)pDirName);
    if ( pDirName[strlen((const char *)pDirName) - 1] != 92 )
      *(_WORD *)&CFileMgr::ms_dirName[strlen((const char *)CFileMgr::ms_dirName)] = 92;
  }
}

//----- (003F0CBC) --------------------------------------------------------
void CFileMgr::SetDirMyDocuments()
{
  CFileMgr::fileDataArea = OSFDA_User_0;
}

//----- (003F0CCC) --------------------------------------------------------
OSFileError __fastcall OSWOpenFile(
        OSFileDataArea area,
        OSFile *intoFile,
        const unsigned __int8 *filename,
        OSFileAccessType type)
{
  char v9[512]; // [sp+4h] [bp-21Ch] BYREF

  if ( strchr((const char *)filename, 58) )
    return sub_19F4CC(area, intoFile, filename, type);
  strcpy(v9, (const char *)CFileMgr::ms_dirName);
  strcat(v9, (const char *)filename);
  return OS_FileOpen(area, intoFile, (const unsigned __int8 *)v9, type);
}

//----- (003F0D70) --------------------------------------------------------
u_native __fastcall CFileMgr::LoadFile(
        const unsigned __int8 *pFilename,
        uint8 *pBuffer,
        int32 bufferSize,
        const unsigned __int8 *pReadString)
{
  OSFileDataArea v7; // r5
  OSFileDataArea v8; // r0
  const unsigned __int8 *v9; // r2
  unsigned int v10; // r0
  OSFile file; // [sp+0h] [bp-220h] BYREF
  char v13[512]; // [sp+4h] [bp-21Ch] BYREF

  v7 = CFileMgr::fileDataArea;
  if ( strchr((const char *)pFilename, 58) )
  {
    v8 = v7;
    v9 = pFilename;
  }
  else
  {
    strcpy(v13, (const char *)CFileMgr::ms_dirName);
    strcat(v13, (const char *)pFilename);
    v8 = v7;
    v9 = (const unsigned __int8 *)v13;
  }
  if ( OS_FileOpen(v8, &file, v9, OSFAT_Read_0) )
    return -1;
  v10 = OS_FileSize(file);
  if ( v10 < bufferSize )
    bufferSize = v10;
  OS_FileRead(file, pBuffer, bufferSize);
  pBuffer[bufferSize] = 0;
  OS_FileClose(file);
  return bufferSize;
}

//----- (003F0E24) --------------------------------------------------------
u_native __fastcall CFileMgr::OpenFile(const unsigned __int8 *pFilename, const unsigned __int8 *pReadString)
{
  signed int v3; // r4
  int v4; // r0
  OSFileDataArea v5; // r6
  OSFileDataArea v6; // r0
  const unsigned __int8 *v7; // r2
  OSFileError v8; // r0
  signed int v10; // [sp+0h] [bp-218h] BYREF
  char v11[512]; // [sp+4h] [bp-214h] BYREF

  v3 = 0;
  v10 = 0;
  v4 = *pReadString;
  if ( v4 != 97 )
  {
    if ( v4 == 119 )
      v3 = 1;
    v5 = CFileMgr::fileDataArea;
    if ( strchr((const char *)pFilename, 58) )
    {
      v6 = v5;
      v7 = pFilename;
    }
    else
    {
      strcpy(v11, (const char *)CFileMgr::ms_dirName);
      strcat(v11, (const char *)pFilename);
      v6 = v5;
      v7 = (const unsigned __int8 *)v11;
    }
    v8 = OS_FileOpen(v6, (OSFile *)&v10, v7, (OSFileAccessType)v3);
    v3 = v10;
    if ( v8 )
      return 0;
  }
  return v3;
}

//----- (003F0EC0) --------------------------------------------------------
u_native __fastcall CFileMgr::OpenFileForWriting(const unsigned __int8 *pFilename)
{
  return CFileMgr::OpenFile(pFilename, (const unsigned __int8 *)&dword_3F0EC4);
}
// 3F0EC4: using guessed type int;

//----- (003F0EC8) --------------------------------------------------------
u_native __fastcall CFileMgr::OpenFileForAppending(const unsigned __int8 *pFilename)
{
  return CFileMgr::OpenFile(pFilename, (const unsigned __int8 *)&off_3F0ECC);
}
// 3F0ECC: using guessed type void *;

//----- (003F0ED0) --------------------------------------------------------
int32 __fastcall CFileMgr::Read_old(u_native id, unsigned __int8 *pData, int32 size)
{
  int32 v3; // r4

  v3 = size;
  if ( OS_FileRead((OSFile)id, pData, size) )
    return 0;
  return v3;
}

//----- (003F0EE4) --------------------------------------------------------
int32 __fastcall CFileMgr::ReadBytes(u_native id, unsigned __int8 *pData, int32 size)
{
  int32 v3; // r4

  v3 = size;
  if ( OS_FileRead((OSFile)id, pData, size) )
    return 0;
  return v3;
}

//----- (003F0EF8) --------------------------------------------------------
int32 __fastcall CFileMgr::Write(u_native id, unsigned __int8 *pData, int32 size)
{
  int32 v3; // r4

  v3 = size;
  if ( OS_FileWrite((OSFile)id, pData, size) )
    return 0;
  return v3;
}

//----- (003F0F0C) --------------------------------------------------------
bool __fastcall CFileMgr::Seek(u_native id, int32 offset, int32 origin)
{
  int32 v3; // r5
  u_native v4; // r4
  int Position; // r0

  v3 = offset;
  v4 = id;
  if ( origin )
  {
    if ( origin == 2 )
    {
      Position = OS_FileSize((OSFile)id);
    }
    else
    {
      if ( origin != 1 )
        return 0;
      Position = OS_FileGetPosition((OSFile)id);
    }
    offset = Position + v3;
    id = v4;
  }
  OS_FileSetPosition((OSFile)id, offset);
  return 1;
}

//----- (003F0F42) --------------------------------------------------------
bool __fastcall CFileMgr::ReadLine(u_native id, unsigned __int8 *pLine, int32 maxLen)
{
  int32 v3; // r6
  int v6; // r10
  int Position; // r4
  OSFileError v8; // r0
  int v9; // r11
  int v10; // r1
  int v11; // r0
  unsigned __int8 *v12; // r10
  unsigned __int8 *v13; // r4
  int32 v14; // r8
  int v15; // r0
  int v16; // t1
  int v17; // r6
  int v18; // r11
  unsigned __int8 *v19; // r4
  int v20; // r0
  int v23; // [sp+0h] [bp-20h]

  v3 = maxLen;
  v6 = maxLen - 1;
  Position = OS_FileGetPosition((OSFile)id);
  v8 = OS_FileRead((OSFile)id, pLine, v6);
  if ( v8 == OSFE_EndOfFile )
  {
    OS_FileSetPosition((OSFile)id, Position);
    v17 = 0;
    if ( OS_FileRead((OSFile)id, pLine, 1) == OSFE_NoError )
    {
      v18 = 0;
      v19 = pLine;
      while ( 1 )
      {
        v17 = v18 + 1;
        if ( v18 + 1 == v6 )
          break;
        while ( 1 )
        {
          v20 = *v19;
          if ( v20 != 13 )
            break;
          if ( OS_FileRead((OSFile)id, v19, 1) )
          {
            v17 = v18;
            goto LABEL_31;
          }
        }
        if ( v20 != 10 )
        {
          v19 = &pLine[v17];
          ++v18;
          if ( OS_FileRead((OSFile)id, &pLine[v17], 1) == OSFE_NoError )
            continue;
        }
        goto LABEL_31;
      }
      v17 = v6;
    }
LABEL_31:
    pLine[v17] = 0;
    return v17 != 0;
  }
  else if ( v8 )
  {
    return 0;
  }
  else
  {
    v9 = 0;
    if ( v3 < 1 || (v10 = *pLine, v10 == 10) )
    {
      v11 = 0;
    }
    else
    {
      v23 = Position;
      v9 = 0;
      v11 = 0;
      v12 = pLine;
      do
      {
        v13 = v12 + 1;
        v14 = v11 + 1;
        while ( (unsigned __int8)v10 != 13 )
        {
          v15 = v14 + 1;
          if ( v3 > v14 )
          {
            v16 = *v13++;
            LOBYTE(v10) = v16;
            ++v14;
            if ( v16 != 10 )
              continue;
          }
          v11 = v15 - 1;
          goto LABEL_26;
        }
        v12 = v13 - 1;
        memmove(v13 - 1, v13, v3 - v14);
        v11 = v14 - 1;
        --v3;
        ++v9;
        if ( v3 <= v14 - 1 )
          break;
        v10 = *(v13 - 1);
      }
      while ( v10 != 10 );
LABEL_26:
      Position = v23;
    }
    if ( pLine[v11] == 10 )
    {
      pLine[v11] = 0;
      OS_FileSetPosition((OSFile)id, v11 + Position + v9 + 1);
    }
    else
    {
      pLine[v3] = 0;
    }
    return 1;
  }
}

//----- (003F107A) --------------------------------------------------------
int32 __fastcall CFileMgr::CloseFile(u_native id)
{
  return OS_FileClose((OSFile)id) != OSFE_NoError;
}

//----- (003F1096) --------------------------------------------------------
int __fastcall CFileMgr::GetErrorReadWrite(u_native FileHandle)
{
  return 0;
}

//----- (003F109A) --------------------------------------------------------
int32 CFileMgr::GetCdError()
{
  return 0;
}

//----- (003F109E) --------------------------------------------------------
const unsigned __int8 *__fastcall CFileMgr::GetCdErrorString(int32 err)
{
  return 0;
}

//----- (003F10A2) --------------------------------------------------------
bool __fastcall CFileMgr::GetCdFile(const unsigned __int8 *pFilename, uint32 *posn, uint32 *size)
{
  return 0;
}

//----- (003F10A6) --------------------------------------------------------
int32 __fastcall CFileMgr::ReadCd(uint32 sector, unsigned __int8 *pData, uint32 size)
{
  return 0;
}

//----- (003F10AA) --------------------------------------------------------
int CFileMgr::SyncCd()
{
  return 0;
}

//----- (003F10B0) --------------------------------------------------------
void __fastcall CFire::CFire(CFire *this)
{
  char v1; // r1

  this->ScriptReferenceIndex = 1;
  v1 = *(_BYTE *)this;
  *(_QWORD *)&this->m_vLocation.x = 0LL;
  *(_QWORD *)&this->m_vLocation.z = 0LL;
  this->m_pEntityStartedFire = 0;
  this->m_nTimeToBurn = 0;
  this->m_Strength = 1.0;
  this->m_fxSysPtr = 0;
  *(_WORD *)&this->m_nNumGenerationsAllowed = 15460;
  *(_BYTE *)this = v1 & 0xE0 | 0x14;
}

//----- (003F10E0) --------------------------------------------------------
void __fastcall CFire::Initialise(CFire *this)
{
  char v1; // r1

  this->ScriptReferenceIndex = 1;
  v1 = *(_BYTE *)this;
  *(_QWORD *)&this->m_vLocation.x = 0LL;
  *(_QWORD *)&this->m_vLocation.z = 0LL;
  this->m_pEntityStartedFire = 0;
  this->m_nTimeToBurn = 0;
  this->m_Strength = 1.0;
  this->m_fxSysPtr = 0;
  *(_WORD *)&this->m_nNumGenerationsAllowed = 15460;
  *(_BYTE *)this = v1 & 0xE0 | 0x14;
}

//----- (003F1112) --------------------------------------------------------
void __fastcall CFireManager::CFireManager(CFireManager *this)
{
  CFireManager *v1; // r4
  char v2; // r5
  CEntity **p_m_pEntityStartedFire; // r6
  int v4; // r4
  char *v5; // r6

  v1 = this;
  do
  {
    v1->m_Fires[0].ScriptReferenceIndex = 1;
    v2 = (char)v1->m_Fires[0];
    *(_QWORD *)&v1->m_Fires[0].m_vLocation.x = 0LL;
    *(_QWORD *)&v1->m_Fires[0].m_vLocation.z = 0LL;
    p_m_pEntityStartedFire = &v1->m_Fires[0].m_pEntityStartedFire;
    v1->m_Fires[0].m_Strength = 1.0;
    *(_BYTE *)v1->m_Fires = v2 & 0xE0 | 0x14;
    v1->m_Fires[0].m_fxSysPtr = 0;
    *(_WORD *)&v1->m_Fires[0].m_nNumGenerationsAllowed = 15460;
    v1 = (CFireManager *)((char *)v1 + 40);
    *p_m_pEntityStartedFire = 0;
    p_m_pEntityStartedFire[1] = 0;
  }
  while ( v1 != (CFireManager *)&this->m_nMaxGenerationsAllowed );
  v4 = 0;
  do
  {
    *(_BYTE *)&this->m_Fires[v4] = *(_BYTE *)&this->m_Fires[v4] & 0xE0 | 0x14;
    v5 = (char *)this + v4 * 40;
    ++v4;
    *((_WORD *)v5 + 1) = 1;
    *((_DWORD *)v5 + 5) = 0;
    *((_DWORD *)v5 + 6) = 0;
    *((_DWORD *)v5 + 7) = 1065353216;
    *((_DWORD *)v5 + 9) = 0;
    *((_WORD *)v5 + 16) = 15460;
    v5 += 4;
    *(_QWORD *)v5 = 0LL;
    *((_QWORD *)v5 + 1) = 0LL;
  }
  while ( v4 != 60 );
  this->m_nMaxGenerationsAllowed = 999999;
}

//----- (003F11AC) --------------------------------------------------------
void __fastcall CFireManager::Init(CFireManager *this)
{
  int v1; // r3
  char *v2; // r4

  v1 = 0;
  do
  {
    *(_BYTE *)&this->m_Fires[v1] = *(_BYTE *)&this->m_Fires[v1] & 0xE0 | 0x14;
    v2 = (char *)this + v1 * 40;
    ++v1;
    *((_WORD *)v2 + 1) = 1;
    *((_DWORD *)v2 + 5) = 0;
    *((_DWORD *)v2 + 6) = 0;
    *((_DWORD *)v2 + 7) = 1065353216;
    *((_DWORD *)v2 + 9) = 0;
    *((_WORD *)v2 + 16) = 15460;
    v2 += 4;
    *(_QWORD *)v2 = 0LL;
    *((_QWORD *)v2 + 1) = 0LL;
  }
  while ( v1 != 60 );
  this->m_nMaxGenerationsAllowed = 999999;
}

//----- (003F1202) --------------------------------------------------------
void __fastcall CFireManager::Shutdown(CFireManager *this)
{
  int i; // r6
  char v3; // r0
  char *v4; // r5
  FxSystem_c *m_fxSysPtr; // r0
  int v6; // r0
  CEntity **v7; // r1
  int v8; // r2
  _DWORD *v9; // r0
  CEntity *v10; // r0

  for ( i = 0; i != 60; ++i )
  {
    v3 = (char)this->m_Fires[i];
    *(_BYTE *)&this->m_Fires[i] = v3 & 0xFD;
    if ( (v3 & 1) != 0 )
    {
      v4 = (char *)this + i * 40;
      *(_BYTE *)&this->m_Fires[i] = v3 & 0xE4 | 0x10;
      m_fxSysPtr = this->m_Fires[i].m_fxSysPtr;
      this->m_Fires[i].m_nTimeToBurn = 0;
      if ( m_fxSysPtr )
      {
        FxSystem_c::Kill(m_fxSysPtr);
        *((_DWORD *)v4 + 9) = 0;
      }
      v7 = (CEntity **)(v4 + 16);
      v6 = *((_DWORD *)v4 + 4);
      if ( v6 )
      {
        v8 = *(_BYTE *)(v6 + 58) & 7;
        if ( v8 == 2 )
        {
          v9 = (_DWORD *)(v6 + 1172);
        }
        else
        {
          if ( v8 != 3 )
          {
            CEntity::CleanUpOldReference((CEntity *)v6, v7);
LABEL_14:
            *((_DWORD *)v4 + 4) = 0;
            continue;
          }
          v9 = (_DWORD *)(v6 + 1848);
        }
        *v9 = 0;
        v10 = (CEntity *)*((_DWORD *)v4 + 4);
        if ( v10 )
          CEntity::CleanUpOldReference(v10, v7);
        goto LABEL_14;
      }
    }
  }
}

//----- (003F1284) --------------------------------------------------------
void __fastcall CFire::Extinguish(CFire *this)
{
  char v2; // r1
  FxSystem_c *m_fxSysPtr; // r0
  CEntity *v4; // r0
  CEntity **p_m_pEntityOnFire; // r4
  CEntity *m_pEntityOnFire; // t1
  int v7; // r1
  _DWORD *p_bdummy; // r0

  v2 = *(_BYTE *)this;
  if ( (*(_BYTE *)this & 1) != 0 )
  {
    this->m_nTimeToBurn = 0;
    m_fxSysPtr = this->m_fxSysPtr;
    *(_BYTE *)this = v2 & 0xE6 | 0x10;
    if ( m_fxSysPtr )
    {
      FxSystem_c::Kill(m_fxSysPtr);
      this->m_fxSysPtr = 0;
    }
    m_pEntityOnFire = this->m_pEntityOnFire;
    p_m_pEntityOnFire = &this->m_pEntityOnFire;
    v4 = m_pEntityOnFire;
    if ( m_pEntityOnFire )
    {
      v7 = *(_BYTE *)&v4->m_info & 7;
      if ( v7 == 2 )
      {
        p_bdummy = &v4[19].m_nFlags.bdummy;
      }
      else
      {
        if ( v7 != 3 )
          goto LABEL_10;
        p_bdummy = &v4[30].m_nScanCode;
      }
      *p_bdummy = 0;
      v4 = *p_m_pEntityOnFire;
      if ( !*p_m_pEntityOnFire )
      {
LABEL_11:
        *p_m_pEntityOnFire = 0;
        return;
      }
LABEL_10:
      CEntity::CleanUpOldReference(v4, p_m_pEntityOnFire);
      goto LABEL_11;
    }
  }
}

//----- (003F12E2) --------------------------------------------------------
CFire *__fastcall CFireManager::GetNextFreeFire(CFireManager *this, Bool8 bCanOverwriteAnExistingFire)
{
  int v2; // r2
  CFireManager *i; // r4
  int v4; // r1
  char v5; // r2
  FxSystem_c *m_fxSysPtr; // r0
  CEntity *m_pEntityOnFire; // r0
  CEntity **p_m_pEntityOnFire; // r1
  int v10; // r2
  _DWORD *p_bdummy; // r0

  v2 = -1;
  i = this;
  do
  {
    if ( !(*(_BYTE *)i->m_Fires << 30) )
      return i->m_Fires;
    ++v2;
    i = (CFireManager *)((char *)i + 40);
  }
  while ( v2 <= 58 );
  if ( !bCanOverwriteAnExistingFire )
    return 0;
  v4 = -1;
  for ( i = this; ; i = (CFireManager *)((char *)i + 40) )
  {
    v5 = (char)i->m_Fires[0];
    if ( (*(_BYTE *)i->m_Fires & 0x12) != 18 )
      break;
    if ( ++v4 >= 59 )
      return 0;
  }
  *(_BYTE *)i->m_Fires = v5 & 0xFD;
  if ( (v5 & 1) == 0 )
    return i->m_Fires;
  i->m_Fires[0].m_nTimeToBurn = 0;
  m_fxSysPtr = i->m_Fires[0].m_fxSysPtr;
  *(_BYTE *)i->m_Fires = v5 & 0xE4 | 0x10;
  if ( m_fxSysPtr )
  {
    FxSystem_c::Kill(m_fxSysPtr);
    i->m_Fires[0].m_fxSysPtr = 0;
  }
  p_m_pEntityOnFire = &i->m_Fires[0].m_pEntityOnFire;
  m_pEntityOnFire = i->m_Fires[0].m_pEntityOnFire;
  if ( !m_pEntityOnFire )
    return i->m_Fires;
  v10 = *(_BYTE *)&m_pEntityOnFire->m_info & 7;
  if ( v10 == 2 )
  {
    p_bdummy = &m_pEntityOnFire[19].m_nFlags.bdummy;
LABEL_18:
    *p_bdummy = 0;
    if ( *p_m_pEntityOnFire )
      CEntity::CleanUpOldReference(*p_m_pEntityOnFire, p_m_pEntityOnFire);
    goto LABEL_22;
  }
  if ( v10 == 3 )
  {
    p_bdummy = &m_pEntityOnFire[30].m_nScanCode;
    goto LABEL_18;
  }
  CEntity::CleanUpOldReference(m_pEntityOnFire, p_m_pEntityOnFire);
LABEL_22:
  i->m_Fires[0].m_pEntityOnFire = 0;
  return i->m_Fires;
}

//----- (003F137E) --------------------------------------------------------
UInt16 __fastcall CFireManager::GetNumOfNonScriptFires(CFireManager *this)
{
  __int64 v1; // d17
  __int64 v2; // d16
  int64x2_t v3; // q12
  __int64 v4; // d18
  __int64 v5; // d21
  __int64 v6; // d20
  __int64 v7; // d19
  __int64 v8; // d22
  char v9; // r12
  bool v10; // zf
  int v11; // r2
  int v12; // r0
  int8x16_t v13; // q8
  int8x16_t v14; // q8
  int16x8_t v15; // q8
  unsigned __int16 v16; // d16.h[0]
  UInt16 v17; // r1

  LOBYTE(v1) = this->m_Fires[0];
  LOBYTE(v2) = this->m_Fires[8];
  v3.n128_u64[0] = 0x1000100010001LL;
  v3.n128_u64[1] = 0x1000100010001LL;
  LOBYTE(v4) = this->m_Fires[32];
  LOBYTE(v5) = this->m_Fires[40];
  LOBYTE(v6) = this->m_Fires[24];
  BYTE1(v1) = this->m_Fires[1];
  LOBYTE(v7) = this->m_Fires[16];
  BYTE1(v2) = this->m_Fires[9];
  BYTE1(v4) = this->m_Fires[33];
  BYTE1(v5) = this->m_Fires[41];
  BYTE1(v6) = this->m_Fires[25];
  BYTE2(v1) = this->m_Fires[2];
  BYTE1(v7) = this->m_Fires[17];
  LOBYTE(v8) = this->m_Fires[48];
  BYTE2(v2) = this->m_Fires[10];
  BYTE2(v4) = this->m_Fires[34];
  BYTE2(v5) = this->m_Fires[42];
  BYTE2(v6) = this->m_Fires[26];
  BYTE3(v1) = this->m_Fires[3];
  BYTE2(v7) = this->m_Fires[18];
  BYTE1(v8) = this->m_Fires[49];
  BYTE3(v2) = this->m_Fires[11];
  BYTE3(v4) = this->m_Fires[35];
  BYTE3(v5) = this->m_Fires[43];
  BYTE3(v6) = this->m_Fires[27];
  BYTE4(v1) = this->m_Fires[4];
  BYTE3(v7) = this->m_Fires[19];
  BYTE2(v8) = this->m_Fires[50];
  BYTE4(v2) = this->m_Fires[12];
  BYTE4(v4) = this->m_Fires[36];
  BYTE4(v5) = this->m_Fires[44];
  BYTE4(v6) = this->m_Fires[28];
  BYTE5(v1) = this->m_Fires[5];
  BYTE4(v7) = this->m_Fires[20];
  BYTE3(v8) = this->m_Fires[51];
  BYTE5(v2) = this->m_Fires[13];
  BYTE5(v4) = this->m_Fires[37];
  BYTE5(v5) = this->m_Fires[45];
  BYTE5(v6) = this->m_Fires[29];
  BYTE6(v1) = this->m_Fires[6];
  BYTE5(v7) = this->m_Fires[21];
  BYTE4(v8) = this->m_Fires[52];
  BYTE6(v2) = this->m_Fires[14];
  BYTE6(v4) = this->m_Fires[38];
  BYTE6(v5) = this->m_Fires[46];
  BYTE6(v6) = this->m_Fires[30];
  HIBYTE(v1) = this->m_Fires[7];
  BYTE6(v7) = this->m_Fires[22];
  BYTE5(v8) = this->m_Fires[53];
  HIBYTE(v2) = this->m_Fires[15];
  HIBYTE(v4) = this->m_Fires[39];
  HIBYTE(v5) = this->m_Fires[47];
  HIBYTE(v6) = this->m_Fires[31];
  HIBYTE(v7) = this->m_Fires[23];
  BYTE6(v8) = this->m_Fires[54];
  HIBYTE(v8) = this->m_Fires[55];
  v9 = (char)this->m_Fires[58];
  v10 = (*(_BYTE *)&this->m_Fires[56] & 3) == 1;
  v11 = *(_BYTE *)&this->m_Fires[57] & 3;
  v12 = *(_BYTE *)&this->m_Fires[59] & 3;
  v13 = vaddq_s16(
          vaddq_s16(
            vaddq_s16(
              vaddq_s16(
                vaddq_s16(
                  vaddq_s16(
                    vandq_s64(
                      vmovl_u8(vceq_s8((int8x8_t)(v1 & 0x303030303030303LL), (int8x8_t)0x101010101010101LL)),
                      v3),
                    vandq_s64(
                      vmovl_u8(vceq_s8((int8x8_t)(v2 & 0x303030303030303LL), (int8x8_t)0x101010101010101LL)),
                      v3)),
                  vandq_s64(vmovl_u8(vceq_s8((int8x8_t)(v7 & 0x303030303030303LL), (int8x8_t)0x101010101010101LL)), v3)),
                vandq_s64(vmovl_u8(vceq_s8((int8x8_t)(v6 & 0x303030303030303LL), (int8x8_t)0x101010101010101LL)), v3)),
              vandq_s64(vmovl_u8(vceq_s8((int8x8_t)(v4 & 0x303030303030303LL), (int8x8_t)0x101010101010101LL)), v3)),
            vandq_s64(vmovl_u8(vceq_s8((int8x8_t)(v5 & 0x303030303030303LL), (int8x8_t)0x101010101010101LL)), v3)),
          vandq_s64(vmovl_u8(vceq_s8((int8x8_t)(v8 & 0x303030303030303LL), (int8x8_t)0x101010101010101LL)), v3));
  v14 = vaddq_s16(v13, vextq_s8(v13, v13, 8u));
  v15 = vaddq_s16(v14, vextq_s8(v14, v14, 4u));
  v16 = vaddq_s16(v15, vdupq_lane_s16((int16x4_t)v15.n128_u64[0], 1)).n128_u16[0];
  v17 = v16;
  if ( v10 )
    v17 = v16 + 1;
  if ( v11 == 1 )
    ++v17;
  if ( (v9 & 3) == 1 )
    ++v17;
  if ( v12 == 1 )
    ++v17;
  return v17;
}

//----- (003F1628) --------------------------------------------------------
void __fastcall CFireManager::Update(CFireManager *this)
{
  float32x2_t v1; // d1
  float32x2_t v2; // d13
  int i; // r4
  float zy; // s16
  float v6; // s20
  float v7; // s18
  float v8; // s0
  CSimpleTransform *p_m_transform; // r5
  CSimpleTransform *p_tx; // r4
  float v11; // r0
  float v12; // s20
  float v13; // r0
  float z; // s4
  float v15; // s22
  float GroundZFor3DCoord; // s18
  RwReal v17; // s2
  RwReal v18; // s4
  float xy; // s0
  float yy; // s2
  float m_heading; // r5
  float v22; // r4
  bool v23; // zf
  __int64 v24; // kr00_8
  float v25; // r8
  FxSystem_c *FxSystem; // r0
  int v27; // r4
  int j; // r0
  char v29; // r1
  float *p_m_Strength; // r6
  float v31; // s0
  int v32; // r0
  int v33; // r1
  float *v34; // r2
  float v35; // s18
  int v36; // r11
  int v37; // r9
  CFire *v38; // r0
  float *v39; // r10
  float32x2_t *p_m_vLocation; // r8
  float32x2_t v41; // d16
  unsigned __int64 v42; // d0
  float v43; // s28
  float v44; // r0
  int v45; // r0
  float v46; // s0
  CEntity **ppEnt; // [sp+0h] [bp-100h]
  __int64 Brightness; // [sp+10h] [bp-F0h]
  __int64 Green; // [sp+18h] [bp-E8h]
  float *v50; // [sp+3Ch] [bp-C4h]
  CFireManager *v51; // [sp+40h] [bp-C0h]
  u_native ID; // [sp+44h] [bp-BCh]
  CVector pCoors; // [sp+48h] [bp-B8h] BYREF
  CEntity *v54; // [sp+58h] [bp-A8h] BYREF
  bool pBool; // [sp+5Fh] [bp-A1h] BYREF
  __int64 offsetPos; // [sp+60h] [bp-A0h] BYREF
  __int64 offsetPos_8; // [sp+68h] [bp-98h]
  __int64 v58; // [sp+70h] [bp-90h]
  __int64 v59; // [sp+78h] [bp-88h]
  __int64 v60; // [sp+80h] [bp-80h]
  __int64 v61; // [sp+88h] [bp-78h]
  int v62; // [sp+90h] [bp-70h]
  __int64 v63; // [sp+94h] [bp-6Ch]

  for ( i = 0; i != 60; ++i )
  {
    if ( *(_BYTE *)&this->m_Fires[i] << 31 )
      CFire::ProcessFire(&this->m_Fires[i]);
  }
  if ( CGameLogic::LaRiotsActiveHere()
    && CTimer::m_snTimeInMilliseconds / 0x1F4 != CTimer::m_snPreviousTimeInMilliseconds / 0x1F4 )
  {
    zy = 0.0;
    v6 = (float)((float)((float)rand() * 4.6566e-10) * 6.2832) + 0.0;
    v7 = (float)((float)((float)rand() * 4.6566e-10) * 25.0) + 35.0;
    v8 = sinf(v6) * v7;
    p_m_transform = &TheCamera.m_transform;
    LODWORD(offsetPos_8) = 1092616192;
    p_tx = &TheCamera.m_transform;
    if ( TheCamera.m_pMat )
      p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    v11 = v6;
    v12 = p_tx->m_translate.x + v8;
    v13 = cosf(v11);
    *(float *)&offsetPos = v12;
    z = p_tx->m_translate.z;
    *((float *)&offsetPos + 1) = p_tx->m_translate.y + (float)(v13 * v7);
    v15 = *((float *)&offsetPos + 1);
    GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(v12, *((float *)&offsetPos + 1), z + 10.0, &pBool, &v54);
    *(float *)&offsetPos_8 = GroundZFor3DCoord;
    if ( TheCamera.m_pMat )
      p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    v17 = v15 - p_m_transform->m_translate.y;
    v18 = GroundZFor3DCoord - p_m_transform->m_translate.z;
    pCoors.x = v12 - p_m_transform->m_translate.x;
    pCoors.y = v17;
    pCoors.z = v18;
    CVector::Normalise(&pCoors);
    if ( TheCamera.m_pMat )
    {
      xy = TheCamera.m_pMat->xy;
      yy = TheCamera.m_pMat->yy;
      zy = TheCamera.m_pMat->zy;
    }
    else
    {
      m_heading = TheCamera.m_transform.m_heading;
      v22 = sinf(TheCamera.m_transform.m_heading);
      yy = cosf(m_heading);
      LODWORD(xy) = LODWORD(v22) ^ 0x80000000;
    }
    if ( v54 )
    {
      v23 = !pBool;
      if ( pBool )
        v23 = (*(_DWORD *)&v54->m_nFlags & 0x10000) == 0;
      if ( !v23 && GroundZFor3DCoord > 0.5 )
      {
        if ( (float)((float)((float)(xy * pCoors.x) + (float)(yy * pCoors.y)) + (float)(zy * pCoors.z)) > 0.2
          || (rand() & 1) != 0 )
        {
          FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, "riot_smoke", (RwV3d_0 *)&offsetPos, 0, 1);
          if ( FxSystem )
            FxSystem_c::PlayAndKill(FxSystem);
        }
        else
        {
          v24 = offsetPos;
          v25 = *(float *)&offsetPos_8;
          rand();
          CFireManager::StartFire(this, *(float *)&v24, *((float *)&v24 + 1), v25, *(float *)&ppEnt, 0, 0, 0x7530u, 5);
        }
      }
    }
  }
  v27 = 0;
  v62 = 0;
  v63 = 0LL;
  v60 = 0LL;
  v61 = 0LL;
  offsetPos = 0LL;
  offsetPos_8 = 0LL;
  v58 = 0LL;
  v59 = 0LL;
  for ( j = 0; j != 60; ++j )
  {
    v29 = (char)this->m_Fires[j];
    v27 += v29 & 1;
  }
  if ( v27 >= 1 )
  {
    p_m_Strength = &this->m_Fires[0].m_Strength;
    v2.n64_u32[0] = 7.0;
    v50 = &this->m_Fires[0].m_Strength;
    v51 = this;
    do
    {
      v31 = -1.0;
      v32 = -1;
      v33 = 0;
      v34 = p_m_Strength;
      do
      {
        if ( !*((_BYTE *)&offsetPos + v33) && *((unsigned __int8 *)v34 - 28) << 31 && *v34 > v31 )
        {
          v32 = v33;
          v31 = *v34;
        }
        ++v33;
        v34 += 10;
      }
      while ( v33 != 60 );
      v35 = 0.0;
      v36 = 0;
      v37 = 0;
      v38 = &this->m_Fires[v32];
      v39 = p_m_Strength;
      p_m_vLocation = (float32x2_t *)&v38->m_vLocation;
      ID = (u_native)v38;
      do
      {
        if ( !*((_BYTE *)&offsetPos + v36) )
        {
          if ( *((unsigned __int8 *)v39 - 28) << 31 )
          {
            v41.n64_u64[0] = vsub_f32(*(float32x2_t *)(v39 - 6), (float32x2_t)p_m_vLocation->n64_u64[0]).n64_u64[0];
            v42 = vmul_f32(v41, v41).n64_u64[0];
            if ( sqrtf(*(float *)&v42 + *((float *)&v42 + 1)) < 6.0 )
            {
              v43 = *v39;
              v44 = ceilf(*v39);
              --v27;
              v35 = v35 + v43;
              *((_BYTE *)&offsetPos + v36) = 1;
              v37 += (int)v44;
            }
          }
        }
        ++v36;
        v39 += 10;
      }
      while ( v36 != 60 );
      if ( v37 )
      {
        if ( v35 > 4.0 )
        {
          v45 = rand();
          pCoors = *(CVector *)(ID + 4);
          v1.n64_f32[0] = (float)(v35 + -6.0) + 3.0;
          v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
          pCoors.z = pCoors.z + 5.0;
          v46 = (float)((float)((float)v45 * 4.6566e-10) * 0.4) + 0.6;
          LODWORD(Brightness) = 0;
          HIDWORD(Green) = (unsigned int)(float)(v46 * 32.0);
          LODWORD(Green) = (unsigned int)(float)(v46 * 50.0);
          HIDWORD(Brightness) = (unsigned int)(float)(v46 * 64.0);
          CShadows::StoreStaticShadow(
            ID,
            2u,
            gpShadowExplosionTex,
            &pCoors,
            v1.n64_f32[0] * 1.2,
            0.0,
            0.0,
            v1.n64_f32[0] * -1.2,
            Brightness,
            Green,
            10.0,
            1.0,
            40.0,
            0,
            0.0);
        }
      }
      p_m_Strength = v50;
      this = v51;
    }
    while ( v27 > 0 );
  }
}
// 3F1854: variable 'ppEnt' is possibly undefined
// 3F1A14: variable 'v1' is possibly undefined
// 3F1A14: variable 'v2' is possibly undefined

//----- (003F1B08) --------------------------------------------------------
void __fastcall CFire::ProcessFire(CFire *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d8
  CEntity **p_m_pEntityOnFire; // r4
  CEntity *m_pEntityOnFire; // r6
  float m_Strength; // s4
  float v8; // s0
  float32x2_t v9; // d1
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v12; // d16
  int v13; // r0
  int v14; // r1
  FxSystem_c *m_fxSysPtr; // r0
  int v16; // r0
  _DWORD *p_bdummy; // r0
  bool v18; // zf
  int m_pLastRenderedLink; // r0
  const CMatrix *v20; // r1
  __int64 v21; // d16
  FxSystem_c *v22; // r0
  float *v23; // r1
  RwReal v24; // s4
  RwReal v25; // s0
  CPlayerPed *PlayerPed; // r0
  CMatrix *v27; // r1
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v29; // d16
  CPlayerPed *v30; // r0
  CPlayerPed *v31; // r0
  CVehiclePool *v32; // r4
  int32 m_nSize; // r0
  int v34; // r8
  float32x2_t *p_y; // r12
  int v36; // r6
  uint8 *v37; // r10
  int v38; // r1
  uint8 *v39; // r2
  float32x2_t v40; // d16
  CVehicle *v41; // r5
  CPlayerPed *v42; // r0
  CPlayerPed *v43; // r0
  float v44; // r3
  void (__fastcall *v45)(CVehicle *, _DWORD, _DWORD); // r10
  char TyreNearestPoint; // r0
  CObjectPool *v47; // r4
  int32 v48; // r0
  int v49; // r5
  int v50; // r6
  CObject *v51; // r0
  CMatrix *v52; // r1
  CSimpleTransform *v53; // r2
  float32x2_t v54; // d16
  int v55; // r0
  int v56; // r2
  char v57; // r3
  float v58; // s16
  int v59; // r0
  int v60; // r0
  float z; // s14
  float v62; // s0
  RwReal v63; // s6
  FxSystem_c *v64; // r0
  RwReal *v65; // r4
  CSimpleTransform *v66; // r3
  float32x2_t v67; // d16
  unsigned __int64 v68; // d0
  int v69; // r1
  float v70; // s0
  FxSystem_c *v71; // r0
  float v72; // s0
  char *v73; // r1
  FxSystem_c *v74; // r0
  char v75; // r0
  FxSystem_c *v76; // r0
  CEntity *v77; // r0
  int v78; // r1
  _DWORD *v79; // r0
  int v80; // r1
  unsigned int v81; // r6
  CFire *v82; // r4
  CFire *v83; // r9
  float y; // s4
  float v85; // s2
  float *v86; // r0
  float v87; // s6
  float v88; // s10
  float v89; // s8
  uint32 m_nTimeToBurn; // r1
  FxSystem_c *v91; // r0
  char *v92; // r1
  FxSystem_c *FxSystem; // r0
  char v94; // r0
  char *v95; // r4
  FxSystem_c *v96; // r0
  _DWORD *v97; // r4
  FxSystem_c *v98; // t1
  char *v99; // r6
  CEntity *v100; // r0
  CEntity **v101; // r6
  CEntity *v102; // t1
  int v103; // r1
  _DWORD *p_m_nScanCode; // r0
  CVector Pos; // [sp+0h] [bp-88h] BYREF
  CEntity **ppAddress; // [sp+34h] [bp-54h]
  CVector v107; // [sp+38h] [bp-50h] BYREF
  CVector v; // [sp+48h] [bp-40h] BYREF
  CVector v109; // 0:r0.12
  CVector v110; // 0:r1.12

  p_m_pEntityOnFire = &this->m_pEntityOnFire;
  m_pEntityOnFire = this->m_pEntityOnFire;
  v3.n64_u32[0] = 3.0;
  m_Strength = this->m_Strength;
  v8 = CTimer::ms_fTimeStep;
  v2.n64_f32[0] = m_Strength + (float)(CTimer::ms_fTimeStep * 0.002);
  v9.n64_u64[0] = vmin_f32(v2, v3).n64_u64[0];
  if ( SLODWORD(m_Strength) == v9.n64_i32[0] )
    m_Strength = v9.n64_f32[0];
  this->m_Strength = m_Strength;
  if ( !m_pEntityOnFire )
    goto LABEL_149;
  m_pMat = m_pEntityOnFire->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pEntityOnFire->m_transform;
  v12 = *(_QWORD *)&p_tx->m_translate.x;
  this->m_vLocation.z = p_tx->m_translate.z;
  *(_QWORD *)&this->m_vLocation.x = v12;
  v13 = *(_BYTE *)&m_pEntityOnFire->m_info & 7;
  if ( v13 == 2 )
  {
    v14 = *(_BYTE *)this;
    if ( (CFire *)m_pEntityOnFire[19].m_nFlags.bdummy != this )
    {
      if ( !(v14 << 31) )
        return;
      goto LABEL_13;
    }
    if ( (v14 & 2) == 0 )
    {
      memset(&Pos, 0, sizeof(Pos));
      CVehicle::InflictDamage(
        (CVehicle *)m_pEntityOnFire,
        this->m_pEntityStartedFire,
        WEAPONTYPE_FLAMETHROWER,
        v8 * 1.2,
        Pos);
      m_pEntityOnFire = this->m_pEntityOnFire;
    }
    if ( !m_pEntityOnFire[24]._vptr$CPlaceable )
    {
      v = *(CVector *)CModelInfo::ms_modelInfoPtrs[m_pEntityOnFire->m_nModelIndex][2].m_hashKey;
      v.z = v.z + 0.15;
      v20 = m_pEntityOnFire->m_pMat;
      if ( !v20 )
      {
        CPlaceable::AllocateMatrix(m_pEntityOnFire);
        CSimpleTransform::UpdateMatrix(&m_pEntityOnFire->m_transform, m_pEntityOnFire->m_pMat);
        v20 = m_pEntityOnFire->m_pMat;
      }
      operator*(&v107, v20, &v);
      v21 = *(_QWORD *)&v107.x;
      this->m_vLocation.z = v107.z;
      *(_QWORD *)&this->m_vLocation.x = v21;
    }
  }
  else if ( v13 == 3 )
  {
    if ( *(CFire **)&m_pEntityOnFire[30].m_nScanCode != this )
    {
      LOBYTE(v14) = *(_BYTE *)this;
      if ( (*(_BYTE *)this & 1) == 0 )
        return;
LABEL_13:
      this->m_nTimeToBurn = 0;
      m_fxSysPtr = this->m_fxSysPtr;
      *(_BYTE *)this = v14 & 0xE6 | 0x10;
      if ( !m_fxSysPtr
        || (FxSystem_c::Kill(m_fxSysPtr), m_pEntityOnFire = this->m_pEntityOnFire, this->m_fxSysPtr = 0, m_pEntityOnFire) )
      {
        v16 = *(_BYTE *)&m_pEntityOnFire->m_info & 7;
        if ( v16 == 2 )
        {
          p_bdummy = &m_pEntityOnFire[19].m_nFlags.bdummy;
        }
        else
        {
          if ( v16 != 3 )
            goto LABEL_36;
          p_bdummy = &m_pEntityOnFire[30].m_nScanCode;
        }
        *p_bdummy = 0;
        m_pEntityOnFire = *p_m_pEntityOnFire;
        if ( !*p_m_pEntityOnFire )
        {
LABEL_37:
          *p_m_pEntityOnFire = 0;
          return;
        }
LABEL_36:
        CEntity::CleanUpOldReference(m_pEntityOnFire, p_m_pEntityOnFire);
        goto LABEL_37;
      }
      return;
    }
    if ( ((int)m_pEntityOnFire[18].m_pMat & 0xFFFFFFFE) == 54 )
      this->m_vLocation.z = this->m_vLocation.z + -1.0;
    m_pLastRenderedLink = BYTE1(m_pEntityOnFire[19].m_transform.m_heading) << 31;
    v18 = m_pLastRenderedLink == 0;
    if ( m_pLastRenderedLink )
    {
      m_pLastRenderedLink = (int)m_pEntityOnFire[23].m_pLastRenderedLink;
      v18 = m_pLastRenderedLink == 0;
    }
    if ( v18 )
    {
      if ( !CPed::IsPlayer((const CPed *)m_pEntityOnFire) && !CPed::IsAlive((const CPed *)m_pEntityOnFire) )
        LODWORD(m_pEntityOnFire[1].m_transform.m_translate.y) |= 0x20000000u;
    }
    else if ( *(_WORD *)(m_pLastRenderedLink + 38) != 407 && !*(_DWORD *)(m_pLastRenderedLink + 1440) )
    {
      *(_DWORD *)(m_pLastRenderedLink + 1228) = 1117126656;
    }
  }
  v22 = this->m_fxSysPtr;
  if ( v22 )
  {
    v23 = (float *)this->m_pEntityOnFire;
    v24 = (float)((float)(CTimer::ms_fTimeStep + CTimer::ms_fTimeStep) * v23[19]) + this->m_vLocation.y;
    v25 = (float)((float)(CTimer::ms_fTimeStep + CTimer::ms_fTimeStep) * v23[20]) + this->m_vLocation.z;
    v.x = (float)(v23[18] * (float)(CTimer::ms_fTimeStep + CTimer::ms_fTimeStep)) + this->m_vLocation.x;
    v.y = v24;
    v.z = v25;
    FxSystem_c::SetOffsetPos(v22, &v);
  }
  if ( !*p_m_pEntityOnFire || (*(_BYTE *)&(*p_m_pEntityOnFire)->m_info & 7) != 2 )
  {
LABEL_149:
    if ( !FindPlayerVehicle(-1, 0)
      && !FindPlayerPed(-1)->m_pFire
      && (*((_BYTE *)&FindPlayerPed(-1)->m_nPhysicalFlags + 2) & 8) == 0
      && !FindPlayerPed(-1)->m_pAttachToEntity )
    {
      PlayerPed = FindPlayerPed(-1);
      v27 = PlayerPed->m_pMat;
      p_m_transform = (CSimpleTransform *)&v27->tx;
      if ( !v27 )
        p_m_transform = &PlayerPed->m_transform;
      v29.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&this->m_vLocation.y).n64_u64[0];
      v9.n64_u64[0] = vmul_f32(v29, v29).n64_u64[0];
      if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - this->m_vLocation.x)
                                 * (float)(p_m_transform->m_translate.x - this->m_vLocation.x))
                         + v9.n64_f32[0])
                 + v9.n64_f32[1]) < 1.2 )
      {
        v30 = FindPlayerPed(-1);
        CPlayerPed::DoStuffToGoOnFire(v30);
        v31 = FindPlayerPed(-1);
        CFireManager::StartFire(&gFireManager, v31, this->m_pEntityStartedFire, COERCE_FLOAT(100), 0, 7000, 100);
      }
    }
  }
  ppAddress = p_m_pEntityOnFire;
  if ( (rand() & 0x1F) == 0 )
  {
    v32 = CPools::ms_pVehiclePool;
    m_nSize = CPools::ms_pVehiclePool->m_nSize;
    if ( m_nSize )
    {
      v34 = m_nSize - 1;
      p_y = (float32x2_t *)&this->m_vLocation.y;
      v36 = 2604 * m_nSize - 1160;
      do
      {
        if ( (v32->m_aFlags[v34] & 0x80u) == 0 )
        {
          v37 = &(*v32->m_aStorage)[v36];
          if ( v37 != (uint8 *)&elf_hash_bucket[298] && !*((_DWORD *)v37 - 68) && *((_WORD *)v37 - 703) != 407 )
          {
            v38 = *((_DWORD *)v37 - 356);
            v39 = (uint8 *)(v38 + 48);
            if ( !v38 )
              v39 = v37 - 1440;
            v40.n64_u64[0] = vsub_f32(*(float32x2_t *)(v39 + 4), (float32x2_t)p_y->n64_u64[0]).n64_u64[0];
            v9.n64_u64[0] = vmul_f32(v40, v40).n64_u64[0];
            if ( sqrtf(
                   (float)((float)((float)(*(float *)v39 - this->m_vLocation.x)
                                 * (float)(*(float *)v39 - this->m_vLocation.x))
                         + v9.n64_f32[0])
                 + v9.n64_f32[1]) < 2.0 )
            {
              v41 = (CVehicle *)(v37 - 1444);
              if ( *(_DWORD *)&(*v32->m_aStorage)[v36] == 10 )
              {
                v42 = FindPlayerPed(-1);
                CPlayerPed::DoStuffToGoOnFire(v42);
                v43 = FindPlayerPed(-1);
                CFireManager::StartFire(&gFireManager, v43, this->m_pEntityStartedFire, v44, 0, 7000, 100);
                v45 = *(void (__fastcall **)(CVehicle *, _DWORD, _DWORD))(*((_DWORD *)v37 - 361) + 180);
                TyreNearestPoint = CVehicle::FindTyreNearestPoint(v41, this->m_vLocation.x, this->m_vLocation.y);
                v45(v41, (unsigned __int8)(TyreNearestPoint + 13), 0);
              }
              else
              {
                CFireManager::StartFire(
                  &gFireManager,
                  (CEntity *)(v37 - 1444),
                  this->m_pEntityStartedFire,
                  COERCE_FLOAT(407),
                  0,
                  7000,
                  0);
              }
              p_y = (float32x2_t *)&this->m_vLocation.y;
            }
          }
        }
        --v34;
        v36 -= 2604;
      }
      while ( v34 != -1 );
    }
  }
  if ( (rand() & 3) == 0 )
  {
    v47 = CPools::ms_pObjectPool;
    v48 = CPools::ms_pObjectPool->m_nSize;
    if ( v48 )
    {
      v49 = v48 - 1;
      v50 = 420 * v48 - 420;
      do
      {
        if ( (v47->m_aFlags[v49] & 0x80u) == 0 )
        {
          v51 = (CObject *)&(*v47->m_aStorage)[v50];
          if ( v51 )
          {
            v52 = v51->m_pMat;
            v53 = (CSimpleTransform *)&v52->tx;
            if ( !v52 )
              v53 = &v51->m_transform;
            v54.n64_u64[0] = vsub_f32(*(float32x2_t *)&v53->m_translate.y, *(float32x2_t *)&this->m_vLocation.y).n64_u64[0];
            v9.n64_u64[0] = vmul_f32(v54, v54).n64_u64[0];
            if ( sqrtf(
                   (float)((float)((float)(v53->m_translate.x - this->m_vLocation.x)
                                 * (float)(v53->m_translate.x - this->m_vLocation.x))
                         + v9.n64_f32[0])
                 + v9.n64_f32[1]) < 3.0 )
              CObject::ObjectFireDamage(v51, CTimer::ms_fTimeStep * 24.0, this->m_pEntityStartedFire);
          }
        }
        --v49;
        v50 -= 420;
      }
      while ( v49 != -1 );
    }
  }
  if ( this->m_nNumGenerationsAllowed >= 1 && (rand() & 0x7F) == 0 )
  {
    v55 = 0;
    v56 = 0;
    do
    {
      v57 = (char)gFireManager.m_Fires[v55++];
      v56 += v57 & 1;
    }
    while ( v55 != 60 );
    if ( v56 < 25 )
    {
      v58 = (float)rand();
      v59 = rand();
      v.z = 0.0;
      v.x = (float)((float)(v58 * 4.6566e-10) + (float)(v58 * 4.6566e-10)) + -1.0;
      v.y = (float)((float)((float)v59 * 4.6566e-10) + (float)((float)v59 * 4.6566e-10)) + -1.0;
      CVector::Normalise(&v);
      v60 = rand();
      z = this->m_vLocation.z;
      v62 = (float)((float)v60 * 4.6566e-10) + 2.0;
      v63 = this->m_vLocation.y + (float)(v.y * v62);
      v.x = this->m_vLocation.x + (float)(v.x * v62);
      v109.x = v.x;
      v109.y = v63;
      v.y = v63;
      v.z = (float)(z + (float)(v62 * v.z)) + 2.0;
      v109.z = v.z;
      CCreepingFire::TryToStartFireAtCoors(v109, this->m_nNumGenerationsAllowed - 1, 0, (*(_BYTE *)this & 2) != 0, 10.0);
    }
  }
  if ( this->m_Strength <= 2.0 )
  {
    if ( this->m_nNumGenerationsAllowed )
    {
      if ( (rand() & 0xF) == 0 )
      {
        v80 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 60.0);
        v81 = 5 * v80;
        v82 = &gFireManager.m_Fires[v80];
        if ( v82 != this )
        {
          v83 = &gFireManager.m_Fires[v80];
          if ( (*(_BYTE *)v82 & 3) == 1 && gFireManager.m_Fires[v80].m_Strength <= 1.0 )
          {
            v1.n64_u32[0] = LODWORD(this->m_vLocation.x);
            y = this->m_vLocation.y;
            v85 = this->m_vLocation.z;
            v86 = (float *)&gFireManager.m_Fires[v80];
            v87 = v86[1];
            v88 = v86[2];
            v89 = v86[3];
            v1.n64_f32[1] = (float)(v85 - v89) * (float)(v85 - v89);
            if ( sqrtf(
                   (float)((float)((float)(v1.n64_f32[0] - v87) * (float)(v1.n64_f32[0] - v87))
                         + (float)((float)(y - v88) * (float)(y - v88)))
                 + v1.n64_f32[1]) < 3.5 )
            {
              v1.n64_f32[1] = v1.n64_f32[0] * 0.7;
              v1.n64_f32[0] = this->m_Strength + 1.0;
              LODWORD(this->m_Strength) = v1.n64_u32[0];
              this->m_vLocation.x = v1.n64_f32[1] + (float)(v87 * 0.3);
              this->m_vLocation.y = (float)(y * 0.7) + (float)(v88 * 0.3);
              this->m_vLocation.z = (float)(v85 * 0.7) + (float)(v89 * 0.3);
              m_nTimeToBurn = CTimer::m_snTimeInMilliseconds + 7000;
              v91 = this->m_fxSysPtr;
              if ( this->m_nTimeToBurn > CTimer::m_snTimeInMilliseconds + 7000 )
                m_nTimeToBurn = this->m_nTimeToBurn;
              this->m_nTimeToBurn = m_nTimeToBurn;
              if ( v91 )
              {
                FxSystem_c::Kill(v91);
                v1.n64_u32[0] = LODWORD(this->m_Strength);
                this->m_fxSysPtr = 0;
              }
              v92 = "fire_med";
              if ( v1.n64_f32[0] > 2.0 )
                v92 = "fire_large";
              if ( v1.n64_f32[0] <= 1.0 )
                v92 = "fire";
              FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, (unsigned __int8 *)v92, &this->m_vLocation, 0, 1);
              this->m_fxSysPtr = FxSystem;
              if ( FxSystem )
                FxSystem_c::Play(FxSystem);
              if ( this->m_nNumGenerationsAllowed < gFireManager.m_Fires[v81 / 5].m_nNumGenerationsAllowed )
                v82 = this;
              this->m_nNumGenerationsAllowed = v82->m_nNumGenerationsAllowed;
              v94 = *(_BYTE *)v83;
              if ( (*(_BYTE *)v83 & 1) != 0 )
              {
                v95 = (char *)&gFireManager + 8 * v81;
                *((_DWORD *)v95 + 6) = 0;
                *(_BYTE *)v83 = v94 & 0xE6 | 0x10;
                v98 = (FxSystem_c *)*((_DWORD *)v95 + 9);
                v97 = v95 + 36;
                v96 = v98;
                if ( v98 )
                {
                  FxSystem_c::Kill(v96);
                  *v97 = 0;
                }
                v99 = (char *)&gFireManager + 8 * v81;
                v102 = (CEntity *)*((_DWORD *)v99 + 4);
                v101 = (CEntity **)(v99 + 16);
                v100 = v102;
                if ( v102 )
                {
                  v103 = *(_BYTE *)&v100->m_info & 7;
                  if ( v103 == 2 )
                  {
                    p_m_nScanCode = &v100[19].m_nFlags.bdummy;
                  }
                  else
                  {
                    if ( v103 != 3 )
                      goto LABEL_145;
                    p_m_nScanCode = &v100[30].m_nScanCode;
                  }
                  *p_m_nScanCode = 0;
                  v100 = *v101;
                  if ( !*v101 )
                  {
LABEL_146:
                    *v101 = 0;
                    goto LABEL_87;
                  }
LABEL_145:
                  CEntity::CleanUpOldReference(v100, v101);
                  goto LABEL_146;
                }
              }
            }
          }
        }
      }
    }
  }
LABEL_87:
  v64 = this->m_fxSysPtr;
  if ( v64 )
  {
    v1.n64_f32[0] = (float)(this->m_nTimeToBurn - CTimer::m_snTimeInMilliseconds) / 3500.0;
    v9.n64_f32[0] = this->m_Strength - (float)(int)this->m_Strength;
    FxSystem_c::SetConstTime(v64, 1u, vmin_f32(v9, v1).n64_f32[0]);
  }
  if ( CTimer::m_snTimeInMilliseconds >= this->m_nTimeToBurn )
  {
    v69 = *(_BYTE *)this;
    if ( (v69 & 2) != 0 )
    {
      v65 = &this->m_vLocation.y;
LABEL_107:
      v75 = rand();
      v110.x = this->m_vLocation.x;
      v110.z = this->m_vLocation.z;
      v110.y = *v65;
      memset(&Pos, 0, sizeof(Pos));
      CPointLights::AddLight(
        0,
        v110,
        Pos,
        8.0,
        (float)(v75 & 0xF | 0x40u) * 0.0019531,
        (float)(v75 & 0xF | 0x40u) * 0.0019531,
        0.0,
        0,
        0,
        0);
      return;
    }
  }
  else
  {
    v65 = &this->m_vLocation.y;
    v66 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      v66 = &TheCamera.m_transform;
    v67.n64_u64[0] = vsub_f32(*(float32x2_t *)&v66->m_translate.x, *(float32x2_t *)&this->m_vLocation.x).n64_u64[0];
    v68 = vmul_f32(v67, v67).n64_u64[0];
    if ( sqrtf(*(float *)&v68 + *((float *)&v68 + 1)) < (float)this->m_RemovalDist )
      goto LABEL_107;
    v69 = *(_BYTE *)this;
    if ( (v69 & 2) != 0 )
      goto LABEL_107;
  }
  v70 = this->m_Strength;
  if ( v70 > 1.0 )
  {
    this->m_nTimeToBurn = CTimer::m_snTimeInMilliseconds + 7000;
    v71 = this->m_fxSysPtr;
    v72 = v70 + -1.0;
    this->m_Strength = v72;
    if ( v71 )
    {
      FxSystem_c::Kill(v71);
      v72 = this->m_Strength;
      this->m_fxSysPtr = 0;
    }
    v73 = "fire_med";
    if ( v72 > 2.0 )
      v73 = "fire_large";
    if ( v72 <= 1.0 )
      v73 = "fire";
    v74 = FxManager_c::CreateFxSystem(&g_fxMan, (unsigned __int8 *)v73, &this->m_vLocation, 0, 1);
    this->m_fxSysPtr = v74;
    if ( v74 )
      FxSystem_c::Play(v74);
    return;
  }
  if ( v69 << 31 )
  {
    this->m_nTimeToBurn = 0;
    v76 = this->m_fxSysPtr;
    *(_BYTE *)this = v69 & 0xE6 | 0x10;
    if ( v76 )
    {
      FxSystem_c::Kill(v76);
      this->m_fxSysPtr = 0;
    }
    v77 = *ppAddress;
    if ( *ppAddress )
    {
      v78 = *(_BYTE *)&v77->m_info & 7;
      if ( v78 == 2 )
      {
        v79 = &v77[19].m_nFlags.bdummy;
      }
      else
      {
        if ( v78 != 3 )
          goto LABEL_141;
        v79 = &v77[30].m_nScanCode;
      }
      *v79 = 0;
      v77 = *ppAddress;
      if ( !*ppAddress )
      {
LABEL_142:
        *ppAddress = 0;
        return;
      }
LABEL_141:
      CEntity::CleanUpOldReference(v77, ppAddress);
      goto LABEL_142;
    }
  }
}
// 3F1B48: variable 'v2' is possibly undefined
// 3F1B48: variable 'v3' is possibly undefined
// 3F1F4A: variable 'v44' is possibly undefined
// 3F21BA: variable 'v1' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003F2618) --------------------------------------------------------
FxSystem_c **__fastcall CFireManager::StartFire(
        CFireManager *this,
        float a2,
        float a3,
        float a4,
        float fFireSize,
        bool8 bExtinguishEnabled,
        CEntity *bReportFire,
        unsigned int bExtinguishEnableda,
        Int32 a9)
{
  FxSystem_c **v13; // r4
  FxSystem_c **p_m_fxSysPtr; // r6
  int v15; // r0
  char v16; // r1
  unsigned int v17; // r5
  unsigned int v18; // s0
  CEntity *v19; // r0
  CEntity *v20; // r0
  char v21; // r1
  Int32 m_nMaxGenerationsAllowed; // r0
  float v23; // s2
  char *v24; // r1
  FxSystem_c *FxSystem; // r0
  float pWaterZ[11]; // [sp+Ch] [bp-2Ch] BYREF

  v13 = 0;
  if ( !CWaterLevel::GetWaterLevelNoWaves(a2, a3, a4, pWaterZ, 0, 0) || pWaterZ[0] <= a4 )
  {
    p_m_fxSysPtr = &this->m_Fires[0].m_fxSysPtr;
    v15 = -1;
    while ( 1 )
    {
      v16 = *((_BYTE *)p_m_fxSysPtr - 36);
      if ( (v16 & 3) == 0 )
        break;
      ++v15;
      p_m_fxSysPtr += 10;
      if ( v15 > 58 )
        return 0;
    }
    if ( p_m_fxSysPtr == (FxSystem_c **)&dword_24 )
      return 0;
    *((float *)p_m_fxSysPtr - 8) = a2;
    *((float *)p_m_fxSysPtr - 7) = a3;
    *((float *)p_m_fxSysPtr - 6) = a4;
    *((_BYTE *)p_m_fxSysPtr - 36) = v16 & 0xE8 | 0x15;
    v17 = CTimer::m_snTimeInMilliseconds;
    v18 = (unsigned int)(float)((float)((float)((float)((float)((float)rand() * 4.6566e-10) * 0.3) + 1.0)
                                      * (float)bExtinguishEnableda)
                              + (float)v17);
    v19 = (CEntity *)*(p_m_fxSysPtr - 5);
    *(p_m_fxSysPtr - 3) = (FxSystem_c *)v18;
    if ( v19 )
      CEntity::CleanUpOldReference(v19, (CEntity **)p_m_fxSysPtr - 5);
    v20 = (CEntity *)*(p_m_fxSysPtr - 4);
    v21 = *((_BYTE *)p_m_fxSysPtr - 36);
    *(p_m_fxSysPtr - 5) = 0;
    *((_BYTE *)p_m_fxSysPtr - 36) = v21 & 0xF7;
    if ( v20 )
      CEntity::CleanUpOldReference(v20, (CEntity **)p_m_fxSysPtr - 4);
    *(p_m_fxSysPtr - 4) = (FxSystem_c *)bReportFire;
    m_nMaxGenerationsAllowed = gFireManager.m_nMaxGenerationsAllowed;
    *(p_m_fxSysPtr - 2) = (FxSystem_c *)1065353216;
    if ( m_nMaxGenerationsAllowed > a9 )
      LOBYTE(m_nMaxGenerationsAllowed) = a9;
    *((_BYTE *)p_m_fxSysPtr - 4) = m_nMaxGenerationsAllowed;
    if ( bReportFire )
      CEntity::RegisterReference(bReportFire, (CEntity **)p_m_fxSysPtr - 4);
    v13 = p_m_fxSysPtr - 9;
    if ( *p_m_fxSysPtr )
    {
      FxSystem_c::Kill(*p_m_fxSysPtr);
      *p_m_fxSysPtr = 0;
    }
    v23 = *((float *)p_m_fxSysPtr - 2);
    v24 = "fire_med";
    if ( v23 > 2.0 )
      v24 = "fire_large";
    if ( v23 <= 1.0 )
      v24 = "fire";
    FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, (unsigned __int8 *)v24, (RwV3d_0 *)(p_m_fxSysPtr - 8), 0, 1);
    *p_m_fxSysPtr = FxSystem;
    if ( FxSystem )
      FxSystem_c::Play(FxSystem);
  }
  return v13;
}
// 24: using guessed type int dword_24;
// 3F2618: using guessed type unsigned int bExtinguishEnabled;
// 3F2618: using guessed type float pWaterZ[11];

//----- (003F27D4) --------------------------------------------------------
CFire *__fastcall CFireManager::FindNearestFire(
        CFireManager *this,
        const CVector *vSearchPosition,
        const bool bRequireUnattendedFire,
        const bool bRequireNonScriptFire)
{
  float32x2_t v4; // d1
  float32x2_t v5; // d16
  _BOOL4 v6; // lr
  _BOOL4 v7; // r3
  int v8; // r1
  CFire *v9; // r12
  char v10; // r2
  CEntity *m_pEntityOnFire; // r4
  float32x2_t v12; // d17
  float32x2_t v13; // d2
  bool v14; // nf

  v5.n64_u64[0] = *(unsigned __int64 *)&vSearchPosition->x;
  v6 = !bRequireUnattendedFire;
  v4.n64_u32[0] = 2139095039;
  v7 = !bRequireNonScriptFire;
  v8 = 0;
  v9 = 0;
  do
  {
    v10 = (char)this->m_Fires[v8];
    if ( (v10 & 1) != 0 && ((v10 & 2) == 0 || v7) && ((v10 & 8) == 0 || v6) )
    {
      m_pEntityOnFire = this->m_Fires[v8].m_pEntityOnFire;
      if ( !m_pEntityOnFire || (*(_BYTE *)&m_pEntityOnFire->m_info & 7) != 3 )
      {
        v12.n64_u64[0] = vsub_f32(*(float32x2_t *)&this->m_Fires[v8].m_vLocation.x, v5).n64_u64[0];
        v13.n64_u64[0] = vmul_f32(v12, v12).n64_u64[0];
        v13.n64_f32[0] = (float)(v13.n64_f32[0] + v13.n64_f32[1]) + 0.0;
        v14 = v13.n64_f32[0] < v4.n64_f32[0];
        v4.n64_u64[0] = vmin_f32(v13, v4).n64_u64[0];
        if ( v14 )
          v9 = &this->m_Fires[v8];
      }
    }
    ++v8;
  }
  while ( v8 != 60 );
  return v9;
}
// 3F283E: variable 'v4' is possibly undefined

//----- (003F2868) --------------------------------------------------------
void __fastcall CFire::CreateFxSysForStrength(CFire *this, RwV3d_0 *vecPosition, RwMatrix *parentMat)
{
  FxSystem_c *m_fxSysPtr; // r0
  float m_Strength; // s4
  char *v8; // r1
  FxSystem_c *FxSystem; // r0

  m_fxSysPtr = this->m_fxSysPtr;
  if ( m_fxSysPtr )
  {
    FxSystem_c::Kill(m_fxSysPtr);
    this->m_fxSysPtr = 0;
  }
  m_Strength = this->m_Strength;
  v8 = "fire_med";
  if ( m_Strength > 2.0 )
    v8 = "fire_large";
  if ( m_Strength <= 1.0 )
    v8 = "fire";
  FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, (unsigned __int8 *)v8, vecPosition, parentMat, 1);
  this->m_fxSysPtr = FxSystem;
  if ( FxSystem )
    sub_18C0A4(FxSystem);
}

//----- (003F28F4) --------------------------------------------------------
CFire *__fastcall CFireManager::StartFire(
        CFireManager *this,
        CEntity *pBurningEntity,
        CEntity *pStartedFireEntity,
        float fFireSize,
        bool8 bExtinguishEnabled,
        int a6,
        Int32 bExtinguishEnableda)
{
  int v10; // r0
  FxSystem_c **p_m_fxSysPtr; // r5
  int v12; // r0
  int (**v13)(void); // r9
  int v14; // r0
  eCrimeType v15; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  CEntity::CEntityInfo m_info; // r0
  int v20; // r1
  uint32 v21; // r4
  CEntity *v22; // r0
  CEntity *v23; // r0
  char m_nMaxGenerationsAllowed; // r1
  FxSystem_c *v25; // r0
  float v26; // s4
  char *v27; // r1
  FxSystem_c *FxSystem; // r0
  __int64 v29; // [sp+8h] [bp-28h]
  RwReal z; // [sp+10h] [bp-20h]

  v10 = *(_BYTE *)&pBurningEntity->m_info & 7;
  switch ( v10 )
  {
    case 2:
      if ( pBurningEntity[19].m_nFlags.bdummy
        || !pBurningEntity[24]._vptr$CPlaceable
        && CDamageManager::GetEngineStatus((const CDamageManager *)&pBurningEntity[24].m_pMat) > 0xE0 )
      {
        return 0;
      }
LABEL_10:
      if ( (BYTE2(pBurningEntity[1].m_transform.m_translate.y) & 8) == 0 )
        break;
      return 0;
    case 4:
      if ( pBurningEntity[6]._vptr$CPlaceable )
        return 0;
      break;
    case 3:
      if ( *(_DWORD *)&pBurningEntity[30].m_nScanCode || !CPed::IsPedInControl((CPed *)pBurningEntity) )
        return 0;
      goto LABEL_10;
  }
  p_m_fxSysPtr = &this->m_Fires[0].m_fxSysPtr;
  v12 = -1;
  while ( *((unsigned __int8 *)p_m_fxSysPtr - 36) << 30 )
  {
    ++v12;
    p_m_fxSysPtr += 10;
    if ( v12 > 58 )
      return 0;
  }
  if ( p_m_fxSysPtr == (FxSystem_c **)&dword_24 )
    return 0;
  v13 = (int (**)(void))(p_m_fxSysPtr - 9);
  v14 = *(_BYTE *)&pBurningEntity->m_info & 7;
  switch ( v14 )
  {
    case 2:
      pBurningEntity[19].m_nFlags.bdummy = (uint32)v13;
      if ( !pStartedFireEntity )
        break;
      v15 = CRIME_CAR_SET_ON_FIRE;
      goto LABEL_29;
    case 4:
      pBurningEntity[6]._vptr$CPlaceable = v13;
      break;
    case 3:
      *(_DWORD *)&pBurningEntity[30].m_nScanCode = v13;
      FindPlayerPed(-1);
      if ( pStartedFireEntity )
      {
        if ( *(_DWORD *)&pBurningEntity[23].numLodChildren == 6 )
          v15 = CRIME_COP_SET_ON_FIRE;
        else
          v15 = CRIME_PED_SET_ON_FIRE;
LABEL_29:
        CCrime::ReportCrime(v15, pBurningEntity, (CPed *)pStartedFireEntity);
      }
      break;
  }
  m_pMat = pBurningEntity->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pBurningEntity->m_transform;
  z = p_tx->m_translate.z;
  v29 = *(_QWORD *)&p_tx->m_translate.x;
  *((_BYTE *)p_m_fxSysPtr - 36) = *(_BYTE *)(p_m_fxSysPtr - 9) & 0xE4 | 0x11;
  *((RwReal *)p_m_fxSysPtr - 6) = z;
  *(p_m_fxSysPtr - 2) = (FxSystem_c *)1065353216;
  *((_QWORD *)p_m_fxSysPtr - 4) = v29;
  m_info = pBurningEntity->m_info;
  if ( (*(_BYTE *)&m_info & 7) != 3 )
    goto LABEL_37;
  if ( !CPed::IsPlayer((const CPed *)pBurningEntity) )
  {
    m_info = pBurningEntity->m_info;
LABEL_37:
    v21 = CTimer::m_snTimeInMilliseconds;
    if ( (*(_BYTE *)&m_info & 7) == 2 )
      v20 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 1000.0) + v21 + 3000;
    else
      v20 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 1000.0) + v21 + a6;
    goto LABEL_40;
  }
  v20 = CTimer::m_snTimeInMilliseconds + 2333;
LABEL_40:
  v22 = (CEntity *)*(p_m_fxSysPtr - 5);
  *(p_m_fxSysPtr - 3) = (FxSystem_c *)v20;
  if ( v22 )
    CEntity::CleanUpOldReference(v22, (CEntity **)p_m_fxSysPtr - 5);
  *(p_m_fxSysPtr - 5) = (FxSystem_c *)pBurningEntity;
  CEntity::RegisterReference(pBurningEntity, (CEntity **)p_m_fxSysPtr - 5);
  v23 = (CEntity *)*(p_m_fxSysPtr - 4);
  if ( v23 )
    CEntity::CleanUpOldReference(v23, (CEntity **)p_m_fxSysPtr - 4);
  *(p_m_fxSysPtr - 4) = (FxSystem_c *)pStartedFireEntity;
  if ( pStartedFireEntity )
    CEntity::RegisterReference(pStartedFireEntity, (CEntity **)p_m_fxSysPtr - 4);
  *((_BYTE *)p_m_fxSysPtr - 36) |= 4u;
  m_nMaxGenerationsAllowed = gFireManager.m_nMaxGenerationsAllowed;
  v25 = *p_m_fxSysPtr;
  if ( gFireManager.m_nMaxGenerationsAllowed > bExtinguishEnableda )
    m_nMaxGenerationsAllowed = bExtinguishEnableda;
  *((_BYTE *)p_m_fxSysPtr - 4) = m_nMaxGenerationsAllowed;
  if ( v25 )
  {
    FxSystem_c::Kill(v25);
    *p_m_fxSysPtr = 0;
  }
  v26 = *((float *)p_m_fxSysPtr - 2);
  v27 = "fire_med";
  if ( v26 > 2.0 )
    v27 = "fire_large";
  if ( v26 <= 1.0 )
    v27 = "fire";
  FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, (unsigned __int8 *)v27, (RwV3d_0 *)(p_m_fxSysPtr - 8), 0, 1);
  *p_m_fxSysPtr = FxSystem;
  if ( FxSystem )
    FxSystem_c::Play(FxSystem);
  return (CFire *)v13;
}
// 24: using guessed type int dword_24;

//----- (003F2B8C) --------------------------------------------------------
bool __fastcall CFireManager::PlentyFiresAvailable(CFireManager *this)
{
  int v1; // r1
  int v2; // r2

  v1 = 0;
  v2 = -1;
  while ( *(_BYTE *)this->m_Fires << 31 )
  {
LABEL_2:
    ++v2;
    this = (CFireManager *)((char *)this + 40);
    if ( v2 >= 59 )
      return 0;
  }
  if ( v1 <= 4 )
  {
    ++v1;
    goto LABEL_2;
  }
  return 1;
}

//----- (003F2BB4) --------------------------------------------------------
int __fastcall CCreepingFire::TryToStartFireAtCoors(
        CVector NewFireCoors,
        Int32 NewNumGenerationsAllowed,
        bool bIgnoreMaterial,
        bool bCreatedByScript,
        float MaxDownDist)
{
  UInt8 *v6; // r3
  int v7; // r6
  UInt8 *v8; // r9
  int v9; // r3
  CFireManager *v10; // r5
  int v11; // r6
  int v12; // r5
  FxSystem_c **started; // r0
  float bCheckBuildings; // [sp+0h] [bp-70h]
  CVector vecStart; // [sp+1Ch] [bp-54h] BYREF
  CEntity *refEntityPtr; // [sp+28h] [bp-48h] BYREF
  CColPoint colPoint; // [sp+2Ch] [bp-44h] BYREF

  v6 = CCreepingFire::m_aFireStatus[(int)NewFireCoors.x & 0x1F];
  v7 = (int)NewFireCoors.y & 0x1F;
  if ( v6[v7] )
    return 0;
  v8 = &v6[v7];
  v9 = 0;
  v10 = &gFireManager;
  v11 = -1;
  while ( *(_BYTE *)v10->m_Fires << 31 )
  {
LABEL_6:
    ++v11;
    v10 = (CFireManager *)((char *)v10 + 40);
    if ( v11 >= 59 )
      return 0;
  }
  if ( v9 <= 4 )
  {
    ++v9;
    goto LABEL_6;
  }
  vecStart = NewFireCoors;
  v12 = 0;
  if ( CWorld::ProcessVerticalLine(
         &vecStart,
         NewFireCoors.z - MaxDownDist,
         &colPoint,
         &refEntityPtr,
         1,
         0,
         0,
         0,
         0,
         0,
         0) )
  {
    *v8 = 6;
    vecStart.z = colPoint.m_vecPosition.z;
    started = CFireManager::StartFire(
                &gFireManager,
                vecStart.x,
                vecStart.y,
                colPoint.m_vecPosition.z,
                bCheckBuildings,
                0,
                0,
                0x4E20u,
                NewNumGenerationsAllowed);
    if ( started )
    {
      *(_BYTE *)started = *(_BYTE *)started & 0xED | (2 * bCreatedByScript);
      return 1;
    }
  }
  return v12;
}
// 3F2C7C: variable 'bCheckBuildings' is possibly undefined

//----- (003F2CA4) --------------------------------------------------------
void __fastcall CFireManager::ExtinguishPoint(CFireManager *this, CVector Coors, float Radius)
{
  float z; // s18
  float y; // s20
  float x; // s22
  int i; // r6
  _DWORD *v8; // r5
  FxSystem_c *v9; // r0
  int v10; // r0
  CEntity **v11; // r1
  int v12; // r2
  _DWORD *v13; // r0
  CEntity *v14; // r0

  z = Coors.z;
  y = Coors.y;
  x = Coors.x;
  for ( i = 0; i != 60; ++i )
  {
    if ( (*(_BYTE *)&this->m_Fires[i] & 1) != 0 )
    {
      v8 = (_DWORD *)((char *)this + i * 40);
      if ( (float)((float)((float)((float)(x - this->m_Fires[i].m_vLocation.x)
                                 * (float)(x - this->m_Fires[i].m_vLocation.x))
                         + (float)((float)(y - this->m_Fires[i].m_vLocation.y)
                                 * (float)(y - this->m_Fires[i].m_vLocation.y)))
                 + (float)((float)(z - this->m_Fires[i].m_vLocation.z) * (float)(z - this->m_Fires[i].m_vLocation.z))) < (float)(Radius * Radius) )
      {
        *(_BYTE *)&this->m_Fires[i] = *(_BYTE *)&this->m_Fires[i] & 0xE4 | 0x10;
        v9 = (FxSystem_c *)v8[9];
        v8[6] = 0;
        if ( v9 )
        {
          FxSystem_c::Kill(v9);
          v8[9] = 0;
        }
        v11 = (CEntity **)(v8 + 4);
        v10 = v8[4];
        if ( v10 )
        {
          v12 = *(_BYTE *)(v10 + 58) & 7;
          if ( v12 == 2 )
          {
            v13 = (_DWORD *)(v10 + 1172);
          }
          else
          {
            if ( v12 != 3 )
            {
              CEntity::CleanUpOldReference((CEntity *)v10, v11);
LABEL_15:
              v8[4] = 0;
              continue;
            }
            v13 = (_DWORD *)(v10 + 1848);
          }
          *v13 = 0;
          v14 = (CEntity *)v8[4];
          if ( v14 )
            CEntity::CleanUpOldReference(v14, v11);
          goto LABEL_15;
        }
      }
    }
  }
}

//----- (003F2D74) --------------------------------------------------------
bool __fastcall CFireManager::ExtinguishPointWithWater(
        CFireManager *this,
        CVector Coors,
        float Radius,
        float fStrength)
{
  float x; // s24
  int v6; // r5
  bool v7; // r11
  float z; // s20
  float y; // s22
  int v10; // r6
  char *v11; // r9
  float v12; // s21
  float v13; // s23
  CRunningScript *v14; // r4
  float v15; // s0
  __int64 v16; // d16
  unsigned __int8 v17; // r0
  int v18; // r0
  FxSystem_c *v19; // r0
  int v20; // r0
  CEntity **v21; // r1
  int v22; // r2
  _DWORD *v23; // r0
  FxSystem_c *v24; // r0
  char *v25; // r1
  FxSystem_c *FxSystem; // r0
  CEntity *v27; // r0
  bool result; // r0
  FxPrtMult_c v29; // [sp+2Ch] [bp-ACh] BYREF
  RwV3d_0 v30; // [sp+48h] [bp-90h] BYREF
  RwV3d_0 vel; // [sp+58h] [bp-80h] BYREF
  RwV3d_0 pos; // [sp+68h] [bp-70h] BYREF

  x = Coors.x;
  v6 = 0;
  v7 = 0;
  z = Coors.z;
  y = Coors.y;
  do
  {
    v10 = (int)this->m_Fires[v6];
    if ( (v10 & 1) != 0 )
    {
      v11 = (char *)this + v6 * 40;
      if ( (float)((float)((float)((float)(x - this->m_Fires[v6].m_vLocation.x)
                                 * (float)(x - this->m_Fires[v6].m_vLocation.x))
                         + (float)((float)(y - this->m_Fires[v6].m_vLocation.y)
                                 * (float)(y - this->m_Fires[v6].m_vLocation.y)))
                 + (float)((float)(z - this->m_Fires[v6].m_vLocation.z) * (float)(z - this->m_Fires[v6].m_vLocation.z))) < (float)(Radius * Radius) )
      {
        v12 = *((float *)v11 + 7);
        v13 = (float)(fStrength / 50.0) * CTimer::ms_fTimeStep;
        v14 = CTheScripts::pActiveScripts;
        if ( CTheScripts::pActiveScripts )
        {
          if ( !strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "firetru") )
          {
            v13 = v13 * 24.0;
          }
          else if ( !strcmp((const char *)v14->pNext->ScriptName, "firetru") )
          {
            v13 = v13 * 24.0;
          }
        }
        v15 = v12 - v13;
        *((float *)v11 + 7) = v12 - v13;
        if ( !((unsigned __int8)CTimer::m_FrameCounter << 30) )
        {
          v16 = *(_QWORD *)(v11 + 4);
          pos.z = *((RwReal *)v11 + 3);
          *(_QWORD *)&pos.x = v16;
          pos.x = *(float *)&v16 + (float)((float)((unsigned __int8)rand() - 128) * 0.01);
          pos.y = pos.y + (float)((float)((unsigned __int8)rand() - 128) * 0.01);
          v17 = rand();
          vel.z = 0.8;
          *(_QWORD *)&vel.x = unk_616F40;
          v30.z = 1.4;
          *(_QWORD *)&v30.x = unk_616F50;
          pos.z = pos.z + (float)((float)v17 * 0.005);
          FxPrtMult_c::FxPrtMult_c(&v29, 1.0, 1.0, 1.0, 0.6, 0.75, 0.0, 0.4);
          FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, &pos, &vel, 0.0, &v29, -1.0, 1.2, 0.6, 0);
          FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, &pos, &v30, 0.0, &v29, -1.0, 1.2, 0.6, 0);
          v18 = (int)this->m_Fires[v6];
          v10 = v18 | 8;
          *(_BYTE *)&this->m_Fires[v6] = v18 | 8;
          v15 = *((float *)v11 + 7);
        }
        if ( v15 < 0.0 )
        {
          if ( v10 << 31 )
          {
            *(_BYTE *)&this->m_Fires[v6] = v10 & 0xE6 | 0x10;
            v19 = (FxSystem_c *)*((_DWORD *)v11 + 9);
            *((_DWORD *)v11 + 6) = 0;
            if ( v19 )
            {
              FxSystem_c::Kill(v19);
              *((_DWORD *)v11 + 9) = 0;
            }
            v21 = (CEntity **)(v11 + 16);
            v20 = *((_DWORD *)v11 + 4);
            if ( v20 )
            {
              v22 = *(_BYTE *)(v20 + 58) & 7;
              if ( v22 == 2 )
              {
                v23 = (_DWORD *)(v20 + 1172);
                goto LABEL_31;
              }
              if ( v22 == 3 )
              {
                v23 = (_DWORD *)(v20 + 1848);
LABEL_31:
                *v23 = 0;
                v27 = (CEntity *)*((_DWORD *)v11 + 4);
                if ( v27 )
                  CEntity::CleanUpOldReference(v27, v21);
              }
              else
              {
                CEntity::CleanUpOldReference((CEntity *)v20, v21);
              }
              *((_DWORD *)v11 + 4) = 0;
            }
          }
LABEL_36:
          v7 = 1;
          goto LABEL_37;
        }
        if ( SLODWORD(v12) == SLODWORD(v15) )
          goto LABEL_36;
        v24 = (FxSystem_c *)*((_DWORD *)v11 + 9);
        if ( v24 )
        {
          FxSystem_c::Kill(v24);
          *((_DWORD *)v11 + 9) = 0;
          v15 = *((float *)v11 + 7);
        }
        v7 = 1;
        v25 = "fire_large";
        if ( v15 <= 2.0 )
          v25 = "fire_med";
        if ( v15 <= 1.0 )
          v25 = "fire";
        FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, (unsigned __int8 *)v25, (RwV3d_0 *)(v11 + 4), 0, 1);
        *((_DWORD *)v11 + 9) = FxSystem;
        if ( FxSystem )
        {
          FxSystem_c::Play(FxSystem);
          v7 = 1;
        }
      }
    }
LABEL_37:
    ++v6;
  }
  while ( v6 != 60 );
  result = v7;
  if ( v7 )
    return 1;
  return result;
}

//----- (003F30F8) --------------------------------------------------------
Int32 __fastcall CFireManager::StartScriptFire(
        CFireManager *this,
        const CVector *Coors,
        CEntity *pEntity,
        float fFireSize,
        bool8 bExtinguishEnabled,
        Int32 NumGenerationsAllowed,
        Int32 Strength)
{
  int v10; // r0
  _BYTE *v11; // r0
  char *v12; // r4
  char v13; // r1
  FxSystem_c *v14; // r0
  CEntity *v15; // r0
  CEntity **v16; // r4
  CEntity *v17; // t1
  int v18; // r1
  _DWORD *p_m_nScanCode; // r0
  _BYTE *bdummy; // r0
  uint32 v21; // r4
  char v22; // r1
  FxSystem_c *v23; // r0
  CEntity *v24; // r0
  CEntity **v25; // r4
  CEntity *v26; // t1
  int v27; // r1
  _DWORD *p_bdummy; // r0
  CFire *NextFreeFire; // r0
  uint32 v30; // r4
  char v31; // r2
  __int64 v32; // d16
  char m_nMaxGenerationsAllowed; // r2
  CEntity *m_pEntityOnFire; // r0
  CEntity **p_m_pEntityOnFire; // r5
  CEntity *v36; // r0
  float v37; // s0
  int v38; // r0
  CMatrix *v39; // r0
  CSimpleTransform *p_m_transform; // r1
  __int64 v41; // d16
  FxSystem_c *v42; // r0
  float v43; // s0
  float v44; // s2
  float v45; // s4
  char *v46; // r1
  FxSystem_c *v48; // r0
  CVector *p_offsetPos; // r2
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v52; // d16
  FxSystem_c *v53; // r0
  FxSystem_c *FxSystem; // r0
  RwV3d_0 offsetPos; // [sp+8h] [bp-28h] BYREF

  if ( !pEntity )
    goto LABEL_31;
  v10 = *(_BYTE *)&pEntity->m_info & 7;
  if ( v10 == 2 )
  {
    bdummy = (_BYTE *)pEntity[19].m_nFlags.bdummy;
    if ( !bdummy )
      goto LABEL_28;
    *bdummy &= ~2u;
    v21 = pEntity[19].m_nFlags.bdummy;
    v22 = *(_BYTE *)v21;
    if ( (*(_BYTE *)v21 & 1) == 0 )
      goto LABEL_28;
    *(_DWORD *)(v21 + 24) = 0;
    v23 = *(FxSystem_c **)(v21 + 36);
    *(_BYTE *)v21 = v22 & 0xE6 | 0x10;
    if ( v23 )
    {
      FxSystem_c::Kill(v23);
      *(_DWORD *)(v21 + 36) = 0;
    }
    v26 = *(CEntity **)(v21 + 16);
    v25 = (CEntity **)(v21 + 16);
    v24 = v26;
    if ( !v26 )
      goto LABEL_28;
    v27 = *(_BYTE *)&v24->m_info & 7;
    if ( v27 == 2 )
    {
      p_bdummy = &v24[19].m_nFlags.bdummy;
    }
    else
    {
      if ( v27 != 3 )
        goto LABEL_26;
      p_bdummy = &v24[30].m_nScanCode;
    }
    *p_bdummy = 0;
    v24 = *v25;
    if ( !*v25 )
    {
LABEL_27:
      *v25 = 0;
LABEL_28:
      if ( !pEntity[24]._vptr$CPlaceable
        && CDamageManager::GetEngineStatus((const CDamageManager *)&pEntity[24].m_pMat) >= 0xE1 )
      {
        CDamageManager::SetEngineStatus((CDamageManager *)&pEntity[24].m_pMat, 0xD7u);
      }
      goto LABEL_31;
    }
LABEL_26:
    CEntity::CleanUpOldReference(v24, v25);
    goto LABEL_27;
  }
  if ( v10 == 3 )
  {
    v11 = *(_BYTE **)&pEntity[30].m_nScanCode;
    if ( v11 )
    {
      *v11 &= ~2u;
      v12 = *(char **)&pEntity[30].m_nScanCode;
      v13 = *v12;
      if ( (*v12 & 1) != 0 )
      {
        *((_DWORD *)v12 + 6) = 0;
        v14 = (FxSystem_c *)*((_DWORD *)v12 + 9);
        *v12 = v13 & 0xE6 | 0x10;
        if ( v14 )
        {
          FxSystem_c::Kill(v14);
          *((_DWORD *)v12 + 9) = 0;
        }
        v17 = (CEntity *)*((_DWORD *)v12 + 4);
        v16 = (CEntity **)(v12 + 16);
        v15 = v17;
        if ( v17 )
        {
          v18 = *(_BYTE *)&v15->m_info & 7;
          if ( v18 == 2 )
          {
            p_m_nScanCode = &v15[19].m_nFlags.bdummy;
          }
          else
          {
            if ( v18 != 3 )
              goto LABEL_22;
            p_m_nScanCode = &v15[30].m_nScanCode;
          }
          *p_m_nScanCode = 0;
          v15 = *v16;
          if ( !*v16 )
          {
LABEL_23:
            *v16 = 0;
            goto LABEL_31;
          }
LABEL_22:
          CEntity::CleanUpOldReference(v15, v16);
          goto LABEL_23;
        }
      }
    }
  }
LABEL_31:
  NextFreeFire = CFireManager::GetNextFreeFire(this, 1u);
  v30 = (uint32)NextFreeFire;
  if ( !NextFreeFire )
    return -1;
  v31 = *(_BYTE *)NextFreeFire | 7;
  *(_BYTE *)NextFreeFire = v31;
  v32 = *(_QWORD *)&Coors->x;
  NextFreeFire->m_vLocation.z = Coors->z;
  *(_BYTE *)NextFreeFire = v31 & 0xE7 | 0x10;
  *(_QWORD *)&NextFreeFire->m_vLocation.x = v32;
  m_nMaxGenerationsAllowed = gFireManager.m_nMaxGenerationsAllowed;
  p_m_pEntityOnFire = &NextFreeFire->m_pEntityOnFire;
  m_pEntityOnFire = NextFreeFire->m_pEntityOnFire;
  if ( gFireManager.m_nMaxGenerationsAllowed > NumGenerationsAllowed )
    m_nMaxGenerationsAllowed = NumGenerationsAllowed;
  *(_BYTE *)(v30 + 32) = m_nMaxGenerationsAllowed;
  if ( m_pEntityOnFire )
    CEntity::CleanUpOldReference(m_pEntityOnFire, (CEntity **)(v30 + 16));
  *p_m_pEntityOnFire = pEntity;
  if ( pEntity )
    CEntity::RegisterReference(pEntity, (CEntity **)(v30 + 16));
  v36 = *(CEntity **)(v30 + 20);
  if ( v36 )
    CEntity::CleanUpOldReference(v36, (CEntity **)(v30 + 20));
  v37 = (float)Strength;
  *(_DWORD *)(v30 + 20) = 0;
  *(float *)(v30 + 28) = (float)Strength;
  if ( !pEntity )
  {
    v48 = *(FxSystem_c **)(v30 + 36);
    if ( v48 )
    {
      FxSystem_c::Kill(v48);
      v37 = *(float *)(v30 + 28);
      *(_DWORD *)(v30 + 36) = 0;
    }
    v46 = "fire_med";
    if ( v37 > 2.0 )
      v46 = "fire_large";
    if ( v37 <= 1.0 )
      v46 = "fire";
    p_offsetPos = (CVector *)Coors;
    goto LABEL_65;
  }
  memset(&offsetPos, 0, sizeof(offsetPos));
  v38 = *(_BYTE *)&pEntity->m_info & 7;
  if ( v38 == 2 )
  {
    m_pMat = pEntity->m_pMat;
    pEntity[19].m_nFlags.bdummy = v30;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pEntity->m_transform;
    v52 = *(_QWORD *)&p_tx->m_translate.x;
    offsetPos.z = p_tx->m_translate.z;
    *(_QWORD *)&offsetPos.x = v52;
    v53 = *(FxSystem_c **)(v30 + 36);
    if ( v53 )
    {
      FxSystem_c::Kill(v53);
      *(_DWORD *)(v30 + 36) = 0;
    }
    v43 = 2.0;
    v44 = 1.0;
    v45 = *(float *)(v30 + 28);
    v46 = "fire_med";
    goto LABEL_61;
  }
  if ( v38 == 3 )
  {
    v39 = pEntity->m_pMat;
    *(_DWORD *)&pEntity[30].m_nScanCode = v30;
    p_m_transform = (CSimpleTransform *)&v39->tx;
    if ( !v39 )
      p_m_transform = &pEntity->m_transform;
    v41 = *(_QWORD *)&p_m_transform->m_translate.x;
    offsetPos.z = p_m_transform->m_translate.z;
    *(_QWORD *)&offsetPos.x = v41;
    v42 = *(FxSystem_c **)(v30 + 36);
    if ( v42 )
    {
      FxSystem_c::Kill(v42);
      *(_DWORD *)(v30 + 36) = 0;
    }
    v43 = 2.0;
    v44 = 1.0;
    v45 = *(float *)(v30 + 28);
    v46 = "fire_med";
LABEL_61:
    p_offsetPos = (CVector *)&offsetPos;
    if ( v45 > v43 )
      v46 = "fire_large";
    if ( v45 <= v44 )
      v46 = "fire";
LABEL_65:
    FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, (unsigned __int8 *)v46, p_offsetPos, 0, 1);
    *(_DWORD *)(v30 + 36) = FxSystem;
    if ( FxSystem )
      FxSystem_c::Play(FxSystem);
  }
  return CTheScripts::GetNewUniqueScriptThingIndex(-858993459 * ((int)(v30 - (_DWORD)this) >> 3), 5u);
}
// 676438: using guessed type CFireManager *gFireManager_ptr;

//----- (003F3400) --------------------------------------------------------
bool8 __fastcall CFireManager::IsScriptFireExtinguished(CFireManager *this, Int16 FireNum)
{
  return (*(_BYTE *)&this->m_Fires[FireNum] & 1) == 0;
}

//----- (003F3410) --------------------------------------------------------
void __fastcall CFireManager::RemoveScriptFire(CFireManager *this, Int16 FireNum)
{
  int v2; // r2
  char v3; // r1
  char *v4; // r4
  FxSystem_c *v5; // r0
  CEntity *v6; // r0
  CEntity **v7; // r4
  CEntity *v8; // t1
  int v9; // r1
  _DWORD *p_bdummy; // r0

  v2 = 5 * FireNum;
  v3 = (char)this->m_Fires[FireNum];
  if ( (v3 & 2) != 0 )
  {
    v4 = (char *)this + 8 * v2;
    *v4 = v3 & 0xFD;
    if ( (v3 & 1) != 0 )
    {
      *((_DWORD *)v4 + 6) = 0;
      *v4 = v3 & 0xE4 | 0x10;
      v5 = (FxSystem_c *)*((_DWORD *)v4 + 9);
      if ( v5 )
      {
        FxSystem_c::Kill(v5);
        *((_DWORD *)v4 + 9) = 0;
      }
      v8 = (CEntity *)*((_DWORD *)v4 + 4);
      v7 = (CEntity **)(v4 + 16);
      v6 = v8;
      if ( v8 )
      {
        v9 = *(_BYTE *)&v6->m_info & 7;
        if ( v9 == 2 )
        {
          p_bdummy = &v6[19].m_nFlags.bdummy;
        }
        else
        {
          if ( v9 != 3 )
            goto LABEL_11;
          p_bdummy = &v6[30].m_nScanCode;
        }
        *p_bdummy = 0;
        v6 = *v7;
        if ( !*v7 )
        {
LABEL_12:
          *v7 = 0;
          return;
        }
LABEL_11:
        CEntity::CleanUpOldReference(v6, v7);
        goto LABEL_12;
      }
    }
  }
}

//----- (003F348A) --------------------------------------------------------
void __fastcall CFireManager::RemoveAllScriptFires(CFireManager *this)
{
  int i; // r6
  char v3; // r0
  char *v4; // r5
  FxSystem_c *m_fxSysPtr; // r0
  int v6; // r0
  CEntity **v7; // r1
  int v8; // r2
  _DWORD *v9; // r0
  CEntity *v10; // r0

  for ( i = 0; i != 60; ++i )
  {
    v3 = (char)this->m_Fires[i];
    if ( (v3 & 2) != 0 )
    {
      *(_BYTE *)&this->m_Fires[i] = v3 & 0xFD;
      if ( (v3 & 1) != 0 )
      {
        v4 = (char *)this + i * 40;
        *(_BYTE *)&this->m_Fires[i] = v3 & 0xE4 | 0x10;
        m_fxSysPtr = this->m_Fires[i].m_fxSysPtr;
        this->m_Fires[i].m_nTimeToBurn = 0;
        if ( m_fxSysPtr )
        {
          FxSystem_c::Kill(m_fxSysPtr);
          *((_DWORD *)v4 + 9) = 0;
        }
        v7 = (CEntity **)(v4 + 16);
        v6 = *((_DWORD *)v4 + 4);
        if ( v6 )
        {
          v8 = *(_BYTE *)(v6 + 58) & 7;
          if ( v8 == 2 )
          {
            v9 = (_DWORD *)(v6 + 1172);
          }
          else
          {
            if ( v8 != 3 )
            {
              CEntity::CleanUpOldReference((CEntity *)v6, v7);
LABEL_15:
              *((_DWORD *)v4 + 4) = 0;
              continue;
            }
            v9 = (_DWORD *)(v6 + 1848);
          }
          *v9 = 0;
          v10 = (CEntity *)*((_DWORD *)v4 + 4);
          if ( v10 )
            CEntity::CleanUpOldReference(v10, v7);
          goto LABEL_15;
        }
      }
    }
  }
}

//----- (003F3512) --------------------------------------------------------
void __fastcall CFireManager::ClearAllScriptFireFlags(CFireManager *this)
{
  int i; // r1

  for ( i = 0; i != 60; ++i )
    *(_BYTE *)&this->m_Fires[i] &= ~2u;
}

//----- (003F3526) --------------------------------------------------------
void __fastcall CFireManager::SetScriptFireAudio(CFireManager *this, Int16 FireNum, bool bAudioFlag)
{
  int v3; // r12
  char v4; // r3
  char v5; // r1

  v3 = FireNum;
  v4 = (char)this->m_Fires[FireNum];
  v5 = v4 & 0xFB;
  if ( bAudioFlag )
    v5 = v4 | 4;
  *(_BYTE *)&this->m_Fires[v3] = v5;
}

//----- (003F3540) --------------------------------------------------------
CVector *__fastcall CFireManager::GetScriptFireCoords(CFireManager *this, Int16 FireNum)
{
  return &this->m_Fires[FireNum].m_vLocation;
}

//----- (003F354C) --------------------------------------------------------
int32 __fastcall CFireManager::GetNumFiresInRange(CFireManager *this, CVector *pos, float range)
{
  int v3; // r3
  int32 v4; // r12
  float32x2_t v6; // d16
  unsigned __int64 v7; // d1

  v3 = 0;
  v4 = 0;
  do
  {
    if ( (*(_BYTE *)&this->m_Fires[v3] & 3) == 1 )
    {
      v6.n64_u64[0] = vsub_f32(*(float32x2_t *)&this->m_Fires[v3].m_vLocation.x, *(float32x2_t *)&pos->x).n64_u64[0];
      v7 = vmul_f32(v6, v6).n64_u64[0];
      if ( sqrtf(*(float *)&v7 + *((float *)&v7 + 1)) <= range )
        ++v4;
    }
    ++v3;
  }
  while ( v3 != 60 );
  return v4;
}

//----- (003F3598) --------------------------------------------------------
int32 __fastcall CFireManager::GetNumFiresInArea(
        CFireManager *this,
        float MinX,
        float MinY,
        float MinZ,
        float MaxX,
        float MaxY,
        float MaxZ)
{
  int v10; // r2
  int v11; // r12
  float *v13; // r3
  float x; // s12
  float v15; // s12
  float v16; // s12
  int v17; // r3
  int v18; // r1

  v10 = 0;
  v11 = 0;
  do
  {
    if ( (*(_BYTE *)&this->m_Fires[v10] & 3) == 1 )
    {
      v13 = (float *)((char *)this + v10 * 40);
      x = this->m_Fires[v10].m_vLocation.x;
      if ( x >= MinX && x <= MaxX )
      {
        v15 = v13[2];
        if ( v15 >= MinY && v15 <= MaxY )
        {
          v16 = v13[3];
          v17 = 0;
          v18 = 0;
          if ( v16 >= MinZ )
            v17 = 1;
          if ( v16 <= MaxZ )
            v18 = 1;
          v11 += v18 & v17;
        }
      }
    }
    ++v10;
  }
  while ( v10 != 60 );
  return v11;
}

//----- (003F3628) --------------------------------------------------------
void CCreepingFire::SetReadyToBurn()
{
  memset(CCreepingFire::m_aFireStatus, 0, sizeof(CCreepingFire::m_aFireStatus));
}

//----- (003F3640) --------------------------------------------------------
void CCreepingFire::Update()
{
  UInt8 *v0; // r0
  UInt32 v1; // r1
  unsigned int v2; // r2

  v0 = CCreepingFire::m_aFireStatus[CTimer::m_FrameCounter & 0x1F];
  v1 = (CTimer::m_FrameCounter >> 5) & 0x1F;
  v2 = (unsigned __int8)(v0[v1] - 4);
  if ( v2 <= 2 )
    v0[v1] = (unsigned int)&stru_503FC.st_value >> (8 * v2);
}
// 503FC: using guessed type Elf32_Sym stru_503FC;

//----- (003F3684) --------------------------------------------------------
int CGame::InitialiseOnceBeforeRW()
{
  CMemoryMgr::Init();
  MobileSettings::Initialize();
  CLocalisation::Initialise();
  CFileMgr::Initialise();
  CdStreamInit(5);
  CPad::Initialise();
  return 1;
}

//----- (003F36A8) --------------------------------------------------------
void CGame::ShutdownRenderWare()
{
  RwMatrixDestroy(CGame::m_pWorkingMatrix1);
  RwMatrixDestroy(CGame::m_pWorkingMatrix2);
  CLoadingScreen::Shutdown(0);
  CHud::Shutdown();
  CFont::Shutdown();
  CPlayerInfo::DeletePlayerSkin(CWorld::Players);
  CPlayerInfo::DeletePlayerSkin(&CWorld::Players[1]);
  CPlayerSkin::Shutdown();
  DestroyDebugFont();
  LightsDestroy(Scene.world);
  CVisibilityPlugins::Shutdown();
  RpWorldRemoveCamera(Scene.world, Scene.camera);
  RpWorldDestroy(Scene.world);
  CameraDestroy(Scene.camera);
  Scene.world = 0;
  for ( Scene.camera = 0; TextureDatabaseRuntime::loaded.numEntries; --TextureDatabaseRuntime::loaded.numEntries )
  {
    TextureDatabaseRuntime::Unload(*TextureDatabaseRuntime::loaded.dataPtr);
    memmove(
      TextureDatabaseRuntime::loaded.dataPtr,
      TextureDatabaseRuntime::loaded.dataPtr + 1,
      4 * TextureDatabaseRuntime::loaded.numEntries - 4);
  }
  sub_190AE0();
}

//----- (003F376C) --------------------------------------------------------
void CGame::FinalShutdown()
{
  CPathFind::Shutdown(&ThePaths);
  CTempColModels::Shutdown();
  CTxdStore::Shutdown();
  CPedStats::Shutdown();
  CText::Unload(&TheText, 0);
  sub_18B920();
}

//----- (003F37A4) --------------------------------------------------------
bool __fastcall CGame::Initialise(const unsigned __int8 *pDatFile)
{
  CGame::Init1(pDatFile);
  CColAccel::startCache();
  CFileLoader::LoadLevel("DATA\\DEFAULT.DAT");
  CFileLoader::LoadLevel(pDatFile);
  CColAccel::endCache();
  CGame::Init2(pDatFile);
  LoadingScreen("Loading the Game", "Start script", 0);
  CTheScripts::StartTestScript();
  skipFirstMissionSave = 1;
  CTheScripts::Process();
  skipFirstMissionSave = 0;
  CCamera::Process(&TheCamera);
  CGame::Init3(pDatFile);
  return 1;
}

//----- (003F3844) --------------------------------------------------------
int CGame::Shutdown()
{
  int32 TxdSlot; // r0

  BreakManager_c::Exit(&g_breakMan);
  InteriorManager_c::Exit(&g_interiorMan);
  ProcObjectMan_c::Exit(&g_procObjMan);
  WaterCreatureManager_c::Exit(&g_waterCreatureMan);
  CPlantMgr::Shutdown();
  CGrassRenderer::Shutdown();
  CRopes::Shutdown();
  CVehicleRecording::ShutDown();
  CTrain::Shutdown();
  CBirds::Shutdown();
  CSpecialFX::Shutdown();
  CGarages::Shutdown();
  CStuntJumpManager::Shutdown();
  CMovingThings::Shutdown();
  CWeapon::ShutdownWeapons();
  CPedType::Shutdown();
  if ( CWorld::Players[0].pPed )
  {
    CWorld::Remove(CWorld::Players[0].pPed);
    if ( CWorld::Players[0].pPed )
      (*((void (__fastcall **)(CPlayerPed *))CWorld::Players[0].pPed->_vptr$CPlaceable + 1))(CWorld::Players[0].pPed);
    CWorld::Players[0].pPed = 0;
  }
  CPlayerInfo::Clear(CWorld::Players);
  if ( CWorld::Players[1].pPed )
  {
    CWorld::Remove(CWorld::Players[1].pPed);
    if ( CWorld::Players[1].pPed )
      (*((void (__fastcall **)(CPlayerPed *))CWorld::Players[1].pPed->_vptr$CPlaceable + 1))(CWorld::Players[1].pPed);
    CWorld::Players[1].pPed = 0;
  }
  CPlayerInfo::Clear(&CWorld::Players[1]);
  CRenderer::Shutdown();
  CWorld::ShutDown();
  CEntryExitManager::Shutdown();
  Fx_c::Exit(&g_fx);
  BoneNodeManager_c::Exit(&g_boneNodeMan);
  IKChainManager_c::Exit(&g_ikChainMan);
  CRealTimeShadowManager::Exit(&g_realTimeShadowMan);
  CModelInfo::ShutDown();
  CAnimManager::Shutdown();
  CCutsceneMgr::Shutdown();
  CVehicleModelInfo::DeleteVehicleColourTextures();
  CVehicleModelInfo::ShutdownEnvironmentMaps();
  CRadar::Shutdown();
  CTouchInterface::DeleteAll();
  CStreaming::Shutdown();
  CTxdStore::GameShutdown();
  CCollision::Shutdown();
  CWaterLevel::Shutdown();
  CClouds::Shutdown();
  CShadows::Shutdown();
  CCoronas::Shutdown();
  CSkidmarks::Shutdown();
  CWeaponEffects::Shutdown();
  CTimeCycle::Shutdown();
  CPtrListDoubleLink::Flush(&CCover::m_ListOfProcessedBuildings);
  CPedGroups::CleanUpForShutDown();
  CTaskSequences::CleanUpForShutdown();
  CInformGroupEventQueue::Flush();
  CInformFriendsEventQueue::Flush();
  CPools::ShutDown();
  CCarFXRenderer::Shutdown();
  CCustomBuildingRenderer::Shutdown();
  CVehicleModelInfo::ShutdownLightTexture();
  CVehicle::Shutdown();
  CCarFXRenderer::Shutdown();
  CCustomCarPlateMgr::Shutdown();
  CCustomRoadsignMgr::Shutdown();
  CHud::ReInitialise();
  CTxdStore::RemoveTxdSlot(gameTxdSlot);
  TxdSlot = CTxdStore::FindTxdSlot("particle");
  CTxdStore::RemoveTxdSlot(TxdSlot);
  CTaskSimpleFight::m_sStrikeColModel.m_pColData = 0;
  CTaskSimpleFight::m_sStrikeColData.m_pSphereArray = 0;
  CTaskSimpleClimb::Shutdown();
  CPedAttractor::ms_tasks.numEntries = 0;
  CTheScripts::RemoveScriptTextureDictionary();
  CMBlur::MotionBlurClose();
  CdStreamRemoveImages();
  return 1;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003F3A64) --------------------------------------------------------
void CGame::ReInitGameObjectVariables()
{
  CPad *Pad; // r0
  CPad *v1; // r0

  CCamera::Init(&TheCamera);
  CGameLogic::InitAtStartOfGame();
  CGangWars::InitAtStartOfGame();
  CWanted::InitialiseStaticVariables();
  CCamera::Init(&TheCamera);
  CCamera::SetRwCamera(&TheCamera, Scene.camera);
  CSkidmarks::Clear();
  CWeather::Init();
  CCover::Init();
  CUserDisplay::Init();
  CMessages::Init();
  CRestart::Initialise();
  CPostEffects::ScriptResetForEffects();
  CWorld::bDoingCarCollisions = 0;
  CHud::ReInitialise();
  CRadar::Initialise();
  CCarCtrl::ReInit();
  CPathFind::ReInit(&ThePaths);
  CTimeCycle::Initialise(0);
  CPopCycle::Initialise();
  CDraw::SetFOV(120.0, 0);
  CGame::currArea = AREA_MAIN_MAP;
  CDraw::ms_fLODDistance = 500.0;
  CPed::Initialise();
  CWeapon::InitialiseWeapons();
  CPopulation::Initialise();
  CPlayerInfo::Clear(CWorld::Players);
  CPlayerInfo::Clear(&CWorld::Players[1]);
  CWorld::PlayerInFocus = 0;
  CGlass::Init();
  gbLARiots = 0;
  gbLARiots_NoPoliceCars = 0;
  CTheScripts::Init();
  CMenuSystem::Initialise();
  CGangs::Initialise();
  CTimer::Initialise();
  CClock::Initialise(0x3E8u);
  CTheCarGenerators::Init();
  CHeli::InitHelis();
  CMovingThings::Init();
  CDarkel::Init();
  CStats::Init();
  CGarages::Init_AfterRestart();
  CRoadBlocks::Init();
  CStreaming::DisableCopBikes(0);
  CSpecialFX::Init();
  CRopes::Init();
  CWaterCannons::Init();
  CDecisionMakerTypesFileLoader::ReStart();
  CVehicleRecording::Init();
  CFireManager::Init(&gFireManager);
  InteriorManager_c::Init(&g_interiorMan);
  ProcObjectMan_c::Init(&g_procObjMan);
  WaterCreatureManager_c::Init(&g_waterCreatureMan);
  CRealTimeShadowManager::Init(&g_realTimeShadowMan);
  CStreaming::RemoveInappropriatePedModels();
  CAudioEngine::ResetStatistics(&AudioEngine);
  if ( !gMobileMenu.WantsToLoad )
  {
    CCranes::InitCranes();
    CTheScripts::StartTestScript();
    CTheScripts::Process();
    CCamera::Process(&TheCamera);
    CTrain::InitTrains();
  }
  Pad = CPad::GetPad(0);
  CPad::Clear(Pad, 1, 1);
  v1 = CPad::GetPad(1);
  sub_199998(v1, 1, 1);
}
// 676438: using guessed type CFireManager *gFireManager_ptr;
// 678910: using guessed type char *gbLARiots_ptr[8];

//----- (003F3C58) --------------------------------------------------------
void CGame::ShutDownForRestart()
{
  CVehicleRecording::ShutDown();
  CMovingThings::Shutdown();
  CPlayerInfo::Clear(CWorld::Players);
  CPlayerInfo::Clear(&CWorld::Players[1]);
  *(_QWORD *)&CTheZones::ZonesVisited[8][0] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[8][8] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[6][4] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[7][2] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[4][8] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[5][6] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[3][2] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[4][0] = 0LL;
  *(_DWORD *)&CTheZones::ZonesVisited[9][6] = 0;
  *(_QWORD *)&CTheZones::ZonesVisited[0][0] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[0][8] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[1][6] = 0LL;
  *(_QWORD *)&CTheZones::ZonesVisited[2][4] = 0LL;
  CTheScripts::UndoBuildingSwaps();
  CTheScripts::UndoEntityInvisibilitySettings();
  InteriorManager_c::Exit(&g_interiorMan);
  ProcObjectMan_c::Exit(&g_procObjMan);
  WaterCreatureManager_c::Exit(&g_waterCreatureMan);
  CRopes::Shutdown();
  CWorld::ClearForRestart();
  CGameLogic::ClearSkip(0);
  CTimer::Shutdown();
  CStreaming::ReInit();
  CRadar::RemoveRadarSections();
  CMenuManager::UnloadTextures(&FrontEndMenuManager);
  CSetPieces::Init();
  CConversations::Clear();
  CPedToPlayerConversations::Clear();
  CPedType::Shutdown();
  CSpecialFX::Shutdown();
  CFireManager::Shutdown(&gFireManager);
  Fx_c::Reset(&g_fx);
  BreakManager_c::ResetAll(&g_breakMan);
  BoneNodeManager_c::Reset(&g_boneNodeMan);
  IKChainManager_c::Reset(&g_ikChainMan);
  CRealTimeShadowManager::Exit(&g_realTimeShadowMan);
  CTheZones::ResetZonesRevealed();
  CEntryExitManager::ShutdownForRestart();
  CShopping::ShutdownForRestart();
  CTagManager::ShutdownForRestart();
  CStuntJumpManager::ShutdownForRestart();
  CGame::TidyUpMemory(0, 0);
  CVehicle::ms_forceVehicleLightsOff = 0;
}
// 676438: using guessed type CFireManager *gFireManager_ptr;
// 679D90: using guessed type char *CVehicle::ms_forceVehicleLightsOff[3];

//----- (003F3DA4) --------------------------------------------------------
void __fastcall CGame::TidyUpMemory(bool bMoveTextures, bool bWait)
{
  CBuildingPool *v2; // r4
  int32 m_nSize; // r0
  int v4; // r6
  int v5; // r5
  CEntity *v6; // r0
  CDummyPool *v7; // r4
  int32 v8; // r0
  int v9; // r6
  int v10; // r5
  CEntity *v11; // r0

  CTimer::Suspend();
  v2 = CPools::ms_pBuildingPool;
  m_nSize = CPools::ms_pBuildingPool->m_nSize;
  if ( m_nSize )
  {
    v4 = m_nSize - 1;
    v5 = 60 * m_nSize - 60;
    do
    {
      if ( (v2->m_aFlags[v4] & 0x80u) == 0 )
      {
        v6 = (CEntity *)&(*v2->m_aStorage)[v5];
        if ( v6 )
        {
          if ( v6->m_pRwObject )
            TidyUpModelInfo2(v6, 0);
        }
      }
      --v4;
      v5 -= 60;
    }
    while ( v4 != -1 );
  }
  v7 = CPools::ms_pDummyPool;
  v8 = CPools::ms_pDummyPool->m_nSize;
  if ( v8 )
  {
    v9 = v8 - 1;
    v10 = 60 * v8 - 60;
    do
    {
      if ( (v7->m_aFlags[v9] & 0x80u) == 0 )
      {
        v11 = (CEntity *)&(*v7->m_aStorage)[v10];
        if ( v11 )
        {
          if ( v11->m_pRwObject )
            TidyUpModelInfo2(v11, 0);
        }
      }
      --v9;
      v10 -= 60;
    }
    while ( v9 != -1 );
  }
  sub_19F744();
}

//----- (003F3E3C) --------------------------------------------------------
void CGame::InitialiseWhenRestarting()
{
  int v0; // r6
  char *v1; // r1
  bool bWrongVersion; // [sp+Bh] [bp-1Dh] BYREF
  CRGBA v3; // [sp+Ch] [bp-1Ch] BYREF

  CRGBA::CRGBA(&v3, 0xFFu, 0xFFu, 0xFFu, 0xFFu);
  CTimer::Initialise();
  CEventScanner::m_sDeadPedWalkingTimer = 0;
  if ( gMobileMenu.WantsToLoad )
  {
    if ( CLoadingScreen::m_bActive )
    {
      CLoadingScreen::DisplayPCScreen();
    }
    else if ( bLoadingScene )
    {
      Pump_SwapBuffers();
    }
    CGenericGameStorage::RestoreForStartLoad();
    CStreaming::RemoveBigBuildings();
  }
  CGame::ReInitGameObjectVariables();
  CTimeCycle::InitForRestart();
  CWeaponEffects::Init();
  CPlane::InitPlaneGenerationAndRemoval();
  if ( gMobileMenu.WantsToLoad )
  {
    if ( CLoadingScreen::m_bActive )
    {
      CLoadingScreen::DisplayPCScreen();
    }
    else if ( bLoadingScene )
    {
      Pump_SwapBuffers();
    }
    gMobileMenu.WantsToLoad = 0;
    CGenericGameStorage::InitRadioStationPositionList();
    if ( CGenericGameStorage::GenericLoad(&bWrongVersion) )
    {
      CTrain::InitTrains();
    }
    else
    {
      v0 = 50;
      do
      {
        if ( bWrongVersion )
          v1 = "FES_LOC";
        else
          v1 = "FED_LFL";
        CMenuManager::MessageScreen(&FrontEndMenuManager, (unsigned __int8 *)v1, 1, 0);
        --v0;
      }
      while ( v0 );
      CCamera::SetFadeColour(&TheCamera, 0, 0, 0);
      CGame::ShutDownForRestart();
      CTimer::Stop();
      CTimer::Initialise();
      gMobileMenu.WantsToLoad = 0;
      CGame::ReInitGameObjectVariables();
      CGame::bMissionPackGame = 0;
      CGame::currLevel = LEVEL_GENERIC;
      CCollision::SortOutCollisionAfterLoad();
      if ( CGenericGameStorage::ms_bFailed )
      {
        CGenericGameStorage::ms_bFailed = 0;
        MobileMenu::LoadFailed(&gMobileMenu);
      }
    }
  }
  CTimer::Update();
  CAudioEngine::ResetSoundEffects(&AudioEngine);
  CAudioEngine::Restart(&AudioEngine);
  Menu_ApplyAudioSettings();
}

//----- (003F4000) --------------------------------------------------------
void CGame::Process()
{
  uint32 CurrentTimeInCycles; // r4
  uint32 v1; // r4
  uint32 v2; // r5
  uint32 v3; // r5
  CSimpleTransform *p_tx; // r3
  __int64 v5; // r0
  unsigned int v6; // r5
  uint32 v7; // r4
  uint32 CyclesPerMillisecond; // r5
  int v9; // r4
  uint32 v10; // r5
  int v11; // r2
  Char *ScriptName; // r4
  char v13; // r0
  CSimpleTransform *p_m_transform; // r0
  bool v15; // zf

  CPad::UpdatePads();
  CTouchInterface::Clear();
  CHID::Update();
  CLoadMonitor::BeginFrame(&g_LoadMonitor);
  CurrentTimeInCycles = CTimer::GetCurrentTimeInCycles();
  v1 = CurrentTimeInCycles / CTimer::GetCyclesPerMillisecond();
  CStreaming::Update();
  v2 = CTimer::GetCurrentTimeInCycles();
  v3 = v2 / CTimer::GetCyclesPerMillisecond();
  CCutsceneMgr::Update();
  if ( !((CCutsceneMgr::ms_cutsceneProcessing || CTimer::m_CodePause) << 24) )
    MobileMenu::Update(&gMobileMenu);
  CTheZones::Update();
  CCover::Update();
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  CAudioZones::Update(0, p_tx->m_translate);
  HIDWORD(v5) = CTimer::m_UserPause;
  LODWORD(v5) = CTimer::m_CodePause;
  CWindModifiers::Number = 0;
  if ( !CTimer::m_CodePause && !CTimer::m_UserPause )
  {
    v6 = v3 - v1;
    CSprite2d::SetRecipNearClip();
    CSprite2d::InitPerFrame();
    CFont::InitPerFrame();
    CCheat::DoCheats();
    CClock::Update();
    CWeather::Update();
    CTheScripts::Process();
    CCollision::Update();
    CPathFind::UpdateStreaming(&ThePaths, 0);
    CTrain::UpdateTrains();
    CHeli::UpdateHelis();
    CDarkel::Update();
    CSkidmarks::Update();
    CGlass::Update();
    CWanted::UpdateEachFrame();
    CCreepingFire::Update();
    CSetPieces::Update();
    CFireManager::Update(&gFireManager);
    if ( v6 > 3 )
    {
      CPopulation::Update(0);
    }
    else
    {
      v7 = CTimer::GetCurrentTimeInCycles();
      CyclesPerMillisecond = CTimer::GetCyclesPerMillisecond();
      CPopulation::Update(1);
      v9 = v7 / CyclesPerMillisecond;
      if ( MobileSettings::settings[0].value >= 2 )
        CPopulation::Update(1);
      v10 = CTimer::GetCurrentTimeInCycles();
      v6 = v10 / CTimer::GetCyclesPerMillisecond() - v9;
    }
    CWeapon::UpdateWeapons();
    if ( !CCutsceneMgr::ms_running )
      CTheCarGenerators::Process();
    CCranes::UpdateCranes();
    CClouds::Update();
    CMovingThings::Update();
    CWaterCannons::Update();
    CUserDisplay::Process();
    CWorld::Process();
    if ( MobileSettings::settings[4].value )
    {
      if ( MobileSettings::settings[4].value != 2 )
      {
        if ( MobileSettings::settings[4].value != 1 )
          goto LABEL_22;
        v11 = 1056964608;
        goto LABEL_21;
      }
      if ( CGame::Process(void)::eOldMode == 2 )
        goto LABEL_22;
    }
    else if ( !CGame::Process(void)::eOldMode )
    {
      goto LABEL_22;
    }
    v11 = 1065353216;
LABEL_21:
    LODWORD(CCarCtrl::CarDensityMultiplier) = v11;
LABEL_22:
    CGame::Process(void)::eOldMode = MobileSettings::settings[4].value;
    if ( CTheScripts::IsPlayerOnAMission() )
    {
      ScriptName = CTheScripts::pActiveScripts->ScriptName;
      if ( !strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "cprace") )
        CGame::Process(void)::bCpraceActive = 1;
      if ( strcmp((const char *)ScriptName, "heist4") )
        goto LABEL_29;
      v13 = 1;
    }
    else
    {
      v13 = 0;
      CGame::Process(void)::bCpraceActive = 0;
    }
    CGame::Process(void)::bHeist4Active = v13;
LABEL_29:
    if ( CGame::Process(void)::bCpraceActive == 1 )
      CCarCtrl::CarDensityMultiplier = 0.75;
    if ( CGame::Process(void)::bHeist4Active )
      CCarCtrl::CarDensityMultiplier = 1.0;
    CLoadMonitor::EndFrame(&g_LoadMonitor);
    if ( !CTimer::bSkipProcessThisFrame )
    {
      CPickups::Update();
      CCarCtrl::PruneVehiclesOfInterest();
      CGarages::Update();
      CEntryExitManager::Update();
      CStuntJumpManager::Update();
      CBirds::Update();
      CSpecialFX::Update();
      CRopes::Update();
    }
    CPostEffects::Update();
    CTimeCycle::Update();
    CPopCycle::Update();
    if ( *((unsigned __int8 *)&g_InterestingEvents + 300) << 31 )
      CInterestingEvents::ScanForNearbyEntities(&g_InterestingEvents);
    CCamera::Process(&TheCamera);
    CCullZones::Update();
    CGameLogic::Update();
    CGangWars::Update();
    CConversations::Update();
    CPedToPlayerConversations::Update();
    CBridge::Update();
    CCoronas::DoSunAndMoon();
    CCoronas::Update();
    CShadows::UpdatePermanentShadows();
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    CPlantMgr::Update(&p_m_transform->m_translate);
    CCustomBuildingRenderer::Update();
    if ( v6 <= 3 )
      CCarCtrl::GenerateRandomCars();
    CRoadBlocks::GenerateRoadBlocks();
    CCarCtrl::RemoveDistantCars();
    CCarCtrl::RemoveCarsIfThePoolGetsFull();
    Fx_c::Update(&g_fx, TheCamera.m_pRwCamera, CTimer::ms_fTimeStep / 50.0);
    BreakManager_c::Update(&g_breakMan, CTimer::ms_fTimeStep);
    InteriorManager_c::Update(&g_interiorMan);
    ProcObjectMan_c::Update(&g_procObjMan);
    WaterCreatureManager_c::Update(&g_waterCreatureMan, CTimer::ms_fTimeStep / 50.0);
    LODWORD(v5) = CTimer::m_CodePause;
    HIDWORD(v5) = CTimer::m_UserPause;
  }
  if ( v5 )
  {
    v15 = gMobileMenu.screenStack.numEntries == 0;
    if ( !gMobileMenu.screenStack.numEntries )
      v15 = gMobileMenu.pendingScreen == 0;
    if ( v15 )
      CCamera::Process(&TheCamera);
    CHeli::UpdateHelis();
  }
  CCheat::ProcessAllCheats();
  sub_196A30();
}
// 9595B4: using guessed type char CGame::Process(void)::bCpraceActive;

//----- (003F445C) --------------------------------------------------------
bool __fastcall MoveMem(void **ppMem)
{
  void *v2; // r0
  void *v3; // r0

  v2 = *ppMem;
  if ( !v2 )
    return 0;
  ++gNumMemMoved;
  v3 = CMemoryMgr::MoveMemory(v2);
  if ( v3 == *ppMem )
    return 0;
  *ppMem = v3;
  return 1;
}

//----- (003F4488) --------------------------------------------------------
bool __fastcall MoveColModelMemory(CColModel *colModel, bool bQuit)
{
  _BOOL4 v3; // r8
  CCollisionData *m_pColData; // r5
  CColSphere *v5; // r0
  CColSphere *v6; // r0
  CColSphere *v7; // r1
  bool v8; // zf
  CColLine *v9; // r0
  CColLine *v10; // r0
  CColLine *v11; // r1
  bool v12; // zf
  CColBox *v13; // r0
  CColBox *v14; // r0
  CColBox *v15; // r1
  bool v16; // zf
  CollisionVector *v17; // r0
  CollisionVector *v18; // r0
  CollisionVector *v19; // r1
  bool v20; // zf
  CColTriangle *v21; // r0
  CColTriangle *v22; // r0
  CCollisionData *v23; // r6
  CCollisionData *v25; // r0
  int v26; // r0
  CColSphere *m_pSphereArray; // r1
  CColBox *m_pBoxArray; // r1
  CColLine *m_pLineArray; // r1
  CollisionVector *m_pTriCompressedVectorArray; // r1
  CColTriangle *m_pTriangleArray; // r1
  CColTrianglePlane *m_pTrianglePlaneArray; // r0
  CColTrianglePlane *v33; // r0
  char v34; // r0

  v3 = bQuit;
  m_pColData = colModel->m_pColData;
  if ( !m_pColData )
    return 0;
  if ( (*((_BYTE *)colModel + 41) & 2) != 0 )
  {
    v25 = (CCollisionData *)CMemoryMgr::MoveMemory(m_pColData);
    v23 = v25;
    if ( m_pColData != v25 )
    {
      colModel->m_pColData = v25;
      v26 = (char *)v25 - (char *)m_pColData;
      m_pSphereArray = v23->m_pSphereArray;
      if ( m_pSphereArray )
        v23->m_pSphereArray = (CColSphere *)((char *)m_pSphereArray + v26);
      m_pBoxArray = v23->m_pBoxArray;
      if ( m_pBoxArray )
        v23->m_pBoxArray = (CColBox *)((char *)m_pBoxArray + v26);
      m_pLineArray = v23->_anon_1.m_pLineArray;
      if ( m_pLineArray )
        v23->_anon_1.m_pLineArray = (CColLine *)((char *)m_pLineArray + v26);
      m_pTriCompressedVectorArray = v23->m_pTriCompressedVectorArray;
      if ( m_pTriCompressedVectorArray )
        v23->m_pTriCompressedVectorArray = (CollisionVector *)((char *)m_pTriCompressedVectorArray + v26);
      m_pTriangleArray = v23->m_pTriangleArray;
      if ( m_pTriangleArray )
        v23->m_pTriangleArray = (CColTriangle *)((char *)m_pTriangleArray + v26);
      if ( v23->m_pTrianglePlaneArray )
        CCollisionData::GetLinkPtr(v23)->item = v23;
      if ( v3 )
        return 1;
      goto LABEL_44;
    }
LABEL_43:
    v23 = m_pColData;
    goto LABEL_44;
  }
  v5 = m_pColData->m_pSphereArray;
  if ( v5 )
  {
    ++gNumMemMoved;
    v6 = (CColSphere *)CMemoryMgr::MoveMemory(v5);
    v7 = m_pColData->m_pSphereArray;
    v8 = v6 == v7;
    if ( v6 != v7 )
    {
      m_pColData->m_pSphereArray = v6;
      v8 = !v3;
    }
    if ( !v8 )
      return 1;
  }
  v9 = m_pColData->_anon_1.m_pLineArray;
  if ( v9 )
  {
    ++gNumMemMoved;
    v10 = (CColLine *)CMemoryMgr::MoveMemory(v9);
    v11 = m_pColData->_anon_1.m_pLineArray;
    v12 = v10 == v11;
    if ( v10 != v11 )
    {
      m_pColData->_anon_1.m_pLineArray = v10;
      v12 = !v3;
    }
    if ( !v12 )
      return 1;
  }
  v13 = m_pColData->m_pBoxArray;
  if ( v13 )
  {
    ++gNumMemMoved;
    v14 = (CColBox *)CMemoryMgr::MoveMemory(v13);
    v15 = m_pColData->m_pBoxArray;
    v16 = v14 == v15;
    if ( v14 != v15 )
    {
      m_pColData->m_pBoxArray = v14;
      v16 = !v3;
    }
    if ( !v16 )
      return 1;
  }
  v17 = m_pColData->m_pTriCompressedVectorArray;
  if ( v17 )
  {
    ++gNumMemMoved;
    v18 = (CollisionVector *)CMemoryMgr::MoveMemory(v17);
    v19 = m_pColData->m_pTriCompressedVectorArray;
    v20 = v18 == v19;
    if ( v18 != v19 )
    {
      m_pColData->m_pTriCompressedVectorArray = v18;
      v20 = !v3;
    }
    if ( !v20 )
      return 1;
  }
  v21 = m_pColData->m_pTriangleArray;
  if ( !v21 )
    goto LABEL_43;
  ++gNumMemMoved;
  v22 = (CColTriangle *)CMemoryMgr::MoveMemory(v21);
  if ( v22 == m_pColData->m_pTriangleArray )
    goto LABEL_43;
  v23 = m_pColData;
  m_pColData->m_pTriangleArray = v22;
  if ( v3 )
    return 1;
LABEL_44:
  m_pTrianglePlaneArray = v23->m_pTrianglePlaneArray;
  if ( m_pTrianglePlaneArray )
  {
    ++gNumMemMoved;
    v33 = (CColTrianglePlane *)CMemoryMgr::MoveMemory(m_pTrianglePlaneArray);
    if ( v33 == v23->m_pTrianglePlaneArray )
    {
      v34 = 0;
    }
    else
    {
      v23->m_pTrianglePlaneArray = v33;
      v34 = 1;
    }
  }
  else
  {
    v34 = 0;
  }
  return v34 & v3;
}

//----- (003F45F4) --------------------------------------------------------
RpGeometry_0 *__fastcall MoveGeometryMemory(RpGeometry_0 *pGeom)
{
  RpGeometry_0 *result; // r0
  RpTriangle_0 *triangles; // r2
  int v4; // r1
  RwRGBA_0 *preLitLum; // r2
  RwTexCoords_0 *v6; // r2
  RwTexCoords_0 *v7; // r2

  result = (RpGeometry_0 *)CMemoryMgr::MoveMemory(pGeom);
  if ( result == pGeom )
    return 0;
  triangles = result->triangles;
  v4 = (char *)result - (char *)pGeom;
  if ( triangles )
    result->triangles = (RpTriangle_0 *)((char *)triangles + v4);
  preLitLum = result->preLitLum;
  if ( preLitLum )
    result->preLitLum = (RwRGBA_0 *)((char *)preLitLum + v4);
  v6 = result->texCoords[0];
  if ( v6 )
    result->texCoords[0] = (RwTexCoords_0 *)((char *)v6 + v4);
  v7 = result->texCoords[1];
  if ( v7 )
    result->texCoords[1] = (RwTexCoords_0 *)((char *)v7 + v4);
  result->morphTarget->parentGeom = result;
  return result;
}

//----- (003F4638) --------------------------------------------------------
bool __fastcall TidyUpModelInfo2(CEntity *pEntity, bool bQuit)
{
  _BOOL4 v3; // r4
  CBaseModelInfo *v4; // r0
  int v5; // r0
  int v6; // r6
  RwObject_0 *m_pRwObject; // r8
  char *v8; // r5
  char *v9; // r0
  int v10; // r2
  int v11; // r1
  int v12; // r2
  int v13; // r2
  int v14; // r2

  v3 = bQuit;
  v4 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  v5 = (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 2))(v4);
  if ( !v5 )
    return 0;
  if ( *(__int16 *)(v5 + 30) > 1 )
    return 0;
  v6 = *(_DWORD *)(v5 + 52);
  m_pRwObject = pEntity->m_pRwObject;
  v8 = *(char **)(v6 + 24);
  v9 = (char *)CMemoryMgr::MoveMemory(v8);
  if ( v8 == v9 )
    return 0;
  v10 = *((_DWORD *)v9 + 11);
  v11 = v9 - v8;
  if ( v10 )
    *((_DWORD *)v9 + 11) = v10 + v11;
  v12 = *((_DWORD *)v9 + 12);
  if ( v12 )
    *((_DWORD *)v9 + 12) = v12 + v11;
  v13 = *((_DWORD *)v9 + 13);
  if ( v13 )
    *((_DWORD *)v9 + 13) = v13 + v11;
  v14 = *((_DWORD *)v9 + 14);
  if ( v14 )
    *((_DWORD *)v9 + 14) = v11 + v14;
  **((_DWORD **)v9 + 24) = v9;
  if ( *(_DWORD *)&m_pRwObject[3].type == *(_DWORD *)(v6 + 24) )
    *(_DWORD *)&m_pRwObject[3].type = v9;
  *(_DWORD *)(v6 + 24) = v9;
  return v3;
}

//----- (003F46CC) --------------------------------------------------------
void __fastcall CGame::DrasticTidyUpMemory(bool bWait)
{
  if ( !CGame::DrasticTidyUpMemory(bool)::bInside )
  {
    CGame::DrasticTidyUpMemory(bool)::bInside = 1;
    CTimer::Suspend();
    CGame::TidyUpMemory(0, 0);
    CStreaming::LoadAllRequestedModels(0);
    CTimer::Resume();
    CGame::DrasticTidyUpMemory(bool)::bInside = 0;
  }
}
// 9595BC: using guessed type char CGame::DrasticTidyUpMemory(bool)::bInside;

//----- (003F470C) --------------------------------------------------------
void CGame::ProcessTidyUpMemory()
{
  int v0; // r11
  int32 *v1; // r12
  int v2; // r5
  int32 v3; // r4
  __int64 v4; // r2
  int v5; // r6
  CEntity *v6; // r0
  int32 *v7; // r4
  bool v8; // cc
  int v9; // r11
  int32 *v10; // r12
  int v11; // r5
  int32 v12; // r4
  __int64 v13; // r2
  int v14; // r6
  CEntity *v15; // r0
  int32 *v16; // r4
  int v17; // r6
  int32 v18; // r3
  CAnimBlendHierarchy *v19; // r0

  v0 = 0;
  gNumMemMoved = 0;
  v1 = &CGame::ProcessTidyUpMemory(void)::buildingIndex;
  while ( 2 )
  {
    v2 = 0;
    v3 = CGame::ProcessTidyUpMemory(void)::buildingIndex;
    v4 = *(_QWORD *)&CPools::ms_pBuildingPool->m_aFlags;
    while ( 1 )
    {
      v5 = v3 + 1;
      if ( *(char *)(v4 + v3) < 0 )
        v6 = 0;
      else
        v6 = (CEntity *)CPools::ms_pBuildingPool->m_aStorage[v3];
      if ( v5 >= SHIDWORD(v4) )
        v5 = 0;
      if ( v2 >= 1000 )
      {
        CGame::ProcessTidyUpMemory(void)::buildingIndex = v5;
        goto LABEL_14;
      }
      ++v2;
      v3 = v5;
      if ( v6 )
      {
        v3 = v5;
        if ( v6->m_pRwObject )
          break;
      }
    }
    *v1 = v5;
    v7 = v1;
    TidyUpModelInfo2(v6, 0);
    v8 = v0 < 9;
    v1 = v7;
    ++v0;
    if ( v8 )
      continue;
    break;
  }
LABEL_14:
  v9 = 0;
  v10 = &CGame::ProcessTidyUpMemory(void)::dummyIndex;
  while ( 2 )
  {
    v11 = 0;
    v12 = CGame::ProcessTidyUpMemory(void)::dummyIndex;
    v13 = *(_QWORD *)&CPools::ms_pDummyPool->m_aFlags;
    while ( 1 )
    {
      v14 = v12 + 1;
      if ( *(char *)(v13 + v12) < 0 )
        v15 = 0;
      else
        v15 = (CEntity *)CPools::ms_pDummyPool->m_aStorage[v12];
      if ( v14 >= SHIDWORD(v13) )
        v14 = 0;
      if ( v11 >= 1000 )
      {
        CGame::ProcessTidyUpMemory(void)::dummyIndex = v14;
        goto LABEL_27;
      }
      ++v11;
      v12 = v14;
      if ( v15 )
      {
        v12 = v14;
        if ( v15->m_pRwObject )
          break;
      }
    }
    *v10 = v14;
    v16 = v10;
    TidyUpModelInfo2(v15, 0);
    v8 = v9 < 9;
    v10 = v16;
    ++v9;
    if ( v8 )
      continue;
    break;
  }
LABEL_27:
  v17 = CGame::ProcessTidyUpMemory(void)::animIndex;
  do
  {
    v18 = v17 + 1;
    if ( v17 > 2498 )
      v18 = 0;
    v19 = &CAnimManager::ms_aAnimations[v17];
    v17 = v18;
  }
  while ( !v19 );
  CGame::ProcessTidyUpMemory(void)::animIndex = v18;
  sub_18B020(v19);
}

//----- (003F4884) --------------------------------------------------------
bool CGame::CanSeeOutSideFromCurrArea()
{
  return CGame::currArea == AREA_MAIN_MAP;
}

//----- (003F489C) --------------------------------------------------------
int CGame::CanSeeWaterFromCurrArea()
{
  int v0; // r2
  int v1; // r1

  v0 = 0;
  v1 = 0;
  if ( CGame::currArea == AREA_STRIP_CLUB )
    v0 = 1;
  if ( CGame::currArea == AREA_MAIN_MAP )
    v1 = 1;
  return v1 | v0;
}

//----- (003F48C0) --------------------------------------------------------
float __fastcall CGeneral::GetAngleBetweenPoints(float fX1, float fY1, float fX2, float fY2)
{
  float v4; // s16
  float v5; // s18
  float v6; // r0
  float v7; // s2
  float v8; // s0
  float v9; // s0

  v4 = fY2 - fY1;
  v5 = fX2 - fX1;
  if ( (float)(fY2 - fY1) == 0.0 )
    v4 = 0.0001;
  v6 = atanf(v5 / v4);
  if ( v5 <= 0.0 )
  {
    if ( v4 <= 0.0 )
    {
      v8 = 1.5708 - v6;
      v7 = -1.5708;
      goto LABEL_10;
    }
    v9 = -1.5708 - (float)(v6 + 1.5708);
  }
  else
  {
    v7 = 1.5708;
    if ( v4 > 0.0 )
    {
      v8 = 1.5708 - v6;
LABEL_10:
      v9 = v8 + v7;
      return v9 * 57.296;
    }
    v9 = 1.5708 - (float)(v6 + 1.5708);
  }
  return v9 * 57.296;
}

//----- (003F4974) --------------------------------------------------------
float __fastcall CGeneral::GetRadianAngleBetweenPoints(float fX1, float fY1, float fX2, float fY2)
{
  float v4; // s16
  float v5; // s18
  float v6; // r0
  float v7; // s2
  float v8; // s0

  v4 = fY2 - fY1;
  v5 = fX2 - fX1;
  if ( (float)(fY2 - fY1) == 0.0 )
    v4 = 0.0001;
  v6 = atanf(v5 / v4);
  if ( v5 <= 0.0 )
  {
    if ( v4 <= 0.0 )
    {
      v8 = 1.5708 - v6;
      v7 = -1.5708;
      return v8 + v7;
    }
    return -1.5708 - (float)(v6 + 1.5708);
  }
  else
  {
    v7 = 1.5708;
    if ( v4 > 0.0 )
    {
      v8 = 1.5708 - v6;
      return v8 + v7;
    }
    return 1.5708 - (float)(v6 + 1.5708);
  }
}

//----- (003F4A1C) --------------------------------------------------------
float __fastcall CGeneral::LimitAngle(float fLimitAngle)
{
  float i; // s0

  for ( i = fLimitAngle; i >= 180.0; i = i + -360.0 )
    ;
  for ( ; i < -180.0; i = i + 360.0 )
    ;
  return i;
}

//----- (003F4A78) --------------------------------------------------------
float __fastcall CGeneral::LimitRadianAngle(float fLimitAngle)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  float i; // s0

  v1.n64_u32[0] = -25.0;
  v3.n64_u32[0] = 25.0;
  v2.n64_f32[0] = fLimitAngle;
  for ( i = vmin_f32(vmax_f32(v2, v1), v3).n64_f32[0]; i >= 3.1416; i = i + -6.2832 )
    ;
  for ( ; i < -3.1416; i = i + 6.2832 )
    ;
  return i;
}
// 3F4A84: variable 'v2' is possibly undefined
// 3F4A84: variable 'v1' is possibly undefined
// 3F4A8C: variable 'v3' is possibly undefined

//----- (003F4AE4) --------------------------------------------------------
float __fastcall CGeneral::GetATanOfXY(float X, float Y)
{
  int v3; // r1
  int v5; // r0
  float v7; // s4
  float v8; // s6
  float v9; // r0
  float v10; // s0
  float v11; // r0
  float v12; // s0

  v3 = 0;
  v5 = 0;
  if ( Y == 0.0 )
    v3 = 1;
  if ( X == 0.0 )
    v5 = 1;
  if ( (v5 & v3) != 0 )
    return 0.0;
  v7 = -Y;
  v8 = -X;
  if ( fabsf(X) >= fabsf(Y) )
  {
    if ( Y > 0.0 )
    {
      if ( X > 0.0 )
        return sub_19A728(Y / X);
      v9 = atanf(Y / v8);
      v10 = 3.1416;
      return v10 - v9;
    }
    if ( X > 0.0 )
    {
      v9 = atanf(v7 / X);
      v10 = 6.2832;
      return v10 - v9;
    }
    v11 = atanf(Y / X);
    v12 = 3.1416;
  }
  else if ( Y <= 0.0 )
  {
    if ( X <= 0.0 )
    {
      v9 = atanf(X / Y);
      v10 = 4.7124;
      return v10 - v9;
    }
    v11 = atanf(X / v7);
    v12 = 4.7124;
  }
  else
  {
    if ( X > 0.0 )
    {
      v9 = atanf(X / Y);
      v10 = 1.5708;
      return v10 - v9;
    }
    v11 = atanf(v8 / Y);
    v12 = 1.5708;
  }
  return v11 + v12;
}

//----- (003F4C2C) --------------------------------------------------------
uint16 __fastcall CGeneral::GetNodeHeadingFromVector(float x, float y)
{
  float v2; // s16
  float v3; // s18
  float v4; // r0
  float v5; // s2
  float v6; // s0
  float v7; // s0
  float v8; // s0
  float v9; // s4

  v2 = 0.0 - y;
  v3 = 0.0 - x;
  if ( (float)(0.0 - y) == 0.0 )
    v2 = 0.0001;
  v4 = atanf(v3 / v2);
  if ( v3 <= 0.0 )
  {
    if ( v2 > 0.0 )
    {
      v7 = -1.5708 - (float)(v4 + 1.5708);
      goto LABEL_11;
    }
    v6 = 1.5708 - v4;
    v5 = -1.5708;
  }
  else
  {
    v5 = 1.5708;
    if ( v2 <= 0.0 )
    {
      v7 = 1.5708 - (float)(v4 + 1.5708);
      goto LABEL_11;
    }
    v6 = 1.5708 - v4;
  }
  v7 = v6 + v5;
LABEL_11:
  if ( v7 < 0.0 )
    v7 = v7 + 6.2832;
  v8 = (float)(6.2832 - v7) + 0.3927;
  v9 = v8 + -6.2832;
  if ( v8 < 6.2832 )
    v9 = v8;
  return (unsigned int)floorf((float)(v9 / 6.2832) * 8.0);
}

//----- (003F4D34) --------------------------------------------------------
int __fastcall CGeneral::SolveQuadratic(const float a, const float b, const float c, float *xminus, float *xplus)
{
  float v5; // s4
  int result; // r0
  float v7; // s4
  float v8; // s0

  v5 = (float)(b * b) + (float)((float)(a * -4.0) * c);
  if ( v5 < 0.0 )
    return 0;
  v7 = sqrtf(v5);
  v8 = (float)((float)((float)-b - v7) * 0.5) / a;
  *xplus = (float)((float)(v7 - b) * 0.5) / a;
  result = 1;
  *xminus = v8;
  return result;
}

//----- (003F4D94) --------------------------------------------------------
void CIniFile::LoadIniFile()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d8
  float32x2_t v2; // d9
  u_native v3; // r0
  u_native v4; // r4
  float32x2_t v5; // d0

  CFileMgr::SetDir((const unsigned __int8 *)&byte_61CADE);
  v3 = CFileMgr::OpenFile("gta3.ini", "r");
  v4 = v3;
  if ( v3 )
  {
    CFileMgr::ReadLine(v3, gString, 200);
    sscanf((const char *)gString, (const char *)&dword_3F4E5C, &CIniFile::PedNumberMultiplier);
    v1.n64_u32[0] = 0.5;
    v0.n64_f32[0] = CIniFile::PedNumberMultiplier;
    v2.n64_u32[0] = 3.0;
    v5.n64_u64[0] = vmin_f32(vmax_f32(v0, v1), v2).n64_u64[0];
    CIniFile::PedNumberMultiplier = v5.n64_f32[0];
    CFileMgr::ReadLine(v4, gString, 200);
    sscanf((const char *)gString, (const char *)&dword_3F4E5C, &CIniFile::CarNumberMultiplier);
    v5.n64_f32[0] = CIniFile::CarNumberMultiplier;
    LODWORD(CIniFile::CarNumberMultiplier) = vmin_f32(vmax_f32(v5, v1), v2).n64_u32[0];
    CFileMgr::CloseFile(v4);
  }
  CCarCtrl::MaxNumberOfCarsInUse = 12;
  CPopulation::MaxNumberOfPedsInUse = 25;
}
// 3F4DEA: variable 'v0' is possibly undefined
// 3F4DEA: variable 'v1' is possibly undefined
// 3F4DEE: variable 'v2' is possibly undefined
// 3F4E5C: using guessed type int dword_3F4E5C;
// 61CADE: using guessed type char byte_61CADE;

//----- (003F4E6C) --------------------------------------------------------
uint32 __fastcall CKeyGen::GetKey(const unsigned __int8 *data, int32 len)
{
  uint32 result; // r0
  int v4; // r1
  int v5; // t1

  if ( len < 1 )
    return -1;
  v4 = len + 1;
  result = -1;
  do
  {
    v5 = *data++;
    --v4;
    result = CKeyGen::keyTable[(unsigned __int8)result ^ v5] ^ (result >> 8);
  }
  while ( v4 > 1 );
  return result;
}

//----- (003F4EA8) --------------------------------------------------------
uint32 __fastcall CKeyGen::GetKey(const unsigned __int8 *pString)
{
  unsigned __int8 v1; // r1
  uint32 result; // r0
  const unsigned __int8 *v3; // r2
  uint32 v4; // r3
  int v5; // t1

  v1 = *pString;
  if ( !*pString )
    return -1;
  v3 = pString + 1;
  result = -1;
  do
  {
    v4 = CKeyGen::keyTable[(unsigned __int8)(v1 ^ result)];
    v5 = *v3++;
    v1 = v5;
    result = v4 ^ (result >> 8);
  }
  while ( v5 );
  return result;
}

//----- (003F4EDC) --------------------------------------------------------
uint32 __fastcall CKeyGen::GetUppercaseKey(const unsigned __int8 *pString)
{
  unsigned __int8 v1; // r1
  const unsigned __int8 *v2; // r5
  uint32 v3; // r4
  char v4; // r0
  int v5; // t1

  v1 = *pString;
  if ( !*pString )
    return -1;
  v2 = pString + 1;
  v3 = -1;
  do
  {
    v4 = toupper(v1);
    v5 = *v2++;
    v1 = v5;
    v3 = CKeyGen::keyTable[(unsigned __int8)(v4 ^ v3)] ^ (v3 >> 8);
  }
  while ( v5 );
  return v3;
}

//----- (003F4F20) --------------------------------------------------------
uint32 __fastcall CKeyGen::AppendStringToKey(uint32 key, const unsigned __int8 *pString)
{
  unsigned __int8 v2; // r2
  const unsigned __int8 *v3; // r1
  uint32 v4; // r3
  int v5; // t1

  v2 = *pString;
  if ( *pString )
  {
    v3 = pString + 1;
    do
    {
      v4 = CKeyGen::keyTable[(unsigned __int8)(v2 ^ key)];
      v5 = *v3++;
      v2 = v5;
      key = v4 ^ (key >> 8);
    }
    while ( v5 );
  }
  return key;
}

//----- (003F4F50) --------------------------------------------------------
void __fastcall CLoadMonitor::CLoadMonitor(CLoadMonitor *this)
{
  uint32 v2; // r0

  this->m_bUseLoadMonitor = 1;
  this->m_bInFrame = 0;
  this->m_eProcLevel = eProcLevelOk;
  this->m_bEnableAmbientCrime = 1;
  v2 = CTimer::m_snTimeInMilliseconds;
  *(_QWORD *)this->m_iMaxCycles = 0LL;
  *(_QWORD *)&this->m_iMaxCycles[2] = 0LL;
  this->m_LastTime = v2;
  this->m_NumFramesThisSec = 0;
  this->m_FPS = 0;
  memset(this->m_fAveragedCyclesThisSecond, 0, 0x90u);
  *(_QWORD *)this->m_fPeakLevels = 0x41A0000041700000LL;
  *(_QWORD *)&this->m_fPeakLevels[2] = 0x4248000041200000LL;
  this->m_DisplayType = eNone;
  this->m_VarConsoleDisplayType = 0;
}

//----- (003F4FB6) --------------------------------------------------------
void __fastcall CLoadMonitor::BeginFrame(CLoadMonitor *this)
{
  uint32 *m_iCyclesThisFrame; // r0

  this->m_bInFrame = 1;
  m_iCyclesThisFrame = this->m_iCyclesThisFrame;
  *(_QWORD *)m_iCyclesThisFrame = 0LL;
  *((_QWORD *)m_iCyclesThisFrame + 1) = 0LL;
}

//----- (003F4FC6) --------------------------------------------------------
void __fastcall CLoadMonitor::StartTimer(CLoadMonitor *this, ELoadType type)
{
  this->m_iStartTimes[type] = CTimer::GetCurrentTimeInCycles();
}

//----- (003F4FD6) --------------------------------------------------------
void __fastcall CLoadMonitor::EndTimer(CLoadMonitor *this, ELoadType type)
{
  this->m_iCyclesThisFrame[type] += CTimer::GetCurrentTimeInCycles() - this->m_iStartTimes[type];
}

//----- (003F4FF0) --------------------------------------------------------
void __fastcall CLoadMonitor::EndFrame(CLoadMonitor *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  CPlayerPed *PlayerPed; // r0
  CVehicle *m_pMyVehicle; // r3
  bool v6; // zf
  float *p_z; // r1
  float *p_y; // r2
  float *p_x; // r0
  uint32 v10; // r0
  unsigned int v11; // s0
  uint32 v12; // r0
  uint32 v13; // r1
  float v14; // s0
  unsigned int v15; // s2
  uint32 v16; // r0
  uint32 v17; // r1
  float v18; // s4
  unsigned int v19; // s2
  unsigned int v20; // r0
  uint32 v21; // r1
  float v22; // s2
  uint32 m_LastTime; // r2
  float v24; // s6
  unsigned int v25; // r2
  unsigned int m_NumFramesThisSec; // r0
  float v27; // s10
  __int64 v28; // d16
  __int64 v29; // d17
  __int64 v30; // d18
  __int64 v31; // d19
  uint32 v32; // r4
  __int64 v33; // r0
  uint32 v34; // lr
  uint32 v35; // r3
  uint32 v36; // r12
  __int64 v37; // d20
  __int64 v38; // d21
  float v39; // s6
  __int64 v40; // d22
  __int64 v41; // d23
  uint32 v42; // r2
  unsigned int v43; // r5
  int v44; // r6
  float *v45; // r4
  float v46; // s24
  unsigned int v47; // r0
  unsigned int *v48; // r1
  float v49; // s0

  PlayerPed = FindPlayerPed(-1);
  if ( PlayerPed )
  {
    v6 = *((unsigned __int8 *)&PlayerPed->m_nPedFlags + 1) << 31 == 0;
    if ( *((unsigned __int8 *)&PlayerPed->m_nPedFlags + 1) << 31 )
    {
      m_pMyVehicle = PlayerPed->m_pMyVehicle;
      v6 = m_pMyVehicle == 0;
    }
    if ( v6 )
    {
      p_z = &PlayerPed->m_vecMoveSpeed.z;
      p_y = &PlayerPed->m_vecMoveSpeed.y;
      p_x = &PlayerPed->m_vecMoveSpeed.x;
    }
    else
    {
      p_z = &m_pMyVehicle->m_vecMoveSpeed.z;
      p_y = &m_pMyVehicle->m_vecMoveSpeed.y;
      p_x = &m_pMyVehicle->m_vecMoveSpeed.x;
    }
    this->m_iCyclesThisFrame[3] = (unsigned int)sqrtf(
                                                  (float)((float)((float)(*p_y * 50.0) * (float)(*p_y * 50.0))
                                                        + (float)((float)(*p_x * 50.0) * (float)(*p_x * 50.0)))
                                                + (float)((float)(*p_z * 50.0) * (float)(*p_z * 50.0)));
  }
  v10 = this->m_iCyclesThisFrame[0];
  v11 = v10;
  if ( v10 > this->m_iMaxCycles[0] )
    this->m_iMaxCycles[0] = v10;
  v12 = this->m_iCyclesThisFrame[1];
  v13 = this->m_iMaxCycles[1];
  v14 = this->m_fAveragedCyclesThisSecond[0] + (float)v11;
  v15 = v12;
  this->m_fAveragedCyclesThisSecond[0] = v14;
  if ( v12 > v13 )
    this->m_iMaxCycles[1] = v12;
  v16 = this->m_iCyclesThisFrame[2];
  v17 = this->m_iMaxCycles[2];
  v18 = this->m_fAveragedCyclesThisSecond[1] + (float)v15;
  v19 = v16;
  this->m_fAveragedCyclesThisSecond[1] = v18;
  if ( v16 > v17 )
    this->m_iMaxCycles[2] = v16;
  v20 = this->m_iCyclesThisFrame[3];
  v21 = this->m_iMaxCycles[3];
  v22 = this->m_fAveragedCyclesThisSecond[2] + (float)v19;
  this->m_fAveragedCyclesThisSecond[2] = v22;
  if ( v20 > v21 )
    this->m_iMaxCycles[3] = v20;
  m_LastTime = this->m_LastTime;
  v24 = this->m_fAveragedCyclesThisSecond[3] + (float)v20;
  this->m_fAveragedCyclesThisSecond[3] = v24;
  v25 = CTimer::m_snTimeInMilliseconds - m_LastTime;
  if ( v25 <= 0x7D0 )
  {
    m_NumFramesThisSec = this->m_NumFramesThisSec;
    if ( v25 >> 3 > 0x7C )
    {
      this->m_LastTime = CTimer::m_snTimeInMilliseconds;
      this->m_FPS = m_NumFramesThisSec;
      if ( !m_NumFramesThisSec )
      {
        m_NumFramesThisSec = 1;
        this->m_NumFramesThisSec = 1;
      }
      v27 = (float)m_NumFramesThisSec;
      v28 = *(_QWORD *)&this->m_iCyclesHistory[0][0];
      v29 = *(_QWORD *)&this->m_iCyclesHistory[0][2];
      v30 = *(_QWORD *)&this->m_iCyclesHistory[1][2];
      v31 = *(_QWORD *)&this->m_iCyclesHistory[1][4];
      v32 = this->m_iCyclesHistory[0][6];
      v33 = *(_QWORD *)&this->m_iCyclesHistory[1][0];
      v34 = this->m_iCyclesHistory[2][4];
      v35 = this->m_iCyclesHistory[2][5];
      v36 = this->m_iCyclesHistory[3][4];
      v37 = *(_QWORD *)&this->m_iCyclesHistory[2][0];
      v38 = *(_QWORD *)&this->m_iCyclesHistory[2][2];
      v39 = (float)(1.0 / v27) * v24;
      v40 = *(_QWORD *)&this->m_iCyclesHistory[3][0];
      v41 = *(_QWORD *)&this->m_iCyclesHistory[3][2];
      v42 = this->m_iCyclesHistory[3][6];
      *(_QWORD *)&this->m_iCyclesHistory[0][5] = *(_QWORD *)&this->m_iCyclesHistory[0][4];
      v43 = 0;
      this->m_iCyclesHistory[0][7] = v32;
      v44 = 0;
      *(_QWORD *)&this->m_iCyclesHistory[0][1] = v28;
      *(_QWORD *)&this->m_iCyclesHistory[0][3] = v29;
      this->m_iCyclesHistory[1][7] = this->m_iCyclesHistory[1][6];
      this->m_NumFramesThisSec = 0;
      this->m_iCyclesHistory[1][2] = HIDWORD(v33);
      this->m_fAveragedCyclesThisSecond[3] = v39;
      *(_QWORD *)&this->m_iCyclesHistory[1][3] = v30;
      *(_QWORD *)&this->m_iCyclesHistory[1][5] = v31;
      HIDWORD(v33) = this->m_iCyclesHistory[2][6];
      this->m_iCyclesHistory[1][1] = v33;
      LODWORD(v33) = this->m_iCyclesHistory[3][5];
      this->m_fAveragedCyclesThisSecond[0] = 0.0;
      this->m_iCyclesHistory[0][0] = (unsigned int)(float)((float)(1.0 / v27) * v14);
      this->m_iCyclesHistory[1][0] = (unsigned int)(float)((float)(1.0 / v27) * v18);
      this->m_fAveragedCyclesThisSecond[1] = 0.0;
      this->m_iCyclesHistory[2][7] = HIDWORD(v33);
      *(_QWORD *)&this->m_iCyclesHistory[2][1] = v37;
      *(_QWORD *)&this->m_iCyclesHistory[2][3] = v38;
      this->m_iCyclesHistory[2][5] = v34;
      this->m_iCyclesHistory[2][6] = v35;
      this->m_fAveragedCyclesThisSecond[2] = 0.0;
      this->m_eProcLevel = eProcLevelOk;
      this->m_iCyclesHistory[2][0] = (unsigned int)(float)((float)(1.0 / v27) * v22);
      this->m_iCyclesHistory[3][7] = v42;
      this->m_fAveragedCyclesThisSecond[3] = 0.0;
      *(_QWORD *)&this->m_iCyclesHistory[3][1] = v40;
      *(_QWORD *)&this->m_iCyclesHistory[3][3] = v41;
      this->m_iCyclesHistory[3][5] = v36;
      this->m_iCyclesHistory[3][6] = v33;
      this->m_iCyclesHistory[3][0] = (unsigned int)v39;
      do
      {
        v45 = (float *)((char *)&this->m_bInFrame + v43);
        v46 = 0.0;
        v47 = this->m_iMaxCycles[v43 / 4];
        if ( v47 )
        {
          v48 = &this->m_bInFrame + 2 * v43;
          v2.n64_f32[0] = (float)v47;
          v1.n64_f32[0] = (float)((float)((float)((float)((float)((float)((float)((float)v48[39] + (float)v48[40])
                                                                        + (float)v48[41])
                                                                + (float)v48[42])
                                                        + (float)v48[43])
                                                + (float)v48[44])
                                        + (float)v48[45])
                                + (float)v48[46])
                        * 0.125;
          LODWORD(v46) = vmin_f32(v1, v2).n64_u32[0];
        }
        v45[23] = v46;
        if ( (v44 & 0xFFFFFFFE) != 2 )
          v46 = v46 / (float)CTimer::GetCyclesPerMillisecond();
        v49 = v46 / v45[27];
        if ( v49 <= 0.66666 || this->m_eProcLevel > eProcLevelMed )
        {
          if ( v49 > 0.33333 && this->m_eProcLevel <= eProcLevelOk )
            this->m_eProcLevel = eProcLevelMed;
        }
        else
        {
          this->m_eProcLevel = eProcLevelHigh;
        }
        v45[31] = v49;
        v43 += 4;
        ++v44;
        v45[23] = v45[23] / (float)*((unsigned int *)v45 + 19);
      }
      while ( v43 != 16 );
    }
    else
    {
      this->m_NumFramesThisSec = m_NumFramesThisSec + 1;
    }
    if ( this->m_bForceProcLevel )
      this->m_eProcLevel = this->m_eProcLevelToForce;
  }
  else
  {
    this->m_LastTime = CTimer::m_snTimeInMilliseconds;
    this->m_NumFramesThisSec = 0;
  }
}
// 3F5024: variable 'm_pMyVehicle' is possibly undefined
// 3F52B8: variable 'v1' is possibly undefined
// 3F52B8: variable 'v2' is possibly undefined

//----- (003F5360) --------------------------------------------------------
void CLocalisation::Initialise()
{
  CLocalisation::germanGame = 0;
  CLocalisation::nastyGame = 1;
  CLocalisation::frenchGame = 0;
}

//----- (003F538C) --------------------------------------------------------
void CLocalisation::SetNormalGame()
{
  CLocalisation::frenchGame = 0;
  CLocalisation::nastyGame = 1;
  CLocalisation::germanGame = 0;
}

//----- (003F53B8) --------------------------------------------------------
void CLocalisation::SetFrenchGame()
{
  CLocalisation::germanGame = 0;
  CLocalisation::frenchGame = 1;
  CLocalisation::nastyGame = 1;
}

//----- (003F53E4) --------------------------------------------------------
void CLocalisation::SetGermanGame()
{
  CLocalisation::frenchGame = 0;
  CLocalisation::germanGame = 1;
  CLocalisation::nastyGame = 0;
}

//----- (003F5410) --------------------------------------------------------
int CLocalisation::GermanGame()
{
  int result; // r0

  result = CLocalisation::germanGame;
  if ( CLocalisation::germanGame )
    return 1;
  return result;
}

//----- (003F5424) --------------------------------------------------------
int CLocalisation::FrenchGame()
{
  int result; // r0

  result = CLocalisation::frenchGame;
  if ( CLocalisation::frenchGame )
    return 1;
  return result;
}

//----- (003F5438) --------------------------------------------------------
int CLocalisation::Metric()
{
  int result; // r0

  result = (unsigned __int8)FrontEndMenuManager.m_PrefsLanguage;
  if ( FrontEndMenuManager.m_PrefsLanguage )
    return 1;
  return result;
}

//----- (003F5450) --------------------------------------------------------
int CLocalisation::Blood()
{
  return 1;
}

//----- (003F5454) --------------------------------------------------------
int CLocalisation::Porn()
{
  return 1;
}

//----- (003F5458) --------------------------------------------------------
bool CLocalisation::ScreamsFromKills()
{
  return CLocalisation::germanGame == 0;
}

//----- (003F5470) --------------------------------------------------------
int CLocalisation::Prostitutes()
{
  return 1;
}

//----- (003F5474) --------------------------------------------------------
int CLocalisation::KickingWhenDown()
{
  int result; // r0

  result = CLocalisation::nastyGame;
  if ( CLocalisation::nastyGame )
    return 1;
  return result;
}

//----- (003F5488) --------------------------------------------------------
int CLocalisation::ShootLimbs()
{
  int result; // r0

  result = CLocalisation::nastyGame;
  if ( CLocalisation::nastyGame )
    return 1;
  return result;
}

//----- (003F549C) --------------------------------------------------------
int CLocalisation::KnockDownPeds()
{
  int result; // r0

  result = CLocalisation::nastyGame;
  if ( CLocalisation::nastyGame )
    return 1;
  return result;
}

//----- (003F54B0) --------------------------------------------------------
int CLocalisation::KillFrenzy()
{
  int result; // r0

  result = CLocalisation::nastyGame;
  if ( CLocalisation::nastyGame )
    return 1;
  return result;
}

//----- (003F54C4) --------------------------------------------------------
int CLocalisation::StealFromDeadPed()
{
  int result; // r0

  result = CLocalisation::nastyGame;
  if ( CLocalisation::nastyGame )
    return 1;
  return result;
}

//----- (003F54D8) --------------------------------------------------------
int CLocalisation::KillPeds()
{
  int result; // r0

  result = CLocalisation::nastyGame;
  if ( CLocalisation::nastyGame )
    return 1;
  return result;
}

//----- (003F54EC) --------------------------------------------------------
int CLocalisation::PedsOnFire()
{
  int result; // r0

  result = CLocalisation::nastyGame;
  if ( CLocalisation::nastyGame )
    return 1;
  return result;
}

//----- (003F5500) --------------------------------------------------------
void ToggleDebugFPS()
{
  displayFrameRate ^= 1u;
}

//----- (003F5514) --------------------------------------------------------
float Diag_GetFPS()
{
  return 39000.0 / (float)(int)(msCollected[(curMS - 1) % 0x28] - msCollected[curMS % 0x28]);
}

//----- (003F5580) --------------------------------------------------------
void DisplayFPS()
{
  unsigned int v0; // r0
  unsigned int v1; // r1
  __int64 v2; // r2
  CRGBA v3; // r0
  CRGBA v4; // r0
  CRGBA v5; // [sp+4h] [bp-274h] BYREF
  CRGBA v6; // [sp+8h] [bp-270h] BYREF
  GxtChar pOutput[200]; // [sp+Ch] [bp-26Ch] BYREF
  unsigned __int8 s[200]; // [sp+19Ch] [bp-DCh] BYREF

  v0 = OS_TimeMS();
  v1 = curMS;
  v2 = 3435973837LL * curMS++;
  msCollected[v1 - 40 * (HIDWORD(v2) >> 5)] = v0;
  CFont::SetBackground(0, 0);
  CRGBA::CRGBA(&v6, 0, 0, 0, 0x80u);
  CFont::SetBackgroundColor(v3);
  CFont::SetScale(1.12);
  CFont::SetOrientation(1u);
  CFont::SetJustify(0);
  CFont::SetWrapx(640.0);
  CFont::SetProportional(0);
  CFont::SetFontStyle(1u);
  CFont::SetEdge(0);
  CRGBA::CRGBA(&v5, 0xFFu, 0xFFu, 0xFFu, 0xFFu);
  CFont::SetColor(v4);
  sprintf(s, "FPS: %.2f", (float)(39000.0 / (float)(int)(msCollected[(curMS - 1) % 0x28] - msCollected[curMS % 0x28])));
  AsciiToGxtChar(s, pOutput);
  CFont::PrintString(
    (float)((float)RsGlobal.screenWidth / 640.0) * 4.0,
    (float)((float)RsGlobal.screenHeight / 448.0) * 200.0,
    pOutput);
}
// 3F55DE: variable 'v3' is possibly undefined
// 3F5626: variable 'v4' is possibly undefined

//----- (003F5714) --------------------------------------------------------
RwBool __fastcall RwGrabScreen(RwCamera_0 *camera, RwChar *filename)
{
  RwImage_0 *v3; // r5
  RwImage_0 *v4; // r4
  char v7[255]; // [sp+5h] [bp-113h] BYREF

  v3 = RsGrabScreen(camera);
  if ( !v3 )
    return 0;
  strcpy(v7, (const char *)filename);
  v4 = RtBMPImageWrite(v3, (const RwChar *)v7);
  RwImageDestroy(v3);
  return v4 != 0;
}

//----- (003F577C) --------------------------------------------------------
bool __fastcall TakeJPegPhoto(RwCamera_0 *pCamera)
{
  return CWeapon::ms_bTakePhoto;
}

//----- (003F578C) --------------------------------------------------------
int __fastcall DoRWStuffStartOfFrame(
        Int16 TopRed,
        Int16 TopGreen,
        Int16 TopBlue,
        Int16 BottomRed,
        Int16 BottomGreen,
        Int16 BottomBlue,
        int alpha)
{
  RwUInt8 v7; // r8
  RwUInt8 v8; // r5
  RwUInt8 v9; // r6
  RwUInt8 v10; // r4
  float v11; // r0
  int v12; // r4
  CRect Rectangle; // [sp+8h] [bp-30h] BYREF
  CRGBA toprightrgba; // [sp+18h] [bp-20h] BYREF
  RwRGBA_0 color; // [sp+1Ch] [bp-1Ch] BYREF

  v7 = BottomRed;
  v8 = TopBlue;
  v9 = TopGreen;
  v10 = TopRed;
  CDraw::CalculateAspectRatio();
  CFont::SetAlphaFade(255.0);
  color._anon_0._anon_0.alpha = alpha;
  color._anon_0._anon_0.blue = v8;
  color._anon_0._anon_0.green = v9;
  toprightrgba._anon_0._anon_0.alpha = alpha;
  toprightrgba._anon_0._anon_0.blue = BottomBlue;
  toprightrgba._anon_0._anon_0.green = BottomGreen;
  color._anon_0._anon_0.red = v10;
  toprightrgba._anon_0._anon_0.red = v7;
  v11 = tanf(CDraw::ms_fFOV * 0.0087266);
  v12 = 0;
  CameraSize(Scene.camera, 0, v11, CDraw::ms_fAspectRatio);
  CVisibilityPlugins::SetRenderWareCamera(Scene.camera);
  RwCameraClear(Scene.camera, &color, 2);
  if ( RsCameraBeginUpdate(Scene.camera) )
  {
    CSprite2d::InitPerFrame();
    if ( alpha )
    {
      Rectangle.left = 0.0;
      Rectangle.bottom = 0.0;
      Rectangle.right = (float)RsGlobal.screenWidth;
      Rectangle.top = (float)RsGlobal.screenHeight;
      CSprite2d::DrawRect(&Rectangle, &toprightrgba, &toprightrgba, (const CRGBA *)&color, (const CRGBA *)&color);
    }
    return 1;
  }
  return v12;
}

//----- (003F5880) --------------------------------------------------------
bool __fastcall DoRWStuffStartOfFrame_Horizon(
        Int16 TopRed,
        Int16 TopGreen,
        Int16 TopBlue,
        Int16 BottomRed,
        Int16 BottomGreen,
        Int16 BottomBlue,
        Int16 alpha)
{
  float v7; // r4
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r3
  RwInt32 v12; // r4
  CRGBA v14; // [sp+4h] [bp-14h] BYREF

  v7 = tanf(CDraw::ms_fFOV * 0.0087266);
  CDraw::CalculateAspectRatio();
  CameraSize(Scene.camera, 0, v7, CDraw::ms_fAspectRatio);
  CVisibilityPlugins::SetRenderWareCamera(Scene.camera);
  PlayerPed = FindPlayerPed(-1);
  if ( PlayerPed )
  {
    m_pMat = PlayerPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &PlayerPed->m_transform;
    if ( p_tx->m_translate.z > 500.0 )
      goto LABEL_11;
  }
  p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_m_transform = &TheCamera.m_transform;
  if ( p_m_transform->m_translate.z < 0.1 || PlayerPed && !CPed::IsAlive(PlayerPed) )
LABEL_11:
    v12 = 3;
  else
    v12 = 2;
  CRGBA::CRGBA(
    &v14,
    CTimeCycle::m_CurrentColours.m_nSkyTopRed,
    CTimeCycle::m_CurrentColours.m_nSkyTopGreen,
    CTimeCycle::m_CurrentColours.m_nSkyTopBlue,
    0xFFu);
  RwCameraClear(Scene.camera, &v14, v12);
  if ( !RsCameraBeginUpdate(Scene.camera) )
    return 0;
  DefinedState();
  CMatrix::Update(&TheCamera.m_viewMatrix);
  CClouds::RenderSkyPolys();
  return 1;
}

//----- (003F59B0) --------------------------------------------------------
void DoFade()
{
  RwUInt8 v0; // r0
  RwUInt8 v1; // r1
  RwUInt8 v2; // r2
  CRect v3; // [sp+0h] [bp-28h] BYREF
  CRGBA rgba; // [sp+1Ch] [bp-Ch] BYREF

  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
  {
    if ( JustLoadedDontFadeInYet )
    {
      JustLoadedDontFadeInYet = 0;
      TimeStartedCountingForFade = CTimer::m_snTimeInMilliseconds;
    }
    if ( StillToFadeOut )
    {
      if ( CTimer::m_snTimeInMilliseconds - TimeStartedCountingForFade <= TimeToStayFadedBeforeFadeOut )
      {
        CCamera::SetFadeColour(&TheCamera, 0, 0, 0);
        CCamera::Fade(&TheCamera, 0.0, 0);
        CCamera::ProcessFade(&TheCamera);
      }
      else
      {
        StillToFadeOut = 0;
        CCamera::Fade(&TheCamera, 3.0, 1);
        CCamera::ProcessFade(&TheCamera);
        CCamera::ProcessMusicFade(&TheCamera);
      }
    }
    v0 = CDraw::FadeValue;
    if ( CDraw::FadeValue )
    {
      *(_QWORD *)&v3.left = 0xC974240049742400LL;
      *(_QWORD *)&v3.right = 0x49742400C9742400LL;
      if ( TheCamera.m_FadeTargetIsSplashScreen )
      {
        v1 = 0;
        v2 = 0;
        rgba._anon_0._anon_0.red = 0;
        v0 = 0;
      }
      else
      {
        v2 = CDraw::FadeBlue;
        v1 = CDraw::FadeGreen;
        rgba._anon_0._anon_0.red = CDraw::FadeRed;
      }
      rgba._anon_0._anon_0.alpha = v0;
      rgba._anon_0._anon_0.blue = v2;
      rgba._anon_0._anon_0.green = v1;
      v3.left = -5.0;
      v3.top = -5.0;
      v3.right = (float)(RsGlobal.screenWidth + 5);
      v3.bottom = (float)(RsGlobal.screenHeight + 5);
      CSprite2d::DrawRect(&v3, &rgba);
    }
  }
}

//----- (003F5B70) --------------------------------------------------------
void __fastcall DoRWStuffEndOfFrame(bool fromIdle)
{
  _BOOL4 v1; // r4

  v1 = fromIdle;
  CDebug::DebugDisplayTextBuffer();
  FlushObrsPrintfs();
  RwCameraEndUpdate(Scene.camera);
  if ( !v1 )
    sub_18EE7C(Scene.camera);
}

//----- (003F5BA8) --------------------------------------------------------
bool PluginAttach()
{
  return RpWorldPluginAttach()
      && j_RpSkinPluginAttach()
      && RtAnimInitialize()
      && RpHAnimPluginAttach()
      && NodeNamePluginAttach()
      && CVisibilityPlugins::PluginAttach()
      && RpAnimBlendPluginAttach()
      && CTxdStore::PluginAttach()
      && RpMatFXPluginAttach()
      && RpUVAnimPluginAttach()
      && CCustomBuildingRenderer::PluginAttach()
      && CCarFXRenderer::RegisterPlugins()
      && BreakablePluginAttach()
      && CCollisionPlugin::PluginAttach() == 1
      && C2dEffect::PluginAttach()
      && PipelinePluginAttach();
}

//----- (003F5C1C) --------------------------------------------------------
RwCamera_0 *__fastcall NewTileRendererCB(RwCamera_0 *camera, RwInt32 x, RwInt32 y, void *data)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  RwCamera_0 *v9; // r8
  float v10; // s0
  float z; // s2
  float nearPlane; // s18
  float farPlane; // s16
  float v14; // s6
  float v15; // s0
  CRect Rectangle; // [sp+8h] [bp-40h] BYREF

  v9 = Scene.camera;
  Scene.camera = camera;
  CDraw::CalculateAspectRatio();
  RpWorldAddCamera(Scene.world, Scene.camera);
  CVisibilityPlugins::SetRenderWareCamera(Scene.camera);
  RwCameraClear(Scene.camera, &gColourTop, 2);
  RsCameraBeginUpdate(Scene.camera);
  v10 = CSprite::CalcHorizonCoors();
  gHorZ = v10;
  if ( v10 < 0.0 )
  {
    gColourTop._anon_0._anon_0.alpha = -1;
    gColourBottom._anon_0._anon_0.alpha = -1;
    gColourTop._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyBottomRed;
    gColourTop._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyBottomGreen;
    gColourBottom._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyBottomRed;
    gColourBottom._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyBottomGreen;
    gColourTop._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyBottomBlue;
    gColourBottom._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyBottomBlue;
    Rectangle.left = 0.0;
    Rectangle.bottom = 0.0;
    Rectangle.right = (float)RsGlobal.screenWidth;
    Rectangle.top = (float)RsGlobal.screenHeight;
LABEL_5:
    CSprite2d::DrawRect(&Rectangle, &gColourBottom, &gColourBottom, &gColourTop, &gColourTop);
    goto LABEL_10;
  }
  if ( v10 > (float)RsGlobal.screenHeight )
  {
    gColourTop._anon_0._anon_0.alpha = -1;
    gColourBottom._anon_0._anon_0.alpha = -1;
    gColourTop._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyTopRed;
    gColourBottom._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyBottomRed;
    gColourTop._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyTopGreen;
    gColourBottom._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyBottomGreen;
    gColourTop._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyTopBlue;
    gColourBottom._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyBottomBlue;
    Rectangle.left = 0.0;
    Rectangle.bottom = 0.0;
    Rectangle.top = v10;
    Rectangle.right = (float)RsGlobal.screenWidth;
    goto LABEL_5;
  }
  gColourTop._anon_0._anon_0.alpha = -1;
  gColourBottom._anon_0._anon_0.alpha = -1;
  gColourTop._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyTopRed;
  gColourTop._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyTopGreen;
  gColourBottom._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyBottomRed;
  gColourBottom._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyBottomGreen;
  gColourTop._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyTopBlue;
  gColourBottom._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyBottomBlue;
  v4.n64_f32[0] = v10 + 4.0;
  if ( y == 1 )
  {
    v6.n64_f32[0] = (float)RsGlobal.screenWidth;
    Rectangle.left = 0.0;
    Rectangle.bottom = (float)-RsGlobal.screenHeight;
    LODWORD(Rectangle.top) = vmin_f32(v4, v6).n64_u32[0];
  }
  else
  {
    v5.n64_f32[0] = (float)RsGlobal.screenWidth;
    Rectangle.left = 0.0;
    Rectangle.bottom = 0.0;
    LODWORD(Rectangle.top) = vmin_f32(v4, v5).n64_u32[0];
  }
  Rectangle.right = (float)RsGlobal.screenWidth;
  CSprite2d::DrawRect(&Rectangle, &gColourBottom, &gColourBottom, &gColourTop, &gColourTop);
  gColourTop._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyBottomRed;
  gColourTop._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyBottomGreen;
  gColourBottom._anon_0._anon_0.red = CTimeCycle::m_CurrentColours.m_nSkyBottomRed;
  gColourBottom._anon_0._anon_0.green = CTimeCycle::m_CurrentColours.m_nSkyBottomGreen;
  gColourTop._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyBottomBlue;
  gColourBottom._anon_0._anon_0.blue = CTimeCycle::m_CurrentColours.m_nSkyBottomBlue;
LABEL_10:
  DefinedState();
  RwCameraSetFarClipPlane(Scene.camera, CTimeCycle::m_CurrentColours.m_fFarClip);
  Scene.camera->fogPlane = CTimeCycle::m_CurrentColours.m_fFogStart;
  CMovingThings::Render_BeforeClouds();
  CClouds::Render();
  CRenderer::RenderRoads();
  CCoronas::RenderReflections();
  DefinedState();
  RwCameraSetFarClipPlane(Scene.camera, CTimeCycle::m_CurrentColours.m_fFarClip);
  Scene.camera->fogPlane = CTimeCycle::m_CurrentColours.m_fFogStart;
  RwRenderStateSet(rwRENDERSTATEFOGENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATEFOGTYPE, (char *)&dword_0 + 1);
  RwRenderStateSet(
    rwRENDERSTATEFOGCOLOR,
    (void *)((CTimeCycle::m_CurrentColours.m_nSkyBottomRed << 16) | (CTimeCycle::m_CurrentColours.m_nSkyBottomGreen << 8) | CTimeCycle::m_CurrentColours.m_nSkyBottomBlue | 0xFF000000));
  CRenderer::RenderEverythingBarRoads();
  DefinedState();
  CWaterLevel::RenderWater();
  z = TheCamera.Cams[TheCamera.ActiveCam].Front.z;
  nearPlane = Scene.camera->nearPlane;
  farPlane = Scene.camera->farPlane;
  v14 = farPlane - nearPlane;
  v15 = (float)(z * 0.000000089407) + 0.00000011921;
  if ( z > 0.0 )
    v15 = 0.00000011921;
  RwCameraSetNearClipPlane(Scene.camera, nearPlane + (float)(v14 * v15));
  RwCameraSetFarClipPlane(Scene.camera, farPlane + (float)(v14 * v15));
  CShadows::UpdateStaticShadows();
  if ( !CMirrors::bRenderingReflection )
  {
    CShadows::RenderStaticShadows(1);
    CShadows::RenderStaticShadows(0);
    if ( !CMirrors::bRenderingReflection )
    {
      CShadows::RenderStoredShadows(0);
      CShadows::RenderStoredShadows(1);
    }
  }
  RwCameraSetNearClipPlane(Scene.camera, nearPlane);
  RwCameraSetFarClipPlane(Scene.camera, farPlane);
  CBirds::Render();
  CGlass::Render();
  CWaterCannons::Render();
  CSpecialFX::Render();
  CRopes::Render();
  CVehicleRecording::Render();
  if ( CHeli::NumberOfSearchLights || CTheScripts::NumberOfScriptSearchLights )
  {
    CHeli::Pre_SearchLightCone();
    CHeli::RenderAllHeliSearchLights();
    CTheScripts::RenderAllSearchLights();
    CHeli::Post_SearchLightCone();
  }
  CSkidmarks::Render();
  CWeaponEffects::Render();
  CPointLights::RenderFogEffect();
  CMovingThings::Render();
  Fx_c::Render(&g_fx, TheCamera.m_pRwCamera, 0);
  RwCameraEndUpdate(Scene.camera);
  RpWorldRemoveCamera(Scene.world, Scene.camera);
  Scene.camera = v9;
  return camera;
}
// 3F5DD8: variable 'v4' is possibly undefined
// 3F5DD8: variable 'v6' is possibly undefined
// 3F5E0E: variable 'v5' is possibly undefined
// 0: using guessed type int dword_0;

//----- (003F608C) --------------------------------------------------------
unsigned __int8 *__fastcall GetLevelSplashScreen(int32 level)
{
  return GetLevelSplashScreen(int)::splashScreens[level];
}

//----- (003F609C) --------------------------------------------------------
void __fastcall LoadingScreen(
        const unsigned __int8 *pMsg,
        const unsigned __int8 *pMsg2,
        const unsigned __int8 *pSplashName)
{
  if ( pMsg )
    CLoadingScreen::SetLoadingBarMsg(pMsg, pMsg2);
  sub_19E7B4();
}

//----- (003F60B8) --------------------------------------------------------
void TheGame()
{
  CTimer::Initialise();
  CGame::Initialise("DATA\\GTA.DAT");
  CLoadingScreen::SetLoadingBarMsg("Starting Game", 0);
  sub_19E7B4();
}

//----- (003F60EC) --------------------------------------------------------
void __fastcall RenderScene(bool setCamPos)
{
  CSimpleTransform *p_tx; // r0
  float v2; // s16
  float nearPlane; // s18
  float farPlane; // s20
  Int32 v5; // r0
  int32 value; // r0

  if ( setCamPos )
  {
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    emu_SetCameraPosition(&p_tx->m_translate.x);
  }
  v2 = CWeather::UnderWaterness;
  nearPlane = Scene.camera->nearPlane;
  farPlane = Scene.camera->farPlane;
  RwCameraEndUpdate(Scene.camera);
  RwCameraSetNearClipPlane(Scene.camera, nearPlane + (float)((float)(farPlane - nearPlane) * 0.000061035));
  RwCameraBeginUpdate(Scene.camera);
  RwRenderStateSet(rwRENDERSTATETEXTURERASTER, 0);
  RwRenderStateSet(rwRENDERSTATEZTESTENABLE, 0);
  RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, 0);
  RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, 0);
  if ( !CMirrors::TypeOfMirror )
  {
    CMovingThings::Render_BeforeClouds();
    CClouds::Render();
  }
  RwRenderStateSet(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATESHADEMODE, (char *)&dword_0 + 2);
  if ( CMirrors::TypeOfMirror != 3 )
    CCarFXRenderer::PreRenderUpdate();
  CRenderer::RenderRoads();
  if ( CMirrors::TypeOfMirror != 3 )
    CCoronas::RenderReflections();
  CRenderer::RenderEverythingBarRoads();
  if ( CMirrors::TypeOfMirror == 3 )
    goto LABEL_16;
  CRenderer::RenderFadingInUnderwaterEntities();
  v5 = CMirrors::TypeOfMirror;
  if ( v2 <= 0.0 && CMirrors::TypeOfMirror != 3 )
  {
    RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 1);
    CWaterLevel::RenderWater();
    RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 2);
    v5 = CMirrors::TypeOfMirror;
  }
  if ( v5 == 3 )
  {
LABEL_16:
    if ( MobileSettings::settings[7].value == 3 )
      CRenderer::RenderFadingInEntities();
  }
  else
  {
    CRenderer::RenderFadingInEntities();
  }
  BreakManager_c::Render(&g_breakMan, 0);
  if ( !CMirrors::bRenderingReflection )
  {
    CShadows::UpdateStaticShadows();
    value = MobileSettings::settings[5].value;
    if ( MobileSettings::settings[5].value == 2 )
    {
      emu_BindShadowRenderTarget();
      value = MobileSettings::settings[5].value;
    }
    if ( value )
    {
      CShadows::RenderStaticShadows(0);
      CShadows::RenderStoredShadows(0);
      if ( MobileSettings::settings[5].value == 2 )
        emu_ResolveShadowTarget((float)((float)CTimeCycle::m_CurrentColours.m_nShadowStrength / 255.0) * 0.45);
    }
    CShadows::RenderStaticShadows(1);
    CShadows::RenderStoredShadows(1);
  }
  BreakManager_c::Render(&g_breakMan, 1u);
  if ( CMirrors::TypeOfMirror != 3 )
    CPlantMgr::Render();
  RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 1);
  if ( !CMirrors::TypeOfMirror )
  {
    CClouds::RenderBottomFromHeight();
    CWeather::RenderRainStreaks();
    if ( MobileSettings::settings[0].value == 3 )
      CCoronas::RenderSunReflection();
  }
  if ( v2 > 0.0 && CMirrors::TypeOfMirror != 3 )
  {
    RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 1);
    CWaterLevel::RenderWater();
    sub_192840(rwRENDERSTATECULLMODE, (char *)&dword_0 + 2);
  }
}
// 0: using guessed type int dword_0;

//----- (003F6390) --------------------------------------------------------
void RenderEffects()
{
  CPlayerPed *PlayerPed; // r0

  if ( MobileSettings::settings[0].value >= 2 )
    CBirds::Render();
  RwRenderStateSet(rwRENDERSTATETEXTUREADDRESS, (char *)&dword_0 + 1);
  if ( MobileSettings::settings[0].value >= 1 )
    CSkidmarks::Render();
  CRopes::Render();
  if ( MobileSettings::settings[0].value >= 1 )
    CGlass::Render();
  CMovingThings::Render();
  CVisibilityPlugins::RenderReallyDrawLastObjects();
  CCoronas::Render();
  Fx_c::Render(&g_fx, TheCamera.m_pRwCamera, 0);
  CWaterCannons::Render();
  if ( CHeli::NumberOfSearchLights || CTheScripts::NumberOfScriptSearchLights )
  {
    CHeli::Pre_SearchLightCone();
    CHeli::RenderAllHeliSearchLights();
    CTheScripts::RenderAllSearchLights();
    CHeli::Post_SearchLightCone();
  }
  CWeaponEffects::Render();
  if ( !CPad::GetPad(0)->DisablePlayerControls )
  {
    PlayerPed = FindPlayerPed(-1);
    CPlayerPed::DrawTriangleForMouseRecruitPed(PlayerPed);
  }
  CSpecialFX::Render();
  CVehicleRecording::Render();
  CPointLights::RenderFogEffect();
  CRenderer::RenderFirstPersonVehicle();
  sub_194094();
}
// 0: using guessed type int dword_0;

//----- (003F646C) --------------------------------------------------------
void Render2dStuff()
{
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v1; // r0

  if ( emu_IsAltRenderTarget() )
    emu_FlushAltRenderTarget();
  RwRenderStateSet(rwRENDERSTATEZTESTENABLE, 0);
  RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, 0);
  RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
  RwRenderStateSet(rwRENDERSTATEDESTBLEND, &byte_6);
  RwRenderStateSet(rwRENDERSTATEFOGENABLE, 0);
  RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 1);
  CPopCycle::Display();
  CPickups::RenderPickUpText();
  if ( TheCamera.m_WideScreenOn )
    CCamera::DrawBordersForWideScreen(&TheCamera);
  CAudioEngine::DisplayRadioStationName(&AudioEngine);
  CHud::Draw();
  CTouchInterface::DrawAll(0);
  emu_GammaSet(1u);
  CSpecialFX::Render2DFXs();
  COnscreenTimer::ProcessForDisplay(&CUserDisplay::OnscnTimer);
  CMessages::Display(1u);
  CDarkel::DrawMessages();
  CGarages::PrintMessages();
  CFont::RenderFontBuffer();
  emu_GammaSet(0);
  if ( CPlayerPed::bDebugTargetting )
  {
    PlayerPed = FindPlayerPed(-1);
    CPlayerPed::DisplayTargettingDebug(PlayerPed);
  }
  if ( CPlayerPed::bDebugTapToTarget )
  {
    v1 = FindPlayerPed(-1);
    sub_18BB0C(v1, 0.0, 0.0, 1);
  }
}
// 0: using guessed type int dword_0;
// 5: using guessed type char byte_5;
// 6: using guessed type char byte_6;

//----- (003F6564) --------------------------------------------------------
void RenderMenus()
{
  bool v0; // zf

  if ( emu_IsAltRenderTarget() )
    emu_FlushAltRenderTarget();
  v0 = gMobileMenu.screenStack.numEntries == 0;
  if ( !gMobileMenu.screenStack.numEntries )
    v0 = gMobileMenu.pendingScreen == 0;
  if ( !v0 )
    sub_19BF84(&gMobileMenu);
}

//----- (003F65A0) --------------------------------------------------------
void Render2dStuffAfterFade()
{
  CHud::DrawAfterFade();
  TemporaryFPSVisualization();
  emu_GammaSet(1u);
  CMessages::Display(0);
  CFont::RenderFontBuffer();
  CCredits::Render();
  sub_18ED4C(0);
}

//----- (003F65D0) --------------------------------------------------------
void TemporaryFPSVisualization()
{
  bool v0; // zf
  int v1; // r0
  float v2; // s4
  float v3; // s0
  float v4; // s0
  float v5; // s0
  CRGBA v6; // r0
  CRGBA v7; // r0
  CRGBA v8; // r0
  RwInt32 screenHeight; // r6
  int v10; // r5
  float Height; // r0
  int v12; // r4
  RwInt32 v13; // r5
  float screenWidth; // s18
  float v15; // r0
  RwInt32 v16; // s0
  RwInt32 v17; // r4
  float v18; // r0
  CVector v19; // [sp+14h] [bp-29Ch] BYREF
  GxtChar pOutput[200]; // [sp+20h] [bp-290h] BYREF
  CRGBA v21; // [sp+1B0h] [bp-100h] BYREF
  CRGBA v22; // [sp+1B4h] [bp-FCh] BYREF
  CRGBA v23; // [sp+1B8h] [bp-F8h] BYREF
  unsigned __int8 s[200]; // [sp+1BCh] [bp-F4h] BYREF

  v0 = gMobileMenu.screenStack.numEntries == 0;
  if ( !gMobileMenu.screenStack.numEntries )
    v0 = gMobileMenu.pendingScreen == 0;
  if ( v0 && displayFrameRate && CWorld::Players[0].pPed )
  {
    if ( (unsigned int)(float)((float)(CTimer::ms_fTimeStepNonClipped / 50.0) * 1000.0) )
    {
      v1 = TemporaryFPSVisualization(void)::FrameSamples + 1;
      v2 = (float)++TemporaryFPSVisualization(void)::FrameSamples;
      v3 = (float)((float)(50.0 / CTimer::ms_fTimeStepNonClipped)
                 + TemporaryFPSVisualization(void)::FramesPerSecondCounter)
         / v2;
      TemporaryFPSVisualization(void)::FramesPerSecondCounter = (float)(50.0 / CTimer::ms_fTimeStepNonClipped)
                                                              + TemporaryFPSVisualization(void)::FramesPerSecondCounter;
      v4 = v3 + 0.05;
    }
    else
    {
      v4 = 0.0;
      v1 = TemporaryFPSVisualization(void)::FrameSamples;
    }
    TemporaryFPSVisualization(void)::FramesPerSecond = v4;
    if ( v1 >= 31 )
    {
      TemporaryFPSVisualization(void)::FramesPerSecondCounter = 0.0;
      TemporaryFPSVisualization(void)::FrameSamples = 0;
    }
    CFont::SetFontStyle(1u);
    CFont::SetBackground(0, 0);
    CFont::SetWrapx((float)((float)RsGlobal.screenWidth / 640.0) * 640.0);
    v5 = (float)((float)RsGlobal.screenHeight / 448.0) * 0.66;
    CFont::SetScale(v5);
    CFont::SetOrientation(1u);
    CFont::SetProportional(1u);
    CRGBA::CRGBA(&v23, 0xFFu, 0xFFu, 0, 0xC8u);
    CFont::SetColor(v6);
    CRGBA::CRGBA(&v22, 0x40u, 0x40u, 0x40u, 0xFFu);
    CFont::SetDropColor(v7);
    CFont::SetEdge(1);
    CRGBA::CRGBA(&v21, 0, 0, 0, 0xFFu);
    CFont::SetDropColor(v8);
    CFont::SetScale(0.77);
    CFont::SetOrientation(0);
    sprintf(s, "FrameRate: %.1f", TemporaryFPSVisualization(void)::FramesPerSecond);
    AsciiToGxtChar(s, pOutput);
    screenHeight = RsGlobal.screenHeight;
    v10 = extraOffset;
    Height = CFont::GetHeight(0);
    CFont::PrintString(88.0, (float)(screenHeight - v10) - (float)(Height * 0.8), pOutput);
    FindPlayerCoors(&v19, -1);
    sprintf(s, "Player: X:%4.0f Y:%4.0f Z:%.1f", v19.x, v19.y, v19.z);
    AsciiToGxtChar(s, pOutput);
    v12 = extraOffset;
    v13 = RsGlobal.screenHeight;
    screenWidth = (float)RsGlobal.screenWidth;
    v15 = CFont::GetHeight(0);
    CFont::PrintString(screenWidth * 0.5, (float)(v13 - v12) - (float)(v15 * 0.8), pOutput);
    sprintf(s, "Version: %s", (const char *)versionString);
    AsciiToGxtChar(s, pOutput);
    v16 = RsGlobal.screenHeight;
    v17 = RsGlobal.screenWidth;
    v18 = CFont::GetHeight(0);
    CFont::PrintString((float)(v17 - 88), (float)v16 - (float)(v18 * 0.8), pOutput);
  }
}
// 3F6714: variable 'v6' is possibly undefined
// 3F6726: variable 'v7' is possibly undefined
// 3F673E: variable 'v8' is possibly undefined

//----- (003F6948) --------------------------------------------------------
void __fastcall Idle(void *param, bool firstFrame)
{
  _BOOL4 v3; // r8
  int32 value; // r4
  int v5; // r0
  int Width; // r4
  void *Height; // r5
  unsigned int v8; // r1
  bool v9; // zf
  unsigned int v10; // r5
  unsigned int v11; // r1
  unsigned int v12; // r4
  float v13; // r0
  CLink<CPed *> *i; // r0
  bool v15; // zf

  v3 = firstFrame;
  if ( bPendingPause )
  {
    MobileMenu::InitForPause(&gMobileMenu);
    bPendingPause = 0;
  }
  value = MobileSettings::settings[1].value;
  if ( (unsigned int)OS_ScreenGetWidth() <= 0x280 )
  {
    Width = OS_ScreenGetWidth();
  }
  else
  {
    v5 = (unsigned __int64)(1374389535LL * (MobileSettings::GetMaxResWidth() - 640) * value) >> 32;
    Width = (v5 >> 5) + ((unsigned int)v5 >> 31) + 640;
  }
  Height = OS_ScreenGetHeight();
  v8 = OS_ScreenGetWidth();
  v9 = gMobileMenu.screenStack.numEntries == 0;
  if ( !gMobileMenu.screenStack.numEntries )
    v9 = gMobileMenu.pendingScreen == 0;
  if ( v9 && (v10 = (int)Height * Width / v8, CCamera::GetScreenFadeStatus(&TheCamera) != 2) )
  {
    v11 = (v10 + 3) & 0xFFFFFFFC;
    v12 = (Width + 3) & 0xFFFFFFFC;
  }
  else
  {
    v11 = 0;
    v12 = 0;
  }
  emu_SetAltRenderTarget(v12, v11);
  if ( !pumpHack )
    CTimer::Update();
  CSprite2d::InitPerFrame();
  CFont::InitPerFrame();
  CPointLights::NumLights = 0;
  if ( !pumpHack )
    CGame::Process();
  CAudioEngine::Service(&AudioEngine);
  SetLightsWithTimeOfDayColour(Scene.world);
  if ( param )
  {
    if ( CTouchInterface::m_pWidgets[160]
      && CWidgetPlayerInfo::PassesDisplayConditions((CWidgetPlayerInfo *)CTouchInterface::m_pWidgets[160]) )
    {
      CTouchInterface::IsTouched(WIDGET_PLAYER_INFO, 0, 1);
    }
    CTouchInterface::Update();
    CCredits::Update();
    if ( v12 )
    {
      if ( !v3 )
        RsCameraShowRaster(Scene.camera);
      CMirrors::RenderReflections();
      CRenderer::ConstructRenderList();
      CRenderer::PreRender();
      CWorld::ProcessPedsAfterPreRender();
      CRealTimeShadowManager::Update(&g_realTimeShadowMan);
      CMirrors::BeforeMainRender();
      if ( CWeather::LightningFlash )
      {
        CTimeCycle::m_CurrentColours.m_nSkyBottomBlue = 255;
        *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyBottomRed = 16711935;
        if ( !DoRWStuffStartOfFrame_Horizon(0, 0, 0, 0, 0, 0, 0) )
          return;
      }
      else if ( !DoRWStuffStartOfFrame_Horizon(0, 0, 0, 0, 0, 0, 0) )
      {
        return;
      }
      DefinedState();
      RwCameraSetFarClipPlane(Scene.camera, CTimeCycle::m_CurrentColours.m_fFarClip);
      Scene.camera->fogPlane = CTimeCycle::m_CurrentColours.m_fFogStart;
      CMirrors::RenderMirrorBuffer(0);
      RenderScene(1);
      CMirrors::RenderMirrorBuffer(1);
      CVisibilityPlugins::RenderWeaponPedsForPC();
      for ( i = CVisibilityPlugins::ms_weaponPedsForPC.m_firstLink.m_pNext;
            CVisibilityPlugins::ms_weaponPedsForPC.m_firstLink.m_pNext != &CVisibilityPlugins::ms_weaponPedsForPC.m_lastLink;
            i = CVisibilityPlugins::ms_weaponPedsForPC.m_firstLink.m_pNext )
      {
        i->m_pNext->m_pPrev = i->m_pPrev;
        i->m_pPrev->m_pNext = i->m_pNext;
        i->m_pNext = CVisibilityPlugins::ms_weaponPedsForPC.m_firstFreeLink.m_pNext;
        CVisibilityPlugins::ms_weaponPedsForPC.m_firstFreeLink.m_pNext->m_pPrev = i;
        i->m_pPrev = &CVisibilityPlugins::ms_weaponPedsForPC.m_firstFreeLink;
        CVisibilityPlugins::ms_weaponPedsForPC.m_firstFreeLink.m_pNext = i;
      }
      if ( !pumpHack )
        RenderEffects();
      if ( (!TheCamera.m_BlurType || TheCamera.m_BlurType == 2) && TheCamera.m_ScreenReductionPercentage > 0.0 )
        CCamera::SetMotionBlurAlpha(&TheCamera, 150);
      CCamera::RenderMotionBlur(&TheCamera);
      Render2dStuff();
      goto LABEL_44;
    }
    if ( !v3 && !CLoadingScreen::m_bActive )
      RsCameraShowRaster(Scene.camera);
    CDraw::CalculateAspectRatio();
    v13 = tanf(CDraw::ms_fFOV * 0.0087266);
    CameraSize(Scene.camera, 0, v13, CDraw::ms_fAspectRatio);
    CVisibilityPlugins::SetRenderWareCamera(Scene.camera);
    RwCameraClear(Scene.camera, &gColourTop, 2);
    if ( RsCameraBeginUpdate(Scene.camera) )
    {
LABEL_44:
      CMirrors::RenderReflBuffer(1);
      if ( emu_IsAltRenderTarget() )
        emu_FlushAltRenderTarget();
      v15 = gMobileMenu.screenStack.numEntries == 0;
      if ( !gMobileMenu.screenStack.numEntries )
        v15 = gMobileMenu.pendingScreen == 0;
      if ( !v15 )
        MobileMenu::Render(&gMobileMenu);
      RwRenderStateSet(rwRENDERSTATETEXTURERASTER, 0);
      DoFade();
      CHud::DrawAfterFade();
      if ( v12 )
      {
        TemporaryFPSVisualization();
        emu_GammaSet(1u);
        CMessages::Display(0);
        CFont::RenderFontBuffer();
        CCredits::Render();
        emu_GammaSet(0);
        CCredits::Render();
      }
      else
      {
        emu_GammaSet(1u);
        CFont::RenderFontBuffer();
        CCredits::Render();
        emu_GammaSet(0);
      }
      CHID::FlushQueuedText();
      if ( FrontEndMenuManager.m_PrefsShowFPS )
      {
        DisplayFPS();
        CFont::RenderFontBuffer();
      }
      CDebug::DebugDisplayTextBuffer();
      FlushObrsPrintfs();
      RwCameraEndUpdate(Scene.camera);
      sub_19DA4C();
    }
  }
}

//----- (003F6D84) --------------------------------------------------------
void Pump_SwapBuffers()
{
  if ( CDraw::FadeValue )
  {
    if ( RwInitialized )
    {
      pumpHack = 1;
      Idle((char *)&dword_0 + 1, 0);
      pumpHack = 0;
    }
  }
}
// 0: using guessed type int dword_0;

//----- (003F6DC8) --------------------------------------------------------
void FrontendIdle()
{
  float v0; // r0

  CDraw::CalculateAspectRatio();
  CTimer::Update();
  CSprite2d::SetRecipNearClip();
  CSprite2d::InitPerFrame();
  CFont::InitPerFrame();
  CPad::UpdatePads();
  MobileMenu::Update(&gMobileMenu);
  if ( !RsGlobal.quit )
  {
    OS_ThreadSleep(16000);
    if ( !NeedsAmazonDownload() )
      CAudioEngine::Service(&AudioEngine);
    v0 = tanf(CDraw::ms_fFOV * 0.0087266);
    CameraSize(Scene.camera, 0, v0, CDraw::ms_fAspectRatio);
    CVisibilityPlugins::SetRenderWareCamera(Scene.camera);
    RwCameraClear(Scene.camera, &gColourTop, 2);
    if ( RsCameraBeginUpdate(Scene.camera) )
    {
      DefinedState();
      MobileMenu::Render(&gMobileMenu);
      SecuromStateDisplay();
      DoFade();
      CHud::DrawAfterFade();
      TemporaryFPSVisualization();
      emu_GammaSet(1u);
      CMessages::Display(0);
      CFont::RenderFontBuffer();
      CCredits::Render();
      emu_GammaSet(0);
      CFont::RenderFontBuffer();
      CDebug::DebugDisplayTextBuffer();
      FlushObrsPrintfs();
      RwCameraEndUpdate(Scene.camera);
      sub_18EE7C(Scene.camera);
    }
  }
}

//----- (003F6EE8) --------------------------------------------------------
void InitialiseGame()
{
  ProcessShaderCache();
  CGame::Initialise("DATA\\GTA.DAT");
  CAudioEngine::Restart(&AudioEngine);
  if ( gMobileMenu.WantsToLoad )
    gMobileMenu.m_WantsToRestartGame = 1;
}

//----- (003F6F30) --------------------------------------------------------
RsEventStatus_0 __fastcall AppEventHandler(RsEvent_0 event, void *param)
{
  RsEventStatus_0 result; // r0
  float v5; // r0
  RwBool v6; // r0

  if ( event == rsIDLE )
  {
    Idle(param, AppEventHandler(RsEvent,void *)::firstFrame != 1);
    result = rsEVENTPROCESSED;
    AppEventHandler(RsEvent,void *)::firstFrame = 1;
  }
  else
  {
    AppEventHandler(RsEvent,void *)::firstFrame = 0;
    result = rsEVENTNOTPROCESSED;
    switch ( event )
    {
      case rsCAMERASIZE:
        v5 = tanf(CDraw::ms_fFOV * 0.0087266);
        CameraSize(Scene.camera, (RwRect_0 *)param, v5, 1.3333);
        goto LABEL_10;
      case rsPLUGINATTACH:
        v6 = PluginAttach();
        return v6 != 0;
      case rsRWINITIALIZE:
        v6 = Initialise3D(param);
        return v6 != 0;
      case rsRWTERMINATE:
        CGame::ShutdownRenderWare();
        RsRwTerminate();
        goto LABEL_10;
      case rsINITIALIZE:
        CGame::InitialiseOnceBeforeRW();
        v6 = RsInitialize();
        return v6 != 0;
      case rsTERMINATE:
        CGame::FinalShutdown();
        goto LABEL_10;
      case rsFRONTENDIDLE:
        FrontendIdle();
LABEL_10:
        result = rsEVENTPROCESSED;
        break;
      default:
        return result;
    }
  }
  return result;
}
// 9599B8: using guessed type char AppEventHandler(RsEvent,void *)::firstFrame;

//----- (003F7004) --------------------------------------------------------
void __fastcall IntToStr(Int32 InNum, unsigned __int8 *pString)
{
  int v2; // r12
  int v3; // lr
  unsigned __int16 v4; // r3
  bool v5; // cc
  int v6; // r3
  unsigned __int8 *v7; // r2

  if ( InNum <= -1 )
  {
    InNum = -InNum;
    v2 = 1;
    *pString = 45;
  }
  else
  {
    v2 = 0;
  }
  v3 = 1;
  if ( InNum << 16 <= 589824 )
    goto LABEL_8;
  v4 = InNum;
  do
  {
    v5 = v4 > 0x63u;
    v4 /= 0xAu;
    v3 = (__int16)(v3 + 1);
  }
  while ( v5 );
  if ( v3 > 0 )
  {
LABEL_8:
    v6 = (unsigned __int16)v3;
    v7 = &pString[v2 - 1 + v3];
    do
    {
      --v6;
      *v7-- = (char)InNum % 10 + 48;
      InNum /= 10;
    }
    while ( v6 );
  }
  pString[v2 + v3] = 0;
}

//----- (003F7098) --------------------------------------------------------
void __fastcall ObrInt(Int32 Num)
{
  int v1; // r12
  int v2; // r2
  unsigned __int16 v3; // r3
  unsigned int v4; // r1
  unsigned __int8 *v5; // r3
  int v6; // r1

  if ( Num <= -1 )
  {
    Num = -Num;
    v1 = 1;
    obrstr[0] = 45;
  }
  else
  {
    v1 = 0;
  }
  v2 = 1;
  if ( Num << 16 <= 589824 )
    goto LABEL_8;
  v3 = Num;
  do
  {
    v4 = v3;
    v2 = (__int16)(v2 + 1);
    v3 /= 0xAu;
  }
  while ( v4 > 0x63 );
  if ( v2 > 0 )
  {
LABEL_8:
    v5 = &obrstr[v1 - 1 + v2];
    v6 = (unsigned __int16)v2;
    do
    {
      --v6;
      *v5-- = (char)Num % 10 + 48;
      Num /= 10;
    }
    while ( v6 );
  }
  obrstr[v1 + v2] = 0;
  sub_1993C8(obrstr);
}

//----- (003F7140) --------------------------------------------------------
void __fastcall ObrInt2(Int32 Num1, Int32 Num2)
{
  Int32 v2; // r9
  int v3; // r12
  int v4; // r2
  unsigned __int16 v5; // r6
  bool v6; // cc
  int v7; // r6
  unsigned __int8 *v8; // r3
  int v9; // r8
  int v10; // r0
  unsigned __int16 v11; // r2
  unsigned int v12; // r3
  int v13; // r2
  unsigned __int8 *v14; // r1
  int v15; // r6

  v2 = Num2;
  if ( Num1 <= -1 )
  {
    Num1 = -Num1;
    v3 = 1;
    obrstr[0] = 45;
  }
  else
  {
    v3 = 0;
  }
  if ( Num1 << 16 <= 589824 )
  {
    v4 = 1;
LABEL_10:
    v7 = (unsigned __int16)v4;
    v8 = &obrstr[v3 - 1 + v4];
    do
    {
      --v7;
      *v8-- = (char)Num1 % 10 + 48;
      Num1 /= 10;
    }
    while ( v7 );
    goto LABEL_12;
  }
  LOWORD(v4) = 1;
  v5 = Num1;
  do
  {
    v6 = v5 > 0x63u;
    v5 /= 0xAu;
    v4 = (__int16)(v4 + 1);
  }
  while ( v6 );
  if ( v4 > 0 )
    goto LABEL_10;
LABEL_12:
  v9 = 0;
  obrstr[v3 + v4] = 0;
  strcat((char *)obrstr, "  ");
  if ( Num2 <= -1 )
  {
    v2 = -Num2;
    v9 = 1;
    obrstr2[0] = 45;
  }
  if ( v2 << 16 <= 589824 )
  {
    v10 = 1;
LABEL_20:
    v13 = (unsigned __int16)v10;
    v14 = &obrstr2[v9 - 1 + v10];
    do
    {
      --v13;
      v15 = v2 % 10;
      v2 /= 10;
      *v14-- = v15 + 48;
    }
    while ( v13 );
    goto LABEL_22;
  }
  LOWORD(v10) = 1;
  v11 = v2;
  do
  {
    v12 = v11;
    v10 = (__int16)(v10 + 1);
    v11 /= 0xAu;
  }
  while ( v12 > 0x63 );
  if ( v10 > 0 )
    goto LABEL_20;
LABEL_22:
  obrstr2[v10 + v9] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  sub_1993C8(obrstr);
}

//----- (003F72B8) --------------------------------------------------------
void __fastcall ObrInt3(Int32 Num1, Int32 Num2, Int32 Num3)
{
  Int32 v4; // r10
  int v5; // r12
  int v6; // r2
  unsigned __int16 v7; // r3
  bool v8; // cc
  int v9; // r6
  unsigned __int8 *v10; // r3
  int v11; // r8
  int v12; // r0
  unsigned __int16 v13; // r2
  unsigned int v14; // r3
  int v15; // r2
  unsigned __int8 *v16; // r1
  char v17; // r6
  int v18; // r6
  int v19; // r0
  unsigned __int16 v20; // r2
  unsigned int v21; // r3
  int v22; // r2
  unsigned __int8 *v23; // r1
  int v24; // r4

  v4 = Num2;
  if ( Num1 <= -1 )
  {
    Num1 = -Num1;
    v5 = 1;
    obrstr[0] = 45;
  }
  else
  {
    v5 = 0;
  }
  v6 = 1;
  if ( Num1 << 16 <= 589824 )
    goto LABEL_8;
  v7 = Num1;
  do
  {
    v8 = v7 > 0x63u;
    v7 /= 0xAu;
    v6 = (__int16)(v6 + 1);
  }
  while ( v8 );
  if ( v6 > 0 )
  {
LABEL_8:
    v9 = (unsigned __int16)v6;
    v10 = &obrstr[v5 - 1 + v6];
    do
    {
      --v9;
      *v10-- = (char)Num1 % 10 + 48;
      Num1 /= 10;
    }
    while ( v9 );
  }
  v11 = 0;
  obrstr[v5 + v6] = 0;
  strcat((char *)obrstr, "  ");
  if ( Num2 <= -1 )
  {
    v4 = -Num2;
    v11 = 1;
    obrstr2[0] = 45;
  }
  if ( v4 << 16 <= 589824 )
  {
    v12 = 1;
LABEL_18:
    v15 = (unsigned __int16)v12;
    v16 = &obrstr2[v11 - 1 + v12];
    do
    {
      --v15;
      v17 = (char)v4 % 10;
      v4 /= 10;
      *v16-- = v17 + 48;
    }
    while ( v15 );
    goto LABEL_20;
  }
  LOWORD(v12) = 1;
  v13 = v4;
  do
  {
    v14 = v13;
    v12 = (__int16)(v12 + 1);
    v13 /= 0xAu;
  }
  while ( v14 > 0x63 );
  if ( v12 > 0 )
    goto LABEL_18;
LABEL_20:
  v18 = 0;
  obrstr2[v12 + v11] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num3 <= -1 )
  {
    Num3 = -Num3;
    v18 = 1;
    obrstr2[0] = 45;
  }
  if ( Num3 << 16 <= 589824 )
  {
    v19 = 1;
LABEL_28:
    v22 = (unsigned __int16)v19;
    v23 = &obrstr2[v18 - 1 + v19];
    do
    {
      --v22;
      v24 = Num3 % 10;
      Num3 /= 10;
      *v23-- = v24 + 48;
    }
    while ( v22 );
    goto LABEL_30;
  }
  LOWORD(v19) = 1;
  v20 = Num3;
  do
  {
    v21 = v20;
    v19 = (__int16)(v19 + 1);
    v20 /= 0xAu;
  }
  while ( v21 > 0x63 );
  if ( v19 > 0 )
    goto LABEL_28;
LABEL_30:
  obrstr2[v19 + v18] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  sub_1993C8(obrstr);
}

//----- (003F74E4) --------------------------------------------------------
void __fastcall ObrInt4(Int32 Num1, Int32 Num2, Int32 Num3, Int32 Num4)
{
  int v7; // r12
  int v8; // r2
  unsigned __int16 v9; // r3
  unsigned int v10; // r1
  unsigned __int8 *v11; // r3
  int v12; // r1
  size_t v13; // r0
  int v14; // r12
  int v15; // r0
  unsigned __int16 v16; // r2
  unsigned int v17; // r3
  int v18; // r2
  unsigned __int8 *v19; // r1
  char v20; // r5
  int v21; // r8
  int v22; // r0
  unsigned __int16 v23; // r2
  unsigned int v24; // r3
  int v25; // r2
  unsigned __int8 *v26; // r1
  int v27; // r5
  int v28; // r6
  int v29; // r0
  unsigned __int16 v30; // r2
  unsigned int v31; // r3
  int v32; // r2
  unsigned __int8 *v33; // r1
  int v34; // r4

  if ( Num1 <= -1 )
  {
    Num1 = -Num1;
    v7 = 1;
    obrstr[0] = 45;
  }
  else
  {
    v7 = 0;
  }
  v8 = 1;
  if ( Num1 << 16 <= 589824 )
    goto LABEL_8;
  v9 = Num1;
  do
  {
    v10 = v9;
    v8 = (__int16)(v8 + 1);
    v9 /= 0xAu;
  }
  while ( v10 > 0x63 );
  if ( v8 > 0 )
  {
LABEL_8:
    v11 = &obrstr[v7 - 1 + v8];
    v12 = (unsigned __int16)v8;
    do
    {
      --v12;
      *v11-- = (char)Num1 % 10 + 48;
      Num1 /= 10;
    }
    while ( v12 );
  }
  obrstr[v7 + v8] = 0;
  v13 = strlen((const char *)obrstr);
  v14 = 0;
  strcpy((char *)&obrstr[v13], "  ");
  if ( Num2 <= -1 )
  {
    Num2 = -Num2;
    v14 = 1;
    obrstr2[0] = 45;
  }
  if ( Num2 << 16 <= 589824 )
  {
    v15 = 1;
LABEL_18:
    v18 = (unsigned __int16)v15;
    v19 = &obrstr2[v14 - 1 + v15];
    do
    {
      --v18;
      v20 = (char)Num2 % 10;
      Num2 /= 10;
      *v19-- = v20 + 48;
    }
    while ( v18 );
    goto LABEL_20;
  }
  LOWORD(v15) = 1;
  v16 = Num2;
  do
  {
    v17 = v16;
    v15 = (__int16)(v15 + 1);
    v16 /= 0xAu;
  }
  while ( v17 > 0x63 );
  if ( v15 > 0 )
    goto LABEL_18;
LABEL_20:
  v21 = 0;
  obrstr2[v15 + v14] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num3 <= -1 )
  {
    Num3 = -Num3;
    v21 = 1;
    obrstr2[0] = 45;
  }
  if ( Num3 << 16 <= 589824 )
  {
    v22 = 1;
LABEL_28:
    v25 = (unsigned __int16)v22;
    v26 = &obrstr2[v21 - 1 + v22];
    do
    {
      --v25;
      v27 = Num3 % 10;
      Num3 /= 10;
      *v26-- = v27 + 48;
    }
    while ( v25 );
    goto LABEL_30;
  }
  LOWORD(v22) = 1;
  v23 = Num3;
  do
  {
    v24 = v23;
    v22 = (__int16)(v22 + 1);
    v23 /= 0xAu;
  }
  while ( v24 > 0x63 );
  if ( v22 > 0 )
    goto LABEL_28;
LABEL_30:
  v28 = 0;
  obrstr2[v22 + v21] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num4 <= -1 )
  {
    Num4 = -Num4;
    v28 = 1;
    obrstr2[0] = 45;
  }
  if ( Num4 << 16 <= 589824 )
  {
    v29 = 1;
LABEL_38:
    v32 = (unsigned __int16)v29;
    v33 = &obrstr2[v28 - 1 + v29];
    do
    {
      --v32;
      v34 = Num4 % 10;
      Num4 /= 10;
      *v33-- = v34 + 48;
    }
    while ( v32 );
    goto LABEL_40;
  }
  LOWORD(v29) = 1;
  v30 = Num4;
  do
  {
    v31 = v30;
    v29 = (__int16)(v29 + 1);
    v30 /= 0xAu;
  }
  while ( v31 > 0x63 );
  if ( v29 > 0 )
    goto LABEL_38;
LABEL_40:
  obrstr2[v29 + v28] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  sub_1993C8(obrstr);
}

//----- (003F77DC) --------------------------------------------------------
void __fastcall ObrInt5(Int32 Num1, Int32 Num2, Int32 Num3, Int32 Num4, int a5)
{
  int v5; // r9
  int v9; // r12
  int v10; // r2
  unsigned __int16 v11; // r3
  unsigned int v12; // r1
  unsigned __int8 *v13; // r3
  int v14; // r1
  size_t v15; // r0
  int v16; // r12
  int v17; // r0
  unsigned __int16 v18; // r2
  unsigned int v19; // r3
  int v20; // r2
  unsigned __int8 *v21; // r1
  char v22; // r5
  int v23; // r8
  int v24; // r0
  unsigned __int16 v25; // r2
  unsigned int v26; // r3
  int v27; // r2
  unsigned __int8 *v28; // r1
  int v29; // r5
  int v30; // r6
  int v31; // r0
  unsigned __int16 v32; // r2
  unsigned int v33; // r3
  int v34; // r2
  unsigned __int8 *v35; // r1
  int v36; // r4
  int v37; // r5
  int v38; // r0
  unsigned __int16 v39; // r2
  unsigned int v40; // r3
  int v41; // r2
  unsigned __int8 *v42; // r1
  int v43; // r4

  v5 = a5;
  if ( Num1 <= -1 )
  {
    Num1 = -Num1;
    v9 = 1;
    obrstr[0] = 45;
  }
  else
  {
    v9 = 0;
  }
  v10 = 1;
  if ( Num1 << 16 <= 589824 )
    goto LABEL_8;
  v11 = Num1;
  do
  {
    v12 = v11;
    v10 = (__int16)(v10 + 1);
    v11 /= 0xAu;
  }
  while ( v12 > 0x63 );
  if ( v10 > 0 )
  {
LABEL_8:
    v13 = &obrstr[v9 - 1 + v10];
    v14 = (unsigned __int16)v10;
    do
    {
      --v14;
      *v13-- = (char)Num1 % 10 + 48;
      Num1 /= 10;
    }
    while ( v14 );
  }
  obrstr[v9 + v10] = 0;
  v15 = strlen((const char *)obrstr);
  v16 = 0;
  strcpy((char *)&obrstr[v15], "  ");
  if ( Num2 <= -1 )
  {
    Num2 = -Num2;
    v16 = 1;
    obrstr2[0] = 45;
  }
  if ( Num2 << 16 <= 589824 )
  {
    v17 = 1;
LABEL_18:
    v20 = (unsigned __int16)v17;
    v21 = &obrstr2[v16 - 1 + v17];
    do
    {
      --v20;
      v22 = (char)Num2 % 10;
      Num2 /= 10;
      *v21-- = v22 + 48;
    }
    while ( v20 );
    goto LABEL_20;
  }
  LOWORD(v17) = 1;
  v18 = Num2;
  do
  {
    v19 = v18;
    v17 = (__int16)(v17 + 1);
    v18 /= 0xAu;
  }
  while ( v19 > 0x63 );
  if ( v17 > 0 )
    goto LABEL_18;
LABEL_20:
  v23 = 0;
  obrstr2[v17 + v16] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num3 <= -1 )
  {
    Num3 = -Num3;
    v23 = 1;
    obrstr2[0] = 45;
  }
  if ( Num3 << 16 <= 589824 )
  {
    v24 = 1;
LABEL_28:
    v27 = (unsigned __int16)v24;
    v28 = &obrstr2[v23 - 1 + v24];
    do
    {
      --v27;
      v29 = Num3 % 10;
      Num3 /= 10;
      *v28-- = v29 + 48;
    }
    while ( v27 );
    goto LABEL_30;
  }
  LOWORD(v24) = 1;
  v25 = Num3;
  do
  {
    v26 = v25;
    v24 = (__int16)(v24 + 1);
    v25 /= 0xAu;
  }
  while ( v26 > 0x63 );
  if ( v24 > 0 )
    goto LABEL_28;
LABEL_30:
  v30 = 0;
  obrstr2[v24 + v23] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num4 <= -1 )
  {
    Num4 = -Num4;
    v30 = 1;
    obrstr2[0] = 45;
  }
  if ( Num4 << 16 <= 589824 )
  {
    v31 = 1;
LABEL_38:
    v34 = (unsigned __int16)v31;
    v35 = &obrstr2[v30 - 1 + v31];
    do
    {
      --v34;
      v36 = Num4 % 10;
      Num4 /= 10;
      *v35-- = v36 + 48;
    }
    while ( v34 );
    goto LABEL_40;
  }
  LOWORD(v31) = 1;
  v32 = Num4;
  do
  {
    v33 = v32;
    v31 = (__int16)(v31 + 1);
    v32 /= 0xAu;
  }
  while ( v33 > 0x63 );
  if ( v31 > 0 )
    goto LABEL_38;
LABEL_40:
  v37 = 0;
  obrstr2[v31 + v30] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( a5 <= -1 )
  {
    v5 = -a5;
    v37 = 1;
    obrstr2[0] = 45;
  }
  if ( v5 << 16 <= 589824 )
  {
    v38 = 1;
LABEL_48:
    v41 = (unsigned __int16)v38;
    v42 = &obrstr2[v37 - 1 + v38];
    do
    {
      --v41;
      v43 = v5 % 10;
      v5 /= 10;
      *v42-- = v43 + 48;
    }
    while ( v41 );
    goto LABEL_50;
  }
  LOWORD(v38) = 1;
  v39 = v5;
  do
  {
    v40 = v39;
    v38 = (__int16)(v38 + 1);
    v39 /= 0xAu;
  }
  while ( v40 > 0x63 );
  if ( v38 > 0 )
    goto LABEL_48;
LABEL_50:
  obrstr2[v38 + v37] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  sub_1993C8(obrstr);
}

//----- (003F7B88) --------------------------------------------------------
void __fastcall ObrInt6(Int32 Num1, Int32 Num2, Int32 Num3, Int32 Num4, Int32 Num5, Int32 Num6)
{
  Int32 v7; // r10
  int v10; // r12
  int v11; // r2
  unsigned __int16 v12; // r3
  unsigned int v13; // r1
  unsigned __int8 *v14; // r3
  int v15; // r1
  size_t v16; // r0
  int v17; // r12
  int v18; // r0
  unsigned __int16 v19; // r2
  unsigned int v20; // r3
  int v21; // r2
  unsigned __int8 *v22; // r1
  char v23; // r5
  int v24; // r4
  int v25; // r0
  unsigned __int16 v26; // r2
  unsigned int v27; // r3
  int v28; // r2
  unsigned __int8 *v29; // r1
  int v30; // r5
  int v31; // r6
  int v32; // r0
  unsigned __int16 v33; // r2
  unsigned int v34; // r3
  int v35; // r2
  unsigned __int8 *v36; // r1
  int v37; // r4
  int v38; // r5
  int v39; // r0
  unsigned __int16 v40; // r2
  unsigned int v41; // r3
  int v42; // r2
  unsigned __int8 *v43; // r1
  int v44; // r4
  int v45; // r8
  Int32 v46; // r5
  int v47; // r0
  unsigned __int16 v48; // r2
  unsigned int v49; // r3
  int v50; // r2
  unsigned __int8 *v51; // r1
  int v52; // r4

  v7 = Num5;
  if ( Num1 <= -1 )
  {
    Num1 = -Num1;
    v10 = 1;
    obrstr[0] = 45;
  }
  else
  {
    v10 = 0;
  }
  v11 = 1;
  if ( Num1 << 16 <= 589824 )
    goto LABEL_8;
  v12 = Num1;
  do
  {
    v13 = v12;
    v11 = (__int16)(v11 + 1);
    v12 /= 0xAu;
  }
  while ( v13 > 0x63 );
  if ( v11 > 0 )
  {
LABEL_8:
    v14 = &obrstr[v10 - 1 + v11];
    v15 = (unsigned __int16)v11;
    do
    {
      --v15;
      *v14-- = (char)Num1 % 10 + 48;
      Num1 /= 10;
    }
    while ( v15 );
  }
  obrstr[v10 + v11] = 0;
  v16 = strlen((const char *)obrstr);
  v17 = 0;
  strcpy((char *)&obrstr[v16], "  ");
  if ( Num2 <= -1 )
  {
    Num2 = -Num2;
    v17 = 1;
    obrstr2[0] = 45;
  }
  if ( Num2 << 16 <= 589824 )
  {
    v18 = 1;
LABEL_18:
    v21 = (unsigned __int16)v18;
    v22 = &obrstr2[v17 - 1 + v18];
    do
    {
      --v21;
      v23 = (char)Num2 % 10;
      Num2 /= 10;
      *v22-- = v23 + 48;
    }
    while ( v21 );
    goto LABEL_20;
  }
  LOWORD(v18) = 1;
  v19 = Num2;
  do
  {
    v20 = v19;
    v18 = (__int16)(v18 + 1);
    v19 /= 0xAu;
  }
  while ( v20 > 0x63 );
  if ( v18 > 0 )
    goto LABEL_18;
LABEL_20:
  v24 = 0;
  obrstr2[v18 + v17] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num3 <= -1 )
  {
    Num3 = -Num3;
    v24 = 1;
    obrstr2[0] = 45;
  }
  if ( Num3 << 16 <= 589824 )
  {
    v25 = 1;
LABEL_28:
    v28 = (unsigned __int16)v25;
    v29 = &obrstr2[v24 - 1 + v25];
    do
    {
      --v28;
      v30 = Num3 % 10;
      Num3 /= 10;
      *v29-- = v30 + 48;
    }
    while ( v28 );
    goto LABEL_30;
  }
  LOWORD(v25) = 1;
  v26 = Num3;
  do
  {
    v27 = v26;
    v25 = (__int16)(v25 + 1);
    v26 /= 0xAu;
  }
  while ( v27 > 0x63 );
  if ( v25 > 0 )
    goto LABEL_28;
LABEL_30:
  v31 = 0;
  obrstr2[v25 + v24] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num4 <= -1 )
  {
    Num4 = -Num4;
    v31 = 1;
    obrstr2[0] = 45;
  }
  if ( Num4 << 16 <= 589824 )
  {
    v32 = 1;
LABEL_38:
    v35 = (unsigned __int16)v32;
    v36 = &obrstr2[v31 - 1 + v32];
    do
    {
      --v35;
      v37 = Num4 % 10;
      Num4 /= 10;
      *v36-- = v37 + 48;
    }
    while ( v35 );
    goto LABEL_40;
  }
  LOWORD(v32) = 1;
  v33 = Num4;
  do
  {
    v34 = v33;
    v32 = (__int16)(v32 + 1);
    v33 /= 0xAu;
  }
  while ( v34 > 0x63 );
  if ( v32 > 0 )
    goto LABEL_38;
LABEL_40:
  v38 = 0;
  obrstr2[v32 + v31] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  if ( Num5 <= -1 )
  {
    v7 = -Num5;
    v38 = 1;
    obrstr2[0] = 45;
  }
  if ( v7 << 16 <= 589824 )
  {
    v39 = 1;
LABEL_48:
    v42 = (unsigned __int16)v39;
    v43 = &obrstr2[v38 - 1 + v39];
    do
    {
      --v42;
      v44 = v7 % 10;
      v7 /= 10;
      *v43-- = v44 + 48;
    }
    while ( v42 );
    goto LABEL_50;
  }
  LOWORD(v39) = 1;
  v40 = v7;
  do
  {
    v41 = v40;
    v39 = (__int16)(v39 + 1);
    v40 /= 0xAu;
  }
  while ( v41 > 0x63 );
  if ( v39 > 0 )
    goto LABEL_48;
LABEL_50:
  v45 = 0;
  obrstr2[v39 + v38] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  strcat((char *)obrstr, "  ");
  v46 = Num6;
  if ( Num6 <= -1 )
  {
    v46 = -Num6;
    v45 = 1;
    obrstr2[0] = 45;
  }
  if ( v46 << 16 <= 589824 )
  {
    v47 = 1;
LABEL_58:
    v50 = (unsigned __int16)v47;
    v51 = &obrstr2[v45 - 1 + v47];
    do
    {
      --v50;
      v52 = v46 % 10;
      v46 /= 10;
      *v51-- = v52 + 48;
    }
    while ( v50 );
    goto LABEL_60;
  }
  LOWORD(v47) = 1;
  v48 = v46;
  do
  {
    v49 = v48;
    v47 = (__int16)(v47 + 1);
    v48 /= 0xAu;
  }
  while ( v49 > 0x63 );
  if ( v47 > 0 )
    goto LABEL_58;
LABEL_60:
  obrstr2[v47 + v45] = 0;
  strcat((char *)obrstr, (const char *)obrstr2);
  sub_1993C8(obrstr);
}

//----- (003F7FF0) --------------------------------------------------------
void CPad::Initialise()
{
  *(_QWORD *)&Pads[0].OldState.ButtonCross = 0LL;
  *(_QWORD *)&Pads[0].OldState.m_bChatIndicated = 0LL;
  *(_QWORD *)&Pads[0].OldState.DPadUp = 0LL;
  *(_QWORD *)&Pads[0].OldState.Start = 0LL;
  *(_QWORD *)&Pads[0].OldState.LeftStickX = 0LL;
  *(_QWORD *)&Pads[0].OldState.LeftShoulder1 = 0LL;
  *(_QWORD *)&Pads[0].NewState.ButtonCross = 0LL;
  *(_QWORD *)&Pads[0].NewState.m_bChatIndicated = 0LL;
  *(_QWORD *)&Pads[0].NewState.LeftStickX = 0LL;
  *(_QWORD *)&Pads[0].NewState.LeftShoulder1 = 0LL;
  *(_QWORD *)&Pads[0].NewState.DPadUp = 0LL;
  *(_QWORD *)&Pads[0].NewState.Start = 0LL;
  memset(&Pads[0].PCTempKeyState, 0, 0x90u);
  Pads[0].bLaneCorrection = 0;
  Pads[0].Phase = 0;
  Pads[0].bUsingDebugCamera = 0;
  Pads[0].bUsingDebugPlayerFreeze = 0;
  Pads[0].bStopRhythmSprites = 0;
  Pads[0].bSetSteeringMode = 0;
  Pads[0].bSetTouchLayout = 0;
  memset(&Pads[1].PCTempKeyState, 0, 0x90u);
  *(_QWORD *)&Pads[0].fBikeStickY = 0LL;
  *(_QWORD *)&Pads[0].bDisablePlayerFireWeaponWithL1 = 0LL;
  *(_QWORD *)((char *)&Pads[0].LastTimeTouched + 1) = 0LL;
  *(_QWORD *)((char *)&Pads[0].AverageEntries + 1) = 0LL;
  *(_QWORD *)&Pads[0].SteeringLeftRightBuffer[4] = 0LL;
  *(_QWORD *)&Pads[0].SteeringLeftRightBuffer[8] = 0LL;
  *(_QWORD *)&Pads[0].currentPadId = 0LL;
  *(_QWORD *)&Pads[0].SteeringLeftRightBuffer[2] = 0LL;
  *(_QWORD *)&Pads[1].OldState.ButtonCross = 0LL;
  *(_QWORD *)&Pads[1].OldState.m_bChatIndicated = 0LL;
  *(_QWORD *)&Pads[1].OldState.DPadLeft = 0LL;
  *(_QWORD *)&Pads[1].OldState.ButtonSquare = 0LL;
  *(_QWORD *)&Pads[1].OldState.RightStickX = 0LL;
  *(_QWORD *)&Pads[1].OldState.RightShoulder1 = 0LL;
  *(_QWORD *)&Pads[1].NewState.ShockButtonL = 0LL;
  *(_QWORD *)&Pads[1].NewState.m_bVehicleMouseLook = 0LL;
  *(_QWORD *)&Pads[1].NewState.DPadLeft = 0LL;
  *(_QWORD *)&Pads[1].NewState.ButtonSquare = 0LL;
  CPad::PCTempMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::PCTempMouseControllerState.m_bWheelMovedDown = 0;
  *(_DWORD *)&CPad::PCTempMouseControllerState.m_bLeftButton = 0;
  *(_QWORD *)&Pads[1].NewState.RightStickX = 0LL;
  *(_QWORD *)&Pads[1].NewState.RightShoulder1 = 0LL;
  *(_DWORD *)&Pads[0].ShakeFreq = 0;
  *(_DWORD *)&Pads[0].ShakeDur = 0;
  *(_DWORD *)&Pads[0].bRhythm = 0;
  Pads[0].fCruisingSpeed = 0.0;
  *(_QWORD *)&Pads[0].m_fAccelX = 0LL;
  *(_QWORD *)&Pads[0].m_fAccelZ = 0LL;
  *(_QWORD *)Pads[1].SteeringLeftRightBuffer = 0LL;
  *(_QWORD *)&Pads[1].SteeringLeftRightBuffer[4] = 0LL;
  CPad::NewMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::NewMouseControllerState.m_bWheelMovedDown = 0;
  CPad::OldMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::OldMouseControllerState.m_bWheelMovedDown = 0;
  *(_DWORD *)&CPad::NewMouseControllerState.m_bLeftButton = 0;
  *(_DWORD *)&CPad::OldMouseControllerState.m_bLeftButton = 0;
  *(_DWORD *)&Pads[1].SteeringLeftRightBuffer[8] = 0;
  Pads[1].DrunkDrivingBufferUsed = 0;
  Pads[1].Phase = 0;
  *(_WORD *)&Pads[1].bLaneCorrection = 0;
  Pads[1].bUsingDebugPlayerFreeze = 0;
  Pads[1].bStopRhythmSprites = 0;
  Pads[1].bSetSteeringMode = 0;
  Pads[1].bSetTouchLayout = 0;
  Pads[1].m_fAccelX = 0.0;
  Pads[1].m_fAccelY = 0.0;
  Pads[1].m_fAccelZ = 0.0;
  *(_DWORD *)&Pads[1].bRhythm = 0;
  Pads[1].fCruisingSpeed = 0.0;
  *(_QWORD *)((char *)&Pads[1].LastTimeTouched + 1) = 0LL;
  *(_QWORD *)((char *)&Pads[1].AverageEntries + 1) = 0LL;
  *(_QWORD *)&Pads[1].fBikeStickY = 0LL;
  *(_QWORD *)&Pads[1].bDisablePlayerFireWeaponWithL1 = 0LL;
  *(_DWORD *)&Pads[1].ShakeFreq = 0;
  *(_DWORD *)&Pads[1].ShakeDur = 0;
  Pads[1].currentPadId = 1;
  CPad::m_bDebugCamPCOn = 0;
  CPad::m_bMapPadOneToPadTwo = 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003F8180) --------------------------------------------------------
void __fastcall CPad::Clear(CPad *this, bool bOkToClearTheDisableFlag, bool bReinit)
{
  int16 *p_ButtonCross; // r0
  _BOOL4 v5; // r6
  _BOOL4 v6; // r5

  p_ButtonCross = &this->OldState.ButtonCross;
  v5 = bOkToClearTheDisableFlag;
  v6 = bReinit;
  *(_QWORD *)p_ButtonCross = 0LL;
  *((_QWORD *)p_ButtonCross + 1) = 0LL;
  *(_QWORD *)&this->OldState.DPadUp = 0LL;
  *(_QWORD *)&this->OldState.Start = 0LL;
  *(_QWORD *)&this->OldState.LeftStickX = 0LL;
  *(_QWORD *)&this->OldState.LeftShoulder1 = 0LL;
  *(_QWORD *)&this->NewState.ButtonCross = 0LL;
  *(_QWORD *)&this->NewState.m_bChatIndicated = 0LL;
  *(_QWORD *)&this->NewState.LeftStickX = 0LL;
  *(_QWORD *)&this->NewState.LeftShoulder1 = 0LL;
  *(_QWORD *)&this->NewState.DPadUp = 0LL;
  *(_QWORD *)&this->NewState.Start = 0LL;
  memset(&this->PCTempKeyState, 0, 0x90u);
  CPad::NewMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::NewMouseControllerState.m_bWheelMovedDown = 0;
  CPad::OldMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::OldMouseControllerState.m_bWheelMovedDown = 0;
  CPad::PCTempMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::PCTempMouseControllerState.m_bWheelMovedDown = 0;
  *(_DWORD *)&CPad::NewMouseControllerState.m_bLeftButton = 0;
  *(_DWORD *)&CPad::OldMouseControllerState.m_bLeftButton = 0;
  *(_DWORD *)&CPad::PCTempMouseControllerState.m_bLeftButton = 0;
  if ( v6 )
    this->Phase = 0;
  this->ShakeDur = 0;
  this->ShakeFreq = 0;
  this->DrunkDrivingBufferUsed = 0;
  *(_DWORD *)&this->SteeringLeftRightBuffer[8] = 0;
  *(_QWORD *)this->SteeringLeftRightBuffer = 0LL;
  *(_QWORD *)&this->SteeringLeftRightBuffer[4] = 0LL;
  if ( v5 )
  {
    this->bDisablePlayerDisplayVitalStats = 0;
    *(_WORD *)&this->bDisablePlayerCycleWeapon = 0;
    *(_DWORD *)&this->bDisablePlayerEnterCar = 0;
    this->DisablePlayerControls = 0;
  }
  this->bLaneCorrection = 0;
  this->bApplyBrakes = 0;
  this->bUsingDebugCamera = 0;
  this->bUsingDebugPlayerFreeze = 0;
  this->bStopRhythmSprites = 0;
  this->fBikeStickY = 0.0;
  this->bApplyGas = 0;
  *(float *)((char *)&this->fCruisingSpeed + 3) = 0.0;
  *(_DWORD *)&this->JustOutOfFrontEnd = 0;
  if ( !v6 )
  {
    *(_WORD *)&this->bDoorsLocked = 0;
    *(_WORD *)&this->bHasCheated = 0;
    *(_DWORD *)&this->bHasJetPack = 0;
  }
  this->bSetTouchLayout = 0;
  this->bSetSteeringMode = 0;
  this->m_fAccelX = 0.0;
  this->m_fAccelY = 0.0;
  this->m_fAccelZ = 0.0;
  this->NoShakeFreq = 0;
  *(_QWORD *)&this->LastTimeTouched = 0LL;
  *(_QWORD *)&this->AverageEntries = 0LL;
}

//----- (003F8290) --------------------------------------------------------
void __fastcall CControllerState::Clear(CControllerState *this)
{
  int16 *p_DPadUp; // r0

  *(_QWORD *)&this->ButtonCross = 0LL;
  *(_QWORD *)&this->m_bChatIndicated = 0LL;
  *(_QWORD *)&this->LeftStickX = 0LL;
  *(_QWORD *)&this->LeftShoulder1 = 0LL;
  p_DPadUp = &this->DPadUp;
  *(_QWORD *)p_DPadUp = 0LL;
  *((_QWORD *)p_DPadUp + 1) = 0LL;
}

//----- (003F82A6) --------------------------------------------------------
bool __fastcall CControllerState::CheckForInput(CControllerState *this)
{
  bool v1; // zf
  bool v3; // zf
  bool v4; // zf
  bool v5; // zf
  bool v6; // zf
  bool v7; // zf
  bool v8; // zf
  bool v9; // zf
  bool v10; // zf

  if ( this->RightStickX )
    return 1;
  v1 = this->RightStickY == 0;
  if ( !this->RightStickY )
    v1 = this->LeftStickX == 0;
  if ( !v1 )
    return 1;
  v3 = this->LeftStickY == 0;
  if ( !this->LeftStickY )
    v3 = this->DPadUp == 0;
  if ( !v3 )
    return 1;
  v4 = this->DPadDown == 0;
  if ( !this->DPadDown )
    v4 = this->DPadLeft == 0;
  if ( !v4 )
    return 1;
  v5 = this->DPadRight == 0;
  if ( !this->DPadRight )
    v5 = this->ButtonTriangle == 0;
  if ( !v5 )
    return 1;
  v6 = this->ButtonCross == 0;
  if ( !this->ButtonCross )
    v6 = this->ButtonCircle == 0;
  if ( !v6 )
    return 1;
  v7 = this->ButtonSquare == 0;
  if ( !this->ButtonSquare )
    v7 = this->Start == 0;
  if ( !v7 )
    return 1;
  v8 = this->Select == 0;
  if ( !this->Select )
    v8 = this->LeftShoulder1 == 0;
  if ( !v8 )
    return 1;
  v9 = this->LeftShoulder2 == 0;
  if ( !this->LeftShoulder2 )
    v9 = this->RightShoulder1 == 0;
  if ( !v9 )
    return 1;
  v10 = this->RightShoulder2 == 0;
  if ( !this->RightShoulder2 )
    v10 = this->ShockButtonL == 0;
  return !v10 || this->ShockButtonR != 0;
}

//----- (003F8324) --------------------------------------------------------
void __fastcall CKeyboardState::Clear(CKeyboardState *this)
{
  memset(this, 0, 0x23Cu);
  this->kWINDOW_RIGHT_CLICK_KEY = 0;
  *(_QWORD *)&this->kRSHIFT = 0LL;
  *(_QWORD *)&this->kLALT = 0LL;
  *(_QWORD *)&this->kNUMPAD_EIGHT = 0LL;
  *(_QWORD *)&this->kTAB = 0LL;
  *(_QWORD *)&this->kNUMPAD_DOT = 0LL;
  *(_QWORD *)&this->kNUMPAD_FOUR = 0LL;
}

//----- (003F8358) --------------------------------------------------------
void __fastcall CMouseControllerState::Clear(CMouseControllerState *this)
{
  this->m_bMsSecondXButton = 0;
  *(_WORD *)&this->m_bWheelMovedDown = 0;
  *(_DWORD *)&this->m_bLeftButton = 0;
}

//----- (003F8364) --------------------------------------------------------
void __fastcall CPad::ClearMouseHistory(CPad *this)
{
  CPad::PCTempMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::PCTempMouseControllerState.m_bWheelMovedDown = 0;
  CPad::NewMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::NewMouseControllerState.m_bWheelMovedDown = 0;
  CPad::OldMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::OldMouseControllerState.m_bWheelMovedDown = 0;
  *(_DWORD *)&CPad::PCTempMouseControllerState.m_bLeftButton = 0;
  *(_DWORD *)&CPad::NewMouseControllerState.m_bLeftButton = 0;
  *(_DWORD *)&CPad::OldMouseControllerState.m_bLeftButton = 0;
}

//----- (003F8398) --------------------------------------------------------
void __fastcall CMouseControllerState::CMouseControllerState(CMouseControllerState *this)
{
  this->m_fWheelMoved = 0.0;
  this->m_AmountMoved.x = 0.0;
  this->m_AmountMoved.y = 0.0;
  this->m_bMsSecondXButton = 0;
  *(_WORD *)&this->m_bWheelMovedDown = 0;
  *(_DWORD *)&this->m_bLeftButton = 0;
}

//----- (003F83A8) --------------------------------------------------------
bool __fastcall CMouseControllerState::CheckForInput(CMouseControllerState *this)
{
  bool v1; // zf
  bool v3; // zf
  bool v4; // zf

  if ( this->m_bLeftButton )
    return 1;
  v1 = this->m_bRightButton == 0;
  if ( !this->m_bRightButton )
    v1 = this->m_bMiddleButton == 0;
  if ( !v1 )
    return 1;
  v3 = this->m_bWheelMovedUp == 0;
  if ( !this->m_bWheelMovedUp )
    v3 = this->m_bWheelMovedDown == 0;
  if ( !v3 )
    return 1;
  v4 = this->m_bMsFirstXButton == 0;
  if ( !this->m_bMsFirstXButton )
    v4 = this->m_bMsSecondXButton == 0;
  return !v4 || this->m_AmountMoved.x != 0.0 || this->m_AmountMoved.y != 0.0;
}

//----- (003F83F6) --------------------------------------------------------
CMouseControllerState *__fastcall CMousePointerStateHelper::GetMouseSetUp(
        CMouseControllerState *retstr,
        CMousePointerStateHelper *this)
{
  retstr->m_fWheelMoved = 0.0;
  retstr->m_AmountMoved.x = 0.0;
  retstr->m_AmountMoved.y = 0.0;
  retstr->m_bMsSecondXButton = 0;
  *(_WORD *)&retstr->m_bWheelMovedDown = 0;
  *(_DWORD *)&retstr->m_bLeftButton = 0;
  return retstr;
}

//----- (003F8406) --------------------------------------------------------
bool __fastcall IsPointerDown(uint32 deviceIdx, uint32 buttonIdx)
{
  return (LIB_PointerGetButton(deviceIdx, buttonIdx) | 1) == 3;
}

//----- (003F841C) --------------------------------------------------------
void __fastcall CPad::UpdateMouse(CPad *this)
{
  bool8 v2; // r5
  bool v3; // r0
  OSPointerState Button; // r0

  v2 = 0;
  CPad::PCTempMouseControllerState.m_bMsSecondXButton = 0;
  *(_WORD *)&CPad::PCTempMouseControllerState.m_bWheelMovedDown = 0;
  *(_DWORD *)&CPad::PCTempMouseControllerState.m_bLeftButton = 0;
  CPad::PCTempMouseControllerState.m_AmountMoved = (RwV2d_0)CPad::vecMouseDelta;
  v3 = (LIB_PointerGetButton(0, 0) | 1) == 3 || (LIB_PointerGetButton(1, 0) | 1) == 3;
  CPad::PCTempMouseControllerState.m_bLeftButton = v3;
  CPad::PCTempMouseControllerState.m_bRightButton = (LIB_PointerGetButton(0, 1) | 1) == 3;
  Button = LIB_PointerGetButton(0, 2);
  *(_WORD *)&CPad::PCTempMouseControllerState.m_bMsFirstXButton = 0;
  CPad::PCTempMouseControllerState.m_fWheelMoved = 0.0;
  if ( (Button | 1) == 3 )
    v2 = 1;
  CPad::PCTempMouseControllerState.m_bMiddleButton = v2;
  CPad::OldMouseControllerState = CPad::NewMouseControllerState;
  CPad::NewMouseControllerState = CPad::PCTempMouseControllerState;
  if ( (CPad::NewMouseControllerState.m_bWheelMovedDown | CPad::PCTempMouseControllerState.m_bRightButton | CPad::PCTempMouseControllerState.m_bLeftButton | v2 | CPad::PCTempMouseControllerState.m_bWheelMovedUp | CPad::NewMouseControllerState.m_bMsFirstXButton | CPad::NewMouseControllerState.m_bMsSecondXButton) << 24
    || CPad::NewMouseControllerState.m_AmountMoved.y != 0.0 )
  {
    this->LastTimeTouched = CTimer::m_snTimeInMilliseconds;
  }
}
// 0: using guessed type int dword_0;

//----- (003F8540) --------------------------------------------------------
CControllerState *__fastcall CPad::ReconcileTwoControllersInput(
        CControllerState *retstr,
        CPad *this,
        const CControllerState *From1rstController,
        const CControllerState *From2ndController)
{
  bool v4; // zf
  bool v5; // zf
  bool v6; // zf
  bool v7; // zf
  bool v8; // zf
  bool v9; // zf
  bool v10; // zf
  bool v11; // zf
  bool v12; // zf
  bool v13; // zf
  bool v14; // zf
  bool v15; // zf
  bool v16; // zf
  bool v17; // zf
  bool v18; // zf
  bool v19; // zf
  const CControllerState *LeftStickX; // r5
  int v21; // r4
  bool v22; // cc
  __int16 v23; // r12
  int v24; // r4
  const CControllerState *v25; // r5
  int LeftStickY; // r4
  int v27; // r5
  const CControllerState *v28; // r5
  int16 v29; // lr
  int v30; // r5
  const CControllerState *v31; // r5
  int v32; // r4
  int v33; // r4
  const CControllerState *RightStickX; // r4
  int v35; // r5
  int v36; // r5
  const CControllerState *v37; // r4
  const CControllerState *RightStickY; // r4
  int v39; // r5
  int v40; // r1
  const CControllerState *v41; // r1
  int v42; // r1
  int v43; // r1
  bool v44; // zf
  int v45; // r1
  bool v46; // zf
  int v47; // r4
  bool v48; // zf
  int v49; // r5
  int DPadRight; // r2
  bool v51; // zf
  int v52; // r2
  __int64 v53; // d16
  __int64 v54; // d17
  __int64 v55; // d21
  __int64 v56; // d18
  __int64 v57; // d19
  CControllerState *result; // r0

  *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ButtonCross = 0LL;
  *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.m_bChatIndicated = 0LL;
  *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickX = 0LL;
  *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftShoulder1 = 0LL;
  *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadUp = 0LL;
  *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.Start = 0LL;
  v4 = From1rstController->LeftShoulder1 == 0;
  if ( !From1rstController->LeftShoulder1 )
    v4 = From2ndController->LeftShoulder1 == 0;
  if ( !v4 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftShoulder1 = 255;
  v5 = From1rstController->LeftShoulder2 == 0;
  if ( !From1rstController->LeftShoulder2 )
    v5 = From2ndController->LeftShoulder2 == 0;
  if ( !v5 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftShoulder2 = 255;
  v6 = From1rstController->RightShoulder1 == 0;
  if ( !From1rstController->RightShoulder1 )
    v6 = From2ndController->RightShoulder1 == 0;
  if ( !v6 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightShoulder1 = 255;
  v7 = From1rstController->RightShoulder2 == 0;
  if ( !From1rstController->RightShoulder2 )
    v7 = From2ndController->RightShoulder2 == 0;
  if ( !v7 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightShoulder2 = 255;
  v8 = From1rstController->Start == 0;
  if ( !From1rstController->Start )
    v8 = From2ndController->Start == 0;
  if ( !v8 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.Start = 255;
  v9 = From1rstController->Select == 0;
  if ( !From1rstController->Select )
    v9 = From2ndController->Select == 0;
  if ( !v9 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.Select = 255;
  v10 = From1rstController->ButtonSquare == 0;
  if ( !From1rstController->ButtonSquare )
    v10 = From2ndController->ButtonSquare == 0;
  if ( !v10 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ButtonSquare = 255;
  v11 = From1rstController->ButtonTriangle == 0;
  if ( !From1rstController->ButtonTriangle )
    v11 = From2ndController->ButtonTriangle == 0;
  if ( !v11 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ButtonTriangle = 255;
  v12 = From1rstController->ButtonCross == 0;
  if ( !From1rstController->ButtonCross )
    v12 = From2ndController->ButtonCross == 0;
  if ( !v12 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ButtonCross = 255;
  v13 = From1rstController->ButtonCircle == 0;
  if ( !From1rstController->ButtonCircle )
    v13 = From2ndController->ButtonCircle == 0;
  if ( !v13 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ButtonCircle = 255;
  v14 = From1rstController->ShockButtonL == 0;
  if ( !From1rstController->ShockButtonL )
    v14 = From2ndController->ShockButtonL == 0;
  if ( !v14 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ShockButtonL = 255;
  v15 = From1rstController->ShockButtonR == 0;
  if ( !From1rstController->ShockButtonR )
    v15 = From2ndController->ShockButtonR == 0;
  if ( !v15 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ShockButtonR = 255;
  v16 = From1rstController->m_bChatIndicated == 0;
  if ( !From1rstController->m_bChatIndicated )
    v16 = From2ndController->m_bChatIndicated == 0;
  if ( !v16 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.m_bChatIndicated = 255;
  v17 = From1rstController->m_bPedWalk == 0;
  if ( !From1rstController->m_bPedWalk )
    v17 = From2ndController->m_bPedWalk == 0;
  if ( !v17 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.m_bPedWalk = 255;
  v18 = From1rstController->m_bRadioTrackSkip == 0;
  if ( !From1rstController->m_bRadioTrackSkip )
    v18 = From2ndController->m_bRadioTrackSkip == 0;
  if ( !v18 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.m_bRadioTrackSkip = 255;
  v19 = From1rstController->m_bVehicleMouseLook == 0;
  if ( !From1rstController->m_bVehicleMouseLook )
    v19 = From2ndController->m_bVehicleMouseLook == 0;
  if ( !v19 )
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.m_bVehicleMouseLook = 255;
  LeftStickX = (const CControllerState *)From1rstController->LeftStickX;
  if ( (int)LeftStickX < 0 )
  {
    v23 = 0;
LABEL_73:
    v24 = From2ndController->LeftStickX;
    if ( v24 <= 0 )
    {
      v22 = (__int16)LeftStickX < v24;
      v25 = From2ndController;
      if ( v22 )
        v25 = From1rstController;
      v23 = v25->LeftStickX;
      CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickX = v25->LeftStickX;
    }
    goto LABEL_77;
  }
  v21 = From2ndController->LeftStickX;
  if ( v21 <= -1 )
  {
    v23 = 0;
  }
  else
  {
    v22 = (int)LeftStickX <= v21;
    LeftStickX = From2ndController;
    if ( !v22 )
      LeftStickX = From1rstController;
    v23 = LeftStickX->LeftStickX;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickX = LeftStickX->LeftStickX;
    LOWORD(LeftStickX) = From1rstController->LeftStickX;
  }
  if ( (__int16)LeftStickX <= 0 )
    goto LABEL_73;
LABEL_77:
  LeftStickY = From1rstController->LeftStickY;
  if ( LeftStickY <= -1 )
  {
    v29 = 0;
LABEL_85:
    v30 = From2ndController->LeftStickY;
    if ( v30 <= 0 )
    {
      v22 = (__int16)LeftStickY < v30;
      v31 = From2ndController;
      if ( v22 )
        v31 = From1rstController;
      v29 = v31->LeftStickY;
      CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickY = v29;
    }
    goto LABEL_89;
  }
  v27 = From2ndController->LeftStickY;
  if ( v27 <= -1 )
  {
    v29 = 0;
  }
  else
  {
    v22 = LeftStickY <= v27;
    v28 = From2ndController;
    if ( !v22 )
      v28 = From1rstController;
    v29 = v28->LeftStickY;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickY = v29;
    LOWORD(LeftStickY) = From1rstController->LeftStickY;
  }
  if ( (__int16)LeftStickY <= 0 )
    goto LABEL_85;
LABEL_89:
  v32 = From1rstController->LeftStickX;
  if ( v32 >= 1 )
  {
    if ( From2ndController->LeftStickX >= 0 )
      goto LABEL_95;
    goto LABEL_94;
  }
  if ( v32 <= -1 && From2ndController->LeftStickX >= 1 )
  {
LABEL_94:
    v23 = 0;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickX = 0;
  }
LABEL_95:
  v33 = From1rstController->LeftStickY;
  if ( v33 < 1 )
  {
    if ( v33 > -1 || From2ndController->LeftStickY < 1 )
      goto LABEL_101;
    goto LABEL_100;
  }
  if ( From2ndController->LeftStickY < 0 )
  {
LABEL_100:
    v29 = 0;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickY = 0;
  }
LABEL_101:
  RightStickX = (const CControllerState *)From1rstController->RightStickX;
  if ( (int)RightStickX <= -1 )
    goto LABEL_107;
  v35 = From2ndController->RightStickX;
  if ( v35 > -1 )
  {
    v22 = (int)RightStickX <= v35;
    RightStickX = From2ndController;
    if ( !v22 )
      RightStickX = From1rstController;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightStickX = RightStickX->RightStickX;
    LOWORD(RightStickX) = From1rstController->RightStickX;
  }
  if ( (__int16)RightStickX <= 0 )
  {
LABEL_107:
    v36 = From2ndController->RightStickX;
    if ( v36 <= 0 )
    {
      v22 = (__int16)RightStickX < v36;
      v37 = From2ndController;
      if ( v22 )
        v37 = From1rstController;
      CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightStickX = v37->RightStickX;
    }
  }
  RightStickY = (const CControllerState *)From1rstController->RightStickY;
  if ( (int)RightStickY <= -1 )
    goto LABEL_117;
  v39 = From2ndController->RightStickY;
  if ( v39 > -1 )
  {
    v22 = (int)RightStickY <= v39;
    RightStickY = From2ndController;
    if ( !v22 )
      RightStickY = From1rstController;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightStickY = RightStickY->RightStickY;
    LOWORD(RightStickY) = From1rstController->RightStickY;
  }
  if ( (__int16)RightStickY <= 0 )
  {
LABEL_117:
    v40 = From2ndController->RightStickY;
    if ( v40 <= 0 )
    {
      v22 = (__int16)RightStickY < v40;
      v41 = From2ndController;
      if ( v22 )
        v41 = From1rstController;
      CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightStickY = v41->RightStickY;
    }
  }
  v42 = From1rstController->RightStickX;
  if ( v42 >= 1 )
  {
    if ( From2ndController->RightStickX >= 0 )
      goto LABEL_127;
    goto LABEL_126;
  }
  if ( v42 <= -1 && From2ndController->RightStickX >= 1 )
LABEL_126:
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightStickX = 0;
LABEL_127:
  v43 = From1rstController->RightStickY;
  if ( v43 >= 1 )
  {
    if ( From2ndController->RightStickY >= 0 )
      goto LABEL_133;
    goto LABEL_132;
  }
  if ( v43 <= -1 && From2ndController->RightStickY >= 1 )
LABEL_132:
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.RightStickY = 0;
LABEL_133:
  v44 = From1rstController->DPadUp == 0;
  if ( !From1rstController->DPadUp )
    v44 = From2ndController->DPadUp == 0;
  if ( v44 )
  {
    v45 = 0;
  }
  else
  {
    v45 = 255;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadUp = 255;
  }
  v46 = From1rstController->DPadDown == 0;
  if ( !From1rstController->DPadDown )
    v46 = From2ndController->DPadDown == 0;
  if ( v46 )
  {
    v47 = 0;
  }
  else
  {
    v47 = 255;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadDown = 255;
  }
  v48 = From1rstController->DPadLeft == 0;
  if ( !From1rstController->DPadLeft )
    v48 = From2ndController->DPadLeft == 0;
  if ( v48 )
  {
    v49 = 0;
  }
  else
  {
    v49 = 255;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadLeft = 255;
  }
  DPadRight = (unsigned __int16)From1rstController->DPadRight;
  v51 = DPadRight == 0;
  if ( !DPadRight )
    v51 = From2ndController->DPadRight == 0;
  if ( v51 )
  {
    v52 = 0;
    if ( !v45 )
    {
LABEL_149:
      if ( v29 > -1 )
        goto LABEL_153;
    }
  }
  else
  {
    v52 = 255;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadRight = 255;
    if ( !v45 )
      goto LABEL_149;
  }
  if ( v29 > 0 || v47 )
  {
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadDown = 0;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadUp = 0;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickY = 0;
  }
LABEL_153:
  if ( (v49 || v23 <= -1) && (v23 > 0 || v52) )
  {
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadRight = 0;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadLeft = 0;
    CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickX = 0;
  }
  v53 = *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftStickX;
  v54 = *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.LeftShoulder1;
  v55 = *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.m_bChatIndicated;
  *(_QWORD *)&retstr->ButtonCross = *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.ButtonCross;
  *(_QWORD *)&retstr->m_bChatIndicated = v55;
  v56 = *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.DPadUp;
  v57 = *(_QWORD *)&CPad::ReconcileTwoControllersInput(CControllerState const&,CControllerState const&)::ReconState.Start;
  *(_QWORD *)&retstr->LeftStickX = v53;
  *(_QWORD *)&retstr->LeftShoulder1 = v54;
  result = (CControllerState *)&retstr->DPadUp;
  *(_QWORD *)&result->LeftStickX = v56;
  *(_QWORD *)&result->LeftShoulder1 = v57;
  return result;
}
// 0: using guessed type int dword_0;

//----- (003F89F8) --------------------------------------------------------
void __fastcall CPad::SetDrunkInputDelay(CPad *this, Int32 FrameDelay)
{
  this->DrunkDrivingBufferUsed = FrameDelay;
}

//----- (003F89FC) --------------------------------------------------------
void __fastcall CPad::StartShake(CPad *this, Int16 Duration, UInt8 Frequency, UInt32 DelayAfterThisOne)
{
  uint32 v4; // r12
  int v5; // r1

  if ( MobileSettings::settings[29].value && !CCutsceneMgr::ms_running )
  {
    if ( Frequency )
    {
      v4 = CTimer::m_snTimeInMilliseconds;
      if ( CTimer::m_snTimeInMilliseconds >= this->NoShakeBeforeThis || (unsigned int)this->NoShakeFreq < Frequency )
      {
        v5 = (__int16)(Duration + ((unsigned __int16)(Duration & 0x8000) >> 15)) >> 1;
        if ( v5 > this->ShakeDur )
        {
          this->ShakeFreq = Frequency;
          this->ShakeDur = v5;
        }
        this->NoShakeFreq = Frequency;
        this->NoShakeBeforeThis = v4 + DelayAfterThisOne;
      }
    }
    else
    {
      this->ShakeFreq = 0;
      this->ShakeDur = 0;
    }
  }
}

//----- (003F8A8C) --------------------------------------------------------
void __fastcall CPad::StartShake_Distance(CPad *this, int Duration, int Frequency, float X, float Y, float Z)
{
  CSimpleTransform *p_tx; // r3

  if ( MobileSettings::settings[29].value && !CCutsceneMgr::ms_running )
  {
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    if ( sqrtf(
           (float)((float)((float)(p_tx->m_translate.x - X) * (float)(p_tx->m_translate.x - X))
                 + (float)((float)(p_tx->m_translate.y - Y) * (float)(p_tx->m_translate.y - Y)))
         + (float)((float)(p_tx->m_translate.z - Z) * (float)(p_tx->m_translate.z - Z))) < 70.0 )
    {
      if ( Frequency )
      {
        if ( this->ShakeDur >= Duration )
          return;
        this->ShakeFreq = Frequency;
      }
      else
      {
        LOWORD(Duration) = 0;
        this->ShakeFreq = 0;
      }
      this->ShakeDur = Duration;
    }
  }
}

//----- (003F8B50) --------------------------------------------------------
void CPad::UpdatePads()
{
  _BOOL4 Enabled; // r4
  _BOOL4 v1; // r5
  int DisablePlayerControls; // r0
  bool v3; // zf
  unsigned int pendingScreen; // r0
  float v5; // r5
  float v6; // r0
  int v7; // [sp+0h] [bp-10h] BYREF
  int x[3]; // [sp+4h] [bp-Ch] BYREF

  if ( CTouchInterface::m_pWidgets[102] )
    Enabled = CWidget::GetEnabled(CTouchInterface::m_pWidgets[102]);
  else
    Enabled = 0;
  if ( CTouchInterface::m_pWidgets[64] )
    v1 = CWidget::GetEnabled(CTouchInterface::m_pWidgets[64]);
  else
    v1 = 0;
  if ( CHID::GetInputType() != 2 )
    goto LABEL_17;
  DisablePlayerControls = Pads[0].DisablePlayerControls;
  if ( Pads[0].DisablePlayerControls )
    DisablePlayerControls = 1;
  v3 = gMobileMenu.screenStack.numEntries == 0;
  if ( !gMobileMenu.screenStack.numEntries )
    v3 = (DisablePlayerControls | Enabled) == 0;
  if ( !v3 )
    goto LABEL_17;
  pendingScreen = (unsigned int)gMobileMenu.pendingScreen;
  if ( gMobileMenu.pendingScreen )
    pendingScreen = 1;
  if ( !(pendingScreen | v1) )
  {
    OS_PointerLock(1);
    v5 = 0.0;
    CPad::vecLastMouse.x = (float)(RsGlobal.screenWidth / 2);
    CPad::vecLastMouse.y = (float)(RsGlobal.screenHeight / 2);
    v7 = 0;
    x[0] = 0;
    LIB_PointerGetCoordinates(0, x, &v7, 0);
    v6 = 0.0;
    if ( CPad::UpdatePads(void)::bLastLock == 1 )
    {
      v6 = (float)v7 - CPad::vecLastMouse.y;
      v5 = (float)x[0] - CPad::vecLastMouse.x;
    }
    CPad::UpdatePads(void)::bLastLock = 1;
    CPad::vecMouseDelta.x = v5;
    CPad::vecMouseDelta.y = v6;
  }
  else
  {
LABEL_17:
    OS_PointerLock(0);
    CPad::UpdatePads(void)::bLastLock = 0;
    CPad::vecMouseDelta.x = 0.0;
    CPad::vecMouseDelta.y = 0.0;
  }
  CPad::UpdateMouse(Pads);
  CapturePad(0);
  CapturePad(1u);
  CControllerConfigManager::ClearSimButtonPressCheckers(&ControlsManager);
  CControllerConfigManager::AffectPadFromKeyBoard(&ControlsManager);
  CControllerConfigManager::AffectPadFromMouse(&ControlsManager);
  CPad::Update(Pads, 0);
  CPad::Update(&Pads[1], 1);
}
// 959E00: using guessed type char CPad::UpdatePads(void)::bLastLock;
// 3F8B50: using guessed type int x[3];

//----- (003F8CF4) --------------------------------------------------------
CPad *__fastcall CPad::GetPad(int32 nPadNumber)
{
  return &Pads[nPadNumber];
}

//----- (003F8D08) --------------------------------------------------------
void __fastcall CPad::Update(CPad *this, Int16 PadNum)
{
  CControllerState *p_OldState; // r0
  __int64 v4; // d17
  __int64 v5; // d18
  __int64 v6; // d19
  int v7; // r8
  __int64 v8; // d20
  __int64 v9; // d21
  __int64 v10; // d16
  __int64 v11; // d17
  __int64 v12; // d20
  __int64 v13; // d21
  __int64 v14; // d19
  CPad *v15; // r1
  __int64 v16; // d16
  __int64 v17; // d17
  __int64 v18; // d19
  __int64 v19; // d20
  __int64 v20; // d21
  float *p_m_fAccelX; // r6
  float *p_m_fAccelY; // r5
  float *p_m_fAccelZ; // r4
  float v24; // s6
  float v25; // s4
  float v26; // s2
  float v27; // s0
  float v28; // s10
  float v29; // s12
  float v30; // s14
  float v31; // s1
  float v32; // s3
  float v33; // s5
  float v34; // s7
  float v35; // s2
  float v36; // s4
  CVehicle *PlayerVehicle; // r0
  CMatrix *m_pMat; // r0
  float v39; // s16
  float v40; // s0
  CPlayerPed *PlayerPed; // r0
  bool v42; // r0
  CVehicle *v43; // r0
  int m_nModelIndex; // r0
  CRunningScript *v45; // r4
  int v46; // r0
  bool v47; // zf
  CPlayerPed *v48; // r0
  CVehicle *v49; // r4
  CPlayerPed *v50; // r0
  const char *v51; // r4
  CPlayerPed *v52; // r0
  CRunningScript *v53; // r4
  CVehicle *CarForScript; // r0
  char v55; // r0
  int value; // r4
  TouchSense *v57; // r0
  __int64 v58; // d16
  __int64 v59; // d17
  int JustOutOfFrontEnd; // r0
  bool v61; // zf
  GxtChar *v62; // r0
  GxtChar *v63; // r0
  GxtChar *v64; // r0
  GxtChar *v65; // r0
  GxtChar *v66; // r0
  GxtChar *v67; // r0
  CControllerState v68; // [sp+18h] [bp-58h] BYREF
  CVector v69; // 0:r1.12
  CVector v70; // 0:r2.8,8:^0.4

  p_OldState = &this->OldState;
  v4 = *(_QWORD *)&this->NewState.LeftShoulder1;
  v5 = *(_QWORD *)&this->NewState.DPadUp;
  v6 = *(_QWORD *)&this->NewState.Start;
  v7 = PadNum;
  v8 = *(_QWORD *)&this->NewState.ButtonCross;
  v9 = *(_QWORD *)&this->NewState.m_bChatIndicated;
  *(_QWORD *)&p_OldState->LeftStickX = *(_QWORD *)&this->NewState.LeftStickX;
  *(_QWORD *)&p_OldState->LeftShoulder1 = v4;
  *(_QWORD *)&this->OldState.ButtonCross = v8;
  *(_QWORD *)&this->OldState.m_bChatIndicated = v9;
  *(_QWORD *)&this->OldState.DPadUp = v5;
  *(_QWORD *)&this->OldState.Start = v6;
  CPad::ReconcileTwoControllersInput(&v68, (CPad *)PadNum, &this->PCTempKeyState, &this->PCTempJoyState);
  v10 = *(_QWORD *)&v68.LeftStickX;
  v11 = *(_QWORD *)&v68.LeftShoulder1;
  v12 = *(_QWORD *)&v68.DPadUp;
  v13 = *(_QWORD *)&v68.Start;
  v14 = *(_QWORD *)&v68.m_bChatIndicated;
  *(_QWORD *)&this->NewState.ButtonCross = *(_QWORD *)&v68.ButtonCross;
  *(_QWORD *)&this->NewState.m_bChatIndicated = v14;
  *(_QWORD *)&this->NewState.LeftStickX = v10;
  *(_QWORD *)&this->NewState.LeftShoulder1 = v11;
  *(_QWORD *)&this->NewState.DPadUp = v12;
  *(_QWORD *)&this->NewState.Start = v13;
  CPad::ReconcileTwoControllersInput(&v68, v15, &this->PCTempMouseState, &this->NewState);
  v16 = *(_QWORD *)&v68.LeftStickX;
  v17 = *(_QWORD *)&v68.LeftShoulder1;
  v18 = *(_QWORD *)&v68.m_bChatIndicated;
  v19 = *(_QWORD *)&v68.DPadUp;
  v20 = *(_QWORD *)&v68.Start;
  *(_QWORD *)&this->NewState.ButtonCross = *(_QWORD *)&v68.ButtonCross;
  *(_QWORD *)&this->NewState.m_bChatIndicated = v18;
  *(_QWORD *)&this->NewState.LeftStickX = v16;
  *(_QWORD *)&this->NewState.LeftShoulder1 = v17;
  *(_QWORD *)&this->NewState.DPadUp = v19;
  *(_QWORD *)&this->NewState.Start = v20;
  memset(&this->PCTempKeyState, 0, 0x90u);
  if ( CControllerState::CheckForInput(&this->NewState) )
    this->LastTimeTouched = CTimer::m_snTimeInMilliseconds;
  p_m_fAccelX = &this->m_fAccelX;
  p_m_fAccelY = &this->m_fAccelY;
  p_m_fAccelZ = &this->m_fAccelZ;
  OS_GamepadAccelerometer(&this->m_fAccelX, &this->m_fAccelY, &this->m_fAccelZ);
  switch ( MobileSettings::settings[8].value )
  {
    case 0:
      v25 = 0.0;
      *p_m_fAccelX = 0.0;
      *p_m_fAccelY = 0.0;
      v26 = 0.0;
      v27 = 0.0;
LABEL_15:
      *p_m_fAccelZ = v27;
      goto LABEL_17;
    case 1:
      v24 = 11.0;
      goto LABEL_9;
    case 2:
      v24 = 7.0;
LABEL_9:
      v27 = 0.0;
      v26 = 0.0;
      if ( fabsf(*p_m_fAccelX) > 0.05 )
        v26 = *p_m_fAccelX / v24;
      *p_m_fAccelX = v26;
      v25 = 0.0;
      if ( fabsf(*p_m_fAccelY) > 0.05 )
        v25 = *p_m_fAccelY / v24;
      *p_m_fAccelY = v25;
      if ( fabsf(*p_m_fAccelZ) > 0.05 )
        v27 = *p_m_fAccelZ / v24;
      goto LABEL_15;
  }
  v27 = *p_m_fAccelZ;
  v25 = *p_m_fAccelY;
  v26 = *p_m_fAccelX;
LABEL_17:
  v28 = 1.0;
  v29 = 1.0;
  v30 = 1.0;
  v31 = 1.0;
  v32 = 1.0;
  v33 = 1.0;
  if ( v26 < 1.0 )
    v28 = v26;
  if ( v25 < 1.0 )
    v29 = v25;
  if ( v27 < 1.0 )
    v30 = v27;
  if ( v28 <= -1.0 )
    v31 = -1.0;
  v34 = v31;
  if ( v29 <= -1.0 )
    v32 = -1.0;
  if ( v30 <= -1.0 )
    v33 = -1.0;
  if ( v26 < 1.0 )
    v34 = v26;
  v35 = v32;
  if ( v25 < 1.0 )
    v35 = v25;
  v36 = v33;
  if ( v27 < 1.0 )
    v36 = v27;
  if ( v28 <= -1.0 )
    v34 = v31;
  if ( v29 <= -1.0 )
    v35 = v32;
  if ( v30 <= -1.0 )
    v36 = v33;
  *p_m_fAccelX = v34;
  *p_m_fAccelY = v35;
  *p_m_fAccelZ = v36;
  if ( !v7 )
  {
    if ( !FindPlayerVehicle(-1, 0)
      || FindPlayerVehicle(-1, 0)->m_vehicleType != 10 && FindPlayerVehicle(-1, 0)->m_vehicleType != 9
      || !MobileSettings::settings[3].value )
    {
      goto LABEL_58;
    }
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    *(_QWORD *)&v70.x = 0LL;
    v70.z = 0.0;
    CPhysical::GetSpeed((CVector *)&v68, PlayerVehicle, v70);
    m_pMat = FindPlayerVehicle(-1, 0)->m_pMat;
    v39 = 0.0;
    v40 = (float)((float)((float)(*(float *)&v68.LeftStickX * m_pMat->xy)
                        + (float)(*(float *)&v68.RightStickX * m_pMat->yy))
                + (float)(*(float *)&v68.LeftShoulder1 * m_pMat->zy))
        / 0.0055556;
    if ( fabsf(v40) < 0.42 )
      v40 = 0.0;
    this->fBikeStickY = 0.0;
    CPad::ProcessWheelie(this, v40);
    if ( CTouchInterface::IsDoubleTapped(WIDGET_BRAKE, 0, 1) )
    {
      this->bStoppie = 1;
      fStartStoppieTimer = 0.0;
    }
    else
    {
      if ( !this->bStoppie )
        goto LABEL_56;
      v39 = fStartStoppieTimer;
    }
    fStartStoppieTimer = v39
                       + (float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) / 1000.0);
    if ( CTouchInterface::IsTouched(WIDGET_BRAKE, 0, 1) )
    {
      if ( FindPlayerPed(-1)->m_pMat->zy > -0.5 )
        this->fBikeStickY = -255.0;
      goto LABEL_58;
    }
LABEL_56:
    if ( fStartStoppieTimer > 0.2 )
      this->bStoppie = 0;
LABEL_58:
    if ( FindPlayerPed(-1) )
    {
      PlayerPed = FindPlayerPed(-1);
      v42 = CPedIntelligence::GetTaskJetPack(PlayerPed->m_pPedIntelligence) != 0;
    }
    else
    {
      v42 = 0;
    }
    this->bHasJetPack = v42;
    v43 = FindPlayerVehicle(-1, 0);
    if ( v43 )
    {
      m_nModelIndex = v43->m_nModelIndex;
      if ( (unsigned int)(m_nModelIndex - 537) > 1 )
      {
        if ( (unsigned __int16)m_nModelIndex == 570 )
        {
          if ( !this->bSavedForTrain )
          {
            this->bSavedForTrain = 1;
            SaveGameForPause(eOddjobSave, CTheScripts::pActiveScripts->ScriptName);
          }
          this->bTrainPassenger = 1;
        }
        else
        {
          this->bSavedForTrain = 0;
        }
      }
      else if ( !this->bSavedForTrain )
      {
        this->bSavedForTrain = 1;
        SaveGameForPause(eOddjobSave, CTheScripts::pActiveScripts->ScriptName);
      }
    }
    else
    {
      *(_WORD *)&this->bTrainPassenger = 0;
    }
    v45 = CTheScripts::pActiveScripts;
    if ( CTheScripts::pActiveScripts )
    {
      if ( strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "bcour")
        || (CPad::GetCarGunFired(this, 0, 0), (v45 = CTheScripts::pActiveScripts) != 0) )
      {
        v46 = strcmp((const char *)v45->ScriptName, "zero1");
        v47 = v46 == 0;
        if ( !v46 )
          v47 = this->DisablePlayerControls == 0;
        if ( v47 )
        {
          v61 = TheCamera.PlayerWeaponMode.Mode == 0;
          if ( TheCamera.PlayerWeaponMode.Mode )
            v61 = TheCamera.PlayerWeaponMode.Mode == 45;
          if ( !v61 )
            CCamera::SetNewPlayerWeaponMode(&TheCamera, 45, 0, 0);
        }
      }
    }
    if ( !this->bHasCheated )
    {
      if ( FindPlayerVehicle(-1, 0) )
      {
        v49 = FindPlayerVehicle(-1, 0);
        v50 = FindPlayerPed(-1);
        if ( CVehicle::IsDriver(v49, v50)
          && !TheCamera.m_WideScreenOn
          && this->bSetSteeringMode
          && CHID::GetInputType() != 2 )
        {
          if ( !CPad::Update(short)::DisplayReleaseLog )
            CPad::Update(short)::DisplayReleaseLog = 1;
          CTimer::StartUserPause();
          if ( CTouchInterface::IsReleased(WIDGET_STEERING_SELECTION, 0, 2)
            && CTouchInterface::m_pWidgets[64][1]._vptr$CWidget != (int (**)(void))-1 )
          {
            MobileSettings::settings[3].value = (int32)CTouchInterface::m_pWidgets[64][1]._vptr$CWidget;
            Menu_SaveSettings();
            CTimer::EndUserPause();
            if ( CHID::GetInputType() )
            {
              if ( CHID::GetInputType() == 2 )
                v51 = "HLPMAPK";
              else
                v51 = "HLPMAPH";
            }
            else
            {
              v51 = "HLPMAPT";
            }
            v62 = CText::Get(&TheText, (const unsigned __int8 *)v51);
            CHud::SetHelpMessage((const unsigned __int8 *)v51, v62, 0, 0, 0, 0);
            v63 = CText::Get(&TheText, (const unsigned __int8 *)v51);
            CMessages::AddToPreviousBriefArray((const unsigned __int8 *)v51, v63, -1, -1, -1, -1, -1, -1, 0);
            v64 = CText::Get(&TheText, "HELP_44");
            CHud::SetHelpMessage("HELP_44", v64, 0, 0, 0, 0);
            v65 = CText::Get(&TheText, "HELP_44");
            CMessages::AddToPreviousBriefArray("HELP_44", v65, -1, -1, -1, -1, -1, -1, 0);
            v66 = CText::Get(&TheText, "HELP22");
            CHud::SetHelpMessage("HELP22", v66, 0, 0, 0, 0);
            v67 = CText::Get(&TheText, "HELP22");
            CMessages::AddToPreviousBriefArray("HELP22", v67, -1, -1, -1, -1, -1, -1, 0);
            this->bSetSteeringMode = 0;
            CPad::Update(short)::DisplayReleaseLog = 0;
          }
        }
      }
    }
    this->bDoorsLocked = 0;
    if ( CTheScripts::pActiveScripts
      && !strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "plchute")
      && FindPlayerVehicle(-1, 0)
      && FindPlayerVehicle(-1, 0)->m_eDoorLockState == CARLOCK_LOCKED_PLAYER_INSIDE )
    {
      this->bDoorsLocked = 1;
    }
    if ( FindPlayerPed(-1) )
    {
      if ( CGangWars::GangWarGoingOn() == 1 )
      {
        if ( !CPad::Update(short)::bStopWantedForGangWars )
        {
          CWanted::SetMaximumWantedLevel(0);
          v48 = FindPlayerPed(-1);
          CPlayerPed::SetWantedLevel(v48, 0);
          CPad::Update(short)::bStopWantedForGangWars = 1;
        }
      }
      else if ( CPad::Update(short)::bStopWantedForGangWars == 1 )
      {
        CWanted::SetMaximumWantedLevel(6);
        v52 = FindPlayerPed(-1);
        CPlayerPed::SetWantedLevel(v52, 0);
        CPad::Update(short)::bStopWantedForGangWars = 0;
      }
      if ( this->bRegainControl )
      {
        this->bRegainControl = 0;
        this->DisablePlayerControls = 0;
      }
    }
    if ( this->bStopRhythmSprites )
    {
      CPad::Update(short)::fRhythmSpriteTimer = CPad::Update(short)::fRhythmSpriteTimer
                                              + (float)(CTimer::ms_fTimeStep / 50.0);
      if ( CPad::Update(short)::fRhythmSpriteTimer > 4.2 )
      {
        CPad::Update(short)::fRhythmSpriteTimer = 0.0;
        this->bStopRhythmSprites = 0;
      }
    }
    v53 = CTheScripts::pActiveScripts;
    if ( CTheScripts::pActiveScripts && !strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "mtbiker") )
    {
      v55 = 1;
    }
    else
    {
      if ( CPad::Update(short)::bIsMTBikerActive != 1 || AllowMissionReplay )
        goto LABEL_116;
      CStreaming::RequestModel(510, 8);
      CStreaming::LoadAllRequestedModels(0);
      v69.x = -2309.2;
      *(_QWORD *)&v69.y = 0x43F18B85C4CE670ALL;
      CarForScript = CCarCtrl::CreateCarForScript(510, v69, 0);
      if ( CarForScript->m_pMat )
        CMatrix::SetRotateZOnly(CarForScript->m_pMat, -2.6529);
      else
        CarForScript->m_transform.m_heading = -2.6529;
      v55 = 0;
    }
    CPad::Update(short)::bIsMTBikerActive = v55;
    v53 = CTheScripts::pActiveScripts;
LABEL_116:
    if ( v53 && !strcmp((const char *)v53->ScriptName, "barb") && TheCamera.m_nPedZoom != 2 )
      TheCamera.m_nPedZoom = 2;
    value = MobileSettings::settings[29].value;
    if ( MobileSettings::settings[29].value )
      value = 2;
    TouchSense::instance();
    TouchSense::setHapticsLevel(v57, value);
  }
  if ( CTouchInterface::m_pWidgets[102] )
    this->bRhythm = CWidget::GetEnabled(CTouchInterface::m_pWidgets[102]);
  v58 = *(_QWORD *)this->SteeringLeftRightBuffer;
  v59 = *(_QWORD *)&this->SteeringLeftRightBuffer[4];
  JustOutOfFrontEnd = this->JustOutOfFrontEnd;
  this->SteeringLeftRightBuffer[9] = this->SteeringLeftRightBuffer[8];
  *(_QWORD *)&this->SteeringLeftRightBuffer[1] = v58;
  *(_QWORD *)&this->SteeringLeftRightBuffer[5] = v59;
  if ( JustOutOfFrontEnd )
    this->JustOutOfFrontEnd = JustOutOfFrontEnd - 1;
}
// 3F8D7E: variable 'v15' is possibly undefined
// 3F9476: variable 'v57' is possibly undefined
// 959E10: using guessed type char CPad::Update(short)::DisplayReleaseLog;
// 959E11: using guessed type char CPad::Update(short)::bStopWantedForGangWars;
// 959E18: using guessed type char CPad::Update(short)::bIsMTBikerActive;

//----- (003F96CC) --------------------------------------------------------
void __fastcall CPad::ProcessWheelie(CPad *this, float fSpeed)
{
  Bool8 *p_bWheelie; // r5

  if ( fSpeed > 15.0 && CTouchInterface::IsDoubleTapped(WIDGET_ACCELERATE, 0, 1)
    || CTouchInterface::IsDoubleTapped(WIDGET_DRIVE_HYBRID, 0, 1) )
  {
    this->bWheelie = 1;
    p_bWheelie = &this->bWheelie;
    fStartWheelieTimer = 0.0;
  }
  else
  {
    p_bWheelie = &this->bWheelie;
    if ( !this->bWheelie )
    {
LABEL_13:
      if ( fStartWheelieTimer <= 0.2 )
        return;
      *p_bWheelie = 0;
      goto LABEL_15;
    }
  }
  fStartWheelieTimer = fStartWheelieTimer
                     + (float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) / 1000.0);
  if ( !CTouchInterface::IsTouched(WIDGET_ACCELERATE, 0, 1) && !CTouchInterface::IsTouched(WIDGET_DRIVE_HYBRID, 0, 1) )
    goto LABEL_13;
  if ( FindPlayerPed(-1)->m_pMat->zy < 0.5 )
    this->fBikeStickY = 255.0;
  if ( FindPlayerPed(-1)->m_pMat->zy >= 0.2 )
  {
LABEL_15:
    fWheelieResetTimer = 0.0;
    return;
  }
  fWheelieResetTimer = fWheelieResetTimer + (float)(CTimer::ms_fTimeStep / 50.0);
  if ( fWheelieResetTimer > 1.5 )
  {
    this->NewState.LeftStickY = 0;
    this->bWheelie = 0;
  }
}

//----- (003F9848) --------------------------------------------------------
void __fastcall CPad::ProcessStoppie(CPad *this)
{
  if ( CTouchInterface::IsDoubleTapped(WIDGET_BRAKE, 0, 1) )
  {
    this->bStoppie = 1;
    fStartStoppieTimer = 0.0;
  }
  else if ( !this->bStoppie )
  {
    goto LABEL_7;
  }
  fStartStoppieTimer = fStartStoppieTimer
                     + (float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) / 1000.0);
  if ( CTouchInterface::IsTouched(WIDGET_BRAKE, 0, 1) )
  {
    if ( FindPlayerPed(-1)->m_pMat->zy > -0.5 )
      this->fBikeStickY = -255.0;
    return;
  }
LABEL_7:
  if ( fStartStoppieTimer > 0.2 )
    this->bStoppie = 0;
}

//----- (003F9924) --------------------------------------------------------
void CPad::CheckPointSave()
{
  sub_190BD0(eOddjobSave, CTheScripts::pActiveScripts->ScriptName);
}

//----- (003F993C) --------------------------------------------------------
int16 __fastcall CPad::GetCarGunFired(CPad *this, bool bCanShootFwd, bool bAir)
{
  _BOOL4 v3; // r5
  _BOOL4 v4; // r4
  bool v5; // zf
  int16 v6; // r6
  CPlayerPed *PlayerPed; // r0
  _BOOL4 IsHeldDown; // r8
  _BOOL4 v10; // r0
  bool v11; // zf
  CPlayerPed *v12; // r0
  CPlayerPed *v13; // r5
  CVehicle *m_pMyVehicle; // r0

  v3 = bCanShootFwd;
  v4 = bAir;
  v5 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v5 = this->bRhythm == 0;
  if ( !v5 )
    return 0;
  if ( bAir )
    goto LABEL_24;
  if ( !FindPlayerVehicle(-1, 0) )
    goto LABEL_24;
  if ( FindPlayerVehicle(-1, 0)->m_nModelIndex == 407 )
    goto LABEL_24;
  if ( FindPlayerVehicle(-1, 0)->m_nModelIndex == 601 )
    goto LABEL_24;
  if ( !FindPlayerPed(-1) )
    goto LABEL_24;
  PlayerPed = FindPlayerPed(-1);
  if ( PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_nAmmoTotal < 1 )
    goto LABEL_24;
  v6 = 1;
  IsHeldDown = CTouchInterface::IsHeldDown(WIDGET_VEHICLE_SHOOT_LEFT, 1);
  v10 = CTouchInterface::IsHeldDown(WIDGET_VEHICLE_SHOOT_RIGHT, 1);
  v11 = !IsHeldDown;
  if ( !IsHeldDown )
    v11 = !v10;
  if ( v11 )
  {
LABEL_24:
    if ( !v3 )
      return 0;
    v12 = FindPlayerPed(-1);
    v13 = v12;
    if ( v4 )
    {
      if ( CTouchInterface::IsTouched(WIDGET_AIR_GUN, 0, 1) )
        return 2;
      return 0;
    }
    if ( (!v12 || v12->m_WeaponSlots[v12->m_nCurrentWeapon].m_nAmmoTotal <= 0)
      && (!FindPlayerVehicle(-1, 0) || FindPlayerVehicle(-1, 0)->m_nModelIndex != 407)
      || !CTouchInterface::IsTouched(WIDGET_CAR_SHOOT, 0, 1) )
    {
      return 0;
    }
    m_pMyVehicle = v13->m_pMyVehicle;
    return !m_pMyVehicle || m_pMyVehicle->m_vehicleType != 10 || !CHID::IsPressed(HID_MAPPING_BUNNY_HOP, 0);
  }
  return v6;
}

//----- (003F9A74) --------------------------------------------------------
bool __fastcall CPad::IsFlyingRCVehicle(CPad *this)
{
  return CWorld::Players[0].pRemoteVehicle && (unsigned int)(CWorld::Players[0].pRemoteVehicle->m_vehicleType - 3) < 2;
}

//----- (003F9A98) --------------------------------------------------------
int32 __fastcall CPad::GetSteeringMode(CPad *this)
{
  int32 v2; // r4

  if ( CHID::GetInputType() == 1 )
    return 0;
  if ( !MobileSettings::settings[18].value
    || !FindPlayerVehicle(-1, 0)
    || (v2 = 0, FindPlayerVehicle(-1, 0)->m_vehicleType != 9) && (v2 = 0, FindPlayerVehicle(-1, 0)->m_vehicleType != 10) )
  {
    if ( this->bHasJetPack )
      return 0;
    if ( FindPlayerVehicle(-1, 0) )
    {
      v2 = 0;
      if ( FindPlayerVehicle(-1, 0)->m_vehicleType == 4 )
        return v2;
      v2 = 0;
      if ( FindPlayerVehicle(-1, 0)->m_vehicleType == 3 )
        return v2;
      if ( CWorld::Players[0].pRemoteVehicle && (unsigned int)(CWorld::Players[0].pRemoteVehicle->m_vehicleType - 3) < 2 )
        return 0;
    }
    return MobileSettings::settings[3].value;
  }
  return v2;
}

//----- (003F9B54) --------------------------------------------------------
int16 __fastcall CPad::GetSteeringLeftRight(CPad *this)
{
  int v2; // r0
  float m_fAccelX; // s2
  int v4; // s16
  int v5; // r5
  int32 SteeringMode; // r0
  float v7; // s0
  float x; // s0
  float v9; // s4
  float v10; // s6
  float v11; // s2
  float v12; // s2
  CVector2D v14[3]; // [sp+0h] [bp-18h] BYREF

  if ( this->DisablePlayerControls )
  {
    LOWORD(v2) = 0;
    return v2;
  }
  LOWORD(v2) = 0;
  if ( this->bRhythm )
    return v2;
  m_fAccelX = this->m_fAccelX;
  v14[0].y = 0.0;
  v4 = (int)(float)(m_fAccelX * 128.0);
  v14[0].x = 0.0;
  LOWORD(v5) = v4;
  SteeringMode = CPad::GetSteeringMode(this);
  if ( !SteeringMode )
  {
    if ( !CTouchInterface::IsTouched(WIDGET_VEHICLE_STEER_ANALOG, v14, 1) )
      goto LABEL_24;
    x = v14[0].x;
    if ( fabsf(v14[0].x) > 64.0 )
    {
      CWidgetHelpText::ConditionSatisfied(4u);
      x = v14[0].x;
    }
    v9 = (float)MobileSettings::settings[27].value / 100.0;
    v10 = (float)MobileSettings::settings[28].value / 100.0;
    v11 = fabsf(x) * 0.0078125;
    if ( v11 >= v9 )
      v12 = (float)(v11 * (float)((float)(1.0 - v10) / (float)(1.0 - v9)))
          - (float)((float)((float)(1.0 - v10) / (float)(1.0 - v9)) + -1.0);
    else
      v12 = v11 * (float)(v10 / v9);
    v7 = x * v12;
    goto LABEL_23;
  }
  if ( SteeringMode != 2 )
  {
    if ( SteeringMode == 1 )
    {
      CTouchInterface::IsTouched(WIDGET_VEHICLE_STEER_RIGHT, 0, 1);
      CTouchInterface::IsTouched(WIDGET_VEHICLE_STEER_LEFT, 0, 1);
      if ( CTouchInterface::IsTouched(WIDGET_VEHICLE_STEER_LEFT, 0, 1) )
      {
        CWidgetHelpText::ConditionSatisfied(4u);
        LOWORD(v5) = v4 - 128;
      }
      if ( CTouchInterface::IsTouched(WIDGET_VEHICLE_STEER_RIGHT, 0, 1) )
      {
        CWidgetHelpText::ConditionSatisfied(4u);
        LOWORD(v5) = v5 + 128;
      }
    }
    goto LABEL_24;
  }
  if ( MobileSettings::settings[3].value == 2
    && CTouchInterface::m_pWidgets[173]
    && CTouchInterface::IsTouched(WIDGET_VEHICLE_FLICK, v14, 1) )
  {
    v7 = v14[0].x;
    if ( fabsf(v14[0].x) > 64.0 )
    {
      CWidgetHelpText::ConditionSatisfied(4u);
      v7 = v14[0].x;
    }
LABEL_23:
    v5 = (int)(float)(v7 + (float)v4);
  }
LABEL_24:
  if ( !CHID::GetInputType() && this->NewState.LeftStickX )
    LOWORD(v5) = this->NewState.LeftStickX;
  v2 = (__int16)v5;
  if ( (__int16)v5 >= 128 )
    v2 = 128;
  if ( v2 <= -128 )
    LOWORD(v2) = -128;
  return v2;
}

//----- (003F9D24) --------------------------------------------------------
int16 __fastcall CPad::GetSteeringUpDown(CPad *this)
{
  int v2; // r4
  float v3; // s0
  float y; // s0
  float v5; // s4
  float v6; // s6
  float v7; // s2
  float v8; // s2
  CVector2D v10; // [sp+0h] [bp-10h] BYREF

  if ( this->DisablePlayerControls )
  {
    LOWORD(v2) = 0;
    return v2;
  }
  if ( CPad::GetSteeringMode(this) )
  {
    v3 = this->fBikeStickY + 0.0;
LABEL_12:
    v2 = (int)v3;
    goto LABEL_13;
  }
  v2 = 0;
  v10.x = 0.0;
  v10.y = 0.0;
  if ( CTouchInterface::IsTouched(WIDGET_VEHICLE_STEER_ANALOG, &v10, 1) )
  {
    y = v10.y;
    if ( fabsf(v10.y) > 64.0 )
    {
      CWidgetHelpText::ConditionSatisfied(4u);
      y = v10.y;
    }
    v5 = (float)MobileSettings::settings[27].value / 100.0;
    v6 = (float)MobileSettings::settings[28].value / 100.0;
    v7 = fabsf(y) * 0.0078125;
    if ( v7 >= v5 )
      v8 = (float)(v7 * (float)((float)(1.0 - v6) / (float)(1.0 - v5)))
         - (float)((float)((float)(1.0 - v6) / (float)(1.0 - v5)) + -1.0);
    else
      v8 = v7 * (float)(v6 / v5);
    v3 = (float)(y * v8) + 0.0;
    goto LABEL_12;
  }
LABEL_13:
  if ( v2 >= 128 )
    v2 = 128;
  if ( v2 <= -128 )
    LOWORD(v2) = -128;
  return v2;
}

//----- (003F9E20) --------------------------------------------------------
int __fastcall CPad::GetCarGunUpDown(
        CPad *this,
        int bCheckHydraulics,
        CAutomobile *pAutomobile,
        float fLimit,
        int bPoop)
{
  int v9; // r6
  int m_nModelIndex; // r0
  bool v12; // zf
  float m_fScaleY; // r0
  int v14; // r0
  unsigned int v15; // r0
  CWidget *v16; // r8
  CHIDJoystick *v17; // r0
  int ButtonID; // r4
  void (__fastcall *v19)(CWidget *, _DWORD); // r4
  float v20; // s0
  unsigned int m_nSuspensionHydraulics; // r4
  unsigned int v22; // r4

  LOWORD(v9) = -128;
  if ( this->bRhythm )
  {
    if ( CHID::MappingIsAnalog(HID_MAPPING_RHYTHM_UP) )
    {
      if ( CHID::IsPressedPositive(HID_MAPPING_RHYTHM_UP) )
        goto LABEL_8;
      if ( CHID::IsPressedNegative(HID_MAPPING_RHYTHM_UP) )
        return (__int16)v9;
    }
    else
    {
      if ( CTouchInterface::IsTouched(WIDGET_RHYTHM_UP, 0, 1) )
        return (__int16)v9;
      if ( CTouchInterface::IsTouched(WIDGET_RHYTHM_DOWN, 0, 1) )
        goto LABEL_8;
    }
  }
  if ( this->DisablePlayerControls )
  {
LABEL_10:
    LOWORD(v9) = 0;
    return (__int16)v9;
  }
  if ( bCheckHydraulics != 1 || !FindPlayerPed(-1) || !(*((unsigned __int8 *)&FindPlayerPed(-1)->m_nPedFlags + 1) << 31) )
    goto LABEL_14;
  if ( !pAutomobile )
  {
    CTouchInterface::IsTouched(WIDGET_HYDRAULICS, 0, 2);
    if ( !CTouchInterface::m_pWidgets[12] )
      goto LABEL_14;
    m_fScaleY = CTouchInterface::m_pWidgets[12][1].m_fScaleY;
    if ( LODWORD(m_fScaleY) > 8 )
      goto LABEL_14;
    v14 = 1 << SLOBYTE(m_fScaleY);
    if ( (v14 & 0x62) != 0 )
      return (__int16)v9;
    if ( (v14 & 0x184) == 0 )
      goto LABEL_14;
LABEL_8:
    LOWORD(v9) = 128;
    return (__int16)v9;
  }
  m_nModelIndex = pAutomobile->m_nModelIndex;
  if ( m_nModelIndex > 524 )
  {
    v15 = m_nModelIndex - 525;
    if ( v15 > 6 || ((1 << v15) & 0x61) == 0 )
      goto LABEL_48;
  }
  else if ( m_nModelIndex != 406 )
  {
    v12 = m_nModelIndex == 443;
    if ( m_nModelIndex != 443 )
      v12 = m_nModelIndex == 486;
    if ( !v12 )
    {
LABEL_48:
      if ( CHID::GetInputType() == 1 )
        return (__int16)-this->NewState.RightStickY;
      goto LABEL_14;
    }
  }
  v16 = CTouchInterface::m_pWidgets[13];
  if ( !CTouchInterface::m_pWidgets[13] )
  {
LABEL_14:
    if ( bPoop == 1 && CHID::GetInputType() != 1 )
      goto LABEL_10;
    return (__int16)-this->NewState.RightStickY;
  }
  if ( CHID::GetInputType() != 1
    || (v17 = (CHIDJoystick *)CHID::m_pInstance[CHID::currentInstanceIndex]) == 0
    || (ButtonID = CHIDJoystick::GetButtonID(v17, HID_MAPPING_ATTACK),
        ButtonID != CHIDJoystick::GetButtonID(
                      (CHIDJoystick *)CHID::m_pInstance[CHID::currentInstanceIndex],
                      HID_MAPPING_AUTO_HYDRAULICS))
    || CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_LEFT, 0) && CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_RIGHT, 0)
    || !CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_LEFT, 0) && !CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_RIGHT, 0) )
  {
    if ( CTouchInterface::IsReleased(WIDGET_AUTO_HYDRAULICS, 0, 2) )
    {
      v19 = (void (__fastcall *)(CWidget *, _DWORD))*((_DWORD *)v16->_vptr$CWidget + 28);
      v20 = fLimit;
      if ( COERCE_FLOAT((*((int (__fastcall **)(CWidget *))v16->_vptr$CWidget + 7))(v16)) > 0.0 )
        v20 = 0.0;
      v19(v16, LODWORD(v20));
    }
  }
  m_nSuspensionHydraulics = pAutomobile->m_nSuspensionHydraulics;
  if ( (float)((float)(fLimit * 0.0) + (*((float (__fastcall **)(CWidget *))v16->_vptr$CWidget + 7))(v16)) >= (float)m_nSuspensionHydraulics )
  {
    v22 = pAutomobile->m_nSuspensionHydraulics;
    LOWORD(v9) = 0;
    if ( (float)((*((float (__fastcall **)(CWidget *))v16->_vptr$CWidget + 7))(v16) - (float)(fLimit * 0.0)) > (float)v22 )
      LOWORD(v9) = 128;
  }
  return (__int16)v9;
}

//----- (003FA070) --------------------------------------------------------
int16 __fastcall CPad::GetCarGunLeftRight(CPad *this, bool bCheckHydraulics, bool bPoop)
{
  _BOOL4 v4; // r8
  _BOOL4 v5; // r6
  int16 v6; // r5
  float m_fScaleY; // r0
  int v9; // r0

  v4 = bPoop;
  v5 = bCheckHydraulics;
  v6 = -128;
  if ( !this->bRhythm )
    goto LABEL_9;
  if ( !CHID::MappingIsAnalog(HID_MAPPING_RHYTHM_LEFT) )
  {
    if ( CTouchInterface::IsTouched(WIDGET_RHYTHM_LEFT, 0, 1) )
      return v6;
    if ( !CTouchInterface::IsTouched(WIDGET_RHYTHM_RIGHT, 0, 1) )
    {
LABEL_9:
      if ( this->DisablePlayerControls )
        return 0;
      if ( !v5 || !FindPlayerPed(-1) || !(*((unsigned __int8 *)&FindPlayerPed(-1)->m_nPedFlags + 1) << 31) )
        goto LABEL_13;
      if ( CHID::GetInputType() == 1 )
        return this->NewState.RightStickX;
      CTouchInterface::IsTouched(WIDGET_HYDRAULICS, 0, 2);
      if ( !CTouchInterface::m_pWidgets[12] )
        goto LABEL_13;
      m_fScaleY = CTouchInterface::m_pWidgets[12][1].m_fScaleY;
      if ( LODWORD(m_fScaleY) > 8 )
        goto LABEL_13;
      v9 = 1 << SLOBYTE(m_fScaleY);
      if ( (v9 & 0xA8) != 0 )
        return v6;
      if ( (v9 & 0x150) == 0 )
      {
LABEL_13:
        if ( v4 )
          return 0;
        return this->NewState.RightStickX;
      }
    }
    return 128;
  }
  if ( CHID::IsPressedPositive(HID_MAPPING_RHYTHM_LEFT) )
    return 128;
  if ( !CHID::IsPressedNegative(HID_MAPPING_RHYTHM_LEFT) )
    goto LABEL_9;
  return v6;
}

//----- (003FA138) --------------------------------------------------------
void __fastcall CPad::GetLeftAnalogue(CPad *this, CVector2D *pVecOut)
{
  CVector2D v4; // [sp+0h] [bp-10h] BYREF

  v4 = 0LL;
  if ( FindPlayerVehicle(-1, 0) || !CTouchInterface::IsTouched(WIDGET_PED_MOVE, &v4, 1) )
  {
    pVecOut->x = (float)this->NewState.LeftStickX;
    pVecOut->y = (float)this->NewState.LeftStickY;
  }
  else
  {
    *pVecOut = v4;
  }
}

//----- (003FA192) --------------------------------------------------------
void __fastcall CPad::GetRightAnalogue(CPad *this, CVector2D *pVecOut)
{
  int v4; // r6

  LOBYTE(v4) = 0;
  if ( FindPlayerVehicle(-1, 0) && !(*(_BYTE *)&FindPlayerVehicle(-1, 0)->m_info << 29) )
    v4 = (BYTE2(FindPlayerVehicle(-1, 0)->hFlagsLocal) >> 1) & 1;
  pVecOut->x = (float)CPad::GetCarGunLeftRight(this, v4, 0);
  pVecOut->y = (float)CPad::GetCarGunUpDown(this, v4, 0, 2500.0, 0);
}

//----- (003FA218) --------------------------------------------------------
int16 __fastcall CPad::GetPedWalkLeftRight(CPad *this)
{
  int v2; // r1
  _BOOL4 v4; // r0
  float x; // s0
  CVector2D v6; // [sp+0h] [bp-10h] BYREF

  if ( this->DisablePlayerControls || this->bUsingDebugPlayerFreeze )
  {
    LOWORD(v2) = 0;
  }
  else
  {
    v4 = CCamera::Using1stPersonWeaponMode(&TheCamera);
    LOWORD(v2) = 0;
    if ( !v4 )
    {
      v6.x = 0.0;
      v6.y = 0.0;
      if ( CTouchInterface::IsTouched(WIDGET_PED_MOVE, &v6, 1) )
      {
        x = v6.x;
        if ( fabsf(v6.x) > 64.0 )
        {
          CWidgetHelpText::ConditionSatisfied(4u);
          return (int)v6.x;
        }
        return (int)x;
      }
      else if ( CHID::GetInputType() )
      {
        LOWORD(v2) = 0;
      }
      else
      {
        LOWORD(v2) = this->NewState.LeftStickX;
      }
    }
  }
  return v2;
}
// 3FA218: using guessed type CVector2D var_10;

//----- (003FA298) --------------------------------------------------------
int16 __fastcall CPad::GetPedWalkUpDown(CPad *this)
{
  int v2; // r1
  _BOOL4 v4; // r0
  float y; // s0
  CVector2D v6; // [sp+0h] [bp-10h] BYREF

  if ( this->DisablePlayerControls || this->bUsingDebugPlayerFreeze )
  {
    LOWORD(v2) = 0;
  }
  else
  {
    v4 = CCamera::Using1stPersonWeaponMode(&TheCamera);
    LOWORD(v2) = 0;
    if ( !v4 )
    {
      v6.x = 0.0;
      v6.y = 0.0;
      if ( CTouchInterface::IsTouched(WIDGET_PED_MOVE, &v6, 1) )
      {
        y = v6.y;
        if ( fabsf(v6.y) > 64.0 )
        {
          CWidgetHelpText::ConditionSatisfied(4u);
          return (int)v6.y;
        }
        return (int)y;
      }
      else if ( CHID::GetInputType() )
      {
        LOWORD(v2) = 0;
      }
      else
      {
        LOWORD(v2) = this->NewState.LeftStickY;
      }
    }
  }
  return v2;
}

//----- (003FA318) --------------------------------------------------------
bool __fastcall CPad::GetLookLeft(CPad *this, bool bCheckWidget)
{
  _BOOL4 v3; // r6
  bool v4; // r5
  CPlayerPed *PlayerPed; // r0
  int bHasJetPack; // r1
  CPlayerPed *v7; // r0

  v3 = bCheckWidget;
  v4 = 0;
  if ( this->DisablePlayerControls || (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
    return v4;
  PlayerPed = FindPlayerPed(-1);
  bHasJetPack = this->bHasJetPack;
  if ( this->bHasJetPack || !v3 )
    return bHasJetPack && CHID::GetInputType() != 2 && CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_LEFT, 0);
  if ( (CWeaponInfo::GetWeaponInfo(PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType, 1)->m_nWeaponSlot != 4
     || !FindPlayerPed(-1)
     || (v7 = FindPlayerPed(-1), v7->m_WeaponSlots[v7->m_nCurrentWeapon].m_nAmmoTotal <= 0))
    && !CHID::Implements(HID_MAPPING_VEHICLE_LOOK_LEFT)
    || (v4 = 1, !CTouchInterface::IsTouched(WIDGET_VEHICLE_SHOOT_LEFT, 0, 1)) )
  {
    bHasJetPack = this->bHasJetPack;
    return bHasJetPack && CHID::GetInputType() != 2 && CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_LEFT, 0);
  }
  return v4;
}

//----- (003FA3DC) --------------------------------------------------------
bool __fastcall CPad::GetLookRight(CPad *this, bool bCheckWidget)
{
  _BOOL4 v3; // r6
  bool v4; // r5
  CPlayerPed *PlayerPed; // r0
  int bHasJetPack; // r1
  CPlayerPed *v7; // r0

  v3 = bCheckWidget;
  v4 = 0;
  if ( this->DisablePlayerControls || (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
    return v4;
  PlayerPed = FindPlayerPed(-1);
  bHasJetPack = this->bHasJetPack;
  if ( this->bHasJetPack || !v3 )
    return bHasJetPack && CHID::GetInputType() != 2 && CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_RIGHT, 0);
  if ( (CWeaponInfo::GetWeaponInfo(PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType, 1)->m_nWeaponSlot != 4
     || !FindPlayerPed(-1)
     || (v7 = FindPlayerPed(-1), v7->m_WeaponSlots[v7->m_nCurrentWeapon].m_nAmmoTotal <= 0))
    && !CHID::Implements(HID_MAPPING_VEHICLE_LOOK_RIGHT)
    || (v4 = 1, !CTouchInterface::IsTouched(WIDGET_VEHICLE_SHOOT_RIGHT, 0, 1)) )
  {
    bHasJetPack = this->bHasJetPack;
    return bHasJetPack && CHID::GetInputType() != 2 && CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_RIGHT, 0);
  }
  return v4;
}

//----- (003FA4A0) --------------------------------------------------------
bool __fastcall CPad::GetTurretLeft(CPad *this)
{
  return !this->DisablePlayerControls && sub_19C350(WIDGET_VEHICLE_TURRET_LEFT, 0, 1);
}

//----- (003FA4B6) --------------------------------------------------------
bool __fastcall CPad::GetTurretRight(CPad *this)
{
  return !this->DisablePlayerControls && sub_19C350(WIDGET_VEHICLE_TURRET_RIGHT, 0, 1);
}

//----- (003FA4CC) --------------------------------------------------------
bool __fastcall CPad::GetJetpackHover(CPad *this)
{
  bool v2; // r4

  if ( this->DisablePlayerControls || !this->bHasJetPack )
    return 0;
  if ( CHID::GetInputType() || (v2 = 1, !CTouchInterface::IsHeldDown(WIDGET_LOOK, 1)) )
  {
    if ( !CTouchInterface::IsTouched(WIDGET_ACCELERATE, 0, 1)
      || (v2 = 1, !CTouchInterface::IsTouched(WIDGET_BRAKE, 0, 1)) )
    {
      if ( CHID::IsPressed(HID_MAPPING_FLIGHT_ASCEND, 0) && CHID::IsPressed(HID_MAPPING_FLIGHT_DESCEND, 0) )
      {
        return 1;
      }
      else
      {
        v2 = 0;
        if ( CHID::IsPressed(HID_MAPPING_VEHICLE_LOOK_LEFT, 0) )
          return sub_196BD4(HID_MAPPING_VEHICLE_LOOK_RIGHT, 0);
      }
    }
  }
  return v2;
}

//----- (003FA54A) --------------------------------------------------------
bool __fastcall CPad::GetLookBehindForCar(CPad *this)
{
  return !this->DisablePlayerControls
      && (!FindPlayerPed(-1) || *((unsigned __int8 *)&FindPlayerPed(-1)->m_nPedFlags + 1) << 31)
      && sub_18F128(WIDGET_LOOK, 1);
}

//----- (003FA57E) --------------------------------------------------------
bool __fastcall CPad::GetLookBehindForPed(CPad *this)
{
  return !this->DisablePlayerControls && (!this->bHasJetPack || CHID::GetInputType()) && sub_18F128(WIDGET_LOOK, 1);
}

//----- (003FA5A8) --------------------------------------------------------
int DisableHorn()
{
  int v0; // r5
  CVehicle *PlayerVehicle; // r4
  unsigned int m_vehicleType; // r0
  CPlayerPed *PlayerPed; // r0

  v0 = 0;
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  if ( PlayerVehicle )
  {
    if ( !FindPlayerPed(-1)->m_pMyVehicle
      || ((m_vehicleType = PlayerVehicle->m_vehicleType, m_vehicleType > 6) || ((1 << m_vehicleType) & 0x58) == 0)
      && m_vehicleType != 5 )
    {
      if ( !CWorld::Players[0].pRemoteVehicle )
      {
        PlayerPed = FindPlayerPed(-1);
        if ( CVehicle::IsDriver(PlayerVehicle, PlayerPed) )
          return 0;
      }
    }
    return 1;
  }
  return v0;
}

//----- (003FA618) --------------------------------------------------------
bool __fastcall CPad::GetHorn(CPad *this, bool bEnableTouch)
{
  bool v2; // zf
  bool result; // r0
  CVehicle *PlayerVehicle; // r4
  unsigned int m_vehicleType; // r0
  CPlayerPed *PlayerPed; // r0

  v2 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v2 = this->bRhythm == 0;
  result = v2
        && ((PlayerVehicle = FindPlayerVehicle(-1, 0)) == 0
         || (!FindPlayerPed(-1)->m_pMyVehicle
          || ((m_vehicleType = PlayerVehicle->m_vehicleType, m_vehicleType > 6) || ((1 << m_vehicleType) & 0x58) == 0)
          && m_vehicleType != 5)
         && !CWorld::Players[0].pRemoteVehicle
         && (PlayerPed = FindPlayerPed(-1), CVehicle::IsDriver(PlayerVehicle, PlayerPed)))
        && sub_19C350(WIDGET_HORN, 0, 2);
  return result;
}

//----- (003FA6A0) --------------------------------------------------------
bool __fastcall CPad::HornJustDown(CPad *this)
{
  bool v1; // zf
  bool result; // r0
  CVehicle *PlayerVehicle; // r4
  unsigned int m_vehicleType; // r0
  CPlayerPed *PlayerPed; // r0

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bRhythm == 0;
  result = v1
        && ((PlayerVehicle = FindPlayerVehicle(-1, 0)) == 0
         || (!FindPlayerPed(-1)->m_pMyVehicle
          || ((m_vehicleType = PlayerVehicle->m_vehicleType, m_vehicleType > 6) || ((1 << m_vehicleType) & 0x58) == 0)
          && m_vehicleType != 5)
         && !CWorld::Players[0].pRemoteVehicle
         && (PlayerPed = FindPlayerPed(-1), CVehicle::IsDriver(PlayerVehicle, PlayerPed)))
        && sub_18D4C0(WIDGET_HORN, 0, 1);
  return result;
}

//----- (003FA728) --------------------------------------------------------
bool __fastcall CPad::GetHydraulicJump(CPad *this)
{
  return !this->DisablePlayerControls && sub_18D4C0(WIDGET_HYDRAULICS, 0, 1);
}

//----- (003FA73E) --------------------------------------------------------
int16 __fastcall CPad::GetNitroFired(CPad *this)
{
  bool v1; // zf

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bRhythm == 0;
  return v1 && CTouchInterface::IsTouched(WIDGET_NITRO, 0, 1);
}

//----- (003FA762) --------------------------------------------------------
int16 __fastcall CPad::CarGunJustDown(CPad *this)
{
  return !this->DisablePlayerControls && CTouchInterface::IsTouched(WIDGET_CAR_SHOOT, 0, 1);
}

//----- (003FA77E) --------------------------------------------------------
bool __fastcall CPad::FlareJustDown(CPad *this)
{
  return !this->DisablePlayerControls && sub_196BD4(HID_MAPPING_FLIGHT_PRIMARY_ATTACK, 0);
}

//----- (003FA792) --------------------------------------------------------
int16 __fastcall CPad::CraneReleaseJustDown(CPad *this)
{
  return !this->DisablePlayerControls && CTouchInterface::IsReleased(WIDGET_DROP_CRANE, 0, 2);
}

//----- (003FA7AE) --------------------------------------------------------
bool __fastcall CPad::UseBomb(CPad *this)
{
  return !this->DisablePlayerControls && sub_18D4C0(WIDGET_VEHICLE_BOMB, 0, 1);
}

//----- (003FA7C4) --------------------------------------------------------
bool __fastcall CPad::UseRocket(CPad *this)
{
  return !this->DisablePlayerControls && sub_18D4C0(WIDGET_ROCKET, 0, 1);
}

//----- (003FA7E0) --------------------------------------------------------
int16 __fastcall CPad::GetHandBrake(CPad *this)
{
  int16 v2; // r5
  CVehicle *PlayerVehicle; // r0
  CVehicle *v5; // r0
  float v6; // s16
  char hFlagsLocal; // r0
  _BOOL4 v8; // r6
  CVehicle *v9; // r0
  bool v10; // zf
  CVector v11; // [sp+4h] [bp-2Ch] BYREF
  CVector v12; // 0:r2.8,8:^0.4

  v2 = 0;
  if ( this->DisablePlayerControls )
    return v2;
  if ( !FindPlayerVehicle(-1, 0) )
    return v2;
  v2 = 0;
  if ( this->bRhythm )
    return v2;
  if ( (*((_BYTE *)&FindPlayerVehicle(-1, 0)->m_nVehicleFlags + 3) & 0x40) != 0 )
  {
    CTouchInterface::IsTouched(WIDGET_HANDBRAKE, 0, 1);
LABEL_14:
    *(_WORD *)&this->bApplyGas = 0;
    bUsingOverride = 0;
    return v2;
  }
  v2 = 0;
  if ( FindPlayerVehicle(-1, 0)->m_vehicleType == 4 )
    return v2;
  v2 = 0;
  if ( FindPlayerVehicle(-1, 0)->m_vehicleType == 3 )
    return v2;
  if ( !CTouchInterface::IsTouched(WIDGET_HANDBRAKE, 0, 1) )
  {
    v2 = 0;
    if ( bUsingOverride != 1 )
      return v2;
    goto LABEL_14;
  }
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  *(_QWORD *)&v12.x = 0LL;
  v12.z = 0.0;
  CPhysical::GetSpeed(&v11, PlayerVehicle, v12);
  v5 = FindPlayerVehicle(-1, 0);
  v6 = (float)((float)((float)(v11.x * v5->m_pMat->xy) + (float)(v11.y * v5->m_pMat->yy))
             + (float)(v11.z * v5->m_pMat->zy))
     / 0.0055556;
  hFlagsLocal = FindPlayerVehicle(-1, 0)->hFlagsLocal;
  if ( fabsf(v6) < 0.42 )
    v6 = 0.0;
  v8 = (hFlagsLocal & 0x40) == 0
    || mod_HandlingManager.m_aHandlingData[FindPlayerVehicle(-1, 0)->pHandling->nVehicleID].Transmission.m_nDriveType == 82;
  v9 = FindPlayerVehicle(-1, 0);
  v2 = 255;
  v10 = v6 == 0.0;
  if ( v6 == 0.0 )
    v10 = v8;
  if ( v10 && v9->m_vehicleType != 10 )
  {
    *(_WORD *)&this->bApplyGas = 257;
    v2 = 0;
    bUsingOverride = 1;
  }
  return v2;
}
// 959E19: using guessed type char bUsingOverride;

//----- (003FA9AC) --------------------------------------------------------
int16 __fastcall CPad::GetBrake(CPad *this)
{
  int DisablePlayerControls; // r0
  bool v3; // zf
  int v4; // r0
  _BOOL4 IsTouched; // r0
  bool v6; // zf
  float pfValueOut[3]; // [sp+4h] [bp-Ch] BYREF

  DisablePlayerControls = this->DisablePlayerControls;
  v3 = DisablePlayerControls == 0;
  if ( !DisablePlayerControls )
    v3 = this->bTrainPassenger == 0;
  if ( !v3 )
    goto LABEL_4;
  LOWORD(v4) = 0;
  if ( this->bRhythm )
    return v4;
  pfValueOut[0] = 0.0;
  if ( CHID::IsPressed(HID_MAPPING_BRAKE, pfValueOut) )
  {
    return (int)(float)(pfValueOut[0] * 255.0);
  }
  else
  {
    IsTouched = CTouchInterface::IsTouched(WIDGET_BRAKE, 0, 1);
    v6 = !IsTouched;
    if ( !IsTouched )
      v6 = this->bApplyBrake == 0;
    if ( v6 )
    {
      if ( CHID::GetInputType() || !this->NewState.ButtonSquare )
      {
LABEL_4:
        LOWORD(v4) = 0;
        return v4;
      }
    }
    else
    {
      CWidgetHelpText::ConditionSatisfied(8u);
    }
    LOWORD(v4) = 255;
  }
  return v4;
}
// 3FA9AC: using guessed type float pfValueOut[3];

//----- (003FAA30) --------------------------------------------------------
bool __fastcall CPad::GetExitVehicle(CPad *this)
{
  bool v1; // zf
  bool v3; // zf

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bDisablePlayerEnterCar == 0;
  if ( !v1 )
    return 0;
  v3 = this->bRhythm == 0;
  if ( !this->bRhythm )
    v3 = this->bDoorsLocked == 0;
  return v3
      && (!CTouchInterface::m_pWidgets[14] || !CWidget::GetEnabled(CTouchInterface::m_pWidgets[14]))
      && sub_19C350(WIDGET_ENTER_CAR, 0, 1);
}

//----- (003FAA7C) --------------------------------------------------------
int __fastcall CPad::ExitVehicleJustDown(
        CPad *this,
        int bCheckTouch,
        CVehicle *pVehicle,
        bool bEntering,
        const CVector *vecVehicle)
{
  int v8; // r6
  int m_vehicleType; // r1
  int m_nModelIndex; // r6
  int hFlagsLocal; // r2

  if ( this->DisablePlayerControls || this->bDisablePlayerEnterCar || this->bRhythm || this->bDoorsLocked )
    return 0;
  if ( CTouchInterface::m_pWidgets[14] )
  {
    v8 = 0;
    if ( CWidget::GetEnabled(CTouchInterface::m_pWidgets[14]) || !bCheckTouch )
      return v8;
  }
  else if ( bCheckTouch != 1 )
  {
    return 0;
  }
  if ( pVehicle )
    m_vehicleType = pVehicle->m_vehicleType;
  else
    m_vehicleType = -1;
  if ( CWorld::Players[0].pRemoteVehicle )
    m_vehicleType = CWorld::Players[0].pRemoteVehicle->m_vehicleType;
  if ( CTouchInterface::m_pWidgets[0] )
  {
    if ( pVehicle )
    {
      m_nModelIndex = pVehicle->m_nModelIndex;
      hFlagsLocal = pVehicle->hFlagsLocal;
    }
    else
    {
      m_nModelIndex = -1;
      hFlagsLocal = 0;
    }
    CWidgetButtonEnterCar::SetEnterCarVehicleType(
      (CWidgetButtonEnterCar *)CTouchInterface::m_pWidgets[0],
      m_vehicleType,
      hFlagsLocal,
      bEntering,
      &vecVehicle->x,
      m_nModelIndex);
  }
  v8 = 0;
  if ( CTouchInterface::IsReleased(WIDGET_ENTER_CAR, 0, 1) )
  {
    v8 = 1;
    CWidgetHelpText::ConditionSatisfied(1u);
  }
  return v8;
}

//----- (003FAB38) --------------------------------------------------------
bool __fastcall CPad::DropItemJustDown(CPad *this)
{
  bool v1; // zf

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bDisablePlayerEnterCar == 0;
  return v1 && sub_18D4C0(WIDGET_DROP_ITEM, 0, 1);
}

//----- (003FAB56) --------------------------------------------------------
bool PlayerIsEnteringCar()
{
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v2; // r0

  if ( !FindPlayerPed(-1) )
    return 0;
  PlayerPed = FindPlayerPed(-1);
  if ( CTaskManager::FindActiveTaskByType(&PlayerPed->m_pPedIntelligence->m_taskManager, 701) )
    return 1;
  v2 = FindPlayerPed(-1);
  return CTaskManager::FindActiveTaskByType(&v2->m_pPedIntelligence->m_taskManager, 700) != 0;
}

//----- (003FABA8) --------------------------------------------------------
Int32 __fastcall CPad::GetWeapon(CPad *this, CPed *pPed, bool bShoulderPossible)
{
  bool v4; // zf
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v7; // r0
  CTask *ActiveTaskByType; // r0
  int v9; // r5
  unsigned __int32 v10; // r0
  int v11; // r1
  CTask *v12; // r0
  _BOOL4 IsTouched; // r4
  CPlayerPed *v14; // r0
  unsigned int v15; // r0
  CPlayerPed *v16; // r0
  unsigned int v17; // r0
  _BOOL4 IsReleased; // r4
  _BOOL4 v19; // r0
  CPlayerPed *v20; // r0
  unsigned int v21; // r0
  _BOOL4 v22; // r0
  _BOOL4 v23; // r4
  CPlayerPed *v24; // r0
  unsigned int v25; // r0
  _BOOL4 v26; // r0

  v4 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v4 = this->bDisablePlayerFireWeapon == 0;
  if ( !v4 )
    return 0;
  if ( FindPlayerPed(-1) )
  {
    PlayerPed = FindPlayerPed(-1);
    if ( CTaskManager::FindActiveTaskByType(&PlayerPed->m_pPedIntelligence->m_taskManager, 701) )
      return 0;
    v7 = FindPlayerPed(-1);
    ActiveTaskByType = CTaskManager::FindActiveTaskByType(&v7->m_pPedIntelligence->m_taskManager, 700);
    if ( !pPed || ActiveTaskByType )
      return 0;
  }
  else if ( !pPed )
  {
    return 0;
  }
  v9 = 0;
  v10 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType - 16;
  if ( v10 <= 0x1D )
  {
    v11 = 1;
    if ( ((1 << v10) & 0x6A00007) != 0 )
    {
LABEL_15:
      v9 = v11;
      goto LABEL_16;
    }
    if ( ((1 << v10) & 0x31000000) != 0 )
    {
      v11 = 2;
      goto LABEL_15;
    }
  }
LABEL_16:
  v12 = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 307);
  if ( v9 && !v12 )
  {
    if ( v9 == 2 )
    {
      if ( CTouchInterface::IsReleased(WIDGET_ATTACK, 0, 1) )
        return 255;
    }
    else if ( CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1) )
    {
      return 255;
    }
    return 0;
  }
  if ( !CCamera::IsTargetingActive(&TheCamera) )
    return 0;
  if ( MobileSettings::IsLockOnMode() || CHID::GetInputType() == 1 )
  {
    if ( !pPed->m_pEntLockOnTarget
      && FindPlayerPed(-1)
      && (v14 = FindPlayerPed(-1), v15 = v14->m_WeaponSlots[v14->m_nCurrentWeapon].m_eWeaponType - 33, v15 <= 0xC)
      && ((1 << v15) & 0x1C0F) != 0 )
    {
      if ( !FindPlayerPed(-1) )
        return 0;
      v16 = FindPlayerPed(-1);
      v17 = v16->m_WeaponSlots[v16->m_nCurrentWeapon].m_eWeaponType - 33;
      if ( v17 > 0xC || ((1 << v17) & 0x1C0F) == 0 )
        return 0;
      IsReleased = CTouchInterface::IsReleased(WIDGET_VC_SHOOT, 0, 1);
      v19 = CTouchInterface::IsReleased(WIDGET_VC_SHOOT_ALT, 0, 1);
      if ( IsReleased )
        return 255;
    }
    else
    {
      if ( CPedIntelligence::GetTaskJetPack(pPed->m_pPedIntelligence) )
        IsTouched = CTouchInterface::IsTouched(WIDGET_VC_SHOOT_ALT, 0, 1);
      else
        IsTouched = 0;
      v19 = CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1);
      if ( IsTouched )
        return 255;
    }
    if ( !v19 )
      return 0;
  }
  else
  {
    if ( MobileSettings::IsFreeAimMode() != 1 )
      return 0;
    if ( FindPlayerPed(-1)
      && (v20 = FindPlayerPed(-1), v21 = v20->m_WeaponSlots[v20->m_nCurrentWeapon].m_eWeaponType - 33, v21 <= 0xC)
      && ((1 << v21) & 0x1C0F) != 0 )
    {
      v22 = CTouchInterface::IsReleased(WIDGET_VC_SHOOT, 0, 1);
    }
    else
    {
      v22 = CTouchInterface::IsTouched(WIDGET_VC_SHOOT, 0, 1);
    }
    v23 = v22;
    if ( FindPlayerPed(-1)
      && (v24 = FindPlayerPed(-1), v25 = v24->m_WeaponSlots[v24->m_nCurrentWeapon].m_eWeaponType - 33, v25 <= 0xC)
      && ((1 << v25) & 0x1C0F) != 0 )
    {
      v26 = CTouchInterface::IsReleased(WIDGET_VC_SHOOT_ALT, 0, 1);
    }
    else
    {
      v26 = CTouchInterface::IsTouched(WIDGET_VC_SHOOT_ALT, 0, 1);
    }
    if ( !v26 && !v23 )
      return 0;
  }
  return 255;
}
// 3FAC5E: conditional instruction was optimized away because r5.4==1

//----- (003FAE28) --------------------------------------------------------
int __fastcall CPad::WeaponUsesAttackButton(CPed *pPlayerPed)
{
  int result; // r0
  unsigned __int32 v2; // r1
  int v3; // r2

  if ( !pPlayerPed )
    return 0;
  v2 = pPlayerPed->m_WeaponSlots[pPlayerPed->m_nCurrentWeapon].m_eWeaponType - 16;
  result = 0;
  if ( v2 <= 0x1D )
  {
    v3 = 1;
    if ( ((1 << v2) & 0x6A00007) == 0 )
    {
      if ( ((1 << v2) & 0x31000000) == 0 )
        return result;
      return 2;
    }
    return v3;
  }
  return result;
}

//----- (003FAE70) --------------------------------------------------------
unsigned int CPad::WeaponUsesTargetingButton()
{
  CPlayerPed *PlayerPed; // r0
  unsigned int v1; // r0

  if ( FindPlayerPed(-1)
    && (PlayerPed = FindPlayerPed(-1),
        v1 = PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType - 33,
        v1 <= 0xC) )
  {
    return (0x1C0Fu >> v1) & 1;
  }
  else
  {
    return 0;
  }
}

//----- (003FAEB4) --------------------------------------------------------
bool __fastcall CPad::WeaponJustDown(CPad *this, CPed *pPed, bool bShoulderPossible, bool bEnableTouch)
{
  _BOOL4 v5; // r6
  bool v6; // r5
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v9; // r0
  CPlayerPed *v10; // r0
  int v11; // r5
  unsigned __int32 v12; // r0
  int v13; // r1
  CTask *ActiveTaskByType; // r0
  _BOOL4 IsTouched; // r0
  _BOOL4 IsReleased; // r4
  _BOOL4 v17; // r0

  v5 = bEnableTouch;
  if ( this->DisablePlayerControls )
    return 0;
  if ( this->bDisablePlayerFireWeapon )
    return 0;
  if ( FindPlayerPed(-1) )
  {
    PlayerPed = FindPlayerPed(-1);
    if ( CTaskManager::FindActiveTaskByType(&PlayerPed->m_pPedIntelligence->m_taskManager, 701) )
      return 0;
    v9 = FindPlayerPed(-1);
    if ( CTaskManager::FindActiveTaskByType(&v9->m_pPedIntelligence->m_taskManager, 700) )
      return 0;
  }
  if ( !FindPlayerPed(-1) )
  {
    if ( v5 )
      goto LABEL_13;
    return 0;
  }
  v10 = FindPlayerPed(-1);
  v6 = 0;
  if ( CPedIntelligence::GetUsingParachute(v10->m_pPedIntelligence) || !v5 )
    return v6;
LABEL_13:
  if ( !pPed )
  {
    v11 = 0;
    goto LABEL_20;
  }
  v11 = 0;
  v12 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType - 16;
  if ( v12 <= 0x1D )
  {
    v13 = 1;
    if ( ((1 << v12) & 0x6A00007) != 0 )
    {
LABEL_18:
      v11 = v13;
      goto LABEL_20;
    }
    if ( ((1 << v12) & 0x31000000) != 0 )
    {
      v13 = 2;
      goto LABEL_18;
    }
  }
LABEL_20:
  ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 307);
  if ( !v11 || ActiveTaskByType )
  {
    v6 = 0;
    if ( CCamera::IsTargetingActive(&TheCamera) )
    {
      IsReleased = CTouchInterface::IsReleased(WIDGET_VC_SHOOT, 0, 1);
      v17 = CTouchInterface::IsReleased(WIDGET_VC_SHOOT_ALT, 0, 1);
      if ( IsReleased || v17 )
        return 1;
    }
  }
  else
  {
    if ( v11 == 2 )
    {
      v6 = 0;
      IsTouched = CTouchInterface::IsReleased(WIDGET_ATTACK, 0, 1);
    }
    else
    {
      v6 = 0;
      IsTouched = CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1);
    }
    if ( IsTouched )
      return 1;
  }
  return v6;
}
// 3FAF94: conditional instruction was optimized away because r5.4==1

//----- (003FAFF0) --------------------------------------------------------
Int8 __fastcall CPad::GetMeleeAttack(CPad *this)
{
  return !this->DisablePlayerControls && CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1);
}

//----- (003FB00C) --------------------------------------------------------
Int8 __fastcall CPad::MeleeAttackJustDown(CPad *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d2
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v6; // r0
  CPlayerPed *v7; // r0
  eWeaponType m_eWeaponType; // r0
  bool v9; // zf
  Int8 v10; // r4
  CPlayerPed *v11; // r0
  int *v12; // r2

  if ( this->DisablePlayerControls )
    return 0;
  if ( FindPlayerPed(-1) )
  {
    PlayerPed = FindPlayerPed(-1);
    if ( CTaskManager::FindActiveTaskByType(&PlayerPed->m_pPedIntelligence->m_taskManager, 701) )
      return 0;
    v6 = FindPlayerPed(-1);
    if ( CTaskManager::FindActiveTaskByType(&v6->m_pPedIntelligence->m_taskManager, 700) )
      return 0;
  }
  if ( FindPlayerPed(-1) )
  {
    v7 = FindPlayerPed(-1);
    m_eWeaponType = v7->m_WeaponSlots[v7->m_nCurrentWeapon].m_eWeaponType;
    v9 = m_eWeaponType == WEAPONTYPE_CHAINSAW;
    if ( m_eWeaponType == WEAPONTYPE_CHAINSAW )
      v9 = this->DisablePlayerControls == 0;
    if ( v9
      && (!((CTimer::m_UserPause | this->bDisablePlayerCycleWeapon | CTimer::m_CodePause) << 24)
       && CTouchInterface::m_pWidgets[160]
       && CTouchInterface::m_pWidgets[160]->m_fTapHoldTime < CTouchInterface::m_pWidgets[160]->m_fHoldEffectPeriod
       && CWidgetPlayerInfo::PassesDisplayConditions((CWidgetPlayerInfo *)CTouchInterface::m_pWidgets[160])
       && CTouchInterface::IsSwipedLeft(WIDGET_PLAYER_INFO, 1)
       || !this->DisablePlayerControls
       && !((CTimer::m_UserPause | this->bDisablePlayerCycleWeapon | CTimer::m_CodePause) << 24)
       && CTouchInterface::m_pWidgets[160]
       && CTouchInterface::m_pWidgets[160]->m_fTapHoldTime < CTouchInterface::m_pWidgets[160]->m_fHoldEffectPeriod
       && CWidgetPlayerInfo::PassesDisplayConditions((CWidgetPlayerInfo *)CTouchInterface::m_pWidgets[160])
       && CTouchInterface::IsSwipedRight(WIDGET_PLAYER_INFO, 1)) )
    {
      v11 = FindPlayerPed(-1);
      v12 = dword_3FB21C;
      if ( (*((_WORD *)v11->m_pPlayerData + 26) & 1) != 0 )
        v12 = &dword_3FB21C[1];
      v1.n64_u32[0] = *v12;
      LODWORD(fStopAttackTimer) = *v12;
      goto LABEL_11;
    }
  }
  v1.n64_f32[0] = fStopAttackTimer;
  if ( fStopAttackTimer > 0.0 )
  {
LABEL_11:
    v1.n64_f32[0] = v1.n64_f32[0] + (float)(CTimer::ms_fTimeStep / -50.0);
    v2.n64_u32[0] = 0;
    LODWORD(fStopAttackTimer) = vmax_f32(v1, v2).n64_u32[0];
    CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1);
    return 0;
  }
  v10 = 1;
  if ( !CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1) )
  {
    if ( !CHID::GetInputType() && CTouchInterface::IsDoubleTapped(WIDGET_ATTACK, 1, 1)
      || (v10 = 0, CHID::GetInputType() == 1)
      && CTouchInterface::IsTouched(WIDGET_ENTER_TARGETING, 0, 1)
      && (v10 = 0, CHID::IsPressed(HID_MAPPING_ALT_ATTACK, 0)) )
    {
      CTouchInterface::ClearTapHistory(WIDGET_ATTACK);
      return 2;
    }
  }
  return v10;
}
// 3FB0C0: variable 'v1' is possibly undefined
// 3FB0C0: variable 'v2' is possibly undefined
// 3FB21C: using guessed type int dword_3FB21C[2];

//----- (003FB238) --------------------------------------------------------
bool __fastcall CPad::CycleWeaponLeftJustDown(CPad *this)
{
  return !this->DisablePlayerControls
      && !((this->bDisablePlayerCycleWeapon | CTimer::m_UserPause | CTimer::m_CodePause) << 24)
      && CTouchInterface::m_pWidgets[160]
      && CTouchInterface::m_pWidgets[160]->m_fTapHoldTime < CTouchInterface::m_pWidgets[160]->m_fHoldEffectPeriod
      && CWidgetPlayerInfo::PassesDisplayConditions((CWidgetPlayerInfo *)CTouchInterface::m_pWidgets[160])
      && CTouchInterface::IsSwipedLeft(WIDGET_PLAYER_INFO, 1);
}

//----- (003FB2AC) --------------------------------------------------------
bool __fastcall CPad::CycleWeaponRightJustDown(CPad *this)
{
  return !this->DisablePlayerControls
      && !((this->bDisablePlayerCycleWeapon | CTimer::m_UserPause | CTimer::m_CodePause) << 24)
      && CTouchInterface::m_pWidgets[160]
      && CTouchInterface::m_pWidgets[160]->m_fTapHoldTime < CTouchInterface::m_pWidgets[160]->m_fHoldEffectPeriod
      && CWidgetPlayerInfo::PassesDisplayConditions((CWidgetPlayerInfo *)CTouchInterface::m_pWidgets[160])
      && CTouchInterface::IsSwipedRight(WIDGET_PLAYER_INFO, 1);
}

//----- (003FB320) --------------------------------------------------------
bool __fastcall CPad::GetBlock(CPad *this)
{
  return CHID::GetInputType() == 1
      && CTouchInterface::IsTouched(WIDGET_ENTER_TARGETING, 0, 1)
      && CHID::IsPressed(HID_MAPPING_BLOCK, 0);
}

//----- (003FB350) --------------------------------------------------------
int16 __fastcall CPad::GetAccelerate(CPad *this)
{
  int DisablePlayerControls; // r0
  bool v3; // zf
  int v4; // r0
  int32 m_vehicleType; // r0
  bool v6; // zf
  float pfValueOut[3]; // [sp+4h] [bp-Ch] BYREF

  DisablePlayerControls = this->DisablePlayerControls;
  v3 = DisablePlayerControls == 0;
  if ( !DisablePlayerControls )
    v3 = this->bTrainPassenger == 0;
  if ( !v3 )
    goto LABEL_4;
  LOWORD(v4) = 0;
  if ( this->bRhythm )
    return v4;
  pfValueOut[0] = 0.0;
  if ( CHID::IsPressed(HID_MAPPING_ACCELERATE, pfValueOut) )
  {
    return (int)(float)(pfValueOut[0] * 255.0);
  }
  else
  {
    if ( CTouchInterface::IsTouched(WIDGET_ACCELERATE, 0, 1) || CTouchInterface::IsTouched(WIDGET_DRIVE_HYBRID, 0, 1) )
      goto LABEL_11;
    if ( !FindPlayerVehicle(-1, 0) )
      goto LABEL_24;
    m_vehicleType = FindPlayerVehicle(-1, 0)->m_vehicleType;
    v6 = m_vehicleType == 4;
    if ( m_vehicleType != 4 )
      v6 = this->bApplyGas == 0;
    if ( !v6 )
    {
LABEL_11:
      CWidgetHelpText::ConditionSatisfied(2u);
    }
    else
    {
LABEL_24:
      if ( CHID::GetInputType() || !this->NewState.ButtonCross )
      {
LABEL_4:
        LOWORD(v4) = 0;
        return v4;
      }
    }
    LOWORD(v4) = 255;
  }
  return v4;
}
// 3FB350: using guessed type float pfValueOut[3];

//----- (003FB400) --------------------------------------------------------
bool __fastcall CPad::GetAccelerateJustDown(CPad *this)
{
  if ( this->DisablePlayerControls )
    return 0;
  if ( CTouchInterface::IsReleased(WIDGET_ACCELERATE, 0, 1) )
    return 1;
  return sub_18D4C0(WIDGET_DRIVE_HYBRID, 0, 1);
}

//----- (003FB430) --------------------------------------------------------
bool __fastcall CPad::CycleCameraModeDownJustDown(CPad *this)
{
  return sub_18D4C0(WIDGET_CAM_TOGGLE, 0, 1);
}

//----- (003FB43A) --------------------------------------------------------
bool __fastcall CPad::NextStationJustUp(CPad *this)
{
  return !this->DisablePlayerControls && sub_195EE4(WIDGET_SWIPE_RADIO, 1);
}

//----- (003FB44E) --------------------------------------------------------
bool __fastcall CPad::LastStationJustUp(CPad *this)
{
  return !this->DisablePlayerControls && sub_18A7CC(WIDGET_SWIPE_RADIO, 1);
}

//----- (003FB464) --------------------------------------------------------
bool __fastcall CPad::WillBulletHitSomething(CPed *pPed)
{
  CWeaponInfo *WeaponInfo; // r0
  CColPoint colPoint; // [sp+24h] [bp-6Ch] BYREF
  CEntity *refEntityPtr; // [sp+50h] [bp-40h] BYREF
  CVector v6; // [sp+54h] [bp-3Ch] BYREF
  CVector v7; // [sp+60h] [bp-30h] BYREF
  RwV3d_0 posn; // [sp+6Ch] [bp-24h] BYREF

  memset(&posn, 0, sizeof(posn));
  CPed::GetTransformedBonePosition(pPed, &posn, 0x18u, 0);
  memset(&v6, 0, sizeof(v6));
  memset(&v7, 0, sizeof(v7));
  WeaponInfo = CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
  CCamera::Find3rdPersonCamTargetVector(&TheCamera, WeaponInfo->m_fWeaponRange, (CVector)posn, &v7, &v6);
  refEntityPtr = 0;
  return CWorld::ProcessLineOfSight(&v7, &v6, &colPoint, &refEntityPtr, 0, 1, 1, 0, 0, 0, 0, 0);
}

//----- (003FB4EC) --------------------------------------------------------
int __fastcall CPad::GetEnterTargeting(CPad *this)
{
  CPlayerPed *PlayerPed; // r4
  CTask *ActiveTaskByType; // r5
  CPlayerPed *v3; // r0
  unsigned int v4; // r0
  float v5; // s0
  CPlayerPed *v7; // r0
  unsigned int v8; // r0
  int v9; // r4
  eWeaponType m_eWeaponType; // r0
  bool v11; // zf
  _BOOL4 IsTouched; // r5
  _BOOL4 IsPressed; // r0
  bool v14; // zf

  if ( this->DisablePlayerControls )
    return 0;
  PlayerPed = FindPlayerPed(-1);
  ActiveTaskByType = CTaskManager::FindActiveTaskByType(&PlayerPed->m_pPedIntelligence->m_taskManager, 307);
  if ( !MobileSettings::IsLockOnMode() && CHID::GetInputType() != 1 )
  {
    if ( MobileSettings::IsFreeAimMode() == 1 )
    {
      switch ( PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType )
      {
        case WEAPONTYPE_KNIFE:
        case WEAPONTYPE_KATANA:
        case WEAPONTYPE_FLAMETHROWER:
        case WEAPONTYPE_SPRAYCAN:
        case WEAPONTYPE_EXTINGUISHER:
          return 0;
        default:
          if ( ActiveTaskByType )
            return 0;
          if ( CHID::GetInputType() == 2 )
          {
            if ( !FindPlayerPed(-1)
              || (v7 = FindPlayerPed(-1), v8 = v7->m_WeaponSlots[v7->m_nCurrentWeapon].m_eWeaponType - 33, v8 > 0xC)
              || ((1 << v8) & 0x1C0F) == 0 )
            {
              v9 = 1;
              if ( CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1) )
                return v9;
              v9 = 1;
              if ( CTouchInterface::IsTouched(WIDGET_ENTER_TARGETING, 0, 1) )
                return v9;
            }
          }
          if ( CTouchInterface::IsReleased(WIDGET_ENTER_TARGETING, 0, 1) )
            goto LABEL_11;
          return 0;
      }
    }
    return 0;
  }
  if ( ActiveTaskByType )
    return 0;
  if ( FindPlayerPed(-1) )
  {
    v3 = FindPlayerPed(-1);
    v4 = v3->m_WeaponSlots[v3->m_nCurrentWeapon].m_eWeaponType - 33;
    if ( v4 <= 0xC && ((1 << v4) & 0x1C0F) != 0 )
    {
      if ( (!CHID::GetInputType() || CHID::GetInputType() == 2)
        && CTouchInterface::IsReleased(WIDGET_ENTER_TARGETING, 0, 1) )
      {
LABEL_11:
        v5 = OS_TimeAccurate();
        m_fKeyboardEnterTargetingTime = v5;
        return 1;
      }
      if ( CHID::GetInputType() == 1 )
      {
        v9 = 1;
        if ( CTouchInterface::IsTouched(WIDGET_ENTER_TARGETING, 0, 1) )
          return v9;
      }
      return 0;
    }
  }
  m_eWeaponType = PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType;
  v11 = m_eWeaponType == WEAPONTYPE_KNIFE;
  if ( m_eWeaponType != WEAPONTYPE_KNIFE )
    v11 = m_eWeaponType == WEAPONTYPE_KATANA;
  if ( v11 )
    return 0;
  if ( CPedIntelligence::GetTaskJetPack(PlayerPed->m_pPedIntelligence) )
    IsTouched = CTouchInterface::IsTouched(WIDGET_VC_SHOOT_ALT, 0, 1);
  else
    IsTouched = 0;
  IsPressed = CHID::IsPressed(HID_MAPPING_ENTER_AND_EXIT_TARGETING, 0);
  v14 = IsPressed;
  if ( IsPressed )
    v14 = PlayerPed->m_pEntLockOnTarget == 0;
  if ( v14 && (CHID::GetInputType() != 1 || !CPedIntelligence::GetTaskJetPack(PlayerPed->m_pPedIntelligence)) )
    return 1;
  return CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1) || IsTouched;
}

//----- (003FB704) --------------------------------------------------------
bool __fastcall CPad::GetTarget(CPad *this, bool bCheckWidget)
{
  char v3; // r5
  int bRocketLocked; // r6
  CVehicle *PlayerVehicle; // r0

  v3 = 0;
  if ( !this->DisablePlayerControls && bCheckWidget )
  {
    v3 = 0;
    if ( FindPlayerVehicle(-1, 0) )
    {
      v3 = 0;
      if ( FindPlayerVehicle(-1, 0)->m_vehicleType == 4 )
      {
        bRocketLocked = this->bRocketLocked;
        PlayerVehicle = FindPlayerVehicle(-1, 0);
        if ( bRocketLocked )
        {
          if ( *(_DWORD *)&PlayerVehicle[1].m_upgrades[1] )
            return 1;
          v3 = 0;
        }
        else
        {
          *(_DWORD *)&PlayerVehicle[1].m_comp1 = 0;
          *(_DWORD *)&FindPlayerVehicle(-1, 0)[1].m_upgrades[1] = 0;
          v3 = 1;
        }
        this->bRocketLocked = v3;
      }
    }
  }
  return v3;
}

//----- (003FB77C) --------------------------------------------------------
bool __fastcall CPad::GetExitTargeting(CPad *this)
{
  bool v1; // r5
  CPlayerPed *PlayerPed; // r4
  CPlayerPed *v4; // r0
  unsigned int v5; // r0
  CPlayerPed *v6; // r0
  unsigned int v7; // r0
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  int v10; // r6

  if ( this->DisablePlayerControls )
    return 0;
  PlayerPed = FindPlayerPed(-1);
  if ( !PlayerPed )
    return 0;
  if ( MobileSettings::IsLockOnMode() || CHID::GetInputType() == 1 )
  {
    if ( FindPlayerPed(-1)
      && (v4 = FindPlayerPed(-1), v5 = v4->m_WeaponSlots[v4->m_nCurrentWeapon].m_eWeaponType - 33, v5 <= 0xC)
      && ((1 << v5) & 0x1C0F) != 0 )
    {
      if ( !CHID::GetInputType() && CTouchInterface::IsReleased(WIDGET_EXIT_TARGETING, 0, 1) )
        goto LABEL_33;
      if ( CHID::GetInputType() == 2 )
      {
        v1 = 0;
        if ( !CTouchInterface::IsReleased(WIDGET_EXIT_TARGETING, 0, 1) )
          return v1;
        goto LABEL_14;
      }
      v1 = 0;
      if ( CHID::GetInputType() == 1 && !CTouchInterface::IsTouched(WIDGET_EXIT_TARGETING, 0, 1) )
        goto LABEL_33;
    }
    else
    {
      v1 = 0;
      if ( CHID::IsReleased(HID_MAPPING_ENTER_AND_EXIT_TARGETING) && !CHID::IsPressed(HID_MAPPING_ATTACK, 0) )
        goto LABEL_33;
    }
    return v1;
  }
  if ( MobileSettings::IsFreeAimMode() != 1 )
    return 0;
  if ( CHID::GetInputType() == 2
    && !CTouchInterface::IsTouched(WIDGET_ATTACK, 0, 1)
    && !CTouchInterface::IsTouched(WIDGET_ENTER_TARGETING, 0, 1) )
  {
    if ( !FindPlayerPed(-1) )
      goto LABEL_33;
    v6 = FindPlayerPed(-1);
    v7 = v6->m_WeaponSlots[v6->m_nCurrentWeapon].m_eWeaponType - 33;
    if ( v7 > 0xC || ((1 << v7) & 0x1C0F) == 0 )
      goto LABEL_33;
  }
  m_eWeaponType = PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(PlayerPed);
  v10 = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_eFireType != FIRETYPE_MELEE;
  if ( CTouchInterface::IsSwipedLeft(WIDGET_EXIT_TARGETING, v10) )
    return 0;
  v1 = 0;
  if ( !CTouchInterface::IsSwipedRight(WIDGET_EXIT_TARGETING, v10)
    && CTouchInterface::IsReleased(WIDGET_EXIT_TARGETING, 0, v10) )
  {
    if ( CHID::GetInputType() != 2 )
    {
LABEL_33:
      CPlayerPed::ClearWeaponTarget(PlayerPed);
      v1 = 1;
      *((_WORD *)PlayerPed->m_pPlayerData + 26) &= ~8u;
      return v1;
    }
LABEL_14:
    if ( OS_TimeAccurate() - m_fKeyboardEnterTargetingTime > 0.25 )
      goto LABEL_33;
    return 0;
  }
  return v1;
}

//----- (003FB95C) --------------------------------------------------------
bool __fastcall CPad::ShiftTargetLeftJustDown(CPad *this)
{
  CPlayerPed *PlayerPed; // r4
  bool result; // r0
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0

  PlayerPed = FindPlayerPed(-1);
  result = 0;
  if ( PlayerPed && !this->DisablePlayerControls )
  {
    if ( (CHID::Implements(HID_MAPPING_ALT_ATTACK)
       || (m_eWeaponType = PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType,
           WeaponSkill = CPed::GetWeaponSkill(PlayerPed),
           CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_eFireType))
      && (*((_BYTE *)PlayerPed->m_pPlayerData + 52) & 8) == 0
      && CTouchInterface::IsSwipedLeft(WIDGET_LOOK, 1) )
    {
      CWidgetHelpText::ConditionSatisfied(0x800u);
      return 1;
    }
    else
    {
      return 0;
    }
  }
  return result;
}

//----- (003FB9CC) --------------------------------------------------------
bool __fastcall CPad::ShiftTargetRightJustDown(CPad *this)
{
  CPlayerPed *PlayerPed; // r4
  bool result; // r0
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0

  PlayerPed = FindPlayerPed(-1);
  result = 0;
  if ( PlayerPed && !this->DisablePlayerControls )
  {
    if ( (CHID::Implements(HID_MAPPING_ALT_ATTACK)
       || (m_eWeaponType = PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType,
           WeaponSkill = CPed::GetWeaponSkill(PlayerPed),
           CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_eFireType))
      && (*((_BYTE *)PlayerPed->m_pPlayerData + 52) & 8) == 0
      && CTouchInterface::IsSwipedRight(WIDGET_LOOK, 1) )
    {
      CWidgetHelpText::ConditionSatisfied(0x800u);
      return 1;
    }
    else
    {
      return 0;
    }
  }
  return result;
}

//----- (003FBA3C) --------------------------------------------------------
bool __fastcall CPad::GetDuck(CPad *this)
{
  bool v1; // zf
  bool v3; // r4
  CTouchInterface::WidgetIDs v4; // r0

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bDisablePlayerDuck == 0;
  if ( !v1 )
    return 0;
  if ( !CTouchInterface::m_pWidgets[32] )
  {
    if ( !CTouchInterface::IsDoubleTapped(WIDGET_PED_MOVE, 1, 1) )
      return 0;
    v4 = WIDGET_PED_MOVE;
    goto LABEL_10;
  }
  v3 = 0;
  if ( CTouchInterface::IsReleased(WIDGET_BUTTON_CROUCH, 0, 1) )
  {
    v4 = WIDGET_BUTTON_CROUCH;
LABEL_10:
    CTouchInterface::ClearTapHistory(v4);
    CWidgetHelpText::ConditionSatisfied(0x1000u);
    return 1;
  }
  return v3;
}

//----- (003FBA9C) --------------------------------------------------------
bool __fastcall CPad::DuckJustDown(CPad *this, CPed *pPed)
{
  CTouchInterface::WidgetIDs v3; // r0

  if ( this->DisablePlayerControls || !pPed || this->bDisablePlayerDuck )
    return 0;
  if ( pPed->m_pAttachToEntity )
    return 0;
  if ( !CTouchInterface::m_pWidgets[32] )
  {
    if ( CTouchInterface::IsDoubleTapped(WIDGET_PED_MOVE, 1, 0) )
    {
      v3 = WIDGET_PED_MOVE;
      goto LABEL_12;
    }
    return 0;
  }
  if ( !CTouchInterface::IsReleased(WIDGET_BUTTON_CROUCH, 0, 1) )
    return 0;
  v3 = WIDGET_BUTTON_CROUCH;
LABEL_12:
  CTouchInterface::ClearTapHistory(v3);
  CWidgetHelpText::ConditionSatisfied(0x1000u);
  return 1;
}

//----- (003FBB0C) --------------------------------------------------------
bool __fastcall CPad::GetAutoClimb(CPad *this)
{
  bool v1; // r4
  int (**v2)(void); // s2
  int v3; // r1
  int v4; // r0
  CVector2D v6; // [sp+0h] [bp-10h] BYREF

  if ( !MobileSettings::settings[35].value )
    return 0;
  if ( this->NewState.LeftStickY < -64 )
    return 1;
  v1 = 0;
  v6.x = 0.0;
  v6.y = 0.0;
  if ( CTouchInterface::IsTouched(WIDGET_PED_MOVE, &v6, 1) && v6.y < -32.0 )
  {
    if ( CTouchInterface::m_pWidgets[167] )
    {
      v2 = CTouchInterface::m_pWidgets[167][1]._vptr$CWidget;
      v3 = 0;
      v4 = 0;
      v1 = 1;
      if ( *(float *)&v2 < 0.4 )
        v3 = 1;
      if ( *(float *)&v2 > 0.0 )
        v4 = 1;
      if ( *(float *)&v2 <= 5.8832 && (v4 & v3) == 0 )
        return 0;
      return v1;
    }
    return 0;
  }
  return v1;
}

//----- (003FBBB8) --------------------------------------------------------
bool __fastcall CPad::GetAbortClimb(CPad *this)
{
  char v2; // r4
  bool IsTouched; // r0
  CVector2D v4; // [sp+0h] [bp-18h] BYREF

  if ( this->NewState.LeftStickY > 64 )
    return 1;
  v2 = 0;
  v4.x = 0.0;
  v4.y = 0.0;
  IsTouched = CTouchInterface::IsTouched(WIDGET_PED_MOVE, &v4, 1);
  if ( v4.y > 32.0 )
    v2 = 1;
  return IsTouched & v2;
}

//----- (003FBBF8) --------------------------------------------------------
bool __fastcall CPad::GetBunnyHop(CPad *this)
{
  bool v1; // zf
  bool v2; // r4

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bDisablePlayerJump == 0;
  if ( !v1 || CHID::Implements(HID_MAPPING_BUNNY_HOP) )
    return 0;
  v2 = 1;
  if ( CTouchInterface::IsDoubleTapped(WIDGET_ACCELERATE, 1, 1) )
    return v2;
  return sub_1A06A4(WIDGET_DRIVE_HYBRID, 1, 1);
}

//----- (003FBC3A) --------------------------------------------------------
bool __fastcall CPad::GetBunnyHopDown(CPad *this)
{
  bool v1; // zf

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bDisablePlayerJump == 0;
  return v1 && sub_196BD4(HID_MAPPING_BUNNY_HOP, 0);
}

//----- (003FBC58) --------------------------------------------------------
bool __fastcall CPad::GetJump(CPad *this)
{
  bool v1; // zf
  bool v2; // r4

  v1 = this->DisablePlayerControls == 0;
  if ( !this->DisablePlayerControls )
    v1 = this->bDisablePlayerJump == 0;
  if ( !v1 || CCamera::IsTargetingActive(&TheCamera) )
    return 0;
  v2 = 1;
  if ( CTouchInterface::IsDoubleTapped(WIDGET_SPRINT, 1, 1) )
    return v2;
  return CTouchInterface::IsDoubleTapped(WIDGET_BUTTON_SPRINT, 1, 1);
}

//----- (003FBCAC) --------------------------------------------------------
bool __fastcall CPad::JumpJustDown(CPad *this)
{
  bool v1; // r4

  if ( this->DisablePlayerControls )
    return 0;
  v1 = 0;
  if ( this->bDisablePlayerJump || CRopes::PlayerControlsCrane )
    return v1;
  if ( CCamera::IsTargetingActive(&TheCamera) )
    return 0;
  v1 = 1;
  if ( CTouchInterface::IsDoubleTapped(WIDGET_SPRINT, 1, 1) )
    return v1;
  return CTouchInterface::IsDoubleTapped(WIDGET_BUTTON_SPRINT, 0, 1);
}

//----- (003FBD10) --------------------------------------------------------
bool __fastcall CPad::DiveJustDown(CPad *this)
{
  if ( CTouchInterface::m_pWidgets[33] )
  {
    if ( CTouchInterface::IsReleased(WIDGET_BUTTON_DIVE, 0, 1) )
      return 1;
  }
  else if ( CTouchInterface::IsDoubleTapped(WIDGET_PED_MOVE, 1, 1) )
  {
    CTouchInterface::ClearTapHistory(WIDGET_PED_MOVE);
    return 1;
  }
  return 0;
}

//----- (003FBD58) --------------------------------------------------------
bool __fastcall CPad::SwimJumpJustDown(CPad *this)
{
  bool v1; // r4

  if ( this->DisablePlayerControls || CCamera::IsTargetingActive(&TheCamera) )
    return 0;
  v1 = 1;
  if ( CTouchInterface::IsDoubleTapped(WIDGET_SPRINT, 1, 1) )
    return v1;
  return CHID::IsReleased(HID_MAPPING_JUMP)
      || CTouchInterface::IsDoubleTapped(WIDGET_BUTTON_SWIM, 0, 1) && !CHID::GetInputType();
}

//----- (003FBDB0) --------------------------------------------------------
bool __fastcall CPad::GetSprint(CPad *this, int nSprintType)
{
  CPlayerPed *PlayerPed; // r0
  bool v5; // r5
  CTouchInterface::WidgetIDs v6; // r0

  if ( this->DisablePlayerControls )
    return 0;
  if ( CRopes::PlayerControlsCrane )
    return 0;
  if ( FindPlayerPed(-1) )
  {
    if ( (*((_BYTE *)&FindPlayerPed(-1)->m_nPedFlags + 3) & 4) != 0 )
    {
      PlayerPed = FindPlayerPed(-1);
      if ( sqrtf(
             (float)(PlayerPed->m_vecMoveSpeed.x * PlayerPed->m_vecMoveSpeed.x)
           + (float)(PlayerPed->m_vecMoveSpeed.y * PlayerPed->m_vecMoveSpeed.y)) == 0.0 )
        return 0;
    }
  }
  if ( CCamera::IsTargetingActive(&TheCamera) )
    return 0;
  if ( !CTouchInterface::m_pWidgets[31] )
  {
    if ( nSprintType != 1 )
    {
      v5 = 1;
      v6 = WIDGET_SPRINT;
      goto LABEL_15;
    }
    return 0;
  }
  if ( !nSprintType )
  {
    v5 = 1;
    v6 = WIDGET_BUTTON_SPRINT;
    goto LABEL_15;
  }
  if ( (nSprintType | 1) != 3 )
    return 0;
  v5 = 1;
  v6 = WIDGET_BUTTON_SWIM;
LABEL_15:
  if ( !CTouchInterface::IsTouched(v6, 0, 1) )
    return 0;
  return v5;
}

//----- (003FBE64) --------------------------------------------------------
bool __fastcall CPad::SprintJustDown(CPad *this)
{
  bool v2; // r4
  CPlayerPed *PlayerPed; // r0

  if ( this->DisablePlayerControls )
    return 0;
  v2 = 0;
  if ( FindPlayerVehicle(-1, 0) )
    return v2;
  if ( FindPlayerPed(-1) )
  {
    PlayerPed = FindPlayerPed(-1);
    v2 = 0;
    if ( CPedIntelligence::GetTaskSwim(PlayerPed->m_pPedIntelligence) || CRopes::PlayerControlsCrane )
      return v2;
  }
  else if ( CRopes::PlayerControlsCrane )
  {
    return 0;
  }
  if ( CCamera::IsTargetingActive(&TheCamera) )
    return 0;
  v2 = 1;
  if ( CTouchInterface::IsReleased(WIDGET_SPRINT, 0, 1) )
    return v2;
  return CTouchInterface::IsReleased(WIDGET_BUTTON_SPRINT, 0, 1);
}

//----- (003FBF00) --------------------------------------------------------
int16 __fastcall CPad::GetDisplayScreenRecord(CPad *this)
{
  return !this->DisablePlayerControls
      && !((this->bDisablePlayerDisplayVitalStats | CTimer::m_UserPause | CTimer::m_CodePause) << 24)
      && CTouchInterface::IsReleased(WIDGET_REPLAY, 0, 1);
}

//----- (003FBF40) --------------------------------------------------------
int16 __fastcall CPad::GetDisplayVitalStats(CPad *this, CPed *pPed)
{
  if ( this->DisablePlayerControls
    || (this->bDisablePlayerDisplayVitalStats | CTimer::m_UserPause | CTimer::m_CodePause) << 24
    || CHID::Use360ClassicVitalStatsHack()
    || !CTouchInterface::IsHeldDown(WIDGET_PLAYER_INFO, 1) )
  {
    return 0;
  }
  CWidgetHelpText::ConditionSatisfied(0x200u);
  return 1;
}

//----- (003FBF90) --------------------------------------------------------
bool __fastcall CPad::CollectPickupJustDown(CPad *this)
{
  int DisablePlayerControls; // r1
  bool result; // r0
  CVector2D v3; // [sp+0h] [bp-10h] BYREF

  DisablePlayerControls = this->DisablePlayerControls;
  result = 0;
  if ( !DisablePlayerControls )
  {
    v3.x = 0.0;
    v3.y = 0.0;
    return CTouchInterface::IsReleased(WIDGET_SWAP_WEAPONS, &v3, -1)
        || CTouchInterface::IsReleased(WIDGET_PURCHASE, &v3, -1);
  }
  return result;
}
// 3FBF90: using guessed type CVector2D var_10;

//----- (003FBFCA) --------------------------------------------------------
bool __fastcall CPad::GetForceCameraBehindPlayer(CPad *this)
{
  return !this->DisablePlayerControls
      && CHID::GetInputType() == 1
      && CHID::Implements(HID_MAPPING_PHONE)
      && CHID::IsPressed(HID_MAPPING_PHONE, 0)
      && !CHID::IsPressed(HID_MAPPING_ENTER_AND_EXIT_TARGETING, 0);
}

//----- (003FC008) --------------------------------------------------------
bool __fastcall IsPinchZooming(bool bZoomIn)
{
  _BOOL4 v1; // r4
  CWidget *v2; // r5
  float v4; // s0
  float v5; // s2
  float v6; // s2

  v1 = bZoomIn;
  v2 = CTouchInterface::m_pWidgets[175];
  if ( !CTouchInterface::m_pWidgets[175] )
    return 0;
  if ( (int)CTouchInterface::GetNumTouches() <= 1 )
  {
    bZooming = 0;
    return 0;
  }
  if ( (int)CTouchInterface::GetNumTouches() < 2 )
    return 0;
  v4 = COERCE_FLOAT((*((int (__fastcall **)(CWidget *))v2->_vptr$CWidget + 6))(v2));
  if ( bZooming == 1 )
  {
    v5 = fLastDistance;
  }
  else
  {
    v5 = v4;
    fLastDistance = v4;
    bZooming = 1;
  }
  v6 = v5 - v4;
  if ( v1 )
  {
    if ( v6 >= (float)((float)-RsGlobal.screenWidth * 0.005) )
      return 0;
  }
  else if ( v6 <= (float)((float)RsGlobal.screenWidth * 0.005) )
  {
    return 0;
  }
  fLastDistance = v4;
  return 1;
}
// 959E24: using guessed type char bZooming;

//----- (003FC0F0) --------------------------------------------------------
bool __fastcall CPad::SniperZoomIn(CPad *this)
{
  CWidget *v2; // r4
  float v3; // s0
  float v4; // s2

  if ( this->DisablePlayerControls )
    return 0;
  if ( CTouchInterface::IsTouched(WIDGET_ZOOM_IN, 0, 1) )
    return 1;
  v2 = CTouchInterface::m_pWidgets[175];
  if ( !CTouchInterface::m_pWidgets[175] )
    return 0;
  if ( (int)CTouchInterface::GetNumTouches() <= 1 )
  {
    bZooming = 0;
    return 0;
  }
  if ( (int)CTouchInterface::GetNumTouches() < 2 )
    return 0;
  v3 = COERCE_FLOAT((*((int (__fastcall **)(CWidget *))v2->_vptr$CWidget + 6))(v2));
  if ( bZooming == 1 )
  {
    v4 = fLastDistance;
  }
  else
  {
    v4 = v3;
    fLastDistance = v3;
    bZooming = 1;
  }
  if ( (float)(v4 - v3) >= (float)((float)-RsGlobal.screenWidth * 0.005) )
    return 0;
  fLastDistance = v3;
  return 1;
}
// 959E24: using guessed type char bZooming;

//----- (003FC1D8) --------------------------------------------------------
bool __fastcall CPad::SniperZoomOut(CPad *this)
{
  CWidget *v2; // r4
  float v3; // s0
  float v4; // s2

  if ( this->DisablePlayerControls )
    return 0;
  if ( CTouchInterface::IsTouched(WIDGET_ZOOM_OUT, 0, 1) )
    return 1;
  v2 = CTouchInterface::m_pWidgets[175];
  if ( !CTouchInterface::m_pWidgets[175] )
    return 0;
  if ( (int)CTouchInterface::GetNumTouches() <= 1 )
  {
    bZooming = 0;
    return 0;
  }
  if ( (int)CTouchInterface::GetNumTouches() < 2 )
    return 0;
  v3 = COERCE_FLOAT((*((int (__fastcall **)(CWidget *))v2->_vptr$CWidget + 6))(v2));
  if ( bZooming == 1 )
  {
    v4 = fLastDistance;
  }
  else
  {
    v4 = v3;
    fLastDistance = v3;
    bZooming = 1;
  }
  if ( (float)(v4 - v3) <= (float)((float)RsGlobal.screenWidth * 0.005) )
    return 0;
  fLastDistance = v3;
  return 1;
}
// 959E24: using guessed type char bZooming;

//----- (003FC2BC) --------------------------------------------------------
Int16 __fastcall CPad::CinemaCamera(CPad *this)
{
  int IsReleased; // r0

  IsReleased = CTouchInterface::IsReleased(WIDGET_CAM_TOGGLE, 0, 1);
  if ( IsReleased )
    LOWORD(IsReleased) = 128;
  return IsReleased;
}

//----- (003FC2D4) --------------------------------------------------------
Int16 __fastcall CPad::LookAroundLeftRight(CPad *this)
{
  CPad *v1; // r1
  int RightStickX; // r4
  float v3; // s16
  float v4; // s18
  float v5; // s0
  _BOOL4 v6; // r1
  float v8; // s2
  float v9; // s0

  v1 = this;
  LOWORD(this) = 0;
  if ( !v1->DisablePlayerControls && !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
  {
    RightStickX = Pads[0].NewState.RightStickX;
    v3 = (float)Pads[0].NewState.RightStickX;
    v4 = v3;
    if ( Pads[0].NewState.RightStickX < 0 )
      v4 = -v3;
    if ( v4 > 100.0 && (v1->bHasJetPack && !CHID::GetInputType() || !CTouchInterface::IsHeldDown(WIDGET_LOOK, 1)) )
    {
      if ( RightStickX < 1 )
      {
        v9 = v3 + 100.0;
        v8 = -50.0;
      }
      else
      {
        v8 = 50.0;
        v9 = v3 + -100.0;
      }
      return (int)(float)(v9 + v8);
    }
    v5 = 50.0;
    v6 = CCam::Using3rdPersonMouseCam(TheCamera.Cams);
    LOWORD(this) = 0;
    if ( v4 > 50.0 && v6 )
    {
      if ( RightStickX >= 1 )
        v5 = -50.0;
      return (int)(float)((float)(v3 + v5) * 0.5);
    }
  }
  return (__int16)this;
}

//----- (003FC3CC) --------------------------------------------------------
Int16 __fastcall CPad::LookAroundUpDown(CPad *this)
{
  int v1; // r5
  int v2; // r6
  int v3; // r1
  _BOOL4 v4; // r0
  int v5; // r0

  LOWORD(v1) = Pads[0].NewState.RightStickY;
  if ( MobileSettings::settings[15].value )
    v1 = -(unsigned __int16)Pads[0].NewState.RightStickY;
  v2 = (__int16)v1;
  if ( (v1 & 0x8000u) != 0 )
    v2 = -(__int16)v1;
  if ( v2 >= 101
    && (this->DisablePlayerControls
     || this->bHasJetPack && !CHID::GetInputType()
     || !CTouchInterface::IsHeldDown(WIDGET_LOOK, 1)) )
  {
    if ( (__int16)v1 < 1 )
      LOWORD(v3) = v1 + 50;
    else
      LOWORD(v3) = v1 - 50;
  }
  else
  {
    v4 = CCam::Using3rdPersonMouseCam(TheCamera.Cams);
    LOWORD(v3) = 0;
    if ( v2 >= 51 && v4 )
    {
      if ( (__int16)v1 >= 1 )
        v5 = (__int16)v1 - 50;
      else
        v5 = (__int16)v1 + 50;
      return (int)(float)((float)v5 * 0.5);
    }
  }
  return v3;
}

//----- (003FC480) --------------------------------------------------------
float __fastcall CPad::AimWeaponLeftRight(CPad *this, CPed *pPed, bool *pbTouchInputX)
{
  float v4; // s16
  CVehicle *PlayerVehicle; // r0
  CVehicle *v8; // r6
  CVehicle *v9; // r0
  CPad *v10; // r1
  int Mode; // r0
  bool v12; // zf
  CVector2D v13; // [sp+0h] [bp-28h] BYREF
  CVector2D pVecOut; // [sp+8h] [bp-20h] BYREF

  v4 = 0.0;
  if ( this->DisablePlayerControls )
    return v4;
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  v8 = PlayerVehicle;
  if ( PlayerVehicle )
  {
    if ( !CVehicle::IsPassenger(PlayerVehicle, pPed)
      && ((unsigned int)(v8->m_vehicleType - 3) < 2
       || CWorld::Players[0].pRemoteVehicle && (unsigned int)(CWorld::Players[0].pRemoteVehicle->m_vehicleType - 3) < 2) )
    {
      return v4;
    }
  }
  if ( CHID::GetInputType() == 1 )
  {
    v9 = FindPlayerVehicle(-1, 0);
    if ( v9 )
    {
      if ( (v9->hFlagsLocal & 0x20000) != 0 )
        return v4;
    }
  }
  pVecOut.x = 0.0;
  pVecOut.y = 0.0;
  if ( !CHID::GetInputType() || CHID::GetInputType() == 2 )
  {
    if ( CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1) )
    {
      if ( pbTouchInputX && !CHID::IsPressed(HID_MAPPING_LOOK_X, 0) )
        *pbTouchInputX = 1;
      return pVecOut.x;
    }
    return 0.0;
  }
  if ( CHID::GetInputType() != 1 )
    return 0.0;
  if ( CHID::IsPressed(HID_MAPPING_LOOK_X, 0) )
    CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1);
  if ( CHID::IsPressed(HID_MAPPING_ENTER_AND_EXIT_TARGETING, 0) || CHID::IsPressed(HID_MAPPING_ATTACK, 0) )
  {
    CPad::GetFreeAimAssistance(&v13, v10, pPed);
    pVecOut.x = v13.x + pVecOut.x;
  }
  Mode = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
  v12 = Mode == 65;
  if ( Mode != 65 )
    v12 = Mode == 55;
  if ( v12 && CHID::IsPressed(HID_MAPPING_PED_MOVE_X, 0) )
    CTouchInterface::IsTouched(WIDGET_PED_MOVE, &pVecOut, 1);
  return pVecOut.x * (float)((float)((float)MobileSettings::settings[25].value / 100.0) + 0.3);
}
// 3FC576: variable 'v10' is possibly undefined

//----- (003FC604) --------------------------------------------------------
CVector2D *__fastcall CPad::GetFreeAimAssistance(CVector2D *retstr, CPad *this, CPed *pPlayerPed)
{
  CEntity *m_pEntMagnetizeTarget; // r6
  CVector2D *result; // r0
  bool v7; // zf
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r8
  CSimpleTransform *p_tx; // r1
  __int64 v11; // d16
  float v12; // s0
  CMatrix *v13; // r1
  CSimpleTransform *v14; // r2
  float32x2_t v15; // d16
  unsigned __int64 v16; // d3
  CVector vecPedFeet; // [sp+8h] [bp-38h] BYREF
  CVector vecPedHead; // [sp+14h] [bp-2Ch] BYREF
  RwV3d_0 In; // [sp+20h] [bp-20h] BYREF

  result = 0;
  retstr->x = 0.0;
  retstr->y = 0.0;
  v7 = pPlayerPed == 0;
  if ( pPlayerPed )
  {
    m_pEntMagnetizeTarget = pPlayerPed->m_pEntMagnetizeTarget;
    v7 = m_pEntMagnetizeTarget == 0;
  }
  if ( !v7 )
  {
    m_pMat = m_pEntMagnetizeTarget->m_pMat;
    p_m_transform = &m_pEntMagnetizeTarget->m_transform;
    p_tx = &m_pEntMagnetizeTarget->m_transform;
    if ( m_pMat )
      p_tx = (CSimpleTransform *)&m_pMat->tx;
    v11 = *(_QWORD *)&p_tx->m_translate.x;
    In.z = p_tx->m_translate.z;
    *(_QWORD *)&In.x = v11;
    if ( (*(_BYTE *)&m_pEntMagnetizeTarget->m_info & 7) == 3 )
    {
      memset(&vecPedFeet, 0, sizeof(vecPedFeet));
      memset(&vecPedHead, 0, sizeof(vecPedHead));
      CPed::GetHeadAndFootPositions((CPed *)m_pEntMagnetizeTarget, &vecPedHead, &vecPedFeet, 1);
    }
    memset(&vecPedHead, 0, sizeof(vecPedHead));
    if ( CSprite::CalcScreenCoors(&In, &vecPedHead, 0, 0, 1, 1) == 1
      && (vecDebug = *(CVector2D *)&vecPedHead.x,
          v12 = (float)((float)(vecPedHead.y / (float)RsGlobal.screenHeight) + -0.5) + 0.085,
          vecPedHead.y = v12,
          vecPedHead.x = (float)((float)(vecPedHead.x / (float)RsGlobal.screenWidth) + -0.5) + -0.025,
          fabsf(vecPedHead.x) < 0.1) )
    {
      retstr->x = vecPedHead.x * 512.0;
      result = (CVector2D *)pPlayerPed->m_pMat;
      v13 = m_pEntMagnetizeTarget->m_pMat;
      v14 = (CSimpleTransform *)&result[6];
      if ( !result )
        v14 = &pPlayerPed->m_transform;
      if ( v13 )
        p_m_transform = (CSimpleTransform *)&v13->tx;
      v15.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&v14->m_translate.y).n64_u64[0];
      v16 = vmul_f32(v15, v15).n64_u64[0];
      if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - v14->m_translate.x)
                                 * (float)(p_m_transform->m_translate.x - v14->m_translate.x))
                         + *(float *)&v16)
                 + *((float *)&v16 + 1)) > 100.0 )
        retstr->y = v12 * 512.0;
    }
    else
    {
      CPed::SetWeaponLockOnTarget(pPlayerPed, 0);
    }
  }
  return result;
}
// 3FC626: variable 'm_pEntMagnetizeTarget' is possibly undefined

//----- (003FC780) --------------------------------------------------------
Int16 __fastcall CPad::AimWeaponUpDown(CPad *this, CPed *pPed, bool *pbTouchInputY)
{
  CVehicle *PlayerVehicle; // r0
  CVehicle *v7; // r6
  CVehicle *v8; // r0
  float v9; // s2
  CPad *v11; // r1
  float y; // s0
  int Mode; // r0
  bool v14; // zf
  float v15; // s4
  CVector2D v16; // [sp+0h] [bp-20h] BYREF
  CVector2D pVecOut; // [sp+8h] [bp-18h] BYREF

  if ( this->DisablePlayerControls )
    return 0;
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  v7 = PlayerVehicle;
  if ( PlayerVehicle )
  {
    if ( !CVehicle::IsPassenger(PlayerVehicle, pPed)
      && ((unsigned int)(v7->m_vehicleType - 3) < 2
       || CWorld::Players[0].pRemoteVehicle && (unsigned int)(CWorld::Players[0].pRemoteVehicle->m_vehicleType - 3) < 2) )
    {
      return 0;
    }
  }
  if ( CHID::GetInputType() == 1 )
  {
    v8 = FindPlayerVehicle(-1, 0);
    if ( v8 )
    {
      if ( (v8->hFlagsLocal & 0x20000) != 0 )
        return 0;
    }
  }
  pVecOut.x = 0.0;
  pVecOut.y = 0.0;
  if ( CHID::GetInputType() && CHID::GetInputType() != 2 )
  {
    if ( CHID::GetInputType() == 1 )
    {
      if ( CHID::IsPressed(HID_MAPPING_LOOK_Y, 0) )
        CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1);
      if ( CHID::IsPressed(HID_MAPPING_ENTER_AND_EXIT_TARGETING, 0) || CHID::IsPressed(HID_MAPPING_ATTACK, 0) )
      {
        CPad::GetFreeAimAssistance(&v16, v11, pPed);
        y = v16.y;
        if ( MobileSettings::settings[15].value )
          y = -v16.y;
        pVecOut.y = pVecOut.y + y;
      }
      Mode = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
      v14 = Mode == 65;
      if ( Mode != 65 )
        v14 = Mode == 55;
      if ( v14 && CHID::IsPressed(HID_MAPPING_PED_MOVE_Y, 0) )
        CTouchInterface::IsTouched(WIDGET_PED_MOVE, &pVecOut, 1);
      v15 = -pVecOut.y;
      if ( MobileSettings::settings[15].value )
        v15 = pVecOut.y;
      return (int)(float)(v15 * (float)((float)((float)MobileSettings::settings[26].value / 100.0) + 0.3));
    }
    return 0;
  }
  if ( !CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1) )
    return 0;
  if ( pbTouchInputY && !CHID::IsPressed(HID_MAPPING_LOOK_Y, 0) )
    *pbTouchInputY = 1;
  v9 = -pVecOut.y;
  if ( MobileSettings::settings[15].value )
    return (int)pVecOut.y;
  return (int)v9;
}
// 3FC882: variable 'v11' is possibly undefined

//----- (003FC940) --------------------------------------------------------
bool __fastcall CPad::ConversationYesJustDown(CPad *this)
{
  bool v1; // r4
  CWidget *v3; // r5

  if ( this->DisablePlayerControls )
    return 0;
  v3 = CTouchInterface::m_pWidgets[157];
  if ( CTouchInterface::m_pWidgets[157] )
  {
    v1 = 1;
    CTouchInterface::IsTouched(WIDGET_RESPONSE, 0, 1);
    if ( LOBYTE(v3[1]._vptr$CWidget) )
      return v1;
  }
  return sub_18D4C0(WIDGET_POSITIVE, 0, 1);
}

//----- (003FC984) --------------------------------------------------------
bool __fastcall CPad::ConversationNoJustDown(CPad *this)
{
  bool v1; // r4
  CWidget *v3; // r5

  if ( this->DisablePlayerControls )
    return 0;
  v3 = CTouchInterface::m_pWidgets[157];
  if ( CTouchInterface::m_pWidgets[157] )
  {
    v1 = 1;
    CTouchInterface::IsTouched(WIDGET_RESPONSE, 0, 1);
    if ( BYTE1(v3[1]._vptr$CWidget) )
      return v1;
  }
  return sub_18D4C0(WIDGET_NEGATIVE, 0, 1);
}

//----- (003FC9C8) --------------------------------------------------------
bool __fastcall CPad::GetGroupControlForward(CPad *this, bool bCheckWidget, bool bCheckAlt)
{
  CPlayerPed *PlayerPed; // r0

  if ( this->DisablePlayerControls || CHud::bDrawingVitalStats || !bCheckWidget )
    return 0;
  if ( bCheckAlt )
    return CTouchInterface::IsTouched(WIDGET_GANG_FOLLOW, 0, 1);
  if ( !CTouchInterface::IsTouched(WIDGET_GANG_RECRUIT, 0, 1) )
    return 0;
  CWidgetHelpText::ConditionSatisfied(0x10u);
  if ( FindPlayerPed(-1) )
  {
    PlayerPed = FindPlayerPed(-1);
    CPlayerPed::ClearWeaponTarget(PlayerPed);
  }
  return 1;
}

//----- (003FCA34) --------------------------------------------------------
bool __fastcall CPad::GetGroupControlBack(CPad *this, bool bCheckWidget, bool bCheckAlt)
{
  CTouchInterface::WidgetIDs v4; // r0

  if ( this->DisablePlayerControls || CHud::bDrawingVitalStats || !bCheckWidget )
    return 0;
  if ( bCheckAlt )
    v4 = WIDGET_GANG_HOLD_POSITION;
  else
    v4 = WIDGET_GANG_IGNORE;
  return CTouchInterface::IsTouched(v4, 0, 1);
}

//----- (003FCA78) --------------------------------------------------------
bool __fastcall CPad::GroupControlForwardJustDown(CPad *this, bool bCheckWidget)
{
  return !this->DisablePlayerControls
      && !CHud::bDrawingVitalStats
      && bCheckWidget
      && CTouchInterface::IsReleased(WIDGET_GANG_FOLLOW, 0, 1);
}

//----- (003FCAB4) --------------------------------------------------------
bool __fastcall CPad::GroupControlBackJustDown(CPad *this, bool bCheckWidget)
{
  return !this->DisablePlayerControls
      && !CHud::bDrawingVitalStats
      && bCheckWidget
      && CTouchInterface::IsReleased(WIDGET_GANG_HOLD_POSITION, 0, 1);
}

//----- (003FCAF0) --------------------------------------------------------
void LittleTest()
{
  ++LittleTest(void)::Cunt;
}

//----- (003FCB00) --------------------------------------------------------
unsigned __int8 *__fastcall CPad::EditString(unsigned __int8 *pString, Int32 MaxStringLength)
{
  return 0;
}

//----- (003FCB04) --------------------------------------------------------
RwInt32 *__fastcall CPad::EditCodesForControls(RwInt32 *pRwKeyCode, Int32 MaxCodeLength)
{
  RwInt32 v3; // r5
  OSKeyboardKey v4; // r0

  v3 = 0;
  *pRwKeyCode = 1056;
  do
  {
    v4 = RsKeyToOSWKey((RsKeyCodes_0)v3);
    if ( v4 != KK_MAX && LIB_KeyboardPressed(v4) )
      *pRwKeyCode = v3;
    ++v3;
  }
  while ( v3 != 255 );
  if ( LIB_KeyboardPressed(KK_F1) )
    *pRwKeyCode = 1001;
  if ( LIB_KeyboardPressed(KK_F2) )
    *pRwKeyCode = 1002;
  if ( LIB_KeyboardPressed(KK_F3) )
    *pRwKeyCode = 1003;
  if ( LIB_KeyboardPressed(KK_F4) )
    *pRwKeyCode = 1004;
  if ( LIB_KeyboardPressed(KK_F5) )
    *pRwKeyCode = 1005;
  if ( LIB_KeyboardPressed(KK_F6) )
    *pRwKeyCode = 1006;
  if ( LIB_KeyboardPressed(KK_F7) )
    *pRwKeyCode = 1007;
  if ( LIB_KeyboardPressed(KK_F8) )
    *pRwKeyCode = 1008;
  if ( LIB_KeyboardPressed(KK_F9) )
    *pRwKeyCode = 1009;
  if ( LIB_KeyboardPressed(KK_F10) )
    *pRwKeyCode = 1010;
  if ( LIB_KeyboardPressed(KK_F11) )
    *pRwKeyCode = 1011;
  if ( LIB_KeyboardPressed(KK_F12) )
    *pRwKeyCode = 1012;
  return pRwKeyCode;
}

//----- (003FCBF0) --------------------------------------------------------
int CPad::UpdatePadsTillStable()
{
  return 1;
}

//----- (003FCBF4) --------------------------------------------------------
bool __fastcall CPad::GetEscapeJustDown(CPad *this)
{
  bool v1; // zf
  bool v2; // r4
  CWidget *v3; // r4

  if ( gMobileMenu.screenStack.numEntries )
    goto LABEL_7;
  v1 = (CTimer::m_UserPause || CTimer::m_CodePause) << 24 == 0;
  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
    v1 = gMobileMenu.pendingScreen == 0;
  if ( !v1 || (v2 = 1, !CTouchInterface::IsReleased(WIDGET_RADAR, 0, 1)) )
  {
LABEL_7:
    v3 = CTouchInterface::m_pWidgets[161];
    if ( CTouchInterface::AnyWidgetsUsingAltBack() == 1 && (!v3 || !CWidget::GetEnabled(v3)) )
      return 0;
    if ( CHID::IsReleased(HID_MAPPING_RADAR) )
      return 1;
    return LIB_KeyboardState(KK_ESCAPE) == OSPS_ButtonReleased;
  }
  return v2;
}

//----- (003FCC80) --------------------------------------------------------
void __fastcall CPhysical::CPhysical(CPhysical *this)
{
  int m_nFlags; // r0

  CEntity::CEntity(this);
  this->m_listEntryInfo.m_pHead = 0;
  this->_vptr$CPlaceable = (int (**)(void))&off_667CAC;
  CPlaceable::AllocateStaticMatrix(this);
  CMatrix::SetUnity(this->m_pMat);
  *(_QWORD *)&this->m_fMass = 0x3F8000003F800000LL;
  *(_QWORD *)&this->m_fMassMultiplier = 0x3DCCCCCD3F800000LL;
  *(_QWORD *)this->m_aCollisionRecordPtrs = 0LL;
  *(_QWORD *)&this->m_aCollisionRecordPtrs[2] = 0LL;
  *(_QWORD *)&this->m_vecAverageMoveSpeed.x = 0LL;
  *(_QWORD *)&this->m_vecAverageMoveSpeed.z = 0LL;
  *(_QWORD *)&this->m_vecMoveFriction.z = 0LL;
  *(_QWORD *)&this->m_vecTurnFriction.y = 0LL;
  *(_QWORD *)&this->m_vecTurnSpeed.y = 0LL;
  *(_QWORD *)&this->m_vecMoveFriction.x = 0LL;
  *(_QWORD *)&this->m_vecMoveSpeed.x = 0LL;
  *(_QWORD *)&this->m_vecMoveSpeed.z = 0LL;
  this->m_aCollisionRecordPtrs[4] = 0;
  this->m_aCollisionRecordPtrs[5] = 0;
  this->m_vecAverageTurnSpeed.y = 0.0;
  this->m_vecAverageTurnSpeed.z = 0.0;
  this->m_LastMaterialToHaveBeenStandingOn = 0;
  *(_WORD *)&this->m_nNoOfStaticFrames = 0;
  *(_QWORD *)&this->m_vecDamageNormal.z = 0LL;
  *(_QWORD *)&this->m_vecDamagePos.y = 0LL;
  *(_QWORD *)&this->m_fDamageImpulseMagnitude = 0LL;
  *(_QWORD *)&this->m_vecDamageNormal.x = 0LL;
  this->m_pMovingListNode = 0;
  this->m_nDamagedPieceType = 0;
  *(_QWORD *)&this->m_AttachQuat.imag.x = 0LL;
  *(_QWORD *)&this->m_AttachQuat.imag.z = 0LL;
  this->m_fPrevDistFromCam = 100.0;
  this->m_vecCOM.x = 0.0;
  this->m_vecCOM.y = 0.0;
  this->m_vecCOM.z = 0.0;
  this->m_pAttachToEntity = 0;
  this->m_fTrueDistanceTravelled = 0.0;
  this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)2;
  m_nFlags = (int)this->m_nFlags;
  this->m_pNOCollisionVehicle = 0;
  this->m_lightingFromCollision = 1.0;
  this->m_lightingFromPointLights = 0.0;
  this->m_pRealTimeShadow = 0;
  *(_DWORD *)&this->m_nFlags = m_nFlags | 1;
}
// 667CAC: using guessed type void *;

//----- (003FCD64) --------------------------------------------------------
void __fastcall CPhysical::~CPhysical(CPhysical *this)
{
  CRealTimeShadow *m_pRealTimeShadow; // r1

  m_pRealTimeShadow = this->m_pRealTimeShadow;
  this->_vptr$CPlaceable = (int (**)(void))&off_667CAC;
  if ( m_pRealTimeShadow )
    CRealTimeShadowManager::ReturnRealTimeShadow(&g_realTimeShadowMan, m_pRealTimeShadow);
  CEntryInfoList::Flush(&this->m_listEntryInfo);
  sub_19CC0C(this);
}
// 667CAC: using guessed type void *off_667CAC;

//----- (003FCDA4) --------------------------------------------------------
void __fastcall CPhysical::~CPhysical(CPhysical *this)
{
  CRealTimeShadow *m_pRealTimeShadow; // r1
  void *v3; // r0

  m_pRealTimeShadow = this->m_pRealTimeShadow;
  this->_vptr$CPlaceable = (int (**)(void))&off_667CAC;
  if ( m_pRealTimeShadow )
    CRealTimeShadowManager::ReturnRealTimeShadow(&g_realTimeShadowMan, m_pRealTimeShadow);
  CEntryInfoList::Flush(&this->m_listEntryInfo);
  CEntity::~CEntity(this);
  sub_191374(v3);
}
// 3FCDDA: variable 'v3' is possibly undefined
// 667CAC: using guessed type void *off_667CAC;

//----- (003FCDE8) --------------------------------------------------------
CRect *__fastcall CPhysical::GetBoundRect(CRect *retstr, const CPhysical *this)
{
  CRect *result; // r0
  float top; // s2
  float v6; // s4
  float v7; // s0
  float v8; // s8
  float v9; // s2
  CVector v10; // [sp+4h] [bp-14h] BYREF

  CEntity::GetBoundCentre(&v10, this);
  result = (CRect *)CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
  top = result[2].top;
  v6 = v10.x - top;
  v7 = top + v10.x;
  v8 = v10.y - top;
  v9 = top + v10.y;
  retstr->left = v6;
  retstr->top = v9;
  retstr->right = v7;
  retstr->bottom = v8;
  return result;
}

//----- (003FCE3C) --------------------------------------------------------
void __fastcall CPhysical::Add(CPhysical *this)
{
  float v2; // s18
  float v3; // s22
  float v4; // s0
  float v5; // s20
  float v6; // r6
  float v7; // s16
  int v8; // s2
  unsigned int v9; // r0
  bool v10; // cc
  bool v11; // cc
  int v12; // r9
  int v13; // r10
  int v14; // r1
  CRepeatSector *v15; // r11
  CEntryInfoNode *v16; // r5
  CPtrNodeDoubleLink *v17; // r0
  CEntryInfoNode *m_pHead; // r0
  int v19; // [sp+4h] [bp-74h]
  int v20; // [sp+Ch] [bp-6Ch]
  float v21[22]; // [sp+20h] [bp-58h] BYREF

  if ( *((unsigned __int8 *)&this->m_nFlags + 1) << 31 )
  {
    sub_18FCA0(this);
  }
  else
  {
    (*((void (__fastcall **)(float *, CPhysical *))this->_vptr$CPlaceable + 10))(v21, this);
    v2 = v21[1];
    v3 = v21[3];
    v4 = (float)(v21[2] / 50.0) + 60.0;
    v5 = floorf((float)(v21[0] / 50.0) + 60.0);
    v6 = floorf((float)(v3 / 50.0) + 60.0);
    v7 = floorf((float)(v2 / 50.0) + 60.0);
    v8 = (int)floorf(v4);
    v9 = (int)v5 + 120;
    v10 = v9 > 0xF0;
    if ( v9 <= 0xF0 )
    {
      v20 = (int)v6;
      v10 = (unsigned int)((int)v6 + 120) > 0xF0;
    }
    if ( !v10 )
    {
      v11 = (unsigned int)(v8 + 120) > 0xF0;
      if ( (unsigned int)(v8 + 120) <= 0xF0 )
      {
        v19 = (int)v7;
        v11 = (unsigned int)((int)v7 + 120) > 0xF0;
      }
      if ( !v11 && v20 <= v19 )
      {
        do
        {
          if ( (int)v5 <= v8 )
          {
            v12 = (int)v5;
            v13 = (unsigned __int8)(16 * v20);
            do
            {
              v14 = *(_BYTE *)&this->m_info & 7;
              switch ( v14 )
              {
                case 4:
                  v15 = (CRepeatSector *)&CWorld::ms_aRepeatSectors[v12 & 0xF | v13].m_ptrListArray[2];
                  break;
                case 3:
                  v15 = (CRepeatSector *)&CWorld::ms_aRepeatSectors[v12 & 0xF | v13].m_ptrListArray[1];
                  break;
                case 2:
                  v15 = &CWorld::ms_aRepeatSectors[v12 & 0xF | v13];
                  break;
                default:
                  v15 = 0;
                  break;
              }
              v16 = (CEntryInfoNode *)CEntryInfoNode::operator new(0x14u);
              v17 = (CPtrNodeDoubleLink *)CPtrNodeDoubleLink::operator new(0xCu);
              v17->m_pVoid = this;
              v17->m_pPrevious = 0;
              v17->m_pNext = v15->m_ptrListArray[0].m_pHead;
              if ( v15->m_ptrListArray[0].m_pHead )
                v15->m_ptrListArray[0].m_pHead[1].m_pVoid = v17;
              v15->m_ptrListArray[0].m_pHead = v17;
              v16->m_pList = (CPtrListDoubleLink *)v15;
              v16->m_pNode = v17;
              v16->m_pSector.m_pStandardSector = (CSector *)&CWorld::ms_aRepeatSectors[v12 & 0xF | v13];
              v16->m_pPrevious = 0;
              v16->m_pNext = this->m_listEntryInfo.m_pHead;
              m_pHead = this->m_listEntryInfo.m_pHead;
              if ( m_pHead )
                m_pHead->m_pPrevious = v16;
              this->m_listEntryInfo.m_pHead = v16;
              v10 = v12++ < v8;
            }
            while ( v10 );
          }
          v10 = v20++ < v19;
        }
        while ( v10 );
      }
    }
  }
}
// 3FCF1E: variable 'v20' is possibly undefined
// 3FCF1E: variable 'v19' is possibly undefined

//----- (003FD02C) --------------------------------------------------------
void __fastcall CPhysical::Remove(CPhysical *this)
{
  CEntryInfoNode *m_pHead; // r5
  __int64 v3; // kr00_8
  CEntryInfoNode *m_pNext; // r6
  CEntryInfoNode *m_pPrevious; // r0
  CEntryInfoNode *v6; // r0

  if ( *((unsigned __int8 *)&this->m_nFlags + 1) << 31 )
  {
    sub_18E08C(this);
  }
  else
  {
    m_pHead = this->m_listEntryInfo.m_pHead;
    if ( m_pHead )
    {
      do
      {
        v3 = *(_QWORD *)&m_pHead->m_pList;
        if ( m_pHead->m_pList->m_pHead == m_pHead->m_pNode )
          *(_DWORD *)v3 = *(_DWORD *)(HIDWORD(v3) + 4);
        if ( *(_DWORD *)(HIDWORD(v3) + 8) )
          *(_DWORD *)(v3 + 4) = *(_DWORD *)(HIDWORD(v3) + 4);
        if ( *(_DWORD *)(HIDWORD(v3) + 4) )
          *(_DWORD *)(v3 + 8) = *(_DWORD *)(HIDWORD(v3) + 8);
        CPtrNodeDoubleLink::operator delete((void *)HIDWORD(v3));
        m_pNext = m_pHead->m_pNext;
        if ( this->m_listEntryInfo.m_pHead == m_pHead )
          this->m_listEntryInfo.m_pHead = m_pNext;
        m_pPrevious = m_pHead->m_pPrevious;
        if ( m_pPrevious )
          m_pPrevious->m_pNext = m_pHead->m_pNext;
        v6 = m_pHead->m_pNext;
        if ( v6 )
          v6->m_pPrevious = m_pHead->m_pPrevious;
        CEntryInfoNode::operator delete(m_pHead);
        m_pHead = m_pNext;
      }
      while ( m_pNext );
    }
  }
}

//----- (003FD0AC) --------------------------------------------------------
void __fastcall CPhysical::RemoveAndAdd(CPhysical *this)
{
  CEntryInfoNode *m_pHead; // r5
  float v3; // s18
  float v4; // s20
  float v5; // s22
  float v6; // r8
  float v7; // r9
  float v8; // r6
  float v9; // r0
  CPhysical *v10; // r3
  int v11; // s0
  int v12; // r1
  CEntryInfoNode *m_pNext; // r6
  int v14; // r2
  CRepeatSector *v15; // r12
  int v16; // r4
  int v17; // r0
  int v18; // r11
  unsigned int v19; // r0
  int v20; // r1
  __int64 v21; // r8
  CPtrListDoubleLink *m_ptrListArray; // r6
  __int64 v23; // kr00_8
  CRepeatSector *v24; // r4
  CPhysical *v25; // r9
  CPtrNode *v26; // r0
  CPtrNode *v27; // r5
  CEntryInfoNode *v28; // r0
  CEntryInfoNode *v29; // r1
  __int64 v30; // kr08_8
  CEntryInfoNode *v31; // r4
  CEntryInfoNode *m_pPrevious; // r0
  CEntryInfoNode *v33; // r0
  int v34; // [sp+4h] [bp-74h]
  int v35; // [sp+8h] [bp-70h]
  int v36; // [sp+Ch] [bp-6Ch]
  int v37; // [sp+18h] [bp-60h]
  float v39[22]; // [sp+20h] [bp-58h] BYREF

  if ( *((unsigned __int8 *)&this->m_nFlags + 1) << 31 )
  {
    CEntity::Remove(this);
    sub_18FCA0(this);
    return;
  }
  m_pHead = this->m_listEntryInfo.m_pHead;
  (*((void (__fastcall **)(float *, CPhysical *))this->_vptr$CPlaceable + 10))(v39, this);
  v3 = v39[1];
  v4 = v39[2];
  v5 = v39[3];
  v6 = floorf((float)(v39[0] / 50.0) + 60.0);
  v7 = floorf((float)(v5 / 50.0) + 60.0);
  v8 = floorf((float)(v4 / 50.0) + 60.0);
  v9 = floorf((float)(v3 / 50.0) + 60.0);
  v10 = this;
  v11 = (int)v8;
  v12 = (int)v7;
  v35 = (int)v9;
  if ( (int)v7 <= (int)v9 )
  {
    v14 = (int)v6;
    m_pNext = m_pHead;
    v15 = CWorld::ms_aRepeatSectors;
    v34 = (int)v6;
    while ( 1 )
    {
      v36 = v12;
      if ( v14 <= v11 )
        break;
LABEL_35:
      v14 = v34;
      v12 = v36 + 1;
      if ( v36 >= v35 )
      {
        if ( m_pHead )
          goto LABEL_37;
        return;
      }
    }
    v16 = (unsigned __int8)(16 * v12);
    v17 = v14;
    v37 = v16;
    while ( 1 )
    {
      v18 = v17;
      v19 = v17 & 0xF | v16;
      v20 = *(_BYTE *)&v10->m_info & 7;
      LODWORD(v21) = &v15[v19];
      if ( v20 == 4 )
      {
        m_ptrListArray = &CWorld::ms_aRepeatSectors[v19].m_ptrListArray[2];
        if ( !m_pHead )
          goto LABEL_25;
      }
      else if ( v20 == 3 )
      {
        m_ptrListArray = &CWorld::ms_aRepeatSectors[v19].m_ptrListArray[1];
        if ( !m_pHead )
          goto LABEL_25;
      }
      else
      {
        if ( v20 == 2 )
          m_ptrListArray = v15[v19].m_ptrListArray;
        else
          m_ptrListArray = 0;
        if ( !m_pHead )
        {
LABEL_25:
          if ( m_ptrListArray )
          {
            v24 = v15;
            v25 = v10;
            v26 = (CPtrNode *)CPtrNodeDoubleLink::operator new(0xCu);
            v27 = v26;
            v26->m_pVoid = v25;
            HIDWORD(v21) = 0;
            v26[1].m_pVoid = 0;
            v26->m_pNext = m_ptrListArray->m_pHead;
            if ( m_ptrListArray->m_pHead )
              m_ptrListArray->m_pHead[1].m_pVoid = v26;
            m_ptrListArray->m_pHead = v26;
            v28 = (CEntryInfoNode *)CEntryInfoNode::operator new(0x14u);
            v28->m_pList = m_ptrListArray;
            v28->m_pNode = (CPtrNodeDoubleLink *)v27;
            v15 = v24;
            *(_QWORD *)&v28->m_pSector.m_pStandardSector = v21;
            m_pNext = 0;
            v10 = this;
            m_pHead = 0;
            v28->m_pNext = this->m_listEntryInfo.m_pHead;
            v29 = this->m_listEntryInfo.m_pHead;
            if ( v29 )
              v29->m_pPrevious = v28;
            this->m_listEntryInfo.m_pHead = v28;
            v16 = v37;
          }
          else
          {
            m_pNext = 0;
            m_pHead = 0;
          }
          goto LABEL_34;
        }
      }
      v23 = *(_QWORD *)&m_pHead->m_pList;
      if ( m_pHead->m_pList->m_pHead == m_pHead->m_pNode )
        *(_DWORD *)v23 = *(_DWORD *)(HIDWORD(v23) + 4);
      if ( *(_DWORD *)(HIDWORD(v23) + 8) )
        *(_DWORD *)(v23 + 4) = *(_DWORD *)(HIDWORD(v23) + 4);
      if ( *(_DWORD *)(HIDWORD(v23) + 4) )
        *(_DWORD *)(v23 + 8) = *(_DWORD *)(HIDWORD(v23) + 8);
      *(_QWORD *)(HIDWORD(v23) + 4) = (unsigned int)m_ptrListArray->m_pHead;
      if ( m_ptrListArray->m_pHead )
        m_ptrListArray->m_pHead[1].m_pVoid = (void *)HIDWORD(v23);
      m_ptrListArray->m_pHead = *(CPtrNode **)((char *)&v23 + 4);
      m_pHead->m_pList = m_ptrListArray;
      m_pNext = m_pHead->m_pNext;
      m_pHead->m_pSector.m_pStandardSector = (CSector *)v21;
      m_pHead = m_pNext;
LABEL_34:
      v17 = v18 + 1;
      if ( v18 >= v11 )
        goto LABEL_35;
    }
  }
  m_pNext = m_pHead;
  if ( m_pHead )
  {
    do
    {
LABEL_37:
      v30 = *(_QWORD *)&m_pHead->m_pList;
      if ( m_pHead->m_pList->m_pHead == m_pHead->m_pNode )
        *(_DWORD *)v30 = *(_DWORD *)(HIDWORD(v30) + 4);
      if ( *(_DWORD *)(HIDWORD(v30) + 8) )
        *(_DWORD *)(v30 + 4) = *(_DWORD *)(HIDWORD(v30) + 4);
      if ( *(_DWORD *)(HIDWORD(v30) + 4) )
        *(_DWORD *)(v30 + 8) = *(_DWORD *)(HIDWORD(v30) + 8);
      CPtrNodeDoubleLink::operator delete((void *)HIDWORD(v30));
      v31 = m_pHead->m_pNext;
      if ( this->m_listEntryInfo.m_pHead == m_pHead )
        this->m_listEntryInfo.m_pHead = v31;
      m_pPrevious = m_pHead->m_pPrevious;
      if ( m_pPrevious )
        m_pPrevious->m_pNext = m_pHead->m_pNext;
      v33 = m_pHead->m_pNext;
      if ( v33 )
        v33->m_pPrevious = m_pHead->m_pPrevious;
      CEntryInfoNode::operator delete(m_pNext);
      m_pHead = v31;
      m_pNext = v31;
    }
    while ( v31 );
  }
}

//----- (003FD334) --------------------------------------------------------
void __fastcall CPhysical::AddToMovingList(CPhysical *this)
{
  CPtrNodeDoubleLink *v2; // r0
  CPtrNode *m_pHead; // r1

  if ( !this->m_pMovingListNode && (*((_BYTE *)&this->m_nFlags + 2) & 4) == 0 )
  {
    v2 = (CPtrNodeDoubleLink *)CPtrNodeDoubleLink::operator new(0xCu);
    v2->m_pVoid = this;
    this->m_pMovingListNode = v2;
    v2->m_pPrevious = 0;
    m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
    v2->m_pNext = CWorld::ms_listMovingEntityPtrs.m_pHead;
    if ( m_pHead )
      m_pHead[1].m_pVoid = v2;
    CWorld::ms_listMovingEntityPtrs.m_pHead = v2;
  }
}

//----- (003FD37C) --------------------------------------------------------
void __fastcall CPhysical::RemoveFromMovingList(CPhysical *this)
{
  CPtrNodeDoubleLink *m_pMovingListNode; // r0
  CPtrNodeDoubleLink *m_pPrevious; // r1
  CPtrNode *m_pNext; // r1
  CPtrNodeDoubleLink *v5; // r0

  m_pMovingListNode = this->m_pMovingListNode;
  if ( m_pMovingListNode )
  {
    if ( CWorld::ms_listMovingEntityPtrs.m_pHead == m_pMovingListNode )
      CWorld::ms_listMovingEntityPtrs.m_pHead = m_pMovingListNode->m_pNext;
    m_pPrevious = m_pMovingListNode->m_pPrevious;
    if ( m_pPrevious )
      m_pPrevious->m_pNext = m_pMovingListNode->m_pNext;
    m_pNext = m_pMovingListNode->m_pNext;
    if ( m_pNext )
      m_pNext[1].m_pVoid = m_pMovingListNode->m_pPrevious;
    v5 = this->m_pMovingListNode;
    if ( v5 )
      CPtrNodeDoubleLink::operator delete(v5);
    this->m_pMovingListNode = 0;
  }
}

//----- (003FD3D4) --------------------------------------------------------
void __fastcall CPhysical::SetDamagedPieceRecord(
        CPhysical *this,
        float fImpulseMagnitude,
        CEntity *pEntity,
        CColPoint *colPoint,
        float fReverseNormal)
{
  uint16 m_nPieceType; // r1
  CEntity *m_pDamageEntity; // r0
  __int64 v11; // d16
  RwReal v12; // s2
  RwReal v13; // s4
  int v14; // r0
  bool v15; // zf
  char v16; // r1

  if ( this->m_fDamageImpulseMagnitude < fImpulseMagnitude )
  {
    m_nPieceType = colPoint->m_dataA.m_nPieceType;
    m_pDamageEntity = this->m_pDamageEntity;
    this->m_fDamageImpulseMagnitude = fImpulseMagnitude;
    this->m_nDamagedPieceType = m_nPieceType;
    if ( m_pDamageEntity )
      CEntity::CleanUpOldReference(m_pDamageEntity, &this->m_pDamageEntity);
    this->m_pDamageEntity = pEntity;
    CEntity::RegisterReference(pEntity, &this->m_pDamageEntity);
    v11 = *(_QWORD *)&colPoint->m_vecPosition.x;
    this->m_vecDamagePos.z = colPoint->m_vecPosition.z;
    *(_QWORD *)&this->m_vecDamagePos.x = v11;
    v12 = colPoint->m_vecNormal.y * fReverseNormal;
    v13 = colPoint->m_vecNormal.z * fReverseNormal;
    v14 = *(_BYTE *)&this->m_info & 7;
    v15 = v14 == 4;
    this->m_vecDamageNormal.x = colPoint->m_vecNormal.x * fReverseNormal;
    this->m_vecDamageNormal.y = v12;
    this->m_vecDamageNormal.z = v13;
    if ( v14 == 4 )
      v15 = colPoint->m_dataB.m_nSurfaceType == 65;
    if ( v15 )
    {
      LODWORD(this[1].m_transform.m_translate.y) |= 0x80000u;
    }
    else if ( (*(_BYTE *)&pEntity->m_info & 7) == 4 && colPoint->m_dataA.m_nSurfaceType == 65 )
    {
      pEntity[5].m_pRwObject = (RwObject_0 *)((int)pEntity[5].m_pRwObject | 0x80000);
    }
  }
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x80) != 0
    && pEntity->m_nModelIndex == MI_POOL_CUE_BALL
    && (*(_BYTE *)&this->m_info & 7) == 4 )
  {
    v16 = 50;
    if ( LOBYTE(this[1].m_transform.m_heading) == 255 )
      v16 = 53;
    LOBYTE(this[1].m_transform.m_heading) = v16;
  }
}

//----- (003FD4D8) --------------------------------------------------------
void __fastcall CPhysical::ApplyMoveForce(CPhysical *this, CVector vecForce)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r12
  float z; // s6
  float v4; // s0
  float v5; // s8
  RwReal v6; // s4

  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x60) == 0 )
  {
    z = this->m_vecMoveSpeed.z;
    v4 = 1.0 / this->m_fMass;
    v5 = 0.0;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) == 0 )
      v5 = vecForce.z;
    v6 = (float)(v4 * vecForce.y) + this->m_vecMoveSpeed.y;
    this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v4 * vecForce.x);
    this->m_vecMoveSpeed.y = v6;
    this->m_vecMoveSpeed.z = (float)(v5 * v4) + z;
  }
}

//----- (003FD540) --------------------------------------------------------
void __fastcall CPhysical::ApplyTurnForce(CPhysical *this, CVector vecForce, CVector vecOffset)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float x; // s0
  float y; // s2
  float z; // s4
  float v8; // r0
  float v9; // s0
  RwReal v10; // s2
  RwReal v11; // s4
  RwReal v12; // s0
  CVector v1; // [sp+4h] [bp-2Ch] BYREF
  CVector v14; // [sp+10h] [bp-20h] BYREF
  CVector v2; // [sp+1Ch] [bp-14h] BYREF

  v2 = vecForce;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) == 0 )
  {
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 )
    {
      x = 0.0;
      y = 0.0;
      z = 0.0;
    }
    else
    {
      Multiply3x3(&v14, this->m_pMat, &this->m_vecCOM);
      m_nPhysicalFlags = this->m_nPhysicalFlags;
      x = v14.x;
      y = v14.y;
      z = v14.z;
    }
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x20) != 0 )
    {
      v8 = 0.0;
      v2.z = 0.0;
    }
    else
    {
      v8 = vecOffset.z;
    }
    v1.y = vecOffset.y - y;
    v1.x = vecOffset.x - x;
    v1.z = v8 - z;
    CrossProduct(&v14, &v1, &v2);
    v9 = 1.0 / this->m_fTurnMass;
    v2.x = v9 * v14.x;
    v2.y = v9 * v14.y;
    v2.z = v9 * v14.z;
    v10 = (float)(v9 * v14.x) + this->m_vecTurnSpeed.x;
    v11 = (float)(v9 * v14.y) + this->m_vecTurnSpeed.y;
    v12 = (float)(v9 * v14.z) + this->m_vecTurnSpeed.z;
    this->m_vecTurnSpeed.x = v10;
    this->m_vecTurnSpeed.y = v11;
    this->m_vecTurnSpeed.z = v12;
  }
}

//----- (003FD618) --------------------------------------------------------
void __fastcall CPhysical::ApplyForce(CPhysical *this, CVector vecForce, CVector vecOffset, int bValidTorque)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float z; // s6
  float v7; // s0
  float v8; // s8
  RwReal v9; // s4
  float m_fTurnMass; // s16
  float x; // s2
  float y; // s4
  float v13; // s0
  float v14; // r0
  RwReal v15; // s4
  RwReal v16; // s0
  CVector v1; // [sp+4h] [bp-34h] BYREF
  CVector v18; // [sp+10h] [bp-28h] BYREF
  CVector v2; // [sp+1Ch] [bp-1Ch] BYREF

  v2 = vecForce;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x60) == 0 )
  {
    z = this->m_vecMoveSpeed.z;
    v7 = 1.0 / this->m_fMass;
    v8 = 0.0;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) == 0 )
      v8 = vecForce.z;
    v9 = (float)(v7 * vecForce.y) + this->m_vecMoveSpeed.y;
    this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v7 * vecForce.x);
    this->m_vecMoveSpeed.y = v9;
    this->m_vecMoveSpeed.z = (float)(v8 * v7) + z;
  }
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) == 0 && bValidTorque )
  {
    m_fTurnMass = this->m_fTurnMass;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 )
    {
      m_fTurnMass = m_fTurnMass + (float)(this->m_vecCOM.z * (float)((float)(this->m_fMass * 0.5) * this->m_vecCOM.z));
      v13 = 0.0;
      y = 0.0;
      x = 0.0;
    }
    else
    {
      Multiply3x3(&v18, this->m_pMat, &this->m_vecCOM);
      m_nPhysicalFlags = this->m_nPhysicalFlags;
      x = v18.x;
      y = v18.y;
      v13 = v18.z;
    }
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x20) != 0 )
    {
      v14 = 0.0;
      v2.z = 0.0;
    }
    else
    {
      v14 = vecOffset.z;
    }
    v1.y = vecOffset.y - y;
    v1.x = vecOffset.x - x;
    v1.z = v14 - v13;
    CrossProduct(&v18, &v1, &v2);
    v2.x = (float)(1.0 / m_fTurnMass) * v18.x;
    v2.y = (float)(1.0 / m_fTurnMass) * v18.y;
    v2.z = (float)(1.0 / m_fTurnMass) * v18.z;
    v15 = v2.y + this->m_vecTurnSpeed.y;
    v16 = v2.z + this->m_vecTurnSpeed.z;
    this->m_vecTurnSpeed.x = v2.x + this->m_vecTurnSpeed.x;
    this->m_vecTurnSpeed.y = v15;
    this->m_vecTurnSpeed.z = v16;
  }
}

//----- (003FD774) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
CVector *__fastcall CPhysical::GetSpeed(CVector *retstr, CPhysical *this, CVector vecOffset)
{
  float y; // r6
  float x; // r8
  float v7; // s0
  float v8; // s2
  float z; // s4
  RwReal v10; // s6
  RwReal v11; // s8
  RwReal v12; // s10
  CVector *result; // r0
  RwReal v14; // s2
  RwReal v15; // s4
  CVector v2; // [sp+4h] [bp-3Ch] BYREF
  CVector v1; // [sp+10h] [bp-30h] BYREF
  CVector v18; // [sp+1Ch] [bp-24h] BYREF

  y = vecOffset.y;
  x = vecOffset.x;
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x40) != 0 )
  {
    v7 = 0.0;
    v8 = 0.0;
    z = 0.0;
  }
  else
  {
    Multiply3x3(&v18, this->m_pMat, &this->m_vecCOM);
    v7 = v18.x;
    v8 = v18.y;
    z = v18.z;
  }
  v10 = this->m_vecTurnSpeed.x + this->m_vecTurnFriction.x;
  v11 = this->m_vecTurnSpeed.y + this->m_vecTurnFriction.y;
  v12 = this->m_vecTurnSpeed.z + this->m_vecTurnFriction.z;
  v2.y = y - v8;
  v1.y = v11;
  v1.x = v10;
  v1.z = v12;
  v2.x = x - v7;
  v2.z = vecOffset.z - z;
  result = CrossProduct(&v18, &v1, &v2);
  v14 = (float)(v18.y + this->m_vecMoveSpeed.y) + this->m_vecMoveFriction.y;
  v15 = (float)(v18.z + this->m_vecMoveSpeed.z) + this->m_vecMoveFriction.z;
  retstr->x = (float)(v18.x + this->m_vecMoveSpeed.x) + this->m_vecMoveFriction.x;
  retstr->y = v14;
  retstr->z = v15;
  return result;
}
// 3FD774: fragmented variable at 0:r2.8,8:^48.4 may be wrong
// 3FD774: variables would overlap: 0:r2.8,8:^48.4 and ^48.4

//----- (003FD86C) --------------------------------------------------------
void __fastcall CPhysical::ApplyMoveSpeed(CPhysical *this)
{
  float v1; // s2

  if ( (*(_WORD *)&this->m_nPhysicalFlags & 0x2020) != 0 )
  {
    this->m_vecMoveSpeed.x = 0.0;
    this->m_vecMoveSpeed.y = 0.0;
    this->m_vecMoveSpeed.z = 0.0;
  }
  else
  {
    v1 = CTimer::ms_fTimeStep;
    this->m_pMat->tx = (float)(this->m_vecMoveSpeed.x * CTimer::ms_fTimeStep) + this->m_pMat->tx;
    this->m_pMat->ty = (float)(this->m_vecMoveSpeed.y * v1) + this->m_pMat->ty;
    this->m_pMat->tz = (float)(this->m_vecMoveSpeed.z * v1) + this->m_pMat->tz;
  }
}

//----- (003FD8D4) --------------------------------------------------------
void __fastcall CPhysical::ApplyTurnSpeed(CPhysical *this)
{
  RwReal v2; // s2
  RwReal v3; // s4
  RwReal v4; // s0
  CMatrix *m_pMat; // r1
  RwReal v6; // s4
  CVector v7; // [sp+0h] [bp-48h] BYREF
  CVector v8; // [sp+Ch] [bp-3Ch] BYREF
  CVector v9; // [sp+18h] [bp-30h] BYREF
  CVector v10; // [sp+28h] [bp-20h] BYREF
  CVector v1; // [sp+34h] [bp-14h] BYREF

  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 1) & 0x20) != 0 )
  {
    this->m_vecTurnSpeed.x = 0.0;
    this->m_vecTurnSpeed.y = 0.0;
    this->m_vecTurnSpeed.z = 0.0;
  }
  else
  {
    v2 = CTimer::ms_fTimeStep * this->m_vecTurnSpeed.y;
    v3 = CTimer::ms_fTimeStep * this->m_vecTurnSpeed.z;
    v1.x = CTimer::ms_fTimeStep * this->m_vecTurnSpeed.x;
    v1.y = v2;
    v1.z = v3;
    CrossProduct(&v10, &v1, (const CVector *)this->m_pMat);
    this->m_pMat->xx = v10.x + this->m_pMat->xx;
    this->m_pMat->yx = v10.y + this->m_pMat->yx;
    this->m_pMat->zx = v10.z + this->m_pMat->zx;
    CrossProduct(&v9, &v1, (const CVector *)&this->m_pMat->xy);
    v10 = v9;
    this->m_pMat->xy = v9.x + this->m_pMat->xy;
    this->m_pMat->yy = v10.y + this->m_pMat->yy;
    this->m_pMat->zy = v10.z + this->m_pMat->zy;
    CrossProduct(&v9, &v1, (const CVector *)&this->m_pMat->xz);
    v10 = v9;
    this->m_pMat->xz = v9.x + this->m_pMat->xz;
    this->m_pMat->yz = v10.y + this->m_pMat->yz;
    this->m_pMat->zz = v10.z + this->m_pMat->zz;
    if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x60) == 0 )
    {
      v4 = -this->m_vecCOM.x;
      m_pMat = this->m_pMat;
      v6 = -this->m_vecCOM.z;
      v7.y = -this->m_vecCOM.y;
      v7.x = v4;
      v7.z = v6;
      Multiply3x3(&v8, m_pMat, &v7);
      CrossProduct(&v9, &v1, &v8);
      v10 = v9;
      this->m_pMat->tx = v9.x + this->m_pMat->tx;
      this->m_pMat->ty = v10.y + this->m_pMat->ty;
      this->m_pMat->tz = v10.z + this->m_pMat->tz;
    }
  }
}

//----- (003FDA94) --------------------------------------------------------
void __fastcall CPhysical::ApplySpeed(CPhysical *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  float32x2_t v4; // d3
  float32x2_t v5; // d8
  float32x2_t v6; // d9
  float32x2_t v7; // d12
  float32x2_t v8; // d13
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r5
  float v11; // s18
  CMatrix *v12; // r0
  float m_heading; // s20
  CMatrix *m_pMat; // r0
  float x; // s0
  float tx; // s2
  float v17; // s4
  float v18; // s4
  float y; // s4
  float ty; // s12
  float v21; // s10
  float v22; // s28
  float v23; // s30
  float v24; // s24
  float v25; // s4
  float v26; // s22
  float v27; // s6
  float v28; // s20
  CMatrix *v29; // r0
  float v30; // s0
  float v31; // s2
  float v32; // s0
  float v33; // s0
  float v34; // s0
  float v35; // s0
  float v36; // s2
  float32x2_t v37; // d0
  float32x2_t v38; // d0
  CMatrix *v39; // r0
  float v40; // s0
  float v41; // s4
  float v42; // s0
  float v43; // s2
  float v44; // s0
  float v45; // s0
  float v46; // s2
  float v47; // s0
  float v48; // s2
  float v49; // s6
  float v50; // s4
  CSimpleTransform *p_tx; // r2
  float m_fRadius; // s2
  float v53; // s4
  float v54; // s8
  float v55; // s6
  float z; // s10
  float v57; // s0
  float v58; // s2
  char v59; // r1
  float v60; // s2
  CColPoint colPoint; // [sp+4h] [bp-74h] BYREF

  m_nPhysicalFlags = this->m_nPhysicalFlags;
  v5.n64_f32[0] = CTimer::ms_fTimeStep;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) != 0 )
  {
    m_pMat = this->m_pMat;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 2) != 0 )
    {
      if ( (float)(m_pMat->tz + (float)(CTimer::ms_fTimeStep * this->m_vecMoveSpeed.z)) < CWorld::SnookerTableMin.z )
      {
        m_pMat->tz = CWorld::SnookerTableMin.z;
        this->m_vecTurnSpeed.y = 0.0;
        this->m_vecTurnSpeed.z = 0.0;
        *(_QWORD *)&this->m_vecMoveSpeed.x = 0LL;
        *(_QWORD *)&this->m_vecMoveSpeed.z = 0LL;
      }
      goto LABEL_97;
    }
    x = this->m_vecMoveSpeed.x;
    tx = m_pMat->tx;
    v17 = tx + (float)(CTimer::ms_fTimeStep * x);
    if ( v17 <= CWorld::SnookerTableMax.x )
    {
      v6.n64_u32[0] = 1148846080;
      if ( x >= 0.0 || v17 >= CWorld::SnookerTableMin.x )
      {
LABEL_12:
        y = this->m_vecMoveSpeed.y;
        ty = m_pMat->ty;
        if ( y <= 0.0 )
        {
          v8.n64_u32[0] = 1148846080;
          v21 = CWorld::SnookerTableMin.y;
          if ( y < 0.0 )
            v8.n64_f32[0] = (float)(CWorld::SnookerTableMin.y - ty) / y;
        }
        else
        {
          v8.n64_f32[0] = (float)(CWorld::SnookerTableMax.y - ty) / y;
          v21 = CWorld::SnookerTableMin.y;
        }
        v22 = CWorld::SnookerTableMax.y - v21;
        v23 = CWorld::SnookerTableMax.x - CWorld::SnookerTableMin.x;
        if ( v6.n64_f32[0] < 1000.0 )
        {
          v24 = 1.0;
          if ( x > 0.0 )
            v24 = -1.0;
          v3.n64_u32[0] = 925353388;
          LODWORD(v25) = vmax_f32(v6, v3).n64_u32[0];
          CTimer::ms_fTimeStep = v25;
          if ( (*(_WORD *)&m_nPhysicalFlags & 0x2020) != 0 )
          {
            this->m_vecMoveSpeed.x = 0.0;
            this->m_vecMoveSpeed.y = 0.0;
            this->m_vecMoveSpeed.z = 0.0;
          }
          else
          {
            m_pMat->tx = (float)(v25 * x) + tx;
            this->m_pMat->ty = (float)(v25 * this->m_vecMoveSpeed.y) + this->m_pMat->ty;
            this->m_pMat->tz = (float)(v25 * this->m_vecMoveSpeed.z) + this->m_pMat->tz;
          }
          v28 = fabsf(x);
          CPhysical::ApplyTurnSpeed(this);
          v29 = this->m_pMat;
          v30 = v29->ty;
          if ( v30 <= (float)(CWorld::SnookerTableMax.y + -0.06) && v30 >= (float)(CWorld::SnookerTableMin.y + 0.06) )
          {
            if ( v22 <= v23
              || (v41 = (float)(CWorld::SnookerTableMax.y + CWorld::SnookerTableMin.y) * 0.5, v30 <= (float)(v41 + -0.06))
              || v30 >= (float)(v41 + 0.06) )
            {
              v33 = -this->m_vecMoveSpeed.x;
              goto LABEL_40;
            }
          }
          v31 = 0.03;
          v32 = v5.n64_f32[0] * this->m_vecMoveSpeed.x;
          *(_DWORD *)&this->m_nPhysicalFlags |= 2u;
          if ( v32 > 0.03 || (v31 = -0.03, v32 < -0.03) )
          {
            v33 = v31 / v5.n64_f32[0];
LABEL_40:
            v26 = 0.0;
            this->m_vecMoveSpeed.x = v33;
            goto LABEL_90;
          }
          v26 = 0.0;
LABEL_90:
          v2.n64_f32[0] = v5.n64_f32[0] - v6.n64_f32[0];
          v1.n64_u32[0] = 925353388;
          v1.n64_u64[0] = vmax_f32(v2, v1).n64_u64[0];
          CTimer::ms_fTimeStep = v1.n64_f32[0];
          if ( v28 > 0.0 )
          {
            p_tx = (CSimpleTransform *)&v29->tx;
            m_fRadius = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
            if ( !v29 )
              p_tx = &this->m_transform;
            v53 = v26 * m_fRadius;
            v54 = p_tx->m_translate.y;
            v55 = v24 * m_fRadius;
            z = p_tx->m_translate.z;
            v57 = m_fRadius * -0.0;
            v58 = p_tx->m_translate.x;
            colPoint.m_vecNormal.x = v24;
            colPoint.m_vecNormal.z = 0.0;
            colPoint.m_vecNormal.y = v26;
            colPoint.m_vecPosition.y = v54 - v53;
            colPoint.m_vecPosition.x = v58 - v55;
            colPoint.m_vecPosition.z = z + v57;
            CPhysical::ApplyFriction(this, v28 * 10.0, &colPoint);
            if ( (*(_BYTE *)&this->m_info & 7) == 4 )
            {
              CAudioEngine::ReportMissionAudioEvent(&AudioEngine, 0x3F8u, (CObject *)this);
              v59 = 50;
              if ( LOBYTE(this[1].m_transform.m_heading) == 255 )
                v59 = 54;
              LOBYTE(this[1].m_transform.m_heading) = v59;
            }
          }
          goto LABEL_97;
        }
        if ( v8.n64_f32[0] >= 1000.0 )
          goto LABEL_97;
        v26 = 1.0;
        if ( y > 0.0 )
          v26 = -1.0;
        v4.n64_u32[0] = 925353388;
        LODWORD(v27) = vmax_f32(v8, v4).n64_u32[0];
        CTimer::ms_fTimeStep = v27;
        if ( (*(_WORD *)&m_nPhysicalFlags & 0x2020) != 0 )
        {
          this->m_vecMoveSpeed.x = 0.0;
          this->m_vecMoveSpeed.y = 0.0;
          this->m_vecMoveSpeed.z = 0.0;
        }
        else
        {
          m_pMat->tx = (float)(v27 * x) + tx;
          this->m_pMat->ty = (float)(v27 * this->m_vecMoveSpeed.y) + this->m_pMat->ty;
          this->m_pMat->tz = (float)(v27 * this->m_vecMoveSpeed.z) + this->m_pMat->tz;
        }
        v28 = fabsf(y);
        CPhysical::ApplyTurnSpeed(this);
        v29 = this->m_pMat;
        v42 = v29->tx;
        if ( v42 > (float)(CWorld::SnookerTableMax.x + -0.06)
          || v42 < (float)(CWorld::SnookerTableMin.x + 0.06)
          || v22 <= v23
          && (v50 = (float)(CWorld::SnookerTableMax.x + CWorld::SnookerTableMin.x) * 0.5, v42 > (float)(v50 + -0.06))
          && v42 < (float)(v50 + 0.06) )
        {
          v43 = 0.03;
          v44 = v5.n64_f32[0] * this->m_vecMoveSpeed.y;
          *(_DWORD *)&this->m_nPhysicalFlags |= 2u;
          if ( v44 <= 0.03 )
          {
            v43 = -0.03;
            if ( v44 >= -0.03 )
            {
              v24 = 0.0;
              goto LABEL_89;
            }
          }
          v45 = v43 / v5.n64_f32[0];
        }
        else
        {
          v45 = -this->m_vecMoveSpeed.y;
        }
        v24 = 0.0;
        this->m_vecMoveSpeed.y = v45;
LABEL_89:
        v6.n64_u32[0] = v8.n64_u32[0];
        goto LABEL_90;
      }
      v18 = CWorld::SnookerTableMin.x - tx;
    }
    else
    {
      v18 = CWorld::SnookerTableMax.x - tx;
    }
    v6.n64_f32[0] = v18 / x;
    goto LABEL_12;
  }
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x20) == 0
    || (*(_BYTE *)&this->m_info & 7) != 4
    || (v7.n64_u32[0] = -998637568, v11 = *(float *)&this[1].m_nFlags.bdummy, v11 <= -1000.0) )
  {
LABEL_97:
    if ( (*(_WORD *)&this->m_nPhysicalFlags & 0x2020) != 0 )
    {
      this->m_vecMoveSpeed.x = 0.0;
      this->m_vecMoveSpeed.y = 0.0;
      this->m_vecMoveSpeed.z = 0.0;
    }
    else
    {
      v60 = CTimer::ms_fTimeStep;
      this->m_pMat->tx = (float)(this->m_vecMoveSpeed.x * CTimer::ms_fTimeStep) + this->m_pMat->tx;
      this->m_pMat->ty = (float)(v60 * this->m_vecMoveSpeed.y) + this->m_pMat->ty;
      this->m_pMat->tz = (float)(v60 * this->m_vecMoveSpeed.z) + this->m_pMat->tz;
    }
    CPhysical::ApplyTurnSpeed(this);
    v1.n64_u32[0] = 925353388;
    LODWORD(CTimer::ms_fTimeStep) = vmax_f32(v5, v1).n64_u32[0];
    return;
  }
  v12 = this->m_pMat;
  if ( v12 )
    m_heading = atan2f(COERCE_FLOAT(LODWORD(v12->xy) ^ 0x80000000), v12->yy);
  else
    m_heading = this->m_transform.m_heading;
  if ( m_heading <= (float)(v11 + 3.1416) )
  {
    if ( m_heading >= (float)(v11 + -3.1416) )
      goto LABEL_48;
    v34 = 6.2832;
  }
  else
  {
    v34 = -6.2832;
  }
  m_heading = m_heading + v34;
LABEL_48:
  v35 = this->m_vecTurnSpeed.z;
  if ( v35 > 0.0 && (v36 = v11 + 1.885, (float)(m_heading + (float)(v35 * v5.n64_f32[0])) > (float)(v11 + 1.885))
    || v35 < 0.0 && (v36 = v11 + -1.885, (float)(m_heading + (float)(v35 * v5.n64_f32[0])) < (float)(v11 + -1.885)) )
  {
    v7.n64_f32[0] = (float)(v36 - m_heading) / v35;
  }
  v37.n64_u64[0] = v5.n64_u64[0];
  if ( v7.n64_f32[0] >= (float)-v5.n64_f32[0] )
  {
    v8.n64_u32[0] = 925353388;
    v38.n64_u64[0] = vmax_f32(v7, v8).n64_u64[0];
    CTimer::ms_fTimeStep = v38.n64_f32[0];
    CPhysical::ApplyTurnSpeed(this);
    v38.n64_f32[0] = v5.n64_f32[0] - v7.n64_f32[0];
    v37.n64_u64[0] = vmax_f32(v38, v8).n64_u64[0];
    this->m_vecTurnSpeed.z = this->m_vecTurnSpeed.z * -0.2;
    CTimer::ms_fTimeStep = v37.n64_f32[0];
    m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&this->m_nPhysicalFlags | 0x40000000);
    this->m_nPhysicalFlags = m_nPhysicalFlags;
  }
  if ( (*(_WORD *)&m_nPhysicalFlags & 0x2020) != 0 )
  {
    this->m_vecMoveSpeed.x = 0.0;
    this->m_vecMoveSpeed.y = 0.0;
    this->m_vecMoveSpeed.z = 0.0;
  }
  else
  {
    this->m_pMat->tx = (float)(this->m_vecMoveSpeed.x * v37.n64_f32[0]) + this->m_pMat->tx;
    this->m_pMat->ty = (float)(v37.n64_f32[0] * this->m_vecMoveSpeed.y) + this->m_pMat->ty;
    this->m_pMat->tz = (float)(v37.n64_f32[0] * this->m_vecMoveSpeed.z) + this->m_pMat->tz;
  }
  CPhysical::ApplyTurnSpeed(this);
  v37.n64_u32[0] = 925353388;
  LODWORD(CTimer::ms_fTimeStep) = vmax_f32(v5, v37).n64_u32[0];
  if ( (BYTE1(this[1].m_transform.m_translate.y) & 0x40) != 0 )
  {
    v39 = this->m_pMat;
    if ( v39 )
      v40 = atan2f(COERCE_FLOAT(LODWORD(v39->xy) ^ 0x80000000), v39->yy);
    else
      v40 = this->m_transform.m_heading;
    if ( v11 <= (float)(v40 + 3.1416) )
    {
      if ( v11 >= (float)(v40 + -3.1416) )
      {
LABEL_76:
        v47 = v40 - v11;
        v48 = m_heading - v11;
        v49 = fabsf(m_heading - v11);
        if ( fabsf(v47) < 0.001 )
          v47 = 0.0;
        if ( v49 < 0.001 )
          v48 = 0.0;
        if ( (float)(v48 * v47) < 0.0 )
          this->m_vecTurnSpeed.z = 0.0;
        return;
      }
      v46 = -6.2832;
    }
    else
    {
      v46 = 6.2832;
    }
    v40 = v40 + v46;
    goto LABEL_76;
  }
}
// 3FDC5E: variable 'v6' is possibly undefined
// 3FDC5E: variable 'v3' is possibly undefined
// 3FDCA6: variable 'v8' is possibly undefined
// 3FDCA6: variable 'v4' is possibly undefined
// 3FDE66: variable 'v5' is possibly undefined
// 3FDE7A: variable 'v7' is possibly undefined
// 3FE0F8: variable 'v2' is possibly undefined
// 3FE0F8: variable 'v1' is possibly undefined

//----- (003FE2A8) --------------------------------------------------------
bool __fastcall CPhysical::ApplyFriction(CPhysical *this, float fAdhesiveLimit, CColPoint *colPoint)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CMatrix *m_pMat; // r0
  float v8; // s20
  float v9; // s22
  float v10; // s24
  float v11; // s0
  float v12; // s2
  float v13; // s4
  float v14; // s12
  float v15; // s2
  float v16; // s0
  float v17; // s4
  float v18; // s16
  float m_fMass; // s28
  float v20; // s0
  int32 FrictionEffect; // r0
  bool v22; // zf
  int v23; // r1
  bool v24; // zf
  float v25; // s20
  float v26; // s22
  float v27; // s24
  RwReal v28; // s2
  RwReal v29; // s4
  int v30; // r9
  float v31; // s0
  RwReal v32; // s6
  RwReal v33; // s4
  RwReal v34; // s0
  float x; // s0
  float v36; // s6
  float y; // s2
  float v38; // s8
  float z; // s4
  float v40; // s10
  float v41; // s12
  float v42; // s14
  float v43; // s0
  float v44; // s2
  float v45; // s4
  float v46; // s8
  float v47; // s10
  float v48; // s2
  float v49; // s0
  CVector v51; // [sp+0h] [bp-C0h]
  CVector v52; // [sp+4h] [bp-BCh]
  CVector pos; // [sp+20h] [bp-A0h] BYREF
  CVector v1; // [sp+2Ch] [bp-94h] BYREF
  CVector dir; // [sp+38h] [bp-88h] BYREF
  CVector v56; // [sp+44h] [bp-7Ch] BYREF
  CVector v2; // [sp+50h] [bp-70h] BYREF
  CVector v58; // [sp+5Ch] [bp-64h] BYREF
  CVector v59; // 0:r1.12
  CVector v60; // 0:r2.8,8:^0.4

  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 4) == 0 )
  {
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) != 0 )
    {
      x = colPoint->m_vecNormal.x;
      v36 = this->m_vecMoveSpeed.x;
      y = colPoint->m_vecNormal.y;
      v38 = this->m_vecMoveSpeed.y;
      z = colPoint->m_vecNormal.z;
      v40 = this->m_vecMoveSpeed.z;
      v41 = (float)((float)(v36 * x) + (float)(v38 * y)) + (float)(v40 * z);
      v42 = x * v41;
      v43 = v38 - (float)(y * v41);
      v44 = v36 - v42;
      v45 = sqrtf(
              (float)((float)(v40 - (float)(z * v41)) * (float)(v40 - (float)(z * v41)))
            + (float)((float)(v44 * v44) + (float)(v43 * v43)));
      if ( v45 > 0.0 )
      {
        v46 = this->m_vecMoveFriction.y;
        v47 = this->m_vecMoveFriction.z;
        v48 = v44 * (float)(1.0 / v45);
        v49 = v43 * (float)(1.0 / v45);
        if ( v45 > (float)((float)(CTimer::ms_fTimeStep / this->m_fMass) * fAdhesiveLimit) )
          v45 = (float)(CTimer::ms_fTimeStep / this->m_fMass) * fAdhesiveLimit;
        this->m_vecMoveFriction.x = this->m_vecMoveFriction.x - (float)(v48 * v45);
        this->m_vecMoveFriction.y = v46 - (float)(v49 * v45);
        this->m_vecMoveFriction.z = v47 + 0.0;
        return 1;
      }
    }
    else
    {
      m_pMat = this->m_pMat;
      v8 = colPoint->m_vecPosition.x - m_pMat->tx;
      v9 = colPoint->m_vecPosition.y - m_pMat->ty;
      v10 = colPoint->m_vecPosition.z - m_pMat->tz;
      v60.z = v10;
      v60.x = v8;
      v60.y = v9;
      CPhysical::GetSpeed(&v58, this, v60);
      v11 = colPoint->m_vecNormal.x;
      v12 = colPoint->m_vecNormal.y;
      v13 = colPoint->m_vecNormal.z;
      v14 = (float)((float)(v58.x * v11) + (float)(v58.y * v12)) + (float)(v58.z * v13);
      v15 = v58.y - (float)(v12 * v14);
      v16 = v58.x - (float)(v11 * v14);
      v17 = v58.z - (float)(v13 * v14);
      v18 = sqrtf((float)(v17 * v17) + (float)((float)(v16 * v16) + (float)(v15 * v15)));
      if ( v18 > 0.0 )
      {
        v2.y = v15 * (float)(1.0 / v18);
        v2.x = v16 * (float)(1.0 / v18);
        v2.z = v17 * (float)(1.0 / v18);
        Multiply3x3(&v56, this->m_pMat, &this->m_vecCOM);
        m_fMass = this->m_fMass;
        v1.x = v8 - v56.x;
        v1.y = v9 - v56.y;
        v1.z = v10 - v56.z;
        CrossProduct(&dir, &v1, &v2);
        v20 = v18
            * (float)(1.0
                    / (float)((float)(1.0 / m_fMass)
                            + (float)((float)((float)((float)(dir.x * dir.x) + (float)(dir.y * dir.y))
                                            + (float)(dir.z * dir.z))
                                    / this->m_fTurnMass)));
        if ( v20 > fAdhesiveLimit )
          v20 = fAdhesiveLimit;
        v51.x = v8;
        *(_QWORD *)&v51.y = __PAIR64__(LODWORD(v10), LODWORD(v9));
        v59.x = -(float)(v20 * v2.x);
        v59.y = -(float)(v20 * v2.y);
        v59.z = -(float)(v20 * v2.z);
        CPhysical::ApplyFrictionForce(this, v59, v51);
        if ( v18 > 0.1 && SurfaceInfos_c::GetFrictionEffect(&g_surfaceInfos, colPoint->m_dataB.m_nSurfaceType) )
        {
          FrictionEffect = SurfaceInfos_c::GetFrictionEffect(&g_surfaceInfos, colPoint->m_dataA.m_nSurfaceType);
          v22 = FrictionEffect == 1;
          v23 = *(_BYTE *)&this->m_info & 7;
          if ( FrictionEffect != 1 )
            v22 = v23 == 2;
          if ( v22 )
          {
            v24 = v23 == 2;
            if ( v23 == 2 )
              v24 = this[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)&byte_9[1];
            if ( !v24
              || !LODWORD(this[3].m_vecCOM.z)
              || fabsf(
                   (float)((float)(colPoint->m_vecNormal.x * this->m_pMat->xx)
                         + (float)(colPoint->m_vecNormal.y * this->m_pMat->yx))
                 + (float)(colPoint->m_vecNormal.z * this->m_pMat->zx)) >= 0.8667 )
            {
              dir = v2;
              v25 = v2.x;
              v26 = v2.y;
              v27 = v2.z;
              v28 = (float)(colPoint->m_vecNormal.y * 0.1) + v2.y;
              v29 = (float)(colPoint->m_vecNormal.z * 0.1) + v2.z;
              dir.x = (float)(colPoint->m_vecNormal.x * 0.1) + v2.x;
              dir.y = v28;
              dir.z = v29;
              CrossProduct(&v1, &colPoint->m_vecNormal, &this->m_vecMoveSpeed);
              CVector::Normalise(&v1);
              v30 = 8;
              do
              {
                v31 = (float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2;
                v32 = (float)(v1.z * v31) + colPoint->m_vecPosition.z;
                v33 = colPoint->m_vecPosition.y + (float)(v1.y * v31);
                v34 = colPoint->m_vecPosition.x + (float)(v1.x * v31);
                pos.z = v32;
                pos.y = v33;
                pos.x = v34;
                v52.x = (float)(v18 * 0.25) * v25;
                *(_QWORD *)&v52.y = __PAIR64__((float)(v18 * 0.25) * v27, (float)(v18 * 0.25) * v26);
                Fx_c::AddSparks(&g_fx, &pos, &dir, v18 * 12.5, 1, v52, 0, 0.1, 1.0);
                --v30;
              }
              while ( v30 );
            }
          }
        }
        return 1;
      }
    }
  }
  return 0;
}

//----- (003FE724) --------------------------------------------------------
void __fastcall CPhysical::UnsetIsInSafePosition(CPhysical *this)
{
  CVector *p_m_vecMoveSpeed; // r5
  float32x4_t v3; // q8
  RwReal v4; // s0
  RwReal v5; // s2
  float32x4_t v6; // q8
  RwReal v7; // s0
  RwReal v8; // s2
  float32x4_t v9; // q8

  p_m_vecMoveSpeed = &this->m_vecMoveSpeed;
  v3.n128_u64[0] = *(_QWORD *)&this->m_vecMoveSpeed.x;
  v3.n128_u64[1] = *(_QWORD *)&this->m_vecMoveSpeed.z;
  v4 = -this->m_vecTurnSpeed.y;
  v5 = -this->m_vecTurnSpeed.z;
  v6 = vnegq_f32(v3);
  *(_QWORD *)&this->m_vecMoveSpeed.x = v6.n128_u64[0];
  *(_QWORD *)&this->m_vecMoveSpeed.z = v6.n128_u64[1];
  this->m_vecTurnSpeed.y = v4;
  this->m_vecTurnSpeed.z = v5;
  CPhysical::ApplySpeed(this);
  v6.n128_u64[0] = *(_QWORD *)&p_m_vecMoveSpeed->x;
  v6.n128_u64[1] = *(_QWORD *)&p_m_vecMoveSpeed->z;
  v7 = -this->m_vecTurnSpeed.y;
  v8 = -this->m_vecTurnSpeed.z;
  v9 = vnegq_f32(v6);
  *(_DWORD *)&this->m_nFlags &= ~0x20u;
  *(_QWORD *)&p_m_vecMoveSpeed->x = v9.n128_u64[0];
  *(_QWORD *)&p_m_vecMoveSpeed->z = v9.n128_u64[1];
  this->m_vecTurnSpeed.y = v7;
  this->m_vecTurnSpeed.z = v8;
}

//----- (003FE784) --------------------------------------------------------
void __fastcall CPhysical::ApplyGravity(CPhysical *this)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float m_fMass; // s16
  float v4; // s18
  CVector v5; // [sp+14h] [bp-24h] BYREF
  CVector v6; // 0:r1.12

  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x22) == 2 )
  {
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 )
    {
      m_fMass = this->m_fMass;
      v4 = CTimer::ms_fTimeStep;
      Multiply3x3(&v5, this->m_pMat, &this->m_vecCOM);
      v6.x = 0.0;
      v6.y = 0.0;
      v6.z = (float)(v4 * -0.008) * m_fMass;
      CPhysical::ApplyForce(this, v6, v5, 1);
    }
    else if ( *(_BYTE *)&this->m_nFlags << 31 )
    {
      this->m_vecMoveSpeed.z = this->m_vecMoveSpeed.z + (float)(CTimer::ms_fTimeStep * -0.008);
    }
  }
}

//----- (003FE818) --------------------------------------------------------
void __fastcall CPhysical::ApplyFriction(CPhysical *this)
{
  float v2; // s0
  float m_fRadius; // s4
  CMatrix *m_pMat; // r0
  float v5; // s2
  CSimpleTransform *p_tx; // r2
  float x; // s0
  float y; // s6
  float z; // s8
  float v10; // s0
  float32x4_t v11; // q4
  CEntity::CEntityInfo m_info; // r0
  float v13; // s2
  RwReal v14; // r1
  bool v15; // zf
  float v16; // r0
  CColPoint colPoint; // [sp+4h] [bp-44h] BYREF

  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x80) != 0 )
  {
    m_fRadius = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
    m_pMat = this->m_pMat;
    v5 = m_fRadius * 0.0;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    x = p_tx->m_translate.x;
    y = p_tx->m_translate.y;
    z = p_tx->m_translate.z;
    colPoint.m_vecNormal.x = 0.0;
    colPoint.m_vecNormal.y = 0.0;
    colPoint.m_vecNormal.z = 1.0;
    colPoint.m_vecPosition.z = z - m_fRadius;
    colPoint.m_vecPosition.y = y - v5;
    colPoint.m_vecPosition.x = x - v5;
    CPhysical::ApplyFriction(this, CTimer::ms_fTimeStep * 0.001, &colPoint);
    v2 = powf(0.98, CTimer::ms_fTimeStep) * this->m_vecTurnSpeed.z;
    this->m_vecTurnSpeed.z = v2;
  }
  else
  {
    v2 = this->m_vecTurnSpeed.z;
  }
  v10 = this->m_vecTurnFriction.z + v2;
  v11 = vaddq_f32(*(float32x4_t *)&this->m_vecMoveFriction.x, *(float32x4_t *)&this->m_vecMoveSpeed.x);
  m_info = this->m_info;
  v13 = this->m_vecTurnFriction.y + this->m_vecTurnSpeed.y;
  this->m_vecTurnFriction.y = 0.0;
  this->m_vecTurnFriction.z = 0.0;
  *(_QWORD *)&this->m_vecMoveFriction.x = 0LL;
  *(_QWORD *)&this->m_vecMoveFriction.z = 0LL;
  *(float32x4_t *)&this->m_vecMoveSpeed.x = v11;
  this->m_vecTurnSpeed.y = v13;
  this->m_vecTurnSpeed.z = v10;
  if ( (*(_BYTE *)&m_info & 7) == 2 )
  {
    v14 = this[4].m_vecCOM.z;
    v15 = LODWORD(v14) == 9;
    if ( LODWORD(v14) == 9 )
      v15 = (*(_BYTE *)&m_info & 0xF8) == 32;
    if ( v15
      && *(_DWORD *)&this->m_nPhysicalFlags >= 0
      && fabsf(this->m_pMat->zz) < 0.707
      && (float)((float)((float)(v11.n128_f32[0] * v11.n128_f32[0]) + (float)(v11.n128_f32[1] * v11.n128_f32[1]))
               + (float)(v11.n128_f32[2] * v11.n128_f32[2])) < 0.0025
      && (float)((float)((float)(v11.n128_f32[3] * v11.n128_f32[3]) + (float)(v13 * v13)) + (float)(v10 * v10)) < 0.0001 )
    {
      v16 = powf(0.5, CTimer::ms_fTimeStep);
      this->m_vecMoveSpeed.x = v11.n128_f32[0] * v16;
      this->m_vecMoveSpeed.y = v16 * v11.n128_f32[1];
      this->m_vecMoveSpeed.z = v16 * v11.n128_f32[2];
    }
  }
}

//----- (003FE9DC) --------------------------------------------------------
void __fastcall CPhysical::ApplyAirResistance(CPhysical *this)
{
  float m_fAirResistance; // s0
  float v3; // s16
  CEntryInfoNode *m_pHead; // r0
  bool v5; // zf
  float v6; // s0
  float v7; // s2
  float v8; // s4
  RwReal v9; // s4
  RwReal v10; // s6
  RwReal v11; // s2

  m_fAirResistance = this->m_fAirResistance;
  if ( m_fAirResistance <= 0.1 || (*(_BYTE *)&this->m_info & 7) == 2 )
  {
    v3 = m_fAirResistance
       * sqrtf(
           (float)((float)(this->m_vecMoveSpeed.x * this->m_vecMoveSpeed.x)
                 + (float)(this->m_vecMoveSpeed.y * this->m_vecMoveSpeed.y))
         + (float)(this->m_vecMoveSpeed.z * this->m_vecMoveSpeed.z));
    if ( CCullZones::DoExtraAirResistanceForPlayer() == 1 && (*(_BYTE *)&this->m_info & 7) == 2 )
    {
      m_pHead = this[4].m_listEntryInfo.m_pHead;
      v5 = m_pHead == (CEntryInfoNode *)byte_9;
      if ( m_pHead != (CEntryInfoNode *)byte_9 )
        v5 = m_pHead == 0;
      if ( v5 )
        v3 = v3 * CVehicle::m_fAirResistanceMult;
    }
    v6 = powf(1.0 - v3, CTimer::ms_fTimeStep);
    v7 = 0.99;
    v8 = v6 * this->m_vecMoveSpeed.y;
    this->m_vecMoveSpeed.x = v6 * this->m_vecMoveSpeed.x;
  }
  else
  {
    v6 = powf(m_fAirResistance, CTimer::ms_fTimeStep);
    v8 = v6 * this->m_vecMoveSpeed.y;
    this->m_vecMoveSpeed.x = v6 * this->m_vecMoveSpeed.x;
    v7 = v6;
  }
  this->m_vecMoveSpeed.y = v8;
  v9 = v7 * this->m_vecTurnSpeed.x;
  v10 = v7 * this->m_vecTurnSpeed.y;
  v11 = v7 * this->m_vecTurnSpeed.z;
  this->m_vecMoveSpeed.z = v6 * this->m_vecMoveSpeed.z;
  this->m_vecTurnSpeed.x = v9;
  this->m_vecTurnSpeed.y = v10;
  this->m_vecTurnSpeed.z = v11;
}

//----- (003FEB0C) --------------------------------------------------------
void __fastcall CPhysical::ApplyFrictionMoveForce(CPhysical *this, CVector vecForce)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r12
  float z; // s6
  float v4; // s0
  float v5; // s8
  RwReal v6; // s4

  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x60) == 0 )
  {
    z = this->m_vecMoveFriction.z;
    v4 = 1.0 / this->m_fMass;
    v5 = 0.0;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) == 0 )
      v5 = vecForce.z;
    v6 = (float)(v4 * vecForce.y) + this->m_vecMoveFriction.y;
    this->m_vecMoveFriction.x = this->m_vecMoveFriction.x + (float)(v4 * vecForce.x);
    this->m_vecMoveFriction.y = v6;
    this->m_vecMoveFriction.z = (float)(v5 * v4) + z;
  }
}

//----- (003FEB74) --------------------------------------------------------
void __fastcall CPhysical::ApplyFrictionTurnForce(CPhysical *this, CVector vecForce, CVector vecOffset)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float m_fTurnMass; // s16
  float x; // s0
  float y; // s2
  float z; // s4
  float v9; // r0
  RwReal v10; // s4
  RwReal v11; // s0
  CVector v1; // [sp+4h] [bp-34h] BYREF
  CVector v13; // [sp+10h] [bp-28h] BYREF
  CVector v2; // [sp+1Ch] [bp-1Ch] BYREF

  v2 = vecForce;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) == 0 )
  {
    m_fTurnMass = this->m_fTurnMass;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 )
    {
      m_fTurnMass = m_fTurnMass + (float)(this->m_vecCOM.z * (float)((float)(this->m_fMass * 0.5) * this->m_vecCOM.z));
      x = 0.0;
      y = 0.0;
      z = 0.0;
    }
    else
    {
      Multiply3x3(&v13, this->m_pMat, &this->m_vecCOM);
      m_nPhysicalFlags = this->m_nPhysicalFlags;
      x = v13.x;
      y = v13.y;
      z = v13.z;
    }
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x20) != 0 )
    {
      v9 = 0.0;
      v2.z = 0.0;
    }
    else
    {
      v9 = vecOffset.z;
    }
    v1.y = vecOffset.y - y;
    v1.x = vecOffset.x - x;
    v1.z = v9 - z;
    CrossProduct(&v13, &v1, &v2);
    v2.x = (float)(1.0 / m_fTurnMass) * v13.x;
    v2.y = (float)(1.0 / m_fTurnMass) * v13.y;
    v2.z = (float)(1.0 / m_fTurnMass) * v13.z;
    v10 = v2.y + this->m_vecTurnFriction.y;
    v11 = v2.z + this->m_vecTurnFriction.z;
    this->m_vecTurnFriction.x = v2.x + this->m_vecTurnFriction.x;
    this->m_vecTurnFriction.y = v10;
    this->m_vecTurnFriction.z = v11;
  }
}

//----- (003FEC70) --------------------------------------------------------
void __fastcall CPhysical::ApplyFrictionForce(CPhysical *this, CVector vecForce, CVector vecOffset)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float y; // s4
  float z; // s6
  float v7; // s0
  float v8; // s8
  float m_fTurnMass; // s16
  float x; // s2
  float v11; // s4
  float v12; // s0
  float v13; // r0
  RwReal v14; // s4
  RwReal v15; // s0
  CVector v1; // [sp+4h] [bp-34h] BYREF
  CVector v17; // [sp+10h] [bp-28h] BYREF
  CVector v2; // [sp+1Ch] [bp-1Ch] BYREF

  v2 = vecForce;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x60) != 0 )
  {
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) != 0 )
      return;
    goto LABEL_7;
  }
  y = this->m_vecMoveFriction.y;
  z = this->m_vecMoveFriction.z;
  v7 = 1.0 / this->m_fMass;
  v8 = 0.0;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) == 0 )
    v8 = vecForce.z;
  this->m_vecMoveFriction.x = this->m_vecMoveFriction.x + (float)(v7 * vecForce.x);
  this->m_vecMoveFriction.y = (float)(v7 * vecForce.y) + y;
  this->m_vecMoveFriction.z = (float)(v8 * v7) + z;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) == 0 )
  {
LABEL_7:
    m_fTurnMass = this->m_fTurnMass;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 )
    {
      m_fTurnMass = m_fTurnMass + (float)(this->m_vecCOM.z * (float)((float)(this->m_fMass * 0.5) * this->m_vecCOM.z));
      v12 = 0.0;
      v11 = 0.0;
      x = 0.0;
    }
    else
    {
      Multiply3x3(&v17, this->m_pMat, &this->m_vecCOM);
      m_nPhysicalFlags = this->m_nPhysicalFlags;
      x = v17.x;
      v11 = v17.y;
      v12 = v17.z;
    }
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x20) != 0 )
    {
      v13 = 0.0;
      v2.z = 0.0;
    }
    else
    {
      v13 = vecOffset.z;
    }
    v1.y = vecOffset.y - v11;
    v1.x = vecOffset.x - x;
    v1.z = v13 - v12;
    CrossProduct(&v17, &v1, &v2);
    v2.x = (float)(1.0 / m_fTurnMass) * v17.x;
    v2.y = (float)(1.0 / m_fTurnMass) * v17.y;
    v2.z = (float)(1.0 / m_fTurnMass) * v17.z;
    v14 = v2.y + this->m_vecTurnFriction.y;
    v15 = v2.z + this->m_vecTurnFriction.z;
    this->m_vecTurnFriction.x = v2.x + this->m_vecTurnFriction.x;
    this->m_vecTurnFriction.y = v14;
    this->m_vecTurnFriction.z = v15;
  }
}

//----- (003FEDCC) --------------------------------------------------------
void __fastcall CPhysical::ProcessControl(CPhysical *this)
{
  CEntity::CEntityInfo m_info; // r0
  int v3; // r1
  int v4; // r0
  CEntity *m_pDamageEntity; // r0
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float m_fMass; // s16
  float v8; // s18
  CVector v9; // [sp+14h] [bp-2Ch] BYREF
  CVector v10; // 0:r1.12

  m_info = this->m_info;
  v3 = *(_BYTE *)&m_info & 7;
  v4 = *(_BYTE *)&m_info & 0xF8;
  if ( v3 != 3 )
    *(_DWORD *)&this->m_nPhysicalFlags &= ~0x100u;
  *(_DWORD *)&this->m_nFlags &= 0xFFFFEF97;
  if ( v4 != 16 )
  {
    m_pDamageEntity = this->m_pDamageEntity;
    this->m_nNoOfCollisionRecords = 0;
    this->m_nDamagedPieceType = 0;
    this->m_fDamageImpulseMagnitude = 0.0;
    *(_DWORD *)&this->m_nPhysicalFlags &= 0xBFFFFDFF;
    if ( m_pDamageEntity )
      CEntity::CleanUpOldReference(m_pDamageEntity, &this->m_pDamageEntity);
    this->m_pDamageEntity = 0;
    CPhysical::ApplyFriction(this);
    m_nPhysicalFlags = this->m_nPhysicalFlags;
    if ( !this->m_pAttachToEntity || (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 )
    {
      if ( (*(_DWORD *)&this->m_nPhysicalFlags & 0x22) == 2 )
      {
        if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 )
        {
          m_fMass = this->m_fMass;
          v8 = CTimer::ms_fTimeStep;
          Multiply3x3(&v9, this->m_pMat, &this->m_vecCOM);
          v10.x = 0.0;
          v10.y = 0.0;
          v10.z = (float)(v8 * -0.008) * m_fMass;
          CPhysical::ApplyForce(this, v10, v9, 1);
        }
        else if ( *(_BYTE *)&this->m_nFlags << 31 )
        {
          this->m_vecMoveSpeed.z = this->m_vecMoveSpeed.z + (float)(CTimer::ms_fTimeStep * -0.008);
        }
      }
      CPhysical::ApplyAirResistance(this);
    }
  }
}

//----- (003FEEDC) --------------------------------------------------------
void __fastcall CPhysical::SkipPhysics(CPhysical *this)
{
  CEntity::CEntityInfo m_info; // r0
  int v3; // r1
  int v4; // r0
  CEntity *m_pDamageEntity; // r0
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r2

  m_info = this->m_info;
  v3 = *(_BYTE *)&m_info & 6;
  v4 = *(_BYTE *)&m_info & 0xF8;
  if ( v3 != 2 )
    *(_DWORD *)&this->m_nPhysicalFlags &= ~0x100u;
  *(_DWORD *)&this->m_nFlags &= 0xFFFFEF97;
  if ( v4 != 16 )
  {
    m_pDamageEntity = this->m_pDamageEntity;
    m_nPhysicalFlags = this->m_nPhysicalFlags;
    this->m_nNoOfCollisionRecords = 0;
    this->m_nDamagedPieceType = 0;
    this->m_fDamageImpulseMagnitude = 0.0;
    this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags & 0xFFFFFDFF);
    if ( m_pDamageEntity )
      CEntity::CleanUpOldReference(m_pDamageEntity, &this->m_pDamageEntity);
    this->m_vecTurnFriction.y = 0.0;
    this->m_vecTurnFriction.z = 0.0;
    this->m_pDamageEntity = 0;
    *(_QWORD *)&this->m_vecMoveFriction.x = 0LL;
    *(_QWORD *)&this->m_vecMoveFriction.z = 0LL;
  }
}

//----- (003FEF48) --------------------------------------------------------
void __fastcall CPhysical::ProcessCollision(CPhysical *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d8
  float32x2_t v3; // d10
  CPhysical *v4; // r10
  int m_nFlags; // r1
  CEntity::CFlags *p_m_nFlags; // r5
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r2
  uint32 bdummy; // r0
  unsigned int m_info; // r2
  uint16 v10; // r0
  _QWORD *p_x; // r0
  char *p_y; // r4
  CVector *p_m_vecMoveSpeed; // r5
  float *p_z; // r6
  float m_fElasticity; // r8
  double v16; // d16
  unsigned int v17; // r11
  CEntity::CFlags v18; // kr00_8
  CPhysical::CPhysicalFlags v19; // r1
  _BOOL4 v20; // r0
  double v21; // d16
  float v22; // s18
  unsigned __int16 v23; // r4
  __int64 v24; // d12
  __int64 v25; // d13
  unsigned __int32 v26; // s16
  _BOOL4 v27; // r0
  int v28; // r1
  RwReal v29; // r0
  _QWORD *v30; // r0
  CPhysical::CPhysicalFlags v31; // r0
  float x; // s0
  unsigned int v33; // r0
  CEntryInfoNode *m_pHead; // r4
  CCollisionData *m_pColData; // r2
  float *v36; // r11
  int v37; // r3
  int v38; // r4
  CMatrix *m_pMat; // r0
  float *p_tx; // r1
  float v41; // s2
  float v42; // s4
  int v43; // r0
  float *v44; // r9
  char *v45; // r6
  float xx; // s16
  float yx; // s18
  float zx; // s20
  float v49; // s22
  float v50; // s24
  float v51; // s26
  float GhostRoadHeight; // r0
  float *v53; // r6
  float v54; // s0
  CMatrix *v55; // r0
  float v56; // r5
  CEntity::CEntityInfo v57; // r0
  int v58; // r0
  CPhysical::CPhysicalFlags v59; // r1
  float *p_xx; // r0
  float v61; // s0
  float v62; // s4
  float v63; // s2
  float tz; // s10
  _DWORD *v65; // [sp+4h] [bp-BCh]
  CCollisionData *v66; // [sp+8h] [bp-B8h]
  _DWORD *v67; // [sp+10h] [bp-B0h]
  int v68; // [sp+10h] [bp-B0h]
  CVehicle *v69; // [sp+14h] [bp-ACh]
  CMatrix m; // [sp+18h] [bp-A8h] BYREF
  double v71; // [sp+60h] [bp-60h]
  RwReal z; // [sp+68h] [bp-58h]
  char v73; // [sp+6Eh] [bp-52h] BYREF
  char v74[81]; // [sp+6Fh] [bp-51h] BYREF
  CVector v75; // 0:r1.12

  v4 = this;
  p_m_nFlags = &this->m_nFlags;
  m_nFlags = (int)this->m_nFlags;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  bdummy = this->m_nFlags.bdummy;
  p_m_nFlags[23].bdummy = 0;
  *(_DWORD *)&p_m_nFlags[5] = *(_DWORD *)&m_nPhysicalFlags & 0xFFFF6FFF;
  if ( (*(_DWORD *)&m_nPhysicalFlags & 0x20000) != 0 || (m_nFlags & 1) == 0 )
  {
    *(_DWORD *)p_m_nFlags = m_nFlags & 0xFFFFFFCF | 0x20;
    p_m_nFlags->bdummy = bdummy;
LABEL_65:
    CPhysical::RemoveAndAdd(v4);
    return;
  }
  m_info = (unsigned __int8)v4->m_info;
  v69 = (CVehicle *)v4;
  if ( m_info >> 3 == 12 )
  {
    v65 = p_m_nFlags;
    if ( v4[4].m_listEntryInfo.m_pHead )
    {
      p_x = (_QWORD *)&v4[6].m_vecTurnFriction.x;
      p_y = (char *)&v4[6].m_vecAverageMoveSpeed.y;
      p_m_vecMoveSpeed = &v4[5].m_vecMoveSpeed;
      p_z = &v4[5].m_vecDamagePos.z;
    }
    else
    {
      p_x = (_QWORD *)&v4[7].m_vecTurnSpeed.y;
      p_y = (char *)&v4[7].m_vecMoveFriction.z;
      p_m_vecMoveSpeed = (CVector *)&v4[5].m_vecAttachPosnOffset.z;
      p_z = &v4[6].m_vecAverageMoveSpeed.z;
    }
    *p_x = 0LL;
    p_x[1] = 0LL;
    m_pColData = CEntity::GetColModel(v4)->m_pColData;
    v36 = (float *)(p_y + 8);
    v37 = 0;
    v38 = 0;
    v66 = m_pColData;
    while ( 1 )
    {
      v43 = *((unsigned __int8 *)m_pColData + 7) << 31 ? 0 : m_pColData->_anon_0.m_nNoOfLines;
      if ( v38 >= v43 )
        break;
      v44 = p_z;
      v68 = v37;
      v45 = (char *)m_pColData->_anon_1.m_pLineArray + v37;
      operator*((CVector *)&m, v69->m_pMat, (const CVector *)v45);
      xx = m.xx;
      yx = m.yx;
      zx = m.zx;
      operator*((CVector *)&m, v69->m_pMat, (const CVector *)(v45 + 16));
      v49 = m.xx;
      v50 = m.yx;
      v4 = v69;
      v51 = m.zx;
      p_m_vecMoveSpeed[1].y = 0.0;
      p_m_vecMoveSpeed[1].z = 0.0;
      p_m_vecMoveSpeed[2].x = 1.0;
      LOBYTE(p_m_vecMoveSpeed[2].z) = 60;
      HIBYTE(p_m_vecMoveSpeed[2].z) = 1;
      p_m_vecMoveSpeed[3].y = 0.0;
      GhostRoadHeight = CCarCtrl::FindGhostRoadHeight(v69);
      if ( GhostRoadHeight <= zx )
      {
        if ( GhostRoadHeight <= v51 )
        {
          xx = v49;
          v53 = v44;
          yx = v50;
          zx = v51;
          *v44 = 1.0;
        }
        else
        {
          v53 = v44;
          v54 = (float)(zx - GhostRoadHeight) / (float)(zx - v51);
          *v44 = v54;
          yx = yx + (float)((float)(v50 - yx) * v54);
          xx = xx + (float)((float)(v49 - xx) * v54);
          zx = zx + (float)((float)(v51 - zx) * v54);
        }
      }
      else
      {
        *v44 = 0.0;
        v53 = v44;
      }
      p_z = v53 + 1;
      m_pColData = v66;
      p_m_vecMoveSpeed->x = xx;
      v37 = v68 + 32;
      p_m_vecMoveSpeed->y = yx;
      ++v38;
      p_m_vecMoveSpeed->z = zx;
      p_m_vecMoveSpeed = (CVector *)((char *)p_m_vecMoveSpeed + 44);
      m_pMat = v69->m_pMat;
      p_tx = &m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v69->m_transform.m_translate.x;
      v41 = yx - p_tx[1];
      v42 = zx - p_tx[2];
      *(v36 - 2) = xx - *p_tx;
      *(v36 - 1) = v41;
      *v36 = v42;
      v36 += 3;
    }
    *v65 = *v65 & 0xFFFFFFCF | 0x20;
    v55 = v4->m_pMat;
    v4->m_vecMoveSpeed.z = 0.0;
    v4->m_vecTurnSpeed.x = 0.0;
    *(_QWORD *)&v75.y = 0x3F80000000000000LL;
    v4->m_vecTurnSpeed.y = 0.0;
    v75.x = 0.0;
    CMatrix::ForceUpVector(v55, v75);
    v56 = CCarCtrl::FindGhostRoadHeight((CVehicle *)v4);
    v4->m_pMat->tz = v56 + (*((float (__fastcall **)(CPhysical *))v4->_vptr$CPlaceable + 54))(v4);
    CPhysical::ApplySpeed(v4);
    CMatrix::Reorthogonalise(v4->m_pMat);
    CPhysical::RemoveAndAdd(v4);
    LODWORD(v4[3].m_vecAverageMoveSpeed.x) |= 0x1000000u;
    return;
  }
  if ( m_info >> 3 == 2 )
  {
    *(_DWORD *)p_m_nFlags = m_nFlags & 0xFFFFFFFD;
    p_m_nFlags->bdummy = bdummy;
    if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
    {
      CWorld::ClearScanCodes();
      v10 = 1;
    }
    else
    {
      v10 = CWorld::ms_nCurrentScanCode + 1;
    }
    CWorld::ms_nCurrentScanCode = v10;
    m_pHead = v4->m_listEntryInfo.m_pHead;
    if ( m_pHead )
    {
      while ( !CPhysical::ProcessCollisionSectorList_SimpleCar(v4, m_pHead->m_pSector.m_pRepeatSector) )
      {
        m_pHead = m_pHead->m_pNext;
        if ( !m_pHead )
          goto LABEL_64;
      }
      v57 = v4->m_info;
      if ( (*(_BYTE *)&v57 & 0xF8) == 16 )
      {
        v58 = *(_BYTE *)&v57 & 7;
        v4->m_info = (CEntity::CEntityInfo)(v58 | 0x18);
        if ( v58 == 2 )
          CCarCtrl::SwitchVehicleToRealPhysics((CVehicle *)v4);
      }
    }
LABEL_64:
    *(_DWORD *)p_m_nFlags = *(_DWORD *)p_m_nFlags & 0xFFFFFFCF | 0x20;
    goto LABEL_65;
  }
  m_fElasticity = v4->m_fElasticity;
  v74[0] = 0;
  v73 = 0;
  v16 = *(double *)&v4->m_vecMoveSpeed.x;
  z = v4->m_vecMoveSpeed.z;
  v71 = v16;
  v2.n64_f32[0] = CTimer::ms_fTimeStep;
  CMatrix::CMatrix(&m, v4->m_pMat);
  v17 = (*((int (__fastcall **)(CPhysical *, char *, char *))v4->_vptr$CPlaceable + 17))(v4, v74, &v73);
  if ( v74[0] )
  {
    CPhysical::ApplySpeed(v4);
    CMatrix::Reorthogonalise(v4->m_pMat);
    v18 = *p_m_nFlags;
    v19 = v4->m_nPhysicalFlags;
    *(_DWORD *)p_m_nFlags &= ~1u;
    p_m_nFlags->bdummy = v18.bdummy;
    v4->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&v19 & 0xFFFE6FFF | 0x10000);
    v20 = CPhysical::CheckCollision(v4);
    *(_DWORD *)p_m_nFlags = *(_DWORD *)p_m_nFlags & 0xFFFFFFFE | *(_BYTE *)&v18 & 1;
    *(_DWORD *)&v4->m_nPhysicalFlags &= ~0x10000u;
    if ( !v20 )
    {
      if ( (*(_BYTE *)&v4->m_info & 7) == 2 )
        LODWORD(v4[3].m_vecAverageMoveSpeed.x) |= 0x1000000u;
      goto LABEL_68;
    }
    CMatrix::operator=(v4->m_pMat, &m);
    v21 = v71;
    v4->m_vecMoveSpeed.z = z;
    *(double *)&v4->m_vecMoveSpeed.x = v21;
    if ( (*(_BYTE *)&v4->m_info & 7) == 2 && LOBYTE(v4[3].m_vecAverageMoveSpeed.x) << 31 )
      v4->m_fElasticity = HIGHSPEED_ELASTICITY_MULT_COPCAR * v4->m_fElasticity;
  }
  if ( v17 < 2 )
  {
LABEL_31:
    CPhysical::ApplySpeed(v4);
    CMatrix::Reorthogonalise(v4->m_pMat);
    v31 = v4->m_nPhysicalFlags;
    x = v4->m_vecMoveSpeed.x;
    v4->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&v31 & 0xFFFF6FFF);
    if ( x != 0.0
      || v4->m_vecMoveSpeed.y != 0.0
      || v4->m_vecTurnSpeed.x != 0.0
      || (*(_WORD *)&v31 & 0x800) != 0
      || v4->m_vecTurnSpeed.z != 0.0
      || (v33 = (unsigned __int8)v4->m_info, v33 < 8) )
    {
LABEL_37:
      if ( (*(_BYTE *)&v4->m_info & 7) == 2 )
        LODWORD(v4[3].m_vecAverageMoveSpeed.x) |= 0x1000000u;
      if ( CPhysical::CheckCollision(v4) )
      {
        CMatrix::operator=(v4->m_pMat, &m);
        v4->m_fElasticity = m_fElasticity;
        goto LABEL_74;
      }
      goto LABEL_68;
    }
    if ( (v33 & 7) == 3 )
    {
      if ( CPed::IsPlayer((const CPed *)v4)
        || (((int)v4[3].m_aCollisionRecordPtrs[4] & 1) == 0) | LODWORD(v4[3].m_fTrueDistanceTravelled) & 0x8000 )
      {
        goto LABEL_37;
      }
      LOBYTE(v33) = v4->m_info;
    }
    else if ( (v33 & 7) == 2 && (LOBYTE(v4[3].m_vecAverageMoveSpeed.y) & 2) != 0 )
    {
      goto LABEL_37;
    }
    if ( (v33 & 7) == 3 )
      v4[3].m_aCollisionRecordPtrs[4] = (CEntity *)((int)v4[3].m_aCollisionRecordPtrs[4] | 1);
LABEL_68:
    *(_DWORD *)p_m_nFlags = *(_DWORD *)p_m_nFlags & 0xFFFFFFCF | 0x20;
    v59 = v4->m_nPhysicalFlags;
    p_xx = &v4->m_pMat->xx;
    v4->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&v59 & 0xFFFFF7FF);
    v61 = p_xx[12] - m.tx;
    v62 = p_xx[14];
    v63 = p_xx[13] - m.ty;
    tz = m.tz;
    v4->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&v59 & 0xFFFFE7FF);
    v4->m_fElasticity = m_fElasticity;
    v4->m_fTrueDistanceTravelled = sqrtf(
                                     (float)((float)(v61 * v61) + (float)(v63 * v63))
                                   + (float)((float)(v62 - tz) * (float)(v62 - tz)));
    CPhysical::RemoveAndAdd(v4);
    goto LABEL_74;
  }
  v22 = v2.n64_f32[0] / (float)v17;
  v23 = 1;
  v67 = &v4[3].m_aCollisionRecordPtrs[4];
  v3.n64_u32[0] = 925353388;
  *(float *)&v24 = 1.0;
  *((float *)&v24 + 1) = 1.0;
  *(float *)&v25 = 1.0;
  *((float *)&v25 + 1) = 1.0;
  v26 = vmax_f32(v2, v3).n64_u32[0];
  while ( 1 )
  {
    v1.n64_f32[0] = v22 * (float)v23;
    v1.n64_u64[0] = vmax_f32(v1, v3).n64_u64[0];
    CTimer::ms_fTimeStep = v1.n64_f32[0];
    CPhysical::ApplySpeed(v4);
    v27 = CPhysical::CheckCollision(v4);
    v28 = *(_BYTE *)&v4->m_info & 7;
    if ( v27 )
      break;
    if ( v28 == 3 && v4->m_vecMoveSpeed.z == 0.0 && (*v67 & 3) == 1 )
      m.tz = v4->m_pMat->tz;
    CMatrix::operator=(v4->m_pMat, &m);
    LODWORD(CTimer::ms_fTimeStep) = v26;
    if ( (*(_BYTE *)&v4->m_info & 7) != 2 )
      goto LABEL_30;
    v29 = v4[4].m_vecCOM.z;
    if ( v29 == 0.0 )
    {
      v30 = (_QWORD *)&v4[6].m_vecAverageMoveSpeed.z;
    }
    else
    {
      if ( LODWORD(v29) != 9 )
      {
        if ( LODWORD(v29) == 11 )
        {
          v4[6].m_vecAverageMoveSpeed.z = 1.0;
          v4[6].m_vecAverageTurnSpeed.x = 1.0;
          v4[6].m_vecAverageTurnSpeed.y = 1.0;
        }
        goto LABEL_30;
      }
      v30 = (_QWORD *)&v4[5].m_vecDamagePos.z;
    }
    *v30 = v24;
    v30[1] = v25;
LABEL_30:
    if ( ++v23 >= v17 )
      goto LABEL_31;
  }
  if ( v28 == 3 && v4->m_vecMoveSpeed.z == 0.0 && (*v67 & 3) == 1 )
    m.tz = v4->m_pMat->tz;
  CMatrix::operator=(v4->m_pMat, &m);
  LODWORD(CTimer::ms_fTimeStep) = v26;
  v4->m_fElasticity = m_fElasticity;
LABEL_74:
  CMatrix::~CMatrix(&m);
}
// 3FF108: variable 'v2' is possibly undefined
// 3FF108: variable 'v3' is possibly undefined
// 3FF11A: variable 'v1' is possibly undefined
// 3FEF48: using guessed type char var_51[81];

//----- (003FF5F8) --------------------------------------------------------
bool __fastcall CPhysical::CheckCollision_SimpleCar(CPhysical *this)
{
  uint16 v2; // r0
  CEntryInfoNode *m_pHead; // r5

  *(_DWORD *)&this->m_nFlags &= ~2u;
  if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
  {
    CWorld::ClearScanCodes();
    v2 = 1;
  }
  else
  {
    v2 = CWorld::ms_nCurrentScanCode + 1;
  }
  CWorld::ms_nCurrentScanCode = v2;
  m_pHead = this->m_listEntryInfo.m_pHead;
  if ( !m_pHead )
    return 0;
  while ( !CPhysical::ProcessCollisionSectorList_SimpleCar(this, m_pHead->m_pSector.m_pRepeatSector) )
  {
    m_pHead = m_pHead->m_pNext;
    if ( !m_pHead )
      return 0;
  }
  return 1;
}

//----- (003FF654) --------------------------------------------------------
bool __fastcall CPhysical::CheckCollision(CPhysical *this)
{
  CEntity::CEntityInfo m_info; // r1
  CEntity *m_pAttachToEntity; // r0
  bool v4; // zf
  unsigned int m_nHeightForPos; // r0
  uint16 v6; // r0
  float v7; // s18
  float v8; // s20
  float v9; // s22
  float v10; // r8
  float v11; // r6
  int v12; // s0
  int v13; // s2
  int v14; // r8
  Int32 v15; // r5
  Int32 v17; // r6
  bool v18; // cc
  unsigned int v19; // r3
  CEntity *v20; // r0
  float m_fTrueDistanceTravelled; // r1
  float m_fDamageImpulseMagnitude; // r2
  float v23[20]; // [sp+0h] [bp-50h] BYREF

  m_info = this->m_info;
  *(_DWORD *)&this->m_nFlags &= ~2u;
  if ( (*(_BYTE *)&m_info & 7) == 3 )
  {
    m_pAttachToEntity = this->m_pAttachToEntity;
    v4 = m_pAttachToEntity == 0;
    if ( !m_pAttachToEntity )
      v4 = (*(_DWORD *)&this->m_nPhysicalFlags & 0x19000) == 0;
    if ( v4 )
    {
      v19 = (unsigned int)this[3].m_aCollisionRecordPtrs[4];
      v20 = this[3].m_aCollisionRecordPtrs[5];
      m_fTrueDistanceTravelled = this[3].m_fTrueDistanceTravelled;
      m_fDamageImpulseMagnitude = this[3].m_fDamageImpulseMagnitude;
      this[4].m_vecAverageMoveSpeed.y = 0.0;
      if ( (v19 & 1) != 0 )
      {
        this[3].m_aCollisionRecordPtrs[4] = (CEntity *)(v19 & 0xFFFFFFFC | 2);
        this[3].m_aCollisionRecordPtrs[5] = v20;
        this[3].m_fTrueDistanceTravelled = m_fTrueDistanceTravelled;
        this[3].m_fDamageImpulseMagnitude = m_fDamageImpulseMagnitude;
      }
    }
    if ( CPed::IsPlayer((const CPed *)this) )
    {
      if ( CPedIntelligence::GetTaskClimb((const CPedIntelligence *)LODWORD(this[3].m_vecAverageTurnSpeed.z)) )
      {
        m_nHeightForPos = (unsigned __int8)CPedIntelligence::GetTaskClimb((const CPedIntelligence *)LODWORD(this[3].m_vecAverageTurnSpeed.z))->m_nHeightForPos;
        if ( m_nHeightForPos <= 5 && ((1 << m_nHeightForPos) & 0x2E) != 0 )
          *(_DWORD *)&this->m_nPhysicalFlags |= 0x1000u;
      }
    }
  }
  if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
  {
    CWorld::ClearScanCodes();
    v6 = 1;
  }
  else
  {
    v6 = CWorld::ms_nCurrentScanCode + 1;
  }
  CWorld::ms_nCurrentScanCode = v6;
  (*((void (__fastcall **)(float *, CPhysical *))this->_vptr$CPlaceable + 10))(v23, this);
  v7 = v23[1];
  v8 = v23[2];
  v9 = v23[3];
  v10 = floorf((float)(v23[0] / 50.0) + 60.0);
  v11 = floorf((float)(v9 / 50.0) + 60.0);
  v12 = (int)floorf((float)(v8 / 50.0) + 60.0);
  v13 = (int)v10;
  v14 = (int)floorf((float)(v7 / 50.0) + 60.0);
  v15 = (int)v11;
  if ( (int)v11 > v14 )
    return 0;
  while ( 1 )
  {
    v17 = v13;
    if ( v13 <= v12 )
      break;
LABEL_18:
    v18 = v15++ < v14;
    if ( !v18 )
      return 0;
  }
  while ( !CPhysical::ProcessCollisionSectorList(this, v17, v15) )
  {
    v18 = v17++ < v12;
    if ( !v18 )
      goto LABEL_18;
  }
  return 1;
}

//----- (003FF7FC) --------------------------------------------------------
bool __fastcall CPhysical::ProcessCollisionSectorList(CPhysical *this, Int32 x, Int32 y)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d12
  float32x2_t v5; // d13
  char v9; // r0
  float m_fRadius; // s16
  Int32 v11; // r1
  Int32 v12; // r3
  unsigned __int64 v13; // d9
  int v14; // r8
  CRepeatSector *v15; // r1
  CSector *v16; // r0
  CPtrNode *m_pHead; // r9
  float32x2_t v18; // d11
  int v19; // r0
  bool v20; // zf
  CColPoint *v21; // r5
  int v22; // r4
  float v23; // s2
  float v24; // s12
  float32x4_t v25; // q1
  float v26; // s14
  float32x4_t v27; // q8
  float v28; // s12
  float32x4_t v29; // q2
  RwReal v30; // s12
  bool v31; // zf
  float v32; // s3
  float v33; // s14
  RwReal v34; // s8
  float v35; // s2
  float v36; // s14
  float32x2_t v37; // d14
  float v38; // s0
  float32x2_t v39; // d11
  CColPoint *v40; // r5
  int v41; // r4
  CEntity::CFlags v42; // r0
  int v43; // r10
  __int64 v44; // d16
  __int64 v45; // d16
  CColPoint *v46; // r5
  float v47; // s0
  CEntity::CFlags v48; // r0
  __int64 v49; // d16
  __int64 v50; // d16
  RwReal z; // r0
  CVector *v52; // r1
  int v53; // r4
  CColPoint *v54; // r5
  float v55; // s0
  CColPoint *v56; // r5
  int v57; // r4
  __int64 v58; // r0
  __int64 v59; // d16
  int v60; // r1
  int v61; // r3
  bool v62; // zf
  float v63; // s0
  float v64; // s4
  float v65; // s2
  CColModel *m_pColModel; // r1
  RwReal v67; // s0
  RwReal v68; // s4
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  CColModel *v71; // r1
  RwReal v72; // s0
  RwReal v73; // s4
  const CMatrix *v74; // r0
  float *v75; // r1
  CMatrix *v76; // r0
  CObject *m_pVoid; // r0
  CMatrix *v78; // r0
  char v79; // r0
  int v80; // r0
  int v81; // r0
  __int64 v82; // d16
  __int64 v83; // d16
  CPtrNode v84; // kr00_8
  bool v85; // zf
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CEntity *m_pAttachToEntity; // r1
  CEntity *m_pNOCollisionVehicle; // r1
  bool v89; // zf
  int v90; // r0
  int v91; // r1
  float v92; // s28
  CColPoint *v93; // r10
  int v94; // r5
  int v95; // r0
  int v96; // r1
  int v97; // r2
  float v98; // s24
  float v99; // s26
  CPhysical *v100; // r0
  float AdhesiveLimit; // r1
  float v102; // s2
  int v103; // r1
  float *p_xx; // r0
  float v105; // s0
  int m_nSurfaceType; // r0
  bool v107; // zf
  float v108; // s29
  float v109; // s17
  char v110; // r0
  CVector *vecMoveInc; // [sp+0h] [bp-1A0h]
  int v113; // [sp+18h] [bp-188h]
  int v114; // [sp+18h] [bp-188h]
  CEntity **v115; // [sp+4Ch] [bp-154h]
  CVector *p_m_vecMoveFriction; // [sp+60h] [bp-140h]
  CVector *p_m_vecTurnFriction; // [sp+64h] [bp-13Ch]
  CVector *p_m_vecMoveSpeed; // [sp+84h] [bp-11Ch]
  char v119; // [sp+94h] [bp-10Ch]
  CPtrListDoubleLink *v120; // [sp+A0h] [bp-100h]
  CPtrListDoubleLink *v121; // [sp+A4h] [bp-FCh]
  CRepeatSector *v122; // [sp+A8h] [bp-F8h]
  CSector *v123; // [sp+ACh] [bp-F4h]
  CEntity::CFlags *p_m_nFlags; // [sp+B0h] [bp-F0h]
  int v125; // [sp+B8h] [bp-E8h]
  int v126; // [sp+B8h] [bp-E8h]
  CPhysical *v127; // [sp+BCh] [bp-E4h]
  CVector v128; // [sp+C0h] [bp-E0h] BYREF
  CMatrix v129; // [sp+D0h] [bp-D0h] BYREF
  CVector v; // [sp+118h] [bp-88h] BYREF
  CVector centre; // [sp+128h] [bp-78h] BYREF
  char v132; // [sp+134h] [bp-6Ch] BYREF
  char v133; // [sp+135h] [bp-6Bh] BYREF
  unsigned __int8 v134; // [sp+136h] [bp-6Ah] BYREF
  unsigned __int8 v135; // [sp+137h] [bp-69h] BYREF
  float fImpulseMagnitudeB; // [sp+138h] [bp-68h] BYREF
  float fImpulseMagnitude[25]; // [sp+13Ch] [bp-64h] BYREF

  v9 = `guard variable for'CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;
  __dmb(0xBu);
  if ( (v9 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CPhysical::ProcessCollisionSectorList(int,int)::aColPoints) )
  {
    _cxa_guard_release((__guard *)&`guard variable for'CPhysical::ProcessCollisionSectorList(int,int)::aColPoints);
  }
  fImpulseMagnitudeB = -1.0;
  fImpulseMagnitude[0] = -1.0;
  v135 = 0;
  v134 = 0;
  v133 = 0;
  v132 = 0;
  m_fRadius = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  CEntity::GetBoundCentre(this, &centre);
  v11 = 0;
  if ( x > 0 )
    v11 = x;
  v12 = 0;
  if ( v11 >= 119 )
    v11 = 119;
  if ( y > 0 )
    v12 = y;
  if ( v12 >= 119 )
    v12 = 119;
  HIDWORD(v13) = 20.0;
  LODWORD(v13) = 0;
  v123 = &CWorld::ms_aSectors[120 * v12 + v11];
  v14 = 4;
  v127 = this;
  v15 = &CWorld::ms_aRepeatSectors[x & 0xF | (16 * (y & 0xF))];
  v115 = &this[3].m_aCollisionRecordPtrs[4];
  p_m_vecTurnFriction = &this->m_vecTurnFriction;
  p_m_vecMoveFriction = &this->m_vecMoveFriction;
  p_m_vecMoveSpeed = &this->m_vecMoveSpeed;
  p_m_nFlags = &this->m_nFlags;
  v121 = &v15->m_ptrListArray[1];
  v120 = &v15->m_ptrListArray[2];
  v122 = v15;
  v119 = 0;
LABEL_259:
  switch ( v14 )
  {
    case 0:
      v110 = v119;
      return v110 & 1;
    case 1:
      v16 = (CSector *)v121;
      goto LABEL_14;
    case 2:
      v16 = (CSector *)v120;
      goto LABEL_14;
    case 3:
      v16 = (CSector *)v122;
      goto LABEL_14;
    case 4:
      v16 = v123;
      goto LABEL_14;
    default:
      v16 = 0;
LABEL_14:
      --v14;
      m_pHead = v16->m_buildingPtrListArray.m_pHead;
      break;
  }
  while ( 1 )
  {
    while ( 1 )
    {
      while ( 1 )
      {
        while ( 1 )
        {
          while ( 1 )
          {
            do
            {
              if ( !m_pHead )
                goto LABEL_259;
              v84 = *m_pHead;
              m_pHead = m_pHead->m_pNext;
              v85 = v84.m_pVoid == this;
              if ( v84.m_pVoid != this )
              {
                x = (Int32)v84.m_pVoid + 28;
                v85 = (*((_DWORD *)v84.m_pVoid + 7) & 1) == 0;
              }
            }
            while ( v85 || *((unsigned __int16 *)v84.m_pVoid + 24) == CWorld::ms_nCurrentScanCode );
            if ( CEntity::GetIsTouching((const CEntity *)v84.m_pVoid, &centre, m_fRadius) )
              break;
            if ( this->m_pNOCollisionVehicle == v84.m_pVoid && this->m_pAttachToEntity != v84.m_pVoid )
              this->m_pNOCollisionVehicle = 0;
            if ( (unsigned __int8)((*((_BYTE *)v84.m_pVoid + 58) & 7) - 2) <= 2u
              && *((CPhysical **)v84.m_pVoid + 75) == this
              && *((CPhysical **)v84.m_pVoid + 64) != this )
            {
              *((_DWORD *)v84.m_pVoid + 75) = 0;
            }
          }
          v135 = 0;
          v134 = 0;
          v133 = 0;
          v132 = 0;
          m_nPhysicalFlags = this->m_nPhysicalFlags;
          this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags & 0xFFFFEFFF);
          if ( (*((_BYTE *)v84.m_pVoid + 58) & 7) == 1 )
          {
            v134 = 0;
            if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) != 0 && (*(_BYTE *)p_m_nFlags & 0x10) != 0 )
              v132 = 1;
            if ( (*(_BYTE *)&m_nPhysicalFlags & 4) != 0
              && ((*(_BYTE *)&this->m_info & 7) != 2 || this[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)&byte_6) )
            {
              goto LABEL_202;
            }
            m_pAttachToEntity = this->m_pAttachToEntity;
            if ( m_pAttachToEntity )
            {
              if ( (unsigned __int8)((*(_BYTE *)&m_pAttachToEntity->m_info & 7) - 2) <= 2u
                && (LOBYTE(m_pAttachToEntity[1].m_transform.m_translate.y) & 4) != 0 )
              {
                goto LABEL_202;
              }
            }
            m_pNOCollisionVehicle = this->m_pNOCollisionVehicle;
            v89 = m_pNOCollisionVehicle == v84.m_pVoid;
            if ( m_pNOCollisionVehicle != v84.m_pVoid )
              v89 = (*(_BYTE *)&m_nPhysicalFlags & 0x82) == 128;
            if ( v89
              || (*(_DWORD *)&m_nPhysicalFlags & 0x1000000) != 0
              && ((*(_BYTE *)&this->m_info >> 3) | 8) != 8
              && CEntity::DoesNotCollideWithFlyers((CEntity *)v84.m_pVoid) )
            {
LABEL_202:
              v90 = 1;
              v135 = 1;
              goto LABEL_203;
            }
          }
          else
          {
            (*((void (__fastcall **)(CPhysical *, void *, _DWORD, unsigned __int8 *, unsigned __int8 *, char *, char *))this->_vptr$CPlaceable
             + 16))(
              this,
              v84.m_pVoid,
              0,
              &v135,
              &v134,
              &v133,
              &v132);
          }
          v90 = v135;
LABEL_203:
          if ( *(_DWORD *)p_m_nFlags << 31 && !((v134 | v90) << 24) )
            break;
          *((_WORD *)v84.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
          if ( !v90 )
          {
            v95 = (*((int (__fastcall **)(CPhysical *, void *, CColPoint *))this->_vptr$CPlaceable + 23))(
                    this,
                    v84.m_pVoid,
                    CPhysical::ProcessCollisionSectorList(int,int)::aColPoints);
            if ( *((unsigned __int8 *)&this->m_nPhysicalFlags + 2) << 31 && v95 >= 1 && !v134 )
              goto LABEL_266;
            if ( !v95 && this->m_pNOCollisionVehicle == v84.m_pVoid && FindPlayerPed(-1) == this )
              this->m_pNOCollisionVehicle = 0;
          }
        }
        if ( (*((_BYTE *)v84.m_pVoid + 58) & 7) == 1 || (*((_DWORD *)v84.m_pVoid + 17) & 8) != 0 || v133 )
          break;
        *((_WORD *)v84.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
        v114 = (*((int (__fastcall **)(CPhysical *, void *, CColPoint *))this->_vptr$CPlaceable + 23))(
                 this,
                 v84.m_pVoid,
                 CPhysical::ProcessCollisionSectorList(int,int)::aColPoints);
        if ( v114 >= 1 )
        {
          v96 = *(_DWORD *)x;
          v97 = *(_DWORD *)x & 8;
          if ( (*(_DWORD *)p_m_nFlags & 8) != 0 )
          {
            if ( v97 )
            {
              v37.n64_u64[0] = v13;
              v53 = v114;
              v54 = CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;
              v126 = 0;
              v39.n64_u64[0] = v13;
              do
              {
                if ( v132
                  || (unsigned __int8)(v54->m_dataA.m_nPieceType - 13) < 4u
                  || (unsigned __int8)(v54->m_dataB.m_nPieceType - 13) <= 3u )
                {
                  CPhysical::ApplySoftCollision(
                    this,
                    (CPhysical *)v84.m_pVoid,
                    v54,
                    fImpulseMagnitude,
                    &fImpulseMagnitudeB);
                  ++v126;
                  if ( (unsigned __int8)(v54->m_dataB.m_nPieceType - 13) <= 3u )
                    CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, this, v54, -1.0);
                }
                else if ( CPhysical::ApplyCollision(
                            this,
                            (CPhysical *)v84.m_pVoid,
                            v54,
                            fImpulseMagnitude,
                            &fImpulseMagnitudeB) )
                {
                  v4.n64_f32[0] = fImpulseMagnitude[0];
                  v5.n64_f32[0] = fImpulseMagnitudeB;
                  CPhysical::SetDamagedPieceRecord(this, fImpulseMagnitude[0], (CEntity *)v84.m_pVoid, v54, 1.0);
                  CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, this, v54, -1.0);
                  v37.n64_u64[0] = vmax_f32(v5, v37).n64_u64[0];
                  v39.n64_u64[0] = vmax_f32(v4, v39).n64_u64[0];
                }
                ++v54;
                --v53;
              }
              while ( v53 );
            }
            else
            {
              *(_DWORD *)&v42 = *(_DWORD *)p_m_nFlags & 0xFFFFFFF7;
              v37.n64_u64[0] = v13;
              v43 = v114;
              v42.bdummy = p_m_nFlags->bdummy;
              v44 = *(_QWORD *)&p_m_vecMoveFriction->x;
              v129.zx = p_m_vecMoveFriction->z;
              v39.n64_u64[0] = v13;
              *(_QWORD *)&v129.xx = v44;
              v45 = *(_QWORD *)&p_m_vecTurnFriction->x;
              v.z = p_m_vecTurnFriction->z;
              *(_QWORD *)&v.x = v45;
              *p_m_nFlags = v42;
              p_m_vecMoveFriction[1].z = 0.0;
              *(_QWORD *)&p_m_vecMoveFriction->x = 0LL;
              *(_QWORD *)&p_m_vecMoveFriction->z = 0LL;
              v46 = CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;
              v126 = 0;
              p_m_vecMoveFriction[1].y = 0.0;
              do
              {
                if ( v132
                  || (unsigned __int8)(v46->m_dataA.m_nPieceType - 13) < 4u
                  || (unsigned __int8)(v46->m_dataB.m_nPieceType - 13) <= 3u )
                {
                  CPhysical::ApplySoftCollision(
                    v127,
                    (CPhysical *)v84.m_pVoid,
                    v46,
                    fImpulseMagnitude,
                    &fImpulseMagnitudeB);
                  ++v126;
                  if ( (unsigned __int8)(v46->m_dataB.m_nPieceType - 13) <= 3u )
                    CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, v127, v46, -1.0);
                }
                else if ( CPhysical::ApplyCollision(
                            v127,
                            (CPhysical *)v84.m_pVoid,
                            v46,
                            fImpulseMagnitude,
                            &fImpulseMagnitudeB) )
                {
                  v4.n64_f32[0] = fImpulseMagnitude[0];
                  v5.n64_f32[0] = fImpulseMagnitudeB;
                  CPhysical::SetDamagedPieceRecord(v127, fImpulseMagnitude[0], (CEntity *)v84.m_pVoid, v46, 1.0);
                  CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, v127, v46, -1.0);
                  v37.n64_u64[0] = vmax_f32(v5, v37).n64_u64[0];
                  v47 = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v46) / (float)v114;
                  v39.n64_u64[0] = vmax_f32(v4, v39).n64_u64[0];
                  if ( (*(_BYTE *)&v127->m_info & 7) == 2
                    && (*((_BYTE *)v84.m_pVoid + 58) & 7) == 2
                    && ((float)((float)((float)(v127->m_vecMoveSpeed.x * v127->m_vecMoveSpeed.x)
                                      + (float)(v127->m_vecMoveSpeed.y * v127->m_vecMoveSpeed.y))
                              + (float)(v127->m_vecMoveSpeed.z * v127->m_vecMoveSpeed.z)) > PHYSICAL_CAR_FRICTION_SPEED_LIMSQR
                     || (float)((float)((float)(v127->m_vecTurnSpeed.x * v127->m_vecTurnSpeed.x)
                                      + (float)(v127->m_vecTurnSpeed.y * v127->m_vecTurnSpeed.y))
                              + (float)(v127->m_vecTurnSpeed.z * v127->m_vecTurnSpeed.z)) > PHYSICAL_CAR_FRICTION_TURN_LIMSQR) )
                  {
                    v47 = v47 * (float)(PHYSICAL_CARCAR_FRICTION_MULT * fImpulseMagnitude[0]);
                  }
                  if ( (*(_DWORD *)x & 0x40004) != 0 )
                  {
                    if ( CPhysical::ApplyFriction(v127, v47, v46) )
                      *(_DWORD *)p_m_nFlags |= 8u;
                  }
                  else if ( CPhysical::ApplyFriction(v127, (CPhysical *)v84.m_pVoid, v47, v46) )
                  {
                    *(_DWORD *)p_m_nFlags |= 8u;
                    *(_DWORD *)x |= 8u;
                  }
                }
                ++v46;
                --v43;
              }
              while ( v43 );
              this = v127;
              if ( (*(_DWORD *)p_m_nFlags & 8) == 0 )
              {
                *(_DWORD *)&v48 = *(_DWORD *)p_m_nFlags | 8;
                v48.bdummy = p_m_nFlags->bdummy;
                *p_m_nFlags = v48;
                v49 = *(_QWORD *)&v129.xx;
                p_m_vecMoveFriction->z = v129.zx;
                *(_QWORD *)&p_m_vecMoveFriction->x = v49;
                v50 = *(_QWORD *)&v.x;
                z = v.z;
                v52 = p_m_vecTurnFriction;
LABEL_116:
                v52->z = z;
                *(_QWORD *)&v52->x = v50;
              }
            }
          }
          else
          {
            if ( !v97 )
            {
              v37.n64_u64[0] = v13;
              v40 = CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;
              v41 = v114;
              v39.n64_u64[0] = v13;
              v126 = 0;
              do
              {
                if ( v132 || (unsigned __int8)(v40->m_dataA.m_nPieceType - 13) <= 3u )
                {
                  CPhysical::ApplySoftCollision(
                    this,
                    (CPhysical *)v84.m_pVoid,
                    v40,
                    fImpulseMagnitude,
                    &fImpulseMagnitudeB);
                  ++v126;
                  if ( (unsigned __int8)(v40->m_dataB.m_nPieceType - 13) <= 3u )
                    CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, this, v40, -1.0);
                }
                else if ( CPhysical::ApplyCollision(
                            this,
                            (CPhysical *)v84.m_pVoid,
                            v40,
                            fImpulseMagnitude,
                            &fImpulseMagnitudeB) )
                {
                  v4.n64_f32[0] = fImpulseMagnitude[0];
                  v5.n64_f32[0] = fImpulseMagnitudeB;
                  CPhysical::SetDamagedPieceRecord(this, fImpulseMagnitude[0], (CEntity *)v84.m_pVoid, v40, 1.0);
                  CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, this, v40, -1.0);
                  v37.n64_u64[0] = vmax_f32(v5, v37).n64_u64[0];
                  v38 = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v40) / (float)v114;
                  v39.n64_u64[0] = vmax_f32(v4, v39).n64_u64[0];
                  if ( (*(_BYTE *)&this->m_info & 7) == 2
                    && (*((_BYTE *)v84.m_pVoid + 58) & 7) == 2
                    && ((float)((float)((float)(this->m_vecMoveSpeed.x * this->m_vecMoveSpeed.x)
                                      + (float)(this->m_vecMoveSpeed.y * this->m_vecMoveSpeed.y))
                              + (float)(this->m_vecMoveSpeed.z * this->m_vecMoveSpeed.z)) > PHYSICAL_CAR_FRICTION_SPEED_LIMSQR
                     || (float)((float)((float)(this->m_vecTurnSpeed.x * this->m_vecTurnSpeed.x)
                                      + (float)(this->m_vecTurnSpeed.y * this->m_vecTurnSpeed.y))
                              + (float)(this->m_vecTurnSpeed.z * this->m_vecTurnSpeed.z)) > PHYSICAL_CAR_FRICTION_TURN_LIMSQR) )
                  {
                    v38 = v38 * (float)(PHYSICAL_CARCAR_FRICTION_MULT * fImpulseMagnitude[0]);
                  }
                  if ( (*(_DWORD *)x & 0x40004) != 0 )
                  {
                    if ( CPhysical::ApplyFriction(this, v38, v40) )
                      *(_DWORD *)p_m_nFlags |= 8u;
                  }
                  else if ( CPhysical::ApplyFriction(this, (CPhysical *)v84.m_pVoid, v38, v40) )
                  {
                    *(_DWORD *)p_m_nFlags |= 8u;
                    *(_DWORD *)x |= 8u;
                  }
                }
                ++v40;
                --v41;
              }
              while ( v41 );
              goto LABEL_117;
            }
            v37.n64_u64[0] = v13;
            v81 = *(_DWORD *)(x + 4);
            v82 = *((_QWORD *)v84.m_pVoid + 12);
            v56 = CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;
            v129.zx = *((float *)v84.m_pVoid + 26);
            v39.n64_u64[0] = v13;
            *(_QWORD *)&v129.xx = v82;
            v83 = *(_QWORD *)((char *)v84.m_pVoid + 108);
            v57 = v114;
            v.z = *((RwReal *)v84.m_pVoid + 29);
            *(_QWORD *)&v.x = v83;
            *(_DWORD *)x = v96 & 0xFFFFFFF7;
            *(_DWORD *)(x + 4) = v81;
            *((_QWORD *)v84.m_pVoid + 12) = 0LL;
            *((_QWORD *)v84.m_pVoid + 13) = 0LL;
            *((_DWORD *)v84.m_pVoid + 28) = 0;
            v126 = 0;
            *((_DWORD *)v84.m_pVoid + 29) = 0;
            do
            {
              if ( v132
                || (unsigned __int8)(v56->m_dataA.m_nPieceType - 13) < 4u
                || (unsigned __int8)(v56->m_dataB.m_nPieceType - 13) <= 3u )
              {
                CPhysical::ApplySoftCollision(
                  this,
                  (CPhysical *)v84.m_pVoid,
                  v56,
                  fImpulseMagnitude,
                  &fImpulseMagnitudeB);
                ++v126;
                if ( (unsigned __int8)(v56->m_dataB.m_nPieceType - 13) <= 3u )
                  CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, this, v56, -1.0);
              }
              else if ( CPhysical::ApplyCollision(
                          this,
                          (CPhysical *)v84.m_pVoid,
                          v56,
                          fImpulseMagnitude,
                          &fImpulseMagnitudeB) )
              {
                v4.n64_f32[0] = fImpulseMagnitude[0];
                v5.n64_f32[0] = fImpulseMagnitudeB;
                CPhysical::SetDamagedPieceRecord(this, fImpulseMagnitude[0], (CEntity *)v84.m_pVoid, v56, 1.0);
                CPhysical::SetDamagedPieceRecord((CPhysical *)v84.m_pVoid, fImpulseMagnitudeB, this, v56, -1.0);
                v37.n64_u64[0] = vmax_f32(v5, v37).n64_u64[0];
                v55 = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v56) / (float)v114;
                v39.n64_u64[0] = vmax_f32(v4, v39).n64_u64[0];
                if ( (*(_BYTE *)&this->m_info & 7) == 2
                  && (*((_BYTE *)v84.m_pVoid + 58) & 7) == 2
                  && ((float)((float)((float)(this->m_vecMoveSpeed.x * this->m_vecMoveSpeed.x)
                                    + (float)(this->m_vecMoveSpeed.y * this->m_vecMoveSpeed.y))
                            + (float)(this->m_vecMoveSpeed.z * this->m_vecMoveSpeed.z)) > PHYSICAL_CAR_FRICTION_SPEED_LIMSQR
                   || (float)((float)((float)(this->m_vecTurnSpeed.x * this->m_vecTurnSpeed.x)
                                    + (float)(this->m_vecTurnSpeed.y * this->m_vecTurnSpeed.y))
                            + (float)(this->m_vecTurnSpeed.z * this->m_vecTurnSpeed.z)) > PHYSICAL_CAR_FRICTION_TURN_LIMSQR) )
                {
                  v55 = v55 * (float)(PHYSICAL_CARCAR_FRICTION_MULT * fImpulseMagnitude[0]);
                }
                if ( (*(_DWORD *)x & 0x40004) != 0 )
                {
                  if ( CPhysical::ApplyFriction(this, v55, v56) )
                    *(_DWORD *)p_m_nFlags |= 8u;
                }
                else if ( CPhysical::ApplyFriction(this, (CPhysical *)v84.m_pVoid, v55, v56) )
                {
                  *(_DWORD *)p_m_nFlags |= 8u;
                  *(_DWORD *)x |= 8u;
                }
              }
              ++v56;
              --v57;
            }
            while ( v57 );
            if ( (*(_DWORD *)x & 8) == 0 )
            {
              HIDWORD(v58) = *(_DWORD *)(x + 4);
              LODWORD(v58) = *(_DWORD *)x | 8;
              *(_QWORD *)x = v58;
              v59 = *(_QWORD *)&v129.xx;
              *((_DWORD *)v84.m_pVoid + 26) = LODWORD(v129.zx);
              *((_QWORD *)v84.m_pVoid + 12) = v59;
              z = v.z;
              v52 = (CVector *)((char *)v84.m_pVoid + 108);
              v50 = *(_QWORD *)&v.x;
              goto LABEL_116;
            }
          }
LABEL_117:
          if ( (*((_BYTE *)v84.m_pVoid + 58) & 7) == 3
            && (*(_BYTE *)&this->m_info & 7) == 2
            && (!CPed::IsPlayer((const CPed *)v84.m_pVoid)
             || (*(_BYTE *)(x + 1) & 0x10) != 0
             && (float)((float)((float)(this->m_vecMoveSpeed.x * this->m_vecMoveSpeed.x)
                              + (float)(this->m_vecMoveSpeed.y * this->m_vecMoveSpeed.y))
                      + (float)(this->m_vecMoveSpeed.z * this->m_vecMoveSpeed.z)) > 0.0025) )
          {
            CPed::KillPedWithCar((CPed *)v84.m_pVoid, (CVehicle *)this, v37.n64_f32[0], 0);
          }
          else
          {
            v60 = *(_BYTE *)&this->m_info & 7;
            v61 = *((_BYTE *)v84.m_pVoid + 58) & 7;
            if ( v60 == 3 )
            {
              v62 = v61 == 2;
              if ( v61 == 2 )
                v62 = *((_DWORD *)v84.m_pVoid + 361) == 6;
              if ( v62 )
              {
                v63 = *((float *)v84.m_pVoid + 18);
                v64 = *((float *)v84.m_pVoid + 19);
                v65 = *((float *)v84.m_pVoid + 20);
                if ( (float)((float)((float)(v63 * this->m_vecDamageNormal.x) + (float)(v64 * this->m_vecDamageNormal.y))
                           + (float)(v65 * this->m_vecDamageNormal.z)) > 0.2
                  || (*((_BYTE *)v115 + 10) & 0x10) != 0
                  && (float)((float)((float)(v63 * v63) + (float)(v64 * v64)) + (float)(v65 * v65)) > 0.0005 )
                {
                  CPed::KillPedWithCar((CPed *)this, (CVehicle *)v84.m_pVoid, v39.n64_f32[0] + v39.n64_f32[0], 0);
                  goto LABEL_162;
                }
              }
            }
            if ( v61 == 4 && *(_DWORD *)x << 31 && v60 == 2 )
            {
              if ( v37.n64_f32[0] > 20.0 && *((_BYTE *)v84.m_pVoid + 328) )
              {
                CObject::ObjectDamage(
                  (CObject *)v84.m_pVoid,
                  v37.n64_f32[0],
                  &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecPosition,
                  &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecNormal,
                  (int)this,
                  WEAPONTYPE_RUNOVERBYCAR);
                goto LABEL_162;
              }
              if ( *((unsigned __int8 *)v84.m_pVoid + 328) < 0x14u )
                goto LABEL_162;
              v129.m_pRwMat = 0;
              v129.m_owner = 0;
              m_pColModel = CModelInfo::ms_modelInfoPtrs[*((__int16 *)v84.m_pVoid + 19)]->m_pColModel;
              v67 = m_pColModel->m_boxBound.m_vecMax.x - m_pColModel->m_boxBound.m_vecMin.x;
              v68 = m_pColModel->m_boxBound.m_vecMax.z - m_pColModel->m_boxBound.m_vecMin.z;
              v.y = m_pColModel->m_boxBound.m_vecMax.y - m_pColModel->m_boxBound.m_vecMin.y;
              v.x = v67;
              v.z = v68;
              operator*(&v128, *((const CMatrix **)v84.m_pVoid + 5), &v);
              v = v128;
              m_pMat = this->m_pMat;
              p_tx = (CSimpleTransform *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = &this->m_transform;
              if ( p_tx->m_translate.z > v128.z )
              {
                vecMoveInc = (CVector *)this;
                goto LABEL_156;
              }
              x = (Int32)&v129;
              v76 = Invert(m_pMat, &v129);
              CMatrix::operator=(&v129, v76);
              operator*(&v128, &v129, &v);
              if ( v128.z < 0.0 )
              {
                vecMoveInc = (CVector *)this;
LABEL_156:
                m_pVoid = (CObject *)v84.m_pVoid;
LABEL_160:
                CObject::ObjectDamage(
                  m_pVoid,
                  50.0,
                  &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecPosition,
                  &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecNormal,
                  (int)vecMoveInc,
                  WEAPONTYPE_RUNOVERBYCAR);
              }
LABEL_161:
              CMatrix::~CMatrix(&v129);
              goto LABEL_162;
            }
            if ( v60 == 4 && *(_DWORD *)p_m_nFlags << 31 && v61 == 2 )
            {
              if ( v37.n64_f32[0] > 20.0 && LOBYTE(this[1].m_transform.m_translate.z) )
              {
                CObject::ObjectDamage(
                  (CObject *)this,
                  v37.n64_f32[0],
                  &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecPosition,
                  &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecNormal,
                  (int)v84.m_pVoid,
                  WEAPONTYPE_RUNOVERBYCAR);
                goto LABEL_162;
              }
              if ( *((unsigned __int8 *)v84.m_pVoid + 328) < 0x14u )
                goto LABEL_162;
              v129.m_pRwMat = 0;
              v129.m_owner = 0;
              v71 = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
              v72 = v71->m_boxBound.m_vecMax.x - v71->m_boxBound.m_vecMin.x;
              v73 = v71->m_boxBound.m_vecMax.z - v71->m_boxBound.m_vecMin.z;
              v.y = v71->m_boxBound.m_vecMax.y - v71->m_boxBound.m_vecMin.y;
              v.x = v72;
              v.z = v73;
              operator*(&v128, this->m_pMat, &v);
              v = v128;
              v74 = (const CMatrix *)*((_DWORD *)v84.m_pVoid + 5);
              v75 = &v74->tx;
              if ( !v74 )
                v75 = (float *)((char *)v84.m_pVoid + 4);
              if ( v128.z >= v75[2] )
              {
                x = (Int32)&v129;
                v78 = Invert(v74, &v129);
                CMatrix::operator=(&v129, v78);
                operator*(&v128, &v129, &v);
                if ( v128.z >= 0.0 )
                  goto LABEL_161;
                vecMoveInc = (CVector *)v84.m_pVoid;
              }
              else
              {
                vecMoveInc = (CVector *)v84.m_pVoid;
              }
              m_pVoid = (CObject *)this;
              goto LABEL_160;
            }
          }
LABEL_162:
          v79 = *((_BYTE *)v84.m_pVoid + 58);
          if ( (v79 & 0xF8) == 16 )
          {
            v80 = v79 & 7;
            *((_BYTE *)v84.m_pVoid + 58) = v80 | 0x18;
            if ( v80 == 2 )
              CCarCtrl::SwitchVehicleToRealPhysics((CVehicle *)v84.m_pVoid);
          }
          if ( CWorld::bSecondShift )
            goto LABEL_15;
          if ( v114 > v126 )
            goto LABEL_266;
        }
      }
      *((_WORD *)v84.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
      v91 = (*((int (__fastcall **)(CPhysical *, void *, CColPoint *))this->_vptr$CPlaceable + 23))(
              this,
              v84.m_pVoid,
              CPhysical::ProcessCollisionSectorList(int,int)::aColPoints);
      if ( v91 >= 1 )
      {
        memset(&v129, 0, 12);
        memset(&v, 0, sizeof(v));
        v113 = v91;
        if ( (*(_BYTE *)p_m_nFlags & 8) == 0 )
        {
          v18.n64_u64[0] = v13;
          v92 = (float)v91;
          v93 = CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;
          v94 = v91;
          v125 = 0;
          while ( !v132 && (unsigned __int8)(v93->m_dataA.m_nPieceType - 13) > 3u )
          {
            if ( CPhysical::ApplyCollisionAlt(
                   v127,
                   (CEntity *)v84.m_pVoid,
                   v93,
                   fImpulseMagnitude,
                   (CVector *)&v129,
                   &v) == 1 )
            {
              v4.n64_f32[0] = fImpulseMagnitude[0];
              v18.n64_u64[0] = vmax_f32(v4, v18).n64_u64[0];
              v108 = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v93) / v92;
              ++v125;
              if ( (*(_BYTE *)&v127->m_info & 7) == 2 )
              {
                if ( LODWORD(v127[4].m_vecCOM.z) != 5 || (v109 = 0.0, v93->m_dataB.m_nSurfaceType != 43) )
                {
                  CPhysical::SetDamagedPieceRecord(v127, fImpulseMagnitude[0], (CEntity *)v84.m_pVoid, v93, 1.0);
                  v109 = v108;
                }
                if ( v127->m_nModelIndex == 441 )
                {
                  v102 = v109 * 0.2;
                  goto LABEL_237;
                }
                if ( LODWORD(v127[4].m_vecCOM.z) == 5 )
                {
                  v102 = 0.0;
                  if ( v93->m_vecNormal.z > 0.6 )
                  {
                    if ( SurfaceInfos_c::GetAdhesionGroup(&g_surfaceInfos, v93->m_dataB.m_nSurfaceType) == 3
                      || SurfaceInfos_c::GetAdhesionGroup(&g_surfaceInfos, v93->m_dataB.m_nSurfaceType) == 4 )
                    {
LABEL_230:
                      v102 = v109 * 3.0;
                      goto LABEL_237;
                    }
LABEL_228:
                    v102 = v109;
                  }
                }
                else
                {
                  if ( v127[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)&byte_6 )
                    goto LABEL_228;
                  v103 = *(_BYTE *)&v127->m_info & 0xF8;
                  if ( v103 == 40 )
                    goto LABEL_230;
                  p_xx = &v127->m_pMat->xx;
                  v105 = p_xx[10];
                  if ( v105 <= 0.3
                    || (float)((float)((float)(v127->m_vecMoveSpeed.x * v127->m_vecMoveSpeed.x)
                                     + (float)(v127->m_vecMoveSpeed.y * v127->m_vecMoveSpeed.y))
                             + (float)(v127->m_vecMoveSpeed.z * v127->m_vecMoveSpeed.z)) >= PHYSICAL_CAR_FRICTION_SPEED_LIMSQR
                    || (v102 = 0.0,
                        (float)((float)((float)(v127->m_vecTurnSpeed.x * v127->m_vecTurnSpeed.x)
                                      + (float)(v127->m_vecTurnSpeed.y * v127->m_vecTurnSpeed.y))
                              + (float)(v127->m_vecTurnSpeed.z * v127->m_vecTurnSpeed.z)) >= PHYSICAL_CAR_FRICTION_TURN_LIMSQR) )
                  {
                    if ( v103 == 32
                      || (float)((float)((float)(v93->m_vecNormal.x * p_xx[8]) + (float)(v93->m_vecNormal.y * p_xx[9]))
                               + (float)(v93->m_vecNormal.z * v105)) < 0.707 )
                    {
                      v102 = v109 * (float)((float)(PHYSICAL_CAR_FRICTION_MULT * fImpulseMagnitude[0]) / v127->m_fMass);
                      goto LABEL_237;
                    }
                    goto LABEL_228;
                  }
                }
LABEL_237:
                v100 = v127;
                if ( (*(_BYTE *)&v127->m_info & 7) == 2 && v127[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)&byte_6 )
                  v102 = v102 + v102;
                AdhesiveLimit = v102;
              }
              else
              {
                v98 = fImpulseMagnitude[0];
                v99 = PHYSICAL_CAR_FRICTION_MULT;
                CPhysical::SetDamagedPieceRecord(v127, fImpulseMagnitude[0], (CEntity *)v84.m_pVoid, v93, 1.0);
                v100 = v127;
                AdhesiveLimit = v108 * (float)(v99 * v98);
              }
LABEL_248:
              if ( CPhysical::ApplyFriction(v100, AdhesiveLimit, v93) )
                *(_DWORD *)p_m_nFlags |= 8u;
            }
LABEL_257:
            ++v93;
            if ( !--v94 )
              goto LABEL_30;
          }
          if ( !CPhysical::ApplySoftCollision(v127, (CEntity *)v84.m_pVoid, v93, fImpulseMagnitude) )
            goto LABEL_257;
          m_nSurfaceType = v93->m_dataA.m_nSurfaceType;
          v107 = m_nSurfaceType == 60;
          if ( m_nSurfaceType == 60 )
            v107 = v93->m_dataB.m_nSurfaceType == 60;
          if ( v107 )
            goto LABEL_257;
          AdhesiveLimit = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v93);
          v100 = v127;
          goto LABEL_248;
        }
        v18.n64_u64[0] = v13;
        v22 = v91;
        v21 = CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;
        v125 = 0;
        do
        {
          if ( v132 || (unsigned __int8)(v21->m_dataA.m_nPieceType - 13) <= 3u )
          {
            CPhysical::ApplySoftCollision(v127, (CEntity *)v84.m_pVoid, v21, fImpulseMagnitude);
          }
          else
          {
            x = (Int32)v127;
            if ( CPhysical::ApplyCollisionAlt(
                   v127,
                   (CEntity *)v84.m_pVoid,
                   v21,
                   fImpulseMagnitude,
                   (CVector *)&v129,
                   &v) == 1 )
            {
              v3.n64_f32[0] = fImpulseMagnitude[0];
              v18.n64_u64[0] = vmax_f32(v3, v18).n64_u64[0];
              v19 = *(_BYTE *)&v127->m_info & 7;
              v20 = v19 == 2;
              ++v125;
              if ( v19 == 2 )
                v20 = LODWORD(v127[4].m_vecCOM.z) == 5;
              if ( !v20 || v21->m_dataB.m_nSurfaceType != 43 )
                CPhysical::SetDamagedPieceRecord(v127, fImpulseMagnitude[0], (CEntity *)v84.m_pVoid, v21, 1.0);
            }
          }
          ++v21;
          --v22;
        }
        while ( v22 );
LABEL_30:
        this = v127;
        if ( v125 << 24 )
          break;
      }
    }
    v23 = v.z;
    v24 = 1.0 / (float)(unsigned __int8)v125;
    v3.n64_u32[0] = LODWORD(v.y);
    v25.n128_u64[0] = *(_QWORD *)&v129.xx;
    v25.n128_u64[1] = __PAIR64__(LODWORD(v.x), LODWORD(v129.zx));
    v26 = v24 * v.y;
    v27 = vmulq_n_f32(v25, v24);
    v28 = v24 * v.z;
    v29 = vaddq_f32(v27, *(float32x4_t *)&p_m_vecMoveSpeed->x);
    *(float32x4_t *)&p_m_vecMoveSpeed->x = v29;
    v3.n64_u32[1] = LODWORD(v127->m_vecTurnSpeed.y);
    v30 = v28 + v127->m_vecTurnSpeed.z;
    v127->m_vecTurnSpeed.y = v26 + v3.n64_f32[1];
    v127->m_vecTurnSpeed.z = v30;
    v31 = CWorld::bNoMoreCollisionTorque == 0;
    if ( !CWorld::bNoMoreCollisionTorque )
      v31 = *(_BYTE *)&v127->m_info == 2;
    if ( v31
      && fabsf(v29.n128_f32[0]) > 0.2
      && fabsf(v29.n128_f32[1]) > 0.2
      && !(*((unsigned __int8 *)&v127->m_nPhysicalFlags + 1) << 31) )
    {
      v32 = v127->m_vecTurnFriction.z;
      v33 = 1.0 / (float)v113;
      v3.n64_u32[1] = LODWORD(v127->m_vecTurnFriction.y);
      v25.n128_f32[2] = v127->m_vecMoveFriction.x + (float)((float)(v25.n128_f32[0] * -0.3) / (float)v113);
      v34 = v127->m_vecMoveFriction.y + (float)((float)(v25.n128_f32[1] * -0.3) / (float)v113);
      v25.n128_f32[0] = v33 * (float)(v25.n128_f32[3] * -0.3);
      v3.n64_f32[0] = v33 * (float)(v3.n64_f32[0] * -0.3);
      v35 = v33 * (float)(v23 * -0.3);
      v36 = v127->m_vecTurnFriction.x;
      LODWORD(v127->m_vecMoveFriction.x) = v25.n128_u32[2];
      v127->m_vecMoveFriction.y = v34;
      v127->m_vecTurnFriction.x = v25.n128_f32[0] + v36;
      v127->m_vecTurnFriction.y = v3.n64_f32[0] + v3.n64_f32[1];
      v127->m_vecTurnFriction.z = v35 + v32;
    }
    if ( (*((_BYTE *)v84.m_pVoid + 58) & 7) == 4 && v18.n64_f32[0] > 20.0 && *((_BYTE *)v84.m_pVoid + 328) )
      CObject::ObjectDamage(
        (CObject *)v84.m_pVoid,
        v18.n64_f32[0],
        &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecPosition,
        &CPhysical::ProcessCollisionSectorList(int,int)::aColPoints[0].m_vecNormal,
        (int)v127,
        WEAPONTYPE_UNIDENTIFIED);
    if ( !CWorld::bSecondShift )
      break;
LABEL_15:
    v119 = 1;
  }
LABEL_266:
  v110 = 1;
  return v110 & 1;
}
// 3FFA80: variable 'v3' is possibly undefined
// 3FFCAE: variable 'v5' is possibly undefined
// 3FFCBC: variable 'v4' is possibly undefined
// 6: using guessed type char byte_6;
// 95A3B8: using guessed type char `guard variable for'CPhysical::ProcessCollisionSectorList(int,int)::aColPoints;

//----- (00400C8C) --------------------------------------------------------
bool __fastcall CPhysical::ProcessCollisionSectorList_SimpleCar(CPhysical *this, CRepeatSector *pSectorList)
{
  char v3; // r0
  float m_fRadius; // s16
  CRepeatSector *v5; // r1
  int v6; // r8
  CPtrNode *m_pHead; // r10
  CPtrNode v8; // kr00_8
  int v9; // r0
  _DWORD *v10; // r6
  int v11; // r0
  int v12; // r11
  int v14; // r2
  float v15; // s16
  CColPoint *v16; // r8
  float v17; // r0
  uint32 bdummy; // r0
  float v19; // s16
  CColPoint *v20; // r8
  float AdhesiveLimit; // r0
  CEntity::CFlags v22; // r0
  __int64 v23; // r0
  float v24; // s16
  CColPoint *v25; // r8
  float v26; // r0
  __int64 v27; // r0
  CColPoint *v28; // r6
  char v29; // r0
  int v30; // r0
  CEntity::CFlags *p_m_nFlags; // [sp+4h] [bp-74h]
  CRepeatSector *v33; // [sp+10h] [bp-68h]
  CVector *p_m_vecTurnFriction; // [sp+10h] [bp-68h]
  CVector *p_m_vecMoveFriction; // [sp+14h] [bp-64h]
  __int64 v36; // [sp+18h] [bp-60h]
  RwReal v37; // [sp+20h] [bp-58h]
  __int64 v38; // [sp+28h] [bp-50h]
  RwReal z; // [sp+30h] [bp-48h]
  CVector centre; // [sp+34h] [bp-44h] BYREF
  float fImpulseMagnitude; // [sp+40h] [bp-38h] BYREF
  float fImpulseMagnitudeA[13]; // [sp+44h] [bp-34h] BYREF

  v3 = `guard variable for'CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints;
  __dmb(0xBu);
  if ( (v3 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints) )
  {
    _cxa_guard_release((__guard *)&`guard variable for'CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints);
  }
  fImpulseMagnitude = -1.0;
  fImpulseMagnitudeA[0] = -1.0;
  if ( (*(_BYTE *)&this->m_nFlags & 1) == 0 )
    return 0;
  p_m_nFlags = &this->m_nFlags;
  m_fRadius = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  CEntity::GetBoundCentre(this, &centre);
  v5 = 0;
  v6 = 2;
  do
  {
LABEL_6:
    switch ( v6 )
    {
      case 1:
        v5 = pSectorList;
        break;
      case 2:
        v5 = (CRepeatSector *)&pSectorList->m_ptrListArray[2];
        break;
      case 0:
        return 0;
    }
    m_pHead = v5->m_ptrListArray[0].m_pHead;
    --v6;
  }
  while ( !v5->m_ptrListArray[0].m_pHead );
  v33 = v5;
  while ( 1 )
  {
    v8 = *m_pHead;
    m_pHead = m_pHead->m_pNext;
    if ( (*((_BYTE *)v8.m_pVoid + 58) & 7) != 4 || !(*((unsigned __int8 *)v8.m_pVoid + 325) << 31) )
    {
      if ( v8.m_pVoid != this )
        goto LABEL_23;
      goto LABEL_27;
    }
    v9 = *((_DWORD *)v8.m_pVoid + 5);
    if ( v9 )
      break;
    CPlaceable::AllocateMatrix((CPlaceable *)v8.m_pVoid);
    CSimpleTransform::UpdateMatrix((const CSimpleTransform *)((char *)v8.m_pVoid + 4), *((CMatrix **)v8.m_pVoid + 5));
    v9 = *((_DWORD *)v8.m_pVoid + 5);
    if ( v8.m_pVoid != this )
      goto LABEL_22;
LABEL_27:
    if ( !m_pHead )
    {
      v5 = v33;
      goto LABEL_6;
    }
  }
  if ( v8.m_pVoid == this )
    goto LABEL_27;
LABEL_22:
  if ( *(float *)(v9 + 40) < 0.66 )
    goto LABEL_27;
LABEL_23:
  if ( *((unsigned __int16 *)v8.m_pVoid + 24) == CWorld::ms_nCurrentScanCode )
    goto LABEL_27;
  v10 = (char *)v8.m_pVoid + 28;
  if ( (*((_BYTE *)v8.m_pVoid + 28) & 1) == 0 )
    goto LABEL_27;
  if ( !CEntity::GetIsTouching((const CEntity *)v8.m_pVoid, &centre, m_fRadius) )
    goto LABEL_27;
  *((_WORD *)v8.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
  v11 = (*((int (__fastcall **)(CPhysical *, void *, CColPoint *))this->_vptr$CPlaceable + 23))(
          this,
          v8.m_pVoid,
          CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints);
  v12 = v11;
  if ( v11 <= 0 )
    goto LABEL_27;
  v14 = *v10 & 8;
  if ( (*(_DWORD *)p_m_nFlags & 8) != 0 )
  {
    if ( v14 )
    {
      v28 = CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints;
      do
      {
        if ( CPhysical::ApplyCollision(this, (CPhysical *)v8.m_pVoid, v28, fImpulseMagnitudeA, &fImpulseMagnitude) )
        {
          CPhysical::SetDamagedPieceRecord(this, fImpulseMagnitudeA[0], (CEntity *)v8.m_pVoid, v28, 1.0);
          CPhysical::SetDamagedPieceRecord((CPhysical *)v8.m_pVoid, fImpulseMagnitude, this, v28, -1.0);
        }
        --v12;
        ++v28;
      }
      while ( v12 );
    }
    else
    {
      bdummy = this->m_nFlags.bdummy;
      z = this->m_vecMoveFriction.z;
      v38 = *(_QWORD *)&this->m_vecMoveFriction.x;
      v19 = (float)v12;
      v37 = this->m_vecTurnFriction.z;
      v36 = *(_QWORD *)&this->m_vecTurnFriction.x;
      *(_DWORD *)p_m_nFlags &= ~8u;
      this->m_nFlags.bdummy = bdummy;
      p_m_vecMoveFriction = &this->m_vecMoveFriction;
      *(_QWORD *)&this->m_vecMoveFriction.x = 0LL;
      *(_QWORD *)&this->m_vecMoveFriction.z = 0LL;
      this->m_vecTurnFriction.y = 0.0;
      this->m_vecTurnFriction.z = 0.0;
      p_m_vecTurnFriction = &this->m_vecTurnFriction;
      v20 = CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints;
      do
      {
        if ( CPhysical::ApplyCollision(this, (CPhysical *)v8.m_pVoid, v20, fImpulseMagnitudeA, &fImpulseMagnitude) )
        {
          CPhysical::SetDamagedPieceRecord(this, fImpulseMagnitudeA[0], (CEntity *)v8.m_pVoid, v20, 1.0);
          CPhysical::SetDamagedPieceRecord((CPhysical *)v8.m_pVoid, fImpulseMagnitude, this, v20, -1.0);
          AdhesiveLimit = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v20);
          if ( CPhysical::ApplyFriction(this, (CPhysical *)v8.m_pVoid, AdhesiveLimit / v19, v20) )
          {
            *(_DWORD *)p_m_nFlags |= 8u;
            *v10 |= 8u;
          }
        }
        --v12;
        ++v20;
      }
      while ( v12 );
      if ( (*(_DWORD *)p_m_nFlags & 8) == 0 )
      {
        v22.bdummy = this->m_nFlags.bdummy;
        *(_DWORD *)&v22 = *(_DWORD *)p_m_nFlags | 8;
        *p_m_nFlags = v22;
LABEL_53:
        p_m_vecMoveFriction->z = z;
        *(_QWORD *)&p_m_vecMoveFriction->x = v38;
        p_m_vecTurnFriction->z = v37;
        *(_QWORD *)&p_m_vecTurnFriction->x = v36;
      }
    }
  }
  else
  {
    if ( !v14 )
    {
      v15 = (float)v11;
      v16 = CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints;
      do
      {
        if ( CPhysical::ApplyCollision(this, (CPhysical *)v8.m_pVoid, v16, fImpulseMagnitudeA, &fImpulseMagnitude) )
        {
          CPhysical::SetDamagedPieceRecord(this, fImpulseMagnitudeA[0], (CEntity *)v8.m_pVoid, v16, 1.0);
          CPhysical::SetDamagedPieceRecord((CPhysical *)v8.m_pVoid, fImpulseMagnitude, this, v16, -1.0);
          v17 = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v16);
          if ( CPhysical::ApplyFriction(this, (CPhysical *)v8.m_pVoid, v17 / v15, v16) )
          {
            *(_DWORD *)p_m_nFlags |= 8u;
            *v10 |= 8u;
          }
        }
        --v12;
        ++v16;
      }
      while ( v12 );
      goto LABEL_58;
    }
    HIDWORD(v23) = *((_DWORD *)v8.m_pVoid + 8);
    LODWORD(v23) = *v10 & 0xFFFFFFF7;
    z = *((float *)v8.m_pVoid + 26);
    v38 = *((_QWORD *)v8.m_pVoid + 12);
    v24 = (float)v12;
    v37 = *((float *)v8.m_pVoid + 29);
    v36 = *(_QWORD *)((char *)v8.m_pVoid + 108);
    *(_QWORD *)v10 = v23;
    p_m_vecMoveFriction = (CVector *)((char *)v8.m_pVoid + 96);
    *((_QWORD *)v8.m_pVoid + 12) = 0LL;
    *((_QWORD *)v8.m_pVoid + 13) = 0LL;
    *((_DWORD *)v8.m_pVoid + 28) = 0;
    *((_DWORD *)v8.m_pVoid + 29) = 0;
    p_m_vecTurnFriction = (CVector *)((char *)v8.m_pVoid + 108);
    v25 = CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints;
    do
    {
      if ( CPhysical::ApplyCollision(this, (CPhysical *)v8.m_pVoid, v25, fImpulseMagnitudeA, &fImpulseMagnitude) )
      {
        CPhysical::SetDamagedPieceRecord(this, fImpulseMagnitudeA[0], (CEntity *)v8.m_pVoid, v25, 1.0);
        CPhysical::SetDamagedPieceRecord((CPhysical *)v8.m_pVoid, fImpulseMagnitude, this, v25, -1.0);
        v26 = SurfaceInfos_c::GetAdhesiveLimit(&g_surfaceInfos, v25);
        if ( CPhysical::ApplyFriction(this, (CPhysical *)v8.m_pVoid, v26 / v24, v25) )
        {
          *(_DWORD *)p_m_nFlags |= 8u;
          *v10 |= 8u;
        }
      }
      --v12;
      ++v25;
    }
    while ( v12 );
    if ( (*v10 & 8) == 0 )
    {
      HIDWORD(v27) = *((_DWORD *)v8.m_pVoid + 8);
      LODWORD(v27) = *v10 | 8;
      *(_QWORD *)v10 = v27;
      goto LABEL_53;
    }
  }
LABEL_58:
  v29 = *((_BYTE *)v8.m_pVoid + 58);
  if ( (v29 & 0xF8) == 16 )
  {
    v30 = v29 & 7;
    *((_BYTE *)v8.m_pVoid + 58) = v30 | 0x18;
    if ( v30 == 2 )
      CCarCtrl::SwitchVehicleToRealPhysics((CVehicle *)v8.m_pVoid);
  }
  return 1;
}
// 95A93C: using guessed type char `guard variable for'CPhysical::ProcessCollisionSectorList_SimpleCar(CRepeatSector *)::aColPoints;

//----- (00401140) --------------------------------------------------------
void __fastcall CPhysical::ProcessShift(CPhysical *this)
{
  CEntity::CEntityInfo m_info; // r0
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r1
  RwReal y; // r0
  bool v5; // zf
  float v6; // r0
  RwReal v7; // s2
  RwReal v8; // s0
  uint16 v9; // r0
  CEntity::CEntityInfo v10; // r4
  float v11; // s20
  float v12; // s22
  float v13; // s24
  float v14; // r8
  float v15; // r6
  int v16; // s0
  int v17; // s2
  int v18; // r8
  Int32 v19; // r5
  int v20; // r4
  Int32 v21; // r6
  bool v22; // cc
  uint16 v23; // r9
  float v24; // s20
  float v25; // s22
  float v26; // s24
  float v27; // r8
  float v28; // r6
  float v29; // r5
  int v30; // s8
  int v31; // s0
  int v32; // s2
  Int32 v33; // r5
  CMatrix *m_pMat; // r0
  int v35; // r8
  Int32 v36; // r6
  CMatrix m; // [sp+8h] [bp-A0h] BYREF
  float v38; // [sp+50h] [bp-58h] BYREF
  float v39; // [sp+54h] [bp-54h]
  float v40; // [sp+58h] [bp-50h]
  float v41; // [sp+5Ch] [bp-4Ch]

  (*((void (__fastcall **)(float *, CPhysical *))this->_vptr$CPlaceable + 10))(&v38, this);
  m_info = this->m_info;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  this->m_fTrueDistanceTravelled = 0.0;
  if ( (*(_BYTE *)&m_info & 0xF8) != 16 && (*(_BYTE *)&m_nPhysicalFlags & 0xE0) == 0 )
  {
    if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0 )
    {
      if ( (*(_BYTE *)&m_info & 7) == 3 )
      {
        y = this[4].m_vecAverageMoveSpeed.y;
        v5 = LODWORD(y) == 0;
        if ( y != 0.0 )
        {
          y = *(float *)(LODWORD(y) + 68);
          v5 = (LOBYTE(y) & 4) == 0;
        }
        if ( v5 || (LOBYTE(y) & 8) != 0 )
          goto LABEL_14;
      }
      if ( CWorld::bSecondShift )
      {
LABEL_14:
        v6 = powf(PHYSICAL_SHIFT_SPEED_DAMP, CTimer::ms_fTimeStep);
        v7 = v6 * this->m_vecTurnSpeed.y;
        v8 = v6 * this->m_vecTurnSpeed.z;
        *(float32x4_t *)&this->m_vecMoveSpeed.x = vmulq_n_f32(*(float32x4_t *)&this->m_vecMoveSpeed.x, v6);
        this->m_vecTurnSpeed.y = v7;
        this->m_vecTurnSpeed.z = v8;
      }
    }
    CMatrix::CMatrix(&m, this->m_pMat);
    CPhysical::ApplySpeed(this);
    CMatrix::Reorthogonalise(this->m_pMat);
    if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
    {
      CWorld::ClearScanCodes();
      v9 = 1;
    }
    else
    {
      v9 = CWorld::ms_nCurrentScanCode + 1;
    }
    CWorld::ms_nCurrentScanCode = v9;
    v10 = this->m_info;
    if ( (*(_BYTE *)&v10 & 7) == 2 )
      *(_DWORD *)&this->m_nPhysicalFlags |= 0x8000u;
    v11 = v39;
    v12 = v40;
    v13 = v41;
    v14 = floorf((float)(v38 / 50.0) + 60.0);
    v15 = floorf((float)(v13 / 50.0) + 60.0);
    v16 = (int)floorf((float)(v12 / 50.0) + 60.0);
    v17 = (int)v14;
    v18 = (int)floorf((float)(v11 / 50.0) + 60.0);
    v19 = (int)v15;
    if ( (int)v15 <= v18 )
    {
      v20 = 0;
      do
      {
        v21 = v17;
        if ( v17 <= v16 )
        {
          do
          {
            v20 |= CPhysical::ProcessShiftSectorList(this, v21, v19);
            v22 = v21++ < v16;
          }
          while ( v22 );
        }
        v22 = v19++ < v18;
      }
      while ( v22 );
      *(_DWORD *)&this->m_nPhysicalFlags &= ~0x8000u;
      if ( v20 << 31 )
      {
LABEL_29:
        if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
        {
          CWorld::ClearScanCodes();
          v23 = 1;
        }
        else
        {
          v23 = CWorld::ms_nCurrentScanCode + 1;
        }
        v24 = v39;
        v25 = v40;
        v26 = v41;
        v27 = floorf((float)(v38 / 50.0) + 60.0);
        v28 = floorf((float)(v26 / 50.0) + 60.0);
        v29 = floorf((float)(v25 / 50.0) + 60.0);
        v30 = (int)floorf((float)(v24 / 50.0) + 60.0);
        v31 = (int)v29;
        CWorld::ms_nCurrentScanCode = v23;
        v33 = (int)v28;
        if ( (int)v28 <= v30 )
        {
          v32 = (int)v27;
          v35 = 0;
          do
          {
            if ( v32 <= v31 )
            {
              v36 = v32;
              do
              {
                if ( CPhysical::ProcessCollisionSectorList(this, v36, v33) )
                {
                  if ( !CWorld::bSecondShift )
                    goto LABEL_43;
                  v35 = 1;
                }
                v22 = v36++ < v31;
              }
              while ( v22 );
            }
            v22 = v33++ < v30;
          }
          while ( v22 );
          if ( v35 << 31 )
          {
LABEL_43:
            CMatrix::operator=(this->m_pMat, &m);
            goto LABEL_44;
          }
        }
LABEL_33:
        *(_DWORD *)&this->m_nFlags = *(_DWORD *)&this->m_nFlags & 0xFFFFFFCF | 0x20;
        m_pMat = this->m_pMat;
        this->m_fTrueDistanceTravelled = sqrtf(
                                           (float)((float)((float)(m_pMat->tx - m.tx) * (float)(m_pMat->tx - m.tx))
                                                 + (float)((float)(m_pMat->ty - m.ty) * (float)(m_pMat->ty - m.ty)))
                                         + (float)((float)(m_pMat->tz - m.tz) * (float)(m_pMat->tz - m.tz)));
        CPhysical::RemoveAndAdd(this);
LABEL_44:
        CMatrix::~CMatrix(&m);
        return;
      }
      v10 = this->m_info;
    }
    else
    {
      *(_DWORD *)&this->m_nPhysicalFlags &= ~0x8000u;
    }
    if ( (*(_BYTE *)&v10 & 7) != 2 )
      goto LABEL_33;
    goto LABEL_29;
  }
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0xE0) != 0 )
  {
    this->m_vecTurnSpeed.x = 0.0;
    this->m_vecTurnSpeed.y = 0.0;
    this->m_vecTurnSpeed.z = 0.0;
  }
  *(_DWORD *)&this->m_nFlags = *(_DWORD *)&this->m_nFlags & 0xFFFFFFCF | 0x20;
  CPhysical::RemoveAndAdd(this);
}

//----- (004014E4) --------------------------------------------------------
bool __fastcall CPhysical::ProcessShiftSectorList(CPhysical *this, Int32 x, Int32 y)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  unsigned __int64 v6; // d13
  float m_fRadius; // s22
  Int32 v11; // r1
  Int32 v12; // r3
  float v13; // s16
  float v14; // s18
  float v15; // s24
  float32x2_t v16; // d10
  int v17; // r11
  CSector *v18; // r10
  CRepeatSector *v19; // r0
  CPtrNode *m_pHead; // r9
  CPtrNode v21; // kr00_8
  __int64 v22; // r0
  __int64 v23; // r0
  int v24; // r1
  bool v25; // zf
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CEntity *m_pAttachToEntity; // r1
  CEntity *m_pNOCollisionVehicle; // r1
  bool v29; // zf
  int v30; // r0
  float *v31; // r1
  float v32; // s0
  int v33; // r2
  float v34; // s2
  float v35; // s2
  float v36; // s0
  float v37; // s0
  float v38; // s4
  float v40; // s4
  float v41; // s0
  float v42; // s2
  float v43; // s4
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  float v46; // s4
  float v47; // s2
  float v48; // s0
  float *p_tz; // r0
  RwReal v50; // s4
  RwReal v51; // s0
  CPtrListDoubleLink *v52; // [sp+14h] [bp-604h]
  CPtrListDoubleLink *v53; // [sp+18h] [bp-600h]
  CRepeatSector *v54; // [sp+1Ch] [bp-5FCh]
  CSector *v55; // [sp+20h] [bp-5F8h]
  int v56; // [sp+28h] [bp-5F0h]
  CVector centre; // [sp+30h] [bp-5E8h] BYREF
  char v58; // [sp+3Ch] [bp-5DCh] BYREF
  char v59; // [sp+3Dh] [bp-5DBh] BYREF
  unsigned __int8 v60; // [sp+3Eh] [bp-5DAh] BYREF
  unsigned __int8 v61; // [sp+3Fh] [bp-5D9h] BYREF
  char v62[20]; // [sp+40h] [bp-5D8h] BYREF
  int v63; // [sp+54h] [bp-5C4h] BYREF

  v61 = 0;
  v60 = 0;
  v59 = 0;
  v58 = 0;
  m_fRadius = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  CEntity::GetBoundCentre(this, &centre);
  v11 = 0;
  if ( x > 0 )
    v11 = x;
  v12 = 0;
  if ( v11 >= 119 )
    v11 = 119;
  if ( y > 0 )
    v12 = y;
  LODWORD(v6) = 0;
  if ( v12 >= 119 )
    v12 = 119;
  v13 = 0.0;
  v14 = 0.0;
  v15 = 0.0;
  v16.n64_u64[0] = v6;
  v17 = 4;
  v55 = &CWorld::ms_aSectors[120 * v12 + v11];
  v18 = 0;
  v19 = &CWorld::ms_aRepeatSectors[x & 0xF | (16 * (y & 0xF))];
  v53 = &v19->m_ptrListArray[2];
  v54 = v19;
  v52 = &v19->m_ptrListArray[1];
  v56 = 0;
LABEL_64:
  switch ( v17 )
  {
    case 0:
      if ( !v56 )
        return 0;
      v36 = sqrtf((float)((float)(v13 * v13) + (float)(v14 * v14)) + (float)(v16.n64_f32[0] * v16.n64_f32[0]));
      if ( v36 > 1.0 )
      {
        v37 = 1.0 / v36;
        v16.n64_f32[0] = v16.n64_f32[0] * v37;
        v14 = v14 * v37;
        v13 = v13 * v37;
      }
      if ( v16.n64_f32[0] >= -0.5 )
      {
        if ( (*(_BYTE *)&this->m_info & 7) == 3 )
        {
          v4.n64_u32[0] = 1000593162;
          v5.n64_u32[0] = 1050253722;
          v3.n64_f32[0] = v15 * 1.5;
          v40 = vmin_f32(vmax_f32(v3, v4), v5).n64_f32[0];
          v41 = v40 * v16.n64_f32[0];
          v42 = v40 * v14;
          v43 = v40 * v13;
          goto LABEL_79;
        }
        v38 = 1.5;
      }
      else
      {
        v38 = 0.75;
      }
      v41 = (float)(v15 * v16.n64_f32[0]) * v38;
      v42 = (float)(v15 * v14) * v38;
      v43 = (float)(v15 * v13) * v38;
LABEL_79:
      m_pMat = this->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &this->m_transform;
      v46 = v43 + p_tx->m_translate.x;
      v47 = v42 + p_tx->m_translate.y;
      v48 = v41 + p_tx->m_translate.z;
      if ( m_pMat )
      {
        m_pMat->tx = v46;
        this->m_pMat->ty = v47;
        p_tz = &this->m_pMat->tz;
      }
      else
      {
        p_tz = &this->m_transform.m_translate.z;
        this->m_transform.m_translate.x = v46;
        this->m_transform.m_translate.y = v47;
      }
      *p_tz = v48;
      if ( (*(_BYTE *)&this->m_info & 7) == 2 )
      {
        v4.n64_u32[0] = 0;
        v50 = (float)((float)(v14 * 0.008) * CTimer::ms_fTimeStep) + this->m_vecMoveSpeed.y;
        v51 = (float)((float)(vmax_f32(v16, v4).n64_f32[0] * 0.008) * CTimer::ms_fTimeStep) + this->m_vecMoveSpeed.z;
        this->m_vecMoveSpeed.x = (float)((float)(v13 * 0.008) * CTimer::ms_fTimeStep) + this->m_vecMoveSpeed.x;
        this->m_vecMoveSpeed.y = v50;
        this->m_vecMoveSpeed.z = v51;
      }
      return 1;
    case 1:
      v18 = v55;
      goto LABEL_10;
    case 2:
      v18 = (CSector *)v54;
      goto LABEL_10;
    case 3:
      v18 = (CSector *)v52;
      goto LABEL_10;
    case 4:
      v18 = (CSector *)v53;
      goto LABEL_10;
    default:
LABEL_10:
      m_pHead = v18->m_buildingPtrListArray.m_pHead;
      --v17;
      break;
  }
  while ( 1 )
  {
    while ( 1 )
    {
LABEL_62:
      if ( !m_pHead )
      {
        v18 = (CSector *)((char *)v18 + 4);
        goto LABEL_64;
      }
      v21 = *m_pHead;
      m_pHead = m_pHead->m_pNext;
      v60 = 0;
      v61 = 0;
      LODWORD(v22) = *((_BYTE *)v21.m_pVoid + 58) & 7;
      if ( (_DWORD)v22 == 1 || (_DWORD)v22 == 4 && (*((_BYTE *)v21.m_pVoid + 68) & 4) != 0 )
        break;
      HIDWORD(v22) = *(_BYTE *)&this->m_info & 7;
      if ( v22 == 0x300000004LL
        && (*((_DWORD *)v21.m_pVoid + 7) & 0x40004) != 0
        && (*((_BYTE *)v21.m_pVoid + 324) & 0x40) == 0 )
      {
        break;
      }
      LODWORD(v23) = 0;
      if ( v21.m_pVoid != this )
        goto LABEL_20;
    }
    LODWORD(v23) = 1;
    if ( v21.m_pVoid != this )
    {
LABEL_20:
      v24 = *((unsigned __int16 *)v21.m_pVoid + 24);
      v25 = v24 == CWorld::ms_nCurrentScanCode;
      if ( v24 != CWorld::ms_nCurrentScanCode )
        v25 = *((unsigned __int8 *)v21.m_pVoid + 28) << 31 == 0;
      if ( !v25 )
      {
        HIDWORD(v23) = (*((_BYTE *)&this->m_nFlags + 1) & 0x10) == 0;
        if ( v23 )
        {
          if ( CEntity::GetIsTouching((const CEntity *)v21.m_pVoid, &centre, m_fRadius) )
          {
            if ( (*((_BYTE *)v21.m_pVoid + 58) & 7) == 1 )
            {
              v60 = 0;
              m_nPhysicalFlags = this->m_nPhysicalFlags;
              if ( (*(_BYTE *)&m_nPhysicalFlags & 4) != 0
                && ((*(_BYTE *)&this->m_info & 7) != 2 || this[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)&byte_6) )
              {
                goto LABEL_36;
              }
              m_pAttachToEntity = this->m_pAttachToEntity;
              if ( m_pAttachToEntity )
              {
                if ( (unsigned __int8)((*(_BYTE *)&m_pAttachToEntity->m_info & 7) - 2) <= 2u
                  && (LOBYTE(m_pAttachToEntity[1].m_transform.m_translate.y) & 4) != 0 )
                {
                  goto LABEL_36;
                }
              }
              m_pNOCollisionVehicle = this->m_pNOCollisionVehicle;
              v29 = m_pNOCollisionVehicle == v21.m_pVoid;
              if ( m_pNOCollisionVehicle != v21.m_pVoid )
                v29 = (*(_DWORD *)&this->m_nPhysicalFlags & 0x82) == 128;
              if ( v29
                || (*(_DWORD *)&m_nPhysicalFlags & 0x1000000) != 0
                && ((*(_BYTE *)&this->m_info >> 3) | 8) != 8
                && CEntity::DoesNotCollideWithFlyers((CEntity *)v21.m_pVoid) )
              {
LABEL_36:
                v61 = 1;
              }
            }
            else
            {
              (*((void (__fastcall **)(CPhysical *, void *, int, unsigned __int8 *, unsigned __int8 *, char *, char *))this->_vptr$CPlaceable
               + 16))(
                this,
                v21.m_pVoid,
                1,
                &v61,
                &v60,
                &v58,
                &v59);
            }
            if ( (*(_BYTE *)&this->m_info & 7) == 3 )
              *(_DWORD *)&this->m_nPhysicalFlags |= 0x1000u;
            if ( !((v60 | v61) << 24) )
            {
              *((_WORD *)v21.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
              v30 = (*((int (__fastcall **)(CPhysical *, void *, char *))this->_vptr$CPlaceable + 23))(
                      this,
                      v21.m_pVoid,
                      v62);
              if ( v30 > 0 )
              {
                v31 = (float *)&v63;
                while ( 1 )
                {
                  v32 = v31[5];
                  if ( v32 > 0.0 && (unsigned __int8)(*((_BYTE *)v31 + 16) - 13) >= 4u )
                  {
                    v33 = *(_BYTE *)&this->m_info & 7;
                    ++v56;
                    if ( v33 != 3 )
                    {
                      if ( v33 == 2 && (*((_BYTE *)v21.m_pVoid + 58) & 7) == 3 && (v34 = v31[1], v34 < 0.0) )
                        v35 = v34 * 0.0;
                      else
LABEL_53:
                        v35 = v31[1];
                      v16.n64_f32[0] = v16.n64_f32[0] + v35;
                      v13 = v13 + *(v31 - 1);
                      v14 = v14 + *v31;
                      if ( v32 > v15 )
                        v15 = v31[5];
                      goto LABEL_56;
                    }
                    if ( (*((_BYTE *)v21.m_pVoid + 58) & 7) != 4
                      || (*((_BYTE *)v21.m_pVoid + 68) & 0x20) == 0
                      || fabsf(v31[1]) <= 0.1 )
                    {
                      goto LABEL_53;
                    }
                  }
LABEL_56:
                  v31 += 11;
                  if ( !--v30 )
                    goto LABEL_62;
                }
              }
            }
          }
        }
      }
    }
  }
}
// 40157C: variable 'v6' is possibly undefined
// 40189E: variable 'v3' is possibly undefined
// 40189E: variable 'v4' is possibly undefined
// 4018A2: variable 'v5' is possibly undefined
// 6: using guessed type char byte_6;
// 4014E4: using guessed type char var_5D8[20];

//----- (004019BC) --------------------------------------------------------
bool __fastcall CPhysical::TestCollision(CPhysical *this, bool bApplySpeed)
{
  _BOOL4 v3; // r10
  int m_nFlags; // r0
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r1
  CEntity::CEntityInfo m_info; // r2
  float m_fTrueDistanceTravelled; // r1
  float m_fDamageImpulseMagnitude; // r12
  int v9; // r9
  int v10; // r5
  bool v11; // r10
  CMatrix *m_pMat; // r0
  CMatrix v14; // [sp+0h] [bp-60h] BYREF

  v3 = bApplySpeed;
  CMatrix::CMatrix(&v14, this->m_pMat);
  m_nFlags = (int)this->m_nFlags;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  *(_DWORD *)&this->m_nFlags = m_nFlags & 0xFFFFFFFE;
  m_info = this->m_info;
  this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags | 0x11000);
  if ( (*(_BYTE *)&m_info & 7) == 3
    && (m_fTrueDistanceTravelled = this[3].m_fTrueDistanceTravelled, (LOWORD(m_fTrueDistanceTravelled) & 0x8000) != 0) )
  {
    m_fDamageImpulseMagnitude = this[3].m_fDamageImpulseMagnitude;
    v9 = 1;
    *(_QWORD *)&this[3].m_aCollisionRecordPtrs[4] = *(_QWORD *)&this[3].m_aCollisionRecordPtrs[4];
    LODWORD(this[3].m_fTrueDistanceTravelled) = LODWORD(m_fTrueDistanceTravelled) & 0xFFFF7FFF;
    this[3].m_fDamageImpulseMagnitude = m_fDamageImpulseMagnitude;
  }
  else
  {
    v9 = 0;
  }
  v10 = m_nFlags & 1;
  if ( v3 )
    CPhysical::ApplySpeed(this);
  v11 = CPhysical::CheckCollision(this);
  *(_DWORD *)&this->m_nFlags = *(_DWORD *)&this->m_nFlags & 0xFFFFFFFE | v10;
  m_pMat = this->m_pMat;
  *(_DWORD *)&this->m_nPhysicalFlags &= 0xFFFEEFFF;
  CMatrix::operator=(m_pMat, &v14);
  if ( v9 == 1 )
    LODWORD(this[3].m_fTrueDistanceTravelled) |= 0x8000u;
  CMatrix::~CMatrix(&v14);
  return v11;
}

//----- (00401A78) --------------------------------------------------------
void __fastcall CPhysical::AddCollisionRecord(CPhysical *this, CEntity *pEntity)
{
  CEntity::CEntityInfo m_info; // r12
  __int64 v3; // r2
  unsigned int m_nNoOfCollisionRecords; // r12
  int v5; // r2

  m_info = this->m_info;
  HIDWORD(v3) = *(_DWORD *)&this->m_nPhysicalFlags | 0x200;
  LODWORD(v3) = CTimer::m_snTimeInMilliseconds;
  *(_QWORD *)&this->m_LastCollisionTime = v3;
  if ( (*(_BYTE *)&m_info & 7) == 2 && (*(_BYTE *)&pEntity->m_info & 7) == 2 )
  {
    if ( LOWORD(this[3].m_vecCOM.y) == 0xFFFF )
      LOWORD(this[3].m_vecCOM.y) = 15000;
    if ( LOWORD(pEntity[18].pReferences) == 0xFFFF )
    {
      LOWORD(pEntity[18].pReferences) = 15000;
      HIDWORD(v3) = this->m_nPhysicalFlags;
    }
  }
  if ( (v3 & 0x1000000000000000LL) != 0 )
  {
    m_nNoOfCollisionRecords = this->m_nNoOfCollisionRecords;
    if ( this->m_nNoOfCollisionRecords )
    {
      v5 = 0;
      while ( this->m_aCollisionRecordPtrs[v5] != pEntity )
      {
        if ( ++v5 >= (int)m_nNoOfCollisionRecords )
        {
          if ( m_nNoOfCollisionRecords > 5 )
            return;
          goto LABEL_13;
        }
      }
    }
    else
    {
LABEL_13:
      this->m_aCollisionRecordPtrs[m_nNoOfCollisionRecords] = pEntity;
      this->m_nNoOfCollisionRecords = m_nNoOfCollisionRecords + 1;
    }
  }
}

//----- (00401B0C) --------------------------------------------------------
bool __fastcall CPhysical::GetHasCollidedWith(CPhysical *this, CEntity *pEntity)
{
  int v3; // r3

  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x10) == 0 )
    return 0;
  if ( !this->m_nNoOfCollisionRecords )
    return 0;
  v3 = 0;
  do
  {
    if ( this->m_aCollisionRecordPtrs[v3] == pEntity )
      return 1;
    ++v3;
  }
  while ( v3 < this->m_nNoOfCollisionRecords );
  return 0;
}

//----- (00401B42) --------------------------------------------------------
bool __fastcall CPhysical::GetHasCollidedWithAnyObject(CPhysical *this)
{
  int m_nNoOfCollisionRecords; // r1
  CEntity **m_aCollisionRecordPtrs; // r0
  int v3; // r2
  CEntity *v4; // r3

  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x10) == 0 )
    return 0;
  m_nNoOfCollisionRecords = this->m_nNoOfCollisionRecords;
  if ( !this->m_nNoOfCollisionRecords )
    return 0;
  m_aCollisionRecordPtrs = this->m_aCollisionRecordPtrs;
  v3 = 0;
  while ( 1 )
  {
    v4 = m_aCollisionRecordPtrs[v3];
    if ( v4 )
    {
      if ( (*(_BYTE *)&v4->m_info & 7) == 4 )
        break;
    }
    if ( ++v3 >= m_nNoOfCollisionRecords )
      return 0;
  }
  return 1;
}

//----- (00401B74) --------------------------------------------------------
bool __fastcall CPhysical::ApplyCollision(
        CPhysical *this,
        CEntity *pEntity,
        CColPoint *colPoint,
        float *fImpulseMagnitude)
{
  CMatrix *m_pMat; // r0
  float v9; // s18
  float v10; // s22
  float v11; // s16
  RwReal v12; // r9
  float v13; // s20
  float v14; // s24
  float v15; // s18
  float v16; // s2
  float v17; // s0
  int v18; // r0
  float v19; // s2
  float v20; // s14
  bool v21; // zf
  int v22; // r0
  int v23; // r4
  float v24; // s0
  float v25; // s2
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float m_fMass; // s0
  float v29; // s12
  float v30; // s14
  float v31; // s3
  float v32; // s2
  float y; // s8
  float v34; // s4
  float z; // s10
  CVector SurfaceB; // [sp+0h] [bp-A8h]
  CVector v1; // [sp+24h] [bp-84h] BYREF
  CVector v38; // [sp+30h] [bp-78h] BYREF
  CVector v39; // [sp+3Ch] [bp-6Ch] BYREF
  CVector v2; // [sp+48h] [bp-60h] BYREF
  CVector v41; // [sp+54h] [bp-54h] BYREF
  CVector v42; // 0:r1.12
  CVector cvector; // 0:r2.8,8:^0.4

  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x10) != 0 )
  {
    v24 = (float)((float)(this->m_vecMoveSpeed.x * colPoint->m_vecNormal.x)
                + (float)(this->m_vecMoveSpeed.y * colPoint->m_vecNormal.y))
        + (float)(this->m_vecMoveSpeed.z * colPoint->m_vecNormal.z);
    if ( v24 < 0.0 )
    {
      v25 = -(float)(v24 * this->m_fMass);
      *fImpulseMagnitude = v25;
      m_nPhysicalFlags = this->m_nPhysicalFlags;
      if ( (*(_BYTE *)&m_nPhysicalFlags & 0x60) != 0 )
      {
        m_fMass = this->m_fMass;
      }
      else
      {
        m_fMass = this->m_fMass;
        v29 = colPoint->m_vecNormal.x * v25;
        v30 = colPoint->m_vecNormal.y * v25;
        v31 = 0.0;
        v32 = colPoint->m_vecNormal.z * v25;
        y = this->m_vecMoveSpeed.y;
        v34 = 1.0 / m_fMass;
        z = this->m_vecMoveSpeed.z;
        if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) == 0 )
          v31 = v32;
        this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v29 * v34);
        this->m_vecMoveSpeed.y = (float)(v30 * v34) + y;
        this->m_vecMoveSpeed.z = (float)(v31 * v34) + z;
        v25 = *fImpulseMagnitude;
      }
      CAudioEngine::ReportCollision(
        &AudioEngine,
        this,
        pEntity,
        colPoint->m_dataA.m_nSurfaceType,
        colPoint->m_dataB.m_nSurfaceType,
        &colPoint->m_vecPosition,
        &colPoint->m_vecNormal,
        v25 / m_fMass,
        1.0,
        0,
        0);
      return 1;
    }
    return 0;
  }
  m_pMat = this->m_pMat;
  v9 = colPoint->m_vecPosition.x - m_pMat->tx;
  v10 = colPoint->m_vecPosition.y - m_pMat->ty;
  v11 = colPoint->m_vecPosition.z - m_pMat->tz;
  v12 = v9;
  cvector.z = v11;
  cvector.x = v9;
  cvector.y = v10;
  CPhysical::GetSpeed(&v41, this, cvector);
  v2 = colPoint->m_vecNormal;
  v13 = (float)((float)(v41.x * v2.x) + (float)(v41.y * v2.y)) + (float)(v41.z * v2.z);
  if ( v13 >= 0.0 )
    return 0;
  Multiply3x3(&v39, this->m_pMat, &this->m_vecCOM);
  v14 = this->m_fMass;
  v1.x = v9 - v39.x;
  v1.y = v10 - v39.y;
  v1.z = v11 - v39.z;
  CrossProduct(&v38, &v1, &v2);
  v15 = 1.0
      / (float)((float)(1.0 / v14)
              + (float)((float)((float)((float)(v38.x * v38.x) + (float)(v38.y * v38.y)) + (float)(v38.z * v38.z))
                      / this->m_fTurnMass));
  v16 = v13 * (float)(this->m_fElasticity + 1.0);
  v17 = -(float)(v15 * v16);
  *fImpulseMagnitude = v17;
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
  {
    v18 = *(_BYTE *)&this->m_info & 7;
    v19 = -(float)((float)(v15 * v16) * v2.z);
    v20 = v19;
    if ( v18 == 2 )
      v20 = v19 * 0.3;
    if ( v2.z < 0.7 )
      v19 = v20;
    v42.z = v19;
    v21 = v18 == 2;
    v22 = 0;
    v23 = 0;
    if ( !v21 )
      v22 = 1;
    if ( !CWorld::bNoMoreCollisionTorque )
      v23 = 1;
    SurfaceB.x = v12;
    *(_QWORD *)&SurfaceB.y = __PAIR64__(LODWORD(v11), LODWORD(v10));
    v42.x = v2.x * v17;
    v42.y = v2.y * v17;
    CPhysical::ApplyForce(this, v42, SurfaceB, v22 | v23);
    v17 = *fImpulseMagnitude;
  }
  CAudioEngine::ReportCollision(
    &AudioEngine,
    this,
    pEntity,
    colPoint->m_dataA.m_nSurfaceType,
    colPoint->m_dataB.m_nSurfaceType,
    &colPoint->m_vecPosition,
    &colPoint->m_vecNormal,
    v17 / v15,
    1.0,
    0,
    0);
  return 1;
}

//----- (00401E80) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
bool __fastcall CPhysical::ApplyCollision(
        CPhysical *this,
        CPhysical *pPhysical,
        CColPoint *colPoint,
        float *fImpulseMagnitudeA,
        float *fImpulseMagnitudeB)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d2
  float32x2_t v7; // d6
  float32x2_t v8; // d8
  float32x2_t v9; // d9
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CPhysical::CPhysicalFlags v14; // r1
  int v16; // r5
  int v17; // r2
  RwReal y; // r1
  float v19; // s18
  CEntity::CEntityInfo m_info; // r0
  int v21; // r4
  CPhysical::CPhysicalFlags v22; // r0
  __int64 v23; // r0
  bool v24; // zf
  int v25; // r1
  CEntity::CFlags *p_m_nFlags; // r6
  float *v27; // r3
  CPhysical::CPhysicalFlags v28; // r0
  CPhysical::CPhysicalFlags v29; // r1
  int v30; // r6
  CMatrix *v31; // r0
  float v32; // s0
  float v33; // s4
  float v34; // s2
  float v35; // s10
  RwReal v36; // r2
  float v37; // r3
  float v38; // r0
  CMatrix *v39; // r1
  float tz; // s10
  RwReal v41; // s0
  float v42; // r5
  float v43; // r11
  float v44; // r4
  CMatrix *v45; // r0
  RwReal v46; // s4
  float v47; // r4
  float v48; // r6
  float v49; // r5
  int v50; // r0
  bool v51; // zf
  float v52; // s0
  float v53; // s22
  float v54; // s20
  float *v55; // r5
  float v56; // s0
  float v57; // s20
  float v58; // s2
  float v59; // s0
  float v60; // s0
  int v61; // r6
  CMatrix *m_pMat; // r0
  CColPoint *v63; // r4
  RwReal v64; // s4
  float v65; // r8
  float v66; // r11
  CPhysical::CPhysicalFlags v67; // r0
  float v68; // r6
  int v69; // r1
  bool v70; // zf
  float v71; // s0
  float v72; // s2
  float v73; // s8
  float v74; // s4
  float v75; // s28
  float v76; // s20
  float v77; // s24
  CVector *p_m_vecNormal; // r11
  float v79; // s26
  float v80; // s30
  float v81; // s22
  float v82; // s6
  float v83; // s0
  float v84; // s0
  void **ppReferenceAddress; // s0
  CBaseModelInfo *v86; // r0
  int v87; // r0
  float v88; // r4
  float v89; // r6
  float v90; // r8
  CPhysical::CPhysicalFlags v91; // r0
  int v92; // r1
  bool v93; // zf
  float v94; // s6
  float v95; // s8
  float v96; // s10
  float v97; // s28
  float v98; // s24
  float v99; // s20
  float v100; // s0
  float x; // s8
  float v102; // s10
  float z; // s12
  float m_fMass; // s16
  float v105; // s0
  float v106; // s2
  int v107; // r6
  float v108; // s20
  float v109; // r5
  float v110; // r8
  float v111; // r6
  float v112; // s4
  float v113; // s6
  float v114; // s8
  float v115; // s10
  float v116; // s0
  float v117; // s6
  CVector *v118; // r6
  float v119; // s28
  float v120; // s24
  float v121; // s0
  float v122; // s22
  float *v123; // r8
  float v124; // s2
  float v125; // s4
  float v126; // s20
  float v127; // s6
  float v128; // s10
  float v129; // s8
  float v130; // s4
  float v131; // s2
  CPhysical::CPhysicalFlags v132; // r0
  float v133; // s4
  float v134; // s6
  float v135; // s8
  float v136; // s10
  float v137; // s0
  float v138; // s14
  float v139; // s10
  float v140; // s3
  float v141; // s5
  unsigned __int32 v142; // s12
  float v143; // s0
  float v144; // r11
  RwReal v145; // s0
  RwReal v146; // s2
  RwReal v147; // r8
  RwReal v148; // s0
  RwReal v149; // s2
  CEntity::CFlags *v150; // r6
  float v151; // s22
  float v152; // s20
  float v153; // s0
  float v154; // s4
  float v155; // s2
  float v156; // s2
  float v157; // s28
  float v158; // s17
  float v159; // s19
  float v160; // s21
  float v161; // s0
  CPhysical::CPhysicalFlags v162; // r0
  float v163; // s0
  float v164; // s28
  float v165; // s16
  float v166; // s18
  RwReal v167; // s2
  RwReal v168; // s2
  float v169; // s8
  float v170; // s6
  float v171; // s2
  float v172; // s4
  float v173; // s24
  float *v174; // r11
  float v175; // s26
  CEntity::CFlags *v176; // r4
  float v177; // s20
  float v178; // s28
  float v179; // s0
  float v180; // s22
  float v181; // s0
  float v182; // s4
  float v183; // s2
  float v184; // s2
  float v185; // s0
  float v186; // s24
  float v187; // s4
  float v188; // s0
  float v189; // s30
  float v190; // s26
  float v191; // s28
  unsigned int v192; // r0
  float v193; // s18
  float v194; // r8
  bool v195; // nf
  float v196; // r5
  unsigned int v197; // r0
  float v198; // s26
  float v199; // s24
  bool v200; // nf
  RwReal v201; // s0
  RwReal v202; // s2
  RwReal v203; // s0
  RwReal v204; // s2
  float *v205; // r4
  int v206; // r0
  CPtrNodeDoubleLink *m_pMovingListNode; // r1
  bool v208; // zf
  CPtrNodeDoubleLink *v209; // r0
  CPtrNode *m_pHead; // r1
  void **v211; // s0
  CBaseModelInfo *v212; // r0
  int v213; // r0
  CBaseModelInfo *v214; // r0
  int v215; // r0
  float v216; // s22
  float v217; // s4
  float v218; // s2
  CPhysical::CPhysicalFlags v219; // r0
  float v220; // s6
  float v221; // s8
  float v222; // s14
  float v223; // s4
  float v224; // s1
  float v225; // s2
  RwReal v226; // s6
  float v227; // s18
  CPhysical::CPhysicalFlags v228; // r0
  float v229; // s20
  float v230; // s22
  float v231; // s24
  float *v232; // r8
  RwReal v233; // s2
  RwReal v234; // s2
  float v235; // s12
  float v236; // s6
  float v237; // s14
  RwReal v238; // s2
  int m_nModelIndex; // r0
  CMatrix *v241; // r2
  CSimpleTransform *p_m_transform; // r1
  CMatrix *v243; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v245; // kr08_8
  RwReal v246; // r6
  int v247; // r0
  float v248; // r2
  float vecOffset; // [sp+0h] [bp-E0h]
  float vecOffseta; // [sp+0h] [bp-E0h]
  float v251; // [sp+20h] [bp-C0h]
  int v252; // [sp+24h] [bp-BCh]
  float vecForce; // [sp+28h] [bp-B8h]
  int vecForcea; // [sp+28h] [bp-B8h]
  int vecForceb; // [sp+28h] [bp-B8h]
  RwReal vecForcec; // [sp+28h] [bp-B8h]
  float *vecForce_4; // [sp+2Ch] [bp-B4h]
  float *vecForce_4a; // [sp+2Ch] [bp-B4h]
  CEntity::CFlags *vecForce_8; // [sp+30h] [bp-B0h]
  int v260; // [sp+34h] [bp-ACh]
  CColPoint *v261; // [sp+34h] [bp-ACh]
  CVector v262; // [sp+38h] [bp-A8h] BYREF
  CVector v1; // [sp+44h] [bp-9Ch] BYREF
  CVector v264; // [sp+50h] [bp-90h] BYREF
  CVector v265; // [sp+5Ch] [bp-84h] BYREF
  CVector v266; // [sp+68h] [bp-78h] BYREF
  CVector v267[9]; // [sp+74h] [bp-6Ch] BYREF
  CVector v268; // 0:r1.12
  CVector v269; // 0:r1.12
  CVector v270; // 0:r1.12
  CVector v271; // 0:r1.12
  CVector v272; // 0:r1.12
  CVector v273; // 0:r1.12
  CVector v274; // 0:r1.12
  CVector v275; // 0:r1.12
  CVector v276; // 0:r2.8,8:^0.4
  CVector v277; // 0:r2.8,8:^0.4

  m_nPhysicalFlags = pPhysical->m_nPhysicalFlags;
  v14 = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) == 0 || (*(_BYTE *)&v14 & 0x20) != 0 )
  {
    v8.n64_u32[0] = 2.0;
    v16 = 0;
    if ( !(*(_DWORD *)&v14 << 31) )
      v8.n64_u32[0] = 1.0;
  }
  else
  {
    v8.n64_u32[0] = 10.0;
    v16 = 0;
    if ( (*(_BYTE *)&pPhysical->m_info & 7) == 3 && (CPhysical *)LODWORD(pPhysical[4].m_vecAverageMoveSpeed.y) == this )
      v16 = 1;
  }
  v17 = *(_BYTE *)&this->m_info & 7;
  if ( (*(_BYTE *)&v14 & 0x10) != 0 )
  {
    if ( v17 == 3
      && CPed::IsPlayer((const CPed *)this)
      && (m_info = pPhysical->m_info, (*(_BYTE *)&m_info & 7) == 2)
      && ((*(_BYTE *)&m_info & 0xF0) == 32 || (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0) )
    {
      v6.n64_u32[0] = 0;
      v5.n64_f32[0] = pPhysical->m_fMass + -2000.0;
      v19 = 1.0 / (float)((float)(vmax_f32(v5, v6).n64_f32[0] * 0.0002) + 1.0);
    }
    else
    {
      v19 = 1.0;
      if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 0x20) == 0 )
        v19 = 10.0;
    }
    v21 = 0;
    if ( (*(_BYTE *)&this->m_info & 7) == 3 && (CPhysical *)LODWORD(this[4].m_vecAverageMoveSpeed.y) == pPhysical )
    {
      v19 = 10.0;
      v21 = 1;
    }
  }
  else
  {
    if ( v17 != 2 || (y = this[3].m_AttachQuat.imag.y, y == 0.0) )
    {
      v19 = 2.0;
      if ( !(*(_DWORD *)&m_nPhysicalFlags << 31) )
        v19 = 1.0;
    }
    else
    {
      v19 = (float)(*(float *)(LODWORD(y) + 144) + this->m_fMass) / this->m_fMass;
    }
    v21 = 0;
  }
  v22 = pPhysical->m_nPhysicalFlags;
  if ( (*(_BYTE *)&v22 & 0xC) == 4 || (v260 = 0, (*(_BYTE *)&v22 & 0x40) == 0) && pPhysical->m_pAttachToEntity )
  {
    v21 = 0;
    v260 = 1;
  }
  Multiply3x3(&v265, this->m_pMat, &this->m_vecCOM);
  Multiply3x3(&v264, pPhysical->m_pMat, &pPhysical->m_vecCOM);
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x40) != 0 )
    memset(&v265, 0, sizeof(v265));
  if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 0x40) != 0 )
    memset(&v264, 0, sizeof(v264));
  HIDWORD(v23) = *(_BYTE *)&pPhysical->m_info & 7;
  LODWORD(v23) = *(_BYTE *)&this->m_info & 7;
  v24 = (_DWORD)v23 == 2;
  if ( (_DWORD)v23 == 2 )
    v24 = HIDWORD(v23) == 4;
  if ( v24 && BYTE1(pPhysical[1].m_transform.m_translate.y) << 31
    || v23 == 0x200000004LL && BYTE1(this[1].m_transform.m_translate.y) << 31 )
  {
    colPoint->m_vecNormal.z = 0.0;
  }
  v25 = 0;
  p_m_nFlags = &pPhysical->m_nFlags;
  v27 = fImpulseMagnitudeB;
  if ( (*(_DWORD *)&pPhysical->m_nFlags & 0x40004) == 0 )
    v25 = 1;
  if ( v260 | v25 )
    goto LABEL_46;
  v252 = v16;
  vecForcea = v21;
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x10) != 0 )
  {
    v83 = (float)((float)(this->m_vecMoveSpeed.x * colPoint->m_vecNormal.x)
                + (float)(this->m_vecMoveSpeed.y * colPoint->m_vecNormal.y))
        + (float)(this->m_vecMoveSpeed.z * colPoint->m_vecNormal.z);
    if ( v83 < 0.0 )
    {
      if ( (*(_BYTE *)&pPhysical->m_info & 7) != 4 )
      {
        if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0 )
          return CPhysical::ApplyCollision(this, pPhysical, colPoint, fImpulseMagnitudeA);
        v205 = fImpulseMagnitudeB;
        (*((void (__fastcall **)(CPhysical *, _DWORD))pPhysical->_vptr$CPlaceable + 5))(pPhysical, 0);
        goto LABEL_203;
      }
      v84 = -(float)(v83 * this->m_fMass);
      *fImpulseMagnitudeA = v84;
      *fImpulseMagnitudeB = v84;
      if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0 )
        return CPhysical::ApplyCollision(this, pPhysical, colPoint, fImpulseMagnitudeA);
      ppReferenceAddress = pPhysical[1].pReferences[2].ppReferenceAddress;
      if ( *(float *)&ppReferenceAddress >= 9999.0 || *fImpulseMagnitudeA <= *(float *)&ppReferenceAddress )
        return CPhysical::ApplyCollision(this, pPhysical, colPoint, fImpulseMagnitudeA);
      if ( (*(_BYTE *)&pPhysical->m_info & 7) != 4
        || (v86 = CModelInfo::ms_modelInfoPtrs[pPhysical->m_nModelIndex],
            v87 = (*((int (__fastcall **)(CBaseModelInfo *))v86->_vptr$CBaseModelInfo + 2))(v86),
            v27 = fImpulseMagnitudeB,
            !v87)
        || (*(_WORD *)(v87 + 40) & 0x7000 | 0x800) != 10240 )
      {
        if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0 )
          goto LABEL_204;
        v205 = v27;
        (*((void (__fastcall **)(CPhysical *, _DWORD))pPhysical->_vptr$CPlaceable + 5))(pPhysical, 0);
        goto LABEL_200;
      }
      p_m_nFlags = &pPhysical->m_nFlags;
      CGlass::WindowRespondsToCollision(
        pPhysical,
        *fImpulseMagnitudeA,
        this->m_vecMoveSpeed,
        colPoint->m_vecPosition,
        0);
      v27 = fImpulseMagnitudeB;
    }
LABEL_204:
    if ( (*(_DWORD *)p_m_nFlags & 0x40004) != 0 )
      return 0;
    v16 = v252;
    v21 = vecForcea;
    if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) == 0 )
    {
      m_pMovingListNode = pPhysical->m_pMovingListNode;
      v208 = m_pMovingListNode == 0;
      if ( !m_pMovingListNode )
        v208 = (*(_DWORD *)p_m_nFlags & 0x40000) == 0;
      if ( v208 )
      {
        v209 = (CPtrNodeDoubleLink *)CPtrNodeDoubleLink::operator new(0xCu);
        v209->m_pVoid = pPhysical;
        pPhysical->m_pMovingListNode = v209;
        v209->m_pPrevious = 0;
        v27 = fImpulseMagnitudeB;
        m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
        v209->m_pNext = CWorld::ms_listMovingEntityPtrs.m_pHead;
        if ( m_pHead )
          m_pHead[1].m_pVoid = v209;
        CWorld::ms_listMovingEntityPtrs.m_pHead = v209;
      }
    }
LABEL_46:
    vecForce_8 = p_m_nFlags;
    v28 = pPhysical->m_nPhysicalFlags;
    v29 = this->m_nPhysicalFlags;
    v30 = *(_BYTE *)&v28 & 0x10;
    if ( (*(_BYTE *)&v29 & 0x10) != 0 )
    {
      if ( (*(_BYTE *)&v28 & 0x10) != 0 )
      {
        x = colPoint->m_vecNormal.x;
        v102 = colPoint->m_vecNormal.y;
        z = colPoint->m_vecNormal.z;
        m_fMass = pPhysical->m_fMass;
        v105 = this->m_fMass;
        v9.n64_f32[0] = (float)((float)(x * pPhysical->m_vecMoveSpeed.x) + (float)(v102 * pPhysical->m_vecMoveSpeed.y))
                      + (float)(z * pPhysical->m_vecMoveSpeed.z);
        v106 = (float)((float)(this->m_vecMoveSpeed.x * x) + (float)(this->m_vecMoveSpeed.y * v102))
             + (float)(this->m_vecMoveSpeed.z * z);
        if ( (*(_WORD *)&v29 & 0x2004) != 0 )
        {
          v107 = 1;
          v108 = (float)((float)(this->m_vecMoveSpeed.x * x) + (float)(this->m_vecMoveSpeed.y * v102))
               + (float)(this->m_vecMoveSpeed.z * z);
        }
        else if ( (*(_WORD *)&v28 & 0x2004) != 0 )
        {
          v107 = 0;
          v108 = (float)((float)(x * pPhysical->m_vecMoveSpeed.x) + (float)(v102 * pPhysical->m_vecMoveSpeed.y))
               + (float)(z * pPhysical->m_vecMoveSpeed.z);
        }
        else if ( (HIBYTE(this[3].m_fTrueDistanceTravelled) & 0x80) != 0 )
        {
          v107 = 1;
          v108 = (float)((float)(v106 * (float)(v105 * 4.0)) + (float)(m_fMass * v9.n64_f32[0]))
               / (float)((float)(v105 * 4.0) + m_fMass);
        }
        else
        {
          v6.n64_u32[0] = 0;
          v107 = 0;
          LODWORD(v108) = vmin_f32(v9, v6).n64_u32[0];
        }
        if ( (float)(v106 - v108) < 0.0 )
        {
          v216 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v217 = v108 - (float)((float)(v106 - v108) * v216);
          if ( (*(_DWORD *)&this->m_nFlags & 0x1000) != 0 )
            v217 = v108;
          v218 = v105 * (float)(v217 - v106);
          *fImpulseMagnitudeA = v218;
          v219 = this->m_nPhysicalFlags;
          if ( (*(_WORD *)&v219 & 0x2004) == 0 )
          {
            if ( (*(_BYTE *)&v219 & 0x60) == 0 )
            {
              v220 = colPoint->m_vecNormal.y * v218;
              v221 = colPoint->m_vecNormal.z * v218;
              v222 = this->m_vecMoveSpeed.z;
              v223 = 1.0 / this->m_fMass;
              v224 = 0.0;
              v225 = (float)(colPoint->m_vecNormal.x * v218) * v223;
              if ( (*(_BYTE *)&v219 & 0x80) == 0 )
                v224 = v221;
              v226 = (float)(v220 * v223) + this->m_vecMoveSpeed.y;
              this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + v225;
              this->m_vecMoveSpeed.y = v226;
              this->m_vecMoveSpeed.z = (float)(v224 * v223) + v222;
              v218 = *fImpulseMagnitudeA;
            }
            CAudioEngine::ReportCollision(
              &AudioEngine,
              this,
              pPhysical,
              colPoint->m_dataA.m_nSurfaceType,
              colPoint->m_dataB.m_nSurfaceType,
              &colPoint->m_vecPosition,
              &colPoint->m_vecNormal,
              v218 / v105,
              1.0,
              0,
              0);
            v27 = fImpulseMagnitudeB;
          }
          if ( v107 == 1 )
          {
            if ( (*((_BYTE *)vecForce_8 + 1) & 0x10) == 0 )
              v108 = v108 - (float)((float)(v9.n64_f32[0] - v108) * v216);
            v227 = v108 - v9.n64_f32[0];
            *v27 = -(float)(m_fMass * v227);
            v228 = pPhysical->m_nPhysicalFlags;
            if ( (*(_WORD *)&v228 & 0x2004) == 0 )
            {
              v229 = colPoint->m_vecNormal.x;
              v230 = colPoint->m_vecNormal.y;
              v231 = colPoint->m_vecNormal.z;
              if ( (*(_BYTE *)vecForce_8 & 0x20) != 0 )
              {
                v232 = v27;
                *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
                v233 = -pPhysical->m_vecTurnSpeed.z;
                pPhysical->m_vecTurnSpeed.y = -pPhysical->m_vecTurnSpeed.y;
                pPhysical->m_vecTurnSpeed.z = v233;
                CPhysical::ApplySpeed(pPhysical);
                v27 = v232;
                *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
                v234 = -pPhysical->m_vecTurnSpeed.z;
                pPhysical->m_vecTurnSpeed.y = -pPhysical->m_vecTurnSpeed.y;
                pPhysical->m_vecTurnSpeed.z = v234;
                *(_DWORD *)vecForce_8 &= ~0x20u;
                v228 = pPhysical->m_nPhysicalFlags;
              }
              if ( (*(_BYTE *)&v228 & 0x60) == 0 )
              {
                v235 = pPhysical->m_vecMoveSpeed.z;
                v236 = 1.0 / pPhysical->m_fMass;
                v237 = 0.0;
                if ( (*(_BYTE *)&v228 & 0x80) == 0 )
                  v237 = (float)(m_fMass * v227) * v231;
                v238 = (float)((float)((float)(m_fMass * v227) * v230) * v236) + pPhysical->m_vecMoveSpeed.y;
                pPhysical->m_vecMoveSpeed.x = pPhysical->m_vecMoveSpeed.x
                                            + (float)((float)(v229 * (float)(m_fMass * v227)) * v236);
                pPhysical->m_vecMoveSpeed.y = v238;
                pPhysical->m_vecMoveSpeed.z = (float)(v237 * v236) + v235;
              }
              CAudioEngine::ReportCollision(
                &AudioEngine,
                pPhysical,
                this,
                colPoint->m_dataB.m_nSurfaceType,
                colPoint->m_dataA.m_nSurfaceType,
                &colPoint->m_vecPosition,
                &colPoint->m_vecNormal,
                *v27 / m_fMass,
                1.0,
                0,
                0);
            }
          }
          return 1;
        }
      }
      else
      {
        vecForceb = v21;
        vecForce_4a = fImpulseMagnitudeA;
        m_pMat = pPhysical->m_pMat;
        v63 = colPoint;
        v64 = colPoint->m_vecPosition.z - m_pMat->tz;
        v277.x = colPoint->m_vecPosition.x - m_pMat->tx;
        v266.y = colPoint->m_vecPosition.y - m_pMat->ty;
        v277.y = v266.y;
        v266.x = v277.x;
        v266.z = v64;
        v277.z = v64;
        CPhysical::GetSpeed(&v1, pPhysical, v277);
        v66 = v1.x;
        v65 = v1.y;
        v67 = pPhysical->m_nPhysicalFlags;
        v68 = v1.z;
        if ( (*(_DWORD *)&v67 & 0x4000000) != 0 )
        {
          v69 = *(_BYTE *)&pPhysical->m_info & 7;
          v70 = v69 == 2;
          if ( v69 == 2 )
            v70 = v63->m_dataB.m_nSurfaceType == 65;
          if ( v70 )
          {
            (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))pPhysical->_vptr$CPlaceable + 50))(
              &v1,
              pPhysical,
              &v266);
            v67 = pPhysical->m_nPhysicalFlags;
            v68 = v1.z + v68;
            v65 = v1.y + v65;
            v66 = v1.x + v66;
          }
        }
        v71 = v63->m_vecNormal.x;
        v72 = v63->m_vecNormal.y;
        v73 = v71 * v66;
        v74 = v63->m_vecNormal.z;
        v75 = this->m_vecMoveSpeed.z * v74;
        v76 = this->m_fMass;
        v77 = v74 * v68;
        p_m_vecNormal = &v63->m_vecNormal;
        v79 = v73 + (float)(v72 * v65);
        v80 = (float)(this->m_vecMoveSpeed.x * v71) + (float)(this->m_vecMoveSpeed.y * v72);
        if ( (*(_BYTE *)&v67 & 0x20) != 0 )
        {
          v262.x = v266.x - v264.x;
          v262.y = v266.y - v264.y;
          v262.z = v266.z - v264.z;
          CrossProduct(&v1, &v262, &v63->m_vecNormal);
          v82 = (float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
              / (float)(v19 * pPhysical->m_fTurnMass);
        }
        else
        {
          v81 = pPhysical->m_fMass;
          v262.x = v266.x - v264.x;
          v262.y = v266.y - v264.y;
          v262.z = v266.z - v264.z;
          CrossProduct(&v1, &v262, &v63->m_vecNormal);
          v82 = (float)(1.0 / (float)(v19 * v81))
              + (float)((float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
                      / (float)(v19 * pPhysical->m_fTurnMass));
        }
        v122 = v8.n64_f32[0] * v76;
        v123 = vecForce_4a;
        v124 = v79 + v77;
        v125 = v80 + v75;
        v126 = 1.0 / v82;
        v127 = v79 + v77;
        if ( !v260 )
          v127 = (float)((float)(v122 * v125) + (float)(v124 * v126)) / (float)(v122 + v126);
        if ( (float)(v125 - v127) < 0.0 )
        {
          v128 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v129 = v127 - (float)((float)(v125 - v127) * v128);
          if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0 )
            v129 = v127;
          v130 = v129 - v125;
          if ( (*((_BYTE *)vecForce_8 + 1) & 0x10) == 0 )
            v127 = v127 - (float)((float)(v124 - v127) * v128);
          v131 = v127 - v124;
          *vecForce_4a = v122 * v130;
          *fImpulseMagnitudeB = -(float)(v126 * v131);
          v132 = this->m_nPhysicalFlags;
          v133 = v63->m_vecNormal.x;
          v134 = v63->m_vecNormal.y;
          v135 = v63->m_vecNormal.z;
          if ( (*(_BYTE *)&v132 & 0x64) == 0 )
          {
            v136 = *vecForce_4a / v8.n64_f32[0];
            v137 = 1.0 / this->m_fMass;
            v138 = v136 * v134;
            v8.n64_u32[0] = 0;
            v7.n64_f32[0] = v136 * v135;
            v139 = v133 * v136;
            v140 = this->m_vecMoveSpeed.y;
            v141 = this->m_vecMoveSpeed.z;
            v142 = vmax_f32(v7, v8).n64_u32[0];
            if ( vecForceb )
              v139 = v139 + v139;
            if ( vecForceb )
              v138 = v138 + v138;
            if ( (*(_BYTE *)&v132 & 0x80) == 0 )
              v8.n64_u32[0] = v142;
            this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v139 * v137);
            this->m_vecMoveSpeed.y = (float)(v138 * v137) + v140;
            this->m_vecMoveSpeed.z = (float)(v8.n64_f32[0] * v137) + v141;
          }
          if ( !(vecForceb | ((unsigned __int8)(*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) >> 2)) )
          {
            v143 = (float)(v126 * v131) / v19;
            v144 = v135 * v143;
            v269.y = v134 * v143;
            v269.x = v133 * v143;
            if ( (*(_BYTE *)vecForce_8 & 0x20) != 0 )
            {
              v145 = -pPhysical->m_vecTurnSpeed.y;
              v146 = -pPhysical->m_vecTurnSpeed.z;
              v147 = v269.y;
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              pPhysical->m_vecTurnSpeed.y = v145;
              pPhysical->m_vecTurnSpeed.z = v146;
              vecForcec = v269.x;
              CPhysical::ApplySpeed(pPhysical);
              v269.y = v147;
              v148 = -pPhysical->m_vecTurnSpeed.y;
              v269.x = vecForcec;
              v149 = -pPhysical->m_vecTurnSpeed.z;
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              v123 = vecForce_4a;
              pPhysical->m_vecTurnSpeed.y = v148;
              pPhysical->m_vecTurnSpeed.z = v149;
              *(_DWORD *)vecForce_8 &= ~0x20u;
            }
            v269.z = v144;
            CPhysical::ApplyForce(pPhysical, v269, v266, 1);
            p_m_vecNormal = &v63->m_vecNormal;
          }
          CAudioEngine::ReportCollision(
            &AudioEngine,
            this,
            pPhysical,
            v63->m_dataA.m_nSurfaceType,
            v63->m_dataB.m_nSurfaceType,
            &v63->m_vecPosition,
            p_m_vecNormal,
            *v123 / v122,
            1.0,
            0,
            0);
          CAudioEngine::ReportCollision(
            &AudioEngine,
            pPhysical,
            this,
            v63->m_dataB.m_nSurfaceType,
            v63->m_dataA.m_nSurfaceType,
            &v63->m_vecPosition,
            p_m_vecNormal,
            *fImpulseMagnitudeB / v126,
            1.0,
            0,
            0);
          return 1;
        }
      }
    }
    else
    {
      vecForce_4 = fImpulseMagnitudeA;
      v31 = this->m_pMat;
      v32 = colPoint->m_vecPosition.x;
      v33 = colPoint->m_vecPosition.y;
      v34 = colPoint->m_vecPosition.z;
      v35 = v34 - v31->tz;
      v36 = colPoint->m_vecPosition.x - v31->tx;
      v37 = v33 - v31->ty;
      v267[0].y = v37;
      v267[0].x = v36;
      v38 = v35;
      v267[0].z = v35;
      if ( v30 )
      {
        vecOffseta = v35;
        CPhysical::GetSpeed(&v266, this, *(CVector *)&v36);
        v88 = v266.x;
        v89 = v266.y;
        v90 = v266.z;
        v91 = this->m_nPhysicalFlags;
        if ( (*(_DWORD *)&v91 & 0x4000000) != 0 )
        {
          v92 = *(_BYTE *)&this->m_info & 7;
          v93 = v92 == 2;
          if ( v92 == 2 )
            v93 = colPoint->m_dataA.m_nSurfaceType == 65;
          if ( v93 )
          {
            (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))this->_vptr$CPlaceable + 50))(&v266, this, v267);
            v91 = this->m_nPhysicalFlags;
            v90 = v266.z + v90;
            v89 = v266.y + v89;
            v88 = v266.x + v88;
          }
        }
        v94 = colPoint->m_vecNormal.x;
        v95 = colPoint->m_vecNormal.y;
        v96 = colPoint->m_vecNormal.z;
        v97 = (float)((float)(v94 * pPhysical->m_vecMoveSpeed.x) + (float)(v95 * pPhysical->m_vecMoveSpeed.y))
            + (float)(v96 * pPhysical->m_vecMoveSpeed.z);
        v98 = (float)((float)(v94 * v88) + (float)(v95 * v89)) + (float)(v96 * v90);
        if ( (*(_BYTE *)&v91 & 0x20) != 0 )
        {
          v1.x = v267[0].x - v265.x;
          v1.y = v267[0].y - v265.y;
          v1.z = v267[0].z - v265.z;
          CrossProduct(&v266, &v1, &colPoint->m_vecNormal);
          v100 = (float)((float)((float)(v266.x * v266.x) + (float)(v266.y * v266.y)) + (float)(v266.z * v266.z))
               / (float)(v8.n64_f32[0] * this->m_fTurnMass);
        }
        else
        {
          v99 = this->m_fMass;
          v1.x = v267[0].x - v265.x;
          v1.y = v267[0].y - v265.y;
          v1.z = v267[0].z - v265.z;
          CrossProduct(&v266, &v1, &colPoint->m_vecNormal);
          v100 = (float)(1.0 / (float)(v8.n64_f32[0] * v99))
               + (float)((float)((float)((float)(v266.x * v266.x) + (float)(v266.y * v266.y)) + (float)(v266.z * v266.z))
                       / (float)(v8.n64_f32[0] * this->m_fTurnMass));
        }
        v150 = vecForce_8;
        v151 = 1.0 / v100;
        v152 = v19 * pPhysical->m_fMass;
        v153 = (float)((float)(v98 * (float)(1.0 / v100)) + (float)(v97 * v152)) / (float)((float)(1.0 / v100) + v152);
        if ( (float)(v98 - v153) < 0.0 )
        {
          v154 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v155 = v153 - (float)((float)(v98 - v153) * v154);
          if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0 )
            v155 = v153;
          v156 = v155 - v98;
          if ( (*((_BYTE *)vecForce_8 + 1) & 0x10) == 0 )
            v153 = v153 - (float)((float)(v97 - v153) * v154);
          v157 = v153 - v97;
          *vecForce_4 = v151 * v156;
          *fImpulseMagnitudeB = -(float)(v152 * v157);
          v158 = colPoint->m_vecNormal.x;
          v159 = colPoint->m_vecNormal.y;
          v160 = colPoint->m_vecNormal.z;
          if ( !(v16 | ((unsigned __int8)(*(_BYTE *)&this->m_nPhysicalFlags & 4) >> 2)) )
          {
            v161 = *vecForce_4 / v8.n64_f32[0];
            v150 = vecForce_8;
            v270.z = v161 * v160;
            if ( (float)(v161 * v160) < 0.0 )
              v270.z = 0.0;
            v270.x = v158 * v161;
            v270.y = v161 * v159;
            CPhysical::ApplyForce(this, v270, v267[0], 1);
          }
          v162 = pPhysical->m_nPhysicalFlags;
          if ( (*(_BYTE *)&v162 & 4) == 0 )
          {
            v163 = (float)(v152 * v157) / v19;
            v164 = v163 * v160;
            v165 = v163 * v159;
            v166 = v163 * v158;
            if ( (float)(v163 * v160) < 0.0 )
            {
              v164 = 0.0;
              if ( fabsf(v98) < 0.01 )
              {
                v165 = v165 * 0.5;
                v166 = v166 * 0.5;
              }
            }
            if ( v16 )
            {
              v165 = v165 + v165;
              v166 = v166 + v166;
            }
            if ( (*(_BYTE *)v150 & 0x20) != 0 )
            {
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              v167 = -pPhysical->m_vecTurnSpeed.z;
              pPhysical->m_vecTurnSpeed.y = -pPhysical->m_vecTurnSpeed.y;
              pPhysical->m_vecTurnSpeed.z = v167;
              CPhysical::ApplySpeed(pPhysical);
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              v168 = -pPhysical->m_vecTurnSpeed.z;
              pPhysical->m_vecTurnSpeed.y = -pPhysical->m_vecTurnSpeed.y;
              pPhysical->m_vecTurnSpeed.z = v168;
              *(_DWORD *)v150 &= ~0x20u;
              v162 = pPhysical->m_nPhysicalFlags;
            }
            if ( (*(_BYTE *)&v162 & 0x60) == 0 )
            {
              v169 = 0.0;
              v170 = 1.0 / pPhysical->m_fMass;
              v171 = pPhysical->m_vecMoveSpeed.y;
              v172 = pPhysical->m_vecMoveSpeed.z;
              if ( (*(_BYTE *)&v162 & 0x80) == 0 )
                v169 = v164;
              pPhysical->m_vecMoveSpeed.x = pPhysical->m_vecMoveSpeed.x + (float)(v166 * v170);
              pPhysical->m_vecMoveSpeed.y = (float)(v165 * v170) + v171;
              pPhysical->m_vecMoveSpeed.z = (float)(v169 * v170) + v172;
            }
          }
          CAudioEngine::ReportCollision(
            &AudioEngine,
            this,
            pPhysical,
            colPoint->m_dataA.m_nSurfaceType,
            colPoint->m_dataB.m_nSurfaceType,
            &colPoint->m_vecPosition,
            &colPoint->m_vecNormal,
            *vecForce_4 / v151,
            1.0,
            0,
            0);
          CAudioEngine::ReportCollision(
            &AudioEngine,
            pPhysical,
            this,
            colPoint->m_dataB.m_nSurfaceType,
            colPoint->m_dataA.m_nSurfaceType,
            &colPoint->m_vecPosition,
            &colPoint->m_vecNormal,
            *fImpulseMagnitudeB / v152,
            1.0,
            0,
            0);
          return 1;
        }
      }
      else
      {
        v261 = colPoint;
        v39 = pPhysical->m_pMat;
        tz = v39->tz;
        v41 = v32 - v39->tx;
        vecOffset = v38;
        v266.y = v33 - v39->ty;
        v266.x = v41;
        v266.z = v34 - tz;
        CPhysical::GetSpeed(&v1, this, *(CVector *)&v36);
        v43 = v1.x;
        v42 = v1.y;
        v44 = v1.z;
        if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 4) != 0
          && (*(_BYTE *)&this->m_info & 7) == 2
          && v261->m_dataA.m_nSurfaceType == 65 )
        {
          (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))this->_vptr$CPlaceable + 50))(&v1, this, v267);
          v44 = v1.z + v44;
          v43 = v1.x + v43;
          vecForce = v1.y + v42;
        }
        else
        {
          vecForce = v1.y;
        }
        CPhysical::GetSpeed(&v1, pPhysical, v266);
        v109 = v1.x;
        v110 = v1.y;
        v111 = v1.z;
        if ( (*((_BYTE *)&pPhysical->m_nPhysicalFlags + 3) & 4) != 0
          && (*(_BYTE *)&pPhysical->m_info & 7) == 2
          && v261->m_dataB.m_nSurfaceType == 65 )
        {
          (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))pPhysical->_vptr$CPlaceable + 50))(
            &v1,
            pPhysical,
            &v266);
          v111 = v1.z + v111;
          v110 = v1.y + v110;
          v109 = v1.x + v109;
        }
        v112 = v261->m_vecNormal.x;
        v113 = v261->m_vecNormal.y;
        v114 = v261->m_vecNormal.z;
        v115 = v113 * v110;
        v116 = v113 * vecForce;
        v117 = v111;
        v118 = &v261->m_vecNormal;
        v119 = (float)(v112 * v43) + v116;
        if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x20) != 0 )
        {
          v262.x = v267[0].x - v265.x;
          v262.y = v267[0].y - v265.y;
          v262.z = v267[0].z - v265.z;
          CrossProduct(&v1, &v262, &v261->m_vecNormal);
          v121 = (float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
               / (float)(v8.n64_f32[0] * this->m_fTurnMass);
        }
        else
        {
          v120 = this->m_fMass;
          v262.x = v267[0].x - v265.x;
          v262.y = v267[0].y - v265.y;
          v262.z = v267[0].z - v265.z;
          CrossProduct(&v1, &v262, &v261->m_vecNormal);
          v121 = (float)(1.0 / (float)(v8.n64_f32[0] * v120))
               + (float)((float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
                       / (float)(v8.n64_f32[0] * this->m_fTurnMass));
        }
        v173 = (float)((float)(v112 * v109) + v115) + (float)(v114 * v117);
        v174 = vecForce_4;
        v175 = v119 + (float)(v114 * v44);
        v176 = vecForce_8;
        v177 = 1.0 / v121;
        if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 0x20) != 0 )
        {
          v262.x = v266.x - v264.x;
          v262.y = v266.y - v264.y;
          v262.z = v266.z - v264.z;
          CrossProduct(&v1, &v262, v118);
          v179 = (float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
               / (float)(v19 * pPhysical->m_fTurnMass);
        }
        else
        {
          v178 = pPhysical->m_fMass;
          v262.x = v266.x - v264.x;
          v262.y = v266.y - v264.y;
          v262.z = v266.z - v264.z;
          CrossProduct(&v1, &v262, v118);
          v179 = (float)(1.0 / (float)(v19 * v178))
               + (float)((float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
                       / (float)(v19 * pPhysical->m_fTurnMass));
        }
        v180 = 1.0 / v179;
        v181 = (float)((float)(v175 * v177) + (float)(v173 * v180)) / (float)(v177 + v180);
        if ( (float)(v175 - v181) < 0.0 )
        {
          v182 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v183 = v181 - (float)((float)(v175 - v181) * v182);
          if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0 )
            v183 = (float)((float)(v175 * v177) + (float)(v173 * v180)) / (float)(v177 + v180);
          v184 = v183 - v175;
          if ( (*((_BYTE *)vecForce_8 + 1) & 0x10) == 0 )
            v181 = v181 - (float)((float)(v173 - v181) * v182);
          v185 = v181 - v173;
          *vecForce_4 = v177 * v184;
          *fImpulseMagnitudeB = -(float)(v180 * v185);
          v186 = (float)(v180 * v185) / v19;
          v187 = *vecForce_4 / v8.n64_f32[0];
          v188 = v261->m_vecNormal.z;
          v189 = v261->m_vecNormal.x;
          v190 = v261->m_vecNormal.y;
          v191 = v186 * v188;
          v192 = (unsigned __int8)this->m_info;
          v193 = v187 * v190;
          v194 = v187 * v188;
          if ( (v192 & 7) == 2 )
          {
            v195 = (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0;
            if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) == 0 )
              v195 = (*(_BYTE *)&this->m_nPhysicalFlags & 4) != 0;
            if ( !v195 )
            {
              if ( v188 < 0.7 )
                v194 = (float)(v187 * v188) * 0.3;
              if ( v192 <= 7 )
              {
                v267[0].x = v267[0].x * 0.8;
                v267[0].y = v267[0].y * 0.8;
                v267[0].z = v267[0].z * 0.8;
              }
              if ( CWorld::bNoMoreCollisionTorque )
              {
                v176 = vecForce_8;
                v271.x = (float)(v189 * v187) * -0.3;
                v271.y = v193 * -0.3;
                v271.z = v194 * -0.3;
                CPhysical::ApplyFrictionForce(this, v271, v267[0]);
              }
            }
          }
          v196 = v186 * v188;
          v197 = (unsigned __int8)pPhysical->m_info;
          v198 = v186 * v190;
          v199 = v186 * v189;
          if ( (v197 & 7) == 2 )
          {
            v200 = (*((_BYTE *)v176 + 1) & 0x10) != 0;
            if ( (*((_BYTE *)v176 + 1) & 0x10) == 0 )
              v200 = (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0;
            if ( !v200 )
            {
              if ( v261->m_vecNormal.z > -0.7 )
                v196 = v191 * 0.3;
              if ( v197 <= 7 )
              {
                v266.x = v266.x * 0.8;
                v266.y = v266.y * 0.8;
                v266.z = v266.z * 0.8;
              }
              if ( CWorld::bNoMoreCollisionTorque )
              {
                v176 = vecForce_8;
                v272.x = v199 * -0.3;
                v272.y = v198 * -0.3;
                v272.z = v196 * -0.3;
                CPhysical::ApplyFrictionForce(pPhysical, v272, v266);
              }
            }
          }
          if ( CCheat::m_aCheatsActive[62] )
          {
            if ( FindPlayerVehicle(-1, 0) == this
              && (*(_BYTE *)&pPhysical->m_info & 7) == 2
              && LOBYTE(pPhysical[3].m_vecDamagePos.y) != 2 )
            {
              *(_DWORD *)&pPhysical->m_nPhysicalFlags &= ~2u;
            }
            if ( FindPlayerVehicle(-1, 0) == pPhysical
              && (*(_BYTE *)&this->m_info & 7) == 2
              && LOBYTE(this[3].m_vecDamagePos.y) != 2 )
            {
              *(_DWORD *)&this->m_nPhysicalFlags &= ~2u;
            }
          }
          if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
          {
            *(_QWORD *)&v273.y = __PAIR64__(LODWORD(v194), LODWORD(v193));
            v273.x = v189 * v187;
            v176 = vecForce_8;
            CPhysical::ApplyForce(this, v273, v267[0], 1);
          }
          if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) == 0 )
          {
            if ( (*(_BYTE *)v176 & 0x20) != 0 )
            {
              v201 = -pPhysical->m_vecTurnSpeed.y;
              v202 = -pPhysical->m_vecTurnSpeed.z;
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              pPhysical->m_vecTurnSpeed.y = v201;
              pPhysical->m_vecTurnSpeed.z = v202;
              CPhysical::ApplySpeed(pPhysical);
              v203 = -pPhysical->m_vecTurnSpeed.y;
              v204 = -pPhysical->m_vecTurnSpeed.z;
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              v174 = vecForce_4;
              pPhysical->m_vecTurnSpeed.y = v203;
              pPhysical->m_vecTurnSpeed.z = v204;
              *(_DWORD *)v176 &= ~0x20u;
            }
            v274.x = v199;
            *(_QWORD *)&v274.y = __PAIR64__(LODWORD(v196), LODWORD(v198));
            CPhysical::ApplyForce(pPhysical, v274, v266, 1);
          }
          CAudioEngine::ReportCollision(
            &AudioEngine,
            this,
            pPhysical,
            v261->m_dataA.m_nSurfaceType,
            v261->m_dataB.m_nSurfaceType,
            &v261->m_vecPosition,
            v118,
            *v174 / v177,
            1.0,
            0,
            0);
          CAudioEngine::ReportCollision(
            &AudioEngine,
            pPhysical,
            this,
            v261->m_dataB.m_nSurfaceType,
            v261->m_dataA.m_nSurfaceType,
            &v261->m_vecPosition,
            &v261->m_vecNormal,
            *fImpulseMagnitudeB / v180,
            1.0,
            0,
            0);
          return 1;
        }
      }
    }
    return 0;
  }
  v45 = this->m_pMat;
  v46 = colPoint->m_vecPosition.z - v45->tz;
  v276.x = colPoint->m_vecPosition.x - v45->tx;
  v267[0].y = colPoint->m_vecPosition.y - v45->ty;
  v276.y = v267[0].y;
  v267[0].x = v276.x;
  v267[0].z = v46;
  v276.z = v46;
  CPhysical::GetSpeed(&v266, this, v276);
  v48 = v266.x;
  v47 = v266.y;
  v49 = v266.z;
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 4) != 0 )
  {
    v50 = *(_BYTE *)&this->m_info & 7;
    v51 = v50 == 2;
    if ( v50 == 2 )
      v51 = colPoint->m_dataA.m_nSurfaceType == 65;
    if ( v51 )
    {
      (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))this->_vptr$CPlaceable + 50))(&v266, this, v267);
      v49 = v266.z + v49;
      v47 = v266.y + v47;
      v48 = v266.x + v48;
    }
  }
  v52 = colPoint->m_vecNormal.x * v48;
  p_m_nFlags = &pPhysical->m_nFlags;
  v27 = fImpulseMagnitudeB;
  v53 = (float)(v52 + (float)(colPoint->m_vecNormal.y * v47)) + (float)(colPoint->m_vecNormal.z * v49);
  if ( v53 >= 0.0 )
    goto LABEL_204;
  if ( (*(_BYTE *)&pPhysical->m_info & 7) != 4 )
  {
    if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0 )
      return CPhysical::ApplyCollision(this, pPhysical, colPoint, fImpulseMagnitudeA);
    v205 = fImpulseMagnitudeB;
    (*((void (__fastcall **)(CPhysical *, _DWORD))pPhysical->_vptr$CPlaceable + 5))(pPhysical, 0);
LABEL_200:
    CWorld::Players[CWorld::PlayerInFocus].HavocCaused += 2;
    v206 = rand();
    CStats::IncrementStat(0x7Du, (float)(v206 % 30 + 30));
LABEL_203:
    v27 = v205;
    goto LABEL_204;
  }
  v54 = this->m_fMass;
  v55 = fImpulseMagnitudeB;
  v1.x = v267[0].x - v265.x;
  v1.y = v267[0].y - v265.y;
  v1.z = v267[0].z - v265.z;
  CrossProduct(&v266, &v1, &colPoint->m_vecNormal);
  v56 = 1.0;
  v57 = 1.0
      / (float)((float)(1.0 / v54)
              + (float)((float)((float)((float)(v266.x * v266.x) + (float)(v266.y * v266.y)) + (float)(v266.z * v266.z))
                      / this->m_fTurnMass));
  if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) == 0 )
    v53 = v53 * (float)(this->m_fElasticity + 1.0);
  v58 = -(float)(v57 * v53);
  *fImpulseMagnitudeA = v58;
  *fImpulseMagnitudeB = v58;
  if ( (*(_BYTE *)&this->m_info & 7) == 2 )
  {
    v56 = 1.0;
    if ( this[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)byte_9 )
      v56 = 3.0;
  }
  if ( !LOBYTE(pPhysical[1].m_transform.m_translate.z)
    || (v59 = v56 * *fImpulseMagnitudeA, v59 <= 20.0)
    || (CObject::ObjectDamage(
          (CObject *)pPhysical,
          v59,
          &colPoint->m_vecPosition,
          &colPoint->m_vecNormal,
          (int)this,
          WEAPONTYPE_UNIDENTIFIED),
        *(_BYTE *)&pPhysical->m_nFlags << 31) )
  {
    if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) == 0 )
    {
      v211 = pPhysical[1].pReferences[2].ppReferenceAddress;
      if ( *(float *)&v211 < 9999.0
        && (*fImpulseMagnitudeA > *(float *)&v211 || (~*(_DWORD *)&this->m_nFlags & 0x1010) == 0) )
      {
        if ( (*(_BYTE *)&pPhysical->m_info & 7) == 4
          && (v212 = CModelInfo::ms_modelInfoPtrs[pPhysical->m_nModelIndex],
              (v213 = (*((int (__fastcall **)(CBaseModelInfo *))v212->_vptr$CBaseModelInfo + 2))(v212)) != 0)
          && (*(_WORD *)(v213 + 40) & 0x7000 | 0x800) == 10240 )
        {
          p_m_nFlags = &pPhysical->m_nFlags;
          v55 = fImpulseMagnitudeB;
          CGlass::WindowRespondsToCollision(
            pPhysical,
            *fImpulseMagnitudeA,
            this->m_vecMoveSpeed,
            colPoint->m_vecPosition,
            0);
        }
        else
        {
          (*((void (__fastcall **)(CPhysical *, _DWORD))pPhysical->_vptr$CPlaceable + 5))(pPhysical, 0);
        }
        m_nModelIndex = pPhysical->m_nModelIndex;
        if ( m_nModelIndex != MI_FIRE_HYDRANT || (LOBYTE(pPhysical[1].m_transform.m_translate.y) & 0x40) != 0 )
        {
          if ( m_nModelIndex != MI_PARKINGMETER && m_nModelIndex != MI_PARKINGMETER2
            || (LOBYTE(pPhysical[1].m_transform.m_translate.y) & 0x40) != 0 )
          {
            v27 = v55;
            if ( (*(_BYTE *)&pPhysical->m_info & 7) == 4 && !HIBYTE(pPhysical[1].pReferences[3].ppReferenceAddress) )
              LODWORD(pPhysical[1].m_transform.m_translate.y) |= 0x40u;
            goto LABEL_272;
          }
          v243 = pPhysical->m_pMat;
          p_tx = (CSimpleTransform *)&v243->tx;
          if ( !v243 )
            p_tx = &pPhysical->m_transform;
          v245 = *(_QWORD *)&p_tx->m_translate.x;
          v251 = p_tx->m_translate.y;
          v246 = p_tx->m_translate.z;
          v247 = rand();
          v248 = v246;
          p_m_nFlags = &pPhysical->m_nFlags;
          CPickups::CreateSomeMoney(*(float *)&v245, v251, v248, v247 % 100);
        }
        else
        {
          v241 = pPhysical->m_pMat;
          p_m_transform = (CSimpleTransform *)&v241->tx;
          if ( !v241 )
            p_m_transform = &pPhysical->m_transform;
          Fx_c::TriggerWaterHydrant(&g_fx, &p_m_transform->m_translate);
        }
        v27 = v55;
        LODWORD(pPhysical[1].m_transform.m_translate.y) |= 0x40u;
LABEL_272:
        if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0
          && *(float *)&pPhysical[1].pReferences[2].ppReferenceAddress > 200.0 )
        {
          p_m_nFlags = &pPhysical->m_nFlags;
          v275.x = (float)(colPoint->m_vecNormal.x * 0.2) * *fImpulseMagnitudeA;
          v275.y = (float)(colPoint->m_vecNormal.y * 0.2) * *fImpulseMagnitudeA;
          v275.z = (float)(colPoint->m_vecNormal.z * 0.2) * *fImpulseMagnitudeA;
          CPhysical::ApplyForce(this, v275, v267[0], 1);
          v27 = fImpulseMagnitudeB;
        }
        goto LABEL_204;
      }
    }
    if ( (*(_BYTE *)&pPhysical->m_info & 7) == 4 )
    {
      v214 = CModelInfo::ms_modelInfoPtrs[pPhysical->m_nModelIndex];
      v215 = (*((int (__fastcall **)(CBaseModelInfo *))v214->_vptr$CBaseModelInfo + 2))(v214);
      if ( v215 )
      {
        if ( (*(_WORD *)(v215 + 40) & 0x7000 | 0x800) == 10240 )
          CGlass::WindowRespondsToSoftCollision(pPhysical, *fImpulseMagnitudeA);
      }
    }
    return CPhysical::ApplyCollision(this, pPhysical, colPoint, fImpulseMagnitudeA);
  }
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
  {
    v60 = 1.0 / (float)(*(float *)&pPhysical[1].pReferences[3].pNext + *(float *)&pPhysical[1].pReferences[3].pNext);
    v268.y = (float)(*fImpulseMagnitudeA * colPoint->m_vecNormal.y) * v60;
    v268.x = (float)(*fImpulseMagnitudeA * colPoint->m_vecNormal.x) * v60;
    v268.z = (float)(*fImpulseMagnitudeA * colPoint->m_vecNormal.z) * v60;
    CPhysical::ApplyForce(this, v268, v267[0], 1);
  }
  v61 = 0;
  CAudioEngine::ReportCollision(
    &AudioEngine,
    this,
    pPhysical,
    colPoint->m_dataA.m_nSurfaceType,
    colPoint->m_dataB.m_nSurfaceType,
    &colPoint->m_vecPosition,
    &colPoint->m_vecNormal,
    (float)((float)(*fImpulseMagnitudeA / v57) + (float)(*fImpulseMagnitudeA / v57))
  * *(float *)&pPhysical[1].pReferences[3].pNext,
    1.0,
    0,
    0);
  return v61;
}
// 401E80: fragmented variable at r2.4 may be wrong
// 401E80: fragmented variable at r3.4 may be wrong

//----- (00403A6C) --------------------------------------------------------
int __fastcall CPhysical::ApplyCollisionAlt(
        CPhysical *this,
        CEntity *pEntity,
        CColPoint *colPoint,
        float *fImpulseMagnitude,
        CVector *vecMoveInc,
        CVector *vecTurnInc)
{
  CEntity *v7; // r8
  CEntity *m_pAttachToEntity; // r0
  bool v11; // zf
  CMatrix *m_pMat; // r0
  RwReal v13; // s4
  int v14; // r0
  bool v15; // zf
  float v16; // s20
  float x; // s4
  float v18; // s2
  float v19; // s0
  float v20; // s0
  float v21; // s2
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float m_fMass; // s0
  float v25; // s16
  CVector *p_m_vecNormal; // r11
  float v27; // s18
  CEntity::CEntityInfo m_info; // r0
  int v29; // r1
  float v30; // s16
  float v31; // s0
  bool v32; // zf
  RwReal v33; // r1
  bool v34; // zf
  float v35; // s2
  float v36; // s12
  float v37; // s14
  float v38; // s3
  float v39; // s2
  float y; // s8
  float v41; // s4
  float z; // s10
  float v43; // s0
  float v44; // s0
  float v45; // s0
  int v46; // r0
  bool v47; // zf
  float v48; // s0
  float v49; // s2
  float v50; // s4
  float v51; // s0
  float v52; // s10
  float v53; // s6
  float v54; // s8
  float v55; // s10
  RwReal v56; // s2
  RwReal v57; // s4
  RwReal v58; // s8
  RwReal v59; // s6
  float v60; // s0
  RwReal v61; // s2
  RwReal v62; // s4
  RwReal v63; // s0
  CVector v64; // [sp+1Ch] [bp-9Ch] BYREF
  CVector v65; // [sp+28h] [bp-90h] BYREF
  CVector v1; // [sp+34h] [bp-84h] BYREF
  CVector v67; // [sp+40h] [bp-78h] BYREF
  CVector v68; // [sp+4Ch] [bp-6Ch] BYREF
  CVector v2; // [sp+58h] [bp-60h] BYREF
  CVector v70; // [sp+68h] [bp-50h] BYREF
  CVector v71[5]; // [sp+74h] [bp-44h] BYREF
  CVector v72; // 0:r1.12
  CVector v73; // 0:r2.8,8:^0.4

  v7 = pEntity;
  m_pAttachToEntity = this->m_pAttachToEntity;
  v11 = m_pAttachToEntity == 0;
  if ( m_pAttachToEntity )
  {
    pEntity = (CEntity *)(*(_BYTE *)&m_pAttachToEntity->m_info & 7);
    v11 = pEntity == (CEntity *)((char *)&dword_0 + 3);
  }
  if ( !v11 && (unsigned __int8)((_BYTE)pEntity - 2) <= 2u )
  {
    v71[0].x = 0.0;
    CPhysical::ApplySoftCollision((CPhysical *)m_pAttachToEntity, v7, colPoint, &v71[0].x);
  }
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x10) != 0 )
  {
    v20 = (float)((float)(this->m_vecMoveSpeed.x * colPoint->m_vecNormal.x)
                + (float)(this->m_vecMoveSpeed.y * colPoint->m_vecNormal.y))
        + (float)(this->m_vecMoveSpeed.z * colPoint->m_vecNormal.z);
    if ( v20 < 0.0 )
    {
      v21 = -(float)(v20 * this->m_fMass);
      *fImpulseMagnitude = v21;
      m_nPhysicalFlags = this->m_nPhysicalFlags;
      if ( (*(_BYTE *)&m_nPhysicalFlags & 0x60) != 0 )
      {
        m_fMass = this->m_fMass;
      }
      else
      {
        m_fMass = this->m_fMass;
        v36 = colPoint->m_vecNormal.x * v21;
        v37 = colPoint->m_vecNormal.y * v21;
        v38 = 0.0;
        v39 = colPoint->m_vecNormal.z * v21;
        y = this->m_vecMoveSpeed.y;
        v41 = 1.0 / m_fMass;
        z = this->m_vecMoveSpeed.z;
        if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) == 0 )
          v38 = v39;
        this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v36 * v41);
        this->m_vecMoveSpeed.y = (float)(v37 * v41) + y;
        this->m_vecMoveSpeed.z = (float)(v38 * v41) + z;
        v21 = *fImpulseMagnitude;
      }
      CAudioEngine::ReportCollision(
        &AudioEngine,
        this,
        v7,
        colPoint->m_dataA.m_nSurfaceType,
        colPoint->m_dataB.m_nSurfaceType,
        &colPoint->m_vecPosition,
        &colPoint->m_vecNormal,
        v21 / m_fMass,
        1.0,
        0,
        0);
      return 1;
    }
    return 0;
  }
  m_pMat = this->m_pMat;
  v13 = colPoint->m_vecPosition.z - m_pMat->tz;
  v73.x = colPoint->m_vecPosition.x - m_pMat->tx;
  v71[0].y = colPoint->m_vecPosition.y - m_pMat->ty;
  v73.y = v71[0].y;
  v71[0].x = v73.x;
  v71[0].z = v13;
  v73.z = v13;
  CPhysical::GetSpeed(&v70, this, v73);
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 4) != 0 )
  {
    v14 = *(_BYTE *)&this->m_info & 7;
    v15 = v14 == 2;
    if ( v14 == 2 )
      v15 = colPoint->m_dataA.m_nSurfaceType == 65;
    if ( v15 )
    {
      (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))this->_vptr$CPlaceable + 50))(&v2, this, v71);
      v70.x = v2.x + v70.x;
      v70.y = v2.y + v70.y;
      v70.z = v2.z + v70.z;
    }
  }
  v2 = colPoint->m_vecNormal;
  v16 = (float)((float)(v70.x * v2.x) + (float)(v70.y * v2.y)) + (float)(v70.z * v2.z);
  if ( v16 >= 0.0 )
    return 0;
  Multiply3x3(&v68, this->m_pMat, &this->m_vecCOM);
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x40) != 0 )
  {
    v19 = 0.0;
    memset(&v68, 0, sizeof(v68));
    v18 = 0.0;
    x = 0.0;
  }
  else
  {
    x = v68.x;
    v18 = v68.y;
    v19 = v68.z;
  }
  v25 = this->m_fMass;
  p_m_vecNormal = &colPoint->m_vecNormal;
  v1.x = v71[0].x - x;
  v1.y = v71[0].y - v18;
  v1.z = v71[0].z - v19;
  CrossProduct(&v67, &v1, &v2);
  v27 = 1.0;
  m_info = this->m_info;
  v29 = *(_BYTE *)&m_info & 7;
  v30 = 1.0
      / (float)((float)(1.0 / v25)
              + (float)((float)((float)((float)(v67.x * v67.x) + (float)(v67.y * v67.y)) + (float)(v67.z * v67.z))
                      / this->m_fTurnMass));
  v31 = CTimer::ms_fTimeStep * 0.008;
  if ( v29 == 4 )
  {
    if ( (*(_BYTE *)&this->m_nFlags & 8) == 0 )
    {
      v43 = v31 * 1.3;
      if ( fabsf(this->m_vecMoveSpeed.x) < v43
        && fabsf(this->m_vecMoveSpeed.y) < v43
        && fabsf(this->m_vecMoveSpeed.z) < (float)(v43 + v43) )
      {
        v27 = 0.0;
        *fImpulseMagnitude = (float)(v16 * -0.98) * v30;
        m_info = this->m_info;
      }
    }
    goto LABEL_48;
  }
  v32 = v29 == 2;
  if ( v29 == 2 )
    v32 = *((unsigned __int8 *)&this->m_nPhysicalFlags + 1) << 31 == 0;
  if ( !v32 )
  {
LABEL_48:
    v46 = *(_BYTE *)&m_info & 7;
    v47 = v46 == 2;
    if ( v46 == 2 )
      v47 = LODWORD(this[4].m_vecCOM.z) == 5;
    if ( v47 && (colPoint->m_dataB.m_nSurfaceType == 43 || v2.z < 0.5) )
      v48 = (float)(this->m_fElasticity + this->m_fElasticity) + 1.0;
    else
      v48 = this->m_fElasticity + 1.0;
    v45 = -(float)(v30 * (float)(v16 * v48));
    goto LABEL_53;
  }
  v33 = this[4].m_vecCOM.z;
  if ( LODWORD(v33) == 5 )
  {
    v44 = v31 * 1.5;
    if ( fabsf(this->m_vecMoveSpeed.x) >= v44 )
      goto LABEL_48;
  }
  else
  {
    v34 = LODWORD(v33) == 9;
    if ( LODWORD(v33) == 9 )
      v34 = (*(_BYTE *)&m_info & 0xF0) == 32;
    if ( v34 )
    {
      v35 = 1.7;
    }
    else
    {
      if ( this->m_pMat->zz >= -0.3 )
        goto LABEL_48;
      v35 = 1.4;
    }
    v44 = v31 * v35;
    if ( fabsf(this->m_vecMoveSpeed.x) >= v44 )
      goto LABEL_48;
  }
  if ( fabsf(this->m_vecMoveSpeed.y) >= v44 || fabsf(this->m_vecMoveSpeed.z) >= (float)(v44 + v44) )
    goto LABEL_48;
  v27 = 0.0;
  v45 = (float)(v16 * -0.95) * v30;
LABEL_53:
  *fImpulseMagnitude = v45;
  v49 = v45 * v2.x;
  v50 = v45 * v2.y;
  v51 = v45 * v2.z;
  v67.x = v49;
  v67.y = v50;
  v67.z = v51;
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0xE0) != 0 )
  {
    v72.x = v49;
    *(_QWORD *)&v72.y = __PAIR64__(LODWORD(v51), LODWORD(v50));
    CPhysical::ApplyForce(this, v72, v71[0], 1);
  }
  else
  {
    v52 = 1.0 / this->m_fMass;
    v53 = v51 * v52;
    v54 = v52 * v50;
    v55 = v52 * v49;
    if ( (*(_BYTE *)&this->m_info & 7) == 2 )
    {
      if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) == 0
        || (float)((float)((float)(this->m_vecMoveSpeed.x * this->m_vecMoveSpeed.x)
                         + (float)(this->m_vecMoveSpeed.y * this->m_vecMoveSpeed.y))
                 + (float)(this->m_vecMoveSpeed.z * this->m_vecMoveSpeed.z)) <= 0.1
        && ((*(_BYTE *)&v7->m_info & 7) == 1 || (LOBYTE(v7[1].m_transform.m_translate.y) & 4) != 0) )
      {
        v53 = v53 * 1.2;
        v54 = v54 * 1.2;
        v55 = v55 * 1.2;
      }
      v58 = v54 + vecMoveInc->y;
      v59 = v53 + vecMoveInc->z;
      vecMoveInc->x = v55 + vecMoveInc->x;
      vecMoveInc->y = v58;
      vecMoveInc->z = v59;
      v67.y = v50 * 0.8;
      v67.x = v49 * 0.8;
      v67.z = v51 * 0.8;
    }
    else
    {
      v56 = v54 + vecMoveInc->y;
      v57 = v53 + vecMoveInc->z;
      vecMoveInc->x = v55 + vecMoveInc->x;
      vecMoveInc->y = v56;
      vecMoveInc->z = v57;
    }
    Multiply3x3(&v1, this->m_pMat, &this->m_vecCOM);
    v64.x = v71[0].x - v1.x;
    v64.y = v71[0].y - v1.y;
    v64.z = v71[0].z - v1.z;
    CrossProduct(&v65, &v64, &v67);
    v60 = 1.0 / this->m_fTurnMass;
    v61 = (float)(v60 * v65.x) + vecTurnInc->x;
    v62 = (float)(v60 * v65.y) + vecTurnInc->y;
    v63 = (float)(v60 * v65.z) + vecTurnInc->z;
    vecTurnInc->x = v61;
    vecTurnInc->y = v62;
    vecTurnInc->z = v63;
    p_m_vecNormal = &colPoint->m_vecNormal;
  }
  CAudioEngine::ReportCollision(
    &AudioEngine,
    this,
    v7,
    colPoint->m_dataA.m_nSurfaceType,
    colPoint->m_dataB.m_nSurfaceType,
    &colPoint->m_vecPosition,
    p_m_vecNormal,
    *fImpulseMagnitude / v30,
    v27,
    0,
    0);
  return 1;
}
// 0: using guessed type int dword_0;

//----- (004040EC) --------------------------------------------------------
bool __fastcall CPhysical::ApplySoftCollision(
        CPhysical *this,
        CEntity *pEntity,
        CColPoint *colPoint,
        float *fImpulseMagnitude)
{
  float32x2_t v4; // d1
  float32x2_t v5; // d3
  CMatrix *m_pMat; // r0
  float v10; // s20
  float v11; // s22
  float v12; // s16
  RwReal v13; // r9
  __int64 v14; // d16
  float v15; // s18
  int v16; // r0
  bool v17; // zf
  float x; // s24
  float y; // s26
  float z; // s28
  float v21; // s30
  float v22; // s17
  float v23; // s19
  float v24; // s6
  float v25; // s8
  float v26; // s4
  float v27; // s24
  RwReal v28; // s2
  float m_fMass; // s20
  int v30; // r0
  bool v31; // zf
  float v32; // s0
  float v33; // s2
  float v34; // s2
  bool v35; // r6
  CMatrix *v36; // r0
  float xz; // s6
  float yz; // s10
  float zz; // s8
  float v40; // s12
  CMatrix *v41; // r0
  float yx; // s10
  float zx; // s12
  float v44; // s14
  CVector vecOffset; // [sp+0h] [bp-A8h]
  CVector v1; // [sp+14h] [bp-94h] BYREF
  CVector v48; // [sp+20h] [bp-88h] BYREF
  CVector v49; // [sp+2Ch] [bp-7Ch] BYREF
  CVector v2; // [sp+38h] [bp-70h] BYREF
  CVector v51; // [sp+44h] [bp-64h] BYREF
  CVector v52; // 0:r1.12
  CVector cvector; // 0:r2.8,8:^0.4

  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x10) != 0 )
    CPhysical::ApplyCollision(this, pEntity, colPoint, fImpulseMagnitude);
  m_pMat = this->m_pMat;
  v10 = colPoint->m_vecPosition.x - m_pMat->tx;
  v11 = colPoint->m_vecPosition.y - m_pMat->ty;
  v12 = colPoint->m_vecPosition.z - m_pMat->tz;
  v13 = v10;
  cvector.z = v12;
  cvector.x = v10;
  cvector.y = v11;
  CPhysical::GetSpeed(&v51, this, cvector);
  v14 = *(_QWORD *)&colPoint->m_vecNormal.x;
  v2.z = colPoint->m_vecNormal.z;
  *(_QWORD *)&v2.x = v14;
  v15 = SOFTCOL_SPEED_MULT;
  v16 = *(_BYTE *)&this->m_info & 7;
  v17 = v16 == 2;
  if ( v16 == 2 )
    v17 = this[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)((char *)&dword_0 + 1);
  if ( v17 )
  {
    v36 = this->m_pMat;
    xz = v36->xz;
    yz = v36->yz;
    zz = v36->zz;
    v40 = (float)((float)(v2.x * xz) + (float)(v2.y * yz)) + (float)(v2.z * zz);
    if ( v40 < -0.9 )
      return 0;
    if ( v40 >= 0.0 )
    {
      if ( v40 > 0.5 )
        v15 = SOFTCOL_SPEED_MULT2;
    }
    else
    {
      v2.y = v2.y - (float)(yz * v40);
      v2.x = v2.x - (float)(xz * v40);
      v2.z = v2.z - (float)(zz * v40);
      CVector::Normalise(&v2);
    }
  }
  x = v2.x;
  y = v2.y;
  z = v2.z;
  v21 = v51.x;
  v22 = v51.y;
  v23 = v51.z;
  Multiply3x3(&v49, this->m_pMat, &this->m_vecCOM);
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x40) != 0 )
  {
    v26 = 0.0;
    memset(&v49, 0, sizeof(v49));
    v25 = 0.0;
    v24 = 0.0;
  }
  else
  {
    v24 = v49.x;
    v25 = v49.y;
    v26 = v49.z;
  }
  v27 = (float)((float)(v21 * x) + (float)(v22 * y)) + (float)(v23 * z);
  v28 = v10 - v24;
  m_fMass = this->m_fMass;
  v1.y = v11 - v25;
  v1.x = v28;
  v1.z = v12 - v26;
  CrossProduct(&v48, &v1, &v2);
  v30 = *(_BYTE *)&this->m_info & 7;
  v31 = v30 == 2;
  if ( v30 == 2 )
    v31 = this[4].m_listEntryInfo.m_pHead == 0;
  v32 = 1.0
      / (float)((float)(1.0 / m_fMass)
              + (float)((float)((float)((float)(v48.x * v48.x) + (float)(v48.y * v48.y)) + (float)(v48.z * v48.z))
                      / this->m_fTurnMass));
  if ( v31 && (unsigned __int8)(colPoint->m_dataA.m_nPieceType - 13) <= 3u )
  {
    v34 = CTimer::ms_fTimeStep * (float)((float)(v32 * (float)(colPoint->m_fDepth * SOFTCOL_DEPTH_MULT)) * 0.008);
    *fImpulseMagnitude = v34;
    if ( v27 < 0.0 )
    {
      v34 = v34 - (float)(v32 * (float)(v27 * SOFTCOL_CARLINE_SPEED_MULT));
      *fImpulseMagnitude = v34;
    }
    v41 = this->m_pMat;
    yx = v41->yx;
    zx = v41->zx;
    v44 = (float)((float)((float)(v2.x * v41->xx) + (float)(v2.y * yx)) + (float)(v2.z * zx)) * 0.9;
    v2.x = v2.x - (float)(v41->xx * v44);
    v2.y = v2.y - (float)(yx * v44);
    v2.z = v2.z - (float)(zx * v44);
  }
  else
  {
    v4.n64_u32[0] = LODWORD(colPoint->m_fDepth);
    v5.n64_f32[0] = SOFTCOL_DEPTH_MIN;
    v33 = CTimer::ms_fTimeStep
        * (float)((float)(v32 * (float)(SOFTCOL_DEPTH_MULT * vmin_f32(v5, v4).n64_f32[0])) * 0.008);
    *fImpulseMagnitude = v33;
    if ( v27 >= 0.0 )
    {
      v35 = 0;
      *fImpulseMagnitude = 0.0;
      return v35;
    }
    v34 = v33 - (float)((float)(v15 * v27) * v32);
    *fImpulseMagnitude = v34;
  }
  if ( v34 == 0.0 )
    return 0;
  v35 = 1;
  vecOffset.x = v13;
  *(_QWORD *)&vecOffset.y = __PAIR64__(LODWORD(v12), LODWORD(v11));
  v52.x = v34 * v2.x;
  v52.y = v34 * v2.y;
  v52.z = v34 * v2.z;
  CPhysical::ApplyForce(this, v52, vecOffset, 1);
  if ( *fImpulseMagnitude < 0.0 )
  {
    *fImpulseMagnitude = -*fImpulseMagnitude;
    return 1;
  }
  return v35;
}
// 404270: variable 'v5' is possibly undefined
// 404270: variable 'v4' is possibly undefined
// 0: using guessed type int dword_0;

//----- (00404498) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
bool __fastcall CPhysical::ApplySoftCollision(
        CPhysical *this,
        CPhysical *pPhysical,
        CColPoint *colPoint,
        float *fImpulseMagnitudeA,
        float *fImpulseMagnitudeB)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d2
  float32x2_t v7; // d6
  float32x2_t v8; // d9
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CPhysical::CPhysicalFlags v12; // r1
  int v14; // r5
  float32x2_t v15; // d9
  float v16; // s16
  CEntity::CEntityInfo m_info; // r0
  char v18; // r1
  CPhysical::CPhysicalFlags v19; // r6
  int v20; // r8
  CPhysical::CPhysicalFlags v21; // r0
  bool v22; // zf
  CEntity::CFlags *p_m_nFlags; // r5
  CMatrix *m_pMat; // r0
  float tz; // s10
  float z; // s4
  float v27; // s22
  float v28; // s20
  float v29; // s20
  float v30; // s0
  int v31; // r6
  int v32; // r0
  CBaseModelInfo *v33; // r0
  int v34; // r0
  CBaseModelInfo *v35; // r0
  int v36; // r0
  float v37; // s0
  float v38; // s6
  int v39; // r2
  float v40; // s8
  int v41; // r1
  float v42; // s2
  float v43; // s0
  float v44; // s14
  _BOOL4 v45; // r1
  int bValidTorque; // r0
  int m_nModelIndex; // r0
  CMatrix *v48; // r2
  CSimpleTransform *p_m_transform; // r1
  CMatrix *v50; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v52; // kr00_8
  int v53; // r0
  CPtrNodeDoubleLink *m_pMovingListNode; // r1
  bool v55; // zf
  CPtrNodeDoubleLink *v56; // r0
  CPtrNode *m_pHead; // r1
  int v58; // r1
  CMatrix *v59; // r0
  float v60; // s0
  float v61; // s4
  float v62; // s2
  float v63; // s10
  RwReal v64; // r2
  float v65; // r3
  float v66; // r0
  CMatrix *v67; // r1
  float v68; // s10
  RwReal v69; // s0
  float v70; // r6
  float v71; // r9
  float v72; // r5
  CMatrix *v73; // r0
  RwReal v74; // s4
  float v75; // r5
  float v76; // r6
  int v77; // r0
  bool v78; // zf
  float v79; // s20
  float v80; // s22
  float v81; // s24
  float v82; // s26
  float v83; // s28
  float v84; // s30
  float v85; // s17
  float v86; // s10
  float v87; // s8
  float v88; // s22
  float v89; // s20
  float v90; // s2
  float v91; // s4
  float v92; // s6
  float v93; // s10
  float v94; // s8
  float v95; // s4
  float v96; // s2
  CPhysical::CPhysicalFlags v97; // r1
  float v98; // s4
  float v99; // s6
  float v100; // s8
  float v101; // s10
  float v102; // s0
  float v103; // s14
  float v104; // s10
  float v105; // s3
  float v106; // s5
  unsigned __int32 v107; // s12
  float v108; // s0
  CVector *p_m_vecNormal; // r5
  float v110; // r6
  float v111; // r9
  float v112; // r8
  int v113; // r0
  bool v114; // zf
  float v115; // s20
  float v116; // s22
  float v117; // s26
  float v118; // s28
  float v119; // s30
  float v120; // s17
  float v121; // s6
  float v122; // s22
  float v123; // s6
  float v124; // s0
  float v125; // s26
  float v126; // s2
  float v127; // s6
  float v128; // s4
  float v129; // s4
  float v130; // s30
  float v131; // s17
  float v132; // s19
  float v133; // s21
  float v134; // s0
  CPhysical::CPhysicalFlags v135; // r0
  float v136; // s2
  float v137; // s4
  float v138; // s0
  float v139; // s2
  float v140; // s12
  float v141; // s8
  float v142; // s10
  float v143; // s1
  float x; // s8
  float y; // s10
  float v146; // s12
  float m_fMass; // s16
  float v148; // s0
  float v149; // s2
  int v150; // r9
  float v151; // s20
  float v152; // r5
  float v153; // r8
  int v154; // r0
  bool v155; // zf
  float v156; // s20
  float v157; // s22
  float v158; // s24
  float v159; // s26
  float v160; // s28
  float v161; // s30
  float v162; // s17
  float v163; // s21
  float v164; // s8
  float v165; // s12
  float v166; // s6
  float v167; // s10
  float v168; // s22
  float v169; // s0
  float v170; // s2
  float v171; // s4
  float v172; // s8
  float v173; // s6
  float v174; // s0
  float *v175; // r8
  float v176; // s2
  float v177; // s24
  unsigned int v178; // r0
  float v179; // s4
  float v180; // s0
  float v181; // s30
  float v182; // s26
  float v183; // s28
  float v184; // s18
  float v185; // r9
  float v186; // r5
  unsigned int v187; // r0
  float v188; // s26
  float v189; // s24
  RwReal v190; // s0
  RwReal v191; // s2
  RwReal v192; // r8
  RwReal v193; // s0
  RwReal v194; // s2
  float v195; // s22
  float v196; // s4
  float v197; // s2
  CPhysical::CPhysicalFlags v198; // r0
  float v199; // s14
  float v200; // s3
  float v201; // s8
  float v202; // s10
  float v203; // s4
  float v204; // s12
  float v205; // s2
  float v206; // s0
  float v207; // s2
  float v208; // s0
  CPhysical::CPhysicalFlags v209; // r0
  float v210; // s0
  float v211; // s1
  float v212; // s6
  float v213; // s8
  float v214; // s12
  float v215; // s2
  float v216; // s10
  float v217; // s0
  float vecOffset; // [sp+0h] [bp-E0h]
  float vecOffseta; // [sp+0h] [bp-E0h]
  CVector *pvNormal; // [sp+24h] [bp-BCh]
  char v222; // [sp+28h] [bp-B8h]
  float v223; // [sp+28h] [bp-B8h]
  int v224; // [sp+2Ch] [bp-B4h]
  float v225; // [sp+2Ch] [bp-B4h]
  float v226; // [sp+2Ch] [bp-B4h]
  RwReal v227; // [sp+30h] [bp-B0h]
  CEntity::CFlags *v228; // [sp+30h] [bp-B0h]
  CVector v230; // [sp+38h] [bp-A8h] BYREF
  CVector v1; // [sp+44h] [bp-9Ch] BYREF
  CVector v232; // [sp+50h] [bp-90h] BYREF
  CVector v233; // [sp+5Ch] [bp-84h] BYREF
  CVector v234; // [sp+68h] [bp-78h] BYREF
  CVector v235[9]; // [sp+74h] [bp-6Ch] BYREF
  CVector v236; // 0:r1.12
  CVector v237; // 0:r1.12
  CVector v238; // 0:r1.12
  CVector v239; // 0:r1.12
  CVector v240; // 0:r1.12
  CVector v241; // 0:r1.12
  CVector v242; // 0:r1.12
  CVector v243; // 0:r1.12
  CVector v244; // 0:r2.8,8:^0.4
  CVector v245; // 0:r2.8,8:^0.4

  m_nPhysicalFlags = pPhysical->m_nPhysicalFlags;
  v12 = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) == 0 || (*(_BYTE *)&v12 & 0x60) != 0 )
  {
    v15.n64_u32[0] = 2.0;
    v14 = 0;
    if ( !(*(_DWORD *)&v12 << 31) )
      v15.n64_u32[0] = 1.0;
  }
  else
  {
    v14 = 0;
    v15.n64_u32[0] = 10.0;
    if ( (CPhysical *)LODWORD(pPhysical[4].m_vecAverageMoveSpeed.y) == this )
      v14 = 1;
  }
  v224 = v14;
  if ( (*(_BYTE *)&v12 & 0x10) == 0 || (*(_BYTE *)&m_nPhysicalFlags & 0x60) != 0 )
  {
    v16 = 2.0;
    if ( !(*(_DWORD *)&m_nPhysicalFlags << 31) )
      v16 = 1.0;
    goto LABEL_22;
  }
  v16 = 10.0;
  if ( (*(_BYTE *)&this->m_info & 7) == 3 && CPed::IsPlayer((const CPed *)this) )
  {
    m_info = pPhysical->m_info;
    if ( (*(_BYTE *)&m_info & 7) == 2
      && ((*(_BYTE *)&m_info & 0xF0) == 32 || (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0) )
    {
      v6.n64_u32[0] = 0;
      v5.n64_f32[0] = pPhysical->m_fMass + -2000.0;
      v16 = 1.0 / (float)((float)(vmax_f32(v5, v6).n64_f32[0] * 0.0002) + 1.0);
    }
  }
  v18 = 0;
  if ( (*(_BYTE *)&this->m_info & 7) != 3 )
  {
LABEL_22:
    v222 = 0;
    goto LABEL_23;
  }
  if ( (CPhysical *)LODWORD(this[4].m_vecAverageMoveSpeed.y) == pPhysical )
    v18 = 1;
  v222 = v18;
LABEL_23:
  v19 = pPhysical->m_nPhysicalFlags;
  Multiply3x3(&v233, this->m_pMat, &this->m_vecCOM);
  Multiply3x3(&v232, pPhysical->m_pMat, &pPhysical->m_vecCOM);
  v20 = *(_BYTE *)&v19 & 0xC;
  v21 = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&v21 & 0x40) != 0 )
    memset(&v233, 0, sizeof(v233));
  if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 0x40) != 0 )
    memset(&v232, 0, sizeof(v232));
  v22 = v20 == 4;
  p_m_nFlags = &pPhysical->m_nFlags;
  if ( v20 != 4 )
    v22 = (*(_DWORD *)&pPhysical->m_nFlags & 0x40004) == 0;
  if ( v22 )
    goto LABEL_88;
  if ( (*(_BYTE *)&v21 & 0x10) != 0 )
    return CPhysical::ApplySoftCollision(this, pPhysical, colPoint, fImpulseMagnitudeA);
  m_pMat = this->m_pMat;
  tz = m_pMat->tz;
  z = colPoint->m_vecPosition.z;
  v244.x = colPoint->m_vecPosition.x - m_pMat->tx;
  v235[0].y = colPoint->m_vecPosition.y - m_pMat->ty;
  v244.y = v235[0].y;
  v235[0].x = v244.x;
  v235[0].z = z - tz;
  v244.z = z - tz;
  CPhysical::GetSpeed(&v234, this, v244);
  v27 = (float)((float)(v234.x * colPoint->m_vecNormal.x) + (float)(v234.y * colPoint->m_vecNormal.y))
      + (float)(v234.z * colPoint->m_vecNormal.z);
  if ( v27 >= 0.0 )
    goto LABEL_79;
  if ( (*(_BYTE *)&pPhysical->m_info & 7) != 4 )
  {
    if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) == 0 )
    {
      (*((void (__fastcall **)(CPhysical *, _DWORD))pPhysical->_vptr$CPlaceable + 5))(pPhysical, 0);
      CWorld::Players[CWorld::PlayerInFocus].HavocCaused += 2;
      v32 = rand();
      CStats::IncrementStat(0x7Du, (float)(v32 % 30 + 30));
LABEL_78:
      p_m_nFlags = &pPhysical->m_nFlags;
    }
LABEL_79:
    if ( (*(_DWORD *)p_m_nFlags & 0x40004) != 0 )
      return 0;
    if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) == 0 )
    {
      m_pMovingListNode = pPhysical->m_pMovingListNode;
      v55 = m_pMovingListNode == 0;
      if ( !m_pMovingListNode )
        v55 = (*(_DWORD *)p_m_nFlags & 0x40000) == 0;
      if ( v55 )
      {
        v56 = (CPtrNodeDoubleLink *)CPtrNodeDoubleLink::operator new(0xCu);
        v56->m_pVoid = pPhysical;
        pPhysical->m_pMovingListNode = v56;
        v56->m_pPrevious = 0;
        m_pHead = CWorld::ms_listMovingEntityPtrs.m_pHead;
        v56->m_pNext = CWorld::ms_listMovingEntityPtrs.m_pHead;
        if ( m_pHead )
          m_pHead[1].m_pVoid = v56;
        p_m_nFlags = &pPhysical->m_nFlags;
        CWorld::ms_listMovingEntityPtrs.m_pHead = v56;
      }
    }
LABEL_88:
    v58 = *(_DWORD *)&pPhysical->m_nPhysicalFlags & 0x10;
    if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x10) != 0 )
    {
      if ( v58 )
      {
        x = colPoint->m_vecNormal.x;
        y = colPoint->m_vecNormal.y;
        v146 = colPoint->m_vecNormal.z;
        m_fMass = pPhysical->m_fMass;
        v148 = this->m_fMass;
        v8.n64_f32[0] = (float)((float)(x * pPhysical->m_vecMoveSpeed.x) + (float)(y * pPhysical->m_vecMoveSpeed.y))
                      + (float)(v146 * pPhysical->m_vecMoveSpeed.z);
        v149 = (float)((float)(this->m_vecMoveSpeed.x * x) + (float)(this->m_vecMoveSpeed.y * y))
             + (float)(this->m_vecMoveSpeed.z * v146);
        if ( LODWORD(this[3].m_fMassMultiplier) == 11 )
        {
          v150 = 1;
          v151 = (float)((float)(v149 * (float)(v148 + v148)) + (float)(m_fMass * v8.n64_f32[0]))
               / (float)((float)(v148 + v148) + m_fMass);
        }
        else
        {
          v6.n64_u32[0] = 0;
          v150 = 0;
          LODWORD(v151) = vmin_f32(v8, v6).n64_u32[0];
        }
        if ( (float)(v149 - v151) < 0.0 )
        {
          v195 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v196 = v151 - (float)((float)(v149 - v151) * v195);
          if ( (*(_DWORD *)&this->m_nFlags & 0x1000) != 0 )
            v196 = v151;
          v197 = v148 * (float)(v196 - v149);
          *fImpulseMagnitudeA = v197;
          v198 = this->m_nPhysicalFlags;
          if ( (*(_BYTE *)&v198 & 0x64) == 0 )
          {
            v199 = colPoint->m_vecNormal.y * v197;
            v200 = 0.0;
            v201 = this->m_vecMoveSpeed.y;
            v202 = this->m_vecMoveSpeed.z;
            v203 = 1.0 / this->m_fMass;
            v204 = colPoint->m_vecNormal.x * v197;
            v205 = colPoint->m_vecNormal.z * v197;
            if ( (*(_BYTE *)&v198 & 0x80) == 0 )
              v200 = v205;
            this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v204 * v203);
            this->m_vecMoveSpeed.y = (float)(v199 * v203) + v201;
            this->m_vecMoveSpeed.z = (float)(v200 * v203) + v202;
            v197 = *fImpulseMagnitudeA;
          }
          CAudioEngine::ReportCollision(
            &AudioEngine,
            this,
            pPhysical,
            colPoint->m_dataA.m_nSurfaceType,
            colPoint->m_dataB.m_nSurfaceType,
            &colPoint->m_vecPosition,
            &colPoint->m_vecNormal,
            v197 / v148,
            1.0,
            0,
            0);
          if ( v150 == 1 && (float)(v8.n64_f32[0] - v151) < 0.0 )
          {
            v206 = v151 - (float)((float)(v8.n64_f32[0] - v151) * v195);
            if ( (*(_DWORD *)p_m_nFlags & 0x1000) != 0 )
              v206 = v151;
            v207 = v206 - v8.n64_f32[0];
            v208 = -(float)(m_fMass * (float)(v206 - v8.n64_f32[0]));
            *fImpulseMagnitudeB = v208;
            v209 = pPhysical->m_nPhysicalFlags;
            if ( (*(_BYTE *)&v209 & 0x64) == 0 )
            {
              v210 = m_fMass * v207;
              v211 = 0.0;
              v212 = pPhysical->m_vecMoveSpeed.y;
              v213 = pPhysical->m_vecMoveSpeed.z;
              v214 = colPoint->m_vecNormal.y * (float)(m_fMass * v207);
              v215 = 1.0 / pPhysical->m_fMass;
              v216 = colPoint->m_vecNormal.x * v210;
              v217 = colPoint->m_vecNormal.z * v210;
              if ( (*(_BYTE *)&v209 & 0x80) == 0 )
                v211 = v217;
              pPhysical->m_vecMoveSpeed.x = pPhysical->m_vecMoveSpeed.x + (float)(v216 * v215);
              pPhysical->m_vecMoveSpeed.y = (float)(v214 * v215) + v212;
              pPhysical->m_vecMoveSpeed.z = (float)(v211 * v215) + v213;
              v208 = *fImpulseMagnitudeB;
            }
            CAudioEngine::ReportCollision(
              &AudioEngine,
              pPhysical,
              this,
              colPoint->m_dataB.m_nSurfaceType,
              colPoint->m_dataA.m_nSurfaceType,
              &colPoint->m_vecPosition,
              &colPoint->m_vecNormal,
              v208 / m_fMass,
              1.0,
              0,
              0);
          }
          return 1;
        }
      }
      else
      {
        v228 = p_m_nFlags;
        v73 = pPhysical->m_pMat;
        v74 = colPoint->m_vecPosition.z - v73->tz;
        v245.x = colPoint->m_vecPosition.x - v73->tx;
        v234.y = colPoint->m_vecPosition.y - v73->ty;
        v245.y = v234.y;
        v234.x = v245.x;
        v234.z = v74;
        v245.z = v74;
        CPhysical::GetSpeed(&v1, pPhysical, v245);
        v75 = v1.x;
        v76 = v1.y;
        v225 = v1.z;
        if ( (*((_BYTE *)&pPhysical->m_nPhysicalFlags + 3) & 4) != 0 )
        {
          v77 = *(_BYTE *)&pPhysical->m_info & 7;
          v78 = v77 == 2;
          if ( v77 == 2 )
            v78 = colPoint->m_dataB.m_nSurfaceType == 65;
          if ( v78 )
          {
            (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))pPhysical->_vptr$CPlaceable + 50))(
              &v1,
              pPhysical,
              &v234);
            v76 = v1.y + v76;
            v75 = v1.x + v75;
            v225 = v1.z + v225;
          }
        }
        v79 = this->m_vecMoveSpeed.x;
        v80 = this->m_vecMoveSpeed.y;
        v81 = this->m_vecMoveSpeed.z;
        v82 = this->m_fMass;
        v83 = colPoint->m_vecNormal.x;
        v84 = colPoint->m_vecNormal.y;
        v85 = colPoint->m_vecNormal.z;
        v15.n64_u32[1] = LODWORD(pPhysical->m_fMass);
        v230.x = v234.x - v232.x;
        v230.y = v234.y - v232.y;
        v230.z = v234.z - v232.z;
        CrossProduct(&v1, &v230, &colPoint->m_vecNormal);
        v86 = v79 * v83;
        v87 = v80 * v84;
        v88 = v15.n64_f32[0] * v82;
        v89 = 1.0
            / (float)((float)(1.0 / (float)(v16 * v15.n64_f32[1]))
                    + (float)((float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
                            / (float)(v16 * pPhysical->m_fTurnMass)));
        v90 = (float)((float)(v83 * v75) + (float)(v84 * v76)) + (float)(v85 * v225);
        v91 = (float)(v86 + v87) + (float)(v81 * v85);
        v92 = v90;
        if ( v20 != 4 )
          v92 = (float)((float)(v88 * v91) + (float)(v90 * v89)) / (float)(v88 + v89);
        if ( (float)(v91 - v92) < 0.0 )
        {
          v93 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v94 = v92 - (float)((float)(v91 - v92) * v93);
          if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0 )
            v94 = v92;
          v95 = v94 - v91;
          if ( (*((_BYTE *)v228 + 1) & 0x10) == 0 )
            v92 = v92 - (float)((float)(v90 - v92) * v93);
          v96 = v92 - v90;
          *fImpulseMagnitudeA = v88 * v95;
          *fImpulseMagnitudeB = -(float)(v89 * v96);
          v97 = this->m_nPhysicalFlags;
          v98 = colPoint->m_vecNormal.x;
          v99 = colPoint->m_vecNormal.y;
          v100 = colPoint->m_vecNormal.z;
          if ( (*(_BYTE *)&v97 & 0x64) == 0 )
          {
            v101 = *fImpulseMagnitudeA / v15.n64_f32[0];
            v102 = 1.0 / this->m_fMass;
            v103 = v101 * v99;
            v15.n64_u32[0] = 0;
            v7.n64_f32[0] = v101 * v100;
            v104 = v98 * v101;
            v105 = this->m_vecMoveSpeed.y;
            v106 = this->m_vecMoveSpeed.z;
            v107 = vmax_f32(v7, v15).n64_u32[0];
            if ( ((unsigned __int8)v222 & (v20 != 4)) != 0 )
              v104 = v104 + v104;
            if ( ((unsigned __int8)v222 & (v20 != 4)) != 0 )
              v103 = v103 + v103;
            if ( (*(_BYTE *)&v97 & 0x80) == 0 )
              v15.n64_u32[0] = v107;
            this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v104 * v102);
            this->m_vecMoveSpeed.y = (float)(v103 * v102) + v105;
            this->m_vecMoveSpeed.z = (float)(v15.n64_f32[0] * v102) + v106;
          }
          if ( !((unsigned __int8)v222 & (v20 != 4) | ((unsigned __int8)(*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) >> 2)) )
          {
            v108 = (float)(v89 * v96) / v16;
            v238.z = v100 * v108;
            v238.y = v99 * v108;
            v238.x = v98 * v108;
            CPhysical::ApplyForce(pPhysical, v238, v234, 1);
          }
          p_m_vecNormal = &colPoint->m_vecNormal;
          CAudioEngine::ReportCollision(
            &AudioEngine,
            this,
            pPhysical,
            colPoint->m_dataA.m_nSurfaceType,
            colPoint->m_dataB.m_nSurfaceType,
            &colPoint->m_vecPosition,
            &colPoint->m_vecNormal,
            *fImpulseMagnitudeA / v88,
            1.0,
            0,
            0);
          goto LABEL_182;
        }
      }
    }
    else
    {
      v59 = this->m_pMat;
      v60 = colPoint->m_vecPosition.x;
      v61 = colPoint->m_vecPosition.y;
      v62 = colPoint->m_vecPosition.z;
      v63 = v62 - v59->tz;
      v64 = colPoint->m_vecPosition.x - v59->tx;
      v65 = v61 - v59->ty;
      v235[0].y = v65;
      v235[0].x = v64;
      v66 = v63;
      v235[0].z = v63;
      if ( v58 )
      {
        vecOffseta = v63;
        CPhysical::GetSpeed(&v234, this, *(CVector *)&v64);
        v110 = v234.x;
        v111 = v234.y;
        v112 = v234.z;
        if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 4) != 0 )
        {
          v113 = *(_BYTE *)&this->m_info & 7;
          v114 = v113 == 2;
          if ( v113 == 2 )
            v114 = colPoint->m_dataA.m_nSurfaceType == 65;
          if ( v114 )
          {
            (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))this->_vptr$CPlaceable + 50))(&v234, this, v235);
            v112 = v234.z + v112;
            v111 = v234.y + v111;
            v110 = v234.x + v110;
          }
        }
        v115 = pPhysical->m_vecMoveSpeed.x;
        v116 = pPhysical->m_vecMoveSpeed.y;
        v117 = pPhysical->m_vecMoveSpeed.z;
        v118 = colPoint->m_vecNormal.x;
        v119 = colPoint->m_vecNormal.y;
        v120 = colPoint->m_vecNormal.z;
        v15.n64_u32[1] = LODWORD(this->m_fMass);
        v1.x = v235[0].x - v233.x;
        v1.y = v235[0].y - v233.y;
        v1.z = v235[0].z - v233.z;
        CrossProduct(&v234, &v1, &colPoint->m_vecNormal);
        v121 = v119 * v116;
        v122 = 1.0
             / (float)((float)(1.0 / (float)(v15.n64_f32[0] * v15.n64_f32[1]))
                     + (float)((float)((float)((float)(v234.x * v234.x) + (float)(v234.y * v234.y))
                                     + (float)(v234.z * v234.z))
                             / (float)(v15.n64_f32[0] * this->m_fTurnMass)));
        v123 = (float)(v118 * v115) + v121;
        v89 = v16 * pPhysical->m_fMass;
        v124 = v123 + (float)(v120 * v117);
        v125 = (float)((float)(v118 * v110) + (float)(v119 * v111)) + (float)(v120 * v112);
        v126 = (float)((float)(v125 * v122) + (float)(v124 * v89)) / (float)(v122 + v89);
        if ( (float)(v125 - v126) < 0.0 )
        {
          v127 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v128 = v126 - (float)((float)(v125 - v126) * v127);
          if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0 )
            v128 = (float)((float)(v125 * v122) + (float)(v124 * v89)) / (float)(v122 + v89);
          v129 = v128 - v125;
          if ( (*((_BYTE *)p_m_nFlags + 1) & 0x10) == 0 )
            v126 = v126 - (float)((float)(v124 - v126) * v127);
          v130 = v126 - v124;
          *fImpulseMagnitudeA = v122 * v129;
          *fImpulseMagnitudeB = -(float)(v89 * (float)(v126 - v124));
          v131 = colPoint->m_vecNormal.x;
          v132 = colPoint->m_vecNormal.y;
          v133 = colPoint->m_vecNormal.z;
          if ( !(v224 | ((unsigned __int8)(*(_BYTE *)&this->m_nPhysicalFlags & 4) >> 2)) )
          {
            v134 = *fImpulseMagnitudeA / v15.n64_f32[0];
            v239.z = v134 * v133;
            if ( (float)(v134 * v133) < 0.0 )
              v239.z = 0.0;
            v239.x = v131 * v134;
            v239.y = v134 * v132;
            CPhysical::ApplyForce(this, v239, v235[0], 1);
          }
          v135 = pPhysical->m_nPhysicalFlags;
          if ( (*(_BYTE *)&v135 & 4) == 0 )
          {
            v136 = (float)(v89 * v130) / v16;
            v137 = v136 * v133;
            v138 = v136 * v132;
            v139 = v136 * v131;
            if ( v137 < 0.0 )
            {
              v137 = 0.0;
              if ( fabsf(v125) < 0.01 )
              {
                v138 = v138 * 0.5;
                v139 = v139 * 0.5;
              }
            }
            if ( (*(_BYTE *)&v135 & 0x60) == 0 )
            {
              v140 = 1.0 / pPhysical->m_fMass;
              v141 = pPhysical->m_vecMoveSpeed.y;
              v142 = pPhysical->m_vecMoveSpeed.z;
              if ( v224 )
              {
                v139 = v139 + v139;
                v138 = v138 + v138;
              }
              v143 = 0.0;
              if ( (*(_BYTE *)&v135 & 0x80) == 0 )
                v143 = v137;
              pPhysical->m_vecMoveSpeed.x = pPhysical->m_vecMoveSpeed.x + (float)(v139 * v140);
              pPhysical->m_vecMoveSpeed.y = (float)(v138 * v140) + v141;
              pPhysical->m_vecMoveSpeed.z = (float)(v143 * v140) + v142;
            }
          }
          p_m_vecNormal = &colPoint->m_vecNormal;
          CAudioEngine::ReportCollision(
            &AudioEngine,
            this,
            pPhysical,
            colPoint->m_dataA.m_nSurfaceType,
            colPoint->m_dataB.m_nSurfaceType,
            &colPoint->m_vecPosition,
            &colPoint->m_vecNormal,
            *fImpulseMagnitudeA / v122,
            1.0,
            0,
            0);
          goto LABEL_182;
        }
      }
      else
      {
        v227 = *(float *)&p_m_nFlags;
        v67 = pPhysical->m_pMat;
        v68 = v67->tz;
        v69 = v60 - v67->tx;
        vecOffset = v66;
        v234.y = v61 - v67->ty;
        v234.x = v69;
        v234.z = v62 - v68;
        CPhysical::GetSpeed(&v1, this, *(CVector *)&v64);
        v71 = v1.x;
        v70 = v1.y;
        v72 = v1.z;
        if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 4) != 0
          && (*(_BYTE *)&this->m_info & 7) == 2
          && colPoint->m_dataA.m_nSurfaceType == 65 )
        {
          (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))this->_vptr$CPlaceable + 50))(&v1, this, v235);
          v70 = v1.y + v70;
          v71 = v1.x + v71;
          v223 = v1.z + v72;
        }
        else
        {
          v223 = v1.z;
        }
        CPhysical::GetSpeed(&v1, pPhysical, v234);
        v152 = v1.x;
        v153 = v1.y;
        v226 = v1.z;
        if ( (*((_BYTE *)&pPhysical->m_nPhysicalFlags + 3) & 4) != 0 )
        {
          v154 = *(_BYTE *)&pPhysical->m_info & 7;
          v155 = v154 == 2;
          if ( v154 == 2 )
            v155 = colPoint->m_dataB.m_nSurfaceType == 65;
          if ( v155 )
          {
            (*((void (__fastcall **)(CVector *, CPhysical *, CVector *))pPhysical->_vptr$CPlaceable + 50))(
              &v1,
              pPhysical,
              &v234);
            v153 = v1.y + v153;
            v152 = v1.x + v152;
            v226 = v1.z + v226;
          }
        }
        v156 = colPoint->m_vecNormal.x;
        v157 = colPoint->m_vecNormal.y;
        v158 = colPoint->m_vecNormal.z;
        v159 = this->m_fMass;
        v230.x = v235[0].x - v233.x;
        v230.y = v235[0].y - v233.y;
        v230.z = v235[0].z - v233.z;
        CrossProduct(&v1, &v230, &colPoint->m_vecNormal);
        v160 = v1.x;
        v161 = v1.y;
        v162 = v1.z;
        v15.n64_u32[1] = LODWORD(this->m_fTurnMass);
        v163 = pPhysical->m_fMass;
        v230.x = v234.x - v232.x;
        v230.y = v234.y - v232.y;
        v230.z = v234.z - v232.z;
        CrossProduct(&v1, &v230, &colPoint->m_vecNormal);
        v164 = v157 * v70;
        v165 = v157 * v153;
        v166 = v156 * v152;
        v167 = v156 * v71;
        v168 = 1.0
             / (float)((float)(1.0 / (float)(v15.n64_f32[0] * v159))
                     + (float)((float)((float)((float)(v160 * v160) + (float)(v161 * v161)) + (float)(v162 * v162))
                             / (float)(v15.n64_f32[0] * v15.n64_f32[1])));
        v89 = 1.0
            / (float)((float)(1.0 / (float)(v16 * v163))
                    + (float)((float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
                            / (float)(v16 * pPhysical->m_fTurnMass)));
        v169 = (float)(v167 + v164) + (float)(v158 * v223);
        v170 = (float)(v166 + v165) + (float)(v158 * v226);
        v171 = (float)((float)(v169 * v168) + (float)(v170 * v89)) / (float)(v168 + v89);
        if ( (float)(v169 - v171) < 0.0 )
        {
          v172 = (float)(this->m_fElasticity + pPhysical->m_fElasticity) * 0.5;
          v173 = v171 - (float)((float)(v169 - v171) * v172);
          if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) != 0 )
            v173 = (float)((float)(v169 * v168) + (float)(v170 * v89)) / (float)(v168 + v89);
          v240.z = v227;
          v174 = v173 - v169;
          if ( (*(_BYTE *)(LODWORD(v227) + 1) & 0x10) == 0 )
            v171 = v171 - (float)((float)(v170 - v171) * v172);
          v175 = fImpulseMagnitudeA;
          v176 = v171 - v170;
          *fImpulseMagnitudeA = v168 * v174;
          *fImpulseMagnitudeB = -(float)(v89 * v176);
          v177 = (float)(v89 * v176) / v16;
          v178 = (unsigned __int8)this->m_info;
          v179 = *fImpulseMagnitudeA / v15.n64_f32[0];
          v180 = colPoint->m_vecNormal.z;
          v181 = colPoint->m_vecNormal.x;
          v182 = colPoint->m_vecNormal.y;
          v183 = v177 * v180;
          v184 = v179 * v182;
          v185 = v179 * v180;
          if ( (v178 & 7) == 2 && (*((_BYTE *)&this->m_nFlags + 1) & 0x10) == 0 )
          {
            if ( v180 < 0.7 )
              v185 = (float)(v179 * v180) * 0.3;
            if ( v178 <= 7 )
            {
              v235[0].x = v235[0].x * 0.8;
              v235[0].y = v235[0].y * 0.8;
              v235[0].z = v235[0].z * 0.8;
            }
            if ( CWorld::bNoMoreCollisionTorque )
            {
              v241.x = (float)(v181 * v179) * -0.3;
              v241.y = v184 * -0.3;
              v241.z = v185 * -0.3;
              CPhysical::ApplyFrictionForce(this, v241, v235[0]);
              v240.z = v227;
            }
          }
          v186 = v177 * v180;
          v187 = (unsigned __int8)pPhysical->m_info;
          v188 = v177 * v182;
          v189 = v177 * v181;
          if ( (v187 & 7) == 2 && (*(_BYTE *)(LODWORD(v240.z) + 1) & 0x10) == 0 )
          {
            if ( colPoint->m_vecNormal.z > -0.7 )
              v186 = v183 * 0.3;
            if ( v187 <= 7 )
            {
              v234.x = v234.x * 0.8;
              v234.y = v234.y * 0.8;
              v234.z = v234.z * 0.8;
            }
            if ( CWorld::bNoMoreCollisionTorque )
            {
              v242.x = v189 * -0.3;
              v242.y = v188 * -0.3;
              v242.z = v186 * -0.3;
              CPhysical::ApplyFrictionForce(pPhysical, v242, v234);
              v240.z = v227;
            }
          }
          if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
          {
            *(_QWORD *)&v243.y = __PAIR64__(LODWORD(v185), LODWORD(v184));
            v243.x = v181 * v179;
            CPhysical::ApplyForce(this, v243, v235[0], 1);
            v240.z = v227;
          }
          if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) == 0 )
          {
            v240.y = v188;
            if ( (*(_BYTE *)LODWORD(v240.z) & 0x20) != 0 )
            {
              v190 = -pPhysical->m_vecTurnSpeed.y;
              v191 = -pPhysical->m_vecTurnSpeed.z;
              v192 = v240.z;
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              pPhysical->m_vecTurnSpeed.y = v190;
              pPhysical->m_vecTurnSpeed.z = v191;
              CPhysical::ApplySpeed(pPhysical);
              v240.y = v188;
              v193 = -pPhysical->m_vecTurnSpeed.y;
              v194 = -pPhysical->m_vecTurnSpeed.z;
              *(float32x4_t *)&pPhysical->m_vecMoveSpeed.x = vnegq_f32(*(float32x4_t *)&pPhysical->m_vecMoveSpeed.x);
              pPhysical->m_vecTurnSpeed.y = v193;
              pPhysical->m_vecTurnSpeed.z = v194;
              *(_DWORD *)LODWORD(v192) &= ~0x20u;
              v175 = fImpulseMagnitudeA;
            }
            v240.x = v189;
            v240.z = v186;
            CPhysical::ApplyForce(pPhysical, v240, v234, 1);
          }
          p_m_vecNormal = &colPoint->m_vecNormal;
          CAudioEngine::ReportCollision(
            &AudioEngine,
            this,
            pPhysical,
            colPoint->m_dataA.m_nSurfaceType,
            colPoint->m_dataB.m_nSurfaceType,
            &colPoint->m_vecPosition,
            &colPoint->m_vecNormal,
            *v175 / v168,
            1.0,
            0,
            0);
LABEL_182:
          CAudioEngine::ReportCollision(
            &AudioEngine,
            pPhysical,
            this,
            colPoint->m_dataB.m_nSurfaceType,
            colPoint->m_dataA.m_nSurfaceType,
            &colPoint->m_vecPosition,
            p_m_vecNormal,
            *fImpulseMagnitudeB / v89,
            1.0,
            0,
            0);
          return 1;
        }
      }
    }
    return 0;
  }
  v28 = this->m_fMass;
  v1.x = v235[0].x - v233.x;
  v1.y = v235[0].y - v233.y;
  v1.z = v235[0].z - v233.z;
  CrossProduct(&v234, &v1, &colPoint->m_vecNormal);
  v29 = 1.0
      / (float)((float)(1.0 / v28)
              + (float)((float)((float)((float)(v234.x * v234.x) + (float)(v234.y * v234.y)) + (float)(v234.z * v234.z))
                      / this->m_fTurnMass));
  if ( (*((_BYTE *)&this->m_nFlags + 1) & 0x10) == 0 )
    v27 = v27 * (float)(this->m_fElasticity + 1.0);
  v30 = -(float)(v29 * v27);
  *fImpulseMagnitudeA = v30;
  *fImpulseMagnitudeB = v30;
  if ( !LOBYTE(pPhysical[1].m_transform.m_translate.z)
    || *fImpulseMagnitudeA <= 20.0
    || (CObject::ObjectDamage(
          (CObject *)pPhysical,
          *fImpulseMagnitudeA,
          &colPoint->m_vecPosition,
          &colPoint->m_vecNormal,
          (int)this,
          WEAPONTYPE_UNIDENTIFIED),
        *(_BYTE *)p_m_nFlags << 31) )
  {
    if ( *fImpulseMagnitudeA <= *(float *)&pPhysical[1].pReferences[2].ppReferenceAddress
      && (*(_BYTE *)&this->m_nFlags & 0x10) == 0
      || (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0 )
    {
      if ( (*(_BYTE *)&pPhysical->m_info & 7) == 4 )
      {
        v35 = CModelInfo::ms_modelInfoPtrs[pPhysical->m_nModelIndex];
        v36 = (*((int (__fastcall **)(CBaseModelInfo *))v35->_vptr$CBaseModelInfo + 2))(v35);
        if ( v36 )
        {
          if ( (*(_WORD *)(v36 + 40) & 0x7000 | 0x800) == 10240 )
            CGlass::WindowRespondsToSoftCollision(pPhysical, *fImpulseMagnitudeA);
        }
      }
      v37 = *fImpulseMagnitudeA;
      if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
      {
        v38 = colPoint->m_vecNormal.z;
        v39 = 0;
        v40 = v37 * v38;
        v41 = *(_BYTE *)&this->m_info & 7;
        v42 = v37 * colPoint->m_vecNormal.x;
        v43 = v37 * colPoint->m_vecNormal.y;
        v44 = v40;
        if ( v41 == 2 )
          v44 = v40 * 0.3;
        if ( v38 < 0.7 )
          v40 = v44;
        v45 = v41 != 2;
        if ( !CWorld::bNoMoreCollisionTorque )
          v39 = 1;
        bValidTorque = v39 | v45;
        v237.x = v42;
        *(_QWORD *)&v237.y = __PAIR64__(LODWORD(v40), LODWORD(v43));
        CPhysical::ApplyForce(this, v237, v235[0], bValidTorque);
        v37 = *fImpulseMagnitudeA;
      }
      CAudioEngine::ReportCollision(
        &AudioEngine,
        this,
        pPhysical,
        colPoint->m_dataA.m_nSurfaceType,
        colPoint->m_dataB.m_nSurfaceType,
        &colPoint->m_vecPosition,
        &colPoint->m_vecNormal,
        v37 / v29,
        1.0,
        0,
        0);
      return 1;
    }
    if ( (*(_BYTE *)&pPhysical->m_info & 7) == 4
      && (v33 = CModelInfo::ms_modelInfoPtrs[pPhysical->m_nModelIndex],
          (v34 = (*((int (__fastcall **)(CBaseModelInfo *))v33->_vptr$CBaseModelInfo + 2))(v33)) != 0)
      && (*(_WORD *)(v34 + 40) & 0x7000 | 0x800) == 10240 )
    {
      CGlass::WindowRespondsToCollision(
        pPhysical,
        *fImpulseMagnitudeA,
        this->m_vecMoveSpeed,
        colPoint->m_vecPosition,
        0);
    }
    else if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) == 0 )
    {
      (*((void (__fastcall **)(CPhysical *, _DWORD))pPhysical->_vptr$CPlaceable + 5))(pPhysical, 0);
    }
    m_nModelIndex = pPhysical->m_nModelIndex;
    if ( m_nModelIndex != MI_FIRE_HYDRANT || (LOBYTE(pPhysical[1].m_transform.m_translate.y) & 0x40) != 0 )
    {
      if ( m_nModelIndex != MI_PARKINGMETER && m_nModelIndex != MI_PARKINGMETER2
        || (LOBYTE(pPhysical[1].m_transform.m_translate.y) & 0x40) != 0 )
      {
        if ( (*(_BYTE *)&pPhysical->m_info & 7) == 4
          && !(*((int (__fastcall **)(CBaseModelInfo *))CModelInfo::ms_modelInfoPtrs[m_nModelIndex]->_vptr$CBaseModelInfo
               + 2))(CModelInfo::ms_modelInfoPtrs[m_nModelIndex]) )
        {
          LODWORD(pPhysical[1].m_transform.m_translate.y) |= 0x40u;
        }
        goto LABEL_79;
      }
      v50 = pPhysical->m_pMat;
      p_tx = (CSimpleTransform *)&v50->tx;
      if ( !v50 )
        p_tx = &pPhysical->m_transform;
      v52 = *(_QWORD *)&p_tx->m_translate.x;
      pvNormal = (CVector *)LODWORD(p_tx->m_translate.z);
      v53 = rand();
      CPickups::CreateSomeMoney(*(float *)&v52, *((float *)&v52 + 1), *(float *)&pvNormal, v53 % 100);
    }
    else
    {
      v48 = pPhysical->m_pMat;
      p_m_transform = (CSimpleTransform *)&v48->tx;
      if ( !v48 )
        p_m_transform = &pPhysical->m_transform;
      Fx_c::TriggerWaterHydrant(&g_fx, &p_m_transform->m_translate);
    }
    LODWORD(pPhysical[1].m_transform.m_translate.y) |= 0x40u;
    goto LABEL_78;
  }
  if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
  {
    v236.x = (float)(colPoint->m_vecNormal.x * 0.2) * *fImpulseMagnitudeA;
    v236.y = (float)(colPoint->m_vecNormal.y * 0.2) * *fImpulseMagnitudeA;
    v236.z = (float)(colPoint->m_vecNormal.z * 0.2) * *fImpulseMagnitudeA;
    CPhysical::ApplyForce(this, v236, v235[0], 1);
  }
  v31 = 0;
  CAudioEngine::ReportCollision(
    &AudioEngine,
    this,
    pPhysical,
    colPoint->m_dataA.m_nSurfaceType,
    colPoint->m_dataB.m_nSurfaceType,
    &colPoint->m_vecPosition,
    &colPoint->m_vecNormal,
    (float)(*fImpulseMagnitudeA * 0.2) / v29,
    1.0,
    0,
    0);
  return v31;
}
// 404498: fragmented variable at r2.4 may be wrong
// 404498: fragmented variable at r3.4 may be wrong

//----- (00405A10) --------------------------------------------------------
int __fastcall CPhysical::ApplySpringCollision(
        CPhysical *this,
        float fSpringStrength,
        CVector *vecDirection,
        CVector *vecOffset,
        float fCompressionRatio,
        float fSuspensionBias,
        float *fImpulseMagnitude)
{
  float32x2_t v7; // d2
  float32x2_t v8; // d3
  float v9; // s0
  CVector v11; // [sp+0h] [bp-18h]
  CVector v12; // 0:r1.12

  if ( (float)(1.0 - fCompressionRatio) > 0.0 )
  {
    v8.n64_f32[0] = CTimer::ms_fTimeStep;
    v7.n64_u32[0] = 3.0;
    v9 = (float)(vmin_f32(v8, v7).n64_f32[0]
               * (float)((float)(1.0 - fCompressionRatio)
                       * (float)((float)((float)(this->m_fMass * 0.008) + (float)(this->m_fMass * 0.008))
                               * fSpringStrength)))
       * fSuspensionBias;
    *fImpulseMagnitude = v9;
    v11 = *vecOffset;
    v12.x = -(float)(v9 * vecDirection->x);
    *(_QWORD *)&v12.y = __PAIR64__(-(float)(v9 * vecDirection->z), -(float)(v9 * vecDirection->y));
    CPhysical::ApplyForce(this, v12, v11, 1);
  }
  return 1;
}
// 405A60: variable 'v8' is possibly undefined
// 405A60: variable 'v7' is possibly undefined

//----- (00405AB4) --------------------------------------------------------
int __fastcall CPhysical::ApplySpringCollisionAlt(
        CPhysical *this,
        float fSpringStrength,
        CVector *vecDirection,
        CVector *vecOffset,
        float fCompressionRatio,
        float fSuspensionBias,
        CVector *vecColNormal,
        float *fImpulseMagnitude)
{
  float32x2_t v8; // d2
  float32x2_t v9; // d3
  float y; // s10
  float z; // s8
  float v12; // s0
  CVector v14; // [sp+0h] [bp-18h]
  CVector v15; // 0:r1.12

  if ( (float)(1.0 - fCompressionRatio) > 0.0 )
  {
    y = vecColNormal->y;
    z = vecColNormal->z;
    if ( (float)((float)((float)(vecDirection->x * vecColNormal->x) + (float)(vecDirection->y * y))
               + (float)(vecDirection->z * z)) > 0.0 )
    {
      vecColNormal->x = -vecColNormal->x;
      vecColNormal->y = -y;
      vecColNormal->z = -z;
    }
    v9.n64_f32[0] = CTimer::ms_fTimeStep;
    v8.n64_u32[0] = 3.0;
    v12 = (float)(vmin_f32(v9, v8).n64_f32[0]
                * (float)((float)(1.0 - fCompressionRatio)
                        * (float)((float)((float)(this->m_fMass * 0.008) + (float)(this->m_fMass * 0.008))
                                * fSpringStrength)))
        * fSuspensionBias;
    *fImpulseMagnitude = v12;
    if ( *(_BYTE *)&this->m_nPhysicalFlags << 31 )
    {
      v12 = v12 * 0.75;
      *fImpulseMagnitude = v12;
    }
    v14 = *vecOffset;
    v15.x = v12 * vecColNormal->x;
    v15.y = v12 * vecColNormal->y;
    v15.z = v12 * vecColNormal->z;
    CPhysical::ApplyForce(this, v15, v14, 1);
  }
  return 1;
}
// 405B52: variable 'v9' is possibly undefined
// 405B52: variable 'v8' is possibly undefined

//----- (00405BBC) --------------------------------------------------------
int __fastcall CPhysical::ApplySpringDampening(
        CPhysical *this,
        float fDampeningScalar,
        float fSpringForce,
        CVector *vecDirection,
        CVector *vecSpeed,
        float *a6)
{
  float32x2_t v6; // d1
  float32x2_t v7; // d3
  float32x2_t v8; // d14
  float x; // s16
  float y; // s18
  float z; // s20
  float v16; // s22
  float v17; // s24
  float v18; // s26
  float v19; // s6
  float v20; // s2
  float v21; // s0
  float v22; // s4
  float v23; // s2
  float v24; // s18
  float m_fMass; // s20
  RwReal v26; // s4
  float32x2_t v27; // d0
  CVector v1; // [sp+14h] [bp-74h] BYREF
  CVector v30; // [sp+20h] [bp-68h] BYREF
  CVector v31; // [sp+2Ch] [bp-5Ch] BYREF
  CVector v32; // 0:r1.12

  x = vecDirection->x;
  y = vecDirection->y;
  z = vecDirection->z;
  v16 = *a6;
  v17 = a6[1];
  v18 = a6[2];
  CPhysical::GetSpeed(&v31, this, *vecSpeed);
  v7.n64_u32[0] = 3.0;
  v8.n64_f32[0] = CTimer::ms_fTimeStep;
  v19 = vmin_f32(v8, v7).n64_f32[0] * fDampeningScalar;
  v20 = v19 + v19;
  if ( !(*(_BYTE *)&this->m_nPhysicalFlags << 31) )
    v20 = v19;
  v21 = (float)((float)(v31.x * vecDirection->x) + (float)(v31.y * vecDirection->y)) + (float)(v31.z * vecDirection->z);
  if ( v20 <= DAMPING_LIMIT_IN_FRAME )
  {
    if ( v20 < (float)-DAMPING_LIMIT_IN_FRAME )
      v20 = -DAMPING_LIMIT_IN_FRAME;
  }
  else
  {
    v20 = DAMPING_LIMIT_IN_FRAME;
  }
  v22 = (float)((float)((float)(v16 * x) + (float)(v17 * y)) + (float)(v18 * z)) * v20;
  v23 = v21 - v22;
  if ( v22 < -0.0 && v23 > 0.0 )
  {
    if ( v21 < 0.0 )
    {
LABEL_10:
      v24 = -v21;
      goto LABEL_15;
    }
LABEL_14:
    v24 = 0.0;
    goto LABEL_15;
  }
  v24 = -v22;
  if ( v22 > -0.0 && v23 < 0.0 )
  {
    if ( v21 > 0.0 )
      goto LABEL_10;
    goto LABEL_14;
  }
LABEL_15:
  Multiply3x3(&v31, this->m_pMat, &this->m_vecCOM);
  v6.n64_f32[0] = vecSpeed->y - v31.y;
  m_fMass = this->m_fMass;
  v26 = vecSpeed->z - v31.z;
  v1.x = vecSpeed->x - v31.x;
  LODWORD(v1.y) = v6.n64_u32[0];
  v1.z = v26;
  CrossProduct(&v30, &v1, vecDirection);
  v27.n64_f32[0] = v24
                 * (float)(1.0
                         / (float)((float)(1.0 / m_fMass)
                                 + (float)((float)((float)((float)(v30.x * v30.x) + (float)(v30.y * v30.y))
                                                 + (float)(v30.z * v30.z))
                                         / this->m_fTurnMass)));
  v6.n64_f32[0] = fabsf(fSpringForce) * DAMPING_LIMIT_OF_SPRING_FORCE;
  v27.n64_f32[1] = v16 * x;
  v27.n64_f32[0] = vmin_f32(v27, v6).n64_f32[0];
  v32.x = vecDirection->x * v27.n64_f32[0];
  v32.y = vecDirection->y * v27.n64_f32[0];
  v32.z = vecDirection->z * v27.n64_f32[0];
  CPhysical::ApplyForce(this, v32, *vecSpeed, 1);
  return 1;
}
// 405C3A: variable 'v8' is possibly undefined
// 405C3A: variable 'v7' is possibly undefined
// 405DAA: variable 'v6' is possibly undefined

//----- (00405DEC) --------------------------------------------------------
bool __fastcall CPhysical::ApplySpringDampeningOld(
        CPhysical *this,
        float fDampeningScalar,
        float fSpringForce,
        CVector *vecDirection,
        CVector *vecOffset,
        CVector *vecSpeed)
{
  float32x2_t v6; // d8
  float32x2_t v7; // d9
  float x; // s22
  float z; // s20
  float y; // s24
  float v14; // s26
  float v15; // s14
  float v16; // s2
  float v17; // s4
  float v18; // s12
  float m_fMass; // s1
  float v20; // s10
  float v21; // s8
  float v22; // s10
  float v23; // s6
  float32x2_t v24; // d8
  float v25; // s7
  float v26; // s5
  float v27; // s6
  float v28; // s8
  float v29; // s10
  CVector v31; // [sp+14h] [bp-4Ch] BYREF
  CVector v32; // 0:r1.12

  x = vecSpeed->x;
  v6.n64_u32[0] = LODWORD(vecDirection->x);
  v7.n64_u32[0] = LODWORD(vecDirection->y);
  z = vecDirection->z;
  y = vecSpeed->y;
  v14 = vecSpeed->z;
  CPhysical::GetSpeed(&v31, this, *vecOffset);
  v15 = x * v6.n64_f32[0];
  v16 = vecDirection->y;
  v17 = vecDirection->z;
  v6.n64_u32[0] = 3.0;
  v18 = v15 + (float)(y * v7.n64_f32[0]);
  v7.n64_f32[0] = CTimer::ms_fTimeStep;
  m_fMass = this->m_fMass;
  v24.n64_u64[0] = vmin_f32(v7, v6).n64_u64[0];
  v20 = (float)((float)(v31.x * vecDirection->x) + (float)(v31.y * v16)) + (float)(v31.z * v17);
  v21 = (float)(v18 + (float)(v14 * z)) + v20;
  v22 = v20 * m_fMass;
  v23 = v24.n64_f32[0] * (float)(m_fMass * (float)((float)(v21 * 0.5) * fDampeningScalar));
  v24.n64_u32[0] = 1.0;
  v25 = v23 * -0.53;
  v27 = v25 + v25;
  if ( !(*(_BYTE *)&this->m_nPhysicalFlags << 31) )
    v27 = v25;
  v28 = fabsf(v27 / v22);
  v26 = (float)((float)((float)(vecOffset->x * vecOffset->x) + (float)(vecOffset->y * vecOffset->y))
              + (float)(vecOffset->z * vecOffset->z))
      + 1.0;
  v7.n64_f32[0] = this->m_fTurnMass / (float)(m_fMass * (float)(v26 + v26));
  v29 = vmin_f32(v7, v24).n64_f32[0];
  if ( v28 > v29 )
    v27 = (float)(v27 * v29) / v28;
  v32.x = v27 * vecDirection->x;
  v32.y = v27 * v16;
  v32.z = v27 * v17;
  CPhysical::ApplyForce(this, v32, *vecOffset, 1);
  return 1;
}
// 405E8E: variable 'v7' is possibly undefined
// 405E8E: variable 'v6' is possibly undefined

//----- (00405F5C) --------------------------------------------------------
bool __fastcall CPhysical::ApplyFriction(
        CPhysical *this,
        CPhysical *pPhysical,
        float fAdhesiveLimit,
        CColPoint *colPoint)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d2
  float32x2_t v6; // d7
  float32x2_t v7; // d8
  float32x2_t v8; // d9
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CPhysical::CPhysicalFlags v12; // r1
  CMatrix *m_pMat; // r0
  float x; // s18
  float y; // s22
  RwReal v17; // s31
  float tz; // s4
  RwReal v19; // s16
  float z; // s24
  CMatrix *v21; // r0
  RwReal v22; // s20
  float tx; // s26
  float v24; // r11
  float ty; // s28
  float v26; // s30
  float v27; // r10
  float v28; // s19
  float v29; // s23
  float v30; // s21
  float v31; // r9
  float v32; // r8
  float v33; // s28
  float v34; // s30
  float v35; // s26
  float v36; // s27
  float v37; // s29
  float v38; // s25
  float v39; // s24
  float v40; // s2
  float v41; // s0
  float v42; // s4
  float v43; // s22
  float v44; // s16
  float v45; // s31
  float v46; // s18
  float m_fTurnMass; // s20
  float v48; // s17
  float v49; // s2
  float32x2_t v50; // d9
  float32x2_t v51; // d0
  float v52; // s2
  float v53; // s16
  float v54; // s26
  float v55; // s28
  float v56; // s24
  float v57; // s30
  float v58; // s17
  float v59; // r0
  float v60; // s0
  RwReal v61; // s2
  RwReal v62; // s4
  float v63; // s0
  CMatrix *v64; // r0
  RwReal v65; // s30
  float v66; // s18
  float v67; // s26
  float v68; // s0
  float v69; // s28
  float v70; // s2
  float v71; // s16
  float v72; // s4
  float v73; // s19
  float v74; // s21
  float v75; // s23
  float v76; // s6
  float v77; // s2
  float v78; // s0
  float v79; // s4
  float v80; // s22
  float v81; // s24
  float v82; // s25
  float v83; // s0
  float v84; // s4
  float v85; // s2
  float v86; // s6
  float v87; // s4
  float v88; // s8
  float v89; // s10
  float v90; // s12
  CPhysical::CPhysicalFlags v91; // r0
  float32x2_t v92; // d8
  float v93; // s7
  float v94; // s11
  float v95; // s5
  float v96; // s14
  float v97; // s9
  float v98; // s13
  float v99; // s14
  float32x2_t v100; // d1
  float v101; // s0
  RwReal v102; // s6
  CMatrix *v103; // r0
  RwReal v104; // s28
  float v105; // s20
  float v106; // r9
  float v107; // r8
  float v108; // s16
  float v109; // s26
  float v110; // s24
  float v111; // s17
  float v112; // s19
  float v113; // s21
  float v114; // s6
  float v115; // s2
  float v116; // s0
  float v117; // s4
  float v118; // s22
  float v119; // s23
  float v120; // s0
  float v121; // s8
  float v122; // s10
  float v123; // s0
  float v124; // s24
  float v125; // s16
  float v126; // s28
  float v127; // s26
  float v128; // s30
  float v129; // s17
  float v130; // s19
  float32x2_t v131; // d1
  CPhysical::CPhysicalFlags v132; // r0
  float32x2_t v133; // d1
  float v134; // s12
  float v135; // s14
  float v136; // s0
  float v137; // s2
  float v138; // s4
  float v139; // s0
  float v140; // s2
  float v141; // s0
  float v142; // s4
  float v143; // s4
  float v144; // s10
  float v145; // s5
  float v146; // s6
  float v147; // s12
  float v148; // s7
  float v149; // s8
  float v150; // s14
  float v151; // s9
  float v152; // s0
  float v153; // s2
  float v154; // s1
  float v155; // s3
  float v156; // s11
  float v157; // s15
  float v158; // s16
  float v159; // s4
  float v160; // s10
  float v161; // s1
  float v162; // s12
  float v163; // s4
  float v164; // s3
  float v165; // s8
  float v166; // s14
  float v167; // s12
  float v168; // s10
  float v169; // s2
  float v170; // s3
  float v171; // s16
  float v172; // s1
  float v173; // s5
  float v174; // s2
  RwReal v175; // s3
  RwReal v176; // s2
  float v177; // s0
  float v178; // s2
  float v179; // s4
  float v180; // s6
  float v181; // s0
  float v182; // s14
  CVector vecOffset; // [sp+0h] [bp-D8h]
  CVector vecOffseta; // [sp+0h] [bp-D8h]
  CVector vecOffsetb; // [sp+0h] [bp-D8h]
  RwReal v187; // [sp+10h] [bp-C8h]
  float m_fMass; // [sp+14h] [bp-C4h]
  unsigned __int64 v189; // [sp+18h] [bp-C0h]
  unsigned __int64 v190; // [sp+18h] [bp-C0h]
  unsigned __int64 v191; // [sp+18h] [bp-C0h]
  CVector v192; // [sp+24h] [bp-B4h] BYREF
  CVector v1; // [sp+30h] [bp-A8h] BYREF
  CVector v194; // [sp+3Ch] [bp-9Ch] BYREF
  CVector v195; // [sp+48h] [bp-90h] BYREF
  CVector v2; // [sp+54h] [bp-84h] BYREF
  CVector v197; // [sp+60h] [bp-78h] BYREF
  CVector v198; // [sp+6Ch] [bp-6Ch] BYREF
  CVector v199; // 0:r1.12
  CVector v200; // 0:r1.12
  CVector v201; // 0:r1.12
  CVector cvector; // 0:r2.8,8:^0.4
  CVector cvectora; // 0:r2.8,8:^0.4
  CVector cvectorc; // 0:r2.8,8:^0.4
  CVector cvectord; // 0:r2.8,8:^0.4

  m_nPhysicalFlags = pPhysical->m_nPhysicalFlags;
  v8.n64_f32[0] = fAdhesiveLimit;
  v12 = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&v12 & 0x10) == 0 )
  {
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) == 0 )
    {
      m_pMat = this->m_pMat;
      v189 = v8.n64_u64[0];
      x = colPoint->m_vecPosition.x;
      y = colPoint->m_vecPosition.y;
      v17 = colPoint->m_vecPosition.x - m_pMat->tx;
      tz = m_pMat->tz;
      v19 = y - m_pMat->ty;
      z = colPoint->m_vecPosition.z;
      v21 = pPhysical->m_pMat;
      v22 = z - tz;
      tx = v21->tx;
      v24 = v17;
      ty = v21->ty;
      v26 = v21->tz;
      v27 = v19;
      cvector.z = z - tz;
      cvector.x = v17;
      cvector.y = v19;
      CPhysical::GetSpeed(&v198, this, cvector);
      v28 = x - tx;
      v29 = y - ty;
      v30 = z - v26;
      v31 = x - tx;
      v32 = y - ty;
      cvectora.z = z - v26;
      cvectora.x = x - tx;
      cvectora.y = y - ty;
      CPhysical::GetSpeed(&v197, pPhysical, cvectora);
      v33 = colPoint->m_vecNormal.x;
      v34 = colPoint->m_vecNormal.y;
      v35 = colPoint->m_vecNormal.z;
      v36 = v197.x;
      v37 = v197.y;
      v38 = v197.z;
      v39 = (float)((float)(v198.x * v33) + (float)(v198.y * v34)) + (float)(v198.z * v35);
      v40 = v198.y - (float)(v34 * v39);
      v41 = v198.x - (float)(v33 * v39);
      v42 = v198.z - (float)(v35 * v39);
      v43 = sqrtf((float)(v42 * v42) + (float)((float)(v41 * v41) + (float)(v40 * v40)));
      v2.y = v40 * (float)(1.0 / v43);
      v2.x = v41 * (float)(1.0 / v43);
      v2.z = v42 * (float)(1.0 / v43);
      Multiply3x3(&v195, this->m_pMat, &this->m_vecCOM);
      m_fMass = this->m_fMass;
      v187 = v22;
      v1.x = v17 - v195.x;
      v1.y = v19 - v195.y;
      v1.z = v22 - v195.z;
      CrossProduct(&v194, &v1, &v2);
      v44 = v194.x;
      v45 = v194.y;
      v46 = v194.z;
      m_fTurnMass = this->m_fTurnMass;
      Multiply3x3(&v194, pPhysical->m_pMat, &pPhysical->m_vecCOM);
      v48 = pPhysical->m_fMass;
      v192.x = v28 - v194.x;
      v192.y = v29 - v194.y;
      v192.z = v30 - v194.z;
      CrossProduct(&v1, &v192, &v2);
      v51.n64_u32[1] = 1.0;
      v49 = v46 * v46;
      v50.n64_u64[0] = v189;
      v51.n64_f32[0] = (float)((float)(v33 * v36) + (float)(v34 * v37)) + (float)(v35 * v38);
      v52 = (float)(1.0 / m_fMass)
          + (float)((float)((float)((float)(v44 * v44) + (float)(v45 * v45)) + v49) / m_fTurnMass);
      v53 = 1.0
          / (float)((float)(1.0 / v48)
                  + (float)((float)((float)((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) + (float)(v1.z * v1.z))
                          / pPhysical->m_fTurnMass));
      v54 = sqrtf(
              (float)((float)(v38 - (float)(v35 * v51.n64_f32[0])) * (float)(v38 - (float)(v35 * v51.n64_f32[0])))
            + (float)((float)((float)(v36 - (float)(v33 * v51.n64_f32[0])) * (float)(v36 - (float)(v33 * v51.n64_f32[0])))
                    + (float)((float)(v37 - (float)(v34 * v51.n64_f32[0])) * (float)(v37 - (float)(v34 * v51.n64_f32[0])))));
      v55 = (float)((float)(v43 * (float)(1.0 / v52)) + (float)(v54 * v53)) / (float)((float)(1.0 / v52) + v53);
      if ( fabsf(v39) < 0.1414 )
        v50.n64_f32[0] = *(float *)&v189 * 0.05;
      if ( (float)(v43 - v55) > 0.0 )
      {
        v56 = v2.x;
        v57 = v2.y;
        v58 = v2.z;
        if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
        {
          *(_QWORD *)&vecOffset.x = __PAIR64__(LODWORD(v27), LODWORD(v24));
          v5.n64_f32[0] = -v50.n64_f32[0];
          v51.n64_f32[0] = (float)(1.0 / v52) * (float)(v55 - v43);
          v51.n64_u64[0] = vmax_f32(v51, v5).n64_u64[0];
          vecOffset.z = v187;
          v199.x = v51.n64_f32[0] * v2.x;
          v199.y = v51.n64_f32[0] * v2.y;
          v199.z = v51.n64_f32[0] * v2.z;
          CPhysical::ApplyFrictionForce(this, v199, vecOffset);
        }
        if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0 )
          return 1;
        v59 = v30;
        v51.n64_f32[0] = v53 * (float)(v55 - v54);
        v60 = vmin_f32(v51, v50).n64_f32[0];
        v61 = v60 * v58;
        v62 = v60 * v57;
        v63 = v60 * v56;
        v200.z = v61;
        v200.y = v62;
        goto LABEL_19;
      }
      return 0;
    }
    if ( (*(_BYTE *)&this->m_info & 7) == 2 )
      return 0;
    v191 = v8.n64_u64[0];
    v103 = this->m_pMat;
    v104 = colPoint->m_vecPosition.x - v103->tx;
    v105 = colPoint->m_vecPosition.z - v103->tz;
    v106 = v104;
    v107 = colPoint->m_vecPosition.y - v103->ty;
    cvectord.z = v105;
    cvectord.x = v104;
    cvectord.y = v107;
    CPhysical::GetSpeed(&v198, this, cvectord);
    v108 = colPoint->m_vecNormal.x;
    v109 = colPoint->m_vecNormal.y;
    v110 = colPoint->m_vecNormal.z;
    v111 = pPhysical->m_vecMoveSpeed.x;
    v112 = pPhysical->m_vecMoveSpeed.y;
    v113 = pPhysical->m_vecMoveSpeed.z;
    v114 = (float)((float)(v198.x * v108) + (float)(v198.y * v109)) + (float)(v198.z * v110);
    v115 = v198.y - (float)(v109 * v114);
    v116 = v198.x - (float)(v108 * v114);
    v117 = v198.z - (float)(v110 * v114);
    v118 = sqrtf((float)(v117 * v117) + (float)((float)(v116 * v116) + (float)(v115 * v115)));
    v197.y = v115 * (float)(1.0 / v118);
    v197.x = v116 * (float)(1.0 / v118);
    v197.z = v117 * (float)(1.0 / v118);
    Multiply3x3(&v2, this->m_pMat, &this->m_vecCOM);
    v119 = this->m_fMass;
    v194.x = v104 - v2.x;
    v194.y = v107 - v2.y;
    v194.z = v105 - v2.z;
    CrossProduct(&v195, &v194, &v197);
    v120 = (float)((float)(v108 * v111) + (float)(v109 * v112)) + (float)(v110 * v113);
    v121 = v109 * v120;
    v122 = v108 * v120;
    v123 = v110 * v120;
    v124 = pPhysical->m_fMass;
    v125 = sqrtf(
             (float)((float)(v113 - v123) * (float)(v113 - v123))
           + (float)((float)((float)(v111 - v122) * (float)(v111 - v122))
                   + (float)((float)(v112 - v121) * (float)(v112 - v121))));
    v4.n64_f32[0] = 1.0
                  / (float)((float)(1.0 / v119)
                          + (float)((float)((float)((float)(v195.x * v195.x) + (float)(v195.y * v195.y))
                                          + (float)(v195.z * v195.z))
                                  / this->m_fTurnMass));
    v126 = (float)((float)(v125 * v124) + (float)(v118 * v4.n64_f32[0])) / (float)(v124 + v4.n64_f32[0]);
    if ( (float)(v118 - v126) <= 0.0 )
      return 0;
    v127 = v197.x;
    v128 = v197.y;
    v129 = v197.z;
    v130 = CTimer::ms_fTimeStep;
    if ( (*(_BYTE *)&this->m_nPhysicalFlags & 4) == 0 )
    {
      v4.n64_f32[0] = v4.n64_f32[0] * (float)(v126 - v118);
      v131.n64_u32[1] = HIDWORD(v191);
      *(_QWORD *)&vecOffsetb.x = __PAIR64__(LODWORD(v107), LODWORD(v106));
      v131.n64_f32[0] = -(float)(CTimer::ms_fTimeStep * *(float *)&v191);
      v4.n64_u64[0] = vmax_f32(v4, v131).n64_u64[0];
      vecOffsetb.z = v105;
      v201.x = v197.x * v4.n64_f32[0];
      v201.y = v197.y * v4.n64_f32[0];
      v201.z = v197.z * v4.n64_f32[0];
      CPhysical::ApplyFrictionForce(this, v201, vecOffsetb);
    }
    v132 = pPhysical->m_nPhysicalFlags;
    if ( (*(_BYTE *)&v132 & 0x60) != 0 )
      return 1;
    v133.n64_u32[1] = HIDWORD(v191);
    v134 = 1.0 / pPhysical->m_fMass;
    v4.n64_f32[0] = v124 * (float)(v126 - v125);
    v135 = 0.0;
    v133.n64_f32[0] = v130 * *(float *)&v191;
    v136 = vmin_f32(v4, v133).n64_f32[0];
    v137 = v129 * v136;
    v138 = v128 * v136;
    v139 = v127 * v136;
    if ( (*(_BYTE *)&v132 & 0x80) == 0 )
      v135 = v137;
    v140 = (float)(v138 * v134) + pPhysical->m_vecMoveFriction.y;
    v141 = pPhysical->m_vecMoveFriction.x + (float)(v139 * v134);
    v142 = (float)(v135 * v134) + pPhysical->m_vecMoveFriction.z;
LABEL_37:
    pPhysical->m_vecMoveFriction.x = v141;
    pPhysical->m_vecMoveFriction.y = v140;
    pPhysical->m_vecMoveFriction.z = v142;
    return 1;
  }
  if ( (*(_BYTE *)&m_nPhysicalFlags & 0x10) != 0 )
  {
    v143 = pPhysical->m_vecMoveSpeed.x;
    v144 = colPoint->m_vecNormal.x;
    v145 = this->m_vecMoveSpeed.x;
    v146 = pPhysical->m_vecMoveSpeed.y;
    v147 = colPoint->m_vecNormal.y;
    v148 = this->m_vecMoveSpeed.y;
    v149 = pPhysical->m_vecMoveSpeed.z;
    v150 = colPoint->m_vecNormal.z;
    v151 = this->m_vecMoveSpeed.z;
    v152 = pPhysical->m_fMass;
    v153 = this->m_fMass;
    v154 = (float)((float)(v144 * v143) + (float)(v147 * v146)) + (float)(v150 * v149);
    v155 = (float)((float)(v145 * v144) + (float)(v148 * v147)) + (float)(v151 * v150);
    v156 = v147 * v154;
    v157 = v144 * v155;
    v158 = v150 * v154;
    v159 = v143 - (float)(v144 * v154);
    v160 = v148 - (float)(v147 * v155);
    v161 = v145 - v157;
    v162 = v151 - (float)(v150 * v155);
    v163 = sqrtf(
             (float)((float)(v149 - v158) * (float)(v149 - v158))
           + (float)((float)(v159 * v159) + (float)((float)(v146 - v156) * (float)(v146 - v156))));
    v164 = sqrtf((float)(v162 * v162) + (float)((float)(v161 * v161) + (float)(v160 * v160)));
    v165 = (float)((float)(v153 * v164) + (float)(v152 * v163)) / (float)(v153 + v152);
    if ( (float)(v164 - v165) <= 0.0 )
      return 0;
    v166 = v162 * (float)(1.0 / v164);
    v167 = v160 * (float)(1.0 / v164);
    v168 = v161 * (float)(1.0 / v164);
    if ( (*(_BYTE *)&v12 & 0x60) == 0 )
    {
      v7.n64_f32[0] = v153 * (float)(v165 - v164);
      v169 = 1.0 / v153;
      v8.n64_f32[0] = -(float)(CTimer::ms_fTimeStep * fAdhesiveLimit);
      v170 = 0.0;
      LODWORD(v171) = vmax_f32(v7, v8).n64_u32[0];
      if ( (*(_BYTE *)&v12 & 0x80) == 0 )
        v170 = v166 * v171;
      v172 = v169 * (float)(v168 * v171);
      v173 = v169 * (float)(v167 * v171);
      v174 = v169 * v170;
      v175 = v173 + this->m_vecMoveFriction.y;
      v176 = v174 + this->m_vecMoveFriction.z;
      this->m_vecMoveFriction.x = v172 + this->m_vecMoveFriction.x;
      this->m_vecMoveFriction.y = v175;
      this->m_vecMoveFriction.z = v176;
      m_nPhysicalFlags = pPhysical->m_nPhysicalFlags;
    }
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x60) != 0 )
      return 1;
    v177 = v152 * (float)(v165 - v163);
    v178 = v166 * v177;
    v179 = v167 * v177;
    v180 = 1.0 / pPhysical->m_fMass;
    v181 = v168 * v177;
    v182 = 0.0;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x80) == 0 )
      v182 = v178;
    v140 = (float)(v179 * v180) + pPhysical->m_vecMoveFriction.y;
    v142 = (float)(v182 * v180) + pPhysical->m_vecMoveFriction.z;
    v141 = pPhysical->m_vecMoveFriction.x + (float)(v181 * v180);
    goto LABEL_37;
  }
  if ( (*(_BYTE *)&pPhysical->m_info & 7) != 2 )
  {
    v190 = v8.n64_u64[0];
    v64 = pPhysical->m_pMat;
    v65 = colPoint->m_vecPosition.x - v64->tx;
    v66 = colPoint->m_vecPosition.z - v64->tz;
    v31 = v65;
    v32 = colPoint->m_vecPosition.y - v64->ty;
    cvectorc.z = v66;
    cvectorc.x = v65;
    cvectorc.y = v32;
    CPhysical::GetSpeed(&v198, pPhysical, cvectorc);
    v67 = colPoint->m_vecNormal.x;
    v68 = this->m_vecMoveSpeed.x;
    v69 = colPoint->m_vecNormal.y;
    v70 = this->m_vecMoveSpeed.y;
    v71 = colPoint->m_vecNormal.z;
    v72 = this->m_vecMoveSpeed.z;
    v73 = v198.x;
    v74 = v198.y;
    v75 = v198.z;
    v76 = (float)((float)(v68 * v67) + (float)(v70 * v69)) + (float)(v72 * v71);
    v77 = v70 - (float)(v69 * v76);
    v78 = v68 - (float)(v67 * v76);
    v79 = v72 - (float)(v71 * v76);
    v80 = sqrtf((float)(v79 * v79) + (float)((float)(v78 * v78) + (float)(v77 * v77)));
    v197.y = v77 * (float)(1.0 / v80);
    v197.x = v78 * (float)(1.0 / v80);
    v197.z = v79 * (float)(1.0 / v80);
    v81 = this->m_fMass;
    Multiply3x3(&v2, pPhysical->m_pMat, &pPhysical->m_vecCOM);
    v82 = pPhysical->m_fMass;
    v194.x = v65 - v2.x;
    v194.y = v32 - v2.y;
    v194.z = v66 - v2.z;
    CrossProduct(&v195, &v194, &v197);
    v83 = (float)((float)(v67 * v73) + (float)(v69 * v74)) + (float)(v71 * v75);
    v84 = (float)((float)(v75 - (float)(v71 * v83)) * (float)(v75 - (float)(v71 * v83)))
        + (float)((float)((float)(v73 - (float)(v67 * v83)) * (float)(v73 - (float)(v67 * v83)))
                + (float)((float)(v74 - (float)(v69 * v83)) * (float)(v74 - (float)(v69 * v83))));
    v4.n64_f32[0] = 1.0
                  / (float)((float)(1.0 / v82)
                          + (float)((float)((float)((float)(v195.x * v195.x) + (float)(v195.y * v195.y))
                                          + (float)(v195.z * v195.z))
                                  / pPhysical->m_fTurnMass));
    v85 = sqrtf(v84);
    v86 = (float)((float)(v81 * v80) + (float)(v85 * v4.n64_f32[0])) / (float)(v81 + v4.n64_f32[0]);
    if ( (float)(v80 - v86) > 0.0 )
    {
      v87 = v197.x;
      v88 = v197.y;
      v89 = v197.z;
      v90 = CTimer::ms_fTimeStep;
      v91 = this->m_nPhysicalFlags;
      if ( (*(_BYTE *)&v91 & 0x60) == 0 )
      {
        v92.n64_u32[1] = HIDWORD(v190);
        v93 = 1.0 / this->m_fMass;
        v6.n64_f32[0] = v81 * (float)(v86 - v80);
        v94 = 0.0;
        v92.n64_f32[0] = -(float)(CTimer::ms_fTimeStep * *(float *)&v190);
        v95 = this->m_vecMoveFriction.z;
        v96 = vmax_f32(v6, v92).n64_f32[0];
        v97 = v197.x * v96;
        v98 = v197.y * v96;
        v99 = v197.z * v96;
        if ( (*(_BYTE *)&v91 & 0x80) == 0 )
          v94 = v99;
        v4.n64_f32[1] = (float)(v98 * v93) + this->m_vecMoveFriction.y;
        this->m_vecMoveFriction.x = this->m_vecMoveFriction.x + (float)(v97 * v93);
        LODWORD(this->m_vecMoveFriction.y) = v4.n64_u32[1];
        this->m_vecMoveFriction.z = (float)(v94 * v93) + v95;
      }
      if ( (*(_BYTE *)&pPhysical->m_nPhysicalFlags & 4) != 0 )
        return 1;
      v59 = v66;
      v4.n64_f32[0] = v4.n64_f32[0] * (float)(v86 - v85);
      v100.n64_u32[1] = HIDWORD(v190);
      v100.n64_f32[0] = v90 * *(float *)&v190;
      v101 = vmin_f32(v4, v100).n64_f32[0];
      v100.n64_f32[0] = v89 * v101;
      v102 = v88 * v101;
      v63 = v87 * v101;
      LODWORD(v200.z) = v100.n64_u32[0];
      v200.y = v102;
LABEL_19:
      v200.x = v63;
      vecOffseta.x = v31;
      *(_QWORD *)&vecOffseta.y = __PAIR64__(LODWORD(v59), LODWORD(v32));
      CPhysical::ApplyFrictionForce(pPhysical, v200, vecOffseta);
      return 1;
    }
  }
  return 0;
}
// 405F90: variable 'v8' is possibly undefined
// 406234: variable 'v5' is possibly undefined
// 40648E: variable 'v6' is possibly undefined
// 4064E6: variable 'v4' is possibly undefined
// 4068A0: variable 'v7' is possibly undefined

//----- (0040696C) --------------------------------------------------------
int32 __fastcall CPhysical::ProcessEntityCollision(CPhysical *this, CEntity *pEntity, CColPoint *aColPoints)
{
  CMatrix *m_pMat; // r6
  CMatrix *v6; // r10
  CColModel *m_pColModel; // r9
  CColModel *ColModel; // r0
  int32 result; // r0
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r3
  RwReal v12; // lr
  int v13; // r1
  unsigned int m_nNoOfCollisionRecords; // r3
  int v15; // r1
  int v16; // r1
  RwReal y; // r3
  unsigned int v18; // r1
  int v19; // r3

  m_pMat = pEntity->m_pMat;
  v6 = this->m_pMat;
  m_pColModel = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex]->m_pColModel;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    m_pMat = pEntity->m_pMat;
  }
  ColModel = CEntity::GetColModel(pEntity);
  result = CCollision::ProcessColModels(v6, m_pColModel, m_pMat, ColModel, aColPoints, 0, 0, 0);
  if ( result >= 1 )
  {
    m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&this->m_nPhysicalFlags | 0x200);
    v12 = *(float *)&CTimer::m_snTimeInMilliseconds;
    v13 = *(_BYTE *)&this->m_info & 7;
    this->m_LastCollisionTime = CTimer::m_snTimeInMilliseconds;
    this->m_nPhysicalFlags = m_nPhysicalFlags;
    if ( v13 == 2 && (*(_BYTE *)&pEntity->m_info & 7) == 2 )
    {
      if ( LOWORD(this[3].m_vecCOM.y) == 0xFFFF )
        LOWORD(this[3].m_vecCOM.y) = 15000;
      if ( LOWORD(pEntity[18].pReferences) == 0xFFFF )
      {
        LOWORD(pEntity[18].pReferences) = 15000;
        m_nPhysicalFlags = this->m_nPhysicalFlags;
      }
    }
    if ( (*(_DWORD *)&m_nPhysicalFlags & 0x10000000) != 0 )
    {
      m_nNoOfCollisionRecords = this->m_nNoOfCollisionRecords;
      if ( this->m_nNoOfCollisionRecords )
      {
        v15 = 0;
        while ( this->m_aCollisionRecordPtrs[v15] != pEntity )
        {
          if ( ++v15 >= (int)m_nNoOfCollisionRecords )
          {
            if ( m_nNoOfCollisionRecords > 5 )
              break;
            goto LABEL_16;
          }
        }
      }
      else
      {
LABEL_16:
        this->m_aCollisionRecordPtrs[m_nNoOfCollisionRecords] = pEntity;
        this->m_nNoOfCollisionRecords = m_nNoOfCollisionRecords + 1;
      }
    }
    v16 = *(_BYTE *)&pEntity->m_info & 7;
    if ( v16 != 1 )
    {
      LODWORD(y) = LODWORD(pEntity[1].m_transform.m_translate.y) | 0x200;
      pEntity[1].m_transform.m_translate.x = v12;
      pEntity[1].m_transform.m_translate.y = y;
      if ( v16 == 2 && (*(_BYTE *)&this->m_info & 7) == 2 )
      {
        if ( LOWORD(pEntity[18].pReferences) == 0xFFFF )
          LOWORD(pEntity[18].pReferences) = 15000;
        if ( LOWORD(this[3].m_vecCOM.y) == 0xFFFF )
        {
          LOWORD(this[3].m_vecCOM.y) = 15000;
          y = pEntity[1].m_transform.m_translate.y;
        }
      }
      if ( (LODWORD(y) & 0x10000000) != 0 )
      {
        v18 = BYTE1(pEntity[3].m_transform.m_translate.y);
        if ( BYTE1(pEntity[3].m_transform.m_translate.y) )
        {
          v19 = 0;
          while ( *((CPhysical **)&pEntity[3].m_transform.m_translate.z + v19) != this )
          {
            if ( ++v19 >= (int)v18 )
            {
              if ( v18 > 5 )
                break;
              goto LABEL_30;
            }
          }
        }
        else
        {
LABEL_30:
          *((_DWORD *)&pEntity[3].m_transform.m_translate.z + v18) = this;
          BYTE1(pEntity[3].m_transform.m_translate.y) = v18 + 1;
        }
      }
    }
    if ( (*(_BYTE *)&pEntity->m_info & 7) == 1 || (*(_DWORD *)&pEntity->m_nFlags & 0x40004) != 0 )
      *(_DWORD *)&this->m_nFlags |= 0x1000u;
  }
  return result;
}

//----- (00406AF0) --------------------------------------------------------
void __fastcall CPhysical::RemoveRefsToEntity(CPhysical *this, CEntity *pEntity)
{
  int m_nNoOfCollisionRecords; // r2
  int v3; // r8
  int v4; // lr
  int v5; // r5
  int v6; // r6

  LOBYTE(m_nNoOfCollisionRecords) = this->m_nNoOfCollisionRecords;
  if ( (_BYTE)m_nNoOfCollisionRecords )
  {
    v3 = 0;
    v4 = 0;
    do
    {
      while ( this->m_aCollisionRecordPtrs[v3] != pEntity )
      {
        v3 = (__int16)++v4;
        if ( (__int16)v4 >= (int)(unsigned __int8)m_nNoOfCollisionRecords )
          return;
      }
      if ( (unsigned __int8)m_nNoOfCollisionRecords - 1 > (__int16)v4 )
      {
        v5 = (__int16)v4;
        v6 = v4;
        do
        {
          ++v6;
          this->m_aCollisionRecordPtrs[v5] = this->m_aCollisionRecordPtrs[v5 + 1];
          v5 = (__int16)v6;
          m_nNoOfCollisionRecords = this->m_nNoOfCollisionRecords;
        }
        while ( m_nNoOfCollisionRecords - 1 > (__int16)v6 );
      }
      LOBYTE(m_nNoOfCollisionRecords) = m_nNoOfCollisionRecords - 1;
      this->m_nNoOfCollisionRecords = m_nNoOfCollisionRecords;
    }
    while ( v3 < (unsigned __int8)m_nNoOfCollisionRecords );
  }
}

//----- (00406B68) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CPhysical::PlacePhysicalRelativeToOtherPhysical(
        CPhysical *pBasePhysical,
        CPhysical *pToBePlacedPhysical,
        CVector Offset)
{
  float x; // s16
  float y; // s18
  float z; // s20
  float v8; // s22
  float v9; // s24
  float v10; // s28
  float v11; // s26
  CMatrix *m_pMat; // r1
  float v13; // s2
  float v14; // s4
  float *p_tz; // r1
  __int64 v16; // d16
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  CMatrix *v19; // r0
  RwMatrix *v20; // r1
  CVector v21; // [sp+0h] [bp-58h] BYREF
  CVector v; // [sp+Ch] [bp-4Ch] BYREF

  v = Offset;
  operator*(&v21, pBasePhysical->m_pMat, &v);
  x = v21.x;
  y = v21.y;
  z = v21.z;
  v8 = pBasePhysical->m_vecMoveSpeed.x;
  v9 = pBasePhysical->m_vecMoveSpeed.y;
  v10 = CTimer::ms_fTimeStep;
  v11 = pBasePhysical->m_vecMoveSpeed.z;
  CWorld::Remove(pToBePlacedPhysical);
  CMatrix::operator=(pToBePlacedPhysical->m_pMat, pBasePhysical->m_pMat);
  m_pMat = pToBePlacedPhysical->m_pMat;
  v13 = y + (float)((float)(v10 * 0.9) * v9);
  v14 = x + (float)(v8 * (float)(v10 * 0.9));
  if ( m_pMat )
  {
    m_pMat->tx = v14;
    pToBePlacedPhysical->m_pMat->ty = v13;
    p_tz = &pToBePlacedPhysical->m_pMat->tz;
  }
  else
  {
    p_tz = &pToBePlacedPhysical->m_transform.m_translate.z;
    pToBePlacedPhysical->m_transform.m_translate.x = v14;
    pToBePlacedPhysical->m_transform.m_translate.y = v13;
  }
  *p_tz = z + (float)((float)(v10 * 0.9) * v11);
  v16 = *(_QWORD *)&pBasePhysical->m_vecMoveSpeed.x;
  m_pRwObject = pToBePlacedPhysical->m_pRwObject;
  pToBePlacedPhysical->m_vecMoveSpeed.z = pBasePhysical->m_vecMoveSpeed.z;
  *(_QWORD *)&pToBePlacedPhysical->m_vecMoveSpeed.x = v16;
  if ( m_pRwObject )
  {
    parent = (char *)m_pRwObject->parent;
    v19 = pToBePlacedPhysical->m_pMat;
    v20 = (RwMatrix *)(parent + 16);
    if ( v19 )
      CMatrix::UpdateRwMatrix(v19, v20);
    else
      CSimpleTransform::UpdateRwMatrix(&pToBePlacedPhysical->m_transform, v20);
  }
  CEntity::UpdateRwFrame(pToBePlacedPhysical);
  CWorld::Add(pToBePlacedPhysical);
}
// 406B68: fragmented variable at 0:r2.8,8:^60.4 may be wrong
// 406B68: variables would overlap: 0:r2.8,8:^60.4 and ^60.4

//----- (00406C44) --------------------------------------------------------
float __fastcall CPhysical::ApplyScriptCollision(
        CPhysical *this,
        CVector vecColNormal,
        float fElasticity,
        float fAdhesiveLimit,
        CVector *pVecColPos)
{
  float z; // r6
  float m_fElasticity; // r9
  float y; // r5
  float x; // r8
  float v10; // s0
  float v11; // s2
  float v12; // s4
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float v15; // s20
  float v16; // s22
  float v17; // s24
  float m_fRadius; // s4
  float v19; // s0
  float v20; // s6
  _BOOL4 v21; // r0
  CColPoint v23; // [sp+0h] [bp-70h] BYREF
  float fImpulseMagnitude[17]; // [sp+2Ch] [bp-44h] BYREF

  fImpulseMagnitude[0] = 0.0;
  z = vecColNormal.z;
  m_fElasticity = this->m_fElasticity;
  y = vecColNormal.y;
  x = vecColNormal.x;
  v23.m_vecNormal = vecColNormal;
  if ( pVecColPos )
  {
    v10 = pVecColPos->x;
    v11 = pVecColPos->y;
    v12 = pVecColPos->z;
  }
  else
  {
    m_pMat = this->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    v15 = p_tx->m_translate.x;
    v16 = p_tx->m_translate.y;
    v17 = p_tx->m_translate.z;
    m_fRadius = CEntity::GetColModel(this)->m_sphereBound.m_fRadius;
    v19 = m_fRadius * y;
    v20 = m_fRadius * x;
    v12 = v17 - (float)(m_fRadius * z);
    v11 = v16 - v19;
    v10 = v15 - v20;
  }
  v23.m_vecPosition.z = v12;
  v23.m_vecPosition.y = v11;
  v23.m_vecPosition.x = v10;
  this->m_fElasticity = fElasticity;
  v21 = CPhysical::ApplyCollision(this, this, &v23, fImpulseMagnitude);
  if ( fAdhesiveLimit > 0.0 && v21 )
    CPhysical::ApplyFriction(this, fAdhesiveLimit, &v23);
  this->m_fElasticity = m_fElasticity;
  return fImpulseMagnitude[0];
}
// 406C44: using guessed type float fImpulseMagnitude[17];

//----- (00406D12) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
CEntity *__fastcall CPhysical::AttachEntityToEntity(int a1, CEntity *a2, int a3, int a4, int a5, _DWORD a6[2], int a7)
{
  CEntity *v7; // r4
  int v11; // r0
  int v12; // r2
  __int64 *v13; // r3
  __int64 v14; // d16

  v7 = a2;
  if ( !a2 )
    return 0;
  *(_DWORD *)(a1 + 256) = a2;
  CEntity::RegisterReference(a2, (CEntity **)(a1 + 256));
  v11 = *(_DWORD *)(a1 + 68);
  *(_DWORD *)(a1 + 260) = a3;
  *(_DWORD *)(a1 + 264) = a4;
  *(_DWORD *)(a1 + 268) = a5;
  if ( (v11 & 0x40) != 0 )
  {
    v12 = *(_DWORD *)(a1 + 20);
    v13 = (__int64 *)(v12 + 48);
    if ( !v12 )
      v13 = (__int64 *)(a1 + 4);
    v14 = *v13;
    *(_DWORD *)(a1 + 280) = *((_DWORD *)v13 + 2);
    *(_QWORD *)(a1 + 272) = v14;
  }
  else
  {
    *(_QWORD *)(a1 + 272) = *(_QWORD *)a6;
    *(_DWORD *)(a1 + 280) = a7;
  }
  *(_DWORD *)(a1 + 300) = *(_DWORD *)(a1 + 256);
  *(_QWORD *)(a1 + 284) = 0LL;
  *(_QWORD *)(a1 + 292) = 0LL;
  if ( (v11 & 4) != 0 )
  {
    *(_DWORD *)(a1 + 68) = v11 & 0xFFFFFFF7;
  }
  else if ( (unsigned __int8)((*(_BYTE *)&v7->m_info & 7) - 2) <= 2u
         && (LOBYTE(v7[1].m_transform.m_translate.y) & 4) != 0
         && (v11 & 0x40) == 0
         && (*(_BYTE *)(a1 + 58) & 7) == 4 )
  {
    *(_DWORD *)(a1 + 68) = v11 | 4;
    *(_DWORD *)(a1 + 144) = 1203982323;
    *(_DWORD *)(a1 + 148) = 1203982323;
  }
  CPhysical::PositionAttachedEntity((CPhysical *)a1);
  return v7;
}
// 406D12: array has been used for an input argument

//----- (00406DDC) --------------------------------------------------------
void __fastcall CPhysical::PositionAttachedEntity(CPhysical *this)
{
  float32x2_t v1; // d3
  float32x2_t v2; // d4
  CEntity *m_pAttachToEntity; // r5
  CEntity **p_m_pAttachToEntity; // r8
  const CMatrix *m_pMat; // r1
  CEntity *v7; // r0
  int v8; // r1
  bool v9; // zf
  RwFrame_0 *m_nFlags; // r0
  RwMatrix *LTM; // r0
  float y; // s0
  int v13; // r1
  float x; // s2
  int v15; // r2
  float z; // s8
  float real; // s10
  float v18; // s4
  float v19; // s12
  float v20; // s4
  float v21; // s14
  float v22; // s1
  float v23; // s5
  float v24; // s2
  float v25; // s12
  float v26; // s4
  float v27; // s0
  RtQuat_0 *p_m_AttachQuat; // r4
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CEntity *v30; // r5
  int v31; // r0
  int v32; // r1
  bool v33; // zf
  int m_nModelIndex; // r0
  bool v35; // zf
  int m_heading_low; // r0
  bool v37; // zf
  bool v38; // zf
  CPhysical *v39; // r1
  int v40; // r0
  bool v41; // zf
  CMatrix *v42; // r0
  CMatrix *v43; // r2
  float *p_tx; // r3
  CSimpleTransform *p_m_transform; // r0
  float v46; // s4
  __int64 v47; // d16
  CEntity *v48; // r0
  __int64 v49; // d16
  CMatrix *v50; // r1
  CSimpleTransform *v51; // r4
  CSimpleTransform *v52; // r0
  float v53; // s2
  float v54; // s0
  __int64 v55; // d16
  float v56; // s4
  float v57; // s6
  float v58; // s6
  float v59; // s22
  float v60; // s24
  float v61; // s26
  float m_fMass; // s28
  float v63; // s6
  float v64; // s16
  float v65; // s20
  CEntity *v66; // r0
  int v67; // r1
  bool v68; // zf
  CMatrix *v69; // r1
  CMatrix *v70; // r1
  float *p_x; // r2
  float v72; // s10
  unsigned int v73; // s0
  unsigned int v74; // s2
  CMatrix *v75; // r1
  float m_heading; // s16
  CPhysical::CPhysicalFlags v77; // r1
  CEntity *v78; // r0
  __int64 v79; // d16
  __int64 v80; // d16
  __int64 v81; // d16
  CMatrix *v82; // r0
  CPlaceable *v83; // r5
  CMatrix *v84; // r0
  CEntity *m_pDamageEntity; // r0
  float v86; // s0
  CMatrix *v87; // r0
  float v88; // s0
  float v89; // s0
  float v90; // s2
  float v91; // s2
  CPhysical::CPhysicalFlags v92; // r1
  unsigned int v93; // r0
  CPlaceable *v94; // r1
  __int64 v95; // d16
  __int64 v96; // d16
  __int64 v97; // d16
  float v98; // s18
  float *p_xx; // r1
  float v100; // s16
  float v101; // s20
  float v102; // s22
  float v103; // s24
  CPhysical::CPhysicalFlags v104; // r0
  float v105; // s9
  float v106; // s10
  float v107; // s7
  float v108; // s0
  float v109; // s6
  float v110; // s4
  float v111; // s8
  float v112; // s0
  RwReal v113; // s2
  float *v114; // r1
  float v115; // s16
  float v116; // s1
  float v117; // s6
  float v118; // s2
  float v119; // s12
  float v120; // s8
  CVector v121; // [sp+0h] [bp-1C0h]
  CVector v122; // [sp+0h] [bp-1C0h]
  RwMatrix pMatrix; // [sp+10h] [bp-1B0h] BYREF
  CMatrix m1; // [sp+50h] [bp-170h] BYREF
  CMatrix v125; // [sp+98h] [bp-128h] BYREF
  CMatrix mat; // [sp+E0h] [bp-E0h] BYREF
  CMatrix v127; // [sp+128h] [bp-98h] BYREF
  CVector v128; // 0:r1.12
  CVector v129; // 0:r1.12
  CVector v130; // 0:r2.8,8:^0.4

  m_pAttachToEntity = this->m_pAttachToEntity;
  if ( m_pAttachToEntity )
  {
    p_m_pAttachToEntity = &this->m_pAttachToEntity;
    mat.m_pRwMat = 0;
    mat.m_owner = 0;
    v125.m_pRwMat = 0;
    v125.m_owner = 0;
    m_pMat = m_pAttachToEntity->m_pMat;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(m_pAttachToEntity);
      CSimpleTransform::UpdateMatrix(&m_pAttachToEntity->m_transform, m_pAttachToEntity->m_pMat);
      m_pMat = m_pAttachToEntity->m_pMat;
    }
    CMatrix::CMatrix(&m1, m_pMat);
    v7 = *p_m_pAttachToEntity;
    v8 = *(_BYTE *)&(*p_m_pAttachToEntity)->m_info & 7;
    v9 = v8 == 2;
    if ( v8 == 2 )
      v9 = v7[24]._vptr$CPlaceable == (int (**)(void))byte_9;
    if ( v9 )
    {
      CBike::CalculateLeanMatrix((CBike *)v7);
      CMatrix::operator=(&m1, (const CMatrix *)&(*p_m_pAttachToEntity)[25].m_transform);
    }
    else if ( (*(_BYTE *)&this->m_info & 7) == 4 && v7->m_nModelIndex == 530 )
    {
      m_nFlags = (RwFrame_0 *)v7[28].m_nFlags;
      if ( m_nFlags )
      {
        LTM = RwFrameGetLTM(m_nFlags);
        CMatrix::UpdateMatrix(&m1, LTM);
      }
    }
    y = this->m_AttachQuat.imag.y;
    v13 = 0;
    x = this->m_AttachQuat.imag.x;
    v15 = 0;
    if ( y != 0.0 )
      v13 = 1;
    if ( x != 0.0 )
      v15 = 1;
    if ( !(v13 | v15) && this->m_AttachQuat.imag.z == 0.0 )
    {
      if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x40) != 0 )
      {
        CMatrix::operator=(&mat, this->m_pMat);
      }
      else
      {
        CMatrix::ResetOrientation(&v125);
        CMatrix::Rotate(
          &v125,
          this->m_vecAttachTiltOffset.x,
          this->m_vecAttachTiltOffset.y,
          this->m_vecAttachTiltOffset.z);
        CMatrix::operator=(&mat, &m1);
        operator*(&v127, &mat, &v125);
        CMatrix::operator=(&mat, &v127);
        CMatrix::~CMatrix(&v127);
      }
      Multiply3x3((CVector *)&v127, &m1, &this->m_vecAttachPosnOffset);
      mat.ty = v127.yx + m1.ty;
      mat.tx = v127.xx + m1.tx;
      mat.tz = v127.zx + m1.tz;
    }
    else
    {
      z = this->m_AttachQuat.imag.z;
      real = this->m_AttachQuat.real;
      memset(&pMatrix.pos, 0, sizeof(pMatrix.pos));
      v18 = 2.0 / (float)((float)(real * real) + (float)((float)((float)(x * x) + (float)(y * y)) + (float)(z * z)));
      v1.n64_f32[0] = z * v18;
      v19 = y * v18;
      v20 = x * v18;
      v21 = z * v1.n64_f32[0];
      v22 = y * v19;
      v23 = x * v19;
      v24 = x * v20;
      v2.n64_f32[0] = z * v20;
      v25 = real * v19;
      v26 = real * v20;
      v27 = y * v1.n64_f32[0];
      v1.n64_f32[1] = v23 + (float)(real * v1.n64_f32[0]);
      v2.n64_f32[1] = v2.n64_f32[0] - v25;
      pMatrix.right.y = v1.n64_f32[1];
      pMatrix.right.z = v2.n64_f32[0] - v25;
      pMatrix.up.x = v23 - (float)(real * v1.n64_f32[0]);
      pMatrix.up.z = v27 + v26;
      pMatrix.at.y = v27 - v26;
      pMatrix.at.x = v2.n64_f32[0] + v25;
      pMatrix.right.x = 1.0 - (float)(v22 + v21);
      pMatrix.up.y = 1.0 - (float)(v21 + v24);
      pMatrix.at.z = 1.0 - (float)(v24 + v22);
      pMatrix.flags = 2;
      CMatrix::UpdateMatrix(&mat, &pMatrix);
      operator*(&v127, &m1, &mat);
      CMatrix::operator=(&mat, &v127);
      CMatrix::~CMatrix(&v127);
      operator*((CVector *)&v127, &m1, &this->m_vecAttachPosnOffset);
      CMatrix::SetTranslateOnly(&mat, v127.xx, v127.yx, v127.zx);
    }
    p_m_AttachQuat = &this->m_AttachQuat;
    CPlaceable::SetMatrix(this, &mat);
    if ( (*(_BYTE *)&this->m_info & 7) == 4 )
    {
      if ( (*(_DWORD *)&this->m_nFlags & 0x40004) != 0 )
        (*((void (__fastcall **)(CPhysical *, _DWORD))this->_vptr$CPlaceable + 5))(this, 0);
      m_nPhysicalFlags = this->m_nPhysicalFlags;
      this->m_nNoOfStaticFrames = 0;
      this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags | 0x2000000);
    }
    v30 = *p_m_pAttachToEntity;
    v31 = *(_BYTE *)&(*p_m_pAttachToEntity)->m_info & 7;
    if ( v31 != 2 )
      goto LABEL_43;
    v32 = *(_BYTE *)&this->m_info & 7;
    v33 = v32 == 4;
    if ( v32 != 4 )
      v33 = v32 == 2;
    if ( !v33 )
    {
LABEL_43:
      if ( this->m_nModelIndex == 363 )
      {
        v38 = v31 == 4;
        if ( v31 == 4 )
          v38 = *(_BYTE *)&v30->m_nFlags << 31 == 0;
        if ( v38 )
        {
          (*((void (__fastcall **)(CPhysical *, _DWORD))this->_vptr$CPlaceable + 5))(this, 0);
          v77 = this->m_nPhysicalFlags;
          this->m_nNoOfStaticFrames = 0;
          this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&v77 & 0xFDFFFFFF);
          if ( (*(_BYTE *)&v77 & 4) != 0 )
          {
            this->m_vecTurnSpeed.x = 0.0;
            this->m_vecTurnSpeed.y = 0.0;
            v81 = *(_QWORD *)&this->m_vecTurnSpeed.x;
            this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&v77 & 0xFDFFFFF7 | 8);
            this->m_vecTurnSpeed.z = 0.0;
            this->m_vecMoveSpeed.z = 0.0;
            *(_QWORD *)&this->m_vecMoveSpeed.x = v81;
          }
          else
          {
            v78 = *p_m_pAttachToEntity;
            if ( (*(_BYTE *)&(*p_m_pAttachToEntity)->m_info & 7) == 2 )
            {
              v79 = *(_QWORD *)&v78[1].m_transform.m_translate.z;
              LODWORD(this->m_vecMoveSpeed.z) = v78[1].m_pMat;
              *(_QWORD *)&this->m_vecMoveSpeed.x = v79;
              v80 = *(_QWORD *)&v78[1].m_pRwObject;
              LODWORD(this->m_vecTurnSpeed.z) = v78[1].m_nFlags.bdummy;
              *(_QWORD *)&this->m_vecTurnSpeed.x = v80;
            }
          }
          *(_QWORD *)p_m_pAttachToEntity = 0LL;
          *(_QWORD *)&this->m_vecAttachPosnOffset.y = 0LL;
          *(_QWORD *)&p_m_AttachQuat->imag.x = 0LL;
          *(_QWORD *)&this->m_AttachQuat.imag.z = 0LL;
          this->m_pNOCollisionVehicle = 0;
          if ( (*(_BYTE *)&this->m_info & 7) == 4 )
            LODWORD(this->m_fElasticity) = this[1].pReferences[1].ppReferenceAddress;
          *(_DWORD *)&this->m_nFlags |= 1u;
          goto LABEL_138;
        }
      }
      goto LABEL_44;
    }
    m_nModelIndex = v30->m_nModelIndex;
    v35 = m_nModelIndex == 530;
    if ( m_nModelIndex != 530 )
      v35 = m_nModelIndex == 406;
    if ( !v35 )
    {
      if ( v32 == 2 )
      {
        v82 = v30->m_pMat;
        if ( !v82 )
        {
          CPlaceable::AllocateMatrix(*p_m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v30->m_transform, v30->m_pMat);
          v82 = v30->m_pMat;
        }
        if ( fabsf(v82->zx) > 0.707 )
          goto LABEL_87;
        v83 = *p_m_pAttachToEntity;
        v84 = (*p_m_pAttachToEntity)->m_pMat;
        if ( !v84 )
        {
          CPlaceable::AllocateMatrix(*p_m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v83->m_transform, v83->m_pMat);
          v84 = v83->m_pMat;
        }
        if ( fabsf(v84->zy) > 0.707 )
        {
LABEL_87:
          CPhysical::DettachEntityFromEntity(this, 0.0, 0.0, 1.0, 0);
LABEL_138:
          CMatrix::~CMatrix(&m1);
          CMatrix::~CMatrix(&v125);
          CMatrix::~CMatrix(&mat);
          return;
        }
      }
LABEL_44:
      if ( (*(_BYTE *)&this->m_nPhysicalFlags & 0x40) == 0 )
      {
        v39 = (CPhysical *)*p_m_pAttachToEntity;
        v40 = *(_BYTE *)&(*p_m_pAttachToEntity)->m_info & 7;
        v41 = v40 == 4;
        if ( v40 != 4 )
          v41 = v40 == 2;
        if ( v41 )
        {
          v42 = v39->m_pMat;
          v43 = this->m_pMat;
          p_tx = &v42->tx;
          if ( !v42 )
            p_tx = &v39->m_transform.m_translate.x;
          p_m_transform = (CSimpleTransform *)&v43->tx;
          v46 = p_tx[2];
          if ( !v43 )
            p_m_transform = &this->m_transform;
          v130.x = p_m_transform->m_translate.x - *p_tx;
          v130.y = p_m_transform->m_translate.y - p_tx[1];
          v130.z = p_m_transform->m_translate.z - v46;
          CPhysical::GetSpeed((CVector *)&v127, v39, v130);
          v47 = *(_QWORD *)&v127.xx;
          this->m_vecMoveSpeed.z = v127.zx;
          *(_QWORD *)&this->m_vecMoveSpeed.x = v47;
          v48 = this->m_pAttachToEntity;
          v49 = *(_QWORD *)&v48[1].m_pRwObject;
          LODWORD(this->m_vecTurnSpeed.z) = v48[1].m_nFlags.bdummy;
          *(_QWORD *)&this->m_vecTurnSpeed.x = v49;
        }
        goto LABEL_138;
      }
      v50 = this->m_pMat;
      v51 = &this->m_transform;
      v52 = &this->m_transform;
      if ( v50 )
        v52 = (CSimpleTransform *)&v50->tx;
      v53 = v52->m_translate.x - this->m_vecAttachTiltOffset.x;
      v54 = v52->m_translate.y - this->m_vecAttachTiltOffset.y;
      v55 = *(_QWORD *)&v52->m_translate.x;
      v56 = v52->m_translate.z - this->m_vecAttachTiltOffset.z;
      this->m_vecAttachTiltOffset.z = v52->m_translate.z;
      *(_QWORD *)&this->m_vecAttachTiltOffset.x = v55;
      v57 = (float)((float)(v53 * v53) + (float)(v54 * v54)) + (float)(v56 * v56);
      if ( v57 > 4.0 )
      {
        v58 = 2.0 / sqrtf(v57);
        v56 = v56 * v58;
        v54 = v54 * v58;
        v53 = v53 * v58;
      }
      v1.n64_u32[0] = 1.0;
      v59 = this->m_vecMoveSpeed.x;
      v60 = this->m_vecMoveSpeed.y;
      v61 = this->m_vecMoveSpeed.z;
      m_fMass = this->m_fMass;
      v2.n64_f32[0] = CTimer::ms_fTimeStep;
      v63 = 1.0 / vmax_f32(v2, v1).n64_f32[0];
      v64 = v53 * v63;
      v65 = v54 * v63;
      this->m_vecMoveSpeed.x = v53 * v63;
      this->m_vecMoveSpeed.y = v54 * v63;
      this->m_vecMoveSpeed.z = v56 * v63;
      Multiply3x3((CVector *)&v127, v50, &this->m_vecCOM);
      v121.x = v127.xx;
      *(_QWORD *)&v121.y = *(_QWORD *)&v127.yx;
      v128.x = -(float)(m_fMass * (float)((float)(v53 * v63) - v59));
      v128.y = -(float)(m_fMass * (float)((float)(v54 * v63) - v60));
      v128.z = -(float)(m_fMass * (float)((float)(v56 * v63) - v61));
      CPhysical::ApplyForce(this, v128, v121, 1);
      v66 = this->m_pAttachToEntity;
      v67 = *(_BYTE *)&v66->m_info & 7;
      v68 = v67 == 4;
      if ( v67 != 4 )
        v68 = v67 == 2;
      if ( !v68 )
        goto LABEL_138;
      if ( *(_BYTE *)&v66->m_nFlags << 31 && (LOBYTE(v66[1].m_transform.m_translate.y) & 4) == 0 )
      {
        v69 = this->m_pMat;
        if ( v69 )
          v51 = (CSimpleTransform *)&v69->tx;
        v70 = v66->m_pMat;
        p_x = &v70->tx;
        if ( !v70 )
          p_x = &v66->m_transform.m_translate.x;
        v72 = p_x[2];
        *(float *)&v73 = (float)(v127.xx + v51->m_translate.x) - *p_x;
        *(float *)&v74 = (float)(v127.yx + v51->m_translate.y) - p_x[1];
        v129.x = -(float)-(float)(m_fMass * (float)(v64 - v59));
        v129.y = -(float)-(float)(m_fMass * (float)(v65 - v60));
        *(_QWORD *)&v122.x = __PAIR64__(v74, v73);
        v122.z = (float)(v127.zx + v51->m_translate.z) - v72;
        v129.z = -(float)-(float)(m_fMass * (float)((float)(v56 * v63) - v61));
        CPhysical::ApplyForce((CPhysical *)v66, v129, v122, 1);
        v66 = this->m_pAttachToEntity;
      }
      v75 = v66->m_pMat;
      if ( v75 )
        m_heading = atan2f(COERCE_FLOAT(LODWORD(v75->xy) ^ 0x80000000), v75->yy);
      else
        m_heading = v66->m_transform.m_heading;
      v87 = this->m_pMat;
      if ( v87 )
        v88 = atan2f(COERCE_FLOAT(LODWORD(v87->xy) ^ 0x80000000), v87->yy);
      else
        v88 = this->m_transform.m_heading;
      v89 = m_heading - v88;
      if ( v89 <= 3.1416 )
      {
        if ( v89 >= -3.1416 )
          goto LABEL_111;
        v90 = 6.2832;
      }
      else
      {
        v90 = -6.2832;
      }
      v89 = v89 + v90;
LABEL_111:
      v91 = 0.5;
      if ( v89 <= 0.5 )
      {
        v91 = v89;
        if ( v89 < -0.5 )
          v91 = -0.5;
      }
      this->m_vecTurnSpeed.z = this->m_vecTurnSpeed.z + (float)((float)(v91 * this->m_fMass) * 0.00001);
      goto LABEL_138;
    }
    if ( m_nModelIndex == 530 )
    {
      if ( !LOWORD(v30[36].m_transform.m_heading) && HIWORD(v30[36].m_transform.m_heading) )
        goto LABEL_116;
      if ( this->m_fDamageImpulseMagnitude <= (float)(this->m_fMass * 0.1) )
        goto LABEL_94;
    }
    else
    {
      if ( m_nModelIndex != 406 )
        goto LABEL_94;
      m_heading_low = LOWORD(v30[36].m_transform.m_heading);
      v37 = m_heading_low == 0;
      if ( LOWORD(v30[36].m_transform.m_heading) )
        v37 = m_heading_low == HIWORD(v30[36].m_transform.m_heading);
      if ( !v37 )
        goto LABEL_116;
      if ( this->m_fDamageImpulseMagnitude <= 0.0 )
      {
LABEL_94:
        v86 = *(float *)&v30[3].pReferences;
        if ( (v86 <= 0.0 || v30->m_pMat->zz >= 0.1)
          && (v86 <= 1.0 || v30->m_pMat->zy <= 0.87)
          && (v86 <= 500.0
           || (float)((float)((float)(*(float *)&v30[3].m_nScanCode * v30->m_pMat->xz)
                            + (float)(*(float *)&v30[3].m_pLod * v30->m_pMat->yz))
                    + (float)(*(float *)&v30[3].numLodChildren * v30->m_pMat->zz)) >= 0.7
           || (float)((float)((float)(v30[1].m_transform.m_translate.z * v30[1].m_transform.m_translate.z)
                            + (float)(v30[1].m_transform.m_heading * v30[1].m_transform.m_heading))
                    + (float)(*(float *)&v30[1].m_pMat * *(float *)&v30[1].m_pMat)) >= 0.09) )
        {
          goto LABEL_44;
        }
LABEL_116:
        (*((void (__fastcall **)(CPhysical *, _DWORD))this->_vptr$CPlaceable + 5))(this, 0);
        v92 = this->m_nPhysicalFlags;
        this->m_nNoOfStaticFrames = 0;
        LOBYTE(v93) = v92;
        this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&v92 & 0xFDFFFFFF);
        if ( (*(_BYTE *)&v92 & 4) != 0 )
        {
          this->m_vecTurnSpeed.x = 0.0;
          this->m_vecTurnSpeed.y = 0.0;
          v93 = *(_DWORD *)&v92 & 0xFDFFFFF7 | 8;
          v97 = *(_QWORD *)&this->m_vecTurnSpeed.x;
          this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)v93;
          this->m_vecTurnSpeed.z = 0.0;
          this->m_vecMoveSpeed.z = 0.0;
          *(_QWORD *)&this->m_vecMoveSpeed.x = v97;
        }
        else
        {
          v94 = *p_m_pAttachToEntity;
          if ( (*(_BYTE *)&(*p_m_pAttachToEntity)->m_info & 7) == 2 )
          {
            v95 = *(_QWORD *)&v94[3]._vptr$CPlaceable;
            this->m_vecMoveSpeed.z = v94[3].m_transform.m_translate.y;
            *(_QWORD *)&this->m_vecMoveSpeed.x = v95;
            v96 = *(_QWORD *)&v94[3].m_transform.m_translate.z;
            LODWORD(this->m_vecTurnSpeed.z) = v94[3].m_pMat;
            *(_QWORD *)&this->m_vecTurnSpeed.x = v96;
          }
        }
        *(_QWORD *)p_m_pAttachToEntity = 0LL;
        *(_QWORD *)&this->m_vecAttachPosnOffset.y = 0LL;
        *(_QWORD *)&p_m_AttachQuat->imag.x = 0LL;
        *(_QWORD *)&this->m_AttachQuat.imag.z = 0LL;
        this->m_pNOCollisionVehicle = 0;
        if ( (*(_BYTE *)&this->m_info & 7) == 4 )
          LODWORD(this->m_fElasticity) = this[1].pReferences[1].ppReferenceAddress;
        if ( (v93 & 4) == 0 )
        {
          v98 = (float)rand();
          p_xx = &v30->m_pMat->xx;
          v100 = this->m_fMass;
          if ( !p_xx )
          {
            CPlaceable::AllocateMatrix(v30);
            CSimpleTransform::UpdateMatrix(&v30->m_transform, v30->m_pMat);
            p_xx = &v30->m_pMat->xx;
          }
          v101 = p_xx[4];
          v102 = p_xx[5];
          v103 = p_xx[6];
          if ( !p_xx )
          {
            CPlaceable::AllocateMatrix(v30);
            CSimpleTransform::UpdateMatrix(&v30->m_transform, v30->m_pMat);
            p_xx = &v30->m_pMat->xx;
          }
          v104 = this->m_nPhysicalFlags;
          if ( (*(_BYTE *)&v104 & 0x60) == 0 )
          {
            v105 = this->m_fMass;
            v106 = 1.0 / v105;
            v107 = this->m_vecMoveSpeed.z;
            v108 = (float)((float)(v98 * 4.6566e-10) + (float)(v98 * 4.6566e-10)) + -1.0;
            v109 = (float)(v100 * 0.01) * (float)((float)(v108 * v102) + (float)(v108 * p_xx[1]));
            v110 = (float)(v100 * 0.01) * (float)((float)(v108 * v101) + (float)(v108 * *p_xx));
            v111 = 0.0;
            v112 = (float)(v100 * 0.01) * (float)((float)(v108 * v103) + (float)(v108 * p_xx[2]));
            if ( (*(_BYTE *)&v104 & 0x80) == 0 )
              v111 = v112;
            v113 = (float)((float)(1.0 / v105) * v109) + this->m_vecMoveSpeed.y;
            this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)(v110 * v106);
            this->m_vecMoveSpeed.y = v113;
            this->m_vecMoveSpeed.z = (float)(v106 * v111) + v107;
          }
          if ( LOWORD(v30[36].m_transform.m_heading) > (unsigned int)HIWORD(v30[36].m_transform.m_heading) )
          {
            v114 = &v30->m_pMat->xx;
            v115 = this->m_fMass;
            if ( !v114 )
            {
              CPlaceable::AllocateMatrix(v30);
              CSimpleTransform::UpdateMatrix(&v30->m_transform, v30->m_pMat);
              v104 = this->m_nPhysicalFlags;
              v114 = &v30->m_pMat->xx;
            }
            if ( (*(_BYTE *)&v104 & 0x60) == 0 )
            {
              v116 = 0.0;
              v117 = this->m_vecMoveSpeed.y;
              v118 = 1.0 / this->m_fMass;
              v119 = (float)(v115 * 0.02) * v114[9];
              v120 = this->m_vecMoveSpeed.z;
              if ( (*(_BYTE *)&v104 & 0x80) == 0 )
                v116 = (float)(v115 * 0.02) * v114[10];
              this->m_vecMoveSpeed.x = this->m_vecMoveSpeed.x + (float)((float)((float)(v115 * 0.02) * v114[8]) * v118);
              this->m_vecMoveSpeed.y = (float)(v119 * v118) + v117;
              this->m_vecMoveSpeed.z = (float)(v116 * v118) + v120;
            }
          }
        }
        goto LABEL_138;
      }
    }
    m_pDamageEntity = this->m_pDamageEntity;
    if ( m_pDamageEntity && (*(_BYTE *)&m_pDamageEntity->m_info & 7) == 1 )
      goto LABEL_116;
    goto LABEL_94;
  }
}
// 40719C: variable 'v2' is possibly undefined
// 40719C: variable 'v1' is possibly undefined

//----- (00407868) --------------------------------------------------------
CEntity *__fastcall CPhysical::AttachEntityToEntity(CPhysical *this, CEntity *pEnt, CVector *pVecPos, RtQuat_0 *pQuat)
{
  CEntity *v4; // r4
  const CMatrix *m_pMat; // r1
  RwFrame_0 *m_nFlags; // r0
  RwMatrix *LTM; // r0
  __int64 v11; // d16
  __int64 v12; // d17
  CMatrix *v13; // r0
  CSimpleTransform *p_tx; // r1
  float v15; // s2
  float v16; // s0
  float v17; // s4
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  CMatrix *v19; // r0
  CSimpleTransform *p_m_transform; // r1
  __int64 v21; // d16
  CMatrix v23; // [sp+0h] [bp-E8h] BYREF
  CMatrix m; // [sp+48h] [bp-A0h] BYREF
  CMatrix v25; // [sp+90h] [bp-58h] BYREF

  v4 = pEnt;
  if ( pEnt )
  {
    this->m_pAttachToEntity = pEnt;
    CEntity::RegisterReference(pEnt, &this->m_pAttachToEntity);
    m_pMat = v4->m_pMat;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(v4);
      CSimpleTransform::UpdateMatrix(&v4->m_transform, v4->m_pMat);
      m_pMat = v4->m_pMat;
    }
    CMatrix::CMatrix(&m, m_pMat);
    if ( (*(_BYTE *)&this->m_info & 7) == 4 && v4->m_nModelIndex == 530 )
    {
      m_nFlags = (RwFrame_0 *)v4[28].m_nFlags;
      if ( m_nFlags )
      {
        LTM = RwFrameGetLTM(m_nFlags);
        CMatrix::UpdateMatrix(&m, LTM);
      }
    }
    if ( pVecPos )
    {
      v11 = *(_QWORD *)&pVecPos->x;
      this->m_vecAttachPosnOffset.z = pVecPos->z;
      *(_QWORD *)&this->m_vecAttachPosnOffset.x = v11;
      if ( pQuat )
      {
LABEL_10:
        v12 = *(_QWORD *)&pQuat->imag.z;
        *(_QWORD *)&this->m_AttachQuat.imag.x = *(_QWORD *)&pQuat->imag.x;
        *(_QWORD *)&this->m_AttachQuat.imag.z = v12;
        goto LABEL_16;
      }
    }
    else
    {
      v13 = this->m_pMat;
      p_tx = (CSimpleTransform *)&v13->tx;
      if ( !v13 )
        p_tx = &this->m_transform;
      v15 = p_tx->m_translate.x - m.tx;
      v16 = p_tx->m_translate.y - m.ty;
      v17 = p_tx->m_translate.z - m.tz;
      this->m_vecAttachPosnOffset.x = (float)((float)(v15 * m.xx) + (float)(v16 * m.yx)) + (float)(v17 * m.zx);
      this->m_vecAttachPosnOffset.y = (float)((float)(v15 * m.xy) + (float)(v16 * m.yy)) + (float)(v17 * m.zy);
      this->m_vecAttachPosnOffset.z = (float)((float)(v15 * m.xz) + (float)(v16 * m.yz)) + (float)(v17 * m.zz);
      if ( pQuat )
        goto LABEL_10;
    }
    v23.m_pRwMat = 0;
    v23.m_owner = 0;
    Invert(&m, &v23);
    operator*(&v25, &v23, this->m_pMat);
    CMatrix::operator=(&v23, &v25);
    CMatrix::~CMatrix(&v25);
    CMatrix::CopyToRwMatrix(&v23, (RwMatrix *)&v25);
    RtQuatConvertFromMatrix(&this->m_AttachQuat, (const RwMatrix *const)&v25);
    CMatrix::~CMatrix(&v23);
LABEL_16:
    m_nPhysicalFlags = this->m_nPhysicalFlags;
    if ( (*(_BYTE *)&m_nPhysicalFlags & 4) != 0 )
    {
      m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags & 0xFFFFFFF7);
      this->m_nPhysicalFlags = m_nPhysicalFlags;
    }
    else if ( (unsigned __int8)((*(_BYTE *)&v4->m_info & 7) - 2) <= 2u
           && (LOBYTE(v4[1].m_transform.m_translate.y) & 4) != 0
           && (*(_BYTE *)&m_nPhysicalFlags & 0x40) == 0 )
    {
      if ( (*(_BYTE *)&this->m_info & 7) == 4 )
      {
        m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags | 4);
        this->m_nPhysicalFlags = m_nPhysicalFlags;
        this->m_fMass = 100000.0;
        this->m_fTurnMass = 100000.0;
      }
      if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) == 0 )
        goto LABEL_29;
      goto LABEL_26;
    }
    if ( (*(_BYTE *)&m_nPhysicalFlags & 0x40) == 0 )
    {
LABEL_29:
      this->m_pNOCollisionVehicle = this->m_pAttachToEntity;
      CPhysical::PositionAttachedEntity(this);
      CMatrix::~CMatrix(&m);
      return v4;
    }
LABEL_26:
    v19 = this->m_pMat;
    p_m_transform = (CSimpleTransform *)&v19->tx;
    if ( !v19 )
      p_m_transform = &this->m_transform;
    v21 = *(_QWORD *)&p_m_transform->m_translate.x;
    this->m_vecAttachTiltOffset.z = p_m_transform->m_translate.z;
    *(_QWORD *)&this->m_vecAttachTiltOffset.x = v21;
    goto LABEL_29;
  }
  return 0;
}

//----- (00407A68) --------------------------------------------------------
void __fastcall CPhysical::DettachEntityFromEntity(
        CPhysical *this,
        float height,
        float direction,
        float strength,
        int a5)
{
  CEntity *m_pAttachToEntity; // r6
  int v10; // r0
  bool v11; // zf
  CColModel *ColModel; // r0
  CCollisionData *m_pColData; // r5
  const CMatrix *m_pMat; // r11
  CColModel *v15; // r0
  CEntity *v16; // r0
  const CMatrix *v17; // r1
  float v18; // s16
  CEntity **p_m_pAttachToEntity; // r8
  float xy; // s18
  float yy; // s20
  float zy; // s22
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0
  float *pReferences; // r1
  __int64 v26; // d16
  float v27; // s4
  float v28; // s2
  float v29; // s0
  CEntity *v30; // r0
  __int64 v31; // d16
  float z; // s6
  RwReal v33; // s10
  CVector aColPoints; // [sp+0h] [bp-138h]
  CMatrix *v35; // [sp+14h] [bp-124h]
  CColModel *v36; // [sp+18h] [bp-120h]
  int8 m_nNoOfLines; // [sp+1Ch] [bp-11Ch]
  CMatrix v38; // [sp+20h] [bp-118h] BYREF
  CMatrix m2; // [sp+68h] [bp-D0h] BYREF
  CMatrix v40; // [sp+B0h] [bp-88h] BYREF
  CVector v41; // 0:r1.12

  m_pAttachToEntity = this->m_pAttachToEntity;
  m2.m_pRwMat = 0;
  m2.m_owner = 0;
  v38.m_pRwMat = 0;
  v38.m_owner = 0;
  if ( !m_pAttachToEntity )
    goto LABEL_5;
  v10 = *(_BYTE *)&this->m_info & 7;
  v11 = v10 == 2;
  if ( v10 == 2 )
    v11 = (*(_BYTE *)&m_pAttachToEntity->m_info & 7) == 2;
  if ( !v11 )
  {
LABEL_5:
    this->m_pNOCollisionVehicle = m_pAttachToEntity;
    goto LABEL_16;
  }
  ColModel = CEntity::GetColModel(this);
  m_pColData = ColModel->m_pColData;
  if ( m_pColData )
  {
    v36 = ColModel;
    m_nNoOfLines = m_pColData->_anon_0.m_nNoOfLines;
    m_pColData->_anon_0.m_nNoOfLines = 0;
    m_pMat = m_pAttachToEntity->m_pMat;
    v35 = this->m_pMat;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(m_pAttachToEntity);
      CSimpleTransform::UpdateMatrix(&m_pAttachToEntity->m_transform, m_pAttachToEntity->m_pMat);
      m_pMat = m_pAttachToEntity->m_pMat;
    }
    v15 = CEntity::GetColModel(m_pAttachToEntity);
    v11 = CCollision::ProcessColModels(v35, v36, m_pMat, v15, CWorld::m_aTempColPts, 0, 0, 0) == 0;
    v16 = m_pAttachToEntity;
    if ( v11 )
    {
      if ( this->m_pNOCollisionVehicle != m_pAttachToEntity )
        goto LABEL_15;
      v16 = 0;
    }
    this->m_pNOCollisionVehicle = v16;
LABEL_15:
    m_pColData->_anon_0.m_nNoOfLines = m_nNoOfLines;
    goto LABEL_16;
  }
  if ( this->m_pNOCollisionVehicle == m_pAttachToEntity )
    this->m_pNOCollisionVehicle = 0;
LABEL_16:
  CMatrix::ResetOrientation(&m2);
  CMatrix::RotateZ(&m2, direction);
  CMatrix::RotateX(&m2, height);
  v17 = m_pAttachToEntity->m_pMat;
  if ( !v17 )
  {
    CPlaceable::AllocateMatrix(m_pAttachToEntity);
    CSimpleTransform::UpdateMatrix(&m_pAttachToEntity->m_transform, m_pAttachToEntity->m_pMat);
    v17 = m_pAttachToEntity->m_pMat;
  }
  v18 = strength;
  p_m_pAttachToEntity = &this->m_pAttachToEntity;
  CMatrix::operator=(&v38, v17);
  operator*(&v40, &v38, &m2);
  CMatrix::operator=(&v38, &v40);
  CMatrix::~CMatrix(&v40);
  xy = v38.xy;
  yy = v38.yy;
  zy = v38.zy;
  CWorld::Remove(this);
  (*((void (__fastcall **)(CPhysical *, _DWORD))this->_vptr$CPlaceable + 5))(this, 0);
  *(_DWORD *)&this->m_nPhysicalFlags &= ~0x2000000u;
  CWorld::Add(this);
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 4) != 0 )
  {
    if ( (*(_BYTE *)&this->m_info & 7) == 4 && (pReferences = (float *)this[1].pReferences, *pReferences < 99998.0) )
    {
      m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags & 0xFFFFFFFB);
      this->m_nPhysicalFlags = m_nPhysicalFlags;
      this->m_fMass = *pReferences;
      this->m_fTurnMass = pReferences[1];
    }
    else
    {
      a5 = 0;
      m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags | 8);
      this->m_vecTurnSpeed.x = 0.0;
      this->m_vecTurnSpeed.y = 0.0;
      v26 = *(_QWORD *)&this->m_vecTurnSpeed.x;
      this->m_nPhysicalFlags = m_nPhysicalFlags;
      this->m_vecTurnSpeed.z = 0.0;
      this->m_vecMoveSpeed.z = 0.0;
      *(_QWORD *)&this->m_vecMoveSpeed.x = v26;
    }
  }
  v27 = zy * v18;
  v28 = yy * v18;
  v29 = xy * v18;
  if ( (*(_BYTE *)&m_nPhysicalFlags & 4) == 0 )
  {
    v30 = *p_m_pAttachToEntity;
    if ( (unsigned __int8)((*(_BYTE *)&(*p_m_pAttachToEntity)->m_info & 7) - 2) <= 2u )
    {
      v31 = *(_QWORD *)&v30[1].m_transform.m_translate.z;
      LODWORD(this->m_vecMoveSpeed.z) = v30[1].m_pMat;
      z = this->m_vecMoveSpeed.z;
      *(_QWORD *)&this->m_vecMoveSpeed.x = v31;
      v33 = v28 + this->m_vecMoveSpeed.y;
      this->m_vecMoveSpeed.x = v29 + this->m_vecMoveSpeed.x;
      this->m_vecMoveSpeed.y = v33;
      this->m_vecMoveSpeed.z = v27 + z;
    }
  }
  if ( a5 == 1 )
  {
    v41.z = zy * v18;
    v41.y = yy * v18;
    v41.x = xy * v18;
    aColPoints.x = v29 * 0.5;
    aColPoints.y = v28 * 0.5;
    aColPoints.z = v27 * 0.5;
    CPhysical::ApplyTurnForce(this, v41, aColPoints);
  }
  *(_QWORD *)p_m_pAttachToEntity = 0LL;
  *(_QWORD *)&this->m_vecAttachPosnOffset.y = 0LL;
  *(_QWORD *)&this->m_AttachQuat.imag.x = 0LL;
  *(_QWORD *)&this->m_AttachQuat.imag.z = 0LL;
  CMatrix::~CMatrix(&v38);
  CMatrix::~CMatrix(&m2);
}

//----- (00407CD0) --------------------------------------------------------
void __fastcall CPhysical::DettachAutoAttachedEntity(CPhysical *this)
{
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r1
  CEntity *m_pAttachToEntity; // r1
  CEntity **p_m_pAttachToEntity; // r0
  __int64 v5; // d16
  __int64 v6; // d16
  __int64 v7; // d16
  CEntity::CEntityInfo m_info; // r0

  (*((void (__fastcall **)(CPhysical *, _DWORD))this->_vptr$CPlaceable + 5))(this, 0);
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  this->m_nNoOfStaticFrames = 0;
  this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags & 0xFDFFFFFF);
  if ( (*(_BYTE *)&m_nPhysicalFlags & 4) != 0 )
  {
    this->m_vecTurnSpeed.x = 0.0;
    this->m_vecTurnSpeed.y = 0.0;
    v7 = *(_QWORD *)&this->m_vecTurnSpeed.x;
    this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags & 0xFDFFFFF7 | 8);
    p_m_pAttachToEntity = &this->m_pAttachToEntity;
    this->m_vecTurnSpeed.z = 0.0;
    this->m_vecMoveSpeed.z = 0.0;
    *(_QWORD *)&this->m_vecMoveSpeed.x = v7;
  }
  else
  {
    m_pAttachToEntity = this->m_pAttachToEntity;
    p_m_pAttachToEntity = &this->m_pAttachToEntity;
    if ( (*(_BYTE *)&m_pAttachToEntity->m_info & 7) == 2 )
    {
      v5 = *(_QWORD *)&m_pAttachToEntity[1].m_transform.m_translate.z;
      LODWORD(this->m_vecMoveSpeed.z) = m_pAttachToEntity[1].m_pMat;
      *(_QWORD *)&this->m_vecMoveSpeed.x = v5;
      v6 = *(_QWORD *)&m_pAttachToEntity[1].m_pRwObject;
      LODWORD(this->m_vecTurnSpeed.z) = m_pAttachToEntity[1].m_nFlags.bdummy;
      *(_QWORD *)&this->m_vecTurnSpeed.x = v6;
    }
  }
  this->m_pNOCollisionVehicle = 0;
  *p_m_pAttachToEntity = 0;
  m_info = this->m_info;
  *(_QWORD *)&this->m_AttachQuat.imag.x = 0LL;
  *(_QWORD *)&this->m_AttachQuat.imag.z = 0LL;
  this->m_vecAttachPosnOffset.x = 0.0;
  this->m_vecAttachPosnOffset.y = 0.0;
  this->m_vecAttachPosnOffset.z = 0.0;
  if ( (*(_BYTE *)&m_info & 7) == 4 )
    LODWORD(this->m_fElasticity) = this[1].pReferences[1].ppReferenceAddress;
}

//----- (00407D70) --------------------------------------------------------
float __fastcall CPhysical::GetLightingFromCol(const CPhysical *this, bool bLightForRender)
{
  _BOOL4 v2; // r4
  float m_lightingFromCollision; // s16
  float AmbientRed_BeforeBrightness; // s18
  float v5; // s18
  float v6; // s0

  v2 = bLightForRender;
  m_lightingFromCollision = this->m_lightingFromCollision;
  AmbientRed_BeforeBrightness = CTimeCycle::GetAmbientRed_BeforeBrightness();
  v5 = AmbientRed_BeforeBrightness + CTimeCycle::GetAmbientGreen_BeforeBrightness();
  v6 = m_lightingFromCollision + (float)((float)(v5 + CTimeCycle::GetAmbientBlue_BeforeBrightness()) * 0.33333);
  if ( !v2 )
    return (float)(v6
                 * (float)((float)(1.0 - TEST_ADD_AMBIENT_LIGHT_FRAC)
                         + (float)(TEST_ADD_AMBIENT_LIGHT_FRAC
                                 * (float)((float)((float)(CTimeCycle::m_CurrentColours.m_fPostFx1Red
                                                         + CTimeCycle::m_CurrentColours.m_fPostFx1Green)
                                                 + CTimeCycle::m_CurrentColours.m_fPostFx1Blue)
                                         / 765.0))))
         + (float)(TEST_ADD_AMBIENT_LIGHT_FRAC
                 * (float)((float)((float)(CTimeCycle::m_CurrentColours.m_fPostFx2Red
                                         + CTimeCycle::m_CurrentColours.m_fPostFx2Green)
                                 + CTimeCycle::m_CurrentColours.m_fPostFx2Blue)
                         / 765.0));
  return v6;
}

//----- (00407E28) --------------------------------------------------------
float __fastcall CPhysical::GetLightingTotal(const CPhysical *this)
{
  int v2; // r5
  float m_fMass; // r0
  bool v4; // zf
  float m_lightingFromCollision; // s16
  float AmbientRed_BeforeBrightness; // s18
  float v7; // s18
  float v8; // s0

  if ( this->m_areaCode )
    goto LABEL_2;
  if ( (*(_BYTE *)&this->m_info & 7) != 3 )
    goto LABEL_9;
  m_fMass = this[3].m_fMass;
  if ( m_fMass == 0.0 )
    goto LABEL_9;
  v4 = CGame::currArea == AREA_MAIN_MAP;
  if ( CGame::currArea == AREA_MAIN_MAP )
    v4 = *(_BYTE *)(LODWORD(m_fMass) + 134) == 0;
  if ( v4 )
LABEL_9:
    v2 = 0;
  else
LABEL_2:
    v2 = 1;
  m_lightingFromCollision = this->m_lightingFromCollision;
  AmbientRed_BeforeBrightness = CTimeCycle::GetAmbientRed_BeforeBrightness();
  v7 = AmbientRed_BeforeBrightness + CTimeCycle::GetAmbientGreen_BeforeBrightness();
  v8 = m_lightingFromCollision + (float)((float)(v7 + CTimeCycle::GetAmbientBlue_BeforeBrightness()) * 0.33333);
  if ( !v2 )
    v8 = (float)(v8
               * (float)((float)(1.0 - TEST_ADD_AMBIENT_LIGHT_FRAC)
                       + (float)(TEST_ADD_AMBIENT_LIGHT_FRAC
                               * (float)((float)((float)(CTimeCycle::m_CurrentColours.m_fPostFx1Red
                                                       + CTimeCycle::m_CurrentColours.m_fPostFx1Green)
                                               + CTimeCycle::m_CurrentColours.m_fPostFx1Blue)
                                       / 765.0))))
       + (float)(TEST_ADD_AMBIENT_LIGHT_FRAC
               * (float)((float)((float)(CTimeCycle::m_CurrentColours.m_fPostFx2Red
                                       + CTimeCycle::m_CurrentColours.m_fPostFx2Green)
                               + CTimeCycle::m_CurrentColours.m_fPostFx2Blue)
                       / 765.0));
  return v8 + this->m_lightingFromPointLights;
}

//----- (00407F20) --------------------------------------------------------
Bool8 __fastcall CPhysical::CanPhysicalBeDamaged(CPhysical *this, eWeaponType WeaponUsed, Bool8 *pBeingShotAt)
{
  Bool8 result; // r0

  if ( pBeingShotAt )
    *pBeingShotAt = 0;
  switch ( WeaponUsed )
  {
    case WEAPONTYPE_UNARMED:
    case WEAPONTYPE_BRASSKNUCKLE:
    case WEAPONTYPE_GOLFCLUB:
    case WEAPONTYPE_NIGHTSTICK:
    case WEAPONTYPE_KNIFE:
    case WEAPONTYPE_BASEBALLBAT:
    case WEAPONTYPE_SHOVEL:
    case WEAPONTYPE_POOL_CUE:
    case WEAPONTYPE_KATANA:
    case WEAPONTYPE_CHAINSAW:
    case WEAPONTYPE_DILDO1:
    case WEAPONTYPE_DILDO2:
    case WEAPONTYPE_VIBE1:
    case WEAPONTYPE_VIBE2:
    case WEAPONTYPE_FLOWERS:
    case WEAPONTYPE_CANE:
      if ( (*((_BYTE *)&this->m_nPhysicalFlags + 2) & 0x20) != 0 )
        goto LABEL_18;
      goto LABEL_5;
    case WEAPONTYPE_GRENADE:
    case WEAPONTYPE_ROCKET:
    case WEAPONTYPE_ROCKET_HS:
    case WEAPONTYPE_FREEFALL_BOMB:
    case WEAPONTYPE_ROCKETLAUNCHER:
    case WEAPONTYPE_ROCKETLAUNCHER_HS:
    case WEAPONTYPE_REMOTE_SATCHEL_CHARGE:
    case WEAPONTYPE_DETONATOR:
    case WEAPONTYPE_EXPLOSION:
      if ( (*((_BYTE *)&this->m_nPhysicalFlags + 2) & 0x80) == 0 )
        goto LABEL_9;
      goto LABEL_18;
    case WEAPONTYPE_MOLOTOV:
      if ( (*((_BYTE *)&this->m_nPhysicalFlags + 2) & 0x88) == 0 )
        goto LABEL_9;
      goto LABEL_18;
    case WEAPONTYPE_PISTOL:
    case WEAPONTYPE_PISTOL_SILENCED:
    case WEAPONTYPE_DESERT_EAGLE:
    case WEAPONTYPE_SHOTGUN:
    case WEAPONTYPE_SAWNOFF_SHOTGUN:
    case WEAPONTYPE_SPAS12_SHOTGUN:
    case WEAPONTYPE_MICRO_UZI:
    case WEAPONTYPE_MP5:
    case WEAPONTYPE_AK47:
    case WEAPONTYPE_M4:
    case WEAPONTYPE_TEC9:
    case WEAPONTYPE_COUNTRYRIFLE:
    case WEAPONTYPE_SNIPERRIFLE:
    case WEAPONTYPE_MINIGUN:
    case WEAPONTYPE_UZI_DRIVEBY:
      if ( (*((_BYTE *)&this->m_nPhysicalFlags + 2) & 4) != 0 )
        goto LABEL_18;
LABEL_9:
      if ( pBeingShotAt )
        *pBeingShotAt = 1;
      return 1;
    case WEAPONTYPE_FLAMETHROWER:
      if ( (*((_BYTE *)&this->m_nPhysicalFlags + 2) & 8) != 0 )
        goto LABEL_18;
      goto LABEL_5;
    case WEAPONTYPE_RAMMEDBYCAR:
    case WEAPONTYPE_RUNOVERBYCAR:
    case WEAPONTYPE_FALL:
      if ( (*((_BYTE *)&this->m_nPhysicalFlags + 2) & 0x10) == 0 )
        goto LABEL_5;
LABEL_18:
      result = 0;
      break;
    default:
LABEL_5:
      result = 1;
      break;
  }
  return result;
}

//----- (00407FB8) --------------------------------------------------------
void __fastcall CMatrixLink::Insert(CMatrixLink *this, CMatrixLink *pLink)
{
  pLink->m_pNext = this->m_pNext;
  this->m_pNext->m_pPrev = pLink;
  pLink->m_pPrev = this;
  this->m_pNext = pLink;
}

//----- (00407FC6) --------------------------------------------------------
void __fastcall CMatrixLink::Remove(CMatrixLink *this)
{
  this->m_pNext->m_pPrev = this->m_pPrev;
  this->m_pPrev->m_pNext = this->m_pNext;
}

//----- (00407FD4) --------------------------------------------------------
void __fastcall CMatrixLinkList::Init(CMatrixLinkList *this, int32 size)
{
  _DWORD *v4; // r0
  CMatrixLink *v5; // r2
  int v6; // r1
  _DWORD *v7; // r0
  CMatrixLink *p_m_firstFreeLink; // lr
  int v9; // r1
  CMatrixLink *v10; // r2
  int v11; // r5
  int v12; // r6
  int v13; // r5
  CMatrixLink *m_pStore; // r3
  CMatrixLink *v15; // r0

  v4 = (_DWORD *)operator new[](saturated_mul(0x54u, size));
  v5 = (CMatrixLink *)(v4 + 2);
  *v4 = 84;
  v4[1] = size;
  if ( size )
  {
    v6 = 84 * size;
    v7 = v4 + 19;
    do
    {
      *(v7 - 1) = 0;
      v6 -= 84;
      *v7 = 0;
      v7 += 21;
    }
    while ( v6 );
  }
  p_m_firstFreeLink = &this->m_firstFreeLink;
  this->m_firstLink1.m_pNext = &this->m_lastLink1;
  this->m_pStore = v5;
  this->m_firstLink2.m_pNext = &this->m_lastLink2;
  this->m_lastLink2.m_pPrev = &this->m_firstLink2;
  this->m_firstFreeLink.m_pNext = &this->m_lastFreeLink;
  this->m_lastFreeLink.m_pPrev = &this->m_firstFreeLink;
  this->m_lastLink1.m_pPrev = &this->m_firstLink1;
  if ( size )
  {
    v9 = size - 1;
    v10 = &v5[size - 1];
    v10->m_pNext = &this->m_lastFreeLink;
    this->m_firstFreeLink.m_pNext->m_pPrev = v10;
    v10->m_pPrev = p_m_firstFreeLink;
    this->m_firstFreeLink.m_pNext = v10;
    if ( size != 1 )
    {
      v11 = 84 * size;
      v12 = 1 - size;
      v13 = v11 - 168;
      do
      {
        m_pStore = this->m_pStore;
        --v9;
        ++v12;
        v15 = (CMatrixLink *)((char *)m_pStore + v13);
        v13 -= 84;
        v15->m_pNext = v10;
        v10 = &m_pStore[v9];
        this->m_firstFreeLink.m_pNext->m_pPrev = v15;
        v15->m_pPrev = p_m_firstFreeLink;
        this->m_firstFreeLink.m_pNext = v15;
      }
      while ( v12 );
    }
  }
}

//----- (004080AC) --------------------------------------------------------
void __fastcall CMatrixLinkList::Shutdown(CMatrixLinkList *this)
{
  CMatrixLink *m_pStore; // r0
  CMatrixLink *m_pNext; // r1
  CMatrixLink **p_m_pPrev; // r8
  CMatrixLink *v5; // r5
  int v6; // r6

  m_pStore = this->m_pStore;
  if ( m_pStore )
  {
    m_pNext = m_pStore[-1].m_pNext;
    p_m_pPrev = &m_pStore[-1].m_pPrev;
    if ( m_pNext )
    {
      v5 = m_pStore - 1;
      v6 = (int)m_pNext;
      do
        CMatrix::~CMatrix(&v5[v6--].matrix);
      while ( v6 * 84 );
    }
    operator delete[](p_m_pPrev);
  }
  this->m_pStore = 0;
}

//----- (004080EC) --------------------------------------------------------
CMatrixLink *__fastcall CMatrixLinkList::AddToList1(CMatrixLinkList *this)
{
  CMatrixLink *p_m_lastFreeLink; // r2
  CMatrixLink *result; // r0

  p_m_lastFreeLink = &this->m_lastFreeLink;
  result = this->m_firstFreeLink.m_pNext;
  if ( result == p_m_lastFreeLink )
    return 0;
  result->m_pNext->m_pPrev = result->m_pPrev;
  result->m_pPrev->m_pNext = result->m_pNext;
  result->m_pNext = this->m_firstLink1.m_pNext;
  this->m_firstLink1.m_pNext->m_pPrev = result;
  result->m_pPrev = &this->m_firstLink1;
  this->m_firstLink1.m_pNext = result;
  return result;
}

//----- (00408118) --------------------------------------------------------
CMatrixLink *__fastcall CMatrixLinkList::AddToList2(CMatrixLinkList *this)
{
  CMatrixLink *p_m_lastFreeLink; // r2
  CMatrixLink *result; // r0

  p_m_lastFreeLink = &this->m_lastFreeLink;
  result = this->m_firstFreeLink.m_pNext;
  if ( result == p_m_lastFreeLink )
    return 0;
  result->m_pNext->m_pPrev = result->m_pPrev;
  result->m_pPrev->m_pNext = result->m_pNext;
  result->m_pNext = this->m_firstLink2.m_pNext;
  this->m_firstLink2.m_pNext->m_pPrev = result;
  result->m_pPrev = &this->m_firstLink2;
  this->m_firstLink2.m_pNext = result;
  return result;
}

//----- (0040814E) --------------------------------------------------------
void __fastcall CMatrixLinkList::MoveToList1(CMatrixLinkList *this, CMatrixLink *pLink)
{
  pLink->m_pNext->m_pPrev = pLink->m_pPrev;
  pLink->m_pPrev->m_pNext = pLink->m_pNext;
  pLink->m_pNext = this->m_firstLink1.m_pNext;
  this->m_firstLink1.m_pNext->m_pPrev = pLink;
  pLink->m_pPrev = &this->m_firstLink1;
  this->m_firstLink1.m_pNext = pLink;
}

//----- (00408168) --------------------------------------------------------
void __fastcall CMatrixLinkList::MoveToList2(CMatrixLinkList *this, CMatrixLink *pLink)
{
  pLink->m_pNext->m_pPrev = pLink->m_pPrev;
  pLink->m_pPrev->m_pNext = pLink->m_pNext;
  pLink->m_pNext = this->m_firstLink2.m_pNext;
  this->m_firstLink2.m_pNext->m_pPrev = pLink;
  pLink->m_pPrev = &this->m_firstLink2;
  this->m_firstLink2.m_pNext = pLink;
}

//----- (0040818C) --------------------------------------------------------
void __fastcall CMatrixLinkList::MoveToFreeList(CMatrixLinkList *this, CMatrixLink *pLink)
{
  pLink->m_pNext->m_pPrev = pLink->m_pPrev;
  pLink->m_pPrev->m_pNext = pLink->m_pNext;
  pLink->m_pNext = this->m_firstFreeLink.m_pNext;
  this->m_firstFreeLink.m_pNext->m_pPrev = pLink;
  pLink->m_pPrev = &this->m_firstFreeLink;
  this->m_firstFreeLink.m_pNext = pLink;
}

//----- (004081B0) --------------------------------------------------------
int32 __fastcall CMatrixLinkList::GetNumFree(CMatrixLinkList *this)
{
  CMatrixLink *p_m_lastFreeLink; // r1
  CMatrixLink *m_pNext; // r2
  int32 result; // r0

  p_m_lastFreeLink = &this->m_lastFreeLink;
  m_pNext = this->m_firstFreeLink.m_pNext;
  result = 0;
  while ( m_pNext != p_m_lastFreeLink )
  {
    m_pNext = m_pNext->m_pNext;
    ++result;
  }
  return result;
}

//----- (004081C8) --------------------------------------------------------
int32 __fastcall CMatrixLinkList::GetNumUsed1(CMatrixLinkList *this)
{
  CMatrixLink *p_m_lastLink1; // r1
  CMatrixLink *m_pNext; // r2
  int32 result; // r0

  p_m_lastLink1 = &this->m_lastLink1;
  m_pNext = this->m_firstLink1.m_pNext;
  result = 0;
  while ( m_pNext != p_m_lastLink1 )
  {
    m_pNext = m_pNext->m_pNext;
    ++result;
  }
  return result;
}

//----- (004081DE) --------------------------------------------------------
int32 __fastcall CMatrixLinkList::GetNumUsed2(CMatrixLinkList *this)
{
  CMatrixLink *p_m_lastLink2; // r1
  CMatrixLink *m_pNext; // r2
  int32 result; // r0

  p_m_lastLink2 = &this->m_lastLink2;
  m_pNext = this->m_firstLink2.m_pNext;
  result = 0;
  while ( m_pNext != p_m_lastLink2 )
  {
    m_pNext = m_pNext->m_pNext;
    ++result;
  }
  return result;
}

//----- (004081F8) --------------------------------------------------------
void __fastcall PrintNumMatrices(unsigned __int8 *pChar)
{
  CMatrixLinkList *m_pNext; // r1
  int v2; // r2
  CMatrixLinkList *v3; // lr
  int v4; // r3
  CMatrixLinkList *v5; // r4
  int v6; // r12

  m_pNext = (CMatrixLinkList *)gMatrixList.m_firstFreeLink.m_pNext;
  if ( gMatrixList.m_firstFreeLink.m_pNext == &gMatrixList.m_lastFreeLink )
  {
    v2 = 0;
  }
  else
  {
    v2 = 0;
    do
    {
      m_pNext = (CMatrixLinkList *)m_pNext->m_firstLink1.m_pNext;
      ++v2;
    }
    while ( m_pNext != (CMatrixLinkList *)&gMatrixList.m_lastFreeLink );
  }
  v3 = (CMatrixLinkList *)gMatrixList.m_firstLink1.m_pNext;
  if ( gMatrixList.m_firstLink1.m_pNext == &gMatrixList.m_lastLink1 )
  {
    v4 = 0;
  }
  else
  {
    v4 = 0;
    do
    {
      v3 = (CMatrixLinkList *)v3->m_firstLink1.m_pNext;
      ++v4;
    }
    while ( v3 != (CMatrixLinkList *)&gMatrixList.m_lastLink1 );
  }
  v5 = (CMatrixLinkList *)gMatrixList.m_firstLink2.m_pNext;
  if ( gMatrixList.m_firstLink2.m_pNext == &gMatrixList.m_lastLink2 )
  {
    v6 = 0;
  }
  else
  {
    v6 = 0;
    do
    {
      v5 = (CMatrixLinkList *)v5->m_firstLink1.m_pNext;
      ++v6;
    }
    while ( v5 != (CMatrixLinkList *)&gMatrixList.m_lastLink2 );
  }
  sprintf(pChar, "Free %d, Used %d, Used2 %d", v2, v4, v6);
}

//----- (004082C8) --------------------------------------------------------
RwV3d_0 *__fastcall TransformPoint(RwV3d_0 *retstr, const CSimpleTransform *t, const RwV3d_0 *v)
{
  float m_heading; // r6
  float v7; // r9
  RwV3d_0 *result; // r0
  float y; // s2
  float v10; // s8
  float v11; // s0
  RwReal v12; // s2
  RwReal v13; // s0

  m_heading = t->m_heading;
  v7 = cosf(m_heading);
  *(float *)&result = sinf(m_heading);
  y = v->y;
  v10 = (float)(v7 * v->x) - (float)(*(float *)&result * y);
  v11 = (float)(*(float *)&result * v->x) + (float)(v7 * y);
  v12 = v->z + t->m_translate.z;
  v13 = t->m_translate.y + v11;
  retstr->x = t->m_translate.x + v10;
  retstr->y = v13;
  retstr->z = v12;
  return result;
}

//----- (0040833C) --------------------------------------------------------
void __fastcall TransformPoint(RwV3d_0 *result, const CSimpleTransform *t, const RwV3d_0 *v)
{
  float m_heading; // r4
  float v7; // r9
  float v8; // r0

  m_heading = t->m_heading;
  v7 = cosf(m_heading);
  v8 = sinf(m_heading);
  result->x = t->m_translate.x + (float)((float)(v7 * v->x) - (float)(v8 * v->y));
  result->y = t->m_translate.y + (float)((float)(v8 * v->x) + (float)(v7 * v->y));
  result->z = v->z + t->m_translate.z;
}

//----- (004083B8) --------------------------------------------------------
void __fastcall TransformPoints(RwV3d_0 *pResult, int32 num, const CSimpleTransform *t, const RwV3d_0 *pSource)
{
  float m_heading; // r10
  float v9; // r9
  float i; // r0
  float z; // s6

  m_heading = t->m_heading;
  v9 = cosf(m_heading);
  for ( i = sinf(m_heading); num; ++pResult )
  {
    --num;
    pResult->x = t->m_translate.x + (float)((float)(v9 * pSource->x) - (float)(i * pSource->y));
    pResult->y = t->m_translate.y + (float)((float)(i * pSource->x) + (float)(v9 * pSource->y));
    z = pSource->z;
    ++pSource;
    pResult->z = z + t->m_translate.z;
  }
}

//----- (00408446) --------------------------------------------------------
RwV3d_0 *__fastcall TransformVector(RwV3d_0 *retstr, const CSimpleTransform *t, const RwV3d_0 *v)
{
  float m_heading; // r6
  float v6; // s20
  float x; // s16
  float y; // s18
  float v9; // r0
  RwV3d_0 *result; // r0

  m_heading = t->m_heading;
  v6 = cosf(m_heading);
  x = v->x;
  y = v->y;
  v9 = sinf(m_heading);
  retstr->x = (float)(v6 * x) - (float)(v9 * y);
  retstr->y = (float)(v9 * x) + (float)(v6 * y);
  result = (RwV3d_0 *)LODWORD(v->z);
  LODWORD(retstr->z) = result;
  return result;
}

//----- (004084A2) --------------------------------------------------------
void __fastcall TransformVector(RwV3d_0 *result, const CSimpleTransform *t, const RwV3d_0 *v)
{
  float m_heading; // r6
  float v6; // r8
  float v7; // r0

  m_heading = t->m_heading;
  v6 = cosf(m_heading);
  v7 = sinf(m_heading);
  result->x = (float)(v6 * v->x) - (float)(v7 * v->y);
  result->y = (float)(v7 * v->x) + (float)(v6 * v->y);
  result->z = v->z;
}

//----- (00408500) --------------------------------------------------------
void __fastcall TransformVectors(RwV3d_0 *pResult, int32 num, const CSimpleTransform *t, const RwV3d_0 *pSource)
{
  float m_heading; // r9
  float v8; // r8
  float v9; // r0
  float v10; // s0
  RwReal z; // r0

  m_heading = t->m_heading;
  v8 = cosf(m_heading);
  v9 = sinf(m_heading);
  if ( num )
  {
    v10 = v9;
    do
    {
      --num;
      pResult->x = (float)(v8 * pSource->x) - (float)(v10 * pSource->y);
      pResult->y = (float)(v10 * pSource->x) + (float)(v8 * pSource->y);
      z = pSource->z;
      ++pSource;
      pResult->z = z;
      ++pResult;
    }
    while ( num );
  }
}

//----- (00408570) --------------------------------------------------------
void __fastcall TransformVectors(RwV3d_0 *pResult, int32 num, const CMatrix *m, const RwV3d_0 *pSource)
{
  CMatrix::CopyToRwMatrix(m, CGame::m_pWorkingMatrix1);
  RwMatrixUpdate(CGame::m_pWorkingMatrix1);
  for ( ; num; --num )
    RwV3dTransformVector(pResult++, pSource++, CGame::m_pWorkingMatrix1);
}

//----- (004085C4) --------------------------------------------------------
void __fastcall TransformPoints(RwV3d_0 *pResult, int32 num, const CMatrix *m, const RwV3d_0 *pSource)
{
  CMatrix::CopyToRwMatrix(m, CGame::m_pWorkingMatrix1);
  RwMatrixUpdate(CGame::m_pWorkingMatrix1);
  for ( ; num; --num )
    RwV3dTransformPoint(pResult++, pSource++, CGame::m_pWorkingMatrix1);
}

//----- (00408618) --------------------------------------------------------
void __fastcall CSimpleTransform::UpdateRwMatrix(const CSimpleTransform *this, RwMatrix *pMatrix)
{
  float m_heading; // r6
  float v5; // r0
  RwReal v6; // s16
  float v7; // r0

  m_heading = this->m_heading;
  pMatrix->right.z = 0.0;
  v5 = sinf(m_heading);
  pMatrix->up.z = 0.0;
  pMatrix->at.x = 0.0;
  pMatrix->at.y = 0.0;
  v6 = -v5;
  pMatrix->at.z = 1.0;
  pMatrix->right.y = v5;
  v7 = cosf(m_heading);
  pMatrix->right.x = v7;
  pMatrix->up.y = v7;
  pMatrix->up.x = v6;
  pMatrix->pos = (RwV3d_0)this->m_translate;
  sub_196158(pMatrix);
}

//----- (0040867C) --------------------------------------------------------
void __fastcall CSimpleTransform::UpdateMatrix(const CSimpleTransform *this, CMatrix *pMatrix)
{
  CMatrix::SetTranslate(pMatrix, this->m_translate.x, this->m_translate.y, this->m_translate.z);
  sub_198CB0(pMatrix, this->m_heading);
}

//----- (0040869A) --------------------------------------------------------
void __fastcall CSimpleTransform::Invert(CSimpleTransform *this, const CSimpleTransform *orig)
{
  float m_heading; // r6
  float v5; // r8
  float v6; // r0

  m_heading = orig->m_heading;
  v5 = cosf(m_heading);
  v6 = sinf(m_heading);
  this->m_translate.x = (float)-(float)(v5 * orig->m_translate.x) - (float)(v6 * orig->m_translate.y);
  this->m_translate.y = (float)(v6 * orig->m_translate.x) - (float)(v5 * orig->m_translate.y);
  this->m_translate.z = -orig->m_translate.z;
  this->m_heading = -orig->m_heading;
}

//----- (0040870C) --------------------------------------------------------
void __fastcall CPlaceable::CPlaceable(CPlaceable *this)
{
  *(_QWORD *)&this->m_transform.m_translate.x = 0LL;
  *(_QWORD *)&this->m_transform.m_translate.z = 0LL;
  this->m_pMat = 0;
  this->_vptr$CPlaceable = (int (**)(void))&off_667D14;
}
// 667D14: using guessed type void *off_667D14;

//----- (0040872C) --------------------------------------------------------
void __fastcall CPlaceable::~CPlaceable(CPlaceable *this)
{
  CMatrix *m_pMat; // r5
  RwReal tx; // r6
  RwReal ty; // r8
  RwReal tz; // r9
  float v6; // r0
  __int64 v7; // kr00_8

  m_pMat = this->m_pMat;
  this->_vptr$CPlaceable = (int (**)(void))&off_667D14;
  if ( m_pMat )
  {
    tx = m_pMat->tx;
    ty = m_pMat->ty;
    tz = m_pMat->tz;
    v6 = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
    this->m_transform.m_translate.x = tx;
    this->m_transform.m_translate.y = ty;
    this->m_transform.m_translate.z = tz;
    *(_QWORD *)&this->m_transform.m_heading = LODWORD(v6);
    v7 = *(_QWORD *)&m_pMat[1].yx;
    m_pMat[1].xx = 0.0;
    *(_DWORD *)(HIDWORD(v7) + 76) = v7;
    *(float *)(LODWORD(m_pMat[1].yx) + 80) = m_pMat[1].zx;
    LODWORD(m_pMat[1].zx) = gMatrixList.m_firstFreeLink.m_pNext;
    gMatrixList.m_firstFreeLink.m_pNext->m_pPrev = (CMatrixLink *)m_pMat;
    LODWORD(m_pMat[1].yx) = &gMatrixList.m_firstFreeLink;
    gMatrixList.m_firstFreeLink.m_pNext = (CMatrixLink *)m_pMat;
    --numMatrices;
  }
  this->m_pMat = &gDummyMatrix;
}
// 667D14: using guessed type void *off_667D14;

//----- (004087C0) --------------------------------------------------------
void __fastcall CPlaceable::RemoveMatrix(CPlaceable *this)
{
  CMatrix *m_pMat; // r5
  RwReal tx; // r6
  RwReal ty; // r8
  RwReal tz; // r9
  float v6; // r0
  __int64 v7; // kr00_8

  m_pMat = this->m_pMat;
  tx = m_pMat->tx;
  ty = m_pMat->ty;
  tz = m_pMat->tz;
  v6 = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
  this->m_transform.m_translate.x = tx;
  this->m_transform.m_translate.y = ty;
  this->m_transform.m_translate.z = tz;
  *(_QWORD *)&this->m_transform.m_heading = LODWORD(v6);
  v7 = *(_QWORD *)&m_pMat[1].yx;
  m_pMat[1].xx = 0.0;
  *(_DWORD *)(HIDWORD(v7) + 76) = v7;
  *(float *)(LODWORD(m_pMat[1].yx) + 80) = m_pMat[1].zx;
  LODWORD(m_pMat[1].zx) = gMatrixList.m_firstFreeLink.m_pNext;
  gMatrixList.m_firstFreeLink.m_pNext->m_pPrev = (CMatrixLink *)m_pMat;
  LODWORD(m_pMat[1].yx) = &gMatrixList.m_firstFreeLink;
  gMatrixList.m_firstFreeLink.m_pNext = (CMatrixLink *)m_pMat;
}

//----- (00408820) --------------------------------------------------------
void __fastcall CPlaceable::~CPlaceable(CPlaceable *this)
{
  CMatrix *m_pMat; // r5
  RwReal tx; // r6
  RwReal ty; // r8
  RwReal tz; // r9
  float v6; // r0
  __int64 v7; // kr00_8

  m_pMat = this->m_pMat;
  this->_vptr$CPlaceable = (int (**)(void))&off_667D14;
  if ( m_pMat )
  {
    tx = m_pMat->tx;
    ty = m_pMat->ty;
    tz = m_pMat->tz;
    v6 = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
    this->m_transform.m_translate.x = tx;
    this->m_transform.m_translate.y = ty;
    this->m_transform.m_translate.z = tz;
    *(_QWORD *)&this->m_transform.m_heading = LODWORD(v6);
    v7 = *(_QWORD *)&m_pMat[1].yx;
    m_pMat[1].xx = 0.0;
    *(_DWORD *)(HIDWORD(v7) + 76) = v7;
    *(float *)(LODWORD(m_pMat[1].yx) + 80) = m_pMat[1].zx;
    LODWORD(m_pMat[1].zx) = gMatrixList.m_firstFreeLink.m_pNext;
    gMatrixList.m_firstFreeLink.m_pNext->m_pPrev = (CMatrixLink *)m_pMat;
    LODWORD(m_pMat[1].yx) = &gMatrixList.m_firstFreeLink;
    gMatrixList.m_firstFreeLink.m_pNext = (CMatrixLink *)m_pMat;
    --numMatrices;
  }
  sub_191374(this);
}
// 667D14: using guessed type void *off_667D14;

//----- (004088AC) --------------------------------------------------------
void __fastcall CPlaceable::SetMatrix(CPlaceable *this, const CMatrix *mat)
{
  CMatrix *m_pMat; // r0
  __int64 v5; // kr00_8
  float tz; // r5
  float v7; // r0

  m_pMat = this->m_pMat;
  if ( m_pMat )
    goto LABEL_2;
  if ( mat->zz != 1.0 )
  {
    CPlaceable::AllocateMatrix(this);
    m_pMat = this->m_pMat;
LABEL_2:
    CMatrix::operator=(m_pMat, mat);
    return;
  }
  v5 = *(_QWORD *)&mat->tx;
  tz = mat->tz;
  v7 = atan2f(COERCE_FLOAT(LODWORD(mat->xy) ^ 0x80000000), mat->yy);
  *(_QWORD *)&this->m_transform.m_translate.x = v5;
  this->m_transform.m_translate.z = tz;
  this->m_transform.m_heading = v7;
}

//----- (00408904) --------------------------------------------------------
void __fastcall CPlaceable::AllocateMatrix(CPlaceable *this)
{
  CMatrixLink *m_pMat; // r0
  CPlaceable *pPlaceable; // r4
  CMatrix *v4; // r5
  RwReal tx; // r9
  RwReal ty; // r10
  RwReal tz; // r11
  float v8; // r1
  __int64 v9; // kr00_8

  m_pMat = (CMatrixLink *)this->m_pMat;
  if ( !m_pMat )
  {
    m_pMat = gMatrixList.m_firstFreeLink.m_pNext;
    if ( gMatrixList.m_firstFreeLink.m_pNext == &gMatrixList.m_lastFreeLink
      || (gMatrixList.m_firstFreeLink.m_pNext->m_pNext->m_pPrev = gMatrixList.m_firstFreeLink.m_pNext->m_pPrev,
          m_pMat->m_pPrev->m_pNext = m_pMat->m_pNext,
          m_pMat->m_pNext = gMatrixList.m_firstLink1.m_pNext,
          gMatrixList.m_firstLink1.m_pNext->m_pPrev = m_pMat,
          m_pMat->m_pPrev = (CMatrixLink *)&gMatrixList,
          (gMatrixList.m_firstLink1.m_pNext = m_pMat) == 0) )
    {
      pPlaceable = gMatrixList.m_lastLink1.m_pPrev->pPlaceable;
      v4 = pPlaceable->m_pMat;
      tx = v4->tx;
      ty = v4->ty;
      tz = v4->tz;
      v8 = atan2f(COERCE_FLOAT(LODWORD(v4->xy) ^ 0x80000000), v4->yy);
      m_pMat = 0;
      pPlaceable->m_transform.m_translate.x = tx;
      pPlaceable->m_transform.m_translate.y = ty;
      pPlaceable->m_transform.m_translate.z = tz;
      pPlaceable->m_transform.m_heading = v8;
      pPlaceable->m_pMat = 0;
      v9 = *(_QWORD *)&v4[1].yx;
      v4[1].xx = 0.0;
      *(_DWORD *)(HIDWORD(v9) + 76) = v9;
      *(float *)(LODWORD(v4[1].yx) + 80) = v4[1].zx;
      LODWORD(v4[1].zx) = gMatrixList.m_firstFreeLink.m_pNext;
      gMatrixList.m_firstFreeLink.m_pNext->m_pPrev = (CMatrixLink *)v4;
      LODWORD(v4[1].yx) = &gMatrixList.m_firstFreeLink;
      gMatrixList.m_firstFreeLink.m_pNext = (CMatrixLink *)v4;
      if ( v4 != (CMatrix *)&gMatrixList.m_lastFreeLink )
      {
        *(float *)(LODWORD(v4[1].zx) + 76) = v4[1].yx;
        *(float *)(LODWORD(v4[1].yx) + 80) = v4[1].zx;
        LODWORD(v4[1].zx) = gMatrixList.m_firstLink1.m_pNext;
        gMatrixList.m_firstLink1.m_pNext->m_pPrev = (CMatrixLink *)v4;
        m_pMat = (CMatrixLink *)v4;
        LODWORD(v4[1].yx) = &gMatrixList;
        gMatrixList.m_firstLink1.m_pNext = (CMatrixLink *)v4;
      }
    }
    m_pMat->pPlaceable = this;
    this->m_pMat = &m_pMat->matrix;
  }
  sub_19E4B4(&m_pMat->matrix);
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004089F0) --------------------------------------------------------
int __fastcall CPlaceable::IsWithinArea(const CPlaceable *this, float x1, float y1, float x2, float y2)
{
  float32x2_t v5; // d1
  float32x2_t v6; // d2
  float32x2_t v7; // d3
  float32x2_t v8; // d4
  CMatrix *m_pMat; // r1
  float v10; // s0
  CSimpleTransform *p_tx; // r2
  float v12; // s2
  float v13; // s6
  float v14; // s4
  float x; // s8
  char v16; // r1
  float y; // s10
  char v18; // r2
  int v19; // r0
  int v20; // r1

  v5.n64_f32[0] = y2;
  v7.n64_f32[0] = y1;
  v8.n64_f32[0] = x1;
  m_pMat = this->m_pMat;
  v6.n64_f32[0] = x2;
  LODWORD(v10) = vmax_f32(v7, v5).n64_u32[0];
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  LODWORD(v12) = vmin_f32(v7, v5).n64_u32[0];
  LODWORD(v13) = vmax_f32(v8, v6).n64_u32[0];
  if ( !m_pMat )
    p_tx = &this->m_transform;
  LODWORD(v14) = vmin_f32(v8, v6).n64_u32[0];
  x = p_tx->m_translate.x;
  v16 = 0;
  y = p_tx->m_translate.y;
  v18 = 0;
  v19 = 0;
  if ( x <= v13 )
    v16 = 1;
  if ( x >= v14 )
    v18 = 1;
  v20 = (unsigned __int8)(v16 & v18) & (y >= v12);
  if ( y <= v10 )
    v19 = 1;
  return v19 & v20;
}
// 408A02: variable 'v7' is possibly undefined
// 408A02: variable 'v5' is possibly undefined
// 408A10: variable 'v8' is possibly undefined
// 408A10: variable 'v6' is possibly undefined

//----- (00408A6A) --------------------------------------------------------
int __fastcall CPlaceable::IsWithinArea(
        const CPlaceable *this,
        float x1,
        float y1,
        float z1,
        float x2,
        float y2,
        float z2)
{
  float32x2_t v7; // d1
  float32x2_t v8; // d2
  float32x2_t v9; // d3
  float32x2_t v10; // d4
  float32x2_t v11; // d5
  float32x2_t v12; // d6
  CMatrix *m_pMat; // r1
  float v14; // s0
  float v15; // s2
  float v16; // s4
  CSimpleTransform *p_tx; // r2
  float v18; // s6
  float v19; // s10
  float v20; // s8
  float x; // s12
  char v22; // r1
  float y; // s14
  float z; // s13
  char v25; // r2
  int v26; // r0
  int v27; // r1

  v7.n64_f32[0] = z2;
  v8.n64_f32[0] = z1;
  v11.n64_f32[0] = y2;
  v10.n64_f32[0] = x1;
  v12.n64_f32[0] = x2;
  v9.n64_f32[0] = y1;
  m_pMat = this->m_pMat;
  LODWORD(v14) = vmax_f32(v8, v7).n64_u32[0];
  LODWORD(v15) = vmin_f32(v8, v7).n64_u32[0];
  LODWORD(v16) = vmax_f32(v9, v11).n64_u32[0];
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  LODWORD(v18) = vmin_f32(v9, v11).n64_u32[0];
  LODWORD(v19) = vmax_f32(v10, v12).n64_u32[0];
  if ( !m_pMat )
    p_tx = &this->m_transform;
  LODWORD(v20) = vmin_f32(v10, v12).n64_u32[0];
  x = p_tx->m_translate.x;
  v22 = 0;
  y = p_tx->m_translate.y;
  z = p_tx->m_translate.z;
  v25 = 0;
  v26 = 0;
  if ( x <= v19 )
    v22 = 1;
  if ( x >= v20 )
    v25 = 1;
  v27 = (unsigned __int8)(v22 & v25) & (y >= v18) & (y <= v16) & (z >= v15);
  if ( z <= v14 )
    v26 = 1;
  return v26 & v27;
}
// 408A84: variable 'v8' is possibly undefined
// 408A84: variable 'v7' is possibly undefined
// 408A8C: variable 'v9' is possibly undefined
// 408A8C: variable 'v11' is possibly undefined
// 408A9A: variable 'v10' is possibly undefined
// 408A9A: variable 'v12' is possibly undefined

//----- (00408B20) --------------------------------------------------------
void CPlaceable::InitMatrixArray()
{
  int v0; // r0
  _DWORD *v1; // r2
  int *v2; // r4
  char *v3; // r1
  CMatrixLink *v4; // lr
  int *v5; // r1
  int v6; // r2
  CMatrixLink *m_pStore; // r5
  CMatrixLink *v8; // r4

  v0 = operator new[]((unsigned int)&elf_hash_chain[2428]);
  *(_DWORD *)v0 = 84;
  *(_DWORD *)(v0 + 4) = 900;
  v1 = (_DWORD *)(v0 + 76);
  v2 = &elf_hash_chain[2426];
  do
  {
    *(v1 - 1) = 0;
    v2 -= 21;
    *v1 = 0;
    v1 += 21;
  }
  while ( v2 );
  gMatrixList.m_firstLink1.m_pNext = &gMatrixList.m_lastLink1;
  gMatrixList.m_pStore = (CMatrixLink *)(v0 + 8);
  gMatrixList.m_firstLink2.m_pNext = &gMatrixList.m_lastLink2;
  gMatrixList.m_lastLink2.m_pPrev = &gMatrixList.m_firstLink2;
  v3 = (char *)&elf_hash_chain[2426] + v0;
  gMatrixList.m_lastLink1.m_pPrev = (CMatrixLink *)&gMatrixList;
  v4 = (CMatrixLink *)((char *)&elf_hash_chain[2386] + v0);
  *((_DWORD *)v3 + 1) = &gMatrixList.m_lastFreeLink;
  gMatrixList.m_lastFreeLink.m_pPrev = (CMatrixLink *)((char *)&elf_hash_chain[2407] + v0);
  gMatrixList.m_firstFreeLink.m_pNext = (CMatrixLink *)((char *)&elf_hash_chain[2407] + v0);
  *(int *)((char *)&elf_hash_chain[2426] + v0) = (int)&gMatrixList.m_firstFreeLink;
  *((_DWORD *)v3 - 20) = (char *)&elf_hash_chain[2407] + v0;
  gMatrixList.m_firstFreeLink.m_pNext->m_pPrev = v4;
  *((_DWORD *)v3 - 21) = &gMatrixList.m_firstFreeLink;
  v5 = &elf_hash_chain[2363];
  gMatrixList.m_firstFreeLink.m_pNext = v4;
  v6 = 898;
  do
  {
    m_pStore = gMatrixList.m_pStore;
    --v6;
    v8 = (CMatrixLink *)((char *)gMatrixList.m_pStore + (unsigned int)v5);
    v5 -= 21;
    v8->m_pNext = v4;
    v4 = &m_pStore[v6];
    gMatrixList.m_firstFreeLink.m_pNext->m_pPrev = v8;
    v8->m_pPrev = &gMatrixList.m_firstFreeLink;
    gMatrixList.m_firstFreeLink.m_pNext = v8;
  }
  while ( v5 != (int *)-84 );
}
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];

//----- (00408BF4) --------------------------------------------------------
void CPlaceable::ShutdownMatrixArray()
{
  CMatrixLink *m_pNext; // r1
  CMatrixLink **p_m_pPrev; // r4
  CMatrixLink *v2; // r6
  int v3; // r5

  if ( gMatrixList.m_pStore )
  {
    m_pNext = gMatrixList.m_pStore[-1].m_pNext;
    p_m_pPrev = &gMatrixList.m_pStore[-1].m_pPrev;
    if ( m_pNext )
    {
      v2 = gMatrixList.m_pStore - 1;
      v3 = (int)m_pNext;
      do
        CMatrix::~CMatrix(&v2[v3--].matrix);
      while ( v3 * 84 );
    }
    operator delete[](p_m_pPrev);
  }
  gMatrixList.m_pStore = 0;
}

//----- (00408C4C) --------------------------------------------------------
void __fastcall CPlaceable::AllocateStaticMatrix(CPlaceable *this)
{
  CMatrixLink *m_pMat; // r0
  CMatrixLink *m_pNext; // r0
  CPlaceable *pPlaceable; // r4
  CMatrix *v5; // r5
  RwReal tx; // r9
  RwReal ty; // r10
  RwReal tz; // r11
  float v9; // r1
  __int64 v10; // kr00_8

  m_pMat = (CMatrixLink *)this->m_pMat;
  if ( m_pMat )
  {
    m_pMat->m_pNext->m_pPrev = m_pMat->m_pPrev;
    m_pMat->m_pPrev->m_pNext = m_pMat->m_pNext;
    m_pMat->m_pNext = gMatrixList.m_firstLink2.m_pNext;
    gMatrixList.m_firstLink2.m_pNext->m_pPrev = m_pMat;
    m_pMat->m_pPrev = &gMatrixList.m_firstLink2;
    gMatrixList.m_firstLink2.m_pNext = m_pMat;
  }
  else
  {
    m_pNext = gMatrixList.m_firstFreeLink.m_pNext;
    if ( gMatrixList.m_firstFreeLink.m_pNext == &gMatrixList.m_lastFreeLink
      || (gMatrixList.m_firstFreeLink.m_pNext->m_pNext->m_pPrev = gMatrixList.m_firstFreeLink.m_pNext->m_pPrev,
          m_pNext->m_pPrev->m_pNext = m_pNext->m_pNext,
          m_pNext->m_pNext = gMatrixList.m_firstLink2.m_pNext,
          gMatrixList.m_firstLink2.m_pNext->m_pPrev = m_pNext,
          m_pNext->m_pPrev = &gMatrixList.m_firstLink2,
          (gMatrixList.m_firstLink2.m_pNext = m_pNext) == 0) )
    {
      pPlaceable = gMatrixList.m_lastLink1.m_pPrev->pPlaceable;
      v5 = pPlaceable->m_pMat;
      tx = v5->tx;
      ty = v5->ty;
      tz = v5->tz;
      v9 = atan2f(COERCE_FLOAT(LODWORD(v5->xy) ^ 0x80000000), v5->yy);
      m_pNext = 0;
      pPlaceable->m_transform.m_translate.x = tx;
      pPlaceable->m_transform.m_translate.y = ty;
      pPlaceable->m_transform.m_translate.z = tz;
      pPlaceable->m_transform.m_heading = v9;
      pPlaceable->m_pMat = 0;
      v10 = *(_QWORD *)&v5[1].yx;
      v5[1].xx = 0.0;
      *(_DWORD *)(HIDWORD(v10) + 76) = v10;
      *(float *)(LODWORD(v5[1].yx) + 80) = v5[1].zx;
      LODWORD(v5[1].zx) = gMatrixList.m_firstFreeLink.m_pNext;
      gMatrixList.m_firstFreeLink.m_pNext->m_pPrev = (CMatrixLink *)v5;
      LODWORD(v5[1].yx) = &gMatrixList.m_firstFreeLink;
      gMatrixList.m_firstFreeLink.m_pNext = (CMatrixLink *)v5;
      if ( v5 != (CMatrix *)&gMatrixList.m_lastFreeLink )
      {
        *(float *)(LODWORD(v5[1].zx) + 76) = v5[1].yx;
        *(float *)(LODWORD(v5[1].yx) + 80) = v5[1].zx;
        LODWORD(v5[1].zx) = gMatrixList.m_firstLink2.m_pNext;
        gMatrixList.m_firstLink2.m_pNext->m_pPrev = (CMatrixLink *)v5;
        LODWORD(v5[1].yx) = &gMatrixList.m_firstLink2;
        m_pNext = (CMatrixLink *)v5;
        gMatrixList.m_firstLink2.m_pNext = (CMatrixLink *)v5;
      }
    }
    m_pNext->pPlaceable = this;
    this->m_pMat = &m_pNext->matrix;
    sub_19E4B4(&m_pNext->matrix);
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00408D7C) --------------------------------------------------------
void __fastcall CPlaceable::FreeStaticMatrix(CPlaceable *this)
{
  CMatrixLink *m_pMat; // r0

  m_pMat = (CMatrixLink *)this->m_pMat;
  m_pMat->m_pNext->m_pPrev = m_pMat->m_pPrev;
  m_pMat->m_pPrev->m_pNext = m_pMat->m_pNext;
  m_pMat->m_pNext = gMatrixList.m_firstLink1.m_pNext;
  gMatrixList.m_firstLink1.m_pNext->m_pPrev = m_pMat;
  m_pMat->m_pPrev = (CMatrixLink *)&gMatrixList;
  gMatrixList.m_firstLink1.m_pNext = m_pMat;
}

//----- (00408DA4) --------------------------------------------------------
void __fastcall CMatrixLinkList::~CMatrixLinkList(CMatrixLinkList *this)
{
  CMatrix::~CMatrix(&this->m_lastFreeLink.matrix);
  CMatrix::~CMatrix(&this->m_firstFreeLink.matrix);
  CMatrix::~CMatrix(&this->m_lastLink2.matrix);
  CMatrix::~CMatrix(&this->m_firstLink2.matrix);
  CMatrix::~CMatrix(&this->m_lastLink1.matrix);
  sub_1911E0(&this->m_firstLink1.matrix);
}

//----- (00408DE0) --------------------------------------------------------
void __fastcall CPlayerInfo::CPlayerInfo(CPlayerInfo *this)
{
  CPlayerPedData *p_PlayerPedData; // r1
  __int16 v3; // r0
  __int16 v4; // r1

  p_PlayerPedData = &this->PlayerPedData;
  this->PlayerPedData.m_nCarDangerCounter = 0;
  this->PlayerPedData.m_vecFightMovement.y = 0.0;
  this->PlayerPedData.m_moveBlendRatio = 0.0;
  v3 = *((_WORD *)&this->PlayerPedData + 26);
  *(_QWORD *)&p_PlayerPedData->m_Wanted = 0LL;
  *(_QWORD *)&p_PlayerPedData->m_ArrestingOfficer = 0LL;
  this->PlayerPedData.m_nDrugLevel = 0;
  *(_WORD *)&this->PlayerPedData.m_nDrunkenness = 0;
  this->PlayerPedData.m_AdrenalineEndTime = 0;
  this->PlayerPedData.m_nChosenWeapon = 0;
  this->PlayerPedData.m_nStandStillTimer = 0;
  this->PlayerPedData.m_nHitAnimDelayTimer = 0;
  this->PlayerPedData.m_fAttackButtonCounter = 0.0;
  this->PlayerPedData.m_pDangerCar = 0;
  this->PlayerPedData.m_nScriptLimitToGangSize = 99;
  this->PlayerPedData.m_MeleeWeaponAnimReferenced = ANIM_STD_PED;
  this->PlayerPedData.m_MeleeWeaponAnimReferencedExtra = ANIM_STD_PED;
  this->PlayerPedData.m_fFPSMoveHeading = 0.0;
  this->PlayerPedData.m_fLookPitch = 0.0;
  this->PlayerPedData.m_fSkateBoardSpeed = 0.0;
  *(_DWORD *)&this->PlayerPedData.m_DPadDownPressedInMilliseconds = 0;
  *(_QWORD *)&this->PlayerPedData.m_vecTargetBoneOffset.x = 0LL;
  *(_QWORD *)&this->PlayerPedData.m_vecTargetBoneOffset.z = 0LL;
  this->PlayerPedData.m_bForceInteriorLighting = 0;
  *(_QWORD *)&this->PlayerPedData.m_fGunSpinSpeed = 0LL;
  *(_QWORD *)&this->PlayerPedData.m_LastTimeFiring = 0LL;
  *(_WORD *)&this->PlayerPedData.m_bPlayerSprintDisabled = 0;
  *((_WORD *)&this->PlayerPedData + 26) = v3 & 0xE7A0 | 0x1010;
  this->PlayerPedData.m_playersGangActive = 1;
  this->PlayerPedData.m_wetness = 0;
  this->PlayerPedData.m_fSprintEnergy = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY);
  this->PlayerPedData.m_fSprintControlCounter = 0.0;
  this->PlayerPedData.m_fBreath = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_BREATH_UNDERWATER);
  this->PlayerPedData.m_pSpecialAtomic = 0;
  v4 = *((_WORD *)&this->PlayerPedData + 26);
  this->PlayerPedData.m_FireHSMissilePressedTime = 0;
  this->PlayerPedData.m_LastHSMissileTarget = 0;
  this->PlayerPedData.m_nModelIndexOfLastBuildingShot = -1;
  *((_DWORD *)&this->PlayerPedData + 40) = 0x80000000;
  this->PlayerPedData.m_pCurrentProstitutePed = 0;
  this->PlayerPedData.m_pLastProstituteShagged = 0;
  this->m_pSkinTexture = 0;
  this->m_nRequireParachuteTimer = 0;
  this->m_bParachuteReferenced = 0;
  *((_WORD *)&this->PlayerPedData + 26) = v4 & 0xFF7F;
}

//----- (00408EA0) --------------------------------------------------------
void __fastcall CPlayerInfo::Clear(CPlayerInfo *this)
{
  CVehicle *pSpecCar; // r1
  UInt32 v3; // r1
  _BOOL4 m_bParachuteReferenced; // r1

  pSpecCar = this->pSpecCar;
  this->pRemoteVehicle = 0;
  this->pPed = 0;
  if ( pSpecCar )
  {
    *(_DWORD *)&pSpecCar->m_nPhysicalFlags &= ~0x4000000u;
    this->pSpecCar = 0;
  }
  this->CarDensityForCurrentZone = 0;
  this->RoadDensityAroundPlayer = 1.0;
  *(_DWORD *)&this->PlayerState = 0;
  *(_WORD *)&this->bTaxiTimerScore = 0;
  this->TaxiTimer = 0;
  v3 = CTimer::m_snTimeInMilliseconds;
  *(_QWORD *)&this->Score = 0LL;
  *(_QWORD *)&this->CollectablesPickedUp = 0x300000000LL;
  *(_QWORD *)&this->nBestBikeWheelieTimeMs = 0LL;
  *(_QWORD *)&this->nBestBikeStoppieTimeMs = 0LL;
  *(_QWORD *)&this->nTempBufferCounter = 0LL;
  *(_QWORD *)&this->fBestCarTwoWheelsDistM = 0LL;
  *(_QWORD *)&this->nBikeRearWheelCounter = 0LL;
  *(_QWORD *)&this->nBikeFrontWheelCounter = 0LL;
  *(_QWORD *)&this->TimesStuckInARow = 0LL;
  *(_QWORD *)&this->fCarTwoWheelDist = 0LL;
  *(_QWORD *)&this->LastTimeEnergyLost = 0LL;
  *(_QWORD *)&this->LastTimeBigGunFired = 0LL;
  this->vehicle_time_counter = v3;
  *(_WORD *)&this->DoesNotGetTired = 0;
  this->FireProof = 0;
  this->HavocCaused = 0;
  this->bCanDoDriveBy = 1;
  *(_DWORD *)&this->MaxHealth = 25700;
  this->TimeOfLastCarExplosionCaused = 0;
  this->ExplosionMultiplier = 0;
  CWorld::Players[CWorld::PlayerInFocus].TimeLastEaten = 0;
  m_bParachuteReferenced = this->m_bParachuteReferenced;
  this->m_nLastBustMessageNumber = 1;
  this->CurrentChaseValue = 0.0;
  this->m_nBustedAudioStatus = 0;
  this->bGetOject = 0;
  this->CrossHair.bActivated = 0;
  this->m_nRequireParachuteTimer = 0;
  if ( m_bParachuteReferenced )
  {
    CGameLogic::IsCoopGameGoingOn();
    if ( this->m_bParachuteReferenced )
    {
      CStreaming::SetModelIsDeletable(371);
      this->m_nRequireParachuteTimer = 0;
      this->m_bParachuteReferenced = 0;
    }
  }
}

//----- (00408FBC) --------------------------------------------------------
void __fastcall CPlayerInfo::StreamParachuteWeapon(CPlayerInfo *this, bool bAllowParachute)
{
  _BOOL4 v2; // r5
  CPlayerPed *pPed; // r0
  bool v5; // zf
  int m_pMyVehicle; // r1
  bool v7; // r0
  uint32 m_nRequireParachuteTimer; // r1
  unsigned int v9; // r2
  CVehicle *v10; // r0
  uint32 v11; // r5
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  float z; // s18

  v2 = bAllowParachute;
  if ( CGameLogic::IsCoopGameGoingOn() != 1 || !v2 )
  {
    if ( !v2 )
      goto LABEL_11;
    pPed = this->pPed;
    if ( this->pPed )
    {
      m_pMyVehicle = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31;
      v5 = m_pMyVehicle == 0;
      if ( m_pMyVehicle )
      {
        m_pMyVehicle = (int)pPed->m_pMyVehicle;
        v5 = m_pMyVehicle == 0;
      }
      if ( !v5 && (*(_DWORD *)(m_pMyVehicle + 1444) == 4 || pPed->m_pMyVehicle->m_vehicleType == 3) )
      {
        m_nRequireParachuteTimer = this->m_nRequireParachuteTimer;
        v9 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
        if ( m_nRequireParachuteTimer <= v9 )
        {
          v10 = pPed->m_pMyVehicle;
          v11 = 0;
          m_pMat = v10->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &v10->m_transform;
          z = p_tx->m_translate.z;
          if ( (float)(z - CCamera::CalculateGroundHeight(&TheCamera, 0)) > 50.0 )
            v11 = 5000;
          this->m_nRequireParachuteTimer = v11;
        }
        else
        {
          this->m_nRequireParachuteTimer = m_nRequireParachuteTimer - v9;
        }
      }
    }
    if ( this->m_nRequireParachuteTimer )
    {
      CStreaming::RequestModel(371, 4);
      v7 = 1;
    }
    else
    {
LABEL_11:
      if ( !this->m_bParachuteReferenced )
        return;
      CStreaming::SetModelIsDeletable(371);
      v7 = 0;
      this->m_nRequireParachuteTimer = 0;
    }
    this->m_bParachuteReferenced = v7;
  }
}

//----- (004090B0) --------------------------------------------------------
void __fastcall CPlayerInfo::SetLastTargetVehicle(CPlayerInfo *this, CVehicle *pTargetVehicle)
{
  CVehicle *pLastTargetVehicle; // r0
  CEntity **p_pLastTargetVehicle; // r4

  p_pLastTargetVehicle = &this->pLastTargetVehicle;
  pLastTargetVehicle = this->pLastTargetVehicle;
  if ( pLastTargetVehicle )
    CEntity::CleanUpOldReference(pLastTargetVehicle, p_pLastTargetVehicle);
  *p_pLastTargetVehicle = pTargetVehicle;
  if ( pTargetVehicle )
    sub_196050(pTargetVehicle, p_pLastTargetVehicle);
}

//----- (004090DC) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CPlayerInfo::Process(CPlayerInfo *this, Int32 PlayerNumber)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d3
  float32x2_t v6; // d8
  CPad *Pad; // r11
  CPlayerPed *pPed; // r0
  bool v11; // zf
  CVehicle *m_pMyVehicle; // r1
  int m_nModelIndex; // r2
  bool v14; // zf
  UInt32 v15; // r1
  bool v16; // zf
  UInt32 *p_nBikeFrontWheelCounter; // r0
  __int64 v18; // kr00_8
  int v19; // r3
  int v20; // r2
  CPedStats *m_pPedStats; // r1
  UInt32 v22; // r1
  float v23; // s2
  float v24; // s4
  bool v25; // zf
  UInt32 v26; // r2
  float v27; // s0
  float v28; // r0
  UInt32 v29; // r0
  UInt32 TaxiTimer; // r1
  __int64 v31; // r2
  float x; // s2
  float *p_y; // r1
  unsigned int v34; // r1
  float fCarTwoWheelDist; // s4
  CPlayerPed *v36; // r0
  CPlayerPed *v37; // r0
  CMatrix *m_pMat; // r2
  float *p_tx; // r1
  CMatrix *v40; // r2
  float v41; // r1
  CSimpleTransform *p_m_transform; // r6
  CPlayerPed *v43; // r1
  float32x2_t v44; // d0
  const CVehicle *v45; // r0
  _BOOL4 IsPassenger; // r0
  _BOOL4 v47; // r6
  _BOOL4 IsTargetingActive; // r0
  CPlayerPed *v49; // r0
  CObject *ObjectToSteal; // r8
  CTask *SimplestActiveTask; // r5
  int v52; // r6
  CTaskSimpleHoldEntity *TaskHold; // r9
  unsigned int v54; // r2
  bool v55; // zf
  CTask *v56; // r0
  CTask *v57; // r6
  Bool8 v58; // r0
  UInt32 TimeOfRemoteVehicleExplosion; // r2
  unsigned int v60; // r6
  CPlayerInfo *v61; // r2
  int v62; // r1
  CVehicle **p_pRemoteVehicle; // r2
  CVehicle *v64; // r6
  CVehicle *pRemoteVehicle; // t1
  CPlayerPed *v66; // r0
  bool v67; // zf
  CVehicle *v68; // r0
  __int16 v69; // r1
  CPlayerPed *v70; // r3
  bool v71; // zf
  CVehicle *v72; // r3
  bool v73; // zf
  float zz; // s0
  int32 m_baseVehicleType; // r6
  bool v76; // zf
  int v77; // r6
  UInt32 v78; // r3
  CPlayerInfo *v79; // r0
  CVehicle *v80; // r2
  unsigned __int32 *p_m_nHealth; // r2
  CPlayerPed *v82; // r2
  CVehicle *v83; // r0
  int v84; // r0
  CPlayerPed *v85; // r0
  bool v86; // zf
  CPlayerInfo *v87; // r0
  CPad *v88; // r0
  CPlayerInfo *v89; // r0
  float m_fTrueDistanceTravelled; // r1
  UInt16 v91; // r0
  UInt16 v92; // r0
  float v93; // r1
  CPlayerPed *v94; // r0
  const CVehicle *v95; // r0
  CPlayerInfo *v96; // r0
  UInt32 nCarTwoWheelCounter; // r0
  CVehicle *v98; // r2
  CMatrix *v99; // r0
  const CVector *p_m_translate; // r1
  CPlayerPed *v101; // r0
  CEntity *pEntityWeAreOnForVisibilityCheck; // r1
  CVehicle *v103; // r1
  CTask *ActiveTask; // r0
  CVehicle *v105; // r0
  CPedIntelligence *m_pPedIntelligence; // r5
  CTaskComplexLeaveCar *v107; // r6
  CPlayerPed *v108; // r0
  int v109; // r3
  int v110; // r2
  int v111; // r6
  CPlayerInfo *v112; // r0
  UInt32 nTempBufferCounter; // r1
  unsigned int v114; // r1
  float v115; // s2
  unsigned int v116; // r1
  float fBikeRearWheelDist; // s2
  UInt32 v118; // r0
  CPlayerPed *v119; // r0
  const CVehicle *v120; // r0
  CPlayerPed *v121; // r0
  const CVehicle *v122; // r0
  CPlayerPed *v123; // r0
  const CVehicle *v124; // r0
  CPlayerPed *v125; // r0
  const CVehicle *v126; // r0
  CPlayerPed *v127; // r0
  const CVehicle *v128; // r0
  CPlayerInfo *v129; // r0
  UInt32 nBikeFrontWheelCounter; // r0
  float fBikeFrontWheelDist; // r2
  float v132; // r2
  UInt32 nBikeRearWheelCounter; // r0
  UInt32 v134; // r1
  CVehicle *v135; // r0
  CPlayerPed *v136; // r0
  bool v137; // zf
  int v138; // r1
  CVehicle *v139; // r1
  CPlayerPed *v140; // r0
  bool v141; // zf
  CPlayerPed *v142; // r0
  bool v143; // zf
  CPlayerPed *v144; // r1
  CVehicle *v145; // r0
  CBike *v146; // r0
  float v147; // r2
  __int64 v148; // r0
  Int32 DisplayScore; // r2
  char v150; // r0
  int v151; // r2
  CPlayerPed *v152; // r0
  bool v153; // zf
  CMatrix *v154; // r2
  CSimpleTransform *v155; // r1
  float v156; // s0
  float32x2_t v157; // d16
  CSimpleTransform *v158; // r3
  int v159; // r2
  RwReal v160; // r3
  float32x2_t v161; // d16
  unsigned __int64 v162; // d1
  bool v163; // zf
  CMatrix *v164; // r2
  CSimpleTransform *v165; // r1
  RwReal v166; // r2
  CPathFind *x_low; // r1
  CSimpleTransform *v168; // r3
  __int64 v169; // kr08_8
  RwReal z; // r1
  bool v171; // zf
  int v172; // r1
  CMatrix *v173; // r1
  CSimpleTransform *v174; // r3
  CSimpleTransform *v175; // r0
  char v176; // r5
  unsigned __int32 v177; // r0
  float v178; // s0
  float CurrentChaseValue; // s2
  float v180; // s16
  int v181; // r0
  bool v182; // zf
  CMatrix *v183; // r1
  CSimpleTransform *v184; // r2
  float y; // s4
  float v186; // s26
  float v187; // r5
  float v188; // s24
  int v189; // s2
  float v190; // r3
  int v191; // s20
  uint16 v192; // r0
  CTaskComplexGoPickUpEntity *v193; // r5
  CPlayerInfo *v194; // r0
  int v195; // r6
  bool v196; // cc
  CTaskSimpleJetPack *TaskJetPack; // r0
  CVehicle *v198; // r8
  CVehicle *m_pTowingVehicle; // r0
  CTask *v200; // r0
  CMatrix *v201; // r1
  CSimpleTransform *v202; // r2
  bool v203; // r1
  CPad *v204; // r0
  CVehicle *v205; // r2
  CPedIntelligence *v206; // r5
  CTaskComplexLeaveCar *v207; // r6
  CTask *v208; // r0
  CTask *v209; // r9
  int v210; // r0
  bool v211; // zf
  CPad *v212; // r0
  CMatrix *v213; // r1
  const CVector *v214; // r2
  CTaskSimpleSwim *TaskSwim; // r0
  __int64 v216; // d16
  CPlayerPed *v217; // r0
  eWeaponType m_eWeaponType; // r1
  CTask *TaskSecondary; // r5
  _BOOL4 v220; // r5
  CTask *v221; // r6
  _BOOL4 v222; // r6
  CTaskSimpleJetPack *v223; // r0
  int v224; // r1
  __int64 v225; // kr10_8
  int v226; // r5
  int v227; // r0
  CVehicle *v228; // r1
  bool IsAlive; // r1
  CMatrix *v230; // r0
  const CVector *v231; // r2
  bool v232; // zf
  bool v233; // zf
  CVehicle *v234; // r2
  CPlayerPed *v235; // r3
  bool v236; // zf
  CMatrix *v237; // r0
  CSimpleTransform *v238; // r1
  CPedIntelligence *v239; // r6
  CTaskComplexEnterCarAsDriver *v240; // r5
  CMatrix *v241; // r0
  const CVector *v242; // r1
  CVector *vecVehicle; // [sp+0h] [bp-B0h]
  CVector *vecVehicleb; // [sp+0h] [bp-B0h]
  CVector *vecVehiclea; // [sp+0h] [bp-B0h]
  float v246; // [sp+4h] [bp-ACh]
  float CutoffDist; // [sp+8h] [bp-A8h]
  bool v248; // [sp+1Ch] [bp-94h]
  int v249; // [sp+30h] [bp-80h]
  int iDoor; // [sp+34h] [bp-7Ch] BYREF
  float pCloseness; // [sp+38h] [bp-78h] BYREF
  CVehicle *v252; // [sp+3Ch] [bp-74h] BYREF
  CEventScriptCommand v253; // [sp+40h] [bp-70h] BYREF

  Pad = CPad::GetPad(PlayerNumber);
  pPed = this->pPed;
  v11 = this->bTaxiTimerScore == 0;
  if ( this->bTaxiTimerScore )
    v11 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  if ( v11 )
    goto LABEL_9;
  m_pMyVehicle = pPed->m_pMyVehicle;
  m_nModelIndex = m_pMyVehicle->m_nModelIndex;
  v14 = m_nModelIndex == 438;
  if ( m_nModelIndex != 438 )
    v14 = m_nModelIndex == 420;
  if ( !v14 || m_pMyVehicle->pDriver != pPed || !m_pMyVehicle->m_nNumPassengers )
  {
LABEL_9:
    v15 = CTimer::m_snTimeInMilliseconds;
LABEL_10:
    this->TaxiTimer = v15;
    goto LABEL_11;
  }
  TaxiTimer = this->TaxiTimer;
  if ( CTimer::m_snTimeInMilliseconds - TaxiTimer >= 0x3E8 )
  {
    v31 = 274877907LL * (CTimer::m_snTimeInMilliseconds - 1000 - TaxiTimer);
    this->Score += (CTimer::m_snTimeInMilliseconds - 1000 - TaxiTimer) / 0x3E8 + 1;
    v15 = TaxiTimer + 1000 * (HIDWORD(v31) >> 6) + 1000;
    goto LABEL_10;
  }
LABEL_11:
  v16 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
  {
    pPed = (CPlayerPed *)pPed->m_pMyVehicle;
    v16 = pPed == 0;
  }
  if ( v16 )
    goto LABEL_15;
  m_pPedStats = pPed->m_pPedStats;
  if ( m_pPedStats != (CPedStats *)byte_9 )
  {
    if ( !m_pPedStats )
    {
      if ( LOBYTE(pPed[1].m_PedAudioEntity.m_fCurrentJetPackRoarVolume) > 2u )
        v22 = 0;
      else
        v22 = this->nCarLess3WheelCounter + (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
      this->nCarLess3WheelCounter = v22;
      x = pPed[1].m_vecTurnSpeed.x;
      p_y = &pPed[1].m_vecMoveSpeed.y;
      if ( x == 1.0 && pPed[1].m_vecTurnSpeed.y == 1.0 )
      {
        if ( *p_y < 1.0 && pPed[1].m_vecMoveSpeed.z < 1.0 && pPed->m_fDamageImpulseMagnitude == 0.0 )
        {
LABEL_53:
          v34 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
          fCarTwoWheelDist = this->fCarTwoWheelDist;
          v2.n64_f32[0] = (float)this->nTempBufferCounter + (float)((float)v34 * -0.5);
          v5.n64_u32[0] = 0;
          this->nCarTwoWheelCounter += v34;
          v2.n64_u64[0] = vmax_f32(v2, v5).n64_u64[0];
          this->fCarTwoWheelDist = pPed->m_fTrueDistanceTravelled + fCarTwoWheelDist;
          this->nTempBufferCounter = (unsigned int)v2.n64_f32[0];
LABEL_254:
          this->nBikeRearWheelCounter = 0;
          p_nBikeFrontWheelCounter = &this->nBikeFrontWheelCounter;
          goto LABEL_16;
        }
        nCarTwoWheelCounter = this->nCarTwoWheelCounter;
        if ( !nCarTwoWheelCounter )
          goto LABEL_252;
        nTempBufferCounter = this->nTempBufferCounter;
        if ( nTempBufferCounter >> 2 <= 0x7C )
          goto LABEL_201;
      }
      else
      {
        if ( *p_y != 1.0 || pPed[1].m_vecMoveSpeed.z != 1.0 )
        {
          nCarTwoWheelCounter = this->nCarTwoWheelCounter;
          if ( !nCarTwoWheelCounter )
            goto LABEL_254;
          if ( nCarTwoWheelCounter >> 4 <= 0x7C )
            goto LABEL_252;
          goto LABEL_251;
        }
        if ( x < 1.0 && pPed[1].m_vecTurnSpeed.y < 1.0 && pPed->m_fDamageImpulseMagnitude == 0.0 )
          goto LABEL_53;
        nCarTwoWheelCounter = this->nCarTwoWheelCounter;
        if ( !nCarTwoWheelCounter )
          goto LABEL_252;
        nTempBufferCounter = this->nTempBufferCounter;
        if ( nTempBufferCounter >> 2 <= 0x7C )
        {
LABEL_201:
          v118 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) + nTempBufferCounter;
LABEL_253:
          this->nTempBufferCounter = v118;
          goto LABEL_254;
        }
      }
      if ( nCarTwoWheelCounter < 0x7D0 )
      {
LABEL_252:
        v118 = 0;
        this->nCarTwoWheelCounter = 0;
        this->fCarTwoWheelDist = 0.0;
        goto LABEL_253;
      }
LABEL_251:
      v132 = this->fCarTwoWheelDist;
      this->nBestCarTwoWheelsTimeMs = nCarTwoWheelCounter;
      this->fBestCarTwoWheelsDistM = v132;
      CStats::SetNewRecordStat(0x13u, (float)(nCarTwoWheelCounter / 0x3E8));
      CStats::SetNewRecordStat(0xCu, this->fCarTwoWheelDist);
      goto LABEL_252;
    }
LABEL_15:
    this->nCarTwoWheelCounter = 0;
    this->nCarLess3WheelCounter = 0;
    this->nBikeRearWheelCounter = 0;
    this->nBikeFrontWheelCounter = 0;
    p_nBikeFrontWheelCounter = &this->nTempBufferCounter;
    goto LABEL_16;
  }
  v23 = *(float *)&pPed->m_nWeaponSkill;
  if ( v23 == 1.0 )
  {
    v24 = *(float *)&pPed->m_pFire;
    v25 = v24 == 1.0;
    if ( v24 == 1.0 )
      v25 = this->nBikeFrontWheelCounter == 0;
    if ( v25 )
    {
      if ( (pPed->FireDamageMultiplier < 1.0 || *(float *)&pPed->m_pEntLookEntity < 1.0)
        && pPed->m_fDamageImpulseMagnitude == 0.0 )
      {
        v116 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
        fBikeRearWheelDist = this->fBikeRearWheelDist;
        v2.n64_f32[0] = (float)this->nTempBufferCounter + (float)((float)v116 * -0.2);
        v4.n64_u32[0] = 0;
        this->nBikeRearWheelCounter += v116;
        v2.n64_u64[0] = vmax_f32(v2, v4).n64_u64[0];
        this->fBikeRearWheelDist = pPed->m_fTrueDistanceTravelled + fBikeRearWheelDist;
        this->nTempBufferCounter = (unsigned int)v2.n64_f32[0];
        goto LABEL_287;
      }
      nBikeRearWheelCounter = this->nBikeRearWheelCounter;
      if ( !nBikeRearWheelCounter )
        goto LABEL_35;
      v134 = this->nTempBufferCounter;
      if ( v134 >> 2 > 0x7C )
      {
        if ( nBikeRearWheelCounter < 0x1388 )
          goto LABEL_35;
        v27 = (float)(nBikeRearWheelCounter / 0x3E8);
        v147 = this->fBikeRearWheelDist;
        this->nBestBikeWheelieTimeMs = nBikeRearWheelCounter;
        this->fBestBikeWheelieDistM = v147;
        goto LABEL_34;
      }
LABEL_285:
      v29 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) + v134;
      goto LABEL_286;
    }
  }
  v26 = this->nBikeRearWheelCounter;
  if ( v26 )
  {
    if ( v26 <= 0x1387 )
    {
LABEL_35:
      v29 = 0;
      this->nBikeRearWheelCounter = 0;
      this->fBikeRearWheelDist = 0.0;
LABEL_286:
      this->nTempBufferCounter = v29;
      goto LABEL_287;
    }
    v27 = (float)(v26 / 0x3E8);
    v28 = this->fBikeRearWheelDist;
    this->nBestBikeWheelieTimeMs = v26;
    this->fBestBikeWheelieDistM = v28;
LABEL_34:
    CStats::SetNewRecordStat(0x11u, v27);
    CStats::SetNewRecordStat(0xAu, this->fBikeRearWheelDist);
    goto LABEL_35;
  }
  if ( pPed->FireDamageMultiplier != 1.0 || *(float *)&pPed->m_pEntLookEntity != 1.0 )
  {
    nBikeFrontWheelCounter = this->nBikeFrontWheelCounter;
    if ( nBikeFrontWheelCounter >> 4 <= 0x7C )
      goto LABEL_249;
    goto LABEL_248;
  }
  if ( v23 >= 1.0 && *(float *)&pPed->m_pFire >= 1.0 || pPed->m_fDamageImpulseMagnitude != 0.0 )
  {
    nBikeFrontWheelCounter = this->nBikeFrontWheelCounter;
    if ( !nBikeFrontWheelCounter )
      goto LABEL_249;
    v134 = this->nTempBufferCounter;
    if ( v134 >> 2 <= 0x7C )
      goto LABEL_285;
    if ( nBikeFrontWheelCounter < 0x7D0 )
    {
LABEL_249:
      v29 = 0;
      this->nBikeFrontWheelCounter = 0;
      this->fBikeFrontWheelDist = 0.0;
      goto LABEL_286;
    }
LABEL_248:
    fBikeFrontWheelDist = this->fBikeFrontWheelDist;
    this->nBestBikeStoppieTimeMs = nBikeFrontWheelCounter;
    this->fBestBikeStoppieDistM = fBikeFrontWheelDist;
    CStats::SetNewRecordStat(0x12u, (float)(nBikeFrontWheelCounter / 0x3E8));
    CStats::SetNewRecordStat(0xBu, this->fBikeFrontWheelDist);
    goto LABEL_249;
  }
  v114 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  v115 = this->fBikeFrontWheelDist;
  v2.n64_f32[0] = (float)this->nTempBufferCounter + (float)((float)v114 * -0.2);
  v4.n64_u32[0] = 0;
  this->nBikeFrontWheelCounter += v114;
  v2.n64_u64[0] = vmax_f32(v2, v4).n64_u64[0];
  this->fBikeFrontWheelDist = pPed->m_fTrueDistanceTravelled + v115;
  this->nTempBufferCounter = (unsigned int)v2.n64_f32[0];
LABEL_287:
  this->nCarTwoWheelCounter = 0;
  p_nBikeFrontWheelCounter = &this->nCarLess3WheelCounter;
LABEL_16:
  *p_nBikeFrontWheelCounter = 0;
  CPlayerInfo::WorkOutEnergyFromHunger(this);
  v18 = *(_QWORD *)&this->Score;
  if ( (_DWORD)v18 != HIDWORD(v18) )
  {
    v19 = v18 - HIDWORD(v18);
    if ( (int)v18 - HIDWORD(v18) < 0 )
      v19 = HIDWORD(v18) - v18;
    if ( v19 <= (int)&elf_hash_chain[8526] )
    {
      if ( v19 <= 10000 )
      {
        if ( v19 <= 1000 )
        {
          v20 = 1;
          if ( v19 > 50 )
            v20 = 42;
        }
        else
        {
          v20 = 123;
        }
      }
      else
      {
        v20 = 1234;
      }
    }
    else
    {
      v20 = 12345;
    }
    if ( (int)v18 - HIDWORD(v18) < 0 )
      v20 = -v20;
    this->DisplayScore = HIDWORD(v18) + v20;
  }
  this->pPed->m_nMaxHealth = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_MAX_HEALTH);
  v36 = this->pPed;
  this->MaxHealth = (unsigned int)this->pPed->m_nMaxHealth;
  if ( *((unsigned __int8 *)&v36->m_nPedFlags + 1) << 31 && CStats::GetStatValue(0xDFu) >= 400.0 )
  {
    CPlayerInfo::StreamParachuteWeapon(this, 1);
  }
  else if ( this->m_bParachuteReferenced )
  {
    CGameLogic::IsCoopGameGoingOn();
    if ( this->m_bParachuteReferenced )
    {
      CStreaming::SetModelIsDeletable(371);
      this->m_nRequireParachuteTimer = 0;
      this->m_bParachuteReferenced = 0;
    }
  }
  if ( (unsigned __int8)CTimer::m_FrameCounter << 28 )
  {
    v2.n64_u32[0] = LODWORD(this->RoadDensityAroundPlayer);
  }
  else
  {
    v37 = this->pPed;
    if ( *((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31 )
      v37 = (CPlayerPed *)v37->m_pMyVehicle;
    m_pMat = v37->m_pMat;
    p_tx = &m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v37->m_transform.m_translate.x;
    v40 = v37->m_pMat;
    v41 = *p_tx;
    p_m_transform = (CSimpleTransform *)&v40->tx;
    if ( !v40 )
      p_m_transform = &v37->m_transform;
    v2.n64_u32[0] = CPathFind::CalcRoadDensity(&ThePaths, v41, p_m_transform->m_translate.y);
    LODWORD(this->RoadDensityAroundPlayer) = v2.n64_u32[0];
  }
  v43 = this->pPed;
  v6.n64_u32[0] = 0.5;
  v3.n64_u32[0] = 1069128090;
  v2.n64_f32[0] = (float)((float)(v2.n64_f32[0] + -1.0) * 0.6) + 1.0;
  v44.n64_u64[0] = vmin_f32(vmax_f32(v2, v6), v3).n64_u64[0];
  LODWORD(this->RoadDensityAroundPlayer) = v44.n64_u32[0];
  if ( *((unsigned __int8 *)&v43->m_nPedFlags + 1) << 31 && (v45 = v43->m_pMyVehicle) != 0 )
  {
    IsPassenger = CVehicle::IsPassenger(v45, v43);
    v43 = this->pPed;
    v47 = IsPassenger;
  }
  else
  {
    v47 = 0;
  }
  IsTargetingActive = CCamera::IsTargetingActive(&TheCamera, v43);
  if ( !v47 && IsTargetingActive
    || (v49 = this->pPed,
        ~*((_DWORD *)&this->pPed->m_nPedFlags + 2) & 0x4000000 | *((_DWORD *)&this->pPed->m_nPedFlags + 3) & 2) )
  {
    v58 = 0;
    goto LABEL_98;
  }
  this->m_bTryingToExitCar = 0;
  if ( *((unsigned __int8 *)&v49->m_nPedFlags + 1) << 31 && !this->pRemoteVehicle )
  {
    v98 = v49->m_pMyVehicle;
    v99 = v98->m_pMat;
    p_m_translate = (const CVector *)&v99->tx;
    if ( !v99 )
      p_m_translate = &v98->m_transform.m_translate;
    if ( CPad::ExitVehicleJustDown(Pad, 1, v98, 0, p_m_translate) == 1 )
    {
      v101 = this->pPed;
    }
    else
    {
      if ( !this->m_bTryingToExitCar )
        goto LABEL_83;
      if ( !CPad::GetExitVehicle(Pad) )
        goto LABEL_83;
      v101 = this->pPed;
      if ( !(*((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31) )
        goto LABEL_83;
    }
    pEntityWeAreOnForVisibilityCheck = v101->m_pMyVehicle->pEntityWeAreOnForVisibilityCheck;
    if ( pEntityWeAreOnForVisibilityCheck )
    {
      if ( CBridge::ThisIsABridgeObjectMovingUp(pEntityWeAreOnForVisibilityCheck->m_nModelIndex) )
        goto LABEL_99;
      v101 = this->pPed;
    }
    v103 = v101->m_pMyVehicle;
    if ( (*(_BYTE *)&v103->m_info >> 3) - 5 < 2u || v103->m_eDoorLockState == CARLOCK_LOCKED_PLAYER_INSIDE )
      goto LABEL_99;
    ActiveTask = CTaskManager::GetActiveTask(&v101->m_pPedIntelligence->m_taskManager);
    if ( ActiveTask
      && (*((int (__fastcall **)(CTask *, CPlayerPed *, int, _DWORD))ActiveTask->_vptr$CTask + 7))(
           ActiveTask,
           this->pPed,
           1,
           0) != 1 )
    {
      this->m_bTryingToExitCar = 1;
      goto LABEL_99;
    }
    v105 = this->pPed->m_pMyVehicle;
    if ( v105->m_baseVehicleType == 5 )
    {
      m_pPedIntelligence = this->pPed->m_pPedIntelligence;
      v107 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar(v107, this->pPed->m_pMyVehicle, 0, 0, 1, 0);
      CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, v107, 3, 0);
      v108 = this->pPed;
      v109 = *((_DWORD *)&this->pPed->m_nPedFlags + 2);
      v110 = *((_DWORD *)&this->pPed->m_nPedFlags + 1) | 0x80;
      v111 = *((_DWORD *)&this->pPed->m_nPedFlags + 3);
      *(_DWORD *)&v108->m_nPedFlags = this->pPed->m_nPedFlags;
      *((_DWORD *)&v108->m_nPedFlags + 1) = v110;
      *((_DWORD *)&v108->m_nPedFlags + 2) = v109;
      *((_DWORD *)&v108->m_nPedFlags + 3) = v111;
      goto LABEL_99;
    }
    if ( (*((int (__fastcall **)(CVehicle *, _DWORD))v105->_vptr$CPlaceable + 58))(v105, 0)
      || (*((int (__fastcall **)(CVehicle *))this->pPed->m_pMyVehicle->_vptr$CPlaceable + 59))(this->pPed->m_pMyVehicle) == 1 )
    {
      v206 = this->pPed->m_pPedIntelligence;
      v207 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar(v207, this->pPed->m_pMyVehicle, 0, 0, 1, 0);
      CTaskManager::SetTask(&v206->m_taskManager, v207, 3, 0);
      this->m_bTryingToExitCar = 1;
      if ( this->m_nRequireParachuteTimer && CStreaming::ms_aInfoForModel[371].m_status == 1 )
      {
        CPed::GiveWeapon(this->pPed, WEAPONTYPE_PARACHUTE, 1u, 1);
        this->pPed->m_eStoredWeapon = WEAPONTYPE_PARACHUTE;
      }
      *((_WORD *)this->pPed->m_pPlayerData + 26) &= ~8u;
      goto LABEL_99;
    }
    if ( *(_BYTE *)&this->pPed->m_pMyVehicle->m_info > 7u )
      goto LABEL_99;
    v58 = 1;
LABEL_98:
    this->m_bTryingToExitCar = v58;
    goto LABEL_99;
  }
LABEL_83:
  if ( this->pPed->m_pAttachToEntity )
    goto LABEL_99;
  ObjectToSteal = CPlayerInfo::FindObjectToSteal(0, this->pPed);
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->pPed->m_pPedIntelligence->m_taskManager);
  v52 = 0;
  TaskHold = CPedIntelligence::GetTaskHold(this->pPed->m_pPedIntelligence, 0);
  v54 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  if ( (int)(CTaskSimpleHoldEntity::m_nPutDownTimer - v54) > 0 )
    v52 = CTaskSimpleHoldEntity::m_nPutDownTimer - v54;
  CTaskSimpleHoldEntity::m_nPutDownTimer = v52;
  if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) == 254
    || CPedIntelligence::GetTaskFighting(this->pPed->m_pPedIntelligence) )
  {
    goto LABEL_99;
  }
  v55 = TaskHold == 0;
  if ( TaskHold )
    v55 = TaskHold->m_pHoldEntity == 0;
  if ( !v55 )
    goto LABEL_99;
  if ( ObjectToSteal )
  {
    v56 = CTaskManager::GetActiveTask(&this->pPed->m_pPedIntelligence->m_taskManager);
    v57 = v56;
    if ( (!v56
       || (*((int (__fastcall **)(CTask *))v56->_vptr$CTask + 5))(v56) != 310
       && (*((int (__fastcall **)(CTask *, CPlayerPed *, int, _DWORD))v57->_vptr$CTask + 7))(v57, this->pPed, 1, 0) == 1)
      && !CTaskSimpleHoldEntity::m_nPutDownTimer )
    {
      v193 = (CTaskComplexGoPickUpEntity *)CTask::operator new(0x34u);
      CTaskComplexGoPickUpEntity::CTaskComplexGoPickUpEntity(v193, ObjectToSteal, ANIM_CARRY_BOX);
      CEventScriptCommand::CEventScriptCommand(&v253, 3, v193, 0);
      if ( CHID::currentInstanceIndex == 1 )
        v194 = &CWorld::Players[1];
      else
        v194 = &CWorld::Players[CWorld::PlayerInFocus];
      CEventGroup::Add(&v194->pPed->m_pPedIntelligence->m_eventGroup, &v253, 0);
      this->bGetOject = 1;
      CEventScriptCommand::~CEventScriptCommand(&v253);
    }
    goto LABEL_99;
  }
  pCloseness = 0.0;
  v252 = 0;
  v183 = this->pPed->m_pMat;
  v184 = (CSimpleTransform *)&v183->tx;
  if ( !v183 )
    v184 = &this->pPed->m_transform;
  y = v184->m_translate.y;
  v186 = v184->m_translate.x + 10.0;
  v187 = floorf((float)((float)(v184->m_translate.x + -10.0) / 50.0) + 60.0);
  v188 = floorf((float)((float)(y + -10.0) / 50.0) + 60.0);
  v189 = (int)floorf((float)((float)(y + 10.0) / 50.0) + 60.0);
  v191 = (int)floorf((float)(v186 / 50.0) + 60.0);
  v249 = (int)v188;
  if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
  {
    CWorld::ClearScanCodes();
    v192 = 1;
  }
  else
  {
    v192 = CWorld::ms_nCurrentScanCode + 1;
  }
  CWorld::ms_nCurrentScanCode = v192;
  if ( v249 <= v189 )
  {
    do
    {
      if ( (int)v187 <= v191 )
      {
        v195 = (int)v187;
        do
        {
          CPlayerInfo::FindClosestCarSectorList(
            this,
            (CPtrList *)&CWorld::ms_aRepeatSectors[v195 & 0xF | (unsigned __int8)(16 * v249)],
            this->pPed,
            v190,
            *(float *)&vecVehicle,
            v246,
            CutoffDist,
            &pCloseness,
            &v252);
          v196 = v195++ < v191;
        }
        while ( v196 );
      }
      v196 = v249++ < v189;
    }
    while ( v196 );
  }
  if ( CPedIntelligence::GetTaskJetPack(this->pPed->m_pPedIntelligence) )
  {
    if ( CTouchInterface::m_pWidgets[0] )
      CWidgetButtonEnterCar::SetEnterCarVehicleType(
        (CWidgetButtonEnterCar *)CTouchInterface::m_pWidgets[0],
        -1,
        0,
        0,
        (float *)&v253,
        370);
    if ( CTouchInterface::IsReleased(WIDGET_ENTER_CAR, 0, 1) )
    {
      TaskJetPack = CPedIntelligence::GetTaskJetPack(this->pPed->m_pPedIntelligence);
      CTaskSimpleJetPack::DropJetPack(TaskJetPack, this->pPed);
    }
  }
  v198 = v252;
  if ( !v252 )
    goto LABEL_99;
  if ( v252->m_vehicleType == 11 )
  {
    m_pTowingVehicle = v252->m_pTowingVehicle;
    if ( m_pTowingVehicle )
    {
      v252 = v252->m_pTowingVehicle;
      v198 = m_pTowingVehicle;
    }
  }
  if ( !CVehicle::CanBeDriven(v198) )
    goto LABEL_99;
  if ( v198->m_baseVehicleType == 5 )
  {
    if ( v198->pDriver )
      goto LABEL_99;
    v200 = CTaskManager::GetActiveTask(&this->pPed->m_pPedIntelligence->m_taskManager);
    if ( v200 )
    {
      if ( (*((int (__fastcall **)(CTask *, CPlayerPed *, int, _DWORD))v200->_vptr$CTask + 7))(v200, this->pPed, 1, 0) != 1 )
        goto LABEL_99;
    }
    v201 = v198->m_pMat;
    v202 = (CSimpleTransform *)&v201->tx;
    v11 = v201 == 0;
    v203 = 0;
    if ( v11 )
      v202 = &v198->m_transform;
    vecVehiclea = &v202->m_translate;
    if ( (*(_DWORD *)&this->pPed->m_nPedFlags & 0x100) == 0 )
      v203 = 1;
    v204 = Pad;
    v205 = v198;
    goto LABEL_471;
  }
  v208 = CTaskManager::GetActiveTask(&this->pPed->m_pPedIntelligence->m_taskManager);
  v209 = v208;
  if ( !v208 )
  {
    v209 = 0;
    goto LABEL_419;
  }
  if ( (*((int (__fastcall **)(CTask *))v208->_vptr$CTask + 5))(v208) == 268
    && CPedIntelligence::GetTaskSwim(this->pPed->m_pPedIntelligence) )
  {
    v210 = v198->m_nModelIndex;
    if ( v210 < 460 )
    {
      if ( v210 != 417 && v210 != 447 )
        goto LABEL_419;
      goto LABEL_414;
    }
    v211 = v210 == 539;
    if ( v210 != 539 )
      v211 = v210 == 460;
    if ( v211 )
    {
LABEL_414:
      v212 = CPad::GetPad(0);
      v213 = v198->m_pMat;
      v214 = (const CVector *)&v213->tx;
      if ( !v213 )
        v214 = &v198->m_transform.m_translate;
      if ( CPad::ExitVehicleJustDown(v212, 1, v198, 1, v214) == 1 )
      {
        iDoor = 0;
        if ( CCarEnterExit::GetNearestCarDoor(this->pPed, v198, (CVector *)&v253, &iDoor) )
        {
          TaskSwim = CPedIntelligence::GetTaskSwim(this->pPed->m_pPedIntelligence);
          v216 = *(_QWORD *)&v253._vptr$CEvent;
          v209 = 0;
          TaskSwim->m_vecTargetPos.z = *(RwReal *)&v253.m_bIsPersistent;
          TaskSwim->m_nSwimTimer = 5000;
          *(_QWORD *)&TaskSwim->m_vecTargetPos.x = v216;
        }
      }
    }
  }
LABEL_419:
  v217 = this->pPed;
  m_eWeaponType = this->pPed->m_WeaponSlots[this->pPed->m_nCurrentWeapon].m_eWeaponType;
  if ( m_eWeaponType != WEAPONTYPE_FLAMETHROWER )
  {
    v220 = 0;
    if ( m_eWeaponType == WEAPONTYPE_MINIGUN )
      goto LABEL_421;
LABEL_423:
    v222 = 0;
    goto LABEL_424;
  }
  TaskSecondary = CTaskManager::GetTaskSecondary(&v217->m_pPedIntelligence->m_taskManager, 0);
  v217 = this->pPed;
  v220 = TaskSecondary != 0;
  if ( this->pPed->m_WeaponSlots[this->pPed->m_nCurrentWeapon].m_eWeaponType != WEAPONTYPE_MINIGUN )
    goto LABEL_423;
LABEL_421:
  v221 = CTaskManager::GetTaskSecondary(&v217->m_pPedIntelligence->m_taskManager, 0);
  v217 = this->pPed;
  v222 = v221 != 0;
LABEL_424:
  v223 = CPedIntelligence::GetTaskJetPack(v217->m_pPedIntelligence);
  if ( v209 )
  {
    if ( TheCamera.m_WideScreenOn )
      goto LABEL_99;
    v224 = CCutsceneMgr::ms_running;
    if ( CCutsceneMgr::ms_running )
      v224 = 1;
    if ( (v223 != 0) | v224 | v220 | v222
      || (*((int (__fastcall **)(CTask *))v209->_vptr$CTask + 5))(v209) == 1022
      || (*((int (__fastcall **)(CTask *))v209->_vptr$CTask + 5))(v209) == 1303
      || (*((int (__fastcall **)(CTask *))v209->_vptr$CTask + 5))(v209) == 504
      || (*((int (__fastcall **)(CTask *))v209->_vptr$CTask + 5))(v209) == 401
      || (*((int (__fastcall **)(CTask *, CPlayerPed *, int, _DWORD))v209->_vptr$CTask + 7))(v209, this->pPed, 1, 0) != 1 )
    {
      goto LABEL_99;
    }
  }
  if ( !CWorld::Players[1].pPed || CGameLogic::bPlayersCanBeInSeparateCars )
  {
    if ( *((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31 )
      IsAlive = 0;
    else
      IsAlive = CPed::IsAlive(this->pPed);
    v230 = v198->m_pMat;
    v231 = (const CVector *)&v230->tx;
    if ( !v230 )
      v231 = &v198->m_transform.m_translate;
    if ( CPad::ExitVehicleJustDown(Pad, IsAlive, v198, 1, v231) == 1 )
    {
LABEL_472:
      v239 = this->pPed->m_pPedIntelligence;
      v240 = (CTaskComplexEnterCarAsDriver *)CTask::operator new(0x50u);
      CTaskComplexEnterCarAsDriver::CTaskComplexEnterCarAsDriver(v240, v198);
LABEL_473:
      CTaskManager::SetTask(&v239->m_taskManager, v240, 3, 0);
      goto LABEL_99;
    }
    goto LABEL_99;
  }
  v225 = *(_QWORD *)&CWorld::Players[(PlayerNumber + 1) % 2].pPed->m_pPedIntelligence->m_taskManager.m_tasks[3];
  if ( HIDWORD(v225) )
  {
    v226 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)HIDWORD(v225) + 20))(HIDWORD(v225));
    if ( (_DWORD)v225 )
      goto LABEL_438;
LABEL_448:
    v227 = 0;
    v228 = 0;
    goto LABEL_452;
  }
  v226 = 0;
  if ( !(_DWORD)v225 )
    goto LABEL_448;
LABEL_438:
  v227 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)v225 + 20))(v225);
  v228 = 0;
  switch ( v227 )
  {
    case 701:
      v228 = *(CVehicle **)(v225 + 12);
      v227 = 701;
      break;
    case 702:
      v228 = *(CVehicle **)(v225 + 12);
      v227 = 702;
      break;
    case 703:
      v228 = *(CVehicle **)(v225 + 12);
      v227 = 703;
      break;
    case 715:
      v228 = *(CVehicle **)(v225 + 12);
      v227 = 715;
      break;
    default:
      break;
  }
LABEL_452:
  v232 = v227 == 709;
  if ( v227 != 709 )
    v232 = v226 == 709;
  if ( v232 )
    goto LABEL_459;
  v233 = v226 == 1;
  if ( v226 != 1 )
    v233 = v227 == 1;
  if ( v233 )
  {
LABEL_459:
    v235 = CWorld::Players[(PlayerNumber + 1) % 2].pPed;
    v234 = v235->m_pMyVehicle;
    if ( v234->pDriver == v235 )
    {
      v228 = v235->m_pMyVehicle;
      v234 = 0;
    }
  }
  else
  {
    v234 = 0;
  }
  if ( v227 == 700 )
    v234 = *(CVehicle **)(v225 + 12);
  if ( v228 == v198 )
  {
    v241 = v198->m_pMat;
    v242 = (const CVector *)&v241->tx;
    if ( !v241 )
      v242 = &v198->m_transform.m_translate;
    if ( CPad::ExitVehicleJustDown(Pad, 1, 0, 1, v242) == 1 )
    {
      v239 = this->pPed->m_pPedIntelligence;
      v240 = (CTaskComplexEnterCarAsDriver *)CTask::operator new(0x50u);
      CTaskComplexEnterCarAsPassenger::CTaskComplexEnterCarAsPassenger(
        (CTaskComplexEnterCarAsPassenger *)v240,
        v198,
        0,
        0);
      goto LABEL_473;
    }
  }
  else
  {
    v236 = v234 == v198;
    if ( v234 != v198 )
      v236 = ((unsigned int)v228 | (unsigned int)v234) == 0;
    if ( v236 )
    {
      v237 = v198->m_pMat;
      v205 = 0;
      v238 = (CSimpleTransform *)&v237->tx;
      if ( !v237 )
        v238 = &v198->m_transform;
      v204 = Pad;
      vecVehiclea = &v238->m_translate;
      v203 = 1;
LABEL_471:
      if ( CPad::ExitVehicleJustDown(v204, v203, v205, 1, vecVehiclea) != 1 )
        goto LABEL_99;
      goto LABEL_472;
    }
  }
LABEL_99:
  if ( this->bAfterRemoteVehicleExplosion )
  {
    TimeOfRemoteVehicleExplosion = this->TimeOfRemoteVehicleExplosion;
    v60 = CTimer::m_snTimeInMilliseconds - TimeOfRemoteVehicleExplosion;
    if ( (CTimer::m_snPreviousTimeInMilliseconds - TimeOfRemoteVehicleExplosion) >> 3 <= 0x7C
      && v60 >= 0x3E8
      && !this->PlayerState
      && this->bFadeAfterRemoteVehicleExplosion )
    {
      CCamera::SetFadeColour(&TheCamera, 0, 0, 0);
      CCamera::Fade(&TheCamera, 1.0, 0);
    }
    if ( v60 > 0x7D0 )
    {
      if ( !this->PlayerState && this->bFadeAfterRemoteVehicleExplosion )
      {
        CCamera::RestoreWithJumpCut(&TheCamera);
        CCamera::SetFadeColour(&TheCamera, 0, 0, 0);
        CCamera::Fade(&TheCamera, 1.0, 1);
        CCamera::Process(&TheCamera);
        CTimer::Stop();
        CRenderer::RequestObjectsInFrustum(0, 0);
        CStreaming::LoadAllRequestedModels(0);
        CTimer::Update();
      }
      this->bAfterRemoteVehicleExplosion = 0;
      v61 = &CWorld::Players[CWorld::PlayerInFocus];
      v62 = CWorld::PlayerInFocus;
      pRemoteVehicle = v61->pRemoteVehicle;
      p_pRemoteVehicle = &v61->pRemoteVehicle;
      v64 = pRemoteVehicle;
      if ( pRemoteVehicle )
        *(_DWORD *)&v64->m_nFlags |= 0x800u;
      *p_pRemoteVehicle = 0;
      v66 = CWorld::Players[v62].pPed;
      v67 = v66 == 0;
      if ( v66 )
        v67 = *((unsigned __int8 *)&v66->m_nPedFlags + 1) << 31 == 0;
      if ( !v67 )
      {
        v68 = v66->m_pMyVehicle;
        if ( v68 )
          *(_BYTE *)&v68->m_info &= 7u;
      }
    }
  }
  v69 = CWorld::PlayerInFocus;
  if ( !((unsigned __int8)CTimer::m_FrameCounter << 27) )
  {
    v70 = CWorld::Players[CWorld::PlayerInFocus].pPed;
    v71 = v70 == 0;
    if ( v70 )
      v71 = *((unsigned __int8 *)&v70->m_nPedFlags + 1) << 31 == 0;
    if ( v71 )
      goto LABEL_137;
    v72 = v70->m_pMyVehicle;
    v73 = v72 == 0;
    if ( v72 )
      v73 = *((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31 == 0;
    if ( v73 )
      goto LABEL_137;
    zz = v72->m_pMat->zz;
    if ( zz >= 0.0
      || sqrtf(
           (float)((float)(v72->m_vecMoveSpeed.x * v72->m_vecMoveSpeed.x)
                 + (float)(v72->m_vecMoveSpeed.y * v72->m_vecMoveSpeed.y))
         + (float)(v72->m_vecMoveSpeed.z * v72->m_vecMoveSpeed.z)) >= 0.05 )
    {
      goto LABEL_137;
    }
    m_baseVehicleType = v72->m_baseVehicleType;
    v76 = m_baseVehicleType == 5;
    if ( m_baseVehicleType != 5 )
      v76 = m_baseVehicleType == 0;
    if ( !v76 || *((unsigned __int8 *)&v72->m_nPhysicalFlags + 1) << 31 )
    {
LABEL_137:
      this->TimesUpsideDownInARow = 0;
    }
    else
    {
      v77 = 1;
      if ( zz < -0.5 )
        v77 = 2;
      v78 = this->TimesUpsideDownInARow + v77;
      this->TimesUpsideDownInARow = v78;
      if ( v78 >= 7 )
      {
        v79 = &CWorld::Players[v69];
        v80 = v79->pPed->m_pMyVehicle;
        if ( (*((_BYTE *)&v80->m_nVehicleFlags + 2) & 0x20) != 0 )
        {
          p_m_nHealth = (unsigned __int32 *)&v80->m_nHealth;
          v44.n64_u32[0] = 1132003328;
          v3.n64_u32[0] = *p_m_nHealth;
          *p_m_nHealth = vmin_f32(v3, v44).n64_u32[0];
          v82 = v79->pPed;
          v83 = v79->pPed->m_pMyVehicle;
          if ( !v83->m_baseVehicleType )
          {
            if ( v82 )
              v84 = (unsigned int)v83 & -(*((_BYTE *)&v82->m_nPedFlags + 1) & 1);
            else
              v84 = 0;
            CDamageManager::SetEngineStatus((CDamageManager *)(v84 + 1460), 0xE1u);
            v69 = CWorld::PlayerInFocus;
            CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMyVehicle[1].pHandling = 0;
          }
        }
      }
    }
  }
  v85 = CWorld::Players[v69].pPed;
  if ( v85 )
  {
    v86 = *((unsigned __int8 *)&v85->m_nPedFlags + 1) << 31 == 0;
    if ( *((unsigned __int8 *)&v85->m_nPedFlags + 1) << 31 )
    {
      v85 = (CPlayerPed *)v85->m_pMyVehicle;
      v86 = v85 == 0;
    }
    if ( !v86 )
    {
      if ( v85->m_nModelIndex == 457 )
      {
        m_fTrueDistanceTravelled = v85->m_fTrueDistanceTravelled;
        v91 = 7;
      }
      else if ( v85->m_WeaponSlots[0].m_eWeaponType == WEAPONTYPE_DILDO1 )
      {
        m_fTrueDistanceTravelled = v85->m_fTrueDistanceTravelled;
        v91 = 27;
      }
      else
      {
        if ( CVehicle::GetVehicleAppearance((const CVehicle *)v85) == APR_HELI )
          CStats::IncrementStat(8u, CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMyVehicle->m_fTrueDistanceTravelled);
        v94 = CWorld::Players[CWorld::PlayerInFocus].pPed;
        if ( v94 )
        {
          if ( *((unsigned __int8 *)&v94->m_nPedFlags + 1) << 31 )
            v95 = v94->m_pMyVehicle;
          else
            v95 = 0;
        }
        else
        {
          v95 = 0;
        }
        if ( CVehicle::GetVehicleAppearance(v95) == APR_PLANE )
          CStats::IncrementStat(9u, CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMyVehicle->m_fTrueDistanceTravelled);
        v119 = CWorld::Players[CWorld::PlayerInFocus].pPed;
        if ( v119 )
        {
          if ( *((unsigned __int8 *)&v119->m_nPedFlags + 1) << 31 )
            v120 = v119->m_pMyVehicle;
          else
            v120 = 0;
        }
        else
        {
          v120 = 0;
        }
        if ( CVehicle::GetVehicleAppearance(v120) == APR_CAR )
          CStats::IncrementStat(4u, CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMyVehicle->m_fTrueDistanceTravelled);
        v121 = CWorld::Players[CWorld::PlayerInFocus].pPed;
        if ( v121 )
        {
          if ( *((unsigned __int8 *)&v121->m_nPedFlags + 1) << 31 )
            v122 = v121->m_pMyVehicle;
          else
            v122 = 0;
        }
        else
        {
          v122 = 0;
        }
        if ( CVehicle::GetVehicleAppearance(v122) == APR_BIKE )
          CStats::IncrementStat(5u, CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMyVehicle->m_fTrueDistanceTravelled);
        v123 = CWorld::Players[CWorld::PlayerInFocus].pPed;
        if ( v123 )
        {
          if ( *((unsigned __int8 *)&v123->m_nPedFlags + 1) << 31 )
            v124 = v123->m_pMyVehicle;
          else
            v124 = 0;
        }
        else
        {
          v124 = 0;
        }
        if ( CVehicle::GetVehicleAppearance(v124) == APR_BOAT )
          CStats::IncrementStat(6u, CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMyVehicle->m_fTrueDistanceTravelled);
        v125 = CWorld::Players[CWorld::PlayerInFocus].pPed;
        if ( v125 )
        {
          if ( *((unsigned __int8 *)&v125->m_nPedFlags + 1) << 31 )
            v126 = v125->m_pMyVehicle;
          else
            v126 = 0;
        }
        else
        {
          v126 = 0;
        }
        if ( CVehicle::GetVehicleAppearance(v126) != APR_PLANE )
        {
          v127 = CWorld::Players[CWorld::PlayerInFocus].pPed;
          if ( v127 )
            v128 = *((unsigned __int8 *)&v127->m_nPedFlags + 1) << 31 ? v127->m_pMyVehicle : 0;
          else
            v128 = 0;
          if ( CVehicle::GetVehicleAppearance(v128) != APR_HELI )
            goto LABEL_263;
        }
        v135 = CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMyVehicle;
        if ( sqrtf(
               (float)((float)(v135->m_vecMoveSpeed.x * v135->m_vecMoveSpeed.x)
                     + (float)(v135->m_vecMoveSpeed.y * v135->m_vecMoveSpeed.y))
             + (float)(v135->m_vecMoveSpeed.z * v135->m_vecMoveSpeed.z)) <= 0.2 )
          goto LABEL_263;
        v91 = 169;
        m_fTrueDistanceTravelled = CTimer::ms_fTimeStep * 16.0;
      }
      CStats::IncrementStat(v91, m_fTrueDistanceTravelled);
LABEL_263:
      v136 = CWorld::Players[CWorld::PlayerInFocus].pPed;
      if ( !v136 )
        goto LABEL_268;
      v138 = *((unsigned __int8 *)&v136->m_nPedFlags + 1) << 31;
      v137 = v138 == 0;
      if ( v138 )
      {
        v138 = (int)v136->m_pMyVehicle;
        v137 = v138 == 0;
      }
      if ( v137 || *(_DWORD *)(v138 + 1440) != 6 )
      {
LABEL_268:
        v139 = v136->m_pMyVehicle;
        if ( (float)((float)((float)(v139->m_vecMoveSpeed.x * v139->m_vecMoveSpeed.x)
                           + (float)(v139->m_vecMoveSpeed.y * v139->m_vecMoveSpeed.y))
                   + (float)(v139->m_vecMoveSpeed.z * v139->m_vecMoveSpeed.z)) > 0.0 )
        {
          switch ( CVehicle::GetVehicleAppearance((const CVehicle *)((unsigned int)v139 & ((int)(*(_DWORD *)&v136->m_nPedFlags << 23) >> 31))) )
          {
            case APR_BIKE:
              v144 = CWorld::Players[CWorld::PlayerInFocus].pPed;
              v145 = v144->m_pMyVehicle;
              if ( v145->m_vehicleType != 10 )
              {
                if ( v144 )
                  v146 = (CBike *)((unsigned int)v145 & -(*((_BYTE *)&v144->m_nPedFlags + 1) & 1));
                else
                  v146 = 0;
                CStats::UpdateStatsWhenOnMotorBike(v146);
              }
              break;
            case APR_HELI:
            case APR_PLANE:
              v140 = CWorld::Players[CWorld::PlayerInFocus].pPed;
              v141 = v140 == 0;
              if ( v140 )
                v141 = *((unsigned __int8 *)&v140->m_nPedFlags + 1) << 31 == 0;
              if ( v141 )
                CStats::UpdateStatsWhenFlying(0);
              else
                CStats::UpdateStatsWhenFlying(v140->m_pMyVehicle);
              break;
            case APR_BOAT:
              goto LABEL_292;
            default:
              v142 = CWorld::Players[CWorld::PlayerInFocus].pPed;
              v143 = v142 == 0;
              if ( v142 )
                v143 = *((unsigned __int8 *)&v142->m_nPedFlags + 1) << 31 == 0;
              if ( v143 )
                CStats::UpdateStatsWhenDriving(0);
              else
                CStats::UpdateStatsWhenDriving(v142->m_pMyVehicle);
              break;
          }
        }
      }
      goto LABEL_292;
    }
  }
  v87 = &CWorld::Players[v69];
  if ( CHID::currentInstanceIndex == 1 )
    v87 = &CWorld::Players[1];
  if ( v87->pPed->m_fTrueDistanceTravelled > 0.0 )
  {
    if ( CPedIntelligence::GetTaskSwim(this->pPed->m_pPedIntelligence) )
    {
      v88 = CPad::GetPad(0);
      if ( !CPad::GetPedWalkLeftRight(v88) )
      {
        v89 = CHID::currentInstanceIndex == 1 ? &CWorld::Players[1] : &CWorld::Players[CWorld::PlayerInFocus];
        if ( CPlayerPed::ControlButtonSprint(v89->pPed, SPRINT_ON_WATER) < 1.0 )
        {
          v112 = CHID::currentInstanceIndex == 1 ? &CWorld::Players[1] : &CWorld::Players[CWorld::PlayerInFocus];
          if ( v112->pPed->m_pPlayerData->m_moveBlendRatio <= 0.5 )
            goto LABEL_292;
        }
      }
      if ( CHID::currentInstanceIndex == 1 )
        v129 = &CWorld::Players[1];
      else
        v129 = &CWorld::Players[CWorld::PlayerInFocus];
      v93 = v129->pPed->m_fTrueDistanceTravelled;
      v92 = 26;
    }
    else if ( CPedIntelligence::GetTaskJetPack(this->pPed->m_pPedIntelligence) )
    {
      v92 = 173;
      v93 = CTimer::ms_fTimeStep * 16.0;
    }
    else
    {
      if ( CHID::currentInstanceIndex == 1 )
        v96 = &CWorld::Players[1];
      else
        v96 = &CWorld::Players[CWorld::PlayerInFocus];
      v93 = v96->pPed->m_fTrueDistanceTravelled;
      v92 = 3;
    }
    CStats::IncrementStat(v92, v93);
  }
LABEL_292:
  if ( this->pPed->m_pPlayerData->m_Wanted->m_WantedLevel == WANTED_CLEAN || CTheScripts::IsPlayerOnAMission() )
  {
    this->CurrentChaseValue = 0.0;
    goto LABEL_295;
  }
  v150 = `guard variable for'CPlayerInfo::Process(int)::OldCoors;
  __dmb(0xBu);
  if ( (v150 & 1) == 0 && _cxa_guard_acquire((__guard *)&`guard variable for'CPlayerInfo::Process(int)::OldCoors) )
    _cxa_guard_release((__guard *)&`guard variable for'CPlayerInfo::Process(int)::OldCoors);
  if ( CTimer::m_snTimeInMilliseconds / 0x4E20 != CTimer::m_snPreviousTimeInMilliseconds / 0x4E20 )
  {
    v151 = 404;
    v152 = CWorld::Players[CWorld::PlayerInFocus].pPed;
    if ( v152 )
    {
      v153 = *((unsigned __int8 *)&v152->m_nPedFlags + 1) << 31 == 0;
      if ( *((unsigned __int8 *)&v152->m_nPedFlags + 1) << 31 )
      {
        v151 = (int)v152->m_pMyVehicle;
        v153 = v151 == 0;
      }
      if ( v153 )
      {
        v154 = v152->m_pMat;
        v155 = (CSimpleTransform *)&v154->tx;
        if ( !v154 )
          v155 = &v152->m_transform;
      }
      else
      {
        v158 = *(CSimpleTransform **)(v151 + 20);
        v155 = v158 + 3;
        if ( !v158 )
          v155 = (CSimpleTransform *)(v151 + 4);
      }
      v157.n64_u64[0] = *(unsigned __int64 *)&v155->m_translate.y;
      v156 = v155->m_translate.x;
    }
    else
    {
      v156 = 0.0;
      v157.n64_u64[0] = 0LL;
    }
    v159 = 0;
    v160 = 0.0;
    v161.n64_u64[0] = vsub_f32(*(float32x2_t *)&CPlayerInfo::Process(int)::OldCoors.y, v157).n64_u64[0];
    v162 = vmul_f32(v161, v161).n64_u64[0];
    if ( sqrtf(
           (float)((float)((float)(CPlayerInfo::Process(int)::OldCoors.x - v156)
                         * (float)(CPlayerInfo::Process(int)::OldCoors.x - v156))
                 + *(float *)&v162)
         + *((float *)&v162 + 1)) >= 10.0 )
      v159 = 1;
    CPlayerInfo::Process(int)::bPlayerHasMoved = v159;
    if ( v152 )
    {
      v163 = *((unsigned __int8 *)&v152->m_nPedFlags + 1) << 31 == 0;
      if ( *((unsigned __int8 *)&v152->m_nPedFlags + 1) << 31 )
      {
        v159 = (int)v152->m_pMyVehicle;
        v163 = v159 == 0;
      }
      if ( v163 )
      {
        v164 = v152->m_pMat;
        v165 = (CSimpleTransform *)&v164->tx;
        if ( !v164 )
          v165 = &v152->m_transform;
      }
      else
      {
        v168 = *(CSimpleTransform **)(v159 + 20);
        v165 = v168 + 3;
        if ( !v168 )
          v165 = (CSimpleTransform *)(v159 + 4);
      }
      v169 = *(_QWORD *)&v165->m_translate.x;
      z = v165->m_translate.z;
      *(_QWORD *)&CPlayerInfo::Process(int)::OldCoors.x = v169;
      CPlayerInfo::Process(int)::OldCoors.z = z;
      v172 = *((unsigned __int8 *)&v152->m_nPedFlags + 1) << 31;
      v171 = v172 == 0;
      if ( v172 )
      {
        v172 = (int)v152->m_pMyVehicle;
        v171 = v172 == 0;
      }
      if ( v171 )
      {
        v173 = v152->m_pMat;
        v174 = (CSimpleTransform *)&v173->tx;
        if ( !v173 )
          v174 = &v152->m_transform;
      }
      else
      {
        v175 = *(CSimpleTransform **)(v172 + 20);
        v174 = v175 + 3;
        if ( !v175 )
          v174 = (CSimpleTransform *)(v172 + 4);
      }
      x_low = (CPathFind *)LODWORD(v174->m_translate.x);
      v166 = v174->m_translate.y;
      v160 = v174->m_translate.z;
    }
    else
    {
      v166 = 0.0;
      x_low = 0;
      CPlayerInfo::Process(int)::OldCoors.x = 0.0;
      CPlayerInfo::Process(int)::OldCoors.y = 0.0;
      CPlayerInfo::Process(int)::OldCoors.z = 0.0;
    }
    v176 = 0;
    vecVehicleb = 0;
    if ( (unsigned __int16)CPathFind::FindNodeClosestToCoors(
                             (CNodeAddress *)&ThePaths,
                             x_low,
                             *(CVector *)(&v160 - 1),
                             60.0,
                             COERCE_FLOAT(1),
                             0,
                             0,
                             0,
                             0,
                             v248) != 0xFFFF )
      v176 = 1;
    CPlayerInfo::Process(int)::bPlayerIsNearCarNodes = v176;
  }
  v177 = this->pPed->m_pPlayerData->m_Wanted->m_WantedLevel - 1;
  if ( v177 > 5 )
    v178 = 0.0;
  else
    v178 = *(float *)&dword_40ADB8[v177];
  CurrentChaseValue = this->CurrentChaseValue;
  v180 = (float)(v178 - CurrentChaseValue) * (float)(CTimer::ms_fTimeStep / 10000.0);
  if ( v180 < 0.0 )
    goto LABEL_346;
  if ( CPlayerInfo::Process(int)::bPlayerHasMoved
    && CPlayerInfo::Process(int)::bPlayerIsNearCarNodes
    && !CCullZones::NoPolice() )
  {
    v181 = CCullZones::PoliceAbandonCars();
    v182 = CGame::currArea == AREA_MAIN_MAP;
    if ( CGame::currArea == AREA_MAIN_MAP )
      v182 = v181 == 0;
    if ( v182 )
    {
      CurrentChaseValue = this->CurrentChaseValue;
LABEL_346:
      this->CurrentChaseValue = v180 + CurrentChaseValue;
    }
  }
LABEL_295:
  CPlayerCrossHair::Update(&this->CrossHair, PlayerNumber, Pad);
  v148 = *(_QWORD *)&this->Score;
  DisplayScore = 999999999;
  if ( (int)v148 >= 999999999 )
    LODWORD(v148) = 999999999;
  if ( SHIDWORD(v148) < 999999999 )
    DisplayScore = this->DisplayScore;
  this->Score = v148;
  this->DisplayScore = DisplayScore;
}
// 4090DC: fragmented variable at r3.4 may be wrong
// 4090DC: fragmented variable at r2.4 may be wrong
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];
// 40ADB8: using guessed type int dword_40ADB8[6];
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];
// 95ABA4: using guessed type char `guard variable for'CPlayerInfo::Process(int)::OldCoors;

//----- (0040ADE0) --------------------------------------------------------
void __fastcall CPlayerInfo::WorkOutEnergyFromHunger(CPlayerInfo *this)
{
  char v2; // r0
  int IsCoopGameGoingOn; // r0
  bool v4; // zf
  CPlayerPed *pPed; // r0
  Int16 TimeLastEaten; // r3
  int v7; // r1
  int v8; // r2
  CPad *Pad; // r0
  int v10; // r5
  GxtChar *v11; // r0
  float *p_m_nHealth; // r0
  float v13; // s0

  if ( !CCheat::m_aCheatsActive[76] )
  {
    v2 = `guard variable for'CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours;
    __dmb(0xBu);
    if ( (v2 & 1) == 0
      && _cxa_guard_acquire((__guard *)&`guard variable for'CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours) )
    {
      CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours = CClock::ms_nGameClockHours;
      _cxa_guard_release((__guard *)&`guard variable for'CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours);
    }
    if ( !CPad::GetPad(0)->DisablePlayerControls
      && !((CMenuSystem::num_menus_in_use | TheCamera.m_WideScreenOn | CCutsceneMgr::ms_running) << 24) )
    {
      IsCoopGameGoingOn = CGameLogic::IsCoopGameGoingOn();
      v4 = IsCoopGameGoingOn == 0;
      if ( !IsCoopGameGoingOn )
        v4 = this->pRemoteVehicle == 0;
      if ( v4 )
      {
        pPed = this->pPed;
        if ( this->pPed )
        {
          if ( !pPed->m_pAttachToEntity )
          {
            TimeLastEaten = this->TimeLastEaten;
            v7 = CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours;
            v8 = CClock::ms_nGameClockHours;
            if ( CClock::ms_nGameClockHours != CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours )
            {
              if ( !this->TimeLastEaten )
                CPlayerInfo::WorkOutEnergyFromHunger(void)::time_start_muscle_dec = 0;
              this->TimeLastEaten = ++TimeLastEaten;
            }
            if ( TimeLastEaten < 49 )
            {
              CPlayerInfo::WorkOutEnergyFromHunger(void)::message_displayed = 0;
            }
            else if ( v8 != v7 )
            {
              CPed::Say(pPed, 0x151u, 0, 1.0, 0, 0, 0);
              Pad = CPad::GetPad(0);
              CPad::StartShake(Pad, 400, 0x6Eu, 0);
              if ( CPlayerInfo::WorkOutEnergyFromHunger(void)::message_displayed )
              {
                if ( CStats::GetStatValue(0x15u) <= 0.0 )
                {
                  v10 = 0;
                }
                else
                {
                  CStats::DecrementStat(0x15u, 25.0);
                  CStats::DisplayScriptStatUpdateMessage(0, 0x15u, 25.0);
                  if ( !CPlayerInfo::WorkOutEnergyFromHunger(void)::time_start_muscle_dec )
                    CPlayerInfo::WorkOutEnergyFromHunger(void)::time_start_muscle_dec = this->TimeLastEaten + 24;
                  v10 = 1;
                }
                if ( CStats::GetStatValue(0x17u) <= 0.0
                  || CPlayerInfo::WorkOutEnergyFromHunger(void)::time_start_muscle_dec
                  && this->TimeLastEaten <= (int)CPlayerInfo::WorkOutEnergyFromHunger(void)::time_start_muscle_dec )
                {
                  if ( !v10 )
                  {
                    p_m_nHealth = &this->pPed->m_nHealth;
                    v13 = *p_m_nHealth + -1.6;
                    *p_m_nHealth = v13;
                  }
                }
                else
                {
                  CStats::DecrementStat(0x17u, 20.0);
                  CStats::DisplayScriptStatUpdateMessage(0, 0x17u, 25.0);
                }
              }
              else
              {
                v11 = CText::Get(&TheText, "NOTEAT");
                CHud::SetHelpMessage("NOTEAT", v11, 1, 0, 1, 0);
                CPlayerInfo::WorkOutEnergyFromHunger(void)::message_displayed = 1;
              }
            }
            if ( CClock::ms_nGameClockHours != CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours )
              CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours = CClock::ms_nGameClockHours;
          }
        }
      }
    }
  }
}
// 95ABB4: using guessed type char CPlayerInfo::WorkOutEnergyFromHunger(void)::message_displayed;
// 95ABB8: using guessed type char `guard variable for'CPlayerInfo::WorkOutEnergyFromHunger(void)::lastGameClockHours;

//----- (0040B040) --------------------------------------------------------
void __fastcall CPlayerInfo::GivePlayerParachute(CPlayerInfo *this)
{
  if ( this->m_nRequireParachuteTimer )
  {
    if ( CStreaming::ms_aInfoForModel[371].m_status == 1 )
    {
      CPed::GiveWeapon(this->pPed, WEAPONTYPE_PARACHUTE, 1u, 1);
      this->pPed->m_eStoredWeapon = WEAPONTYPE_PARACHUTE;
    }
  }
}
// FC: using guessed type int elf_hash_bucket[16411];
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];

//----- (0040B078) --------------------------------------------------------
CObject *__fastcall CPlayerInfo::FindObjectToSteal(CPlayerInfo *this, CPed *pPed)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  float32x2_t v5; // d17
  float32x2_t v6; // d9
  float v7; // s16
  float v8; // r8
  float v9; // s20
  float v10; // s22
  int v11; // s20
  float v12; // r0
  int v13; // r9
  int v14; // r11
  int v15; // r5
  int v16; // r4
  uint16 v17; // r1
  CObject *result; // r0
  int v19; // r2
  int v20; // r4
  CPtrNode *m_pHead; // r6
  CMatrix *v22; // r2
  float v23; // s10
  unsigned __int64 v24; // d6
  unsigned __int64 v25; // d7
  float v26; // s8
  float v27; // s10
  CPtrNode v28; // kr00_8
  int v29; // r3
  char *v30; // r2
  float v31; // s8
  float32x2_t v32; // d16
  unsigned __int64 v33; // d6
  int v35; // [sp+0h] [bp-60h]
  int v36; // [sp+4h] [bp-5Ch]

  m_pMat = pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  v5.n64_f32[0] = 1.5;
  v5.n64_f32[1] = 1.5;
  v6.n64_u64[0] = vadd_f32(
                    vmul_f32(vmul_f32(*(float32x2_t *)&m_pMat->yy, (float32x2_t)0x3F0000003F000000LL), v5),
                    *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
  v7 = (float)((float)(m_pMat->xy * 0.5) * 1.5) + p_tx->m_translate.x;
  v8 = floorf((float)((float)(v7 + -1.5) / 50.0) + 60.0);
  v9 = floorf((float)((float)(v6.n64_f32[0] + -1.5) / 50.0) + 60.0);
  v10 = floorf((float)((float)(v6.n64_f32[0] + 1.5) / 50.0) + 60.0);
  v11 = (int)v9;
  v12 = floorf((float)((float)(v7 + 1.5) / 50.0) + 60.0);
  v13 = 119;
  v14 = v11;
  v15 = 0;
  v16 = (int)v10;
  if ( (int)v10 >= 119 )
    v16 = 119;
  if ( v11 <= 0 )
    v14 = 0;
  if ( (int)v12 < 119 )
    v13 = (int)v12;
  if ( (int)v8 > 0 )
    v15 = (int)v8;
  if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
  {
    CWorld::ClearScanCodes();
    v17 = 1;
  }
  else
  {
    v17 = CWorld::ms_nCurrentScanCode + 1;
  }
  CWorld::ms_nCurrentScanCode = v17;
  result = 0;
  if ( v14 <= v16 )
  {
    v35 = v15;
    v36 = v16;
    do
    {
      if ( v15 <= v13 )
      {
        v19 = v15;
        do
        {
          v20 = v19;
          m_pHead = CWorld::ms_aRepeatSectors[v19 & 0xF | (unsigned __int8)(16 * v14)].m_ptrListArray[2].m_pHead;
          while ( m_pHead )
          {
            v28 = *m_pHead;
            m_pHead = m_pHead->m_pNext;
            v29 = *((_DWORD *)v28.m_pVoid + 5);
            v30 = (char *)(v29 + 48);
            if ( !v29 )
              v30 = (char *)v28.m_pVoid + 4;
            if ( (*((_BYTE *)v28.m_pVoid + 325) & 0x20) != 0 && *((unsigned __int16 *)v28.m_pVoid + 24) != v17 )
            {
              v31 = *(float *)v30 - v7;
              v32.n64_u64[0] = vsub_f32(*(float32x2_t *)(v30 + 4), v6).n64_u64[0];
              v33 = vmul_f32(v32, v32).n64_u64[0];
              if ( (float)((float)((float)(v31 * v31) + *(float *)&v33) + *((float *)&v33 + 1)) < 2.25 )
              {
                v22 = pPed->m_pMat;
                v23 = v31 * v22->xx;
                v24 = vmul_f32(v32, *(float32x2_t *)&v22->yx).n64_u64[0];
                v25 = vmul_f32(v32, *(float32x2_t *)&v22->yy).n64_u64[0];
                v26 = (float)((float)(v31 * v22->xy) + *(float *)&v25) + *((float *)&v25 + 1);
                v27 = fabsf((float)(v23 + *(float *)&v24) + *((float *)&v24 + 1)) * 3.0;
                if ( v26 < 0.0 )
                  v26 = 10.0 - v26;
                if ( (float)(v27 + v26) < 1000.0 )
                  result = (CObject *)v28.m_pVoid;
              }
            }
          }
          v19 = v20 + 1;
        }
        while ( v20 < v13 );
      }
      v15 = v35;
    }
    while ( v14++ < v36 );
  }
  return result;
}

//----- (0040B2D8) --------------------------------------------------------
CPlayerPed *__fastcall FindPlayerPed(Int32 Player)
{
  Int32 v2; // r1

  if ( CHID::currentInstanceIndex == 1 )
    return CWorld::Players[1].pPed;
  v2 = CWorld::PlayerInFocus;
  if ( Player >= 0 )
    v2 = Player;
  return CWorld::Players[v2].pPed;
}

//----- (0040B324) --------------------------------------------------------
void __fastcall CPlayerInfo::FindClosestCarSectorList(
        CPlayerInfo *this,
        CPtrList *list,
        CPed *pPed,
        float MinX,
        float MinY,
        float MaxX,
        float MaxY,
        float *pCloseness,
        CVehicle **ppClosestVehicle)
{
  CPtrNode *m_pHead; // r5
  unsigned int v11; // r1
  int v12; // r0
  int v13; // r0
  bool v14; // zf
  int v15; // r0
  float32x2_t *v16; // r10
  RwReal *v17; // r1
  __int64 v18; // d16
  float z; // s28
  float v20; // r0
  CSimpleTransform *p_m_transform; // r1
  float v22; // s0
  CMatrix *m_pMat; // r0
  float v24; // s28
  CMatrix *v25; // r0
  CSimpleTransform *p_tx; // r1
  float32x2_t *v27; // r0
  CSimpleTransform *v28; // r1
  CMatrix *v29; // r2
  float32x2_t v30; // d16
  unsigned __int64 v31; // d0
  float v32; // s28
  float v33; // s30
  CMatrix *v34; // r0
  CSimpleTransform *v35; // r1
  float v36; // s2
  CPtrNode v37; // kr00_8
  int v38; // r1
  bool v39; // zf
  CVector vDoorPos; // [sp+8h] [bp-80h] BYREF
  int iDoor; // [sp+14h] [bp-74h] BYREF
  CVector v42; // [sp+18h] [bp-70h] BYREF

  m_pHead = list->m_pHead;
  while ( m_pHead )
  {
    while ( 1 )
    {
      v37 = *m_pHead;
      m_pHead = m_pHead->m_pNext;
      v38 = *((unsigned __int16 *)v37.m_pVoid + 24);
      v39 = v38 == CWorld::ms_nCurrentScanCode;
      if ( v38 != CWorld::ms_nCurrentScanCode )
        v39 = *((unsigned __int8 *)v37.m_pVoid + 28) << 31 == 0;
      if ( v39 )
        break;
      v11 = *((unsigned __int8 *)v37.m_pVoid + 58);
      if ( (v11 & 7) != 2 )
        break;
      *((_WORD *)v37.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
      if ( (v11 >> 3) - 5 < 2 )
        break;
      v12 = *((_DWORD *)v37.m_pVoid + 5);
      if ( !v12 )
      {
        CPlaceable::AllocateMatrix((CPlaceable *)v37.m_pVoid);
        CSimpleTransform::UpdateMatrix(
          (const CSimpleTransform *)((char *)v37.m_pVoid + 4),
          *((CMatrix **)v37.m_pVoid + 5));
        v12 = *((_DWORD *)v37.m_pVoid + 5);
      }
      if ( *(float *)(v12 + 40) <= 0.3 )
      {
        v13 = *((_BYTE *)v37.m_pVoid + 58) & 7;
        v14 = v13 == 2;
        if ( v13 == 2 )
          v14 = *((_DWORD *)v37.m_pVoid + 360) == 9;
        if ( !v14 )
          break;
      }
      CEntity::GetBoundCentre(&v42, (const CEntity *)v37.m_pVoid);
      v15 = *((_DWORD *)v37.m_pVoid + 5);
      v16 = (float32x2_t *)((char *)v37.m_pVoid + 4);
      v17 = (RwReal *)((char *)v37.m_pVoid + 4);
      if ( v15 )
        v17 = (RwReal *)(v15 + 48);
      v18 = *(_QWORD *)v17;
      v42.z = v17[2];
      *(_QWORD *)&v42.x = v18;
      z = v42.z;
      v20 = (*(float (__fastcall **)(void *))(*(_DWORD *)v37.m_pVoid + 216))(v37.m_pVoid);
      p_m_transform = &pPed->m_transform;
      v22 = (float)(z - v20) + 1.0;
      v42.z = v22;
      m_pMat = pPed->m_pMat;
      if ( m_pMat )
        p_m_transform = (CSimpleTransform *)&m_pMat->tx;
      v24 = (float)(p_m_transform->m_translate.z - v22)
          + (float)((float)((float)(p_m_transform->m_translate.x - v42.x) * 0.0)
                  + (float)((float)(p_m_transform->m_translate.y - v42.y) * 0.0));
      if ( *((_WORD *)v37.m_pVoid + 19) != 577 )
        goto LABEL_38;
      iDoor = 0;
      if ( !CCarEnterExit::GetNearestCarDoor(pPed, (const CVehicle *)v37.m_pVoid, &vDoorPos, &iDoor) )
        goto LABEL_38;
      v25 = pPed->m_pMat;
      p_tx = &pPed->m_transform;
      if ( v25 )
        p_tx = (CSimpleTransform *)&v25->tx;
      v24 = fabsf(p_tx->m_translate.z - vDoorPos.z);
      if ( v24 >= 1.0 )
      {
LABEL_38:
        if ( fabsf(v24) >= 2.0 )
        {
          if ( *((_DWORD *)v37.m_pVoid + 360) != 5 )
            break;
          v34 = pPed->m_pMat;
          v35 = &pPed->m_transform;
          if ( v34 )
            v35 = (CSimpleTransform *)&v34->tx;
          v36 = v35->m_translate.z;
          if ( (v42.z >= v36 || v42.z <= (float)(v36 + -4.0)) && pPed->m_pEntityStandingOn != v37.m_pVoid )
            break;
        }
      }
      if ( (*((_BYTE *)v37.m_pVoid + 1074) & 0x20) == 0 )
        break;
      v27 = (float32x2_t *)*((_DWORD *)v37.m_pVoid + 5);
      v28 = &pPed->m_transform;
      v29 = pPed->m_pMat;
      if ( v27 )
        v16 = v27 + 6;
      if ( v29 )
        v28 = (CSimpleTransform *)&v29->tx;
      v30.n64_u64[0] = vsub_f32(*(float32x2_t *)&v28->m_translate.x, (float32x2_t)v16->n64_u64[0]).n64_u64[0];
      v31 = vmul_f32(v30, v30).n64_u64[0];
      v32 = sqrtf((float)(*(float *)&v31 + *((float *)&v31 + 1)) + 0.0);
      if ( v32 <= 10.0
        || (v33 = 10.0, !CPedGeometryAnalyser::LiesInsideBoundingBox(pPed, &v28->m_translate, (CEntity *)v37.m_pVoid)) )
      {
        v33 = v32;
        if ( v32 > 10.0 )
          break;
      }
      if ( CCranes::IsThisCarBeingCarriedByAnyCrane((CVehicle *)v37.m_pVoid) )
        break;
      CPlayerInfo::EvaluateCarPosition(
        (CPlayerInfo *)ppClosestVehicle,
        (CEntity *)v37.m_pVoid,
        pPed,
        v33,
        pCloseness,
        ppClosestVehicle);
      if ( !m_pHead )
        return;
    }
  }
}

//----- (0040B580) --------------------------------------------------------
CVehicle *__fastcall FindPlayerVehicle(Int32 Player, bool bReturnRemoteVehicle)
{
  Int32 v2; // r3
  CPlayerPed *pPed; // r2
  bool v4; // zf
  CVehicle *result; // r0

  v2 = CWorld::PlayerInFocus;
  if ( Player >= 0 )
    v2 = Player;
  pPed = CWorld::Players[v2].pPed;
  v4 = pPed == 0;
  if ( pPed )
    v4 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  if ( v4 )
    return 0;
  if ( !bReturnRemoteVehicle )
    return pPed->m_pMyVehicle;
  result = CWorld::Players[v2].pRemoteVehicle;
  if ( !result )
    return pPed->m_pMyVehicle;
  return result;
}

//----- (0040B5E4) --------------------------------------------------------
CVehicle *__fastcall FindPlayerTrain(Int32 Player)
{
  Int32 v1; // r1
  CVehicle *result; // r0
  bool v3; // zf

  v1 = CWorld::PlayerInFocus;
  if ( Player >= 0 )
    v1 = Player;
  result = (CVehicle *)CWorld::Players[v1].pPed;
  if ( !result )
    return 0;
  v3 = BYTE1(result->pPassengers[7]) << 31 == 0;
  if ( BYTE1(result->pPassengers[7]) << 31 )
  {
    result = (CVehicle *)result->m_fxSysHeliDust;
    v3 = result == 0;
  }
  if ( v3 )
    return 0;
  if ( result->m_baseVehicleType != 6 )
    return 0;
  return result;
}

//----- (0040B62C) --------------------------------------------------------
CVector *__fastcall FindPlayerCoors(CVector *retstr, Int32 Player)
{
  Int32 v2; // r2
  CPlayerPed *pPed; // r1
  bool v4; // zf
  int m_pMyVehicle; // r2
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *v8; // r1
  __int64 v9; // d16

  v2 = CWorld::PlayerInFocus;
  if ( Player >= 0 )
    v2 = Player;
  pPed = CWorld::Players[v2].pPed;
  if ( pPed )
  {
    m_pMyVehicle = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31;
    v4 = m_pMyVehicle == 0;
    if ( m_pMyVehicle )
    {
      m_pMyVehicle = (int)pPed->m_pMyVehicle;
      v4 = m_pMyVehicle == 0;
    }
    if ( v4 )
    {
      m_pMat = pPed->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
    }
    else
    {
      v8 = *(CSimpleTransform **)(m_pMyVehicle + 20);
      p_tx = v8 + 3;
      if ( !v8 )
        p_tx = (CSimpleTransform *)(m_pMyVehicle + 4);
    }
    v9 = *(_QWORD *)&p_tx->m_translate.x;
    retstr->z = p_tx->m_translate.z;
    *(_QWORD *)&retstr->x = v9;
  }
  else
  {
    retstr->x = 0.0;
    retstr->y = 0.0;
    retstr->z = 0.0;
  }
  return retstr;
}

//----- (0040B694) --------------------------------------------------------
void __fastcall CPlayerCrossHair::Update(CPlayerCrossHair *this, Int32 PlayerIndex, CPad *pPad)
{
  float v6; // s16
  int32 value; // r6
  float v8; // s18
  int SteeringUpDown; // r0
  float v10; // s2
  float TargetX; // s4
  float v12; // s0
  float v13; // s16
  float xx; // s20
  float zx; // s18
  float yx; // s22
  float CamFOV; // r0
  float v18; // r4
  float TargetY; // s19
  float xy; // s30
  float zy; // s28
  float yy; // s17
  float v23; // r0
  float v24; // s0
  CWeapon *v25; // r0
  Int32 v26; // r10
  CSimpleTransform *p_tx; // r1
  __int64 v28; // d16
  CPlayerPed *pPed; // r1
  unsigned int v30; // r8
  int v31; // r3
  int v32; // r6
  CPlayerPed *v33; // r0
  int v34; // r3
  unsigned int v35; // r2
  int v36; // r6
  CVector pBarrelPosn; // [sp+18h] [bp-90h] BYREF
  CWeapon v38; // [sp+28h] [bp-80h] BYREF
  CVector v39; // [sp+44h] [bp-64h] BYREF

  if ( this->bActivated )
  {
    v6 = CTimer::ms_fTimeStep;
    this->TargetX = this->TargetX + (float)((float)(v6 * (float)CPad::GetSteeringLeftRight(pPad)) / 3000.0);
    value = MobileSettings::settings[15].value;
    v8 = CTimer::ms_fTimeStep;
    SteeringUpDown = CPad::GetSteeringUpDown(pPad);
    v10 = -(float)((float)(v8 * (float)SteeringUpDown) / 3000.0);
    if ( value )
      v10 = (float)(v8 * (float)SteeringUpDown) / 3000.0;
    TargetX = this->TargetX;
    v12 = this->TargetY + v10;
    this->TargetY = v12;
    if ( TargetX <= 0.9 )
    {
      if ( TargetX < -0.9 )
        this->TargetX = -0.9;
    }
    else
    {
      this->TargetX = 0.9;
    }
    if ( v12 <= 0.9 )
    {
      if ( v12 < -0.9 )
        this->TargetY = -0.9;
    }
    else
    {
      this->TargetY = 0.9;
    }
    if ( CPad::GetCarGunFired(pPad, 0, 0) )
    {
      CamShakeNoPos(&TheCamera, 0.2);
      v13 = this->TargetX;
      xx = TheCamera.m_cameraMatrix.xx;
      zx = TheCamera.m_cameraMatrix.zx;
      yx = TheCamera.m_cameraMatrix.yx;
      CamFOV = CCamera::FindCamFOV(&TheCamera);
      v18 = tanf((float)(CamFOV * 0.017453) * 0.5);
      TargetY = this->TargetY;
      xy = TheCamera.m_cameraMatrix.xy;
      zy = TheCamera.m_cameraMatrix.zy;
      yy = TheCamera.m_cameraMatrix.yy;
      v23 = CCamera::FindCamFOV(&TheCamera);
      v24 = (float)(TargetY * tanf((float)(v23 * 0.017453) * 0.5)) / CDraw::ms_fAspectRatio;
      v39.x = (float)((float)((float)(xy - (float)((float)(v13 * xx) * v18)) - (float)(TheCamera.m_cameraMatrix.xz * v24))
                    * 200.0)
            + TheCamera.m_cameraMatrix.tx;
      v39.y = TheCamera.m_cameraMatrix.ty
            + (float)((float)((float)(yy - (float)((float)(v13 * yx) * v18)) - (float)(v24 * TheCamera.m_cameraMatrix.yz))
                    * 200.0);
      v39.z = TheCamera.m_cameraMatrix.tz
            + (float)((float)((float)(zy - (float)((float)(v13 * zx) * v18)) - (float)(v24 * TheCamera.m_cameraMatrix.zz))
                    * 200.0);
      CWeapon::CWeapon(&v38, WEAPONTYPE_M4, 5000);
      v26 = PlayerIndex;
      p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        p_tx = &TheCamera.m_transform;
      v28 = *(_QWORD *)&p_tx->m_translate.x;
      pBarrelPosn.z = *(RwReal *)&byte_8[(_DWORD)p_tx];
      pPed = CWorld::Players[PlayerIndex].pPed;
      *(_QWORD *)&pBarrelPosn.x = v28;
      v30 = *((_DWORD *)&pPed->m_nPedFlags + 1);
      v31 = *((_DWORD *)&pPed->m_nPedFlags + 2);
      v32 = *((_DWORD *)&pPed->m_nPedFlags + 3);
      *(_DWORD *)&pPed->m_nPedFlags = pPed->m_nPedFlags;
      *((_DWORD *)&pPed->m_nPedFlags + 1) = v30 & 0xFDFFFFFF;
      *((_DWORD *)&pPed->m_nPedFlags + 2) = v31;
      *((_DWORD *)&pPed->m_nPedFlags + 3) = v32;
      CWeapon::FireInstantHit(v25, CWorld::Players[v26].pPed, &pBarrelPosn, &pBarrelPosn, 0, &v39, 0, 1, 1);
      v33 = CWorld::Players[v26].pPed;
      v34 = *((_DWORD *)&v33->m_nPedFlags + 2);
      v35 = *((_DWORD *)&v33->m_nPedFlags + 1) & 0xFDFFFFFF | (((v30 >> 25) & 1) << 25);
      v36 = *((_DWORD *)&v33->m_nPedFlags + 3);
      *(_DWORD *)&v33->m_nPedFlags = v33->m_nPedFlags;
      *((_DWORD *)&v33->m_nPedFlags + 1) = v35;
      *((_DWORD *)&v33->m_nPedFlags + 2) = v34;
      *((_DWORD *)&v33->m_nPedFlags + 3) = v36;
    }
  }
}
// 40B928: variable 'v25' is possibly undefined

//----- (0040B98C) --------------------------------------------------------
bool __fastcall CPlayerInfo::IsPlayerInRemoteMode(CPlayerInfo *this)
{
  return this->pRemoteVehicle || this->bAfterRemoteVehicleExplosion;
}

//----- (0040B9A4) --------------------------------------------------------
void __fastcall CPlayerInfo::EvaluateCarPosition(
        CPlayerInfo *this,
        CEntity *pEntity,
        CPed *pPed,
        float Distance,
        float *pCloseness,
        CVehicle **ppClosestVehicle)
{
  float ATanOfXY; // r6
  CMatrix *m_pMat; // r0
  CMatrix *v11; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r0
  float i; // s0
  float v15; // s16
  CVector v16; // [sp+0h] [bp-28h] BYREF
  int iDoor[7]; // [sp+Ch] [bp-1Ch] BYREF

  ATanOfXY = CGeneral::GetATanOfXY(pPed->m_pMat->xy, pPed->m_pMat->yy);
  m_pMat = pPed->m_pMat;
  v11 = pEntity->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  p_m_transform = (CSimpleTransform *)&v11->tx;
  if ( !v11 )
    p_m_transform = &pEntity->m_transform;
  for ( i = ATanOfXY
          - CGeneral::GetATanOfXY(
              p_m_transform->m_translate.x - p_tx->m_translate.x,
              p_m_transform->m_translate.y - p_tx->m_translate.y); i > 3.1416; i = i + -6.2832 )
    ;
  for ( ; i < -3.1416; i = i + 6.2832 )
    ;
  v15 = (float)(10.0 - Distance) * (float)((float)(fabsf(i) / -6.2832) + 1.0);
  if ( v15 >= *pCloseness )
  {
    iDoor[0] = 0;
    if ( CCarEnterExit::GetNearestCarDoor(pPed, (const CVehicle *)pEntity, &v16, iDoor) )
    {
      *pCloseness = v15;
      *ppClosestVehicle = (CVehicle *)pEntity;
    }
  }
}
// 40B9A4: using guessed type int iDoor[7];

//----- (0040BAB8) --------------------------------------------------------
CVector *__fastcall CPlayerInfo::GetSpeed(CVector *retstr, CPlayerInfo *this)
{
  CPlayerPed *pPed; // r1
  bool v3; // zf
  int m_pMyVehicle; // r2
  RwReal z; // r1
  __int64 v6; // d16

  pPed = this->pPed;
  m_pMyVehicle = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31;
  v3 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = (int)pPed->m_pMyVehicle;
    v3 = m_pMyVehicle == 0;
  }
  if ( v3 )
  {
    v6 = *(_QWORD *)&pPed->m_vecMoveSpeed.x;
    z = pPed->m_vecMoveSpeed.z;
  }
  else
  {
    z = *(float *)(m_pMyVehicle + 80);
    v6 = *(_QWORD *)(m_pMyVehicle + 72);
  }
  retstr->z = z;
  *(_QWORD *)&retstr->x = v6;
  return retstr;
}

//----- (0040BAE0) --------------------------------------------------------
CVector *__fastcall CPlayerInfo::GetPos(CVector *retstr, CPlayerInfo *this)
{
  CPlayerPed *pPed; // r1
  bool v3; // zf
  int m_pMyVehicle; // r2
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *v7; // r1
  __int64 v8; // d16

  pPed = this->pPed;
  m_pMyVehicle = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31;
  v3 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = (int)pPed->m_pMyVehicle;
    v3 = m_pMyVehicle == 0;
  }
  if ( v3 )
  {
    m_pMat = pPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
  }
  else
  {
    v7 = *(CSimpleTransform **)(m_pMyVehicle + 20);
    p_tx = v7 + 3;
    if ( !v7 )
      p_tx = (CSimpleTransform *)(m_pMyVehicle + 4);
  }
  v8 = *(_QWORD *)&p_tx->m_translate.x;
  retstr->z = p_tx->m_translate.z;
  *(_QWORD *)&retstr->x = v8;
  return retstr;
}

//----- (0040BB1C) --------------------------------------------------------
const CVector *__fastcall FindPlayerSpeed(Int32 Player)
{
  Int32 v1; // r1
  CPlayerPed *pPed; // r0
  const CVector *m_pMyVehicle; // r1

  v1 = CWorld::PlayerInFocus;
  if ( Player >= 0 )
    v1 = Player;
  pPed = CWorld::Players[v1].pPed;
  if ( !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
    return &pPed->m_vecMoveSpeed;
  m_pMyVehicle = (const CVector *)pPed->m_pMyVehicle;
  if ( !m_pMyVehicle )
    m_pMyVehicle = (const CVector *)pPed;
  return m_pMyVehicle + 6;
}

//----- (0040BB60) --------------------------------------------------------
bool IsPlayerRemotePlane()
{
  CPlayerPed *pPed; // r1
  bool v1; // zf
  CVehicle *pRemoteVehicle; // r0
  _BOOL4 result; // r0

  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  v1 = pPed == 0;
  if ( pPed )
    v1 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  result = 0;
  if ( !v1 )
  {
    pRemoteVehicle = CWorld::Players[CWorld::PlayerInFocus].pRemoteVehicle;
    if ( pRemoteVehicle )
    {
      if ( pRemoteVehicle->m_vehicleType == 4 )
        return 1;
    }
  }
  return result;
}

//----- (0040BBB8) --------------------------------------------------------
CEntity *__fastcall FindPlayerEntity(Int32 Player)
{
  Int32 v1; // r1
  CEntity *result; // r0
  CEntity *m_pLastRenderedLink; // r1

  v1 = CWorld::PlayerInFocus;
  if ( Player >= 0 )
    v1 = Player;
  result = CWorld::Players[v1].pPed;
  if ( BYTE1(result[19].m_transform.m_heading) << 31 )
  {
    m_pLastRenderedLink = (CEntity *)result[23].m_pLastRenderedLink;
    if ( !m_pLastRenderedLink )
      return result;
    return m_pLastRenderedLink;
  }
  return result;
}

//----- (0040BBF4) --------------------------------------------------------
CWanted *__fastcall FindPlayerWanted(Int32 Player)
{
  Int32 v1; // r1

  v1 = CWorld::PlayerInFocus;
  if ( Player >= 0 )
    v1 = Player;
  return CWorld::Players[v1].PlayerPedData.m_Wanted;
}

//----- (0040BC1C) --------------------------------------------------------
const CVector *__fastcall FindPlayerCentreOfWorld(Int32 Player)
{
  CCamera *pRemoteVehicle; // r1
  CPlayerPed *pPed; // r1
  bool v3; // zf
  const CVector *m_pMat; // r2
  const CVector *result; // r0

  if ( Player < 0 )
    Player = CWorld::PlayerInFocus;
  if ( CCarCtrl::bCarsGeneratedAroundCamera )
  {
    pRemoteVehicle = &TheCamera;
  }
  else
  {
    pRemoteVehicle = (CCamera *)CWorld::Players[Player].pRemoteVehicle;
    if ( !pRemoteVehicle )
    {
      pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
      v3 = pPed == 0;
      if ( pPed )
        v3 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
      if ( v3 || (pRemoteVehicle = (CCamera *)pPed->m_pMyVehicle) == 0 )
        pRemoteVehicle = (CCamera *)CWorld::Players[Player].pPed;
    }
  }
  m_pMat = (const CVector *)pRemoteVehicle->m_pMat;
  result = m_pMat + 4;
  if ( !m_pMat )
    return &pRemoteVehicle->m_transform.m_translate;
  return result;
}

//----- (0040BCA4) --------------------------------------------------------
const CVector *__fastcall FindPlayerCentreOfWorld_NoSniperShift(Int32 Player)
{
  CCamera *pRemoteVehicle; // r1
  Int32 v2; // r1
  CPlayerPed *pPed; // r1
  bool v4; // zf
  const CVector *m_pMat; // r2
  const CVector *result; // r0

  if ( CCarCtrl::bCarsGeneratedAroundCamera )
  {
    pRemoteVehicle = &TheCamera;
  }
  else
  {
    pRemoteVehicle = (CCamera *)CWorld::Players[Player].pRemoteVehicle;
    if ( !pRemoteVehicle )
    {
      v2 = CWorld::PlayerInFocus;
      if ( Player >= 0 )
        v2 = Player;
      pPed = CWorld::Players[v2].pPed;
      v4 = pPed == 0;
      if ( pPed )
        v4 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
      if ( v4 || (pRemoteVehicle = (CCamera *)pPed->m_pMyVehicle) == 0 )
      {
        pRemoteVehicle = (CCamera *)CWorld::Players[Player].pPed;
        if ( !pRemoteVehicle )
          return &NullVec;
      }
    }
  }
  m_pMat = (const CVector *)pRemoteVehicle->m_pMat;
  result = m_pMat + 4;
  if ( !m_pMat )
    return &pRemoteVehicle->m_transform.m_translate;
  return result;
}

//----- (0040BD38) --------------------------------------------------------
CVector *__fastcall FindPlayerCentreOfWorldForMap(CVector *retstr, Int32 Player)
{
  CPlayerInfo *v2; // r2
  Int32 v3; // r2
  CPlayerPed *pPed; // r2
  CCamera *pRemoteVehicle; // r2
  CPlayerPed *v6; // r2
  bool v7; // zf
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  __int64 v10; // d16

  if ( CHID::currentInstanceIndex == 1 )
  {
    v2 = &CWorld::Players[1];
  }
  else
  {
    v3 = CWorld::PlayerInFocus;
    if ( Player >= 0 )
      v3 = Player;
    v2 = &CWorld::Players[v3];
  }
  pPed = v2->pPed;
  retstr->x = 0.0;
  retstr->y = 0.0;
  retstr->z = 0.0;
  if ( pPed )
  {
    if ( Player < 0 )
      Player = CWorld::PlayerInFocus;
    if ( CCarCtrl::bCarsGeneratedAroundCamera )
    {
      pRemoteVehicle = &TheCamera;
    }
    else
    {
      pRemoteVehicle = (CCamera *)CWorld::Players[Player].pRemoteVehicle;
      if ( !pRemoteVehicle )
      {
        v6 = CWorld::Players[CWorld::PlayerInFocus].pPed;
        v7 = v6 == 0;
        if ( v6 )
          v7 = *((unsigned __int8 *)&v6->m_nPedFlags + 1) << 31 == 0;
        if ( v7 || (pRemoteVehicle = (CCamera *)v6->m_pMyVehicle) == 0 )
          pRemoteVehicle = (CCamera *)CWorld::Players[Player].pPed;
      }
    }
    m_pMat = pRemoteVehicle->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pRemoteVehicle->m_transform;
    v10 = *(_QWORD *)&p_tx->m_translate.x;
    retstr->z = p_tx->m_translate.z;
    *(_QWORD *)&retstr->x = v10;
    CEntryExitManager::GetPositionRelativeToOutsideWorld(retstr);
  }
  return retstr;
}

//----- (0040BE30) --------------------------------------------------------
float __fastcall FindPlayerHeading(Int32 Player)
{
  void *pRemoteVehicle; // r1
  Int32 v2; // r1
  CPlayerPed *pPed; // r1
  bool v4; // zf
  int v5; // r0

  pRemoteVehicle = CWorld::Players[Player].pRemoteVehicle;
  if ( !pRemoteVehicle )
  {
    v2 = CWorld::PlayerInFocus;
    if ( Player >= 0 )
      v2 = Player;
    pPed = CWorld::Players[v2].pPed;
    v4 = pPed == 0;
    if ( pPed )
      v4 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
    if ( v4 || (pRemoteVehicle = pPed->m_pMyVehicle) == 0 )
      pRemoteVehicle = CWorld::Players[Player].pPed;
  }
  v5 = *((_DWORD *)pRemoteVehicle + 5);
  if ( v5 )
    return sub_18D4E8(COERCE_FLOAT(*(_DWORD *)(v5 + 16) ^ 0x80000000), *(float *)(v5 + 20));
  else
    return *((float *)pRemoteVehicle + 4);
}

//----- (0040BEA4) --------------------------------------------------------
RwReal FindPlayerHeight()
{
  CPlayerPed *pPed; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2

  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  m_pMat = pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  return p_tx->m_translate.z;
}

//----- (0040BED4) --------------------------------------------------------
Bool8 __fastcall CPlayerInfo::IsRestartingAfterDeath(CPlayerInfo *this)
{
  int PlayerState; // r0

  PlayerState = this->PlayerState;
  if ( PlayerState != 1 )
    LOBYTE(PlayerState) = 0;
  return PlayerState;
}

//----- (0040BEE0) --------------------------------------------------------
Bool8 __fastcall CPlayerInfo::IsRestartingAfterArrest(CPlayerInfo *this)
{
  return this->PlayerState == 2;
}

//----- (0040BEEE) --------------------------------------------------------
Bool8 __fastcall CPlayerInfo::IsRestartingAfterMissionFailed(CPlayerInfo *this)
{
  return this->PlayerState == 3;
}

//----- (0040BEFC) --------------------------------------------------------
void __fastcall CPlayerInfo::KillPlayer(CPlayerInfo *this)
{
  GxtChar *v1; // r0

  if ( !this->PlayerState )
  {
    this->PlayerState = 1;
    CDarkel::ResetOnPlayerDeath();
    v1 = CText::Get(&TheText, "DEAD");
    CMessages::AddBigMessage(v1, 0xFA0u, 2u);
    CStats::IncrementStat(0x87u, 1.0);
    sub_199174(0);
  }
}

//----- (0040BF4C) --------------------------------------------------------
void __fastcall CPlayerInfo::ArrestPlayer(CPlayerInfo *this)
{
  if ( !this->PlayerState )
  {
    this->m_nBustedAudioStatus = 0;
    this->PlayerState = 2;
    CDarkel::ResetOnPlayerDeath();
    CStats::IncrementStat(0x85u, 1.0);
    sub_199174(0);
  }
}

//----- (0040BF80) --------------------------------------------------------
void __fastcall CPlayerInfo::PlayerFailedCriticalMission(CPlayerInfo *this)
{
  if ( !this->PlayerState )
  {
    this->PlayerState = 3;
    CGameLogic::TimeOfLastEvent = CTimer::m_snTimeInMilliseconds;
    CGameLogic::GameState = 3;
    sub_19A0EC();
  }
}

//----- (0040BFCC) --------------------------------------------------------
void __fastcall CPlayerInfo::MakePlayerSafe(CPlayerInfo *this, bool bSafeState, float ExtinguishRange)
{
  _BOOL4 v5; // r5
  CPad *PadFromPlayer; // r6
  CWanted *m_Wanted; // r0
  char v8; // r1
  CVehicle *m_pMyVehicle; // r2
  CPlayerPed *pPed; // r1
  bool v11; // zf
  CMatrix *m_pMat; // r2
  CVector *p_tx; // r0
  CVector *v14; // r1
  CPlayerPed *v15; // r0
  bool v16; // zf
  int v17; // r1
  CMatrix *v18; // r1
  CVector *p_m_translate; // r2
  CVector *v20; // r0
  CPlayerPed *v21; // r0
  bool v22; // zf
  int v23; // r1
  CMatrix *v24; // r1
  CVector *v25; // r2
  CVector *v26; // r0
  CPlayerInfo *v27; // r0

  v5 = bSafeState;
  PadFromPlayer = CPlayerPed::GetPadFromPlayer(this->pPed);
  m_Wanted = this->PlayerPedData.m_Wanted;
  v8 = *((_BYTE *)m_Wanted + 30);
  if ( v5 )
  {
    *((_BYTE *)m_Wanted + 30) = v8 | 4;
    CWorld::StopAllLawEnforcersInTheirTracks();
    PadFromPlayer->DisablePlayerControls |= 0x20u;
    CPad::StopPadsShaking();
    *(_DWORD *)&this->pPed->m_nPhysicalFlags |= 0x400000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags |= 0x40000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags |= 0x80000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags |= 0x800000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags |= 0x100000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags |= 0x200000u;
    *((_WORD *)this->pPed->m_pPlayerData + 26) &= ~0x10u;
    CPlayerPed::ClearAdrenaline(this->pPed);
    if ( this->PlayerPedData.m_fSprintEnergy < 0.0 )
      this->PlayerPedData.m_fSprintEnergy = 0.0;
    CPedIntelligence::ClearTasks(this->pPed->m_pPedIntelligence, 1, 0);
    pPed = this->pPed;
    v11 = *((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31 == 0;
    if ( *((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31 )
    {
      m_pMyVehicle = pPed->m_pMyVehicle;
      v11 = m_pMyVehicle == 0;
    }
    if ( v11 )
    {
      m_pMat = pPed->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform.m_translate;
    }
    else
    {
      v14 = (CVector *)m_pMyVehicle->m_pMat;
      p_tx = v14 + 4;
      if ( !v14 )
        p_tx = &m_pMyVehicle->m_transform.m_translate;
    }
    CFireManager::ExtinguishPoint(&gFireManager, *p_tx, ExtinguishRange);
    v15 = this->pPed;
    v17 = *((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31;
    v16 = v17 == 0;
    if ( v17 )
    {
      v17 = (int)v15->m_pMyVehicle;
      v16 = v17 == 0;
    }
    if ( v16 )
    {
      v18 = v15->m_pMat;
      p_m_translate = (CVector *)&v18->tx;
      if ( !v18 )
        p_m_translate = &v15->m_transform.m_translate;
    }
    else
    {
      v20 = *(CVector **)(v17 + 20);
      p_m_translate = v20 + 4;
      if ( !v20 )
        p_m_translate = (CVector *)(v17 + 4);
    }
    CExplosion::RemoveAllExplosionsInArea(*p_m_translate, 4000.0);
    CProjectileInfo::RemoveAllProjectiles();
    CWorld::SetAllCarsCanBeDamaged(0);
    v21 = this->pPed;
    v23 = *((unsigned __int8 *)&this->pPed->m_nPedFlags + 1) << 31;
    v22 = v23 == 0;
    if ( v23 )
    {
      v23 = (int)v21->m_pMyVehicle;
      v22 = v23 == 0;
    }
    if ( v22 )
    {
      v24 = v21->m_pMat;
      v25 = (CVector *)&v24->tx;
      if ( !v24 )
        v25 = &v21->m_transform.m_translate;
    }
    else
    {
      v26 = *(CVector **)(v23 + 20);
      v25 = v26 + 4;
      if ( !v26 )
        v25 = (CVector *)(v23 + 4);
    }
    CWorld::ExtinguishAllCarFiresInArea(*v25, ExtinguishRange);
    CPlayerPed::ClearWeaponTarget(this->pPed);
    if ( CHID::currentInstanceIndex == 1 )
      v27 = &CWorld::Players[1];
    else
      v27 = &CWorld::Players[CWorld::PlayerInFocus];
    *((_WORD *)v27->pPed->m_pPlayerData + 26) &= ~8u;
  }
  else
  {
    *((_BYTE *)m_Wanted + 30) = v8 & 0xFB;
    PadFromPlayer->DisablePlayerControls &= ~0x20u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags &= ~0x400000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags &= ~0x40000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags &= ~0x80000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags &= ~0x800000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags &= ~0x100000u;
    *(_DWORD *)&this->pPed->m_nPhysicalFlags &= ~0x200000u;
    *((_WORD *)this->pPed->m_pPlayerData + 26) |= 0x10u;
    sub_1919C0(1);
  }
}
// 40C10E: variable 'm_pMyVehicle' is possibly undefined

//----- (0040C204) --------------------------------------------------------
void __fastcall CPlayerInfo::BlowUpRCBuggy(CPlayerInfo *this, bool bCauseExplosion)
{
  _BOOL4 v3; // r5
  CVehicle *pRemoteVehicle; // r0
  CPlayerInfo *v5; // r1

  v3 = bCauseExplosion;
  pRemoteVehicle = this->pRemoteVehicle;
  if ( pRemoteVehicle )
  {
    if ( (*((_BYTE *)&pRemoteVehicle->m_nFlags + 1) & 8) == 0 )
    {
      CRemote::TakeRemoteControlledCarFromPlayer(bCauseExplosion);
      if ( v3 )
      {
        if ( CHID::currentInstanceIndex == 1 )
          v5 = &CWorld::Players[1];
        else
          v5 = &CWorld::Players[CWorld::PlayerInFocus];
        (*((void (__fastcall **)(CVehicle *, CPlayerPed *, _DWORD))this->pRemoteVehicle->_vptr$CPlaceable + 42))(
          this->pRemoteVehicle,
          v5->pPed,
          0);
      }
    }
  }
}

//----- (0040C278) --------------------------------------------------------
void __fastcall CPlayerInfo::SetPlayerSkin(CPlayerInfo *this, const unsigned __int8 *pSkinName)
{
  unsigned __int8 *m_skinName; // r5
  RwTexture_0 *m_pSkinTexture; // r0

  m_skinName = this->m_skinName;
  strncpy((char *)this->m_skinName, (const char *)pSkinName, 0x20u);
  m_pSkinTexture = this->m_pSkinTexture;
  if ( m_pSkinTexture )
  {
    RwTextureDestroy(m_pSkinTexture);
    this->m_pSkinTexture = 0;
  }
  this->m_pSkinTexture = CPlayerSkin::GetSkinTexture(m_skinName);
}

//----- (0040C2A6) --------------------------------------------------------
void __fastcall CPlayerInfo::LoadPlayerSkin(CPlayerInfo *this)
{
  RwTexture_0 *m_pSkinTexture; // r0

  m_pSkinTexture = this->m_pSkinTexture;
  if ( m_pSkinTexture )
  {
    RwTextureDestroy(m_pSkinTexture);
    this->m_pSkinTexture = 0;
  }
  this->m_pSkinTexture = CPlayerSkin::GetSkinTexture(this->m_skinName);
}

//----- (0040C2CA) --------------------------------------------------------
void __fastcall CPlayerInfo::DeletePlayerSkin(CPlayerInfo *this)
{
  RwTexture_0 *m_pSkinTexture; // r0

  m_pSkinTexture = this->m_pSkinTexture;
  if ( m_pSkinTexture )
  {
    RwTextureDestroy(m_pSkinTexture);
    this->m_pSkinTexture = 0;
  }
}

//----- (0040C2E6) --------------------------------------------------------
void __fastcall CPlayerInfo::AddHealth(CPlayerInfo *this, Int32 Amount)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float *p_m_nHealth; // r1

  v2.n64_f32[0] = (float)Amount;
  p_m_nHealth = &this->pPed->m_nHealth;
  v3.n64_f32[0] = *p_m_nHealth;
  v4.n64_f32[0] = (float)this->MaxHealth;
  v2.n64_f32[0] = *p_m_nHealth + v2.n64_f32[0];
  *(_DWORD *)p_m_nHealth = vmax_f32(v3, vmin_f32(v2, v4)).n64_u32[0];
}
// 40C30C: variable 'v3' is possibly undefined
// 40C308: variable 'v2' is possibly undefined
// 40C308: variable 'v4' is possibly undefined

//----- (0040C318) --------------------------------------------------------
void __fastcall CPlayerCrossHair::Render(CPlayerCrossHair *this, Int32 PlayerIndex)
{
  UInt32 *v4; // r2
  __int64 *v5; // r0
  __int64 v6; // d16
  __int64 v7; // d17
  int v8; // r8
  __int64 *v9; // r0
  _QWORD *v10; // r6
  __int64 v11; // d16
  __int64 v12; // d17
  int v13; // r6
  float TargetY; // r2
  unsigned int v15; // r5
  CPtrNodeSingleLinkPool *v16; // r0
  int v17; // r2
  Int32 v18; // r6
  int v19; // r10
  float v20; // s23
  float v21; // s25
  int v22; // r8
  UInt32 *v23; // [sp+24h] [bp-8Ch]
  Int32 v24; // [sp+28h] [bp-88h]
  int v25; // [sp+2Ch] [bp-84h]
  float *v26; // [sp+30h] [bp-80h]
  float *v27; // [sp+34h] [bp-7Ch]
  unsigned int v28; // [sp+38h] [bp-78h]
  unsigned int v29; // [sp+3Ch] [bp-74h]

  if ( this->bActivated )
  {
    RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, 0);
    RwRenderStateSet(rwRENDERSTATEZTESTENABLE, 0);
    RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
    RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
    RwRenderStateSet(rwRENDERSTATEDESTBLEND, byte_8);
    RwRenderStateSet(rwRENDERSTATETEXTURERASTER, gpCoronaTexture[8]->raster);
    v4 = OldTime[PlayerIndex];
    v4[4] = (UInt32)CPools::ms_pPedPool;
    v4[3] = (UInt32)CPools::ms_pEntryInfoNodePool;
    v4[2] = (UInt32)CPools::ms_pPtrNodeDoubleLinkPool;
    v5 = (__int64 *)OldTargetX[PlayerIndex];
    v6 = *v5;
    v7 = v5[1];
    v5 = (__int64 *)((char *)v5 + 4);
    v8 = 0;
    *v5 = v6;
    v5[1] = v7;
    v9 = (__int64 *)OldTargetY[PlayerIndex];
    v10 = (__int64 *)((char *)v9 + 4);
    v11 = *v9;
    v12 = v9[1];
    v16 = CPools::ms_pPtrNodeSingleLinkPool;
    *v10 = v11;
    v10[1] = v12;
    v13 = 0;
    v23 = v4;
    v4[1] = (UInt32)v16;
    OldTargetX[PlayerIndex][0] = this->TargetX;
    TargetY = this->TargetY;
    v15 = 255;
    OldTargetY[PlayerIndex][0] = TargetY;
    LOWORD(v16) = CTimer::m_snTimeInMilliseconds;
    v24 = PlayerIndex;
    OldTime[PlayerIndex][0] = CTimer::m_snTimeInMilliseconds;
    if ( PlayerIndex )
    {
      PlayerIndex = 50;
    }
    else
    {
      v15 = 50;
      v13 = 255;
    }
    v17 = v13;
    v18 = PlayerIndex;
    while ( 1 )
    {
      v29 = v17;
      v19 = 0;
      v27 = &OldTargetY[v24][v8];
      v25 = v8;
      v20 = (float)(sinf((float)((unsigned __int16)v16 & 0x3FF) * 0.0061359) * 0.2) + 1.0;
      v26 = &OldTargetX[v24][v8];
      v28 = v18;
      do
      {
        v21 = v20 * (float)((float)((float)v19 * 10.0) + 20.0);
        CSprite::RenderOneXLUSprite_Rotate_Aspect(
          (float)(v21 * 0.70711) + (float)((float)((float)(*v26 + 1.0) * (float)RsGlobal.screenWidth) * 0.5),
          (float)(v21 * 0.70711) + (float)((float)((float)(*v27 + 1.0) * (float)RsGlobal.screenHeight) * 0.5),
          10.0,
          15.0,
          15.0,
          (unsigned __int8)v18,
          (unsigned __int8)v29,
          (unsigned __int8)v15,
          255,
          0.01,
          0.0,
          0xFFu);
        v22 = (unsigned __int8)v18;
        CSprite::RenderOneXLUSprite_Rotate_Aspect(
          (float)(v21 * 0.70711) + (float)((float)((float)(*v26 + 1.0) * (float)RsGlobal.screenWidth) * 0.5),
          (float)(v21 * -0.70711) + (float)((float)((float)(*v27 + 1.0) * (float)RsGlobal.screenHeight) * 0.5),
          10.0,
          15.0,
          15.0,
          (unsigned __int8)v18,
          (unsigned __int8)v29,
          (unsigned __int8)v15,
          255,
          0.01,
          0.0,
          0xFFu);
        CSprite::RenderOneXLUSprite_Rotate_Aspect(
          (float)(v21 * -0.70711) + (float)((float)((float)(*v26 + 1.0) * (float)RsGlobal.screenWidth) * 0.5),
          (float)(v21 * -0.70711) + (float)((float)((float)(*v27 + 1.0) * (float)RsGlobal.screenHeight) * 0.5),
          10.0,
          15.0,
          15.0,
          (unsigned __int8)v18,
          (unsigned __int8)v29,
          (unsigned __int8)v15,
          255,
          0.01,
          0.0,
          0xFFu);
        LOBYTE(v18) = v28;
        CSprite::RenderOneXLUSprite_Rotate_Aspect(
          (float)(v21 * -0.70711) + (float)((float)((float)(*v26 + 1.0) * (float)RsGlobal.screenWidth) * 0.5),
          (float)(v21 * 0.70711) + (float)((float)((float)(*v27 + 1.0) * (float)RsGlobal.screenHeight) * 0.5),
          10.0,
          15.0,
          15.0,
          v22,
          (unsigned __int8)v29,
          (unsigned __int8)v15,
          255,
          0.01,
          0.0,
          0xFFu);
        ++v19;
      }
      while ( v19 != 3 );
      v8 = v25 + 1;
      if ( v25 == 4 )
        break;
      v18 = v28 >> 1;
      v17 = v29 >> 1;
      v15 >>= 1;
      v16 = (CPtrNodeSingleLinkPool *)*v23;
    }
    RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, (char *)&dword_0 + 1);
    sub_192840(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
  }
}
// 0: using guessed type int dword_0;
// 5: using guessed type char byte_5;

//----- (0040C710) --------------------------------------------------------
void __fastcall CPlayerPedData::CPlayerPedData(CPlayerPedData *this)
{
  __int16 v3; // r0
  __int16 v4; // r1

  v3 = *((_WORD *)this + 26);
  *(_QWORD *)&this->m_Wanted = 0LL;
  *(_QWORD *)&this->m_ArrestingOfficer = 0LL;
  this->m_vecFightMovement.y = 0.0;
  this->m_moveBlendRatio = 0.0;
  *(_WORD *)&this->m_nChosenWeapon = 0;
  this->m_nStandStillTimer = 0;
  this->m_nHitAnimDelayTimer = 0;
  this->m_fAttackButtonCounter = 0.0;
  this->m_pDangerCar = 0;
  this->m_nDrugLevel = 0;
  *(_WORD *)&this->m_nDrunkenness = 0;
  this->m_AdrenalineEndTime = 0;
  this->m_MeleeWeaponAnimReferenced = ANIM_STD_PED;
  this->m_MeleeWeaponAnimReferencedExtra = ANIM_STD_PED;
  this->m_fFPSMoveHeading = 0.0;
  this->m_fLookPitch = 0.0;
  this->m_fSkateBoardSpeed = 0.0;
  this->m_nScriptLimitToGangSize = 99;
  this->m_DPadDownPressedInMilliseconds = 0;
  this->m_DPadUpPressedInMilliseconds = 0;
  *(_QWORD *)&this->m_vecTargetBoneOffset.x = 0LL;
  *(_QWORD *)&this->m_vecTargetBoneOffset.z = 0LL;
  this->m_bForceInteriorLighting = 0;
  *(_QWORD *)&this->m_fGunSpinSpeed = 0LL;
  *(_QWORD *)&this->m_LastTimeFiring = 0LL;
  *(_WORD *)&this->m_bPlayerSprintDisabled = 0;
  *((_WORD *)this + 26) = v3 & 0xE7A0 | 0x1010;
  this->m_playersGangActive = 1;
  this->m_wetness = 0;
  this->m_fSprintEnergy = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY);
  this->m_fSprintControlCounter = 0.0;
  this->m_fBreath = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_BREATH_UNDERWATER);
  this->m_pSpecialAtomic = 0;
  v4 = *((_WORD *)this + 26);
  this->m_FireHSMissilePressedTime = 0;
  this->m_LastHSMissileTarget = 0;
  this->m_nModelIndexOfLastBuildingShot = -1;
  *((_DWORD *)this + 40) = 0x80000000;
  this->m_pCurrentProstitutePed = 0;
  this->m_pLastProstituteShagged = 0;
  *((_WORD *)this + 26) = v4 & 0xFF7F;
}

//----- (0040C7BA) --------------------------------------------------------
void __fastcall CPlayerPedData::SetInitialState(CPlayerPedData *this)
{
  __int16 v2; // r0
  __int16 v3; // r1

  *(_WORD *)&this->m_nChosenWeapon = 0;
  this->m_nStandStillTimer = 0;
  this->m_nHitAnimDelayTimer = 0;
  this->m_fAttackButtonCounter = 0.0;
  this->m_pDangerCar = 0;
  this->m_nDrugLevel = 0;
  *(_WORD *)&this->m_nDrunkenness = 0;
  this->m_AdrenalineEndTime = 0;
  this->m_nScriptLimitToGangSize = 99;
  this->m_fFPSMoveHeading = 0.0;
  this->m_fLookPitch = 0.0;
  this->m_fSkateBoardSpeed = 0.0;
  *(_WORD *)&this->m_bPlayerSprintDisabled = 0;
  this->m_bForceInteriorLighting = 0;
  *(_DWORD *)&this->m_DPadDownPressedInMilliseconds = 0;
  v2 = *((_WORD *)this + 26);
  *(_QWORD *)&this->m_ArrestingOfficer = 0LL;
  *(_QWORD *)&this->m_vecFightMovement.y = 0LL;
  *(_QWORD *)&this->m_vecTargetBoneOffset.x = 0LL;
  *(_QWORD *)&this->m_vecTargetBoneOffset.z = 0LL;
  *(_QWORD *)&this->m_fGunSpinSpeed = 0LL;
  *(_QWORD *)&this->m_LastTimeFiring = 0LL;
  *((_WORD *)this + 26) = v2 & 0xE7A0 | 0x1010;
  this->m_playersGangActive = 1;
  this->m_wetness = 0;
  this->m_fSprintEnergy = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY);
  this->m_fSprintControlCounter = 0.0;
  this->m_fBreath = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_BREATH_UNDERWATER);
  v3 = *((_WORD *)this + 26);
  this->m_FireHSMissilePressedTime = 0;
  this->m_LastHSMissileTarget = 0;
  this->m_nModelIndexOfLastBuildingShot = -1;
  *((_DWORD *)this + 40) = 0x80000000;
  this->m_pCurrentProstitutePed = 0;
  this->m_pLastProstituteShagged = 0;
  *((_WORD *)this + 26) = v3 & 0xFF7F;
}

//----- (0040C854) --------------------------------------------------------
void __fastcall CPlayerPedData::~CPlayerPedData(CPlayerPedData *this)
{
  CWanted *m_Wanted; // r5
  CPedClothesDesc *m_pClothes; // r0

  m_Wanted = this->m_Wanted;
  if ( this->m_Wanted )
  {
    CAEPoliceScannerAudioEntity::~CAEPoliceScannerAudioEntity(&m_Wanted->m_PoliceScannerAudioEntity);
    operator delete(m_Wanted);
    this->m_Wanted = 0;
  }
  m_pClothes = this->m_pClothes;
  if ( m_pClothes )
  {
    operator delete(m_pClothes);
    this->m_pClothes = 0;
  }
}

//----- (0040C880) --------------------------------------------------------
void __fastcall CPlayerPedData::AllocateData(CPlayerPedData *this)
{
  CWanted *m_Wanted; // r5
  CPedClothesDesc *m_pClothes; // r0
  CPedClothesDesc *v4; // r0

  m_Wanted = this->m_Wanted;
  if ( !this->m_Wanted )
  {
    m_Wanted = (CWanted *)operator new(0x29Cu);
    memset(m_Wanted, 0, sizeof(CWanted));
    m_Wanted->m_PoliceScannerAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667848;
    this->m_Wanted = m_Wanted;
  }
  CWanted::Initialise(m_Wanted);
  m_pClothes = this->m_pClothes;
  if ( !m_pClothes )
  {
    v4 = (CPedClothesDesc *)operator new(0x78u);
    CPedClothesDesc::CPedClothesDesc(v4);
    this->m_pClothes = m_pClothes;
  }
  sub_19BA10(m_pClothes);
}
// 40C8C6: variable 'm_pClothes' is possibly undefined
// 667848: using guessed type void *off_667848;

//----- (0040C8D4) --------------------------------------------------------
void __fastcall CPlayerPedData::DeAllocateData(CPlayerPedData *this)
{
  CWanted *m_Wanted; // r5
  CPedClothesDesc *m_pClothes; // r0

  m_Wanted = this->m_Wanted;
  if ( this->m_Wanted )
  {
    CAEPoliceScannerAudioEntity::~CAEPoliceScannerAudioEntity(&m_Wanted->m_PoliceScannerAudioEntity);
    operator delete(m_Wanted);
  }
  m_pClothes = this->m_pClothes;
  this->m_Wanted = 0;
  if ( m_pClothes )
    operator delete(m_pClothes);
  this->m_pClothes = 0;
}

//----- (0040C900) --------------------------------------------------------
void CPools::Initialise()
{
  CPtrNodeSingleLinkPool *v0; // r4
  uint8 *v1; // r0
  uint8 v2; // r1
  int *v3; // r0
  CPtrNodeDoubleLinkPool *v4; // r4
  uint8 *v5; // r0
  uint8 v6; // r1
  int i; // r0
  CEntryInfoNodePool *v8; // r4
  uint8 *v9; // r0
  uint8 v10; // r1
  int j; // r0
  CPedPool *v12; // r4
  uint8 *v13; // r0
  uint8 v14; // r1
  int k; // r0
  CVehiclePool *v16; // r4
  uint8 *v17; // r0
  uint8 v18; // r1
  int m; // r0
  CBuildingPool *v20; // r4
  uint8 *v21; // r0
  uint8 v22; // r1
  int n; // r0
  CObjectPool *v24; // r4
  uint8 *v25; // r0
  uint8 v26; // r1
  int ii; // r0
  CDummyPool *v28; // r4
  uint8 *v29; // r0
  uint8 v30; // r1
  int v31; // r0
  int v32; // r1
  CColModelPool *v33; // r4
  uint8 *v34; // r0
  uint8 v35; // r1
  int jj; // r0
  CTaskPool *v37; // r4
  uint8 *v38; // r0
  uint8 v39; // r1
  int kk; // r0
  CEventPool *v41; // r4
  uint8 *v42; // r0
  uint8 v43; // r1
  int mm; // r0
  CPointRoutePool *v45; // r4
  uint8 *v46; // r0
  uint8 v47; // r1
  int nn; // r0
  CPatrolRoutePool *v49; // r4
  uint8 *v50; // r0
  uint8 v51; // r1
  int i1; // r0
  CNodeRoutePool *v53; // r4
  uint8 *v54; // r0
  uint8 v55; // r1
  int i2; // r0
  CTaskAllocatorPool *v57; // r4
  uint8 *v58; // r0
  CPedIntelligencePool *v59; // r4
  uint8 *v60; // r0
  uint8 v61; // r1
  int i3; // r0
  CPedAttractorPool *v63; // r4
  uint8 *v64; // r0
  uint8 v65; // r1
  int i4; // r0

  v0 = (CPtrNodeSingleLinkPool *)operator new(0x14u);
  v0->m_aStorage = (CPool<CPtrNodeSingleLink,CPtrNodeSingleLink>::StorageType *)operator new[]((unsigned int)"ceShowAdv");
  v1 = (uint8 *)operator new[]((unsigned int)&elf_hash_chain[2276]);
  v0->m_bOwnsArrays = 1;
  v0->m_aFlags = v1;
  v0->m_nSize = (int32)&elf_hash_chain[2276];
  v0->m_nFreeIndex = -1;
  v2 = v1[1];
  *v1 = 0x80;
  v1[1] = v2 | 0x80;
  v0->m_aFlags[1] &= 0x80u;
  v3 = &dword_0 + 2;
  do
  {
    v0->m_aFlags[(unsigned int)v3] |= 0x80u;
    v0->m_aFlags[(unsigned int)v3] &= 0x80u;
    v3 = (int *)((char *)v3 + 1);
  }
  while ( v3 != &elf_hash_chain[2276] );
  CPools::ms_pPtrNodeSingleLinkPool = v0;
  v4 = (CPtrNodeDoubleLinkPool *)operator new(0x14u);
  v4->m_aStorage = (CPool<CPtrNodeDoubleLink,CPtrNodeDoubleLink>::StorageType *)operator new[]((unsigned int)&elf_hash_chain[1526]);
  v5 = (uint8 *)operator new[](0x1770u);
  v4->m_bOwnsArrays = 1;
  v4->m_aFlags = v5;
  v4->m_nSize = 6000;
  v4->m_nFreeIndex = -1;
  v6 = v5[1];
  *v5 = 0x80;
  v5[1] = v6 | 0x80;
  v4->m_aFlags[1] &= 0x80u;
  for ( i = 2; i != 6000; ++i )
  {
    v4->m_aFlags[i] |= 0x80u;
    v4->m_aFlags[i] &= 0x80u;
  }
  CPools::ms_pPtrNodeDoubleLinkPool = v4;
  v8 = (CEntryInfoNodePool *)operator new(0x14u);
  v8->m_aStorage = (CPool<CEntryInfoNode,CEntryInfoNode>::StorageType *)operator new[](0x2710u);
  v9 = (uint8 *)operator new[](0x1F4u);
  v8->m_bOwnsArrays = 1;
  v8->m_aFlags = v9;
  v8->m_nSize = 500;
  v8->m_nFreeIndex = -1;
  v10 = v9[1];
  *v9 = 0x80;
  v9[1] = v10 | 0x80;
  v8->m_aFlags[1] &= 0x80u;
  for ( j = 2; j != 500; ++j )
  {
    v8->m_aFlags[j] |= 0x80u;
    v8->m_aFlags[j] &= 0x80u;
  }
  CPools::ms_pEntryInfoNodePool = v8;
  v12 = (CPedPool *)operator new(0x14u);
  v12->m_aStorage = (CPool<CPed,CCopPed>::StorageType *)operator new[]((unsigned int)&stru_4438C.st_value);
  v13 = (uint8 *)operator new[](0x8Cu);
  v12->m_bOwnsArrays = 1;
  v12->m_aFlags = v13;
  v12->m_nSize = 140;
  v12->m_nFreeIndex = -1;
  v14 = v13[1];
  *v13 = 0x80;
  v13[1] = v14 | 0x80;
  v12->m_aFlags[1] &= 0x80u;
  for ( k = 2; k != 140; ++k )
  {
    v12->m_aFlags[k] |= 0x80u;
    v12->m_aFlags[k] &= 0x80u;
  }
  CPools::ms_pPedPool = v12;
  v16 = (CVehiclePool *)operator new(0x14u);
  v16->m_aStorage = (CPool<CVehicle,CHeli>::StorageType *)operator new[]((unsigned int)&stru_45EDC.st_info);
  v17 = (uint8 *)operator new[](0x6Eu);
  v16->m_bOwnsArrays = 1;
  v16->m_aFlags = v17;
  v16->m_nSize = 110;
  v16->m_nFreeIndex = -1;
  v18 = v17[1];
  *v17 = 0x80;
  v17[1] = v18 | 0x80;
  v16->m_aFlags[1] &= 0x80u;
  for ( m = 2; m != 110; ++m )
  {
    v16->m_aFlags[m] |= 0x80u;
    v16->m_aFlags[m] &= 0x80u;
  }
  CPools::ms_pVehiclePool = v16;
  v20 = (CBuildingPool *)operator new(0x14u);
  v20->m_aStorage = (CPool<CBuilding,CBuilding>::StorageType *)operator new[]((unsigned int)"3AddEP4CPedP6CEvent");
  v21 = (uint8 *)operator new[](0x36B0u);
  v20->m_bOwnsArrays = 1;
  v20->m_aFlags = v21;
  v20->m_nSize = 14000;
  v20->m_nFreeIndex = -1;
  v22 = v21[1];
  *v21 = 0x80;
  v21[1] = v22 | 0x80;
  v20->m_aFlags[1] &= 0x80u;
  for ( n = 2; n != 14000; ++n )
  {
    v20->m_aFlags[n] |= 0x80u;
    v20->m_aFlags[n] &= 0x80u;
  }
  CPools::ms_pBuildingPool = v20;
  v24 = (CObjectPool *)operator new(0x14u);
  v24->m_aStorage = (CPool<CObject,CCutsceneObject>::StorageType *)operator new[]((unsigned int)&elf_hash_chain[20276]);
  v25 = (uint8 *)operator new[](0x15Eu);
  v24->m_bOwnsArrays = 1;
  v24->m_aFlags = v25;
  v24->m_nSize = 350;
  v24->m_nFreeIndex = -1;
  v26 = v25[1];
  *v25 = 0x80;
  v25[1] = v26 | 0x80;
  v24->m_aFlags[1] &= 0x80u;
  for ( ii = 2; ii != 350; ++ii )
  {
    v24->m_aFlags[ii] |= 0x80u;
    v24->m_aFlags[ii] &= 0x80u;
  }
  CPools::ms_pObjectPool = v24;
  v28 = (CDummyPool *)operator new(0x14u);
  v28->m_aStorage = (CPool<CDummy,CDummy>::StorageType *)operator new[]((unsigned int)&stru_3344C.st_value);
  v29 = (uint8 *)operator new[](0xDACu);
  v28->m_bOwnsArrays = 1;
  v28->m_aFlags = v29;
  v28->m_nSize = 3500;
  v28->m_nFreeIndex = -1;
  v30 = v29[1];
  *v29 = 0x80;
  v29[1] = v30 | 0x80;
  v28->m_aFlags[1] &= 0x80u;
  v31 = -3498;
  do
  {
    v28->m_aFlags[v31 + 3500] |= 0x80u;
    v32 = (int)&v28->m_aFlags[v31++];
    *(_BYTE *)(v32 + 3500) &= 0x80u;
  }
  while ( v31 );
  CPools::ms_pDummyPool = v28;
  v33 = (CColModelPool *)operator new(0x14u);
  v33->m_aStorage = (CPool<CColModel,CColModel>::StorageType *)operator new[]((unsigned int)&stru_76F1C.st_value);
  v34 = (uint8 *)operator new[](0x27A6u);
  v33->m_bOwnsArrays = 1;
  v33->m_aFlags = v34;
  v33->m_nSize = 10150;
  v33->m_nFreeIndex = -1;
  v35 = v34[1];
  *v34 = 0x80;
  v34[1] = v35 | 0x80;
  v33->m_aFlags[1] &= 0x80u;
  for ( jj = 2; jj != 10150; ++jj )
  {
    v33->m_aFlags[jj] |= 0x80u;
    v33->m_aFlags[jj] &= 0x80u;
  }
  CPools::ms_pColModelPool = v33;
  v37 = (CTaskPool *)operator new(0x14u);
  v37->m_aStorage = (CPool<CTask,char [128]>::StorageType *)operator new[](0xFA00u);
  v38 = (uint8 *)operator new[](0x1F4u);
  v37->m_bOwnsArrays = 1;
  v37->m_aFlags = v38;
  v37->m_nSize = 500;
  v37->m_nFreeIndex = -1;
  v39 = v38[1];
  *v38 = 0x80;
  v38[1] = v39 | 0x80;
  v37->m_aFlags[1] &= 0x80u;
  for ( kk = 2; kk != 500; ++kk )
  {
    v37->m_aFlags[kk] |= 0x80u;
    v37->m_aFlags[kk] &= 0x80u;
  }
  CPools::ms_pTaskPool = v37;
  v41 = (CEventPool *)operator new(0x14u);
  v41->m_aStorage = (CPool<CEvent,char [68]>::StorageType *)operator new[](0x3520u);
  v42 = (uint8 *)operator new[](0xC8u);
  v41->m_bOwnsArrays = 1;
  v41->m_aFlags = v42;
  v41->m_nSize = 200;
  v41->m_nFreeIndex = -1;
  v43 = v42[1];
  *v42 = 0x80;
  v42[1] = v43 | 0x80;
  v41->m_aFlags[1] &= 0x80u;
  for ( mm = 2; mm != 200; ++mm )
  {
    v41->m_aFlags[mm] |= 0x80u;
    v41->m_aFlags[mm] &= 0x80u;
  }
  CPools::ms_pEventPool = v41;
  v45 = (CPointRoutePool *)operator new(0x14u);
  v45->m_aStorage = (CPool<CPointRoute,CPointRoute>::StorageType *)operator new[](0x1900u);
  v46 = (uint8 *)operator new[](0x40u);
  v45->m_bOwnsArrays = 1;
  v45->m_aFlags = v46;
  v45->m_nSize = 64;
  v45->m_nFreeIndex = -1;
  v47 = v46[1];
  *v46 = 0x80;
  v46[1] = v47 | 0x80;
  v45->m_aFlags[1] &= 0x80u;
  for ( nn = 2; nn != 64; ++nn )
  {
    v45->m_aFlags[nn] |= 0x80u;
    v45->m_aFlags[nn] &= 0x80u;
  }
  CPools::ms_pPointRoutePool = v45;
  v49 = (CPatrolRoutePool *)operator new(0x14u);
  v49->m_aStorage = (CPool<CPatrolRoute,CPatrolRoute>::StorageType *)operator new[](0x3480u);
  v50 = (uint8 *)operator new[](0x20u);
  v49->m_bOwnsArrays = 1;
  v49->m_aFlags = v50;
  v49->m_nSize = 32;
  v49->m_nFreeIndex = -1;
  v51 = v50[1];
  *v50 = 0x80;
  v50[1] = v51 | 0x80;
  v49->m_aFlags[1] &= 0x80u;
  for ( i1 = 2; i1 != 32; ++i1 )
  {
    v49->m_aFlags[i1] |= 0x80u;
    v49->m_aFlags[i1] &= 0x80u;
  }
  CPools::ms_pPatrolRoutePool = v49;
  v53 = (CNodeRoutePool *)operator new(0x14u);
  v53->m_aStorage = (CPool<CNodeRoute,CNodeRoute>::StorageType *)operator new[](0x900u);
  v54 = (uint8 *)operator new[](0x40u);
  v53->m_bOwnsArrays = 1;
  v53->m_aFlags = v54;
  v53->m_nSize = 64;
  v53->m_nFreeIndex = -1;
  v55 = v54[1];
  *v54 = 0x80;
  v54[1] = v55 | 0x80;
  v53->m_aFlags[1] &= 0x80u;
  for ( i2 = 2; i2 != 64; ++i2 )
  {
    v53->m_aFlags[i2] |= 0x80u;
    v53->m_aFlags[i2] &= 0x80u;
  }
  CPools::ms_pNodeRoutePool = v53;
  v57 = (CTaskAllocatorPool *)operator new(0x14u);
  v57->m_aStorage = (CPool<CTaskAllocator,CTaskAllocatorPlayerCommandAttack>::StorageType *)operator new[](0x200u);
  v58 = (uint8 *)operator new[](0x10u);
  v57->m_bOwnsArrays = 1;
  v57->m_aFlags = v58;
  v57->m_nSize = 16;
  v57->m_nFreeIndex = -1;
  *(_QWORD *)v58 = 0x8080808080808080LL;
  *((_QWORD *)v58 + 1) = 0x8080808080808080LL;
  CPools::ms_pTaskAllocatorPool = v57;
  v59 = (CPedIntelligencePool *)operator new(0x14u);
  v59->m_aStorage = (CPool<CPedIntelligence,CPedIntelligence>::StorageType *)operator new[]((unsigned int)&elf_hash_chain[6766]);
  v60 = (uint8 *)operator new[](0x8Cu);
  v59->m_bOwnsArrays = 1;
  v59->m_aFlags = v60;
  v59->m_nSize = 140;
  v59->m_nFreeIndex = -1;
  v61 = v60[1];
  *v60 = 0x80;
  v60[1] = v61 | 0x80;
  v59->m_aFlags[1] &= 0x80u;
  for ( i3 = 2; i3 != 140; ++i3 )
  {
    v59->m_aFlags[i3] |= 0x80u;
    v59->m_aFlags[i3] &= 0x80u;
  }
  CPools::ms_pPedIntelligencePool = v59;
  v63 = (CPedAttractorPool *)operator new(0x14u);
  v63->m_aStorage = (CPool<CPedAttractor,char [236]>::StorageType *)operator new[](0x3B00u);
  v64 = (uint8 *)operator new[](0x40u);
  v63->m_bOwnsArrays = 1;
  v63->m_aFlags = v64;
  v63->m_nSize = 64;
  v63->m_nFreeIndex = -1;
  v65 = v64[1];
  *v64 = 0x80;
  v64[1] = v65 | 0x80;
  v63->m_aFlags[1] &= 0x80u;
  for ( i4 = 2; i4 != 64; ++i4 )
  {
    v63->m_aFlags[i4] |= 0x80u;
    v63->m_aFlags[i4] &= 0x80u;
  }
  CPools::ms_pPedAttractorPool = v63;
}
// 0: using guessed type int dword_0;
// 10168: using guessed type int elf_hash_chain[22025];
// 3344C: using guessed type Elf32_Sym stru_3344C;
// 4438C: using guessed type Elf32_Sym stru_4438C;
// 45EDC: using guessed type Elf32_Sym stru_45EDC;
// 76F1C: using guessed type Elf32_Sym stru_76F1C;

//----- (0040D010) --------------------------------------------------------
void CPools::ShutDown()
{
  CPtrNodeSingleLinkPool *v0; // r4
  uint8 *m_aFlags; // r0
  uint8 **p_m_aFlags; // r5
  CPtrNodeDoubleLinkPool *v3; // r4
  uint8 *v4; // r0
  uint8 **v5; // r5
  CEntryInfoNodePool *v6; // r4
  uint8 *v7; // r0
  uint8 **v8; // r5
  CPedPool *v9; // r4
  uint8 *v10; // r0
  uint8 **v11; // r5
  CVehiclePool *v12; // r4
  uint8 *v13; // r0
  uint8 **v14; // r5
  CBuildingPool *v15; // r4
  uint8 *v16; // r0
  uint8 **v17; // r5
  CObjectPool *v18; // r4
  uint8 *v19; // r0
  uint8 **v20; // r5
  CDummyPool *v21; // r4
  uint8 *v22; // r0
  uint8 **v23; // r5
  CColModelPool *v24; // r4
  uint8 *v25; // r0
  uint8 **v26; // r5
  CTaskPool *v27; // r4
  uint8 *v28; // r0
  uint8 **v29; // r5
  CEventPool *v30; // r4
  uint8 *v31; // r0
  uint8 **v32; // r5
  CPointRoutePool *v33; // r4
  uint8 *v34; // r0
  uint8 **v35; // r5
  CPatrolRoutePool *v36; // r4
  uint8 *v37; // r0
  uint8 **v38; // r5
  CNodeRoutePool *v39; // r4
  uint8 *v40; // r0
  uint8 **v41; // r5
  CTaskAllocatorPool *v42; // r4
  uint8 *v43; // r0
  uint8 **v44; // r5
  CPedIntelligencePool *v45; // r4
  uint8 *v46; // r0
  uint8 **v47; // r5
  CPedAttractorPool *v48; // r4
  uint8 *v49; // r0
  uint8 **v50; // r5

  v0 = CPools::ms_pPtrNodeSingleLinkPool;
  if ( CPools::ms_pPtrNodeSingleLinkPool )
  {
    if ( CPools::ms_pPtrNodeSingleLinkPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pPtrNodeSingleLinkPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pPtrNodeSingleLinkPool->m_aStorage )
          operator delete[](CPools::ms_pPtrNodeSingleLinkPool->m_aStorage);
        p_m_aFlags = &v0->m_aFlags;
        m_aFlags = v0->m_aFlags;
        if ( m_aFlags )
          operator delete[](m_aFlags);
      }
      else
      {
        p_m_aFlags = &CPools::ms_pPtrNodeSingleLinkPool->m_aFlags;
      }
      v0->m_aStorage = 0;
      *p_m_aFlags = 0;
    }
    operator delete(v0);
  }
  v3 = CPools::ms_pPtrNodeDoubleLinkPool;
  if ( CPools::ms_pPtrNodeDoubleLinkPool )
  {
    if ( CPools::ms_pPtrNodeDoubleLinkPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pPtrNodeDoubleLinkPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pPtrNodeDoubleLinkPool->m_aStorage )
          operator delete[](CPools::ms_pPtrNodeDoubleLinkPool->m_aStorage);
        v5 = &v3->m_aFlags;
        v4 = v3->m_aFlags;
        if ( v4 )
          operator delete[](v4);
      }
      else
      {
        v5 = &CPools::ms_pPtrNodeDoubleLinkPool->m_aFlags;
      }
      v3->m_aStorage = 0;
      *v5 = 0;
    }
    operator delete(v3);
  }
  v6 = CPools::ms_pEntryInfoNodePool;
  if ( CPools::ms_pEntryInfoNodePool )
  {
    if ( CPools::ms_pEntryInfoNodePool->m_nSize >= 1 )
    {
      if ( CPools::ms_pEntryInfoNodePool->m_bOwnsArrays )
      {
        if ( CPools::ms_pEntryInfoNodePool->m_aStorage )
          operator delete[](CPools::ms_pEntryInfoNodePool->m_aStorage);
        v8 = &v6->m_aFlags;
        v7 = v6->m_aFlags;
        if ( v7 )
          operator delete[](v7);
      }
      else
      {
        v8 = &CPools::ms_pEntryInfoNodePool->m_aFlags;
      }
      v6->m_aStorage = 0;
      *v8 = 0;
    }
    operator delete(v6);
  }
  v9 = CPools::ms_pPedPool;
  if ( CPools::ms_pPedPool )
  {
    if ( CPools::ms_pPedPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pPedPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pPedPool->m_aStorage )
          operator delete[](CPools::ms_pPedPool->m_aStorage);
        v11 = &v9->m_aFlags;
        v10 = v9->m_aFlags;
        if ( v10 )
          operator delete[](v10);
      }
      else
      {
        v11 = &CPools::ms_pPedPool->m_aFlags;
      }
      v9->m_aStorage = 0;
      *v11 = 0;
    }
    operator delete(v9);
  }
  v12 = CPools::ms_pVehiclePool;
  if ( CPools::ms_pVehiclePool )
  {
    if ( CPools::ms_pVehiclePool->m_nSize >= 1 )
    {
      if ( CPools::ms_pVehiclePool->m_bOwnsArrays )
      {
        if ( CPools::ms_pVehiclePool->m_aStorage )
          operator delete[](CPools::ms_pVehiclePool->m_aStorage);
        v14 = &v12->m_aFlags;
        v13 = v12->m_aFlags;
        if ( v13 )
          operator delete[](v13);
      }
      else
      {
        v14 = &CPools::ms_pVehiclePool->m_aFlags;
      }
      v12->m_aStorage = 0;
      *v14 = 0;
    }
    operator delete(v12);
  }
  v15 = CPools::ms_pBuildingPool;
  if ( CPools::ms_pBuildingPool )
  {
    if ( CPools::ms_pBuildingPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pBuildingPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pBuildingPool->m_aStorage )
          operator delete[](CPools::ms_pBuildingPool->m_aStorage);
        v17 = &v15->m_aFlags;
        v16 = v15->m_aFlags;
        if ( v16 )
          operator delete[](v16);
      }
      else
      {
        v17 = &CPools::ms_pBuildingPool->m_aFlags;
      }
      v15->m_aStorage = 0;
      *v17 = 0;
    }
    operator delete(v15);
  }
  v18 = CPools::ms_pObjectPool;
  if ( CPools::ms_pObjectPool )
  {
    if ( CPools::ms_pObjectPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pObjectPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pObjectPool->m_aStorage )
          operator delete[](CPools::ms_pObjectPool->m_aStorage);
        v20 = &v18->m_aFlags;
        v19 = v18->m_aFlags;
        if ( v19 )
          operator delete[](v19);
      }
      else
      {
        v20 = &CPools::ms_pObjectPool->m_aFlags;
      }
      v18->m_aStorage = 0;
      *v20 = 0;
    }
    operator delete(v18);
  }
  v21 = CPools::ms_pDummyPool;
  if ( CPools::ms_pDummyPool )
  {
    if ( CPools::ms_pDummyPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pDummyPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pDummyPool->m_aStorage )
          operator delete[](CPools::ms_pDummyPool->m_aStorage);
        v23 = &v21->m_aFlags;
        v22 = v21->m_aFlags;
        if ( v22 )
          operator delete[](v22);
      }
      else
      {
        v23 = &CPools::ms_pDummyPool->m_aFlags;
      }
      v21->m_aStorage = 0;
      *v23 = 0;
    }
    operator delete(v21);
  }
  v24 = CPools::ms_pColModelPool;
  if ( CPools::ms_pColModelPool )
  {
    if ( CPools::ms_pColModelPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pColModelPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pColModelPool->m_aStorage )
          operator delete[](CPools::ms_pColModelPool->m_aStorage);
        v26 = &v24->m_aFlags;
        v25 = v24->m_aFlags;
        if ( v25 )
          operator delete[](v25);
      }
      else
      {
        v26 = &CPools::ms_pColModelPool->m_aFlags;
      }
      v24->m_aStorage = 0;
      *v26 = 0;
    }
    operator delete(v24);
  }
  v27 = CPools::ms_pTaskPool;
  if ( CPools::ms_pTaskPool )
  {
    if ( CPools::ms_pTaskPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pTaskPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pTaskPool->m_aStorage )
          operator delete[](CPools::ms_pTaskPool->m_aStorage);
        v29 = &v27->m_aFlags;
        v28 = v27->m_aFlags;
        if ( v28 )
          operator delete[](v28);
      }
      else
      {
        v29 = &CPools::ms_pTaskPool->m_aFlags;
      }
      v27->m_aStorage = 0;
      *v29 = 0;
    }
    operator delete(v27);
  }
  v30 = CPools::ms_pEventPool;
  if ( CPools::ms_pEventPool )
  {
    if ( CPools::ms_pEventPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pEventPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pEventPool->m_aStorage )
          operator delete[](CPools::ms_pEventPool->m_aStorage);
        v32 = &v30->m_aFlags;
        v31 = v30->m_aFlags;
        if ( v31 )
          operator delete[](v31);
      }
      else
      {
        v32 = &CPools::ms_pEventPool->m_aFlags;
      }
      v30->m_aStorage = 0;
      *v32 = 0;
    }
    operator delete(v30);
  }
  v33 = CPools::ms_pPointRoutePool;
  if ( CPools::ms_pPointRoutePool )
  {
    if ( CPools::ms_pPointRoutePool->m_nSize >= 1 )
    {
      if ( CPools::ms_pPointRoutePool->m_bOwnsArrays )
      {
        if ( CPools::ms_pPointRoutePool->m_aStorage )
          operator delete[](CPools::ms_pPointRoutePool->m_aStorage);
        v35 = &v33->m_aFlags;
        v34 = v33->m_aFlags;
        if ( v34 )
          operator delete[](v34);
      }
      else
      {
        v35 = &CPools::ms_pPointRoutePool->m_aFlags;
      }
      v33->m_aStorage = 0;
      *v35 = 0;
    }
    operator delete(v33);
  }
  v36 = CPools::ms_pPatrolRoutePool;
  if ( CPools::ms_pPatrolRoutePool )
  {
    if ( CPools::ms_pPatrolRoutePool->m_nSize >= 1 )
    {
      if ( CPools::ms_pPatrolRoutePool->m_bOwnsArrays )
      {
        if ( CPools::ms_pPatrolRoutePool->m_aStorage )
          operator delete[](CPools::ms_pPatrolRoutePool->m_aStorage);
        v38 = &v36->m_aFlags;
        v37 = v36->m_aFlags;
        if ( v37 )
          operator delete[](v37);
      }
      else
      {
        v38 = &CPools::ms_pPatrolRoutePool->m_aFlags;
      }
      v36->m_aStorage = 0;
      *v38 = 0;
    }
    operator delete(v36);
  }
  v39 = CPools::ms_pNodeRoutePool;
  if ( CPools::ms_pNodeRoutePool )
  {
    if ( CPools::ms_pNodeRoutePool->m_nSize >= 1 )
    {
      if ( CPools::ms_pNodeRoutePool->m_bOwnsArrays )
      {
        if ( CPools::ms_pNodeRoutePool->m_aStorage )
          operator delete[](CPools::ms_pNodeRoutePool->m_aStorage);
        v41 = &v39->m_aFlags;
        v40 = v39->m_aFlags;
        if ( v40 )
          operator delete[](v40);
      }
      else
      {
        v41 = &CPools::ms_pNodeRoutePool->m_aFlags;
      }
      v39->m_aStorage = 0;
      *v41 = 0;
    }
    operator delete(v39);
  }
  v42 = CPools::ms_pTaskAllocatorPool;
  if ( CPools::ms_pTaskAllocatorPool )
  {
    if ( CPools::ms_pTaskAllocatorPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pTaskAllocatorPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pTaskAllocatorPool->m_aStorage )
          operator delete[](CPools::ms_pTaskAllocatorPool->m_aStorage);
        v44 = &v42->m_aFlags;
        v43 = v42->m_aFlags;
        if ( v43 )
          operator delete[](v43);
      }
      else
      {
        v44 = &CPools::ms_pTaskAllocatorPool->m_aFlags;
      }
      v42->m_aStorage = 0;
      *v44 = 0;
    }
    operator delete(v42);
  }
  v45 = CPools::ms_pPedIntelligencePool;
  if ( CPools::ms_pPedIntelligencePool )
  {
    if ( CPools::ms_pPedIntelligencePool->m_nSize >= 1 )
    {
      if ( CPools::ms_pPedIntelligencePool->m_bOwnsArrays )
      {
        if ( CPools::ms_pPedIntelligencePool->m_aStorage )
          operator delete[](CPools::ms_pPedIntelligencePool->m_aStorage);
        v47 = &v45->m_aFlags;
        v46 = v45->m_aFlags;
        if ( v46 )
          operator delete[](v46);
      }
      else
      {
        v47 = &CPools::ms_pPedIntelligencePool->m_aFlags;
      }
      v45->m_aStorage = 0;
      *v47 = 0;
    }
    operator delete(v45);
  }
  v48 = CPools::ms_pPedAttractorPool;
  if ( CPools::ms_pPedAttractorPool )
  {
    if ( CPools::ms_pPedAttractorPool->m_nSize >= 1 )
    {
      if ( CPools::ms_pPedAttractorPool->m_bOwnsArrays )
      {
        if ( CPools::ms_pPedAttractorPool->m_aStorage )
          operator delete[](CPools::ms_pPedAttractorPool->m_aStorage);
        v50 = &v48->m_aFlags;
        v49 = v48->m_aFlags;
        if ( v49 )
          operator delete[](v49);
      }
      else
      {
        v50 = &CPools::ms_pPedAttractorPool->m_aFlags;
      }
      v48->m_aStorage = 0;
      *v50 = 0;
    }
    sub_191374(v48);
  }
}

//----- (0040D468) --------------------------------------------------------
int32 __fastcall CPools::GetPedRef(CPed *pPed)
{
  return CPools::ms_pPedPool->m_aFlags[-1093107909 * (((char *)pPed - (char *)CPools::ms_pPedPool->m_aStorage) >> 2)] | (-662750464 * (((char *)pPed - (char *)CPools::ms_pPedPool->m_aStorage) >> 2));
}

//----- (0040D490) --------------------------------------------------------
CPed *__fastcall CPools::GetPed(int32 nRef)
{
  int v1; // r3
  unsigned int v2; // r0

  if ( nRef >= 0 && (v1 = (unsigned __int8)nRef, v2 = (unsigned int)nRef >> 8, CPools::ms_pPedPool->m_aFlags[v2] == v1) )
    return (CPed *)CPools::ms_pPedPool->m_aStorage[v2];
  else
    return 0;
}

//----- (0040D4BC) --------------------------------------------------------
int32 __fastcall CPools::GetVehicleRef(CVehicle *pVehicle)
{
  return CPools::ms_pVehiclePool->m_aFlags[-1075391197
                                         * (((char *)pVehicle - (char *)CPools::ms_pVehiclePool->m_aStorage) >> 2)] | (-422239488 * (((char *)pVehicle - (char *)CPools::ms_pVehiclePool->m_aStorage) >> 2));
}

//----- (0040D4E4) --------------------------------------------------------
CVehicle *__fastcall CPools::GetVehicle(int32 nRef)
{
  int v1; // r3
  unsigned int v2; // r0

  if ( nRef >= 0
    && (v1 = (unsigned __int8)nRef, v2 = (unsigned int)nRef >> 8, CPools::ms_pVehiclePool->m_aFlags[v2] == v1) )
  {
    return (CVehicle *)CPools::ms_pVehiclePool->m_aStorage[v2];
  }
  else
  {
    return 0;
  }
}

//----- (0040D510) --------------------------------------------------------
int32 __fastcall CPools::GetObjectRef(CObject *pObject)
{
  return CPools::ms_pObjectPool->m_aFlags[-654471207
                                        * (((char *)pObject - (char *)CPools::ms_pObjectPool->m_aStorage) >> 2)] | (-40904448 * (((char *)pObject - (char *)CPools::ms_pObjectPool->m_aStorage) >> 2));
}

//----- (0040D538) --------------------------------------------------------
CObject *__fastcall CPools::GetObject(int32 nRef)
{
  int v1; // r3
  unsigned int v2; // r0

  if ( nRef >= 0
    && (v1 = (unsigned __int8)nRef, v2 = (unsigned int)nRef >> 8, CPools::ms_pObjectPool->m_aFlags[v2] == v1) )
  {
    return (CObject *)CPools::ms_pObjectPool->m_aStorage[v2];
  }
  else
  {
    return 0;
  }
}

//----- (0040D564) --------------------------------------------------------
void __fastcall CPools::MakeSureSlotInObjectPoolIsEmpty(Int32 Slot)
{
  CPool<CObject,CCutsceneObject>::StorageType *m_aStorage; // r6
  CObject *v3; // r4
  uint8 *v4; // r6
  CObject *v5; // r5

  if ( (CPools::ms_pObjectPool->m_aFlags[Slot] & 0x80u) == 0 )
  {
    m_aStorage = CPools::ms_pObjectPool->m_aStorage;
    v3 = (CObject *)CPools::ms_pObjectPool->m_aStorage[Slot];
    if ( v3->ObjectCreatedBy == 3 )
    {
      CWorld::Remove(v3);
      if ( v3 )
        (*((void (__fastcall **)(CObject *))v3->_vptr$CPlaceable + 1))(v3);
    }
    else if ( !CProjectileInfo::RemoveIfThisIsAProjectile(v3) )
    {
      v4 = m_aStorage[Slot];
      v5 = (CObject *)CObject::operator new(0x184u);
      CObject::CObject(v5, *((__int16 *)v4 + 19), 0);
      CWorld::Remove(v3);
      qmemcpy(v5, v3, 0x1A4u);
      CWorld::Add(v5);
      *((_DWORD *)v4 + 6) = 0;
      if ( v3 )
        (*((void (__fastcall **)(CObject *))v3->_vptr$CPlaceable + 1))(v3);
      v5->pReferences = 0;
    }
  }
}

//----- (0040D608) --------------------------------------------------------
Int32 CPools::CheckBuildingAtomics()
{
  return -1;
}

//----- (0040D610) --------------------------------------------------------
void CProfile::Initialise()
{
  __int64 v0; // d17
  __int64 v1; // d16

  CDebug::DebugLog("Initialising CProfile...\n");
  LODWORD(v0) = "Collision";
  LODWORD(v1) = "Frame rate";
  HIDWORD(v0) = "Ped AI";
  HIDWORD(v1) = "Physics";
  *(_QWORD *)CProfile::ms_afMaxEndTime = 0LL;
  *(_QWORD *)&CProfile::ms_afMaxEndTime[2] = 0LL;
  *(_QWORD *)CProfile::ms_afMaxCumulativeTime = 0LL;
  *(_QWORD *)&CProfile::ms_afMaxCumulativeTime[2] = 0LL;
  CProfile::ms_pProfileString[5] = "Rendering time";
  CProfile::ms_pProfileString[6] = "Total";
  CProfile::ms_aBarColours[5] = -65536;
  CProfile::ms_aBarColours[6] = -1;
  *(_QWORD *)CProfile::ms_pProfileString = v1;
  *(_QWORD *)&CProfile::ms_pProfileString[2] = v0;
  *(_QWORD *)&CProfile::ms_aBarColours[1] = 0xFFFFFF00FFFF7F00LL;
  *(_QWORD *)&CProfile::ms_aBarColours[3] = 0xFF00FF00FF0000FFLL;
  *(_QWORD *)&CProfile::ms_afMaxEndTime[3] = 0LL;
  *(_QWORD *)&CProfile::ms_afMaxEndTime[5] = 0LL;
  *(_QWORD *)&CProfile::ms_afMaxCumulativeTime[3] = 0LL;
  *(_QWORD *)&CProfile::ms_afMaxCumulativeTime[5] = 0LL;
  CProfile::ms_pProfileString[4] = "Processing time";
  sub_1977C0("CProfile ready\n");
}

//----- (0040D734) --------------------------------------------------------
void __fastcall CProfile::SuspendProfile(eProfile ProfileType)
{
  float v1; // s0
  float *v2; // r1
  float *v3; // r0
  float v4; // s2

  v1 = 0.0 - CProfile::ms_afStartTime[ProfileType];
  v2 = &CProfile::ms_afEndTime[ProfileType];
  v3 = &CProfile::ms_afCumulativeTime[ProfileType];
  v4 = *v3;
  *v2 = v1;
  *v3 = v1 + v4;
}

//----- (0040D780) --------------------------------------------------------
void CProfile::ShowResults()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d3
  float32x2_t v2; // d6
  float32x2_t v3; // d8
  float *v4; // r3
  float *v5; // r2
  float *v6; // r1
  float *v7; // r2
  float *v8; // r2
  float *v9; // r2
  float *v10; // r2
  float *v11; // r2
  float *v12; // r2
  float *v13; // r2
  float *v14; // r2
  float *v15; // r2

  v4 = CProfile::ms_afEndTime;
  v5 = CProfile::ms_afMaxEndTime;
  v6 = CProfile::ms_afCumulativeTime;
  v0.n64_f32[0] = CProfile::ms_afMaxEndTime[0];
  v1.n64_f32[0] = CProfile::ms_afEndTime[0];
  v2.n64_f32[0] = CProfile::ms_afMaxCumulativeTime[0];
  v3.n64_f32[0] = CProfile::ms_afCumulativeTime[0];
  LODWORD(CProfile::ms_afMaxEndTime[0]) = vmax_f32(v1, v0).n64_u32[0];
  LODWORD(CProfile::ms_afMaxCumulativeTime[0]) = vmax_f32(v3, v2).n64_u32[0];
  if ( CProfile::ms_afEndTime[1] > CProfile::ms_afMaxEndTime[1] )
    v5 = CProfile::ms_afEndTime;
  CProfile::ms_afMaxEndTime[1] = *(float *)&byte_4[(_DWORD)v5];
  v7 = CProfile::ms_afMaxCumulativeTime;
  if ( CProfile::ms_afCumulativeTime[1] > CProfile::ms_afMaxCumulativeTime[1] )
    v7 = CProfile::ms_afCumulativeTime;
  CProfile::ms_afMaxCumulativeTime[1] = *(float *)&byte_4[(_DWORD)v7];
  v8 = CProfile::ms_afMaxEndTime;
  if ( CProfile::ms_afEndTime[2] > CProfile::ms_afMaxEndTime[2] )
    v8 = CProfile::ms_afEndTime;
  CProfile::ms_afMaxEndTime[2] = *(float *)&byte_8[(_DWORD)v8];
  v9 = CProfile::ms_afMaxCumulativeTime;
  if ( CProfile::ms_afCumulativeTime[2] > CProfile::ms_afMaxCumulativeTime[2] )
    v9 = CProfile::ms_afCumulativeTime;
  CProfile::ms_afMaxCumulativeTime[2] = *(float *)&byte_8[(_DWORD)v9];
  v10 = CProfile::ms_afMaxEndTime;
  if ( CProfile::ms_afEndTime[3] > CProfile::ms_afMaxEndTime[3] )
    v10 = CProfile::ms_afEndTime;
  CProfile::ms_afMaxEndTime[3] = *(float *)&byte_9[(_DWORD)v10 + 3];
  v11 = CProfile::ms_afMaxCumulativeTime;
  if ( CProfile::ms_afCumulativeTime[3] > CProfile::ms_afMaxCumulativeTime[3] )
    v11 = CProfile::ms_afCumulativeTime;
  CProfile::ms_afMaxCumulativeTime[3] = *(float *)&byte_9[(_DWORD)v11 + 3];
  v12 = CProfile::ms_afMaxEndTime;
  if ( CProfile::ms_afEndTime[4] > CProfile::ms_afMaxEndTime[4] )
    v12 = CProfile::ms_afEndTime;
  CProfile::ms_afMaxEndTime[4] = *(float *)((char *)&word_10 + (_DWORD)v12);
  v13 = CProfile::ms_afMaxCumulativeTime;
  if ( CProfile::ms_afCumulativeTime[4] > CProfile::ms_afMaxCumulativeTime[4] )
    v13 = CProfile::ms_afCumulativeTime;
  CProfile::ms_afMaxCumulativeTime[4] = *(float *)((char *)&word_10 + (_DWORD)v13);
  v14 = CProfile::ms_afMaxEndTime;
  if ( CProfile::ms_afEndTime[5] > CProfile::ms_afMaxEndTime[5] )
    v14 = CProfile::ms_afEndTime;
  CProfile::ms_afMaxEndTime[5] = *(float *)((char *)&dword_14 + (_DWORD)v14);
  v15 = CProfile::ms_afMaxCumulativeTime;
  if ( CProfile::ms_afCumulativeTime[5] > CProfile::ms_afMaxCumulativeTime[5] )
    v15 = CProfile::ms_afCumulativeTime;
  CProfile::ms_afMaxCumulativeTime[5] = *(float *)((char *)&dword_14 + (_DWORD)v15);
  if ( CProfile::ms_afEndTime[6] <= CProfile::ms_afMaxEndTime[6] )
    v4 = CProfile::ms_afMaxEndTime;
  CProfile::ms_afMaxEndTime[6] = *(float *)((char *)&off_18 + (_DWORD)v4);
  if ( CProfile::ms_afCumulativeTime[6] <= CProfile::ms_afMaxCumulativeTime[6] )
    v6 = CProfile::ms_afMaxCumulativeTime;
  CProfile::ms_afMaxCumulativeTime[6] = *(float *)((char *)&off_18 + (_DWORD)v6);
}
// 40D7CA: variable 'v1' is possibly undefined
// 40D7CA: variable 'v0' is possibly undefined
// 40D7D2: variable 'v3' is possibly undefined
// 40D7D2: variable 'v2' is possibly undefined
// 10: using guessed type __int16 word_10;
// 14: using guessed type int dword_14;
// 18: using guessed type int (*off_18)();

//----- (0040D914) --------------------------------------------------------
bool8 __fastcall CPCKeyboard::GetKeyJustDown(
        CPCKeyboard *this,
        uint16 key_code,
        uint8 use_mode,
        unsigned __int8 *usage)
{
  return 0;
}

//----- (0040D918) --------------------------------------------------------
bool8 __fastcall CPCKeyboard::GetKeyDown(CPCKeyboard *this, uint16 key_code, uint8 use_mode, unsigned __int8 *usage)
{
  return 0;
}

//----- (0040D91C) --------------------------------------------------------
u_char __fastcall CPCKeyboard::GetCurrentKeyPressed(CPCKeyboard *this, uint8 use_mode)
{
  return 0;
}

//----- (0040D920) --------------------------------------------------------
u_char __fastcall CPCKeyboard::KeyToAscii(CPCKeyboard *this, u_char keyboardKey, int shift, int numLock)
{
  return 0;
}

//----- (0040D924) --------------------------------------------------------
void *__fastcall CPtrNodeSingleLink::operator new(size_t nSize)
{
  int v1; // lr
  CPtrNodeSingleLinkPool *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pPtrNodeSingleLinkPool;
  result = (void *)CPools::ms_pPtrNodeSingleLinkPool->m_nFreeIndex;
  m_nSize = (void *)CPools::ms_pPtrNodeSingleLinkPool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (0040D984) --------------------------------------------------------
void __fastcall CPtrNodeSingleLink::operator delete(void *pVoid)
{
  CPtrNodeSingleLinkPool *v1; // r1
  signed int v2; // r0

  v1 = CPools::ms_pPtrNodeSingleLinkPool;
  v2 = (signed int)((int)pVoid - (unsigned int)CPools::ms_pPtrNodeSingleLinkPool->m_aStorage) >> 3;
  CPools::ms_pPtrNodeSingleLinkPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (0040D9AC) --------------------------------------------------------
void *__fastcall CPtrNodeDoubleLink::operator new(size_t nSize)
{
  int v1; // lr
  CPtrNodeDoubleLinkPool *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pPtrNodeDoubleLinkPool;
  result = (void *)CPools::ms_pPtrNodeDoubleLinkPool->m_nFreeIndex;
  m_nSize = (void *)CPools::ms_pPtrNodeDoubleLinkPool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (0040DA10) --------------------------------------------------------
void __fastcall CPtrNodeDoubleLink::operator delete(void *pVoid)
{
  CPtrNodeDoubleLinkPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pPtrNodeDoubleLinkPool;
  v2 = -1431655765 * ((signed int)((int)pVoid - (unsigned int)CPools::ms_pPtrNodeDoubleLinkPool->m_aStorage) >> 2);
  CPools::ms_pPtrNodeDoubleLinkPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (0040DA40) --------------------------------------------------------
void __fastcall CPtrListSingleLink::Flush(CPtrListSingleLink *this)
{
  CPtrNode *m_pHead; // r2
  CPtrNode *i; // r3
  CPtrListSingleLink *p_m_pNext; // r1
  CPtrNodeSingleLinkPool *v4; // r1
  signed int v5; // r2
  CPtrNode *m_pNext; // lr

  m_pHead = this->m_pHead;
  if ( this->m_pHead )
  {
    for ( i = this->m_pHead; ; i = m_pNext )
    {
      m_pNext = i->m_pNext;
      if ( m_pHead == i )
      {
        p_m_pNext = this;
LABEL_4:
        p_m_pNext->m_pHead = m_pNext;
      }
      else
      {
        while ( m_pHead )
        {
          p_m_pNext = (CPtrListSingleLink *)&m_pHead->m_pNext;
          m_pHead = m_pHead->m_pNext;
          if ( m_pHead == i )
            goto LABEL_4;
        }
      }
      v4 = CPools::ms_pPtrNodeSingleLinkPool;
      v5 = ((char *)i - (char *)CPools::ms_pPtrNodeSingleLinkPool->m_aStorage) >> 3;
      CPools::ms_pPtrNodeSingleLinkPool->m_aFlags[v5] |= 0x80u;
      if ( v5 < v4->m_nFreeIndex )
        v4->m_nFreeIndex = v5;
      if ( !m_pNext )
        break;
      m_pHead = this->m_pHead;
    }
  }
}

//----- (0040DAA0) --------------------------------------------------------
void __fastcall CPtrListDoubleLink::Flush(CPtrListDoubleLink *this)
{
  CPtrNode *m_pHead; // r1
  CPtrNode *i; // r3
  CPtrNode *m_pNext; // r2
  _DWORD *m_pVoid; // r1
  CPtrNode *v5; // r1
  CPtrNodeDoubleLinkPool *v6; // r1
  int v7; // r3

  m_pHead = this->m_pHead;
  if ( this->m_pHead )
  {
    for ( i = this->m_pHead; ; i = m_pNext )
    {
      m_pNext = i->m_pNext;
      if ( m_pHead == i )
        this->m_pHead = m_pNext;
      m_pVoid = i[1].m_pVoid;
      if ( m_pVoid )
        m_pVoid[1] = i->m_pNext;
      v5 = i->m_pNext;
      if ( v5 )
        v5[1].m_pVoid = i[1].m_pVoid;
      v6 = CPools::ms_pPtrNodeDoubleLinkPool;
      v7 = -1431655765 * (((char *)i - (char *)CPools::ms_pPtrNodeDoubleLinkPool->m_aStorage) >> 2);
      CPools::ms_pPtrNodeDoubleLinkPool->m_aFlags[v7] |= 0x80u;
      if ( v7 < v6->m_nFreeIndex )
        v6->m_nFreeIndex = v7;
      if ( !m_pNext )
        break;
      m_pHead = this->m_pHead;
    }
  }
}

//----- (0040DB08) --------------------------------------------------------
Int32 __fastcall CPtrList::CountElements(CPtrList *this)
{
  CPtrNode *m_pHead; // r1
  Int32 result; // r0

  m_pHead = this->m_pHead;
  result = 0;
  while ( m_pHead )
  {
    m_pHead = m_pHead->m_pNext;
    ++result;
  }
  return result;
}

//----- (0040DB1A) --------------------------------------------------------
bool __fastcall CPtrList::IsMemberOfList(CPtrList *this, void *pMember)
{
  CPtrNode *m_pHead; // r0

  m_pHead = this->m_pHead;
  if ( !m_pHead )
    return 0;
  while ( m_pHead->m_pVoid != pMember )
  {
    m_pHead = m_pHead->m_pNext;
    if ( !m_pHead )
      return 0;
  }
  return 1;
}

//----- (0040DB3C) --------------------------------------------------------
void CQuadTreeNode::InitPool()
{
  CPool<CQuadTreeNode,CQuadTreeNode> *v0; // r4
  uint8 *v1; // r0
  uint8 v2; // r1
  int i; // r0

  if ( !CQuadTreeNode::ms_pQuadTreeNodePool )
  {
    v0 = (CPool<CQuadTreeNode,CQuadTreeNode> *)operator new(0x14u);
    v0->m_aStorage = (CPool<CQuadTreeNode,CQuadTreeNode>::StorageType *)operator new[](0x3E80u);
    v1 = (uint8 *)operator new[](0x190u);
    v0->m_bOwnsArrays = 1;
    v0->m_aFlags = v1;
    v0->m_nSize = 400;
    v0->m_nFreeIndex = -1;
    v2 = v1[1];
    *v1 = 0x80;
    v1[1] = v2 | 0x80;
    v0->m_aFlags[1] &= 0x80u;
    for ( i = 2; i != 400; ++i )
    {
      v0->m_aFlags[i] |= 0x80u;
      v0->m_aFlags[i] &= 0x80u;
    }
    CQuadTreeNode::ms_pQuadTreeNodePool = v0;
  }
}

//----- (0040DBC4) --------------------------------------------------------
void *__fastcall CQuadTreeNode::operator new(size_t nSize)
{
  int v1; // lr
  CPool<CQuadTreeNode,CQuadTreeNode> *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CQuadTreeNode::ms_pQuadTreeNodePool;
  result = (void *)CQuadTreeNode::ms_pQuadTreeNodePool->m_nFreeIndex;
  m_nSize = (void *)CQuadTreeNode::ms_pQuadTreeNodePool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (0040DC28) --------------------------------------------------------
void __fastcall CQuadTreeNode::operator delete(void *pVoid)
{
  CPool<CQuadTreeNode,CQuadTreeNode> *v1; // r1
  int v2; // r0

  v1 = CQuadTreeNode::ms_pQuadTreeNodePool;
  v2 = -858993459 * ((signed int)((int)pVoid - (unsigned int)CQuadTreeNode::ms_pQuadTreeNodePool->m_aStorage) >> 3);
  CQuadTreeNode::ms_pQuadTreeNodePool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (0040DC58) --------------------------------------------------------
void __fastcall CQuadTreeNode::CQuadTreeNode(CQuadTreeNode *this, const CRect *bb, Int32 Depth)
{
  __int64 v3; // d16
  __int64 v4; // d17

  v3 = *(_QWORD *)&bb->left;
  v4 = *(_QWORD *)&bb->right;
  this->m_Depth = Depth;
  *(_QWORD *)this->mp_Children = 0LL;
  *(_QWORD *)&this->mp_Children[2] = 0LL;
  *(_QWORD *)&this->m_rect.left = v3;
  *(_QWORD *)&this->m_rect.right = v4;
  this->m_DataItems.m_pHead = 0;
}

//----- (0040DC78) --------------------------------------------------------
void __fastcall CQuadTreeNode::~CQuadTreeNode(CQuadTreeNode *this)
{
  CQuadTreeNode *v2; // r0
  CPool<CQuadTreeNode,CQuadTreeNode> *v3; // r1
  int v4; // r0
  int v5; // r0
  CQuadTreeNode *v6; // r0
  CPool<CQuadTreeNode,CQuadTreeNode> *v7; // r1
  int v8; // r0
  int v9; // r0
  CQuadTreeNode *v10; // r0
  CPool<CQuadTreeNode,CQuadTreeNode> *v11; // r1
  int v12; // r0
  int v13; // r0
  CQuadTreeNode *v14; // r0
  CPool<CQuadTreeNode,CQuadTreeNode> *v15; // r1
  int v16; // r0
  int v17; // r0

  v2 = this->mp_Children[0];
  if ( v2 )
  {
    CQuadTreeNode::~CQuadTreeNode(v2);
    v3 = CQuadTreeNode::ms_pQuadTreeNodePool;
    v5 = -858993459 * ((signed int)(v4 - (unsigned int)CQuadTreeNode::ms_pQuadTreeNodePool->m_aStorage) >> 3);
    CQuadTreeNode::ms_pQuadTreeNodePool->m_aFlags[v5] |= 0x80u;
    if ( v5 < v3->m_nFreeIndex )
      v3->m_nFreeIndex = v5;
  }
  v6 = this->mp_Children[1];
  if ( v6 )
  {
    CQuadTreeNode::~CQuadTreeNode(v6);
    v7 = CQuadTreeNode::ms_pQuadTreeNodePool;
    v9 = -858993459 * ((signed int)(v8 - (unsigned int)CQuadTreeNode::ms_pQuadTreeNodePool->m_aStorage) >> 3);
    CQuadTreeNode::ms_pQuadTreeNodePool->m_aFlags[v9] |= 0x80u;
    if ( v9 < v7->m_nFreeIndex )
      v7->m_nFreeIndex = v9;
  }
  v10 = this->mp_Children[2];
  if ( v10 )
  {
    CQuadTreeNode::~CQuadTreeNode(v10);
    v11 = CQuadTreeNode::ms_pQuadTreeNodePool;
    v13 = -858993459 * ((signed int)(v12 - (unsigned int)CQuadTreeNode::ms_pQuadTreeNodePool->m_aStorage) >> 3);
    CQuadTreeNode::ms_pQuadTreeNodePool->m_aFlags[v13] |= 0x80u;
    if ( v13 < v11->m_nFreeIndex )
      v11->m_nFreeIndex = v13;
  }
  v14 = this->mp_Children[3];
  if ( v14 )
  {
    CQuadTreeNode::~CQuadTreeNode(v14);
    v15 = CQuadTreeNode::ms_pQuadTreeNodePool;
    v17 = -858993459 * ((signed int)(v16 - (unsigned int)CQuadTreeNode::ms_pQuadTreeNodePool->m_aStorage) >> 3);
    CQuadTreeNode::ms_pQuadTreeNodePool->m_aFlags[v17] |= 0x80u;
    if ( v17 < v15->m_nFreeIndex )
      v15->m_nFreeIndex = v17;
  }
  CPtrListSingleLink::Flush(&this->m_DataItems);
}
// 40DC92: variable 'v4' is possibly undefined
// 40DCC4: variable 'v8' is possibly undefined
// 40DCF6: variable 'v12' is possibly undefined
// 40DD28: variable 'v16' is possibly undefined

//----- (0040DD64) --------------------------------------------------------
void __fastcall CQuadTreeNode::GetAll(CQuadTreeNode *this, CPtrListSingleLink *Matches)
{
  CQuadTreeNode *v2; // r8
  CPtrListSingleLink *v3; // r4
  CPtrNode *i; // r6
  void *m_pVoid; // r5
  CPtrNode *v6; // r0
  CQuadTreeNode *v7; // r0
  CQuadTreeNode *v8; // r0
  CQuadTreeNode *v9; // r0

  while ( 1 )
  {
    v2 = this;
    v3 = Matches;
    for ( i = this->m_DataItems.m_pHead; i; i = i->m_pNext )
    {
      m_pVoid = i->m_pVoid;
      v6 = (CPtrNode *)CPtrNodeSingleLink::operator new(8u);
      v6->m_pVoid = m_pVoid;
      v6->m_pNext = v3->m_pHead;
      v3->m_pHead = v6;
    }
    v7 = v2->mp_Children[0];
    if ( v7 )
      CQuadTreeNode::GetAll(v7, v3);
    v8 = v2->mp_Children[1];
    if ( v8 )
      CQuadTreeNode::GetAll(v8, v3);
    v9 = v2->mp_Children[2];
    if ( v9 )
      CQuadTreeNode::GetAll(v9, v3);
    this = v2->mp_Children[3];
    if ( !this )
      break;
    Matches = v3;
  }
}

//----- (0040DDD0) --------------------------------------------------------
void __fastcall CQuadTreeNode::GetAllMatching(CQuadTreeNode *this, const CRect *bb, CPtrListSingleLink *Matches)
{
  CPtrNode *i; // r5
  CPtrNode *m_pVoid; // r4
  CPtrListSingleLink *v8; // r0
  int j; // r5
  CQuadTreeNode *v10; // r0
  float top; // r1
  float left; // s2
  float bottom; // r2
  float right; // s0
  float v15; // s4
  float *v16; // r1
  float v17; // [sp+0h] [bp-28h] BYREF
  float v18; // [sp+4h] [bp-24h] BYREF

  for ( i = this->m_DataItems.m_pHead; i; i = i->m_pNext )
  {
    m_pVoid = (CPtrNode *)i->m_pVoid;
    v8 = (CPtrListSingleLink *)CPtrNodeSingleLink::operator new(8u);
    v8->m_pHead = m_pVoid;
    v8[1].m_pHead = Matches->m_pHead;
    Matches->m_pHead = (CPtrNode *)v8;
  }
  for ( j = 0; j != 4; ++j )
  {
    v10 = this->mp_Children[j];
    if ( v10 )
    {
      top = this->m_rect.top;
      left = this->m_rect.left;
      v18 = top;
      bottom = this->m_rect.bottom;
      right = this->m_rect.right;
      v17 = bottom;
      if ( this->m_Depth )
      {
        v15 = top;
        switch ( j )
        {
          case 0:
            v16 = &v17;
            right = (float)(left + right) * 0.5;
            goto LABEL_12;
          case 1:
            v16 = &v17;
            left = (float)(left + right) * 0.5;
            goto LABEL_12;
          case 2:
            right = (float)(left + right) * 0.5;
            goto LABEL_11;
          case 3:
            left = (float)(left + right) * 0.5;
LABEL_11:
            v16 = &v18;
LABEL_12:
            *v16 = (float)(v15 + bottom) * 0.5;
            break;
          default:
            break;
        }
        if ( left <= bb->right && right >= bb->left && v17 <= bb->top && v18 >= bb->bottom )
          CQuadTreeNode::GetAllMatching(v10, bb, Matches);
      }
    }
  }
}

//----- (0040DED0) --------------------------------------------------------
bool __fastcall CQuadTreeNode::InSector(CQuadTreeNode *this, const CRect *bb, int32 sectorIndex)
{
  float top; // r12
  float left; // s2
  float bottom; // r3
  float right; // s0
  float *v7; // r0
  float v9; // [sp+0h] [bp-8h] BYREF
  float v10; // [sp+4h] [bp-4h] BYREF

  top = this->m_rect.top;
  left = this->m_rect.left;
  v10 = top;
  bottom = this->m_rect.bottom;
  right = this->m_rect.right;
  v9 = bottom;
  if ( !this->m_Depth )
    return 0;
  switch ( sectorIndex )
  {
    case 0:
      v7 = &v9;
      right = (float)(left + right) * 0.5;
      goto LABEL_8;
    case 1:
      v7 = &v9;
      left = (float)(left + right) * 0.5;
      goto LABEL_8;
    case 2:
      right = (float)(left + right) * 0.5;
      goto LABEL_7;
    case 3:
      left = (float)(left + right) * 0.5;
LABEL_7:
      v7 = &v10;
LABEL_8:
      *v7 = (float)(top + bottom) * 0.5;
      break;
    default:
      return left <= bb->right && right >= bb->left && v9 <= bb->top && v10 >= bb->bottom;
  }
  return left <= bb->right && right >= bb->left && v9 <= bb->top && v10 >= bb->bottom;
}

//----- (0040DF98) --------------------------------------------------------
void __fastcall CQuadTreeNode::GetAllMatching(
        CQuadTreeNode *this,
        const CVector2D *position,
        CPtrListSingleLink *matches)
{
  CPtrNode *i; // r5
  CPtrNode *m_pVoid; // r6
  CPtrListSingleLink *v8; // r0
  int v9; // r0
  int v10; // r1

  do
  {
    for ( i = this->m_DataItems.m_pHead; i; i = i->m_pNext )
    {
      m_pVoid = (CPtrNode *)i->m_pVoid;
      v8 = (CPtrListSingleLink *)CPtrNodeSingleLink::operator new(8u);
      v8->m_pHead = m_pVoid;
      v8[1].m_pHead = matches->m_pHead;
      matches->m_pHead = (CPtrNode *)v8;
    }
    if ( !this->m_Depth )
      break;
    v9 = 2;
    v10 = 3;
    if ( position->y >= (float)((float)(this->m_rect.bottom + this->m_rect.top) * 0.5) )
    {
      v9 = 0;
      v10 = 1;
    }
    if ( position->x < (float)((float)(this->m_rect.left + this->m_rect.right) * 0.5) )
      v10 = v9;
    this = this->mp_Children[v10];
  }
  while ( this );
}

//----- (0040E030) --------------------------------------------------------
Int32 __fastcall CQuadTreeNode::FindSector(CQuadTreeNode *this, const CVector2D *Position)
{
  Int32 result; // r0
  float v3; // s0
  float y; // s2

  if ( !this->m_Depth )
    return -1;
  v3 = (float)(this->m_rect.bottom + this->m_rect.top) * 0.5;
  y = Position->y;
  if ( Position->x >= (float)((float)(this->m_rect.left + this->m_rect.right) * 0.5) )
  {
    result = 3;
    if ( y >= v3 )
      return 1;
  }
  else
  {
    result = 2;
    if ( y >= v3 )
      return 0;
  }
  return result;
}

//----- (0040E094) --------------------------------------------------------
void __fastcall CQuadTreeNode::ForAllMatching(CQuadTreeNode *this, const CRect *bb, void (*fn)(const CRect *, void *))
{
  CPtrNode *i; // r4
  int j; // r4
  CQuadTreeNode *v8; // r0
  float top; // r1
  float left; // s2
  float bottom; // r2
  float right; // s0
  float v13; // s4
  float *v14; // r1
  float v15; // [sp+0h] [bp-28h] BYREF
  float v16; // [sp+4h] [bp-24h] BYREF

  for ( i = this->m_DataItems.m_pHead; i; i = i->m_pNext )
    fn(bb, i->m_pVoid);
  for ( j = 0; j != 4; ++j )
  {
    v8 = this->mp_Children[j];
    if ( v8 )
    {
      top = this->m_rect.top;
      left = this->m_rect.left;
      v16 = top;
      bottom = this->m_rect.bottom;
      right = this->m_rect.right;
      v15 = bottom;
      if ( this->m_Depth )
      {
        v13 = top;
        switch ( j )
        {
          case 0:
            v14 = &v15;
            right = (float)(left + right) * 0.5;
            goto LABEL_12;
          case 1:
            v14 = &v15;
            left = (float)(left + right) * 0.5;
            goto LABEL_12;
          case 2:
            right = (float)(left + right) * 0.5;
            goto LABEL_11;
          case 3:
            left = (float)(left + right) * 0.5;
LABEL_11:
            v14 = &v16;
LABEL_12:
            *v14 = (float)(v13 + bottom) * 0.5;
            break;
          default:
            break;
        }
        if ( left <= bb->right && right >= bb->left && v15 <= bb->top && v16 >= bb->bottom )
          CQuadTreeNode::ForAllMatching(v8, bb, fn);
      }
    }
  }
}

//----- (0040E186) --------------------------------------------------------
void __fastcall CQuadTreeNode::ForAllMatching(int a1, const CVector2D *posn, void (*fn)(const CVector2D *, void *))
{
  int i; // r6
  int v7; // r0
  int v8; // r1

  do
  {
    for ( i = *(_DWORD *)(a1 + 16); i; i = *(_DWORD *)(i + 4) )
      fn(posn, *(void **)i);
    if ( !*(_DWORD *)(a1 + 36) )
      break;
    v7 = 2;
    v8 = 3;
    if ( posn->y >= (float)((float)(*(float *)(a1 + 12) + *(float *)(a1 + 4)) * 0.5) )
    {
      v7 = 0;
      v8 = 1;
    }
    if ( posn->x < (float)((float)(*(float *)a1 + *(float *)(a1 + 8)) * 0.5) )
      v8 = v7;
    a1 = *(_DWORD *)(a1 + 4 * v8 + 20);
  }
  while ( a1 );
}

//----- (0040E214) --------------------------------------------------------
Int32 __fastcall CQuadTreeNode::FindSector(CQuadTreeNode *this, const CRect *bb)
{
  float v2; // s6
  int v3; // r2
  float v4; // s0
  Int32 result; // r0

  if ( !this->m_Depth )
    return -1;
  v2 = (float)(this->m_rect.bottom + this->m_rect.top) * 0.5;
  if ( bb->top < v2 )
  {
    v3 = 0;
    goto LABEL_6;
  }
  if ( bb->bottom <= v2 )
    return -1;
  v3 = 1;
LABEL_6:
  v4 = (float)(this->m_rect.left + this->m_rect.right) * 0.5;
  if ( bb->right >= v4 )
  {
    if ( bb->left > v4 )
    {
      result = 3;
      if ( v3 )
        return 1;
    }
    else
    {
      return -1;
    }
  }
  else
  {
    result = 2;
    if ( v3 )
      return 0;
  }
  return result;
}

//----- (0040E29C) --------------------------------------------------------
void __fastcall CQuadTreeNode::AddItem(CQuadTreeNode *this, void *p_vData, const CRect *bb)
{
  Int32 m_Depth; // r0
  int v7; // r5
  Int32 v8; // r1
  int v9; // r2
  float v10; // r2
  float top; // r2
  float left; // s0
  float bottom; // r3
  float right; // s2
  float v15; // s8
  float v16; // s10
  float v17; // s8
  float *v18; // r0
  float v19; // s8
  char *v20; // r12
  int32 m_nFreeIndex; // r0
  int32 *v22; // r12
  int32 v23; // t1
  float *v24; // r0
  CPool<CQuadTreeNode,CQuadTreeNode> *v25; // r2
  int v26; // r1
  int32 m_nSize; // lr
  uint8 *m_aFlags; // r6
  int v29; // r3
  CPtrNode *v30; // r0
  float v31; // [sp+0h] [bp-40h] BYREF
  int v32[15]; // [sp+4h] [bp-3Ch] BYREF

  m_Depth = this->m_Depth;
  if ( m_Depth )
  {
    v7 = 0;
    while ( 1 )
    {
      top = this->m_rect.top;
      left = this->m_rect.left;
      *(float *)v32 = top;
      bottom = this->m_rect.bottom;
      right = this->m_rect.right;
      v31 = bottom;
      if ( m_Depth )
      {
        v15 = right;
        v16 = left;
        switch ( v7 )
        {
          case 0:
            v17 = left + right;
            v18 = &v31;
            goto LABEL_12;
          case 1:
            v19 = left + right;
            v18 = &v31;
            goto LABEL_14;
          case 2:
            v17 = left + right;
            v18 = (float *)v32;
LABEL_12:
            v16 = left;
            v15 = v17 * 0.5;
            goto LABEL_15;
          case 3:
            v19 = left + right;
            v18 = (float *)v32;
LABEL_14:
            v16 = v19 * 0.5;
            v15 = right;
LABEL_15:
            *v18 = (float)(top + bottom) * 0.5;
            break;
          default:
            break;
        }
        if ( v16 <= bb->right && v15 >= bb->left && v31 <= bb->top && *(float *)v32 >= bb->bottom )
        {
          v20 = (char *)(&this->m_rect.left + v7);
          v23 = *((_DWORD *)v20 + 5);
          v22 = (int32 *)(v20 + 20);
          m_nFreeIndex = v23;
          if ( !v23 )
          {
            v31 = bottom;
            *(float *)v32 = top;
            switch ( v7 )
            {
              case 0:
                v24 = &v31;
                right = (float)(left + right) * 0.5;
                goto LABEL_27;
              case 1:
                v24 = &v31;
                left = (float)(left + right) * 0.5;
                goto LABEL_27;
              case 2:
                right = (float)(left + right) * 0.5;
                goto LABEL_26;
              case 3:
                left = (float)(left + right) * 0.5;
LABEL_26:
                v24 = (float *)v32;
LABEL_27:
                *v24 = (float)(top + bottom) * 0.5;
                break;
              default:
                break;
            }
            v25 = CQuadTreeNode::ms_pQuadTreeNodePool;
            v26 = 0;
            m_nFreeIndex = CQuadTreeNode::ms_pQuadTreeNodePool->m_nFreeIndex;
            m_nSize = CQuadTreeNode::ms_pQuadTreeNodePool->m_nSize;
            do
            {
              v25->m_nFreeIndex = ++m_nFreeIndex;
              if ( m_nFreeIndex == m_nSize )
              {
                m_nFreeIndex = 0;
                v25->m_nFreeIndex = 0;
                if ( v26 << 31 )
                  goto LABEL_3;
                v26 = 1;
              }
              m_aFlags = v25->m_aFlags;
              v29 = (char)m_aFlags[m_nFreeIndex];
            }
            while ( v29 > -1 );
            m_aFlags[m_nFreeIndex] = v29 & 0x7F;
            v25->m_aFlags[v25->m_nFreeIndex] = (v25->m_aFlags[v25->m_nFreeIndex] + 1) & 0x7F | v25->m_aFlags[v25->m_nFreeIndex] & 0x80;
            m_nFreeIndex = (int32)v25->m_aStorage[v25->m_nFreeIndex];
LABEL_3:
            v8 = this->m_Depth;
            *(float *)m_nFreeIndex = left;
            v9 = v32[0];
            *(float *)(m_nFreeIndex + 8) = right;
            *(_DWORD *)(m_nFreeIndex + 4) = v9;
            v10 = v31;
            *(_QWORD *)(m_nFreeIndex + 20) = 0LL;
            *(_QWORD *)(m_nFreeIndex + 28) = 0LL;
            *(float *)(m_nFreeIndex + 12) = v10;
            *(_DWORD *)(m_nFreeIndex + 16) = 0;
            *(_DWORD *)(m_nFreeIndex + 36) = v8 - 1;
            *v22 = m_nFreeIndex;
          }
          CQuadTreeNode::AddItem((CQuadTreeNode *)m_nFreeIndex, p_vData, bb);
        }
      }
      if ( ++v7 == 4 )
        break;
      m_Depth = this->m_Depth;
    }
  }
  else
  {
    v30 = (CPtrNode *)CPtrNodeSingleLink::operator new(8u);
    v30->m_pVoid = p_vData;
    v30->m_pNext = this->m_DataItems.m_pHead;
    this->m_DataItems.m_pHead = v30;
  }
}

//----- (0040E478) --------------------------------------------------------
void __fastcall CQuadTreeNode::DeleteItem(CQuadTreeNode *this, void *p_vData)
{
  CQuadTreeNode *v2; // r5
  void *v3; // r4
  CPtrNode *m_pHead; // r1
  CPtrNode *v5; // r0
  CPtrNode *v6; // r2
  CPtrNode *v7; // r3
  CPtrNode *v8; // r0
  CQuadTreeNode *v9; // r0
  CQuadTreeNode *v10; // r0
  CQuadTreeNode *v11; // r0

  while ( 1 )
  {
    v2 = this;
    v3 = p_vData;
    m_pHead = this->m_DataItems.m_pHead;
    if ( m_pHead )
    {
      v5 = this->m_DataItems.m_pHead;
      while ( v5->m_pVoid != v3 )
      {
        v5 = v5->m_pNext;
        if ( !v5 )
          goto LABEL_16;
      }
      v6 = 0;
      v7 = m_pHead;
      while ( 1 )
      {
        v8 = v7;
        if ( v7->m_pVoid == v3 )
          break;
        v7 = v7->m_pNext;
        v6 = v8;
        if ( !v7 )
          goto LABEL_16;
      }
      if ( m_pHead == v7 )
      {
        v2->m_DataItems.m_pHead = m_pHead->m_pNext;
      }
      else if ( v6 )
      {
        v6->m_pNext = v7->m_pNext;
      }
      CPtrNodeSingleLink::operator delete(v7);
    }
LABEL_16:
    v9 = v2->mp_Children[0];
    if ( v9 )
      CQuadTreeNode::DeleteItem(v9, v3);
    v10 = v2->mp_Children[1];
    if ( v10 )
      CQuadTreeNode::DeleteItem(v10, v3);
    v11 = v2->mp_Children[2];
    if ( v11 )
      CQuadTreeNode::DeleteItem(v11, v3);
    this = v2->mp_Children[3];
    if ( !this )
      break;
    p_vData = v3;
  }
}

//----- (0040E4F4) --------------------------------------------------------
void __fastcall CQuadTreeNode::DeleteItem(CQuadTreeNode *this, void *p_vData, const CRect *bb)
{
  CPtrNode *m_pHead; // r1
  CPtrNode *v7; // r0
  CPtrNode *v8; // r2
  CPtrNode *v9; // r3
  CPtrNode *v10; // r0
  int i; // r5
  float top; // r0
  float left; // s2
  float bottom; // r1
  float right; // s0
  float v16; // s4
  float *v17; // r0
  float v18; // [sp+0h] [bp-28h] BYREF
  float v19; // [sp+4h] [bp-24h] BYREF

  m_pHead = this->m_DataItems.m_pHead;
  if ( m_pHead )
  {
    v7 = this->m_DataItems.m_pHead;
    while ( v7->m_pVoid != p_vData )
    {
      v7 = v7->m_pNext;
      if ( !v7 )
        goto LABEL_16;
    }
    v8 = 0;
    v9 = m_pHead;
    while ( 1 )
    {
      v10 = v9;
      if ( v9->m_pVoid == p_vData )
        break;
      v9 = v9->m_pNext;
      v8 = v10;
      if ( !v9 )
        goto LABEL_16;
    }
    if ( m_pHead == v9 )
    {
      this->m_DataItems.m_pHead = m_pHead->m_pNext;
    }
    else if ( v8 )
    {
      v8->m_pNext = v9->m_pNext;
    }
    CPtrNodeSingleLink::operator delete(v9);
  }
LABEL_16:
  for ( i = 0; i != 4; ++i )
  {
    top = this->m_rect.top;
    left = this->m_rect.left;
    v19 = top;
    bottom = this->m_rect.bottom;
    right = this->m_rect.right;
    v18 = bottom;
    if ( this->m_Depth )
    {
      v16 = top;
      switch ( i )
      {
        case 0:
          v17 = &v18;
          right = (float)(left + right) * 0.5;
          goto LABEL_24;
        case 1:
          v17 = &v18;
          left = (float)(left + right) * 0.5;
          goto LABEL_24;
        case 2:
          right = (float)(left + right) * 0.5;
          goto LABEL_23;
        case 3:
          left = (float)(left + right) * 0.5;
LABEL_23:
          v17 = &v19;
LABEL_24:
          *v17 = (float)(v16 + bottom) * 0.5;
          break;
        default:
          break;
      }
      if ( left <= bb->right && right >= bb->left && v18 <= bb->top && v19 >= bb->bottom )
        CQuadTreeNode::DeleteItem(this->mp_Children[i], p_vData, bb);
    }
  }
}

//----- (0040E614) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CRange2D::CRange2D(CRange2D *this, CVector2D vec2DTopLeft, CVector2D vec2DBotRight)
{
  this->m_vec2DTopLeft = vec2DTopLeft;
  this->m_vec2DBotRight = vec2DBotRight;
}
// 40E614: fragmented variable at 0:r3.4,4:^0.4 may be wrong
// 40E614: variables would overlap: 0:r3.4,4:^0.4 and ^0.4

//----- (0040E620) --------------------------------------------------------
bool __fastcall CRange2D::IsInRange(CRange2D *this, CVector2D vec2DCoord)
{
  return this->m_vec2DTopLeft.x < vec2DCoord.x
      && this->m_vec2DBotRight.x > vec2DCoord.x
      && this->m_vec2DTopLeft.y < vec2DCoord.y
      && this->m_vec2DBotRight.y > vec2DCoord.y;
}

//----- (0040E668) --------------------------------------------------------
CVector2D *__fastcall CRange2D::GetRandomPointInRange(CVector2D *retstr, CRange2D *this)
{
  float x; // s16
  float y; // s18
  float v6; // s20
  int v7; // s22
  float v8; // s16
  int v9; // s18
  int v10; // r0
  CVector2D *result; // r0
  int v12; // r1

  x = this->m_vec2DTopLeft.x;
  y = this->m_vec2DTopLeft.y;
  v6 = this->m_vec2DBotRight.y;
  v7 = (int)fabsf(this->m_vec2DBotRight.x - this->m_vec2DTopLeft.x);
  retstr->x = x + (float)(rand() % v7);
  v8 = this->m_vec2DTopLeft.y;
  v9 = (int)fabsf(v6 - y);
  v10 = rand();
  v12 = v10 % v9;
  result = (CVector2D *)(v10 / v9);
  retstr->y = v8 + (float)v12;
  return result;
}

//----- (0040E6E0) --------------------------------------------------------
void __fastcall CRange3D::CRange3D(CRange3D *this, CVector vecTopLeft, __int64 a3, RwReal a4)
{
  this->m_vecTopLeft = vecTopLeft;
  *(_QWORD *)&this->m_vecBotRight.x = a3;
  this->m_vecBotRight.z = a4;
}
// 40E6E0: using guessed type _QWORD arg_0;

//----- (0040E6F6) --------------------------------------------------------
bool __fastcall CRange3D::IsInRange(CRange3D *this, CVector vecCoord)
{
  return this->m_vecTopLeft.x < vecCoord.x
      && this->m_vecBotRight.x > vecCoord.x
      && this->m_vecTopLeft.y < vecCoord.y
      && this->m_vecBotRight.y > vecCoord.y
      && this->m_vecTopLeft.z < vecCoord.z
      && this->m_vecBotRight.z > vecCoord.z;
}

//----- (0040E75E) --------------------------------------------------------
CVector *__fastcall CRange3D::GetRandomPointInRange(CVector *retstr, CRange3D *this)
{
  float x; // s16
  float y; // s18
  float z; // s20
  float v7; // s22
  float v8; // s24
  int v9; // s26
  float v10; // s16
  int v11; // s2
  float v12; // s16
  int v13; // r0
  CVector *result; // r0
  int v15; // r1

  x = this->m_vecTopLeft.x;
  y = this->m_vecTopLeft.y;
  z = this->m_vecTopLeft.z;
  v7 = this->m_vecBotRight.y;
  v8 = this->m_vecBotRight.z;
  v9 = (int)fabsf(this->m_vecBotRight.x - this->m_vecTopLeft.x);
  retstr->x = x + (float)(rand() % v9);
  v10 = this->m_vecTopLeft.y;
  v11 = (int)fabsf(v8 - z);
  retstr->y = v10 + (float)(rand() % (int)fabsf(v7 - y));
  v12 = this->m_vecTopLeft.z;
  v13 = rand();
  v15 = v13 % v11;
  result = (CVector *)(v13 / v11);
  retstr->z = v12 + (float)v15;
  return result;
}

//----- (0040E818) --------------------------------------------------------
void CReferences::Init()
{
  void ***p_ppReferenceAddress; // r0
  int v1; // r1

  CReferences::pEmptyList = CReferences::aRefs;
  p_ppReferenceAddress = &CReferences::aRefs[0].ppReferenceAddress;
  v1 = 3000;
  do
  {
    *(p_ppReferenceAddress - 1) = (void **)(p_ppReferenceAddress + 1);
    *p_ppReferenceAddress = 0;
    --v1;
    p_ppReferenceAddress += 2;
  }
  while ( v1 );
  CReferences::aRefs[2999].pNext = 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0040E85C) --------------------------------------------------------
Int32 __fastcall CReferences::ListSize(CReference *pListHead)
{
  Int32 result; // r0

  result = 0;
  while ( pListHead )
  {
    pListHead = pListHead->pNext;
    ++result;
  }
  return result;
}

//----- (0040E870) --------------------------------------------------------
void __fastcall CEntity::RegisterReference(CEntity *this, CEntity **ppAddress)
{
  int v2; // r2
  bool v3; // zf
  CReference *pReferences; // r2
  CReference *m_aStorage; // r2
  int32 m_nSize; // r9
  CReference *v7; // r6
  CReference *v8; // r3
  int v9; // r10
  bool v10; // zf
  CReference *v11; // r4
  CReference *v12; // r12
  void **ppReferenceAddress; // r8
  int32 v14; // r9
  CReference *v15; // r6
  CReference *v16; // r3
  int v17; // r10
  bool v18; // zf
  CReference *v19; // r4
  CReference *v20; // r12
  void **v21; // r8
  int32 v22; // r9
  CReference *v23; // r6
  CReference *v24; // r3
  int v25; // r10
  bool v26; // zf
  CReference *v27; // r4
  CReference *v28; // r12
  void **v29; // r8
  CPedPool *v30; // [sp+0h] [bp-20h]
  CVehiclePool *v31; // [sp+0h] [bp-20h]
  CObjectPool *v32; // [sp+0h] [bp-20h]

  v2 = *(_BYTE *)&this->m_info & 7;
  v3 = v2 == 1;
  if ( v2 == 1 )
    v3 = (*((_WORD *)&this->m_nFlags + 1) & 0x440) == 0;
  if ( !v3 || this->m_iplIndex )
  {
    pReferences = this->pReferences;
    if ( pReferences )
    {
      while ( (CEntity **)pReferences->ppReferenceAddress != ppAddress )
      {
        pReferences = pReferences->pNext;
        if ( !pReferences )
          goto LABEL_9;
      }
    }
    else
    {
LABEL_9:
      m_aStorage = CReferences::pEmptyList;
      if ( !CReferences::pEmptyList )
      {
        v30 = CPools::ms_pPedPool;
        m_nSize = CPools::ms_pPedPool->m_nSize;
        if ( m_nSize )
        {
          v7 = 0;
          while ( 1 )
          {
            if ( (v30->m_aFlags[--m_nSize] & 0x80u) == 0 )
            {
              m_aStorage = (CReference *)v30->m_aStorage;
              v8 = (CReference *)(elf_hash_bucket + 1744);
              v9 = (int)v30->m_aStorage[m_nSize];
              v10 = v9 == 0;
              if ( v9 )
              {
                m_aStorage = (CReference *)(v9 + 40);
                v8 = *(CReference **)(v9 + 40);
                v10 = v8 == 0;
              }
              if ( !v10 )
              {
                v11 = 0;
                do
                {
                  v12 = m_aStorage;
                  while ( 1 )
                  {
                    m_aStorage = v8;
                    ppReferenceAddress = v8->ppReferenceAddress;
                    v8 = v8->pNext;
                    if ( *ppReferenceAddress == (void *)v9 )
                      break;
                    v12->pNext = v8;
                    v7 = m_aStorage;
                    m_aStorage->pNext = CReferences::pEmptyList;
                    v11 = m_aStorage;
                    CReferences::pEmptyList = m_aStorage;
                    m_aStorage->ppReferenceAddress = 0;
                    if ( !v8 )
                      goto LABEL_59;
                  }
                }
                while ( v8 );
                m_aStorage = v11;
                if ( v11 )
                  break;
              }
            }
            if ( !m_nSize )
            {
              m_aStorage = v7;
              if ( v7 )
                break;
              goto LABEL_25;
            }
          }
        }
        else
        {
LABEL_25:
          v31 = CPools::ms_pVehiclePool;
          v14 = CPools::ms_pVehiclePool->m_nSize;
          if ( v14 )
          {
            v15 = 0;
            while ( 1 )
            {
              if ( (v31->m_aFlags[--v14] & 0x80u) == 0 )
              {
                m_aStorage = (CReference *)v31->m_aStorage;
                v16 = (CReference *)(elf_hash_bucket + 2352);
                v17 = (int)v31->m_aStorage[v14];
                v18 = v17 == 0;
                if ( v17 )
                {
                  m_aStorage = (CReference *)(v17 + 40);
                  v16 = *(CReference **)(v17 + 40);
                  v18 = v16 == 0;
                }
                if ( !v18 )
                {
                  v19 = 0;
                  do
                  {
                    v20 = m_aStorage;
                    while ( 1 )
                    {
                      m_aStorage = v16;
                      v21 = v16->ppReferenceAddress;
                      v16 = v16->pNext;
                      if ( *v21 == (void *)v17 )
                        break;
                      v20->pNext = v16;
                      v15 = m_aStorage;
                      m_aStorage->pNext = CReferences::pEmptyList;
                      v19 = m_aStorage;
                      CReferences::pEmptyList = m_aStorage;
                      m_aStorage->ppReferenceAddress = 0;
                      if ( !v16 )
                        goto LABEL_59;
                    }
                  }
                  while ( v16 );
                  m_aStorage = v19;
                  if ( v19 )
                    break;
                }
              }
              if ( !v14 )
              {
                m_aStorage = v15;
                if ( v15 )
                  break;
                goto LABEL_44;
              }
            }
          }
          else
          {
LABEL_44:
            v32 = CPools::ms_pObjectPool;
            v22 = CPools::ms_pObjectPool->m_nSize;
            if ( !v22 )
              return;
            v23 = 0;
            while ( 1 )
            {
              if ( (v32->m_aFlags[--v22] & 0x80u) == 0 )
              {
                m_aStorage = (CReference *)v32->m_aStorage;
                v24 = (CReference *)(elf_hash_bucket + 168);
                v25 = (int)v32->m_aStorage[v22];
                v26 = v25 == 0;
                if ( v25 )
                {
                  m_aStorage = (CReference *)(v25 + 40);
                  v24 = *(CReference **)(v25 + 40);
                  v26 = v24 == 0;
                }
                if ( !v26 )
                {
                  v27 = 0;
                  do
                  {
                    v28 = m_aStorage;
                    while ( 1 )
                    {
                      m_aStorage = v24;
                      v29 = v24->ppReferenceAddress;
                      v24 = v24->pNext;
                      if ( *v29 == (void *)v25 )
                        break;
                      v28->pNext = v24;
                      v23 = m_aStorage;
                      m_aStorage->pNext = CReferences::pEmptyList;
                      v27 = m_aStorage;
                      CReferences::pEmptyList = m_aStorage;
                      m_aStorage->ppReferenceAddress = 0;
                      if ( !v24 )
                        goto LABEL_59;
                    }
                  }
                  while ( v24 );
                  m_aStorage = v27;
                  if ( v27 )
                    break;
                }
              }
              if ( !v22 )
              {
                m_aStorage = v23;
                if ( !v23 )
                  return;
                break;
              }
            }
          }
        }
      }
LABEL_59:
      CReferences::pEmptyList = m_aStorage->pNext;
      m_aStorage->pNext = this->pReferences;
      this->pReferences = m_aStorage;
      m_aStorage->ppReferenceAddress = (void **)ppAddress;
    }
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0040EAB0) --------------------------------------------------------
void __fastcall CEntity::PruneReferences(CEntity *this)
{
  CReference **p_pReferences; // r1
  CReference *pReferences; // r3
  CReference **v3; // lr

  p_pReferences = &this->pReferences;
  pReferences = this->pReferences;
  while ( pReferences )
  {
    v3 = p_pReferences;
    p_pReferences = &pReferences->pNext;
    while ( 1 )
    {
      pReferences = *p_pReferences;
      if ( (CEntity *)p_pReferences[1]->pNext == this )
        break;
      *v3 = pReferences;
      *p_pReferences = CReferences::pEmptyList;
      CReferences::pEmptyList = (CReference *)p_pReferences;
      p_pReferences[1] = 0;
      p_pReferences = &pReferences->pNext;
      if ( !pReferences )
        return;
    }
  }
}

//----- (0040EAFC) --------------------------------------------------------
void __fastcall CEntity::CleanUpOldReference(CEntity *this, CEntity **ppAddress)
{
  CReference **p_pReferences; // r0
  CReference *v3; // r2
  CReference *pReferences; // t1

  pReferences = this->pReferences;
  p_pReferences = &this->pReferences;
  v3 = pReferences;
  if ( pReferences )
  {
    while ( (CEntity **)v3->ppReferenceAddress != ppAddress )
    {
      p_pReferences = &v3->pNext;
      v3 = v3->pNext;
      if ( !v3 )
        return;
    }
    *p_pReferences = v3->pNext;
    v3->pNext = CReferences::pEmptyList;
    CReferences::pEmptyList = v3;
    v3->ppReferenceAddress = 0;
  }
}

//----- (0040EB34) --------------------------------------------------------
void __fastcall CEntity::ResolveReferences(CEntity *this)
{
  CReference *pReferences; // r1
  void **ppReferenceAddress; // r3
  CReference *v3; // r1
  CReference *v4; // r2

  pReferences = this->pReferences;
  if ( pReferences )
  {
    do
    {
      ppReferenceAddress = pReferences->ppReferenceAddress;
      if ( *ppReferenceAddress == this )
        *ppReferenceAddress = 0;
      pReferences = pReferences->pNext;
    }
    while ( pReferences );
    v3 = this->pReferences;
    if ( v3 )
    {
      do
      {
        v4 = v3;
        v3 = v3->pNext;
        v4->ppReferenceAddress = 0;
      }
      while ( v3 );
      v4->pNext = CReferences::pEmptyList;
      CReferences::pEmptyList = this->pReferences;
      this->pReferences = 0;
    }
  }
}

//----- (0040EB7C) --------------------------------------------------------
void __fastcall CheckReferences(CEntity *entity)
{
  CReference **p_pReferences; // r0

  p_pReferences = &entity->pReferences;
  do
    p_pReferences = (CReference **)*p_pReferences;
  while ( p_pReferences );
}

//----- (0040EB88) --------------------------------------------------------
void CReferences::RemoveReferencesToPlayer()
{
  CVehicle *PlayerVehicle; // r0
  CReference *pReferences; // r1
  CVehicle **ppReferenceAddress; // r2
  CReference *v3; // r1
  CReference *v4; // r2
  CPlayerPed *PlayerPed; // r0
  CReference *v6; // r1
  CPlayerPed **v7; // r3
  CReference *v8; // r1
  CReference *v9; // r2
  CPedGroupMembership *p_m_membership; // r4
  CPlayerPed *v11; // r0
  CPlayerPed *v12; // r0

  if ( FindPlayerVehicle(-1, 0) )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    pReferences = PlayerVehicle->pReferences;
    if ( pReferences )
    {
      do
      {
        ppReferenceAddress = (CVehicle **)pReferences->ppReferenceAddress;
        if ( *ppReferenceAddress == PlayerVehicle )
          *ppReferenceAddress = 0;
        pReferences = pReferences->pNext;
      }
      while ( pReferences );
      v3 = PlayerVehicle->pReferences;
      if ( v3 )
      {
        do
        {
          v4 = v3;
          v3 = v3->pNext;
          v4->ppReferenceAddress = 0;
        }
        while ( v3 );
        v4->pNext = CReferences::pEmptyList;
        CReferences::pEmptyList = PlayerVehicle->pReferences;
        PlayerVehicle->pReferences = 0;
      }
    }
  }
  if ( FindPlayerPed(-1) )
  {
    PlayerPed = FindPlayerPed(-1);
    v6 = PlayerPed->pReferences;
    if ( v6 )
    {
      do
      {
        v7 = (CPlayerPed **)v6->ppReferenceAddress;
        if ( *v7 == PlayerPed )
          *v7 = 0;
        v6 = v6->pNext;
      }
      while ( v6 );
      v8 = PlayerPed->pReferences;
      if ( v8 )
      {
        do
        {
          v9 = v8;
          v8 = v8->pNext;
          v9->ppReferenceAddress = 0;
        }
        while ( v8 );
        v9->pNext = CReferences::pEmptyList;
        CReferences::pEmptyList = PlayerPed->pReferences;
        PlayerPed->pReferences = 0;
      }
    }
    p_m_membership = &CPedGroups::ms_groups[FindPlayerPed(-1)->m_pPlayerData->m_PlayerGroup].m_membership;
    v11 = FindPlayerPed(-1);
    CPedGroupMembership::SetLeader(p_m_membership, v11);
    v12 = FindPlayerPed(-1);
    sub_18AD80(&CPedGroups::ms_groups[v12->m_pPlayerData->m_PlayerGroup]);
  }
}

//----- (0040EC8C) --------------------------------------------------------
void CReferences::PruneAllReferencesInWorld()
{
  CPedPool *v0; // lr
  int32 m_nSize; // r1
  int v2; // r0
  CReference *v3; // r4
  CReference *pNext; // r5
  CReference *v5; // r6
  CVehiclePool *v6; // lr
  int32 v7; // r1
  int v8; // r0
  CReference *v9; // r4
  CReference *v10; // r5
  CReference *v11; // r6
  CObjectPool *v12; // lr
  int32 v13; // r1
  int v14; // r0
  CReference *v15; // r4
  CReference *v16; // r5
  CReference *v17; // r6

  v0 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  while ( m_nSize )
  {
    if ( (v0->m_aFlags[--m_nSize] & 0x80u) == 0 )
    {
      v2 = (int)v0->m_aStorage[m_nSize];
      if ( v2 )
      {
        v3 = (CReference *)(v2 + 40);
        pNext = *(CReference **)(v2 + 40);
        while ( pNext )
        {
          v5 = v3;
          v3 = pNext;
          while ( 1 )
          {
            pNext = v3->pNext;
            if ( *v3->ppReferenceAddress == (void *)v2 )
              break;
            v5->pNext = pNext;
            v3->pNext = CReferences::pEmptyList;
            CReferences::pEmptyList = v3;
            v3->ppReferenceAddress = 0;
            v3 = pNext;
            if ( !pNext )
              goto LABEL_9;
          }
        }
      }
    }
LABEL_9:
    ;
  }
  v6 = CPools::ms_pVehiclePool;
  v7 = CPools::ms_pVehiclePool->m_nSize;
  while ( v7 )
  {
    if ( (v6->m_aFlags[--v7] & 0x80u) == 0 )
    {
      v8 = (int)v6->m_aStorage[v7];
      if ( v8 )
      {
        v9 = (CReference *)(v8 + 40);
        v10 = *(CReference **)(v8 + 40);
        while ( v10 )
        {
          v11 = v9;
          v9 = v10;
          while ( 1 )
          {
            v10 = v9->pNext;
            if ( *v9->ppReferenceAddress == (void *)v8 )
              break;
            v11->pNext = v10;
            v9->pNext = CReferences::pEmptyList;
            CReferences::pEmptyList = v9;
            v9->ppReferenceAddress = 0;
            v9 = v10;
            if ( !v10 )
              goto LABEL_18;
          }
        }
      }
    }
LABEL_18:
    ;
  }
  v12 = CPools::ms_pObjectPool;
  v13 = CPools::ms_pObjectPool->m_nSize;
  while ( v13 )
  {
    if ( (v12->m_aFlags[--v13] & 0x80u) == 0 )
    {
      v14 = (int)v12->m_aStorage[v13];
      if ( v14 )
      {
        v15 = (CReference *)(v14 + 40);
        v16 = *(CReference **)(v14 + 40);
        while ( v16 )
        {
          v17 = v15;
          v15 = v16;
          while ( 1 )
          {
            v16 = v15->pNext;
            if ( *v15->ppReferenceAddress == (void *)v14 )
              break;
            v17->pNext = v16;
            v15->pNext = CReferences::pEmptyList;
            CReferences::pEmptyList = v15;
            v15->ppReferenceAddress = 0;
            v15 = v16;
            if ( !v16 )
              goto LABEL_27;
          }
        }
      }
    }
LABEL_27:
    ;
  }
}

//----- (0040EDE0) --------------------------------------------------------
int32 AllowDistanceFog()
{
  int32 result; // r0

  result = MobileSettings::settings[0].value;
  if ( MobileSettings::settings[0].value )
    return 1;
  return result;
}

//----- (0040EDF8) --------------------------------------------------------
void CRenderer::ConstructReflectionList()
{
  CSimpleTransform *p_tx; // r2
  unsigned int TunnelAttributesForCoors; // r0
  char v2; // r2
  bool v3; // r1
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r3
  CSimpleTransform *p_m_transform; // r2
  __int64 v7; // d16
  float v8; // s0

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  TunnelAttributesForCoors = CCullZones::FindTunnelAttributesForCoors(p_tx->m_translate);
  v2 = TunnelAttributesForCoors & 0x80;
  if ( (TunnelAttributesForCoors & 0x880) != 0 )
    v2 = 1;
  CRenderer::ms_bRenderTunnels = v2;
  v3 = 1;
  if ( (TunnelAttributesForCoors & 0x80) == 0 )
    v3 = ((TunnelAttributesForCoors >> 11) & 1) == 0;
  CRenderer::ms_bInTheSky = 0;
  CRenderer::ms_bRenderOutsideTunnels = v3;
  CRenderer::ms_lowLodDistScale = CTimeCycle::m_CurrentColours.m_fLODMultiplier * 10.0;
  COcclusion::ProcessBeforeRendering();
  CRenderer::ms_nNoOfVisibleLods = 0;
  CRenderer::ms_nNoOfVisibleEntities = 0;
  CRenderer::ms_nNoOfInVisibleEntities = 0;
  PlayerPed = FindPlayerPed(-1);
  m_pMat = PlayerPed->m_pMat;
  p_m_transform = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_m_transform = &PlayerPed->m_transform;
  v7 = *(_QWORD *)&p_m_transform->m_translate.x;
  CRenderer::ms_vecCameraPosition.z = p_m_transform->m_translate.z;
  *(_QWORD *)&CRenderer::ms_vecCameraPosition.x = v7;
  if ( TheCamera.m_pMat )
    v8 = atan2f(TheCamera.m_pMat->xy, COERCE_FLOAT(LODWORD(TheCamera.m_pMat->yy) ^ 0x80000000));
  else
    v8 = TheCamera.m_transform.m_heading + 3.1416;
  CRenderer::ms_fCameraHeading = v8;
  CRenderer::ms_fFarClipPlane = TheCamera.m_pRwCamera->farPlane;
  CRenderer::ms_pLodRenderList = (EntityInfo_0 *)&PC_Scratch[24];
  CRenderer::ms_pLodDontRenderList = (EntityInfo_0 *)&PC_Scratch[0x2000];
  CRenderer::ScanWorld();
  CRenderer::ProcessLodRenderLists();
  sub_19FA9C();
}

//----- (0040EF7C) --------------------------------------------------------
void CRenderer::ResetLodRenderLists()
{
  CRenderer::ms_pLodDontRenderList = (EntityInfo_0 *)&PC_Scratch[0x2000];
  CRenderer::ms_pLodRenderList = (EntityInfo_0 *)&PC_Scratch[24];
}

//----- (0040EFB0) --------------------------------------------------------
void CRenderer::ScanWorld()
{
  char v0; // r0
  char v1; // r0
  float farPlane; // s16
  float x; // s0
  unsigned int v4; // s6
  char *parent; // r6
  const RwMatrix *v6; // r3
  uint16 v7; // r0
  float v8; // s0
  CSimpleTransform *p_tx; // r2
  __int64 v10; // d19
  RwReal v11; // r0
  float32x4_t v12; // q8
  RwV2d_0 v13; // [sp+0h] [bp-F0h] BYREF
  float v14; // [sp+8h] [bp-E8h]
  float v15; // [sp+Ch] [bp-E4h]
  float v16; // [sp+10h] [bp-E0h]
  float v17; // [sp+14h] [bp-DCh]
  float v18; // [sp+18h] [bp-D8h]
  float v19; // [sp+1Ch] [bp-D4h]
  float v20; // [sp+20h] [bp-D0h]
  float v21; // [sp+24h] [bp-CCh]
  RwV3d_0 v22; // [sp+28h] [bp-C8h] BYREF
  float32x4_t v23; // [sp+34h] [bp-BCh]
  unsigned int v24; // [sp+44h] [bp-ACh]
  float v25; // [sp+48h] [bp-A8h]
  float32x4_t v26; // [sp+4Ch] [bp-A4h]
  float v27; // [sp+5Ch] [bp-94h]
  float v28; // [sp+60h] [bp-90h]
  float32x4_t v29; // [sp+64h] [bp-8Ch]
  __int64 v30; // [sp+74h] [bp-7Ch]
  double v31; // [sp+7Ch] [bp-74h]
  __int64 v32; // [sp+84h] [bp-6Ch]
  __int64 v33; // [sp+8Ch] [bp-64h]
  float32x4_t v34; // [sp+94h] [bp-5Ch]
  __int64 v35; // [sp+A4h] [bp-4Ch]
  double v36; // [sp+ACh] [bp-44h]
  __int64 v37; // [sp+B4h] [bp-3Ch]
  __int64 v38; // [sp+BCh] [bp-34h]

  v0 = `guard variable for'CRenderer::ScanWorld(void)::oldCameraPosn;
  __dmb(0xBu);
  if ( (v0 & 1) == 0 && _cxa_guard_acquire((__guard *)&`guard variable for'CRenderer::ScanWorld(void)::oldCameraPosn) )
    _cxa_guard_release((__guard *)&`guard variable for'CRenderer::ScanWorld(void)::oldCameraPosn);
  v1 = `guard variable for'CRenderer::ScanWorld(void)::oldCameraView;
  __dmb(0xBu);
  if ( (v1 & 1) == 0 && _cxa_guard_acquire((__guard *)&`guard variable for'CRenderer::ScanWorld(void)::oldCameraView) )
    _cxa_guard_release((__guard *)&`guard variable for'CRenderer::ScanWorld(void)::oldCameraView);
  farPlane = TheCamera.m_pRwCamera->farPlane;
  memset(&v22, 0, sizeof(v22));
  x = TheCamera.m_pRwCamera->viewWindow.x;
  *(float *)&v4 = farPlane * TheCamera.m_pRwCamera->viewWindow.y;
  v23.n128_f32[0] = -(float)(farPlane * x);
  v25 = farPlane;
  v23.n128_f32[3] = farPlane * x;
  v26.n128_f32[2] = farPlane;
  v26.n128_f32[0] = farPlane * x;
  v28 = farPlane;
  v26.n128_f32[3] = v23.n128_f32[0];
  *(unsigned __int64 *)((char *)v23.n128_u64 + 4) = __PAIR64__(LODWORD(farPlane), v4);
  v24 = v4;
  v26.n128_f32[1] = -*(float *)&v4;
  v27 = -*(float *)&v4;
  v37 = 0LL;
  v38 = 0LL;
  v35 = 0LL;
  v36 = 0.0;
  v34 = 0uLL;
  v32 = 0LL;
  v33 = 0LL;
  v30 = 0LL;
  v31 = 0.0;
  v29 = 0uLL;
  parent = (char *)TheCamera.m_pRwCamera->object.object.parent;
  CRenderer::m_pFirstPersonVehicle = 0;
  CVisibilityPlugins::InitAlphaEntityList();
  v6 = (const RwMatrix *)(parent + 16);
  if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
  {
    CWorld::ClearScanCodes();
    v6 = (const RwMatrix *)(parent + 16);
    v7 = 1;
  }
  else
  {
    v7 = CWorld::ms_nCurrentScanCode + 1;
  }
  v8 = 1.0 / farPlane;
  CWorld::ms_nCurrentScanCode = v7;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v10 = *(_QWORD *)&p_tx->m_translate.x;
  v11 = *(float *)&byte_8[(_DWORD)p_tx];
  v12.n128_u64[0] = 0x4396000043960000LL;
  v12.n128_u64[1] = 0x4396000043960000LL;
  CRenderer::ScanWorld(void)::oldCameraView = *(CVector *)&TheCamera.m_cameraMatrix.xy;
  CRenderer::ScanWorld(void)::oldCameraPosn.z = v11;
  *(_QWORD *)&CRenderer::ScanWorld(void)::oldCameraPosn.x = v10;
  v29 = vmulq_n_f32(vmulq_f32(v23, v12), v8);
  *((float *)&v30 + 1) = v8 * (float)(v25 * 300.0);
  *(float *)&v30 = v8 * (float)(*(float *)&v24 * 300.0);
  LODWORD(v32) = v29.n128_u32[2];
  *((float *)&v33 + 1) = *((float *)&v30 + 1);
  *(float *)&v31 = v29.n128_f32[0] * 0.2;
  *((float *)&v32 + 1) = v29.n128_f32[3] * 0.2;
  *((float *)&v31 + 1) = v29.n128_f32[1] * 0.2;
  *(float *)&v33 = *(float *)&v30 * 0.2;
  v34 = vmulq_n_f32(vmulq_f32(v26, v12), v8);
  *(float *)&v35 = v8 * (float)(v27 * 300.0);
  *((float *)&v35 + 1) = v8 * (float)(v28 * 300.0);
  LODWORD(v37) = v34.n128_u32[2];
  *((float *)&v38 + 1) = *((float *)&v35 + 1);
  *(float *)&v36 = v34.n128_f32[0] * 0.2;
  *((float *)&v36 + 1) = v34.n128_f32[1] * 0.2;
  *((float *)&v37 + 1) = v34.n128_f32[3] * 0.2;
  *(float *)&v38 = *(float *)&v35 * 0.2;
  RwV3dTransformPoints(&v22, &v22, 13, v6);
  CRenderer::m_loadingPriority = 0;
  v14 = (float)(v29.n128_f32[0] / 50.0) + 60.0;
  v13.x = (float)(v22.x / 50.0) + 60.0;
  v13.y = (float)(v22.y / 50.0) + 60.0;
  v18 = (float)(v34.n128_f32[0] / 50.0) + 60.0;
  v16 = (float)(v29.n128_f32[3] / 50.0) + 60.0;
  v15 = (float)(v29.n128_f32[1] / 50.0) + 60.0;
  v17 = (float)(*(float *)&v30 / 50.0) + 60.0;
  v19 = (float)(v34.n128_f32[1] / 50.0) + 60.0;
  v20 = (float)(v34.n128_f32[3] / 50.0) + 60.0;
  v21 = (float)(*(float *)&v35 / 50.0) + 60.0;
  CWorldScan::ScanWorld(&v13, 5, CRenderer::ScanSectorList);
  v13.x = (float)(v22.x / 200.0) + 15.0;
  v13.y = (float)(v22.y / 200.0) + 15.0;
  v14 = (float)(v23.n128_f32[0] / 200.0) + 15.0;
  v15 = (float)(v23.n128_f32[1] / 200.0) + 15.0;
  v16 = (float)(v23.n128_f32[3] / 200.0) + 15.0;
  v17 = (float)(*(float *)&v24 / 200.0) + 15.0;
  v18 = (float)(v26.n128_f32[0] / 200.0) + 15.0;
  v19 = (float)(v26.n128_f32[1] / 200.0) + 15.0;
  v20 = (float)(v26.n128_f32[3] / 200.0) + 15.0;
  v21 = (float)(v27 / 200.0) + 15.0;
  CWorldScan::ScanWorld(&v13, 5, CRenderer::ScanBigBuildingList);
}
// 962E7C: using guessed type char `guard variable for'CRenderer::ScanWorld(void)::oldCameraPosn;
// 962E8C: using guessed type char `guard variable for'CRenderer::ScanWorld(void)::oldCameraView;

//----- (0040F424) --------------------------------------------------------
void CRenderer::ProcessLodRenderLists()
{
  EntityInfo_0 *v0; // r0
  int *v1; // r5
  int *v2; // r1
  int v3; // r3
  EntityInfo_0 *v4; // r0
  int v5; // r8
  int *v6; // r1
  int v7; // r1
  int v8; // r2
  int m_alpha; // r3
  bool v10; // zf
  int32 v11; // r0
  int v12; // r0
  int *v13; // r0
  int v14; // r2
  int v15; // r3
  int *v16; // r6
  int v17; // r4
  int v18; // r1
  int *v19; // r5
  int v20; // r0
  int v21; // r12
  CBaseModelInfo *v22; // r3
  float v23; // s0
  int32 *v24; // r1
  u_native *v25; // r2
  int32 v26; // r0

  v0 = CRenderer::ms_pLodRenderList;
  v1 = &PC_Scratch[24];
  if ( CRenderer::ms_pLodRenderList != (EntityInfo_0 *)&PC_Scratch[24] )
  {
    v2 = &PC_Scratch[24];
    do
    {
      v3 = *v2;
      if ( *v2 && !(*(unsigned __int8 *)(v3 + 28) >> 7) )
      {
        *(_BYTE *)(v3 + 57) = 0;
        *v2 = 0;
      }
      v2 += 2;
    }
    while ( v0 != (EntityInfo_0 *)v2 );
    v1 = (int *)v0;
  }
  if ( v1 == &PC_Scratch[24] )
    goto LABEL_29;
  do
  {
    v4 = (EntityInfo_0 *)v1;
    v5 = 1;
    v1 = &PC_Scratch[24];
LABEL_10:
    while ( 2 )
    {
      v6 = v1 + 2;
      while ( 1 )
      {
        v1 = v6;
        v7 = *(v6 - 2);
        if ( v7 )
          break;
LABEL_24:
        v6 = v1 + 2;
        if ( v1 == (int *)v4 )
        {
          v1 = &PC_Scratch[24];
          v12 = ((char *)v6 - (char *)PC_Scratch == 104) | v5;
          v5 = 1;
          v10 = v12 << 31 == 0;
          v4 = (EntityInfo_0 *)(v6 - 2);
          if ( v10 )
            goto LABEL_10;
          v1 = v6 - 2;
          goto LABEL_29;
        }
      }
      if ( !*(_BYTE *)(v7 + 56) || *(char *)(v7 + 57) != *(unsigned __int8 *)(v7 + 56) )
      {
        v8 = *(_DWORD *)(v7 + 52);
        if ( v8 )
        {
          m_alpha = CModelInfo::ms_modelInfoPtrs[*(__int16 *)(v7 + 38)]->m_alpha;
          v10 = m_alpha == 255;
          if ( m_alpha != 255 )
            v10 = *(unsigned __int8 *)(v8 + 57) == 128;
          if ( !v10 && (*(_BYTE *)(v8 + 31) & 2) != 0 )
            *(_BYTE *)(v8 + 57) = 0;
          if ( !*(_DWORD *)(v7 + 24) )
          {
            if ( (*(_BYTE *)(v8 + 31) & 2) != 0 )
              *(_BYTE *)(v8 + 57) = 0x80;
            *(v1 - 2) = 0;
            v11 = *(__int16 *)(v7 + 38);
            *(_BYTE *)(v7 + 57) = 0;
            CStreaming::RequestModel(v11, 0);
            v4 = CRenderer::ms_pLodRenderList;
          }
        }
        goto LABEL_24;
      }
      v5 = 0;
      *(_BYTE *)(v7 + 57) = 0;
      *(v1 - 2) = 0;
      v4 = CRenderer::ms_pLodRenderList;
      if ( CRenderer::ms_pLodRenderList != (EntityInfo_0 *)v1 )
        continue;
      break;
    }
  }
  while ( (char *)v1 - (char *)PC_Scratch != 96 );
LABEL_29:
  if ( v1 != &PC_Scratch[24] )
  {
    v13 = &PC_Scratch[24];
    do
    {
      v14 = *v13;
      if ( *v13 && *(char *)(v14 + 57) >= 1 )
      {
        v15 = *(_DWORD *)(v14 + 28);
        *(_BYTE *)(v14 + 57) = 0;
        *(_DWORD *)(v14 + 28) = v15 & 0xFDFFFFFF;
        *v13 = 0;
      }
      v13 += 2;
    }
    while ( v1 != v13 );
    if ( v1 != &PC_Scratch[24] )
    {
      v16 = &PC_Scratch[24];
      while ( 1 )
      {
        v17 = *v16;
        if ( *v16 )
          break;
LABEL_52:
        v16 += 2;
        if ( v16 == v1 )
          return;
      }
      if ( (*(unsigned __int8 *)(v17 + 57) | 0xFFFFFF80) == -128 )
      {
        v19 = (int *)(v17 + 28);
        v18 = *(_DWORD *)(v17 + 28);
        v20 = *(__int16 *)(v17 + 38);
        v21 = *(_DWORD *)(v17 + 32);
        v22 = CModelInfo::ms_modelInfoPtrs[v20];
        *(_DWORD *)(v17 + 28) = v18 | 0x2000000;
        if ( v22->m_alpha != 255 )
        {
          *v19 = v18 | 0x2008000;
          *(_DWORD *)(v17 + 32) = v21;
        }
        v23 = *((float *)v16 + 1);
        CModelInfo::ms_modelInfoPtrs[v20]->m_flags &= ~1u;
        if ( (*v19 & 0x8000) != 0 )
        {
          if ( CVisibilityPlugins::InsertEntityIntoSortedList((CEntity *)v17, v23) )
            goto LABEL_51;
        }
        else if ( (*v19 & 0x4000) != 0 && CVisibilityPlugins::InsertEntityIntoSortedList((CEntity *)v17, v23) )
        {
          *v19 &= ~0x8000u;
          goto LABEL_51;
        }
        if ( !*(_BYTE *)(v17 + 56) || (*(_BYTE *)(v17 + 30) & 0x10) != 0 )
        {
          v24 = &CRenderer::ms_nNoOfVisibleEntities;
          v25 = CRenderer::ms_aVisibleEntityPtrs;
        }
        else
        {
          v24 = &CRenderer::ms_nNoOfVisibleLods;
          v25 = CRenderer::ms_aVisibleLodPtrs;
        }
        v26 = *v24;
        v25[*v24] = v17;
        *v24 = v26 + 1;
      }
LABEL_51:
      *(_BYTE *)(v17 + 57) = 0;
      v1 = (int *)CRenderer::ms_pLodRenderList;
      goto LABEL_52;
    }
  }
}

//----- (0040F6FC) --------------------------------------------------------
void CRenderer::ConstructRenderList()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d2
  CSimpleTransform *p_tx; // r2
  unsigned int TunnelAttributesForCoors; // r0
  char v4; // r2
  bool v5; // r1
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v7; // r5
  int v8; // r10
  float v9; // r9
  _BOOL4 v10; // r8
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r1
  int v13; // r4
  CSimpleTransform *v14; // r2
  CSimpleTransform *v15; // r1
  __int64 v16; // d16
  float m_heading; // s0

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  TunnelAttributesForCoors = CCullZones::FindTunnelAttributesForCoors(p_tx->m_translate);
  v4 = TunnelAttributesForCoors & 0x80;
  if ( (TunnelAttributesForCoors & 0x880) != 0 )
    v4 = 1;
  CRenderer::ms_bRenderTunnels = v4;
  v5 = 1;
  if ( (TunnelAttributesForCoors & 0x80) == 0 )
    v5 = ((TunnelAttributesForCoors >> 11) & 1) == 0;
  CRenderer::ms_lowLodDistScale = 1.0;
  CRenderer::ms_bRenderOutsideTunnels = v5;
  CRenderer::ms_bInTheSky = 0;
  PlayerPed = FindPlayerPed(-1);
  v7 = PlayerPed;
  if ( PlayerPed && !PlayerPed->m_areaCode )
  {
    v8 = 0;
    v9 = CCamera::CalculateGroundHeight(&TheCamera, 0);
    CCamera::CalculateGroundHeight(&TheCamera, 2u);
    v10 = IsPlayerRemotePlane();
    m_pMat = v7->m_pMat;
    p_m_transform = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_m_transform = &v7->m_transform;
    if ( (float)(p_m_transform->m_translate.z - v9) > 50.0 )
    {
      v13 = 0;
      if ( !FindPlayerVehicle(-1, 0) )
        v13 = 1;
      if ( !(v10 | v13) )
        CRenderer::ms_bInTheSky = 1;
    }
    v14 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      v14 = &TheCamera.m_transform;
    v0.n64_u32[0] = LODWORD(v14->m_translate.z);
    if ( v0.n64_f32[0] <= 80.0 )
      v8 = 1;
    if ( !(v10 | v8) )
    {
      v1.n64_u32[0] = 1.0;
      v0.n64_f32[0] = (float)(v0.n64_f32[0] + -80.0) / 170.0;
      CRenderer::ms_lowLodDistScale = (float)(vmin_f32(v0, v1).n64_f32[0] * 1.2) + 1.0;
    }
  }
  CRenderer::ms_lowLodDistScale = CTimeCycle::m_CurrentColours.m_fLODMultiplier * CRenderer::ms_lowLodDistScale;
  CMirrors::BeforeConstructRenderList();
  COcclusion::ProcessBeforeRendering();
  CRenderer::ms_nNoOfInVisibleEntities = 0;
  v15 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  CRenderer::ms_nNoOfVisibleLods = 0;
  CRenderer::ms_nNoOfVisibleEntities = 0;
  if ( !TheCamera.m_pMat )
    v15 = &TheCamera.m_transform;
  v16 = *(_QWORD *)&v15->m_translate.x;
  CRenderer::ms_vecCameraPosition.z = *(RwReal *)&byte_8[(_DWORD)v15];
  *(_QWORD *)&CRenderer::ms_vecCameraPosition.x = v16;
  if ( TheCamera.m_pMat )
    m_heading = atan2f(COERCE_FLOAT(LODWORD(TheCamera.m_pMat->xy) ^ 0x80000000), TheCamera.m_pMat->yy);
  else
    m_heading = TheCamera.m_transform.m_heading;
  CRenderer::ms_fCameraHeading = m_heading;
  CRenderer::ms_fFarClipPlane = TheCamera.m_pRwCamera->farPlane;
  CRenderer::ms_pLodRenderList = (EntityInfo_0 *)&PC_Scratch[24];
  CRenderer::ms_pLodDontRenderList = (EntityInfo_0 *)&PC_Scratch[0x2000];
  CRenderer::ScanWorld();
  CRenderer::ProcessLodRenderLists();
  sub_19FA9C();
}
// 40F83A: variable 'v0' is possibly undefined
// 40F83A: variable 'v1' is possibly undefined

//----- (0040F990) --------------------------------------------------------
void CRenderer::PreRender()
{
  int v0; // r1
  int32 v1; // r4
  int32 v2; // r4
  int32 v3; // r4
  int32 v4; // r4
  CLinkList<CVisibilityPlugins::AlphaObjectInfo> *i; // r4
  _DWORD *pObj; // r0
  __int64 v7; // kr00_8
  CLinkList<CVisibilityPlugins::AlphaObjectInfo> *j; // r4
  _DWORD *v9; // r0
  __int64 v10; // kr08_8

  FadeDistMult = 1.0;
  if ( (RQCaps[5] || RQCaps[4] || RQCaps[14]) << 24 )
  {
    if ( MobileSettings::settings[0].value == 2 )
    {
      v0 = 1058642330;
      goto LABEL_12;
    }
    if ( MobileSettings::settings[0].value == 1 )
    {
      v0 = 1048576000;
      goto LABEL_12;
    }
    if ( MobileSettings::settings[0].value )
      goto LABEL_13;
  }
  else
  {
    if ( MobileSettings::settings[0].value == 1 )
    {
      v0 = 1056964608;
      goto LABEL_12;
    }
    if ( MobileSettings::settings[0].value )
      goto LABEL_13;
  }
  v0 = 0;
LABEL_12:
  LODWORD(FadeDistMult) = v0;
LABEL_13:
  if ( CRenderer::ms_nNoOfVisibleLods >= 1 )
  {
    v1 = 0;
    do
    {
      (*(void (__fastcall **)(u_native))(*(_DWORD *)CRenderer::ms_aVisibleLodPtrs[v1] + 72))(CRenderer::ms_aVisibleLodPtrs[v1]);
      ++v1;
    }
    while ( v1 < CRenderer::ms_nNoOfVisibleLods );
  }
  if ( CRenderer::ms_nNoOfVisibleEntities >= 1 )
  {
    v2 = 0;
    do
    {
      (*(void (__fastcall **)(u_native))(*(_DWORD *)CRenderer::ms_aVisibleEntityPtrs[v2] + 72))(CRenderer::ms_aVisibleEntityPtrs[v2]);
      ++v2;
    }
    while ( v2 < CRenderer::ms_nNoOfVisibleEntities );
  }
  if ( CRenderer::ms_nNoOfVisibleSuperLods >= 1 )
  {
    v3 = 0;
    do
    {
      (*(void (__fastcall **)(u_native))(*(_DWORD *)CRenderer::ms_aVisibleSuperLodPtrs[v3] + 72))(CRenderer::ms_aVisibleSuperLodPtrs[v3]);
      ++v3;
    }
    while ( v3 < CRenderer::ms_nNoOfVisibleSuperLods );
  }
  if ( CRenderer::ms_nNoOfInVisibleEntities >= 1 )
  {
    v4 = 0;
    do
    {
      (*(void (__fastcall **)(u_native))(*(_DWORD *)CRenderer::ms_aInVisibleEntityPtrs[v4] + 72))(CRenderer::ms_aInVisibleEntityPtrs[v4]);
      ++v4;
    }
    while ( v4 < CRenderer::ms_nNoOfInVisibleEntities );
  }
  for ( i = (CLinkList<CVisibilityPlugins::AlphaObjectInfo> *)CVisibilityPlugins::m_alphaEntityList.m_firstLink.m_pNext;
        i != (CLinkList<CVisibilityPlugins::AlphaObjectInfo> *)&CVisibilityPlugins::m_alphaEntityList.m_lastLink;
        i = (CLinkList<CVisibilityPlugins::AlphaObjectInfo> *)i->m_firstLink.m_pNext )
  {
    if ( i->m_firstLink.item.RenderFn == CVisibilityPlugins::RenderEntity )
    {
      pObj = i->m_firstLink.item.pObj;
      v7 = *(_QWORD *)((char *)i->m_firstLink.item.pObj + 28);
      pObj[7] = v7 & 0xFFFDFFFF;
      pObj[8] = HIDWORD(v7);
      (*(void (__fastcall **)(void *))(*(_DWORD *)i->m_firstLink.item.pObj + 72))(i->m_firstLink.item.pObj);
    }
  }
  for ( j = (CLinkList<CVisibilityPlugins::AlphaObjectInfo> *)CVisibilityPlugins::m_alphaUnderwaterEntityList.m_firstLink.m_pNext;
        j != (CLinkList<CVisibilityPlugins::AlphaObjectInfo> *)&CVisibilityPlugins::m_alphaUnderwaterEntityList.m_lastLink;
        j = (CLinkList<CVisibilityPlugins::AlphaObjectInfo> *)j->m_firstLink.m_pNext )
  {
    if ( j->m_firstLink.item.RenderFn == CVisibilityPlugins::RenderEntity )
    {
      v9 = j->m_firstLink.item.pObj;
      v10 = *(_QWORD *)((char *)j->m_firstLink.item.pObj + 28);
      v9[7] = v10 & 0xFFFDFFFF;
      v9[8] = HIDWORD(v10);
      (*(void (__fastcall **)(void *))(*(_DWORD *)j->m_firstLink.item.pObj + 72))(j->m_firstLink.item.pObj);
    }
  }
  if ( MobileSettings::settings[5].value != 2 )
    sub_193C7C();
}

//----- (0040FBC4) --------------------------------------------------------
void CRenderer::RenderRoads()
{
  int32 v0; // r5
  u_native v1; // r4

  RwRenderStateSet(rwRENDERSTATEFOGENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 2);
  DeActivateDirectional();
  SetAmbientColours();
  if ( CRenderer::ms_nNoOfVisibleEntities >= 1 )
  {
    v0 = 0;
    do
    {
      v1 = CRenderer::ms_aVisibleEntityPtrs[v0];
      if ( (*(_BYTE *)(v1 + 58) & 7) == 1 && HIBYTE(CModelInfo::ms_modelInfoPtrs[*(__int16 *)(v1 + 38)]->m_flags) << 31 )
      {
        if ( CPostEffects::IsVisionFXActive() )
        {
          CPostEffects::FilterFX_StoreAndSetDayNightBalance();
          (*(void (__fastcall **)(u_native))(*(_DWORD *)v1 + 76))(v1);
          CPostEffects::FilterFX_RestoreDayNightBalance();
        }
        else
        {
          (*(void (__fastcall **)(u_native))(*(_DWORD *)v1 + 76))(v1);
        }
      }
      ++v0;
    }
    while ( v0 < CRenderer::ms_nNoOfVisibleEntities );
  }
}
// 0: using guessed type int dword_0;

//----- (0040FC70) --------------------------------------------------------
void __fastcall CRenderer::RenderOneRoad(CEntity *pEntity)
{
  if ( CPostEffects::IsVisionFXActive() )
  {
    CPostEffects::FilterFX_StoreAndSetDayNightBalance();
    (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 19))(pEntity);
    sub_18CA30();
  }
  else
  {
    (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 19))(pEntity);
  }
}

//----- (0040FC9E) --------------------------------------------------------
void CRenderer::RenderFadingInEntities()
{
  RwRenderStateSet(rwRENDERSTATEFOGENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 2);
  DeActivateDirectional();
  SetAmbientColours();
  sub_18A804();
}
// 0: using guessed type int dword_0;

//----- (0040FCCA) --------------------------------------------------------
void CRenderer::RenderFadingInUnderwaterEntities()
{
  DeActivateDirectional();
  SetAmbientColours();
  sub_19C37C();
}

//----- (0040FCDE) --------------------------------------------------------
u_native __fastcall GetBufferID(CEntity *ent)
{
  RpAtomic_0 *m_pRwObject; // r0
  RpGeometry_0 *geometry; // r0
  bool v3; // zf

  m_pRwObject = (RpAtomic_0 *)ent->m_pRwObject;
  if ( !m_pRwObject )
    return 0;
  if ( m_pRwObject->object.object.type != 1 )
    m_pRwObject = GetFirstAtomic((RpClump_0 *)m_pRwObject);
  geometry = m_pRwObject->geometry;
  v3 = geometry == 0;
  if ( geometry )
  {
    geometry = (RpGeometry_0 *)geometry->repEntry;
    v3 = geometry == 0;
  }
  if ( v3 )
    return 0;
  else
    return sub_18C628((u_native)geometry->texCoords[1]);
}

//----- (0040FD08) --------------------------------------------------------
int __fastcall sortLODs(const void *A, const void *B)
{
  int v2; // r5
  RpClump_0 *FirstAtomic; // r0
  RwLLLink *next; // r0
  RwLLLink *prev; // r0
  u_native ID; // r4
  RpClump_0 *v7; // r0
  int v8; // r5
  RwLLLink *v9; // r0
  RwLLLink *v10; // r0
  u_native v11; // r0

  v2 = *(_DWORD *)B;
  FirstAtomic = *(RpClump_0 **)(*(_DWORD *)A + 24);
  if ( !FirstAtomic )
    goto LABEL_7;
  if ( FirstAtomic->object.type != 1 )
    FirstAtomic = (RpClump_0 *)GetFirstAtomic(FirstAtomic);
  next = FirstAtomic->cameraList.link.next;
  if ( next && (prev = next[11].prev) != 0 )
    ID = emu_ArraysGetID((u_native)prev[7].next);
  else
LABEL_7:
    ID = 0;
  v7 = *(RpClump_0 **)(v2 + 24);
  v8 = 0;
  if ( !v7 )
    goto LABEL_14;
  if ( v7->object.type != 1 )
    v7 = (RpClump_0 *)GetFirstAtomic(v7);
  v9 = v7->cameraList.link.next;
  if ( v9 && (v10 = v9[11].prev) != 0 )
    v11 = emu_ArraysGetID((u_native)v10[7].next);
  else
LABEL_14:
    v11 = 0;
  if ( ID < v11 )
    v8 = 1;
  if ( ID > v11 )
    return -1;
  return v8;
}

//----- (0040FD64) --------------------------------------------------------
void CRenderer::RenderEverythingBarRoads()
{
  int Mode; // r0
  bool v1; // zf
  int v2; // r8
  int32 v3; // r6
  u_native v4; // r4
  int v5; // r0
  float *v6; // r1
  int v7; // r1
  int v8; // r4
  u_native v9; // r0
  int32 v10; // r6
  u_native v11; // r4
  int v12; // r0
  float *v13; // r1
  int32 v14; // r5
  u_native v15; // r4
  int v16; // r0
  float *v17; // r1
  int v18; // r5
  u_native v19; // r6
  int v20; // r0
  int v21; // r0
  float *v22; // r1
  _BOOL4 inserted; // r0
  int v24; // r0
  float *v25; // r1
  _BOOL4 v26; // r4
  int *v27; // r1
  RwFrame_0 *parent; // r9
  float v29; // s16
  RwReal v30; // s2
  RwReal v31; // s4
  int32 v32; // r6
  RwReal v33; // s2
  RwReal v34; // s4

  RwRenderStateSet(rwRENDERSTATEFOGENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 2);
  if ( CGame::currArea == AREA_MAIN_MAP )
    RwRenderStateSet(rwRENDERSTATEALPHATESTFUNCTIONREF, &dword_8C);
  Mode = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
  v1 = Mode == 17;
  if ( Mode != 17 )
    v1 = Mode == 15;
  v2 = v1;
  if ( CRenderer::ms_nNoOfVisibleEntities >= 1 )
  {
    v3 = 0;
    do
    {
      v4 = CRenderer::ms_aVisibleEntityPtrs[v3];
      if ( (*(_BYTE *)(v4 + 58) & 7) == 3 && CPed::IsPlayer((const CPed *)CRenderer::ms_aVisibleEntityPtrs[v3]) )
      {
        if ( CVisibilityPlugins::GetClumpAlpha(*(RpClump_0 **)(v4 + 24)) == 255 )
          goto LABEL_16;
        v5 = *(_DWORD *)(v4 + 20);
        v6 = (float *)(v5 + 48);
        if ( !v5 )
          v6 = (float *)(v4 + 4);
        if ( !CVisibilityPlugins::InsertEntityIntoSortedList(
                (CEntity *)v4,
                sqrtf(
                  (float)((float)((float)(CRenderer::ms_vecCameraPosition.x - *v6)
                                * (float)(CRenderer::ms_vecCameraPosition.x - *v6))
                        + (float)((float)(CRenderer::ms_vecCameraPosition.y - v6[1])
                                * (float)(CRenderer::ms_vecCameraPosition.y - v6[1])))
                + (float)((float)(CRenderer::ms_vecCameraPosition.z - v6[2])
                        * (float)(CRenderer::ms_vecCameraPosition.z - v6[2])))) )
LABEL_16:
          CRenderer::RenderOneNonRoad((CEntity *)v4);
      }
      v7 = CRenderer::ms_nNoOfVisibleEntities;
      ++v3;
    }
    while ( v3 < CRenderer::ms_nNoOfVisibleEntities );
    if ( CRenderer::ms_nNoOfVisibleEntities >= 1 )
    {
      v8 = 0;
      do
      {
        v9 = CRenderer::ms_aVisibleEntityPtrs[v8];
        if ( (unsigned __int8)((*(_BYTE *)(v9 + 58) & 7) - 2) >= 3u
          && !(HIBYTE(CModelInfo::ms_modelInfoPtrs[*(__int16 *)(v9 + 38)]->m_flags) << 31) )
        {
          CRenderer::RenderOneNonRoad((CEntity *)v9);
          v7 = CRenderer::ms_nNoOfVisibleEntities;
        }
        ++v8;
      }
      while ( v8 < v7 );
      if ( v7 >= 1 )
      {
        v10 = 0;
        do
        {
          v11 = CRenderer::ms_aVisibleEntityPtrs[v10];
          if ( (*(_BYTE *)(v11 + 58) & 7) == 3 && !CPed::IsPlayer((const CPed *)CRenderer::ms_aVisibleEntityPtrs[v10]) )
          {
            if ( CVisibilityPlugins::GetClumpAlpha(*(RpClump_0 **)(v11 + 24)) == 255 )
              goto LABEL_32;
            v12 = *(_DWORD *)(v11 + 20);
            v13 = (float *)(v12 + 48);
            if ( !v12 )
              v13 = (float *)(v11 + 4);
            if ( !CVisibilityPlugins::InsertEntityIntoSortedList(
                    (CEntity *)v11,
                    sqrtf(
                      (float)((float)((float)(CRenderer::ms_vecCameraPosition.x - *v13)
                                    * (float)(CRenderer::ms_vecCameraPosition.x - *v13))
                            + (float)((float)(CRenderer::ms_vecCameraPosition.y - v13[1])
                                    * (float)(CRenderer::ms_vecCameraPosition.y - v13[1])))
                    + (float)((float)(CRenderer::ms_vecCameraPosition.z - v13[2])
                            * (float)(CRenderer::ms_vecCameraPosition.z - v13[2])))) )
LABEL_32:
              CRenderer::RenderOneNonRoad((CEntity *)v11);
          }
          ++v10;
        }
        while ( v10 < CRenderer::ms_nNoOfVisibleEntities );
        if ( CRenderer::ms_nNoOfVisibleEntities >= 1 )
        {
          v14 = 0;
          do
          {
            v15 = CRenderer::ms_aVisibleEntityPtrs[v14];
            if ( (*(_BYTE *)(v15 + 58) & 7) == 4 )
            {
              if ( v2 != 1 )
                goto LABEL_41;
              v16 = *(_DWORD *)(v15 + 20);
              v17 = (float *)(v16 + 48);
              if ( !v16 )
                v17 = (float *)(v15 + 4);
              if ( !CVisibilityPlugins::InsertEntityIntoSortedList(
                      (CEntity *)CRenderer::ms_aVisibleEntityPtrs[v14],
                      sqrtf(
                        (float)((float)((float)(CRenderer::ms_vecCameraPosition.x - *v17)
                                      * (float)(CRenderer::ms_vecCameraPosition.x - *v17))
                              + (float)((float)(CRenderer::ms_vecCameraPosition.y - v17[1])
                                      * (float)(CRenderer::ms_vecCameraPosition.y - v17[1])))
                      + (float)((float)(CRenderer::ms_vecCameraPosition.z - v17[2])
                              * (float)(CRenderer::ms_vecCameraPosition.z - v17[2])))) )
LABEL_41:
                CRenderer::RenderOneNonRoad((CEntity *)v15);
            }
            ++v14;
          }
          while ( v14 < CRenderer::ms_nNoOfVisibleEntities );
          if ( CRenderer::ms_nNoOfVisibleEntities >= 1 )
          {
            v18 = 0;
            while ( 1 )
            {
              v19 = CRenderer::ms_aVisibleEntityPtrs[v18];
              if ( (*(_BYTE *)(v19 + 58) & 7) == 2 )
                break;
LABEL_61:
              if ( ++v18 >= CRenderer::ms_nNoOfVisibleEntities )
                goto LABEL_62;
            }
            if ( *(_DWORD *)(v19 + 1440) == 5 )
            {
              v20 = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
              if ( v20 == 14
                || v20 == 16 && CCamera::GetLookDirection(&TheCamera) != 3 && CCamera::GetLookDirection(&TheCamera)
                || CVisibilityPlugins::GetClumpAlpha(*(RpClump_0 **)(v19 + 24)) != 255 )
              {
                goto LABEL_52;
              }
            }
            else if ( (*(_BYTE *)(v19 + 71) & 8) == 0 )
            {
LABEL_52:
              v21 = *(_DWORD *)(v19 + 20);
              v22 = (float *)(v21 + 48);
              if ( !v21 )
                v22 = (float *)(v19 + 4);
              inserted = CVisibilityPlugins::InsertEntityIntoSortedList(
                           (CEntity *)v19,
                           sqrtf(
                             (float)((float)((float)(CRenderer::ms_vecCameraPosition.x - *v22)
                                           * (float)(CRenderer::ms_vecCameraPosition.x - *v22))
                                   + (float)((float)(CRenderer::ms_vecCameraPosition.y - v22[1])
                                           * (float)(CRenderer::ms_vecCameraPosition.y - v22[1])))
                           + (float)((float)(CRenderer::ms_vecCameraPosition.z - v22[2])
                                   * (float)(CRenderer::ms_vecCameraPosition.z - v22[2]))));
LABEL_59:
              if ( !inserted )
                CRenderer::RenderOneNonRoad((CEntity *)v19);
              goto LABEL_61;
            }
            v24 = *(_DWORD *)(v19 + 20);
            v25 = (float *)(v24 + 48);
            if ( !v24 )
              v25 = (float *)(v19 + 4);
            inserted = CVisibilityPlugins::InsertEntityIntoUnderwaterList(
                         (CEntity *)v19,
                         sqrtf(
                           (float)((float)((float)(CRenderer::ms_vecCameraPosition.x - *v25)
                                         * (float)(CRenderer::ms_vecCameraPosition.x - *v25))
                                 + (float)((float)(CRenderer::ms_vecCameraPosition.y - v25[1])
                                         * (float)(CRenderer::ms_vecCameraPosition.y - v25[1])))
                         + (float)((float)(CRenderer::ms_vecCameraPosition.z - v25[2])
                                 * (float)(CRenderer::ms_vecCameraPosition.z - v25[2]))));
            goto LABEL_59;
          }
        }
      }
    }
  }
LABEL_62:
  v26 = RQCaps[0];
  RwCameraEndUpdate(Scene.camera);
  v27 = dword_4102EC;
  parent = (RwFrame_0 *)Scene.camera->object.object.parent;
  if ( v26 )
    v27 = &dword_4102EC[1];
  v29 = *(float *)v27;
  v30 = parent->modelling.pos.y - (float)(*(float *)v27 * parent->modelling.at.y);
  v31 = parent->modelling.pos.z - (float)(*(float *)v27 * parent->modelling.at.z);
  parent->modelling.pos.x = parent->modelling.pos.x - (float)(*(float *)v27 * parent->modelling.at.x);
  parent->modelling.pos.y = v30;
  parent->modelling.pos.z = v31;
  RwMatrixUpdate(&parent->modelling);
  RwFrameUpdateObjects(parent);
  RwFrameOrthoNormalize(parent);
  RwCameraBeginUpdate(Scene.camera);
  qsort(CRenderer::ms_aVisibleLodPtrs, CRenderer::ms_nNoOfVisibleLods, 4u, sortLODs);
  if ( CRenderer::ms_nNoOfVisibleLods >= 1 )
  {
    v32 = 0;
    do
      CRenderer::RenderOneNonRoad((CEntity *)CRenderer::ms_aVisibleLodPtrs[v32++]);
    while ( v32 < CRenderer::ms_nNoOfVisibleLods );
  }
  RwCameraEndUpdate(Scene.camera);
  v33 = parent->modelling.pos.y + (float)(v29 * parent->modelling.at.y);
  v34 = parent->modelling.pos.z + (float)(v29 * parent->modelling.at.z);
  parent->modelling.pos.x = parent->modelling.pos.x + (float)(v29 * parent->modelling.at.x);
  parent->modelling.pos.y = v33;
  parent->modelling.pos.z = v34;
  RwMatrixUpdate(&parent->modelling);
  RwFrameUpdateObjects(parent);
  RwFrameOrthoNormalize(parent);
  sub_1992E8(Scene.camera);
}
// 0: using guessed type int dword_0;
// 54: using guessed type int dword_54;
// 8C: using guessed type int dword_8C;
// 4102EC: using guessed type int dword_4102EC[2];

//----- (0041030C) --------------------------------------------------------
void __fastcall CRenderer::RenderOneNonRoad(CEntity *pEntity)
{
  int v2; // r0
  bool v3; // zf
  int v4; // r5
  int m_nFlags; // r0
  CEntity::CFlags *p_m_nFlags; // r6
  CEntity::CFlags v7; // r0

  v2 = *(_BYTE *)&pEntity->m_info & 7;
  v3 = v2 == 3;
  if ( v2 == 3 )
    v3 = pEntity[18].m_pMat == (CMatrix *)&word_32;
  if ( !v3 )
  {
    v4 = (*((int (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 20))(pEntity);
    if ( (*(_BYTE *)&pEntity->m_info & 7) == 2 )
    {
      CVisibilityPlugins::SetupVehicleVariables((RpClump_0 *)pEntity->m_pRwObject);
      CVisibilityPlugins::InitAlphaAtomicList();
      CVehicle::RenderDriverAndPassengers((CVehicle *)pEntity);
      CVehicle::SetupRender((CVehicle *)pEntity);
    }
    else if ( (*((_BYTE *)&pEntity->m_nFlags + 3) & 8) == 0 )
    {
      RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 1);
    }
    if ( CPostEffects::IsVisionFXActive() )
    {
      if ( CPostEffects::m_bNightVision )
        CPostEffects::NightVisionSetLights();
      if ( CPostEffects::m_bInfraredVision )
        CPostEffects::InfraredVisionSetLightsForDefaultObjects();
      CPostEffects::FilterFX_StoreAndSetDayNightBalance();
      (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 19))(pEntity);
      CPostEffects::FilterFX_RestoreDayNightBalance();
    }
    else
    {
      (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 19))(pEntity);
    }
    p_m_nFlags = &pEntity->m_nFlags;
    m_nFlags = (int)pEntity->m_nFlags;
    if ( (*(_BYTE *)&pEntity->m_info & 7) == 2 )
    {
      v7.bdummy = pEntity->m_nFlags.bdummy;
      *(_DWORD *)&v7 = m_nFlags | 0x2000;
      *p_m_nFlags = v7;
      CVisibilityPlugins::RenderAlphaAtomics();
      *(_DWORD *)p_m_nFlags &= ~0x2000u;
      CVehicle::ResetAfterRender((CVehicle *)pEntity);
    }
    else if ( (m_nFlags & 0x8000000) == 0 )
    {
      RwRenderStateSet(rwRENDERSTATECULLMODE, (char *)&dword_0 + 2);
    }
    (*((void (__fastcall **)(CEntity *, int))pEntity->_vptr$CPlaceable + 21))(pEntity, v4);
  }
}
// 0: using guessed type int dword_0;
// 32: using guessed type __int16 word_32;

//----- (00410404) --------------------------------------------------------
void CRenderer::RenderFirstPersonVehicle()
{
  RwRenderState_0 v0; // r0

  if ( CRenderer::m_pFirstPersonVehicle )
  {
    if ( CWorld::Players[0].pPed->m_WeaponSlots[CWorld::Players[0].pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_MICRO_UZI )
    {
      RwRenderStateSet(rwRENDERSTATEALPHATESTFUNCTIONREF, &dword_50);
      RwRenderStateSet(rwRENDERSTATEFOGENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
      RwRenderStateSet(rwRENDERSTATEDESTBLEND, &byte_6);
      CRenderer::RenderOneNonRoad(CRenderer::m_pFirstPersonVehicle);
      RwRenderStateSet(rwRENDERSTATEFOGENABLE, 0);
      v0 = rwRENDERSTATEALPHATESTFUNCTIONREF;
    }
    else
    {
      RwRenderStateSet(rwRENDERSTATEFOGENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
      RwRenderStateSet(rwRENDERSTATEDESTBLEND, &byte_6);
      CRenderer::RenderOneNonRoad(CRenderer::m_pFirstPersonVehicle);
      v0 = rwRENDERSTATEFOGENABLE;
    }
    sub_192840(v0, 0);
  }
}
// 0: using guessed type int dword_0;
// 5: using guessed type char byte_5;
// 6: using guessed type char byte_6;
// 50: using guessed type int dword_50;

//----- (004104DC) --------------------------------------------------------
bool __fastcall CEntity::SetupLighting(CEntity *this)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r0
  float LightsAffectingObject; // r0

  if ( (*((_BYTE *)&this->m_nFlags + 3) & 0x10) == 0 )
    return 0;
  ActivateDirectional();
  m_pMat = this->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &this->m_transform;
  LightsAffectingObject = CPointLights::GenerateLightsAffectingObject(&p_tx->m_translate, 0, this);
  SetLightColoursForPedsCarsAndObjects(LightsAffectingObject * 0.5);
  return 1;
}

//----- (0041051C) --------------------------------------------------------
void __fastcall CEntity::RemoveLighting(CEntity *this, bool reset)
{
  if ( reset )
  {
    SetAmbientColours();
    DeActivateDirectional();
    sub_1919D0();
  }
}

//----- (00410538) --------------------------------------------------------
bool __fastcall CObject::SetupLighting(CObject *this)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v4; // d16
  float v5; // r6
  bool v6; // r5
  float v7; // r4
  CVector v9; // [sp+0h] [bp-20h] BYREF

  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) != 0 )
  {
    WorldReplaceNormalLightsWithScorched(Scene.world, 0.18);
    return 1;
  }
  if ( (*((_BYTE *)&this->m_nFlags + 3) & 0x10) == 0 )
    return 0;
  ActivateDirectional();
  CCarFXRenderer::SetFxEnvMapLightMult(1.0);
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) != 0 )
  {
    WorldReplaceNormalLightsWithScorched(Scene.world, 0.18);
    return 0;
  }
  m_pMat = this->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &this->m_transform;
  v4 = *(_QWORD *)&p_tx->m_translate.x;
  v9.z = p_tx->m_translate.z;
  *(_QWORD *)&v9.x = v4;
  this->m_lightingFromPointLights = 0.0;
  v5 = CPointLights::GenerateLightsAffectingObject(&v9, &this->m_lightingFromPointLights, this);
  v6 = 1;
  v7 = v5 * (float)((float)(CPhysical::GetLightingFromCol(this, 1) * 0.95) + 0.05);
  CCarFXRenderer::SetFxEnvMapLightMult(v7);
  SetLightColoursForPedsCarsAndObjects(v7);
  return v6;
}

//----- (00410614) --------------------------------------------------------
void __fastcall CObject::RemoveLighting(CObject *this, bool reset)
{
  if ( reset )
  {
    if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) == 0 )
      CPointLights::RemoveLightsAffectingObject();
    SetAmbientColours();
    sub_18FE08();
  }
}

//----- (00410636) --------------------------------------------------------
void __fastcall CRenderer::RemoveVehiclePedLights(CPhysical *pEntity, bool ResetColours)
{
  if ( (*((_BYTE *)&pEntity->m_nPhysicalFlags + 3) & 0x20) == 0 )
    sub_1919D0();
}

//----- (00410644) --------------------------------------------------------
bool __fastcall CPed::SetupLighting(CPed *this)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v4; // d16
  float v5; // r6
  bool v6; // r5
  float v7; // r4
  CVector v9; // [sp+0h] [bp-20h] BYREF

  ActivateDirectional();
  CCarFXRenderer::SetFxEnvMapLightMult(1.0);
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) != 0 )
  {
    WorldReplaceNormalLightsWithScorched(Scene.world, 0.18);
    return 0;
  }
  else
  {
    m_pMat = this->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    v4 = *(_QWORD *)&p_tx->m_translate.x;
    v9.z = p_tx->m_translate.z;
    *(_QWORD *)&v9.x = v4;
    this->m_lightingFromPointLights = 0.0;
    v5 = CPointLights::GenerateLightsAffectingObject(&v9, &this->m_lightingFromPointLights, this);
    v6 = 1;
    v7 = v5 * (float)((float)(CPhysical::GetLightingFromCol(this, 1) * 0.95) + 0.05);
    CCarFXRenderer::SetFxEnvMapLightMult(v7);
    SetLightColoursForPedsCarsAndObjects(v7);
  }
  return v6;
}

//----- (004106F4) --------------------------------------------------------
void __fastcall CPed::RemoveLighting(CPed *this, bool reset)
{
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) == 0 )
    CPointLights::RemoveLightsAffectingObject();
  SetAmbientColours();
  sub_18FE08();
}

//----- (00410710) --------------------------------------------------------
bool __fastcall CVehicle::SetupLighting(CVehicle *this)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v4; // d16
  float v5; // r6
  bool v6; // r5
  float v7; // r4
  CVector v9; // [sp+0h] [bp-20h] BYREF

  ActivateDirectional();
  CCarFXRenderer::SetFxEnvMapLightMult(1.0);
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) != 0 )
  {
    WorldReplaceNormalLightsWithScorched(Scene.world, 0.18);
    return 0;
  }
  else
  {
    m_pMat = this->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    v4 = *(_QWORD *)&p_tx->m_translate.x;
    v9.z = p_tx->m_translate.z;
    *(_QWORD *)&v9.x = v4;
    this->m_lightingFromPointLights = 0.0;
    v5 = CPointLights::GenerateLightsAffectingObject(&v9, &this->m_lightingFromPointLights, this);
    v6 = 1;
    v7 = v5 * (float)((float)(CPhysical::GetLightingFromCol(this, 1) * 0.95) + 0.05);
    CCarFXRenderer::SetFxEnvMapLightMult(v7);
    SetLightColoursForPedsCarsAndObjects(v7);
  }
  return v6;
}

//----- (004107C0) --------------------------------------------------------
void __fastcall CVehicle::RemoveLighting(CVehicle *this, bool reset)
{
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) == 0 )
    CPointLights::RemoveLightsAffectingObject();
  SetAmbientColours();
  sub_18FE08();
}

//----- (004107DC) --------------------------------------------------------
bool __fastcall CCutsceneObject::SetupLighting(CCutsceneObject *this)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v4; // d16
  float v5; // r6
  bool v6; // r5
  float v7; // r4
  CVector v9; // [sp+0h] [bp-20h] BYREF

  ActivateDirectional();
  CCarFXRenderer::SetFxEnvMapLightMult(1.0);
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) != 0 )
  {
    WorldReplaceNormalLightsWithScorched(Scene.world, 0.18);
    return 0;
  }
  else
  {
    m_pMat = this->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    v4 = *(_QWORD *)&p_tx->m_translate.x;
    v9.z = p_tx->m_translate.z;
    *(_QWORD *)&v9.x = v4;
    this->m_lightingFromPointLights = 0.0;
    v5 = CPointLights::GenerateLightsAffectingObject(&v9, &this->m_lightingFromPointLights, this);
    v6 = 1;
    v7 = v5 * (float)((float)(CPhysical::GetLightingFromCol(this, 1) * 0.95) + 0.05);
    CCarFXRenderer::SetFxEnvMapLightMult(v7);
    SetLightColoursForPedsCarsAndObjects(v7);
  }
  return v6;
}

//----- (0041088C) --------------------------------------------------------
void __fastcall CCutsceneObject::RemoveLighting(CCutsceneObject *this, bool reset)
{
  if ( (*((_BYTE *)&this->m_nPhysicalFlags + 3) & 0x20) == 0 )
    CPointLights::RemoveLightsAffectingObject();
  SetAmbientColours();
  sub_18FE08();
}

//----- (004108A8) --------------------------------------------------------
float __fastcall CalcNewDelta(RwV2d_0 *pStartPoint, RwV2d_0 *pEndPoint)
{
  return (float)(pEndPoint->x - pStartPoint->x) / (float)(pEndPoint->y - pStartPoint->y);
}

//----- (004108CA) --------------------------------------------------------
void __fastcall LimitFrustumVector(CVector *vec, const CVector *origin, float minZ)
{
  float z; // s4
  float v4; // s10
  float v5; // s12
  RwReal v6; // s2

  z = origin->z;
  v4 = vec->z - z;
  v5 = (float)(minZ - z) / v4;
  v6 = origin->y + (float)(v5 * (float)(vec->y - origin->y));
  vec->x = origin->x + (float)(v5 * (float)(vec->x - origin->x));
  vec->y = v6;
  vec->z = z + (float)(v4 * v5);
}

//----- (00410920) --------------------------------------------------------
void __fastcall CRenderer::ScanSectorList(Int32 BlockX, Int32 BlockY)
{
  Int32 v3; // r4
  float v4; // s0
  float v5; // s2
  _BOOL4 v6; // r0
  float v7; // r0
  int v8; // r1
  bool v9; // cc
  int v10; // r0
  CRepeatSector *v11; // r1
  CRepeatSector *v12; // r0
  Int32 v13; // r0
  CSector *v14; // r0
  int p_m_dummyPtrListArray; // r1
  CRepeatSector *v16; // r3
  int v17; // r10
  int *v18; // r9
  CSector *v19; // t1
  CPtrNode *m_pHead; // r11
  CPtrNode v21; // kr00_8
  int v22; // r1
  _DWORD *v23; // r5
  CBaseModelInfo *v24; // r0
  int v25; // r0
  int v26; // r1
  float *v27; // r0
  float v28; // s2
  float v29; // s0
  float v30; // s2
  int32 v31; // r0
  float v32; // s0
  CBaseModelInfo *v33; // r0
  _BOOL4 v34; // r0
  bool v35; // zf
  _BOOL4 v36; // r0
  int32 *v37; // r1
  u_native *v38; // r2
  int32 v39; // r0
  _BOOL4 v40; // [sp+2Ch] [bp-54h]
  float dist[13]; // [sp+4Ch] [bp-34h] BYREF

  v3 = BlockX;
  v4 = (float)((float)((float)(BlockY - 60) * 50.0) + 25.0) - CRenderer::ms_vecCameraPosition.y;
  v5 = (float)((float)((float)(BlockX - 60) * 50.0) + 25.0) - CRenderer::ms_vecCameraPosition.x;
  if ( (float)((float)(v5 * v5) + (float)(v4 * v4)) >= 10000.0 )
  {
    v7 = atan2f(
           -(float)((float)((float)((float)(BlockX - 60) * 50.0) + 25.0) - CRenderer::ms_vecCameraPosition.x),
           (float)((float)((float)(BlockY - 60) * 50.0) + 25.0) - CRenderer::ms_vecCameraPosition.y);
    v6 = COERCE_FLOAT(COERCE_UNSIGNED_INT(CGeneral::LimitRadianAngle(v7 - CRenderer::ms_fCameraHeading)) & 0x7FFFFFFF) < 0.36;
  }
  else
  {
    v6 = 1;
  }
  v40 = v6;
  v8 = v3 & 0xF | (16 * (BlockY & 0xF));
  v9 = BlockY <= 119;
  if ( BlockY <= 119 )
    v9 = v3 <= 119;
  v10 = v8;
  v11 = &CWorld::ms_aRepeatSectors[v8];
  if ( v9 && (BlockY | v3) >= 0 )
  {
    v12 = &CWorld::ms_aRepeatSectors[v10];
    PC_Scratch[1] = (int)&v12->m_ptrListArray[2];
    PC_Scratch[2] = (int)v11;
    PC_Scratch[3] = (int)&v12->m_ptrListArray[1];
    v13 = 0;
    if ( v3 <= 0 )
      v3 = 0;
    if ( v3 >= 119 )
      v3 = 119;
    if ( BlockY > 0 )
      v13 = BlockY;
    if ( v13 >= 119 )
      v13 = 119;
    v14 = &CWorld::ms_aSectors[120 * v13 + v3];
    PC_Scratch[0] = (int)v14;
    p_m_dummyPtrListArray = (int)&v14->m_dummyPtrListArray;
  }
  else
  {
    v16 = &CWorld::ms_aRepeatSectors[v10];
    v14 = 0;
    PC_Scratch[0] = 0;
    PC_Scratch[1] = (int)&v16->m_ptrListArray[2];
    PC_Scratch[2] = (int)v11;
    PC_Scratch[3] = (int)&v16->m_ptrListArray[1];
    p_m_dummyPtrListArray = 0;
  }
  v17 = 4;
  v18 = PC_Scratch;
  PC_Scratch[4] = p_m_dummyPtrListArray;
  if ( v14 )
  {
LABEL_22:
    m_pHead = v14->m_buildingPtrListArray.m_pHead;
    while ( 1 )
    {
      do
      {
LABEL_24:
        if ( !m_pHead )
          goto LABEL_64;
        v21 = *m_pHead;
        m_pHead = m_pHead->m_pNext;
      }
      while ( *((unsigned __int16 *)v21.m_pVoid + 24) == CWorld::ms_nCurrentScanCode );
      v23 = (char *)v21.m_pVoid + 28;
      v22 = *((_DWORD *)v21.m_pVoid + 7);
      *((_WORD *)v21.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
      *((_DWORD *)v21.m_pVoid + 7) = v22 & 0xFFFDFFFF;
      switch ( CRenderer::SetupEntityVisibility((CEntity *)v21.m_pVoid, dist) )
      {
        case ENTITY_INVISIBLE:
          if ( (*((_BYTE *)v21.m_pVoid + 58) & 7) == 4 )
          {
            v24 = CModelInfo::ms_modelInfoPtrs[*((__int16 *)v21.m_pVoid + 19)];
            v25 = (*((int (__fastcall **)(CBaseModelInfo *))v24->_vptr$CBaseModelInfo + 2))(v24);
            if ( v25 )
            {
              if ( (*(_WORD *)(v25 + 40) & 0x7000 | 0x800) == 10240 )
                goto LABEL_30;
            }
          }
          goto LABEL_24;
        case ENTITY_VISIBLE:
          v32 = dist[0];
          v33 = CModelInfo::ms_modelInfoPtrs[*((__int16 *)v21.m_pVoid + 19)];
          v33->m_flags &= ~1u;
          if ( (*v23 & 0x8000) != 0 )
          {
            if ( !CVisibilityPlugins::InsertEntityIntoSortedList((CEntity *)v21.m_pVoid, v32) )
              goto LABEL_55;
          }
          else if ( (*v23 & 0x4000) != 0 && CVisibilityPlugins::InsertEntityIntoSortedList((CEntity *)v21.m_pVoid, v32) )
          {
            *v23 &= ~0x8000u;
          }
          else
          {
LABEL_55:
            if ( !*((_BYTE *)v21.m_pVoid + 56) || (*((_BYTE *)v21.m_pVoid + 30) & 0x10) != 0 )
            {
              v37 = &CRenderer::ms_nNoOfVisibleEntities;
              v38 = CRenderer::ms_aVisibleEntityPtrs;
              v39 = CRenderer::ms_nNoOfVisibleEntities;
            }
            else
            {
              v37 = &CRenderer::ms_nNoOfVisibleLods;
              v38 = CRenderer::ms_aVisibleLodPtrs;
              v39 = CRenderer::ms_nNoOfVisibleLods;
            }
            v38[v39] = (u_native)v21.m_pVoid;
            *v37 = v39 + 1;
          }
          goto LABEL_24;
        case ENTITY_OFFSCREEN:
LABEL_30:
          v35 = (*v23 & 0x200000) == 0;
          *v23 |= 0x20000u;
          if ( !v35 )
          {
            v26 = *((_DWORD *)v21.m_pVoid + 5);
            v27 = (float *)(v26 + 48);
            if ( !v26 )
              v27 = (float *)((char *)v21.m_pVoid + 4);
            v28 = CRenderer::ms_vecCameraPosition.x - *v27;
            v29 = 30.0;
            if ( (*((_BYTE *)v21.m_pVoid + 58) & 7) == 2 )
            {
              v29 = 200.0;
              if ( !(*((unsigned __int8 *)v21.m_pVoid + 1073) << 31) )
                v29 = 30.0;
            }
            if ( v28 > (float)-v29 && v28 < v29 )
            {
              v30 = CRenderer::ms_vecCameraPosition.y - v27[1];
              if ( v30 > (float)-v29 && v30 < v29 )
              {
                v31 = CRenderer::ms_nNoOfInVisibleEntities;
                if ( CRenderer::ms_nNoOfInVisibleEntities <= 148 )
                {
                  CRenderer::ms_aInVisibleEntityPtrs[CRenderer::ms_nNoOfInVisibleEntities] = (u_native)v21.m_pVoid;
                  CRenderer::ms_nNoOfInVisibleEntities = v31 + 1;
                }
              }
            }
          }
          goto LABEL_24;
        case ENTITY_STREAM_MODEL:
          if ( CStreaming::ms_disableStreaming )
            goto LABEL_24;
          v34 = CEntity::GetIsOnScreen((CEntity *)v21.m_pVoid);
          v35 = v34;
          if ( v34 )
            v35 = !CRenderer::ms_bInTheSky;
          if ( !v35 )
            goto LABEL_24;
          v36 = v40;
          if ( CStreaming::ms_aInfoForModel[*((__int16 *)v21.m_pVoid + 19)].m_status == 1 )
            goto LABEL_60;
          if ( !CEntity::IsEntityOccluded((CEntity *)v21.m_pVoid) && v40 )
          {
            CRenderer::m_loadingPriority = 1;
            goto LABEL_63;
          }
          v36 = 0;
LABEL_60:
          if ( v36 || !CRenderer::m_loadingPriority || CStreaming::ms_numModelsRequested <= 0 )
LABEL_63:
            CStreaming::RequestModel(*((__int16 *)v21.m_pVoid + 19), 0);
          break;
        default:
          goto LABEL_24;
      }
    }
  }
LABEL_64:
  while ( v17 )
  {
    v19 = (CSector *)v18[1];
    ++v18;
    v14 = v19;
    --v17;
    if ( v19 )
      goto LABEL_22;
  }
}
// 676210: using guessed type int CRenderer::ms_nNoOfVisibleLods;
// 676474: using guessed type int (*CRenderer::ms_aVisibleLodPtrs)[1000];
// 6771F0: using guessed type int *CRenderer::ms_nNoOfVisibleEntities;
// 6778EC: using guessed type int (*CRenderer::ms_aVisibleEntityPtrs)[1000];
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];
// 410920: using guessed type float dist[13];

//----- (00410DBC) --------------------------------------------------------
void __fastcall CRenderer::ScanBigBuildingList(Int32 BlockX, Int32 BlockY)
{
  __int64 v2; // d8
  bool v3; // cc
  int v4; // r8
  CPtrNode *m_pHead; // r6
  float v6; // s0
  float v7; // s2
  float v8; // r0
  __int16 *m_pVoid; // r5
  CRenderer::VisibilityState v10; // r0
  int v11; // r0
  CBaseModelInfo *v12; // r0
  float v13; // s0
  int v14; // r0
  _DWORD *v15; // r10
  int32 *v16; // r1
  u_native *v17; // r2
  int32 v18; // r0
  float dist; // [sp+14h] [bp-34h] BYREF
  __int64 v20; // [sp+18h] [bp-30h]

  v3 = BlockY <= 29;
  if ( BlockY <= 29 )
    v3 = BlockX <= 29;
  if ( v3 && (BlockY | BlockX) >= 0 )
  {
    v20 = v2;
    v4 = 0;
    m_pHead = CWorld::ms_aLodPtrLists[30 * BlockY + BlockX].m_pHead;
    v6 = (float)((float)((float)(BlockY - 15) * 200.0) + 100.0) - CRenderer::ms_vecCameraPosition.y;
    v7 = (float)((float)((float)(BlockX - 15) * 200.0) + 100.0) - CRenderer::ms_vecCameraPosition.x;
    if ( (float)((float)(v7 * v7) + (float)(v6 * v6)) >= 80000.0 )
    {
      v8 = atan2f(
             -(float)((float)((float)((float)(BlockX - 15) * 200.0) + 100.0) - CRenderer::ms_vecCameraPosition.x),
             v6);
      if ( COERCE_FLOAT(COERCE_UNSIGNED_INT(CGeneral::LimitRadianAngle(v8 - CRenderer::ms_fCameraHeading)) & 0x7FFFFFFF) > 0.7 )
        v4 = 1;
    }
    if ( m_pHead )
    {
      while ( 1 )
      {
        m_pVoid = (__int16 *)m_pHead->m_pVoid;
        if ( *((unsigned __int16 *)m_pHead->m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
          break;
LABEL_28:
        m_pHead = m_pHead->m_pNext;
        if ( !m_pHead )
          return;
      }
      m_pVoid[24] = CWorld::ms_nCurrentScanCode;
      v10 = CRenderer::SetupBigBuildingVisibility((CEntity *)m_pVoid, &dist);
      if ( v10 != ENTITY_VISIBLE )
      {
        if ( v10 == ENTITY_STREAM_MODEL )
        {
          v11 = CStreaming::ms_disableStreaming;
          if ( CStreaming::ms_disableStreaming )
            v11 = 1;
          if ( !(v11 | v4) )
            CStreaming::RequestModel(m_pVoid[19], 0);
        }
        goto LABEL_28;
      }
      v12 = CModelInfo::ms_modelInfoPtrs[m_pVoid[19]];
      v13 = dist + 0.01;
      v12->m_flags &= ~1u;
      v15 = m_pVoid + 14;
      v14 = *((_DWORD *)m_pVoid + 7);
      if ( (v14 & 0x8000) != 0 )
      {
        if ( CVisibilityPlugins::InsertEntityIntoSortedList((CEntity *)m_pVoid, v13) )
          goto LABEL_27;
      }
      else if ( (v14 & 0x4000) != 0 && CVisibilityPlugins::InsertEntityIntoSortedList((CEntity *)m_pVoid, v13) )
      {
        *v15 &= ~0x8000u;
LABEL_27:
        *v15 &= ~0x20000u;
        goto LABEL_28;
      }
      if ( !*((_BYTE *)m_pVoid + 56) || (m_pVoid[15] & 0x10) != 0 )
      {
        v16 = &CRenderer::ms_nNoOfVisibleEntities;
        v17 = CRenderer::ms_aVisibleEntityPtrs;
      }
      else
      {
        v16 = &CRenderer::ms_nNoOfVisibleLods;
        v17 = CRenderer::ms_aVisibleLodPtrs;
      }
      v18 = *v16;
      v17[*v16] = (u_native)m_pVoid;
      *v16 = v18 + 1;
      goto LABEL_27;
    }
  }
}
// 410DDA: variable 'v2' is possibly undefined
// 676210: using guessed type int CRenderer::ms_nNoOfVisibleLods;
// 676474: using guessed type int (*CRenderer::ms_aVisibleLodPtrs)[1000];
// 6771F0: using guessed type int *CRenderer::ms_nNoOfVisibleEntities;
// 6778EC: using guessed type int (*CRenderer::ms_aVisibleEntityPtrs)[1000];

//----- (00410FE8) --------------------------------------------------------
void __fastcall CRenderer::AddEntityToRenderList(CEntity *pEntity, float dist)
{
  CBaseModelInfo *v3; // r0
  int m_nFlags; // r0
  int *v5; // r0
  int (**v6)[1000]; // r1
  int *v7; // r0
  int v8; // r2

  v3 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  v3->m_flags &= ~1u;
  m_nFlags = (int)pEntity->m_nFlags;
  if ( (m_nFlags & 0x8000) != 0 )
  {
    if ( CVisibilityPlugins::InsertEntityIntoSortedList(pEntity, dist) )
      return;
  }
  else if ( (m_nFlags & 0x4000) != 0 && CVisibilityPlugins::InsertEntityIntoSortedList(pEntity, dist) )
  {
    *(_DWORD *)&pEntity->m_nFlags &= ~0x8000u;
    return;
  }
  if ( !pEntity->numLodChildren || (*((_BYTE *)&pEntity->m_nFlags + 2) & 0x10) != 0 )
  {
    v5 = (int *)&CRenderer::ms_nNoOfVisibleEntities;
    v6 = &CRenderer::ms_aVisibleEntityPtrs;
  }
  else
  {
    v5 = &CRenderer::ms_nNoOfVisibleLods;
    v6 = &CRenderer::ms_aVisibleLodPtrs;
  }
  v7 = (int *)*v5;
  v8 = *v7;
  (**v6)[*v7] = (int)pEntity;
  *v7 = v8 + 1;
}
// 676210: using guessed type int CRenderer::ms_nNoOfVisibleLods;
// 676474: using guessed type int (*CRenderer::ms_aVisibleLodPtrs)[1000];
// 6771F0: using guessed type int *CRenderer::ms_nNoOfVisibleEntities;
// 6778EC: using guessed type int (*CRenderer::ms_aVisibleEntityPtrs)[1000];

//----- (00411078) --------------------------------------------------------
CRenderer::VisibilityState __fastcall CRenderer::SetupEntityVisibility(CEntity *pEntity, float *dist)
{
  CBaseModelInfo *v4; // r5
  int v5; // r6
  int m_nFlags; // r0
  int v7; // r0
  bool v8; // zf
  int v9; // r0
  int v10; // r0
  int v11; // r6
  int DirectionWasLooking; // r5
  int m_nModelIndex; // r1
  CRenderer::VisibilityState result; // r0
  bool v15; // zf
  int v16; // r0
  bool v17; // r3
  int m_areaCode; // r0
  CEntity *m_pLod; // r1
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r6
  float32x2_t v22; // d16
  unsigned __int64 v23; // d1
  float v24; // s0
  float v25; // s2
  CMatrix *v26; // r1
  CSimpleTransform *p_m_transform; // r2
  CEntity::CFlags *p_m_nFlags; // r5
  int v29; // r0
  CEntity::CFlags v30; // r0
  CSimpleTransform *v31; // r2
  float v32; // s0
  float v33; // s2
  CBaseModelInfo *v34; // r0
  float v35; // s4
  float v36; // s0
  int *v37; // r0
  int (**v38)[1000]; // r1
  int *v39; // r0
  int v40; // r2

  v4 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  v5 = (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 2))(v4);
  if ( (*(_BYTE *)&pEntity->m_info & 7) == 2 )
  {
    m_nFlags = (int)pEntity->m_nFlags;
    if ( m_nFlags >= 0 )
    {
      v7 = m_nFlags & 0x40000000;
      if ( v7 )
      {
        if ( !CRenderer::ms_bRenderTunnels )
          return 0;
      }
      v8 = !CRenderer::ms_bRenderOutsideTunnels;
      if ( !CRenderer::ms_bRenderOutsideTunnels )
        v8 = v7 == 0;
      if ( v8 )
        return 0;
    }
  }
  v9 = (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 5))(v4);
  if ( v5 )
  {
    if ( v9 == 3 )
    {
      v10 = (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 6))(v4);
      v11 = *(unsigned __int16 *)(v10 + 2);
      if ( !CClock::GetIsTimeInRange(*(_BYTE *)v10, *(_BYTE *)(v10 + 1)) )
      {
        if ( v11 == 0xFFFF || CModelInfo::ms_modelInfoPtrs[(__int16)v11]->m_pRwObject )
        {
          (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 9))(pEntity);
          return 0;
        }
        v17 = 0;
LABEL_30:
        m_areaCode = pEntity->m_areaCode;
        if ( m_areaCode == 13 || CGame::currArea == m_areaCode )
        {
          m_pLod = pEntity->m_pLod;
          if ( !m_pLod )
            m_pLod = pEntity;
          m_pMat = m_pLod->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &m_pLod->m_transform;
          v22.n64_u64[0] = vsub_f32(
                             *(float32x2_t *)&p_tx->m_translate.y,
                             *(float32x2_t *)&CRenderer::ms_vecCameraPosition.y).n64_u64[0];
          v23 = vmul_f32(v22, v22).n64_u64[0];
          v24 = sqrtf(
                  (float)((float)((float)(p_tx->m_translate.x - CRenderer::ms_vecCameraPosition.x)
                                * (float)(p_tx->m_translate.x - CRenderer::ms_vecCameraPosition.x))
                        + *(float *)&v23)
                + *((float *)&v23 + 1));
          *dist = v24;
          if ( v24 > 300.0 )
          {
            v25 = v4->m_lodDistance * TheCamera.LODDistMultiplier;
            if ( v25 > 300.0 && v24 < (float)(v25 + (float)(FadeDistMult * 22.0)) )
            {
              v24 = v24 + (float)(v25 + -300.0);
              *dist = v24;
            }
          }
          return sub_19A8D4(pEntity, v4, v24, v17);
        }
        return 0;
      }
      if ( v11 != 0xFFFF && CModelInfo::ms_modelInfoPtrs[(__int16)v11]->m_pRwObject )
        v4->m_alpha = -1;
LABEL_29:
      v17 = 1;
      goto LABEL_30;
    }
    v16 = (int)pEntity->m_nFlags;
    if ( (v16 & 0x80000) == 0 )
      goto LABEL_29;
    if ( !pEntity->m_pRwObject || (v16 & 0x80) == 0 && (!CMirrors::TypeOfMirror || pEntity->m_nModelIndex) )
      return 0;
    if ( CEntity::GetIsOnScreen(pEntity) && !CEntity::IsEntityOccluded(pEntity) )
    {
      if ( (*((_BYTE *)&pEntity->m_nFlags + 1) & 0x40) != 0 )
      {
        v26 = pEntity->m_pMat;
        p_m_transform = (CSimpleTransform *)&v26->tx;
        if ( !v26 )
          p_m_transform = &pEntity->m_transform;
        CVisibilityPlugins::InsertEntityIntoSortedList(
          pEntity,
          sqrtf(
            (float)((float)((float)(p_m_transform->m_translate.x - CRenderer::ms_vecCameraPosition.x)
                          * (float)(p_m_transform->m_translate.x - CRenderer::ms_vecCameraPosition.x))
                  + (float)((float)(p_m_transform->m_translate.y - CRenderer::ms_vecCameraPosition.y)
                          * (float)(p_m_transform->m_translate.y - CRenderer::ms_vecCameraPosition.y)))
          + (float)((float)(p_m_transform->m_translate.z - CRenderer::ms_vecCameraPosition.z)
                  * (float)(p_m_transform->m_translate.z - CRenderer::ms_vecCameraPosition.z))));
        *(_DWORD *)&pEntity->m_nFlags &= ~0x8000u;
        return 0;
      }
      return 1;
    }
    return 2;
  }
  if ( v9 == 5 || (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 5))(v4) == 4 )
    goto LABEL_29;
  if ( FindPlayerVehicle(-1, 0) != pEntity
    || !gbFirstPersonRunThisFrame
    || (DirectionWasLooking = TheCamera.Cams[TheCamera.ActiveCam].DirectionWasLooking,
        FindPlayerVehicle(-1, 0)->m_baseVehicleType == 9)
    && SLOBYTE(FindPlayerVehicle(-1, 0)[1].m_vecTurnFriction.z) < 0 )
  {
LABEL_59:
    result = ENTITY_INVISIBLE;
    if ( !pEntity->m_pRwObject )
      return result;
    p_m_nFlags = &pEntity->m_nFlags;
    if ( !(*(_BYTE *)&pEntity->m_nFlags >> 7) && (!CMirrors::TypeOfMirror || pEntity->m_nModelIndex) )
      return 0;
    v29 = pEntity->m_areaCode;
    if ( v29 != 13 && CGame::currArea != v29 && (*(_BYTE *)&pEntity->m_info & 7) == 2 )
      return 0;
    if ( CEntity::GetIsOnScreen(pEntity) && !CEntity::IsEntityOccluded(pEntity) )
    {
      if ( (*(_DWORD *)p_m_nFlags & 0x4000) != 0 )
      {
        *(_DWORD *)&v30 = *(_DWORD *)p_m_nFlags & 0xFFFF7FFF;
        v30.bdummy = pEntity->m_nFlags.bdummy;
        *p_m_nFlags = v30;
        *(_DWORD *)&v30 = pEntity->m_pMat;
        v31 = (CSimpleTransform *)(*(_DWORD *)&v30 + 48);
        if ( !*(_DWORD *)&v30 )
          v31 = &pEntity->m_transform;
        v32 = (float)(v31->m_translate.x - CRenderer::ms_vecCameraPosition.x)
            * (float)(v31->m_translate.x - CRenderer::ms_vecCameraPosition.x);
        v33 = (float)(v31->m_translate.y - CRenderer::ms_vecCameraPosition.y)
            * (float)(v31->m_translate.y - CRenderer::ms_vecCameraPosition.y);
        v34 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
        v35 = (float)(v31->m_translate.z - CRenderer::ms_vecCameraPosition.z)
            * (float)(v31->m_translate.z - CRenderer::ms_vecCameraPosition.z);
        v34->m_flags &= ~1u;
        v36 = sqrtf((float)(v32 + v33) + v35);
        if ( (*(_DWORD *)p_m_nFlags & 0x8000) != 0 )
        {
          if ( CVisibilityPlugins::InsertEntityIntoSortedList(pEntity, v36) )
            return 0;
        }
        else if ( (*(_DWORD *)p_m_nFlags & 0x4000) != 0 && CVisibilityPlugins::InsertEntityIntoSortedList(pEntity, v36) )
        {
          *(_DWORD *)p_m_nFlags &= ~0x8000u;
          return 0;
        }
        if ( !pEntity->numLodChildren || (*((_BYTE *)&pEntity->m_nFlags + 2) & 0x10) != 0 )
        {
          v37 = (int *)&CRenderer::ms_nNoOfVisibleEntities;
          v38 = &CRenderer::ms_aVisibleEntityPtrs;
        }
        else
        {
          v37 = &CRenderer::ms_nNoOfVisibleLods;
          v38 = &CRenderer::ms_aVisibleLodPtrs;
        }
        v39 = (int *)*v37;
        v40 = *v39;
        (**v38)[*v39] = (int)pEntity;
        *v39 = v40 + 1;
        return 0;
      }
      return 1;
    }
    return 2;
  }
  if ( DirectionWasLooking == 3 )
    return 2;
  m_nModelIndex = pEntity->m_nModelIndex;
  result = ENTITY_OFFSCREEN;
  v15 = (unsigned __int16)m_nModelIndex == 432;
  if ( (unsigned __int16)m_nModelIndex != 432 )
    v15 = (unsigned __int16)m_nModelIndex == 437;
  if ( !v15 && !TheCamera.m_bInATunnelAndABigVehicle )
  {
    if ( DirectionWasLooking )
      goto LABEL_27;
    if ( (*(_BYTE *)(LODWORD(pEntity[15].m_transform.m_translate.x) + 205) & 0x40) != 0 )
      return 2;
    if ( pEntity[24]._vptr$CPlaceable != (int (**)(void))&byte_5
      || (unsigned int)(m_nModelIndex - 430) <= 0x1E && ((1 << (m_nModelIndex + 82)) & 0x41800001) != 0 )
    {
LABEL_27:
      CRenderer::m_pFirstPersonVehicle = pEntity;
      return 2;
    }
    goto LABEL_59;
  }
  return result;
}
// 5: using guessed type char byte_5;
// 676210: using guessed type int CRenderer::ms_nNoOfVisibleLods;
// 676474: using guessed type int (*CRenderer::ms_aVisibleLodPtrs)[1000];
// 6771F0: using guessed type int *CRenderer::ms_nNoOfVisibleEntities;
// 6778EC: using guessed type int (*CRenderer::ms_aVisibleEntityPtrs)[1000];

//----- (00411548) --------------------------------------------------------
CRenderer::VisibilityState __fastcall CRenderer::SetupBigBuildingVisibility(CEntity *pEntity, float *dist)
{
  CBaseModelInfo *v4; // r6
  int m_areaCode; // r0
  CRenderer::VisibilityState result; // r0
  int v7; // r0
  int v8; // r5
  bool v9; // r3
  CEntity *v10; // r1
  CEntity *m_pLod; // r5
  CMatrix *m_pMat; // r2
  float *p_tx; // r0
  float v14; // s0
  float v15; // r2
  EntityInfo_0 *v16; // r1
  float v17; // r2
  EntityInfo_0 *v18; // r1

  v4 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  m_areaCode = pEntity->m_areaCode;
  if ( m_areaCode != 13 && CGame::currArea != m_areaCode )
    return 0;
  if ( (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 5))(v4) != 3 )
  {
    if ( (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 5))(v4) != 6 )
    {
LABEL_15:
      v9 = 1;
      goto LABEL_16;
    }
    return CEntity::IsVisible(pEntity) && !CEntity::IsEntityOccluded(pEntity);
  }
  v7 = (*((int (__fastcall **)(CBaseModelInfo *))v4->_vptr$CBaseModelInfo + 6))(v4);
  v8 = *(unsigned __int16 *)(v7 + 2);
  if ( CClock::GetIsTimeInRange(*(_BYTE *)v7, *(_BYTE *)(v7 + 1)) )
  {
    if ( v8 != 0xFFFF && CModelInfo::ms_modelInfoPtrs[(__int16)v8]->m_pRwObject )
      v4->m_alpha = -1;
    goto LABEL_15;
  }
  if ( v8 == 0xFFFF || CModelInfo::ms_modelInfoPtrs[(__int16)v8]->m_pRwObject )
  {
    (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 9))(pEntity);
    return 0;
  }
  v9 = 0;
LABEL_16:
  v10 = pEntity;
  m_pLod = pEntity->m_pLod;
  if ( m_pLod )
    v10 = pEntity->m_pLod;
  m_pMat = v10->m_pMat;
  p_tx = &m_pMat->tx;
  if ( !m_pMat )
    p_tx = &v10->m_transform.m_translate.x;
  v14 = sqrtf(
          (float)((float)((float)(*p_tx - CRenderer::ms_vecCameraPosition.x)
                        * (float)(*p_tx - CRenderer::ms_vecCameraPosition.x))
                + (float)((float)(p_tx[1] - CRenderer::ms_vecCameraPosition.y)
                        * (float)(p_tx[1] - CRenderer::ms_vecCameraPosition.y)))
        + (float)((float)(p_tx[2] - CRenderer::ms_vecCameraPosition.z)
                * (float)(p_tx[2] - CRenderer::ms_vecCameraPosition.z)));
  *dist = v14;
  if ( pEntity->numLodChildrenRendered < 1 )
  {
    result = CRenderer::SetupMapEntityVisibility(pEntity, v4, v14, v9);
    if ( result != ENTITY_VISIBLE )
      return result;
    if ( pEntity->numLodChildren >= 2u )
    {
      if ( m_pLod && v4->m_alpha == 255 )
        ++m_pLod->numLodChildrenRendered;
      v17 = *dist;
      CRenderer::ms_pLodRenderList->pEntity = pEntity;
      v18 = CRenderer::ms_pLodRenderList;
      CRenderer::ms_pLodRenderList->dist = v17;
      CRenderer::ms_pLodRenderList = v18 + 1;
      return 0;
    }
    return 1;
  }
  if ( m_pLod )
    ++m_pLod->numLodChildrenRendered;
  if ( pEntity->numLodChildren < 2u )
  {
    pEntity->numLodChildrenRendered = 0;
  }
  else
  {
    v15 = *dist;
    CRenderer::ms_pLodRenderList->pEntity = pEntity;
    v16 = CRenderer::ms_pLodRenderList;
    CRenderer::ms_pLodRenderList->dist = v15;
    CRenderer::ms_pLodRenderList = v16 + 1;
  }
  if ( !pEntity->m_pRwObject )
    (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 8))(pEntity);
  return 3;
}

//----- (00411724) --------------------------------------------------------
void __fastcall CRenderer::AddToLodRenderList(CEntity *pEntity, float dist)
{
  EntityInfo_0 *v2; // r0

  CRenderer::ms_pLodRenderList->pEntity = pEntity;
  v2 = CRenderer::ms_pLodRenderList;
  CRenderer::ms_pLodRenderList->dist = dist;
  CRenderer::ms_pLodRenderList = v2 + 1;
}

//----- (0041173C) --------------------------------------------------------
void __fastcall CRenderer::ScanSectorList_RequestModels(Int32 BlockX, Int32 BlockY)
{
  char v2; // r10
  bool v3; // cc
  Int32 v4; // r3
  Int32 v5; // r2
  int v6; // r0
  CPtrNode *m_pHead; // r4
  CPtrNode v8; // kr00_8
  CPtrNode *v9; // r6
  CPtrNode v10; // kr08_8
  CPtrNode *v11; // r6
  CPtrNode v12; // kr10_8
  int v13; // [sp+4h] [bp-24h]
  int v14; // [sp+8h] [bp-20h]

  v2 = BlockY;
  v3 = BlockY <= 119;
  if ( BlockY <= 119 )
    v3 = BlockX <= 119;
  if ( v3 && (BlockY | BlockX) >= 0 )
  {
    v4 = 0;
    if ( BlockX > 0 )
      v4 = BlockX;
    v5 = 0;
    if ( v4 >= 119 )
      v4 = 119;
    if ( BlockY > 0 )
      v5 = BlockY;
    v6 = BlockX & 0xF;
    if ( v5 >= 119 )
      v5 = 119;
    v14 = v6;
    v13 = v4 + 120 * v5;
    m_pHead = CWorld::ms_aSectors[v13].m_buildingPtrListArray.m_pHead;
    while ( m_pHead )
    {
      v8 = *m_pHead;
      m_pHead = m_pHead->m_pNext;
      if ( *((unsigned __int16 *)v8.m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
      {
        *((_WORD *)v8.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
        if ( CRenderer::ShouldModelBeStreamed(
               (CEntity *)v8.m_pVoid,
               &CRenderer::ms_vecCameraPosition,
               CRenderer::ms_fFarClipPlane) )
        {
          CStreaming::RequestModel(*((__int16 *)v8.m_pVoid + 19), gStreamingFlags);
        }
      }
    }
    v9 = CWorld::ms_aSectors[v13].m_dummyPtrListArray.m_pHead;
    while ( v9 )
    {
      v10 = *v9;
      v9 = v9->m_pNext;
      if ( *((unsigned __int16 *)v10.m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
      {
        *((_WORD *)v10.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
        if ( CRenderer::ShouldModelBeStreamed(
               (CEntity *)v10.m_pVoid,
               &CRenderer::ms_vecCameraPosition,
               CRenderer::ms_fFarClipPlane) )
        {
          CStreaming::RequestModel(*((__int16 *)v10.m_pVoid + 19), gStreamingFlags);
        }
      }
    }
    v11 = CWorld::ms_aRepeatSectors[v14 & 0xFFFFFF0F | (16 * (v2 & 0xF))].m_ptrListArray[2].m_pHead;
    while ( v11 )
    {
      v12 = *v11;
      v11 = v11->m_pNext;
      if ( *((unsigned __int16 *)v12.m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
      {
        *((_WORD *)v12.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
        if ( CRenderer::ShouldModelBeStreamed(
               (CEntity *)v12.m_pVoid,
               &CRenderer::ms_vecCameraPosition,
               CRenderer::ms_fFarClipPlane) )
        {
          CStreaming::RequestModel(*((__int16 *)v12.m_pVoid + 19), gStreamingFlags);
        }
      }
    }
  }
}

//----- (004118EC) --------------------------------------------------------
void __fastcall CRenderer::ScanPtrList_RequestModels(CPtrList *ptrList)
{
  CPtrNode *m_pHead; // r6
  CPtrNode v2; // kr00_8

  m_pHead = ptrList->m_pHead;
  while ( m_pHead )
  {
    v2 = *m_pHead;
    m_pHead = m_pHead->m_pNext;
    if ( *((unsigned __int16 *)v2.m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
    {
      *((_WORD *)v2.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
      if ( CRenderer::ShouldModelBeStreamed(
             (CEntity *)v2.m_pVoid,
             &CRenderer::ms_vecCameraPosition,
             CRenderer::ms_fFarClipPlane) )
      {
        CStreaming::RequestModel(*((__int16 *)v2.m_pVoid + 19), gStreamingFlags);
      }
    }
  }
}

//----- (00411958) --------------------------------------------------------
bool __fastcall CRenderer::ShouldModelBeStreamed(CEntity *pEntity, const CVector *posn, float farPlane)
{
  int m_areaCode; // r0
  CBaseModelInfo *v7; // r8
  uint8 *v8; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float32x2_t v11; // d16
  unsigned __int64 v12; // d2
  bool result; // r0
  float v14; // s0

  m_areaCode = pEntity->m_areaCode;
  if ( m_areaCode != 13 && CGame::currArea != m_areaCode )
    return 0;
  v7 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  v8 = (uint8 *)(*((int (__fastcall **)(CBaseModelInfo *))v7->_vptr$CBaseModelInfo + 6))(v7);
  if ( v8 )
  {
    if ( !CClock::GetIsTimeInRange(*v8, v8[1]) )
      return 0;
  }
  m_pMat = pEntity->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pEntity->m_transform;
  v11.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&posn->y).n64_u64[0];
  v12 = vmul_f32(v11, v11).n64_u64[0];
  result = 0;
  v14 = sqrtf(
          (float)((float)((float)(p_tx->m_translate.x - posn->x) * (float)(p_tx->m_translate.x - posn->x))
                + *(float *)&v12)
        + *((float *)&v12 + 1));
  if ( v14 <= (float)(CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius
                    + farPlane)
    && (float)(v7->m_lodDistance * TheCamera.LODDistMultiplier) > v14 )
  {
    return 1;
  }
  return result;
}

//----- (00411A40) --------------------------------------------------------
void __fastcall CRenderer::RequestObjectsInDirection(const CVector *posn, float heading, int32 flags)
{
  RwV3d_0 v5; // [sp+0h] [bp-70h] BYREF
  RwV3d_0 axis; // [sp+10h] [bp-60h] BYREF
  RwMatrix matrix; // [sp+20h] [bp-50h] BYREF

  axis.z = 0.0;
  *(_QWORD *)&axis.x = unk_616FB0;
  v5.z = 1.0;
  matrix.at.z = 1.0;
  matrix.up.y = 1.0;
  matrix.up.x = 0.0;
  *(_QWORD *)&v5.x = unk_616FC0;
  matrix.up.z = 0.0;
  matrix.at.x = 0.0;
  matrix.at.y = 0.0;
  matrix.right.z = 0.0;
  matrix.right.x = 1.0;
  matrix.right.y = 0.0;
  matrix.flags = -1;
  memset(&matrix.pos, 0, sizeof(matrix.pos));
  RwMatrixRotate(&matrix, &axis, 90.0, rwCOMBINEREPLACE);
  RwMatrixRotate(&matrix, &v5, (float)((float)(heading * 180.0) / 3.1416) + 180.0, rwCOMBINEPOSTCONCAT);
  RwMatrixTranslate(&matrix, posn, rwCOMBINEPOSTCONCAT);
  CRenderer::RequestObjectsInFrustum(&matrix, 32);
}

//----- (00411AF4) --------------------------------------------------------
void __fastcall CRenderer::RequestObjectsInFrustum(RwMatrix *pMatrix, int32 flags)
{
  float farPlane; // s16
  float x; // s0
  float v6; // s6
  uint16 v7; // r0
  __int64 v8; // d16
  float *v9; // r0
  float *v10; // r1
  float *v11; // r2
  float v12; // s2
  float v13; // s4
  float v14; // s6
  float v15; // s4
  float v16; // s6
  RwV2d_0 Points; // [sp+4h] [bp-D4h] BYREF
  float v18; // [sp+Ch] [bp-CCh]
  float v19; // [sp+10h] [bp-C8h]
  float v20; // [sp+14h] [bp-C4h]
  float v21; // [sp+18h] [bp-C0h]
  RwV3d_0 pointsIn; // [sp+24h] [bp-B4h] BYREF
  float v23; // [sp+30h] [bp-A8h]
  float v24; // [sp+34h] [bp-A4h]
  float v25; // [sp+38h] [bp-A0h]
  float v26; // [sp+3Ch] [bp-9Ch] BYREF
  float v27; // [sp+40h] [bp-98h] BYREF
  float v28; // [sp+44h] [bp-94h] BYREF
  float v29; // [sp+48h] [bp-90h] BYREF
  float v30; // [sp+4Ch] [bp-8Ch] BYREF
  float v31; // [sp+50h] [bp-88h] BYREF
  float v32; // [sp+54h] [bp-84h]
  float v33; // [sp+58h] [bp-80h]
  float v34; // [sp+5Ch] [bp-7Ch]
  __int64 v35; // [sp+60h] [bp-78h]
  __int64 v36; // [sp+68h] [bp-70h]
  __int64 v37; // [sp+70h] [bp-68h]
  __int64 v38; // [sp+78h] [bp-60h]
  __int64 v39; // [sp+80h] [bp-58h]
  __int64 v40; // [sp+88h] [bp-50h]
  __int64 v41; // [sp+90h] [bp-48h]
  __int64 v42; // [sp+98h] [bp-40h]
  __int64 v43; // [sp+A0h] [bp-38h]
  __int64 v44; // [sp+A8h] [bp-30h]
  __int64 v45; // [sp+B0h] [bp-28h]
  __int64 v46; // [sp+B8h] [bp-20h]

  farPlane = TheCamera.m_pRwCamera->farPlane;
  memset(&pointsIn, 0, sizeof(pointsIn));
  x = TheCamera.m_pRwCamera->viewWindow.x;
  v6 = farPlane * TheCamera.m_pRwCamera->viewWindow.y;
  v23 = -(float)(farPlane * x);
  v25 = farPlane;
  v28 = farPlane;
  v26 = farPlane * x;
  v31 = farPlane;
  v29 = farPlane * x;
  v34 = farPlane;
  v32 = v23;
  v24 = v6;
  v27 = v6;
  v30 = -v6;
  v33 = -v6;
  v45 = 0LL;
  v46 = 0LL;
  v43 = 0LL;
  v44 = 0LL;
  v41 = 0LL;
  v42 = 0LL;
  v39 = 0LL;
  v40 = 0LL;
  v37 = 0LL;
  v38 = 0LL;
  v35 = 0LL;
  v36 = 0LL;
  if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
  {
    CWorld::ClearScanCodes();
    v7 = 1;
  }
  else
  {
    v7 = CWorld::ms_nCurrentScanCode + 1;
  }
  CWorld::ms_nCurrentScanCode = v7;
  if ( !pMatrix )
    pMatrix = (RwMatrix *)((char *)TheCamera.m_pRwCamera->object.object.parent + 16);
  v8 = *(_QWORD *)&pMatrix->pos.x;
  CRenderer::ms_vecCameraPosition.z = pMatrix->pos.z;
  *(_QWORD *)&CRenderer::ms_vecCameraPosition.x = v8;
  gStreamingFlags = flags;
  CRenderer::ms_fFarClipPlane = 300.0;
  if ( pMatrix->at.z <= 0.0 )
  {
    v9 = &v28;
    v10 = &v27;
    v11 = &v26;
    v12 = v23;
    v13 = v24;
    v14 = v25;
  }
  else
  {
    v9 = &v31;
    v10 = &v30;
    v11 = &v29;
    v12 = v32;
    v13 = v33;
    v14 = v34;
  }
  *(float *)&v36 = (float)(1.0 / farPlane) * (float)(v14 * 300.0);
  *((float *)&v35 + 1) = (float)(1.0 / farPlane) * (float)(v13 * 300.0);
  *(float *)&v35 = (float)(1.0 / farPlane) * (float)(v12 * 300.0);
  v15 = *v10 * 300.0;
  v16 = *v11 * 300.0;
  *((float *)&v37 + 1) = (float)(1.0 / farPlane) * (float)(*v9 * 300.0);
  *(float *)&v37 = (float)(1.0 / farPlane) * v15;
  *((float *)&v36 + 1) = (float)(1.0 / farPlane) * v16;
  RwV3dTransformPoints(&pointsIn, &pointsIn, 13, pMatrix);
  Points.x = (float)(pointsIn.x / 50.0) + 60.0;
  Points.y = (float)(pointsIn.y / 50.0) + 60.0;
  v18 = (float)(*(float *)&v35 / 50.0) + 60.0;
  v19 = (float)(*((float *)&v35 + 1) / 50.0) + 60.0;
  v20 = (float)(*((float *)&v36 + 1) / 50.0) + 60.0;
  v21 = (float)(*(float *)&v37 / 50.0) + 60.0;
  CWorldScan::ScanWorld(&Points, 3, CRenderer::ScanSectorList_RequestModels);
}

//----- (00411D58) --------------------------------------------------------
void __fastcall CRenderer::ScanSectorList_ListModels(Int32 BlockX, Int32 BlockY)
{
  int v2; // r3
  bool v3; // cc
  CRepeatSector *v4; // r5
  CRepeatSector *v5; // r3
  CPtrListDoubleLink *v6; // r2
  Int32 v7; // r3
  CSector *v8; // r0
  bool v9; // zf
  CSector v10; // kr00_8
  int m_pVoid_high; // r4
  bool v12; // zf
  CEntity **v13; // r2
  CRepeatSector *v14; // r1
  CPtrNode *m_pHead; // r0
  CPtrNode v16; // kr08_8
  int v17; // r4
  bool v18; // zf
  CEntity **v19; // r2
  int v20; // r0
  bool v21; // zf
  __int64 v22; // kr10_8
  int v23; // r4
  bool v24; // zf
  CEntity **v25; // r2
  int v26; // r0
  bool v27; // zf
  __int64 v28; // kr18_8
  int v29; // r4
  bool v30; // zf
  CEntity **v31; // r2
  int v32; // r0
  bool v33; // zf
  __int64 v34; // kr20_8
  int v35; // r4
  bool v36; // zf
  CEntity **v37; // r2

  v2 = BlockX & 0xF | (16 * (BlockY & 0xF));
  v3 = BlockY <= 119;
  if ( BlockY <= 119 )
    v3 = BlockX <= 119;
  v4 = &CWorld::ms_aRepeatSectors[v2];
  if ( !v3 || (BlockY | BlockX) <= -1 )
  {
    v14 = &CWorld::ms_aRepeatSectors[v2];
    v6 = &v14->m_ptrListArray[2];
    PC_Scratch[0] = 0;
    PC_Scratch[1] = (int)&v14->m_ptrListArray[2];
    PC_Scratch[2] = (int)v14;
    PC_Scratch[3] = (int)&v14->m_ptrListArray[1];
    PC_Scratch[4] = 0;
LABEL_27:
    m_pHead = v6->m_pHead;
    while ( m_pHead )
    {
      v16 = *m_pHead;
      m_pHead = m_pHead->m_pNext;
      if ( *((unsigned __int16 *)v16.m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
      {
        v17 = *((unsigned __int8 *)v16.m_pVoid + 51);
        *((_WORD *)v16.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
        v18 = v17 == 13;
        if ( v17 != 13 )
          v18 = CGame::currArea == v17;
        if ( v18 )
        {
          v19 = gpEntityList;
          *gpEntityList = (CEntity *)v16.m_pVoid;
          gpEntityList = v19 + 1;
        }
      }
    }
    goto LABEL_35;
  }
  v5 = &CWorld::ms_aRepeatSectors[v2];
  v6 = &v5->m_ptrListArray[2];
  PC_Scratch[1] = (int)&v5->m_ptrListArray[2];
  PC_Scratch[2] = (int)v4;
  PC_Scratch[3] = (int)&v5->m_ptrListArray[1];
  v7 = 0;
  if ( BlockX <= 0 )
    BlockX = 0;
  if ( BlockX >= 119 )
    BlockX = 119;
  if ( BlockY > 0 )
    v7 = BlockY;
  if ( v7 >= 119 )
    v7 = 119;
  v8 = &CWorld::ms_aSectors[120 * v7 + BlockX];
  PC_Scratch[0] = (int)v8;
  PC_Scratch[4] = (int)&v8->m_dummyPtrListArray;
  v9 = v8 == 0;
  if ( v8 )
  {
    v8 = (CSector *)v8->m_buildingPtrListArray.m_pHead;
    v9 = v8 == 0;
  }
  if ( v9 )
    goto LABEL_27;
  do
  {
    v10 = *v8;
    v8 = (CSector *)v8->m_dummyPtrListArray.m_pHead;
    if ( LOWORD(v10.m_buildingPtrListArray.m_pHead[6].m_pVoid) != CWorld::ms_nCurrentScanCode )
    {
      m_pVoid_high = HIBYTE(v10.m_buildingPtrListArray.m_pHead[6].m_pVoid);
      LOWORD(v10.m_buildingPtrListArray.m_pHead[6].m_pVoid) = CWorld::ms_nCurrentScanCode;
      v12 = m_pVoid_high == 13;
      if ( m_pVoid_high != 13 )
        v12 = CGame::currArea == m_pVoid_high;
      if ( v12 )
      {
        v13 = gpEntityList;
        *gpEntityList = (CEntity *)v10.m_buildingPtrListArray.m_pHead;
        gpEntityList = v13 + 1;
      }
    }
  }
  while ( v8 );
  v6 = (CPtrListDoubleLink *)PC_Scratch[1];
  if ( PC_Scratch[1] )
    goto LABEL_27;
LABEL_35:
  v20 = PC_Scratch[2];
  v21 = PC_Scratch[2] == 0;
  if ( PC_Scratch[2] )
  {
    v20 = *(_DWORD *)PC_Scratch[2];
    v21 = *(_DWORD *)PC_Scratch[2] == 0;
  }
  if ( !v21 )
  {
    do
    {
      v22 = *(_QWORD *)v20;
      v20 = *(_DWORD *)(v20 + 4);
      if ( *(unsigned __int16 *)(v22 + 48) != CWorld::ms_nCurrentScanCode )
      {
        v23 = *(unsigned __int8 *)(v22 + 51);
        *(_WORD *)(v22 + 48) = CWorld::ms_nCurrentScanCode;
        v24 = v23 == 13;
        if ( v23 != 13 )
          v24 = CGame::currArea == v23;
        if ( v24 )
        {
          v25 = gpEntityList;
          *gpEntityList = (CEntity *)v22;
          gpEntityList = v25 + 1;
        }
      }
    }
    while ( v20 );
  }
  v26 = PC_Scratch[3];
  v27 = PC_Scratch[3] == 0;
  if ( PC_Scratch[3] )
  {
    v26 = *(_DWORD *)PC_Scratch[3];
    v27 = *(_DWORD *)PC_Scratch[3] == 0;
  }
  if ( !v27 )
  {
    do
    {
      v28 = *(_QWORD *)v26;
      v26 = *(_DWORD *)(v26 + 4);
      if ( *(unsigned __int16 *)(v28 + 48) != CWorld::ms_nCurrentScanCode )
      {
        v29 = *(unsigned __int8 *)(v28 + 51);
        *(_WORD *)(v28 + 48) = CWorld::ms_nCurrentScanCode;
        v30 = v29 == 13;
        if ( v29 != 13 )
          v30 = CGame::currArea == v29;
        if ( v30 )
        {
          v31 = gpEntityList;
          *gpEntityList = (CEntity *)v28;
          gpEntityList = v31 + 1;
        }
      }
    }
    while ( v26 );
  }
  v32 = PC_Scratch[4];
  v33 = PC_Scratch[4] == 0;
  if ( PC_Scratch[4] )
  {
    v32 = *(_DWORD *)PC_Scratch[4];
    v33 = *(_DWORD *)PC_Scratch[4] == 0;
  }
  if ( !v33 )
  {
    do
    {
      v34 = *(_QWORD *)v32;
      v32 = *(_DWORD *)(v32 + 4);
      if ( *(unsigned __int16 *)(v34 + 48) != CWorld::ms_nCurrentScanCode )
      {
        v35 = *(unsigned __int8 *)(v34 + 51);
        *(_WORD *)(v34 + 48) = CWorld::ms_nCurrentScanCode;
        v36 = v35 == 13;
        if ( v35 != 13 )
          v36 = CGame::currArea == v35;
        if ( v36 )
        {
          v37 = gpEntityList;
          *gpEntityList = (CEntity *)v34;
          gpEntityList = v37 + 1;
        }
      }
    }
    while ( v32 );
  }
}

//----- (0041200C) --------------------------------------------------------
void __fastcall CRenderer::ScanSectorList_ListModelsVisible(Int32 BlockX, Int32 BlockY)
{
  bool v2; // cc
  CRepeatSector *v3; // r2
  CRepeatSector *v4; // r3
  Int32 v5; // r2
  int v6; // r0
  CRepeatSector *v7; // r1
  int v8; // r10
  int *v9; // r5
  int v10; // r0
  __int64 *v11; // r6
  CEntity **v12; // r0
  __int64 v13; // kr00_8
  int v14; // r1
  bool v15; // zf

  v2 = BlockY <= 119;
  if ( BlockY <= 119 )
    v2 = BlockX <= 119;
  v3 = &CWorld::ms_aRepeatSectors[BlockX & 0xF | (16 * (BlockY & 0xF))];
  if ( v2 && (BlockY | BlockX) >= 0 )
  {
    v4 = &CWorld::ms_aRepeatSectors[BlockX & 0xF | (16 * (BlockY & 0xF))];
    PC_Scratch[1] = (int)&v4->m_ptrListArray[2];
    PC_Scratch[2] = (int)v4;
    PC_Scratch[3] = (int)&v4->m_ptrListArray[1];
    v5 = 0;
    if ( BlockX <= 0 )
      BlockX = 0;
    if ( BlockX >= 119 )
      BlockX = 119;
    if ( BlockY > 0 )
      v5 = BlockY;
    if ( v5 >= 119 )
      v5 = 119;
    PC_Scratch[0] = (int)&CWorld::ms_aSectors[120 * v5 + BlockX];
    v6 = PC_Scratch[0] + 4;
  }
  else
  {
    v7 = &CWorld::ms_aRepeatSectors[BlockX & 0xF | (16 * (BlockY & 0xF))];
    v6 = 0;
    PC_Scratch[0] = 0;
    PC_Scratch[1] = (int)&v7->m_ptrListArray[2];
    PC_Scratch[2] = (int)v3;
    PC_Scratch[3] = (int)&v7->m_ptrListArray[1];
  }
  v8 = 5;
  v9 = PC_Scratch;
  PC_Scratch[4] = v6;
LABEL_17:
  v10 = -v8;
  while ( ++v10 != 1 )
  {
    if ( *v9 )
    {
      v8 = -v10;
      v11 = *(__int64 **)*v9++;
      while ( v11 )
      {
        v13 = *v11;
        v11 = (__int64 *)*((_DWORD *)v11 + 1);
        if ( *(unsigned __int16 *)(v13 + 48) != CWorld::ms_nCurrentScanCode )
        {
          v14 = *(unsigned __int8 *)(v13 + 51);
          *(_WORD *)(v13 + 48) = CWorld::ms_nCurrentScanCode;
          v15 = v14 == 13;
          if ( v14 != 13 )
            v15 = CGame::currArea == v14;
          if ( v15 && CEntity::IsVisible((CEntity *)v13) )
          {
            v12 = gpEntityList;
            *gpEntityList = (CEntity *)v13;
            gpEntityList = v12 + 1;
          }
        }
      }
      goto LABEL_17;
    }
  }
}

//----- (0041215C) --------------------------------------------------------
int32 __fastcall CRenderer::GetObjectsInFrustum(CEntity **pEntityList, float farPlane, RwMatrix *pMatrix)
{
  float x; // s2
  float v6; // s8
  uint16 v7; // r0
  RwMatrix *v8; // r3
  CSimpleTransform *p_tx; // r6
  __int64 v10; // d16
  void **v11; // r1
  RwV2d_0 v13; // [sp+0h] [bp-D0h] BYREF
  float v14; // [sp+8h] [bp-C8h]
  float v15; // [sp+Ch] [bp-C4h]
  float v16; // [sp+10h] [bp-C0h]
  float v17; // [sp+14h] [bp-BCh]
  RwV3d_0 pointsIn; // [sp+20h] [bp-B0h] BYREF
  double v19; // [sp+2Ch] [bp-A4h]
  float v20; // [sp+34h] [bp-9Ch]
  double v21; // [sp+38h] [bp-98h]
  float v22; // [sp+40h] [bp-90h]
  double v23; // [sp+44h] [bp-8Ch]
  float v24; // [sp+4Ch] [bp-84h]
  double v25; // [sp+50h] [bp-80h]
  float v26; // [sp+58h] [bp-78h]
  __int64 v27; // [sp+5Ch] [bp-74h]
  __int64 v28; // [sp+64h] [bp-6Ch]
  __int64 v29; // [sp+6Ch] [bp-64h]
  __int64 v30; // [sp+74h] [bp-5Ch]
  __int64 v31; // [sp+7Ch] [bp-54h]
  __int64 v32; // [sp+84h] [bp-4Ch]
  __int64 v33; // [sp+8Ch] [bp-44h]
  __int64 v34; // [sp+94h] [bp-3Ch]
  __int64 v35; // [sp+9Ch] [bp-34h]
  __int64 v36; // [sp+A4h] [bp-2Ch]
  __int64 v37; // [sp+ACh] [bp-24h]
  __int64 v38; // [sp+B4h] [bp-1Ch]

  memset(&pointsIn, 0, sizeof(pointsIn));
  x = TheCamera.m_pRwCamera->viewWindow.x;
  v6 = TheCamera.m_pRwCamera->viewWindow.y * farPlane;
  *(float *)&v19 = -(float)(x * farPlane);
  v20 = farPlane;
  v22 = farPlane;
  *(float *)&v21 = x * farPlane;
  v24 = farPlane;
  *(float *)&v23 = x * farPlane;
  v26 = farPlane;
  *(float *)&v25 = *(float *)&v19;
  *((float *)&v19 + 1) = v6;
  *((float *)&v21 + 1) = v6;
  *((float *)&v23 + 1) = -v6;
  *((float *)&v25 + 1) = -v6;
  v37 = 0LL;
  v38 = 0LL;
  v35 = 0LL;
  v36 = 0LL;
  v33 = 0LL;
  v34 = 0LL;
  v31 = 0LL;
  v32 = 0LL;
  v29 = 0LL;
  v30 = 0LL;
  v27 = 0LL;
  v28 = 0LL;
  if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
  {
    CWorld::ClearScanCodes();
    v7 = 1;
  }
  else
  {
    v7 = CWorld::ms_nCurrentScanCode + 1;
  }
  v8 = pMatrix;
  CWorld::ms_nCurrentScanCode = v7;
  if ( !pMatrix )
    v8 = (RwMatrix *)((char *)TheCamera.m_pRwCamera->object.object.parent + 16);
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v10 = *(_QWORD *)&p_tx->m_translate.x;
  CRenderer::ms_vecCameraPosition.z = *(RwReal *)&byte_8[(_DWORD)p_tx];
  *(_QWORD *)&CRenderer::ms_vecCameraPosition.x = v10;
  CRenderer::ms_fFarClipPlane = 300.0;
  if ( v8->at.z > 0.0 )
  {
    v20 = v26;
    v22 = v24;
    v21 = v23;
    v19 = v25;
  }
  RwV3dTransformPoints(&pointsIn, &pointsIn, 13, v8);
  gpEntityList = pEntityList;
  v13.x = (float)(pointsIn.x / 50.0) + 60.0;
  v13.y = (float)(pointsIn.y / 50.0) + 60.0;
  v15 = (float)(*((float *)&v19 + 1) / 50.0) + 60.0;
  v14 = (float)(*(float *)&v19 / 50.0) + 60.0;
  v16 = (float)(*(float *)&v21 / 50.0) + 60.0;
  v17 = (float)(*((float *)&v21 + 1) / 50.0) + 60.0;
  if ( pMatrix )
    v11 = &CRenderer::ScanSectorList_ListModels;
  else
    v11 = &CRenderer::ScanSectorList_ListModelsVisible;
  CWorldScan::ScanWorld(&v13, 3, (void (*)(Int32, Int32))*v11);
  return gpEntityList - pEntityList;
}
// 676754: using guessed type void *CRenderer::ScanSectorList_ListModels;
// 6772AC: using guessed type void *CRenderer::ScanSectorList_ListModelsVisible;

//----- (00412360) --------------------------------------------------------
EntityInfo *CRenderer::GetLodRenderListBase()
{
  return (EntityInfo *)&PC_Scratch[24];
}

//----- (00412370) --------------------------------------------------------
EntityInfo *CRenderer::GetLodDontRenderListBase()
{
  return (EntityInfo *)&PC_Scratch[0x2000];
}

//----- (00412380) --------------------------------------------------------
void __fastcall CRenderer::AddToLodDontRenderList(CEntity *pEntity, float dist)
{
  EntityInfo_0 *v2; // r0

  CRenderer::ms_pLodDontRenderList->pEntity = pEntity;
  v2 = CRenderer::ms_pLodDontRenderList;
  CRenderer::ms_pLodDontRenderList->dist = dist;
  CRenderer::ms_pLodDontRenderList = v2 + 1;
}

//----- (00412398) --------------------------------------------------------
CRenderer::VisibilityState __fastcall CRenderer::SetupMapEntityVisibility(
        CEntity *pEntity,
        CBaseModelInfo *pModelInfo,
        float dist,
        bool doStream)
{
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  CColModel *m_pColModel; // r6
  CCamera *v11; // r2
  int m_nFlags; // r1
  CEntity::CFlags *p_m_nFlags; // r4
  RwObject_0 *m_pRwObject; // r0
  CEntity *m_pLod; // r11
  bool v16; // zf
  float v17; // s0
  float32x2_t v18; // d2
  int v19; // r10
  float v20; // s6
  float v21; // s2
  float v22; // s2
  EntityInfo_0 *v23; // r1
  CRenderer::VisibilityState result; // r0
  uint16 v25; // r0
  uint16 v26; // r0
  bool v27; // zf
  uint16 m_flags; // r0
  uint16 v29; // r0
  unsigned int v30; // r2
  CEntity *v31; // r0
  EntityInfo_0 **v32; // r0
  EntityInfo_0 *v33; // r1
  EntityInfo_0 *v34; // r1
  CBaseModelInfo *v35; // r0
  EntityInfo_0 ***v36; // r0
  int (**v37)[1000]; // r1
  EntityInfo_0 *v38; // r2

  m_pColModel = pModelInfo->m_pColModel;
  v11 = &TheCamera;
  p_m_nFlags = &pEntity->m_nFlags;
  m_nFlags = (int)pEntity->m_nFlags;
  m_pRwObject = pModelInfo->m_pRwObject;
  m_pLod = pEntity->m_pLod;
  v4.n64_u32[0] = LODWORD(pModelInfo->m_lodDistance);
  if ( m_nFlags >= 0 )
  {
    v11 = (CCamera *)(m_nFlags & 0x40000000);
    if ( (m_nFlags & 0x40000000) != 0 && !CRenderer::ms_bRenderTunnels )
      return 0;
    v16 = !CRenderer::ms_bRenderOutsideTunnels;
    if ( !CRenderer::ms_bRenderOutsideTunnels )
      v16 = v11 == 0;
    if ( v16 )
      return 0;
  }
  v5.n64_f32[0] = CRenderer::ms_fFarClipPlane + m_pColModel->m_sphereBound.m_fRadius;
  v6.n64_f32[0] = v4.n64_f32[0] * TheCamera.LODDistMultiplier;
  v17 = FadeDistMult * 22.0;
  v18.n64_u64[0] = vmin_f32(v6, v5).n64_u64[0];
  if ( !m_pLod )
  {
    v22 = vmin_f32(v4, v18).n64_f32[0];
    v20 = FadeDistMult * 22.0;
    if ( v22 > 150.0 )
      v20 = (float)(v22 / 15.0) + 10.0;
    v19 = 0;
    v11 = (CCamera *)(m_nFlags << 23);
    v21 = v18.n64_f32[0] * CRenderer::ms_lowLodDistScale;
    if ( (m_nFlags & 0x100) == 0 )
      v21 = v18.n64_f32[0];
    if ( !m_pRwObject )
      goto LABEL_24;
    goto LABEL_15;
  }
  if ( m_pRwObject )
  {
    v19 = 1;
    v20 = FadeDistMult * 22.0;
    v21 = v18.n64_f32[0];
LABEL_15:
    if ( (float)((float)(v20 + dist) - v17) < v21 )
    {
      if ( pEntity->m_pRwObject )
      {
        if ( (m_nFlags & 0x80) == 0 )
          return 0;
      }
      else
      {
        (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 8))(pEntity);
        if ( !pEntity->m_pRwObject || (*(_DWORD *)p_m_nFlags & 0x80) == 0 )
          return 0;
      }
      if ( !CEntity::GetIsOnScreen(pEntity) || CEntity::IsEntityOccluded(pEntity) )
      {
        m_flags = pModelInfo->m_flags;
        v16 = (m_flags & 1) == 0;
        v29 = m_flags & 0xFFFE;
        if ( v16 )
          pModelInfo->m_alpha = -1;
        pModelInfo->m_flags = v29;
        return 2;
      }
      v30 = *(_DWORD *)p_m_nFlags & 0xFFFF7FFF;
      if ( pModelInfo->m_alpha != 255 )
        v30 = *(_DWORD *)p_m_nFlags | 0x8000;
      *(_DWORD *)p_m_nFlags = v30;
      if ( v19 != 1 )
        return 1;
      if ( pModelInfo->m_alpha == 255 )
        ++m_pLod->numLodChildrenRendered;
      if ( m_pLod->numLodChildren < 2u )
        return 1;
      goto LABEL_60;
    }
    v19 = 1;
    goto LABEL_24;
  }
  if ( m_pLod->numLodChildren >= 2u && (float)((float)(v17 + dist) - v17) < v18.n64_f32[0] )
  {
    CRenderer::ms_pLodRenderList->pEntity = pEntity;
    v23 = CRenderer::ms_pLodRenderList;
    CRenderer::ms_pLodRenderList->dist = dist;
    CRenderer::ms_pLodRenderList = v23 + 1;
    return 3;
  }
  v21 = v18.n64_f32[0];
  v19 = 0;
LABEL_24:
  result = ENTITY_INVISIBLE;
  if ( (m_nFlags & 0x80000) != 0 )
    return result;
  if ( (float)(dist - v17) < v21 )
    result = ENTITY_VISIBLE;
  if ( (result & v19) == 1 )
  {
    if ( !pEntity->m_pRwObject )
    {
      (*((void (__fastcall **)(CEntity *, _DWORD, CCamera *, bool))pEntity->_vptr$CPlaceable + 8))(
        pEntity,
        *((_DWORD *)pEntity->_vptr$CPlaceable + 8),
        v11,
        doStream);
      if ( !pEntity->m_pRwObject )
        return 0;
      m_nFlags = *(_DWORD *)p_m_nFlags;
    }
    if ( (m_nFlags & 0x80) != 0 )
    {
      if ( !CEntity::GetIsOnScreen(pEntity) || CEntity::IsEntityOccluded(pEntity) )
      {
        v25 = pModelInfo->m_flags;
        v16 = (v25 & 1) == 0;
        v26 = v25 & 0xFFFE;
        if ( v16 )
          pModelInfo->m_alpha = -1;
        pModelInfo->m_flags = v26;
        return 0;
      }
      *(_DWORD *)p_m_nFlags |= 0x8000u;
      v31 = pEntity->m_pLod;
      if ( v31 && v31->numLodChildren >= 2u )
      {
LABEL_60:
        v32 = &CRenderer::ms_pLodRenderList;
        CRenderer::ms_pLodRenderList->pEntity = pEntity;
        v33 = CRenderer::ms_pLodRenderList;
        CRenderer::ms_pLodRenderList->dist = dist;
        v34 = v33 + 1;
LABEL_71:
        *v32 = v34;
        return 0;
      }
      v35 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
      v35->m_flags &= ~1u;
      if ( (*(_DWORD *)p_m_nFlags & 0x8000) != 0 )
      {
        if ( CVisibilityPlugins::InsertEntityIntoSortedList(pEntity, dist) )
          return 0;
      }
      else if ( (*(_DWORD *)p_m_nFlags & 0x4000) != 0 && CVisibilityPlugins::InsertEntityIntoSortedList(pEntity, dist) )
      {
        *(_DWORD *)p_m_nFlags &= ~0x8000u;
        return 0;
      }
      if ( !pEntity->numLodChildren || (*((_BYTE *)p_m_nFlags + 2) & 0x10) != 0 )
      {
        v36 = (EntityInfo_0 ***)&CRenderer::ms_nNoOfVisibleEntities;
        v37 = &CRenderer::ms_aVisibleEntityPtrs;
      }
      else
      {
        v36 = (EntityInfo_0 ***)&CRenderer::ms_nNoOfVisibleLods;
        v37 = &CRenderer::ms_aVisibleLodPtrs;
      }
      v32 = *v36;
      v38 = *v32;
      (**v37)[(_DWORD)*v32] = (int)pEntity;
      v34 = (EntityInfo_0 *)((char *)&v38->pEntity + 1);
      goto LABEL_71;
    }
    return 0;
  }
  result = ENTITY_INVISIBLE;
  if ( (float)(dist - (float)(v17 + (float)(v17 + 10.0))) < v21 )
  {
    v27 = !doStream;
    if ( doStream )
      v27 = (m_nFlags & 0x80) == 0;
    if ( !v27 )
    {
      if ( !pEntity->m_pRwObject )
        (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 8))(pEntity);
      return 3;
    }
  }
  return result;
}
// 412422: variable 'v6' is possibly undefined
// 412422: variable 'v5' is possibly undefined
// 412438: variable 'v4' is possibly undefined
// 676210: using guessed type int CRenderer::ms_nNoOfVisibleLods;
// 676474: using guessed type int (*CRenderer::ms_aVisibleLodPtrs)[1000];
// 6771F0: using guessed type int *CRenderer::ms_nNoOfVisibleEntities;
// 6778EC: using guessed type int (*CRenderer::ms_aVisibleEntityPtrs)[1000];

//----- (004126F0) --------------------------------------------------------
void CRopes::Init()
{
  CRopes::aRopes[5].RopeType = 0;
  CRopes::aRopes[6].RopeType = 0;
  CRopes::aRopes[7].RopeType = 0;
  CRopes::aRopes[1].RopeType = 0;
  CRopes::aRopes[0].RopeType = 0;
  CRopes::aRopes[2].RopeType = 0;
  CRopes::aRopes[3].RopeType = 0;
  CRopes::aRopes[4].RopeType = 0;
  CRopes::PlayerControlsCrane = 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00412730) --------------------------------------------------------
void CRopes::Update()
{
  if ( CRopes::aRopes[0].RopeType )
    CRope::Update(CRopes::aRopes);
  if ( CRopes::aRopes[1].RopeType )
    CRope::Update(&CRopes::aRopes[1]);
  if ( CRopes::aRopes[2].RopeType )
    CRope::Update(&CRopes::aRopes[2]);
  if ( CRopes::aRopes[3].RopeType )
    CRope::Update(&CRopes::aRopes[3]);
  if ( CRopes::aRopes[4].RopeType )
    CRope::Update(&CRopes::aRopes[4]);
  if ( CRopes::aRopes[5].RopeType )
    CRope::Update(&CRopes::aRopes[5]);
  if ( CRopes::aRopes[6].RopeType )
    CRope::Update(&CRopes::aRopes[6]);
  if ( CRopes::aRopes[7].RopeType )
    CRope::Update(&CRopes::aRopes[7]);
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00412850) --------------------------------------------------------
void __fastcall CRope::Update(CRope *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d8
  float32x2_t v4; // d9
  float x; // s18
  float y; // s16
  float v8; // s20
  CSimpleTransform *p_tx; // r2
  float v10; // s22
  float v11; // r5
  char v12; // r1
  float z; // s2
  RwReal v14; // s0
  float GroundZFor3DCoord; // r0
  CPhysical *m_pWinchCarriedObject; // r0
  int m_nModelIndex; // r0
  CObject *m_pWinchHookObject; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_m_transform; // r2
  unsigned int FixedAtNode; // r0
  int v22; // r6
  CVector *v23; // r5
  float v24; // s20
  float v25; // s28
  float v26; // s30
  char v27; // r0
  float v28; // s4
  float v29; // s0
  float v30; // s10
  RwReal v31; // s6
  float v32; // s4
  float v33; // s8
  float v34; // s6
  float v35; // s10
  float v36; // s0
  float v37; // s12
  RwReal v38; // s2
  RwReal v39; // s4
  float v40; // s6
  int RopeType; // r1
  unsigned int v42; // r0
  bool v43; // zf
  bool v44; // zf
  bool v45; // zf
  _BOOL4 v46; // r1
  CPad *v47; // r0
  __int16 CarGunUpDown; // r5
  _BOOL4 v49; // r0
  float v50; // s16
  float v51; // s16
  unsigned int v52; // r0
  _BOOL4 IsTouched; // r0
  float v54; // s16
  float v55; // s16
  unsigned int v56; // r0
  CPhysical **p_m_pWinchCarriedObject; // r8
  CObject *v58; // r5
  float32x2_t v59; // d0
  float v60; // s20
  CMatrix *v61; // r0
  float *p_x; // r6
  CVector *p_m_translate; // r3
  RwReal v64; // r1
  CMatrix *v65; // r3
  RwReal v66; // r0
  RwReal *p_tz; // r1
  CPhysical *pConnectedTo; // r1
  CMatrix *v69; // r0
  float *v70; // r2
  float v71; // s10
  RwReal v72; // s2
  float v73; // s24
  float v74; // s26
  float v75; // s22
  float v76; // s28
  float v77; // s23
  float v78; // s30
  CMatrix *v79; // r0
  RwReal v80; // s0
  RwReal v81; // s4
  float v82; // s6
  RwReal v83; // s2
  float v84; // s8
  RwReal v85; // s0
  float v86; // s10
  RwReal v87; // s4
  float v88; // s12
  float v89; // s12
  float v90; // s14
  float v91; // s1
  float v92; // s8
  float v93; // s6
  float v94; // s10
  CPhysical *v95; // r0
  RwReal v96; // s6
  CMatrix *v97; // r0
  CPhysical *v98; // r4
  __int64 v99; // r0
  __int64 v100; // d16
  __int64 v101; // kr00_8
  float v102; // r1
  int v103; // r3
  float v104; // r0
  float *v105; // r1
  int v106; // r0
  bool v107; // zf
  bool v108; // zf
  bool v109; // zf
  CPad *Pad; // r0
  CObject *v111; // r0
  CEntity::CFlags v112; // kr08_8
  CPhysical *v113; // r0
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r1
  CObject *v115; // r0
  int v116; // r1
  bool v117; // zf
  CObject *v118; // r0
  CEntity::CFlags v119; // kr10_8
  int v120; // r4
  float v121; // s18
  float32x2_t v122; // d10
  int v123; // r12
  int v124; // r3
  int v125; // lr
  int v126; // r5
  CPedPool *v127; // r10
  int32 m_nSize; // r0
  int v129; // r4
  int v130; // r5
  CPool<CPed,CCopPed>::StorageType *m_aStorage; // r6
  uint8 *v132; // r9
  bool v133; // zf
  int v134; // r8
  _BOOL4 IsPlayer; // r0
  float32x2_t *v136; // r0
  float32x2_t *v137; // r1
  float32x2_t v138; // d16
  unsigned __int64 v139; // d1
  float v140; // s0
  int v141; // r2
  unsigned __int8 v142; // r0
  int v143; // r2
  int v144; // r1
  CVehiclePool *v145; // r10
  int32 v146; // r0
  int v147; // r8
  int v148; // r9
  CPool<CVehicle,CHeli>::StorageType *v149; // r0
  uint8 *v150; // r6
  unsigned int v151; // r1
  int v152; // r1
  bool v153; // zf
  const CMatrix *v154; // r1
  float v155; // r0
  float32x2_t v156; // d16
  float v157; // s24
  unsigned __int64 v158; // d1
  char v159; // r0
  __int64 v160; // kr18_8
  const CMatrix *v161; // r1
  float v162; // r0
  float v163; // r1
  int v164; // r3
  float v165; // r0
  float *v166; // r1
  bool v167; // zf
  CObjectPool *v168; // r2
  int32 v169; // r8
  int v170; // r9
  int v171; // r6
  int v172; // r10
  CPool<CObject,CCutsceneObject>::StorageType *v173; // r1
  uint8 *v174; // r5
  int v175; // r2
  uint8 *v176; // r0
  int v177; // r1
  const CMatrix *v178; // r1
  float v179; // r0
  float32x2_t v180; // d14
  int v181; // r0
  float v182; // s24
  const CMatrix *v183; // r1
  float v184; // s0
  unsigned __int64 v185; // d13
  const CMatrix *v186; // r1
  float v187; // s28
  const CMatrix *v188; // r1
  float v189; // s0
  float32x2_t v190; // d16
  unsigned __int64 v191; // d1
  CPhysical *v192; // r1
  CObject *v193; // r1
  CEntity::CFlags m_nFlags; // kr20_8
  CObject **p_m_pWinchHookObject; // r4
  CObject *v196; // r0
  CObject *v197; // r4
  CMatrix *v198; // r1
  float v199; // r0
  float v200; // r1
  CMatrix *v201; // r3
  float v202; // r0
  float *v203; // r1
  CPhysical *v204; // r0
  int v205; // r0
  CMatrix *v206; // r1
  float v207; // s0
  __int64 v208; // d16
  float v209; // s2
  float v210; // s4
  float *p_xx; // r1
  CObject *v212; // r4
  CMatrix *v213; // r1
  float v214; // r0
  float yx; // r1
  CMatrix *v216; // r3
  float zx; // r0
  float *p_z; // r1
  CEntity **ppEnt; // [sp+0h] [bp-198h]
  int v220; // [sp+64h] [bp-134h]
  int v221; // [sp+68h] [bp-130h]
  int v222; // [sp+6Ch] [bp-12Ch]
  CObjectPool *v223; // [sp+6Ch] [bp-12Ch]
  int v224; // [sp+70h] [bp-128h]
  CPhysical **ppAddress; // [sp+74h] [bp-124h]
  uint8 *v226; // [sp+78h] [bp-120h]
  CEntity *v227; // [sp+7Ch] [bp-11Ch]
  CPhysical *v228; // [sp+7Ch] [bp-11Ch]
  CMatrix v229; // [sp+80h] [bp-118h] BYREF
  CMatrix v230; // [sp+C8h] [bp-D0h] BYREF
  CVector v231; // [sp+114h] [bp-84h] BYREF
  CVector v; // [sp+120h] [bp-78h] BYREF
  CVector pNewWeightCoors; // [sp+12Ch] [bp-6Ch] BYREF
  CVector v234; // 0:r1.12
  CVector v235; // 0:r1.12
  CVector v236; // 0:r2.8,8:^0.4

  x = this->aCoors[0].x;
  y = this->aCoors[0].y;
  v8 = CTimer::ms_fTimeStep;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v10 = sqrtf(
          (float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
        + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)));
  v11 = powf(0.8, CTimer::ms_fTimeStep);
  if ( v10 < 200.0 )
  {
    v12 = *((_BYTE *)this + 807);
    if ( (v12 & 1) == 0 && CTimer::m_snTimeInMilliseconds > this->TimeToBeKeptAliveTill )
    {
      z = this->aCoors[0].z;
      v14 = this->aSpeeds[0].z + (float)(v8 * -0.0015);
      x = (float)(v8 * this->aSpeeds[0].x) + x;
      y = (float)(v8 * this->aSpeeds[0].y) + y;
      this->aSpeeds[0].z = v14;
      this->aCoors[0].x = x;
      this->aCoors[0].y = y;
      this->aCoors[0].z = (float)(v8 * v14) + z;
    }
    if ( (v12 & 4) != 0 && (CTimer::m_FrameCounter & 7) == 2 )
    {
      GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(x, y, this->aCoors[0].z, 0, 0);
      v12 = *((_BYTE *)this + 807);
      this->GroundHeight = GroundZFor3DCoord;
    }
    if ( (v12 & 4) != 0 )
    {
      m_pWinchCarriedObject = this->m_pWinchCarriedObject;
      if ( m_pWinchCarriedObject )
      {
        if ( (*(_BYTE *)&m_pWinchCarriedObject->m_info & 7) == 2
          || (m_nModelIndex = m_pWinchCarriedObject->m_nModelIndex, m_nModelIndex == MI_OBJECTFORMAGNOCRANE1)
          || m_nModelIndex == MI_OBJECTFORMAGNOCRANE2
          || m_nModelIndex == MI_OBJECTFORMAGNOCRANE3
          || m_nModelIndex == MI_OBJECTFORMAGNOCRANE5 )
        {
          m_pWinchHookObject = this->m_pWinchHookObject;
          m_pMat = m_pWinchHookObject->m_pMat;
          p_m_transform = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_m_transform = &m_pWinchHookObject->m_transform;
          this->GroundHeight = p_m_transform->m_translate.z + -0.5;
        }
      }
    }
    FixedAtNode = this->FixedAtNode;
    if ( FixedAtNode <= 0x1E )
    {
      v22 = FixedAtNode - 1;
      v3.n64_f32[0] = v11;
      v23 = &this->aCoors[FixedAtNode];
      v24 = 1.0 - v3.n64_f32[0];
      do
      {
        v25 = v23[1].x;
        v3.n64_u32[1] = LODWORD(v23[1].y);
        v26 = v23[1].z;
        v23[33].x = v23[33].x + (float)((float)((rand() & 0xF) - 8) * 0.001);
        v27 = rand();
        ++v22;
        v28 = v24 * v23[32].y;
        v29 = v23[33].y + (float)((float)((v27 & 0xF) - 8) * 0.001);
        v30 = v23[1].z;
        v31 = (float)(v24 * v23[32].z) + (float)(v3.n64_f32[0] * v23[33].z);
        v23[33].x = (float)(v24 * v23[32].x) + (float)(v3.n64_f32[0] * v23[33].x);
        v23[33].y = v28 + (float)(v3.n64_f32[0] * v29);
        v23[33].z = v31;
        v1.n64_f32[0] = v30 + (float)(CTimer::ms_fTimeStep * -0.15);
        LODWORD(v23[1].z) = v1.n64_u32[0];
        if ( (*((_BYTE *)this + 807) & 4) != 0 )
        {
          v2.n64_f32[0] = this->GroundHeight + 0.3;
          v1.n64_u32[0] = vmax_f32(v1, v2).n64_u32[0];
          LODWORD(v23[1].z) = v1.n64_u32[0];
        }
        v32 = v23->y;
        v33 = v23[1].x - v23->x;
        v34 = v23->z;
        v35 = v23[1].y - v32;
        v36 = v1.n64_f32[0] - v34;
        v1.n64_f32[1] = v36 * v36;
        v37 = this->m_SegmentLength / sqrtf((float)((float)(v33 * v33) + (float)(v35 * v35)) + (float)(v36 * v36));
        v1.n64_f32[0] = v34 + (float)(v36 * v37);
        v38 = v23->x + (float)(v33 * v37);
        v39 = v32 + (float)(v35 * v37);
        v23[1].x = v38;
        v23[1].y = v39;
        LODWORD(v23[1].z) = v1.n64_u32[0];
        v40 = 1.0 / CTimer::ms_fTimeStep;
        v23[33].x = (float)(1.0 / CTimer::ms_fTimeStep) * (float)(v38 - v25);
        v23[33].y = v40 * (float)(v39 - v3.n64_f32[1]);
        v23[33].z = v40 * (float)(v1.n64_f32[0] - v26);
        ++v23;
      }
      while ( v22 < 30 );
    }
    RopeType = this->RopeType;
    v42 = (unsigned __int8)(RopeType - 1);
    if ( v42 > 6 )
    {
LABEL_238:
      if ( !(*((unsigned __int8 *)this + 807) << 31) && this->aCoors[0].z < -50.0 )
      {
        v192 = this->m_pWinchCarriedObject;
        this->RopeType = 0;
        if ( v192 )
        {
          *(_DWORD *)&v192->m_nPhysicalFlags &= ~0x2000000u;
          *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x80000000;
          v193 = this->m_pWinchHookObject;
          this->m_pWinchCarriedObject = 0;
          m_nFlags = v193->m_nFlags;
          *(_DWORD *)&v193->m_nFlags = *(_DWORD *)&m_nFlags | 1;
          v193->m_nFlags.bdummy = m_nFlags.bdummy;
          this->m_WinchDisabled = 60;
        }
        p_m_pWinchHookObject = &this->m_pWinchHookObject;
        v196 = this->m_pWinchHookObject;
        if ( v196 )
        {
          CWorld::Remove(v196);
          if ( *p_m_pWinchHookObject )
            (*((void (__fastcall **)(CObject *))(*p_m_pWinchHookObject)->_vptr$CPlaceable + 1))(*p_m_pWinchHookObject);
          *p_m_pWinchHookObject = 0;
        }
      }
      *((_BYTE *)this + 807) &= ~1u;
      return;
    }
    v43 = RopeType == 4;
    if ( RopeType == 4 )
      v43 = CRopes::PlayerControlsCrane == 1;
    if ( !v43 )
    {
      v44 = RopeType == 5;
      if ( RopeType == 5 )
        v44 = CRopes::PlayerControlsCrane == 2;
      if ( !v44 )
      {
        v45 = RopeType == 7;
        if ( RopeType == 7 )
          v45 = CRopes::PlayerControlsCrane == 3;
        if ( !v45 )
        {
          v46 = (RopeType ^ 6 | CRopes::PlayerControlsCrane ^ 4) == 0;
          if ( v42 >= 3 && !v46 )
          {
LABEL_77:
            v3.n64_u32[0] = 1008981770;
            p_m_pWinchCarriedObject = &this->m_pWinchCarriedObject;
            v1.n64_u32[0] = LODWORD(this->m_fWinchHeight);
            v4.n64_u32[0] = 1063675494;
            v58 = (CObject *)this->m_pWinchCarriedObject;
            v59.n64_u64[0] = vmin_f32(vmax_f32(v1, v3), v4).n64_u64[0];
            LODWORD(this->m_fWinchHeight) = v59.n64_u32[0];
            if ( v58 )
            {
              v59.n64_f32[0] = (float)(v58->m_fMass * 0.00010833) + 0.06;
              if ( v58->m_nModelIndex == 428 )
                v59.n64_u32[0] = 1041277911;
              v2.n64_u32[0] = 0.5;
              v58->m_nNoOfStaticFrames = 0;
              LODWORD(v60) = vmin_f32(v59, v2).n64_u32[0];
            }
            else
            {
              v58 = this->m_pWinchHookObject;
              *(_DWORD *)&v58->m_nFlags |= 1u;
              if ( !v58 )
                goto LABEL_106;
              v60 = 0.06;
            }
            v61 = v58->m_pMat;
            p_x = &v58->m_transform.m_translate.x;
            p_m_translate = &v58->m_transform.m_translate;
            if ( v61 )
              p_m_translate = (CVector *)&v61->tx;
            if ( CRope::UpdateWeightInRope(this, *p_m_translate, *(float *)&ppEnt, &pNewWeightCoors) == 1 )
            {
              v64 = pNewWeightCoors.y;
              v65 = v58->m_pMat;
              v66 = pNewWeightCoors.z;
              if ( v65 )
              {
                v65->tx = pNewWeightCoors.x;
                v58->m_pMat->ty = v64;
                p_tz = &v58->m_pMat->tz;
              }
              else
              {
                v58->m_transform.m_translate.x = pNewWeightCoors.x;
                v58->m_transform.m_translate.y = v64;
                p_tz = &v58->m_transform.m_translate.z;
              }
              *p_tz = v66;
              pConnectedTo = this->pConnectedTo;
              v69 = pConnectedTo->m_pMat;
              v70 = &v69->tx;
              if ( !v69 )
                v70 = &pConnectedTo->m_transform.m_translate.x;
              v71 = v70[2];
              v72 = this->aCoors[0].y - v70[1];
              v73 = v58->m_vecMoveSpeed.x;
              v74 = v58->m_vecMoveSpeed.y;
              v75 = v58->m_vecMoveSpeed.z;
              v236.x = this->aCoors[0].x - *v70;
              v236.y = v72;
              v236.z = this->aCoors[0].z - v71;
              CPhysical::GetSpeed(&v, pConnectedTo, v236);
              if ( (this->RopeType & 0xFC) == 4 )
              {
                v76 = 0.0;
                memset(&v, 0, sizeof(v));
                v77 = 0.0;
                v78 = 0.0;
              }
              else
              {
                v78 = v.x;
                v77 = v.y;
                v76 = v.z;
              }
              v79 = v58->m_pMat;
              if ( v79 )
                p_x = &v79->tx;
              v80 = *p_x - this->aCoors[0].x;
              v81 = p_x[2] - this->aCoors[0].z;
              v231.y = p_x[1] - this->aCoors[0].y;
              v231.x = v80;
              v231.z = v81;
              CVector::Normalise(&v231);
              v82 = v74 - v77;
              v83 = v231.y;
              v84 = v73 - v78;
              v85 = v231.x;
              v86 = v75 - v76;
              v87 = v231.z;
              v88 = (float)((float)((float)(v73 - v78) * v231.x) + (float)((float)(v74 - v77) * v231.y))
                  + (float)((float)(v75 - v76) * v231.z);
              if ( v88 > 0.0 )
              {
                v86 = v86 - (float)(v231.z * v88);
                v82 = v82 - (float)(v231.y * v88);
                v84 = v84 - (float)(v231.x * v88);
              }
              v89 = v58->m_vecMoveSpeed.x;
              v90 = v58->m_vecMoveSpeed.y;
              v91 = v58->m_vecMoveSpeed.z;
              v92 = (float)(v84 + v.x) - v89;
              v93 = (float)(v82 + v.y) - v90;
              v94 = (float)(v86 + v.z) - v91;
              v58->m_vecMoveSpeed.x = v89 + (float)((float)(1.0 - v60) * v92);
              v58->m_vecMoveSpeed.y = v90 + (float)((float)(1.0 - v60) * v93);
              v58->m_vecMoveSpeed.z = v91 + (float)((float)(1.0 - v60) * v94);
              v95 = this->pConnectedTo;
              v59.n64_u32[1] = LODWORD(v95->m_vecMoveSpeed.z);
              v96 = v95->m_vecMoveSpeed.y - (float)(v60 * v93);
              v95->m_vecMoveSpeed.x = v95->m_vecMoveSpeed.x - (float)(v60 * v92);
              v95->m_vecMoveSpeed.y = v96;
              v95->m_vecMoveSpeed.z = v59.n64_f32[1] - (float)(v60 * v94);
              if ( this->m_pWinchCarriedObject )
              {
                CMatrix::CMatrix(&v230, v58->m_pMat);
                LODWORD(v234.x) = LODWORD(v231.x) ^ 0x80000000;
                *(_QWORD *)&v234.y = *(_QWORD *)&v231.y ^ 0x8000000080000000LL;
                CMatrix::ForceUpVector(v58->m_pMat, v234);
                CMatrix::CMatrix(&v229, v58->m_pMat);
                v58->m_pMat->xx = (float)(v229.xx * 0.1) + (float)(v230.xx * 0.9);
                v58->m_pMat->yx = (float)(v229.yx * 0.1) + (float)(v230.yx * 0.9);
                v58->m_pMat->zx = (float)(v229.zx * 0.1) + (float)(v230.zx * 0.9);
                v58->m_pMat->xy = (float)(v229.xy * 0.1) + (float)(v230.xy * 0.9);
                v58->m_pMat->yy = (float)(v229.yy * 0.1) + (float)(v230.yy * 0.9);
                v58->m_pMat->zy = (float)(v229.zy * 0.1) + (float)(v230.zy * 0.9);
                v58->m_pMat->xz = (float)(v229.xz * 0.1) + (float)(v230.xz * 0.9);
                v58->m_pMat->yz = (float)(v229.yz * 0.1) + (float)(v230.yz * 0.9);
                v58->m_pMat->zz = (float)(v229.zz * 0.1) + (float)(v230.zz * 0.9);
                CMatrix::~CMatrix(v97);
                CMatrix::~CMatrix(&v230);
              }
              else
              {
                LODWORD(v235.x) = LODWORD(v85) ^ 0x80000000;
                LODWORD(v235.y) = LODWORD(v83) ^ 0x80000000;
                LODWORD(v235.z) = LODWORD(v87) ^ 0x80000000;
                CMatrix::ForceUpVector(v58->m_pMat, v235);
              }
            }
            v98 = 0;
            if ( !*p_m_pWinchCarriedObject )
            {
LABEL_107:
              if ( v98 )
              {
                v106 = this->RopeType;
                v107 = v106 == 4;
                if ( v106 == 4 )
                  v107 = CRopes::PlayerControlsCrane == 1;
                if ( v107 )
                  goto LABEL_266;
                v108 = v106 == 5;
                if ( v106 == 5 )
                  v108 = CRopes::PlayerControlsCrane == 2;
                if ( v108 )
                  goto LABEL_266;
                v109 = v106 == 7;
                if ( v106 == 7 )
                  v109 = CRopes::PlayerControlsCrane == 3;
                if ( v109 )
                  goto LABEL_266;
                v141 = v106 ^ 6;
                v142 = v106 - 1;
                v43 = (CRopes::PlayerControlsCrane ^ 4 | v141) == 0;
                v143 = 0;
                v144 = 0;
                if ( v43 )
                  v143 = 1;
                if ( v142 < 3u )
                  v144 = 1;
                if ( (v144 | v143) == 1 )
                {
LABEL_266:
                  if ( CTheScripts::bEnableCraneRelease )
                  {
                    Pad = CPad::GetPad(0);
                    if ( CPad::CraneReleaseJustDown(Pad) )
                    {
                      if ( *p_m_pWinchCarriedObject )
                      {
                        *(_DWORD *)&(*p_m_pWinchCarriedObject)->m_nPhysicalFlags &= ~0x2000000u;
                        *(_DWORD *)&(*p_m_pWinchCarriedObject)->m_nPhysicalFlags &= ~0x80000000;
                        *p_m_pWinchCarriedObject = 0;
                      }
                      v111 = this->m_pWinchHookObject;
                      v112 = v111->m_nFlags;
                      *(_DWORD *)&v111->m_nFlags = *(_DWORD *)&v112 | 1;
                      v111->m_nFlags.bdummy = v112.bdummy;
                      this->m_WinchDisabled = 60;
                    }
                  }
                }
                v113 = *p_m_pWinchCarriedObject;
                if ( *p_m_pWinchCarriedObject )
                {
                  m_nPhysicalFlags = v113->m_nPhysicalFlags;
                  if ( (*(_DWORD *)&m_nPhysicalFlags & 0x20000000) == 0
                    || (v113->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags & 0xFDFFFFFF),
                        *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x80000000,
                        v115 = this->m_pWinchHookObject,
                        this->m_pWinchCarriedObject = 0,
                        *(_DWORD *)&v115->m_nFlags |= 1u,
                        v113 = this->m_pWinchCarriedObject,
                        this->m_WinchDisabled = 60,
                        v113) )
                  {
                    v116 = *(_BYTE *)&v113->m_info & 7;
                    v117 = v116 == 2;
                    if ( v116 == 2 )
                      v117 = v113[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)byte_9;
                    if ( v117 && LODWORD(v113[3].m_vecCOM.z) )
                    {
                      *(_DWORD *)&v113->m_nPhysicalFlags &= ~0x2000000u;
                      *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x80000000;
                      v118 = this->m_pWinchHookObject;
                      this->m_pWinchCarriedObject = 0;
                      v119 = v118->m_nFlags;
                      *(_DWORD *)&v118->m_nFlags = *(_DWORD *)&v119 | 1;
                      v118->m_nFlags.bdummy = v119.bdummy;
                      this->m_WinchDisabled = 60;
                    }
                  }
                }
                goto LABEL_238;
              }
              if ( this->m_WinchDisabled )
              {
                --this->m_WinchDisabled;
                goto LABEL_238;
              }
              ppAddress = &this->m_pWinchCarriedObject;
              v120 = 0;
              v121 = this->aCoors[31].z;
              v122.n64_u64[0] = *(unsigned __int64 *)&this->aCoors[31].x;
              v123 = -2566;
              v124 = 1;
              v125 = 0;
              v126 = 0;
              v227 = 0;
              switch ( this->RopeType )
              {
                case 1u:
                  goto LABEL_160;
                case 2u:
                  if ( *ppAddress )
                    goto LABEL_148;
                  v127 = CPools::ms_pPedPool;
                  m_nSize = CPools::ms_pPedPool->m_nSize;
                  if ( !m_nSize )
                    goto LABEL_148;
                  v129 = m_nSize - 1;
                  v130 = 1996 * m_nSize - 896;
                  while ( 1 )
                  {
                    if ( (v127->m_aFlags[v129] & 0x80u) == 0 )
                    {
                      m_aStorage = v127->m_aStorage;
                      v132 = &(*v127->m_aStorage)[v130];
                      v133 = v132 == (uint8 *)&elf_hash_bucket[212];
                      if ( v132 != (uint8 *)&elf_hash_bucket[212] )
                        v133 = *(_DWORD *)&(*m_aStorage)[v130] == 55;
                      if ( !v133 )
                      {
                        v228 = (CPhysical *)(v132 - 1100);
                        v134 = v123;
                        IsPlayer = CPed::IsPlayer((const CPed *)(v132 - 1100));
                        v123 = v134;
                        if ( !IsPlayer && !(v132[57] << 31) )
                        {
                          v136 = (float32x2_t *)*((_DWORD *)v132 - 270);
                          v137 = v136 + 6;
                          if ( !v136 )
                            v137 = (float32x2_t *)(v132 - 1096);
                          v138.n64_u64[0] = vsub_f32((float32x2_t)v137->n64_u64[0], v122).n64_u64[0];
                          v139 = vmul_f32(v138, v138).n64_u64[0];
                          v140 = sqrtf(
                                   (float)(*(float *)&v139 + *((float *)&v139 + 1))
                                 + (float)((float)(v137[1].n64_f32[0] - v121) * (float)(v137[1].n64_f32[0] - v121)));
                          if ( v140 < 2.5 )
                            break;
                        }
                      }
                    }
                    --v129;
                    v130 -= 1996;
                    if ( v129 == -1 )
                      goto LABEL_148;
                  }
                  this->m_pWinchCarriedObject = v228;
                  CEntity::RegisterReference(v228, ppAddress);
                  *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags |= 0x80000000;
                  v212 = this->m_pWinchHookObject;
                  v213 = this->m_pWinchCarriedObject->m_pMat;
                  v214 = CModelInfo::ms_modelInfoPtrs[*(__int16 *)&(*m_aStorage)[v134 + 1504 + v130]]->m_pColModel->m_boxBound.m_vecMax.z;
                  v229.xx = 0.0;
                  v229.yx = 0.0;
                  v229.zx = v214;
                  operator*((CVector *)&v230, v213, (const CVector *)&v229);
                  yx = v230.yx;
                  v216 = v212->m_pMat;
                  zx = v230.zx;
                  if ( v216 )
                  {
                    v216->tx = v230.xx;
                    v212->m_pMat->ty = yx;
                    p_z = &v212->m_pMat->tz;
                  }
                  else
                  {
                    v212->m_transform.m_translate.x = v230.xx;
                    v212->m_transform.m_translate.y = yx;
                    p_z = &v212->m_transform.m_translate.z;
                  }
                  v59.n64_f32[0] = v121 - v140;
                  *p_z = zx;
                  *(_DWORD *)&this->m_pWinchHookObject->m_nFlags &= ~1u;
                  if ( v59.n64_f32[0] > 0.0 )
                  {
                    v59.n64_f32[0] = (float)(this->m_fWinchHeight - (float)(v59.n64_f32[0] / this->m_RopeLength))
                                   - (float)(this->m_SegmentLength / this->m_RopeLength);
                    v59.n64_u64[0] = vmax_f32(v59, v3).n64_u64[0];
                    LODWORD(this->m_fWinchHeight) = v59.n64_u32[0];
                  }
LABEL_148:
                  v120 = 0;
LABEL_149:
                  v125 = 0;
                  v227 = 0;
                  goto LABEL_187;
                case 3u:
                  v126 = 1;
                  v120 = 0;
                  v125 = 0;
                  goto LABEL_160;
                case 4u:
                  v125 = 1;
                  v120 = 0;
                  goto LABEL_159;
                case 5u:
                  goto LABEL_187;
                case 6u:
                  v125 = 0;
                  v120 = 1;
LABEL_159:
                  v126 = 0;
LABEL_160:
                  v227 = (CEntity *)v120;
                  v145 = CPools::ms_pVehiclePool;
                  v146 = CPools::ms_pVehiclePool->m_nSize;
                  if ( !v146 )
                    goto LABEL_186;
                  v147 = v146 - 1;
                  v148 = 2604 * v146 - 1160;
                  break;
                case 7u:
                  goto LABEL_192;
                default:
                  goto LABEL_149;
              }
              while ( 1 )
              {
                if ( (v145->m_aFlags[v147] & 0x80u) == 0 )
                {
                  v149 = v145->m_aStorage;
                  v150 = &(*v145->m_aStorage)[v148];
                  if ( v150 != (uint8 *)&elf_hash_bucket[298] )
                  {
                    v151 = *(_DWORD *)&(*v149)[v148];
                    if ( v151 < 2 || v151 == 9 && !*((_DWORD *)v150 - 80) )
                      goto LABEL_174;
                    v152 = *(__int16 *)&(*v149)[v148 - 1406];
                    v153 = v152 == 539;
                    if ( v152 != 539 )
                      v153 = v152 == 473;
                    if ( v153 )
                    {
LABEL_174:
                      if ( (*(v150 - 1373) & 0x20) == 0
                        && (*(v150 - 371) & 0x10) != 0
                        && (v126 != 1 || *(_WORD *)&(*v149)[v148 - 1406] == 564)
                        && (*(v150 - 242) & 0x60) == 0 )
                      {
                        v154 = (const CMatrix *)*((_DWORD *)v150 - 356);
                        v222 = (int)&(*v149)[v148 - 2566];
                        v155 = CModelInfo::ms_modelInfoPtrs[*(__int16 *)(v222 + 1160)]->m_pColModel->m_boxBound.m_vecMax.z;
                        v229.xx = 0.0;
                        v229.yx = 0.0;
                        v229.zx = v155;
                        operator*((CVector *)&v230, v154, (const CVector *)&v229);
                        v156.n64_u64[0] = vsub_f32(*(float32x2_t *)&v230.xx, v122).n64_u64[0];
                        v157 = v230.zx;
                        v158 = vmul_f32(v156, v156).n64_u64[0];
                        if ( sqrtf(
                               (float)(*(float *)&v158 + *((float *)&v158 + 1))
                             + (float)((float)(v230.zx - v121) * (float)(v230.zx - v121))) < 2.5 )
                          break;
                      }
                    }
                  }
                }
                --v147;
                v148 -= 2604;
                if ( v147 == -1 )
                {
                  v120 = v126;
                  goto LABEL_187;
                }
              }
              *ppAddress = (CPhysical *)(v150 - 1444);
              CEntity::RegisterReference((CEntity *)(v150 - 1444), ppAddress);
              *(_DWORD *)&(*ppAddress)->m_nPhysicalFlags |= 0x80000000;
              v159 = *(_BYTE *)(v222 + 1180);
              if ( (v159 & 0xF8) == 16 )
                *(_BYTE *)(v222 + 1180) = v159 & 7 | 0x18;
              v160 = *(_QWORD *)&this->m_pWinchHookObject;
              v161 = *(const CMatrix **)(HIDWORD(v160) + 20);
              v162 = CModelInfo::ms_modelInfoPtrs[*(__int16 *)(v222 + 1160)]->m_pColModel->m_boxBound.m_vecMax.z;
              v229.xx = 0.0;
              v229.yx = 0.0;
              v229.zx = v162;
              operator*((CVector *)&v230, v161, (const CVector *)&v229);
              v163 = v230.yx;
              v164 = *(_DWORD *)(v160 + 20);
              v165 = v230.zx;
              if ( v164 )
              {
                *(float *)(v164 + 48) = v230.xx;
                *(float *)(*(_DWORD *)(v160 + 20) + 52) = v163;
                v166 = (float *)(*(_DWORD *)(v160 + 20) + 56);
              }
              else
              {
                *(float *)(v160 + 4) = v230.xx;
                *(float *)(v160 + 8) = v163;
                v166 = (float *)(v160 + 12);
              }
              *v166 = v165;
              *(_DWORD *)&this->m_pWinchHookObject->m_nFlags &= ~1u;
              if ( (float)(v121 - v157) > 0.0 )
              {
                v59.n64_f32[0] = (float)(this->m_fWinchHeight - (float)((float)(v121 - v157) / this->m_RopeLength))
                               - (float)(this->m_SegmentLength / this->m_RopeLength);
                v59.n64_u64[0] = vmax_f32(v59, v3).n64_u64[0];
                LODWORD(this->m_fWinchHeight) = v59.n64_u32[0];
              }
LABEL_186:
              v120 = v126;
LABEL_187:
              v167 = v120 == 0;
              v124 = 0;
              if ( !v120 )
                v167 = v125 == 0;
              if ( !v167 || v227 == (CEntity *)((char *)&dword_0 + 1) )
              {
LABEL_192:
                if ( *ppAddress )
                  goto LABEL_238;
                v168 = CPools::ms_pObjectPool;
                v169 = CPools::ms_pObjectPool->m_nSize;
                if ( !v169 )
                  goto LABEL_238;
                v170 = v169 - 1;
                v171 = 420 * v169 - 164;
                v223 = CPools::ms_pObjectPool;
                v224 = v125;
                v220 = v120;
                v221 = v124;
                while ( 1 )
                {
                  --v169;
                  if ( (v168->m_aFlags[v170] & 0x80u) != 0 )
                    goto LABEL_237;
                  v173 = v168->m_aStorage;
                  v174 = &(*v168->m_aStorage)[v171];
                  if ( v174 == (uint8 *)&elf_hash_bucket[1] || (v174[70] & 4) == 0 )
                    goto LABEL_237;
                  if ( v125 != 1
                    || (v175 = *((__int16 *)v174 - 109),
                        v226 = v174 - 218,
                        LOWORD(v176) = *((_WORD *)v174 - 109),
                        v175 != MI_OBJECTFORMAGNOCRANE1)
                    && v175 != MI_OBJECTFORMAGNOCRANE2
                    && v175 != MI_OBJECTFORMAGNOCRANE3
                    && v175 != MI_OBJECTFORMAGNOCRANE4
                    && (v124 = v221, v175 != MI_OBJECTFORMAGNOCRANE5) )
                  {
                    if ( v124 == 1
                      && (v176 = (uint8 *)*((__int16 *)v174 - 109), v176 == (uint8 *)MI_OBJECTFORBUILDINGSITECRANE1)
                      || v227 == (CEntity *)((char *)&dword_0 + 1)
                      && ((v176 = (uint8 *)*((__int16 *)v174 - 109), v176 == (uint8 *)MI_QUARY_ROCK1)
                       || v176 == (uint8 *)MI_QUARY_ROCK2
                       || v176 == (uint8 *)MI_QUARY_ROCK3
                       || v176 == (uint8 *)MI_DEAD_TIED_COP)
                      && !*(_DWORD *)&(*v173)[v171] )
                    {
                      v226 = &v173[v169][38];
                    }
                    else
                    {
                      v168 = v223;
                      if ( v120 != 1 )
                        goto LABEL_237;
                      v176 = v173[v169];
                      v177 = *((__int16 *)v174 - 109);
                      v226 = v176 + 38;
                      LOWORD(v176) = *((_WORD *)v174 - 109);
                      if ( v177 != MI_WONG_DISH && v177 != MI_KMB_ROCK && v177 != MI_KMB_PLANK )
                      {
                        v168 = v223;
                        if ( v177 != MI_KMB_BOMB )
                          goto LABEL_237;
                      }
                    }
                  }
                  v178 = (const CMatrix *)*((_DWORD *)v174 - 59);
                  v179 = CModelInfo::ms_modelInfoPtrs[(__int16)v176]->m_pColModel->m_boxBound.m_vecMax.z;
                  v229.xx = 0.0;
                  v229.yx = 0.0;
                  v229.zx = v179;
                  operator*((CVector *)&v230, v178, (const CVector *)&v229);
                  v180.n64_u64[0] = *(unsigned __int64 *)&v230.xx;
                  v181 = *(__int16 *)v226;
                  v182 = v230.zx;
                  if ( v181 == MI_OBJECTFORMAGNOCRANE1
                    || v181 == MI_OBJECTFORMAGNOCRANE2
                    || v181 == MI_OBJECTFORMAGNOCRANE3
                    || v181 == MI_OBJECTFORMAGNOCRANE5 )
                  {
                    v183 = (const CMatrix *)*((_DWORD *)v174 - 59);
                    v184 = CModelInfo::ms_modelInfoPtrs[v181]->m_pColModel->m_boxBound.m_vecMax.z;
                    v229.xx = 0.0;
                    v229.yx = 0.0;
                    v229.zx = -v184;
                    operator*((CVector *)&v230, v183, (const CVector *)&v229);
                    v185 = *(_QWORD *)&v230.xx;
                    v172 = 0;
                    if ( v230.zx <= v182 )
                    {
                      v185 = v180.n64_u64[0];
                    }
                    else
                    {
                      v182 = v230.zx;
                      v172 = 2;
                    }
                    v186 = (const CMatrix *)*((_DWORD *)v174 - 59);
                    v.x = CModelInfo::ms_modelInfoPtrs[*(__int16 *)v226]->m_pColModel->m_boxBound.m_vecMax.z;
                    v.y = 0.0;
                    v.z = 0.0;
                    operator*((CVector *)&v229, v186, &v);
                    v187 = v182;
                    v230.zx = v229.zx;
                    *(_QWORD *)&v230.xx = *(_QWORD *)&v229.xx;
                    if ( v229.zx > v182 )
                    {
                      v187 = v229.zx;
                      v172 = 3;
                    }
                    if ( v229.zx > v182 )
                      v185 = *(_QWORD *)&v230.xx;
                    v188 = (const CMatrix *)*((_DWORD *)v174 - 59);
                    v189 = CModelInfo::ms_modelInfoPtrs[*(__int16 *)v226]->m_pColModel->m_boxBound.m_vecMax.z;
                    v.y = 0.0;
                    v.z = 0.0;
                    v.x = -v189;
                    operator*((CVector *)&v229, v188, &v);
                    v182 = v187;
                    v230.zx = v229.zx;
                    *(_QWORD *)&v230.xx = *(_QWORD *)&v229.xx;
                    if ( v229.zx > v187 )
                    {
                      v182 = v229.zx;
                      v172 = 1;
                    }
                    if ( v229.zx > v187 )
                      v180.n64_u64[0] = *(unsigned __int64 *)&v230.xx;
                    else
                      v180.n64_u64[0] = v185;
                  }
                  else
                  {
                    v172 = 0;
                  }
                  v190.n64_u64[0] = vsub_f32(v180, v122).n64_u64[0];
                  v120 = v220;
                  v124 = v221;
                  v168 = v223;
                  v125 = v224;
                  v191 = vmul_f32(v190, v190).n64_u64[0];
                  if ( sqrtf(
                         (float)(*(float *)&v191 + *((float *)&v191 + 1))
                       + (float)((float)(v182 - v121) * (float)(v182 - v121))) < 2.5 )
                  {
                    this->m_pWinchCarriedObject = (CPhysical *)(v174 - 256);
                    CEntity::RegisterReference((CEntity *)(v174 - 256), ppAddress);
                    *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags |= 0x80000000;
                    v197 = this->m_pWinchHookObject;
                    v198 = this->m_pWinchCarriedObject->m_pMat;
                    v199 = CModelInfo::ms_modelInfoPtrs[*(__int16 *)v226]->m_pColModel->m_boxBound.m_vecMax.z;
                    v229.xx = 0.0;
                    v229.yx = 0.0;
                    v229.zx = v199;
                    operator*((CVector *)&v230, v198, (const CVector *)&v229);
                    v200 = v230.yx;
                    v201 = v197->m_pMat;
                    v202 = v230.zx;
                    if ( v201 )
                    {
                      v201->tx = v230.xx;
                      v197->m_pMat->ty = v200;
                      v203 = &v197->m_pMat->tz;
                    }
                    else
                    {
                      v197->m_transform.m_translate.x = v230.xx;
                      v197->m_transform.m_translate.y = v200;
                      v203 = &v197->m_transform.m_translate.z;
                    }
                    *v203 = v202;
                    *(_DWORD *)&this->m_pWinchHookObject->m_nFlags &= ~1u;
                    v204 = this->m_pWinchCarriedObject;
                    if ( (*(_DWORD *)&v204->m_nFlags & 0x40004) != 0 )
                    {
                      (*((void (__fastcall **)(CPhysical *, _DWORD))v204->_vptr$CPlaceable + 5))(v204, 0);
                      CPhysical::AddToMovingList(*ppAddress);
                      v204 = *ppAddress;
                    }
                    *(_DWORD *)&v204->m_nPhysicalFlags |= 0x2000000u;
                    if ( (float)(v121 - v182) > 0.0 )
                    {
                      v59.n64_f32[0] = (float)(this->m_fWinchHeight - (float)((float)(v121 - v182) / this->m_RopeLength))
                                     - (float)(this->m_SegmentLength / this->m_RopeLength);
                      LODWORD(this->m_fWinchHeight) = vmax_f32(v59, v3).n64_u32[0];
                    }
                    if ( v172 >= 1 )
                    {
                      v205 = v172 + 1;
                      do
                      {
                        --v205;
                        v206 = (*ppAddress)->m_pMat;
                        v207 = -v206->xx;
                        v208 = *(_QWORD *)&v206->xz;
                        v209 = -v206->yx;
                        v210 = -v206->zx;
                        v206->zx = v206->zz;
                        *(_QWORD *)&v206->xx = v208;
                        p_xx = &(*ppAddress)->m_pMat->xx;
                        p_xx[8] = v207;
                        p_xx[9] = v209;
                        p_xx[10] = v210;
                      }
                      while ( v205 > 1 );
                    }
                    goto LABEL_238;
                  }
LABEL_237:
                  --v170;
                  v171 -= 420;
                  if ( v170 == -1 )
                    goto LABEL_238;
                }
              }
              goto LABEL_238;
            }
            CMatrix::operator=(this->m_pWinchHookObject->m_pMat, (*p_m_pWinchCarriedObject)->m_pMat);
            v99 = *(_QWORD *)&this->m_pWinchHookObject;
            v100 = *(_QWORD *)(HIDWORD(v99) + 72);
            *(_DWORD *)(v99 + 80) = *(_DWORD *)(HIDWORD(v99) + 80);
            *(_QWORD *)(v99 + 72) = v100;
            v101 = *(_QWORD *)&this->m_pWinchHookObject;
            HIDWORD(v99) = *(_DWORD *)(HIDWORD(v101) + 20);
            *(RwReal *)&v99 = CModelInfo::ms_modelInfoPtrs[*(__int16 *)(HIDWORD(v101) + 38)]->m_pColModel->m_boxBound.m_vecMax.z;
            v229.xx = 0.0;
            v229.yx = 0.0;
            LODWORD(v229.zx) = v99;
            operator*((CVector *)&v230, (const CMatrix *)HIDWORD(v99), (const CVector *)&v229);
            v102 = v230.yx;
            v103 = *(_DWORD *)(v101 + 20);
            v104 = v230.zx;
            if ( v103 )
            {
              *(float *)(v103 + 48) = v230.xx;
              *(float *)(*(_DWORD *)(v101 + 20) + 52) = v102;
              v105 = (float *)(*(_DWORD *)(v101 + 20) + 56);
            }
            else
            {
              *(float *)(v101 + 4) = v230.xx;
              *(float *)(v101 + 8) = v102;
              v105 = (float *)(v101 + 12);
            }
            *v105 = v104;
LABEL_106:
            v98 = *p_m_pWinchCarriedObject;
            goto LABEL_107;
          }
        }
      }
    }
    if ( v42 <= 2 )
    {
      v47 = CPad::GetPad(0);
      CarGunUpDown = CPad::GetCarGunUpDown(v47, 0, 0, 2500.0, 0);
      if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_vehicleType == 3 )
      {
        if ( CTouchInterface::IsTouched(WIDGET_HELICOPTER_MAGNET_UP, 0, 1) )
          CarGunUpDown = -128;
        if ( CTouchInterface::IsTouched(WIDGET_HELICOPTER_MAGNET_DOWN, 0, 1) )
          CarGunUpDown = 128;
      }
      if ( CarGunUpDown <= -1 && CTheScripts::bEnableCraneRaise || CarGunUpDown >= 1 && CTheScripts::bEnableCraneLower )
      {
        v1.n64_f32[0] = this->m_fWinchHeight + (float)((float)(CTimer::ms_fTimeStep * (float)CarGunUpDown) * -0.00001);
        LODWORD(this->m_fWinchHeight) = v1.n64_u32[0];
      }
      else
      {
        v1.n64_u32[0] = LODWORD(this->m_fWinchHeight);
      }
      v2.n64_u32[0] = 1062668861;
      v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
      LODWORD(this->m_fWinchHeight) = v1.n64_u32[0];
      goto LABEL_77;
    }
    if ( !CTheScripts::bEnableCraneRaise )
    {
LABEL_64:
      if ( !CTheScripts::bEnableCraneLower )
        goto LABEL_77;
      IsTouched = CTouchInterface::IsTouched(WIDGET_CRANE_DOWN, 0, 1);
      v54 = CTimer::ms_fTimeStep;
      if ( IsTouched )
        v55 = CTimer::ms_fTimeStep * 0.00255;
      else
        v55 = (float)(v54 * (float)CPad::GetPad(0)->NewState.ButtonCross) * 0.00001;
      v56 = this->RopeType;
      if ( v56 <= 7 && ((1 << v56) & 0xB0) != 0 )
      {
        if ( v55 <= 0.0 )
        {
LABEL_76:
          this->m_fWinchHeight = this->m_fWinchHeight - v55;
          goto LABEL_77;
        }
      }
      else if ( v55 <= 0.0 || v56 != 6 )
      {
        goto LABEL_76;
      }
      if ( (float)(this->m_fWinchHeight - v55) > 0.01 )
        CAudioEngine::ReportMissionAudioEvent(&AudioEngine, 0x68u, this->pConnectedTo, 0.0, 1.0);
      goto LABEL_76;
    }
    v49 = CTouchInterface::IsTouched(WIDGET_CRANE_UP, 0, 1);
    v50 = CTimer::ms_fTimeStep;
    if ( v49 )
      v51 = CTimer::ms_fTimeStep * 0.00255;
    else
      v51 = (float)(v50 * (float)CPad::GetPad(0)->NewState.ButtonSquare) * 0.00001;
    v52 = this->RopeType;
    if ( v52 <= 7 && ((1 << v52) & 0xB0) != 0 )
    {
      if ( v51 <= 0.0 )
      {
LABEL_63:
        this->m_fWinchHeight = v51 + this->m_fWinchHeight;
        goto LABEL_64;
      }
    }
    else if ( v51 <= 0.0 || v52 != 6 )
    {
      goto LABEL_63;
    }
    if ( (float)(v51 + this->m_fWinchHeight) < 0.9 )
      CAudioEngine::ReportMissionAudioEvent(&AudioEngine, 0x68u, this->pConnectedTo, 0.0, 1.0);
    goto LABEL_63;
  }
}
// 412AC6: variable 'v1' is possibly undefined
// 412AC6: variable 'v2' is possibly undefined
// 412E42: variable 'v3' is possibly undefined
// 412E4C: variable 'v4' is possibly undefined
// 412EB8: variable 'ppEnt' is possibly undefined
// 4131A0: variable 'v97' is possibly undefined
// 0: using guessed type int dword_0;
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00413DAC) --------------------------------------------------------
void CRopes::Render()
{
  if ( CRopes::aRopes[0].RopeType )
    CRope::Render(CRopes::aRopes);
  if ( CRopes::aRopes[1].RopeType )
    CRope::Render(&CRopes::aRopes[1]);
  if ( CRopes::aRopes[2].RopeType )
    CRope::Render(&CRopes::aRopes[2]);
  if ( CRopes::aRopes[3].RopeType )
    CRope::Render(&CRopes::aRopes[3]);
  if ( CRopes::aRopes[4].RopeType )
    CRope::Render(&CRopes::aRopes[4]);
  if ( CRopes::aRopes[5].RopeType )
    CRope::Render(&CRopes::aRopes[5]);
  if ( CRopes::aRopes[6].RopeType )
    CRope::Render(&CRopes::aRopes[6]);
  if ( CRopes::aRopes[7].RopeType )
    CRope::Render(&CRopes::aRopes[7]);
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00413ECC) --------------------------------------------------------
void __fastcall CRope::Render(CRope *this)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v3; // d16
  unsigned __int64 v4; // d0
  unsigned int v5; // r1
  RwRGBA_0 *p_color; // r0
  __int64 v7; // kr00_8
  char *v8; // r2
  RwReal x; // r2
  RwReal y; // r3
  RwReal z; // r6

  if ( CCamera::IsSphereVisible(&TheCamera, &this->aCoors[16], 20.0) )
  {
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    v3.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.x, *(float32x2_t *)&this->aCoors[0].x).n64_u64[0];
    v4 = vmul_f32(v3, v3).n64_u64[0];
    if ( sqrtf(*(float *)&v4 + *((float *)&v4 + 1)) < 120.0 )
    {
      DefinedState();
      v5 = 0;
      p_color = &TempVertexBuffer.m_3d[0].color;
      do
      {
        *p_color = (RwRGBA_0)0x80000000;
        v7 = *(_QWORD *)&this->aCoors[v5 / 0xC].y;
        p_color[-6] = LODWORD(this->aCoors[v5 / 0xC].x);
        v8 = (char *)&TempVertexBuffer + 3 * v5;
        v5 += 12;
        p_color += 9;
        *(_QWORD *)(v8 + 4) = v7;
      }
      while ( v5 != 384 );
      RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
      RwRenderStateSet(rwRENDERSTATEDESTBLEND, &byte_6);
      RwRenderStateSet(rwRENDERSTATETEXTUREFILTER, (char *)&dword_0 + 2);
      RwRenderStateSet(rwRENDERSTATETEXTURERASTER, 0);
      if ( RwIm3DTransform(TempVertexBuffer.m_3d, 0x20u, 0, 0) )
      {
        RwIm3DRenderIndexedPrimitive(rwPRIMTYPELINELIST, RopeIndices, 62);
        RwIm3DEnd();
      }
      if ( this->RopeType == 6 )
      {
        TempVertexBuffer.m_3d[0].color = (RwRGBA_0)0x80000000;
        x = this->aCoors[0].x;
        y = this->aCoors[0].y;
        z = this->aCoors[0].z;
        TempVertexBuffer.m_3d[0].position.x = x;
        TempVertexBuffer.m_3d[0].position.y = y;
        TempVertexBuffer.m_3d[0].position.z = z;
        TempVertexBuffer.m_3d[1].color = (RwRGBA_0)0x80000000;
        TempVertexBuffer.m_3d[1].position.x = 709.32;
        TempVertexBuffer.m_3d[1].position.y = 916.2;
        TempVertexBuffer.m_3d[1].position.z = 53.0;
        if ( RwIm3DTransform(TempVertexBuffer.m_3d, 2u, 0, 0) )
        {
          RwIm3DRenderIndexedPrimitive(rwPRIMTYPELINELIST, RopeIndices, 2);
          sub_18D77C();
        }
      }
    }
  }
}
// 0: using guessed type int dword_0;
// 5: using guessed type char byte_5;
// 6: using guessed type char byte_6;

//----- (00414040) --------------------------------------------------------
void CRopes::Shutdown()
{
  int v0; // r8
  int v1; // r11
  CRope *v2; // r0
  CPhysical *m_pWinchCarriedObject; // r1
  CRope *v4; // r0
  CObject *m_pWinchHookObject; // r1
  CEntity::CFlags m_nFlags; // r2
  CObject **p_m_pWinchHookObject; // r9
  CEntity *v8; // r0

  v0 = 0;
  v1 = 0;
  do
  {
    if ( CRopes::aRopes[v0].RopeType )
    {
      CRopes::aRopes[v0].RopeType = 0;
      v2 = &CRopes::aRopes[v0];
      m_pWinchCarriedObject = CRopes::aRopes[v0].m_pWinchCarriedObject;
      if ( m_pWinchCarriedObject )
      {
        *(_DWORD *)&m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x2000000u;
        *(_DWORD *)&v2->m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x80000000;
        v2->m_pWinchCarriedObject = 0;
        v4 = &CRopes::aRopes[v0];
        m_pWinchHookObject = CRopes::aRopes[v0].m_pWinchHookObject;
        m_nFlags = m_pWinchHookObject->m_nFlags;
        *(_DWORD *)&m_nFlags |= 1u;
        m_pWinchHookObject->m_nFlags = m_nFlags;
        CRopes::aRopes[v0].m_WinchDisabled = 60;
      }
      else
      {
        v4 = &CRopes::aRopes[v1];
      }
      p_m_pWinchHookObject = &v4->m_pWinchHookObject;
      v8 = v4->m_pWinchHookObject;
      if ( v8 )
      {
        CWorld::Remove(v8);
        if ( *p_m_pWinchHookObject )
          (*((void (__fastcall **)(CObject *))(*p_m_pWinchHookObject)->_vptr$CPlaceable + 1))(*p_m_pWinchHookObject);
        *p_m_pWinchHookObject = 0;
      }
    }
    ++v0;
    ++v1;
  }
  while ( v0 != 8 );
}

//----- (0041410C) --------------------------------------------------------
void __fastcall CRope::Remove(CRope *this)
{
  CPhysical *m_pWinchCarriedObject; // r2
  CObject *m_pWinchHookObject; // r2
  CEntity::CFlags m_nFlags; // kr00_8
  CObject **p_m_pWinchHookObject; // r4
  CObject *v5; // r0

  m_pWinchCarriedObject = this->m_pWinchCarriedObject;
  this->RopeType = 0;
  if ( m_pWinchCarriedObject )
  {
    *(_DWORD *)&m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x2000000u;
    *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x80000000;
    m_pWinchHookObject = this->m_pWinchHookObject;
    this->m_pWinchCarriedObject = 0;
    m_nFlags = m_pWinchHookObject->m_nFlags;
    *(_DWORD *)&m_pWinchHookObject->m_nFlags = *(_DWORD *)&m_nFlags | 1;
    m_pWinchHookObject->m_nFlags.bdummy = m_nFlags.bdummy;
    this->m_WinchDisabled = 60;
  }
  p_m_pWinchHookObject = &this->m_pWinchHookObject;
  v5 = this->m_pWinchHookObject;
  if ( v5 )
  {
    CWorld::Remove(v5);
    if ( *p_m_pWinchHookObject )
      (*((void (__fastcall **)(CObject *))(*p_m_pWinchHookObject)->_vptr$CPlaceable + 1))(*p_m_pWinchHookObject);
    *p_m_pWinchHookObject = 0;
  }
}

//----- (0041416C) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
Int32 __fastcall CRopes::RegisterRope(
        u_native ID,
        UInt32 ArgRopeType,
        CVector Coors,
        UInt32 bKeepAliveForAWhile,
        UInt8 ArgFixedAtNode,
        bool bArgSitOnGround,
        CPhysical *pArgConnectedTo,
        Int32 LifeTime)
{
  int v8; // r9
  CRope *v9; // r0
  CRope *v10; // r5
  char v11; // r4
  char v12; // r6
  int v13; // r4
  int v14; // r4
  int v16; // r5
  int v17; // r5
  int RopeType; // r6
  bool v19; // zf
  int v20; // r5
  int v21; // r6
  int v22; // r5
  int v23; // r8
  int v24; // r6
  int v25; // r11
  unsigned __int8 v26; // r8
  char v27; // r11
  int v28; // r8
  UInt8 *p_RopeType; // r11
  CRope *v30; // r8
  RwReal *p_y; // r12
  int v32; // s0
  UInt32 v33; // r5
  CRope *v34; // r3
  float v35; // s0
  int v36; // s2
  CRope *v37; // r0
  float *p_m_SegmentLength; // r0
  CRope *v39; // r0
  CRope *v40; // r0
  float v41; // s0
  CRope *v42; // r1
  RwReal v43; // r2
  RwReal x; // r3
  int v45; // r6
  RwReal *v46; // r5
  int v47; // r6
  CRope *v48; // r1
  int v49; // r2
  float v50; // s2
  float y; // s6
  float i; // s0
  float *v53; // r5
  int v54; // [sp+4h] [bp-3Ch]
  int v55; // [sp+8h] [bp-38h]
  int v56; // [sp+10h] [bp-30h]
  int v57; // [sp+14h] [bp-2Ch]
  int v58; // [sp+14h] [bp-2Ch]
  int v59; // [sp+20h] [bp-20h]

  if ( CRopes::aRopes[0].ID == ID && CRopes::aRopes[0].RopeType )
  {
    LOWORD(v8) = 0;
    goto LABEL_24;
  }
  if ( CRopes::aRopes[1].ID == ID && CRopes::aRopes[1].RopeType )
  {
    LOWORD(v8) = 1;
    goto LABEL_24;
  }
  if ( CRopes::aRopes[2].ID == ID && CRopes::aRopes[2].RopeType )
  {
    LOWORD(v8) = 2;
    goto LABEL_24;
  }
  if ( CRopes::aRopes[3].ID == ID && CRopes::aRopes[3].RopeType )
  {
    LOWORD(v8) = 3;
    goto LABEL_24;
  }
  if ( CRopes::aRopes[4].ID == ID && CRopes::aRopes[4].RopeType )
  {
    LOWORD(v8) = 4;
    goto LABEL_24;
  }
  if ( CRopes::aRopes[5].ID == ID && CRopes::aRopes[5].RopeType )
  {
    LOWORD(v8) = 5;
    goto LABEL_24;
  }
  if ( CRopes::aRopes[6].ID == ID && CRopes::aRopes[6].RopeType )
  {
    LOWORD(v8) = 6;
LABEL_24:
    v9 = &CRopes::aRopes[(__int16)v8];
    v9->aCoors[0] = Coors;
    v10 = v9;
    v9->aSpeeds[0].x = 0.0;
    v9->aSpeeds[0].y = 0.0;
    v9->aSpeeds[0].z = 0.0;
    v11 = *((_BYTE *)v9 + 807);
    v9->FixedAtNode = ArgFixedAtNode;
    v12 = v11 | 1;
    v13 = -1;
    *((_BYTE *)v9 + 807) = v12;
    do
    {
      v10->aCoors[0] = Coors;
      ++v13;
      v10->aSpeeds[0].x = 0.0;
      v10->aSpeeds[0].y = 0.0;
      v10->aSpeeds[0].z = 0.0;
      v10 = (CRope *)((char *)v10 + 12);
    }
    while ( v13 < v9->FixedAtNode );
    goto LABEL_26;
  }
  v8 = 7;
  if ( CRopes::aRopes[7].ID == ID && CRopes::aRopes[7].RopeType )
    goto LABEL_24;
  v16 = 0;
  v14 = 0;
  if ( !CRopes::aRopes[0].RopeType )
    v16 = 1;
  v17 = v16 | (CRopes::aRopes[1].RopeType == 0);
  RopeType = CRopes::aRopes[0].RopeType;
  v56 = v17;
  if ( CRopes::aRopes[0].RopeType )
    RopeType = 1;
  v19 = v17 == 0;
  v20 = 0;
  if ( v19 )
    RopeType = 2;
  v57 = RopeType;
  if ( !CRopes::aRopes[2].RopeType )
    v20 = 1;
  v21 = v56 | v20;
  v19 = (v56 | v20) == 0;
  v22 = v57;
  v55 = v21;
  if ( v19 )
    v22 = 3;
  v23 = v21 | (CRopes::aRopes[3].RopeType == 0);
  v24 = v22;
  v54 = v23;
  if ( !v23 )
    v24 = 4;
  v25 = v23 | (CRopes::aRopes[4].RopeType == 0);
  v58 = v25;
  if ( !v25 )
    v24 = 5;
  v26 = (CRopes::aRopes[5].RopeType == 0) | v25;
  v27 = 0;
  v59 = v26 & 1;
  if ( (v26 & 1) == 0 )
    v24 = 6;
  if ( !CRopes::aRopes[6].RopeType )
    v27 = 1;
  v28 = (v26 | (unsigned __int8)v27) & 1;
  if ( v28 )
    v8 = v24;
  p_RopeType = &CRopes::aRopes[1].RopeType;
  if ( !CRopes::aRopes[0].RopeType )
    p_RopeType = &CRopes::aRopes[0].RopeType;
  if ( !v56 )
    p_RopeType = &CRopes::aRopes[2].RopeType;
  if ( !v55 )
    p_RopeType = &CRopes::aRopes[3].RopeType;
  if ( !v54 )
    p_RopeType = &CRopes::aRopes[4].RopeType;
  if ( !v58 )
    p_RopeType = &CRopes::aRopes[5].RopeType;
  if ( !v59 )
    p_RopeType = &CRopes::aRopes[6].RopeType;
  if ( v28 || (p_RopeType = &CRopes::aRopes[7].RopeType, !CRopes::aRopes[7].RopeType) )
  {
    v30 = &CRopes::aRopes[v8];
    v30->aCoors[0].x = Coors.x;
    v30->aSpeeds[0].x = 0.0;
    v30->aSpeeds[0].y = 0.0;
    v30->aSpeeds[0].z = 0.0;
    LOBYTE(Coors.x) = *((_BYTE *)v30 + 807);
    v30->FixedAtNode = ArgFixedAtNode;
    v30->ID = ID;
    v30->GroundHeight = 0.0;
    v30->m_pWinchHookObject = 0;
    v30->m_pWinchCarriedObject = 0;
    *((_BYTE *)v30 + 807) = LOBYTE(Coors.x) & 0xF8 | (4 * bArgSitOnGround) | 1;
    v30->aCoors[0].z = Coors.z;
    v30->aCoors[0].y = Coors.y;
    p_y = &v30->aCoors[0].y;
    if ( pArgConnectedTo && (*(_BYTE *)&pArgConnectedTo->m_info & 7) == 2 )
      v32 = 1063675494;
    else
      v32 = 0.5;
    v33 = bKeepAliveForAWhile;
    v34 = &CRopes::aRopes[v8];
    v34->pConnectedTo = pArgConnectedTo;
    v34->m_WinchDisabled = 0;
    LODWORD(v34->m_fWinchHeight) = v32;
    *p_RopeType = ArgRopeType;
    if ( pArgConnectedTo )
    {
      CEntity::RegisterReference(pArgConnectedTo, &v34->pConnectedTo);
      LOBYTE(ArgRopeType) = *p_RopeType;
      p_y = &v30->aCoors[0].y;
    }
    if ( bKeepAliveForAWhile )
      v33 = CTimer::m_snTimeInMilliseconds + LifeTime;
    CRopes::aRopes[v8].TimeToBeKeptAliveTill = v33;
    if ( (unsigned int)(unsigned __int8)ArgRopeType - 5 >= 3 )
    {
      if ( (unsigned __int8)ArgRopeType == 3 )
      {
        v35 = 0.32258;
        v39 = &CRopes::aRopes[v8];
        v39->m_RopeLength = 10.0;
        v39->m_SegmentLength = 0.32258;
        p_m_SegmentLength = &v39->m_SegmentLength;
        goto LABEL_83;
      }
      if ( (unsigned __int8)ArgRopeType == 4 )
      {
        v35 = 1.6129;
        v37 = &CRopes::aRopes[v8];
        v37->m_RopeLength = 50.0;
        v37->m_SegmentLength = 1.6129;
        p_m_SegmentLength = &v37->m_SegmentLength;
        goto LABEL_80;
      }
      v36 = 20.0;
      v35 = 0.64516;
    }
    else
    {
      v35 = 2.1935;
      v36 = 1116209152;
    }
    v40 = &CRopes::aRopes[v8];
    LODWORD(v40->m_RopeLength) = v36;
    v40->m_SegmentLength = v35;
    p_m_SegmentLength = &v40->m_SegmentLength;
    if ( (ArgRopeType & 0xFC) == 4 )
    {
LABEL_80:
      v41 = v30->aCoors[0].z - v35;
      v42 = &CRopes::aRopes[v8];
      v43 = *p_y;
      x = v42->aCoors[0].x;
      v45 = 0;
      v42->aCoors[1].z = v41;
      v42->aCoors[1].x = x;
      v42->aCoors[1].y = v43;
      do
      {
        v46 = (RwReal *)((char *)v42 + v45);
        v45 += 12;
        v41 = v41 - *p_m_SegmentLength;
        v46[6] = x;
        v46[7] = v43;
        v46[8] = v41;
      }
      while ( v45 != 360 );
LABEL_88:
      v9 = &CRopes::aRopes[v8];
LABEL_26:
      CRope::CreateHookObjectForRope(v9);
      return 1;
    }
LABEL_83:
    v47 = 0;
    v48 = &CRopes::aRopes[v8];
    v49 = 1;
    v50 = v48->aCoors[0].x;
LABEL_86:
    v50 = v35 + v50;
    y = v48->aCoors[v47].y + 0.0;
    for ( i = v48->aCoors[v47].z + 0.0; ; i = v48->aCoors[v47].z )
    {
      v53 = (float *)((char *)v48 + v47 * 12);
      v53[3] = v50;
      v53[4] = y;
      v53[5] = i;
      v53[99] = 0.0;
      v53[100] = 0.0;
      v53[101] = 0.0;
      if ( v47 == 30 )
        break;
      ++v49;
      v35 = *p_m_SegmentLength;
      ++v47;
      if ( v49 << 31 )
        goto LABEL_86;
      v50 = v50 - v35;
      y = v48->aCoors[v47].y;
    }
    goto LABEL_88;
  }
  return v14;
}
// 41416C: fragmented variable at 0:r2.8,8:^48.4 may be wrong
// 41416C: variables would overlap: 0:r2.8,8:^48.4 and ^48.4
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0041468C) --------------------------------------------------------
void __fastcall CRope::CreateHookObjectForRope(CRope *this)
{
  unsigned __int8 v2; // r0
  int32 v3; // r6
  CObject *v4; // r0
  CObject *v5; // r0
  __int64 v6; // kr00_8
  CObject *m_pWinchHookObject; // r1
  RwReal z; // r0
  CMatrix *m_pMat; // r6
  RwReal *p_tz; // r1

  if ( !this->m_pWinchHookObject )
  {
    v2 = this->RopeType - 1;
    if ( v2 <= 6u )
    {
      v3 = **((unsigned __int16 **)&off_667D20 + (char)v2);
      v4 = (CObject *)CObject::operator new(0x184u);
      CObject::CObject(v4, v3, 1);
      this->m_pWinchHookObject = v5;
      CEntity::RegisterReference(v5, &this->m_pWinchHookObject);
      v6 = *(_QWORD *)&this->aCoors[31].x;
      m_pWinchHookObject = this->m_pWinchHookObject;
      z = this->aCoors[31].z;
      m_pMat = m_pWinchHookObject->m_pMat;
      if ( m_pMat )
      {
        LODWORD(m_pMat->tx) = v6;
        m_pWinchHookObject->m_pMat->ty = *((float *)&v6 + 1);
        p_tz = &m_pWinchHookObject->m_pMat->tz;
      }
      else
      {
        *(_QWORD *)&m_pWinchHookObject->m_transform.m_translate.x = v6;
        p_tz = &m_pWinchHookObject->m_transform.m_translate.z;
      }
      *p_tz = z;
      this->m_pWinchHookObject->ObjectCreatedBy = 5;
      (*((void (__fastcall **)(CObject *, _DWORD))this->m_pWinchHookObject->_vptr$CPlaceable + 5))(
        this->m_pWinchHookObject,
        0);
      *(_DWORD *)&this->m_pWinchHookObject->m_nPhysicalFlags |= 0x2000000u;
      CWorld::Add(this->m_pWinchHookObject);
      this->m_WinchDisabled = 0;
      this->m_pWinchCarriedObject = 0;
    }
  }
}
// 4146CC: variable 'v5' is possibly undefined

//----- (00414738) --------------------------------------------------------
int __fastcall CRope::UpdateWeightInRope(
        CRope *this,
        CVector WeightCoors,
        float RelativeWeight,
        CVector *pNewWeightCoors)
{
  int FixedAtNode; // r5
  float *p_x; // r0
  float v7; // s18
  float v8; // s16
  float v9; // s2
  float v10; // s20
  float v11; // s0
  float v12; // s4
  float m_SegmentLength; // s10
  float v14; // s8
  float v15; // s6
  int i; // lr
  int v17; // r0
  float *v18; // r6
  float v19; // s2
  float v20; // s6
  float v21; // s10
  float v22; // s4
  float v23; // s12
  float v24; // s1
  float v25; // s14
  float v26; // s14
  float v27; // s8
  float v28; // s10
  float v29; // s12
  CVector *v30; // r1
  RwReal v31; // s6
  RwReal v32; // s4
  int v33; // r6
  int v34; // r0
  float *v35; // r5
  float v36; // s6
  float v37; // s8
  float v38; // s4
  float v39; // s10
  float v40; // s12
  float v41; // s1
  float v42; // s14
  float v43; // s14
  CVector *v44; // r0
  float32x2_t v45; // d16
  float x; // s0
  int v47; // r1
  float32x2_t v48; // d17
  float32x2_t v49; // d18
  unsigned __int64 v50; // d3
  float v51; // s4
  float v52; // s6
  float v53; // s4
  float v54; // s4
  float v56; // s6
  unsigned int v57; // r0
  int v58; // r5
  CVector *v59; // r6
  float v60; // s6
  int v61; // r0
  float v62; // s6
  RwReal v63; // s2
  RwReal v64; // s4
  CVector v65; // [sp+4h] [bp-34h] BYREF

  FixedAtNode = this->FixedAtNode;
  p_x = &this->aCoors[FixedAtNode].x;
  v7 = p_x[1];
  v8 = *p_x;
  v9 = WeightCoors.y - v7;
  v10 = p_x[2];
  v11 = WeightCoors.x - *p_x;
  v12 = WeightCoors.z - v10;
  m_SegmentLength = this->m_SegmentLength;
  v65.z = WeightCoors.z - v10;
  v65.y = WeightCoors.y - v7;
  v14 = m_SegmentLength * (float)(31 - FixedAtNode);
  v65.x = v11;
  this->aCoors[31] = WeightCoors;
  v15 = sqrtf((float)((float)(v11 * v11) + (float)(v9 * v9)) + (float)(v12 * v12));
  if ( v15 >= v14 )
  {
    v56 = v14 / v15;
    pNewWeightCoors->x = v8 + (float)(v56 * v11);
    pNewWeightCoors->y = v7 + (float)(v56 * v9);
    pNewWeightCoors->z = v10 + (float)(v56 * v12);
    v57 = this->FixedAtNode;
    if ( v57 <= 0x1E )
    {
      v58 = v57 - 1;
      v59 = &this->aCoors[v57 + 1];
      do
      {
        CVector::Normalise(&v65);
        v60 = this->m_SegmentLength;
        v65.x = v60 * v65.x;
        v65.y = v60 * v65.y;
        v65.z = v60 * v65.z;
        v61 = v58 - this->FixedAtNode;
        ++v58;
        v62 = (float)(v61 + 2);
        v63 = v7 + (float)(v65.y * v62);
        v64 = v10 + (float)(v65.z * v62);
        v59->x = v8 + (float)(v65.x * v62);
        v59->y = v63;
        v59->z = v64;
        ++v59;
      }
      while ( v58 < 30 );
    }
    return 1;
  }
  else
  {
    for ( i = 0; i != 6; ++i )
    {
      if ( (unsigned int)(unsigned __int8)FixedAtNode + 1 <= 0x1E )
      {
        v17 = 31;
        do
        {
          v18 = &this->aCoors[v17].x;
          v19 = *(v18 - 3);
          v20 = *(v18 - 2);
          v21 = v18[1];
          v22 = *(v18 - 1);
          v23 = v18[2];
          v24 = this->m_SegmentLength;
          v25 = sqrtf(
                  (float)((float)((float)(*v18 - v19) * (float)(*v18 - v19))
                        + (float)((float)(v21 - v20) * (float)(v21 - v20)))
                + (float)((float)(v23 - v22) * (float)(v23 - v22)));
          if ( v25 <= v24 )
          {
            v17 = 0;
          }
          else
          {
            v26 = v24 / v25;
            v27 = *v18 + (float)((float)(v19 - *v18) * v26);
            v28 = v21 + (float)((float)(v20 - v21) * v26);
            v29 = v23 + (float)((float)(v22 - v23) * v26);
            *(v18 - 3) = v27;
            *(v18 - 2) = v28;
            *(v18 - 1) = v29;
            v30 = &this->aCoors[v17 - 1];
            v31 = (float)(v28 - v20) * (float)(1.0 / CTimer::ms_fTimeStep);
            v32 = (float)(v29 - v22) * (float)(1.0 / CTimer::ms_fTimeStep);
            v30[32].x = (float)(v27 - v19) * (float)(1.0 / CTimer::ms_fTimeStep);
            v30[32].y = v31;
            v30[32].z = v32;
            LOBYTE(FixedAtNode) = this->FixedAtNode;
          }
          v33 = (unsigned __int8)FixedAtNode + 1;
          --v17;
        }
        while ( v17 > v33 );
        if ( (unsigned int)v33 <= 0x1E )
        {
          v34 = (unsigned __int8)FixedAtNode;
          v35 = &this->aCoors[(unsigned __int8)FixedAtNode].x;
          do
          {
            v36 = v35[1];
            v37 = v35[3] - *v35;
            v38 = v35[2];
            v39 = v35[4] - v36;
            v40 = v35[5] - v38;
            v41 = this->m_SegmentLength;
            v42 = sqrtf((float)((float)(v37 * v37) + (float)(v39 * v39)) + (float)(v40 * v40));
            if ( v42 > v41 )
            {
              v43 = v41 / v42;
              v35[3] = *v35 + (float)(v37 * v43);
              v35[4] = v36 + (float)(v39 * v43);
              v35[5] = v38 + (float)(v40 * v43);
            }
            ++v34;
            v35 += 3;
          }
          while ( v34 < 30 );
        }
      }
      FixedAtNode = this->FixedAtNode;
    }
    if ( (unsigned int)(FixedAtNode + 1) <= 0x1E )
    {
      v44 = &this->aCoors[30];
      v45.n64_u64[0] = *(unsigned __int64 *)&this->aCoors[31].y;
      x = this->aCoors[31].x;
      v47 = 31;
      do
      {
        v48.n64_u64[0] = *(unsigned __int64 *)&v44->y;
        v49.n64_u64[0] = vsub_f32(v45, v48).n64_u64[0];
        v50 = vmul_f32(v49, v49).n64_u64[0];
        v51 = (float)((float)((float)(x - v44->x) * (float)(x - v44->x)) + *(float *)&v50) + *((float *)&v50 + 1);
        v52 = this->m_SegmentLength;
        v53 = sqrtf(v51);
        if ( v53 <= v52 )
          break;
        v54 = v52 / v53;
        --v47;
        v45.n64_u64[0] = vadd_f32(v45, vmul_n_f32(vsub_f32(v48, v45), v54)).n64_u64[0];
        x = x + (float)((float)(v44->x - x) * v54);
        *(float32x2_t *)&v44->y = v45;
        v44->x = x;
        --v44;
      }
      while ( v47 > this->FixedAtNode + 1 );
    }
    return 0;
  }
}

//----- (00414A9C) --------------------------------------------------------
void __fastcall CRopes::SetSpeedOfTopNode(UInt32 ID, CVector Speed)
{
  __int16 v2; // r12

  if ( CRopes::aRopes[0].RopeType && CRopes::aRopes[0].ID == ID )
  {
    v2 = 0;
LABEL_25:
    CRopes::aRopes[v2].aSpeeds[0] = Speed;
    return;
  }
  if ( CRopes::aRopes[1].RopeType && CRopes::aRopes[1].ID == ID )
  {
    v2 = 1;
    goto LABEL_25;
  }
  if ( CRopes::aRopes[2].RopeType && CRopes::aRopes[2].ID == ID )
  {
    v2 = 2;
    goto LABEL_25;
  }
  if ( CRopes::aRopes[3].RopeType && CRopes::aRopes[3].ID == ID )
  {
    v2 = 3;
    goto LABEL_25;
  }
  if ( CRopes::aRopes[4].RopeType && CRopes::aRopes[4].ID == ID )
  {
    v2 = 4;
    goto LABEL_25;
  }
  if ( CRopes::aRopes[5].RopeType && CRopes::aRopes[5].ID == ID )
  {
    v2 = 5;
    goto LABEL_25;
  }
  if ( CRopes::aRopes[6].RopeType && CRopes::aRopes[6].ID == ID )
  {
    v2 = 6;
    goto LABEL_25;
  }
  if ( CRopes::aRopes[7].RopeType && CRopes::aRopes[7].ID == ID )
  {
    v2 = 7;
    goto LABEL_25;
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00414C04) --------------------------------------------------------
bool __fastcall CRopes::FindCoorsAlongRope(UInt32 ID, float DistAlongRope, CVector *pResult, CVector *pResultSpeed)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  __int16 v7; // lr
  bool v8; // r12
  float v9; // s0
  int v10; // r1
  float v11; // s0
  float *p_x; // r0
  RwReal v13; // s4
  RwReal v14; // s6
  RwReal v15; // s0
  CVector *v16; // r0
  __int64 v17; // d16

  if ( CRopes::aRopes[0].RopeType && CRopes::aRopes[0].ID == ID )
  {
    v7 = 0;
  }
  else if ( CRopes::aRopes[1].RopeType && CRopes::aRopes[1].ID == ID )
  {
    v7 = 1;
  }
  else if ( CRopes::aRopes[2].RopeType && CRopes::aRopes[2].ID == ID )
  {
    v7 = 2;
  }
  else if ( CRopes::aRopes[3].RopeType && CRopes::aRopes[3].ID == ID )
  {
    v7 = 3;
  }
  else if ( CRopes::aRopes[4].RopeType && CRopes::aRopes[4].ID == ID )
  {
    v7 = 4;
  }
  else if ( CRopes::aRopes[5].RopeType && CRopes::aRopes[5].ID == ID )
  {
    v7 = 5;
  }
  else if ( CRopes::aRopes[6].RopeType && CRopes::aRopes[6].ID == ID )
  {
    v7 = 6;
  }
  else
  {
    v8 = 0;
    if ( !CRopes::aRopes[7].RopeType || CRopes::aRopes[7].ID != ID )
      return v8;
    v7 = 7;
  }
  v5.n64_u32[0] = 0;
  v4.n64_f32[0] = DistAlongRope;
  v6.n64_u32[0] = 1065336439;
  v9 = vmin_f32(vmax_f32(v4, v5), v6).n64_f32[0] * 31.0;
  v10 = (int)v9;
  v11 = v9 - (float)(int)v9;
  p_x = &CRopes::aRopes[v7].aCoors[v10].x;
  v13 = (float)((float)(1.0 - v11) * *p_x) + (float)(v11 * p_x[3]);
  v14 = (float)((float)(1.0 - v11) * p_x[1]) + (float)(v11 * p_x[4]);
  v15 = (float)((float)(1.0 - v11) * p_x[2]) + (float)(v11 * p_x[5]);
  pResult->x = v13;
  pResult->y = v14;
  pResult->z = v15;
  if ( pResultSpeed )
  {
    v16 = &CRopes::aRopes[v7].aCoors[v10 + 1];
    v17 = *(_QWORD *)&v16[32].x;
    pResultSpeed->z = v16[32].z;
    *(_QWORD *)&pResultSpeed->x = v17;
  }
  return 1;
}
// 414D1A: variable 'v4' is possibly undefined
// 414D1A: variable 'v5' is possibly undefined
// 414D2C: variable 'v6' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00414DFC) --------------------------------------------------------
bool __fastcall CRopes::IsCarriedByRope(CPhysical *pPhysical)
{
  if ( !pPhysical )
    return 0;
  if ( CRopes::aRopes[0].RopeType && CRopes::aRopes[0].m_pWinchCarriedObject == pPhysical
    || CRopes::aRopes[1].RopeType && CRopes::aRopes[1].m_pWinchCarriedObject == pPhysical
    || CRopes::aRopes[2].RopeType && CRopes::aRopes[2].m_pWinchCarriedObject == pPhysical
    || CRopes::aRopes[3].RopeType && CRopes::aRopes[3].m_pWinchCarriedObject == pPhysical
    || CRopes::aRopes[4].RopeType && CRopes::aRopes[4].m_pWinchCarriedObject == pPhysical
    || CRopes::aRopes[5].RopeType && CRopes::aRopes[5].m_pWinchCarriedObject == pPhysical
    || CRopes::aRopes[6].RopeType && CRopes::aRopes[6].m_pWinchCarriedObject == pPhysical )
  {
    return 1;
  }
  return CRopes::aRopes[7].RopeType != 0 && CRopes::aRopes[7].m_pWinchCarriedObject == pPhysical;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00414EE4) --------------------------------------------------------
float __fastcall CRopes::FindPickUpHeight(CEntity *pCarried)
{
  return CModelInfo::ms_modelInfoPtrs[pCarried->m_nModelIndex]->m_pColModel->m_boxBound.m_vecMax.z;
}

//----- (00414EFC) --------------------------------------------------------
bool __fastcall CRope::DoControlsApply(CRope *this)
{
  int RopeType; // r0
  bool v2; // zf
  bool v3; // zf
  bool v4; // zf
  int v5; // r2
  unsigned __int8 v6; // r0
  char v7; // r2
  char v8; // r1

  RopeType = this->RopeType;
  v2 = RopeType == 4;
  if ( RopeType == 4 )
    v2 = CRopes::PlayerControlsCrane == 1;
  if ( v2 )
    return 1;
  v3 = RopeType == 5;
  if ( RopeType == 5 )
    v3 = CRopes::PlayerControlsCrane == 2;
  if ( v3 )
    return 1;
  v4 = RopeType == 7;
  if ( RopeType == 7 )
    v4 = CRopes::PlayerControlsCrane == 3;
  if ( v4 )
    return 1;
  v5 = RopeType ^ 6;
  v6 = RopeType - 1;
  v2 = (CRopes::PlayerControlsCrane ^ 4 | v5) == 0;
  v7 = 0;
  v8 = 0;
  if ( v2 )
    v7 = 1;
  if ( v6 < 3u )
    v8 = 1;
  return v8 | v7;
}

//----- (00414F50) --------------------------------------------------------
void __fastcall CRope::ReleasePickedUpObject(CRope *this)
{
  CPhysical *m_pWinchCarriedObject; // r1
  CObject *m_pWinchHookObject; // r1
  CEntity::CFlags m_nFlags; // r2

  m_pWinchCarriedObject = this->m_pWinchCarriedObject;
  if ( m_pWinchCarriedObject )
  {
    *(_DWORD *)&m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x2000000u;
    *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x80000000;
    this->m_pWinchCarriedObject = 0;
  }
  m_pWinchHookObject = this->m_pWinchHookObject;
  m_nFlags = m_pWinchHookObject->m_nFlags;
  *(_DWORD *)&m_nFlags |= 1u;
  m_pWinchHookObject->m_nFlags = m_nFlags;
  this->m_WinchDisabled = 60;
}

//----- (00414F88) --------------------------------------------------------
Int32 __fastcall CRopes::FindRope(u_native ID)
{
  Int32 result; // r0
  bool v2; // zf

  if ( CRopes::aRopes[0].RopeType && CRopes::aRopes[0].ID == ID )
    return 0;
  if ( CRopes::aRopes[1].RopeType && CRopes::aRopes[1].ID == ID )
    return 1;
  if ( CRopes::aRopes[2].RopeType && CRopes::aRopes[2].ID == ID )
    return 2;
  if ( CRopes::aRopes[3].RopeType && CRopes::aRopes[3].ID == ID )
    return 3;
  if ( CRopes::aRopes[4].RopeType && CRopes::aRopes[4].ID == ID )
    return 4;
  if ( CRopes::aRopes[5].RopeType && CRopes::aRopes[5].ID == ID )
    return 5;
  if ( CRopes::aRopes[6].RopeType && CRopes::aRopes[6].ID == ID )
    return 6;
  v2 = CRopes::aRopes[7].ID == ID;
  result = -1;
  if ( v2 )
    result = 7;
  if ( !CRopes::aRopes[7].RopeType )
    return -1;
  return result;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00415080) --------------------------------------------------------
void __fastcall CRope::PickUpObject(CRope *this, CEntity *pToBePickedUp)
{
  CPhysical *m_pWinchCarriedObject; // r1
  CPhysical **p_m_pWinchCarriedObject; // r4
  CObject *m_pWinchHookObject; // r1
  CEntity::CFlags m_nFlags; // r2
  CObject **p_m_pWinchHookObject; // r8
  CObject *v8; // r6
  const CMatrix *m_pMat; // r1
  RwReal z; // r0
  RwReal y; // r1
  CMatrix *v12; // r3
  RwReal v13; // r0
  RwReal *p_tz; // r1
  CObject *v15; // r0
  uint32 bdummy; // r2
  CEntity::CEntityInfo m_info; // r1
  CVector v18; // [sp+0h] [bp-28h] BYREF
  CVector v19; // [sp+Ch] [bp-1Ch] BYREF

  m_pWinchCarriedObject = this->m_pWinchCarriedObject;
  if ( m_pWinchCarriedObject != pToBePickedUp )
  {
    p_m_pWinchCarriedObject = &this->m_pWinchCarriedObject;
    if ( m_pWinchCarriedObject )
    {
      *(_DWORD *)&m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x2000000u;
      *(_DWORD *)&this->m_pWinchCarriedObject->m_nPhysicalFlags &= ~0x80000000;
      m_pWinchHookObject = this->m_pWinchHookObject;
      this->m_pWinchCarriedObject = 0;
      m_nFlags = m_pWinchHookObject->m_nFlags;
      *(_DWORD *)&m_nFlags |= 1u;
      m_pWinchHookObject->m_nFlags = m_nFlags;
      this->m_WinchDisabled = 60;
    }
    p_m_pWinchHookObject = &this->m_pWinchHookObject;
    *p_m_pWinchCarriedObject = (CPhysical *)pToBePickedUp;
    CEntity::RegisterReference(pToBePickedUp, p_m_pWinchCarriedObject);
    v8 = *p_m_pWinchHookObject;
    m_pMat = (*p_m_pWinchCarriedObject)->m_pMat;
    z = CModelInfo::ms_modelInfoPtrs[pToBePickedUp->m_nModelIndex]->m_pColModel->m_boxBound.m_vecMax.z;
    v18.x = 0.0;
    v18.y = 0.0;
    v18.z = z;
    operator*(&v19, m_pMat, &v18);
    y = v19.y;
    v12 = v8->m_pMat;
    v13 = v19.z;
    if ( v12 )
    {
      v12->tx = v19.x;
      v8->m_pMat->ty = y;
      p_tz = &v8->m_pMat->tz;
    }
    else
    {
      v8->m_transform.m_translate.x = v19.x;
      v8->m_transform.m_translate.y = y;
      p_tz = &v8->m_transform.m_translate.z;
    }
    *p_tz = v13;
    v15 = *p_m_pWinchHookObject;
    bdummy = (*p_m_pWinchHookObject)->m_nFlags.bdummy;
    *(_DWORD *)&v15->m_nFlags = *(_DWORD *)&(*p_m_pWinchHookObject)->m_nFlags & 0xFFFFFFFE;
    v15->m_nFlags.bdummy = bdummy;
    *(_DWORD *)&(*p_m_pWinchCarriedObject)->m_nPhysicalFlags |= 0x2000000u;
    m_info = pToBePickedUp->m_info;
    if ( (*(_BYTE *)&m_info & 7) == 4 )
    {
      if ( (*(_DWORD *)&(*p_m_pWinchCarriedObject)->m_nFlags & 0x40004) != 0 )
      {
        (*((void (__fastcall **)(CPhysical *, _DWORD))(*p_m_pWinchCarriedObject)->_vptr$CPlaceable + 5))(
          *p_m_pWinchCarriedObject,
          0);
        CPhysical::AddToMovingList(*p_m_pWinchCarriedObject);
        (*p_m_pWinchCarriedObject)->m_nNoOfStaticFrames = 0;
      }
    }
    else if ( (*(_BYTE *)&m_info & 7) == 2 && (*(_BYTE *)&m_info & 0xF8) == 16 )
    {
      pToBePickedUp->m_info = (CEntity::CEntityInfo)26;
    }
  }
}

//----- (0041518C) --------------------------------------------------------
int __fastcall CRopes::CreateRopeForSwatPed(const CVector *Coors)
{
  int v1; // r4

  v1 = CRopes::CreateRopeForSwatPed(CVector const&)::RopeNum + 100;
  if ( CRopes::RegisterRope(CRopes::CreateRopeForSwatPed(CVector const&)::RopeNum + 100, 8u, *Coors, 1u, 0, 0, 0, 4000) < 0 )
    return -1;
  CRopes::CreateRopeForSwatPed(CVector const&)::RopeNum = (unsigned __int8)(CRopes::CreateRopeForSwatPed(CVector const&)::RopeNum
                                                                          + 1);
  return v1;
}

//----- (004151E4) --------------------------------------------------------
void CStats::Init()
{
  Int32 *RadioStationListenTimes; // r0
  __int64 v1; // d17
  __int64 v2; // d17
  __int64 v3; // d17

  CTimer::m_snTimeInMilliseconds = 0;
  memset(CStats::StatTypesFloat, 0, sizeof(CStats::StatTypesFloat));
  memset(CStats::StatTypesInt, 0, sizeof(CStats::StatTypesInt));
  CStats::CheckForStatsMessage(1);
  CStats::StatTypesFloat[24] = 569.0;
  CStats::CheckForStatsMessage(0);
  CStats::StatTypesFloat[22] = 100.0;
  CStats::CheckForStatsMessage(0);
  *(_QWORD *)&CStats::PedsKilledOfThisType[28] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[30] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[24] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[26] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[20] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[22] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[16] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[18] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[12] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[14] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[8] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[10] = 0LL;
  *(_QWORD *)CStats::PedsKilledOfThisType = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[2] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[4] = 0LL;
  *(_QWORD *)&CStats::PedsKilledOfThisType[6] = 0LL;
  memset(CStats::TimesMissionAttempted, 0, sizeof(CStats::TimesMissionAttempted));
  *(_DWORD *)&CStats::LastMissionPassedName[4] = 0;
  *(_DWORD *)CStats::LastMissionPassedName = 0;
  RadioStationListenTimes = CAudioEngine::GetRadioStationListenTimes(&AudioEngine);
  v1 = *((_QWORD *)RadioStationListenTimes + 1);
  *(_QWORD *)CStats::FavoriteRadioStationList = *(_QWORD *)RadioStationListenTimes;
  *(_QWORD *)&CStats::FavoriteRadioStationList[2] = v1;
  v2 = *((_QWORD *)RadioStationListenTimes + 3);
  *(_QWORD *)&CStats::FavoriteRadioStationList[4] = *((_QWORD *)RadioStationListenTimes + 2);
  *(_QWORD *)&CStats::FavoriteRadioStationList[6] = v2;
  v3 = *((_QWORD *)RadioStationListenTimes + 5);
  *(_QWORD *)&CStats::FavoriteRadioStationList[8] = *((_QWORD *)RadioStationListenTimes + 4);
  *(_QWORD *)&CStats::FavoriteRadioStationList[10] = v3;
  CStats::FavoriteRadioStationList[12] = RadioStationListenTimes[12];
  CStats::FavoriteRadioStationList[13] = RadioStationListenTimes[13];
  CStats::LoadActionReactionStats();
  CStats::LoadStatUpdateConditions();
  CStats::usingRespectCheat = 0;
  CStats::m_DrivingCounter = 0;
  CStats::m_FlyingCounter = 0;
  CStats::m_BoatCounter = 0;
  CStats::usingSexCheat = 0;
  CStats::m_BikeCounter = 0;
  CStats::m_FatCounter = 0;
  CStats::m_RunningCounter = 0;
  CStats::m_SprintStaminaCounter = 0;
  CStats::m_CycleStaminaCounter = 0;
  CStats::m_SwimStaminaCounter = 0;
}

//----- (00415384) --------------------------------------------------------
void __fastcall CStats::CheckForStatsMessage(bool bInitialize)
{
  uint32 v1; // r4
  uint32 v2; // r8
  unsigned int stat_num; // r1
  int condition; // r2
  float v5; // s2
  float value; // s0
  unsigned int v7; // r5
  bool8 *v8; // r3
  bool v9; // cf
  unsigned __int8 *TextLabel; // r5
  unsigned int v11; // r3
  bool8 *v12; // r2
  bool v13; // cf
  GxtChar *v14; // r0
  sStatMessageStruct *v15; // r3
  bool8 *p_processed; // r3
  int processed; // t1
  bool v18; // cf
  _BOOL4 v19; // [sp+24h] [bp-2Ch]

  if ( CStats::bShowUpdateStats )
  {
    v1 = CStats::TotalNumStatMessages;
    if ( CStats::TotalNumStatMessages )
    {
      v2 = 0;
      v19 = bInitialize;
      do
      {
        v15 = &CStats::StatMessage[v2];
        processed = v15->processed;
        p_processed = &v15->processed;
        if ( !processed )
        {
          stat_num = CStats::StatMessage[v2].stat_num;
          condition = CStats::StatMessage[v2].condition;
          if ( stat_num > 0x51 )
            v5 = (float)CStats::StatTypesInt[stat_num - 120];
          else
            v5 = CStats::StatTypesFloat[stat_num];
          value = CStats::StatMessage[v2].value;
          if ( CStats::StatMessage[v2].condition )
          {
            if ( v5 < value )
              goto LABEL_36;
            *p_processed = 1;
            v7 = 0;
            v8 = &CStats::StatMessage[0].processed;
            do
            {
              if ( v2 != v7
                && stat_num == *((unsigned __int16 *)v8 - 1)
                && value == *(float *)(v8 + 2)
                && condition != v8[1] )
              {
                *v8 = 0;
              }
              v9 = ++v7 >= 0x7F;
              if ( v7 <= 0x7F )
              {
                v8 += 16;
                v9 = v7 >= v1;
              }
            }
            while ( !v9 );
            if ( bInitialize )
              goto LABEL_36;
            TextLabel = CStats::StatMessage[v2].TextLabel;
          }
          else
          {
            if ( v5 > value )
              goto LABEL_36;
            *p_processed = 1;
            v11 = 0;
            v12 = &CStats::StatMessage[0].processed;
            do
            {
              if ( v2 != v11 && stat_num == *((unsigned __int16 *)v12 - 1) && value == *(float *)(v12 + 2) && v12[1] )
                *v12 = 0;
              v13 = ++v11 >= 0x7F;
              if ( v11 <= 0x7F )
              {
                v12 += 16;
                v13 = v11 >= v1;
              }
            }
            while ( !v13 );
            if ( bInitialize )
              goto LABEL_36;
            TextLabel = CStats::StatMessage[v2].TextLabel;
          }
          v1 = 0;
          v14 = CText::Get(&TheText, TextLabel);
          CHud::SetHelpMessage(TextLabel, v14, 0, 0, 0, 0);
          *(_DWORD *)&bInitialize = v19;
        }
LABEL_36:
        v18 = ++v2 >= 0x7F;
        if ( v2 <= 0x7F )
        {
          v1 = CStats::TotalNumStatMessages;
          v18 = v2 >= CStats::TotalNumStatMessages;
        }
      }
      while ( !v18 );
    }
  }
}

//----- (0041557C) --------------------------------------------------------
void __fastcall CStats::SetStatValue(UInt16 index, float NewValue)
{
  if ( index > 0x51u )
    CStats::StatTypesInt[index - 120] = (int)NewValue;
  else
    CStats::StatTypesFloat[index] = NewValue;
  CStats::CheckForStatsMessage(0);
}

//----- (004155C0) --------------------------------------------------------
bool CStats::PopulateFavoriteRadioStationList()
{
  Int32 *RadioStationListenTimes; // r0

  RadioStationListenTimes = CAudioEngine::GetRadioStationListenTimes(&AudioEngine);
  CStats::FavoriteRadioStationList[0] = *RadioStationListenTimes;
  CStats::FavoriteRadioStationList[1] = RadioStationListenTimes[1];
  CStats::FavoriteRadioStationList[2] = RadioStationListenTimes[2];
  CStats::FavoriteRadioStationList[3] = RadioStationListenTimes[3];
  CStats::FavoriteRadioStationList[4] = RadioStationListenTimes[4];
  CStats::FavoriteRadioStationList[5] = RadioStationListenTimes[5];
  CStats::FavoriteRadioStationList[6] = RadioStationListenTimes[6];
  CStats::FavoriteRadioStationList[7] = RadioStationListenTimes[7];
  CStats::FavoriteRadioStationList[8] = RadioStationListenTimes[8];
  CStats::FavoriteRadioStationList[9] = RadioStationListenTimes[9];
  CStats::FavoriteRadioStationList[10] = RadioStationListenTimes[10];
  CStats::FavoriteRadioStationList[11] = RadioStationListenTimes[11];
  CStats::FavoriteRadioStationList[12] = RadioStationListenTimes[12];
  CStats::FavoriteRadioStationList[13] = RadioStationListenTimes[13];
  return (CStats::FavoriteRadioStationList[13] | CStats::FavoriteRadioStationList[0] | CStats::FavoriteRadioStationList[1] | CStats::FavoriteRadioStationList[2] | CStats::FavoriteRadioStationList[3] | CStats::FavoriteRadioStationList[4] | CStats::FavoriteRadioStationList[5] | CStats::FavoriteRadioStationList[6] | CStats::FavoriteRadioStationList[7] | CStats::FavoriteRadioStationList[8] | CStats::FavoriteRadioStationList[9] | CStats::FavoriteRadioStationList[10] | CStats::FavoriteRadioStationList[11] | CStats::FavoriteRadioStationList[12]) == 0;
}

//----- (00415674) --------------------------------------------------------
void CStats::LoadActionReactionStats()
{
  u_native v0; // r4
  unsigned __int8 *i; // r0
  int v2; // r1
  bool v3; // zf
  int v4; // [sp+4h] [bp-74h] BYREF
  float v5; // [sp+8h] [bp-70h] BYREF
  char v6; // [sp+Ch] [bp-6Ch] BYREF

  v4 = 0;
  v5 = 0.0;
  CFileMgr::SetDir((const unsigned __int8 *)&byte_61CADE);
  v0 = CFileMgr::OpenFile("DATA\\AR_STATS.DAT", "rb");
  for ( i = CFileLoader::LoadLine(v0); i; i = CFileLoader::LoadLine(v0) )
  {
    v2 = *i;
    v3 = v2 == 35;
    if ( v2 != 35 )
      v3 = v2 == 0;
    if ( !v3 )
    {
      sscanf((const char *)i, "%d %s %f", &v4, &v6, &v5);
      CStats::StatReactionValue[v4] = v5;
    }
  }
  CFileMgr::CloseFile(v0);
}
// 61CADE: using guessed type char byte_61CADE;

//----- (0041573C) --------------------------------------------------------
void CStats::LoadStatUpdateConditions()
{
  uint32 v0; // r8
  u_native v1; // r4
  unsigned __int8 *Line; // r0
  char v3; // r0
  char v4; // r1
  sStatMessageStruct *v5; // r2
  sStatMessageStruct *v6; // r1
  int v7; // r1
  bool v8; // zf
  int v9; // [sp+Ch] [bp-8Ch] BYREF
  float v10; // [sp+10h] [bp-88h] BYREF
  char v11[8]; // [sp+17h] [bp-81h] BYREF
  unsigned __int8 textid[8]; // [sp+1Fh] [bp-79h] BYREF
  unsigned __int8 cond[9]; // [sp+27h] [bp-71h] BYREF

  v0 = 0;
  v9 = 0;
  v10 = 0.0;
  CFileMgr::SetDir((const unsigned __int8 *)&byte_61CADE);
  v1 = CFileMgr::OpenFile("DATA\\STATDISP.DAT", "rb");
  CStats::TotalNumStatMessages = 0;
  Line = CFileLoader::LoadLine(v1);
  if ( Line )
  {
    v0 = 0;
    while ( 1 )
    {
      v7 = *Line;
      v8 = v7 == 35;
      if ( v7 != 35 )
        v8 = v7 == 0;
      if ( v8 )
        goto LABEL_13;
      sscanf((const char *)Line, "%d %s %s %f %s", &v9, &cond[1], textid, &v10, v11);
      CStats::StatMessage[v0].stat_num = v9;
      if ( !strcmp((const char *)textid, "lessthan") )
        break;
      if ( !strcmp((const char *)textid, "morethan") )
      {
        v3 = 0;
        v4 = 1;
LABEL_7:
        v5 = &CStats::StatMessage[v0];
        v5->processed = v3;
        v5->condition = v4;
      }
      v6 = &CStats::StatMessage[v0];
      v6->value = v10;
      strcpy((char *)v6->TextLabel, v11);
      ++v0;
LABEL_13:
      Line = CFileLoader::LoadLine(v1);
      if ( !Line )
        goto LABEL_14;
    }
    v3 = 1;
    v4 = 0;
    goto LABEL_7;
  }
LABEL_14:
  CStats::TotalNumStatMessages = v0;
  CFileMgr::CloseFile(v1);
}
// 61CADE: using guessed type char byte_61CADE;
// 41573C: using guessed type char var_81[8];

//----- (0041589C) --------------------------------------------------------
unsigned __int8 *__fastcall CStats::GetStatID(UInt16 index)
{
  if ( index > 0x51u )
    sprintf(gString, "stat_i_%d");
  else
    sprintf(gString, "stat_f_%d");
  return gString;
}

//----- (004158E8) --------------------------------------------------------
bool8 __fastcall CStats::GetStatType(UInt16 index)
{
  return index < 0x52u;
}

//----- (004158F4) --------------------------------------------------------
float __fastcall CStats::GetStatValue(UInt16 index)
{
  if ( index > 0x51u )
    return (float)CStats::StatTypesInt[index - 120];
  else
    return CStats::StatTypesFloat[index];
}

//----- (0041592C) --------------------------------------------------------
void __fastcall CStats::ModifyStat(UInt16 index, float amount)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float *v5; // r1
  float32x2_t v6; // d0
  Int32 *v7; // r1

  v2.n64_f32[0] = amount;
  if ( amount < 0.0 )
  {
    if ( amount < -0.0 )
    {
      if ( index > 0x51u )
      {
        v3.n64_u32[0] = 0;
        v7 = &CStats::StatTypesInt[index];
        v2.n64_f32[0] = (float)(*(v7 - 120) - (int)(float)-v2.n64_f32[0]);
        v6.n64_u64[0] = vmax_f32(v2, v3).n64_u64[0];
        *(v7 - 120) = (int)v6.n64_f32[0];
      }
      else
      {
        v4.n64_u32[0] = 0;
        v5 = &CStats::StatTypesFloat[index];
        v2.n64_f32[0] = *v5 + v2.n64_f32[0];
        v6.n64_u64[0] = vmax_f32(v2, v4).n64_u64[0];
        *v5 = v6.n64_f32[0];
      }
      if ( (unsigned __int8)index == 165 && CStats::StatTypesInt[45] <= -1 )
      {
        v4.n64_u32[0] = 0;
        v6.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
        LODWORD(CStats::StatTypesFloat[21]) = vmax_f32(v6, v4).n64_u32[0];
        CStats::CheckForStatsMessage(0);
      }
      CStats::CheckForStatsMessage(0);
    }
  }
  else
  {
    CStats::IncrementStat(index, amount);
  }
}
// 415966: variable 'v2' is possibly undefined
// 415966: variable 'v4' is possibly undefined
// 4159A0: variable 'v3' is possibly undefined

//----- (00415A10) --------------------------------------------------------
void __fastcall CStats::IncrementStat(UInt16 index, float amount)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d3
  float v6; // s16
  int v7; // r4
  float *v8; // r0
  CPlayerInfo *v9; // r12
  float m_nHealth; // s18
  unsigned int v11; // r5
  float v12; // s0
  CPlayerInfo *v13; // r1
  float MaxHealth; // s2
  unsigned __int32 *p_m_nHealth; // r0
  float v16; // s2
  float v17; // s0
  int v18; // r1
  bool v19; // zf
  unsigned __int32 v20; // s0

  v6 = amount;
  v7 = index;
  if ( amount > 0.0 )
  {
    if ( index > 0x51u )
    {
      v9 = &CWorld::Players[CWorld::PlayerInFocus];
      if ( index == 335 )
      {
        v5.n64_u32[0] = 0;
        v4.n64_u32[0] = 1108344832;
        v13 = &CWorld::Players[CWorld::PlayerInFocus];
        v2.n64_f32[0] = (float)v13->TimeLastEaten + (float)(v6 * -0.5);
        v2.n64_u64[0] = vmin_f32(vmax_f32(v2, v5), v4).n64_u64[0];
        MaxHealth = (float)v13->MaxHealth;
        v13->TimeLastEaten = (int)v2.n64_f32[0];
        p_m_nHealth = (unsigned __int32 *)&v9->pPed->m_nHealth;
        v2.n64_u32[0] = *p_m_nHealth;
        v16 = (float)(int)(float)(MaxHealth - *(float *)p_m_nHealth);
        if ( v16 <= v6 )
        {
          v6 = v16;
          v13->TimeLastEaten = 0;
          v2.n64_u32[0] = *p_m_nHealth;
        }
        *(float *)p_m_nHealth = v6 + v2.n64_f32[0];
        v17 = (float)(CStats::m_AddToHealthCounter + (unsigned int)v6);
        CStats::m_AddToHealthCounter += (unsigned int)v6;
        if ( CStats::StatReactionValue[58] < v17 )
        {
          v2.n64_f32[0] = CStats::StatReactionValue[11];
          if ( CStats::StatReactionValue[11] > 0.0 )
          {
            v4.n64_u32[0] = 1148846080;
            v2.n64_f32[0] = CStats::StatReactionValue[11] + CStats::StatTypesFloat[24];
            v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
            CStats::StatTypesFloat[24] = v2.n64_f32[0];
            CStats::CheckForStatsMessage(0);
            v2.n64_f32[0] = CStats::StatReactionValue[11];
          }
          if ( v2.n64_f32[0] > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[24] < 1000.0 )
            CHud::SetHelpMessageStatUpdate(1u, 0x18u, v2.n64_f32[0], 1000.0);
          CStats::m_AddToHealthCounter = 0;
        }
      }
      else if ( index == 245 )
      {
        m_nHealth = v9->pPed->m_nHealth;
        v11 = CWorld::Players[CWorld::PlayerInFocus].MaxHealth;
        CStats::IncrementStat(0x14Fu, amount);
        v12 = (float)(int)(float)((float)v11 - m_nHealth);
        if ( v12 < v6 )
        {
          v2.n64_f32[0] = (float)(v6 - v12) * 0.5;
          if ( v2.n64_f32[0] > 0.0 )
          {
            v4.n64_u32[0] = 1148846080;
            v2.n64_f32[0] = v2.n64_f32[0] + CStats::StatTypesFloat[21];
            v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
            CStats::StatTypesFloat[21] = v2.n64_f32[0];
            CStats::CheckForStatsMessage(0);
          }
        }
      }
      else
      {
        v18 = CStats::StatTypesInt[index - 120] + (int)amount;
        CStats::StatTypesInt[index - 120] = v18;
        switch ( index )
        {
          case 0xA0u:
          case 0xA4u:
          case 0xA5u:
          case 0xDFu:
          case 0xE1u:
          case 0xE5u:
          case 0xE6u:
          case 0xE9u:
          case 0xF1u:
          case 0xF2u:
          case 0xF3u:
          case 0xF4u:
            v2.n64_u32[0] = 1148846080;
            v3.n64_f32[0] = (float)v18;
            v2.n64_u64[0] = vmin_f32(v3, v2).n64_u64[0];
            CStats::StatTypesInt[index - 120] = (int)v2.n64_f32[0];
            break;
          default:
            break;
        }
      }
    }
    else
    {
      v8 = &CStats::StatTypesFloat[index];
      v2.n64_f32[0] = *v8 + amount;
      *v8 = v2.n64_f32[0];
      if ( (unsigned int)(v7 - 65) <= 0xF && v7 != 68 || (unsigned int)(v7 - 21) < 5 )
      {
        v3.n64_u32[0] = 1148846080;
        v2.n64_u64[0] = vmin_f32(v2, v3).n64_u64[0];
        *v8 = v2.n64_f32[0];
      }
    }
    v19 = (unsigned __int8)v7 == 22;
    if ( (unsigned __int8)v7 != 22 )
      v19 = (unsigned __int8)v7 == 225;
    if ( v19 )
    {
      if ( CStats::StatTypesInt[45] > -1 )
      {
LABEL_34:
        CStats::CheckForStatsMessage(0);
        return;
      }
      v4.n64_u32[0] = 0;
      v2.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
      v20 = vmax_f32(v2, v4).n64_u32[0];
    }
    else
    {
      if ( (unsigned __int8)v7 != 165 )
        goto LABEL_34;
      if ( CStats::StatTypesInt[45] <= 1000 )
        goto LABEL_34;
      v2.n64_f32[0] = (float)CStats::StatTypesInt[45] + -1000.0;
      if ( v2.n64_f32[0] <= 0.0 )
        goto LABEL_34;
      v4.n64_u32[0] = 1148846080;
      v2.n64_f32[0] = v2.n64_f32[0] + CStats::StatTypesFloat[21];
      v20 = vmin_f32(v2, v4).n64_u32[0];
    }
    LODWORD(CStats::StatTypesFloat[21]) = v20;
    CStats::CheckForStatsMessage(0);
    goto LABEL_34;
  }
}
// 415A64: variable 'v2' is possibly undefined
// 415A64: variable 'v3' is possibly undefined
// 415B0A: variable 'v4' is possibly undefined
// 415B4C: variable 'v5' is possibly undefined

//----- (00415DF8) --------------------------------------------------------
void __fastcall CStats::DecrementStat(UInt16 index, float amount)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float *v5; // r1
  float32x2_t v6; // d0
  Int32 *v7; // r1

  v2.n64_f32[0] = amount;
  if ( amount > 0.0 )
  {
    if ( index > 0x51u )
    {
      v3.n64_u32[0] = 0;
      v7 = &CStats::StatTypesInt[index];
      v2.n64_f32[0] = (float)(*(v7 - 120) - (int)v2.n64_f32[0]);
      v6.n64_u64[0] = vmax_f32(v2, v3).n64_u64[0];
      *(v7 - 120) = (int)v6.n64_f32[0];
    }
    else
    {
      v4.n64_u32[0] = 0;
      v5 = &CStats::StatTypesFloat[index];
      v2.n64_f32[0] = *v5 - v2.n64_f32[0];
      v6.n64_u64[0] = vmax_f32(v2, v4).n64_u64[0];
      *v5 = v6.n64_f32[0];
    }
    if ( (unsigned __int8)index == 165 && CStats::StatTypesInt[45] <= -1 )
    {
      v4.n64_u32[0] = 0;
      v6.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
      LODWORD(CStats::StatTypesFloat[21]) = vmax_f32(v6, v4).n64_u32[0];
      CStats::CheckForStatsMessage(0);
    }
    CStats::CheckForStatsMessage(0);
  }
}
// 415E22: variable 'v2' is possibly undefined
// 415E22: variable 'v4' is possibly undefined
// 415E58: variable 'v3' is possibly undefined

//----- (00415EC4) --------------------------------------------------------
bool8 __fastcall CStats::IsStatCapped(UInt16 index)
{
  int v1; // r1
  bool8 result; // r0

  v1 = index - 21;
  result = 1;
  switch ( v1 )
  {
    case 0:
    case 1:
    case 2:
    case 3:
    case 4:
    case 44:
    case 45:
    case 46:
    case 48:
    case 49:
    case 50:
    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
    case 139:
    case 143:
    case 144:
    case 202:
    case 204:
    case 208:
    case 209:
    case 212:
    case 220:
    case 221:
    case 222:
    case 223:
      return result;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (0041609C) --------------------------------------------------------
void __fastcall CStats::UpdateStatsAddToHealth(uint32 nAdd)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d2
  float v3; // s0

  CStats::m_AddToHealthCounter += nAdd;
  if ( CStats::StatReactionValue[58] < (float)CStats::m_AddToHealthCounter )
  {
    v3 = CStats::StatReactionValue[11];
    if ( CStats::StatReactionValue[11] > 0.0 )
    {
      v2.n64_u32[0] = 1148846080;
      v1.n64_f32[0] = CStats::StatReactionValue[11] + CStats::StatTypesFloat[24];
      LODWORD(CStats::StatTypesFloat[24]) = vmin_f32(v1, v2).n64_u32[0];
      CStats::CheckForStatsMessage(0);
      v3 = CStats::StatReactionValue[11];
    }
    if ( v3 > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[24] < 1000.0 )
      CHud::SetHelpMessageStatUpdate(1u, 0x18u, v3, 1000.0);
    CStats::m_AddToHealthCounter = 0;
  }
}
// 4160F0: variable 'v1' is possibly undefined
// 4160F0: variable 'v2' is possibly undefined

//----- (00416180) --------------------------------------------------------
void __fastcall CStats::ProcessReactionStatsOnIncrement(UInt8 index)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d2
  bool v3; // zf
  unsigned __int32 v4; // s0

  v3 = index == 22;
  if ( index != 22 )
    v3 = index == 225;
  if ( v3 )
  {
    if ( CStats::StatTypesInt[45] > -1 )
      return;
    v2.n64_u32[0] = 0;
    v1.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
    v4 = vmax_f32(v1, v2).n64_u32[0];
    goto LABEL_11;
  }
  if ( index == 165 && CStats::StatTypesInt[45] > 1000 )
  {
    v1.n64_f32[0] = (float)CStats::StatTypesInt[45] + -1000.0;
    if ( v1.n64_f32[0] > 0.0 )
    {
      v2.n64_u32[0] = 1148846080;
      v1.n64_f32[0] = v1.n64_f32[0] + CStats::StatTypesFloat[21];
      v4 = vmin_f32(v1, v2).n64_u32[0];
LABEL_11:
      LODWORD(CStats::StatTypesFloat[21]) = v4;
      CStats::CheckForStatsMessage(0);
    }
  }
}
// 4161C8: variable 'v1' is possibly undefined
// 4161C8: variable 'v2' is possibly undefined

//----- (00416224) --------------------------------------------------------
void __fastcall CStats::ProcessReactionStatsOnDecrement(UInt8 index)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d2

  if ( index == 165 && CStats::StatTypesInt[45] <= -1 )
  {
    v2.n64_u32[0] = 0;
    v1.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
    LODWORD(CStats::StatTypesFloat[21]) = vmax_f32(v1, v2).n64_u32[0];
    CStats::CheckForStatsMessage(0);
  }
}
// 416250: variable 'v1' is possibly undefined
// 416250: variable 'v2' is possibly undefined

//----- (0041626C) --------------------------------------------------------
void __fastcall CStats::SetNewRecordStat(UInt16 index, float NewLevel)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float *v4; // r0
  Int32 *v5; // r0

  v2.n64_f32[0] = NewLevel;
  if ( index > 0x51u )
  {
    v5 = &CStats::StatTypesInt[index];
    v3.n64_f32[0] = (float)*(v5 - 120);
    *(v5 - 120) = (int)vmax_f32(v3, v2).n64_f32[0];
  }
  else
  {
    v4 = &CStats::StatTypesFloat[index];
    v3.n64_f32[0] = *v4;
    *(_DWORD *)v4 = vmax_f32(v3, v2).n64_u32[0];
  }
  CStats::CheckForStatsMessage(0);
}
// 416282: variable 'v3' is possibly undefined
// 416282: variable 'v2' is possibly undefined

//----- (004162C8) --------------------------------------------------------
uint8 __fastcall CStats::GetTimesMissionAttempted(UInt8 MissionNumber)
{
  return CStats::TimesMissionAttempted[MissionNumber];
}

//----- (004162D8) --------------------------------------------------------
void __fastcall CStats::RegisterMissionAttempted(UInt8 MissionNumber)
{
  if ( CStats::TimesMissionAttempted[MissionNumber] != -1 )
    ++CStats::TimesMissionAttempted[MissionNumber];
}

//----- (004162FC) --------------------------------------------------------
void __fastcall CStats::RegisterMissionPassed(UInt8 MissionNumber)
{
  CStats::TimesMissionAttempted[MissionNumber] = -1;
}

//----- (00416310) --------------------------------------------------------
void __fastcall CStats::RegisterFastestTime(Int32 StatIndex, Int32 NewTime)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float v4; // s0
  float *v5; // r0
  Int32 *v6; // r0

  if ( (unsigned __int16)StatIndex > 0x51u )
    v4 = (float)CStats::StatTypesInt[(unsigned __int16)StatIndex - 120];
  else
    v4 = CStats::StatTypesFloat[(unsigned __int16)StatIndex];
  if ( v4 == 0.0 )
  {
    if ( (unsigned __int16)StatIndex <= 0x51u )
    {
      CStats::StatTypesFloat[(unsigned __int16)StatIndex] = (float)NewTime;
      CStats::CheckForStatsMessage(0);
      return;
    }
    NewTime = (__int16)NewTime;
    v6 = &CStats::StatTypesInt[(unsigned __int16)StatIndex];
    goto LABEL_12;
  }
  if ( (unsigned __int16)StatIndex > 0x51u )
  {
    v6 = &CStats::StatTypesInt[(unsigned __int16)StatIndex];
    v3.n64_f32[0] = (float)NewTime;
    v2.n64_f32[0] = (float)*(v6 - 120);
    NewTime = (int)vmin_f32(v2, v3).n64_f32[0];
LABEL_12:
    *(v6 - 120) = NewTime;
    CStats::CheckForStatsMessage(0);
    return;
  }
  v2.n64_f32[0] = (float)NewTime;
  v5 = &CStats::StatTypesFloat[(unsigned __int16)StatIndex];
  v3.n64_f32[0] = *v5;
  *(_DWORD *)v5 = vmin_f32(v3, v2).n64_u32[0];
  CStats::CheckForStatsMessage(0);
}
// 41635C: variable 'v3' is possibly undefined
// 41635C: variable 'v2' is possibly undefined

//----- (004163E8) --------------------------------------------------------
void __fastcall CStats::RegisterBestPosition(Int32 StatIndex, Int32 NewPosition)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float v4; // s0
  float *v5; // r0
  Int32 *v6; // r0

  if ( (unsigned __int16)StatIndex > 0x51u )
    v4 = (float)CStats::StatTypesInt[(unsigned __int16)StatIndex - 120];
  else
    v4 = CStats::StatTypesFloat[(unsigned __int16)StatIndex];
  if ( v4 == 0.0 )
  {
    if ( (unsigned __int16)StatIndex <= 0x51u )
    {
      CStats::StatTypesFloat[(unsigned __int16)StatIndex] = (float)NewPosition;
      CStats::CheckForStatsMessage(0);
      return;
    }
    NewPosition = (__int16)NewPosition;
    v6 = &CStats::StatTypesInt[(unsigned __int16)StatIndex];
    goto LABEL_12;
  }
  if ( (unsigned __int16)StatIndex > 0x51u )
  {
    v6 = &CStats::StatTypesInt[(unsigned __int16)StatIndex];
    v3.n64_f32[0] = (float)NewPosition;
    v2.n64_f32[0] = (float)*(v6 - 120);
    NewPosition = (int)vmin_f32(v2, v3).n64_f32[0];
LABEL_12:
    *(v6 - 120) = NewPosition;
    CStats::CheckForStatsMessage(0);
    return;
  }
  v2.n64_f32[0] = (float)NewPosition;
  v5 = &CStats::StatTypesFloat[(unsigned __int16)StatIndex];
  v3.n64_f32[0] = *v5;
  *(_DWORD *)v5 = vmin_f32(v3, v2).n64_u32[0];
  CStats::CheckForStatsMessage(0);
}
// 416434: variable 'v3' is possibly undefined
// 416434: variable 'v2' is possibly undefined

//----- (004164C0) --------------------------------------------------------
float __fastcall CStats::GetFavoriteRadioStationList(Int32 station)
{
  return 0.0;
}

//----- (004164C4) --------------------------------------------------------
Int32 *CStats::GetFullFavoriteRadioStationList()
{
  return CStats::FavoriteRadioStationList;
}

//----- (004164D0) --------------------------------------------------------
Int32 CStats::FindMostFavoriteRadioStation()
{
  Int32 result; // r0
  Int32 v1; // r1

  result = 1;
  v1 = CStats::FavoriteRadioStationList[1];
  if ( CStats::FavoriteRadioStationList[1] <= 0 )
    v1 = 0;
  if ( CStats::FavoriteRadioStationList[2] > v1 )
  {
    result = 2;
    v1 = CStats::FavoriteRadioStationList[2];
  }
  if ( CStats::FavoriteRadioStationList[3] > v1 )
  {
    result = 3;
    v1 = CStats::FavoriteRadioStationList[3];
  }
  if ( CStats::FavoriteRadioStationList[4] > v1 )
    result = 4;
  if ( CStats::FavoriteRadioStationList[4] > v1 )
    v1 = CStats::FavoriteRadioStationList[4];
  if ( CStats::FavoriteRadioStationList[5] > v1 )
    result = 5;
  if ( CStats::FavoriteRadioStationList[5] > v1 )
    v1 = CStats::FavoriteRadioStationList[5];
  if ( CStats::FavoriteRadioStationList[6] > v1 )
    result = 6;
  if ( CStats::FavoriteRadioStationList[6] > v1 )
    v1 = CStats::FavoriteRadioStationList[6];
  if ( CStats::FavoriteRadioStationList[7] > v1 )
    result = 7;
  if ( CStats::FavoriteRadioStationList[7] > v1 )
    v1 = CStats::FavoriteRadioStationList[7];
  if ( CStats::FavoriteRadioStationList[8] > v1 )
  {
    result = 8;
    v1 = CStats::FavoriteRadioStationList[8];
  }
  if ( CStats::FavoriteRadioStationList[9] > v1 )
  {
    result = 9;
    v1 = CStats::FavoriteRadioStationList[9];
  }
  if ( CStats::FavoriteRadioStationList[10] > v1 )
  {
    result = 10;
    v1 = CStats::FavoriteRadioStationList[10];
  }
  if ( CStats::FavoriteRadioStationList[11] > v1 )
  {
    result = 11;
    v1 = CStats::FavoriteRadioStationList[11];
  }
  if ( CStats::FavoriteRadioStationList[12] > v1 )
    return 12;
  return result;
}

//----- (00416564) --------------------------------------------------------
Int32 CStats::FindLeastFavoriteRadioStation()
{
  Int32 result; // r0
  Int32 v1; // r1

  result = 1;
  v1 = CStats::FavoriteRadioStationList[1];
  if ( CStats::FavoriteRadioStationList[2] < CStats::FavoriteRadioStationList[1] )
  {
    result = 2;
    v1 = CStats::FavoriteRadioStationList[2];
  }
  if ( CStats::FavoriteRadioStationList[3] < v1 )
  {
    result = 3;
    v1 = CStats::FavoriteRadioStationList[3];
  }
  if ( CStats::FavoriteRadioStationList[4] < v1 )
  {
    result = 4;
    v1 = CStats::FavoriteRadioStationList[4];
  }
  if ( CStats::FavoriteRadioStationList[5] < v1 )
  {
    result = 5;
    v1 = CStats::FavoriteRadioStationList[5];
  }
  if ( CStats::FavoriteRadioStationList[6] < v1 )
    result = 6;
  if ( CStats::FavoriteRadioStationList[6] < v1 )
    v1 = CStats::FavoriteRadioStationList[6];
  if ( CStats::FavoriteRadioStationList[7] < v1 )
  {
    result = 7;
    v1 = CStats::FavoriteRadioStationList[7];
  }
  if ( CStats::FavoriteRadioStationList[8] < v1 )
  {
    result = 8;
    v1 = CStats::FavoriteRadioStationList[8];
  }
  if ( CStats::FavoriteRadioStationList[9] < v1 )
  {
    result = 9;
    v1 = CStats::FavoriteRadioStationList[9];
  }
  if ( CStats::FavoriteRadioStationList[10] < v1 )
  {
    result = 10;
    v1 = CStats::FavoriteRadioStationList[10];
  }
  if ( CStats::FavoriteRadioStationList[11] < v1 )
    return 11;
  return result;
}

//----- (004165E8) --------------------------------------------------------
GxtChar *CStats::FindCriminalRatingString()
{
  Int32 CriminalRatingNumber; // r0
  const char *v1; // r1
  int p_z; // r3
  const char *v3; // r2

  CriminalRatingNumber = CStats::FindCriminalRatingNumber();
  if ( CriminalRatingNumber <= -1 )
  {
    if ( CriminalRatingNumber > -500 )
    {
      v1 = "RATNG53";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber > -2000 )
    {
      v1 = "RATNG54";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber > -4000 )
    {
      v1 = "RATNG55";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    p_z = -6000;
    v3 = "RATNG57";
    v1 = "RATNG56";
  }
  else
  {
    if ( CriminalRatingNumber < 20 )
    {
      v1 = "RATNG1";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 50 )
    {
      v1 = "RATNG2";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 75 )
    {
      v1 = "RATNG3";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 100 )
    {
      v1 = "RATNG4";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 120 )
    {
      v1 = "RATNG5";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 150 )
    {
      v1 = "RATNG6";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 200 )
    {
      v1 = "RATNG7";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 240 )
    {
      v1 = "RATNG8";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 270 )
    {
      v1 = "RATNG9";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 300 )
    {
      v1 = "RATNG10";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber <= 334 )
    {
      v1 = "RATNG11";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 370 )
    {
      v1 = "RATNG12";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 400 )
    {
      v1 = "RATNG13";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 450 )
    {
      v1 = "RATNG14";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 500 )
    {
      v1 = "RATNG15";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 550 )
    {
      v1 = "RATNG16";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 600 )
    {
      v1 = "RATNG17";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 610 )
    {
      v1 = "RATNG18";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 650 )
    {
      v1 = "RATNG19";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 700 )
    {
      v1 = "RATNG20";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 850 )
    {
      v1 = "RATNG21";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 1000 )
    {
      v1 = "RATNG22";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber <= 1004 )
    {
      v1 = "RATNG23";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    v1 = "RATNG24";
    if ( CriminalRatingNumber < 1150 )
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    if ( CriminalRatingNumber <= 1299 )
    {
      if ( CStats::StatTypesInt[13] > 0 )
        v1 = "RATNG25";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 1500 )
    {
      v1 = "RATNG26";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 1700 )
    {
      v1 = "RATNG27";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 2000 )
    {
      v1 = "RATNG28";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 2100 )
    {
      v1 = "RATNG29";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 2300 )
    {
      v1 = "RATNG30";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 2500 )
    {
      v1 = "RATNG31";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 2750 )
    {
      v1 = "RATNG32";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 3000 )
    {
      v1 = "RATNG33";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 3500 )
    {
      v1 = "RATNG34";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 4000 )
    {
      v1 = "RATNG35";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 5000 )
    {
      v1 = "RATNG36";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 7500 )
    {
      v1 = "RATNG37";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 10000 )
    {
      v1 = "RATNG38";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 20000 )
    {
      v1 = "RATNG39";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 30000 )
    {
      v1 = "RATNG40";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 40000 )
    {
      v1 = "RATNG41";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 50000 )
    {
      v1 = "RATNG42";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < 65000 )
    {
      v1 = "RATNG43";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < (int)&elf_hash_chain[3526] )
    {
      v1 = "RATNG44";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < (int)&elf_hash_chain[8526] )
    {
      v1 = "RATNG45";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < (int)&elf_hash_chain[21026] )
    {
      v1 = "RATNG46";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < (int)&stru_30D3C.st_value )
    {
      v1 = "RATNG47";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < (int)&stru_493DC.st_value )
    {
      v1 = "RATNG48";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < (int)&stru_5B8CC.st_info )
    {
      v1 = "RATNG49";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber <= 499999 )
    {
      v1 = "RATNG50";
      if ( (int)(float)((float)((float)CStats::StatTypesInt[49] / 60000.0) / 60.0) <= 10 )
        v1 = "RATNG49";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    if ( CriminalRatingNumber < (int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly" )
    {
      v1 = "RATNG51";
      return sub_18A500(&TheText, (const unsigned __int8 *)v1);
    }
    p_z = (int)&CWorld::m_aTempColPts[2].m_vecNormal.z;
    v3 = "RATNG51";
    v1 = "RATNG52";
    CriminalRatingNumber = CWorld::Players[CWorld::PlayerInFocus].DisplayScore;
  }
  if ( CriminalRatingNumber <= p_z )
    v1 = v3;
  return sub_18A500(&TheText, (const unsigned __int8 *)v1);
}
// 10168: using guessed type int elf_hash_chain[22025];
// 30D3C: using guessed type Elf32_Sym stru_30D3C;
// 493DC: using guessed type Elf32_Sym stru_493DC;
// 5B8CC: using guessed type Elf32_Sym stru_5B8CC;

//----- (00416AB8) --------------------------------------------------------
Int32 CStats::FindCriminalRatingNumber()
{
  Int32 result; // r0

  result = (int)(float)((float)((float)((float)((float)((float)((float)((float)((float)((float)CStats::StatTypesInt[57]
                                                                                      - (float)((float)CStats::StatTypesInt[13]
                                                                                              * 3.0))
                                                                              - (float)((float)CStats::StatTypesInt[15]
                                                                                      * 3.0))
                                                                      + (float)((float)CStats::StatTypesInt[4] * 30.0))
                                                              + (float)CStats::StatTypesInt[31])
                                                      + (float)CStats::StatTypesInt[32])
                                              + (float)((float)CStats::StatTypesInt[38] * 10.0))
                                      + (float)((float)CStats::StatTypesInt[39] * 10.0))
                              + (float)CStats::StatTypesInt[33])
                      + (float)(CWorld::Players[CWorld::PlayerInFocus].Score / 5000));
  if ( CCheat::m_bHasPlayerCheated || CStats::StatTypesInt[17] >= 1 )
  {
    result = -10000;
    if ( (int)(float)((float)(int)(float)((float)((float)((float)((float)((float)((float)((float)((float)((float)CStats::StatTypesInt[57] - (float)((float)CStats::StatTypesInt[13] * 3.0))
                                                                                                - (float)((float)CStats::StatTypesInt[15] * 3.0))
                                                                                        + (float)((float)CStats::StatTypesInt[4]
                                                                                                * 30.0))
                                                                                + (float)CStats::StatTypesInt[31])
                                                                        + (float)CStats::StatTypesInt[32])
                                                                + (float)((float)CStats::StatTypesInt[38] * 10.0))
                                                        + (float)((float)CStats::StatTypesInt[39] * 10.0))
                                                + (float)CStats::StatTypesInt[33])
                                        + (float)(CWorld::Players[CWorld::PlayerInFocus].Score / 5000))
                    + (float)((float)CStats::StatTypesInt[17] * -10.0)) > -10000 )
      result = (int)(float)((float)(int)(float)((float)((float)((float)((float)((float)((float)((float)((float)((float)CStats::StatTypesInt[57] - (float)((float)CStats::StatTypesInt[13] * 3.0)) - (float)((float)CStats::StatTypesInt[15] * 3.0))
                                                                                              + (float)((float)CStats::StatTypesInt[4] * 30.0))
                                                                                      + (float)CStats::StatTypesInt[31])
                                                                              + (float)CStats::StatTypesInt[32])
                                                                      + (float)((float)CStats::StatTypesInt[38] * 10.0))
                                                              + (float)((float)CStats::StatTypesInt[39] * 10.0))
                                                      + (float)CStats::StatTypesInt[33])
                                              + (float)(CWorld::Players[CWorld::PlayerInFocus].Score / 5000))
                          + (float)((float)CStats::StatTypesInt[17] * -10.0));
  }
  else if ( result <= 0 )
  {
    result = 0;
  }
  if ( CStats::StatTypesInt[6] >= 101 )
    result = (int)(float)((float)((float)((float)CStats::StatTypesInt[8] / (float)CStats::StatTypesInt[6]) * 500.0)
                        + (float)result);
  if ( CStats::StatTypesFloat[1] != 0.0 )
    return (int)(float)((float)((float)(CStats::StatTypesFloat[0] / CStats::StatTypesFloat[1]) * 1000.0) + (float)result);
  return result;
}

//----- (00416C7C) --------------------------------------------------------
unsigned __int32 CStats::GetPercentageProgress()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d1

  if ( CStats::StatTypesFloat[1] == 0.0 )
    v0.n64_u32[0] = 0;
  else
    v0.n64_f32[0] = (float)(CStats::StatTypesFloat[0] * 100.0) / CStats::StatTypesFloat[1];
  v1.n64_u32[0] = 1120403456;
  return vmin_f32(v0, v1).n64_u32[0];
}
// 416CB0: variable 'v0' is possibly undefined
// 416CB0: variable 'v1' is possibly undefined

//----- (00416CCC) --------------------------------------------------------
Int32 __fastcall CStats::ConstructStatLine(Int32 LineID, uint8 CurrentCategory)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  sStatStruct *v4; // r10
  int stat_num; // r4
  sStatStruct *v6; // r6
  int v7; // r9
  int v8; // r0
  sStatStruct *v9; // r5
  float v10; // s0
  Int32 v11; // r0
  bool v12; // zf
  float v13; // s0
  float v14; // s0
  float v15; // s0
  float v16; // s0
  float v17; // s0
  float v18; // s0
  float v19; // s16
  float v20; // s0
  GxtChar *v21; // r0
  GxtChar *v22; // r0
  GxtChar *v23; // r0
  int v24; // r1
  int v25; // r2
  unsigned int v26; // r2
  float v27; // s0
  GxtChar *v28; // r0
  GxtChar *v29; // r0
  Char *v30; // r0
  GxtChar *v31; // r0
  int v32; // s0
  int v33; // r3
  int v34; // r3
  GxtChar *v35; // r0
  float v36; // s0
  GxtChar *v37; // r0
  GxtChar *v38; // r0
  GxtChar *v39; // r0
  Int32 v42; // [sp+50h] [bp-40h]
  float NumberPtr[2]; // [sp+54h] [bp-3Ch] BYREF

  if ( CurrentCategory > 6u )
    v4 = StatsMiscList;
  else
    v4 = (sStatStruct *)*(&off_667D40 + (char)CurrentCategory);
  stat_num = (unsigned __int16)v4->stat_num;
  v42 = 0;
  if ( stat_num == 65437 )
    return v42;
  v6 = v4;
  v7 = 0;
  v42 = 0;
  v8 = 0;
  while ( 1 )
  {
    v9 = &v4[v8];
    if ( !v9->show )
    {
      v10 = (unsigned __int16)stat_num > 0x51u ? (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120] : CStats::StatTypesFloat[(unsigned __int16)stat_num];
      if ( v10 <= 0.0 )
        goto LABEL_46;
    }
    if ( (__int16)stat_num > 9 )
      sprintf(gString, "STAT0%d", (__int16)stat_num);
    else
      sprintf(gString, "STAT00%d", (__int16)stat_num);
LABEL_15:
    LOWORD(v6) = v6->stat_num;
    if ( CLocalisation::GermanGame() )
    {
      if ( (unsigned int)(unsigned __int8)v6 - 205 < 5
        || (unsigned int)(unsigned __int8)v6 - 167 <= 0xA && ((1 << ((_BYTE)v6 + 89)) & 0x403) != 0 )
      {
        goto LABEL_46;
      }
    }
    CStats::m_ThisStatIsABarChart = 0;
    if ( !v9->details )
    {
      switch ( v9->type )
      {
        case 1u:
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v15 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v15 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
          v42 = 0;
          gString2[0] = 0;
          sprintf(gString2, "%.2f", v15);
          v22 = CText::Get(&TheText, gString);
          GxtCharStrcpy(gGxtString, v22);
          CFont::FilterOutTokensFromString(gGxtString);
          goto LABEL_105;
        case 3u:
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v16 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v16 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
          v42 = 0;
          gString2[0] = 0;
          sprintf(gString2, (const unsigned __int8 *)&unk_617146, v16);
          v23 = CText::Get(&TheText, gString);
          GxtCharStrcpy(gGxtString, v23);
          CFont::FilterOutTokensFromString(gGxtString);
          goto LABEL_105;
        case 4u:
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v18 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v18 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
          v42 = 0;
          gString2[0] = 0;
          sprintf(gString2, (const unsigned __int8 *)&dword_417B60, (int)v18);
          v28 = CText::Get(&TheText, gString);
          GxtCharStrcpy(gGxtString, v28);
          CFont::FilterOutTokensFromString(gGxtString);
          goto LABEL_105;
        case 5u:
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v13 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v13 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
          v42 = 0;
          LODWORD(NumberPtr[0]) = (int)v13;
          CStats::BuildStatLine(gString, NumberPtr, 5, 0, 0);
          return v42;
        case 6u:
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v19 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v19 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
          v42 = 0;
          gString2[0] = 0;
          v29 = CText::Get(&TheText, "ST_MILE");
          v30 = GxtCharToAscii(v29, 0);
          sprintf(gString2, "%.2f %s", v19, (const char *)v30);
          v31 = CText::Get(&TheText, gString);
          GxtCharStrcpy(gGxtString, v31);
          CFont::FilterOutTokensFromString(gGxtString);
          goto LABEL_105;
        case 7u:
          v12 = CLocalisation::Metric() == 0;
          v11 = v42;
          if ( v12 )
          {
            if ( v42 == LineID )
            {
              if ( (unsigned __int16)stat_num > 0x51u )
                v36 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
              else
                v36 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
              v42 = 0;
              gString2[0] = 0;
              sprintf(gString2, "%.2f ft", (float)(v36 / 0.3));
              v38 = CText::Get(&TheText, gString);
              GxtCharStrcpy(gGxtString, v38);
              CFont::FilterOutTokensFromString(gGxtString);
              goto LABEL_105;
            }
          }
          else if ( v42 == LineID )
          {
            if ( (unsigned __int16)stat_num > 0x51u )
              v20 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
            else
              v20 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
            v42 = 0;
            gString2[0] = 0;
            sprintf(gString2, "%.2f m", v20);
            v37 = CText::Get(&TheText, gString);
            GxtCharStrcpy(gGxtString, v37);
            CFont::FilterOutTokensFromString(gGxtString);
            goto LABEL_105;
          }
LABEL_45:
          v42 = v11 + 1;
          goto LABEL_46;
        case 9u:
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v17 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v17 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
          v24 = (int)v17;
          if ( (int)v17 < 60 )
          {
            v26 = 0;
            if ( (unsigned __int16)stat_num <= 0x51u )
            {
LABEL_80:
              v27 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
              goto LABEL_87;
            }
          }
          else
          {
            v25 = ~v24;
            if ( ~v24 < -120 || v24 == 119 )
              v25 = -120;
            v26 = (v24 + v25 + 60) / 0x3Cu + 1;
            if ( (unsigned __int16)stat_num <= 0x51u )
              goto LABEL_80;
          }
          v27 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
LABEL_87:
          v32 = (int)v27;
          v33 = ~v32;
          if ( ~v32 < -60 || v32 == 59 )
            v33 = -60;
          gString2[0] = 0;
          v34 = -60 * ((v33 + v32 + 60) / 0x3Cu) + v32;
          if ( v34 < 0 )
            v34 = -v34;
          if ( v34 > 9 )
            sprintf(gString2, "%d:%d", v26);
          else
            sprintf(gString2, "%d:0%d", v26);
          v35 = CText::Get(&TheText, gString);
          GxtCharStrcpy(gGxtString, v35);
          CFont::FilterOutTokensFromString(gGxtString);
          AsciiToGxtChar(gString2, gGxtString2);
          return 0;
        case 0xAu:
          CStats::m_ThisStatIsABarChart = stat_num;
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v14 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v14 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
          goto LABEL_69;
        default:
          v11 = v42;
          if ( v42 != LineID )
            goto LABEL_45;
          if ( (unsigned __int16)stat_num > 0x51u )
            v14 = (float)CStats::StatTypesInt[(unsigned __int16)stat_num - 120];
          else
            v14 = CStats::StatTypesFloat[(unsigned __int16)stat_num];
LABEL_69:
          v42 = 0;
          gString2[0] = 0;
          sprintf(gString2, (const unsigned __int8 *)&dword_4179EC, (int)v14);
          v21 = CText::Get(&TheText, gString);
          GxtCharStrcpy(gGxtString, v21);
          CFont::FilterOutTokensFromString(gGxtString);
          goto LABEL_105;
      }
    }
    if ( (unsigned int)(__int16)stat_num >> 1 <= 0xA8 )
      break;
LABEL_46:
    v8 = (unsigned __int16)++v7;
    stat_num = (unsigned __int16)v4[(unsigned __int16)v7].stat_num;
    v6 = &v4[(unsigned __int16)v7];
    if ( stat_num == 65437 )
      return v42;
  }
  switch ( (__int16)stat_num )
  {
    case 0:
      v11 = v42;
      if ( v42 != LineID )
        goto LABEL_45;
      if ( CStats::StatTypesFloat[1] == 0.0 )
        v2.n64_u32[0] = 0;
      else
        v2.n64_f32[0] = (float)(CStats::StatTypesFloat[0] * 100.0) / CStats::StatTypesFloat[1];
      v3.n64_u32[0] = 1120403456;
      v42 = 0;
      gString2[0] = 0;
      sprintf(gString2, "%0.2f%%", vmin_f32(v2, v3).n64_f32[0]);
      v39 = CText::Get(&TheText, gString);
      GxtCharStrcpy(gGxtString, v39);
      CFont::FilterOutTokensFromString(gGxtString);
      break;
    case 1:
    case 2:
    case 3:
    case 4:
    case 5:
    case 6:
    case 7:
    case 8:
    case 9:
    case 10:
    case 11:
    case 12:
    case 13:
    case 14:
    case 15:
    case 16:
    case 17:
    case 18:
    case 19:
    case 20:
    case 21:
    case 22:
    case 23:
    case 24:
    case 25:
    case 26:
    case 27:
    case 28:
    case 29:
    case 30:
    case 31:
    case 32:
    case 33:
    case 34:
    case 35:
    case 36:
    case 37:
    case 38:
    case 39:
    case 40:
    case 41:
    case 42:
    case 43:
    case 44:
    case 45:
    case 46:
    case 47:
    case 48:
    case 49:
    case 50:
    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
    case 60:
    case 61:
    case 62:
    case 63:
    case 64:
    case 65:
    case 66:
    case 67:
    case 68:
    case 69:
    case 70:
    case 71:
    case 72:
    case 73:
    case 74:
    case 75:
    case 76:
    case 77:
    case 78:
    case 79:
    case 80:
    case 81:
    case 82:
    case 83:
    case 84:
    case 85:
    case 86:
    case 87:
    case 88:
    case 89:
    case 90:
    case 91:
    case 92:
    case 93:
    case 94:
    case 95:
    case 96:
    case 97:
    case 98:
    case 99:
      goto LABEL_46;
    default:
      sprintf(gString, "STAT%d", (__int16)stat_num);
      goto LABEL_15;
  }
LABEL_105:
  AsciiToGxtChar(gString2, gGxtString2);
  return v42;
}
// 418F7A: variable 'v2' is possibly undefined
// 418F7A: variable 'v3' is possibly undefined
// 4179EC: using guessed type int dword_4179EC;
// 417B60: using guessed type int dword_417B60;
// 667D40: using guessed type sStatStruct (*off_667D40)[25];
// 416CCC: using guessed type float NumberPtr[2];

//----- (00419B5C) --------------------------------------------------------
bool8 __fastcall CStats::SafeToShowThisStat(uint8 index)
{
  int v1; // r4
  bool8 result; // r0

  v1 = index;
  if ( !CLocalisation::GermanGame() )
    return 1;
  result = 0;
  if ( (unsigned int)(v1 - 205) < 5 )
    return result;
  if ( (unsigned int)(v1 - 167) > 0xA )
    return 1;
  if ( ((1 << (v1 + 89)) & 0x403) == 0 )
    return 1;
  return result;
}

//----- (00419B94) --------------------------------------------------------
void __fastcall CStats::BuildStatLine(
        unsigned __int8 *TEXT,
        void *NumberPtr,
        Int32 bNumberIsFloat,
        void *NumberPtr2,
        Int32 Type)
{
  int v6; // r3
  int v7; // r2
  int v8; // r5
  Char *v9; // r4
  GxtChar *v10; // r0
  double v11; // r2
  const char *v12; // r1
  float v13; // s18
  float v14; // s16
  GxtChar *v15; // r0
  Char *v16; // r0
  double v17; // d16
  float v18; // s18
  GxtChar *v19; // r0
  double v20; // d16
  int v21; // r5
  float v22; // s16
  GxtChar *v23; // r0
  float v24; // s0
  GxtChar *v25; // r0
  GxtChar *v26; // r0
  Char *v27; // [sp+0h] [bp-30h]
  int v28; // [sp+4h] [bp-2Ch]
  double v29; // [sp+8h] [bp-28h]

  if ( TEXT )
  {
    gString2[0] = 0;
    if ( Type == 1 )
    {
      v6 = *(_DWORD *)NumberPtr2;
      v7 = *(_DWORD *)NumberPtr;
      if ( v6 > 9 )
        sprintf(gString2, "%d:%d", v7, v6);
      else
        sprintf(gString2, "%d:0%d", v7, v6);
      goto LABEL_31;
    }
    if ( !NumberPtr2 )
    {
      if ( NumberPtr )
      {
        switch ( bNumberIsFloat )
        {
          case 0:
            sprintf(gString2, (const unsigned __int8 *)&dword_419EB8, *(_DWORD *)NumberPtr);
            goto LABEL_31;
          case 1:
            v20 = *(float *)NumberPtr;
            v12 = "%.2f";
            goto LABEL_28;
          case 2:
            v20 = *(float *)NumberPtr;
            v12 = "%0.2f%%";
            goto LABEL_28;
          case 3:
            v20 = *(float *)NumberPtr;
            v12 = (const char *)&unk_617146;
            goto LABEL_28;
          case 4:
            sprintf(gString2, (const unsigned __int8 *)&dword_419EA0, *(_DWORD *)NumberPtr);
            goto LABEL_31;
          case 5:
            v21 = *(_DWORD *)NumberPtr;
            if ( CLocalisation::Metric() )
              sprintf(gString2, "%dkgs", (int)(float)((float)v21 * 0.4536));
            else
              sprintf(gString2, "%dlbs", v21);
            goto LABEL_31;
          case 6:
            v22 = *(float *)NumberPtr;
            v23 = CText::Get(&TheText, "ST_MILE");
            v27 = GxtCharToAscii(v23, 0);
            v12 = "%.2f %s";
            v11 = v22;
            goto LABEL_30;
          case 7:
            v20 = *(float *)NumberPtr;
            v12 = "%.2f m";
LABEL_28:
            v11 = v20;
            goto LABEL_30;
          case 8:
            v24 = *(float *)NumberPtr / 0.3;
            v12 = "%.2f ft";
            v11 = v24;
            goto LABEL_30;
          case 9:
            v8 = *(_DWORD *)NumberPtr;
            v26 = CText::Get(&TheText, "ST_SECS");
            HIDWORD(v11) = GxtCharToAscii(v26, 0);
            v12 = "%d %s";
            goto LABEL_11;
          default:
            goto LABEL_31;
        }
      }
      goto LABEL_31;
    }
    if ( bNumberIsFloat == 3 )
    {
      v13 = *(float *)NumberPtr;
      v14 = *(float *)NumberPtr2;
      v15 = CText::Get(&TheText, "FEST_OO");
      v16 = GxtCharToAscii(v15, 0);
      v17 = v13;
      v12 = "$%.2f %s $%.2f";
    }
    else
    {
      if ( bNumberIsFloat != 1 )
      {
        if ( bNumberIsFloat )
        {
LABEL_31:
          v25 = CText::Get(&TheText, TEXT);
          GxtCharStrcpy(gGxtString, v25);
          CFont::FilterOutTokensFromString(gGxtString);
          sub_196418(gString2, gGxtString2);
          return;
        }
        v8 = *(_DWORD *)NumberPtr;
        v9 = *(Char **)NumberPtr2;
        v10 = CText::Get(&TheText, "FEST_OO");
        HIDWORD(v11) = GxtCharToAscii(v10, 0);
        v27 = v9;
        v12 = " %d %s %d";
LABEL_11:
        LODWORD(v11) = v8;
LABEL_30:
        sprintf(gString2, (const unsigned __int8 *)v12, v11, v27, v28, v29);
        goto LABEL_31;
      }
      v18 = *(float *)NumberPtr;
      v14 = *(float *)NumberPtr2;
      v19 = CText::Get(&TheText, "FEST_OO");
      v16 = GxtCharToAscii(v19, 0);
      v17 = v18;
      v12 = "%.2f %s %.2f";
    }
    v11 = v17;
    v29 = v14;
    v27 = v16;
    goto LABEL_30;
  }
}
// 419D80: variable 'v27' is possibly undefined
// 419D80: variable 'v28' is possibly undefined
// 419D80: variable 'v29' is possibly undefined
// 419EA0: using guessed type int dword_419EA0;
// 419EB8: using guessed type int dword_419EB8;

//----- (00419EDC) --------------------------------------------------------
Int32 __fastcall CStats::ConvertToMins(Int32 TimeInSecs)
{
  int v2; // r1

  if ( TimeInSecs < 60 )
    return 0;
  v2 = ~TimeInSecs;
  if ( ~TimeInSecs < -120 || TimeInSecs == 119 )
    v2 = -120;
  return (TimeInSecs + v2 + 60) / 0x3Cu + 1;
}

//----- (00419F08) --------------------------------------------------------
Int32 __fastcall CStats::ConvertToSecs(Int32 TimeInSecs)
{
  int v1; // r1
  Int32 result; // r0

  v1 = ~TimeInSecs;
  if ( ~TimeInSecs < -60 || TimeInSecs == 59 )
    v1 = -60;
  result = TimeInSecs - 60 * ((v1 + TimeInSecs + 60) / 0x3Cu);
  if ( result < 0 )
    return -result;
  return result;
}

//----- (00419F3C) --------------------------------------------------------
bool8 __fastcall CStats::CheckForThreshold(float *stored_value, float new_value)
{
  if ( (float)(*stored_value + 40.0) >= new_value && (float)(*stored_value + -40.0) <= new_value )
    return 0;
  *stored_value = new_value;
  return 1;
}

//----- (00419F7C) --------------------------------------------------------
void __fastcall CStats::DisplayScriptStatUpdateMessage(bool8 IncOrDec, UInt32 StatIndex, float fValue)
{
  __int16 v5; // r6
  float v6; // s0
  float v7; // r3
  unsigned int v8; // r8
  int m_nScriptLimitToGangSize; // r0

  v5 = StatIndex;
  if ( CStats::bShowUpdateStats )
  {
    switch ( (__int16)StatIndex )
    {
      case 21:
      case 22:
      case 23:
      case 24:
      case 25:
      case 65:
      case 66:
      case 67:
      case 69:
      case 70:
      case 71:
      case 72:
      case 73:
      case 74:
      case 75:
      case 76:
      case 77:
      case 78:
      case 79:
      case 80:
      case 160:
      case 164:
      case 165:
      case 223:
      case 225:
      case 229:
      case 230:
      case 233:
      case 241:
      case 242:
      case 243:
      case 244:
        if ( (unsigned __int16)StatIndex > 0x51u )
          v6 = (float)CStats::StatTypesInt[(unsigned __int16)StatIndex - 120];
        else
          v6 = CStats::StatTypesFloat[(unsigned __int16)StatIndex];
        if ( v6 < 1000.0 )
          goto LABEL_7;
        break;
      default:
LABEL_7:
        if ( (StatIndex - 21) >> 2 <= 0x4E )
        {
          switch ( StatIndex )
          {
            case 0x15u:
            case 0x16u:
            case 0x17u:
            case 0x18u:
            case 0x19u:
            case 0x45u:
            case 0x46u:
            case 0x47u:
            case 0x48u:
            case 0x49u:
            case 0x4Au:
            case 0x4Bu:
            case 0x4Cu:
            case 0x4Du:
            case 0x4Eu:
            case 0x4Fu:
            case 0x51u:
            case 0xA0u:
            case 0xA4u:
            case 0xA5u:
            case 0xDFu:
            case 0xE1u:
            case 0xE5u:
            case 0xE6u:
            case 0xE9u:
              if ( fValue > 1.0 )
                goto LABEL_10;
              return;
            case 0x1Au:
            case 0x1Bu:
            case 0x1Cu:
            case 0x1Du:
            case 0x1Eu:
            case 0x1Fu:
            case 0x20u:
            case 0x21u:
            case 0x22u:
            case 0x23u:
            case 0x24u:
            case 0x25u:
            case 0x26u:
            case 0x27u:
            case 0x28u:
            case 0x29u:
            case 0x2Au:
            case 0x2Bu:
            case 0x2Cu:
            case 0x2Du:
            case 0x2Eu:
            case 0x2Fu:
            case 0x30u:
            case 0x31u:
            case 0x32u:
            case 0x33u:
            case 0x34u:
            case 0x35u:
            case 0x36u:
            case 0x37u:
            case 0x38u:
            case 0x39u:
            case 0x3Au:
            case 0x3Bu:
            case 0x3Cu:
            case 0x3Du:
            case 0x3Eu:
            case 0x3Fu:
            case 0x41u:
            case 0x42u:
            case 0x43u:
            case 0x44u:
            case 0x50u:
            case 0x52u:
            case 0x53u:
            case 0x54u:
            case 0x55u:
            case 0x56u:
            case 0x57u:
            case 0x58u:
            case 0x59u:
            case 0x5Au:
            case 0x5Bu:
            case 0x5Cu:
            case 0x5Du:
            case 0x5Eu:
            case 0x5Fu:
            case 0x60u:
            case 0x61u:
            case 0x62u:
            case 0x63u:
            case 0x64u:
            case 0x65u:
            case 0x66u:
            case 0x67u:
            case 0x68u:
            case 0x69u:
            case 0x6Au:
            case 0x6Bu:
            case 0x6Cu:
            case 0x6Du:
            case 0x6Eu:
            case 0x6Fu:
            case 0x70u:
            case 0x71u:
            case 0x72u:
            case 0x73u:
            case 0x74u:
            case 0x75u:
            case 0x76u:
            case 0x77u:
            case 0x78u:
            case 0x79u:
            case 0x7Au:
            case 0x7Bu:
            case 0x7Cu:
            case 0x7Du:
            case 0x7Eu:
            case 0x7Fu:
            case 0x80u:
            case 0x81u:
            case 0x82u:
            case 0x83u:
            case 0x84u:
            case 0x85u:
            case 0x86u:
            case 0x87u:
            case 0x88u:
            case 0x89u:
            case 0x8Au:
            case 0x8Bu:
            case 0x8Cu:
            case 0x8Du:
            case 0x8Eu:
            case 0x8Fu:
            case 0x90u:
            case 0x91u:
            case 0x92u:
            case 0x93u:
            case 0x94u:
            case 0x95u:
            case 0x96u:
            case 0x97u:
            case 0x98u:
            case 0x99u:
            case 0x9Au:
            case 0x9Bu:
            case 0x9Cu:
            case 0x9Du:
            case 0x9Eu:
            case 0x9Fu:
            case 0xA1u:
            case 0xA2u:
            case 0xA3u:
            case 0xA6u:
            case 0xA7u:
            case 0xA8u:
            case 0xA9u:
            case 0xAAu:
            case 0xABu:
            case 0xACu:
            case 0xADu:
            case 0xAEu:
            case 0xAFu:
            case 0xB0u:
            case 0xB1u:
            case 0xB2u:
            case 0xB3u:
            case 0xB4u:
            case 0xB5u:
            case 0xB6u:
            case 0xB7u:
            case 0xB8u:
            case 0xB9u:
            case 0xBAu:
            case 0xBBu:
            case 0xBCu:
            case 0xBDu:
            case 0xBEu:
            case 0xBFu:
            case 0xC0u:
            case 0xC1u:
            case 0xC2u:
            case 0xC3u:
            case 0xC4u:
            case 0xC5u:
            case 0xC6u:
            case 0xC7u:
            case 0xC8u:
            case 0xC9u:
            case 0xCAu:
            case 0xCBu:
            case 0xCCu:
            case 0xCDu:
            case 0xCEu:
            case 0xCFu:
            case 0xD0u:
            case 0xD1u:
            case 0xD3u:
            case 0xD4u:
            case 0xD5u:
            case 0xD6u:
            case 0xD7u:
            case 0xD8u:
            case 0xD9u:
            case 0xDAu:
            case 0xDBu:
            case 0xDCu:
            case 0xDDu:
            case 0xDEu:
            case 0xE0u:
            case 0xE2u:
            case 0xE3u:
            case 0xE4u:
            case 0xE7u:
            case 0xE8u:
            case 0xEAu:
            case 0xEBu:
            case 0xECu:
            case 0xEDu:
            case 0xEEu:
            case 0xEFu:
            case 0xF0u:
            case 0xF1u:
            case 0xF2u:
            case 0xF3u:
            case 0xF4u:
            case 0xF5u:
            case 0xF6u:
            case 0xF7u:
            case 0xF8u:
            case 0xF9u:
            case 0xFAu:
            case 0xFBu:
            case 0x102u:
            case 0x103u:
            case 0x104u:
            case 0x105u:
            case 0x106u:
            case 0x107u:
            case 0x108u:
            case 0x109u:
            case 0x10Au:
            case 0x10Bu:
            case 0x10Cu:
            case 0x10Du:
            case 0x10Eu:
            case 0x10Fu:
            case 0x110u:
            case 0x111u:
            case 0x112u:
            case 0x113u:
            case 0x114u:
            case 0x115u:
            case 0x116u:
            case 0x117u:
            case 0x118u:
            case 0x119u:
            case 0x11Au:
            case 0x11Bu:
            case 0x11Cu:
            case 0x11Du:
            case 0x11Eu:
            case 0x11Fu:
            case 0x120u:
            case 0x121u:
            case 0x122u:
            case 0x123u:
            case 0x124u:
            case 0x125u:
            case 0x126u:
            case 0x127u:
            case 0x128u:
            case 0x129u:
            case 0x12Au:
            case 0x12Bu:
            case 0x12Cu:
            case 0x12Du:
            case 0x12Eu:
            case 0x12Fu:
            case 0x130u:
            case 0x131u:
            case 0x132u:
            case 0x133u:
            case 0x134u:
            case 0x135u:
            case 0x136u:
            case 0x137u:
            case 0x138u:
            case 0x139u:
            case 0x13Au:
            case 0x13Bu:
            case 0x13Cu:
            case 0x13Du:
            case 0x13Eu:
            case 0x13Fu:
            case 0x140u:
            case 0x141u:
            case 0x142u:
            case 0x143u:
            case 0x144u:
            case 0x145u:
            case 0x146u:
            case 0x147u:
            case 0x148u:
            case 0x149u:
            case 0x14Au:
            case 0x14Bu:
            case 0x14Cu:
            case 0x14Du:
            case 0x14Eu:
            case 0x14Fu:
              return;
            case 0x40u:
LABEL_10:
              v7 = 1000.0;
              goto LABEL_12;
            case 0xD2u:
              v7 = 10.0;
              goto LABEL_12;
            case 0xFCu:
            case 0xFDu:
            case 0xFEu:
            case 0xFFu:
            case 0x100u:
            case 0x101u:
              v7 = 100.0;
              goto LABEL_12;
            case 0x150u:
              if ( !FindPlayerPed(-1) )
                return;
              if ( CStats::StatTypesFloat[64] >= 10.0 )
              {
                if ( CStats::StatTypesFloat[64] >= 60.0 )
                {
                  if ( CStats::StatTypesFloat[64] >= 160.0 )
                  {
                    if ( CStats::StatTypesFloat[64] >= 330.0 )
                    {
                      if ( CStats::StatTypesFloat[64] >= 540.0 )
                      {
                        v8 = 7;
                        if ( CStats::StatTypesFloat[64] < 800.0 )
                          v8 = 6;
                      }
                      else
                      {
                        v8 = 5;
                      }
                    }
                    else
                    {
                      v8 = 4;
                    }
                  }
                  else
                  {
                    v8 = 3;
                  }
                }
                else
                {
                  v8 = 2;
                }
              }
              else
              {
                v8 = 0;
              }
              if ( v8 >= FindPlayerPed(-1)->m_pPlayerData->m_nScriptLimitToGangSize )
              {
                m_nScriptLimitToGangSize = FindPlayerPed(-1)->m_pPlayerData->m_nScriptLimitToGangSize;
              }
              else if ( CStats::StatTypesFloat[64] >= 10.0 )
              {
                if ( CStats::StatTypesFloat[64] >= 60.0 )
                {
                  if ( CStats::StatTypesFloat[64] >= 160.0 )
                  {
                    if ( CStats::StatTypesFloat[64] >= 330.0 )
                    {
                      if ( CStats::StatTypesFloat[64] >= 540.0 )
                      {
                        m_nScriptLimitToGangSize = 7;
                        if ( CStats::StatTypesFloat[64] < 800.0 )
                          m_nScriptLimitToGangSize = 6;
                      }
                      else
                      {
                        m_nScriptLimitToGangSize = 5;
                      }
                    }
                    else
                    {
                      m_nScriptLimitToGangSize = 4;
                    }
                  }
                  else
                  {
                    m_nScriptLimitToGangSize = 3;
                  }
                }
                else
                {
                  m_nScriptLimitToGangSize = 2;
                }
              }
              else
              {
                m_nScriptLimitToGangSize = 0;
              }
              LOWORD(StatIndex) = v5;
              v7 = (float)m_nScriptLimitToGangSize;
LABEL_12:
              sub_1A0850(IncOrDec, StatIndex, fValue, v7);
              break;
          }
        }
        break;
    }
  }
}

//----- (0041A5E8) --------------------------------------------------------
Int32 CStats::FindMaxNumberOfGroupMembers()
{
  Int32 result; // r0

  if ( CStats::StatTypesFloat[64] < 10.0 )
    return 0;
  if ( CStats::StatTypesFloat[64] < 60.0 )
    return 2;
  if ( CStats::StatTypesFloat[64] < 160.0 )
    return 3;
  if ( CStats::StatTypesFloat[64] < 330.0 )
    return 4;
  if ( CStats::StatTypesFloat[64] < 540.0 )
    return 5;
  result = 7;
  if ( CStats::StatTypesFloat[64] < 800.0 )
    return 6;
  return result;
}

//----- (0041A678) --------------------------------------------------------
void __fastcall CStats::UpdateRespectStat(bool8 reset)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d3
  float32x2_t v4; // d6
  float32x2_t v5; // d9
  float v6; // s16
  float v7; // s2
  float v8; // s20
  float v9; // s26
  float32x2_t v10; // d0
  float v11; // s28
  unsigned __int32 v12; // s0
  char v13; // r0
  char v14; // r4
  float v15; // s0
  int v16; // r0

  if ( reset )
  {
    CStats::UpdateRespectStat(unsigned char)::oldRespect_Total = -99.0;
    CStats::UpdateRespectStat(unsigned char)::old_diff_value = -99.0;
    CStats::usingRespectCheat = 0;
    return;
  }
  v6 = 1000.0;
  v1.n64_u32[0] = 1.0;
  v2.n64_f32[0] = (float)CStats::StatTypesInt[108];
  v3.n64_f32[0] = CGangWars::TerritoryUnderControlPercentage + -0.2;
  v5.n64_u32[0] = 0;
  v7 = vmax_f32(v2, v1).n64_f32[0];
  v8 = CStats::StatTypesFloat[66];
  v9 = CStats::StatTypesFloat[23] * 0.03;
  v4.n64_f32[0] = (float)CWorld::Players[CWorld::PlayerInFocus].Score / 10000000.0;
  v10.n64_u64[0] = vmin_f32(v4, v1).n64_u64[0];
  v11 = (float)((float)((float)(CStats::StatTypesFloat[65] * 0.03)
                      + (float)((float)((float)(CStats::StatTypesFloat[68] * 0.4) + 0.0)
                              + (float)((float)((float)((float)CStats::StatTypesInt[104] * 1000.0) / v7) * 0.36)))
              + (float)((float)((float)(vmax_f32(v3, v5).n64_f32[0] * 1000.0) / 0.8) * 0.05))
      + (float)((float)(v10.n64_f32[0] * 1000.0) * 0.05);
  v10.n64_f32[0] = (float)((float)(10 * CTagManager::GetPercentageTagged()) * 0.05)
                 + (float)((float)(v8 * 0.03) + (float)(v9 + v11));
  v12 = vmax_f32(v10, v5).n64_u32[0];
  if ( CLoadingScreen::m_bActive )
    goto LABEL_4;
  if ( CCheat::m_aCheatsActive[87] )
  {
    v13 = 1;
  }
  else
  {
    if ( !CStats::usingRespectCheat )
    {
LABEL_4:
      v6 = *(float *)&v12;
      goto LABEL_10;
    }
    v6 = *(float *)&v12;
    v13 = 0;
  }
  CStats::usingRespectCheat = v13;
LABEL_10:
  if ( SLODWORD(CStats::UpdateRespectStat(unsigned char)::oldRespect_Total) == SLODWORD(v6) )
    return;
  v14 = 0;
  CStats::StatTypesFloat[64] = v6;
  CStats::CheckForStatsMessage(0);
  v15 = CStats::UpdateRespectStat(unsigned char)::oldRespect_Total;
  if ( CStats::UpdateRespectStat(unsigned char)::old_diff_value != -99.0 )
    v14 = 1;
  v16 = (CStats::UpdateRespectStat(unsigned char)::oldRespect_Total != -99.0) & (unsigned __int8)v14;
  if ( v6 <= CStats::UpdateRespectStat(unsigned char)::old_diff_value
    && CStats::UpdateRespectStat(unsigned char)::oldRespect_Total >= 2.0 )
  {
    if ( v16 != 1 )
      goto LABEL_28;
    if ( (float)(CStats::UpdateRespectStat(unsigned char)::old_diff_value + 40.0) < v6
      || (float)(CStats::UpdateRespectStat(unsigned char)::old_diff_value + -40.0) > v6 )
    {
      CStats::UpdateRespectStat(unsigned char)::old_diff_value = v6;
    }
    else if ( v6 >= 2.0 )
    {
      goto LABEL_28;
    }
    if ( CStats::bShowUpdateStats )
    {
      CHud::SetHelpMessageStatUpdate(0, 0x40u, v6, 1000.0);
      v15 = CStats::UpdateRespectStat(unsigned char)::oldRespect_Total;
    }
LABEL_28:
    if ( v6 > v15 )
      goto LABEL_34;
    goto LABEL_35;
  }
  if ( v16 == 1 )
  {
    if ( (float)(CStats::UpdateRespectStat(unsigned char)::old_diff_value + 40.0) < v6
      || (float)(CStats::UpdateRespectStat(unsigned char)::old_diff_value + -40.0) > v6 )
    {
      CStats::UpdateRespectStat(unsigned char)::old_diff_value = v6;
    }
    else if ( CStats::UpdateRespectStat(unsigned char)::oldRespect_Total >= 2.0 )
    {
      goto LABEL_33;
    }
    if ( CStats::bShowUpdateStats )
    {
      CHud::SetHelpMessageStatUpdate(1u, 0x40u, v6, 1000.0);
      v15 = CStats::UpdateRespectStat(unsigned char)::oldRespect_Total;
    }
  }
LABEL_33:
  if ( v6 < v15 )
LABEL_34:
    CStats::UpdateRespectStat(unsigned char)::old_diff_value = v6;
LABEL_35:
  CStats::UpdateRespectStat(unsigned char)::oldRespect_Total = v6;
}
// 41A6F8: variable 'v2' is possibly undefined
// 41A6F8: variable 'v1' is possibly undefined
// 41A750: variable 'v4' is possibly undefined
// 41A708: variable 'v3' is possibly undefined
// 41A708: variable 'v5' is possibly undefined

//----- (0041A9F4) --------------------------------------------------------
void CStats::UpdateSexAppealStat()
{
  float32x2_t v0; // d1
  float32x2_t v1; // d2
  float32x2_t v2; // d8
  float v3; // s20
  float v4; // s20
  float32x2_t v5; // d0
  CVehicle *v6; // r4
  CMatrix *m_pMat; // r5
  float32x2_t *p_tx; // r0
  float32x2_t v9; // d16
  unsigned __int64 v10; // d0
  bool v11; // fnf
  unsigned int v12; // r0
  float v13; // s2
  unsigned __int32 v14; // s2
  char v15; // r0
  CVector v16[4]; // [sp+0h] [bp-30h] BYREF

  v2.n64_u32[0] = 0;
  v3 = CStats::StatTypesFloat[80] * 0.5;
  if ( FindPlayerVehicle(-1, 0) )
  {
    CStats::UpdateSexAppealStat(void)::pLastVehicle = FindPlayerVehicle(-1, 0);
    CEntity::RegisterReference(
      CStats::UpdateSexAppealStat(void)::pLastVehicle,
      &CStats::UpdateSexAppealStat(void)::pLastVehicle);
  }
  v4 = v3 + 0.0;
  v5.n64_u64[0] = v2.n64_u64[0];
  v6 = CStats::UpdateSexAppealStat(void)::pLastVehicle;
  if ( CStats::UpdateSexAppealStat(void)::pLastVehicle )
  {
    m_pMat = CStats::UpdateSexAppealStat(void)::pLastVehicle->m_pMat;
    FindPlayerCoors(v16, -1);
    p_tx = (float32x2_t *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (float32x2_t *)&v6->m_transform;
    v9.n64_u64[0] = vsub_f32((float32x2_t)p_tx->n64_u64[0], *(float32x2_t *)&v16[0].x).n64_u64[0];
    v10 = vmul_f32(v9, v9).n64_u64[0];
    v11 = sqrtf(*(float *)&v10 + *((float *)&v10 + 1)) < 35.0;
    v5.n64_u64[0] = v2.n64_u64[0];
    if ( v11 )
    {
      v1.n64_u32[0] = 1148846080;
      v12 = SBYTE1(CModelInfo::ms_modelInfoPtrs[CStats::UpdateSexAppealStat(void)::pLastVehicle->m_nModelIndex][1].m_pColModel);
      v5.n64_f32[0] = (float)(CStats::UpdateSexAppealStat(void)::pLastVehicle->m_nHealth
                            + CStats::UpdateSexAppealStat(void)::pLastVehicle->m_nHealth)
                    + -1000.0;
      v0.n64_u32[0] = 0;
      v5.n64_u64[0] = vmax_f32(vmin_f32(v5, v1), v0).n64_u64[0];
      if ( v12 <= 0xB )
      {
        if ( ((1 << v12) & 0x8A2) != 0 )
        {
          v13 = 0.1;
          goto LABEL_14;
        }
        if ( ((1 << v12) & 0x20C) != 0 )
          goto LABEL_15;
        if ( ((1 << v12) & 0x450) != 0 )
        {
          v13 = 0.3;
LABEL_14:
          v5.n64_f32[0] = v5.n64_f32[0] * v13;
          goto LABEL_15;
        }
      }
      v5.n64_f32[0] = v5.n64_f32[0] * 0.5;
    }
  }
LABEL_15:
  v0.n64_f32[0] = v5.n64_f32[0] * 0.5;
  v5.n64_u32[0] = 1148846080;
  v0.n64_f32[0] = v4 + v0.n64_f32[0];
  v14 = vmin_f32(vmax_f32(v0, v2), v5).n64_u32[0];
  if ( !CLoadingScreen::m_bActive )
  {
    if ( CCheat::m_aCheatsActive[88] )
    {
      v15 = 1;
    }
    else
    {
      if ( !CStats::usingSexCheat )
        goto LABEL_16;
      v5.n64_u32[0] = v14;
      v15 = 0;
    }
    CStats::usingSexCheat = v15;
    goto LABEL_22;
  }
LABEL_16:
  v5.n64_u32[0] = v14;
LABEL_22:
  CStats::StatTypesFloat[25] = v5.n64_f32[0];
  CStats::CheckForStatsMessage(0);
}
// 41AA3A: variable 'v2' is possibly undefined
// 41AABC: variable 'v1' is possibly undefined
// 41AAC0: variable 'v0' is possibly undefined

//----- (0041ABA0) --------------------------------------------------------
void __fastcall CStats::UpdateFatAndMuscleStats(uint32 nExerciseRate)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d2
  float32x2_t v3; // d8
  uint8 v4; // r2
  bool v5; // zf
  float v6; // r2
  bool8 v7; // r0
  UInt16 v8; // r1
  float v9; // s0
  UInt32 v10; // r0

  v3.n64_u32[0] = 1148846080;
  if ( (float)(CStats::StatReactionValue[42] * 1000.0) >= (float)CStats::m_FatCounter )
  {
    CStats::m_FatCounter += nExerciseRate * (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) / 0xA;
    goto LABEL_28;
  }
  CStats::m_FatCounter = 0;
  if ( CStats::StatTypesFloat[21] <= 0.0 )
  {
    v1.n64_f32[0] = CStats::StatReactionValue[24];
    if ( CStats::StatReactionValue[24] > 0.0 )
    {
      v2.n64_u32[0] = 0;
      v1.n64_f32[0] = CStats::StatTypesFloat[23] - CStats::StatReactionValue[24];
      v1.n64_u64[0] = vmax_f32(v1, v2).n64_u64[0];
      CStats::StatTypesFloat[23] = v1.n64_f32[0];
      CStats::CheckForStatsMessage(0);
      v1.n64_f32[0] = CStats::StatReactionValue[24];
    }
    CStats::UpdateFatAndMuscleStats(unsigned int)::dispMessage = 3;
    if ( v1.n64_f32[0] <= 1.0 || !CStats::bShowUpdateStats || CStats::StatTypesFloat[23] >= 1000.0 )
      goto LABEL_28;
    v6 = v1.n64_f32[0];
    v7 = 0;
LABEL_22:
    v8 = 23;
LABEL_27:
    CHud::SetHelpMessageStatUpdate(v7, v8, v6, 1000.0);
    goto LABEL_28;
  }
  if ( CStats::StatReactionValue[23] > 0.0 )
  {
    v1.n64_f32[0] = CStats::StatTypesFloat[21] - CStats::StatReactionValue[23];
    v2.n64_u32[0] = 0;
    v1.n64_u64[0] = vmax_f32(v1, v2).n64_u64[0];
    CStats::StatTypesFloat[21] = v1.n64_f32[0];
    CStats::CheckForStatsMessage(0);
  }
  if ( CStats::StatReactionValue[9] > 0.0 )
  {
    v1.n64_f32[0] = CStats::StatReactionValue[9] + CStats::StatTypesFloat[23];
    v1.n64_u64[0] = vmin_f32(v1, v3).n64_u64[0];
    CStats::StatTypesFloat[23] = v1.n64_f32[0];
    CStats::CheckForStatsMessage(0);
  }
  v4 = 1;
  v5 = CStats::UpdateFatAndMuscleStats(unsigned int)::dispMessage == 1;
  if ( CStats::UpdateFatAndMuscleStats(unsigned int)::dispMessage == 1 )
    v4 = 2;
  CStats::UpdateFatAndMuscleStats(unsigned int)::dispMessage = v4;
  if ( v5 )
  {
    if ( CStats::StatReactionValue[9] <= 1.0 || !CStats::bShowUpdateStats || CStats::StatTypesFloat[23] >= 1000.0 )
      goto LABEL_28;
    v6 = CStats::StatReactionValue[9];
    v7 = 1;
    goto LABEL_22;
  }
  if ( CStats::StatReactionValue[23] > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[21] < 1000.0 )
  {
    v6 = CStats::StatReactionValue[23];
    v7 = 0;
    v8 = 21;
    goto LABEL_27;
  }
LABEL_28:
  if ( (float)(CStats::StatReactionValue[45] * 1000.0) >= (float)CStats::m_MaxHealthCounter )
  {
    v10 = CStats::m_MaxHealthCounter + (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  }
  else
  {
    v9 = CStats::StatReactionValue[11];
    if ( CStats::StatReactionValue[11] > 0.0 )
    {
      v1.n64_f32[0] = CStats::StatReactionValue[11] + CStats::StatTypesFloat[24];
      LODWORD(CStats::StatTypesFloat[24]) = vmin_f32(v1, v3).n64_u32[0];
      CStats::CheckForStatsMessage(0);
      v9 = CStats::StatReactionValue[11];
    }
    v10 = 0;
    if ( v9 > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[24] < 1000.0 )
    {
      CHud::SetHelpMessageStatUpdate(1u, 0x18u, v9, 1000.0);
      v10 = 0;
    }
  }
  CStats::m_MaxHealthCounter = v10;
}
// 41AC14: variable 'v1' is possibly undefined
// 41AC14: variable 'v2' is possibly undefined
// 41AC44: variable 'v3' is possibly undefined

//----- (0041AF18) --------------------------------------------------------
void CStats::UpdateStatsWhenSprinting()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d2
  float32x2_t v2; // d8
  float v3; // s0
  float32x2_t v4; // d0

  CStats::UpdateFatAndMuscleStats((unsigned int)CStats::StatReactionValue[30]);
  v2.n64_u32[0] = 1148846080;
  if ( (float)(CStats::StatReactionValue[35] * 1000.0) >= (float)CStats::m_SprintStaminaCounter )
  {
    CStats::m_SprintStaminaCounter += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  }
  else
  {
    v3 = CStats::StatReactionValue[2];
    CStats::m_SprintStaminaCounter = 0;
    if ( CStats::StatReactionValue[2] > 0.0 )
    {
      v0.n64_f32[0] = CStats::StatReactionValue[2] + CStats::StatTypesFloat[22];
      v4.n64_u64[0] = vmin_f32(v0, v2).n64_u64[0];
      CStats::StatTypesFloat[22] = v4.n64_f32[0];
      if ( CStats::StatTypesInt[45] <= -1 )
      {
        v1.n64_u32[0] = 0;
        v4.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
        LODWORD(CStats::StatTypesFloat[21]) = vmax_f32(v4, v1).n64_u32[0];
        CStats::CheckForStatsMessage(0);
      }
      CStats::CheckForStatsMessage(0);
      v3 = CStats::StatReactionValue[2];
    }
    if ( v3 > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[22] < 1000.0 )
      sub_1A0850(1u, 0x16u, v3, 1000.0);
  }
}
// 41AF96: variable 'v0' is possibly undefined
// 41AF96: variable 'v2' is possibly undefined
// 41AFB6: variable 'v1' is possibly undefined

//----- (0041B084) --------------------------------------------------------
void CStats::UpdateStatsWhenRunning()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d2
  float32x2_t v2; // d8
  float v3; // s0
  float32x2_t v4; // d0

  CStats::UpdateFatAndMuscleStats((unsigned int)CStats::StatReactionValue[31]);
  v2.n64_u32[0] = 1148846080;
  if ( (float)(CStats::StatReactionValue[36] * 1000.0) >= (float)CStats::m_RunningCounter )
  {
    CStats::m_RunningCounter += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  }
  else
  {
    v3 = CStats::StatReactionValue[3];
    CStats::m_RunningCounter = 0;
    if ( CStats::StatReactionValue[3] > 0.0 )
    {
      v0.n64_f32[0] = CStats::StatReactionValue[3] + CStats::StatTypesFloat[22];
      v4.n64_u64[0] = vmin_f32(v0, v2).n64_u64[0];
      CStats::StatTypesFloat[22] = v4.n64_f32[0];
      if ( CStats::StatTypesInt[45] <= -1 )
      {
        v1.n64_u32[0] = 0;
        v4.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
        LODWORD(CStats::StatTypesFloat[21]) = vmax_f32(v4, v1).n64_u32[0];
        CStats::CheckForStatsMessage(0);
      }
      CStats::CheckForStatsMessage(0);
      v3 = CStats::StatReactionValue[3];
    }
    if ( v3 > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[22] < 1000.0 )
      sub_1A0850(1u, 0x16u, v3, 1000.0);
  }
}
// 41B102: variable 'v0' is possibly undefined
// 41B102: variable 'v2' is possibly undefined
// 41B122: variable 'v1' is possibly undefined

//----- (0041B1F0) --------------------------------------------------------
void __fastcall CStats::UpdateStatsWhenCycling(bool bSprinting, CBmx *pBmx)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d8
  _BOOL4 v7; // r4
  float *v8; // r0
  float v9; // s0
  UInt32 v10; // r6
  float v11; // s2
  float x; // s2
  float y; // s6
  float z; // s4
  float v15; // s2

  v7 = bSprinting;
  if ( pBmx->m_fGasPedal != 0.0 || bSprinting )
  {
    v8 = &CStats::StatReactionValue[26];
    if ( v7 )
      v8 = &CStats::StatReactionValue[27];
    CStats::UpdateFatAndMuscleStats((unsigned int)*v8);
    v5.n64_u32[0] = 1148846080;
    if ( (float)(CStats::StatReactionValue[33] * 1000.0) >= (float)CStats::m_CycleStaminaCounter )
    {
      CStats::m_CycleStaminaCounter += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    }
    else
    {
      v9 = CStats::StatReactionValue[0];
      CStats::m_CycleStaminaCounter = 0;
      if ( CStats::StatReactionValue[0] > 0.0 )
      {
        v2.n64_f32[0] = CStats::StatReactionValue[0] + CStats::StatTypesFloat[22];
        v2.n64_u64[0] = vmin_f32(v2, v5).n64_u64[0];
        CStats::StatTypesFloat[22] = v2.n64_f32[0];
        if ( CStats::StatTypesInt[45] <= -1 )
        {
          v4.n64_u32[0] = 0;
          v2.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
          v2.n64_u64[0] = vmax_f32(v2, v4).n64_u64[0];
          CStats::StatTypesFloat[21] = v2.n64_f32[0];
          CStats::CheckForStatsMessage(0);
        }
        CStats::CheckForStatsMessage(0);
        v9 = CStats::StatReactionValue[0];
      }
      if ( v9 > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[22] < 1000.0 )
        CHud::SetHelpMessageStatUpdate(1u, 0x16u, v9, 1000.0);
    }
  }
  v2.n64_u32[0] = 1148846080;
  v10 = CStats::m_CycleSkillCounter;
  if ( (float)(CStats::StatReactionValue[39] * 1000.0) >= (float)CStats::m_CycleSkillCounter )
  {
    x = pBmx->m_vecMoveSpeed.x;
    if ( pBmx->nNoOfContactWheels >= 2u )
    {
      y = pBmx->m_vecMoveSpeed.y;
      z = pBmx->m_vecMoveSpeed.z;
    }
    else
    {
      y = pBmx->m_vecMoveSpeed.y;
      z = pBmx->m_vecMoveSpeed.z;
      if ( (float)((float)((float)(x * x) + (float)(y * y)) + (float)(z * z)) > 0.0025 )
      {
        v15 = 3.0;
LABEL_29:
        CStats::m_CycleSkillCounter = (unsigned int)ceilf(
                                                      v15
                                                    * (float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0)
                                                                                 * 1000.0))
                                    + v10;
        return;
      }
    }
    if ( (float)((float)((float)(x * x) + (float)(y * y)) + (float)(z * z)) <= 0.04 )
      return;
    v15 = 1.0;
    if ( v7 )
      v15 = 1.5;
    goto LABEL_29;
  }
  v11 = CStats::StatReactionValue[6];
  CStats::m_CycleSkillCounter = 0;
  if ( CStats::StatReactionValue[6] > 0.0 )
  {
    v3.n64_f32[0] = (float)(CStats::StatTypesInt[110] + (int)CStats::StatReactionValue[6]);
    CStats::StatTypesInt[110] = (int)vmin_f32(v3, v2).n64_f32[0];
    CStats::CheckForStatsMessage(0);
    v11 = CStats::StatReactionValue[6];
  }
  if ( CStats::bShowUpdateStats && v11 > 1.0 && CStats::StatTypesInt[110] < 1000 )
    sub_1A0850(1u, 0xE6u, v11, 1000.0);
}
// 41B29A: variable 'v2' is possibly undefined
// 41B29A: variable 'v5' is possibly undefined
// 41B2BA: variable 'v4' is possibly undefined
// 41B3A6: variable 'v3' is possibly undefined
// 679678: using guessed type char *CStats::bShowUpdateStats;

//----- (0041B538) --------------------------------------------------------
void __fastcall CStats::UpdateStatsWhenSwimming(bool bUnderWater, bool bSprinting)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d2
  float32x2_t v4; // d8
  _BOOL4 v5; // r4
  bool v6; // zf
  float *v7; // r1
  float v8; // s0
  float v9; // s0
  float32x2_t v10; // d0

  v5 = bUnderWater;
  v6 = !bSprinting;
  v7 = &CStats::StatReactionValue[29];
  if ( v6 )
    v7 = &CStats::StatReactionValue[28];
  if ( bUnderWater )
    v7 = &CStats::StatReactionValue[29];
  CStats::UpdateFatAndMuscleStats((unsigned int)*v7);
  v4.n64_u32[0] = 1148846080;
  if ( (float)(CStats::StatReactionValue[34] * 1000.0) >= (float)CStats::m_SwimStaminaCounter )
  {
    CStats::m_SwimStaminaCounter += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    if ( !v5 )
      return;
    goto LABEL_17;
  }
  v8 = CStats::StatReactionValue[1];
  CStats::m_SwimStaminaCounter = 0;
  if ( CStats::StatReactionValue[1] > 0.0 )
  {
    v2.n64_f32[0] = CStats::StatReactionValue[1] + CStats::StatTypesFloat[22];
    v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
    CStats::StatTypesFloat[22] = v2.n64_f32[0];
    if ( CStats::StatTypesInt[45] <= -1 )
    {
      v3.n64_u32[0] = 0;
      v2.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
      v2.n64_u64[0] = vmax_f32(v2, v3).n64_u64[0];
      CStats::StatTypesFloat[21] = v2.n64_f32[0];
      CStats::CheckForStatsMessage(0);
    }
    CStats::CheckForStatsMessage(0);
    v8 = CStats::StatReactionValue[1];
  }
  if ( v8 > 1.0 && CStats::bShowUpdateStats && CStats::StatTypesFloat[22] < 1000.0 )
    CHud::SetHelpMessageStatUpdate(1u, 0x16u, v8, 1000.0);
  if ( v5 )
  {
LABEL_17:
    if ( (float)(CStats::StatReactionValue[44] * 1000.0) >= (float)CStats::m_SwimUnderWaterCounter )
    {
      CStats::m_SwimUnderWaterCounter += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    }
    else
    {
      v9 = CStats::StatReactionValue[10];
      CStats::m_SwimUnderWaterCounter = 0;
      if ( CStats::StatReactionValue[10] > 0.0 )
      {
        v2.n64_f32[0] = (float)(CStats::StatTypesInt[105] + (int)CStats::StatReactionValue[10]);
        v10.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
        CStats::StatTypesInt[105] = (int)v10.n64_f32[0];
        if ( CStats::StatTypesInt[45] <= -1 )
        {
          v3.n64_u32[0] = 0;
          v10.n64_f32[0] = CStats::StatTypesFloat[21] + -23.0;
          LODWORD(CStats::StatTypesFloat[21]) = vmax_f32(v10, v3).n64_u32[0];
          CStats::CheckForStatsMessage(0);
        }
        CStats::CheckForStatsMessage(0);
        v9 = CStats::StatReactionValue[10];
      }
      if ( CStats::bShowUpdateStats && v9 > 1.0 && CStats::StatTypesInt[105] < 1000 )
        sub_1A0850(1u, 0xE1u, v9, 1000.0);
    }
  }
}
// 41B5CC: variable 'v2' is possibly undefined
// 41B5CC: variable 'v4' is possibly undefined
// 41B5EC: variable 'v3' is possibly undefined
// 679678: using guessed type char *CStats::bShowUpdateStats;

//----- (0041B800) --------------------------------------------------------
void __fastcall CStats::UpdateStatsWhenDriving(CVehicle *pVehicle)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float v3; // s2
  CVehicle *v4; // r1
  float v5; // s2
  float v6; // s6
  float v7; // s4

  v1.n64_u32[0] = 1148846080;
  v3 = (float)CStats::m_DrivingCounter;
  v4 = 0;
  if ( !pVehicle->m_baseVehicleType )
    v4 = pVehicle;
  if ( (float)(CStats::StatReactionValue[37] * 1000.0) >= v3 )
  {
    v6 = sqrtf(
           (float)((float)(pVehicle->m_vecMoveSpeed.x * pVehicle->m_vecMoveSpeed.x)
                 + (float)(pVehicle->m_vecMoveSpeed.y * pVehicle->m_vecMoveSpeed.y))
         + (float)(pVehicle->m_vecMoveSpeed.z * pVehicle->m_vecMoveSpeed.z));
    v7 = 1.5;
    if ( v6 <= 0.8 && (!v4 || LOBYTE(v4[1].AutoPilot.TempActionFinish)) )
    {
      if ( v6 <= 0.2 )
        return;
      v7 = 0.5;
    }
    CStats::m_DrivingCounter = (unsigned int)(float)((float)(v7
                                                           * (float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep
                                                                                                / 50.0)
                                                                                        * 1000.0))
                                                   + v3);
  }
  else
  {
    v5 = CStats::StatReactionValue[4];
    CStats::m_DrivingCounter = 0;
    if ( CStats::StatReactionValue[4] > 0.0 )
    {
      v2.n64_f32[0] = (float)(CStats::StatTypesInt[40] + (int)CStats::StatReactionValue[4]);
      CStats::StatTypesInt[40] = (int)vmin_f32(v2, v1).n64_f32[0];
      CStats::CheckForStatsMessage(0);
      v5 = CStats::StatReactionValue[4];
    }
    if ( CStats::bShowUpdateStats && v5 > 1.0 && CStats::StatTypesInt[40] < 1000 )
      sub_1A0850(1u, 0xA0u, v5, 1000.0);
  }
}
// 41B876: variable 'v2' is possibly undefined
// 41B876: variable 'v1' is possibly undefined

//----- (0041B994) --------------------------------------------------------
void __fastcall CStats::UpdateStatsWhenFlying(CVehicle *pVehicle)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float v3; // s2
  float v4; // s6
  float v5; // s4

  if ( !pVehicle->m_baseVehicleType )
  {
    v1.n64_u32[0] = 1148846080;
    if ( (float)(CStats::StatReactionValue[38] * 1000.0) >= (float)CStats::m_FlyingCounter )
    {
      if ( !LOBYTE(pVehicle[1].AutoPilot.TempActionFinish) )
      {
        v4 = sqrtf(
               (float)((float)(pVehicle->m_vecMoveSpeed.x * pVehicle->m_vecMoveSpeed.x)
                     + (float)(pVehicle->m_vecMoveSpeed.y * pVehicle->m_vecMoveSpeed.y))
             + (float)(pVehicle->m_vecMoveSpeed.z * pVehicle->m_vecMoveSpeed.z));
        v5 = 1.5;
        if ( v4 > 1.3 || pVehicle->m_pMat->zz < 0.0 || (v5 = 0.5, v4 > 0.5) )
          CStats::m_FlyingCounter = (unsigned int)(float)((float)(v5
                                                                * (float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0)
                                                                                             * 1000.0))
                                                        + (float)CStats::m_FlyingCounter);
      }
    }
    else
    {
      v3 = CStats::StatReactionValue[5];
      CStats::m_FlyingCounter = 0;
      if ( CStats::StatReactionValue[5] > 0.0 )
      {
        v2.n64_f32[0] = (float)(CStats::StatTypesInt[103] + (int)CStats::StatReactionValue[5]);
        CStats::StatTypesInt[103] = (int)vmin_f32(v2, v1).n64_f32[0];
        CStats::CheckForStatsMessage(0);
        v3 = CStats::StatReactionValue[5];
      }
      if ( CStats::bShowUpdateStats && v3 > 1.0 && CStats::StatTypesInt[103] < 1000 )
        sub_1A0850(1u, 0xDFu, v3, 1000.0);
    }
  }
}
// 41BA04: variable 'v2' is possibly undefined
// 41BA04: variable 'v1' is possibly undefined

//----- (0041BB28) --------------------------------------------------------
void __fastcall CStats::UpdateStatsWhenOnMotorBike(CBike *pBike)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float v3; // s2
  float v4; // s6
  float v5; // s4

  v1.n64_u32[0] = 1148846080;
  if ( (float)(CStats::StatReactionValue[40] * 1000.0) >= (float)CStats::m_BikeCounter )
  {
    v4 = sqrtf(
           (float)((float)(pBike->m_vecMoveSpeed.x * pBike->m_vecMoveSpeed.x)
                 + (float)(pBike->m_vecMoveSpeed.y * pBike->m_vecMoveSpeed.y))
         + (float)(pBike->m_vecMoveSpeed.z * pBike->m_vecMoveSpeed.z));
    v5 = 1.5;
    if ( v4 <= 0.6 && (v4 <= 0.1 || pBike->nNoOfContactWheels >= 3u) )
    {
      if ( v4 <= 0.2 )
        return;
      v5 = 0.5;
    }
    CStats::m_BikeCounter = (unsigned int)(float)((float)(v5
                                                        * (float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep
                                                                                             / 50.0)
                                                                                     * 1000.0))
                                                + (float)CStats::m_BikeCounter);
  }
  else
  {
    v3 = CStats::StatReactionValue[7];
    CStats::m_BikeCounter = 0;
    if ( CStats::StatReactionValue[7] > 0.0 )
    {
      v2.n64_f32[0] = (float)(CStats::StatTypesInt[109] + (int)CStats::StatReactionValue[7]);
      CStats::StatTypesInt[109] = (int)vmin_f32(v2, v1).n64_f32[0];
      CStats::CheckForStatsMessage(0);
      v3 = CStats::StatReactionValue[7];
    }
    if ( CStats::bShowUpdateStats && v3 > 1.0 && CStats::StatTypesInt[109] < 1000 )
      sub_1A0850(1u, 0xE5u, v3, 1000.0);
  }
}
// 41BB90: variable 'v2' is possibly undefined
// 41BB90: variable 'v1' is possibly undefined

//----- (0041BCC0) --------------------------------------------------------
void __fastcall CStats::UpdateStatsWhenWeaponHit(int32 nWeaponType)
{
  int32 SkillStatIndex; // r0
  UInt32 v2; // r4
  UInt16 v3; // r5
  float v4; // s16
  int IsCoopGameGoingOn; // r0
  float *v6; // r6
  float *v7; // r6
  float v8; // t1
  UInt32 v9; // r0

  SkillStatIndex = CWeaponInfo::GetSkillStatIndex((eWeaponType)nWeaponType);
  v2 = SkillStatIndex;
  v3 = SkillStatIndex;
  if ( (unsigned __int16)SkillStatIndex > 0x51u )
    v4 = (float)CStats::StatTypesInt[(unsigned __int16)SkillStatIndex - 120];
  else
    v4 = CStats::StatTypesFloat[(unsigned __int16)SkillStatIndex];
  IsCoopGameGoingOn = CGameLogic::IsCoopGameGoingOn();
  if ( v4 < 1000.0 && !IsCoopGameGoingOn )
  {
    v6 = &CStats::StatReactionValue[v2];
    v8 = *(v6 - 57);
    v7 = v6 - 57;
    CStats::IncrementStat(v3, v8);
    if ( CStats::m_LastWeaponTypeFired == v2 - 69 )
    {
      if ( CStats::StatReactionValue[v2 - 23] >= (float)CStats::m_WeaponCounter )
      {
        v9 = CStats::m_WeaponCounter + 1;
      }
      else
      {
        CStats::DisplayScriptStatUpdateMessage(1u, v2, *v7 * (float)CStats::m_WeaponCounter);
        v9 = 0;
      }
    }
    else
    {
      CStats::m_LastWeaponTypeFired = v2 - 69;
      v9 = 0;
    }
    CStats::m_WeaponCounter = v9;
  }
}

//----- (0041BDC4) --------------------------------------------------------
void CStats::UpdateStatsWhenFighting()
{
  CStats::UpdateFatAndMuscleStats((unsigned int)CStats::StatReactionValue[32]);
}

//----- (0041BDE0) --------------------------------------------------------
void CStats::UpdateStatsOnRespawn()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d2
  float v2; // s0
  float v3; // s2
  UInt32 v4; // r4

  if ( CStats::StatReactionValue[57] >= (float)CStats::m_DeathCounter )
  {
    v4 = CStats::m_DeathCounter + 1;
  }
  else
  {
    v2 = CStats::StatTypesFloat[24];
    if ( CStats::StatTypesFloat[24] <= 400.0 )
    {
      v4 = 0;
    }
    else
    {
      v3 = CStats::StatReactionValue[25];
      if ( CStats::StatReactionValue[25] > 0.0 )
      {
        v0.n64_f32[0] = CStats::StatTypesFloat[24] + CStats::StatReactionValue[25];
        v1.n64_u32[0] = 1148846080;
        LODWORD(CStats::StatTypesFloat[24]) = vmin_f32(v0, v1).n64_u32[0];
        CStats::CheckForStatsMessage(0);
        v2 = CStats::StatTypesFloat[24];
        v3 = CStats::StatReactionValue[25];
      }
      v4 = 0;
      if ( v3 > 1.0 && CStats::bShowUpdateStats && v2 < 1000.0 )
      {
        v4 = 0;
        CHud::SetHelpMessageStatUpdate(0, 0x18u, v3, 1000.0);
      }
    }
  }
  CStats::m_DeathCounter = v4;
}
// 41BE44: variable 'v0' is possibly undefined
// 41BE44: variable 'v1' is possibly undefined

//----- (0041BED4) --------------------------------------------------------
float __fastcall CStats::GetFatAndMuscleModifier(eStatModAbilities nAbility)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  float result; // r0
  float v5; // s0
  float v6; // s0
  float v7; // s2
  float v8; // s0
  float v9; // s2
  float v10; // s4
  float v11; // s0
  float v12; // s2
  float v13; // s2
  float v14; // s4
  float v15; // s0
  float v16; // s2
  float v17; // s2
  float v18; // s0

  switch ( nAbility )
  {
    case STAT_MODIFIER_CLIMB_HEIGHT:
      if ( CStats::StatTypesFloat[21] > 800.0 )
        return 2.0;
      v5 = 0.0;
      if ( CStats::StatTypesFloat[21] > 400.0 )
        return 1.0;
      return v5;
    case STAT_MODIFIER_CLIMB_SPEED:
      v2.n64_f32[0] = (float)(CStats::StatTypesFloat[21] + -200.0) / 800.0;
      v3.n64_u32[0] = 0;
      v6 = (float)((float)((float)(CStats::StatTypesFloat[23] + -50.0) * 0.2) / 950.0)
         + (float)((float)(vmax_f32(v2, v3).n64_f32[0] * -0.4) + 1.0);
      v7 = 0.7;
      goto LABEL_25;
    case STAT_MODIFIER_JUMP_SPEED:
      v2.n64_f32[0] = (float)(CStats::StatTypesFloat[21] + -200.0) / 800.0;
      v8 = (float)((float)(CStats::StatTypesFloat[23] + -50.0) * -0.1) / 950.0;
      v3.n64_u32[0] = 0;
      v9 = (float)(vmax_f32(v2, v3).n64_f32[0] * -0.2) + 1.0;
      goto LABEL_10;
    case STAT_MODIFIER_FIGHT_SPEED:
      v9 = (float)((float)(CStats::StatTypesFloat[23] + -50.0) * -0.1) / 950.0;
      v8 = (float)((float)((float)(CStats::StatTypesFloat[21] + -200.0) * -0.2) / 800.0) + 1.0;
LABEL_10:
      v6 = v8 + v9;
      v7 = 0.8;
      goto LABEL_25;
    case STAT_MODIFIER_FIGHT_DAMAGE:
      v10 = (float)(CStats::StatTypesFloat[23] + -50.0) / 950.0;
      v11 = (float)((float)((float)(CStats::StatTypesFloat[21] + -200.0) * 0.5) / 800.0) + 1.0;
      v12 = 2.0;
      goto LABEL_21;
    case STAT_MODIFIER_BMX_SPRINT_SPEED:
      v6 = 2.0;
      v13 = (float)((float)CStats::StatTypesInt[110] / 1000.0)
          + (float)((float)((float)(CStats::StatTypesFloat[22] / 1000.0) * 0.5)
                  + (float)((float)((float)((float)(CStats::StatTypesFloat[21] + -200.0) / -800.0) + 1.0)
                          + (float)((float)((float)(CStats::StatTypesFloat[23] + -50.0) * 0.5) / 950.0)));
      if ( v13 > 2.0 )
        goto LABEL_32;
      v14 = 0.25;
      goto LABEL_30;
    case STAT_MODIFIER_BMX_BUNNYHOP:
      v6 = 2.0;
      v13 = (float)((float)CStats::StatTypesInt[110] / 1000.0)
          + (float)((float)((float)((float)(CStats::StatTypesFloat[21] + -200.0) * -0.5) / 800.0) + 1.0);
      if ( v13 > 2.0 )
        goto LABEL_32;
      v14 = 0.5;
LABEL_30:
      v6 = v13;
      if ( v13 >= v14 )
        goto LABEL_32;
      result = v14;
      break;
    case STAT_MODIFIER_SPRINT_ENERGY:
      v15 = (float)(CStats::StatTypesFloat[22] / 1000.0) * 3000.0;
      v16 = 150.0;
      return v15 + v16;
    case STAT_MODIFIER_BREATH_UNDERWATER:
      v15 = (float)((float)(CStats::StatTypesFloat[22] + (float)CStats::StatTypesInt[105]) / 2000.0) * 3000.0;
      v16 = 1000.0;
      return v15 + v16;
    case STAT_MODIFIER_MAX_HEALTH:
      return (float)(CStats::StatTypesFloat[24] / 1000.0) * 220.0;
    case STAT_MODIFIER_MAX_HEALTH_LIMIT:
      return 220.0;
    case STAT_MODIFIER_BIKE_WHEELIE_MULT:
      v1.n64_f32[0] = (float)CStats::StatTypesInt[109] / 1000.0;
      v17 = 0.5;
      goto LABEL_19;
    case STAT_MODIFIER_BIKE_BALANCE_FORCE:
      v1.n64_f32[0] = (float)CStats::StatTypesInt[109] / 1000.0;
      v17 = 0.3;
      goto LABEL_19;
    case STAT_MODIFIER_BIKE_BALANCE_DAMPING:
      v1.n64_f32[0] = (float)CStats::StatTypesInt[109] / 1000.0;
      v17 = 0.25;
LABEL_19:
      v3.n64_u32[0] = 1.0;
      result = (float)(vmin_f32(v1, v3).n64_f32[0] * v17) + 1.0;
      break;
    case STAT_MODIFIER_CAR_INAIR_BALANCE:
      v12 = 1.0;
      v11 = (float)((float)(CStats::StatTypesFloat[21] + -200.0) * 0.5) / 800.0;
      v10 = (float)((float)((float)CStats::StatTypesInt[40] / 1000.0) * 0.5) + 1.0;
LABEL_21:
      v18 = v10 + v11;
      if ( v18 > v12 )
        v18 = v12;
      result = v18;
      break;
    case STAT_MODIFIER_TAKE_DAMAGE_MULT:
      v7 = 0.5;
      v6 = (float)((float)((float)((float)(CStats::StatTypesFloat[21] + -200.0) * -0.5) / 800.0) + 1.0)
         + (float)((float)((float)(CStats::StatTypesFloat[23] + -50.0) * -0.25) / 950.0);
LABEL_25:
      if ( v6 >= v7 )
LABEL_32:
        result = v6;
      else
        result = v7;
      break;
    default:
      result = 1.0;
      break;
  }
  return result;
}
// 41BF82: variable 'v2' is possibly undefined
// 41BF82: variable 'v3' is possibly undefined
// 41C19C: variable 'v1' is possibly undefined

//----- (0041C3E0) --------------------------------------------------------
void __fastcall SurfaceInfos_c::Init(SurfaceInfos_c *this)
{
  memset(this->m_surfaceInfos, 0, sizeof(this->m_surfaceInfos));
  SurfaceInfos_c::LoadAdhesiveLimits(this);
  SurfaceInfos_c::LoadSurfaceInfos(this);
  SurfaceInfos_c::LoadSurfaceAudioInfos(this);
}

//----- (0041C408) --------------------------------------------------------
void __fastcall SurfaceInfos_c::LoadAdhesiveLimits(SurfaceInfos_c *this)
{
  u_native v2; // r5
  unsigned __int8 *Line; // r6
  int v4; // r9
  int v5; // r10
  int v6; // r0
  bool v7; // zf
  int v8; // r0
  bool v9; // zf
  int v10; // r8
  int v11; // r0
  bool v12; // zf
  char v13; // r0
  bool v14; // zf
  float v15; // r0
  int v16; // r1
  float v17; // [sp+4h] [bp-124h] BYREF
  char v18; // [sp+8h] [bp-120h] BYREF

  CFileMgr::SetDir((const unsigned __int8 *)&byte_61CADE);
  v2 = CFileMgr::OpenFile("data\\surface.dat", "rb");
  Line = CFileLoader::LoadLine(v2);
  if ( Line )
  {
    v4 = 1;
    v5 = 0;
    do
    {
      while ( 1 )
      {
        v6 = *Line;
        v7 = v6 == 59;
        if ( v6 != 59 )
          v7 = v6 == 0;
        if ( !v7 )
          break;
        Line = CFileLoader::LoadLine(v2);
        if ( !Line )
          goto LABEL_29;
      }
      sscanf((const char *)Line, "%s", &v18);
      while ( 1 )
      {
        v8 = *Line;
        v9 = v8 == 32;
        if ( v8 != 32 )
          v9 = v8 == 9;
        if ( v9 )
          break;
        ++Line;
      }
      v10 = 0;
      do
      {
        while ( 1 )
        {
          v11 = *Line;
          v12 = v11 == 32;
          if ( v11 != 32 )
            v12 = v11 == 9;
          if ( !v12 )
            break;
          ++Line;
        }
        v17 = 0.0;
        if ( *Line == 45 )
        {
          v13 = 45;
          goto LABEL_22;
        }
        sscanf((const char *)Line, "%f", &v17);
        while ( 1 )
        {
          v13 = *Line;
LABEL_22:
          if ( !v13 )
            break;
          v14 = v13 == 9;
          if ( v13 != 9 )
            v14 = v13 == 32;
          if ( v14 )
            break;
          ++Line;
        }
        v15 = v17;
        this->m_adhesiveLimitTable[6 * v5 + v10] = v17;
        v16 = 3 * v10++;
        this->m_adhesiveLimitTable[2 * v16 + v5] = v15;
      }
      while ( v10 != v4 );
      ++v5;
      ++v4;
      Line = CFileLoader::LoadLine(v2);
    }
    while ( Line );
  }
LABEL_29:
  CFileMgr::CloseFile(v2);
}
// 61CADE: using guessed type char byte_61CADE;

//----- (0041C548) --------------------------------------------------------
void __fastcall SurfaceInfos_c::LoadSurfaceInfos(SurfaceInfos_c *this)
{
  u_native v2; // r9
  unsigned __int8 *Line; // r0
  int v4; // r1
  bool v5; // zf
  SurfaceInfos_c *v6; // r0
  uint32 SurfaceIdFromName; // r11
  int v8; // r0
  char v9; // r2
  char *v10; // r0
  unsigned int v11; // r1
  char *v12; // r5
  int v13; // r0
  char v14; // r1
  unsigned int v15; // r0
  unsigned int v16; // r0
  int v17; // r0
  unsigned int *v18; // r5
  unsigned int v19; // r11
  unsigned int v20; // t1
  unsigned int v21; // r4
  int v22; // t1
  int v23; // r11
  int v24; // t1
  char v25; // r0
  int v26; // t1
  int v27; // t1
  unsigned int v28; // r6
  int v29; // r3
  int v30; // r4
  int v31; // r2
  int v32; // r8
  __int16 v33; // r10
  int v34; // r0
  int v35; // r1
  int v36; // r12
  int v37; // lr
  int v38; // [sp+88h] [bp-1A0h]
  int v39; // [sp+8Ch] [bp-19Ch]
  int v40; // [sp+90h] [bp-198h]
  int v41; // [sp+98h] [bp-190h]
  int v42; // [sp+9Ch] [bp-18Ch]
  int v43; // [sp+A0h] [bp-188h]
  int v44; // [sp+A4h] [bp-184h]
  int v45; // [sp+A8h] [bp-180h]
  int v46; // [sp+ACh] [bp-17Ch]
  int v47; // [sp+B0h] [bp-178h]
  SurfaceInfos_c *v48; // [sp+B4h] [bp-174h]
  int v49; // [sp+B8h] [bp-170h] BYREF
  int v50; // [sp+BCh] [bp-16Ch] BYREF
  int v51; // [sp+C0h] [bp-168h] BYREF
  int v52; // [sp+C4h] [bp-164h] BYREF
  int v53; // [sp+C8h] [bp-160h] BYREF
  int v54; // [sp+CCh] [bp-15Ch] BYREF
  int v55; // [sp+D0h] [bp-158h] BYREF
  int v56; // [sp+D4h] [bp-154h] BYREF
  int v57; // [sp+D8h] [bp-150h] BYREF
  int v58; // [sp+DCh] [bp-14Ch] BYREF
  int v59; // [sp+E0h] [bp-148h] BYREF
  int v60; // [sp+E4h] [bp-144h] BYREF
  int v61; // [sp+E8h] [bp-140h] BYREF
  int v62; // [sp+ECh] [bp-13Ch] BYREF
  int v63; // [sp+F0h] [bp-138h] BYREF
  int v64; // [sp+F4h] [bp-134h] BYREF
  int v65; // [sp+F8h] [bp-130h] BYREF
  int v66; // [sp+FCh] [bp-12Ch] BYREF
  int v67; // [sp+100h] [bp-128h] BYREF
  int v68; // [sp+104h] [bp-124h] BYREF
  int v69; // [sp+108h] [bp-120h] BYREF
  int v70; // [sp+10Ch] [bp-11Ch] BYREF
  int v71; // [sp+110h] [bp-118h] BYREF
  int v72; // [sp+114h] [bp-114h] BYREF
  __int16 v73; // [sp+118h] [bp-110h] BYREF
  int v74; // [sp+11Ch] [bp-10Ch] BYREF
  int v75; // [sp+120h] [bp-108h] BYREF
  int v76; // [sp+124h] [bp-104h] BYREF
  int v77; // [sp+128h] [bp-100h] BYREF
  float v78; // [sp+12Ch] [bp-FCh] BYREF
  float v79; // [sp+130h] [bp-F8h] BYREF
  char v80[32]; // [sp+134h] [bp-F4h] BYREF
  char v81[32]; // [sp+154h] [bp-D4h] BYREF
  char v82[32]; // [sp+174h] [bp-B4h] BYREF
  char v83[32]; // [sp+194h] [bp-94h] BYREF
  unsigned __int8 v84[64]; // [sp+1B4h] [bp-74h] BYREF

  v2 = CFileMgr::OpenFile("data\\surfinfo.dat", "r");
  Line = CFileLoader::LoadLine(v2);
  while ( Line )
  {
    while ( 1 )
    {
      v4 = *Line;
      v5 = v4 == 35;
      if ( v4 != 35 )
        v5 = v4 == 0;
      if ( !v5 )
        break;
      Line = CFileLoader::LoadLine(v2);
      if ( !Line )
        goto LABEL_48;
    }
    v6 = (SurfaceInfos_c *)sscanf(
                             (const char *)Line,
                             "%s %s %f %f %s %s %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %d %"
                             "d %d %d %d %d %s",
                             v84,
                             v83,
                             &v79,
                             &v78,
                             v82,
                             v81,
                             &v77,
                             &v76,
                             &v75,
                             &v74,
                             &v73,
                             &v72,
                             &v71,
                             &v70,
                             &v69,
                             &v68,
                             &v67,
                             &v66,
                             &v65,
                             &v64,
                             &v63,
                             &v62,
                             &v61,
                             &v60,
                             &v59,
                             &v58,
                             &v57,
                             &v56,
                             &v55,
                             &v54,
                             &v53,
                             &v52,
                             &v51,
                             &v50,
                             &v49,
                             v80);
    SurfaceIdFromName = SurfaceInfos_c::GetSurfaceIdFromName(v6, v84);
    if ( !strcmp(v83, "RUBBER") )
    {
      v10 = (char *)this + 12 * SurfaceIdFromName;
      v11 = *(_DWORD *)(v10 + 146) & 0xFFFFFFF8;
    }
    else
    {
      if ( !strcmp(v83, "HARD") )
      {
        v8 = 3 * SurfaceIdFromName;
        v9 = 1;
      }
      else if ( !strcmp(v83, "ROAD") )
      {
        v8 = 3 * SurfaceIdFromName;
        v9 = 2;
      }
      else if ( !strcmp(v83, "LOOSE") )
      {
        v8 = 3 * SurfaceIdFromName;
        v9 = 3;
      }
      else if ( !strcmp(v83, "SAND") )
      {
        v8 = 3 * SurfaceIdFromName;
        v9 = 4;
      }
      else
      {
        if ( strcmp(v83, "WET") )
          goto LABEL_22;
        v8 = 3 * SurfaceIdFromName;
        v9 = 5;
      }
      v10 = (char *)&this->m_adhesiveLimitTable[v8];
      v11 = *(_DWORD *)(v10 + 146) & 0xFFFFFFF8 | v9 & 7;
    }
    *(_DWORD *)(v10 + 146) = v11;
LABEL_22:
    v12 = (char *)this + 12 * SurfaceIdFromName;
    v12[144] = (int)(float)(v79 * 10.0);
    v12[145] = (int)(float)(v78 * 100.0);
    if ( !strcmp(v82, "DEFAULT") )
    {
      v15 = *(_DWORD *)(v12 + 146) & 0xFFFFFFE7;
    }
    else
    {
      if ( !strcmp(v82, "SANDY") )
      {
        v13 = *(_DWORD *)(v12 + 146);
        v14 = 2;
      }
      else
      {
        if ( strcmp(v82, "MUDDY") )
          goto LABEL_30;
        v13 = *(_DWORD *)(v12 + 146);
        v14 = 1;
      }
      v15 = v13 & 0xFFFFFFE7 | (8 * (v14 & 3));
    }
    *(_DWORD *)(v12 + 146) = v15;
LABEL_30:
    if ( !strcmp(v81, "NONE") )
    {
      v16 = *(_DWORD *)(v12 + 146) & 0xFFFFFF1F;
    }
    else
    {
      if ( strcmp(v81, "SPARKS") )
        goto LABEL_35;
      v16 = *(_DWORD *)(v12 + 146) & 0xFFFFFF1F | 0x20;
    }
    *(_DWORD *)(v12 + 146) = v16;
LABEL_35:
    v48 = this;
    if ( !strcmp(v80, "NONE") )
    {
      v22 = *(_DWORD *)(v12 + 146);
      v18 = (unsigned int *)(v12 + 146);
      v21 = v18[1];
      v19 = v22 & 0xFFFFF8FF;
    }
    else
    {
      if ( !strcmp(v80, "SPARKS") )
      {
        v24 = *(_DWORD *)(v12 + 146);
        v18 = (unsigned int *)(v12 + 146);
        v23 = v24;
        v25 = 1;
      }
      else if ( !strcmp(v80, "SAND") )
      {
        v26 = *(_DWORD *)(v12 + 146);
        v18 = (unsigned int *)(v12 + 146);
        v23 = v26;
        v25 = 2;
      }
      else
      {
        if ( strcmp(v80, "WOOD") )
        {
          v17 = strcmp(v80, "DUST");
          v20 = *(_DWORD *)(v12 + 146);
          v18 = (unsigned int *)(v12 + 146);
          v19 = v20;
          v21 = v18[1];
          if ( !v17 )
          {
            v19 = v19 & 0xFFFFF8FF | 0x400;
            *v18 = v19;
            v18[1] = v21;
          }
          goto LABEL_47;
        }
        v27 = *(_DWORD *)(v12 + 146);
        v18 = (unsigned int *)(v12 + 146);
        v23 = v27;
        v25 = 3;
      }
      v21 = v18[1];
      v19 = v23 & 0xFFFFF8FF | ((v25 & 7) << 8);
    }
    *v18 = v19;
LABEL_47:
    v47 = v59;
    v46 = v60;
    v45 = v61;
    v44 = v62;
    v28 = v58 & 1 | v21 & 0xFFFFFC00 | (2 * (v57 & 1)) | (4 * (v56 & 1)) | (8 * (v55 & 1)) | (16 * (v54 & 1)) | (32 * (v53 & 1)) | ((v52 & 1) << 6) | ((v51 & 1) << 7) | ((v50 & 1) << 8) | ((v49 & 1) << 9);
    v42 = v64;
    v41 = v65;
    v40 = v66;
    v39 = v67;
    v43 = v63;
    v38 = v68;
    v30 = v69;
    v29 = v70;
    v31 = v71;
    v32 = v72;
    v33 = v73;
    v34 = v74;
    v35 = v75;
    v36 = v76;
    v37 = v77;
    v18[1] = v28;
    *v18 = (v34 << 14) & 0x4000 | (v35 << 13) & 0x2000 | (v36 << 12) & 0x1000 | (v37 << 11) & 0x800 | v19 & 0x7FF | (unsigned __int16)(v33 << 15) | (v32 << 16) & 0x10000 | (v31 << 17) & 0x20000 | (v29 << 18) & 0x40000 | (v30 << 19) & 0x80000 | (v38 << 20) & 0x100000 | (v39 << 21) & 0x200000 | (v40 << 22) & 0x400000 | (v41 << 23) & 0x1800000 | (v42 << 25) & 0x6000000 | (v43 << 27) & 0x8000000 | (v44 << 28) & 0x10000000 | (v45 << 29) & 0x20000000 | (v46 << 30) & 0x7FFFFFFF | (v47 << 31);
    Line = CFileLoader::LoadLine(v2);
    this = v48;
  }
LABEL_48:
  CFileMgr::CloseFile(v2);
}
// 41C548: using guessed type unsigned __int8 var_74[64];

//----- (0041CA3C) --------------------------------------------------------
void __fastcall SurfaceInfos_c::LoadSurfaceAudioInfos(SurfaceInfos_c *this)
{
  u_native v2; // r5
  unsigned __int8 *Line; // r0
  int *v4; // r9
  int *v5; // r10
  char *v6; // r11
  SurfaceInfos_c *v7; // r0
  uint32 SurfaceIdFromName; // r0
  int *v9; // lr
  int *v10; // r12
  char *v11; // r0
  int v12; // r2
  char *v13; // r3
  char v14; // r6
  char v15; // r8
  char v16; // r11
  char v17; // r9
  char v18; // r10
  int v19; // r1
  unsigned int v20; // r1
  int v21; // r2
  int v22; // r1
  int v23; // r2
  int v24; // r1
  int v25; // r2
  int v26; // r1
  bool v27; // zf
  char v28; // [sp+20h] [bp-98h]
  char v29; // [sp+24h] [bp-94h]
  char v30; // [sp+28h] [bp-90h]
  char v31; // [sp+2Ch] [bp-8Ch]
  SurfaceInfos_c *v32; // [sp+30h] [bp-88h]
  int v33; // [sp+34h] [bp-84h] BYREF
  int v34; // [sp+38h] [bp-80h] BYREF
  int v35; // [sp+3Ch] [bp-7Ch] BYREF
  int v36; // [sp+40h] [bp-78h] BYREF
  char v37; // [sp+44h] [bp-74h] BYREF
  char v38; // [sp+48h] [bp-70h] BYREF
  int v39; // [sp+4Ch] [bp-6Ch] BYREF
  int v40; // [sp+50h] [bp-68h] BYREF
  int v41; // [sp+54h] [bp-64h] BYREF
  unsigned __int8 v42[64]; // [sp+58h] [bp-60h] BYREF

  v2 = CFileMgr::OpenFile("data\\surfaud.dat", "r");
  Line = CFileLoader::LoadLine(v2);
  if ( Line )
  {
    v4 = &v35;
    v5 = &v36;
    v6 = &v37;
    do
    {
      v26 = *Line;
      v27 = v26 == 35;
      if ( v26 != 35 )
        v27 = v26 == 0;
      if ( !v27 )
      {
        v7 = (SurfaceInfos_c *)sscanf(
                                 (const char *)Line,
                                 "%s %d %d %d %d %d %d %d %d %d",
                                 v42,
                                 &v41,
                                 &v40,
                                 &v39,
                                 &v38,
                                 v6,
                                 v5,
                                 v4,
                                 &v34,
                                 &v33);
        SurfaceIdFromName = SurfaceInfos_c::GetSurfaceIdFromName(v7, v42);
        v9 = v4;
        v10 = v5;
        v11 = (char *)this + 12 * SurfaceIdFromName;
        v12 = *(_DWORD *)(v11 + 150);
        v31 = v33;
        v30 = v34;
        v29 = v35;
        v28 = v36;
        v13 = v6;
        v32 = this;
        v14 = v37;
        v15 = v38;
        v16 = v41;
        v17 = v39;
        v18 = v40;
        *(_DWORD *)(v11 + 146) = *(_DWORD *)(v11 + 146);
        v19 = v16 & 1;
        v6 = v13;
        v20 = v12 & 0xFFF803FF | (v19 << 10);
        v21 = v18 & 1;
        v5 = v10;
        v22 = v20 | (v21 << 11);
        v23 = v17 & 1;
        v4 = v9;
        v24 = v22 | (v23 << 12);
        v25 = v15 & 1;
        this = v32;
        *(_DWORD *)(v11 + 150) = v24 | (v25 << 13) | ((v14 & 1) << 14) | ((v28 & 1) << 15) | ((v29 & 1) << 16) | ((v30 & 1) << 17) | ((v31 & 1) << 18);
      }
      Line = CFileLoader::LoadLine(v2);
    }
    while ( Line );
  }
  CFileMgr::CloseFile(v2);
}
// 41CA3C: using guessed type unsigned __int8 var_60[64];

//----- (0041CBB8) --------------------------------------------------------
uint32 __fastcall SurfaceInfos_c::GetSurfaceIdFromName(SurfaceInfos_c *this, unsigned __int8 *surfaceName)
{
  int v3; // r1
  uint32 result; // r0

  if ( !strcmp((const char *)surfaceName, "DEFAULT") )
    return 0;
  if ( !strcmp((const char *)surfaceName, "TARMAC") )
    return 1;
  if ( !strcmp((const char *)surfaceName, "TARMAC_FUCKED") )
    return 2;
  if ( !strcmp((const char *)surfaceName, "TARMAC_REALLYFUCKED") )
    return 3;
  if ( !strcmp((const char *)surfaceName, "PAVEMENT") )
    return 4;
  if ( !strcmp((const char *)surfaceName, "PAVEMENT_FUCKED") )
    return 5;
  if ( !strcmp((const char *)surfaceName, "GRAVEL") )
    return 6;
  if ( !strcmp((const char *)surfaceName, "FUCKED_CONCRETE") )
    return 7;
  if ( !strcmp((const char *)surfaceName, "PAINTED_GROUND") )
    return 8;
  if ( !strcmp((const char *)surfaceName, "GRASS_SHORT_LUSH") )
    return 9;
  if ( !strcmp((const char *)surfaceName, "GRASS_MEDIUM_LUSH") )
    return 10;
  if ( !strcmp((const char *)surfaceName, "GRASS_LONG_LUSH") )
    return 11;
  if ( !strcmp((const char *)surfaceName, "GRASS_SHORT_DRY") )
    return 12;
  if ( !strcmp((const char *)surfaceName, "GRASS_MEDIUM_DRY") )
    return 13;
  if ( !strcmp((const char *)surfaceName, "GRASS_LONG_DRY") )
    return 14;
  if ( !strcmp((const char *)surfaceName, "GOLFGRASS_ROUGH") )
    return 15;
  if ( !strcmp((const char *)surfaceName, "GOLFGRASS_SMOOTH") )
    return 16;
  if ( !strcmp((const char *)surfaceName, "STEEP_SLIDYGRASS") )
    return 17;
  if ( !strcmp((const char *)surfaceName, "STEEP_CLIFF") )
    return 18;
  if ( !strcmp((const char *)surfaceName, "FLOWERBED") )
    return 19;
  if ( !strcmp((const char *)surfaceName, "MEADOW") )
    return 20;
  if ( !strcmp((const char *)surfaceName, "WASTEGROUND") )
    return 21;
  if ( !strcmp((const char *)surfaceName, "WOODLANDGROUND") )
    return 22;
  if ( !strcmp((const char *)surfaceName, "VEGETATION") )
    return 23;
  if ( !strcmp((const char *)surfaceName, "MUD_WET") )
    return 24;
  if ( !strcmp((const char *)surfaceName, "MUD_DRY") )
    return 25;
  if ( !strcmp((const char *)surfaceName, "DIRT") )
    return 26;
  if ( !strcmp((const char *)surfaceName, "DIRTTRACK") )
    return 27;
  if ( !strcmp((const char *)surfaceName, "SAND_DEEP") )
    return 28;
  if ( !strcmp((const char *)surfaceName, "SAND_MEDIUM") )
    return 29;
  if ( !strcmp((const char *)surfaceName, "SAND_COMPACT") )
    return 30;
  if ( !strcmp((const char *)surfaceName, "SAND_ARID") )
    return 31;
  if ( !strcmp((const char *)surfaceName, "SAND_MORE") )
    return 32;
  if ( !strcmp((const char *)surfaceName, "SAND_BEACH") )
    return 33;
  if ( !strcmp((const char *)surfaceName, "CONCRETE_BEACH") )
    return 34;
  if ( !strcmp((const char *)surfaceName, "ROCK_DRY") )
    return 35;
  if ( !strcmp((const char *)surfaceName, "ROCK_WET") )
    return 36;
  if ( !strcmp((const char *)surfaceName, "ROCK_CLIFF") )
    return 37;
  if ( !strcmp((const char *)surfaceName, "WATER_RIVERBED") )
    return 38;
  if ( !strcmp((const char *)surfaceName, "WATER_SHALLOW") )
    return 39;
  if ( !strcmp((const char *)surfaceName, "CORNFIELD") )
    return 40;
  if ( !strcmp((const char *)surfaceName, "HEDGE") )
    return 41;
  if ( !strcmp((const char *)surfaceName, "WOOD_CRATES") )
    return 42;
  if ( !strcmp((const char *)surfaceName, "WOOD_SOLID") )
    return 43;
  if ( !strcmp((const char *)surfaceName, "WOOD_THIN") )
    return 44;
  if ( !strcmp((const char *)surfaceName, "GLASS") )
    return 45;
  if ( !strcmp((const char *)surfaceName, "GLASS_WINDOWS_LARGE") )
    return 46;
  if ( !strcmp((const char *)surfaceName, "GLASS_WINDOWS_SMALL") )
    return 47;
  if ( !strcmp((const char *)surfaceName, "EMPTY1") )
    return 48;
  if ( !strcmp((const char *)surfaceName, "EMPTY2") )
    return 49;
  if ( !strcmp((const char *)surfaceName, "GARAGE_DOOR") )
    return 50;
  if ( !strcmp((const char *)surfaceName, "THICK_METAL_PLATE") )
    return 51;
  if ( !strcmp((const char *)surfaceName, "SCAFFOLD_POLE") )
    return 52;
  if ( !strcmp((const char *)surfaceName, "LAMP_POST") )
    return 53;
  if ( !strcmp((const char *)surfaceName, "METAL_GATE") )
    return 54;
  if ( !strcmp((const char *)surfaceName, "METAL_CHAIN_FENCE") )
    return 55;
  if ( !strcmp((const char *)surfaceName, "GIRDER") )
    return 56;
  if ( !strcmp((const char *)surfaceName, "FIRE_HYDRANT") )
    return 57;
  if ( !strcmp((const char *)surfaceName, "CONTAINER") )
    return 58;
  if ( !strcmp((const char *)surfaceName, "NEWS_VENDOR") )
    return 59;
  if ( !strcmp((const char *)surfaceName, "WHEELBASE") )
    return 60;
  if ( !strcmp((const char *)surfaceName, "CARDBOARDBOX") )
    return 61;
  if ( !strcmp((const char *)surfaceName, (const char *)&dword_41DC7C) )
    return 62;
  if ( !strcmp((const char *)surfaceName, (const char *)&dword_41DC80) )
    return 63;
  if ( !strcmp((const char *)surfaceName, "CAR_PANEL") )
    return 64;
  if ( !strcmp((const char *)surfaceName, "CAR_MOVINGCOMPONENT") )
    return 65;
  if ( !strcmp((const char *)surfaceName, "TRANSPARENT_CLOTH") )
    return 66;
  if ( !strcmp((const char *)surfaceName, "RUBBER") )
    return 67;
  if ( !strcmp((const char *)surfaceName, "PLASTIC") )
    return 68;
  if ( !strcmp((const char *)surfaceName, "TRANSPARENT_STONE") )
    return 69;
  if ( !strcmp((const char *)surfaceName, "WOOD_BENCH") )
    return 70;
  if ( !strcmp((const char *)surfaceName, "CARPET") )
    return 71;
  if ( !strcmp((const char *)surfaceName, "FLOORBOARD") )
    return 72;
  if ( !strcmp((const char *)surfaceName, "STAIRSWOOD") )
    return 73;
  if ( !strcmp((const char *)surfaceName, "P_SAND") )
    return 74;
  if ( !strcmp((const char *)surfaceName, "P_SAND_DENSE") )
    return 75;
  if ( !strcmp((const char *)surfaceName, "P_SAND_ARID") )
    return 76;
  if ( !strcmp((const char *)surfaceName, "P_SAND_COMPACT") )
    return 77;
  if ( !strcmp((const char *)surfaceName, "P_SAND_ROCKY") )
    return 78;
  if ( !strcmp((const char *)surfaceName, "P_SANDBEACH") )
    return 79;
  if ( !strcmp((const char *)surfaceName, "P_GRASS_SHORT") )
    return 80;
  if ( !strcmp((const char *)surfaceName, "P_GRASS_MEADOW") )
    return 81;
  if ( !strcmp((const char *)surfaceName, "P_GRASS_DRY") )
    return 82;
  if ( !strcmp((const char *)surfaceName, "P_WOODLAND") )
    return 83;
  if ( !strcmp((const char *)surfaceName, "P_WOODDENSE") )
    return 84;
  if ( !strcmp((const char *)surfaceName, "P_ROADSIDE") )
    return 85;
  if ( !strcmp((const char *)surfaceName, "P_ROADSIDEDES") )
    return 86;
  if ( !strcmp((const char *)surfaceName, "P_FLOWERBED") )
    return 87;
  if ( !strcmp((const char *)surfaceName, "P_WASTEGROUND") )
    return 88;
  if ( !strcmp((const char *)surfaceName, "P_CONCRETE") )
    return 89;
  if ( !strcmp((const char *)surfaceName, "P_OFFICEDESK") )
    return 90;
  if ( !strcmp((const char *)surfaceName, "P_711SHELF1") )
    return 91;
  if ( !strcmp((const char *)surfaceName, "P_711SHELF2") )
    return 92;
  if ( !strcmp((const char *)surfaceName, "P_711SHELF3") )
    return 93;
  if ( !strcmp((const char *)surfaceName, "P_RESTUARANTTABLE") )
    return 94;
  if ( !strcmp((const char *)surfaceName, "P_BARTABLE") )
    return 95;
  if ( !strcmp((const char *)surfaceName, "P_UNDERWATERLUSH") )
    return 96;
  if ( !strcmp((const char *)surfaceName, "P_UNDERWATERBARREN") )
    return 97;
  if ( !strcmp((const char *)surfaceName, "P_UNDERWATERCORAL") )
    return 98;
  if ( !strcmp((const char *)surfaceName, "P_UNDERWATERDEEP") )
    return 99;
  if ( !strcmp((const char *)surfaceName, "P_RIVERBED") )
    return 100;
  if ( !strcmp((const char *)surfaceName, "P_RUBBLE") )
    return 101;
  if ( !strcmp((const char *)surfaceName, "P_BEDROOMFLOOR") )
    return 102;
  if ( !strcmp((const char *)surfaceName, "P_KIRCHENFLOOR") )
    return 103;
  if ( !strcmp((const char *)surfaceName, "P_LIVINGRMFLOOR") )
    return 104;
  if ( !strcmp((const char *)surfaceName, "P_CORRIDORFLOOR") )
    return 105;
  if ( !strcmp((const char *)surfaceName, "P_711FLOOR") )
    return 106;
  if ( !strcmp((const char *)surfaceName, "P_FASTFOODFLOOR") )
    return 107;
  if ( !strcmp((const char *)surfaceName, "P_SKANKYFLOOR") )
    return 108;
  if ( !strcmp((const char *)surfaceName, "P_MOUNTAIN") )
    return 109;
  if ( !strcmp((const char *)surfaceName, "P_MARSH") )
    return 110;
  if ( !strcmp((const char *)surfaceName, "P_BUSHY") )
    return 111;
  if ( !strcmp((const char *)surfaceName, "P_BUSHYMIX") )
    return 112;
  if ( !strcmp((const char *)surfaceName, "P_BUSHYDRY") )
    return 113;
  if ( !strcmp((const char *)surfaceName, "P_BUSHYMID") )
    return 114;
  if ( !strcmp((const char *)surfaceName, "P_GRASSWEEFLOWERS") )
    return 115;
  if ( !strcmp((const char *)surfaceName, "P_GRASSDRYTALL") )
    return 116;
  if ( !strcmp((const char *)surfaceName, "P_GRASSLUSHTALL") )
    return 117;
  if ( !strcmp((const char *)surfaceName, "P_GRASSGRNMIX") )
    return 118;
  if ( !strcmp((const char *)surfaceName, "P_GRASSBRNMIX") )
    return 119;
  if ( !strcmp((const char *)surfaceName, "P_GRASSLOW") )
    return 120;
  if ( !strcmp((const char *)surfaceName, "P_GRASSROCKY") )
    return 121;
  if ( !strcmp((const char *)surfaceName, "P_GRASSSMALLTREES") )
    return 122;
  if ( !strcmp((const char *)surfaceName, "P_DIRTROCKY") )
    return 123;
  if ( !strcmp((const char *)surfaceName, "P_DIRTWEEDS") )
    return 124;
  if ( !strcmp((const char *)surfaceName, "P_GRASSWEEDS") )
    return 125;
  if ( !strcmp((const char *)surfaceName, "P_RIVEREDGE") )
    return 126;
  if ( !strcmp((const char *)surfaceName, "P_POOLSIDE") )
    return 127;
  if ( !strcmp((const char *)surfaceName, "P_FORESTSTUMPS") )
    return 128;
  if ( !strcmp((const char *)surfaceName, "P_FORESTSTICKS") )
    return 129;
  if ( !strcmp((const char *)surfaceName, "P_FORRESTLEAVES") )
    return 130;
  if ( !strcmp((const char *)surfaceName, "P_DESERTROCKS") )
    return 131;
  if ( !strcmp((const char *)surfaceName, "P_FORRESTDRY") )
    return 132;
  if ( !strcmp((const char *)surfaceName, "P_SPARSEFLOWERS") )
    return 133;
  if ( !strcmp((const char *)surfaceName, "P_BUILDINGSITE") )
    return 134;
  if ( !strcmp((const char *)surfaceName, "P_DOCKLANDS") )
    return 135;
  if ( !strcmp((const char *)surfaceName, "P_INDUSTRIAL") )
    return 136;
  if ( !strcmp((const char *)surfaceName, "P_INDUSTJETTY") )
    return 137;
  if ( !strcmp((const char *)surfaceName, "P_CONCRETELITTER") )
    return 138;
  if ( !strcmp((const char *)surfaceName, "P_ALLEYRUBISH") )
    return 139;
  if ( !strcmp((const char *)surfaceName, "P_JUNKYARDPILES") )
    return 140;
  if ( !strcmp((const char *)surfaceName, "P_JUNKYARDGRND") )
    return 141;
  if ( !strcmp((const char *)surfaceName, "P_DUMP") )
    return 142;
  if ( !strcmp((const char *)surfaceName, "P_CACTUSDENSE") )
    return 143;
  if ( !strcmp((const char *)surfaceName, "P_AIRPORTGRND") )
    return 144;
  if ( !strcmp((const char *)surfaceName, "P_CORNFIELD") )
    return 145;
  if ( !strcmp((const char *)surfaceName, "P_GRASSLIGHT") )
    return 146;
  if ( !strcmp((const char *)surfaceName, "P_GRASSLIGHTER") )
    return 147;
  if ( !strcmp((const char *)surfaceName, "P_GRASSLIGHTER2") )
    return 148;
  if ( !strcmp((const char *)surfaceName, "P_GRASSMID1") )
    return 149;
  if ( !strcmp((const char *)surfaceName, "P_GRASSMID2") )
    return 150;
  if ( !strcmp((const char *)surfaceName, "P_GRASSDARK") )
    return 151;
  if ( !strcmp((const char *)surfaceName, "P_GRASSDARK2") )
    return 152;
  if ( !strcmp((const char *)surfaceName, "P_GRASSDIRTMIX") )
    return 153;
  if ( !strcmp((const char *)surfaceName, "P_RIVERBEDSTONE") )
    return 154;
  if ( !strcmp((const char *)surfaceName, "P_RIVERBEDSHALLOW") )
    return 155;
  if ( !strcmp((const char *)surfaceName, "P_RIVERBEDWEEDS") )
    return 156;
  if ( !strcmp((const char *)surfaceName, "P_SEAWEED") )
    return 157;
  if ( !strcmp((const char *)surfaceName, "DOOR") )
    return 158;
  if ( !strcmp((const char *)surfaceName, "PLASTICBARRIER") )
    return 159;
  if ( !strcmp((const char *)surfaceName, "PARKGRASS") )
    return 160;
  if ( !strcmp((const char *)surfaceName, "STAIRSSTONE") )
    return 161;
  if ( !strcmp((const char *)surfaceName, "STAIRSMETAL") )
    return 162;
  if ( !strcmp((const char *)surfaceName, "STAIRSCARPET") )
    return 163;
  if ( !strcmp((const char *)surfaceName, "FLOORMETAL") )
    return 164;
  if ( !strcmp((const char *)surfaceName, "FLOORCONCRETE") )
    return 165;
  if ( !strcmp((const char *)surfaceName, "BIN_BAG") )
    return 166;
  if ( !strcmp((const char *)surfaceName, "THIN_METAL_SHEET") )
    return 167;
  if ( !strcmp((const char *)surfaceName, "METAL_BARREL") )
    return 168;
  if ( !strcmp((const char *)surfaceName, "PLASTIC_CONE") )
    return 169;
  if ( !strcmp((const char *)surfaceName, "PLASTIC_DUMPSTER") )
    return 170;
  if ( !strcmp((const char *)surfaceName, "METAL_DUMPSTER") )
    return 171;
  if ( !strcmp((const char *)surfaceName, "WOOD_PICKET_FENCE") )
    return 172;
  if ( !strcmp((const char *)surfaceName, "WOOD_SLATTED_FENCE") )
    return 173;
  if ( !strcmp((const char *)surfaceName, "WOOD_RANCH_FENCE") )
    return 174;
  if ( !strcmp((const char *)surfaceName, "UNBREAKABLE_GLASS") )
    return 175;
  if ( !strcmp((const char *)surfaceName, "HAY_BALE") )
    return 176;
  if ( !strcmp((const char *)surfaceName, "GORE") )
    return 177;
  v3 = strcmp((const char *)surfaceName, "RAILTRACK");
  result = 0;
  if ( !v3 )
    return 178;
  return result;
}
// 41DC7C: using guessed type int dword_41DC7C;
// 41DC80: using guessed type int dword_41DC80;

//----- (0041DE50) --------------------------------------------------------
int32 __fastcall SurfaceInfos_c::GetAdhesionGroup(SurfaceInfos_c *this, uint32 surfaceId)
{
  return *(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) & 7;
}

//----- (0041DE62) --------------------------------------------------------
float __fastcall SurfaceInfos_c::GetTyreGrip(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (float)this->m_surfaceInfos[surfaceId].tyreGrip / 10.0;
}

//----- (0041DE84) --------------------------------------------------------
float __fastcall SurfaceInfos_c::GetWetMultiplier(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (float)(CWeather::WetRoads * (float)((float)this->m_surfaceInfos[surfaceId].wetMult / 100.0)) + 1.0;
}

//----- (0041DEC4) --------------------------------------------------------
eSkidmarkType __fastcall SurfaceInfos_c::GetSkidmarkType(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 3) & 3;
}

//----- (0041DED6) --------------------------------------------------------
int32 __fastcall SurfaceInfos_c::GetFrictionEffect(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (unsigned __int8)*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 5;
}

//----- (0041DEE8) --------------------------------------------------------
int32 __fastcall SurfaceInfos_c::GetBulletFx(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 8) & 7;
}

//----- (0041DEFA) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsSoftLanding(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 11) & 1;
}

//----- (0041DF0C) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsSeeThrough(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 12) & 1;
}

//----- (0041DF1E) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsShootThrough(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 13) & 1;
}

//----- (0041DF30) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsSand(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 14) & 1;
}

//----- (0041DF42) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsWater(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 15) & 1;
}

//----- (0041DF54) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsShallowWater(SurfaceInfos_c *this, uint32 surfaceId)
{
  return *((_WORD *)&this->m_surfaceInfos[surfaceId] + 2) & 1;
}

//----- (0041DF66) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsBeach(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 17) & 1;
}

//----- (0041DF78) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsSteepSlope(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 18) & 1;
}

//----- (0041DF8A) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsGlass(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 19) & 1;
}

//----- (0041DF9C) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsStairs(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 20) & 1;
}

//----- (0041DFAE) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsSkateable(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 21) & 1;
}

//----- (0041DFC0) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsPavement(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 22) & 1;
}

//----- (0041DFD2) --------------------------------------------------------
int32 __fastcall SurfaceInfos_c::GetRoughness(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 23) & 3;
}

//----- (0041DFE4) --------------------------------------------------------
int32 __fastcall SurfaceInfos_c::GetFlammability(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 25) & 3;
}

//----- (0041DFF6) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesSparks(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 27) & 1;
}

//----- (0041E008) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CantSprintOn(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 28) & 1;
}

//----- (0041E01A) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::LeavesFootsteps(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 29) & 1;
}

//----- (0041E02C) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::ProducesFootDust(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 30) & 1;
}

//----- (0041E03E) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::MakesCarDirty(SurfaceInfos_c *this, uint32 surfaceId)
{
  return *(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 2) >> 31;
}

//----- (0041E04E) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::MakesCarClean(SurfaceInfos_c *this, uint32 surfaceId)
{
  return *(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) & 1;
}

//----- (0041E060) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesWheelGrass(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 1) & 1;
}

//----- (0041E072) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesWheelGravel(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 2) & 1;
}

//----- (0041E084) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesWheelMud(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 3) & 1;
}

//----- (0041E096) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesWheelDust(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 4) & 1;
}

//----- (0041E0A8) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesWheelSand(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 5) & 1;
}

//----- (0041E0BA) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesWheelSpray(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 6) & 1;
}

//----- (0041E0CC) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesPlants(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 7) & 1;
}

//----- (0041E0DE) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CreatesObjects(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 8) & 1;
}

//----- (0041E0F0) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::CanClimb(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 9) & 1;
}

//----- (0041E102) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioConcrete(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 10) & 1;
}

//----- (0041E114) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioGrass(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 11) & 1;
}

//----- (0041E126) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioSand(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 12) & 1;
}

//----- (0041E138) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioGravel(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 13) & 1;
}

//----- (0041E14A) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioWood(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 14) & 1;
}

//----- (0041E15C) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioWater(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 15) & 1;
}

//----- (0041E16E) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioMetal(SurfaceInfos_c *this, uint32 surfaceId)
{
  return *((_WORD *)&this->m_surfaceInfos[surfaceId] + 4) & 1;
}

//----- (0041E180) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioLongGrass(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 17) & 1;
}

//----- (0041E192) --------------------------------------------------------
bool8 __fastcall SurfaceInfos_c::IsAudioTile(SurfaceInfos_c *this, uint32 surfaceId)
{
  return (*(_DWORD *)((char *)&this->m_surfaceInfos[surfaceId] + 6) >> 18) & 1;
}

//----- (0041E1A4) --------------------------------------------------------
float __fastcall SurfaceInfos_c::GetAdhesiveLimit(SurfaceInfos_c *this, CColPoint *colPoint)
{
  return this->m_adhesiveLimitTable[6
                                  * (*(_DWORD *)((char *)&this->m_surfaceInfos[colPoint->m_dataB.m_nSurfaceType] + 2) & 7)
                                  + (*(_DWORD *)((char *)&this->m_surfaceInfos[colPoint->m_dataA.m_nSurfaceType] + 2) & 7)];
}

//----- (0041E1E0) --------------------------------------------------------
void __fastcall CColourSet::CColourSet(CColourSet *this, Int32 Time, Int32 Weather)
{
  unsigned int v3; // r3
  RQVector *v4; // r4
  RQVector *v5; // r6
  RQVector *v6; // r1
  __int64 v7; // d17
  _QWORD *arr; // r3
  __int64 v9; // d17
  __int64 v10; // d17

  *(_QWORD *)this->m_vGreenGrade._anon_0.arr = 0LL;
  *(_QWORD *)&this->m_vGreenGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)this->m_vRedGrade._anon_0.arr = 0LL;
  *(_QWORD *)&this->m_vRedGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)this->m_vBlueGrade._anon_0.arr = 0LL;
  *(_QWORD *)&this->m_vBlueGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  this->m_fAmbientRed = (float)CTimeCycle::m_nAmbientRed[Time][Weather];
  this->m_fAmbientGreen = (float)CTimeCycle::m_nAmbientGreen[Time][Weather];
  this->m_fAmbientBlue = (float)CTimeCycle::m_nAmbientBlue[Time][Weather];
  this->m_fAmbientRed_Obj = (float)CTimeCycle::m_nAmbientRed_Obj[Time][Weather];
  this->m_fAmbientGreen_Obj = (float)CTimeCycle::m_nAmbientGreen_Obj[Time][Weather];
  this->m_fAmbientBlue_Obj = (float)CTimeCycle::m_nAmbientBlue_Obj[Time][Weather];
  this->m_nSkyTopRed = CTimeCycle::m_nSkyTopRed[Time][Weather];
  this->m_nSkyTopGreen = CTimeCycle::m_nSkyTopGreen[Time][Weather];
  this->m_nSkyTopBlue = CTimeCycle::m_nSkyTopBlue[Time][Weather];
  this->m_nSkyBottomRed = CTimeCycle::m_nSkyBottomRed[Time][Weather];
  this->m_nSkyBottomGreen = CTimeCycle::m_nSkyBottomGreen[Time][Weather];
  this->m_nSkyBottomBlue = CTimeCycle::m_nSkyBottomBlue[Time][Weather];
  this->m_nSunCoreRed = CTimeCycle::m_nSunCoreRed[Time][Weather];
  this->m_nSunCoreGreen = CTimeCycle::m_nSunCoreGreen[Time][Weather];
  this->m_nSunCoreBlue = CTimeCycle::m_nSunCoreBlue[Time][Weather];
  this->m_nSunCoronaRed = CTimeCycle::m_nSunCoronaRed[Time][Weather];
  this->m_nSunCoronaGreen = CTimeCycle::m_nSunCoronaGreen[Time][Weather];
  this->m_nSunCoronaBlue = CTimeCycle::m_nSunCoronaBlue[Time][Weather];
  this->m_fSunSize = (float)CTimeCycle::m_fSunSize[23 * Time + Weather];
  this->m_fSpriteSize = (float)CTimeCycle::m_fSpriteSize[23 * Time + Weather];
  this->m_fSpriteBrightness = (float)CTimeCycle::m_fSpriteBrightness[23 * Time + Weather];
  this->m_nShadowStrength = CTimeCycle::m_nShadowStrength[Time][Weather];
  this->m_nLightShadowStrength = CTimeCycle::m_nLightShadowStrength[Time][Weather];
  this->m_nPoleShadowStrength = CTimeCycle::m_nPoleShadowStrength[Time][Weather];
  this->m_fFarClip = (float)CTimeCycle::m_fFarClip[Time][Weather];
  this->m_fFogStart = (float)CTimeCycle::m_fFogStart[Time][Weather];
  this->m_fLightsOnGroundBrightness = (float)CTimeCycle::m_fLightsOnGroundBrightness[Time][Weather];
  this->m_nLowCloudsRed = CTimeCycle::m_nLowCloudsRed[Time][Weather];
  this->m_nLowCloudsGreen = CTimeCycle::m_nLowCloudsGreen[Time][Weather];
  this->m_nLowCloudsBlue = CTimeCycle::m_nLowCloudsBlue[Time][Weather];
  this->m_nFluffyCloudsBottomRed = CTimeCycle::m_nFluffyCloudsBottomRed[Time][Weather];
  this->m_nFluffyCloudsBottomGreen = CTimeCycle::m_nFluffyCloudsBottomGreen[Time][Weather];
  this->m_nFluffyCloudsBottomBlue = CTimeCycle::m_nFluffyCloudsBottomBlue[Time][Weather];
  this->m_fWaterRed = (float)CTimeCycle::m_fWaterRed[Time][Weather];
  this->m_fWaterGreen = (float)CTimeCycle::m_fWaterGreen[Time][Weather];
  this->m_fWaterBlue = (float)CTimeCycle::m_fWaterBlue[Time][Weather];
  this->m_fWaterAlpha = (float)CTimeCycle::m_fWaterAlpha[Time][Weather];
  this->m_fPostFx1Red = (float)CTimeCycle::m_fPostFx1Red[Time][Weather];
  this->m_fPostFx1Green = (float)CTimeCycle::m_fPostFx1Green[Time][Weather];
  this->m_fPostFx1Blue = (float)CTimeCycle::m_fPostFx1Blue[Time][Weather];
  this->m_fPostFx1Alpha = (float)CTimeCycle::m_fPostFx1Alpha[Time][Weather];
  this->m_fPostFx2Red = (float)CTimeCycle::m_fPostFx2Red[Time][Weather];
  this->m_fPostFx2Green = (float)CTimeCycle::m_fPostFx2Green[Time][Weather];
  this->m_fPostFx2Blue = (float)CTimeCycle::m_fPostFx2Blue[Time][Weather];
  this->m_fPostFx2Alpha = (float)CTimeCycle::m_fPostFx2Alpha[Time][Weather];
  this->m_fCloudAlpha = (float)CTimeCycle::m_fCloudAlpha[Time][Weather];
  this->m_nHighLightMinIntensity = CTimeCycle::m_nHighLightMinIntensity[Time][Weather];
  this->m_nWaterFogAlpha = CTimeCycle::m_nWaterFogAlpha[Time][Weather];
  v3 = CTimeCycle::m_nDirectionalMult[Time][Weather];
  this->m_fLODMultiplier = 1.0;
  v4 = &CTimeCycle::m_vRedGrade[Time][Weather];
  v5 = CTimeCycle::m_vBlueGrade[Time];
  v6 = &CTimeCycle::m_vGreenGrade[Time][Weather];
  this->m_fDirectionalLightMultiplier = (float)v3 / 100.0;
  v7 = *(_QWORD *)&v4->_anon_0._anon_1.b;
  *(_QWORD *)this->m_vRedGrade._anon_0.arr = *(_QWORD *)v4->_anon_0.arr;
  *(_QWORD *)&this->m_vRedGrade._anon_0._anon_1.b = v7;
  arr = (_QWORD *)v5[Weather]._anon_0.arr;
  v9 = arr[1];
  *(_QWORD *)this->m_vBlueGrade._anon_0.arr = *arr;
  *(_QWORD *)&this->m_vBlueGrade._anon_0._anon_1.b = v9;
  v10 = *(_QWORD *)&v6->_anon_0._anon_1.b;
  *(_QWORD *)this->m_vGreenGrade._anon_0.arr = *(_QWORD *)v6->_anon_0.arr;
  *(_QWORD *)&this->m_vGreenGrade._anon_0._anon_1.b = v10;
}

//----- (0041E790) --------------------------------------------------------
void __fastcall CColourSet::Interpolate(
        CColourSet *this,
        CColourSet *pSet1,
        CColourSet *pSet2,
        float Mult1,
        float Mult2,
        int bSkipSky)
{
  float32x2_t v6; // d0
  float32x2_t v7; // d1
  int v12; // r8
  int *v13; // r0

  if ( !bSkipSky )
  {
    this->m_nSkyTopRed = (int)(float)((float)((float)pSet1->m_nSkyTopRed * Mult1)
                                    + (float)((float)pSet2->m_nSkyTopRed * Mult2));
    this->m_nSkyTopGreen = (int)(float)((float)((float)pSet1->m_nSkyTopGreen * Mult1)
                                      + (float)((float)pSet2->m_nSkyTopGreen * Mult2));
    this->m_nSkyTopBlue = (int)(float)((float)((float)pSet1->m_nSkyTopBlue * Mult1)
                                     + (float)((float)pSet2->m_nSkyTopBlue * Mult2));
    this->m_nSkyBottomRed = (int)(float)((float)((float)pSet1->m_nSkyBottomRed * Mult1)
                                       + (float)((float)pSet2->m_nSkyBottomRed * Mult2));
    this->m_nSkyBottomGreen = (int)(float)((float)((float)pSet1->m_nSkyBottomGreen * Mult1)
                                         + (float)((float)pSet2->m_nSkyBottomGreen * Mult2));
    this->m_nSkyBottomBlue = (int)(float)((float)((float)pSet1->m_nSkyBottomBlue * Mult1)
                                        + (float)((float)pSet2->m_nSkyBottomBlue * Mult2));
    this->m_nSunCoreRed = (int)(float)((float)((float)pSet1->m_nSunCoreRed * Mult1)
                                     + (float)((float)pSet2->m_nSunCoreRed * Mult2));
    this->m_nSunCoreGreen = (int)(float)((float)((float)pSet1->m_nSunCoreGreen * Mult1)
                                       + (float)((float)pSet2->m_nSunCoreGreen * Mult2));
    this->m_nSunCoreBlue = (int)(float)((float)((float)pSet1->m_nSunCoreBlue * Mult1)
                                      + (float)((float)pSet2->m_nSunCoreBlue * Mult2));
    this->m_nSunCoronaRed = (int)(float)((float)((float)pSet1->m_nSunCoronaRed * Mult1)
                                       + (float)((float)pSet2->m_nSunCoronaRed * Mult2));
    this->m_nSunCoronaGreen = (int)(float)((float)((float)pSet1->m_nSunCoronaGreen * Mult1)
                                         + (float)((float)pSet2->m_nSunCoronaGreen * Mult2));
    this->m_nSunCoronaBlue = (int)(float)((float)((float)pSet1->m_nSunCoronaBlue * Mult1)
                                        + (float)((float)pSet2->m_nSunCoronaBlue * Mult2));
    this->m_fSunSize = (float)(pSet1->m_fSunSize * Mult1) + (float)(pSet2->m_fSunSize * Mult2);
    this->m_nLowCloudsRed = (int)(float)((float)((float)pSet1->m_nLowCloudsRed * Mult1)
                                       + (float)((float)pSet2->m_nLowCloudsRed * Mult2));
    this->m_nLowCloudsGreen = (int)(float)((float)((float)pSet1->m_nLowCloudsGreen * Mult1)
                                         + (float)((float)pSet2->m_nLowCloudsGreen * Mult2));
    this->m_nLowCloudsBlue = (int)(float)((float)((float)pSet1->m_nLowCloudsBlue * Mult1)
                                        + (float)((float)pSet2->m_nLowCloudsBlue * Mult2));
    this->m_nFluffyCloudsBottomRed = (int)(float)((float)((float)pSet1->m_nFluffyCloudsBottomRed * Mult1)
                                                + (float)((float)pSet2->m_nFluffyCloudsBottomRed * Mult2));
    this->m_nFluffyCloudsBottomGreen = (int)(float)((float)((float)pSet1->m_nFluffyCloudsBottomGreen * Mult1)
                                                  + (float)((float)pSet2->m_nFluffyCloudsBottomGreen * Mult2));
    this->m_nFluffyCloudsBottomBlue = (int)(float)((float)((float)pSet1->m_nFluffyCloudsBottomBlue * Mult1)
                                                 + (float)((float)pSet2->m_nFluffyCloudsBottomBlue * Mult2));
  }
  v12 = 0;
  this->m_fAmbientRed = (float)(pSet1->m_fAmbientRed * Mult1) + (float)(pSet2->m_fAmbientRed * Mult2);
  this->m_fAmbientGreen = (float)(pSet1->m_fAmbientGreen * Mult1) + (float)(pSet2->m_fAmbientGreen * Mult2);
  this->m_fAmbientBlue = (float)(pSet1->m_fAmbientBlue * Mult1) + (float)(pSet2->m_fAmbientBlue * Mult2);
  this->m_fAmbientRed_Obj = (float)(pSet1->m_fAmbientRed_Obj * Mult1) + (float)(pSet2->m_fAmbientRed_Obj * Mult2);
  this->m_fAmbientGreen_Obj = (float)(pSet1->m_fAmbientGreen_Obj * Mult1) + (float)(pSet2->m_fAmbientGreen_Obj * Mult2);
  this->m_fAmbientBlue_Obj = (float)(pSet1->m_fAmbientBlue_Obj * Mult1) + (float)(pSet2->m_fAmbientBlue_Obj * Mult2);
  this->m_fSpriteSize = (float)(pSet1->m_fSpriteSize * Mult1) + (float)(pSet2->m_fSpriteSize * Mult2);
  this->m_fSpriteBrightness = (float)(pSet1->m_fSpriteBrightness * Mult1) + (float)(pSet2->m_fSpriteBrightness * Mult2);
  this->m_nShadowStrength = (int)(float)((float)((float)pSet1->m_nShadowStrength * Mult1)
                                       + (float)((float)pSet2->m_nShadowStrength * Mult2));
  this->m_nLightShadowStrength = (int)(float)((float)((float)pSet1->m_nLightShadowStrength * Mult1)
                                            + (float)((float)pSet2->m_nLightShadowStrength * Mult2));
  this->m_nPoleShadowStrength = (int)(float)((float)((float)pSet1->m_nPoleShadowStrength * Mult1)
                                           + (float)((float)pSet2->m_nPoleShadowStrength * Mult2));
  this->m_fFarClip = (float)(pSet1->m_fFarClip * Mult1) + (float)(pSet2->m_fFarClip * Mult2);
  if ( FindPlayerVehicle(-1, 0) )
  {
    v12 = 0;
    if ( FindPlayerVehicle(-1, 0)->m_vehicleType == 4 )
    {
      v12 = 1;
    }
    else if ( FindPlayerVehicle(-1, 0)->m_vehicleType == 3 )
    {
      v12 = 1;
    }
  }
  if ( (RQCaps[14] || RQCaps[4] || RQCaps[5]) << 24 )
  {
    if ( (MobileSettings::settings[0].value > 1) | v12 )
    {
      v13 = dword_41EF64;
      if ( MobileSettings::settings[0].value < 3 )
        v13 = &dword_41EF64[1];
LABEL_19:
      v6.n64_u32[0] = *v13;
      goto LABEL_20;
    }
    goto LABEL_16;
  }
  if ( !((MobileSettings::settings[0].value > 0) | v12) )
  {
LABEL_16:
    v6.n64_u32[0] = 1138819072;
    goto LABEL_20;
  }
  if ( MobileSettings::settings[0].value >= 2 )
  {
    v13 = dword_41EF70;
    if ( MobileSettings::settings[0].value == 2 )
      v13 = &dword_41EF70[1];
    goto LABEL_19;
  }
  v6.n64_u32[0] = 1142702080;
LABEL_20:
  v7.n64_u32[0] = LODWORD(this->m_fFarClip);
  LODWORD(this->m_fFarClip) = vmin_f32(v7, v6).n64_u32[0];
  this->m_fFogStart = (float)(pSet1->m_fFogStart * Mult1) + (float)(pSet2->m_fFogStart * Mult2);
  this->m_fPostFx1Red = (float)(pSet1->m_fPostFx1Red * Mult1) + (float)(pSet2->m_fPostFx1Red * Mult2);
  this->m_fPostFx1Green = (float)(pSet1->m_fPostFx1Green * Mult1) + (float)(pSet2->m_fPostFx1Green * Mult2);
  this->m_fPostFx1Blue = (float)(pSet1->m_fPostFx1Blue * Mult1) + (float)(pSet2->m_fPostFx1Blue * Mult2);
  this->m_fPostFx1Alpha = (float)(pSet1->m_fPostFx1Alpha * Mult1) + (float)(pSet2->m_fPostFx1Alpha * Mult2);
  this->m_fPostFx2Red = (float)(pSet1->m_fPostFx2Red * Mult1) + (float)(pSet2->m_fPostFx2Red * Mult2);
  this->m_fPostFx2Green = (float)(pSet1->m_fPostFx2Green * Mult1) + (float)(pSet2->m_fPostFx2Green * Mult2);
  this->m_fPostFx2Blue = (float)(pSet1->m_fPostFx2Blue * Mult1) + (float)(pSet2->m_fPostFx2Blue * Mult2);
  this->m_fPostFx2Alpha = (float)(pSet1->m_fPostFx2Alpha * Mult1) + (float)(pSet2->m_fPostFx2Alpha * Mult2);
  this->m_fLightsOnGroundBrightness = (float)(pSet1->m_fLightsOnGroundBrightness * Mult1)
                                    + (float)(pSet2->m_fLightsOnGroundBrightness * Mult2);
  this->m_fCloudAlpha = (float)(pSet1->m_fCloudAlpha * Mult1) + (float)(pSet2->m_fCloudAlpha * Mult2);
  this->m_nHighLightMinIntensity = (int)(float)((float)((float)pSet1->m_nHighLightMinIntensity * Mult1)
                                              + (float)((float)pSet2->m_nHighLightMinIntensity * Mult2));
  this->m_nWaterFogAlpha = (int)(float)((float)((float)pSet1->m_nWaterFogAlpha * Mult1)
                                      + (float)((float)pSet2->m_nWaterFogAlpha * Mult2));
  this->m_fDirectionalLightMultiplier = (float)(pSet1->m_fDirectionalLightMultiplier * Mult1)
                                      + (float)(pSet2->m_fDirectionalLightMultiplier * Mult2);
  this->m_fLODMultiplier = (float)(pSet1->m_fLODMultiplier * Mult1) + (float)(pSet2->m_fLODMultiplier * Mult2);
  this->m_fWaterRed = (float)(pSet1->m_fWaterRed * Mult1) + (float)(pSet2->m_fWaterRed * Mult2);
  this->m_fWaterGreen = (float)(pSet1->m_fWaterGreen * Mult1) + (float)(pSet2->m_fWaterGreen * Mult2);
  this->m_fWaterBlue = (float)(pSet1->m_fWaterBlue * Mult1) + (float)(pSet2->m_fWaterBlue * Mult2);
  this->m_fWaterAlpha = (float)(pSet1->m_fWaterAlpha * Mult1) + (float)(pSet2->m_fWaterAlpha * Mult2);
  this->m_vRedGrade = (RQVector)vaddq_f32(
                                  vmulq_n_f32((float32x4_t)pSet1->m_vRedGrade, Mult1),
                                  vmulq_n_f32((float32x4_t)pSet2->m_vRedGrade, Mult2));
  this->m_vGreenGrade = (RQVector)vaddq_f32(
                                    vmulq_n_f32((float32x4_t)pSet1->m_vGreenGrade, Mult1),
                                    vmulq_n_f32((float32x4_t)pSet2->m_vGreenGrade, Mult2));
  this->m_vBlueGrade = (RQVector)vaddq_f32(
                                   vmulq_n_f32((float32x4_t)pSet1->m_vBlueGrade, Mult1),
                                   vmulq_n_f32((float32x4_t)pSet2->m_vBlueGrade, Mult2));
}
// 41ECEC: variable 'v7' is possibly undefined
// 41ECEC: variable 'v6' is possibly undefined
// 41EF64: using guessed type int dword_41EF64[2];
// 41EF70: using guessed type int dword_41EF70[2];

//----- (0041EF78) --------------------------------------------------------
void CTimeCycle::Update()
{
  CSimpleTransform *p_tx; // r2

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  CTimeCycle::CalcColoursForPoint(p_tx->m_translate, (int)&CTimeCycle::m_CurrentColours);
}

//----- (0041EFA0) --------------------------------------------------------
float *__fastcall CTimeCycle::CalcColoursForPoint(CVector a1, int a2)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d3
  float32x2_t v6; // d8
  float32x2_t v7; // d13
  float x; // r4
  RwReal z; // r5
  RwReal y; // r9
  CTimeCycleBox *v12; // r6
  float v13; // r0
  int v14; // r10
  float32x2_t v15; // d0
  uint8 *v16; // r1
  unsigned int v17; // r1
  int v18; // r0
  float v19; // s19
  float v20; // s20
  Int32 m_index; // r0
  int v22; // r9
  CSimpleTransform *p_tx; // r2
  float v24; // s24
  float v25; // r6
  int v26; // r1
  Int32 v27; // r2
  float v28; // s0
  __int16 v29; // r0
  unsigned int v30; // s2
  unsigned int v31; // s4
  unsigned int v32; // s6
  unsigned int v33; // s8
  unsigned int v34; // r2
  unsigned int v35; // s0
  __int16 v36; // r2
  __int16 v37; // r2
  __int16 v38; // r2
  __int16 v39; // r2
  float v40; // r5
  float v41; // r6
  RwReal v42; // s2
  CVector *v43; // r0
  float v44; // s0
  float v45; // s2
  unsigned int v46; // r1
  unsigned int v47; // s4
  int v48; // r3
  unsigned int v49; // s4
  unsigned int v50; // r0
  unsigned int v51; // s4
  int v52; // r2
  unsigned int v53; // s4
  unsigned int v54; // r1
  float v55; // s8
  float v56; // s10
  float v57; // s12
  unsigned int v58; // r0
  float v59; // s8
  float v60; // s10
  unsigned int v61; // r1
  float v62; // s8
  float v63; // s10
  int v64; // r2
  int v65; // r0
  unsigned int v66; // r1
  float v67; // s8
  float v68; // s10
  float v69; // s12
  unsigned int v70; // r0
  float v71; // s8
  float v72; // s10
  float v73; // s12
  float32x4_t v74; // q9
  float32x4_t v75; // q8
  float32x4_t v76; // q9
  float v77; // s0
  float v78; // s18
  _BOOL4 v79; // r0
  float v80; // s18
  float32x4_t v81; // q9
  int v82; // s0
  float v83; // s2
  int v84; // r0
  CSimpleTransform *p_m_transform; // r0
  float v86; // s2
  int v87; // s2
  float v88; // s10
  float v89; // r0
  float v90; // r2
  float v91; // r3
  float value; // s8
  float v93; // s8
  float v94; // s10
  float v95; // s10
  float v96; // s14
  float v97; // s18
  float v98; // s10
  float v99; // s8
  float v100; // s12
  float v101; // s10
  float v102; // s4
  float v103; // s2
  float v104; // s0
  float *result; // r0
  int v106; // [sp+14h] [bp-85Ch]
  float v107; // [sp+18h] [bp-858h]
  CTimeCycleBox *v108; // [sp+1Ch] [bp-854h]
  CTimeCycleBox *v109; // [sp+20h] [bp-850h]
  Int32 Time; // [sp+24h] [bp-84Ch]
  CVector vec; // [sp+28h] [bp-848h] BYREF
  __int64 v112; // [sp+DCh] [bp-794h]
  __int64 v113; // [sp+E4h] [bp-78Ch]
  __int64 v114; // [sp+ECh] [bp-784h]
  __int64 v115; // [sp+F4h] [bp-77Ch]
  __int64 v116; // [sp+FCh] [bp-774h]
  __int64 v117; // [sp+104h] [bp-76Ch]
  CColourSet v118; // [sp+10Ch] [bp-764h] BYREF
  CColourSet v119; // [sp+1E8h] [bp-688h] BYREF
  CColourSet v120; // [sp+2C4h] [bp-5ACh] BYREF
  CColourSet v121; // [sp+3A0h] [bp-4D0h] BYREF
  CColourSet pSet2; // [sp+47Ch] [bp-3F4h] BYREF
  CColourSet pSet1; // [sp+558h] [bp-318h] BYREF
  CColourSet v124; // [sp+634h] [bp-23Ch] BYREF
  CColourSet v125; // [sp+710h] [bp-160h] BYREF
  CTimeCycleBox *ppCurrentTCB; // [sp+7ECh] [bp-84h] BYREF
  CTimeCycleBox *v127; // [sp+7F0h] [bp-80h] BYREF
  CTimeCycleBox *currentTCBFarClip[2]; // [sp+7F4h] [bp-7Ch] BYREF
  float pBoxStrength; // [sp+7FCh] [bp-74h] BYREF
  float v130; // [sp+800h] [bp-70h] BYREF
  float BoxStrengthFarClip[2]; // [sp+804h] [bp-6Ch] BYREF
  CVector v132; // 0:r0.12
  CVector v133; // 0:r0.12
  CVector v134; // 0:r0.12

  x = a1.x;
  z = a1.z;
  y = a1.y;
  CTimeCycle::FindTimeCycleBox(a1, currentTCBFarClip, BoxStrengthFarClip, 1, 0, 0);
  *(_QWORD *)&v132.x = __PAIR64__(LODWORD(y), LODWORD(x));
  v132.z = z;
  CTimeCycle::FindTimeCycleBox(v132, &ppCurrentTCB, &pBoxStrength, 0, 1, 0);
  if ( ppCurrentTCB )
  {
    *(_QWORD *)&v133.x = __PAIR64__(LODWORD(y), LODWORD(x));
    v133.z = z;
    CTimeCycle::FindTimeCycleBox(v133, &v127, &v130, 0, 1, ppCurrentTCB);
    v12 = 0;
    if ( v127 )
    {
      v12 = ppCurrentTCB;
      if ( (float)(ppCurrentTCB->m_bBox.m_vecMax.x - ppCurrentTCB->m_bBox.m_vecMin.x) >= (float)(v127->m_bBox.m_vecMax.x
                                                                                               - v127->m_bBox.m_vecMin.x) )
      {
        v12 = v127;
      }
      else
      {
        ppCurrentTCB = v127;
        v13 = pBoxStrength;
        v127 = v12;
        pBoxStrength = v130;
        v130 = v13;
      }
    }
  }
  else
  {
    v12 = 0;
    v127 = 0;
  }
  v14 = 0;
  *(_QWORD *)&v134.x = __PAIR64__(LODWORD(y), LODWORD(x));
  v134.z = z;
  CTimeCycle::FindTimeCycleBox(v134, &currentTCBFarClip[1], &BoxStrengthFarClip[1], 0, 0, 0);
  v4.n64_u32[0] = 1103101428;
  v2.n64_f32[0] = (float)((float)((float)CClock::ms_nGameClockMinutes / 60.0) + (float)CClock::ms_nGameClockHours)
                + (float)((float)(unsigned __int8)CClock::ms_nGameClockSeconds / 3600.0);
  v15.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
  do
  {
    v16 = &aTimeSamples[v14++];
    v17 = v16[1];
  }
  while ( v15.n64_f32[0] >= (float)v17 );
  v107 = y;
  v7.n64_u32[0] = 1.0;
  v18 = (int)&CWeather::InterpolationValue;
  LODWORD(vec.y) = v14 % 8;
  v19 = CWeather::InterpolationValue;
  v108 = currentTCBFarClip[1];
  v109 = v12;
  v20 = (float)(v15.n64_f32[0] - (float)aTimeSamples[v14 - 1]) / (float)(int)(v17 - aTimeSamples[v14 - 1]);
  if ( currentTCBFarClip[1] )
  {
    m_index = currentTCBFarClip[1]->m_index;
    v22 = 22;
    if ( m_index < 8 )
      v22 = 21;
    v18 = m_index % 8;
  }
  else
  {
    v22 = 0;
  }
  *(_QWORD *)v125.m_vGreenGrade._anon_0.arr = 0LL;
  *(_QWORD *)&v125.m_vGreenGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  v106 = v18;
  *(_QWORD *)v125.m_vRedGrade._anon_0.arr = 0LL;
  *(_QWORD *)&v125.m_vRedGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)v125.m_vBlueGrade._anon_0.arr = 0LL;
  *(_QWORD *)&v125.m_vBlueGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)v124.m_vGreenGrade._anon_0.arr = 0LL;
  *(_QWORD *)&v124.m_vGreenGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)v124.m_vRedGrade._anon_0.arr = 0LL;
  *(_QWORD *)&v124.m_vRedGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)v124.m_vBlueGrade._anon_0.arr = 0LL;
  *(_QWORD *)&v124.m_vBlueGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  CColourSet::CColourSet(&pSet1, v14 - 1, CWeather::OldWeatherType);
  CColourSet::CColourSet(&pSet2, SLODWORD(vec.y), CWeather::OldWeatherType);
  Time = v14 - 1;
  CColourSet::CColourSet(&v121, v14 - 1, CWeather::NewWeatherType);
  CColourSet::CColourSet(&v120, SLODWORD(vec.y), CWeather::NewWeatherType);
  v6.n64_u32[0] = 0;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v15.n64_f32[0] = (float)(p_tx->m_translate.z + -20.0) / 200.0;
  v24 = vmin_f32(vmax_f32(v15, v6), v7).n64_f32[0];
  if ( v24 > 0.0 )
  {
    if ( CWeather::OldWeatherType == 3 )
    {
      CColourSet::CColourSet(&v119, Time, 1);
      CColourSet::Interpolate(&pSet1, &pSet1, &v119, 1.0 - v24, v24, 0);
      CColourSet::CColourSet(&v118, SLODWORD(vec.y), 1);
      CColourSet::Interpolate(&pSet2, &pSet2, &v118, 1.0 - v24, v24, 0);
    }
    else if ( CWeather::OldWeatherType == 2 )
    {
      CColourSet::CColourSet(&v119, Time, 0);
      CColourSet::Interpolate(&pSet1, &pSet1, &v119, 1.0 - v24, v24, 0);
      CColourSet::CColourSet(&v118, SLODWORD(vec.y), 0);
      CColourSet::Interpolate(&pSet2, &pSet2, &v118, 1.0 - v24, v24, 0);
    }
    if ( CWeather::NewWeatherType == 3 )
    {
      CColourSet::CColourSet(&v119, Time, 1);
      v25 = 1.0 - v24;
      CColourSet::Interpolate(&v121, &v121, &v119, 1.0 - v24, v24, 0);
      v26 = v14 % 8;
      v27 = 1;
    }
    else
    {
      if ( CWeather::NewWeatherType != 2 )
        goto LABEL_26;
      CColourSet::CColourSet(&v119, Time, 0);
      v25 = 1.0 - v24;
      CColourSet::Interpolate(&v121, &v121, &v119, 1.0 - v24, v24, 0);
      v26 = v14 % 8;
      v27 = 0;
    }
    CColourSet::CColourSet(&v118, v26, v27);
    CColourSet::Interpolate(&v120, &v120, &v118, v25, v24, 0);
  }
LABEL_26:
  CColourSet::Interpolate(&v125, &pSet1, &pSet2, 1.0 - v20, v20, 0);
  CColourSet::Interpolate(&v124, &v121, &v120, 1.0 - v20, v20, 0);
  CColourSet::Interpolate((CColourSet *)a2, &v125, &v124, 1.0 - v19, v19, 0);
  v28 = (float)((float)(1.0 / CCoronas::LightsMult) + 3.0) * 0.25;
  v29 = 255;
  v30 = (unsigned int)(float)(v28 * (float)*(unsigned __int16 *)(a2 + 42));
  v31 = (unsigned int)(float)(v28 * (float)*(unsigned __int16 *)(a2 + 44));
  v32 = (unsigned int)(float)(v28 * (float)*(unsigned __int16 *)(a2 + 46));
  v33 = (unsigned int)(float)(v28 * (float)*(unsigned __int16 *)(a2 + 40));
  v34 = (unsigned int)(float)(v28 * (float)*(unsigned __int16 *)(a2 + 36));
  v35 = (unsigned int)(float)(v28 * (float)*(unsigned __int16 *)(a2 + 38));
  if ( v34 >= 0xFF )
    LOWORD(v34) = 255;
  *(_WORD *)(a2 + 36) = v34;
  v36 = v35;
  if ( v35 >= 0xFF )
    v36 = 255;
  *(_WORD *)(a2 + 38) = v36;
  v37 = v33;
  if ( v33 >= 0xFF )
    v37 = 255;
  *(_WORD *)(a2 + 40) = v37;
  v38 = v30;
  if ( v30 >= 0xFF )
    v38 = 255;
  *(_WORD *)(a2 + 42) = v38;
  v39 = v31;
  if ( v31 >= 0xFF )
    v39 = 255;
  *(_WORD *)(a2 + 44) = v39;
  if ( v32 < 0xFF )
    v29 = v32;
  *(_WORD *)(a2 + 46) = v29;
  if ( CTimeCycle::m_FogReduction )
  {
    v4.n64_u32[0] = *(_DWORD *)(a2 + 80);
    v15.n64_f32[0] = (float)CTimeCycle::m_FogReduction * 10.156;
    v15.n64_u64[0] = vmax_f32(v4, v15).n64_u64[0];
    *(_DWORD *)(a2 + 80) = v15.n64_u32[0];
  }
  v40 = (float)((float)((float)CClock::ms_nGameClockSeconds / 60.0)
              + (float)(CClock::ms_nGameClockMinutes + 60 * CClock::ms_nGameClockHours))
      * 0.0043633;
  v41 = sinf(v40);
  v42 = 0.2 - cosf(v40);
  CTimeCycle::m_CurrentStoredValue = (CTimeCycle::m_CurrentStoredValue + 1) & 0xF;
  v43 = &CTimeCycle::m_VectorToSun[CTimeCycle::m_CurrentStoredValue];
  v43->y = -0.7;
  v43->x = v41 + 0.7;
  v43->z = v42;
  CVector::Normalise(v43);
  if ( v108 && v108->m_index >= 0 )
  {
    v44 = v108->m_percentage * BoxStrengthFarClip[1];
    v45 = 1.0 - v44;
    v46 = CTimeCycle::m_nSkyTopRed[v106][v22];
    if ( v46 != 255 )
    {
      v47 = *(unsigned __int16 *)(a2 + 38);
      *(_WORD *)(a2 + 36) = (int)(float)((float)(v44 * (float)v46) + (float)(v45 * (float)*(unsigned __int16 *)(a2 + 36)));
      v48 = (int)(float)((float)(v45 * (float)v47) + (float)(v44 * (float)CTimeCycle::m_nSkyTopGreen[v106][v22]));
      v49 = *(unsigned __int16 *)(a2 + 40);
      *(_WORD *)(a2 + 38) = v48;
      *(_WORD *)(a2 + 40) = (int)(float)((float)(v45 * (float)v49)
                                       + (float)(v44 * (float)CTimeCycle::m_nSkyTopBlue[v106][v22]));
    }
    v50 = CTimeCycle::m_nSkyBottomRed[v106][v22];
    if ( v50 != 255 )
    {
      v51 = *(unsigned __int16 *)(a2 + 44);
      *(_WORD *)(a2 + 42) = (int)(float)((float)(v44 * (float)v50) + (float)(v45 * (float)*(unsigned __int16 *)(a2 + 42)));
      v52 = (int)(float)((float)(v45 * (float)v51) + (float)(v44 * (float)CTimeCycle::m_nSkyBottomGreen[v106][v22]));
      v53 = *(unsigned __int16 *)(a2 + 46);
      *(_WORD *)(a2 + 44) = v52;
      *(_WORD *)(a2 + 46) = (int)(float)((float)(v45 * (float)v53)
                                       + (float)(v44 * (float)CTimeCycle::m_nSkyBottomBlue[v106][v22]));
    }
    v54 = CTimeCycle::m_fWaterRed[v106][v22];
    if ( v54 != 255 )
    {
      v55 = *(float *)(a2 + 108);
      v56 = *(float *)(a2 + 112);
      v57 = *(float *)(a2 + 116);
      *(float *)(a2 + 104) = (float)(v44 * (float)v54) + (float)(v45 * *(float *)(a2 + 104));
      *(float *)(a2 + 108) = (float)(v45 * v55) + (float)(v44 * (float)CTimeCycle::m_fWaterGreen[v106][v22]);
      *(float *)(a2 + 112) = (float)(v45 * v56) + (float)(v44 * (float)CTimeCycle::m_fWaterBlue[v106][v22]);
      *(float *)(a2 + 116) = (float)(v45 * v57) + (float)(v44 * (float)CTimeCycle::m_fWaterAlpha[v106][v22]);
    }
    v58 = CTimeCycle::m_nAmbientRed[v106][v22];
    if ( v58 != 255 )
    {
      v59 = *(float *)(a2 + 4);
      v60 = *(float *)(a2 + 8);
      *(float *)a2 = (float)(v44 * (float)v58) + (float)(v45 * *(float *)a2);
      *(float *)(a2 + 4) = (float)(v45 * v59) + (float)(v44 * (float)CTimeCycle::m_nAmbientGreen[v106][v22]);
      *(float *)(a2 + 8) = (float)(v45 * v60) + (float)(v44 * (float)CTimeCycle::m_nAmbientBlue[v106][v22]);
    }
    v61 = CTimeCycle::m_nAmbientRed_Obj[v106][v22];
    if ( v61 != 255 )
    {
      v62 = *(float *)(a2 + 16);
      v63 = *(float *)(a2 + 20);
      *(float *)(a2 + 12) = (float)(v44 * (float)v61) + (float)(v45 * *(float *)(a2 + 12));
      *(float *)(a2 + 16) = (float)(v45 * v62) + (float)(v44 * (float)CTimeCycle::m_nAmbientGreen_Obj[v106][v22]);
      *(float *)(a2 + 20) = (float)(v45 * v63) + (float)(v44 * (float)CTimeCycle::m_nAmbientBlue_Obj[v106][v22]);
    }
    v64 = (unsigned __int16)CTimeCycle::m_fFarClip[v106][v22];
    if ( v64 != 0xFFFF )
    {
      v4.n64_u32[0] = *(_DWORD *)(a2 + 80);
      v5.n64_f32[0] = (float)(__int16)v64;
      v5.n64_u64[0] = vmin_f32(v4, v5).n64_u64[0];
      *(float *)(a2 + 80) = (float)(v45 * v4.n64_f32[0]) + (float)(v44 * v5.n64_f32[0]);
    }
    v65 = (unsigned __int16)CTimeCycle::m_fFogStart[v106][v22];
    if ( v65 != 0xFFFF )
      *(float *)(a2 + 84) = (float)(v44 * (float)(__int16)v65) + (float)(v45 * *(float *)(a2 + 84));
    v66 = CTimeCycle::m_fPostFx1Red[v106][v22];
    if ( v66 != 255 )
    {
      v67 = *(float *)(a2 + 124);
      v68 = *(float *)(a2 + 128);
      v69 = *(float *)(a2 + 132);
      *(float *)(a2 + 120) = (float)(v44 * (float)v66) + (float)(v45 * *(float *)(a2 + 120));
      *(float *)(a2 + 124) = (float)(v45 * v67) + (float)(v44 * (float)CTimeCycle::m_fPostFx1Green[v106][v22]);
      *(float *)(a2 + 128) = (float)(v45 * v68) + (float)(v44 * (float)CTimeCycle::m_fPostFx1Blue[v106][v22]);
      *(float *)(a2 + 132) = (float)(v45 * v69) + (float)(v44 * (float)CTimeCycle::m_fPostFx1Alpha[v106][v22]);
    }
    v70 = CTimeCycle::m_fPostFx2Red[v106][v22];
    if ( v70 != 255 )
    {
      v71 = *(float *)(a2 + 140);
      v72 = *(float *)(a2 + 144);
      v73 = *(float *)(a2 + 148);
      *(float *)(a2 + 136) = (float)(v44 * (float)v70) + (float)(v45 * *(float *)(a2 + 136));
      *(float *)(a2 + 140) = (float)(v45 * v71) + (float)(v44 * (float)CTimeCycle::m_fPostFx2Green[v106][v22]);
      *(float *)(a2 + 144) = (float)(v45 * v72) + (float)(v44 * (float)CTimeCycle::m_fPostFx2Blue[v106][v22]);
      *(float *)(a2 + 148) = (float)(v45 * v73) + (float)(v44 * (float)CTimeCycle::m_fPostFx2Alpha[v106][v22]);
    }
    v74 = *(float32x4_t *)(a2 + 188);
    *(float32x4_t *)(a2 + 172) = vaddq_f32(
                                   vmulq_n_f32(*(float32x4_t *)(a2 + 172), v45),
                                   vmulq_n_f32((float32x4_t)CTimeCycle::m_vRedGrade[v106][v22], v44));
    v75 = vaddq_f32(vmulq_n_f32(v74, v45), vmulq_n_f32((float32x4_t)CTimeCycle::m_vGreenGrade[v106][v22], v44));
    v76 = *(float32x4_t *)(a2 + 204);
    *(float32x4_t *)(a2 + 188) = v75;
    *(float32x4_t *)(a2 + 204) = vaddq_f32(
                                   vmulq_n_f32(v76, v45),
                                   vmulq_n_f32((float32x4_t)CTimeCycle::m_vBlueGrade[v106][v22], v44));
  }
  if ( currentTCBFarClip[0] )
    *(float *)(a2 + 168) = (float)(*(float *)(a2 + 168) * (float)(1.0 - BoxStrengthFarClip[0]))
                         + (float)(BoxStrengthFarClip[0] * (float)((float)currentTCBFarClip[0]->m_lodMult * 0.03125));
  if ( ppCurrentTCB )
  {
    v4.n64_u32[0] = *(_DWORD *)(a2 + 80);
    v5.n64_f32[0] = (float)ppCurrentTCB->m_farClip;
    v5.n64_u64[0] = vmin_f32(v4, v5).n64_u64[0];
    *(float *)(a2 + 80) = (float)(v4.n64_f32[0] * (float)(1.0 - pBoxStrength)) + (float)(pBoxStrength * v5.n64_f32[0]);
  }
  if ( v109 )
  {
    v4.n64_u32[0] = *(_DWORD *)(a2 + 80);
    v5.n64_f32[0] = (float)v109->m_farClip;
    v5.n64_u64[0] = vmin_f32(v4, v5).n64_u64[0];
    *(float *)(a2 + 80) = (float)(v4.n64_f32[0] * (float)(1.0 - v130)) + (float)(v130 * v5.n64_f32[0]);
  }
  v77 = CTimer::ms_fTimeStep / 120.0;
  if ( !CTimeCycle::m_bExtraColourOn )
  {
    v78 = CTimeCycle::m_ExtraColourInter - v77;
    if ( (float)(CTimeCycle::m_ExtraColourInter - v77) < 0.0 )
    {
      CTimeCycle::m_ExtraColourInter = 0.0;
      goto LABEL_77;
    }
LABEL_72:
    CTimeCycle::m_ExtraColourInter = v78;
    if ( v78 <= 0.0 )
      goto LABEL_77;
    goto LABEL_73;
  }
  v78 = CTimeCycle::m_ExtraColourInter + v77;
  if ( (float)(CTimeCycle::m_ExtraColourInter + v77) <= 1.0 )
    goto LABEL_72;
  v78 = 1.0;
  CTimeCycle::m_ExtraColourInter = 1.0;
LABEL_73:
  CColourSet::CColourSet(&v119, CTimeCycle::m_ExtraColour, CTimeCycle::m_ExtraColourWeatherType);
  v79 = CTimeCycle::m_nSkyTopRed[CTimeCycle::m_ExtraColour][CTimeCycle::m_ExtraColourWeatherType]
     || CTimeCycle::m_nSkyTopGreen[CTimeCycle::m_ExtraColour][CTimeCycle::m_ExtraColourWeatherType]
     || CTimeCycle::m_nSkyTopBlue[CTimeCycle::m_ExtraColour][CTimeCycle::m_ExtraColourWeatherType] != 0;
  CColourSet::Interpolate((CColourSet *)a2, (CColourSet *)a2, &v119, 1.0 - v78, CTimeCycle::m_ExtraColourInter, !v79);
LABEL_77:
  if ( CWeather::UnderWaterness > 0.0 )
  {
    CColourSet::CColourSet(&v119, Time, 20);
    CColourSet::CColourSet(&v118, SLODWORD(vec.y), 20);
    v114 = 0LL;
    v115 = 0x3F80000000000000LL;
    v112 = 0LL;
    v113 = 0x3F80000000000000LL;
    v116 = 0LL;
    v117 = 0x3F80000000000000LL;
    CColourSet::Interpolate((CColourSet *)&vec.z, &v119, &v118, 1.0 - v20, v20, 0);
    CColourSet::Interpolate(
      (CColourSet *)a2,
      (CColourSet *)a2,
      (CColourSet *)&vec.z,
      1.0 - CWeather::UnderWaterness,
      CWeather::UnderWaterness,
      0);
  }
  v80 = CWeather::InTunnelness;
  if ( CWeather::InTunnelness > 0.0 )
  {
    CColourSet::CColourSet(&v119, 1, 22);
    CColourSet::Interpolate(
      (CColourSet *)a2,
      (CColourSet *)a2,
      &v119,
      1.0 - v80,
      CWeather::InTunnelness,
      (CTimeCycle::m_nSkyTopBlue[1][22] | CTimeCycle::m_nSkyTopGreen[1][22] | CTimeCycle::m_nSkyTopRed[1][22]) << 24 == 0);
  }
  v81.n128_u64[0] = 0x3B8080813B808081LL;
  v81.n128_u64[1] = 0x3B8080813B808081LL;
  v82 = (int)*(float *)(a2 + 20);
  *(float32x4_t *)a2 = vmulq_f32(vcvtq_f32_s32(vcvtq_s32_f32(*(float32x4_t *)a2)), v81);
  v83 = (float)(int)*(float *)(a2 + 16);
  *(float *)(a2 + 20) = (float)v82 * 0.0039216;
  *(float *)(a2 + 16) = v83 * 0.0039216;
  CShadows::CalcPedShadowValues(
    CTimeCycle::m_VectorToSun[CTimeCycle::m_CurrentStoredValue].x,
    CTimeCycle::m_VectorToSun[CTimeCycle::m_CurrentStoredValue].y,
    LODWORD(CTimeCycle::m_VectorToSun[CTimeCycle::m_CurrentStoredValue].z),
    &CTimeCycle::m_fShadowFrontX[CTimeCycle::m_CurrentStoredValue],
    &CTimeCycle::m_fShadowFrontY[CTimeCycle::m_CurrentStoredValue],
    &CTimeCycle::m_fShadowSideX[CTimeCycle::m_CurrentStoredValue],
    &CTimeCycle::m_fShadowSideY[CTimeCycle::m_CurrentStoredValue],
    &CTimeCycle::m_fShadowDisplacementX[CTimeCycle::m_CurrentStoredValue],
    &CTimeCycle::m_fShadowDisplacementY[CTimeCycle::m_CurrentStoredValue]);
  if ( TheCamera.m_cameraMatrix.zy < -0.9
    || !CWeather::bScriptsForceRain
    && (CCullZones::PlayerNoRain() || CCullZones::CamNoRain() || CCutsceneMgr::ms_running) )
  {
    v84 = CTimeCycle::m_FogReduction + 1;
    if ( CTimeCycle::m_FogReduction + 1 >= 64 )
      v84 = 64;
  }
  else
  {
    v84 = CTimeCycle::m_FogReduction - 1;
    if ( CTimeCycle::m_FogReduction - 1 <= 0 )
      v84 = 0;
  }
  CTimeCycle::m_FogReduction = v84;
  p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_m_transform = &TheCamera.m_transform;
  v86 = p_m_transform->m_translate.z;
  if ( v86 >= 200.0 )
  {
    v15.n64_u32[0] = *(_DWORD *)(a2 + 80);
    if ( v86 <= 500.0 )
    {
      if ( v15.n64_f32[0] > 1000.0 )
        *(float *)(a2 + 80) = (float)((float)((float)(v86 + -200.0) / 300.0) * 1000.0)
                            + (float)((float)(1.0 - (float)((float)(v86 + -200.0) / 300.0)) * v15.n64_f32[0]);
    }
    else
    {
      v3.n64_u32[0] = 1148846080;
      *(_DWORD *)(a2 + 80) = vmin_f32(v15, v3).n64_u32[0];
    }
  }
  v87 = (unsigned __int8)(int)(float)((float)((float)(1.0 - v20)
                                            * (float)CTimeCycle::CalcColoursForPoint(CVector,CColourSet *)::GreyValuesDuringDay[v14 - 1])
                                    + (float)(v20
                                            * (float)CTimeCycle::CalcColoursForPoint(CVector,CColourSet *)::GreyValuesDuringDay[LODWORD(vec.y)]));
  v88 = (float)(1.0 - CWeather::UnderWaterness) * (float)(unsigned int)v87;
  CTimeCycle::m_BelowHorizonGrey._anon_0._anon_0.blue = (int)(float)(v88
                                                                   + (float)(CWeather::UnderWaterness
                                                                           * (float)CTimeCycle::m_CurrentColours.m_nSkyBottomBlue));
  CTimeCycle::m_BelowHorizonGrey._anon_0._anon_0.red = (int)(float)((float)((float)(1.0 - CWeather::UnderWaterness)
                                                                          * (float)v87)
                                                                  + (float)(CWeather::UnderWaterness
                                                                          * (float)CTimeCycle::m_CurrentColours.m_nSkyBottomRed));
  CTimeCycle::m_BelowHorizonGrey._anon_0._anon_0.green = (int)(float)(v88
                                                                    + (float)(CWeather::UnderWaterness
                                                                            * (float)CTimeCycle::m_CurrentColours.m_nSkyBottomGreen));
  v89 = *(float *)a2;
  v90 = *(float *)(a2 + 4);
  v91 = *(float *)(a2 + 8);
  *(_DWORD *)(a2 + 24) = *(_DWORD *)a2;
  *(float *)(a2 + 28) = v90;
  *(float *)(a2 + 32) = v91;
  v5.n64_f32[0] = v91;
  v4.n64_f32[0] = v89;
  value = (float)MobileSettings::settings[16].value;
  v3.n64_f32[0] = v90;
  if ( MobileSettings::settings[16].value > 59 )
  {
    v93 = (float)((float)((float)(value + -60.0) + (float)(value + -60.0)) / 40.0) + 1.0;
    v94 = vmax_f32(vmax_f32(v4, v3), v5).n64_f32[0];
    v95 = (float)(v93 * v94) - v94;
    v3.n64_f32[0] = v95 + v90;
    v4.n64_f32[0] = v95 + v89;
    v5.n64_f32[0] = v95 + v91;
  }
  else
  {
    v93 = (float)((float)(value / 60.0) * 0.8) + 0.2;
    v3.n64_f32[0] = v93 * v90;
    v4.n64_f32[0] = v93 * v89;
    v5.n64_f32[0] = v93 * v91;
  }
  *(_DWORD *)a2 = v4.n64_u32[0];
  *(_DWORD *)(a2 + 4) = v3.n64_u32[0];
  *(_DWORD *)(a2 + 8) = v5.n64_u32[0];
  if ( v93 > 1.0 )
  {
    v96 = v4.n64_f32[0];
    v97 = vmax_f32(vmax_f32(v4, v3), v5).n64_f32[0];
    v98 = (float)((float)(v93 + -1.0) * 0.12) * 0.5;
    v99 = v5.n64_f32[0];
    v100 = v3.n64_f32[0];
    if ( v97 == 0.0 )
    {
      v99 = 0.001;
      v100 = 0.001;
      *(_DWORD *)a2 = 981668463;
      *(_DWORD *)(a2 + 4) = 981668463;
      v96 = 0.001;
      *(_DWORD *)(a2 + 8) = 981668463;
      v97 = 0.001;
    }
    if ( v98 > v97 )
    {
      v101 = v98 / v97;
      v96 = v101 * v96;
      v100 = v101 * v100;
      v99 = v101 * v99;
      *(float *)a2 = v96;
      *(float *)(a2 + 4) = v100;
      *(float *)(a2 + 8) = v99;
    }
    CTimeCycle::m_BrightnessAddedToAmbientGreen = v100 - v3.n64_f32[0];
    CTimeCycle::m_BrightnessAddedToAmbientRed = v96 - v4.n64_f32[0];
    CTimeCycle::m_BrightnessAddedToAmbientBlue = v99 - v5.n64_f32[0];
  }
  if ( x >= -3000.0 )
  {
    if ( x <= 3000.0 )
      goto LABEL_109;
    v102 = x + -3000.0;
  }
  else
  {
    v102 = -3000.0 - x;
  }
  v6.n64_f32[0] = v102 + 0.0;
LABEL_109:
  if ( v107 >= -3000.0 )
  {
    if ( v107 <= 3000.0 )
      goto LABEL_114;
    v103 = v107 + -3000.0;
  }
  else
  {
    v103 = -3000.0 - v107;
  }
  v6.n64_f32[0] = v103 + v6.n64_f32[0];
LABEL_114:
  if ( v6.n64_f32[0] >= 1000.0 )
  {
    v104 = 2.0;
  }
  else
  {
    if ( v6.n64_f32[0] < 0.0 )
      goto LABEL_119;
    v104 = (float)(v6.n64_f32[0] / 1000.0) + 1.0;
  }
  *(float *)(a2 + 168) = v104 * *(float *)(a2 + 168);
LABEL_119:
  result = (float *)CPostEffects::IsVisionFXActive();
  if ( result == (float *)((char *)&dword_0 + 1) )
  {
    if ( CPostEffects::m_bNightVision )
    {
      CTimeCycle::m_CurrentColours.m_nPoleShadowStrength = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nShadowStrength = 0;
      CTimeCycle::m_CurrentColours.m_fAmbientBlue_Obj = 0.0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopRed = 0x800000;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopBlue = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyBottomGreen = 128;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientRed = 0x3ECCCCCD00000000LL;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientBlue = 0LL;
      CTimeCycle::m_CurrentColours.m_fAmbientGreen_Obj = 0.4;
    }
    result = (float *)CPostEffects::m_bInfraredVision;
    if ( CPostEffects::m_bInfraredVision )
    {
      CTimeCycle::m_CurrentColours.m_nPoleShadowStrength = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nShadowStrength = 0;
      CTimeCycle::m_CurrentColours.m_fLightsOnGroundBrightness = 0.0;
      CTimeCycle::m_CurrentColours.m_nHighLightMinIntensity = 0;
      CTimeCycle::m_CurrentColours.m_nWaterFogAlpha = 0;
      CTimeCycle::m_CurrentColours.m_fAmbientBlue_Obj = 1.0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopRed = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopBlue = 128;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyBottomGreen = 0x800000;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientRed = 0LL;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientBlue = 1065353216LL;
      result = &CTimeCycle::m_CurrentColours.m_fAmbientGreen_Obj;
      CTimeCycle::m_CurrentColours.m_fAmbientGreen_Obj = 0.0;
    }
  }
  return result;
}
// 41F0DA: variable 'v2' is possibly undefined
// 41F0DA: variable 'v4' is possibly undefined
// 41F230: variable 'v6' is possibly undefined
// 41F234: variable 'v7' is possibly undefined
// 41F93A: variable 'v5' is possibly undefined
// 41FF6A: variable 'v3' is possibly undefined
// 0: using guessed type int dword_0;

//----- (0042050C) --------------------------------------------------------
void __fastcall CTimeCycle::FindTimeCycleBox(
        CVector vec,
        CTimeCycleBox **ppCurrentTCB,
        float *pBoxStrength,
        int bLOD,
        int bFarClip,
        CTimeCycleBox *pAlreadyFoundBox)
{
  float v6; // s12
  float x; // s2
  float y; // s4
  bool v9; // zf
  float v10; // s5
  float v11; // s14
  float v12; // s3
  float v13; // s1
  float v14; // s9
  float v15; // s11
  float v16; // s7
  float v17; // s9
  float v18; // s5
  float v19; // s3
  float v20; // s1
  float v21; // s14

  *ppCurrentTCB = 0;
  *pBoxStrength = 0.0;
  if ( CTimeCycle::m_NumBoxes >= 1 )
  {
    v6 = 0.0;
    x = vec.x;
    y = vec.y;
    vec.y = 0.0;
    LODWORD(vec.x) = CTimeCycle::m_aBoxes;
    do
    {
      if ( !LODWORD(vec.x) )
        goto LABEL_35;
      v9 = bLOD == 1;
      if ( bLOD == 1 )
        v9 = *(_BYTE *)(LODWORD(vec.x) + 26) == 32;
      if ( v9 )
        goto LABEL_35;
      if ( bFarClip == 1 )
      {
        if ( pAlreadyFoundBox != (CTimeCycleBox *)LODWORD(vec.x) && *(_WORD *)(LODWORD(vec.x) + 24) )
        {
LABEL_12:
          v10 = *(float *)LODWORD(vec.x);
          v11 = *(float *)(LODWORD(vec.x) + 36);
          if ( (float)(*(float *)LODWORD(vec.x) - v11) <= x )
          {
            v12 = *(float *)(LODWORD(vec.x) + 4);
            if ( (float)(v12 - v11) <= y )
            {
              v13 = *(float *)(LODWORD(vec.x) + 8);
              if ( (float)(v13 - (float)(v11 / 3.0)) <= vec.z )
              {
                v14 = *(float *)(LODWORD(vec.x) + 12);
                if ( (float)(v11 + v14) >= x )
                {
                  v15 = *(float *)(LODWORD(vec.x) + 16);
                  if ( (float)(v11 + v15) >= y )
                  {
                    v16 = *(float *)(LODWORD(vec.x) + 20);
                    if ( (float)((float)(v11 / 3.0) + v16) >= vec.z )
                    {
                      if ( v14 >= x )
                      {
                        v17 = 0.0;
                        if ( v10 > x )
                          v17 = v10 - x;
                      }
                      else
                      {
                        v17 = x - v14;
                      }
                      if ( v15 >= y )
                      {
                        v18 = 0.0;
                        if ( v12 > y )
                          v18 = v12 - y;
                      }
                      else
                      {
                        v18 = y - v15;
                      }
                      if ( v16 >= vec.z )
                      {
                        v19 = 0.0;
                        if ( v13 > vec.z )
                          v19 = v13 - vec.z;
                      }
                      else
                      {
                        v19 = vec.z - v16;
                      }
                      v20 = sqrtf(
                              (float)((float)(v17 * v17) + (float)(v18 * v18))
                            + (float)((float)(v19 * 3.0) * (float)(v19 * 3.0)));
                      if ( v20 <= 0.0 )
                      {
                        *ppCurrentTCB = (CTimeCycleBox *)LODWORD(vec.x);
                        v6 = 1.0;
                        *pBoxStrength = 1.0;
                      }
                      else
                      {
                        v21 = 1.0 - (float)(v20 / v11);
                        if ( v21 > v6 )
                        {
                          *ppCurrentTCB = (CTimeCycleBox *)LODWORD(vec.x);
                          *pBoxStrength = v21;
                          v6 = v21;
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
      else if ( pAlreadyFoundBox != (CTimeCycleBox *)LODWORD(vec.x) )
      {
        goto LABEL_12;
      }
LABEL_35:
      ++LODWORD(vec.y);
      LODWORD(vec.x) += 40;
    }
    while ( SLODWORD(vec.y) < CTimeCycle::m_NumBoxes );
  }
}
// 42050C: using guessed type _DWORD bFarClip_0;

//----- (004206E0) --------------------------------------------------------
void CTimeCycle::SetConstantParametersForPostFX()
{
  if ( CPostEffects::IsVisionFXActive() )
  {
    if ( CPostEffects::m_bNightVision )
    {
      CTimeCycle::m_CurrentColours.m_nPoleShadowStrength = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nShadowStrength = 0;
      CTimeCycle::m_CurrentColours.m_fAmbientBlue_Obj = 0.0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopRed = 0x800000;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopBlue = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyBottomGreen = 128;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientRed = 0x3ECCCCCD00000000LL;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientBlue = 0LL;
      CTimeCycle::m_CurrentColours.m_fAmbientGreen_Obj = 0.4;
    }
    if ( CPostEffects::m_bInfraredVision )
    {
      CTimeCycle::m_CurrentColours.m_nPoleShadowStrength = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nShadowStrength = 0;
      CTimeCycle::m_CurrentColours.m_fLightsOnGroundBrightness = 0.0;
      CTimeCycle::m_CurrentColours.m_nHighLightMinIntensity = 0;
      CTimeCycle::m_CurrentColours.m_nWaterFogAlpha = 0;
      CTimeCycle::m_CurrentColours.m_fAmbientBlue_Obj = 1.0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopRed = 0;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyTopBlue = 128;
      *(_DWORD *)&CTimeCycle::m_CurrentColours.m_nSkyBottomGreen = 0x800000;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientRed = 0LL;
      *(_QWORD *)&CTimeCycle::m_CurrentColours.m_fAmbientBlue = 1065353216LL;
      CTimeCycle::m_CurrentColours.m_fAmbientGreen_Obj = 0.0;
    }
  }
}
// 676668: using guessed type char *CPostEffects::m_bNightVision[2];

//----- (004207A0) --------------------------------------------------------
float __fastcall CTimeCycle::FindFarClipForCoors(CVector Coors)
{
  bool32 v1; // r5
  float v2; // r8
  float result; // r0
  CColourSet pResult; // [sp+4h] [bp-ECh] BYREF

  *(_QWORD *)pResult.m_vGreenGrade._anon_0.arr = 0LL;
  *(_QWORD *)&pResult.m_vGreenGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)pResult.m_vRedGrade._anon_0.arr = 0LL;
  *(_QWORD *)&pResult.m_vRedGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  *(_QWORD *)pResult.m_vBlueGrade._anon_0.arr = 0LL;
  *(_QWORD *)&pResult.m_vBlueGrade._anon_0._anon_1.b = 0x3F80000000000000LL;
  v1 = CTimeCycle::m_bExtraColourOn;
  v2 = CTimeCycle::m_ExtraColourInter;
  CTimeCycle::m_bExtraColourOn = 0;
  CTimeCycle::m_ExtraColourInter = 0.0;
  CTimeCycle::CalcColoursForPoint(Coors, (int)&pResult);
  CTimeCycle::m_ExtraColourInter = v2;
  result = pResult.m_fFarClip;
  CTimeCycle::m_bExtraColourOn = v1 != 0;
  return result;
}

//----- (00420828) --------------------------------------------------------
void __fastcall CTimeCycle::StartExtraColour(Int32 ExtraColour, bool bFade)
{
  float v2; // s0

  v2 = 1.0;
  if ( bFade )
    v2 = 0.0;
  CTimeCycle::m_ExtraColourWeatherType = ExtraColour / 8 + 21;
  CTimeCycle::m_ExtraColour = ExtraColour % 8;
  CTimeCycle::m_ExtraColourInter = v2;
  CTimeCycle::m_bExtraColourOn = 1;
}

//----- (00420898) --------------------------------------------------------
void __fastcall CTimeCycle::StopExtraColour(bool bFade)
{
  CTimeCycle::m_bExtraColourOn = 0;
  if ( !bFade )
    CTimeCycle::m_ExtraColourInter = 0.0;
}

//----- (004208BC) --------------------------------------------------------
void __fastcall CTimeCycle::AddOne(
        CBox *bBox,
        Int16 farClip,
        Int32 index,
        float percentage,
        float range,
        float LODMult)
{
  __int64 v6; // d16
  __int64 v7; // d17
  Int32 v8; // r4
  __int64 v9; // d18
  CTimeCycleBox *v10; // r0
  unsigned int v11; // r1

  v6 = *(_QWORD *)&bBox->m_vecMin.x;
  v7 = *(_QWORD *)&bBox->m_vecMin.z;
  v8 = CTimeCycle::m_NumBoxes;
  v9 = *(_QWORD *)&bBox->m_vecMax.y;
  v10 = &CTimeCycle::m_aBoxes[CTimeCycle::m_NumBoxes];
  v10->m_farClip = farClip;
  v11 = (unsigned int)(float)(LODMult * 32.0);
  v10->m_index = index;
  if ( LODMult > 4.0 )
    LOBYTE(v11) = 0x80;
  v10->m_lodMult = v11;
  v10->m_percentage = percentage * 0.01;
  v10->m_range = range;
  *(_QWORD *)&v10->m_bBox.m_vecMin.x = v6;
  *(_QWORD *)&v10->m_bBox.m_vecMin.z = v7;
  *(_QWORD *)&v10->m_bBox.m_vecMax.y = v9;
  CTimeCycle::m_NumBoxes = v8 + 1;
}

//----- (00420950) --------------------------------------------------------
void CTimeCycle::InitForRestart()
{
  CTimeCycle::m_ExtraColourInter = 0.0;
  CTimeCycle::m_bExtraColourOn = 0;
}

//----- (0042096C) --------------------------------------------------------
float CTimeCycle::GetAmbientRed()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientRed * gfLaRiotsLightMult;
}

//----- (00420994) --------------------------------------------------------
float CTimeCycle::GetAmbientGreen()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientGreen * gfLaRiotsLightMult;
}

//----- (004209BC) --------------------------------------------------------
float CTimeCycle::GetAmbientBlue()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientBlue * gfLaRiotsLightMult;
}

//----- (004209E4) --------------------------------------------------------
float CTimeCycle::GetAmbientRed_Obj()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientRed_Obj;
}

//----- (004209F4) --------------------------------------------------------
float CTimeCycle::GetAmbientGreen_Obj()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientGreen_Obj;
}

//----- (00420A04) --------------------------------------------------------
float CTimeCycle::GetAmbientBlue_Obj()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientBlue_Obj;
}

//----- (00420A14) --------------------------------------------------------
float CTimeCycle::GetAmbientRed_BeforeBrightness()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientRed_BeforeBrightness * gfLaRiotsLightMult;
}

//----- (00420A3C) --------------------------------------------------------
float CTimeCycle::GetAmbientGreen_BeforeBrightness()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientGreen_BeforeBrightness * gfLaRiotsLightMult;
}

//----- (00420A64) --------------------------------------------------------
float CTimeCycle::GetAmbientBlue_BeforeBrightness()
{
  return CTimeCycle::m_CurrentColours.m_fAmbientBlue_BeforeBrightness * gfLaRiotsLightMult;
}

//----- (00420A90) --------------------------------------------------------
uint64 GetOSWPerformanceTime()
{
  return (unsigned __int64)(OS_TimeAccurate() * 1000000.0);
}

//----- (00420AB8) --------------------------------------------------------
uint64 GetMillisecondTime()
{
  return RsTimer();
}

//----- (00420AC8) --------------------------------------------------------
void CTimer::Initialise()
{
  gSuspendDepth = 0;
  gTimerRunning = 0;
  CTimer::m_CodePause = 0;
  CTimer::m_snTimeInMilliseconds = 0;
  CTimer::m_FrameCounter = 0;
  CTimer::game_FPS = 0.0;
  CTimer::m_UserPause = 0;
  CTimer::bSlowMotionActive = 0;
  CTimer::bSkipProcessThisFrame = 0;
  CTimer::m_snTimeInMillisecondsNonClipped = 1;
  CTimer::m_snTimeInMillisecondsPauseMode = 1;
  CTimer::m_snPPPPreviousTimeInMilliseconds = 0;
  CTimer::m_snPPPreviousTimeInMilliseconds = 0;
  CTimer::m_snPPreviousTimeInMilliseconds = 0;
  CTimer::m_snPreviousTimeInMilliseconds = 0;
  CTimer::m_snPreviousTimeInMillisecondsNonClipped = 0;
  CTimer::ms_fTimeScale = 1.0;
  CTimer::ms_fOldTimeStep = 1.0;
  CTimer::ms_fTimeStep = 1.0;
  CTimer::ms_fSlowMotionScale = -1.0;
  timerDef.GetTime = GetOSWPerformanceTime;
  timerDef.millisecondRatio = 1000;
  oldTimerValue = (unsigned __int64)(OS_TimeAccurate() * 1000000.0);
}
// 96B524: using guessed type char gTimerRunning;

//----- (00420C24) --------------------------------------------------------
void CTimer::Shutdown()
{
  gTimerRunning = 0;
}
// 96B524: using guessed type char gTimerRunning;

//----- (00420C34) --------------------------------------------------------
void CTimer::Update()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d1
  float32x2_t v2; // d2
  float v3; // s0
  uint32 v4; // r2
  uint64 v5; // r4
  float v6; // s2
  float v7; // s0
  float v8; // s4
  float v9; // s4
  unsigned int v10; // s8
  unsigned int v11; // r6

  if ( timerDef.GetTime )
  {
    gTimerRunning = 1;
    CTimer::m_snPPPPreviousTimeInMilliseconds = CTimer::m_snPPPreviousTimeInMilliseconds;
    v3 = (float)(CTimer::m_snTimeInMillisecondsNonClipped - CTimer::m_snPreviousTimeInMillisecondsNonClipped);
    CTimer::m_snPreviousTimeInMillisecondsNonClipped = CTimer::m_snTimeInMillisecondsNonClipped;
    CTimer::m_snPPPreviousTimeInMilliseconds = CTimer::m_snPPreviousTimeInMilliseconds;
    v4 = CTimer::m_snPreviousTimeInMilliseconds;
    CTimer::m_snPreviousTimeInMilliseconds = CTimer::m_snTimeInMilliseconds;
    CTimer::m_snPPreviousTimeInMilliseconds = v4;
    CTimer::game_FPS = 1000.0 / v3;
    v5 = timerDef.GetTime();
    v6 = (float)(v5 - oldTimerValue);
    v7 = CTimer::ms_fTimeScale * v6;
    v8 = 0.0;
    if ( !__PAIR16__(CTimer::m_CodePause, CTimer::m_UserPause) )
    {
      v6 = CTimer::ms_fTimeScale * v6;
      v8 = v7;
    }
    v9 = v8 / (float)timerDef.millisecondRatio;
    v0.n64_f32[0] = v9 / 20.0;
    v10 = (unsigned int)(float)((float)(v6 / (float)timerDef.millisecondRatio)
                              + (float)CTimer::m_snTimeInMillisecondsPauseMode);
    oldTimerValue = v5;
    v11 = (unsigned int)v9;
    v1.n64_u32[0] = 1008981770;
    if ( (unsigned int)v9 >= 0x12C )
      v11 = 300;
    CTimer::m_snTimeInMilliseconds += v11;
    CTimer::m_snTimeInMillisecondsPauseMode = v10;
    CTimer::m_snTimeInMillisecondsNonClipped = (unsigned int)(float)(v9 + (float)CTimer::m_snTimeInMillisecondsNonClipped);
    CTimer::ms_fTimeStepNonClipped = v9 / 20.0;
    if ( v0.n64_f32[0] < 0.01 && !((CTimer::m_CodePause || CTimer::m_UserPause || CSpecialFX::bSnapShotActive) << 24) )
    {
      v0.n64_u64[0] = v1.n64_u64[0];
      CTimer::ms_fTimeStepNonClipped = 0.01;
    }
    v1.n64_u32[0] = 3.0;
    v2.n64_u32[0] = 925353388;
    CTimer::ms_fOldTimeStep = CTimer::ms_fTimeStep;
    LODWORD(CTimer::ms_fTimeStep) = vmax_f32(vmin_f32(v0, v1), v2).n64_u32[0];
    ++CTimer::m_FrameCounter;
  }
}
// 420DA4: variable 'v1' is possibly undefined
// 420DCE: variable 'v0' is possibly undefined
// 420DDA: variable 'v2' is possibly undefined
// 96B524: using guessed type char gTimerRunning;

//----- (00420E58) --------------------------------------------------------
void __fastcall CTimer::UpdateVariables(float timeElapsed)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  float v4; // s2
  unsigned int v5; // s4
  unsigned int v6; // r4

  v4 = timeElapsed / (float)timerDef.millisecondRatio;
  v1.n64_f32[0] = v4 / 20.0;
  v5 = (unsigned int)(float)(v4 + (float)CTimer::m_snTimeInMillisecondsNonClipped);
  v6 = (unsigned int)v4;
  v2.n64_u32[0] = 1008981770;
  if ( v6 >= 0x12C )
    v6 = 300;
  CTimer::m_snTimeInMilliseconds += v6;
  CTimer::m_snTimeInMillisecondsNonClipped = v5;
  CTimer::ms_fTimeStepNonClipped = v1.n64_f32[0];
  if ( v1.n64_f32[0] < 0.01 && !((CTimer::m_CodePause || CTimer::m_UserPause || CSpecialFX::bSnapShotActive) << 24) )
  {
    v1.n64_u64[0] = v2.n64_u64[0];
    CTimer::ms_fTimeStepNonClipped = 0.01;
  }
  v2.n64_u32[0] = 3.0;
  v3.n64_u32[0] = 925353388;
  CTimer::ms_fOldTimeStep = CTimer::ms_fTimeStep;
  LODWORD(CTimer::ms_fTimeStep) = vmax_f32(vmin_f32(v1, v2), v3).n64_u32[0];
}
// 420EFC: variable 'v2' is possibly undefined
// 420F22: variable 'v1' is possibly undefined
// 420F2A: variable 'v3' is possibly undefined

//----- (00420F64) --------------------------------------------------------
void CTimer::Suspend()
{
  if ( gTimerRunning == 1 && ++gSuspendDepth <= 1 )
    suspendTimerValue = timerDef.GetTime();
}
// 96B524: using guessed type char gTimerRunning;

//----- (00420FAC) --------------------------------------------------------
void CTimer::Resume()
{
  if ( gTimerRunning == 1 && !--gSuspendDepth )
    oldTimerValue += timerDef.GetTime() - suspendTimerValue;
}
// 96B524: using guessed type char gTimerRunning;

//----- (0042100C) --------------------------------------------------------
uint32 CTimer::GetCyclesPerMillisecond()
{
  return timerDef.millisecondRatio;
}

//----- (0042101C) --------------------------------------------------------
uint32 CTimer::GetCyclesPerFrame()
{
  return (unsigned int)(float)((float)timerDef.millisecondRatio * 20.0);
}

//----- (00421040) --------------------------------------------------------
uint32 CTimer::GetCurrentTimeInCycles()
{
  return (unsigned __int64)(OS_TimeAccurate() * 1000000.0) - oldTimerValue;
}

//----- (00421074) --------------------------------------------------------
void CTimer::Stop()
{
  gTimerRunning = 0;
  CTimer::m_snPPPPreviousTimeInMilliseconds = CTimer::m_snTimeInMilliseconds;
  CTimer::m_snPPPreviousTimeInMilliseconds = CTimer::m_snTimeInMilliseconds;
  CTimer::m_snPPreviousTimeInMilliseconds = CTimer::m_snTimeInMilliseconds;
  CTimer::m_snPreviousTimeInMilliseconds = CTimer::m_snTimeInMilliseconds;
  CTimer::m_snPreviousTimeInMillisecondsNonClipped = CTimer::m_snTimeInMillisecondsNonClipped;
}
// 96B524: using guessed type char gTimerRunning;

//----- (004210F4) --------------------------------------------------------
bool CTimer::GetIsSlowMotionActive()
{
  return CTimer::ms_fTimeScale < 1.0;
}

//----- (00421118) --------------------------------------------------------
void CTimer::StartUserPause()
{
  CTimer::m_UserPause = 1;
}

//----- (00421128) --------------------------------------------------------
void CTimer::EndUserPause()
{
  CTimer::m_UserPause = 0;
}

//----- (00421138) --------------------------------------------------------
void __fastcall CPlaceName::CPlaceName(CPlaceName *this)
{
  this->Timer = 0;
  this->pNavZone = 0;
}

//----- (00421140) --------------------------------------------------------
void __fastcall CPlaceName::Init(CPlaceName *this)
{
  this->Timer = 0;
  this->pNavZone = 0;
}

//----- (00421148) --------------------------------------------------------
GxtChar *__fastcall CPlaceName::GetForMap(CPlaceName *this, float x, float y)
{
  CPlayerPed *pPed; // r0
  CMatrix *v6; // r1
  CSimpleTransform *p_m_transform; // r2
  __int64 v8; // d16
  CVehicle *m_pMyVehicle; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v12; // d16
  CZone *SmallestZoneForPosition; // r0
  CVector pPoint; // [sp+4h] [bp-34h] BYREF
  CVector posn; // [sp+10h] [bp-28h] BYREF

  memset(&posn, 0, sizeof(posn));
  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  if ( pPed )
  {
    if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
    {
      m_pMyVehicle = pPed->m_pMyVehicle;
      m_pMat = m_pMyVehicle->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pMyVehicle->m_transform;
      v12 = *(_QWORD *)&p_tx->m_translate.x;
      posn.z = p_tx->m_translate.z;
      *(_QWORD *)&posn.x = v12;
    }
    else
    {
      v6 = pPed->m_pMat;
      p_m_transform = (CSimpleTransform *)&v6->tx;
      if ( !v6 )
        p_m_transform = &pPed->m_transform;
      v8 = *(_QWORD *)&p_m_transform->m_translate.x;
      posn.z = p_m_transform->m_translate.z;
      *(_QWORD *)&posn.x = v8;
      CEntryExitManager::GetPositionRelativeToOutsideWorld(&posn);
    }
  }
  pPoint.x = x;
  pPoint.y = y;
  pPoint.z = posn.z;
  SmallestZoneForPosition = CTheZones::FindSmallestZoneForPosition(&pPoint, 0);
  return CZone::GetTranslatedName(SmallestZoneForPosition);
}

//----- (004211F0) --------------------------------------------------------
void __fastcall CPlaceName::Process(CPlaceName *this)
{
  CPlayerPed *pPed; // r0
  CMatrix *v3; // r1
  CSimpleTransform *p_m_transform; // r2
  __int64 v5; // d16
  CVehicle *m_pMyVehicle; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v9; // d16
  char v10; // r5
  CZone *SmallestZoneForPosition; // r0
  CZone *pNavZone; // r1
  bool v13; // zf
  GxtChar *TranslatedName; // r0
  CVector v15[2]; // [sp+0h] [bp-18h] BYREF

  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    m_pMat = m_pMyVehicle->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pMyVehicle->m_transform;
    v9 = *(_QWORD *)&p_tx->m_translate.x;
    v15[0].z = p_tx->m_translate.z;
    *(_QWORD *)&v15[0].x = v9;
  }
  else
  {
    v3 = pPed->m_pMat;
    p_m_transform = (CSimpleTransform *)&v3->tx;
    if ( !v3 )
      p_m_transform = &pPed->m_transform;
    v5 = *(_QWORD *)&p_m_transform->m_translate.x;
    v15[0].z = p_m_transform->m_translate.z;
    *(_QWORD *)&v15[0].x = v5;
    CEntryExitManager::GetPositionRelativeToOutsideWorld(v15);
  }
  v10 = 0;
  SmallestZoneForPosition = CTheZones::FindSmallestZoneForPosition(v15, 0);
  if ( SmallestZoneForPosition )
  {
    pNavZone = this->pNavZone;
    if ( CGame::currArea == AREA_MAIN_MAP )
      v10 = 1;
    v13 = pNavZone == 0;
    if ( pNavZone )
      v13 = ((SmallestZoneForPosition != this->pNavZone) & (unsigned __int8)v10) == 1;
    if ( !v13 || pNavZone && SmallestZoneForPosition->TextLabel == pNavZone->TextLabel )
    {
      if ( this->Timer )
        --this->Timer;
      SmallestZoneForPosition = pNavZone;
      if ( !pNavZone )
        goto LABEL_20;
LABEL_23:
      TranslatedName = CZone::GetTranslatedName(SmallestZoneForPosition);
      goto LABEL_24;
    }
  }
  else
  {
    this->Timer = 0;
    this->pNavZone = 0;
  }
  this->Timer = 250;
  this->pNavZone = SmallestZoneForPosition;
  if ( SmallestZoneForPosition )
    goto LABEL_23;
LABEL_20:
  TranslatedName = 0;
LABEL_24:
  CHud::SetZoneName(TranslatedName, 0);
}
// 421286: conditional instruction was optimized away because r0.4!=0

//----- (004212D8) --------------------------------------------------------
void __fastcall CPlaceName::Display(CPlaceName *this)
{
  CZone *pNavZone; // r0
  GxtChar *TranslatedName; // r0

  pNavZone = this->pNavZone;
  if ( pNavZone )
  {
    TranslatedName = CZone::GetTranslatedName(pNavZone);
    sub_18A844(TranslatedName, 0);
  }
  else
  {
    sub_18A844(0, 0);
  }
}

//----- (004212F8) --------------------------------------------------------
void __fastcall CPlaceName::ProcessAfterFrontEndShutDown(CPlaceName *this)
{
  CHud::m_pLastZoneName = 0;
  CHud::m_ZoneState = 0;
  this->Timer = 250;
}

//----- (00421318) --------------------------------------------------------
void __fastcall CCurrentVehicle::CCurrentVehicle(CCurrentVehicle *this)
{
  this->pCurrentVehicle = 0;
}

//----- (0042131E) --------------------------------------------------------
void __fastcall CCurrentVehicle::Init(CCurrentVehicle *this)
{
  this->pCurrentVehicle = 0;
}

//----- (00421324) --------------------------------------------------------
void __fastcall CCurrentVehicle::Process(CCurrentVehicle *this)
{
  CPlayerPed *pPed; // r1
  CVehicle *m_pMyVehicle; // r1
  GxtChar *v3; // r0

  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  if ( !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
  {
    this->pCurrentVehicle = 0;
LABEL_6:
    sub_18E460(0);
    return;
  }
  m_pMyVehicle = pPed->m_pMyVehicle;
  this->pCurrentVehicle = m_pMyVehicle;
  if ( !m_pMyVehicle )
    goto LABEL_6;
  v3 = CText::Get(&TheText, &CModelInfo::ms_modelInfoPtrs[m_pMyVehicle->m_nModelIndex][1].m_modelName[10]);
  sub_18E460(v3);
}

//----- (00421390) --------------------------------------------------------
void __fastcall CCurrentVehicle::Display(CCurrentVehicle *this)
{
  CVehicle *pCurrentVehicle; // r0
  GxtChar *v2; // r0

  pCurrentVehicle = this->pCurrentVehicle;
  if ( pCurrentVehicle )
    v2 = CText::Get(&TheText, &CModelInfo::ms_modelInfoPtrs[pCurrentVehicle->m_nModelIndex][1].m_modelName[10]);
  else
    v2 = 0;
  sub_18E460(v2);
}

//----- (004213CC) --------------------------------------------------------
void CUserDisplay::Init()
{
  CUserDisplay::PlaceName.Timer = 0;
  CUserDisplay::PlaceName.pNavZone = 0;
  COnscreenTimer::Init(&CUserDisplay::OnscnTimer);
  CUserDisplay::CurrentVehicle.pCurrentVehicle = 0;
}

//----- (004213FC) --------------------------------------------------------
void CUserDisplay::Process()
{
  CPlayerPed *pPed; // r0
  CVehicle *m_pMyVehicle; // r0
  GxtChar *v2; // r0

  CPlaceName::Process(&CUserDisplay::PlaceName);
  COnscreenTimer::Process(&CUserDisplay::OnscnTimer);
  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  if ( !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
  {
    CUserDisplay::CurrentVehicle.pCurrentVehicle = 0;
LABEL_6:
    sub_18E460(0);
    return;
  }
  m_pMyVehicle = pPed->m_pMyVehicle;
  CUserDisplay::CurrentVehicle.pCurrentVehicle = m_pMyVehicle;
  if ( !m_pMyVehicle )
    goto LABEL_6;
  v2 = CText::Get(&TheText, &CModelInfo::ms_modelInfoPtrs[m_pMyVehicle->m_nModelIndex][1].m_modelName[10]);
  sub_18E460(v2);
}

//----- (004214A0) --------------------------------------------------------
void __fastcall CWanted::Initialise(CWanted *this)
{
  char v1; // r2

  this->m_nChanceOnRoadBlock = 0;
  this->m_fMultiplier = 1.0;
  *(_DWORD *)&this->m_nCopsInPursuit = 0;
  this->m_bTimeCounting = 0;
  this->m_bStoredPoliceBackOff = 0;
  this->m_WantedLevel = WANTED_CLEAN;
  this->m_WantedLevelBeforeParole = WANTED_CLEAN;
  this->m_pCopsInPursuit[8] = 0;
  this->m_pCopsInPursuit[9] = 0;
  v1 = *((_BYTE *)this + 30);
  *(_QWORD *)&this->m_pCopsInPursuit[4] = 0LL;
  *(_QWORD *)&this->m_pCopsInPursuit[6] = 0LL;
  *(_QWORD *)this->m_pCopsInPursuit = 0LL;
  *(_QWORD *)&this->m_pCopsInPursuit[2] = 0LL;
  *(_QWORD *)&this->m_nWantedLevel = 0LL;
  *(_QWORD *)&this->m_LastTimeWantedDecreased = 0LL;
  this->m_TimeOfParole = 0;
  *((_BYTE *)this + 30) = v1 & 0xC0;
  this->CrimesBeingQd[0].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[2].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[1].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[3].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[4].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[5].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[6].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[7].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[8].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[9].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[10].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[11].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[12].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[13].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[14].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[15].CrimeType = CRIME_NONE;
}

//----- (0042151C) --------------------------------------------------------
void __fastcall CWanted::ClearQdCrimes(CWanted *this)
{
  this->CrimesBeingQd[2].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[1].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[3].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[4].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[5].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[6].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[7].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[8].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[9].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[10].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[11].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[12].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[13].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[14].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[15].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[0].CrimeType = CRIME_NONE;
}

//----- (0042155C) --------------------------------------------------------
void CWanted::InitialiseStaticVariables()
{
  CWanted::nMaximumWantedLevel = 9200;
  CWanted::MaximumWantedLevel = WANTED_LEVEL6;
  CWanted::bUseNewsHeliInAdditionToPolice = 0;
}

//----- (0042158C) --------------------------------------------------------
void __fastcall CWanted::Reset(CWanted *this)
{
  char v1; // r2

  this->m_nChanceOnRoadBlock = 0;
  this->m_fMultiplier = 1.0;
  *(_DWORD *)&this->m_nCopsInPursuit = 0;
  this->m_bTimeCounting = 0;
  this->m_bStoredPoliceBackOff = 0;
  this->m_WantedLevel = WANTED_CLEAN;
  this->m_WantedLevelBeforeParole = WANTED_CLEAN;
  this->m_pCopsInPursuit[8] = 0;
  this->m_pCopsInPursuit[9] = 0;
  v1 = *((_BYTE *)this + 30);
  *(_QWORD *)&this->m_pCopsInPursuit[4] = 0LL;
  *(_QWORD *)&this->m_pCopsInPursuit[6] = 0LL;
  *(_QWORD *)this->m_pCopsInPursuit = 0LL;
  *(_QWORD *)&this->m_pCopsInPursuit[2] = 0LL;
  *(_QWORD *)&this->m_nWantedLevel = 0LL;
  *(_QWORD *)&this->m_LastTimeWantedDecreased = 0LL;
  this->m_TimeOfParole = 0;
  *((_BYTE *)this + 30) = v1 & 0xC0;
  this->CrimesBeingQd[0].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[2].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[1].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[3].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[4].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[5].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[6].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[7].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[8].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[9].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[10].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[11].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[12].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[13].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[14].CrimeType = CRIME_NONE;
  this->CrimesBeingQd[15].CrimeType = CRIME_NONE;
}

//----- (0042160C) --------------------------------------------------------
void __fastcall CWanted::Update(CWanted *this)
{
  eWantedLevel m_WantedLevel; // r1
  int m_bTimeCounting; // r0
  uint32 current_chase_time_counter; // r1
  uint32 v5; // r0
  uint32 v6; // r0
  __int16 v7; // r5
  CVehicle *PlayerVehicle; // r0
  int32 m_nWantedLevel; // r1
  int v10; // r0
  int32 v11; // r0
  int i; // r5
  char *v13; // r8
  eCrimeType CrimeType; // r1
  int v15; // r0
  unsigned int v16; // r2
  char v17; // r2
  int v18; // r6
  int v19; // r3
  CCopPed *v20; // r0
  CCopPed *v21; // r5
  uint8 v22; // r1
  unsigned int v23; // r2
  _BOOL4 v24; // r2
  int v25; // r5
  int v26; // r2
  int v27; // r3
  int v28; // r3
  int v29; // r3
  int v30; // r3
  int v31; // r3
  int v32; // r3
  int v33; // r2
  int v34; // r1
  unsigned __int8 v35; // r3
  int32 *v36; // r5
  CCopPed *v37; // r6
  int v38; // r0
  char v39; // r0
  CVector v40[3]; // [sp+0h] [bp-28h] BYREF

  m_WantedLevel = this->m_WantedLevel;
  m_bTimeCounting = this->m_bTimeCounting;
  if ( m_WantedLevel < WANTED_LEVEL5 )
  {
    if ( m_bTimeCounting )
    {
      CStats::SetNewRecordStat(0x33u, (float)this->current_chase_time);
      CStats::SetStatValue(0x34u, (float)this->current_chase_time);
      this->m_bTimeCounting = 0;
    }
  }
  else
  {
    if ( m_bTimeCounting )
    {
      current_chase_time_counter = this->current_chase_time_counter;
      v5 = CTimer::m_snTimeInMilliseconds;
    }
    else
    {
      current_chase_time_counter = CTimer::m_snTimeInMilliseconds;
      this->m_bTimeCounting = 1;
      v5 = current_chase_time_counter;
      this->current_chase_time = 0;
      this->current_chase_time_counter = current_chase_time_counter;
    }
    if ( v5 - current_chase_time_counter > 0x3E8 )
    {
      ++this->current_chase_time;
      this->current_chase_time_counter = v5;
    }
  }
  v6 = CTimer::m_snTimeInMilliseconds;
  if ( CTimer::m_snTimeInMilliseconds > this->m_TimeOfParole + 20000 )
  {
    this->m_WantedLevelBeforeParole = WANTED_CLEAN;
    this->m_nWantedLevelBeforeParole = 0;
  }
  if ( v6 - this->m_LastTimeWantedDecreased > 0x3E8 )
  {
    if ( (v7 = CWeather::WeatherRegion | 4, this->m_WantedLevel >= WANTED_LEVEL2) && (v7 != 4 || CGame::currArea)
      || FindPlayerVehicle(-1, 0)
      && ((PlayerVehicle = FindPlayerVehicle(-1, 0), CVehicle::IsLawEnforcementVehicle(PlayerVehicle))
       || FindPlayerVehicle(-1, 0)->m_vehicleType == 4
       || FindPlayerVehicle(-1, 0)->m_vehicleType == 3) )
    {
      this->m_LastTimeWantedDecreased = CTimer::m_snTimeInMilliseconds;
    }
    else
    {
      FindPlayerCoors(v40, -1);
      if ( !CWanted::WorkOutPolicePresence(v40[0], 18.0) )
      {
        m_nWantedLevel = this->m_nWantedLevel;
        this->m_LastTimeWantedDecreased = CTimer::m_snTimeInMilliseconds;
        v10 = 1;
        if ( v7 == 4 )
          v10 = 2;
        v11 = m_nWantedLevel - v10;
        if ( v11 <= 0 )
          v11 = 0;
        this->m_nWantedLevel = v11;
        CWanted::UpdateWantedLevel(this);
        CGameLogic::SetPlayerWantedLevelForForbiddenTerritories(1);
      }
    }
    for ( i = 0; i != 16; ++i )
    {
      v13 = (char *)this + i * 28;
      CrimeType = this->CrimesBeingQd[i].CrimeType;
      if ( CrimeType )
      {
        v15 = *((_DWORD *)v13 + 15);
        v16 = CTimer::m_snTimeInMilliseconds;
        if ( CTimer::m_snTimeInMilliseconds > v15 + 500 && !v13[76] )
        {
          CWanted::ReportCrimeNow(this, CrimeType, (const CVector *)(v13 + 64), v13[77]);
          v13[76] = 1;
          v15 = *((_DWORD *)v13 + 15);
          v16 = CTimer::m_snTimeInMilliseconds;
        }
        if ( v16 > v15 + 10000 )
          *((_DWORD *)v13 + 13) = 0;
      }
    }
    v17 = 2;
    v18 = 0;
    v19 = 0;
    v20 = this->m_pCopsInPursuit[0];
    v21 = this->m_pCopsInPursuit[1];
    v22 = (unsigned __int8)v20;
    if ( v20 )
      v22 = 1;
    else
      v17 = 1;
    if ( v21 )
      v22 = v17;
    if ( !v20 )
      v18 = 1;
    v23 = (unsigned int)this->m_pCopsInPursuit[1];
    if ( v21 )
      v23 = 1;
    if ( this->m_pCopsInPursuit[2] )
    {
      v24 = v20 == 0;
      if ( !v21 )
        v19 = 1;
      ++v22;
      v25 = v19 | v24;
      v26 = v19 | v24;
    }
    else
    {
      v26 = v23 & v18;
      v25 = 1;
    }
    if ( this->m_pCopsInPursuit[3] )
    {
      v27 = v25;
      if ( v25 )
        v27 = 1;
      ++v22;
      v26 |= v27;
    }
    else
    {
      v25 = 1;
    }
    if ( this->m_pCopsInPursuit[4] )
    {
      v28 = v25;
      if ( v25 )
        v28 = 1;
      ++v22;
      v26 |= v28;
    }
    else
    {
      v25 = 1;
    }
    if ( this->m_pCopsInPursuit[5] )
    {
      v29 = v25;
      if ( v25 )
        v29 = 1;
      ++v22;
      v26 |= v29;
    }
    else
    {
      v25 = 1;
    }
    if ( this->m_pCopsInPursuit[6] )
    {
      v30 = v25;
      if ( v25 )
        v30 = 1;
      ++v22;
      v26 |= v30;
    }
    else
    {
      v25 = 1;
    }
    if ( this->m_pCopsInPursuit[7] )
    {
      v31 = v25;
      if ( v25 )
        v31 = 1;
      ++v22;
      v26 |= v31;
    }
    else
    {
      v25 = 1;
    }
    if ( this->m_pCopsInPursuit[8] )
    {
      v32 = v25;
      if ( v25 )
        v32 = 1;
      ++v22;
      v26 |= v32;
    }
    else
    {
      v25 = 1;
    }
    if ( this->m_pCopsInPursuit[9] )
    {
      ++v22;
      v26 |= v25 != 0;
    }
    if ( v22 != this->m_nCopsInPursuit )
      this->m_nCopsInPursuit = v22;
    if ( v26 == 1 )
    {
      v33 = 1;
      v34 = 0;
      if ( v20 )
        goto LABEL_88;
LABEL_90:
      v35 = v34;
      while ( 1 )
      {
        v36 = &this->m_nWantedLevel + v35;
        v37 = (CCopPed *)v36[125];
        if ( v37 )
          break;
        if ( ++v35 > 9u )
        {
          if ( !(v33 << 24) )
          {
            v33 = 0;
            goto LABEL_88;
          }
          goto LABEL_94;
        }
      }
      v33 = 0;
      this->m_pCopsInPursuit[v34] = v37;
      v36[125] = 0;
LABEL_88:
      while ( (unsigned int)++v34 <= 9 )
      {
        if ( !this->m_pCopsInPursuit[v34] )
          goto LABEL_90;
      }
    }
  }
LABEL_94:
  v38 = *((_BYTE *)this + 30) & 7;
  if ( (*((_BYTE *)this + 30) & 7) != 0 )
    v38 = 1;
  if ( this->m_bStoredPoliceBackOff != v38 )
  {
    CWanted::UpdateWantedLevel(this);
    v39 = *((_BYTE *)this + 30) & 7;
    this->m_bStoredPoliceBackOff = v39 != 0;
  }
}

//----- (0042195C) --------------------------------------------------------
Int32 __fastcall CWanted::WorkOutPolicePresence(CVector Coors, float Radius)
{
  float x; // r10
  float z; // r9
  CPedPool *v5; // r4
  int32 m_nSize; // r5
  float y; // s20
  int v8; // r0
  int v9; // r8
  uint8 *v10; // r6
  int v11; // r0
  float *v12; // r1
  CVehiclePool *v13; // r4
  int32 v14; // r5
  float v15; // s18
  float v16; // s20
  int i; // r6
  CPool<CVehicle,CHeli>::StorageType *m_aStorage; // r9
  uint8 *v19; // r0
  int v20; // r0
  int v21; // r1
  RwReal v23; // [sp+0h] [bp-48h]
  int v24; // [sp+4h] [bp-44h]

  x = Coors.x;
  z = Coors.z;
  v5 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize )
  {
    y = Coors.y;
    v24 = 0;
    v23 = Coors.y;
    do
    {
      v8 = 1996 * m_nSize--;
      v9 = v8 - 560;
      while ( 1 )
      {
        if ( (v5->m_aFlags[m_nSize] & 0x80u) == 0 )
        {
          v10 = &(*v5->m_aStorage)[v9];
          if ( v10 != (uint8 *)&elf_hash_bucket[296]
            && *(_DWORD *)&(*v5->m_aStorage)[v9] == 6
            && CPed::IsAlive((const CPed *)(v10 - 1436)) )
          {
            v11 = *((_DWORD *)v10 - 354);
            v12 = (float *)(v11 + 48);
            if ( !v11 )
              v12 = (float *)(v10 - 1432);
            if ( sqrtf(
                   (float)((float)((float)(x - *v12) * (float)(x - *v12))
                         + (float)((float)(y - v12[1]) * (float)(y - v12[1])))
                 + (float)((float)(z - v12[2]) * (float)(z - v12[2]))) < Radius )
              break;
          }
        }
        --m_nSize;
        v9 -= 1996;
        if ( m_nSize == -1 )
        {
          Coors.y = v23;
          goto LABEL_16;
        }
      }
      Coors.y = v23;
      ++v24;
    }
    while ( m_nSize );
  }
  else
  {
    v24 = 0;
  }
LABEL_16:
  v13 = CPools::ms_pVehiclePool;
  v14 = CPools::ms_pVehiclePool->m_nSize;
  if ( v14 )
  {
    v15 = z;
    v16 = Coors.y;
    do
    {
      for ( i = v14--; ; --i )
      {
        if ( (v13->m_aFlags[v14] & 0x80u) == 0 )
        {
          m_aStorage = v13->m_aStorage;
          v19 = v13->m_aStorage[i];
          if ( v19 != (uint8 *)&elf_hash_bucket[588]
            && (*(v19 - 1536) << 31 || *(_WORD *)&(*m_aStorage)[i * 2604 - 2566] == 497)
            && v19 - 2604 != (uint8 *)FindPlayerVehicle(-1, 0) )
          {
            v20 = (int)&(*m_aStorage)[i * 2604 - 2600];
            if ( (*(_BYTE *)(v20 + 54) & 0xF0) != 32 )
            {
              v21 = *(_DWORD *)(v20 + 16);
              if ( v21 )
                v20 = v21 + 48;
              if ( sqrtf(
                     (float)((float)((float)(x - *(float *)v20) * (float)(x - *(float *)v20))
                           + (float)((float)(v16 - *(float *)(v20 + 4)) * (float)(v16 - *(float *)(v20 + 4))))
                   + (float)((float)(v15 - *(float *)(v20 + 8)) * (float)(v15 - *(float *)(v20 + 8)))) < Radius )
                break;
            }
          }
        }
        if ( --v14 == -1 )
          return v24;
      }
      ++v24;
    }
    while ( v14 );
  }
  return v24;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00421B3C) --------------------------------------------------------
void __fastcall CWanted::UpdateWantedLevel(CWanted *this)
{
  eWantedLevel m_WantedLevel; // r5
  int32 m_nWantedLevel; // r0
  int32 v4; // r1
  uint16 v5; // r0
  uint8 v6; // r1
  uint8 v7; // r3
  eWantedLevel v8; // r2

  m_WantedLevel = this->m_WantedLevel;
  m_nWantedLevel = this->m_nWantedLevel;
  v4 = CWanted::nMaximumWantedLevel;
  if ( m_nWantedLevel > CWanted::nMaximumWantedLevel )
  {
    this->m_nWantedLevel = CWanted::nMaximumWantedLevel;
    m_nWantedLevel = v4;
  }
  if ( m_nWantedLevel < 4600 )
  {
    if ( m_nWantedLevel < 2400 )
    {
      if ( m_nWantedLevel < 1200 )
      {
        if ( m_nWantedLevel < 550 )
        {
          if ( m_nWantedLevel < 180 )
          {
            if ( m_nWantedLevel < 50 )
            {
              if ( m_WantedLevel == WANTED_LEVEL1 )
                CStats::IncrementStat(0x84u, 1.0);
              v8 = WANTED_CLEAN;
              v7 = 0;
              v6 = 0;
              v5 = 0;
            }
            else
            {
              CStats::IncrementStat(0x83u, (float)(1 - m_WantedLevel));
              v5 = 0;
              v8 = WANTED_LEVEL1;
              v7 = 1;
              v6 = 1;
            }
          }
          else
          {
            CStats::IncrementStat(0x83u, (float)(2 - m_WantedLevel));
            v5 = 0;
            v6 = 3;
            v8 = WANTED_LEVEL2;
            v7 = 2;
          }
        }
        else
        {
          CStats::IncrementStat(0x83u, (float)(3 - m_WantedLevel));
          v5 = 12;
          v6 = 4;
          v7 = 2;
          v8 = WANTED_LEVEL3;
        }
      }
      else
      {
        CStats::IncrementStat(0x83u, (float)(4 - m_WantedLevel));
        v5 = 18;
        v6 = 6;
        v7 = 2;
        v8 = WANTED_LEVEL4;
      }
    }
    else
    {
      CStats::IncrementStat(0x83u, (float)(5 - m_WantedLevel));
      v5 = 24;
      v6 = 8;
      v7 = 3;
      v8 = WANTED_LEVEL5;
    }
  }
  else
  {
    CStats::IncrementStat(0x83u, (float)(6 - m_WantedLevel));
    v5 = 30;
    v6 = 10;
    v7 = 3;
    v8 = WANTED_LEVEL6;
  }
  this->m_nMaxCopCarsInPursuit = v7;
  this->m_WantedLevel = v8;
  this->m_nMaxCopsInPursuit = v6;
  this->m_nChanceOnRoadBlock = v5;
  if ( m_WantedLevel != v8 )
    this->m_LastTimeWantedLevelChanged = CTimer::m_snTimeInMilliseconds;
  if ( *((unsigned __int8 *)this + 30) << 29 )
  {
    this->m_nChanceOnRoadBlock = 0;
    *(_WORD *)&this->m_nMaxCopsInPursuit = 0;
  }
}

//----- (00421C80) --------------------------------------------------------
void __fastcall CWanted::UpdateCrimesQ(CWanted *this)
{
  int i; // r5
  char *v3; // r8
  eCrimeType CrimeType; // r1
  int v5; // r0
  unsigned int v6; // r2

  for ( i = 0; i != 16; ++i )
  {
    v3 = (char *)this + i * 28;
    CrimeType = this->CrimesBeingQd[i].CrimeType;
    if ( CrimeType )
    {
      v5 = *((_DWORD *)v3 + 15);
      v6 = CTimer::m_snTimeInMilliseconds;
      if ( CTimer::m_snTimeInMilliseconds > v5 + 500 && !v3[76] )
      {
        CWanted::ReportCrimeNow(this, CrimeType, (const CVector *)(v3 + 64), v3[77]);
        v3[76] = 1;
        v5 = *((_DWORD *)v3 + 15);
        v6 = CTimer::m_snTimeInMilliseconds;
      }
      if ( v6 > v5 + 10000 )
        *((_DWORD *)v3 + 13) = 0;
    }
  }
}

//----- (00421D00) --------------------------------------------------------
void __fastcall CWanted::RegisterCrime(
        CWanted *this,
        eCrimeType CrimeType,
        const CVector *Pos,
        u_native IDKey,
        bool bPoliceDontReallyCare)
{
  CWanted::AddCrimeToQ(this, CrimeType, IDKey, Pos, 0, bPoliceDontReallyCare);
}

//----- (00421D20) --------------------------------------------------------
int __fastcall CWanted::AddCrimeToQ(
        CWanted *this,
        eCrimeType ArgCrimeType,
        u_native ArgCrimeID,
        const CVector *Coors,
        int bArgAlreadyReported,
        bool bArgPoliceDontReallyCare)
{
  int v6; // r6
  eCrimeType CrimeType; // r12
  bool v8; // zf
  eCrimeType v9; // r8
  CCrimeBeingQd *CrimesBeingQd; // lr
  bool v11; // zf
  eCrimeType v12; // r9
  bool v13; // zf
  bool v14; // zf
  bool v15; // zf
  eCrimeType v16; // r6
  bool v17; // zf
  bool v18; // zf
  bool v19; // zf
  eCrimeType v20; // r6
  bool v21; // zf
  bool v22; // zf
  bool v23; // zf
  bool v24; // zf
  bool v25; // zf
  bool v26; // zf
  bool v27; // zf
  bool v28; // zf
  char v29; // r4
  const CVector *v30; // r5
  int v31; // r8
  int v32; // r1
  char *v33; // r1
  int result; // r0
  _BYTE *v35; // r1
  int v36; // t1
  char *v37; // r0
  __int64 v38; // d16
  uint32 v39; // r1
  eCrimeType v40; // [sp+0h] [bp-5Ch]
  eCrimeType v41; // [sp+4h] [bp-58h]
  eCrimeType v42; // [sp+8h] [bp-54h]
  eCrimeType v43; // [sp+Ch] [bp-50h]
  eCrimeType v44; // [sp+10h] [bp-4Ch]
  eCrimeType v45; // [sp+14h] [bp-48h]
  eCrimeType v46; // [sp+18h] [bp-44h]
  eCrimeType v47; // [sp+24h] [bp-38h]
  eCrimeType v48; // [sp+28h] [bp-34h]
  eCrimeType v49; // [sp+34h] [bp-28h]
  eCrimeType v50; // [sp+3Ch] [bp-20h]

  v6 = bArgAlreadyReported;
  CrimeType = this->CrimesBeingQd[0].CrimeType;
  v8 = CrimeType == ArgCrimeType;
  if ( CrimeType == ArgCrimeType )
    v8 = this->CrimesBeingQd[0].CrimeID == ArgCrimeID;
  if ( v8 )
  {
    v32 = 0;
  }
  else
  {
    CrimesBeingQd = &this->CrimesBeingQd[1];
    v9 = this->CrimesBeingQd[1].CrimeType;
    v11 = v9 == ArgCrimeType;
    if ( v9 == ArgCrimeType )
      v11 = this->CrimesBeingQd[1].CrimeID == ArgCrimeID;
    if ( v11 )
    {
      v32 = 1;
    }
    else
    {
      v12 = this->CrimesBeingQd[2].CrimeType;
      v13 = v12 == ArgCrimeType;
      if ( v12 == ArgCrimeType )
        v13 = this->CrimesBeingQd[2].CrimeID == ArgCrimeID;
      if ( v13 )
      {
        v32 = 2;
      }
      else
      {
        v50 = this->CrimesBeingQd[3].CrimeType;
        v14 = v50 == ArgCrimeType;
        if ( v50 == ArgCrimeType )
          v14 = this->CrimesBeingQd[3].CrimeID == ArgCrimeID;
        if ( v14 )
        {
          v32 = 3;
        }
        else
        {
          v49 = this->CrimesBeingQd[4].CrimeType;
          v15 = v49 == ArgCrimeType;
          if ( v49 == ArgCrimeType )
            v15 = this->CrimesBeingQd[4].CrimeID == ArgCrimeID;
          if ( v15 )
          {
            v32 = 4;
          }
          else
          {
            v16 = this->CrimesBeingQd[5].CrimeType;
            v17 = v16 == ArgCrimeType;
            if ( v16 == ArgCrimeType )
              v17 = this->CrimesBeingQd[5].CrimeID == ArgCrimeID;
            if ( v17 )
            {
              v32 = 5;
            }
            else
            {
              v48 = this->CrimesBeingQd[6].CrimeType;
              v18 = v48 == ArgCrimeType;
              if ( v48 == ArgCrimeType )
                v18 = this->CrimesBeingQd[6].CrimeID == ArgCrimeID;
              if ( v18 )
              {
                v32 = 6;
              }
              else
              {
                v47 = this->CrimesBeingQd[7].CrimeType;
                v19 = v47 == ArgCrimeType;
                if ( v47 == ArgCrimeType )
                  v19 = this->CrimesBeingQd[7].CrimeID == ArgCrimeID;
                if ( v19 )
                {
                  v32 = 7;
                }
                else
                {
                  v20 = this->CrimesBeingQd[8].CrimeType;
                  v21 = v20 == ArgCrimeType;
                  if ( v20 == ArgCrimeType )
                    v21 = this->CrimesBeingQd[8].CrimeID == ArgCrimeID;
                  if ( v21 )
                  {
                    v32 = 8;
                  }
                  else
                  {
                    v46 = this->CrimesBeingQd[9].CrimeType;
                    v22 = v46 == ArgCrimeType;
                    if ( v46 == ArgCrimeType )
                      v22 = this->CrimesBeingQd[9].CrimeID == ArgCrimeID;
                    if ( v22 )
                    {
                      v32 = 9;
                    }
                    else
                    {
                      v45 = this->CrimesBeingQd[10].CrimeType;
                      v23 = v45 == ArgCrimeType;
                      if ( v45 == ArgCrimeType )
                        v23 = this->CrimesBeingQd[10].CrimeID == ArgCrimeID;
                      if ( v23 )
                      {
                        v32 = 10;
                      }
                      else
                      {
                        v44 = this->CrimesBeingQd[11].CrimeType;
                        v24 = v44 == ArgCrimeType;
                        if ( v44 == ArgCrimeType )
                          v24 = this->CrimesBeingQd[11].CrimeID == ArgCrimeID;
                        if ( v24 )
                        {
                          v32 = 11;
                        }
                        else
                        {
                          v43 = this->CrimesBeingQd[12].CrimeType;
                          v25 = v43 == ArgCrimeType;
                          if ( v43 == ArgCrimeType )
                            v25 = this->CrimesBeingQd[12].CrimeID == ArgCrimeID;
                          if ( v25 )
                          {
                            v32 = 12;
                          }
                          else
                          {
                            v42 = this->CrimesBeingQd[13].CrimeType;
                            v26 = v42 == ArgCrimeType;
                            if ( v42 == ArgCrimeType )
                              v26 = this->CrimesBeingQd[13].CrimeID == ArgCrimeID;
                            if ( v26 )
                            {
                              v32 = 13;
                            }
                            else
                            {
                              v41 = this->CrimesBeingQd[14].CrimeType;
                              v27 = v41 == ArgCrimeType;
                              if ( v41 == ArgCrimeType )
                                v27 = this->CrimesBeingQd[14].CrimeID == ArgCrimeID;
                              if ( v27 )
                              {
                                v32 = 14;
                              }
                              else
                              {
                                v40 = this->CrimesBeingQd[15].CrimeType;
                                v28 = v40 == ArgCrimeType;
                                if ( v40 == ArgCrimeType )
                                  v28 = this->CrimesBeingQd[15].CrimeID == ArgCrimeID;
                                if ( !v28 )
                                {
                                  if ( CrimeType == CRIME_NONE )
                                  {
                                    v31 = 0;
                                    CrimesBeingQd = this->CrimesBeingQd;
                                    goto LABEL_95;
                                  }
                                  if ( v9 == CRIME_NONE )
                                  {
                                    v31 = 1;
                                    goto LABEL_95;
                                  }
                                  if ( v12 == CRIME_NONE )
                                  {
                                    v31 = 2;
                                    CrimesBeingQd = &this->CrimesBeingQd[2];
                                    goto LABEL_95;
                                  }
                                  if ( v50 == CRIME_NONE )
                                  {
                                    v31 = 3;
                                    CrimesBeingQd = &this->CrimesBeingQd[3];
                                    goto LABEL_95;
                                  }
                                  if ( v49 == CRIME_NONE )
                                  {
                                    v31 = 4;
                                    CrimesBeingQd = &this->CrimesBeingQd[4];
                                    goto LABEL_95;
                                  }
                                  if ( this->CrimesBeingQd[5].CrimeType == CRIME_NONE )
                                  {
                                    v31 = 5;
                                    CrimesBeingQd = &this->CrimesBeingQd[5];
                                    goto LABEL_95;
                                  }
                                  v29 = bArgAlreadyReported;
                                  v30 = Coors;
                                  if ( v48 == CRIME_NONE )
                                  {
                                    v31 = 6;
                                    CrimesBeingQd = &this->CrimesBeingQd[6];
                                    goto LABEL_96;
                                  }
                                  if ( v47 == CRIME_NONE )
                                  {
                                    v31 = 7;
                                    CrimesBeingQd = &this->CrimesBeingQd[7];
                                    goto LABEL_96;
                                  }
                                  if ( v20 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[8];
                                    v31 = 8;
                                    goto LABEL_96;
                                  }
                                  if ( v46 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[9];
                                    v31 = 9;
                                    goto LABEL_96;
                                  }
                                  if ( v45 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[10];
                                    v31 = 10;
                                    goto LABEL_96;
                                  }
                                  if ( v44 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[11];
                                    v31 = 11;
                                    goto LABEL_95;
                                  }
                                  if ( v43 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[12];
                                    v31 = 12;
                                    goto LABEL_95;
                                  }
                                  if ( v42 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[13];
                                    v31 = 13;
                                    goto LABEL_95;
                                  }
                                  if ( v41 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[14];
                                    v31 = 14;
                                    goto LABEL_95;
                                  }
                                  if ( v40 == CRIME_NONE )
                                  {
                                    CrimesBeingQd = &this->CrimesBeingQd[15];
                                    v31 = 15;
LABEL_95:
                                    v29 = bArgAlreadyReported;
                                    v30 = Coors;
LABEL_96:
                                    CrimesBeingQd->CrimeType = ArgCrimeType;
                                    v37 = (char *)this + 28 * v31;
                                    *((_DWORD *)v37 + 14) = ArgCrimeID;
                                    v38 = *(_QWORD *)&v30->x;
                                    *((_DWORD *)v37 + 18) = LODWORD(v30->z);
                                    *((_QWORD *)v37 + 8) = v38;
                                    v39 = CTimer::m_snTimeInMilliseconds;
                                    v37[76] = v29;
                                    *((_DWORD *)v37 + 15) = v39;
                                    v37[77] = bArgPoliceDontReallyCare;
                                  }
                                  return 0;
                                }
                                v32 = 15;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          v6 = bArgAlreadyReported;
        }
      }
    }
  }
  v33 = (char *)this + 28 * v32;
  v36 = (unsigned __int8)v33[76];
  v35 = v33 + 76;
  result = v36;
  if ( v36 )
    return 1;
  if ( v6 )
  {
    *v35 = v6;
    return 0;
  }
  return result;
}

//----- (00422008) --------------------------------------------------------
void __fastcall CWanted::RegisterCrime_Immediately(
        CWanted *this,
        eCrimeType CrimeType,
        const CVector *Pos,
        u_native IDKey,
        bool a5)
{
  if ( !CWanted::AddCrimeToQ(this, CrimeType, IDKey, Pos, 1, a5) )
    CWanted::ReportCrimeNow(this, CrimeType, Pos, a5);
}

//----- (00422048) --------------------------------------------------------
void __fastcall CWanted::ReportCrimeNow(
        CWanted *this,
        eCrimeType CrimeType,
        const CVector *Coors,
        bool bPoliceDontReallyCare)
{
  _BOOL4 v5; // r4
  float m_fMultiplier; // s16
  eWantedLevel m_WantedLevel; // r9
  unsigned __int32 v10; // r5
  _BOOL4 v11; // r0
  int32 v12; // s0
  int32 m_nWantedLevel; // r0
  int32 m_nWantedLevelBeforeParole; // r1

  v5 = bPoliceDontReallyCare;
  if ( !CCheat::m_aCheatsActive[73] )
  {
    m_fMultiplier = this->m_fMultiplier;
    m_WantedLevel = this->m_WantedLevel;
    if ( CDarkel::Status == 1 )
      m_fMultiplier = m_fMultiplier * 0.3;
    if ( m_fMultiplier < 0.0 )
      m_fMultiplier = 0.0;
    v10 = CrimeType - 2;
    if ( CGangWars::GangWarFightingGoingOn() )
      m_fMultiplier = 0.0;
    v11 = CGangWars::GangWarFightingGoingOn();
    if ( v10 >= 0x15 )
    {
      m_nWantedLevel = this->m_nWantedLevel;
    }
    else
    {
      if ( v5 )
        m_fMultiplier = m_fMultiplier * 0.333;
      if ( v11 )
        m_fMultiplier = 0.0;
      v12 = (int)(float)((float)(m_fMultiplier * flt_6179D0[v10]) + (float)this->m_nWantedLevel);
      this->m_nWantedLevel = v12;
      m_nWantedLevel = v12;
    }
    m_nWantedLevelBeforeParole = this->m_nWantedLevelBeforeParole;
    if ( m_nWantedLevel > m_nWantedLevelBeforeParole )
      m_nWantedLevelBeforeParole = m_nWantedLevel;
    this->m_nWantedLevel = m_nWantedLevelBeforeParole;
    CWanted::UpdateWantedLevel(this);
    if ( this->m_WantedLevel > m_WantedLevel )
      j_CAEPoliceScannerAudioEntity::AddAudioEvent(&this->m_PoliceScannerAudioEntity, 164, CrimeType, Coors);
  }
}
// 6179D0: using guessed type float flt_6179D0[24];

//----- (00422150) --------------------------------------------------------
void __fastcall CWanted::SetWantedLevel(CWanted *this, Int32 NewLev)
{
  eWantedLevel v2; // r2

  if ( !CCheat::m_aCheatsActive[73] )
  {
    v2 = CWanted::MaximumWantedLevel;
    this->CrimesBeingQd[2].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[1].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[3].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[4].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[5].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[6].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[7].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[8].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[9].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[10].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[11].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[12].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[13].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[14].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[15].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[0].CrimeType = CRIME_NONE;
    if ( v2 < NewLev )
      NewLev = v2;
    if ( (unsigned int)NewLev <= 6 )
      this->m_nWantedLevel = dword_617A50[NewLev];
    CWanted::UpdateWantedLevel(this);
  }
}
// 617A50: using guessed type _DWORD dword_617A50[7];

//----- (004221C8) --------------------------------------------------------
void __fastcall CWanted::CheatWantedLevel(CWanted *this, Int32 NewLev)
{
  eWantedLevel v3; // r0

  v3 = CWanted::MaximumWantedLevel;
  if ( CWanted::MaximumWantedLevel < NewLev && (unsigned int)NewLev <= 6 )
  {
    CWanted::nMaximumWantedLevel = dword_617A30[NewLev];
    v3 = NewLev;
    CWanted::MaximumWantedLevel = NewLev;
  }
  if ( !CCheat::m_aCheatsActive[73] )
  {
    this->CrimesBeingQd[2].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[1].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[3].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[4].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[5].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[6].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[7].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[8].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[9].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[10].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[11].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[12].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[13].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[14].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[15].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[0].CrimeType = CRIME_NONE;
    if ( v3 < NewLev )
      NewLev = v3;
    if ( (unsigned int)NewLev <= 6 )
      this->m_nWantedLevel = dword_617A50[NewLev];
    CWanted::UpdateWantedLevel(this);
  }
  CWanted::UpdateWantedLevel(this);
}
// 617A30: using guessed type _DWORD dword_617A30[8];
// 617A50: using guessed type _DWORD dword_617A50[7];

//----- (0042227C) --------------------------------------------------------
void __fastcall CWanted::SetMaximumWantedLevel(Int32 NewMaxLev)
{
  if ( (unsigned int)NewMaxLev <= 6 )
  {
    CWanted::nMaximumWantedLevel = dword_617A30[NewMaxLev];
    CWanted::MaximumWantedLevel = NewMaxLev;
  }
}
// 617A30: using guessed type _DWORD dword_617A30[8];

//----- (004222A8) --------------------------------------------------------
void __fastcall CWanted::SetWantedLevelNoDrop(CWanted *this, Int32 NewLev)
{
  eWantedLevel m_WantedLevelBeforeParole; // r0
  Int32 m_WantedLevel; // r2
  __int64 v6; // kr00_8
  int v7; // r1
  eWantedLevel v8; // r1
  eWantedLevel v9; // r0

  v6 = *(_QWORD *)&this->m_WantedLevel;
  m_WantedLevelBeforeParole = this->m_WantedLevelBeforeParole;
  m_WantedLevel = v6;
  v7 = CCheat::m_aCheatsActive[73];
  if ( (int)v6 < m_WantedLevelBeforeParole && !CCheat::m_aCheatsActive[73] )
  {
    v8 = CWanted::MaximumWantedLevel;
    this->CrimesBeingQd[2].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[1].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[3].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[4].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[5].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[6].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[7].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[8].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[9].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[10].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[11].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[12].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[13].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[14].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[15].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[0].CrimeType = CRIME_NONE;
    if ( v8 < m_WantedLevelBeforeParole )
      m_WantedLevelBeforeParole = v8;
    if ( (unsigned int)m_WantedLevelBeforeParole <= WANTED_LEVEL6 )
      this->m_nWantedLevel = dword_617A50[m_WantedLevelBeforeParole];
    CWanted::UpdateWantedLevel(this);
    m_WantedLevel = this->m_WantedLevel;
    v7 = CCheat::m_aCheatsActive[73];
  }
  if ( m_WantedLevel < NewLev && !v7 )
  {
    v9 = CWanted::MaximumWantedLevel;
    this->CrimesBeingQd[2].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[1].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[3].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[4].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[5].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[6].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[7].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[8].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[9].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[10].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[11].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[12].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[13].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[14].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[15].CrimeType = CRIME_NONE;
    this->CrimesBeingQd[0].CrimeType = CRIME_NONE;
    if ( v9 < NewLev )
      NewLev = v9;
    if ( (unsigned int)NewLev <= 6 )
      this->m_nWantedLevel = dword_617A50[NewLev];
    CWanted::UpdateWantedLevel(this);
  }
}
// 617A50: using guessed type _DWORD dword_617A50[7];

//----- (004223B4) --------------------------------------------------------
void __fastcall CWanted::ClearWantedLevelAndGoOnParole(CWanted *this)
{
  eWantedLevel m_WantedLevel; // r0
  UInt32 v3; // r1

  CStats::IncrementStat(0x84u, (float)(unsigned int)this->m_WantedLevel);
  this->m_nWantedLevelBeforeParole = FindPlayerWanted(-1)->m_nWantedLevel;
  m_WantedLevel = FindPlayerWanted(-1)->m_WantedLevel;
  v3 = CTimer::m_snTimeInMilliseconds;
  this->m_nWantedLevel = 0;
  this->m_TimeOfParole = v3;
  this->m_WantedLevel = WANTED_CLEAN;
  this->m_WantedLevelBeforeParole = m_WantedLevel;
}

//----- (004223FC) --------------------------------------------------------
bool __fastcall CWanted::AreMiamiViceRequired(CWanted *this)
{
  return this->m_WantedLevel > WANTED_LEVEL2;
}

//----- (00422408) --------------------------------------------------------
bool __fastcall CWanted::AreSwatRequired(CWanted *this)
{
  _BOOL4 v1; // r0

  if ( this->m_WantedLevel == WANTED_LEVEL4 )
    LOBYTE(v1) = 1;
  else
    return (*((unsigned __int8 *)&dword_1C + (_DWORD)this + 2) >> 3) & 1;
  return v1;
}
// 1C: using guessed type int dword_1C;

//----- (00422418) --------------------------------------------------------
bool __fastcall CWanted::AreFbiRequired(CWanted *this)
{
  _BOOL4 v1; // r0

  if ( this->m_WantedLevel == WANTED_LEVEL5 )
    LOBYTE(v1) = 1;
  else
    return (*((unsigned __int8 *)&dword_1C + (_DWORD)this + 2) >> 4) & 1;
  return v1;
}
// 1C: using guessed type int dword_1C;

//----- (00422428) --------------------------------------------------------
bool __fastcall CWanted::AreArmyRequired(CWanted *this)
{
  _BOOL4 v1; // r0

  if ( this->m_WantedLevel == WANTED_LEVEL6 )
    LOBYTE(v1) = 1;
  else
    return (*((unsigned __int8 *)&dword_1C + (_DWORD)this + 2) >> 5) & 1;
  return v1;
}
// 1C: using guessed type int dword_1C;

//----- (00422438) --------------------------------------------------------
Int32 __fastcall CWanted::NumOfHelisRequired(CWanted *this)
{
  unsigned __int32 v2; // r0

  if ( *((unsigned __int8 *)this + 30) << 29 )
    return 0;
  v2 = this->m_WantedLevel - 3;
  if ( v2 > 3 )
    return 0;
  else
    return dword_422458[v2];
}
// 422458: using guessed type int dword_422458[4];

//----- (00422468) --------------------------------------------------------
bool __fastcall CWanted::CanCopJoinPursuit(const CWanted *this, CCopPed *pCopPed)
{
  bool v3; // r8
  __int64 v5; // d17
  __int64 v6; // d18
  __int64 v7; // d19
  double v8; // d20
  unsigned int m_nMaxCopsInPursuit; // r4
  uint8 m_nCopsInPursuit; // r9
  CCopPed *v11; // r0
  double *p_ppCopsInPursuit; // r0
  __int64 ppCopsInPursuit; // [sp+20h] [bp-48h] BYREF
  __int64 v14; // [sp+28h] [bp-40h] BYREF
  __int64 v15; // [sp+30h] [bp-38h] BYREF
  __int64 v16; // [sp+38h] [bp-30h] BYREF
  double v17[5]; // [sp+40h] [bp-28h] BYREF

  if ( !(*((unsigned __int8 *)this + 30) << 29) )
  {
    v5 = *(_QWORD *)&this->m_pCopsInPursuit[2];
    v3 = 0;
    v6 = *(_QWORD *)&this->m_pCopsInPursuit[4];
    v7 = *(_QWORD *)&this->m_pCopsInPursuit[6];
    v8 = *(double *)&this->m_pCopsInPursuit[8];
    ppCopsInPursuit = *(_QWORD *)this->m_pCopsInPursuit;
    v14 = v5;
    v15 = v6;
    v16 = v7;
    v17[0] = v8;
    m_nMaxCopsInPursuit = this->m_nMaxCopsInPursuit;
    if ( !this->m_nMaxCopsInPursuit )
      return v3;
    m_nCopsInPursuit = this->m_nCopsInPursuit;
    while ( 1 )
    {
      if ( m_nCopsInPursuit < m_nMaxCopsInPursuit )
        return 1;
      v11 = CWanted::ComputePursuitCopToDisplace(pCopPed, (CCopPed **)&ppCopsInPursuit);
      if ( !v11 )
        return 0;
      if ( (CCopPed *)ppCopsInPursuit == v11 )
      {
        p_ppCopsInPursuit = (double *)&ppCopsInPursuit;
        goto LABEL_6;
      }
      if ( (CCopPed *)HIDWORD(ppCopsInPursuit) == v11 )
      {
        p_ppCopsInPursuit = (double *)((char *)&ppCopsInPursuit + 4);
        goto LABEL_6;
      }
      if ( (CCopPed *)v14 == v11 )
      {
        p_ppCopsInPursuit = (double *)&v14;
        goto LABEL_6;
      }
      if ( (CCopPed *)HIDWORD(v14) == v11 )
      {
        p_ppCopsInPursuit = (double *)((char *)&v14 + 4);
        goto LABEL_6;
      }
      if ( (CCopPed *)v15 == v11 )
      {
        p_ppCopsInPursuit = (double *)&v15;
        goto LABEL_6;
      }
      if ( (CCopPed *)HIDWORD(v15) == v11 )
      {
        p_ppCopsInPursuit = (double *)((char *)&v15 + 4);
        goto LABEL_6;
      }
      if ( (CCopPed *)v16 == v11 )
      {
        p_ppCopsInPursuit = (double *)&v16;
        goto LABEL_6;
      }
      if ( (CCopPed *)HIDWORD(v16) == v11 )
        break;
      if ( (CCopPed *)LODWORD(v17[0]) == v11 )
      {
        p_ppCopsInPursuit = v17;
LABEL_6:
        *(_DWORD *)p_ppCopsInPursuit = 0;
        --m_nCopsInPursuit;
      }
      else if ( (CCopPed *)HIDWORD(v17[0]) == v11 )
      {
        p_ppCopsInPursuit = (double *)((char *)v17 + 4);
        goto LABEL_6;
      }
    }
    p_ppCopsInPursuit = (double *)((char *)&v16 + 4);
    goto LABEL_6;
  }
  return 0;
}

//----- (00422574) --------------------------------------------------------
bool __fastcall CWanted::CanCopJoinPursuit(
        CCopPed *pCopPed,
        const uint8 nMaxCopsInPursuit,
        CCopPed **ppCopsInPursuit,
        uint8 *nCopsInPursuit)
{
  unsigned int v4; // r6
  CCopPed **v8; // r10
  CCopPed **v9; // r11
  CCopPed *v10; // r0
  CCopPed **v11; // r1
  CCopPed **v13; // [sp+0h] [bp-38h]
  CCopPed **v14; // [sp+4h] [bp-34h]
  CCopPed **v15; // [sp+8h] [bp-30h]
  CCopPed **v16; // [sp+Ch] [bp-2Ch]
  CCopPed **v17; // [sp+10h] [bp-28h]
  CCopPed **v18; // [sp+14h] [bp-24h]
  CCopPed **v19; // [sp+18h] [bp-20h]

  v4 = nMaxCopsInPursuit;
  if ( nMaxCopsInPursuit )
  {
    if ( (unsigned int)*nCopsInPursuit < nMaxCopsInPursuit )
      return 1;
    v13 = ppCopsInPursuit + 9;
    v14 = ppCopsInPursuit + 8;
    v15 = ppCopsInPursuit + 7;
    v16 = ppCopsInPursuit + 6;
    v8 = ppCopsInPursuit + 2;
    v9 = ppCopsInPursuit + 1;
    v17 = ppCopsInPursuit + 5;
    v18 = ppCopsInPursuit + 4;
    v19 = ppCopsInPursuit + 3;
    while ( 1 )
    {
      v10 = CWanted::ComputePursuitCopToDisplace(pCopPed, ppCopsInPursuit);
      if ( !v10 )
        break;
      v11 = ppCopsInPursuit;
      if ( *ppCopsInPursuit == v10 )
        goto LABEL_15;
      v11 = ppCopsInPursuit + 1;
      if ( *v9 == v10 )
        goto LABEL_15;
      v11 = ppCopsInPursuit + 2;
      if ( *v8 == v10
        || (v11 = v19, *v19 == v10)
        || (v11 = v18, *v18 == v10)
        || (v11 = v17, *v17 == v10)
        || (v11 = v16, *v16 == v10)
        || (v11 = v15, *v15 == v10)
        || (v11 = v14, *v14 == v10)
        || (v11 = v13, *v13 == v10) )
      {
LABEL_15:
        *v11 = 0;
        --*nCopsInPursuit;
      }
      if ( *nCopsInPursuit < v4 )
        return 1;
    }
  }
  return 0;
}

//----- (00422660) --------------------------------------------------------
CCopPed *__fastcall CWanted::ComputePursuitCopToDisplace(CCopPed *pCopPed, CCopPed **ppCopsInPursuit)
{
  float32x2_t v2; // d8
  float32x2_t v5; // d0
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v8; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float v11; // s16
  CCopPed *v12; // r8
  int v13; // r0
  int v14; // r6
  CCopPed *v15; // r0
  CPlayerPed *v16; // r0
  CCopPed *v17; // r1
  CMatrix *v18; // r2
  CMatrix *v19; // r3
  CSimpleTransform *p_m_transform; // r5
  CSimpleTransform *v21; // r0
  float32x2_t v22; // d16
  unsigned __int64 v23; // d1

  v2.n64_u32[0] = 1.0;
  v5.n64_u64[0] = v2.n64_u64[0];
  if ( pCopPed )
  {
    PlayerPed = FindPlayerPed(-1);
    m_pMat = pCopPed->m_pMat;
    v8 = PlayerPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pCopPed->m_transform;
    p_x = &v8->tx;
    if ( !v8 )
      p_x = &PlayerPed->m_transform.m_translate.x;
    v5.n64_f32[0] = (float)((float)((float)(*p_x - p_tx->m_translate.x) * (float)(*p_x - p_tx->m_translate.x))
                          + (float)((float)(p_x[1] - p_tx->m_translate.y) * (float)(p_x[1] - p_tx->m_translate.y)))
                  + (float)((float)(p_x[2] - p_tx->m_translate.z) * (float)(p_x[2] - p_tx->m_translate.z));
  }
  LODWORD(v11) = vmax_f32(v5, v2).n64_u32[0];
  v12 = 0;
  v13 = 0;
  while ( 1 )
  {
    v14 = v13;
    v15 = ppCopsInPursuit[v13];
    if ( v15 )
      break;
LABEL_16:
    v13 = v14 + 1;
    if ( v14 >= 9 )
      return v12;
  }
  if ( CPed::IsAlive(v15) )
  {
    v16 = FindPlayerPed(-1);
    v17 = ppCopsInPursuit[v14];
    v18 = v16->m_pMat;
    v19 = v17->m_pMat;
    p_m_transform = (CSimpleTransform *)&v18->tx;
    if ( !v18 )
      p_m_transform = &v16->m_transform;
    v21 = (CSimpleTransform *)&v19->tx;
    if ( !v19 )
      v21 = &v17->m_transform;
    v22.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&v21->m_translate.y).n64_u64[0];
    v23 = vmul_f32(v22, v22).n64_u64[0];
    if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - v21->m_translate.x)
                               * (float)(p_m_transform->m_translate.x - v21->m_translate.x))
                       + *(float *)&v23)
               + *((float *)&v23 + 1)) > v11 )
    {
      v11 = (float)((float)((float)(p_m_transform->m_translate.x - v21->m_translate.x)
                          * (float)(p_m_transform->m_translate.x - v21->m_translate.x))
                  + *(float *)&v23)
          + *((float *)&v23 + 1);
      v12 = ppCopsInPursuit[v14];
    }
    goto LABEL_16;
  }
  return ppCopsInPursuit[v14];
}
// 422676: variable 'v2' is possibly undefined

//----- (00422760) --------------------------------------------------------
void __fastcall CWanted::RemovePursuitCop(CCopPed *pCopPed, CCopPed **ppCopsInPursuit, uint8 *nCopsInPursuit)
{
  CCopPed *v3; // r3
  CCopPed **v4; // r12
  bool v5; // zf
  CCopPed *v6; // r3
  bool v7; // zf
  CCopPed *v8; // r3
  bool v9; // zf
  CCopPed *v10; // r3
  bool v11; // zf

  if ( *ppCopsInPursuit == pCopPed )
  {
    v4 = ppCopsInPursuit;
LABEL_17:
    *v4 = 0;
    --*nCopsInPursuit;
    return;
  }
  v4 = ppCopsInPursuit + 1;
  v3 = ppCopsInPursuit[1];
  v5 = v3 == pCopPed;
  if ( v3 != pCopPed )
  {
    v4 = ppCopsInPursuit + 2;
    v5 = ppCopsInPursuit[2] == pCopPed;
  }
  if ( v5 )
    goto LABEL_17;
  v4 = ppCopsInPursuit + 3;
  v6 = ppCopsInPursuit[3];
  v7 = v6 == pCopPed;
  if ( v6 != pCopPed )
  {
    v4 = ppCopsInPursuit + 4;
    v7 = ppCopsInPursuit[4] == pCopPed;
  }
  if ( v7 )
    goto LABEL_17;
  v4 = ppCopsInPursuit + 5;
  v8 = ppCopsInPursuit[5];
  v9 = v8 == pCopPed;
  if ( v8 != pCopPed )
  {
    v4 = ppCopsInPursuit + 6;
    v9 = ppCopsInPursuit[6] == pCopPed;
  }
  if ( v9 )
    goto LABEL_17;
  v4 = ppCopsInPursuit + 7;
  v10 = ppCopsInPursuit[7];
  v11 = v10 == pCopPed;
  if ( v10 != pCopPed )
  {
    v4 = ppCopsInPursuit + 8;
    v11 = ppCopsInPursuit[8] == pCopPed;
  }
  if ( v11 )
    goto LABEL_17;
  v4 = ppCopsInPursuit + 9;
  if ( ppCopsInPursuit[9] == pCopPed )
    goto LABEL_17;
}

//----- (004227E0) --------------------------------------------------------
bool __fastcall CWanted::IsClosestCop(const CWanted *this, CPed *pPed, const int iClosest)
{
  unsigned __int64 v3; // d0
  float32x2_t v4; // d2
  int v6; // r6
  CCopPed *v7; // r1
  CCopPed *v8; // r1
  CCopPed *v9; // r1
  CCopPed *v10; // r1
  CCopPed *v11; // r1
  CCopPed *v12; // r1
  CCopPed *v13; // r1
  CCopPed *v14; // r1
  CCopPed *v15; // r0
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r2
  float *p_tx; // r1
  int *v19; // r0
  float v20; // s0
  float v21; // s2
  int v22; // r2
  float v23; // s4
  float *v24; // r1
  int v25; // r3
  int v26; // t1
  int v27; // r5
  float *v28; // r4
  bool result; // r0
  int v30; // r2
  float32x2_t v31; // d1
  unsigned __int32 *v32; // r4
  int v33; // r5
  int v34; // r3
  bool v35; // nf
  int v36; // r0
  _QWORD v38[4]; // [sp+8h] [bp-98h] BYREF
  int v39; // [sp+28h] [bp-78h]
  int v40; // [sp+2Ch] [bp-74h]
  int v41[11]; // [sp+30h] [bp-70h] BYREF
  int v42[17]; // [sp+5Ch] [bp-44h] BYREF

  if ( this->m_pCopsInPursuit[0] )
  {
    v42[0] = (int)this->m_pCopsInPursuit[0];
    v6 = 1;
  }
  else
  {
    v6 = 0;
  }
  v7 = this->m_pCopsInPursuit[1];
  if ( v7 )
    v42[v6++] = (int)v7;
  v8 = this->m_pCopsInPursuit[2];
  if ( v8 )
    v42[v6++] = (int)v8;
  v9 = this->m_pCopsInPursuit[3];
  if ( v9 )
    v42[v6++] = (int)v9;
  v10 = this->m_pCopsInPursuit[4];
  if ( v10 )
    v42[v6++] = (int)v10;
  v11 = this->m_pCopsInPursuit[5];
  if ( v11 )
    v42[v6++] = (int)v11;
  v12 = this->m_pCopsInPursuit[6];
  if ( v12 )
    v42[v6++] = (int)v12;
  v13 = this->m_pCopsInPursuit[7];
  if ( v13 )
    v42[v6++] = (int)v13;
  v14 = this->m_pCopsInPursuit[8];
  if ( v14 )
    v42[v6++] = (int)v14;
  v15 = this->m_pCopsInPursuit[9];
  if ( v15 )
    v42[v6++] = (int)v15;
  memset(v41, 0, 40);
  v38[0] = 0x7F7FFFFF7F7FFFFFLL;
  v38[1] = 0x7F7FFFFF7F7FFFFFLL;
  v38[2] = 0x7F7FFFFF7F7FFFFFLL;
  v38[3] = 0x7F7FFFFF7F7FFFFFLL;
  v39 = 2139095039;
  v40 = 2139095039;
  PlayerPed = FindPlayerPed(-1);
  m_pMat = PlayerPed->m_pMat;
  p_tx = &m_pMat->tx;
  if ( !m_pMat )
    p_tx = &PlayerPed->m_transform.m_translate.x;
  if ( v6 > 0 )
  {
    v19 = v42;
    v20 = *p_tx;
    v21 = p_tx[1];
    v22 = v6;
    v23 = p_tx[2];
    v24 = (float *)v38;
    do
    {
      v26 = *v19++;
      v25 = v26;
      v27 = *(_DWORD *)(v26 + 20);
      v28 = (float *)(v27 + 48);
      if ( !v27 )
        v28 = (float *)(v25 + 4);
      --v22;
      *v24++ = (float)((float)((float)(v20 - *v28) * (float)(v20 - *v28))
                     + (float)((float)(v21 - v28[1]) * (float)(v21 - v28[1])))
             + (float)((float)(v23 - v28[2]) * (float)(v23 - v28[2]));
    }
    while ( v22 );
  }
  result = 0;
  if ( iClosest >= 1 )
  {
    LODWORD(v3) = 2139095039;
    v30 = 0;
    do
    {
      if ( v6 >= 1 )
      {
        v31.n64_u64[0] = v3;
        v32 = (unsigned __int32 *)v38;
        v33 = 0;
        v34 = -1;
        do
        {
          v4.n64_u32[0] = *v32++;
          v35 = v4.n64_f32[0] < v31.n64_f32[0];
          v31.n64_u64[0] = vmin_f32(v4, v31).n64_u64[0];
          if ( v35 )
            v34 = v33;
          ++v33;
        }
        while ( v6 != v33 );
        if ( v34 != -1 )
        {
          v41[v30] = v42[v34];
          v42[v34] = 0;
          *((_DWORD *)v38 + v34) = 2139095039;
        }
      }
      ++v30;
    }
    while ( v30 != iClosest );
    v36 = 0;
    while ( (CPed *)v41[v36] != pPed )
    {
      if ( ++v36 >= iClosest )
        return 0;
    }
    return 1;
  }
  return result;
}
// 4229A4: conditional instruction was optimized away because r8.4>=1
// 42295C: variable 'v3' is possibly undefined
// 422976: variable 'v4' is possibly undefined
// 4227E0: using guessed type int var_44[17];

//----- (004229E4) --------------------------------------------------------
bool __fastcall CWanted::SetPursuitCop(CWanted *this, CCopPed *pCopPed)
{
  unsigned int m_nCopsInPursuit; // r0
  CCopPed **m_pCopsInPursuit; // r6
  CCopPed *v6; // r0
  CCopPed **v7; // r1

  if ( !CWanted::CanCopJoinPursuit(this, pCopPed) )
    return 0;
  m_nCopsInPursuit = this->m_nCopsInPursuit;
  m_pCopsInPursuit = this->m_pCopsInPursuit;
  if ( m_nCopsInPursuit >= this->m_nMaxCopsInPursuit )
  {
    do
    {
      v6 = CWanted::ComputePursuitCopToDisplace(pCopPed, this->m_pCopsInPursuit);
      v7 = this->m_pCopsInPursuit;
      if ( *m_pCopsInPursuit == v6 )
        goto LABEL_14;
      v7 = &this->m_pCopsInPursuit[1];
      if ( this->m_pCopsInPursuit[1] == v6 )
        goto LABEL_14;
      v7 = &this->m_pCopsInPursuit[2];
      if ( this->m_pCopsInPursuit[2] == v6
        || (v7 = &this->m_pCopsInPursuit[3], this->m_pCopsInPursuit[3] == v6)
        || (v7 = &this->m_pCopsInPursuit[4], this->m_pCopsInPursuit[4] == v6)
        || (v7 = &this->m_pCopsInPursuit[5], this->m_pCopsInPursuit[5] == v6)
        || (v7 = &this->m_pCopsInPursuit[6], this->m_pCopsInPursuit[6] == v6)
        || (v7 = &this->m_pCopsInPursuit[7], this->m_pCopsInPursuit[7] == v6)
        || (v7 = &this->m_pCopsInPursuit[8], this->m_pCopsInPursuit[8] == v6)
        || (v7 = &this->m_pCopsInPursuit[9], this->m_pCopsInPursuit[9] == v6) )
      {
LABEL_14:
        *v7 = 0;
        LOBYTE(m_nCopsInPursuit) = this->m_nCopsInPursuit - 1;
        this->m_nCopsInPursuit = m_nCopsInPursuit;
      }
      else
      {
        LOBYTE(m_nCopsInPursuit) = this->m_nCopsInPursuit;
      }
    }
    while ( (unsigned __int8)m_nCopsInPursuit >= (unsigned int)this->m_nMaxCopsInPursuit );
  }
  if ( !*m_pCopsInPursuit )
    goto LABEL_36;
  if ( !this->m_pCopsInPursuit[1] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[1];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[2] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[2];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[3] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[3];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[4] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[4];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[5] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[5];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[6] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[6];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[7] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[7];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[8] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[8];
    goto LABEL_36;
  }
  if ( !this->m_pCopsInPursuit[9] )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[9];
LABEL_36:
    this->m_nCopsInPursuit = m_nCopsInPursuit + 1;
    *m_pCopsInPursuit = pCopPed;
  }
  return 1;
}

//----- (00422B4A) --------------------------------------------------------
void __fastcall CWanted::RemovePursuitCop(CWanted *this, CCopPed *pCopPed)
{
  CCopPed **m_pCopsInPursuit; // r1

  if ( this->m_pCopsInPursuit[0] == pCopPed )
  {
    m_pCopsInPursuit = this->m_pCopsInPursuit;
  }
  else if ( this->m_pCopsInPursuit[1] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[1];
  }
  else if ( this->m_pCopsInPursuit[2] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[2];
  }
  else if ( this->m_pCopsInPursuit[3] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[3];
  }
  else if ( this->m_pCopsInPursuit[4] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[4];
  }
  else if ( this->m_pCopsInPursuit[5] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[5];
  }
  else if ( this->m_pCopsInPursuit[6] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[6];
  }
  else if ( this->m_pCopsInPursuit[7] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[7];
  }
  else if ( this->m_pCopsInPursuit[8] == pCopPed )
  {
    m_pCopsInPursuit = &this->m_pCopsInPursuit[8];
  }
  else
  {
    if ( this->m_pCopsInPursuit[9] != pCopPed )
      return;
    m_pCopsInPursuit = &this->m_pCopsInPursuit[9];
  }
  *m_pCopsInPursuit = 0;
  --this->m_nCopsInPursuit;
}

//----- (00422BE2) --------------------------------------------------------
bool __fastcall CWanted::IsInPursuit(CWanted *this, CCopPed *pCopPed)
{
  CCopPed *v2; // r2
  bool v3; // zf
  CCopPed *v4; // r2
  bool v5; // zf
  CCopPed *v6; // r2
  bool v7; // zf
  CCopPed *v8; // r2
  bool v9; // zf

  if ( this->m_pCopsInPursuit[0] == pCopPed )
    return 1;
  v2 = this->m_pCopsInPursuit[1];
  v3 = v2 == pCopPed;
  if ( v2 != pCopPed )
    v3 = this->m_pCopsInPursuit[2] == pCopPed;
  if ( v3 )
    return 1;
  v4 = this->m_pCopsInPursuit[3];
  v5 = v4 == pCopPed;
  if ( v4 != pCopPed )
    v5 = this->m_pCopsInPursuit[4] == pCopPed;
  if ( v5 )
    return 1;
  v6 = this->m_pCopsInPursuit[5];
  v7 = v6 == pCopPed;
  if ( v6 != pCopPed )
    v7 = this->m_pCopsInPursuit[6] == pCopPed;
  if ( v7 )
    return 1;
  v8 = this->m_pCopsInPursuit[7];
  v9 = v8 == pCopPed;
  if ( v8 != pCopPed )
    v9 = this->m_pCopsInPursuit[8] == pCopPed;
  return v9 || this->m_pCopsInPursuit[9] == pCopPed;
}

//----- (00422C3C) --------------------------------------------------------
void __fastcall CWanted::RemoveExcessPursuitCops(CWanted *this)
{
  CCopPed **v2; // r9
  CCopPed **v3; // r10
  CCopPed **m_pCopsInPursuit; // r11
  float v5; // s18
  CCopPed *v6; // r6
  int v7; // r0
  int v8; // r8
  const CPed *v9; // r0
  CPlayerPed *PlayerPed; // r0
  int v11; // r1
  CMatrix *m_pMat; // r2
  int v13; // r3
  CSimpleTransform *p_tx; // r5
  int v15; // r0
  float32x2_t v16; // d16
  unsigned __int64 v17; // d1
  CCopPed **v18; // r0
  uint8 m_nCopsInPursuit; // r0
  CCopPed **v20; // [sp+4h] [bp-4Ch]
  CCopPed **v21; // [sp+8h] [bp-48h]
  CCopPed **v22; // [sp+Ch] [bp-44h]
  CCopPed **v23; // [sp+10h] [bp-40h]
  CCopPed **v24; // [sp+14h] [bp-3Ch]
  CCopPed **v25; // [sp+18h] [bp-38h]
  CCopPed **v26; // [sp+1Ch] [bp-34h]

  if ( this->m_nCopsInPursuit <= (unsigned int)this->m_nMaxCopsInPursuit )
    return;
  v20 = &this->m_pCopsInPursuit[9];
  v21 = &this->m_pCopsInPursuit[8];
  v22 = &this->m_pCopsInPursuit[7];
  v23 = &this->m_pCopsInPursuit[6];
  v2 = &this->m_pCopsInPursuit[2];
  v3 = &this->m_pCopsInPursuit[1];
  m_pCopsInPursuit = this->m_pCopsInPursuit;
  v24 = &this->m_pCopsInPursuit[5];
  v25 = &this->m_pCopsInPursuit[4];
  v26 = &this->m_pCopsInPursuit[3];
  do
  {
    v5 = 1.0;
    v6 = 0;
    v7 = 125;
    while ( 1 )
    {
      v8 = v7;
      v9 = (const CPed *)*(&this->m_nWantedLevel + v7);
      if ( v9 )
        break;
LABEL_12:
      v7 = v8 + 1;
      if ( v8 - 125 >= 9 )
        goto LABEL_15;
    }
    if ( CPed::IsAlive(v9) )
    {
      PlayerPed = FindPlayerPed(-1);
      v11 = *(&this->m_nWantedLevel + v8);
      m_pMat = PlayerPed->m_pMat;
      v13 = *(_DWORD *)(v11 + 20);
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &PlayerPed->m_transform;
      v15 = v13 + 48;
      if ( !v13 )
        v15 = v11 + 4;
      v16.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)(v15 + 4)).n64_u64[0];
      v17 = vmul_f32(v16, v16).n64_u64[0];
      if ( (float)((float)((float)((float)(p_tx->m_translate.x - *(float *)v15)
                                 * (float)(p_tx->m_translate.x - *(float *)v15))
                         + *(float *)&v17)
                 + *((float *)&v17 + 1)) > v5 )
      {
        v5 = (float)((float)((float)(p_tx->m_translate.x - *(float *)v15) * (float)(p_tx->m_translate.x - *(float *)v15))
                   + *(float *)&v17)
           + *((float *)&v17 + 1);
        v6 = (CCopPed *)*(&this->m_nWantedLevel + v8);
      }
      goto LABEL_12;
    }
    v6 = (CCopPed *)*(&this->m_nWantedLevel + v8);
LABEL_15:
    v18 = this->m_pCopsInPursuit;
    if ( *m_pCopsInPursuit == v6 )
      goto LABEL_26;
    v18 = &this->m_pCopsInPursuit[1];
    if ( *v3 == v6 )
      goto LABEL_26;
    v18 = &this->m_pCopsInPursuit[2];
    if ( *v2 == v6
      || (v18 = v26, *v26 == v6)
      || (v18 = v25, *v25 == v6)
      || (v18 = v24, *v24 == v6)
      || (v18 = v23, *v23 == v6)
      || (v18 = v22, *v22 == v6)
      || (v18 = v21, *v21 == v6)
      || (v18 = v20, *v20 == v6) )
    {
LABEL_26:
      *v18 = 0;
      m_nCopsInPursuit = this->m_nCopsInPursuit - 1;
      this->m_nCopsInPursuit = m_nCopsInPursuit;
    }
    else
    {
      m_nCopsInPursuit = this->m_nCopsInPursuit;
    }
  }
  while ( m_nCopsInPursuit > (unsigned int)this->m_nMaxCopsInPursuit );
}

//----- (00422DB0) --------------------------------------------------------
void CWanted::UpdateEachFrame()
{
  CWanted *PlayerWanted; // r0

  PlayerWanted = FindPlayerWanted(-1);
  if ( *((unsigned __int8 *)PlayerWanted + 30) << 29 || (unsigned int)(PlayerWanted->m_WantedLevel - 3) >= 4 )
    CWanted::bUseNewsHeliInAdditionToPolice = 1;
}

//----- (00422DDC) --------------------------------------------------------
void CWorld::ResetLineTestOptions()
{
  CWorld::bIncludeCarTyres = 0;
  CWorld::bIncludeDeadPeds = 0;
  CWorld::bIncludeBikers = 0;
  CWorld::pIgnoreEntity = 0;
  CWorld::fWeaponSpreadRate = 0.0;
}

//----- (00422E28) --------------------------------------------------------
void CWorld::Initialise()
{
  CWorld::bNoMoreCollisionTorque = 0;
  CWorld::bDoingCarCollisions = 0;
  CWorld::bProcessCutsceneOnly = 0;
  CWorld::bIncludeBikers = 0;
  CWorld::bForceProcessControl = 0;
  CWorld::bIncludeDeadPeds = 0;
  CWorld::bSecondShift = 0;
  CWorld::pIgnoreEntity = 0;
  CWorld::fWeaponSpreadRate = 0.0;
  CWorld::bIncludeCarTyres = 0;
  sub_196B20();
}

//----- (00422EC4) --------------------------------------------------------
void CWorld::ShutDown()
{
  int i; // r9
  CPtrNode *m_pHead; // r6
  CPtrNode v2; // r4
  int j; // r9
  CPtrNode *m_pNext; // r6
  CPtrNode v5; // kr00_8
  CPtrNode *v6; // r6
  CPtrNode v7; // r4
  CPtrNode *v8; // r5
  CPtrNode v9; // kr08_8
  int k; // r11
  CPtrNode *v11; // r6
  CPtrNode v12; // kr10_8
  CSector *v13; // r5
  CPtrNode *v14; // r4
  CPtrListDoubleLink *p_m_dummyPtrListArray; // r5
  CPtrNode *v16; // t1
  CPtrNode v17; // kr18_8
  int v18; // r5
  CPtrListDoubleLink *v19; // r4
  int v20; // r9
  int v21; // r6

  CIplStore::Shutdown();
  for ( i = 0; i != 900; ++i )
  {
    m_pHead = CWorld::ms_aLodPtrLists[i].m_pHead;
    if ( m_pHead )
    {
      do
      {
        v2 = *m_pHead;
        (*(void (__fastcall **)(void *))(*(_DWORD *)m_pHead->m_pVoid + 16))(m_pHead->m_pVoid);
        if ( (unsigned __int8)((*((_BYTE *)v2.m_pVoid + 58) & 7) - 2) <= 2u )
          CPhysical::RemoveFromMovingList((CPhysical *)v2.m_pVoid);
        if ( m_pHead->m_pVoid )
          (*(void (__fastcall **)(void *))(*(_DWORD *)m_pHead->m_pVoid + 4))(m_pHead->m_pVoid);
        m_pHead = v2.m_pNext;
      }
      while ( v2.m_pNext );
    }
  }
  for ( j = 0; j != 256; ++j )
  {
    m_pNext = CWorld::ms_aRepeatSectors[j].m_ptrListArray[0].m_pHead;
    if ( m_pNext )
    {
      do
      {
        v5 = *m_pNext;
        (*(void (__fastcall **)(void *))(*(_DWORD *)m_pNext->m_pVoid + 16))(m_pNext->m_pVoid);
        if ( (unsigned __int8)((*((_BYTE *)v5.m_pVoid + 58) & 7) - 2) <= 2u )
          CPhysical::RemoveFromMovingList((CPhysical *)v5.m_pVoid);
        if ( m_pNext->m_pVoid )
          (*(void (__fastcall **)(void *))(*(_DWORD *)m_pNext->m_pVoid + 4))(m_pNext->m_pVoid);
        m_pNext = v5.m_pNext;
      }
      while ( v5.m_pNext );
    }
    v6 = CWorld::ms_aRepeatSectors[j].m_ptrListArray[1].m_pHead;
    if ( v6 )
    {
      do
      {
        v7 = *v6;
        (*(void (__fastcall **)(void *))(*(_DWORD *)v6->m_pVoid + 16))(v6->m_pVoid);
        if ( (unsigned __int8)((*((_BYTE *)v7.m_pVoid + 58) & 7) - 2) <= 2u )
          CPhysical::RemoveFromMovingList((CPhysical *)v7.m_pVoid);
        if ( v6->m_pVoid )
          (*(void (__fastcall **)(void *))(*(_DWORD *)v6->m_pVoid + 4))(v6->m_pVoid);
        v6 = v7.m_pNext;
      }
      while ( v7.m_pNext );
    }
    v8 = CWorld::ms_aRepeatSectors[j].m_ptrListArray[2].m_pHead;
    if ( v8 )
    {
      do
      {
        v9 = *v8;
        (*(void (__fastcall **)(void *))(*(_DWORD *)v8->m_pVoid + 16))(v8->m_pVoid);
        if ( (unsigned __int8)((*((_BYTE *)v9.m_pVoid + 58) & 7) - 2) <= 2u )
          CPhysical::RemoveFromMovingList((CPhysical *)v9.m_pVoid);
        if ( v8->m_pVoid )
          (*(void (__fastcall **)(void *))(*(_DWORD *)v8->m_pVoid + 4))(v8->m_pVoid);
        v8 = v9.m_pNext;
      }
      while ( v9.m_pNext );
    }
  }
  for ( k = 0; k != 14400; ++k )
  {
    v11 = CWorld::ms_aSectors[k].m_buildingPtrListArray.m_pHead;
    if ( v11 )
    {
      do
      {
        v12 = *v11;
        (*(void (__fastcall **)(void *))(*(_DWORD *)v11->m_pVoid + 16))(v11->m_pVoid);
        if ( (unsigned __int8)((*((_BYTE *)v12.m_pVoid + 58) & 7) - 2) <= 2u )
          CPhysical::RemoveFromMovingList((CPhysical *)v12.m_pVoid);
        if ( v11->m_pVoid )
          (*(void (__fastcall **)(void *))(*(_DWORD *)v11->m_pVoid + 4))(v11->m_pVoid);
        v11 = v12.m_pNext;
      }
      while ( v12.m_pNext );
    }
    v13 = &CWorld::ms_aSectors[k];
    v16 = v13->m_dummyPtrListArray.m_pHead;
    p_m_dummyPtrListArray = &v13->m_dummyPtrListArray;
    v14 = v16;
    if ( v16 )
    {
      do
      {
        v17 = *v14;
        (*(void (__fastcall **)(void *))(*(_DWORD *)v14->m_pVoid + 16))(v14->m_pVoid);
        if ( (unsigned __int8)((*((_BYTE *)v17.m_pVoid + 58) & 7) - 2) <= 2u )
          CPhysical::RemoveFromMovingList((CPhysical *)v17.m_pVoid);
        if ( v14->m_pVoid )
          (*(void (__fastcall **)(void *))(*(_DWORD *)v14->m_pVoid + 4))(v14->m_pVoid);
        v14 = v17.m_pNext;
      }
      while ( v17.m_pNext );
    }
    CPtrListSingleLink::Flush(&CWorld::ms_aSectors[k].m_buildingPtrListArray);
    CPtrListDoubleLink::Flush(p_m_dummyPtrListArray);
  }
  v18 = -14400;
  v19 = &CWorld::ms_aSectors[0].m_dummyPtrListArray;
  do
  {
    if ( v19[-1].m_pHead )
    {
      sprintf(gString, "Building overlap list %d,%d not empty\n", (v18 + 14400) % 120, (v18 + 14400) / 0x78u);
      CPtrListSingleLink::Flush((CPtrListSingleLink *)&v19[-1]);
    }
    if ( v19->m_pHead )
    {
      sprintf(gString, "Dummy overlap list %d,%d not empty\n", (v18 + 14400) % 120, (v18 + 14400) / 0x78u);
      CPtrListDoubleLink::Flush(v19);
    }
    v19 += 2;
    ++v18;
  }
  while ( v18 );
  v20 = 0;
  v21 = 0;
  do
  {
    if ( CWorld::ms_aRepeatSectors[v20].m_ptrListArray[0].m_pHead )
    {
      sprintf(gString, "Vehicle overlap list %d,%d not empty\n", v21 % 120, v21 / 0x78u);
      CPtrListDoubleLink::Flush(CWorld::ms_aRepeatSectors[v20].m_ptrListArray);
    }
    if ( CWorld::ms_aRepeatSectors[v20].m_ptrListArray[1].m_pHead )
    {
      sprintf(gString, "Ped overlap list %d,%d not empty\n", v21 % 120, v21 / 0x78u);
      CPtrListDoubleLink::Flush(&CWorld::ms_aRepeatSectors[v20].m_ptrListArray[1]);
    }
    if ( CWorld::ms_aRepeatSectors[v20].m_ptrListArray[2].m_pHead )
    {
      sprintf(gString, "Object overlap list %d,%d not empty\n", v21 % 120, v21 / 0x78u);
      CPtrListDoubleLink::Flush(&CWorld::ms_aRepeatSectors[v20].m_ptrListArray[2]);
    }
    ++v20;
    ++v21;
  }
  while ( v20 != 256 );
  CPtrListDoubleLink::Flush(&CWorld::ms_listMovingEntityPtrs);
  CPtrListDoubleLink::Flush(&CWorld::ms_listObjectsWithControlCode);
  CPlayerPedData::DeAllocateData(&CWorld::Players[0].PlayerPedData);
  sub_197284(&CWorld::Players[1].PlayerPedData);
}

//----- (0042330C) --------------------------------------------------------
void __fastcall CWorld::Remove(CEntity *pEntity)
{
  (*((void (__fastcall **)(CEntity *))pEntity->_vptr$CPlaceable + 4))(pEntity);
  if ( (unsigned __int8)((*(_BYTE *)&pEntity->m_info & 7) - 2) <= 2u )
    sub_18E984((CPhysical *)pEntity);
}

//----- (00423338) --------------------------------------------------------
void CWorld::ClearForRestart()
{
  int i; // r11
  CPtrNode *m_pHead; // r6
  CPtrNode v2; // r4
  CPtrNode *m_pNext; // r5
  CPtrNode v4; // kr00_8

  if ( CCutsceneMgr::ms_cutsceneLoadStatus == 2 )
    CCutsceneMgr::DeleteCutsceneData();
  CProjectileInfo::RemoveAllProjectiles();
  CObject::DeleteAllTempObjects();
  CObject::DeleteAllMissionObjects();
  CPopulation::ConvertAllObjectsToDummyObjects();
  for ( i = 0; i != 256; ++i )
  {
    m_pHead = CWorld::ms_aRepeatSectors[i].m_ptrListArray[1].m_pHead;
    if ( m_pHead )
    {
      do
      {
        v2 = *m_pHead;
        (*(void (__fastcall **)(void *))(*(_DWORD *