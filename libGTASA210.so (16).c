rmals[1].z));
    if ( v12 < 0.0 )
      v11 = 1;
    if ( v10 >= 0.0 )
      result = 1;
    result &= v11;
    if ( !result )
    {
      v13 = segmentplane_normals[2].x;
      v14 = segmentplane_normals[2].z;
      v15 = y * segmentplane_normals[2].y;
      v16 = 0;
      v17 = (float)((float)(x * v13) + v15) + (float)(z * v14);
      v18 = segmentplane_ds[2];
      v19 = 0;
      v20 = v18 + v17;
      if ( v20 < 0.0 )
        v19 = 1;
      if ( v12 >= 0.0 )
        v16 = 1;
      if ( (v16 & v19) != 0 )
      {
        return 2;
      }
      else
      {
        v21 = result;
        if ( v9 < 0.0 )
          v21 = 3;
        if ( v20 >= 0.0 )
          return v21;
      }
    }
  }
  return result;
}
// 4AE3A4: conditional instruction was optimized away because r1.4==0

//----- (004AE3C0) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxCentre(
        const float fHeight,
        CEntity *entity,
        CVector *vCentre)
{
  RwReal v5; // s2
  CVector v6; // [sp+0h] [bp-38h] BYREF
  float v7; // [sp+Ch] [bp-2Ch]
  float v8; // [sp+10h] [bp-28h]
  float v9; // [sp+18h] [bp-20h]
  float v10; // [sp+1Ch] [bp-1Ch]
  float v11; // [sp+24h] [bp-14h]
  float v12; // [sp+28h] [bp-10h]

  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(fHeight, entity, &v6);
  vCentre->z = fHeight;
  v5 = (float)((float)((float)((float)(v6.y + 0.0) + v8) + v10) + v12) * 0.25;
  vCentre->x = (float)((float)((float)((float)(v6.x + 0.0) + v7) + v9) + v11) * 0.25;
  vCentre->y = v5;
}

//----- (004AE434) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxCentreUncachedAll(
        float fHeight,
        CEntity *entity,
        CVector *vCentre)
{
  RwReal v5; // s2
  CVector v6; // [sp+0h] [bp-38h] BYREF
  float v7; // [sp+Ch] [bp-2Ch]
  float v8; // [sp+10h] [bp-28h]
  float v9; // [sp+18h] [bp-20h]
  float v10; // [sp+1Ch] [bp-1Ch]
  float v11; // [sp+24h] [bp-14h]
  float v12; // [sp+28h] [bp-10h]

  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(fHeight, entity, &v6);
  vCentre->z = fHeight;
  v5 = (float)((float)((float)((float)(v6.y + 0.0) + v8) + v10) + v12) * 0.25;
  vCentre->x = (float)((float)((float)((float)(v6.x + 0.0) + v7) + v9) + v11) * 0.25;
  vCentre->y = v5;
}

//----- (004AE4AC) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxCentreUncached(
        const float fHeight,
        const CVector *corners,
        CVector *vCentre)
{
  RwReal v3; // s2
  RwReal v4; // s0
  RwReal v5; // s2
  RwReal v6; // s0
  RwReal v7; // s2
  RwReal v8; // s0
  RwReal v9; // s2
  float y; // s4

  vCentre->x = 0.0;
  vCentre->y = 0.0;
  vCentre->z = fHeight;
  v3 = corners->x + 0.0;
  vCentre->x = v3;
  v4 = corners->y + 0.0;
  vCentre->y = v4;
  v5 = corners[1].x + v3;
  vCentre->x = v5;
  v6 = corners[1].y + v4;
  vCentre->y = v6;
  v7 = corners[2].x + v5;
  vCentre->x = v7;
  v8 = corners[2].y + v6;
  vCentre->y = v8;
  v9 = corners[3].x + v7;
  vCentre->x = v9;
  y = corners[3].y;
  vCentre->x = v9 * 0.25;
  vCentre->y = (float)(y + v8) * 0.25;
}

//----- (004AE530) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(
        const float fHeight,
        CEntity *entity,
        CVector *corners)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  float32x2_t v7; // d4
  float32x2_t v8; // d5
  float32x2_t v9; // d6
  float32x2_t v10; // d9
  float32x2_t v11; // d10
  float32x2_t v12; // d11
  float32x2_t v13; // d12
  CVector *v16; // r5
  CMatrix *m_pMat; // r10
  CColModel *m_pColModel; // r0
  CCollisionData *m_pColData; // r6
  int m_nNoOfBoxes; // r1
  bool v21; // zf
  float v22; // s30
  float v23; // s17
  float32x2_t v24; // d14
  int v25; // r4
  float32x2_t v26; // d13
  int v27; // r5
  unsigned __int32 *v28; // r0
  int v29; // r8
  int v30; // r9
  int v31; // r0
  __int64 v32; // d16
  float v33; // s4
  int v34; // r0
  __int64 v35; // d16
  float v36; // s4
  float *v37; // r0
  float xx; // s17
  float v39; // s26
  float yz; // s27
  float v41; // s22
  float yy; // s23
  float v43; // s24
  float xz; // s25
  float v45; // s20
  float xy; // s21
  float v47; // s18
  float yx; // s19
  float v49; // s28
  float v50; // s1
  float v51; // s22
  float v52; // s20
  float v53; // s18
  float v54; // s6
  float v55; // s0
  __int64 v56; // kr00_8
  float v57; // s24
  float v58; // s26
  float v59; // s4
  float v60; // s2
  float v61; // s10
  float v62; // s6
  float v63; // s0
  float v64; // s8
  float v65; // s12
  float v66; // s8
  float v67; // s1
  float v68; // s9
  float v69; // s14
  float v70; // s11
  float v71; // s4
  float v72; // s10
  float v73; // s6
  float v74; // s12
  float v75; // s3
  float v76; // s1
  float v77; // s5
  __int64 v78; // kr08_8
  float v79; // s24
  float v80; // s26
  float v81; // s10
  float v82; // s6
  float v83; // s8
  float v84; // s12
  float v85; // s1
  float v86; // s9
  float v87; // s11
  __int64 v88; // kr10_8
  float x; // s24
  float y; // s26
  float v91; // s10
  float v92; // s5
  float v93; // s6
  float v94; // s8
  float v95; // s7
  float v96; // s12
  float v97; // s9
  float v98; // s8
  float v99; // s14
  float v100; // s3
  float v101; // s14
  float v102; // s8
  float v103; // s10
  float v104; // s12
  float v105; // s6
  float v106; // s4
  float v107; // s2
  float v108; // s0
  CVector *v110; // [sp+4h] [bp-9Ch]
  CVector v111; // [sp+8h] [bp-98h] BYREF
  CVector v; // [sp+18h] [bp-88h] BYREF
  CVector v113; // [sp+28h] [bp-78h] BYREF
  CVector v114; // [sp+34h] [bp-6Ch] BYREF

  v16 = corners;
  if ( (*(_BYTE *)&entity->m_info & 7) == 1
    && (*((_BYTE *)&entity->m_nFlags + 2) & 0x40) != 0
    && InteriorManager_c::GetBoundingBox(&g_interiorMan, entity, corners) )
  {
    v16[1].z = fHeight;
    v16->z = fHeight;
    v16[2].z = fHeight;
  }
  else
  {
    m_pMat = entity->m_pMat;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(entity);
      CSimpleTransform::UpdateMatrix(&entity->m_transform, entity->m_pMat);
      m_pMat = entity->m_pMat;
    }
    m_pColModel = CModelInfo::ms_modelInfoPtrs[entity->m_nModelIndex]->m_pColModel;
    v11.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMin.z);
    v10.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMax.z);
    if ( (float)(v10.n64_f32[0] - v11.n64_f32[0]) <= 6.0 )
      goto LABEL_20;
    m_pColData = m_pColModel->m_pColData;
    if ( !m_pColData || (*(_BYTE *)&entity->m_info & 7) != 4 )
      goto LABEL_20;
    m_nNoOfBoxes = m_pColData->m_nNoOfBoxes;
    v21 = m_nNoOfBoxes == 0;
    if ( !m_pColData->m_nNoOfBoxes )
      v21 = m_pColData->m_nNoOfSpheres == 0;
    if ( !v21 )
    {
      v110 = v16;
      v22 = fHeight + 1.0;
      v23 = fHeight + -1.0;
      if ( m_nNoOfBoxes < 1 )
      {
        v12.n64_u32[0] = 2139095039;
        v13.n64_u32[0] = -8388609;
        v26.n64_u64[0] = v12.n64_u64[0];
        v24.n64_u64[0] = v13.n64_u64[0];
        v10.n64_u64[0] = v13.n64_u64[0];
        v11.n64_u64[0] = v12.n64_u64[0];
      }
      else
      {
        v10.n64_u32[0] = -8388609;
        v11.n64_u32[0] = 2139095039;
        v24.n64_u64[0] = v10.n64_u64[0];
        v25 = 0;
        v26.n64_u64[0] = v11.n64_u64[0];
        v27 = 12;
        v12.n64_u64[0] = v11.n64_u64[0];
        v13.n64_u64[0] = v10.n64_u64[0];
        do
        {
          CVector::FromMultiply(&v114, m_pMat, (const CVector *)((char *)m_pColData->m_pBoxArray + v27 - 12));
          CVector::FromMultiply(&v113, m_pMat, (const CVector *)((char *)&m_pColData->m_pBoxArray->m_vecMin + v27));
          if ( v114.z >= v23 && v114.z <= v22 )
          {
            v28 = (unsigned __int32 *)((char *)m_pColData->m_pBoxArray + v27);
            v3.n64_u32[0] = *(v28 - 3);
            v4.n64_u32[0] = *(v28 - 2);
            v5.n64_u32[0] = *(v28 - 1);
            v12.n64_u64[0] = vmin_f32(v12, v3).n64_u64[0];
            v6.n64_u32[0] = *v28;
            v26.n64_u64[0] = vmin_f32(v26, v4).n64_u64[0];
            v7.n64_u32[0] = v28[1];
            v11.n64_u64[0] = vmin_f32(v11, v5).n64_u64[0];
            v8.n64_u32[0] = v28[2];
            v13.n64_u64[0] = vmax_f32(v13, v6).n64_u64[0];
            v24.n64_u64[0] = vmax_f32(v24, v7).n64_u64[0];
            v10.n64_u64[0] = vmax_f32(v10, v8).n64_u64[0];
          }
          ++v25;
          v27 += 28;
        }
        while ( v25 < m_pColData->m_nNoOfBoxes );
      }
      if ( m_pColData->m_nNoOfSpheres >= 1 )
      {
        v29 = 0;
        v30 = 12;
        do
        {
          v31 = (int)m_pColData->m_pSphereArray + v30;
          v32 = *(_QWORD *)(v31 - 12);
          v.z = *(RwReal *)(v31 - 4);
          *(_QWORD *)&v.x = v32;
          v33 = *(float *)((char *)&m_pColData->m_pSphereArray->m_vecCentre.x + v30);
          v.x = *(float *)&v32 - v33;
          v.y = *((float *)&v32 + 1) - v33;
          v.z = v.z - v33;
          v34 = (int)m_pColData->m_pSphereArray + v30;
          v35 = *(_QWORD *)(v34 - 12);
          v111.z = *(RwReal *)(v34 - 4);
          *(_QWORD *)&v111.x = v35;
          v36 = *(float *)((char *)&m_pColData->m_pSphereArray->m_vecCentre.x + v30);
          v111.x = v36 + *(float *)&v35;
          v111.y = v36 + *((float *)&v35 + 1);
          v111.z = v36 + v111.z;
          CVector::FromMultiply(&v114, m_pMat, &v);
          CVector::FromMultiply(&v113, m_pMat, &v111);
          if ( v114.z >= v23 && v114.z <= v22 )
          {
            v37 = (float *)((char *)&m_pColData->m_pSphereArray->m_vecCentre.x + v30);
            v3.n64_f32[0] = *(v37 - 3);
            v4.n64_f32[0] = *(v37 - 2);
            v5.n64_f32[0] = *(v37 - 1);
            v9.n64_f32[0] = v3.n64_f32[0] + *v37;
            v8.n64_f32[0] = *v37 + v4.n64_f32[0];
            v7.n64_f32[0] = *v37 + v5.n64_f32[0];
            v5.n64_f32[0] = v5.n64_f32[0] - *v37;
            v4.n64_f32[0] = v4.n64_f32[0] - *v37;
            v3.n64_f32[0] = v3.n64_f32[0] - *v37;
            v13.n64_u64[0] = vmax_f32(v13, v9).n64_u64[0];
            v24.n64_u64[0] = vmax_f32(v24, v8).n64_u64[0];
            v10.n64_u64[0] = vmax_f32(v10, v7).n64_u64[0];
            v11.n64_u64[0] = vmin_f32(v11, v5).n64_u64[0];
            v26.n64_u64[0] = vmin_f32(v26, v4).n64_u64[0];
            v12.n64_u64[0] = vmin_f32(v12, v3).n64_u64[0];
          }
          ++v29;
          v30 += 20;
        }
        while ( v29 < m_pColData->m_nNoOfSpheres );
      }
      v16 = v110;
    }
    else
    {
LABEL_20:
      v12.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMin.x);
      v26.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMin.y);
      v13.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMax.x);
      v24.n64_u32[0] = LODWORD(m_pColModel->m_boxBound.m_vecMax.y);
    }
    xx = m_pMat->xx;
    v39 = v26.n64_f32[0] - CPedGeometryAnalyser::ms_fPedNominalRadius;
    yz = m_pMat->yz;
    v41 = v12.n64_f32[0] - CPedGeometryAnalyser::ms_fPedNominalRadius;
    yy = m_pMat->yy;
    v43 = v13.n64_f32[0] + CPedGeometryAnalyser::ms_fPedNominalRadius;
    xz = m_pMat->xz;
    v45 = v11.n64_f32[0] - CPedGeometryAnalyser::ms_fPedNominalRadius;
    xy = m_pMat->xy;
    v47 = v10.n64_f32[0] + CPedGeometryAnalyser::ms_fPedNominalRadius;
    yx = m_pMat->yx;
    v49 = v24.n64_f32[0] + CPedGeometryAnalyser::ms_fPedNominalRadius;
    v114.y = (float)(v49 + v39) * 0.5;
    v114.x = (float)(v43 + v41) * 0.5;
    v114.z = (float)(v47 + v45) * 0.5;
    CVector::FromMultiply(&v113, m_pMat, &v114);
    v50 = v47 - v45;
    v51 = (float)(v43 - v41) * 0.5;
    v52 = (float)(v49 - v39) * 0.5;
    v53 = v50 * 0.5;
    v55 = (float)(v52 * (float)((float)(xy * xy) + (float)(yy * yy)))
        + (float)(v52 * (float)((float)(xy * xy) + (float)(yy * yy)));
    if ( (float)((float)(v51 * (float)((float)(xx * xx) + (float)(yx * yx)))
               + (float)(v51 * (float)((float)(xx * xx) + (float)(yx * yx)))) <= v55 )
    {
      v54 = (float)(v50 * 0.5) * (float)((float)(xz * xz) + (float)(yz * yz));
      if ( v55 <= (float)(v54 + v54) )
      {
        *(_QWORD *)&v.x = *(_QWORD *)&m_pMat->xz;
        v88 = *(_QWORD *)&v.x;
        v.z = 0.0;
        x = v113.x;
        y = v113.y;
        CVector::Normalise(&v);
        v60 = v.y;
        v91 = m_pMat->yy;
        v92 = v53 * *((float *)&v88 + 1);
        v93 = m_pMat->yx;
        v63 = v.x;
        v94 = m_pMat->xy;
        v95 = v53 * *(float *)&v88;
        v96 = v.x * v94;
        v66 = v.y * v94;
        v53 = v52;
        v85 = (float)(v93 * v.x) - (float)(v.y * m_pMat->xx);
        v97 = (float)(v.y * v91) + v96;
        v69 = v.x * v91;
        v87 = (float)(v.y * v93) + (float)(v.x * m_pMat->xx);
        v71 = y - v92;
        v72 = v92 + y;
        v73 = x - v95;
        v74 = v95 + x;
        v75 = v52 * v97;
      }
      else
      {
        *(_QWORD *)&v.x = *(_QWORD *)&m_pMat->xy;
        v78 = *(_QWORD *)&v.x;
        v.z = 0.0;
        v79 = v113.x;
        v80 = v113.y;
        CVector::Normalise(&v);
        v60 = v.y;
        v81 = m_pMat->yz;
        v82 = m_pMat->yx;
        v63 = v.x;
        v83 = m_pMat->xz;
        v84 = v.x * v83;
        v66 = v.y * v83;
        v85 = (float)(v82 * v.x) - (float)(v.y * m_pMat->xx);
        v86 = (float)(v.y * v81) + v84;
        v69 = v.x * v81;
        v87 = (float)(v.y * v82) + (float)(v.x * m_pMat->xx);
        v71 = v80 - (float)(v52 * *((float *)&v78 + 1));
        v72 = (float)(v52 * *((float *)&v78 + 1)) + v80;
        v73 = v79 - (float)(v52 * *(float *)&v78);
        v74 = (float)(v52 * *(float *)&v78) + v79;
        v75 = v53 * v86;
      }
      v76 = v51 * v85;
      v77 = v51 * v87;
    }
    else
    {
      *(_QWORD *)&v.x = *(_QWORD *)&m_pMat->xx;
      v56 = *(_QWORD *)&v.x;
      v.z = 0.0;
      v57 = v113.x;
      v58 = v113.y;
      CVector::Normalise(&v);
      v59 = m_pMat->xy;
      v60 = v.y;
      v61 = m_pMat->yz;
      v62 = m_pMat->yy;
      v63 = v.x;
      v64 = m_pMat->xz;
      v65 = v.x * v64;
      v66 = v.y * v64;
      v67 = (float)(v62 * v.x) - (float)(v.y * v59);
      v68 = (float)(v.y * v61) + v65;
      v69 = v.x * v61;
      v70 = (float)(v.y * v62) + (float)(v.x * v59);
      v71 = v58 - (float)(v51 * *((float *)&v56 + 1));
      v72 = (float)(v51 * *((float *)&v56 + 1)) + v58;
      v73 = v57 - (float)(v51 * *(float *)&v56);
      v74 = (float)(v51 * *(float *)&v56) + v57;
      v75 = v53 * v68;
      v76 = v52 * v67;
      v77 = v52 * v70;
    }
    v98 = v69 - v66;
    v99 = fabsf(v77) + fabsf(v75);
    v100 = v60 * v99;
    v101 = v63 * v99;
    v102 = fabsf(v53 * v98) + fabsf(v76);
    v103 = v72 + v100;
    v104 = v74 + v101;
    v105 = v73 - v101;
    v106 = v71 - v100;
    v107 = v60 * v102;
    v108 = v63 * v102;
    v16->x = v104 - v107;
    v16->y = v103 + v108;
    v16->z = fHeight;
    v16[1].x = v105 - v107;
    v16[1].y = v108 + v106;
    v16[1].z = fHeight;
    v16[2].x = v107 + v105;
    v16[2].y = v106 - v108;
    v16[2].z = fHeight;
    v16[3].x = v107 + v104;
    v16[3].y = v103 - v108;
  }
  v16[3].z = fHeight;
  return 1;
}
// 4AE608: variable 'v10' is possibly undefined
// 4AE60E: variable 'v11' is possibly undefined
// 4AE678: variable 'v3' is possibly undefined
// 4AE680: variable 'v4' is possibly undefined
// 4AE688: variable 'v5' is possibly undefined
// 4AE690: variable 'v6' is possibly undefined
// 4AE694: variable 'v7' is possibly undefined
// 4AE698: variable 'v8' is possibly undefined
// 4AE6C4: variable 'v12' is possibly undefined
// 4AE6C8: variable 'v13' is possibly undefined
// 4AE7DA: variable 'v9' is possibly undefined

//----- (004AEB38) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanes(
        const float fHeight,
        CEntity *entity,
        CVector *out_normals,
        float *out_ds)
{
  _BOOL4 v6; // r0
  CVector v7[5]; // [sp+0h] [bp-40h] BYREF

  v6 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(fHeight, entity, v7);
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(*(const float *)&v6, v7, out_normals, out_ds);
}

//----- (004AEB60) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncachedAll(
        const float fHeight,
        CEntity *entity,
        CVector *out_normals,
        float *out_ds)
{
  _BOOL4 v6; // r0
  CVector v7[5]; // [sp+0h] [bp-40h] BYREF

  v6 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(fHeight, entity, v7);
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(*(const float *)&v6, v7, out_normals, out_ds);
}

//----- (004AEB88) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(
        const float fHeight,
        const CVector *in_corners,
        CVector *out_normals,
        float *out_ds)
{
  float x; // s16
  float y; // s18
  RwReal v9; // s0
  float z; // s20
  RwReal v11; // s4
  float v12; // r0
  float v13; // s0
  float v14; // s18
  float v15; // s20
  RwReal v16; // s0
  float v17; // s22
  RwReal v18; // s4
  float v19; // r0
  float v20; // s0
  float v21; // s18
  float v22; // s20
  RwReal v23; // s0
  float v24; // s22
  RwReal v25; // s4
  float v26; // r0
  float v27; // s0
  float v28; // s18
  float v29; // s20
  RwReal v30; // s0
  float v31; // s22
  RwReal v32; // s4
  float v33; // r0
  float v34; // s0
  CVector v35; // [sp+4h] [bp-44h] BYREF

  x = in_corners[3].x;
  y = in_corners[3].y;
  v9 = in_corners->x - x;
  z = in_corners[3].z;
  v11 = in_corners->z - z;
  v35.y = in_corners->y - y;
  v35.x = v9;
  v35.z = v11;
  CVector::Normalise(&v35);
  v12 = v35.y;
  v13 = v35.x;
  out_normals->z = 0.0;
  out_normals->x = v12;
  out_normals->y = -v13;
  *out_ds = -(float)((float)(z * 0.0) + (float)((float)(x * v12) - (float)(y * v13)));
  v14 = in_corners->x;
  v15 = in_corners->y;
  v16 = in_corners[1].x - in_corners->x;
  v17 = in_corners->z;
  v18 = in_corners[1].z - v17;
  v35.y = in_corners[1].y - v15;
  v35.x = v16;
  v35.z = v18;
  CVector::Normalise(&v35);
  v19 = v35.y;
  v20 = v35.x;
  out_normals[1].z = 0.0;
  out_normals[1].x = v19;
  out_normals[1].y = -v20;
  out_ds[1] = -(float)((float)(v17 * 0.0) + (float)((float)(v14 * v19) - (float)(v15 * v20)));
  v21 = in_corners[1].x;
  v22 = in_corners[1].y;
  v23 = in_corners[2].x - v21;
  v24 = in_corners[1].z;
  v25 = in_corners[2].z - v24;
  v35.y = in_corners[2].y - v22;
  v35.x = v23;
  v35.z = v25;
  CVector::Normalise(&v35);
  v26 = v35.y;
  v27 = v35.x;
  out_normals[2].z = 0.0;
  out_normals[2].x = v26;
  out_normals[2].y = -v27;
  out_ds[2] = -(float)((float)(v24 * 0.0) + (float)((float)(v21 * v26) - (float)(v22 * v27)));
  v28 = in_corners[2].x;
  v29 = in_corners[2].y;
  v30 = in_corners[3].x - v28;
  v31 = in_corners[2].z;
  v32 = in_corners[3].z - v31;
  v35.y = in_corners[3].y - v29;
  v35.x = v30;
  v35.z = v32;
  CVector::Normalise(&v35);
  v33 = v35.y;
  v34 = v35.x;
  out_normals[3].z = 0.0;
  out_normals[3].x = v33;
  out_normals[3].y = -v34;
  out_ds[3] = -(float)((float)(v31 * 0.0) + (float)((float)(v28 * v33) - (float)(v29 * v34)));
}

//----- (004AED60) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxSegmentPlanesUncachedAll(
        const float fHeight,
        CEntity *entity,
        CVector *normals,
        float *ds)
{
  float y; // s4
  float x; // s2
  float v8; // s10
  float v9; // s8
  float v10; // s12
  float v11; // s6
  float v12; // s14
  float v13; // s1
  float v14; // s3
  float v15; // s7
  float v16; // s10
  float v17; // s12
  CVector v18; // [sp+0h] [bp-38h] BYREF
  float v19; // [sp+Ch] [bp-2Ch]
  float v20; // [sp+10h] [bp-28h]
  float v21; // [sp+14h] [bp-24h]
  float v22; // [sp+18h] [bp-20h]
  float v23; // [sp+1Ch] [bp-1Ch]
  float v24; // [sp+20h] [bp-18h]
  float v25; // [sp+24h] [bp-14h]
  float v26; // [sp+28h] [bp-10h]
  float v27; // [sp+2Ch] [bp-Ch]

  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(fHeight, entity, &v18);
  y = v18.y;
  x = v18.x;
  v8 = v18.y + 0.0;
  v9 = v20;
  v10 = v18.x + 0.0;
  v11 = v19;
  v12 = v23;
  v13 = v22;
  v14 = v26;
  v15 = v25;
  normals->z = 0.0;
  v16 = (float)((float)((float)(v8 + v9) + v12) + v14) * 0.25;
  v17 = (float)((float)((float)(v10 + v11) + v13) + v15) * 0.25;
  normals->x = -(float)(y - v16);
  normals->y = x - v17;
  *ds = -(float)((float)((float)((float)(x - v17) * y) - (float)(x * (float)(y - v16))) + (float)(v18.z * 0.0));
  normals[1].z = 0.0;
  normals[1].x = -(float)(v9 - v16);
  normals[1].y = v11 - v17;
  ds[1] = -(float)((float)((float)((float)(v11 - v17) * v9) - (float)(v11 * (float)(v9 - v16))) + (float)(v21 * 0.0));
  normals[2].z = 0.0;
  normals[2].x = -(float)(v12 - v16);
  normals[2].y = v13 - v17;
  ds[2] = -(float)((float)((float)((float)(v13 - v17) * v12) - (float)(v13 * (float)(v12 - v16))) + (float)(v24 * 0.0));
  normals[3].z = 0.0;
  normals[3].x = -(float)(v14 - v16);
  normals[3].y = v15 - v17;
  ds[3] = -(float)((float)((float)((float)(v15 - v17) * v14) - (float)(v15 * (float)(v14 - v16))) + (float)(v27 * 0.0));
}

//----- (004AEEA4) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingBoxSegmentPlanesUncached(
        const CVector *in_corners,
        CVector *in_center,
        CVector *normals,
        float *ds)
{
  float x; // s0
  float v5; // s2
  float v6; // s4
  RwReal v7; // s0
  float v8; // s0
  float v9; // s2
  float v10; // s6
  RwReal v11; // s0
  float v12; // s0
  float v13; // s2
  float v14; // s6
  RwReal v15; // s0
  float v16; // s0
  float v17; // s2
  float v18; // s6
  RwReal v19; // s0

  x = in_center->x;
  v5 = in_corners->y - in_center->y;
  v6 = in_corners->x;
  normals->z = 0.0;
  v7 = v6 - x;
  normals->x = -v5;
  normals->y = v7;
  *ds = -(float)((float)((float)(v7 * in_corners->y) - (float)(in_corners->x * v5)) + (float)(in_corners->z * 0.0));
  v8 = in_center->x;
  v9 = in_corners[1].y - in_center->y;
  v10 = in_corners[1].x;
  normals[1].z = 0.0;
  v11 = v10 - v8;
  normals[1].x = -v9;
  normals[1].y = v11;
  ds[1] = -(float)((float)((float)(v11 * in_corners[1].y) - (float)(in_corners[1].x * v9))
                 + (float)(in_corners[1].z * 0.0));
  v12 = in_center->x;
  v13 = in_corners[2].y - in_center->y;
  v14 = in_corners[2].x;
  normals[2].z = 0.0;
  v15 = v14 - v12;
  normals[2].x = -v13;
  normals[2].y = v15;
  ds[2] = -(float)((float)((float)(v15 * in_corners[2].y) - (float)(in_corners[2].x * v13))
                 + (float)(in_corners[2].z * 0.0));
  v16 = in_center->x;
  v17 = in_corners[3].y - in_center->y;
  v18 = in_corners[3].x;
  normals[3].z = 0.0;
  v19 = v18 - v16;
  normals[3].x = -v17;
  normals[3].y = v19;
  ds[3] = -(float)((float)((float)(v19 * in_corners[3].y) - (float)(in_corners[3].x * v17))
                 + (float)(in_corners[3].z * 0.0));
}

//----- (004AEFF4) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeEntityBoundingSphere(const CPed *ped, CEntity *entity, CColSphere *sphere)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  CSimpleTransform *p_m_transform; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  CMatrix *v11; // r0
  RwReal z; // s16
  float32x2_t v13; // d17
  float32x2_t v14; // d16
  float32x2_t v15; // d17
  float32x2_t v16; // d18
  float32x2_t v17; // d19
  float32x2_t v18; // d16
  float32x2_t v19; // d3
  unsigned __int64 v20; // d5
  unsigned __int64 v21; // d6
  unsigned __int64 v22; // d7
  float32x2_t v23; // d16
  float32x2_t v24; // d16
  CVector vecCentre; // [sp+Ch] [bp-8Ch] BYREF
  CVector corners; // [sp+18h] [bp-80h] BYREF
  float32x2_t v27; // [sp+24h] [bp-74h]
  float v28; // [sp+2Ch] [bp-6Ch]
  float32x2_t v29; // [sp+30h] [bp-68h]
  float v30; // [sp+38h] [bp-60h]
  float32x2_t v31; // [sp+3Ch] [bp-5Ch]
  float v32; // [sp+44h] [bp-54h]
  CVector v33; // [sp+48h] [bp-50h] BYREF
  float32x2_t v34; // [sp+54h] [bp-44h]
  float32x2_t v35; // [sp+60h] [bp-38h]
  float32x2_t v36; // [sp+6Ch] [bp-2Ch]

  p_m_transform = &ped->m_transform;
  m_pMat = ped->m_pMat;
  p_tx = p_m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(p_tx->m_translate.z, entity, &corners);
  v11 = ped->m_pMat;
  if ( v11 )
    p_m_transform = (CSimpleTransform *)&v11->tx;
  z = p_m_transform->m_translate.z;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(z, entity, &v33);
  v13.n64_f32[0] = 0.25;
  v13.n64_f32[1] = 0.25;
  v14.n64_u64[0] = vmul_f32(vadd_f32(vadd_f32(vadd_f32(vadd_f32(*(float32x2_t *)&v33.x, 0LL), v34), v35), v36), v13).n64_u64[0];
  v15.n64_u64[0] = vsub_f32(*(float32x2_t *)&corners.x, v14).n64_u64[0];
  *(float32x2_t *)&vecCentre.x = v14;
  v16.n64_u64[0] = vsub_f32(v27, v14).n64_u64[0];
  v17.n64_u64[0] = vsub_f32(v29, v14).n64_u64[0];
  v18.n64_u64[0] = vsub_f32(v31, v14).n64_u64[0];
  v19.n64_u64[0] = vmul_f32(v15, v15).n64_u64[0];
  vecCentre.z = z;
  v20 = vmul_f32(v16, v16).n64_u64[0];
  v21 = vmul_f32(v17, v17).n64_u64[0];
  v22 = vmul_f32(v18, v18).n64_u64[0];
  v4.n64_f32[0] = (float)(v19.n64_f32[0] + v19.n64_f32[1]) + (float)((float)(corners.z - z) * (float)(corners.z - z));
  v19.n64_u32[0] = 0;
  v3.n64_f32[0] = (float)(*(float *)&v20 + *((float *)&v20 + 1)) + (float)((float)(v28 - z) * (float)(v28 - z));
  v23.n64_u64[0] = vmax_f32(v4, v19).n64_u64[0];
  v4.n64_f32[0] = (float)(*(float *)&v21 + *((float *)&v21 + 1)) + (float)((float)(v30 - z) * (float)(v30 - z));
  v24.n64_u64[0] = vmax_f32(v3, v23).n64_u64[0];
  v3.n64_f32[0] = (float)(*(float *)&v22 + *((float *)&v22 + 1)) + (float)((float)(v32 - z) * (float)(v32 - z));
  CColSphere::Set(sphere, sqrtf(vmax_f32(v3, vmax_f32(v4, v24)).n64_f32[0]) * 1.1, &vecCentre, 0, 0, 0xFFu);
}
// 4AF100: variable 'v4' is possibly undefined
// 4AF108: variable 'v3' is possibly undefined

//----- (004AF140) --------------------------------------------------------
int __fastcall CPedGeometryAnalyser::ComputeRouteRoundEntityBoundingBox(
        const CPed *ped,
        CEntity *entity,
        const CVector *vTargetPos,
        CPointRoute *route,
        int iForceDirection)
{
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r1

  m_pMat = ped->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &ped->m_transform;
  return CPedGeometryAnalyser::ComputeRouteRoundEntityBoundingBox(
           ped,
           &p_tx->m_translate,
           entity,
           vTargetPos,
           route,
           iForceDirection);
}

//----- (004AF168) --------------------------------------------------------
int __fastcall CPedGeometryAnalyser::ComputeRouteRoundEntityBoundingBox(
        const CPed *ped,
        const CVector *vStartPos,
        CEntity *entity,
        const CVector *vTargetPos,
        CPointRoute *route,
        int iForceDirection)
{
  CSimpleTransform *p_m_transform; // r5
  CSimpleTransform *p_tx; // r1
  CMatrix *m_pMat; // r0
  CSimpleTransform *v13; // r1
  CMatrix *v14; // r0
  CSimpleTransform *v15; // r6
  _BOOL4 v16; // r0
  int v17; // r3
  float x; // s6
  float y; // s10
  float z; // s8
  float v21; // s0
  float v22; // s4
  float v23; // s2
  CSimpleTransform *v25; // r1
  CMatrix *v26; // r0
  int v27; // r0
  float v28; // s11
  float v29; // s9
  float v30; // s7
  float v31; // s6
  float v32; // s19
  float v33; // s5
  float v34; // s8
  float v35; // s0
  float v36; // s30
  float v37; // s13
  float v38; // s1
  float v39; // s17
  float v40; // s10
  float v41; // s2
  float v42; // s15
  float v43; // s9
  float v44; // s3
  float v45; // s2
  float v46; // s4
  float v47; // s14
  float v48; // s7
  float v49; // s12
  float v50; // s20
  float v51; // s14
  int v52; // r1
  float v53; // s22
  float v54; // s5
  int v55; // r1
  float v56; // s5
  int v57; // r1
  float v58; // s11
  float v59; // s15
  float v60; // s1
  float v61; // s6
  float v62; // s8
  int v63; // r2
  float v64; // s10
  float v65; // s0
  int v66; // r2
  CSimpleTransform *v67; // r1
  CMatrix *v68; // r0
  CMatrix *v69; // r0
  _BOOL4 v70; // r0
  __int64 v71; // d16
  __int64 v72; // d16
  float v73; // s12
  RwReal *p_y; // r6
  float v75; // s14
  int v76; // r1
  float v77; // s1
  float v78; // s20
  float v79; // s22
  float v80; // s0
  float v81; // s24
  float v82; // s2
  float v83; // s4
  RwReal *v84; // r0
  int v85; // lr
  float v86; // s7
  float v87; // s9
  float v88; // s11
  int v89; // r3
  float v90; // s7
  float v91; // s28
  float v92; // s13
  int v93; // r2
  float v94; // s15
  float v95; // s26
  bool v96; // zf
  float v97; // s0
  float v98; // s7
  float v99; // s8
  float *p_out_ds; // r2
  float v101; // s6
  float v102; // s10
  int v103; // r1
  float v104; // s14
  int v105; // r0
  float v106; // s12
  int v107; // r3
  float v108; // s1
  float v109; // s5
  int v110; // r5
  float v111; // s7
  int v112; // r4
  float v113; // s3
  float v114; // s9
  float v115; // s11
  float v116; // s13
  float v117; // s12
  float v118; // s1
  float v119; // s3
  float v120; // s6
  float v121; // s10
  float v122; // s3
  __int64 v123; // d16
  int v124; // r2
  CVector *v125; // r0
  __int64 v126; // d16
  int v127; // r0
  int v128; // r1
  int v129; // r3
  int v130; // r8
  float v131; // s2
  float v132; // s6
  RwReal v133; // s0
  __int64 v134; // d16
  float *v135; // r6
  CVector *v136; // r5
  __int64 v137; // d16
  RwV3d_0 *v138; // r3
  __int64 v139; // d16
  __int64 v140; // d16
  CVector *v141; // r2
  double v142; // d16
  int v143; // r9
  int v144; // r6
  int *v145; // r2
  CVector *v146; // r3
  __int64 v147; // d16
  CVector *v148; // r1
  __int64 v149; // d16
  float32x2_t v150; // d18
  float32x2_t v151; // d10
  float v152; // s18
  float *p_m_fRadius; // r5
  float v154; // s28
  float32x2_t v155; // d15
  CMatrix *v156; // r0
  unsigned __int64 v157; // d1
  float v158; // s2
  RwReal v159; // s0
  float v160; // s2
  float v161; // s0
  float v162; // s6
  float v163; // s10
  float v164; // s14
  float v165; // s4
  float v166; // s8
  float v167; // s12
  CPlaceable *v168; // r4
  bool v169; // zf
  __int64 v170; // d16
  double *v171; // r5
  float v172; // s28
  float32x2_t v173; // d15
  CMatrix *v174; // r0
  unsigned __int64 v175; // d1
  float v176; // s2
  RwReal v177; // s0
  float v178; // s6
  float32x2_t v179; // d2
  float32x2_t v180; // d0
  float v181; // s2
  float32x2_t v182; // d16
  unsigned __int64 v183; // d5
  float v184; // s6
  float v185; // s8
  CPlaceable *v186; // r4
  bool v187; // zf
  float32x2_t v188; // d16
  float m_fRadius; // s0
  float v190; // s2
  float32x2_t v191; // d16
  float *v192; // r0
  float v193; // s4
  int v194; // r1
  float v195; // s6
  float32x2_t v196; // d17
  float32x2_t v197; // d16
  unsigned __int64 v198; // d4
  double *v199; // r0
  float32x2_t v200; // d16
  int v201; // r1
  float v202; // s4
  float v203; // s6
  float32x2_t v204; // d17
  float32x2_t v205; // d16
  unsigned __int64 v206; // d4
  CPointRoute *v207; // r6
  int v208; // r5
  double *v209; // r1
  int v210; // r2
  const CVector *v211; // r0
  const CVector *v212; // r4
  __int64 v213; // d16
  char *v214; // r2
  float *v215; // r1
  int v216; // r5
  int m_iRouteSize; // r2
  __int64 v218; // d16
  char *v219; // r2
  __int64 v220; // d16
  char *v221; // r2
  int v222; // r1
  bool v223; // cc
  int v224; // r8
  CVector *v225; // r4
  int v226; // r5
  int v227; // r0
  int v228; // r0
  __int64 v229; // d16
  int v230; // [sp+28h] [bp-200h]
  int v231; // [sp+2Ch] [bp-1FCh]
  int v232; // [sp+30h] [bp-1F8h]
  int v233; // [sp+34h] [bp-1F4h]
  const CVector *v234; // [sp+3Ch] [bp-1ECh]
  CEntity *v235; // [sp+40h] [bp-1E8h]
  CPed *v236; // [sp+44h] [bp-1E4h]
  float v237; // [sp+48h] [bp-1E0h]
  int v238; // [sp+48h] [bp-1E0h]
  int v239; // [sp+48h] [bp-1E0h]
  CPlaceable *v240; // [sp+4Ch] [bp-1DCh] BYREF
  CColPoint v; // [sp+50h] [bp-1D8h] BYREF
  CVector vecEnd; // [sp+7Ch] [bp-1ACh] BYREF
  CVector vecStart; // [sp+88h] [bp-1A0h] BYREF
  CVector v244; // [sp+94h] [bp-194h] BYREF
  CVector m_vecCentre; // [sp+A0h] [bp-188h] BYREF
  CPlaceable *v246; // [sp+ACh] [bp-17Ch] BYREF
  CVector v247; // [sp+B0h] [bp-178h] BYREF
  double v248; // [sp+BCh] [bp-16Ch] BYREF
  RwReal v249; // [sp+C4h] [bp-164h]
  int v250; // [sp+C8h] [bp-160h] BYREF
  CColSphere v251; // [sp+F0h] [bp-138h] BYREF
  RwReal v252; // [sp+104h] [bp-124h]
  float v253; // [sp+108h] [bp-120h] BYREF
  float v254; // [sp+10Ch] [bp-11Ch]
  float v255; // [sp+110h] [bp-118h]
  float v256; // [sp+114h] [bp-114h]
  float v257; // [sp+118h] [bp-110h]
  float v258; // [sp+11Ch] [bp-10Ch]
  CVector v259; // [sp+12Ch] [bp-FCh] BYREF
  CVector v260; // [sp+138h] [bp-F0h] BYREF
  CVector v1; // [sp+148h] [bp-E0h] BYREF
  float out_ds; // [sp+158h] [bp-D0h] BYREF
  float v263; // [sp+15Ch] [bp-CCh]
  float v264; // [sp+160h] [bp-C8h]
  float v265; // [sp+164h] [bp-C4h]
  CVector out_normals; // [sp+168h] [bp-C0h] BYREF
  float v267; // [sp+174h] [bp-B4h]
  float v268; // [sp+178h] [bp-B0h]
  float v269; // [sp+17Ch] [bp-ACh]
  float v270; // [sp+180h] [bp-A8h]
  float v271; // [sp+184h] [bp-A4h]
  float v272; // [sp+188h] [bp-A0h]
  float v273; // [sp+18Ch] [bp-9Ch]
  float v274; // [sp+190h] [bp-98h]
  float v275; // [sp+194h] [bp-94h]
  CVector corners; // [sp+198h] [bp-90h] BYREF
  float32x2_t v277; // [sp+1A4h] [bp-84h]
  float v278; // [sp+1ACh] [bp-7Ch]
  float32x2_t v279; // [sp+1B0h] [bp-78h]
  float v280; // [sp+1B8h] [bp-70h]
  float32x2_t v281; // [sp+1BCh] [bp-6Ch]
  float v282; // [sp+1C4h] [bp-64h]

  p_m_transform = &ped->m_transform;
  route->m_iRouteSize = 0;
  p_tx = &ped->m_transform;
  v237 = CPedGeometryAnalyser::ms_fPedNominalRadius;
  CPedGeometryAnalyser::ms_fPedNominalRadius = 0.175;
  m_pMat = ped->m_pMat;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(p_tx->m_translate.z, entity, &corners);
  v13 = p_m_transform;
  v236 = (CPed *)ped;
  v14 = ped->m_pMat;
  v15 = p_m_transform;
  if ( v14 )
    v13 = (CSimpleTransform *)&v14->tx;
  v235 = entity;
  v16 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(v13->m_translate.z, entity, &v251.m_vecCentre);
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(
    *(const float *)&v16,
    &v251.m_vecCentre,
    &out_normals,
    &out_ds);
  v17 = 0;
  CPedGeometryAnalyser::ms_fPedNominalRadius = v237;
  x = vStartPos->x;
  y = vStartPos->y;
  z = vStartPos->z;
  v21 = vTargetPos->x;
  v22 = vTargetPos->y;
  v23 = vTargetPos->z;
  if ( (float)(out_ds
             + (float)((float)((float)(out_normals.x * vStartPos->x) + (float)(out_normals.y * y))
                     + (float)(out_normals.z * z))) > 0.0
    && (float)(out_ds
             + (float)((float)((float)(out_normals.x * v21) + (float)(out_normals.y * v22))
                     + (float)(out_normals.z * v23))) > 0.0 )
  {
    return v17;
  }
  if ( (float)(v263 + (float)((float)((float)(v267 * x) + (float)(v268 * y)) + (float)(v269 * z))) > 0.0
    && (float)(v263 + (float)((float)((float)(v267 * v21) + (float)(v268 * v22)) + (float)(v269 * v23))) > 0.0
    || (float)(v264 + (float)((float)((float)(v270 * x) + (float)(v271 * y)) + (float)(v272 * z))) > 0.0
    && (float)(v264 + (float)((float)((float)(v270 * v21) + (float)(v271 * v22)) + (float)(v272 * v23))) > 0.0
    || (float)(v265 + (float)((float)((float)(v273 * x) + (float)(v274 * y)) + (float)(v275 * z))) > 0.0
    && (float)(v265 + (float)((float)((float)(v273 * v21) + (float)(v274 * v22)) + (float)(v275 * v23))) > 0.0 )
  {
    return 0;
  }
  v25 = p_m_transform;
  v26 = v236->m_pMat;
  if ( v26 )
    v25 = (CSimpleTransform *)&v26->tx;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(v25->m_translate.z, entity, &v251.m_vecCentre);
  v27 = 0;
  v28 = vStartPos->y;
  v29 = (float)((float)((float)((float)(v251.m_vecCentre.x + 0.0) + v251.m_fRadius) + v253) + v256) * 0.25;
  v30 = (float)((float)((float)((float)(v251.m_vecCentre.y + 0.0) + *(float *)&v251.m_data.m_nSurfaceType) + v254) + v257)
      * 0.25;
  v31 = v256 - v29;
  v32 = *(float *)&v251.m_data.m_nSurfaceType - v30;
  v33 = vStartPos->x;
  v34 = (float)((float)(v257 * (float)(v256 - v29)) - (float)(v256 * (float)(v257 - v30))) + (float)(v258 * 0.0);
  v35 = v253 - v29;
  v36 = (float)(v254 * (float)(v253 - v29)) - (float)(v253 * (float)(v254 - v30));
  v37 = vStartPos->z * 0.0;
  v38 = v251.m_vecCentre.x - v29;
  v39 = (float)(v28 * (float)(v251.m_vecCentre.x - v29)) - (float)(vStartPos->x * (float)(v251.m_vecCentre.y - v30));
  v40 = v251.m_fRadius - v29;
  v41 = (float)(v251.m_vecCentre.y * (float)(v251.m_vecCentre.x - v29))
      - (float)(v251.m_vecCentre.x * (float)(v251.m_vecCentre.y - v30));
  v42 = (float)((float)((float)(v28 * (float)(v256 - v29)) - (float)(vStartPos->x * (float)(v257 - v30))) + v37) - v34;
  v43 = -(float)(v251.m_vecCentre.y - v30);
  v44 = v41 + (float)(v251.m_vecCentre.z * 0.0);
  v45 = -(float)(v254 - v30);
  v46 = v36 + (float)(v255 * 0.0);
  v47 = (float)(*(float *)&v251.m_data.m_nSurfaceType * v40)
      - (float)(v251.m_fRadius * (float)(*(float *)&v251.m_data.m_nSurfaceType - v30));
  v48 = -(float)(v257 - v30);
  v49 = -v32;
  v50 = (float)(v39 + v37) - v44;
  v51 = v47 + (float)(v252 * 0.0);
  if ( v42 < 0.0 || v50 >= 0.0 )
  {
    v52 = 0;
    v53 = (float)((float)((float)(v33 * v49) + (float)(v28 * v40)) + v37) - v51;
    if ( v53 < 0.0 )
      v52 = 1;
    if ( v50 >= 0.0 )
      v27 = 1;
    v27 &= v52;
    if ( !v27 )
    {
      v54 = (float)((float)((float)(v33 * v45) + (float)(v28 * v35)) + v37) - v46;
      if ( v53 < 0.0 || v54 >= 0.0 )
      {
        v55 = 0;
        if ( v54 >= 0.0 )
          v55 = 3;
        if ( v42 < 0.0 )
          v27 = v55;
      }
      else
      {
        v27 = 2;
      }
    }
  }
  v56 = vTargetPos->x;
  v57 = 0;
  v58 = vTargetPos->y;
  v59 = v58 * v38;
  v60 = vTargetPos->z * 0.0;
  v61 = (float)((float)((float)(vTargetPos->x * v48) + (float)(v58 * v31)) + v60) - v34;
  v62 = (float)((float)((float)(vTargetPos->x * v43) + v59) + v60) - v44;
  if ( v61 < 0.0 || v62 >= 0.0 )
  {
    v63 = 0;
    v64 = (float)((float)((float)(v56 * v49) + (float)(v58 * v40)) + v60) - v51;
    if ( v64 < 0.0 )
      v63 = 1;
    if ( v62 >= 0.0 )
      v57 = 1;
    v57 &= v63;
    if ( !v57 )
    {
      v65 = (float)((float)((float)(v56 * v45) + (float)(v58 * v35)) + v60) - v46;
      if ( v64 < 0.0 || v65 >= 0.0 )
      {
        v66 = 0;
        if ( v65 >= 0.0 )
          v66 = 3;
        if ( v61 < 0.0 )
          v57 = v66;
      }
      else
      {
        v57 = 2;
      }
    }
  }
  v17 = 0;
  if ( v27 == v57 )
    return v17;
  v67 = p_m_transform;
  v68 = v236->m_pMat;
  if ( v68 )
    v67 = (CSimpleTransform *)&v68->tx;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(v67->m_translate.z, entity, &corners);
  v69 = v236->m_pMat;
  if ( v69 )
    v15 = (CSimpleTransform *)&v69->tx;
  v70 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(v15->m_translate.z, entity, &v251.m_vecCentre);
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(
    *(const float *)&v70,
    &v251.m_vecCentre,
    &out_normals,
    &out_ds);
  v71 = *(_QWORD *)&vStartPos->x;
  v1.z = vStartPos->z;
  *(_QWORD *)&v1.x = v71;
  v72 = *(_QWORD *)&vTargetPos->x;
  v260.z = vTargetPos->z;
  *(_QWORD *)&v260.x = v72;
  v259.x = *(float *)&v72 - v1.x;
  v259.y = *((float *)&v72 + 1) - v1.y;
  v259.z = v260.z - v1.z;
  CVector::Normalise(&v259);
  v73 = v1.x;
  p_y = &out_normals.y;
  v75 = v1.y;
  v76 = 0;
  v77 = v1.z;
  v78 = v1.y;
  v79 = v1.x;
  v80 = v260.x;
  v81 = v1.z;
  v82 = v260.y;
  v83 = v260.z;
  v84 = &out_normals.y;
  v85 = 0;
  do
  {
    v87 = *(v84 - 1);
    v88 = *v84;
    v89 = 0;
    v90 = v84[1];
    v91 = (float)((float)(v87 * v80) + (float)(*v84 * v82)) + (float)(v90 * v83);
    v92 = *(float *)((char *)&out_ds + v76);
    v93 = 0;
    v94 = v92 + v91;
    v95 = v92 + (float)((float)((float)(v87 * v79) + (float)(*v84 * v78)) + (float)(v90 * v81));
    if ( (float)(v92 + v91) < -0.2 )
      v93 = -1;
    if ( (float)(v92 + v91) > 0.2 )
      v93 = 1;
    if ( v95 < -0.2 )
      v89 = -1;
    if ( v95 > 0.2 )
      v89 = 1;
    v96 = v89 == -1;
    if ( v89 != -1 )
      v96 = v93 == -1;
    if ( !v96 )
    {
      if ( v89 )
      {
        if ( v93 )
          goto LABEL_67;
      }
      else
      {
        v78 = (float)(v88 * (float)(0.2 - v95)) + v78;
        v79 = v79 + (float)(v87 * (float)(0.2 - v95));
        v81 = (float)(v90 * (float)(0.2 - v95)) + v81;
        v1.y = v78;
        v1.x = v79;
        v1.z = v81;
        if ( v93 )
        {
LABEL_67:
          v85 = 1;
          goto LABEL_74;
        }
      }
      v85 = 1;
      v82 = (float)((float)(0.2 - v94) * v88) + v82;
      v80 = (float)((float)(0.2 - v94) * v87) + v80;
      v83 = (float)((float)(0.2 - v94) * v90) + v83;
      goto LABEL_73;
    }
    if ( v89 == -1 && v94 > 0.2 )
    {
      v97 = (float)-(float)((float)((float)((float)(v73 * v87) + (float)(v75 * v88)) + (float)(v77 * v90)) + v92)
          / (float)((float)((float)(v87 * v259.x) + (float)(v88 * v259.y)) + (float)(v90 * v259.z));
      v98 = v259.z * v97;
      v82 = v75 + (float)(v259.y * v97);
      v80 = v73 + (float)(v259.x * v97);
      v83 = v77 + v98;
LABEL_73:
      v260.y = v82;
      v260.x = v80;
      v260.z = v83;
      goto LABEL_74;
    }
    if ( v95 > 0.2 && v93 == -1 )
    {
      v86 = (float)-(float)((float)((float)((float)(v73 * v87) + (float)(v75 * v88)) + (float)(v77 * v90)) + v92)
          / (float)((float)((float)(v87 * v259.x) + (float)(v88 * v259.y)) + (float)(v90 * v259.z));
      v78 = v75 + (float)(v259.y * v86);
      v79 = v73 + (float)(v259.x * v86);
      v81 = v77 + (float)(v259.z * v86);
      v1.y = v78;
      v1.x = v79;
      v1.z = v81;
    }
LABEL_74:
    v76 += 4;
    v84 += 3;
  }
  while ( v76 != 16 );
  if ( !(v85 << 31) )
  {
    CPedGeometryAnalyser::ComputeEntityBoundingSphere(v236, entity, &v251);
    v131 = vStartPos->y;
    v132 = vTargetPos->y;
    v133 = vTargetPos->x - vStartPos->x;
    v247.z = 0.0;
    v247.y = v132 - v131;
    v247.x = v133;
    if ( sqrtf((float)((float)(v133 * v133) + (float)(v247.y * v247.y)) + 0.0) != 0.0 )
    {
      CVector::Normalise(&v247);
      v134 = *(_QWORD *)&vStartPos->x;
      v.m_vecPosition.z = vStartPos->z;
      *(_QWORD *)&v.m_vecPosition.x = v134;
      if ( CColSphere::IntersectRay(&v251, &v.m_vecPosition, &v247, &v1, &v260) )
      {
        v80 = v260.x;
        v82 = v260.y;
        v83 = v260.z;
        v79 = v1.x;
        v78 = v1.y;
        v81 = v1.z;
        goto LABEL_76;
      }
    }
    return 0;
  }
LABEL_76:
  v259.y = v82 - v78;
  v259.x = v80 - v79;
  v259.z = v83 - v81;
  CVector::Normalise(&v259);
  v99 = v260.x;
  p_out_ds = &out_ds;
  v101 = v260.y;
  v102 = v260.z;
  v103 = -1;
  v104 = v1.x;
  v105 = 0;
  v106 = v1.y;
  v107 = -1;
  v108 = v1.z;
  do
  {
    v109 = *(p_y - 1);
    v110 = 0;
    v111 = *p_y;
    v112 = 0;
    v113 = p_y[1];
    v114 = *p_out_ds;
    v115 = *p_out_ds + (float)((float)((float)(v109 * v99) + (float)(*p_y * v101)) + (float)(v113 * v102));
    v116 = *p_out_ds + (float)((float)((float)(v109 * v104) + (float)(*p_y * v106)) + (float)(v113 * v108));
    if ( v115 == 0.0 )
      v110 = 1;
    if ( v116 == 0.0 )
      v112 = 1;
    if ( (v112 & v110) == 0 )
    {
      if ( v116 < 0.0 || v115 > 0.0 )
      {
        if ( v116 <= 0.0 && v115 >= 0.0 )
        {
          v107 = v105;
          v120 = (float)-(float)(v114 + (float)((float)((float)(v79 * v109) + (float)(v78 * v111)) + (float)(v81 * v113)))
               / (float)((float)((float)(v109 * v259.x) + (float)(v111 * v259.y)) + (float)(v113 * v259.z));
          v121 = v259.x * v120;
          v122 = v259.z * v120;
          v101 = v78 + (float)(v259.y * v120);
          v99 = v79 + v121;
          v102 = v81 + v122;
          v260.y = v101;
          v260.x = v99;
          v260.z = v81 + v122;
        }
      }
      else
      {
        v103 = v105;
        v117 = (float)-(float)(v114 + (float)((float)((float)(v79 * v109) + (float)(v78 * v111)) + (float)(v81 * v113)))
             / (float)((float)((float)(v109 * v259.x) + (float)(v111 * v259.y)) + (float)(v113 * v259.z));
        v118 = v259.x * v117;
        v119 = v259.z * v117;
        v106 = v78 + (float)(v259.y * v117);
        v104 = v79 + v118;
        v108 = v81 + v119;
        v1.y = v106;
        v1.x = v104;
        v1.z = v81 + v119;
      }
    }
    ++v105;
    p_y += 3;
    ++p_out_ds;
  }
  while ( v105 != 4 );
  if ( (v103 | v107) < 0 )
    return 0;
  v234 = vTargetPos;
  v123 = *(_QWORD *)&vStartPos->x;
  v251.m_vecCentre.z = vStartPos->z;
  *(_QWORD *)&v251.m_vecCentre.x = v123;
  v124 = (v103 + 3) % 4;
  v125 = &corners + v124;
  v126 = *(_QWORD *)&v125->x;
  v252 = v125->z;
  *(_QWORD *)&v251.m_fRadius = v126;
  v127 = (v103 + 4) % 4;
  v128 = (v107 + 3) % 4;
  v129 = (v107 + 4) % 4;
  if ( v124 == v129 )
  {
    v130 = 2;
  }
  else
  {
    v130 = 2;
    v135 = &v253;
    do
    {
      ++v130;
      v124 = (v124 + 3) % 4;
      v136 = &corners + v124;
      v137 = *(_QWORD *)&v136->x;
      v135[2] = v136->z;
      *(_QWORD *)v135 = v137;
      v135 += 3;
    }
    while ( v124 != v129 );
  }
  v138 = &v251.m_vecCentre + v130;
  v139 = *(_QWORD *)&vTargetPos->x;
  v138->z = vTargetPos->z;
  *(_QWORD *)&v138->x = v139;
  v140 = *(_QWORD *)&vStartPos->x;
  v247.z = vStartPos->z;
  *(_QWORD *)&v247.x = v140;
  v141 = &corners + v127;
  v142 = *(double *)&v141->x;
  v249 = v141->z;
  v248 = v142;
  if ( v127 == v128 )
  {
    v143 = 2;
    v144 = iForceDirection;
  }
  else
  {
    v144 = iForceDirection;
    v145 = &v250;
    v143 = 2;
    do
    {
      ++v143;
      v127 = (v127 + 5) % 4;
      v146 = &corners + v127;
      v147 = *(_QWORD *)&v146->x;
      v145[2] = LODWORD(v146->z);
      *(_QWORD *)v145 = v147;
      v145 += 3;
    }
    while ( v127 != v128 );
  }
  v148 = &v247 + v143;
  v149 = *(_QWORD *)&v234->x;
  v148->z = v234->z;
  *(_QWORD *)&v148->x = v149;
  if ( v144 == 1 )
    goto LABEL_168;
  if ( v144 )
    goto LABEL_159;
  v150.n64_f32[0] = 0.25;
  v150.n64_f32[1] = 0.25;
  v231 = v130 + 1;
  v230 = v143 + 1;
  v246 = 0;
  m_vecCentre = v251.m_vecCentre;
  v151.n64_u64[0] = vmul_f32(
                      vadd_f32(vadd_f32(vadd_f32(vadd_f32(*(float32x2_t *)&corners.x, 0LL), v277), v279), v281),
                      v150).n64_u64[0];
  v152 = (float)((float)((float)((float)(corners.z + 0.0) + v278) + v280) + v282) * 0.25;
  if ( v130 >= 1 )
  {
    p_m_fRadius = &v251.m_fRadius;
    v238 = 0;
    v232 = 1;
    while ( 1 )
    {
      v158 = p_m_fRadius[1];
      v159 = *p_m_fRadius - m_vecCentre.x;
      v244.z = 0.0;
      v244.x = v159;
      v244.y = v158 - m_vecCentre.y;
      CVector::Normalise(&v244);
      v160 = *p_m_fRadius;
      v161 = v244.y * 0.5;
      v162 = p_m_fRadius[1];
      v163 = v244.x * -0.5;
      v164 = *p_m_fRadius - v151.n64_f32[0];
      v165 = p_m_fRadius[2];
      v166 = v244.x * 0.5;
      v244.z = 0.0;
      v244.x = v161;
      v244.y = v163;
      if ( (float)((float)((float)(v165 - v152) * 0.0)
                 + (float)((float)(v164 * v161) - (float)((float)(v162 - v151.n64_f32[1]) * v166))) >= 0.0 )
      {
        v167 = 0.0;
        v166 = v163;
      }
      else
      {
        v161 = -v161;
        v167 = -0.0;
        v244.y = v166;
        v244.z = -0.0;
        v244.x = v161;
      }
      ++v238;
      vecEnd.y = v162 + v166;
      vecStart.x = m_vecCentre.x + v161;
      vecEnd.x = v160 + v161;
      vecStart.y = m_vecCentre.y + v166;
      vecStart.z = m_vecCentre.z + v167;
      vecEnd.z = v165 + v167;
      if ( CWorld::ProcessLineOfSight(
             &m_vecCentre,
             (const CVector *)p_m_fRadius,
             &v,
             (CEntity **)&v246,
             1,
             1,
             1,
             1,
             0,
             0,
             0,
             0)
        || CWorld::ProcessLineOfSight(&vecStart, &vecEnd, &v, (CEntity **)&v246, 1, 1, 1, 1, 0, 0, 0, 0) == 1 )
      {
        v168 = v246;
        v169 = v246 == v235;
        if ( v246 != v235 )
          v169 = v246 == v236;
        if ( v169 )
        {
          v246 = 0;
        }
        else
        {
          if ( (BYTE2(v246[2].m_transform.m_translate.y) & 7) != 3
            || v246[46]._vptr$CPlaceable == (int (**)(void))((char *)&dword_0 + 1) )
          {
            goto LABEL_119;
          }
          v154 = *p_m_fRadius - m_vecCentre.x;
          v155.n64_u64[0] = vsub_f32(*(float32x2_t *)(p_m_fRadius + 1), *(float32x2_t *)&m_vecCentre.y).n64_u64[0];
          v156 = v246->m_pMat;
          if ( !v156 )
          {
            CPlaceable::AllocateMatrix(v246);
            CSimpleTransform::UpdateMatrix(&v168->m_transform, v168->m_pMat);
            v156 = v168->m_pMat;
          }
          v157 = vmul_f32(v155, *(float32x2_t *)&v156->yy).n64_u64[0];
          if ( (float)((float)((float)(v154 * v156->xy) + *(float *)&v157) + *((float *)&v157 + 1)) < 0.0 )
          {
LABEL_119:
            v232 = 0;
            v231 = v238;
            goto LABEL_124;
          }
        }
      }
      v170 = *(_QWORD *)p_m_fRadius;
      m_vecCentre.z = p_m_fRadius[2];
      *(_QWORD *)&m_vecCentre.x = v170;
      p_m_fRadius += 3;
      if ( v238 >= v130 )
        goto LABEL_124;
    }
  }
  v232 = 1;
LABEL_124:
  m_vecCentre = v247;
  v240 = 0;
  if ( v143 >= 1 )
  {
    v171 = &v248;
    v239 = 0;
    v233 = 1;
    while ( 1 )
    {
      v176 = *((float *)v171 + 1);
      v177 = *(float *)v171 - m_vecCentre.x;
      v244.z = 0.0;
      v244.x = v177;
      v244.y = v176 - m_vecCentre.y;
      CVector::Normalise(&v244);
      v178 = v244.x;
      v180.n64_f32[0] = v244.y * 0.5;
      v179.n64_u64[0] = *(unsigned __int64 *)v171;
      v180.n64_f32[1] = v244.x * -0.5;
      v181 = *((float *)v171 + 2);
      v182.n64_u64[0] = vsub_f32(*(float32x2_t *)v171, v151).n64_u64[0];
      v244.z = 0.0;
      v244.x = v244.y * 0.5;
      v183 = vmul_f32(v182, v180).n64_u64[0];
      LODWORD(v244.y) = v180.n64_u32[1];
      if ( (float)((float)((float)(v181 - v152) * 0.0) + (float)(*(float *)&v183 + *((float *)&v183 + 1))) >= 0.0 )
      {
        v185 = 0.0;
        v184 = v180.n64_f32[0];
      }
      else
      {
        v180.n64_f32[1] = v178 * 0.5;
        v184 = -v180.n64_f32[0];
        v185 = -0.0;
        LODWORD(v244.y) = v180.n64_u32[1];
        v244.z = -0.0;
        v244.x = -v180.n64_f32[0];
      }
      ++v239;
      vecEnd.y = v179.n64_f32[1] + v180.n64_f32[1];
      vecStart.x = m_vecCentre.x + v184;
      vecStart.y = m_vecCentre.y + v180.n64_f32[1];
      vecEnd.x = v179.n64_f32[0] + v184;
      vecStart.z = m_vecCentre.z + v185;
      vecEnd.z = v181 + v185;
      if ( CWorld::ProcessLineOfSight(
             &m_vecCentre,
             (const CVector *)v171,
             &v,
             (CEntity **)&v240,
             1,
             1,
             1,
             1,
             0,
             0,
             0,
             0)
        || CWorld::ProcessLineOfSight(&vecStart, &vecEnd, &v, (CEntity **)&v240, 1, 1, 1, 1, 0, 0, 0, 0) == 1 )
      {
        v186 = v240;
        v187 = v240 == v235;
        if ( v240 != v235 )
          v187 = v240 == v236;
        if ( v187 )
        {
          v240 = 0;
        }
        else
        {
          if ( (BYTE2(v240[2].m_transform.m_translate.y) & 7) != 3
            || v240[46]._vptr$CPlaceable == (int (**)(void))((char *)&dword_0 + 1) )
          {
            goto LABEL_140;
          }
          v172 = *(float *)v171 - m_vecCentre.x;
          v173.n64_u64[0] = vsub_f32(*(float32x2_t *)((char *)v171 + 4), *(float32x2_t *)&m_vecCentre.y).n64_u64[0];
          v174 = v240->m_pMat;
          if ( !v174 )
          {
            CPlaceable::AllocateMatrix(v240);
            CSimpleTransform::UpdateMatrix(&v186->m_transform, v186->m_pMat);
            v174 = v186->m_pMat;
          }
          v175 = vmul_f32(v173, *(float32x2_t *)&v174->yy).n64_u64[0];
          if ( (float)((float)((float)(v172 * v174->xy) + *(float *)&v175) + *((float *)&v175 + 1)) < 0.0 )
          {
LABEL_140:
            v233 = 0;
            v230 = v239;
            goto LABEL_145;
          }
        }
      }
      v188.n64_u64[0] = *(unsigned __int64 *)v171;
      m_vecCentre.z = *((RwReal *)v171 + 2);
      *(float32x2_t *)&m_vecCentre.x = v188;
      v171 = (double *)((char *)v171 + 12);
      if ( v239 >= v143 )
        goto LABEL_145;
    }
  }
  v233 = 1;
LABEL_145:
  m_fRadius = 0.0;
  v190 = 0.0;
  if ( v130 >= 1 )
  {
    v190 = 0.0;
    v191.n64_u64[0] = *(unsigned __int64 *)&v251.m_vecCentre.y;
    v192 = &v251.m_fRadius;
    v193 = v251.m_vecCentre.x;
    v194 = v130;
    do
    {
      v195 = *v192;
      --v194;
      v196.n64_u64[0] = *(unsigned __int64 *)(v192 + 1);
      v192 += 3;
      v197.n64_u64[0] = vsub_f32(v196, v191).n64_u64[0];
      v198 = vmul_f32(v197, v197).n64_u64[0];
      v191.n64_u64[0] = v196.n64_u64[0];
      v190 = v190
           + sqrtf((float)((float)((float)(v195 - v193) * (float)(v195 - v193)) + *(float *)&v198) + *((float *)&v198 + 1));
      v193 = v195;
    }
    while ( v194 );
  }
  if ( v143 >= 1 )
  {
    m_fRadius = 0.0;
    v199 = &v248;
    v200.n64_u64[0] = *(unsigned __int64 *)&v247.y;
    v201 = v143;
    v202 = v247.x;
    do
    {
      v203 = *(float *)v199;
      --v201;
      v204.n64_u64[0] = *(unsigned __int64 *)((char *)v199 + 4);
      v199 = (double *)((char *)v199 + 12);
      v205.n64_u64[0] = vsub_f32(v204, v200).n64_u64[0];
      v206 = vmul_f32(v205, v205).n64_u64[0];
      v200.n64_u64[0] = v204.n64_u64[0];
      m_fRadius = m_fRadius
                + sqrtf(
                    (float)((float)((float)(v203 - v202) * (float)(v203 - v202)) + *(float *)&v206)
                  + *((float *)&v206 + 1));
      v202 = v203;
    }
    while ( v201 );
  }
  if ( !((v232 & v233) << 31) )
  {
    if ( (v232 | v233) << 31 )
    {
      if ( !(v232 << 31) )
        goto LABEL_159;
    }
    else
    {
      if ( v231 == 1 && v230 > 1 )
        goto LABEL_159;
      if ( v231 < 2 || v230 != 1 )
      {
        if ( v246 != v240 )
        {
          m_fRadius = CModelInfo::ms_modelInfoPtrs[SHIWORD(v240[1].m_transform.m_translate.z)]->m_pColModel->m_sphereBound.m_fRadius;
          v190 = CModelInfo::ms_modelInfoPtrs[SHIWORD(v246[1].m_transform.m_translate.z)]->m_pColModel->m_sphereBound.m_fRadius;
        }
        goto LABEL_152;
      }
    }
LABEL_168:
    if ( v130 >= 2 )
    {
      v207 = route;
      v215 = &v251.m_fRadius;
      v216 = v130 - 1;
      m_iRouteSize = route->m_iRouteSize;
      v211 = vStartPos;
      v212 = v234;
      do
      {
        if ( m_iRouteSize <= 7 )
        {
          v218 = *(_QWORD *)v215;
          v219 = (char *)route + 12 * m_iRouteSize;
          *((float *)v219 + 3) = v215[2];
          *(_QWORD *)(v219 + 4) = v218;
          m_iRouteSize = route->m_iRouteSize + 1;
          route->m_iRouteSize = m_iRouteSize;
        }
        --v216;
        v215 += 3;
      }
      while ( v216 );
      v17 = 1;
      goto LABEL_176;
    }
    v17 = 1;
LABEL_175:
    v207 = route;
    v211 = vStartPos;
    v212 = v234;
    goto LABEL_176;
  }
LABEL_152:
  if ( v190 < m_fRadius )
    goto LABEL_168;
LABEL_159:
  if ( v143 < 2 )
  {
    v17 = 2;
    goto LABEL_175;
  }
  v207 = route;
  v208 = v143 - 1;
  v209 = &v248;
  v210 = route->m_iRouteSize;
  v211 = vStartPos;
  v212 = v234;
  do
  {
    if ( v210 <= 7 )
    {
      v213 = *(_QWORD *)v209;
      v214 = (char *)route + 12 * v210;
      *((_DWORD *)v214 + 3) = *((_DWORD *)v209 + 2);
      *(_QWORD *)(v214 + 4) = v213;
      v210 = route->m_iRouteSize + 1;
      route->m_iRouteSize = v210;
    }
    --v208;
    v209 = (double *)((char *)v209 + 12);
  }
  while ( v208 );
  v17 = 2;
LABEL_176:
  if ( v207->m_iRouteSize > 7
    || (v220 = *(_QWORD *)&v212->x,
        v221 = (char *)v207 + 12 * v207->m_iRouteSize,
        *((_DWORD *)v221 + 3) = LODWORD(v212->z),
        *(_QWORD *)(v221 + 4) = v220,
        v222 = v207->m_iRouteSize + 1,
        v223 = v207->m_iRouteSize < 1,
        v207->m_iRouteSize = v222,
        !v223) )
  {
    v224 = v17;
    v225 = &v207->m_routePoints[1];
    v226 = CPedGeometryAnalyser::ComputeEntityHitSide(v211, v235);
    v227 = CPedGeometryAnalyser::ComputeEntityHitSide(&v207->m_routePoints[1], v235);
    v222 = v207->m_iRouteSize;
    if ( v226 == v227 )
    {
      v17 = v224;
      if ( v222 < 2 )
      {
        --v222;
      }
      else
      {
        v228 = 0;
        do
        {
          v229 = *(_QWORD *)&v225->x;
          ++v228;
          v225[-1].z = v225->z;
          *(_QWORD *)&v225[-1].x = v229;
          ++v225;
          v222 = v207->m_iRouteSize - 1;
        }
        while ( v228 < v222 );
      }
      v207->m_iRouteSize = v222;
    }
    else
    {
      v17 = v224;
    }
  }
  v207->m_iRouteSize = v222 - 1;
  return v17;
}
// 0: using guessed type int dword_0;

//----- (004B02C0) --------------------------------------------------------
int __fastcall CPedGeometryAnalyser::ComputeRouteRoundSphere(
        const CPed *ped,
        const CColSphere *sphere,
        const CVector *vStartPoint,
        const CVector *vTarget,
        CVector *vNewTarget,
        CVector *vDetourTarget)
{
  CMatrix *m_pMat; // r1
  __int64 v10; // d16
  CSimpleTransform *p_tx; // r5
  float y; // s2
  float v13; // s8
  float z; // s10
  float v15; // s4
  __int64 v16; // d16
  float v17; // s2
  float v18; // s8
  float v19; // s4
  float v20; // s10
  float v21; // s8
  float v22; // s10
  __int64 v23; // d16
  int result; // r0
  __int64 v25; // d16
  float x; // s0
  float v27; // s6
  float v28; // s8
  float v29; // s4
  float v30; // s10
  float v31; // s14
  float v32; // s2
  float v33; // s2
  float v34; // s12
  float m_fRadius; // s6
  float v36; // s4
  RwReal v37; // s2
  CVector v38; // [sp+8h] [bp-50h] BYREF
  CVector w; // [sp+14h] [bp-44h] BYREF
  CVector v2; // [sp+20h] [bp-38h] BYREF
  CVector v1; // [sp+30h] [bp-28h] BYREF

  m_pMat = ped->m_pMat;
  v10 = *(_QWORD *)&vTarget->x;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  vNewTarget->z = vTarget->z;
  *(_QWORD *)&vNewTarget->x = v10;
  if ( !m_pMat )
    p_tx = &ped->m_transform;
  if ( CColSphere::IntersectPoint(sphere, vTarget) )
  {
    y = vStartPoint->y;
    v13 = vTarget->y;
    z = vTarget->z;
    v15 = vStartPoint->z;
    w.x = vTarget->x - vStartPoint->x;
    w.y = v13 - y;
    w.z = z - v15;
    CVector::Normalise(&w);
    if ( CColSphere::IntersectRay(sphere, &p_tx->m_translate, &w, &v1, &v2) == 1 )
    {
      v16 = *(_QWORD *)&v2.x;
      vNewTarget->z = v2.z;
      *(_QWORD *)&vNewTarget->x = v16;
    }
  }
  v17 = p_tx->m_translate.y;
  v18 = vNewTarget->y;
  v19 = p_tx->m_translate.z;
  v20 = vNewTarget->z;
  w.x = vNewTarget->x - p_tx->m_translate.x;
  w.y = v18 - v17;
  w.z = v20 - v19;
  CVector::Normalise(&w);
  if ( CColSphere::IntersectRay(sphere, vNewTarget, &w, &v1, &v2) )
  {
    v21 = p_tx->m_translate.y;
    v22 = p_tx->m_translate.z;
    if ( (float)((float)((float)((float)(vNewTarget->x - p_tx->m_translate.x)
                               * (float)(vNewTarget->x - p_tx->m_translate.x))
                       + (float)((float)(vNewTarget->y - v21) * (float)(vNewTarget->y - v21)))
               + (float)((float)(vNewTarget->z - v22) * (float)(vNewTarget->z - v22))) >= (float)((float)((float)((float)(v1.x - p_tx->m_translate.x) * (float)(v1.x - p_tx->m_translate.x)) + (float)((float)(v1.y - v21) * (float)(v1.y - v21)))
                                                                                                + (float)((float)(v1.z - v22) * (float)(v1.z - v22))) )
    {
      if ( CColSphere::IntersectRay(sphere, &p_tx->m_translate, &w, &v1, &v2) == 1 )
      {
        x = p_tx->m_translate.x;
        v27 = sphere->m_vecCentre.x;
        v28 = sphere->m_vecCentre.y;
        v29 = p_tx->m_translate.z;
        v30 = sphere->m_vecCentre.z;
        v31 = (float)(sphere->m_vecCentre.x - p_tx->m_translate.x) * w.x;
        v32 = (float)(v28 - p_tx->m_translate.y) * w.y;
        v38.z = v30 - v29;
        v33 = (float)(v31 + v32) + (float)((float)(v30 - v29) * w.z);
        v34 = p_tx->m_translate.y + (float)(w.y * v33);
        v38.x = (float)(x + (float)(w.x * v33)) - v27;
        v38.y = v34 - v28;
        v38.z = (float)(v29 + (float)(w.z * v33)) - v30;
        CVector::Normalise(&v38);
        m_fRadius = sphere->m_fRadius;
        v36 = v38.z;
        v38.x = m_fRadius * v38.x;
        v38.y = m_fRadius * v38.y;
        v37 = v38.y;
        vDetourTarget->x = sphere->m_vecCentre.x + v38.x;
        vDetourTarget->y = sphere->m_vecCentre.y + v37;
        vDetourTarget->z = sphere->m_vecCentre.z + (float)(m_fRadius * v36);
      }
      return 1;
    }
    else
    {
      v23 = *(_QWORD *)&vNewTarget->x;
      vDetourTarget->z = vNewTarget->z;
      result = 0;
      *(_QWORD *)&vDetourTarget->x = v23;
    }
  }
  else
  {
    v25 = *(_QWORD *)&vNewTarget->x;
    vDetourTarget->z = vNewTarget->z;
    result = 0;
    *(_QWORD *)&vDetourTarget->x = v25;
  }
  return result;
}

//----- (004B053A) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::ComputeClosestSurfacePoint(
        const CPed *ped,
        CEntity *entity,
        CVector *vClosestPoint)
{
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r5
  CVector v7[5]; // [sp+0h] [bp-40h] BYREF

  m_pMat = ped->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &ped->m_transform;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(p_tx->m_translate.z, entity, v7);
  return CPedGeometryAnalyser::ComputeClosestSurfacePoint(&p_tx->m_translate, v7, vClosestPoint);
}

//----- (004B056E) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::ComputeClosestSurfacePoint(
        const CVector *pos,
        CEntity *entity,
        CVector *vClosestPoint)
{
  CVector v6[5]; // [sp+0h] [bp-40h] BYREF

  CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(pos->z, entity, v6);
  return CPedGeometryAnalyser::ComputeClosestSurfacePoint(pos, v6, vClosestPoint);
}

//----- (004B0598) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::ComputeClosestSurfacePoint(
        const CVector *pos,
        const CVector *corners,
        CVector *vClosestPoint)
{
  float v3; // s0
  int v4; // r12
  int v5; // r3
  float x; // s4
  float y; // s6
  float z; // s8
  int v9; // lr
  const CVector *v10; // r4
  float v11; // s10
  float v12; // s14
  float v13; // s12
  float v14; // s15
  const CVector *v15; // r4
  float v16; // s3
  float v17; // s9
  float v18; // s5
  float v19; // s7
  float v20; // s1
  float v21; // s3
  float v22; // s5
  float v23; // s9
  float v24; // s14
  float v25; // s1
  float v26; // s10
  float v27; // s2
  float v28; // s4
  float v29; // s6
  __int64 v30; // d16
  __int64 v31; // d16
  __int64 v32; // d16
  __int64 v33; // d16

  v3 = 3.4028e38;
  v4 = 0;
  v5 = 0;
LABEL_2:
  x = pos->x;
  y = pos->y;
  z = pos->z;
  do
  {
    v9 = v5;
    v10 = &corners[v5 % 4];
    ++v5;
    v11 = v10->x;
    v12 = v10->y;
    v13 = v10->z;
    v14 = x - v10->x;
    v15 = &corners[v5 % 4];
    v16 = v15->y - v12;
    v17 = v15->x - v11;
    v18 = v15->z - v13;
    v19 = sqrtf((float)((float)(v17 * v17) + (float)(v16 * v16)) + (float)(v18 * v18));
    v20 = v16 * (float)(1.0 / v19);
    v21 = v17 * (float)(1.0 / v19);
    v22 = v18 * (float)(1.0 / v19);
    v23 = (float)((float)(z - v13) * v22) + (float)((float)(v14 * v21) + (float)((float)(y - v12) * v20));
    if ( v23 >= 0.0 && v23 <= v19 )
    {
      v24 = v12 + (float)(v20 * v23);
      v25 = v11 + (float)(v21 * v23);
      v26 = v13 + (float)(v22 * v23);
      if ( (float)((float)((float)(z - v26) * (float)(z - v26))
                 + (float)((float)((float)(x - v25) * (float)(x - v25)) + (float)((float)(y - v24) * (float)(y - v24)))) < v3 )
      {
        v3 = (float)((float)(z - v26) * (float)(z - v26))
           + (float)((float)((float)(x - v25) * (float)(x - v25)) + (float)((float)(y - v24) * (float)(y - v24)));
        v4 = 1;
        vClosestPoint->x = v25;
        vClosestPoint->y = v24;
        vClosestPoint->z = v26;
        if ( v9 < 3 )
          goto LABEL_2;
        return v4;
      }
    }
  }
  while ( v5 - 1 < 3 );
  if ( v4 << 31 )
    return 1;
  v27 = pos->x;
  v28 = pos->y;
  v29 = pos->z;
  if ( (float)((float)((float)((float)(corners->x - pos->x) * (float)(corners->x - pos->x))
                     + (float)((float)(corners->y - v28) * (float)(corners->y - v28)))
             + (float)((float)(corners->z - v29) * (float)(corners->z - v29))) >= v3 )
  {
    LOBYTE(v4) = 0;
  }
  else
  {
    v3 = (float)((float)((float)(corners->x - pos->x) * (float)(corners->x - pos->x))
               + (float)((float)(corners->y - v28) * (float)(corners->y - v28)))
       + (float)((float)(corners->z - v29) * (float)(corners->z - v29));
    v30 = *(_QWORD *)&corners->x;
    LOBYTE(v4) = 1;
    vClosestPoint->z = corners->z;
    *(_QWORD *)&vClosestPoint->x = v30;
    v27 = pos->x;
    v28 = pos->y;
    v29 = pos->z;
  }
  if ( (float)((float)((float)((float)(corners[1].x - v27) * (float)(corners[1].x - v27))
                     + (float)((float)(corners[1].y - v28) * (float)(corners[1].y - v28)))
             + (float)((float)(corners[1].z - v29) * (float)(corners[1].z - v29))) < v3 )
  {
    v3 = (float)((float)((float)(corners[1].x - v27) * (float)(corners[1].x - v27))
               + (float)((float)(corners[1].y - v28) * (float)(corners[1].y - v28)))
       + (float)((float)(corners[1].z - v29) * (float)(corners[1].z - v29));
    LOBYTE(v4) = 1;
    v31 = *(_QWORD *)&corners[1].x;
    vClosestPoint->z = corners[1].z;
    *(_QWORD *)&vClosestPoint->x = v31;
    v27 = pos->x;
    v28 = pos->y;
    v29 = pos->z;
  }
  if ( (float)((float)((float)((float)(corners[2].x - v27) * (float)(corners[2].x - v27))
                     + (float)((float)(corners[2].y - v28) * (float)(corners[2].y - v28)))
             + (float)((float)(corners[2].z - v29) * (float)(corners[2].z - v29))) < v3 )
  {
    v3 = (float)((float)((float)(corners[2].x - v27) * (float)(corners[2].x - v27))
               + (float)((float)(corners[2].y - v28) * (float)(corners[2].y - v28)))
       + (float)((float)(corners[2].z - v29) * (float)(corners[2].z - v29));
    LOBYTE(v4) = 1;
    v32 = *(_QWORD *)&corners[2].x;
    vClosestPoint->z = corners[2].z;
    *(_QWORD *)&vClosestPoint->x = v32;
    v27 = pos->x;
    v28 = pos->y;
    v29 = pos->z;
  }
  if ( (float)((float)((float)((float)(corners[3].x - v27) * (float)(corners[3].x - v27))
                     + (float)((float)(corners[3].y - v28) * (float)(corners[3].y - v28)))
             + (float)((float)(corners[3].z - v29) * (float)(corners[3].z - v29))) < v3 )
  {
    v33 = *(_QWORD *)&corners[3].x;
    vClosestPoint->z = corners[3].z;
    *(_QWORD *)&vClosestPoint->x = v33;
    return 1;
  }
  return v4;
}

//----- (004B084C) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::GetIsLineOfSightClear(
        const CPed *ped,
        const CVector *vTarget,
        CEntity *entity,
        float *fIntersectionLength)
{
  CSimpleTransform *p_m_transform; // r5
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2
  __int64 v10; // d16
  float x; // s20
  float y; // s18
  float z; // s16
  CMatrix *v14; // r0
  _BOOL4 v15; // r0
  float *v16; // r5
  int v17; // r1
  float v18; // s4
  float v19; // s8
  float v20; // s6
  RwReal *p_y; // r0
  float v22; // s2
  float v23; // s5
  float v24; // s9
  float v25; // s7
  float v26; // s3
  float v27; // s11
  int v28; // r2
  int v29; // r3
  float v30; // s5
  float v31; // s3
  float v32; // s5
  float v33; // s3
  bool result; // r0
  float out_ds[4]; // [sp+8h] [bp-F0h] BYREF
  CVector out_normals; // [sp+18h] [bp-E0h] BYREF
  CVector v2; // [sp+48h] [bp-B0h] BYREF
  CVector v1; // [sp+54h] [bp-A4h] BYREF
  CVector v39; // [sp+60h] [bp-98h] BYREF
  CColSphere sphere; // [sp+6Ch] [bp-8Ch] BYREF
  CVector v; // [sp+80h] [bp-78h] BYREF
  CVector corners; // [sp+90h] [bp-68h] BYREF

  p_m_transform = &ped->m_transform;
  m_pMat = ped->m_pMat;
  p_tx = p_m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v10 = *(_QWORD *)&p_tx->m_translate.x;
  v.z = p_tx->m_translate.z;
  *(_QWORD *)&v.x = v10;
  x = vTarget->x;
  y = vTarget->y;
  z = vTarget->z;
  CPedGeometryAnalyser::ComputeEntityBoundingSphere(ped, entity, &sphere);
  v39.x = x - v.x;
  v39.y = y - v.y;
  v39.z = z - v.z;
  CVector::NormaliseAndMag(&v39);
  if ( CColSphere::IntersectRay(&sphere, &v, &v39, &v1, &v2) == 1 )
  {
    v14 = ped->m_pMat;
    if ( v14 )
      p_m_transform = (CSimpleTransform *)&v14->tx;
    v15 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(p_m_transform->m_translate.z, entity, &corners);
    v16 = out_ds;
    CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(*(const float *)&v15, &corners, &out_normals, out_ds);
    *fIntersectionLength = 0.0;
    v17 = -1;
    v18 = v.x;
    v19 = v.y;
    v20 = v.z;
    p_y = &out_normals.y;
    v22 = -CPedGeometryAnalyser::ms_fPedNominalRadius;
    while ( 1 )
    {
      v23 = *(p_y - 1);
      v24 = *p_y;
      v25 = p_y[1];
      v26 = *v16 + (float)((float)((float)(v18 * v23) + (float)(v19 * *p_y)) + (float)(v20 * v25));
      v27 = *v16 + (float)((float)((float)(x * v23) + (float)(y * *p_y)) + (float)(z * v25));
      if ( v26 <= CPedGeometryAnalyser::ms_fPedNominalRadius )
        v28 = v26 >= v22 ? 0 : -1;
      else
        v28 = 1;
      if ( v27 <= CPedGeometryAnalyser::ms_fPedNominalRadius )
        v29 = v27 >= v22 ? 0 : -1;
      else
        v29 = 1;
      if ( (v29 | v28) > -1 )
        break;
      if ( v28 < 1 )
      {
        if ( v29 >= 1 )
        {
          v32 = (float)((float)(v23 * v39.x) + (float)(v24 * v39.y)) + (float)(v25 * v39.z);
          if ( v32 > 0.001 )
          {
            v33 = (float)-v26 / v32;
            z = v20 + (float)(v39.z * v33);
            y = v19 + (float)(v39.y * v33);
            x = v18 + (float)(v39.x * v33);
          }
        }
      }
      else
      {
        v30 = (float)((float)(v23 * v39.x) + (float)(v24 * v39.y)) + (float)(v25 * v39.z);
        if ( v30 > 0.001 )
        {
          v31 = (float)-v26 / v30;
          v19 = v19 + (float)(v39.y * v31);
          v18 = v18 + (float)(v39.x * v31);
          v20 = v20 + (float)(v39.z * v31);
          v.y = v19;
          v.x = v18;
          v.z = v20;
        }
      }
      ++v17;
      p_y += 3;
      ++v16;
      if ( v17 >= 3 )
      {
        result = 0;
        v39.z = z - v20;
        v39.y = y - v19;
        v39.x = x - v18;
        *fIntersectionLength = sqrtf(
                                 (float)((float)(z - v20) * (float)(z - v20))
                               + (float)((float)((float)(y - v19) * (float)(y - v19))
                                       + (float)((float)(x - v18) * (float)(x - v18))));
        return result;
      }
    }
  }
  return 1;
}

//----- (004B0AA4) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::GetIsLineOfSightClear(
        const CVector *vStart,
        const CVector *vTarget,
        CEntity *entity)
{
  CMatrix *m_pMat; // r1
  CColLine line; // [sp+8h] [bp-28h] BYREF

  CColLine::CColLine(&line, vStart, vTarget);
  m_pMat = entity->m_pMat;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(entity);
    CSimpleTransform::UpdateMatrix(&entity->m_transform, entity->m_pMat);
    m_pMat = entity->m_pMat;
  }
  return CCollision::TestLineOfSight(
           &line,
           m_pMat,
           CModelInfo::ms_modelInfoPtrs[entity->m_nModelIndex]->m_pColModel,
           0,
           0) ^ 1;
}

//----- (004B0AF4) --------------------------------------------------------
int __fastcall CPedGeometryAnalyser::IsWanderPathClear(
        const CVector *vStart,
        const CVector *vEnd,
        const float fMaxHeightChange,
        const int iMaxNoOfSamples)
{
  float z; // s0
  float v7; // s2
  int v9; // r6
  __int64 v10; // r0
  const CVector *v11; // r5
  RwReal v12; // r5
  RwReal v13; // s18
  RwReal v14; // s16
  RwReal v15; // s20
  float v16; // r0
  int v17; // r6
  int v18; // r9
  float v19; // s8
  float v20; // s4
  float v21; // s16
  const CVector *v22; // r0
  float v23; // r1
  float v24; // s0
  int v25; // r10
  float v26; // s22
  float x; // s6
  float y; // s8
  CEntity *v30; // [sp+1Ch] [bp-8Ch] BYREF
  CColPoint vecStart; // [sp+20h] [bp-88h] BYREF
  CVector v32; // [sp+4Ch] [bp-5Ch] BYREF
  float pWaterZ; // [sp+58h] [bp-50h] BYREF
  CVector vecEnd; // [sp+5Ch] [bp-4Ch] BYREF

  z = vEnd->z;
  v7 = vStart->z;
  v9 = 0;
  if ( fabsf(v7 - z) > fMaxHeightChange )
    return v9;
  v10 = *(_QWORD *)&vEnd->x;
  v11 = vEnd;
  if ( v7 < z )
    v11 = vStart;
  v12 = v11->z;
  *(_QWORD *)&vecStart.m_vecPosition.x = *(_QWORD *)&vStart->x;
  vecStart.m_vecPosition.z = v12;
  *(_QWORD *)&vecEnd.x = v10;
  vecEnd.z = v12;
  v9 = 1;
  if ( !CWorld::GetIsLineOfSightClear(&vecStart.m_vecPosition, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
    return v9;
  v13 = vEnd->x - vStart->x;
  v14 = vEnd->y - vStart->y;
  v15 = vEnd->z - vStart->z;
  v16 = floorf(sqrtf((float)((float)(v13 * v13) + (float)(v14 * v14)) + (float)(v15 * v15)));
  vecEnd.y = v14;
  vecEnd.x = v13;
  vecEnd.z = v15;
  v17 = (int)v16;
  if ( (int)v16 > iMaxNoOfSamples )
    v17 = iMaxNoOfSamples;
  if ( !v17 )
    return 4;
  CVector::Normalise(&vecEnd);
  if ( v17 < 2 )
  {
LABEL_15:
    pWaterZ = 0.0;
    if ( !CWorld::ProcessVerticalLine(vStart, vStart->z + -5.0, &vecStart, (CEntity **)&pWaterZ, 1, 0, 0, 0, 0, 0, 0) )
      return 3;
    if ( v17 >= 2 )
    {
      v24 = vecStart.m_vecPosition.z;
      v25 = 1;
      while ( 1 )
      {
        v26 = v24 + 0.5;
        x = vStart->x;
        y = vStart->y;
        v32.z = v24 + 0.5;
        v32.x = (float)(vecEnd.x * (float)v25) + x;
        v32.y = (float)(vecEnd.y * (float)v25) + y;
        if ( !CWorld::ProcessVerticalLine(
                &v32,
                (float)(v24 + 0.5) + -2.0,
                &vecStart,
                (CEntity **)&pWaterZ,
                1,
                0,
                0,
                0,
                0,
                0,
                0) )
          break;
        v24 = vecStart.m_vecPosition.z;
        if ( fabsf(vecStart.m_vecPosition.z - v26) > 1.0 )
          break;
        if ( ++v25 >= v17 )
          return 4;
      }
      return 3;
    }
    return 4;
  }
  v18 = 1;
  while ( 1 )
  {
    v19 = vStart->y;
    v20 = vecEnd.y * (float)v18;
    v21 = (float)(vecEnd.x * (float)v18) + vStart->x;
    if ( CWaterLevel::GetWaterLevel(v21, v20 + v19, (float)(vecEnd.z * (float)v18) + vStart->z, &pWaterZ, 0, 0) == 1 )
    {
      v32.y = v20 + v19;
      v32.x = v21;
      v32.z = pWaterZ;
      v22 = vEnd;
      if ( vStart->z > vEnd->z )
        v22 = vStart;
      v23 = v22->z;
      v30 = 0;
      if ( !CWorld::ProcessVerticalLine(&v32, v23, &vecStart, &v30, 1, 0, 0, 0, 0, 0, 0) )
        return 2;
    }
    if ( ++v18 >= v17 )
      goto LABEL_15;
  }
}

//----- (004B0D7E) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeMoveDirToAvoidEntity(const CPed *ped, CEntity *entity, CVector *vMoveDir)
{
  CSimpleTransform *p_m_transform; // r4
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2
  _BOOL4 v8; // r0
  CMatrix *v9; // r0
  float y; // s6
  float z; // s4
  float v12; // s0
  float v13; // s2
  __int64 v14; // d16
  RwReal v15; // r0
  float v16[4]; // [sp+0h] [bp-88h] BYREF
  CVector out_normals; // [sp+10h] [bp-78h] BYREF
  __int64 v18; // [sp+1Ch] [bp-6Ch]
  RwReal v19; // [sp+24h] [bp-64h]
  __int64 v20; // [sp+34h] [bp-54h]
  RwReal v21; // [sp+3Ch] [bp-4Ch]
  CVector corners; // [sp+40h] [bp-48h] BYREF

  p_m_transform = &ped->m_transform;
  m_pMat = ped->m_pMat;
  p_tx = p_m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v8 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(p_tx->m_translate.z, entity, &corners);
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(*(const float *)&v8, &corners, &out_normals, v16);
  v9 = ped->m_pMat;
  if ( v9 )
    p_m_transform = (CSimpleTransform *)&v9->tx;
  y = p_m_transform->m_translate.y;
  z = p_m_transform->m_translate.z;
  v12 = v16[1]
      + (float)((float)((float)(*(float *)&v18 * p_m_transform->m_translate.x) + (float)(*((float *)&v18 + 1) * y))
              + (float)(v19 * z));
  if ( v12 <= 0.0
    && ((v13 = v16[3]
             + (float)((float)((float)(p_m_transform->m_translate.x * *(float *)&v20) + (float)(y * *((float *)&v20 + 1)))
                     + (float)(z * v21)),
         v13 > 0.0)
     || v12 <= v13) )
  {
    v15 = v21;
    v14 = v20;
  }
  else
  {
    v14 = v18;
    v15 = v19;
  }
  vMoveDir->z = v15;
  *(_QWORD *)&vMoveDir->x = v14;
}

//----- (004B0E5C) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::CanPedJumpObstacle(
        const CPed *ped,
        const CEntity *entity,
        const CVector *vContactNormal,
        const CVector *vContactPos)
{
  float32x2_t v4; // d2
  float32x2_t v5; // d3
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2
  __int64 v10; // d16
  float xy; // s20
  float yy; // s18
  float zy; // s16
  float z; // s2
  CCollisionData *m_pColData; // r0
  float v17; // s0
  float y; // s8
  float v19; // s1
  float v20; // s2
  float v21; // s10
  float v22; // s8
  float v23; // s2
  float v24; // s4
  float m_fRadius; // s8
  float v26; // s16
  CVector vecEnd; // [sp+14h] [bp-44h] BYREF
  CVector vecStart; // [sp+20h] [bp-38h] BYREF

  m_pMat = ped->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &ped->m_transform;
  v10 = *(_QWORD *)&p_tx->m_translate.x;
  vecStart.z = p_tx->m_translate.z;
  *(_QWORD *)&vecStart.x = v10;
  if ( (*((_BYTE *)&entity->m_nFlags + 2) & 0x40) != 0 )
    return 0;
  xy = m_pMat->xy;
  yy = m_pMat->yy;
  zy = m_pMat->zy;
  if ( SurfaceInfos_c::IsShallowWater(&g_surfaceInfos, ped->m_LastMaterialToHaveBeenStandingOn) )
    return 1;
  z = vContactNormal->z;
  if ( z <= 0.17 )
  {
    v17 = vecStart.z;
    if ( !CPedGroups::IsInPlayersGroup(ped) )
    {
      v17 = vecStart.z + -0.15;
      vecStart.z = vecStart.z + -0.15;
    }
  }
  else
  {
    if ( z > 0.9 )
      return 0;
    m_pColData = CModelInfo::ms_modelInfoPtrs[ped->m_nModelIndex]->m_pColModel->m_pColData;
    v17 = vecStart.z
        + (float)(m_pColData->m_pSphereArray->m_vecCentre.z - (float)(z * m_pColData->m_pSphereArray->m_fRadius));
    vecStart.z = v17;
    v5.n64_u32[0] = LODWORD(vContactNormal->x);
    y = vContactNormal->y;
    v4.n64_f32[0] = sqrtf((float)(v5.n64_f32[0] * v5.n64_f32[0]) + (float)(y * y));
    if ( z <= 0.5 )
    {
      m_fRadius = m_pColData->m_pSphereArray->m_fRadius;
      zy = zy + (float)((float)(zy * v4.n64_f32[0]) * m_fRadius);
      yy = yy + (float)((float)(yy * v4.n64_f32[0]) * m_fRadius);
      xy = xy + (float)((float)(xy * v4.n64_f32[0]) * m_fRadius);
    }
    else
    {
      v19 = m_pColData->m_pSphereArray->m_fRadius;
      v20 = v5.n64_f32[0] * (float)(1.0 / v4.n64_f32[0]);
      v5.n64_f32[0] = 2.0 / v4.n64_f32[0];
      v21 = (float)((float)(1.0 / v4.n64_f32[0]) * 0.0)
          + (float)((float)(v4.n64_f32[0] * (float)((float)(1.0 / v4.n64_f32[0]) * 0.0)) * v19);
      v22 = (float)-(float)((float)(v4.n64_f32[0] * (float)(y * (float)(1.0 / v4.n64_f32[0]))) * v19)
          - (float)(y * (float)(1.0 / v4.n64_f32[0]));
      v23 = (float)-(float)((float)(v4.n64_f32[0] * v20) * v19) - v20;
      v4.n64_u32[0] = 4.0;
      v24 = vmin_f32(v5, v4).n64_f32[0];
      zy = v24 * v21;
      yy = v24 * v22;
      xy = v24 * v23;
    }
  }
  vecEnd.z = zy + v17;
  vecEnd.x = xy + vecStart.x;
  vecEnd.y = yy + vecStart.y;
  if ( CWorld::GetIsLineOfSightClear(&vecStart, &vecEnd, 1, 0, 0, 1, 0, 0, 0) )
  {
    LOBYTE(vecEnd.x) = 0;
    v26 = (float)(zy * 3.0) + vecStart.z;
    if ( (float)(v26
               - CWorld::FindGroundZFor3DCoord(
                   (float)(xy * 3.0) + vecStart.x,
                   (float)(yy * 3.0) + vecStart.y,
                   v26,
                   (bool *)&vecEnd,
                   0)) < 3.0 )
    {
      if ( LOBYTE(vecEnd.x) )
        return 1;
    }
  }
  return 0;
}
// 4B0F76: variable 'v5' is possibly undefined
// 4B0F76: variable 'v4' is possibly undefined

//----- (004B1090) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::CanPedJumpObstacle(const CPed *ped, const CEntity *entity)
{
  bool result; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  float yy; // s2
  float zy; // s4
  float y; // s8
  float z; // s10
  CVector vecEnd; // [sp+14h] [bp-14h] BYREF

  result = 0;
  if ( (*((_BYTE *)&entity->m_nFlags + 2) & 0x40) == 0 )
  {
    m_pMat = ped->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    yy = m_pMat->yy;
    zy = m_pMat->zy;
    if ( !m_pMat )
      p_tx = &ped->m_transform;
    y = p_tx->m_translate.y;
    z = p_tx->m_translate.z;
    vecEnd.x = p_tx->m_translate.x + m_pMat->xy;
    vecEnd.y = y + yy;
    vecEnd.z = z + zy;
    return CWorld::GetIsLineOfSightClear(&p_tx->m_translate, &vecEnd, 1, 0, 0, 1, 0, 0, 0);
  }
  return result;
}

//----- (004B1100) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::CanPedTargetPoint(
        const CPed *ped,
        const CVector *vTarget,
        const bool bUseDirectionTest)
{
  CMatrix *m_pMat; // r12
  CSimpleTransform *p_tx; // r3
  float x; // s0
  float y; // s4
  float z; // s2
  float v8; // s8
  float v9; // s10
  float v10; // s6
  bool result; // r0
  CVector vecStart; // [sp+14h] [bp-14h] BYREF

  m_pMat = ped->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &ped->m_transform;
  x = p_tx->m_translate.x;
  y = p_tx->m_translate.y;
  z = p_tx->m_translate.z;
  v8 = vTarget->x - p_tx->m_translate.x;
  v9 = vTarget->y - y;
  v10 = vTarget->z - z;
  if ( bUseDirectionTest
    && (float)((float)((float)(v8 * m_pMat->xy) + (float)(v9 * m_pMat->yy)) + (float)(v10 * m_pMat->zy)) < 0.0 )
  {
    return 0;
  }
  result = 0;
  if ( (float)((float)((float)(v8 * v8) + (float)(v9 * v9)) + (float)(v10 * v10)) <= 1600.0 )
  {
    vecStart.y = y + 0.0;
    vecStart.x = x + 0.0;
    vecStart.z = z + 0.75;
    return CWorld::GetIsLineOfSightClear(&vecStart, vTarget, 1, 0, 0, 1, 0, 1, 0);
  }
  return result;
}

//----- (004B11D8) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::CanPedTargetPed(CPed *targetter, CPed *targettee, const bool bUseDirectionTest)
{
  CMatrix *m_pMat; // r0
  _BOOL4 v5; // r4
  CSimpleTransform *p_tx; // r2
  float v7; // s20
  float v8; // s22
  float v9; // s24
  CMatrix *v10; // r0
  CSimpleTransform *p_m_transform; // r1
  float x; // s0
  float y; // s4
  float z; // s2
  float v15; // s8
  float v16; // s10
  float v17; // s6
  bool result; // r0
  CVector vecEnd; // [sp+18h] [bp-48h] BYREF
  CVector vecStart; // [sp+24h] [bp-3Ch] BYREF

  m_pMat = targettee->m_pMat;
  v5 = bUseDirectionTest;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &targettee->m_transform;
  v7 = p_tx->m_translate.x + 0.0;
  v8 = p_tx->m_translate.y + 0.0;
  v9 = p_tx->m_translate.z + 0.75;
  vecEnd.y = v8;
  vecEnd.x = v7;
  vecEnd.z = v9;
  if ( CTaskManager::GetTaskSecondary(&targettee->m_pPedIntelligence->m_taskManager, 1) )
  {
    v9 = v9 + -1.0;
    vecEnd.z = v9;
  }
  v10 = targetter->m_pMat;
  p_m_transform = (CSimpleTransform *)&v10->tx;
  if ( !v10 )
    p_m_transform = &targetter->m_transform;
  x = p_m_transform->m_translate.x;
  y = p_m_transform->m_translate.y;
  z = p_m_transform->m_translate.z;
  v15 = v7 - p_m_transform->m_translate.x;
  v16 = v8 - y;
  v17 = v9 - z;
  if ( v5 && (float)((float)((float)(v15 * v10->xy) + (float)(v16 * v10->yy)) + (float)(v17 * v10->zy)) < 0.0 )
    return 0;
  result = 0;
  if ( (float)((float)((float)(v15 * v15) + (float)(v16 * v16)) + (float)(v17 * v17)) <= 1600.0 )
  {
    vecStart.y = y + 0.0;
    vecStart.x = x + 0.0;
    vecStart.z = z + 0.75;
    return CWorld::GetIsLineOfSightClear(&vecStart, &vecEnd, 1, 0, 0, 1, 0, 1, 0);
  }
  return result;
}

//----- (004B12F4) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::IsInAir(const CPed *ped)
{
  CTask *SimplestActiveTask; // r0
  CTask *ActiveTask; // r0
  _BOOL4 v5; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v8; // d16
  _BOOL4 v9; // r0
  bool v10; // zf
  CEntity *refEntityPtr; // [sp+20h] [bp-50h] BYREF
  CColPoint colPoint; // [sp+24h] [bp-4Ch] BYREF
  CVector vecStart; // [sp+50h] [bp-20h] BYREF

  if ( *((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31 )
    return 0;
  if ( CTaskManager::GetActiveTask(&ped->m_pPedIntelligence->m_taskManager) )
  {
    if ( CPedIntelligence::GetTaskSwim(ped->m_pPedIntelligence) )
      return 0;
    if ( CPedIntelligence::GetTaskJetPack(ped->m_pPedIntelligence) )
      return 0;
    SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) == 254 )
      return 0;
  }
  if ( CTaskManager::GetActiveTask(&ped->m_pPedIntelligence->m_taskManager) )
  {
    ActiveTask = CTaskManager::GetActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    v5 = (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 211;
  }
  else
  {
    v5 = 0;
  }
  m_pMat = ped->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &ped->m_transform;
  v8 = *(_QWORD *)&p_tx->m_translate.x;
  vecStart.z = p_tx->m_translate.z;
  *(_QWORD *)&vecStart.x = v8;
  v9 = CWorld::ProcessVerticalLine(&vecStart, p_tx->m_translate.z + -1.5, &colPoint, &refEntityPtr, 1, 1, 0, 1, 0, 0, 0);
  v10 = !v5;
  if ( !v5 )
    v10 = !v9;
  if ( v10 )
  {
    vecStart.z = vecStart.z + -1.0;
    LOBYTE(v9) = CWorld::TestSphereAgainstWorld(vecStart, 0.15, &ped->CPhysical, 1, 0, 0, 0, 0, 0) != 0;
  }
  return !v9;
}

//----- (004B1400) --------------------------------------------------------
const CPed *__fastcall CPedGeometryAnalyser::GetNearestPed(const CVector *vPos)
{
  float32x2_t v1; // d1
  float32x2_t v2; // d2
  int32 m_nSize; // r2
  float32x2_t v4; // d16
  float x; // s0
  const CPed *result; // r0
  int v7; // r1
  int i; // r4
  const CPed *v9; // r1
  CMatrix *m_pMat; // r4
  CSimpleTransform *p_tx; // r5
  float32x2_t v12; // d17
  unsigned __int64 v13; // d3
  bool v14; // nf

  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( !m_nSize )
    return 0;
  v1.n64_u32[0] = 2139095039;
  v4.n64_u64[0] = *(unsigned __int64 *)&vPos->y;
  x = vPos->x;
  result = 0;
  do
  {
    v7 = 1996 * m_nSize--;
    for ( i = v7 - 1996; ; i -= 1996 )
    {
      if ( (CPools::ms_pPedPool->m_aFlags[m_nSize] & 0x80u) == 0 )
      {
        v9 = (const CPed *)&(*CPools::ms_pPedPool->m_aStorage)[i];
        if ( v9 )
          break;
      }
      if ( --m_nSize == -1 )
        return result;
    }
    m_pMat = v9->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v9->m_transform;
    v12.n64_u64[0] = vsub_f32(v4, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
    v13 = vmul_f32(v12, v12).n64_u64[0];
    v2.n64_f32[0] = (float)((float)((float)(x - p_tx->m_translate.x) * (float)(x - p_tx->m_translate.x)) + *(float *)&v13)
                  + *((float *)&v13 + 1);
    v14 = v2.n64_f32[0] < v1.n64_f32[0];
    v1.n64_u64[0] = vmin_f32(v2, v1).n64_u64[0];
    if ( v14 )
      result = v9;
  }
  while ( m_nSize );
  return result;
}
// 4B147C: variable 'v2' is possibly undefined
// 4B147C: variable 'v1' is possibly undefined

//----- (004B14A4) --------------------------------------------------------
void __fastcall CPedGeometryAnalyser::ComputeClearTarget(
        const CPed *ped,
        const CVector *vTarget,
        CVector *vClearTarget)
{
  __int64 v3; // d16
  float32x2_t *p_y; // r6
  CMatrix *m_pMat; // r0
  int v8; // r8
  CSimpleTransform *p_tx; // r10
  CEntity **m_entities; // r9
  CEntity *v11; // r5
  CMatrix *v12; // r0
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v14; // d16
  unsigned __int64 v15; // d1
  float y; // s4
  float z; // s6
  RwReal v18; // s4
  RwReal v19; // s0
  int v20; // r8
  CEntity **v21; // r9
  CEntity *v22; // r5
  CMatrix *v23; // r0
  CSimpleTransform *v24; // r1
  float32x2_t v25; // d16
  unsigned __int64 v26; // d1
  float v27; // s4
  float v28; // s6
  RwReal v29; // s4
  RwReal v30; // s0
  float v31; // s2
  float v32; // s4
  int v33; // r11
  int v34; // r6
  float v35; // s0
  float v36; // s2
  float v37; // s4
  RwReal v38; // s2
  RwReal v39; // s4
  CVector fIntersectionLength; // [sp+24h] [bp-64h] BYREF
  CEntity *refEntityPtr; // [sp+30h] [bp-58h] BYREF
  CColPoint v42; // [sp+34h] [bp-54h] BYREF

  v3 = *(_QWORD *)&vTarget->x;
  vClearTarget->z = vTarget->z;
  *(_QWORD *)&vClearTarget->x = v3;
  p_y = (float32x2_t *)&vClearTarget->y;
  m_pMat = ped->m_pMat;
  v8 = 0;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  m_entities = ped->m_pPedIntelligence->m_vehicleScanner.m_entities;
  if ( !m_pMat )
    p_tx = &ped->m_transform;
  do
  {
    v11 = m_entities[v8];
    if ( v11 )
    {
      v12 = v11->m_pMat;
      p_m_transform = (CSimpleTransform *)&v12->tx;
      if ( !v12 )
        p_m_transform = &v11->m_transform;
      v14.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, (float32x2_t)p_y->n64_u64[0]).n64_u64[0];
      v15 = vmul_f32(v14, v14).n64_u64[0];
      if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - vClearTarget->x)
                                 * (float)(p_m_transform->m_translate.x - vClearTarget->x))
                         + *(float *)&v15)
                 + *((float *)&v15 + 1)) < 25.0
        && CPedGeometryAnalyser::LiesInsideBoundingBox(ped, vClearTarget, m_entities[v8])
        && !CPedGeometryAnalyser::GetIsLineOfSightClear(ped, vClearTarget, v11, &fIntersectionLength.x) )
      {
        y = vClearTarget->y;
        z = vClearTarget->z;
        v42.m_vecPosition.x = vClearTarget->x - p_tx->m_translate.x;
        v42.m_vecPosition.y = y - p_tx->m_translate.y;
        v42.m_vecPosition.z = z - p_tx->m_translate.z;
        CVector::Normalise(&v42.m_vecPosition);
        v42.m_vecPosition.x = v42.m_vecPosition.x
                            * (float)(fIntersectionLength.x + CPedGeometryAnalyser::ms_fPedNominalRadius);
        v42.m_vecPosition.y = (float)(fIntersectionLength.x + CPedGeometryAnalyser::ms_fPedNominalRadius)
                            * v42.m_vecPosition.y;
        v18 = vClearTarget->y - v42.m_vecPosition.y;
        v19 = vClearTarget->z
            - (float)((float)(fIntersectionLength.x + CPedGeometryAnalyser::ms_fPedNominalRadius) * v42.m_vecPosition.z);
        vClearTarget->x = vClearTarget->x - v42.m_vecPosition.x;
        vClearTarget->y = v18;
        vClearTarget->z = v19;
      }
    }
    ++v8;
  }
  while ( v8 != 16 );
  v20 = 0;
  v21 = ped->m_pPedIntelligence->m_pedScanner.m_entities;
  do
  {
    v22 = v21[v20];
    if ( v22 )
    {
      v23 = v22->m_pMat;
      v24 = (CSimpleTransform *)&v23->tx;
      if ( !v23 )
        v24 = &v22->m_transform;
      v25.n64_u64[0] = vsub_f32(*(float32x2_t *)&v24->m_translate.y, (float32x2_t)p_y->n64_u64[0]).n64_u64[0];
      v26 = vmul_f32(v25, v25).n64_u64[0];
      if ( (float)((float)((float)((float)(v24->m_translate.x - vClearTarget->x)
                                 * (float)(v24->m_translate.x - vClearTarget->x))
                         + *(float *)&v26)
                 + *((float *)&v26 + 1)) < 25.0
        && CPedGeometryAnalyser::LiesInsideBoundingBox(ped, vClearTarget, v21[v20])
        && !CPedGeometryAnalyser::GetIsLineOfSightClear(ped, vClearTarget, v22, &fIntersectionLength.x) )
      {
        v27 = vClearTarget->y;
        v28 = vClearTarget->z;
        v42.m_vecPosition.x = vClearTarget->x - p_tx->m_translate.x;
        v42.m_vecPosition.y = v27 - p_tx->m_translate.y;
        v42.m_vecPosition.z = v28 - p_tx->m_translate.z;
        CVector::Normalise(&v42.m_vecPosition);
        v42.m_vecPosition.x = v42.m_vecPosition.x
                            * (float)(fIntersectionLength.x + CPedGeometryAnalyser::ms_fPedNominalRadius);
        v42.m_vecPosition.y = (float)(fIntersectionLength.x + CPedGeometryAnalyser::ms_fPedNominalRadius)
                            * v42.m_vecPosition.y;
        v29 = vClearTarget->y - v42.m_vecPosition.y;
        v30 = vClearTarget->z
            - (float)((float)(fIntersectionLength.x + CPedGeometryAnalyser::ms_fPedNominalRadius) * v42.m_vecPosition.z);
        vClearTarget->x = vClearTarget->x - v42.m_vecPosition.x;
        vClearTarget->y = v29;
        vClearTarget->z = v30;
      }
    }
    ++v20;
  }
  while ( v20 != 16 );
  v31 = vClearTarget->y;
  v32 = vClearTarget->z;
  fIntersectionLength.x = p_tx->m_translate.x - vClearTarget->x;
  fIntersectionLength.y = p_tx->m_translate.y - v31;
  fIntersectionLength.z = p_tx->m_translate.z - v32;
  CVector::Normalise(&fIntersectionLength);
  fIntersectionLength.x = CPedGeometryAnalyser::ms_fPedNominalRadius * fIntersectionLength.x;
  fIntersectionLength.y = CPedGeometryAnalyser::ms_fPedNominalRadius * fIntersectionLength.y;
  fIntersectionLength.z = CPedGeometryAnalyser::ms_fPedNominalRadius * fIntersectionLength.z;
  v33 = (int)(float)(5.0 / CPedGeometryAnalyser::ms_fPedNominalRadius);
  if ( v33 >= 0 )
  {
    v34 = -1;
    do
    {
      v35 = p_tx->m_translate.x - vClearTarget->x;
      v36 = p_tx->m_translate.y - vClearTarget->y;
      v37 = p_tx->m_translate.z - vClearTarget->z;
      if ( (float)((float)((float)(v35 * v35) + (float)(v36 * v36)) + (float)(v37 * v37)) >= 25.0 )
        break;
      if ( (float)((float)((float)(v35 * fIntersectionLength.x) + (float)(v36 * fIntersectionLength.y))
                 + (float)(v37 * fIntersectionLength.z)) < 0.0 )
        break;
      CWorld::ProcessLineOfSight(&p_tx->m_translate, vClearTarget, &v42, &refEntityPtr, 1, 0, 0, 0, 1, 0, 0, 0);
      if ( (int)CWorld::ms_iProcessLineNumCrossings % 2 != 1 )
        break;
      ++v34;
      v38 = fIntersectionLength.y + vClearTarget->y;
      v39 = fIntersectionLength.z + vClearTarget->z;
      vClearTarget->x = fIntersectionLength.x + vClearTarget->x;
      vClearTarget->y = v38;
      vClearTarget->z = v39;
    }
    while ( v34 < v33 );
  }
}

//----- (004B186C) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::LiesInsideBoundingBox(const CPed *ped, const CVector *vPos, CEntity *entity)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  float32x2_t v6; // d16
  unsigned __int64 v7; // d1
  CColModel *m_pColModel; // r1
  CMatrix *v9; // r1
  CSimpleTransform *p_m_transform; // r3
  _BOOL4 v11; // r0
  float x; // s0
  float y; // s4
  float z; // s2
  float v16[4]; // [sp+0h] [bp-78h] BYREF
  CVector out_normals; // [sp+10h] [bp-68h] BYREF
  float v18; // [sp+1Ch] [bp-5Ch]
  float v19; // [sp+20h] [bp-58h]
  float v20; // [sp+24h] [bp-54h]
  float v21; // [sp+28h] [bp-50h]
  float v22; // [sp+2Ch] [bp-4Ch]
  float v23; // [sp+30h] [bp-48h]
  float v24; // [sp+34h] [bp-44h]
  float v25; // [sp+38h] [bp-40h]
  float v26; // [sp+3Ch] [bp-3Ch]
  CVector corners; // [sp+40h] [bp-38h] BYREF

  m_pMat = entity->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &entity->m_transform;
  v6.n64_u64[0] = vsub_f32(*(float32x2_t *)&vPos->y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
  v7 = vmul_f32(v6, v6).n64_u64[0];
  m_pColModel = CModelInfo::ms_modelInfoPtrs[entity->m_nModelIndex]->m_pColModel;
  if ( (float)((float)((float)((float)(vPos->x - p_tx->m_translate.x) * (float)(vPos->x - p_tx->m_translate.x))
                     + *(float *)&v7)
             + *((float *)&v7 + 1)) >= (float)(m_pColModel->m_sphereBound.m_fRadius
                                             * m_pColModel->m_sphereBound.m_fRadius) )
    return 0;
  v9 = ped->m_pMat;
  p_m_transform = (CSimpleTransform *)&v9->tx;
  if ( !v9 )
    p_m_transform = &ped->m_transform;
  v11 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(p_m_transform->m_translate.z, entity, &corners);
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(*(const float *)&v11, &corners, &out_normals, v16);
  x = vPos->x;
  y = vPos->y;
  z = vPos->z;
  return (float)(v16[0]
               + (float)((float)((float)(vPos->x * out_normals.x) + (float)(y * out_normals.y))
                       + (float)(z * out_normals.z))) < 0.0
      || (float)(v16[1] + (float)((float)((float)(x * v18) + (float)(y * v19)) + (float)(z * v20))) < 0.0
      || (float)(v16[2] + (float)((float)((float)(x * v21) + (float)(y * v22)) + (float)(z * v23))) < 0.0
      || (float)(v16[3] + (float)((float)((float)(x * v24) + (float)(y * v25)) + (float)(z * v26))) < 0.0;
}

//----- (004B19D0) --------------------------------------------------------
int __fastcall CPedGeometryAnalyser::ComputeBuildingHitPoints(const CVector *vStart, const CVector *vTarget)
{
  CEntity *refEntityPtr; // [sp+20h] [bp-38h] BYREF
  CColPoint colPoint; // [sp+24h] [bp-34h] BYREF

  CWorld::ProcessLineOfSight(vStart, vTarget, &colPoint, &refEntityPtr, 1, 0, 0, 0, 1, 0, 0, 0);
  return CWorld::ms_iProcessLineNumCrossings;
}

//----- (004B1A04) --------------------------------------------------------
bool __fastcall CPedGeometryAnalyser::IsEntityBlockingTarget(CEntity *pEntity, const CVector *pos, float radius)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r5
  const float *p_z; // r5
  float32x2_t v8; // d17
  float32x2_t v9; // d16
  unsigned __int64 v11; // d1
  CColModel *m_pColModel; // r0
  _BOOL4 v13; // r0
  float x; // s0
  float y; // s4
  float z; // s2
  float v17; // s6
  float v19[4]; // [sp+0h] [bp-80h] BYREF
  CVector out_normals; // [sp+10h] [bp-70h] BYREF
  float v21; // [sp+1Ch] [bp-64h]
  float v22; // [sp+20h] [bp-60h]
  float v23; // [sp+24h] [bp-5Ch]
  float v24; // [sp+28h] [bp-58h]
  float v25; // [sp+2Ch] [bp-54h]
  float v26; // [sp+30h] [bp-50h]
  float v27; // [sp+34h] [bp-4Ch]
  float v28; // [sp+38h] [bp-48h]
  float v29; // [sp+3Ch] [bp-44h]
  CVector corners; // [sp+40h] [bp-40h] BYREF

  m_pMat = pEntity->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pEntity->m_transform;
  v8.n64_u64[0] = *(unsigned __int64 *)&p_tx->m_translate.x;
  p_z = &p_tx->m_translate.z;
  if ( fabsf(*p_z - pos->z) > 3.0 )
    return 0;
  v9.n64_u64[0] = vsub_f32(v8, *(float32x2_t *)&pos->x).n64_u64[0];
  v11 = vmul_f32(v9, v9).n64_u64[0];
  m_pColModel = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex]->m_pColModel;
  if ( sqrtf(*(float *)&v11 + *((float *)&v11 + 1)) > (float)((float)(radius * radius)
                                                            + (float)(m_pColModel->m_sphereBound.m_fRadius
                                                                    * m_pColModel->m_sphereBound.m_fRadius)) )
    return 0;
  v13 = CPedGeometryAnalyser::ComputeEntityBoundingBoxCornersUncached(*p_z, pEntity, &corners);
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanesUncached(*(const float *)&v13, &corners, &out_normals, v19);
  x = pos->x;
  y = pos->y;
  z = pos->z;
  v17 = radius * 0.5;
  return (float)((float)(radius * 0.5)
               + (float)(v19[0]
                       + (float)((float)((float)(out_normals.x * pos->x) + (float)(out_normals.y * y))
                               + (float)(out_normals.z * z)))) <= 0.0
      && (float)(v17 + (float)(v19[1] + (float)((float)((float)(v21 * x) + (float)(v22 * y)) + (float)(v23 * z)))) <= 0.0
      && (float)(v17 + (float)(v19[2] + (float)((float)((float)(v24 * x) + (float)(v25 * y)) + (float)(v26 * z)))) <= 0.0
      && (float)(v17 + (float)(v19[3] + (float)((float)((float)(v27 * x) + (float)(v28 * y)) + (float)(v29 * z)))) <= 0.0;
}

//----- (004B1BA0) --------------------------------------------------------
void __fastcall CPedGroupMembership::CPedGroupMembership(CPedGroupMembership *this)
{
  this->m_fMaxSeparation = 60.0;
  *(_QWORD *)&this->m_pMembers[4] = 0LL;
  *(_QWORD *)&this->m_pMembers[6] = 0LL;
  *(_QWORD *)this->m_pMembers = 0LL;
  *(_QWORD *)&this->m_pMembers[2] = 0LL;
}

//----- (004B1BBC) --------------------------------------------------------
void __fastcall CPedGroupMembership::CPedGroupMembership(CPedGroupMembership *this, const CPedGroupMembership *src)
{
  CPedGroupMembership::From(this, src);
}

//----- (004B1BCA) --------------------------------------------------------
void __fastcall CPedGroupMembership::From(CPedGroupMembership *this, const CPedGroupMembership *src)
{
  CPed *v4; // r0
  CPed *v5; // r0
  CPed *v6; // r0
  CPed *v7; // r0
  CPed *v8; // r0
  CPed *v9; // r0
  CPed *v10; // r0
  CPed *v11; // r0

  v4 = src->m_pMembers[0];
  this->m_pMembers[0] = v4;
  CEntity::RegisterReference(v4, this->m_pMembers);
  if ( !CPed::IsPlayer(this->m_pMembers[0]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[0]->m_pPedIntelligence, 0);
  v5 = src->m_pMembers[1];
  this->m_pMembers[1] = v5;
  CEntity::RegisterReference(v5, &this->m_pMembers[1]);
  if ( !CPed::IsPlayer(this->m_pMembers[1]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[1]->m_pPedIntelligence, 0);
  v6 = src->m_pMembers[2];
  this->m_pMembers[2] = v6;
  CEntity::RegisterReference(v6, &this->m_pMembers[2]);
  if ( !CPed::IsPlayer(this->m_pMembers[2]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[2]->m_pPedIntelligence, 0);
  v7 = src->m_pMembers[3];
  this->m_pMembers[3] = v7;
  CEntity::RegisterReference(v7, &this->m_pMembers[3]);
  if ( !CPed::IsPlayer(this->m_pMembers[3]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[3]->m_pPedIntelligence, 0);
  v8 = src->m_pMembers[4];
  this->m_pMembers[4] = v8;
  CEntity::RegisterReference(v8, &this->m_pMembers[4]);
  if ( !CPed::IsPlayer(this->m_pMembers[4]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[4]->m_pPedIntelligence, 0);
  v9 = src->m_pMembers[5];
  this->m_pMembers[5] = v9;
  CEntity::RegisterReference(v9, &this->m_pMembers[5]);
  if ( !CPed::IsPlayer(this->m_pMembers[5]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[5]->m_pPedIntelligence, 0);
  v10 = src->m_pMembers[6];
  this->m_pMembers[6] = v10;
  CEntity::RegisterReference(v10, &this->m_pMembers[6]);
  if ( !CPed::IsPlayer(this->m_pMembers[6]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[6]->m_pPedIntelligence, 0);
  v11 = src->m_pMembers[7];
  this->m_pMembers[7] = v11;
  CEntity::RegisterReference(v11, &this->m_pMembers[7]);
  if ( !CPed::IsPlayer(this->m_pMembers[7]) )
    CPedIntelligence::SetPedDecisionMakerType(this->m_pMembers[7]->m_pPedIntelligence, 0);
  this->m_pPedGroup = src->m_pPedGroup;
  this->m_fMaxSeparation = src->m_fMaxSeparation;
}

//----- (004B1CF4) --------------------------------------------------------
void __fastcall CPedGroupMembership::~CPedGroupMembership(CPedGroupMembership *this)
{
  CPedGroupMembership::Flush(this);
}

//----- (004B1D02) --------------------------------------------------------
void __fastcall CPedGroupMembership::Flush(CPedGroupMembership *this)
{
  if ( this->m_pMembers[0] )
    CPedGroupMembership::RemoveMember(this, 0);
  if ( this->m_pMembers[1] )
    CPedGroupMembership::RemoveMember(this, 1);
  if ( this->m_pMembers[2] )
    CPedGroupMembership::RemoveMember(this, 2);
  if ( this->m_pMembers[3] )
    CPedGroupMembership::RemoveMember(this, 3);
  if ( this->m_pMembers[4] )
    CPedGroupMembership::RemoveMember(this, 4);
  if ( this->m_pMembers[5] )
    CPedGroupMembership::RemoveMember(this, 5);
  if ( this->m_pMembers[6] )
    CPedGroupMembership::RemoveMember(this, 6);
  if ( this->m_pMembers[7] )
    CPedGroupMembership::RemoveMember(this, 7);
}

//----- (004B1D7C) --------------------------------------------------------
void __fastcall CPedGroupMembership::RemoveMember(CPedGroupMembership *this, const int iSlot)
{
  CPedGroup **v3; // r4
  CEntity *v4; // r0
  CEntity **v5; // r4
  CEntity *v6; // t1
  const CPed *v7; // r0
  CEntity *v8; // r0
  CEntity *v9; // r0
  CMatrix *m_pMat; // r2
  unsigned int v11; // r3
  int m_nFlags; // r12
  CPed *v13; // r0
  bool v14; // zf
  CEntity *v15; // r0
  RwObject_0 *m_pRwObject; // r3
  int v17; // r2
  int v18; // r5

  v3 = &this->m_pPedGroup + iSlot;
  v6 = (CEntity *)v3[1];
  v5 = (CEntity **)(v3 + 1);
  v4 = v6;
  if ( v6 )
  {
    CEntity::CleanUpOldReference(v4, v5);
    v7 = (const CPed *)*v5;
  }
  else
  {
    v7 = 0;
  }
  if ( !CPed::IsPlayer(v7) )
  {
    v8 = *v5;
    if ( (BYTE1((*v5)[19].m_pRwObject) & 0x20) != 0 )
    {
      CRadar::ClearBlipForEntity(
        BLIPTYPE_CHAR,
        CPools::ms_pPedPool->m_aFlags[-1093107909 * (((char *)v8 - (char *)CPools::ms_pPedPool->m_aStorage) >> 2)] | (-662750464 * (((char *)v8 - (char *)CPools::ms_pPedPool->m_aStorage) >> 2)));
      v9 = *v5;
      m_pMat = (*v5)[19].m_pMat;
      v11 = (int)(*v5)[19].m_pRwObject & 0xFFFFDFFF;
      m_nFlags = (int)(*v5)[19].m_nFlags;
      v9[19].m_transform.m_heading = (*v5)[19].m_transform.m_heading;
      v9[19].m_pMat = m_pMat;
      v9[19].m_pRwObject = (RwObject_0 *)v11;
      *(_DWORD *)&v9[19].m_nFlags = m_nFlags;
      v8 = *v5;
    }
    CPedIntelligence::RestorePedDecisionMakerType((CPedIntelligence *)LODWORD(v8[18].m_transform.m_translate.y));
    v13 = this->m_pMembers[7];
    v14 = v13 == 0;
    if ( v13 )
      v14 = v13->m_pPlayerData == 0;
    if ( !v14 )
    {
      v15 = *v5;
      m_pRwObject = (*v5)[19].m_pRwObject;
      v17 = (int)(*v5)[19].m_pMat | 0x100000;
      v18 = (int)(*v5)[19].m_nFlags;
      v15[19].m_transform.m_heading = (*v5)[19].m_transform.m_heading;
      v15[19].m_pMat = (CMatrix *)v17;
      v15[19].m_pRwObject = m_pRwObject;
      *(_DWORD *)&v15[19].m_nFlags = v18;
    }
  }
  *v5 = 0;
}

//----- (004B1E40) --------------------------------------------------------
void __fastcall CPedGroupMembership::RemoveAllFollowers(CPedGroupMembership *this, bool bLeaveMissionPeds)
{
  _BOOL4 v3; // r5
  CPed *v4; // r0
  bool v5; // zf
  CPed *v6; // r0
  bool v7; // zf
  CPed *v8; // r0
  bool v9; // zf
  CPed *v10; // r0
  bool v11; // zf
  CPed *v12; // r0
  bool v13; // zf
  CPed *v14; // r0
  bool v15; // zf
  CPed *v16; // r0
  bool v17; // zf

  v3 = bLeaveMissionPeds;
  v4 = this->m_pMembers[0];
  if ( v4 )
  {
    v5 = bLeaveMissionPeds;
    if ( bLeaveMissionPeds )
      v5 = v4->CharCreatedBy == 2;
    if ( !v5 )
      CPedGroupMembership::RemoveMember(this, 0);
  }
  v6 = this->m_pMembers[1];
  if ( v6 )
  {
    v7 = v3;
    if ( v3 )
      v7 = v6->CharCreatedBy == 2;
    if ( !v7 )
      CPedGroupMembership::RemoveMember(this, 1);
  }
  v8 = this->m_pMembers[2];
  if ( v8 )
  {
    v9 = v3;
    if ( v3 )
      v9 = v8->CharCreatedBy == 2;
    if ( !v9 )
      CPedGroupMembership::RemoveMember(this, 2);
  }
  v10 = this->m_pMembers[3];
  if ( v10 )
  {
    v11 = v3;
    if ( v3 )
      v11 = v10->CharCreatedBy == 2;
    if ( !v11 )
      CPedGroupMembership::RemoveMember(this, 3);
  }
  v12 = this->m_pMembers[4];
  if ( v12 )
  {
    v13 = v3;
    if ( v3 )
      v13 = v12->CharCreatedBy == 2;
    if ( !v13 )
      CPedGroupMembership::RemoveMember(this, 4);
  }
  v14 = this->m_pMembers[5];
  if ( v14 )
  {
    v15 = v3;
    if ( v3 )
      v15 = v14->CharCreatedBy == 2;
    if ( !v15 )
      CPedGroupMembership::RemoveMember(this, 5);
  }
  v16 = this->m_pMembers[6];
  if ( v16 )
  {
    v17 = v3;
    if ( v3 )
      v17 = v16->CharCreatedBy == 2;
    if ( !v17 )
      CPedGroupMembership::RemoveMember(this, 6);
  }
}

//----- (004B1EF8) --------------------------------------------------------
void __fastcall CPedGroupMembership::RemoveNFollowers(CPedGroupMembership *this, Int32 N)
{
  Int32 v2; // r5
  CPed *v4; // r0
  bool v5; // zf
  CPed *v6; // r0
  bool v7; // zf
  CPed *v8; // r0
  bool v9; // zf
  CPed *v10; // r0
  bool v11; // zf
  CPed *v12; // r0
  bool v13; // zf
  CPed *v14; // r0
  bool v15; // zf
  CPed *v16; // r0
  bool v17; // zf

  v2 = N;
  if ( N >= 1 )
  {
    v4 = this->m_pMembers[0];
    v5 = v4 == 0;
    if ( v4 )
      v5 = v4->CharCreatedBy == 2;
    if ( !v5 )
    {
      CPedGroupMembership::RemoveMember(this, 0);
      --v2;
    }
  }
  if ( v2 >= 1 )
  {
    v6 = this->m_pMembers[1];
    v7 = v6 == 0;
    if ( v6 )
      v7 = v6->CharCreatedBy == 2;
    if ( !v7 )
    {
      CPedGroupMembership::RemoveMember(this, 1);
      --v2;
    }
  }
  if ( v2 >= 1 )
  {
    v8 = this->m_pMembers[2];
    v9 = v8 == 0;
    if ( v8 )
      v9 = v8->CharCreatedBy == 2;
    if ( !v9 )
    {
      CPedGroupMembership::RemoveMember(this, 2);
      --v2;
    }
  }
  if ( v2 >= 1 )
  {
    v10 = this->m_pMembers[3];
    v11 = v10 == 0;
    if ( v10 )
      v11 = v10->CharCreatedBy == 2;
    if ( !v11 )
    {
      CPedGroupMembership::RemoveMember(this, 3);
      --v2;
    }
  }
  if ( v2 >= 1 )
  {
    v12 = this->m_pMembers[4];
    v13 = v12 == 0;
    if ( v12 )
      v13 = v12->CharCreatedBy == 2;
    if ( !v13 )
    {
      CPedGroupMembership::RemoveMember(this, 4);
      --v2;
    }
  }
  if ( v2 >= 1 )
  {
    v14 = this->m_pMembers[5];
    v15 = v14 == 0;
    if ( v14 )
      v15 = v14->CharCreatedBy == 2;
    if ( !v15 )
    {
      CPedGroupMembership::RemoveMember(this, 5);
      --v2;
    }
  }
  if ( v2 >= 1 )
  {
    v16 = this->m_pMembers[6];
    v17 = v16 == 0;
    if ( v16 )
      v17 = v16->CharCreatedBy == 2;
    if ( !v17 )
      CPedGroupMembership::RemoveMember(this, 6);
  }
}

//----- (004B1FC8) --------------------------------------------------------
void __fastcall CPedGroupMembership::AddMember(CPedGroupMembership *this, CPed *pPed, const int iSlot)
{
  CPedGroup **v3; // r4
  CEntity **v4; // r4

  v3 = &this->m_pPedGroup + iSlot;
  v3[1] = (CPedGroup *)pPed;
  v4 = (CEntity **)(v3 + 1);
  CEntity::RegisterReference(pPed, v4);
  if ( !CPed::IsPlayer((const CPed *)*v4) )
    sub_19EF84((CPedIntelligence *)LODWORD((*v4)[18].m_transform.m_translate.y), 0);
}

//----- (004B1FF8) --------------------------------------------------------
int32 CPedGroupMembership::GetObjectForPedToHold()
{
  int v0; // r0
  __int16 **v1; // r0

  v0 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0);
  if ( v0 > 32 )
  {
    if ( v0 > 65 )
      return -1;
    v1 = &MI_GANG_DRINK_ptr;
  }
  else
  {
    v1 = &MI_GANG_SMOKE_ptr;
  }
  return (unsigned __int16)**v1;
}
// 6778F8: using guessed type __int16 *MI_GANG_DRINK_ptr;
// 679000: using guessed type __int16 *MI_GANG_SMOKE_ptr;

//----- (004B2050) --------------------------------------------------------
void __fastcall CPedGroupMembership::SetLeader(CPedGroupMembership *this, CPed *pLeader)
{
  CPed *v4; // r0
  bool v5; // zf
  CPed *v6; // r0
  bool v7; // zf
  int v8; // r1
  const CPed **v9; // r6
  int v10; // r0
  __int16 **v11; // r0

  if ( pLeader )
  {
    if ( this->m_pMembers[0] == pLeader )
    {
      v8 = 0;
LABEL_26:
      CPedGroupMembership::RemoveMember(this, v8);
      goto LABEL_27;
    }
    if ( this->m_pMembers[1] == pLeader )
      goto LABEL_11;
    v4 = this->m_pMembers[2];
    v5 = v4 == pLeader;
    if ( v4 != pLeader )
      v5 = this->m_pMembers[3] == pLeader;
    if ( v5 )
      goto LABEL_11;
    v6 = this->m_pMembers[4];
    v7 = v6 == pLeader;
    if ( v6 != pLeader )
      v7 = this->m_pMembers[5] == pLeader;
    if ( v7 || this->m_pMembers[6] == pLeader )
    {
LABEL_11:
      if ( this->m_pMembers[1] == pLeader )
      {
        v8 = 1;
      }
      else if ( this->m_pMembers[2] == pLeader )
      {
        v8 = 2;
      }
      else if ( this->m_pMembers[3] == pLeader )
      {
        v8 = 3;
      }
      else if ( this->m_pMembers[4] == pLeader )
      {
        v8 = 4;
      }
      else if ( this->m_pMembers[5] == pLeader )
      {
        v8 = 5;
      }
      else if ( this->m_pMembers[6] == pLeader )
      {
        v8 = 6;
      }
      else
      {
        if ( this->m_pMembers[7] != pLeader )
          goto LABEL_27;
        v8 = 7;
      }
      goto LABEL_26;
    }
  }
LABEL_27:
  v9 = (const CPed **)&this->m_pMembers[7];
  if ( this->m_pMembers[7] )
    CPedGroupMembership::RemoveMember(this, 7);
  *v9 = pLeader;
  CEntity::RegisterReference(pLeader, &this->m_pMembers[7]);
  if ( !CPed::IsPlayer(*v9) )
    CPedIntelligence::SetPedDecisionMakerType((*v9)->m_pPedIntelligence, 0);
  if ( !this->m_pPedGroup->m_iGroupCreatedBy
    && pLeader->m_WeaponSlots[pLeader->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_UNARMED )
  {
    v10 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0);
    if ( v10 >= 33 )
    {
      if ( v10 > 65 )
        return;
      v11 = &MI_GANG_DRINK_ptr;
    }
    else
    {
      v11 = &MI_GANG_SMOKE_ptr;
    }
    sub_190A44(pLeader, (unsigned __int16)**v11, 1u);
  }
}
// 6778F8: using guessed type __int16 *MI_GANG_DRINK_ptr;
// 679000: using guessed type __int16 *MI_GANG_SMOKE_ptr;

//----- (004B2184) --------------------------------------------------------
bool __fastcall CPedGroupMembership::IsFollower(const CPedGroupMembership *this, const CPed *pFollower)
{
  CPed *v3; // r2
  bool v4; // zf
  CPed *v5; // r2
  bool v6; // zf
  CPed *v7; // r2
  bool v8; // zf

  if ( !pFollower )
    return 0;
  v3 = this->m_pMembers[0];
  v4 = v3 == pFollower;
  if ( v3 != pFollower )
    v4 = this->m_pMembers[1] == pFollower;
  if ( v4 )
    return 1;
  v5 = this->m_pMembers[2];
  v6 = v5 == pFollower;
  if ( v5 != pFollower )
    v6 = this->m_pMembers[3] == pFollower;
  if ( v6 )
    return 1;
  v7 = this->m_pMembers[4];
  v8 = v7 == pFollower;
  if ( v7 != pFollower )
    v8 = this->m_pMembers[5] == pFollower;
  return v8 || this->m_pMembers[6] == pFollower;
}

//----- (004B21C0) --------------------------------------------------------
void __fastcall CPedGroupMembership::RemoveMember(CPedGroupMembership *this, CPed *pMember)
{
  int v2; // r1

  if ( this->m_pMembers[0] == pMember )
  {
    v2 = 0;
LABEL_3:
    CPedGroupMembership::RemoveMember(this, v2);
    return;
  }
  if ( this->m_pMembers[1] == pMember )
  {
    v2 = 1;
    goto LABEL_3;
  }
  if ( this->m_pMembers[2] == pMember )
  {
    v2 = 2;
    goto LABEL_3;
  }
  if ( this->m_pMembers[3] == pMember )
  {
    v2 = 3;
    goto LABEL_3;
  }
  if ( this->m_pMembers[4] == pMember )
  {
    v2 = 4;
    goto LABEL_3;
  }
  if ( this->m_pMembers[5] == pMember )
  {
    v2 = 5;
    goto LABEL_3;
  }
  if ( this->m_pMembers[6] == pMember )
  {
    v2 = 6;
    goto LABEL_3;
  }
  if ( this->m_pMembers[7] == pMember )
  {
    v2 = 7;
    goto LABEL_3;
  }
}

//----- (004B2214) --------------------------------------------------------
void __fastcall CPedGroupMembership::AddFollower(CPedGroupMembership *this, CPed *pFollower)
{
  CPed *v2; // r12
  int m_nPedFlags; // r0
  int v6; // r2
  CPed *v7; // r3
  CPed *v8; // r1
  CPed *v9; // r6
  CPed *v10; // r0
  bool v11; // zf
  CPed *v12; // r2
  bool v13; // zf
  CPed *v14; // r8
  bool v15; // zf
  CPed *v16; // lr
  bool v17; // zf
  int v18; // r0
  CPedGroup **v19; // r6
  CEntity **v20; // r6
  int v21; // r0
  __int16 **v22; // r0

  m_nPedFlags = (int)pFollower->m_nPedFlags;
  v6 = *((_DWORD *)&pFollower->m_nPedFlags + 1);
  v7 = (CPed *)(*((_DWORD *)&pFollower->m_nPedFlags + 2) & 0xFDFFFFFF);
  v8 = (CPed *)*((_DWORD *)&pFollower->m_nPedFlags + 3);
  *((_DWORD *)&pFollower->m_nPedFlags + 2) = v7;
  v9 = this->m_pMembers[7];
  if ( v9 && v9->m_pPlayerData )
  {
    *(_DWORD *)&pFollower->m_nPedFlags = m_nPedFlags;
    *((_DWORD *)&pFollower->m_nPedFlags + 1) = v6 & 0xFFEFFFFF;
    *((_DWORD *)&pFollower->m_nPedFlags + 2) = v7;
    *((_DWORD *)&pFollower->m_nPedFlags + 3) = v8;
  }
  v10 = this->m_pMembers[0];
  v11 = v10 == pFollower;
  if ( v10 != pFollower )
  {
    v8 = this->m_pMembers[1];
    v11 = v8 == pFollower;
  }
  if ( !v11 )
  {
    v12 = this->m_pMembers[2];
    v13 = v12 == pFollower;
    if ( v12 != pFollower )
    {
      v7 = this->m_pMembers[3];
      v13 = v7 == pFollower;
    }
    if ( !v13 )
    {
      v14 = this->m_pMembers[4];
      v15 = v14 == pFollower;
      if ( v14 != pFollower )
      {
        v2 = this->m_pMembers[5];
        v15 = v2 == pFollower;
      }
      if ( !v15 )
      {
        v16 = this->m_pMembers[6];
        v17 = v16 == pFollower;
        if ( v16 != pFollower )
          v17 = this->m_pMembers[7] == pFollower;
        if ( !v17 )
        {
          if ( v10 )
          {
            if ( v8 )
            {
              if ( v12 )
              {
                if ( v7 )
                {
                  if ( v14 )
                  {
                    if ( v2 )
                    {
                      if ( v16 )
                        return;
                      v18 = 6;
                    }
                    else
                    {
                      v18 = 5;
                    }
                  }
                  else
                  {
                    v18 = 4;
                  }
                }
                else
                {
                  v18 = 3;
                }
              }
              else
              {
                v18 = 2;
              }
            }
            else
            {
              v18 = 1;
            }
          }
          else
          {
            v18 = 0;
          }
          v19 = &this->m_pPedGroup + v18;
          v19[1] = (CPedGroup *)pFollower;
          v20 = (CEntity **)(v19 + 1);
          CEntity::RegisterReference(pFollower, v20);
          if ( !CPed::IsPlayer((const CPed *)*v20) )
            CPedIntelligence::SetPedDecisionMakerType(
              (CPedIntelligence *)LODWORD((*v20)[18].m_transform.m_translate.y),
              0);
          if ( !this->m_pPedGroup->m_iGroupCreatedBy
            && pFollower->m_WeaponSlots[pFollower->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_UNARMED )
          {
            v21 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0);
            if ( v21 >= 33 )
            {
              if ( v21 > 65 )
                return;
              v22 = &MI_GANG_DRINK_ptr;
            }
            else
            {
              v22 = &MI_GANG_SMOKE_ptr;
            }
            sub_190A44(pFollower, (unsigned __int16)**v22, 1u);
          }
        }
      }
    }
  }
}
// 4B229A: variable 'v2' is possibly undefined
// 6778F8: using guessed type __int16 *MI_GANG_DRINK_ptr;
// 679000: using guessed type __int16 *MI_GANG_SMOKE_ptr;

//----- (004B235C) --------------------------------------------------------
CPed *__fastcall CPedGroupMembership::GetLeader(const CPedGroupMembership *this)
{
  return this->m_pMembers[7];
}

//----- (004B2360) --------------------------------------------------------
bool __fastcall CPedGroupMembership::IsMember(const CPedGroupMembership *this, const CPed *pMember)
{
  CPed *v3; // r2
  bool v4; // zf
  CPed *v5; // r2
  bool v6; // zf
  CPed *v7; // r2
  bool v8; // zf

  if ( !pMember )
    return 0;
  if ( this->m_pMembers[0] == pMember )
    return 1;
  v3 = this->m_pMembers[1];
  v4 = v3 == pMember;
  if ( v3 != pMember )
    v4 = this->m_pMembers[2] == pMember;
  if ( v4 )
    return 1;
  v5 = this->m_pMembers[3];
  v6 = v5 == pMember;
  if ( v5 != pMember )
    v6 = this->m_pMembers[4] == pMember;
  if ( v6 )
    return 1;
  v7 = this->m_pMembers[5];
  v8 = v7 == pMember;
  if ( v7 != pMember )
    v8 = this->m_pMembers[6] == pMember;
  if ( v8 )
    return 1;
  return this->m_pMembers[7] == pMember;
}

//----- (004B23A2) --------------------------------------------------------
CPed *__fastcall CPedGroupMembership::GetMember(const CPedGroupMembership *this, const int i)
{
  return this->m_pMembers[i];
}

//----- (004B23AA) --------------------------------------------------------
bool __fastcall CPedGroupMembership::IsLeader(const CPedGroupMembership *this, const CPed *pLeader)
{
  bool result; // r0

  result = 0;
  if ( pLeader )
  {
    if ( this->m_pMembers[7] == pLeader )
      return 1;
  }
  return result;
}

//----- (004B23BE) --------------------------------------------------------
int __fastcall CPedGroupMembership::CountMembers(const CPedGroupMembership *this)
{
  int64x2_t v2; // q9
  int32x4_t v8; // t2
  int8x16_t v9; // q8
  int32x4_t v10; // q8

  _Q8 = *(_OWORD *)this->m_pMembers;
  v2.n128_u64[0] = 0x100000001LL;
  v2.n128_u64[1] = 0x100000001LL;
  _Q10 = *(int64x2_t *)&this->m_pMembers[4];
  __asm { VCEQ.I32        Q8, Q8, #0 }
  v8.n128_u64[0] = ~(_QWORD)_Q8;
  v8.n128_u64[1] = ~*((_QWORD *)&_Q8 + 1);
  __asm { VCEQ.I32        Q10, Q10, #0 }
  v9 = vsubq_s32(vbicq_s64(v2, _Q10), v8);
  v10 = vaddq_s32(v9, vextq_s8(v9, v9, 8u));
  return vaddq_s32(v10, vdupq_lane_s32((int32x2_t)v10.n128_u64[0], 1)).n128_u32[0];
}

//----- (004B23F8) --------------------------------------------------------
int __fastcall CPedGroupMembership::CountMembersExcludingLeader(const CPedGroupMembership *this)
{
  __int64 v1; // kr08_8
  int v2; // r1

  v1 = *(_QWORD *)&this->m_pMembers[5];
  v2 = this->m_pMembers[1] != 0;
  if ( this->m_pMembers[0] )
    ++v2;
  if ( this->m_pMembers[2] )
    ++v2;
  if ( this->m_pMembers[3] )
    ++v2;
  if ( this->m_pMembers[4] )
    ++v2;
  if ( (_DWORD)v1 )
    ++v2;
  if ( HIDWORD(v1) )
    ++v2;
  return v2;
}

//----- (004B243E) --------------------------------------------------------
void __fastcall CPedGroupMembership::Process(CPedGroupMembership *this)
{
  const CPed *v2; // r0
  const CPed *v3; // r0
  const CPed *v4; // r0
  const CPed *v5; // r0
  const CPed *v6; // r0
  const CPed *v7; // r0
  const CPed *v8; // r0
  const CPed *v9; // r0
  int i; // r5
  int v11; // r0
  CPed *v12; // r1
  int v13; // r2
  CMatrix *m_pMat; // r3
  int v15; // r4
  CSimpleTransform *p_tx; // r2
  float32x2_t v17; // d16
  unsigned __int64 v18; // d1

  v2 = this->m_pMembers[0];
  if ( v2 && !CPed::IsAlive(v2) )
    CPedGroupMembership::RemoveMember(this, 0);
  v3 = this->m_pMembers[1];
  if ( v3 && !CPed::IsAlive(v3) )
    CPedGroupMembership::RemoveMember(this, 1);
  v4 = this->m_pMembers[2];
  if ( v4 && !CPed::IsAlive(v4) )
    CPedGroupMembership::RemoveMember(this, 2);
  v5 = this->m_pMembers[3];
  if ( v5 && !CPed::IsAlive(v5) )
    CPedGroupMembership::RemoveMember(this, 3);
  v6 = this->m_pMembers[4];
  if ( v6 && !CPed::IsAlive(v6) )
    CPedGroupMembership::RemoveMember(this, 4);
  v7 = this->m_pMembers[5];
  if ( v7 && !CPed::IsAlive(v7) )
    CPedGroupMembership::RemoveMember(this, 5);
  v8 = this->m_pMembers[6];
  if ( v8 && !CPed::IsAlive(v8) )
    CPedGroupMembership::RemoveMember(this, 6);
  v9 = this->m_pMembers[7];
  if ( v9 )
  {
    if ( !CPed::IsAlive(v9) && !CPed::IsPlayer(this->m_pMembers[7]) )
      CPedGroupMembership::RemoveMember(this, 7);
    if ( this->m_pMembers[7] )
      goto LABEL_28;
  }
  CPedGroupMembership::AppointNewLeader(this);
  if ( this->m_pMembers[7] )
  {
LABEL_28:
    for ( i = 1; i != 8; ++i )
    {
      v11 = *((_DWORD *)&this->m_pPedGroup + i);
      if ( v11 && (*(_BYTE *)(v11 + 1165) & 0x40) == 0 )
      {
        v12 = this->m_pMembers[7];
        v13 = *(_DWORD *)(v11 + 20);
        m_pMat = v12->m_pMat;
        v15 = v13 + 48;
        if ( !v13 )
          v15 = v11 + 4;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &v12->m_transform;
        v17.n64_u64[0] = vsub_f32(*(float32x2_t *)(v15 + 4), *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
        v18 = vmul_f32(v17, v17).n64_u64[0];
        if ( (float)((float)((float)((float)(*(float *)v15 - p_tx->m_translate.x)
                                   * (float)(*(float *)v15 - p_tx->m_translate.x))
                           + *(float *)&v18)
                   + *((float *)&v18 + 1)) > (float)(this->m_fMaxSeparation * this->m_fMaxSeparation)
          && *(unsigned __int8 *)(v11 + 51) == v12->m_areaCode )
        {
          CPedGroupMembership::RemoveMember(this, i - 1);
        }
      }
    }
  }
}

//----- (004B2572) --------------------------------------------------------
void __fastcall CPedGroupMembership::AppointNewLeader(CPedGroupMembership *this)
{
  CEntity **v2; // r4
  CPed *v3; // r6
  int v4; // r1

  v2 = &this->m_pMembers[7];
  if ( !this->m_pMembers[7] )
  {
    v3 = this->m_pMembers[0];
    if ( v3 )
    {
      v4 = 0;
    }
    else
    {
      v3 = this->m_pMembers[1];
      if ( v3 )
      {
        v4 = 1;
      }
      else
      {
        v3 = this->m_pMembers[2];
        if ( v3 )
        {
          v4 = 2;
        }
        else
        {
          v3 = this->m_pMembers[3];
          if ( v3 )
          {
            v4 = 3;
          }
          else
          {
            v3 = this->m_pMembers[4];
            if ( v3 )
            {
              v4 = 4;
            }
            else
            {
              v3 = this->m_pMembers[5];
              if ( v3 )
              {
                v4 = 5;
              }
              else
              {
                v3 = this->m_pMembers[6];
                if ( !v3 )
                  return;
                v4 = 6;
              }
            }
          }
        }
      }
    }
    CPedGroupMembership::RemoveMember(this, v4);
    this->m_pMembers[7] = v3;
    CEntity::RegisterReference(v3, v2);
    if ( !CPed::IsPlayer(this->m_pMembers[7]) )
      sub_19EF84((CPedIntelligence *)LODWORD((*v2)[18].m_transform.m_translate.y), 0);
  }
}

//----- (004B25F0) --------------------------------------------------------
void __fastcall CPedGroupDefaultTaskAllocatorFollowAnyMeans::AllocateDefaultTasks(
        const CPedGroupDefaultTaskAllocatorFollowAnyMeans *this,
        CPedGroup *pPedGroup,
        CPed *pPed)
{
  int v5; // r4
  float *p_y; // r6
  int v7; // r0
  int v8; // r1
  CPed *m_pPed; // r2
  CTaskComplexFollowLeaderAnyMeans *v10; // r0
  CPed *v11; // r2
  RwReal v12; // r3
  CTask *v13; // r0
  CPed *v14; // r2
  int v15; // r1
  int v16; // r0
  CTaskComplexWanderGang *v17; // r5
  unsigned __int16 v18; // r0
  CVector v19; // [sp+8h] [bp-28h] BYREF

  v5 = 0;
  p_y = &CTaskComplexFollowLeaderInFormation::ms_offsets.m_offsets[0].y;
  do
  {
    v7 = 0;
    v8 = 0;
    m_pPed = pPedGroup->m_intelligence.m_defaultPedTaskPairs[v5].m_pPed;
    if ( m_pPed == pPed )
      v7 = 1;
    if ( !pPed )
      v8 = 1;
    if ( m_pPed && (v7 | v8) == 1 )
    {
      v10 = (CTaskComplexFollowLeaderAnyMeans *)CTask::operator new(0x24u);
      v11 = pPedGroup->m_membership.m_pMembers[7];
      v12 = *p_y;
      v19.x = *(p_y - 1);
      v19.y = v12;
      v19.z = 0.0;
      CTaskComplexFollowLeaderAnyMeans::CTaskComplexFollowLeaderAnyMeans(v10, pPedGroup, v11, &v19);
      pPedGroup->m_intelligence.m_defaultPedTaskPairs[v5].m_pTask = v13;
    }
    ++v5;
    p_y += 2;
  }
  while ( v5 != 7 );
  v14 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pPed;
  v15 = 0;
  v16 = 0;
  if ( v14 == pPed )
    v15 = 1;
  if ( !pPed )
    v16 = 1;
  if ( v14 )
  {
    if ( (v16 | v15) == 1 )
    {
      v17 = (CTaskComplexWanderGang *)CTask::operator new(0x38u);
      v18 = rand();
      CTaskComplexWanderGang::CTaskComplexWanderGang(
        v17,
        4,
        (int)(float)((float)((float)v18 * 0.000015259) * 8.0),
        5000,
        1,
        0.5);
      pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pTask = v17;
    }
  }
}
// 4B2652: variable 'v13' is possibly undefined
// 4B25F0: using guessed type CVector var_28;

//----- (004B26E4) --------------------------------------------------------
void __fastcall CPedGroupDefaultTaskAllocatorFollowLimited::AllocateDefaultTasks(
        const CPedGroupDefaultTaskAllocatorFollowLimited *this,
        CPedGroup *pPedGroup,
        CPed *pPed)
{
  int v5; // r4
  float *p_y; // r6
  int v7; // r0
  int v8; // r1
  CPed *m_pPed; // r2
  CTaskComplexFollowLeaderInFormation *v10; // r0
  RwReal v11; // r3
  CPed *v12; // r2
  CTask *v13; // r0
  CPed *v14; // r2
  int v15; // r1
  int v16; // r0
  CTaskComplexWanderGang *v17; // r5
  unsigned __int16 v18; // r0
  CVector v19; // [sp+8h] [bp-28h] BYREF

  v5 = 0;
  p_y = &CTaskComplexFollowLeaderInFormation::ms_offsets.m_offsets[0].y;
  do
  {
    v7 = 0;
    v8 = 0;
    m_pPed = pPedGroup->m_intelligence.m_defaultPedTaskPairs[v5].m_pPed;
    if ( m_pPed == pPed )
      v7 = 1;
    if ( !pPed )
      v8 = 1;
    if ( m_pPed && (v7 | v8) == 1 )
    {
      v10 = (CTaskComplexFollowLeaderInFormation *)CTask::operator new(0x28u);
      v11 = *p_y;
      v12 = pPedGroup->m_membership.m_pMembers[7];
      v19.x = *(p_y - 1);
      v19.y = v11;
      v19.z = 0.0;
      CTaskComplexFollowLeaderInFormation::CTaskComplexFollowLeaderInFormation(v10, pPedGroup, v12, &v19, 10.0);
      pPedGroup->m_intelligence.m_defaultPedTaskPairs[v5].m_pTask = v13;
    }
    ++v5;
    p_y += 2;
  }
  while ( v5 != 7 );
  v14 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pPed;
  v15 = 0;
  v16 = 0;
  if ( v14 == pPed )
    v15 = 1;
  if ( !pPed )
    v16 = 1;
  if ( v14 )
  {
    if ( (v16 | v15) == 1 )
    {
      v17 = (CTaskComplexWanderGang *)CTask::operator new(0x38u);
      v18 = rand();
      CTaskComplexWanderGang::CTaskComplexWanderGang(
        v17,
        4,
        (int)(float)((float)((float)v18 * 0.000015259) * 8.0),
        5000,
        1,
        0.5);
      pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pTask = v17;
    }
  }
}
// 4B274C: variable 'v13' is possibly undefined

//----- (004B27DC) --------------------------------------------------------
void __fastcall CPedGroupDefaultTaskAllocatorStandStill::AllocateDefaultTasks(
        const CPedGroupDefaultTaskAllocatorStandStill *this,
        CPedGroup *pPedGroup,
        CPed *pPed)
{
  CPed *m_pPed; // r2
  int v6; // r0
  int v7; // r1
  int v8; // r6
  CTaskComplex *v9; // r0
  CTask *v10; // r0
  CPed *v11; // r1
  bool v12; // zf
  CTaskComplex *v13; // r0
  CTask *v14; // r0
  CPed *v15; // r2
  int v16; // r0
  int v17; // r1
  int v18; // r6
  CTaskComplex *v19; // r0
  CTask *v20; // r0
  CPed *v21; // r1
  CTaskComplex *v22; // r0
  CTask *v23; // r0
  CPed *v24; // r2
  int v25; // r0
  int v26; // r1
  int v27; // r6
  CTaskComplex *v28; // r0
  CTask *v29; // r0
  CPed *v30; // r1
  CTaskComplex *v31; // r0
  CTask *v32; // r0
  CPed *v33; // r2
  int v34; // r0
  int v35; // r1
  int v36; // r6
  CTaskComplex *v37; // r0
  CTask *v38; // r0
  CPed *v39; // r1
  bool v40; // zf
  CTaskComplex *v41; // r0
  CTask *v42; // r0

  m_pPed = pPedGroup->m_intelligence.m_defaultPedTaskPairs[0].m_pPed;
  v6 = 0;
  v7 = 0;
  v8 = 0;
  if ( m_pPed == pPed )
    v6 = 1;
  if ( !pPed )
    v7 = 1;
  if ( m_pPed && (v6 | v7) == 1 )
  {
    v9 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v9);
    v10->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[0].m_pTask = v10;
  }
  v11 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[1].m_pPed;
  if ( !pPed )
    v8 = 1;
  v12 = v11 == 0;
  if ( v11 )
    v12 = ((v11 == pPed) | v8) == 0;
  if ( !v12 )
  {
    v13 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v13);
    v14->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[1].m_pTask = v14;
  }
  v15 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[2].m_pPed;
  v16 = 0;
  v17 = 0;
  v18 = 0;
  if ( v15 == pPed )
    v16 = 1;
  if ( !pPed )
    v17 = 1;
  if ( v15 && (v16 | v17) == 1 )
  {
    v19 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v19);
    v20->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[2].m_pTask = v20;
  }
  v21 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[3].m_pPed;
  if ( !pPed )
    v18 = 1;
  if ( v21 && ((v21 == pPed) | v18) == 1 )
  {
    v22 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v22);
    v23->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[3].m_pTask = v23;
  }
  v24 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[4].m_pPed;
  v25 = 0;
  v26 = 0;
  v27 = 0;
  if ( v24 == pPed )
    v25 = 1;
  if ( !pPed )
    v26 = 1;
  if ( v24 && (v25 | v26) == 1 )
  {
    v28 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v28);
    v29->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[4].m_pTask = v29;
  }
  v30 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[5].m_pPed;
  if ( !pPed )
    v27 = 1;
  if ( v30 && ((v30 == pPed) | v27) == 1 )
  {
    v31 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v31);
    v32->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[5].m_pTask = v32;
  }
  v33 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[6].m_pPed;
  v34 = 0;
  v35 = 0;
  v36 = 0;
  if ( v33 == pPed )
    v34 = 1;
  if ( !pPed )
    v35 = 1;
  if ( v33 && (v34 | v35) == 1 )
  {
    v37 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v37);
    v38->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[6].m_pTask = v38;
  }
  v39 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pPed;
  if ( !pPed )
    v36 = 1;
  v40 = v39 == 0;
  if ( v39 )
    v40 = ((v39 == pPed) | v36) == 0;
  if ( !v40 )
  {
    v41 = (CTaskComplex *)CTask::operator new(0xCu);
    CTaskComplex::CTaskComplex(v41);
    v42->_vptr$CTask = (int (**)(void))&off_66A770;
    pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pTask = v42;
  }
}
// 4B2818: variable 'v10' is possibly undefined
// 4B284C: variable 'v14' is possibly undefined
// 4B2882: variable 'v20' is possibly undefined
// 4B28B4: variable 'v23' is possibly undefined
// 4B28EA: variable 'v29' is possibly undefined
// 4B291C: variable 'v32' is possibly undefined
// 4B2952: variable 'v38' is possibly undefined
// 4B2986: variable 'v42' is possibly undefined
// 66A770: using guessed type void *;

//----- (004B29B4) --------------------------------------------------------
void __fastcall CPedGroupDefaultTaskAllocatorChat::AllocateDefaultTasks(
        const CPedGroupDefaultTaskAllocatorChat *this,
        CPedGroup *pPedGroup,
        CPed *pPed)
{
  CPedGroup *v3; // r11
  int v4; // r10
  int v6; // r6
  int *v7; // r5
  int *v8; // r8
  int v9; // r9
  int v10; // r5
  CPed *v11; // r11
  CTaskComplexGoToPointAndStandStill *v12; // r10
  const CVector *m_pMat; // r0
  const CVector *p_m_translate; // r2
  CTaskComplexSequence *v15; // r4
  CTaskSimpleAchieveHeading *v16; // r5
  CTask *v17; // r1
  int v18; // r0
  int v19; // r6
  int v20; // r10
  int v21; // r11
  CTaskComplexSequence *v22; // r4
  CTaskSimpleRunTimedAnim *v23; // r5
  CTask *v24; // r1
  int v25; // r6
  int *v26; // r4
  int v27; // r5
  CPed *v28; // [sp+18h] [bp-290h]
  CPedGroup *v29; // [sp+3Ch] [bp-26Ch]
  int fHeadingChangeRateFrac; // [sp+40h] [bp-268h]
  CTaskComplexSequence v31; // [sp+48h] [bp-260h] BYREF
  CTaskComplexSequence v32; // [sp+88h] [bp-220h] BYREF
  CTaskComplexSequence v33; // [sp+C8h] [bp-1E0h] BYREF
  CTaskComplexSequence v34; // [sp+108h] [bp-1A0h] BYREF
  CTaskComplexSequence v35; // [sp+148h] [bp-160h] BYREF
  CTaskComplexSequence v36; // [sp+188h] [bp-120h] BYREF
  CTaskComplexSequence v37; // [sp+1C8h] [bp-E0h] BYREF
  CTaskComplexSequence v38; // [sp+208h] [bp-A0h] BYREF
  int v39[24]; // [sp+248h] [bp-60h] BYREF

  v3 = pPedGroup;
  v4 = 0;
  if ( pPedGroup->m_membership.m_pMembers[0] )
  {
    v39[0] = 0;
    v4 = 1;
  }
  if ( pPedGroup->m_membership.m_pMembers[1] )
    v39[v4++] = 1;
  if ( pPedGroup->m_membership.m_pMembers[2] )
    v39[v4++] = 2;
  if ( pPedGroup->m_membership.m_pMembers[3] )
    v39[v4++] = 3;
  if ( pPedGroup->m_membership.m_pMembers[4] )
    v39[v4++] = 4;
  if ( pPedGroup->m_membership.m_pMembers[5] )
    v39[v4++] = 5;
  if ( pPedGroup->m_membership.m_pMembers[6] )
    v39[v4++] = 6;
  if ( pPedGroup->m_membership.m_pMembers[7] )
    v39[v4++] = 7;
  CTaskComplexSequence::CTaskComplexSequence(&v31);
  CTaskComplexSequence::CTaskComplexSequence(&v32);
  CTaskComplexSequence::CTaskComplexSequence(&v33);
  CTaskComplexSequence::CTaskComplexSequence(&v34);
  CTaskComplexSequence::CTaskComplexSequence(&v35);
  CTaskComplexSequence::CTaskComplexSequence(&v36);
  CTaskComplexSequence::CTaskComplexSequence(&v37);
  CTaskComplexSequence::CTaskComplexSequence(&v38);
  if ( v4 > 0 )
  {
    v6 = 0;
    v28 = pPed;
    v7 = v39;
    v29 = v3;
    do
    {
      v8 = v7;
      v9 = v4;
      v10 = v7[v6];
      v11 = v3->m_membership.m_pMembers[v10];
      v12 = (CTaskComplexGoToPointAndStandStill *)CTask::operator new(0x28u);
      m_pMat = (const CVector *)v11->m_pMat;
      p_m_translate = m_pMat + 4;
      if ( !m_pMat )
        p_m_translate = &v11->m_transform.m_translate;
      CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(v12, 4, p_m_translate, 0.5, 2.0, 0, 0);
      v15 = &v31 + v10;
      CTaskComplexSequence::AddTask(v15, v12);
      v16 = (CTaskSimpleAchieveHeading *)CTask::operator new(0x18u);
      v4 = v9;
      CTaskSimpleAchieveHeading::CTaskSimpleAchieveHeading(v16, v11->m_fCurrentHeading, 0.5, 0.2);
      v17 = v16;
      v7 = v8;
      CTaskComplexSequence::AddTask(v15, v17);
      v3 = v29;
      ++v6;
      v15->m_iRepeatMode = 1;
    }
    while ( v9 != v6 );
    v18 = 0;
    do
    {
      fHeadingChangeRateFrac = v18;
      v19 = 0;
      v20 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)v9);
      v21 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3000.0) + 3000;
      do
      {
        v22 = &v31 + v7[v19];
        if ( v20 == v19 )
        {
          v23 = (CTaskSimpleRunTimedAnim *)CTask::operator new(0x34u);
          CTaskSimpleRunTimedAnim::CTaskSimpleRunTimedAnim(
            v23,
            ANIM_STD_PED,
            ANIM_STD_CHAT,
            4.0,
            -4.0,
            v21,
            416,
            "Chat",
            0);
          v23->_vptr$CTask = (int (**)(void))&off_668878;
        }
        else
        {
          v23 = (CTaskSimpleRunTimedAnim *)CTask::operator new(0x20u);
          CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v23, v21, 0, 0, 8.0);
        }
        v24 = v23;
        v7 = v8;
        CTaskComplexSequence::AddTask(v22, v24);
        ++v19;
      }
      while ( v9 != v19 );
      v25 = v9;
      v18 = fHeadingChangeRateFrac + 1;
    }
    while ( fHeadingChangeRateFrac + 1 != v9 );
    v26 = v39;
    do
    {
      v27 = *v26;
      if ( !v28 || v29->m_intelligence.m_defaultPedTaskPairs[v27].m_pPed == v28 )
        v29->m_intelligence.m_defaultPedTaskPairs[v27].m_pTask = (CTask *)(*(int (__fastcall **)(CTaskComplexSequence *))(*((_DWORD *)&v31._vptr$CTask + 16 * v27) + 8))(&v31 + v27);
      --v25;
      ++v26;
    }
    while ( v25 );
  }
  CTaskComplexSequence::~CTaskComplexSequence(&v38);
  CTaskComplexSequence::~CTaskComplexSequence(&v37);
  CTaskComplexSequence::~CTaskComplexSequence(&v36);
  CTaskComplexSequence::~CTaskComplexSequence(&v35);
  CTaskComplexSequence::~CTaskComplexSequence(&v34);
  CTaskComplexSequence::~CTaskComplexSequence(&v33);
  CTaskComplexSequence::~CTaskComplexSequence(&v32);
  CTaskComplexSequence::~CTaskComplexSequence(&v31);
}
// 4B2B8E: conditional instruction was optimized away because r9.4>=1
// 4B2C74: conditional instruction was optimized away because r6.4>=1
// 668878: using guessed type void *off_668878;
// 4B29B4: using guessed type int var_60[24];

//----- (004B2D14) --------------------------------------------------------
void __fastcall CPedGroupDefaultTaskAllocatorRandom::AllocateDefaultTasks(
        const CPedGroupDefaultTaskAllocatorRandom *this,
        CPedGroup *pPedGroup,
        CPed *pPed)
{
  int v5; // r5
  int v6; // r4
  int *p_y; // r6
  int v8; // r0
  int v9; // r1
  CPed *m_pPed; // r2
  void *v11; // r0
  CTaskComplexGangFollower *v12; // r0
  CPed *v13; // r2
  int v14; // r1
  int v15; // r0
  CTaskComplexGangLeader *v16; // r0
  CTask *v17; // r0

  v5 = 0;
  v6 = 0;
  p_y = (int *)&CTaskComplexFollowLeaderInFormation::ms_offsets.m_offsets[0].y;
  do
  {
    v8 = 0;
    v9 = 0;
    m_pPed = pPedGroup->m_intelligence.m_defaultPedTaskPairs[v5].m_pPed;
    if ( m_pPed == pPed )
      v8 = 1;
    if ( !pPed )
      v9 = 1;
    if ( m_pPed && (v8 | v9) == 1 )
    {
      v11 = CTask::operator new(0x4Cu);
      v12 = (CTaskComplexGangFollower *)CTaskComplexGangFollower::CTaskComplexGangFollower(
                                          (int)v11,
                                          (int)pPedGroup,
                                          pPedGroup->m_membership.m_pMembers[7],
                                          v6,
                                          *(p_y - 1),
                                          *p_y,
                                          0,
                                          1092616192);
      pPedGroup->m_intelligence.m_defaultPedTaskPairs[v5].m_pTask = v12;
      CTaskComplexGangFollower::SetFollowLeader(v12, pPedGroup->m_followLeader != 0);
    }
    ++v6;
    p_y += 2;
    ++v5;
  }
  while ( v6 != 7 );
  v13 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pPed;
  v14 = 0;
  v15 = 0;
  if ( v13 == pPed )
    v14 = 1;
  if ( !pPed )
    v15 = 1;
  if ( v13 )
  {
    if ( (v15 | v14) == 1 )
    {
      v16 = (CTaskComplexGangLeader *)CTask::operator new(0x38u);
      CTaskComplexGangLeader::CTaskComplexGangLeader(v16, pPedGroup);
      pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pTask = v17;
    }
  }
}
// 4B2DC2: variable 'v17' is possibly undefined

//----- (004B2DD4) --------------------------------------------------------
void __fastcall CPedGroupDefaultTaskAllocatorSitInLeaderCar::AllocateDefaultTasks(
        const CPedGroupDefaultTaskAllocatorSitInLeaderCar *this,
        CPedGroup *pPedGroup,
        CPed *pPed)
{
  CPedGroup *v3; // r6
  CPed *v4; // r0
  bool v5; // zf
  CTaskComplexSequence *v6; // r8
  CTaskComplexEnterCarAsDriver *v7; // r5
  CTaskSimpleCarDrive *v8; // r5
  CPed *m_pPed; // r0
  bool v10; // zf
  unsigned int v11; // r9
  int v12; // r4
  int m_nMaxPassengers; // r10
  CPedGroup *v14; // r8
  int v15; // r6
  CTaskComplexSequence *v16; // r5
  CTaskComplexEnterCarAsPassenger *v17; // r0
  int v18; // r2
  CTask *v19; // r4
  CTaskSimpleCarDrive *v20; // r4
  char *v21; // r0
  int v22; // r1
  CPed *v23; // r3
  int v24; // r4
  CVehicle *pTargetVehicle; // [sp+0h] [bp-28h]
  int v27; // [sp+8h] [bp-20h]

  v3 = pPedGroup;
  v4 = pPedGroup->m_membership.m_pMembers[7];
  v5 = v4 == 0;
  if ( v4 )
  {
    pTargetVehicle = v4->m_pMyVehicle;
    v5 = pTargetVehicle == 0;
  }
  if ( !v5 )
  {
    v6 = (CTaskComplexSequence *)CTask::operator new(0x40u);
    CTaskComplexSequence::CTaskComplexSequence(v6);
    v7 = (CTaskComplexEnterCarAsDriver *)CTask::operator new(0x50u);
    CTaskComplexEnterCarAsDriver::CTaskComplexEnterCarAsDriver(v7, pTargetVehicle);
    CTaskComplexSequence::AddTask(v6, v7);
    v8 = (CTaskSimpleCarDrive *)CTask::operator new(0x60u);
    CTaskSimpleCarDrive::CTaskSimpleCarDrive(v8, pTargetVehicle, 0, 0);
    CTaskComplexSequence::AddTask(v6, v8);
    m_pPed = v3->m_intelligence.m_defaultPedTaskPairs[7].m_pPed;
    if ( !m_pPed )
      goto LABEL_10;
    v10 = pPed == 0;
    if ( pPed )
      v10 = m_pPed == pPed;
    if ( v10 )
    {
      v3->m_intelligence.m_defaultPedTaskPairs[7].m_pTask = v6;
    }
    else
    {
LABEL_10:
      if ( v6 )
        (*((void (__fastcall **)(CTaskComplexSequence *))v6->_vptr$CTask + 1))(v6);
    }
    v11 = 0;
    v12 = 0;
    m_nMaxPassengers = pTargetVehicle->m_nMaxPassengers;
    do
    {
      if ( v12 < m_nMaxPassengers && v3->m_membership.m_pMembers[v11 / 4] )
      {
        v27 = v12;
        v14 = v3;
        v15 = CCarEnterExit::ComputeTargetDoorToEnterAsPassenger(pTargetVehicle, v12);
        v16 = (CTaskComplexSequence *)CTask::operator new(0x40u);
        CTaskComplexSequence::CTaskComplexSequence(v16);
        v17 = (CTaskComplexEnterCarAsPassenger *)CTask::operator new(0x50u);
        v18 = v15;
        v19 = v17;
        v3 = v14;
        CTaskComplexEnterCarAsPassenger::CTaskComplexEnterCarAsPassenger(v17, pTargetVehicle, v18, 0);
        CTaskComplexSequence::AddTask(v16, v19);
        v20 = (CTaskSimpleCarDrive *)CTask::operator new(0x60u);
        CTaskSimpleCarDrive::CTaskSimpleCarDrive(v20, pTargetVehicle, 0, 0);
        CTaskComplexSequence::AddTask(v16, v20);
        v21 = (char *)v14 + 5 * v11;
        v22 = 0;
        v23 = (CPed *)*((_DWORD *)v21 + 135);
        if ( v23 == pPed )
          v22 = 1;
        if ( v23 && (v22 | (pPed == 0)) == 1 )
        {
          *((_DWORD *)v21 + 136) = v16;
          v24 = v27;
        }
        else
        {
          v24 = v27;
          if ( v16 )
            (*((void (__fastcall **)(CTaskComplexSequence *))v16->_vptr$CTask + 1))(v16);
        }
        v12 = v24 + 1;
      }
      v11 += 4;
    }
    while ( v11 != 28 );
  }
}
// 4B2E0C: variable 'pTargetVehicle' is possibly undefined

//----- (004B2F18) --------------------------------------------------------
const CPedGroupDefaultTaskAllocator *__fastcall CPedGroupDefaultTaskAllocators::Get(const int iType)
{
  if ( (unsigned int)iType <= 5 )
    return (&off_668FD0)[iType];
  else
    return 0;
}
// 668FD0: using guessed type CPedGroupDefaultTaskAllocatorFollowAnyMeans *off_668FD0;

//----- (004B2F30) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::CPedGroupIntelligence(CPedGroupIntelligence *this)
{
  this->m_pedTaskPairs[0].m_iSlot = -1;
  this->m_pedTaskPairs[0].m_pTask = 0;
  this->m_pedTaskPairs[0].m_matchID = 0;
  this->m_pedTaskPairs[0].m_bUsedTask = 0;
  this->m_pedTaskPairs[0].m_pPed = 0;
  this->m_pedTaskPairs[1].m_pPed = 0;
  this->m_pedTaskPairs[1].m_pTask = 0;
  this->m_pedTaskPairs[1].m_iSlot = -1;
  this->m_pedTaskPairs[1].m_matchID = 0;
  this->m_pedTaskPairs[1].m_bUsedTask = 0;
  this->m_pedTaskPairs[2].m_bUsedTask = 0;
  this->m_pedTaskPairs[2].m_pPed = 0;
  this->m_pedTaskPairs[2].m_pTask = 0;
  this->m_pedTaskPairs[2].m_iSlot = -1;
  this->m_pedTaskPairs[2].m_matchID = 0;
  this->m_pedTaskPairs[3].m_bUsedTask = 0;
  this->m_pedTaskPairs[3].m_pPed = 0;
  this->m_pedTaskPairs[3].m_pTask = 0;
  this->m_pedTaskPairs[3].m_iSlot = -1;
  this->m_pedTaskPairs[3].m_matchID = 0;
  this->m_pedTaskPairs[4].m_bUsedTask = 0;
  this->m_pedTaskPairs[4].m_pPed = 0;
  this->m_pedTaskPairs[4].m_pTask = 0;
  this->m_pedTaskPairs[4].m_iSlot = -1;
  this->m_pedTaskPairs[4].m_matchID = 0;
  this->m_pedTaskPairs[5].m_bUsedTask = 0;
  this->m_pedTaskPairs[5].m_pPed = 0;
  this->m_pedTaskPairs[5].m_pTask = 0;
  this->m_pedTaskPairs[5].m_iSlot = -1;
  this->m_pedTaskPairs[5].m_matchID = 0;
  this->m_pedTaskPairs[6].m_bUsedTask = 0;
  this->m_pedTaskPairs[6].m_pPed = 0;
  this->m_pedTaskPairs[6].m_pTask = 0;
  this->m_pedTaskPairs[6].m_iSlot = -1;
  this->m_pedTaskPairs[6].m_matchID = 0;
  this->m_pedTaskPairs[7].m_bUsedTask = 0;
  this->m_pedTaskPairs[7].m_pPed = 0;
  this->m_pedTaskPairs[7].m_pTask = 0;
  this->m_pedTaskPairs[7].m_iSlot = -1;
  this->m_pedTaskPairs[7].m_matchID = 0;
  this->m_secondaryPedTaskPairs[0].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[0].m_pPed = 0;
  this->m_secondaryPedTaskPairs[0].m_pTask = 0;
  this->m_secondaryPedTaskPairs[0].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[0].m_matchID = 0;
  this->m_secondaryPedTaskPairs[1].m_pPed = 0;
  this->m_secondaryPedTaskPairs[1].m_pTask = 0;
  this->m_secondaryPedTaskPairs[1].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[1].m_matchID = 0;
  this->m_secondaryPedTaskPairs[1].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[2].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[2].m_pPed = 0;
  this->m_secondaryPedTaskPairs[2].m_pTask = 0;
  this->m_secondaryPedTaskPairs[2].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[2].m_matchID = 0;
  this->m_secondaryPedTaskPairs[3].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[3].m_pPed = 0;
  this->m_secondaryPedTaskPairs[3].m_pTask = 0;
  this->m_secondaryPedTaskPairs[3].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[3].m_matchID = 0;
  this->m_secondaryPedTaskPairs[4].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[4].m_pPed = 0;
  this->m_secondaryPedTaskPairs[4].m_pTask = 0;
  this->m_secondaryPedTaskPairs[4].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[4].m_matchID = 0;
  this->m_secondaryPedTaskPairs[5].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[5].m_pPed = 0;
  this->m_secondaryPedTaskPairs[5].m_pTask = 0;
  this->m_secondaryPedTaskPairs[5].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[5].m_matchID = 0;
  this->m_secondaryPedTaskPairs[6].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[6].m_pPed = 0;
  this->m_secondaryPedTaskPairs[6].m_pTask = 0;
  this->m_secondaryPedTaskPairs[6].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[6].m_matchID = 0;
  this->m_secondaryPedTaskPairs[7].m_bUsedTask = 0;
  this->m_secondaryPedTaskPairs[7].m_pPed = 0;
  this->m_secondaryPedTaskPairs[7].m_pTask = 0;
  this->m_secondaryPedTaskPairs[7].m_iSlot = -1;
  this->m_secondaryPedTaskPairs[7].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[0].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[0].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[0].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[0].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[0].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[1].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[1].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[1].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[1].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[1].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[2].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[2].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[2].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[2].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[2].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[3].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[3].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[3].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[3].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[3].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[4].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[4].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[4].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[4].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[4].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[5].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[5].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[5].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[5].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[5].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[6].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[6].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[6].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[6].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[6].m_matchID = 0;
  this->m_scriptCommandPedTaskPairs[7].m_bUsedTask = 0;
  this->m_scriptCommandPedTaskPairs[7].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[7].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[7].m_iSlot = -1;
  this->m_scriptCommandPedTaskPairs[7].m_matchID = 0;
  this->m_defaultPedTaskPairs[0].m_iSlot = -1;
  this->m_defaultPedTaskPairs[0].m_matchID = 0;
  this->m_defaultPedTaskPairs[0].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[1].m_pPed = 0;
  this->m_defaultPedTaskPairs[1].m_pTask = 0;
  this->m_defaultPedTaskPairs[1].m_iSlot = -1;
  this->m_defaultPedTaskPairs[1].m_matchID = 0;
  this->m_defaultPedTaskPairs[1].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[2].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[2].m_pPed = 0;
  this->m_defaultPedTaskPairs[2].m_pTask = 0;
  this->m_defaultPedTaskPairs[2].m_iSlot = -1;
  this->m_defaultPedTaskPairs[2].m_matchID = 0;
  this->m_defaultPedTaskPairs[3].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[3].m_pPed = 0;
  this->m_defaultPedTaskPairs[3].m_pTask = 0;
  this->m_defaultPedTaskPairs[3].m_iSlot = -1;
  this->m_defaultPedTaskPairs[3].m_matchID = 0;
  this->m_defaultPedTaskPairs[4].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[4].m_pPed = 0;
  this->m_defaultPedTaskPairs[4].m_pTask = 0;
  this->m_defaultPedTaskPairs[4].m_iSlot = -1;
  this->m_defaultPedTaskPairs[4].m_matchID = 0;
  this->m_defaultPedTaskPairs[5].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[5].m_pPed = 0;
  this->m_defaultPedTaskPairs[5].m_pTask = 0;
  this->m_defaultPedTaskPairs[5].m_iSlot = -1;
  this->m_defaultPedTaskPairs[5].m_matchID = 0;
  this->m_defaultPedTaskPairs[6].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[6].m_pPed = 0;
  this->m_defaultPedTaskPairs[6].m_pTask = 0;
  this->m_defaultPedTaskPairs[6].m_iSlot = -1;
  this->m_defaultPedTaskPairs[6].m_matchID = 0;
  this->m_defaultPedTaskPairs[7].m_bUsedTask = 0;
  this->m_defaultPedTaskPairs[7].m_pPed = 0;
  this->m_defaultPedTaskPairs[7].m_pTask = 0;
  this->m_defaultPedTaskPairs[7].m_iSlot = -1;
  this->m_defaultPedTaskPairs[7].m_matchID = 0;
  this->m_iSequenceTaskID = -1;
  this->m_pedTaskPairs[0].m_pPed = 0;
  this->m_pedTaskPairs[0].m_pTask = 0;
  this->m_secondaryPedTaskPairs[0].m_pPed = 0;
  this->m_secondaryPedTaskPairs[0].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[0].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[0].m_pTask = 0;
  this->m_pedTaskPairs[1].m_pPed = 0;
  this->m_pedTaskPairs[1].m_pTask = 0;
  this->m_defaultPedTaskPairs[0].m_pPed = 0;
  this->m_defaultPedTaskPairs[0].m_pTask = 0;
  this->m_secondaryPedTaskPairs[1].m_pPed = 0;
  this->m_secondaryPedTaskPairs[1].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[1].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[1].m_pTask = 0;
  this->m_pedTaskPairs[2].m_pPed = 0;
  this->m_pedTaskPairs[2].m_pTask = 0;
  this->m_defaultPedTaskPairs[1].m_pPed = 0;
  this->m_defaultPedTaskPairs[1].m_pTask = 0;
  this->m_secondaryPedTaskPairs[2].m_pPed = 0;
  this->m_secondaryPedTaskPairs[2].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[2].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[2].m_pTask = 0;
  this->m_pedTaskPairs[3].m_pPed = 0;
  this->m_pedTaskPairs[3].m_pTask = 0;
  this->m_defaultPedTaskPairs[2].m_pPed = 0;
  this->m_defaultPedTaskPairs[2].m_pTask = 0;
  this->m_secondaryPedTaskPairs[3].m_pPed = 0;
  this->m_secondaryPedTaskPairs[3].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[3].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[3].m_pTask = 0;
  this->m_pedTaskPairs[4].m_pPed = 0;
  this->m_pedTaskPairs[4].m_pTask = 0;
  this->m_defaultPedTaskPairs[3].m_pPed = 0;
  this->m_defaultPedTaskPairs[3].m_pTask = 0;
  this->m_secondaryPedTaskPairs[4].m_pPed = 0;
  this->m_secondaryPedTaskPairs[4].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[4].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[4].m_pTask = 0;
  this->m_pedTaskPairs[5].m_pPed = 0;
  this->m_pedTaskPairs[5].m_pTask = 0;
  this->m_defaultPedTaskPairs[4].m_pPed = 0;
  this->m_defaultPedTaskPairs[4].m_pTask = 0;
  this->m_secondaryPedTaskPairs[5].m_pPed = 0;
  this->m_secondaryPedTaskPairs[5].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[5].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[5].m_pTask = 0;
  this->m_pedTaskPairs[6].m_pPed = 0;
  this->m_pedTaskPairs[6].m_pTask = 0;
  this->m_defaultPedTaskPairs[5].m_pPed = 0;
  this->m_defaultPedTaskPairs[5].m_pTask = 0;
  this->m_secondaryPedTaskPairs[6].m_pPed = 0;
  this->m_secondaryPedTaskPairs[6].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[6].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[6].m_pTask = 0;
  this->m_pedTaskPairs[7].m_pPed = 0;
  this->m_pedTaskPairs[7].m_pTask = 0;
  this->m_defaultPedTaskPairs[6].m_pPed = 0;
  this->m_defaultPedTaskPairs[6].m_pTask = 0;
  this->m_secondaryPedTaskPairs[7].m_pPed = 0;
  this->m_secondaryPedTaskPairs[7].m_pTask = 0;
  this->m_scriptCommandPedTaskPairs[7].m_pPed = 0;
  this->m_scriptCommandPedTaskPairs[7].m_pTask = 0;
  this->m_defaultPedTaskPairs[7].m_pPed = 0;
  this->m_defaultPedTaskPairs[7].m_pTask = 0;
  this->m_pDefaultTaskAllocator = &CPedGroupDefaultTaskAllocators::ms_standStillAllocator;
  this->m_pPrimaryTaskAllocator = 0;
  this->m_pEventResponseTaskAllocator = 0;
  this->m_iDecisionMaker = -1;
}

//----- (004B3148) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::~CPedGroupIntelligence(CPedGroupIntelligence *this)
{
  CPedGroupIntelligence::Flush(this);
}

//----- (004B3156) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::Flush(CPedGroupIntelligence *this)
{
  CEventGroupEvent *m_pHighestPriorityEvent; // r0
  CEventGroupEvent **p_m_pHighestPriorityEvent; // r5
  CEventGroupEvent *m_pCurrentEvent; // r1
  CEventGroupEvent **p_m_pCurrentEvent; // r6
  CTaskAllocator *m_pPrimaryTaskAllocator; // r0
  CTaskAllocator *m_pEventResponseTaskAllocator; // r0

  CPedTaskPair::Flush(this->m_pedTaskPairs);
  CPedTaskPair::Flush(this->m_secondaryPedTaskPairs);
  CPedTaskPair::Flush(this->m_defaultPedTaskPairs);
  CPedTaskPair::Flush(this->m_scriptCommandPedTaskPairs);
  CPedTaskPair::Flush(&this->m_pedTaskPairs[1]);
  CPedTaskPair::Flush(&this->m_secondaryPedTaskPairs[1]);
  CPedTaskPair::Flush(&this->m_defaultPedTaskPairs[1]);
  CPedTaskPair::Flush(&this->m_scriptCommandPedTaskPairs[1]);
  CPedTaskPair::Flush(&this->m_pedTaskPairs[2]);
  CPedTaskPair::Flush(&this->m_secondaryPedTaskPairs[2]);
  CPedTaskPair::Flush(&this->m_defaultPedTaskPairs[2]);
  CPedTaskPair::Flush(&this->m_scriptCommandPedTaskPairs[2]);
  CPedTaskPair::Flush(&this->m_pedTaskPairs[3]);
  CPedTaskPair::Flush(&this->m_secondaryPedTaskPairs[3]);
  CPedTaskPair::Flush(&this->m_defaultPedTaskPairs[3]);
  CPedTaskPair::Flush(&this->m_scriptCommandPedTaskPairs[3]);
  CPedTaskPair::Flush(&this->m_pedTaskPairs[4]);
  CPedTaskPair::Flush(&this->m_secondaryPedTaskPairs[4]);
  CPedTaskPair::Flush(&this->m_defaultPedTaskPairs[4]);
  CPedTaskPair::Flush(&this->m_scriptCommandPedTaskPairs[4]);
  CPedTaskPair::Flush(&this->m_pedTaskPairs[5]);
  CPedTaskPair::Flush(&this->m_secondaryPedTaskPairs[5]);
  CPedTaskPair::Flush(&this->m_defaultPedTaskPairs[5]);
  CPedTaskPair::Flush(&this->m_scriptCommandPedTaskPairs[5]);
  CPedTaskPair::Flush(&this->m_pedTaskPairs[6]);
  CPedTaskPair::Flush(&this->m_secondaryPedTaskPairs[6]);
  CPedTaskPair::Flush(&this->m_defaultPedTaskPairs[6]);
  CPedTaskPair::Flush(&this->m_scriptCommandPedTaskPairs[6]);
  CPedTaskPair::Flush(&this->m_pedTaskPairs[7]);
  CPedTaskPair::Flush(&this->m_secondaryPedTaskPairs[7]);
  CPedTaskPair::Flush(&this->m_defaultPedTaskPairs[7]);
  CPedTaskPair::Flush(&this->m_scriptCommandPedTaskPairs[7]);
  p_m_pHighestPriorityEvent = &this->m_pHighestPriorityEvent;
  m_pHighestPriorityEvent = this->m_pHighestPriorityEvent;
  p_m_pCurrentEvent = &this->m_pCurrentEvent;
  m_pCurrentEvent = this->m_pCurrentEvent;
  if ( m_pHighestPriorityEvent == m_pCurrentEvent )
  {
    if ( m_pHighestPriorityEvent )
      (*((void (__fastcall **)(CEventGroupEvent *))m_pHighestPriorityEvent->_vptr$CEvent + 1))(m_pHighestPriorityEvent);
    *p_m_pHighestPriorityEvent = 0;
  }
  else
  {
    if ( m_pCurrentEvent )
    {
      (*((void (__fastcall **)(CEventGroupEvent *))m_pCurrentEvent->_vptr$CEvent + 1))(this->m_pCurrentEvent);
      m_pHighestPriorityEvent = *p_m_pHighestPriorityEvent;
    }
    *p_m_pCurrentEvent = 0;
    if ( m_pHighestPriorityEvent )
      (*((void (__fastcall **)(CEventGroupEvent *))m_pHighestPriorityEvent->_vptr$CEvent + 1))(m_pHighestPriorityEvent);
    p_m_pCurrentEvent = &this->m_pHighestPriorityEvent;
  }
  *p_m_pCurrentEvent = 0;
  m_pPrimaryTaskAllocator = this->m_pPrimaryTaskAllocator;
  if ( m_pPrimaryTaskAllocator )
    (*((void (__fastcall **)(CTaskAllocator *))m_pPrimaryTaskAllocator->_vptr$CTaskAllocator + 1))(m_pPrimaryTaskAllocator);
  m_pEventResponseTaskAllocator = this->m_pEventResponseTaskAllocator;
  this->m_pPrimaryTaskAllocator = 0;
  if ( m_pEventResponseTaskAllocator )
    (*((void (__fastcall **)(CTaskAllocator *))m_pEventResponseTaskAllocator->_vptr$CTaskAllocator + 1))(m_pEventResponseTaskAllocator);
  this->m_pEventResponseTaskAllocator = 0;
  this->m_iDecisionMaker = -1;
  this->m_iSequenceTaskID = -1;
}

//----- (004B32D4) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetGroupDecisionMakerType(CPedGroupIntelligence *this, const int iDecisionMaker)
{
  this->m_iDecisionMaker = iDecisionMaker;
}

//----- (004B32DC) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetDefaultTaskAllocatorType(CPedGroupIntelligence *this, const int iType)
{
  CPedGroupDefaultTaskAllocatorFollowAnyMeans *v3; // r0
  const CPedGroupDefaultTaskAllocator *m_pDefaultTaskAllocator; // r0

  if ( (unsigned int)iType > 5 )
    v3 = 0;
  else
    v3 = (&off_668FD0)[iType];
  this->m_pDefaultTaskAllocator = v3;
  CPedGroupIntelligence::FlushTasks((CPedGroupIntelligence *)v3, this->m_defaultPedTaskPairs, 0);
  m_pDefaultTaskAllocator = this->m_pDefaultTaskAllocator;
  if ( m_pDefaultTaskAllocator )
    ((void (__fastcall *)(const CPedGroupDefaultTaskAllocator *, CPedGroup *, _DWORD))*m_pDefaultTaskAllocator->_vptr$CPedGroupDefaultTaskAllocator)(
      m_pDefaultTaskAllocator,
      this->m_pPedGroup,
      0);
}
// 668FD0: using guessed type CPedGroupDefaultTaskAllocatorFollowAnyMeans *off_668FD0;

//----- (004B331C) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetDefaultTaskAllocator(
        CPedGroupIntelligence *this,
        const CPedGroupDefaultTaskAllocator *p)
{
  const CPedGroupDefaultTaskAllocator *m_pDefaultTaskAllocator; // r0

  this->m_pDefaultTaskAllocator = p;
  CPedGroupIntelligence::FlushTasks(this, this->m_defaultPedTaskPairs, 0);
  m_pDefaultTaskAllocator = this->m_pDefaultTaskAllocator;
  if ( m_pDefaultTaskAllocator )
    ((void (__fastcall *)(const CPedGroupDefaultTaskAllocator *, CPedGroup *, _DWORD))*m_pDefaultTaskAllocator->_vptr$CPedGroupDefaultTaskAllocator)(
      m_pDefaultTaskAllocator,
      this->m_pPedGroup,
      0);
}

//----- (004B3348) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::ComputeDefaultTasks(CPedGroupIntelligence *this, CPed *pPed)
{
  const CPedGroupDefaultTaskAllocator *m_pDefaultTaskAllocator; // r0

  CPedGroupIntelligence::FlushTasks(this, this->m_defaultPedTaskPairs, pPed);
  m_pDefaultTaskAllocator = this->m_pDefaultTaskAllocator;
  if ( m_pDefaultTaskAllocator )
    (*(void (__fastcall **)(const CPedGroupDefaultTaskAllocator *, CPedGroup *, CPed *))m_pDefaultTaskAllocator->_vptr$CPedGroupDefaultTaskAllocator)(
      m_pDefaultTaskAllocator,
      this->m_pPedGroup,
      pPed);
}

//----- (004B3372) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetPrimaryTaskAllocator(CPedGroupIntelligence *this, CTaskAllocator *p)
{
  CTaskAllocator *m_pPrimaryTaskAllocator; // r0

  m_pPrimaryTaskAllocator = this->m_pPrimaryTaskAllocator;
  if ( m_pPrimaryTaskAllocator )
    (*((void (__fastcall **)(CTaskAllocator *))m_pPrimaryTaskAllocator->_vptr$CTaskAllocator + 1))(m_pPrimaryTaskAllocator);
  this->m_pPrimaryTaskAllocator = p;
}

//----- (004B338E) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetEventResponseTaskAllocator(CPedGroupIntelligence *this, CTaskAllocator *p)
{
  CTaskAllocator *m_pEventResponseTaskAllocator; // r0

  m_pEventResponseTaskAllocator = this->m_pEventResponseTaskAllocator;
  if ( m_pEventResponseTaskAllocator )
    (*((void (__fastcall **)(CTaskAllocator *))m_pEventResponseTaskAllocator->_vptr$CTaskAllocator + 1))(m_pEventResponseTaskAllocator);
  this->m_pEventResponseTaskAllocator = p;
}

//----- (004B33AA) --------------------------------------------------------
bool __fastcall CPedGroupIntelligence::AddEvent(CPedGroupIntelligence *this, CEvent *rEvent)
{
  int v4; // r0
  CPedGroup *m_pPedGroup; // r1
  CPed *v6; // r2
  bool v7; // zf
  CPed *v8; // r2
  bool v9; // zf
  CPed *v10; // r2
  bool v11; // zf
  CPed *v12; // r2
  bool v13; // zf
  CEventEditableResponse *m_iAccumulatedTime; // r6
  CEventGroupEvent *m_pHighestPriorityEvent; // r1
  CEventGroupEvent *v16; // r0

  if ( (*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 2))(rEvent) == 47
    && (*((int (__fastcall **)(CEvent *, CPedGroup *))rEvent->_vptr$CEvent + 7))(rEvent, this->m_pPedGroup) == 1
    && (*(int (__fastcall **)(int, CPedGroup *))(*(_DWORD *)rEvent[1].m_iAccumulatedTime + 28))(
         rEvent[1].m_iAccumulatedTime,
         this->m_pPedGroup) == 1 )
  {
    v4 = (*(int (__fastcall **)(int))(*(_DWORD *)rEvent[1].m_iAccumulatedTime + 44))(rEvent[1].m_iAccumulatedTime);
    if ( !v4 || (*(_BYTE *)(v4 + 58) & 7) != 3 )
      goto LABEL_18;
    m_pPedGroup = this->m_pPedGroup;
    v6 = this->m_pPedGroup->m_membership.m_pMembers[0];
    v7 = v6 == (CPed *)v4;
    if ( v6 != (CPed *)v4 )
      v7 = m_pPedGroup->m_membership.m_pMembers[1] == (CPed *)v4;
    if ( !v7 )
    {
      v8 = m_pPedGroup->m_membership.m_pMembers[2];
      v9 = v8 == (CPed *)v4;
      if ( v8 != (CPed *)v4 )
        v9 = m_pPedGroup->m_membership.m_pMembers[3] == (CPed *)v4;
      if ( !v9 )
      {
        v10 = m_pPedGroup->m_membership.m_pMembers[4];
        v11 = v10 == (CPed *)v4;
        if ( v10 != (CPed *)v4 )
          v11 = m_pPedGroup->m_membership.m_pMembers[5] == (CPed *)v4;
        if ( !v11 )
        {
          v12 = m_pPedGroup->m_membership.m_pMembers[6];
          v13 = v12 == (CPed *)v4;
          if ( v12 != (CPed *)v4 )
            v13 = m_pPedGroup->m_membership.m_pMembers[7] == (CPed *)v4;
          if ( !v13 )
          {
LABEL_18:
            m_iAccumulatedTime = (CEventEditableResponse *)rEvent[1].m_iAccumulatedTime;
            if ( (*((int (__fastcall **)(CEventEditableResponse *))m_iAccumulatedTime->_vptr$CEvent + 10))(m_iAccumulatedTime) != 1
              || (CEventEditableResponse::ComputeResponseTaskType(m_iAccumulatedTime, this->m_pPedGroup),
                  CEventEditableResponse::WillRespond(m_iAccumulatedTime)) )
            {
              m_pHighestPriorityEvent = this->m_pHighestPriorityEvent;
              if ( !m_pHighestPriorityEvent )
              {
LABEL_24:
                this->m_pHighestPriorityEvent = (CEventGroupEvent *)(*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent
                                                                     + 5))(rEvent);
                return 1;
              }
              if ( CEventGroupEvent::BaseEventTakesPriorityOverBaseEvent(
                     (const CEventGroupEvent *)rEvent,
                     m_pHighestPriorityEvent) )
              {
                v16 = this->m_pHighestPriorityEvent;
                if ( v16 )
                  (*((void (__fastcall **)(CEventGroupEvent *))v16->_vptr$CEvent + 1))(v16);
                goto LABEL_24;
              }
            }
          }
        }
      }
    }
  }
  return 0;
}

//----- (004B347A) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetEventResponseTask(
        CPedGroupIntelligence *this,
        CPed *pPed,
        int bMain,
        const CTask *TaskMain,
        int bSecondary,
        const CTask *TaskSecondary,
        const int iSlot)
{
  if ( bMain == 1 )
    CPedGroupIntelligence::SetTask(
      (CPedGroupIntelligence *)this->m_pedTaskPairs,
      pPed,
      TaskMain,
      this->m_pedTaskPairs,
      -1,
      0);
  if ( bSecondary == 1 )
    CPedGroupIntelligence::SetTask(
      (CPedGroupIntelligence *)iSlot,
      pPed,
      TaskSecondary,
      this->m_secondaryPedTaskPairs,
      iSlot,
      0);
}

//----- (004B34C6) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetTask(
        CPedGroupIntelligence *this,
        CPed *pPed,
        const CTask *Task,
        CPedTaskPair *p,
        const int iSlot,
        int bForce)
{
  int v7; // r1
  CPedTaskPair *v8; // r4
  CTask *m_pTask; // r5
  CTask **p_m_pTask; // r6
  int v11; // r9
  int v12; // r0

  if ( p->m_pPed == pPed )
  {
    v7 = 0;
  }
  else if ( p[1].m_pPed == pPed )
  {
    v7 = 1;
  }
  else if ( p[2].m_pPed == pPed )
  {
    v7 = 2;
  }
  else if ( p[3].m_pPed == pPed )
  {
    v7 = 3;
  }
  else if ( p[4].m_pPed == pPed )
  {
    v7 = 4;
  }
  else if ( p[5].m_pPed == pPed )
  {
    v7 = 5;
  }
  else if ( p[6].m_pPed == pPed )
  {
    v7 = 6;
  }
  else
  {
    if ( p[7].m_pPed != pPed )
      return;
    v7 = 7;
  }
  v8 = &p[v7];
  p_m_pTask = &v8->m_pTask;
  m_pTask = v8->m_pTask;
  if ( !m_pTask )
  {
LABEL_21:
    *p_m_pTask = (CTask *)(*((int (__fastcall **)(const CTask *))Task->_vptr$CTask + 2))(Task);
    v8->m_iSlot = iSlot;
    return;
  }
  if ( !bForce )
  {
    v11 = (*((int (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 5))(m_pTask);
    v12 = (*((int (__fastcall **)(const CTask *))Task->_vptr$CTask + 5))(Task);
    m_pTask = *p_m_pTask;
    if ( v11 == v12 )
    {
      if ( m_pTask )
        return;
      goto LABEL_21;
    }
  }
  *p_m_pTask = (CTask *)(*((int (__fastcall **)(const CTask *))Task->_vptr$CTask + 2))(Task);
  v8->m_iSlot = iSlot;
  if ( m_pTask )
    (*((void (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 1))(m_pTask);
}

//----- (004B358E) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetScriptCommandTask(CPedGroupIntelligence *this, CPed *pPed, const CTask *Task)
{
  int v3; // r1
  char *v4; // r5
  int v5; // r4

  if ( this->m_scriptCommandPedTaskPairs[0].m_pPed == pPed )
  {
    v3 = 0;
  }
  else if ( this->m_scriptCommandPedTaskPairs[1].m_pPed == pPed )
  {
    v3 = 1;
  }
  else if ( this->m_scriptCommandPedTaskPairs[2].m_pPed == pPed )
  {
    v3 = 2;
  }
  else if ( this->m_scriptCommandPedTaskPairs[3].m_pPed == pPed )
  {
    v3 = 3;
  }
  else if ( this->m_scriptCommandPedTaskPairs[4].m_pPed == pPed )
  {
    v3 = 4;
  }
  else if ( this->m_scriptCommandPedTaskPairs[5].m_pPed == pPed )
  {
    v3 = 5;
  }
  else if ( this->m_scriptCommandPedTaskPairs[6].m_pPed == pPed )
  {
    v3 = 6;
  }
  else
  {
    if ( this->m_scriptCommandPedTaskPairs[7].m_pPed != pPed )
      return;
    v3 = 7;
  }
  v4 = (char *)this + 20 * v3;
  v5 = *((_DWORD *)v4 + 84);
  *((_QWORD *)v4 + 42) = (unsigned int)(*((int (__fastcall **)(const CTask *))Task->_vptr$CTask + 2))(Task) | 0xFFFFFFFF00000000LL;
  if ( v5 )
    (*(void (__fastcall **)(int))(*(_DWORD *)v5 + 4))(v5);
}

//----- (004B3620) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetDefaultTask(CPedGroupIntelligence *this, CPed *pPed, const CTask *Task)
{
  CPedGroupIntelligence::SetTask(this, pPed, Task, this->m_defaultPedTaskPairs, -1, 0);
}

//----- (004B363E) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::SetTask(
        CPedGroupIntelligence *this,
        Int32 Index,
        const CTask *Task,
        CPedTaskPair *p,
        const int iSlot,
        int bForce)
{
  CPedTaskPair *v7; // r10
  CTask *m_pTask; // r5
  CTask **p_m_pTask; // r6
  int v10; // r8
  int v11; // r0

  v7 = &p[Index];
  p_m_pTask = &v7->m_pTask;
  m_pTask = v7->m_pTask;
  if ( !m_pTask )
  {
LABEL_5:
    *p_m_pTask = (CTask *)(*((int (__fastcall **)(const CTask *))Task->_vptr$CTask + 2))(Task);
    v7->m_iSlot = iSlot;
    return;
  }
  if ( !bForce )
  {
    v10 = (*((int (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 5))(m_pTask);
    v11 = (*((int (__fastcall **)(const CTask *))Task->_vptr$CTask + 5))(Task);
    m_pTask = *p_m_pTask;
    if ( v10 == v11 )
    {
      if ( m_pTask )
        return;
      goto LABEL_5;
    }
  }
  *p_m_pTask = (CTask *)(*((int (__fastcall **)(const CTask *))Task->_vptr$CTask + 2))(Task);
  v7->m_iSlot = iSlot;
  if ( m_pTask )
    (*((void (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 1))(m_pTask);
}

//----- (004B36B2) --------------------------------------------------------
const CTask *__fastcall CPedGroupIntelligence::GetTaskMain(const CPedGroupIntelligence *this, CPed *pPed)
{
  int v2; // r2
  CTask *m_pTask; // r2
  int v4; // r2
  int v6; // r1

  if ( this->m_scriptCommandPedTaskPairs[0].m_pPed == pPed )
  {
    v2 = 0;
  }
  else if ( this->m_scriptCommandPedTaskPairs[1].m_pPed == pPed )
  {
    v2 = 1;
  }
  else if ( this->m_scriptCommandPedTaskPairs[2].m_pPed == pPed )
  {
    v2 = 2;
  }
  else if ( this->m_scriptCommandPedTaskPairs[3].m_pPed == pPed )
  {
    v2 = 3;
  }
  else if ( this->m_scriptCommandPedTaskPairs[4].m_pPed == pPed )
  {
    v2 = 4;
  }
  else if ( this->m_scriptCommandPedTaskPairs[5].m_pPed == pPed )
  {
    v2 = 5;
  }
  else if ( this->m_scriptCommandPedTaskPairs[6].m_pPed == pPed )
  {
    v2 = 6;
  }
  else
  {
    if ( this->m_scriptCommandPedTaskPairs[7].m_pPed != pPed )
      goto LABEL_18;
    v2 = 7;
  }
  m_pTask = this->m_scriptCommandPedTaskPairs[v2].m_pTask;
  if ( m_pTask )
    return m_pTask;
LABEL_18:
  if ( this->m_pedTaskPairs[0].m_pPed == pPed )
  {
    v4 = 0;
  }
  else if ( this->m_pedTaskPairs[1].m_pPed == pPed )
  {
    v4 = 1;
  }
  else if ( this->m_pedTaskPairs[2].m_pPed == pPed )
  {
    v4 = 2;
  }
  else if ( this->m_pedTaskPairs[3].m_pPed == pPed )
  {
    v4 = 3;
  }
  else if ( this->m_pedTaskPairs[4].m_pPed == pPed )
  {
    v4 = 4;
  }
  else if ( this->m_pedTaskPairs[5].m_pPed == pPed )
  {
    v4 = 5;
  }
  else if ( this->m_pedTaskPairs[6].m_pPed == pPed )
  {
    v4 = 6;
  }
  else
  {
    if ( this->m_pedTaskPairs[7].m_pPed != pPed )
      goto LABEL_36;
    v4 = 7;
  }
  m_pTask = this->m_pedTaskPairs[v4].m_pTask;
  if ( m_pTask )
    return m_pTask;
LABEL_36:
  if ( this->m_defaultPedTaskPairs[0].m_pPed == pPed )
  {
    v6 = 0;
  }
  else if ( this->m_defaultPedTaskPairs[1].m_pPed == pPed )
  {
    v6 = 1;
  }
  else if ( this->m_defaultPedTaskPairs[2].m_pPed == pPed )
  {
    v6 = 2;
  }
  else if ( this->m_defaultPedTaskPairs[3].m_pPed == pPed )
  {
    v6 = 3;
  }
  else if ( this->m_defaultPedTaskPairs[4].m_pPed == pPed )
  {
    v6 = 4;
  }
  else if ( this->m_defaultPedTaskPairs[5].m_pPed == pPed )
  {
    v6 = 5;
  }
  else if ( this->m_defaultPedTaskPairs[6].m_pPed == pPed )
  {
    v6 = 6;
  }
  else
  {
    if ( this->m_defaultPedTaskPairs[7].m_pPed != pPed )
      return 0;
    v6 = 7;
  }
  return this->m_defaultPedTaskPairs[v6].m_pTask;
}

//----- (004B37F4) --------------------------------------------------------
CTask *__fastcall CPedGroupIntelligence::GetTask(const CPedGroupIntelligence *this, CPed *pPed, const CPedTaskPair *p)
{
  int v4; // r0

  if ( p->m_pPed == pPed )
  {
    v4 = 0;
  }
  else if ( p[1].m_pPed == pPed )
  {
    v4 = 1;
  }
  else if ( p[2].m_pPed == pPed )
  {
    v4 = 2;
  }
  else if ( p[3].m_pPed == pPed )
  {
    v4 = 3;
  }
  else if ( p[4].m_pPed == pPed )
  {
    v4 = 4;
  }
  else if ( p[5].m_pPed == pPed )
  {
    v4 = 5;
  }
  else if ( p[6].m_pPed == pPed )
  {
    v4 = 6;
  }
  else
  {
    if ( p[7].m_pPed != pPed )
      return 0;
    v4 = 7;
  }
  return p[v4].m_pTask;
}

//----- (004B3854) --------------------------------------------------------
const CTask *__fastcall CPedGroupIntelligence::GetTaskSecondary(const CPedGroupIntelligence *this, CPed *pPed)
{
  int v3; // r1

  if ( this->m_secondaryPedTaskPairs[0].m_pPed == pPed )
  {
    v3 = 0;
  }
  else if ( this->m_secondaryPedTaskPairs[1].m_pPed == pPed )
  {
    v3 = 1;
  }
  else if ( this->m_secondaryPedTaskPairs[2].m_pPed == pPed )
  {
    v3 = 2;
  }
  else if ( this->m_secondaryPedTaskPairs[3].m_pPed == pPed )
  {
    v3 = 3;
  }
  else if ( this->m_secondaryPedTaskPairs[4].m_pPed == pPed )
  {
    v3 = 4;
  }
  else if ( this->m_secondaryPedTaskPairs[5].m_pPed == pPed )
  {
    v3 = 5;
  }
  else if ( this->m_secondaryPedTaskPairs[6].m_pPed == pPed )
  {
    v3 = 6;
  }
  else
  {
    if ( this->m_secondaryPedTaskPairs[7].m_pPed != pPed )
      return 0;
    v3 = 7;
  }
  return this->m_secondaryPedTaskPairs[v3].m_pTask;
}

//----- (004B38C4) --------------------------------------------------------
int __fastcall CPedGroupIntelligence::GetTaskSecondarySlot(const CPedGroupIntelligence *this, CPed *pPed)
{
  int v3; // r1

  if ( this->m_secondaryPedTaskPairs[0].m_pPed == pPed )
  {
    v3 = 0;
  }
  else if ( this->m_secondaryPedTaskPairs[1].m_pPed == pPed )
  {
    v3 = 1;
  }
  else if ( this->m_secondaryPedTaskPairs[2].m_pPed == pPed )
  {
    v3 = 2;
  }
  else if ( this->m_secondaryPedTaskPairs[3].m_pPed == pPed )
  {
    v3 = 3;
  }
  else if ( this->m_secondaryPedTaskPairs[4].m_pPed == pPed )
  {
    v3 = 4;
  }
  else if ( this->m_secondaryPedTaskPairs[5].m_pPed == pPed )
  {
    v3 = 5;
  }
  else if ( this->m_secondaryPedTaskPairs[6].m_pPed == pPed )
  {
    v3 = 6;
  }
  else
  {
    if ( this->m_secondaryPedTaskPairs[7].m_pPed != pPed )
      return -1;
    v3 = 7;
  }
  return this->m_secondaryPedTaskPairs[v3].m_iSlot;
}

//----- (004B3936) --------------------------------------------------------
int __fastcall CPedGroupIntelligence::GetTaskSlot(const CPedGroupIntelligence *this, CPed *pPed, const CPedTaskPair *p)
{
  int v4; // r0

  if ( p->m_pPed == pPed )
  {
    v4 = 0;
  }
  else if ( p[1].m_pPed == pPed )
  {
    v4 = 1;
  }
  else if ( p[2].m_pPed == pPed )
  {
    v4 = 2;
  }
  else if ( p[3].m_pPed == pPed )
  {
    v4 = 3;
  }
  else if ( p[4].m_pPed == pPed )
  {
    v4 = 4;
  }
  else if ( p[5].m_pPed == pPed )
  {
    v4 = 5;
  }
  else if ( p[6].m_pPed == pPed )
  {
    v4 = 6;
  }
  else
  {
    if ( p[7].m_pPed != pPed )
      return -1;
    v4 = 7;
  }
  return p[v4].m_iSlot;
}

//----- (004B3998) --------------------------------------------------------
const CTask *__fastcall CPedGroupIntelligence::GetTaskScriptCommand(const CPedGroupIntelligence *this, CPed *pPed)
{
  int v3; // r1

  if ( this->m_scriptCommandPedTaskPairs[0].m_pPed == pPed )
  {
    v3 = 0;
  }
  else if ( this->m_scriptCommandPedTaskPairs[1].m_pPed == pPed )
  {
    v3 = 1;
  }
  else if ( this->m_scriptCommandPedTaskPairs[2].m_pPed == pPed )
  {
    v3 = 2;
  }
  else if ( this->m_scriptCommandPedTaskPairs[3].m_pPed == pPed )
  {
    v3 = 3;
  }
  else if ( this->m_scriptCommandPedTaskPairs[4].m_pPed == pPed )
  {
    v3 = 4;
  }
  else if ( this->m_scriptCommandPedTaskPairs[5].m_pPed == pPed )
  {
    v3 = 5;
  }
  else if ( this->m_scriptCommandPedTaskPairs[6].m_pPed == pPed )
  {
    v3 = 6;
  }
  else
  {
    if ( this->m_scriptCommandPedTaskPairs[7].m_pPed != pPed )
      return 0;
    v3 = 7;
  }
  return this->m_scriptCommandPedTaskPairs[v3].m_pTask;
}

//----- (004B3A08) --------------------------------------------------------
const CTask *__fastcall CPedGroupIntelligence::GetTaskDefault(const CPedGroupIntelligence *this, CPed *pPed)
{
  int v3; // r1

  if ( this->m_defaultPedTaskPairs[0].m_pPed == pPed )
  {
    v3 = 0;
  }
  else if ( this->m_defaultPedTaskPairs[1].m_pPed == pPed )
  {
    v3 = 1;
  }
  else if ( this->m_defaultPedTaskPairs[2].m_pPed == pPed )
  {
    v3 = 2;
  }
  else if ( this->m_defaultPedTaskPairs[3].m_pPed == pPed )
  {
    v3 = 3;
  }
  else if ( this->m_defaultPedTaskPairs[4].m_pPed == pPed )
  {
    v3 = 4;
  }
  else if ( this->m_defaultPedTaskPairs[5].m_pPed == pPed )
  {
    v3 = 5;
  }
  else if ( this->m_defaultPedTaskPairs[6].m_pPed == pPed )
  {
    v3 = 6;
  }
  else
  {
    if ( this->m_defaultPedTaskPairs[7].m_pPed != pPed )
      return 0;
    v3 = 7;
  }
  return this->m_defaultPedTaskPairs[v3].m_pTask;
}

//----- (004B3A78) --------------------------------------------------------
bool __fastcall CPedGroupIntelligence::ReportFinishedTask(
        CPedGroupIntelligence *this,
        const CPed *pPed,
        const CTask *finishedTask)
{
  CTask **p_m_pTask; // r4
  int v7; // r5
  int v8; // r6
  int v9; // r5
  int v10; // r6
  CTask **v11; // r4
  int v12; // r5
  int v13; // r6
  bool result; // r0
  int v15; // r5
  int v16; // r6

  p_m_pTask = &this->m_scriptCommandPedTaskPairs[0].m_pTask;
  v7 = -1;
  while ( 1 )
  {
    if ( *(p_m_pTask - 1) == (CTask *)pPed )
    {
      if ( *p_m_pTask )
      {
        v8 = (*((int (__fastcall **)(const CTask *))finishedTask->_vptr$CTask + 5))(finishedTask);
        if ( v8 == (*((int (__fastcall **)(CTask *))(*p_m_pTask)->_vptr$CTask + 5))(*p_m_pTask) )
          break;
      }
    }
    ++v7;
    p_m_pTask += 5;
    if ( v7 >= 7 )
    {
      p_m_pTask = &this->m_pedTaskPairs[0].m_pTask;
      v9 = -1;
      while ( 1 )
      {
        if ( *(p_m_pTask - 1) == (CTask *)pPed )
        {
          if ( *p_m_pTask )
          {
            v10 = (*((int (__fastcall **)(const CTask *))finishedTask->_vptr$CTask + 5))(finishedTask);
            if ( v10 == (*((int (__fastcall **)(CTask *))(*p_m_pTask)->_vptr$CTask + 5))(*p_m_pTask) )
              goto LABEL_17;
          }
        }
        ++v9;
        p_m_pTask += 5;
        if ( v9 >= 7 )
        {
          v11 = &this->m_secondaryPedTaskPairs[0].m_pTask;
          v12 = -1;
          while ( 1 )
          {
            if ( *(v11 - 1) == (CTask *)pPed )
            {
              if ( *v11 )
              {
                v13 = (*((int (__fastcall **)(const CTask *))finishedTask->_vptr$CTask + 5))(finishedTask);
                if ( v13 == (*((int (__fastcall **)(CTask *))(*v11)->_vptr$CTask + 5))(*v11) )
                  break;
              }
            }
            ++v12;
            v11 += 5;
            if ( v12 >= 7 )
              goto LABEL_23;
          }
          if ( *v11 )
            (*((void (__fastcall **)(CTask *))(*v11)->_vptr$CTask + 1))(*v11);
          *v11 = 0;
LABEL_23:
          p_m_pTask = &this->m_defaultPedTaskPairs[0].m_pTask;
          v15 = -1;
          while ( 1 )
          {
            if ( *(p_m_pTask - 1) == (CTask *)pPed )
            {
              if ( *p_m_pTask )
              {
                v16 = (*((int (__fastcall **)(const CTask *))finishedTask->_vptr$CTask + 5))(finishedTask);
                if ( v16 == (*((int (__fastcall **)(CTask *))(*p_m_pTask)->_vptr$CTask + 5))(*p_m_pTask) )
                  break;
              }
            }
            ++v15;
            p_m_pTask += 5;
            if ( v15 >= 7 )
              return 0;
          }
          if ( *p_m_pTask )
            (*((void (__fastcall **)(CTask *))(*p_m_pTask)->_vptr$CTask + 1))(*p_m_pTask);
          result = 0;
          goto LABEL_32;
        }
      }
    }
  }
LABEL_17:
  if ( *p_m_pTask )
    (*((void (__fastcall **)(CTask *))(*p_m_pTask)->_vptr$CTask + 1))(*p_m_pTask);
  result = 1;
LABEL_32:
  *p_m_pTask = 0;
  return result;
}

//----- (004B3B98) --------------------------------------------------------
bool __fastcall CPedGroupIntelligence::ReportFinishedTask(
        CPedGroupIntelligence *this,
        const CPed *pPed,
        const CTask *finishedTask,
        CPedTaskPair *pPedTaskPairs)
{
  CTask **p_m_pTask; // r4
  int v7; // r6
  int v8; // r9

  p_m_pTask = &pPedTaskPairs->m_pTask;
  v7 = -1;
  while ( 1 )
  {
    if ( *(p_m_pTask - 1) == (CTask *)pPed )
    {
      if ( *p_m_pTask )
      {
        v8 = (*((int (__fastcall **)(const CTask *))finishedTask->_vptr$CTask + 5))(finishedTask);
        if ( v8 == (*((int (__fastcall **)(CTask *))(*p_m_pTask)->_vptr$CTask + 5))(*p_m_pTask) )
          break;
      }
    }
    ++v7;
    p_m_pTask += 5;
    if ( v7 >= 7 )
      return 0;
  }
  if ( *p_m_pTask )
    (*((void (__fastcall **)(CTask *))(*p_m_pTask)->_vptr$CTask + 1))(*p_m_pTask);
  *p_m_pTask = 0;
  return 1;
}

//----- (004B3BF6) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::ReportAllTasksFinished(CPedGroupIntelligence *this)
{
  CPedGroupIntelligence *v2; // r0
  CPedGroupIntelligence *v3; // r0

  CPedGroupIntelligence::ReportAllTasksFinished(this, this->m_pedTaskPairs);
  CPedGroupIntelligence::ReportAllTasksFinished(v2, this->m_scriptCommandPedTaskPairs);
  CPedGroupIntelligence::ReportAllTasksFinished(v3, this->m_secondaryPedTaskPairs);
}
// 4B3C08: variable 'v2' is possibly undefined
// 4B3C15: variable 'v3' is possibly undefined

//----- (004B3C16) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::ReportAllTasksFinished(CPedGroupIntelligence *this, CPedTaskPair *pPedTaskPairs)
{
  CTask *m_pTask; // r0
  CTask *v4; // r0
  CTask *v5; // r0
  CTask *v6; // r0
  CTask *v7; // r0
  CTask *v8; // r0
  CTask *v9; // r0
  CTask *v10; // r0

  m_pTask = pPedTaskPairs->m_pTask;
  if ( m_pTask )
  {
    (*((void (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 1))(m_pTask);
    pPedTaskPairs->m_pTask = 0;
  }
  v4 = pPedTaskPairs[1].m_pTask;
  if ( v4 )
  {
    (*((void (__fastcall **)(CTask *))v4->_vptr$CTask + 1))(v4);
    pPedTaskPairs[1].m_pTask = 0;
  }
  v5 = pPedTaskPairs[2].m_pTask;
  if ( v5 )
  {
    (*((void (__fastcall **)(CTask *))v5->_vptr$CTask + 1))(v5);
    pPedTaskPairs[2].m_pTask = 0;
  }
  v6 = pPedTaskPairs[3].m_pTask;
  if ( v6 )
  {
    (*((void (__fastcall **)(CTask *))v6->_vptr$CTask + 1))(v6);
    pPedTaskPairs[3].m_pTask = 0;
  }
  v7 = pPedTaskPairs[4].m_pTask;
  if ( v7 )
  {
    (*((void (__fastcall **)(CTask *))v7->_vptr$CTask + 1))(v7);
    pPedTaskPairs[4].m_pTask = 0;
  }
  v8 = pPedTaskPairs[5].m_pTask;
  if ( v8 )
  {
    (*((void (__fastcall **)(CTask *))v8->_vptr$CTask + 1))(v8);
    pPedTaskPairs[5].m_pTask = 0;
  }
  v9 = pPedTaskPairs[6].m_pTask;
  if ( v9 )
  {
    (*((void (__fastcall **)(CTask *))v9->_vptr$CTask + 1))(v9);
    pPedTaskPairs[6].m_pTask = 0;
  }
  v10 = pPedTaskPairs[7].m_pTask;
  if ( v10 )
  {
    (*((void (__fastcall **)(CTask *))v10->_vptr$CTask + 1))(v10);
    pPedTaskPairs[7].m_pTask = 0;
  }
}

//----- (004B3C96) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::ReportAllBarScriptTasksFinished(CPedGroupIntelligence *this)
{
  CPedGroupIntelligence *v2; // r0

  CPedGroupIntelligence::ReportAllTasksFinished(this, this->m_pedTaskPairs);
  CPedGroupIntelligence::ReportAllTasksFinished(v2, this->m_secondaryPedTaskPairs);
}
// 4B3CAC: variable 'v2' is possibly undefined

//----- (004B3CAE) --------------------------------------------------------
bool __fastcall CPedGroupIntelligence::IsGroupResponding(const CPedGroupIntelligence *this)
{
  CPed *m_pPed; // r1
  bool v2; // zf
  CPed *v3; // r1
  bool v4; // zf
  CPed *v5; // r1
  bool v6; // zf
  CPed *v7; // r1
  bool v8; // zf
  CPed *v9; // r1
  bool v10; // zf
  CPed *v11; // r1
  bool v12; // zf
  CPed *v13; // r1
  bool v14; // zf
  CPed *v15; // r1
  bool v16; // zf
  CPed *v17; // r1
  bool v18; // zf
  CPed *v19; // r1
  bool v20; // zf
  CPed *v21; // r1
  bool v22; // zf
  CPed *v23; // r1
  bool v24; // zf
  CPed *v25; // r1
  bool v26; // zf
  CPed *v27; // r1
  bool v28; // zf
  CPed *v29; // r1
  bool v30; // zf

  m_pPed = this->m_pedTaskPairs[0].m_pPed;
  v2 = m_pPed == 0;
  if ( m_pPed )
    v2 = this->m_pedTaskPairs[0].m_pTask == 0;
  if ( !v2 )
    return 1;
  v3 = this->m_secondaryPedTaskPairs[0].m_pPed;
  v4 = v3 == 0;
  if ( v3 )
    v4 = this->m_secondaryPedTaskPairs[0].m_pTask == 0;
  if ( !v4 || this->m_pedTaskPairs[1].m_pPed && this->m_pedTaskPairs[1].m_pTask )
    return 1;
  v5 = this->m_secondaryPedTaskPairs[1].m_pPed;
  v6 = v5 == 0;
  if ( v5 )
    v6 = this->m_secondaryPedTaskPairs[1].m_pTask == 0;
  if ( !v6 )
    return 1;
  v7 = this->m_pedTaskPairs[2].m_pPed;
  v8 = v7 == 0;
  if ( v7 )
    v8 = this->m_pedTaskPairs[2].m_pTask == 0;
  if ( !v8 )
    return 1;
  v9 = this->m_secondaryPedTaskPairs[2].m_pPed;
  v10 = v9 == 0;
  if ( v9 )
    v10 = this->m_secondaryPedTaskPairs[2].m_pTask == 0;
  if ( !v10 )
    return 1;
  v11 = this->m_pedTaskPairs[3].m_pPed;
  v12 = v11 == 0;
  if ( v11 )
    v12 = this->m_pedTaskPairs[3].m_pTask == 0;
  if ( !v12 )
    return 1;
  v13 = this->m_secondaryPedTaskPairs[3].m_pPed;
  v14 = v13 == 0;
  if ( v13 )
    v14 = this->m_secondaryPedTaskPairs[3].m_pTask == 0;
  if ( !v14 )
    return 1;
  v15 = this->m_pedTaskPairs[4].m_pPed;
  v16 = v15 == 0;
  if ( v15 )
    v16 = this->m_pedTaskPairs[4].m_pTask == 0;
  if ( !v16 )
    return 1;
  v17 = this->m_secondaryPedTaskPairs[4].m_pPed;
  v18 = v17 == 0;
  if ( v17 )
    v18 = this->m_secondaryPedTaskPairs[4].m_pTask == 0;
  if ( !v18 )
    return 1;
  v19 = this->m_pedTaskPairs[5].m_pPed;
  v20 = v19 == 0;
  if ( v19 )
    v20 = this->m_pedTaskPairs[5].m_pTask == 0;
  if ( !v20 )
    return 1;
  v21 = this->m_secondaryPedTaskPairs[5].m_pPed;
  v22 = v21 == 0;
  if ( v21 )
    v22 = this->m_secondaryPedTaskPairs[5].m_pTask == 0;
  if ( !v22 )
    return 1;
  v23 = this->m_pedTaskPairs[6].m_pPed;
  v24 = v23 == 0;
  if ( v23 )
    v24 = this->m_pedTaskPairs[6].m_pTask == 0;
  if ( !v24 )
    return 1;
  v25 = this->m_secondaryPedTaskPairs[6].m_pPed;
  v26 = v25 == 0;
  if ( v25 )
    v26 = this->m_secondaryPedTaskPairs[6].m_pTask == 0;
  if ( !v26 )
    return 1;
  v27 = this->m_pedTaskPairs[7].m_pPed;
  v28 = v27 == 0;
  if ( v27 )
    v28 = this->m_pedTaskPairs[7].m_pTask == 0;
  if ( !v28 )
    return 1;
  v29 = this->m_secondaryPedTaskPairs[7].m_pPed;
  v30 = v29 == 0;
  if ( v29 )
    v30 = this->m_secondaryPedTaskPairs[7].m_pTask == 0;
  return !v30;
}

//----- (004B3D9C) --------------------------------------------------------
bool __fastcall CPedGroupIntelligence::IsCurrentEventValid(const CPedGroupIntelligence *this)
{
  CEventGroupEvent *m_pCurrentEvent; // r0
  CEvent *m_pEvent; // r5
  int v4; // r0
  CPedGroup *m_pPedGroup; // r1
  CPed *v6; // r2
  bool v7; // zf
  CPed *v8; // r2
  bool v9; // zf
  CPed *v10; // r2
  bool v11; // zf
  CPed *v12; // r2
  bool v13; // zf

  m_pCurrentEvent = this->m_pCurrentEvent;
  if ( !m_pCurrentEvent )
    return 1;
  if ( (*((int (__fastcall **)(CEvent *))m_pCurrentEvent->m_pEvent->_vptr$CEvent + 2))(m_pCurrentEvent->m_pEvent) != 71 )
    return 1;
  m_pEvent = this->m_pCurrentEvent->m_pEvent;
  if ( !(*((int (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 11))(m_pEvent) )
    return 1;
  if ( (*(_BYTE *)((*((int (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 11))(m_pEvent) + 58) & 7) != 3 )
    return 1;
  v4 = (*((int (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 11))(m_pEvent);
  if ( !v4 )
    return 1;
  m_pPedGroup = this->m_pPedGroup;
  v6 = this->m_pPedGroup->m_membership.m_pMembers[0];
  v7 = v6 == (CPed *)v4;
  if ( v6 != (CPed *)v4 )
    v7 = m_pPedGroup->m_membership.m_pMembers[1] == (CPed *)v4;
  if ( v7 )
    return 0;
  v8 = m_pPedGroup->m_membership.m_pMembers[2];
  v9 = v8 == (CPed *)v4;
  if ( v8 != (CPed *)v4 )
    v9 = m_pPedGroup->m_membership.m_pMembers[3] == (CPed *)v4;
  if ( v9 )
    return 0;
  v10 = m_pPedGroup->m_membership.m_pMembers[4];
  v11 = v10 == (CPed *)v4;
  if ( v10 != (CPed *)v4 )
    v11 = m_pPedGroup->m_membership.m_pMembers[5] == (CPed *)v4;
  if ( v11 )
    return 0;
  v12 = m_pPedGroup->m_membership.m_pMembers[6];
  v13 = v12 == (CPed *)v4;
  if ( v12 != (CPed *)v4 )
    v13 = m_pPedGroup->m_membership.m_pMembers[7] == (CPed *)v4;
  return !v13;
}

//----- (004B3E18) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::ComputeScriptCommandTasks(CPedGroupIntelligence *this)
{
  int v2; // r0
  CPedGroup *m_pPedGroup; // r1
  CPed **m_pMembers; // r1
  __int64 v5; // kr00_8
  CPed *v6; // r3
  CTask *m_pTask; // r3
  int v8; // r3
  int i; // r6
  char *v10; // r5
  CTask *v11; // r0
  int v12; // r1
  int v13; // r1
  __int64 v14; // [sp+0h] [bp-B8h] BYREF
  int v15; // [sp+8h] [bp-B0h]
  int v16; // [sp+Ch] [bp-ACh]
  char v17; // [sp+10h] [bp-A8h]
  __int64 v18; // [sp+14h] [bp-A4h]
  int v19; // [sp+1Ch] [bp-9Ch]
  int v20; // [sp+20h] [bp-98h]
  char v21; // [sp+24h] [bp-94h]
  __int64 v22; // [sp+28h] [bp-90h]
  int v23; // [sp+30h] [bp-88h]
  int v24; // [sp+34h] [bp-84h]
  char v25; // [sp+38h] [bp-80h]
  __int64 v26; // [sp+3Ch] [bp-7Ch]
  int v27; // [sp+44h] [bp-74h]
  int v28; // [sp+48h] [bp-70h]
  char v29; // [sp+4Ch] [bp-6Ch]
  __int64 v30; // [sp+50h] [bp-68h]
  int v31; // [sp+58h] [bp-60h]
  int v32; // [sp+5Ch] [bp-5Ch]
  char v33; // [sp+60h] [bp-58h]
  __int64 v34; // [sp+64h] [bp-54h]
  int v35; // [sp+6Ch] [bp-4Ch]
  int v36; // [sp+70h] [bp-48h]
  char v37; // [sp+74h] [bp-44h]
  __int64 v38; // [sp+78h] [bp-40h]
  int v39; // [sp+80h] [bp-38h]
  int v40; // [sp+84h] [bp-34h]
  char v41; // [sp+88h] [bp-30h]
  __int64 v42; // [sp+8Ch] [bp-2Ch]
  int v43; // [sp+94h] [bp-24h]
  int v44; // [sp+98h] [bp-20h]
  char v45; // [sp+9Ch] [bp-1Ch]

  v2 = 0;
  m_pPedGroup = this->m_pPedGroup;
  v14 = 0LL;
  m_pMembers = m_pPedGroup->m_membership.m_pMembers;
  v15 = -1;
  v16 = 0;
  v17 = 0;
  v18 = 0LL;
  v19 = -1;
  v20 = 0;
  v21 = 0;
  v22 = 0LL;
  v23 = -1;
  v24 = 0;
  v25 = 0;
  v27 = -1;
  v28 = 0;
  v29 = 0;
  v26 = 0LL;
  v31 = -1;
  v32 = 0;
  v33 = 0;
  v30 = 0LL;
  v35 = -1;
  v36 = 0;
  v37 = 0;
  v34 = 0LL;
  v39 = -1;
  v40 = 0;
  v41 = 0;
  v38 = 0LL;
  v43 = -1;
  v44 = 0;
  v45 = 0;
  v42 = 0LL;
  do
  {
    v5 = *(_QWORD *)&this->m_scriptCommandPedTaskPairs[v2].m_pPed;
    *(__int64 *)((char *)&v14 + v2 * 20) = v5;
    if ( *m_pMembers == (CPed *)v5 )
      goto LABEL_22;
    *(_DWORD *)((char *)&v14 + v2 * 20) = *m_pMembers;
    v6 = *m_pMembers;
    if ( this->m_scriptCommandPedTaskPairs[0].m_pPed == *m_pMembers )
    {
      v8 = 0;
LABEL_20:
      m_pTask = this->m_scriptCommandPedTaskPairs[v8].m_pTask;
      goto LABEL_21;
    }
    if ( this->m_scriptCommandPedTaskPairs[1].m_pPed == v6 )
    {
      v8 = 1;
      goto LABEL_20;
    }
    if ( this->m_scriptCommandPedTaskPairs[2].m_pPed == v6 )
    {
      v8 = 2;
      goto LABEL_20;
    }
    if ( this->m_scriptCommandPedTaskPairs[3].m_pPed == v6 )
    {
      v8 = 3;
      goto LABEL_20;
    }
    if ( this->m_scriptCommandPedTaskPairs[4].m_pPed == v6 )
    {
      v8 = 4;
      goto LABEL_20;
    }
    if ( this->m_scriptCommandPedTaskPairs[5].m_pPed == v6 )
    {
      v8 = 5;
      goto LABEL_20;
    }
    if ( this->m_scriptCommandPedTaskPairs[6].m_pPed == v6 )
    {
      v8 = 6;
      goto LABEL_20;
    }
    if ( this->m_scriptCommandPedTaskPairs[7].m_pPed == v6 )
    {
      v8 = 7;
      goto LABEL_20;
    }
    m_pTask = 0;
LABEL_21:
    *(_DWORD *)((char *)&v14 + v2 * 20 + 4) = m_pTask;
LABEL_22:
    ++v2;
    ++m_pMembers;
  }
  while ( v2 != 8 );
  for ( i = 0; i != 8; ++i )
  {
    v10 = (char *)this + i * 20;
    v11 = this->m_scriptCommandPedTaskPairs[i].m_pTask;
    if ( !v11 )
      continue;
    v12 = *((_DWORD *)v10 + 83);
    if ( (_DWORD)v14 == v12 )
    {
      v13 = 0;
      goto LABEL_41;
    }
    if ( (_DWORD)v18 == v12 )
    {
      v13 = 1;
      goto LABEL_41;
    }
    if ( (_DWORD)v22 == v12 )
    {
      v13 = 2;
      goto LABEL_41;
    }
    if ( (_DWORD)v26 == v12 )
    {
      v13 = 3;
      goto LABEL_41;
    }
    if ( (_DWORD)v30 == v12 )
    {
      v13 = 4;
      goto LABEL_41;
    }
    if ( (_DWORD)v34 == v12 )
    {
      v13 = 5;
      goto LABEL_41;
    }
    if ( (_DWORD)v38 == v12 )
    {
      v13 = 6;
LABEL_41:
      if ( *((_DWORD *)&v14 + 5 * v13 + 1) )
        continue;
      goto LABEL_42;
    }
    if ( (_DWORD)v42 == v12 )
    {
      v13 = 7;
      goto LABEL_41;
    }
LABEL_42:
    (*((void (__fastcall **)(CTask *))v11->_vptr$CTask + 1))(v11);
    *((_DWORD *)v10 + 83) = 0;
    *((_DWORD *)v10 + 84) = 0;
  }
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[0].m_pPed = v14;
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[1].m_pPed = v18;
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[2].m_pPed = v22;
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[3].m_pPed = v26;
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[4].m_pPed = v30;
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[5].m_pPed = v34;
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[6].m_pPed = v38;
  *(_QWORD *)&this->m_scriptCommandPedTaskPairs[7].m_pPed = v42;
}

//----- (004B3FE8) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::ProcessIgnorePlayerGroup(CPedGroupIntelligence *this)
{
  __int64 v2; // kr00_8
  CEventGroupEvent *v3; // r0
  CEventGroupEvent *m_pCurrentEvent; // r0
  int v5; // r0
  int v6; // r2
  CPed **i; // r1
  int v8; // r5
  bool v9; // zf
  int v10; // r5
  bool v11; // zf
  int v12; // r5
  bool v13; // zf
  int v14; // r5
  bool v15; // zf
  CPlayerPed *v17; // r5
  CEventGroupEvent *v18; // r0
  CPedGroupIntelligence *m_pEventResponseTaskAllocator; // r0
  CPedGroupIntelligence *v20; // r0

  if ( (*((_BYTE *)FindPlayerWanted(-1) + 30) & 4) != 0 )
  {
    v2 = *(_QWORD *)&this->m_pPedGroup;
    if ( !this->m_pCurrentEvent
      || (*(int (__fastcall **)(_DWORD))(**(_DWORD **)(HIDWORD(v2) + 16) + 8))(*(_DWORD *)(HIDWORD(v2) + 16)) != 77
      && ((v3 = this->m_pCurrentEvent) == 0
       || (*((int (__fastcall **)(CEvent *))v3->m_pEvent->_vptr$CEvent + 2))(v3->m_pEvent) != 54) )
    {
      if ( FindPlayerPed(-1) == *(CPlayerPed **)(v2 + 40) )
        goto LABEL_27;
      m_pCurrentEvent = this->m_pCurrentEvent;
      if ( m_pCurrentEvent )
      {
        v5 = (*((int (__fastcall **)(CEvent *))m_pCurrentEvent->m_pEvent->_vptr$CEvent + 11))(m_pCurrentEvent->m_pEvent);
        if ( v5 )
        {
          if ( (*(_BYTE *)(v5 + 58) & 7) == 3 )
          {
            v6 = 0;
            for ( i = &CPedGroups::ms_groups[0].m_membership.m_pMembers[7]; ; i += 181 )
            {
              if ( CPedGroups::ms_activeGroups[v6] )
              {
                v8 = (int)*(i - 7);
                v9 = v8 == v5;
                if ( v8 != v5 )
                  v9 = *(i - 6) == (CPed *)v5;
                if ( v9 )
                  break;
                v10 = (int)*(i - 5);
                v11 = v10 == v5;
                if ( v10 != v5 )
                  v11 = *(i - 4) == (CPed *)v5;
                if ( v11 )
                  break;
                v12 = (int)*(i - 3);
                v13 = v12 == v5;
                if ( v12 != v5 )
                  v13 = *(i - 2) == (CPed *)v5;
                if ( v13 )
                  break;
                v14 = (int)*(i - 1);
                v15 = v14 == v5;
                if ( v14 != v5 )
                  v15 = *i == (CPed *)v5;
                if ( v15 )
                  break;
              }
              if ( v6++ >= 7 )
                return;
            }
            v17 = (CPlayerPed *)*i;
            if ( v17 == FindPlayerPed(-1) )
            {
LABEL_27:
              v18 = this->m_pCurrentEvent;
              if ( v18 )
              {
                (*((void (__fastcall **)(CEventGroupEvent *))v18->_vptr$CEvent + 1))(v18);
                m_pEventResponseTaskAllocator = (CPedGroupIntelligence *)this->m_pEventResponseTaskAllocator;
                this->m_pCurrentEvent = 0;
                if ( m_pEventResponseTaskAllocator )
                  m_pEventResponseTaskAllocator = (CPedGroupIntelligence *)(*(int (__fastcall **)(CPedGroupIntelligence *))&m_pEventResponseTaskAllocator->m_pPedGroup->m_followLeader)(m_pEventResponseTaskAllocator);
                this->m_pEventResponseTaskAllocator = 0;
                CPedGroupIntelligence::FlushTasks(m_pEventResponseTaskAllocator, this->m_pedTaskPairs, 0);
                CPedGroupIntelligence::FlushTasks(v20, this->m_secondaryPedTaskPairs, 0);
              }
            }
          }
        }
      }
    }
  }
}
// 4B40EE: variable 'v20' is possibly undefined

//----- (004B40FC) --------------------------------------------------------
CPedGroup *__fastcall CPedGroups::GetPedsGroup(const CPed *pPed)
{
  CPedGroup *v1; // r2
  int v2; // r1
  int v3; // r4
  _BOOL4 v4; // r1
  bool v5; // zf
  CPedGroup *v6; // r1
  const CPed *v7; // r5
  bool v8; // zf
  const CPed *v9; // r5
  bool v10; // zf
  const CPed *v11; // r5
  bool v12; // zf

  v1 = CPedGroups::ms_groups;
  v2 = 0;
  while ( 1 )
  {
    v3 = v2;
    v4 = CPedGroups::ms_activeGroups[v2];
    v5 = !v4;
    if ( v4 )
      v5 = pPed == 0;
    if ( !v5 )
    {
      v6 = &CPedGroups::ms_groups[v3];
      if ( v1->m_membership.m_pMembers[0] == pPed )
        return v6;
      v7 = v1->m_membership.m_pMembers[1];
      v8 = v7 == pPed;
      if ( v7 != pPed )
        v8 = v1->m_membership.m_pMembers[2] == pPed;
      if ( v8 )
        return v6;
      v9 = v1->m_membership.m_pMembers[3];
      v10 = v9 == pPed;
      if ( v9 != pPed )
        v10 = v1->m_membership.m_pMembers[4] == pPed;
      if ( v10 )
        return v6;
      v11 = v1->m_membership.m_pMembers[5];
      v12 = v11 == pPed;
      if ( v11 != pPed )
        v12 = v1->m_membership.m_pMembers[6] == pPed;
      if ( v12 )
        return v6;
      if ( v1->m_membership.m_pMembers[7] == pPed )
        break;
    }
    ++v1;
    v2 = v3 + 1;
    if ( v3 >= 7 )
      return 0;
  }
  return v1;
}

//----- (004B417C) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::FlushTasks(CPedGroupIntelligence *this, CPedTaskPair *a, CPed *pPed)
{
  bool v5; // zf
  CTask *m_pTask; // r0
  CTask *v7; // r0
  CTask *v8; // r0
  CTask *v9; // r0
  CTask *v10; // r0
  CTask *v11; // r0
  CTask *v12; // r0
  CTask *v13; // r0

  v5 = pPed == 0;
  if ( pPed )
    v5 = a->m_pPed == pPed;
  if ( v5 )
  {
    m_pTask = a->m_pTask;
    if ( m_pTask )
      (*((void (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 1))(m_pTask);
    a->m_pTask = 0;
    if ( !pPed )
      goto LABEL_43;
  }
  if ( a[1].m_pPed == pPed )
  {
LABEL_43:
    v7 = a[1].m_pTask;
    if ( v7 )
      (*((void (__fastcall **)(CTask *))v7->_vptr$CTask + 1))(v7);
    a[1].m_pTask = 0;
    if ( !pPed )
      goto LABEL_42;
  }
  if ( a[2].m_pPed == pPed )
  {
LABEL_42:
    v8 = a[2].m_pTask;
    if ( v8 )
      (*((void (__fastcall **)(CTask *))v8->_vptr$CTask + 1))(v8);
    a[2].m_pTask = 0;
    if ( !pPed )
      goto LABEL_41;
  }
  if ( a[3].m_pPed == pPed )
  {
LABEL_41:
    v9 = a[3].m_pTask;
    if ( v9 )
      (*((void (__fastcall **)(CTask *))v9->_vptr$CTask + 1))(v9);
    a[3].m_pTask = 0;
    if ( !pPed )
      goto LABEL_40;
  }
  if ( a[4].m_pPed == pPed )
  {
LABEL_40:
    v10 = a[4].m_pTask;
    if ( v10 )
      (*((void (__fastcall **)(CTask *))v10->_vptr$CTask + 1))(v10);
    a[4].m_pTask = 0;
    if ( !pPed )
      goto LABEL_39;
  }
  if ( a[5].m_pPed == pPed )
  {
LABEL_39:
    v11 = a[5].m_pTask;
    if ( v11 )
      (*((void (__fastcall **)(CTask *))v11->_vptr$CTask + 1))(v11);
    a[5].m_pTask = 0;
    if ( !pPed )
      goto LABEL_38;
  }
  if ( a[6].m_pPed == pPed )
  {
LABEL_38:
    v12 = a[6].m_pTask;
    if ( v12 )
      (*((void (__fastcall **)(CTask *))v12->_vptr$CTask + 1))(v12);
    a[6].m_pTask = 0;
    if ( !pPed )
      goto LABEL_33;
  }
  if ( a[7].m_pPed == pPed )
  {
LABEL_33:
    v13 = a[7].m_pTask;
    if ( v13 )
      (*((void (__fastcall **)(CTask *))v13->_vptr$CTask + 1))(v13);
    a[7].m_pTask = 0;
  }
}

//----- (004B425E) --------------------------------------------------------
void __fastcall CPedGroupIntelligence::Process(CPedGroupIntelligence *this)
{
  CEventGroupEvent *m_pCurrentEvent; // r5
  CPedGroup *m_pPedGroup; // r6
  CTaskAllocator *m_pEventResponseTaskAllocator; // r0
  CPed *v5; // r0
  int v6; // r0
  CPed *v7; // r1
  CPed *v8; // r1
  CPed *v9; // r1
  CPed *v10; // r1
  CPed *v11; // r1
  CPed *v12; // r1
  CPed *v13; // r1
  CTaskAllocator *m_pPrimaryTaskAllocator; // r0
  CEventGroupEvent *m_pHighestPriorityEvent; // r0
  int v16; // r5
  CEventGroupEvent *v17; // r0
  CPedGroupIntelligence *v18; // r0
  CEvent *v19; // r5
  CPedGroupIntelligence *v20; // r0
  const CPedGroupDefaultTaskAllocator *m_pDefaultTaskAllocator; // r0
  CPedGroupIntelligence *v22; // r0
  CPedTaskPair *m_pedTaskPairs; // r1
  int v24; // r5
  CTaskAllocator *v25; // r0
  CTaskAllocator *v26; // r0
  CEventGroupEvent *v27; // r0
  bool v28; // zf
  void *v29; // r0
  bool v30; // zf
  CPedGroupIntelligence *v31; // r0

  CPedGroupIntelligence::ProcessIgnorePlayerGroup(this);
  m_pCurrentEvent = this->m_pCurrentEvent;
  m_pPedGroup = this->m_pPedGroup;
  if ( !m_pCurrentEvent || this->m_pPrimaryTaskAllocator )
    goto LABEL_10;
  if ( !CPedGroupIntelligence::IsGroupResponding(this) )
    goto LABEL_6;
  if ( CPedGroupIntelligence::IsCurrentEventValid(this) )
    goto LABEL_10;
  m_pCurrentEvent = this->m_pCurrentEvent;
  if ( m_pCurrentEvent )
LABEL_6:
    (*((void (__fastcall **)(CEventGroupEvent *))m_pCurrentEvent->_vptr$CEvent + 1))(m_pCurrentEvent);
  m_pEventResponseTaskAllocator = this->m_pEventResponseTaskAllocator;
  this->m_pCurrentEvent = 0;
  if ( m_pEventResponseTaskAllocator )
    (*((void (__fastcall **)(CTaskAllocator *))m_pEventResponseTaskAllocator->_vptr$CTaskAllocator + 1))(m_pEventResponseTaskAllocator);
  this->m_pEventResponseTaskAllocator = 0;
LABEL_10:
  v5 = m_pPedGroup->m_membership.m_pMembers[0];
  if ( v5 == this->m_pedTaskPairs[0].m_pPed )
  {
    v6 = 0;
  }
  else
  {
    this->m_pedTaskPairs[0].m_pPed = v5;
    this->m_secondaryPedTaskPairs[0].m_pPed = m_pPedGroup->m_membership.m_pMembers[0];
    this->m_defaultPedTaskPairs[0].m_pPed = m_pPedGroup->m_membership.m_pMembers[0];
    v6 = 1;
  }
  v7 = m_pPedGroup->m_membership.m_pMembers[1];
  if ( v7 != this->m_pedTaskPairs[1].m_pPed )
  {
    this->m_pedTaskPairs[1].m_pPed = v7;
    this->m_secondaryPedTaskPairs[1].m_pPed = m_pPedGroup->m_membership.m_pMembers[1];
    this->m_defaultPedTaskPairs[1].m_pPed = m_pPedGroup->m_membership.m_pMembers[1];
    v6 = 1;
  }
  v8 = m_pPedGroup->m_membership.m_pMembers[2];
  if ( v8 != this->m_pedTaskPairs[2].m_pPed )
  {
    this->m_pedTaskPairs[2].m_pPed = v8;
    this->m_secondaryPedTaskPairs[2].m_pPed = m_pPedGroup->m_membership.m_pMembers[2];
    this->m_defaultPedTaskPairs[2].m_pPed = m_pPedGroup->m_membership.m_pMembers[2];
    v6 = 1;
  }
  v9 = m_pPedGroup->m_membership.m_pMembers[3];
  if ( v9 != this->m_pedTaskPairs[3].m_pPed )
  {
    this->m_pedTaskPairs[3].m_pPed = v9;
    this->m_secondaryPedTaskPairs[3].m_pPed = m_pPedGroup->m_membership.m_pMembers[3];
    this->m_defaultPedTaskPairs[3].m_pPed = m_pPedGroup->m_membership.m_pMembers[3];
    v6 = 1;
  }
  v10 = m_pPedGroup->m_membership.m_pMembers[4];
  if ( v10 != this->m_pedTaskPairs[4].m_pPed )
  {
    this->m_pedTaskPairs[4].m_pPed = v10;
    this->m_secondaryPedTaskPairs[4].m_pPed = m_pPedGroup->m_membership.m_pMembers[4];
    this->m_defaultPedTaskPairs[4].m_pPed = m_pPedGroup->m_membership.m_pMembers[4];
    v6 = 1;
  }
  v11 = m_pPedGroup->m_membership.m_pMembers[5];
  if ( v11 != this->m_pedTaskPairs[5].m_pPed )
  {
    this->m_pedTaskPairs[5].m_pPed = v11;
    this->m_secondaryPedTaskPairs[5].m_pPed = m_pPedGroup->m_membership.m_pMembers[5];
    this->m_defaultPedTaskPairs[5].m_pPed = m_pPedGroup->m_membership.m_pMembers[5];
    v6 = 1;
  }
  v12 = m_pPedGroup->m_membership.m_pMembers[6];
  if ( v12 != this->m_pedTaskPairs[6].m_pPed )
  {
    this->m_pedTaskPairs[6].m_pPed = v12;
    this->m_secondaryPedTaskPairs[6].m_pPed = m_pPedGroup->m_membership.m_pMembers[6];
    this->m_defaultPedTaskPairs[6].m_pPed = m_pPedGroup->m_membership.m_pMembers[6];
    v6 = 1;
  }
  v13 = m_pPedGroup->m_membership.m_pMembers[7];
  if ( v13 == this->m_pedTaskPairs[7].m_pPed )
  {
    if ( !v6 )
      goto LABEL_30;
  }
  else
  {
    this->m_pedTaskPairs[7].m_pPed = v13;
    this->m_secondaryPedTaskPairs[7].m_pPed = m_pPedGroup->m_membership.m_pMembers[7];
    this->m_defaultPedTaskPairs[7].m_pPed = m_pPedGroup->m_membership.m_pMembers[7];
  }
  m_pPrimaryTaskAllocator = this->m_pPrimaryTaskAllocator;
  if ( m_pPrimaryTaskAllocator )
    goto LABEL_29;
  CPedGroupIntelligence::FlushTasks(0, this->m_defaultPedTaskPairs, 0);
  m_pDefaultTaskAllocator = this->m_pDefaultTaskAllocator;
  if ( m_pDefaultTaskAllocator )
    ((void (__fastcall *)(const CPedGroupDefaultTaskAllocator *, CPedGroup *, _DWORD))*m_pDefaultTaskAllocator->_vptr$CPedGroupDefaultTaskAllocator)(
      m_pDefaultTaskAllocator,
      this->m_pPedGroup,
      0);
  CPedGroupIntelligence::ComputeScriptCommandTasks(this);
  if ( this->m_pCurrentEvent )
  {
    v22 = (CPedGroupIntelligence *)this->m_pEventResponseTaskAllocator;
    m_pedTaskPairs = this->m_pedTaskPairs;
    if ( v22 )
    {
      CPedGroupIntelligence::FlushTasks(v22, m_pedTaskPairs, 0);
      m_pPrimaryTaskAllocator = this->m_pEventResponseTaskAllocator;
LABEL_29:
      (*((void (__fastcall **)(CTaskAllocator *, CPedGroupIntelligence *))m_pPrimaryTaskAllocator->_vptr$CTaskAllocator
       + 2))(
        m_pPrimaryTaskAllocator,
        this);
      goto LABEL_30;
    }
    CPedGroupIntelligence::FlushTasks(0, m_pedTaskPairs, 0);
    CPedGroupIntelligence::FlushTasks(v31, this->m_secondaryPedTaskPairs, 0);
    this->m_pEventResponseTaskAllocator = CGroupEventHandler::ComputeEventResponseTasks(
                                            this->m_pCurrentEvent,
                                            this->m_pPedGroup);
  }
LABEL_30:
  m_pHighestPriorityEvent = this->m_pHighestPriorityEvent;
  if ( !m_pHighestPriorityEvent )
    goto LABEL_48;
  if ( this->m_pCurrentEvent )
  {
    v16 = (*((int (__fastcall **)(CEvent *))m_pHighestPriorityEvent->m_pEvent->_vptr$CEvent + 2))(m_pHighestPriorityEvent->m_pEvent);
    if ( (v16 != (*((int (__fastcall **)(CEvent *))this->m_pCurrentEvent->m_pEvent->_vptr$CEvent + 2))(this->m_pCurrentEvent->m_pEvent)
       || (*((int (__fastcall **)(CEvent *))this->m_pHighestPriorityEvent->m_pEvent->_vptr$CEvent + 16))(this->m_pHighestPriorityEvent->m_pEvent) == 1)
      && CEventGroupEvent::BaseEventTakesPriorityOverBaseEvent(this->m_pHighestPriorityEvent, this->m_pCurrentEvent) )
    {
      v17 = this->m_pCurrentEvent;
      if ( v17 )
        (*((void (__fastcall **)(CEventGroupEvent *))v17->_vptr$CEvent + 1))(v17);
      goto LABEL_37;
    }
    v24 = (*((int (__fastcall **)(CEvent *))this->m_pHighestPriorityEvent->m_pEvent->_vptr$CEvent + 2))(this->m_pHighestPriorityEvent->m_pEvent);
    if ( v24 == (*((int (__fastcall **)(CEvent *))this->m_pCurrentEvent->m_pEvent->_vptr$CEvent + 2))(this->m_pCurrentEvent->m_pEvent)
      && (*((int (__fastcall **)(CEvent *))this->m_pHighestPriorityEvent->m_pEvent->_vptr$CEvent + 16))(this->m_pHighestPriorityEvent->m_pEvent) == 1 )
    {
      v19 = (CEvent *)(*((int (__fastcall **)(CEventGroupEvent *))this->m_pHighestPriorityEvent->_vptr$CEvent + 5))(this->m_pHighestPriorityEvent);
      goto LABEL_49;
    }
LABEL_48:
    v19 = 0;
    goto LABEL_49;
  }
LABEL_37:
  v18 = (CPedGroupIntelligence *)this->m_pEventResponseTaskAllocator;
  v19 = 0;
  this->m_pCurrentEvent = this->m_pHighestPriorityEvent;
  this->m_pHighestPriorityEvent = 0;
  if ( v18 )
    v18 = (CPedGroupIntelligence *)(*(int (__fastcall **)(CPedGroupIntelligence *))&v18->m_pPedGroup->m_followLeader)(v18);
  this->m_pEventResponseTaskAllocator = 0;
  CPedGroupIntelligence::FlushTasks(v18, this->m_pedTaskPairs, 0);
  CPedGroupIntelligence::FlushTasks(v20, this->m_secondaryPedTaskPairs, 0);
  this->m_pEventResponseTaskAllocator = CGroupEventHandler::ComputeEventResponseTasks(
                                          this->m_pCurrentEvent,
                                          this->m_pPedGroup);
LABEL_49:
  v25 = this->m_pPrimaryTaskAllocator;
  if ( v25
    && !(*((int (__fastcall **)(CTaskAllocator *, CPedGroupIntelligence *))v25->_vptr$CTaskAllocator + 3))(v25, this) )
  {
    v26 = this->m_pPrimaryTaskAllocator;
    if ( v26 )
      (*((void (__fastcall **)(CTaskAllocator *))v26->_vptr$CTaskAllocator + 1))(v26);
    this->m_pPrimaryTaskAllocator = 0;
  }
  v27 = this->m_pHighestPriorityEvent;
  v28 = v27 == 0;
  if ( v27 )
    v28 = this->m_pCurrentEvent == v27;
  if ( !v28 )
  {
    (*((void (__fastcall **)(CEventGroupEvent *))v27->_vptr$CEvent + 1))(v27);
    this->m_pHighestPriorityEvent = 0;
  }
  if ( !this->m_pPrimaryTaskAllocator )
  {
    v29 = this->m_pCurrentEvent;
    v30 = v29 == 0;
    if ( v29 )
    {
      v29 = this->m_pEventResponseTaskAllocator;
      v30 = v29 == 0;
    }
    if ( !v30 )
      (*(void (__fastcall **)(void *, CPedGroupIntelligence *))(*(_DWORD *)v29 + 12))(v29, this);
  }
  if ( v19 )
  {
    CPedGroupIntelligence::AddEvent(this, v19);
    (*((void (__fastcall **)(CEvent *))v19->_vptr$CEvent + 1))(v19);
  }
}
// 4B440A: variable 'v20' is possibly undefined
// 4B4510: variable 'v31' is possibly undefined

//----- (004B4522) --------------------------------------------------------
CTaskAllocator *__fastcall CPedGroupIntelligence::ComputeEventResponseTasks(CPedGroupIntelligence *this)
{
  CPedGroupIntelligence *v2; // r0

  CPedGroupIntelligence::FlushTasks(this, this->m_pedTaskPairs, 0);
  CPedGroupIntelligence::FlushTasks(v2, this->m_secondaryPedTaskPairs, 0);
  return CGroupEventHandler::ComputeEventResponseTasks(this->m_pCurrentEvent, this->m_pPedGroup);
}
// 4B4538: variable 'v2' is possibly undefined

//----- (004B4548) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeEventResponseTasks(
        const CEventGroupEvent *rEventGroupEvent,
        CPedGroup *pPedGroup)
{
  __int64 v2; // kr00_8
  const CEvent *v4; // r0
  CPed *v5; // r2
  int v7; // r0
  CTaskSimple v9; // [sp+Ch] [bp-3Ch] BYREF
  CTaskGoToVehicleAndLean v10; // [sp+14h] [bp-34h] BYREF

  v2 = *(_QWORD *)&rEventGroupEvent->m_pDistressedPed;
  v4 = (const CEvent *)((*(int (__fastcall **)(CEvent *))(*(_DWORD *)HIDWORD(v2) + 8))(rEventGroupEvent->m_pEvent) - 7);
  switch ( (unsigned int)v4 )
  {
    case 0u:
      return CGroupEventHandler::ComputeResponseDraggedOutCar((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 2u:
      return CGroupEventHandler::ComputeResponseDamage((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 8u:
      return CGroupEventHandler::ComputeResponseShotFired((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 0xDu:
      CGroupEventHandler::ComputeResponseSexyPed((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
      return 0;
    case 0x18u:
      return CGroupEventHandler::ComputeResponseGunAimedAt((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 0x1Du:
    case 0x1Eu:
      return CGroupEventHandler::ComputeResponsePedThreat((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 0x1Fu:
    case 0x20u:
      CGroupEventHandler::ComputeResponsePedFriend((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
      return 0;
    case 0x22u:
    case 0x42u:
      return CGroupEventHandler::ComputeResponseVehicleDamage((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 0x2Fu:
      CGroupEventHandler::ComputeResponseLeaderEnteredCar((const CEvent *)HIDWORD(v2), pPedGroup, v5);
      return 0;
    case 0x30u:
      CGroupEventHandler::ComputeResponseLeaderExitedCar(v4, pPedGroup, v5);
      return 0;
    case 0x32u:
      CGroupEventHandler::ComputeResponsLeaderQuitEnteringCar(v4, pPedGroup, v5);
      return 0;
    case 0x40u:
    case 0x45u:
      return CGroupEventHandler::ComputeResponsePlayerCommand((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 0x41u:
      return CGroupEventHandler::ComputeResponseSeenCop((const CEvent *)HIDWORD(v2), pPedGroup, (CPed *)v2);
    case 0x44u:
      v7 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)HIDWORD(v2) + 44))(HIDWORD(v2));
      if ( v7
        && (*(_BYTE *)(v7 + 58) & 7) == 3
        && (int *)*(unsigned __int16 *)(HIDWORD(v2) + 10) == (int *)((char *)&elf_hash_bucket[313] + 1) )
      {
        CGroupEventHandler::ComputeFleePedResponse(
          pPedGroup,
          (CPed *)v7,
          (CPed *)((char *)&elf_hash_bucket[313] + 1),
          0);
      }
      return 0;
    case 0x46u:
      CGroupEventHandler::ComputeResponseLeaderEnterExit(v4, pPedGroup, v5);
      return 0;
    case 0x53u:
      CGroupEventHandler::ComputeResponseNewGangMember((const CEvent *)HIDWORD(v2), pPedGroup, v5);
      return 0;
    case 0x55u:
      if ( pPedGroup->m_membership.m_pMembers[7] )
      {
        CTaskGoToVehicleAndLean::CTaskGoToVehicleAndLean(
          &v10,
          *(CVehicle **)(HIDWORD(v2) + 12),
          *(_DWORD *)(HIDWORD(v2) + 16));
        CTaskSimple::CTaskSimple(&v9);
        v9._vptr$CTask = (int (**)(void))&off_668FF0;
        CPedGroupIntelligence::SetTask(0, (CPed *)v2, &v10, pPedGroup->m_intelligence.m_pedTaskPairs, -1, 0);
        CTask::~CTask(&v9);
        CTaskGoToVehicleAndLean::~CTaskGoToVehicleAndLean(&v10);
      }
      return 0;
    default:
      return 0;
  }
}
// 4B46C0: variable 'v5' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 668FF0: using guessed type void *off_668FF0;

//----- (004B477C) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseLeaderEnteredCar(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CPed *v3; // r10
  bool v4; // zf
  int v5; // r11
  unsigned int m_iSequenceTaskID; // r12
  CPed *v7; // lr
  int v8; // r6
  CPed *v9; // r8
  CPed *v10; // r9
  CPed *v11; // r5
  CPed *v12; // r4
  CPed *v13; // r2
  CPed *v14; // r0
  int v15; // r8
  int v16; // r6
  int v17; // r9
  int v18; // r10
  CPed *v19; // r12
  __int64 v20; // kr08_8
  CPed *v21; // r4
  CPed *v22; // r0
  CPed *v23; // r1
  int v24; // r12
  CPed *v25; // r12
  int32 v26; // r2
  bool v27; // zf
  char v28; // r2
  bool v29; // r4
  CTaskComplexEnterCarAsPassengerWait *v30; // r5
  CTaskComplexUseSequence *v31; // r4
  __int64 v32; // kr10_8
  __int64 v33; // kr18_8
  __int64 v34; // kr20_8
  CPed *v35; // r4
  CPed *v36; // r3
  int32 m_baseVehicleType; // r3
  bool v38; // zf
  bool v39; // r3
  int v40; // r0
  int v41; // r2
  int v42; // r12
  CTaskSimpleCarDrive *v43; // r5
  int v44; // r4
  bool v45; // zf
  bool v46; // zf
  bool v47; // zf
  bool v48; // zf
  CPed *v49; // r3
  bool v50; // zf
  bool v51; // zf
  bool v52; // zf
  bool v53; // zf
  bool v54; // zf
  CTask *m_pTask; // r0
  CTask *v56; // r0
  int v57; // r0
  int v58; // r2
  int v59; // r3
  CTaskSimpleCarDrive *v60; // r6
  int v61; // r4
  CTask *v62; // r0
  CTask *v63; // r0
  CPed *v65; // [sp+Ch] [bp-DCh]
  int id; // [sp+18h] [bp-D0h]
  CTask **m_tasks; // [sp+1Ch] [bp-CCh]
  CPedTaskPair *m_defaultPedTaskPairs; // [sp+20h] [bp-C8h]
  _BOOL4 v69; // [sp+28h] [bp-C0h]
  CPed *v70; // [sp+2Ch] [bp-BCh]
  CPed *pWaitForPed; // [sp+34h] [bp-B4h]
  CVehicle *pTargetVehicle; // [sp+38h] [bp-B0h]
  CPedTaskPair *p; // [sp+44h] [bp-A4h]
  int v75; // [sp+48h] [bp-A0h]
  CTaskComplexEnterCarAsPassengerWait v76; // [sp+4Ch] [bp-9Ch] BYREF
  CTaskComplexSequence v77; // [sp+70h] [bp-78h] BYREF
  int v78[5]; // [sp+B0h] [bp-38h] BYREF
  __int64 v79; // [sp+C4h] [bp-24h]

  v3 = pPedGroup->m_membership.m_pMembers[7];
  v4 = v3 == 0;
  if ( v3 )
  {
    pOriginatorPed = (CPed *)rEvent[1].m_iAccumulatedTime;
    v4 = pOriginatorPed == 0;
  }
  if ( v4 )
    return 0;
  v5 = *((unsigned __int16 *)&rEvent->m_bIsPersistent + 1);
  m_iSequenceTaskID = pPedGroup->m_intelligence.m_iSequenceTaskID;
  v75 = *((unsigned __int8 *)&pOriginatorPed->m_nPedFlags + 8);
  v79 = 0LL;
  memset(v78, 0, sizeof(v78));
  v7 = pPedGroup->m_membership.m_pMembers[0];
  if ( v7 )
  {
    if ( v7->CharCreatedBy == 2 )
    {
      v78[0] = (int)pPedGroup->m_membership.m_pMembers[0];
      v8 = 1;
    }
    else
    {
      v8 = 0;
    }
  }
  else
  {
    v8 = 0;
  }
  v9 = pPedGroup->m_membership.m_pMembers[1];
  if ( v9 && v9->CharCreatedBy == 2 )
    *(_DWORD *)((unsigned int)v78 | (4 * v8++)) = v9;
  v10 = pPedGroup->m_membership.m_pMembers[2];
  if ( v10 && v10->CharCreatedBy == 2 )
    v78[v8++] = (int)v10;
  v11 = pPedGroup->m_membership.m_pMembers[3];
  if ( v11 && v11->CharCreatedBy == 2 )
    v78[v8++] = (int)v11;
  v12 = pPedGroup->m_membership.m_pMembers[4];
  pTargetVehicle = (CVehicle *)pOriginatorPed;
  if ( v12 && v12->CharCreatedBy == 2 )
    v78[v8++] = (int)v12;
  v13 = pPedGroup->m_membership.m_pMembers[5];
  if ( v13 && v13->CharCreatedBy == 2 )
    v78[v8++] = (int)v13;
  v14 = pPedGroup->m_membership.m_pMembers[6];
  if ( v14 && v14->CharCreatedBy == 2 )
    v78[v8++] = (int)v14;
  if ( v7 && v7->CharCreatedBy != 2 )
    v78[v8++] = (int)v7;
  if ( v9 && v9->CharCreatedBy != 2 )
    v78[v8++] = (int)v9;
  if ( v10 && v10->CharCreatedBy != 2 )
    v78[v8++] = (int)v10;
  if ( v11 && v11->CharCreatedBy != 2 )
    v78[v8++] = (int)v11;
  if ( v12 && v12->CharCreatedBy != 2 )
    v78[v8++] = (int)v12;
  if ( v13 && v13->CharCreatedBy != 2 )
    v78[v8++] = (int)v13;
  if ( v14 && v14->CharCreatedBy != 2 )
    v78[v8] = (int)v14;
  v15 = (int)v3;
  v16 = 0;
  m_tasks = CTaskSequences::ms_taskSequence[m_iSequenceTaskID].m_tasks;
  m_defaultPedTaskPairs = pPedGroup->m_intelligence.m_defaultPedTaskPairs;
  p = pPedGroup->m_intelligence.m_pedTaskPairs;
  v17 = 0;
  v69 = m_iSequenceTaskID < 0x40 && v5 == 1513;
  id = m_iSequenceTaskID;
  v70 = v3;
  do
  {
    v18 = v16;
    pWaitForPed = (CPed *)v15;
    while ( 1 )
    {
      v16 = v18 + 1;
      v15 = v78[v18];
      if ( v15 )
        break;
LABEL_53:
      ++v18;
      if ( v16 - 1 >= 6 )
        goto LABEL_151;
    }
    if ( v17 >= v75 )
    {
      CTaskComplex::CTaskComplex(&v77);
      v77.m_iProgress = 0;
      LOWORD(v77.m_tasks[0]) = 1;
      v77._vptr$CTask = (int (**)(void))&off_66AF80;
      CTaskSimple::CTaskSimple((CTaskSimple *)&v76);
      v76._vptr$CTask = (int (**)(void))&off_668FF0;
      CPedGroupIntelligence::SetTask((CPedGroupIntelligence *)0xFFFFFFFF, (CPed *)v15, &v77, p, -1, 0);
      CTask::~CTask(&v76);
      CTaskComplex::~CTaskComplex(&v77);
      goto LABEL_53;
    }
    if ( !v69 || !*m_tasks )
    {
      v32 = *(_QWORD *)pPedGroup->m_membership.m_pMembers;
      v33 = *(_QWORD *)&pPedGroup->m_membership.m_pMembers[2];
      v34 = *(_QWORD *)&pPedGroup->m_membership.m_pMembers[4];
      v35 = pPedGroup->m_membership.m_pMembers[6];
      v36 = pPedGroup->m_membership.m_pMembers[0];
      if ( (_DWORD)v32 )
        v36 = (CPed *)(&dword_0 + 1);
      if ( HIDWORD(v32) )
        v36 = (CPed *)((char *)v36 + 1);
      if ( (_DWORD)v33 )
        v36 = (CPed *)((char *)v36 + 1);
      if ( HIDWORD(v33) )
        v36 = (CPed *)((char *)v36 + 1);
      if ( (_DWORD)v34 )
        v36 = (CPed *)((char *)v36 + 1);
      if ( HIDWORD(v34) )
        v36 = (CPed *)((char *)v36 + 1);
      if ( v35 )
        v36 = (CPed *)((char *)v36 + 1);
      if ( v36 != (CPed *)((char *)&dword_0 + 1) )
        goto LABEL_95;
      m_baseVehicleType = pTargetVehicle->m_baseVehicleType;
      v38 = m_baseVehicleType == 9;
      if ( m_baseVehicleType != 9 )
        v38 = pTargetVehicle->m_vehicleType == 2;
      if ( v38 )
      {
LABEL_95:
        v39 = 0;
      }
      else
      {
        v39 = 1;
        v65 = pTargetVehicle->pPassengers[0];
        if ( v65 && v65 != (CPed *)v15 )
        {
          v45 = (_DWORD)v32 == (_DWORD)v65;
          if ( (CPed *)v32 != v65 )
            v45 = HIDWORD(v32) == (_DWORD)v65;
          if ( v45 )
            goto LABEL_140;
          v46 = (_DWORD)v33 == (_DWORD)v65;
          if ( (CPed *)v33 != v65 )
            v46 = HIDWORD(v33) == (_DWORD)v65;
          if ( v46 )
            goto LABEL_140;
          v47 = (_DWORD)v34 == (_DWORD)v65;
          if ( (CPed *)v34 != v65 )
            v47 = HIDWORD(v34) == (_DWORD)v65;
          if ( v47 )
            goto LABEL_140;
          v48 = v35 == v65;
          if ( v35 != v65 )
            v48 = pPedGroup->m_membership.m_pMembers[7] == v65;
          if ( v48 || (*((_BYTE *)&v65->m_nPedFlags + 3) & 0x20) != 0 )
LABEL_140:
            v39 = 0;
          else
            v39 = 1;
        }
      }
      CTaskComplexEnterCarAsPassengerWait::CTaskComplexEnterCarAsPassengerWait(
        &v76,
        pTargetVehicle,
        pWaitForPed,
        v39,
        6);
      CTaskSimple::CTaskSimple((CTaskSimple *)&v77);
      v77._vptr$CTask = (int (**)(void))&off_668FF0;
      CPedGroupIntelligence::SetTask(0, (CPed *)v15, &v76, p, -1, 0);
      CTask::~CTask(&v77);
      v40 = *(_DWORD *)(v15 + 1164);
      if ( (v40 & 0x2000000) != 0 )
        goto LABEL_149;
      v41 = *(_DWORD *)(v15 + 1160);
      v42 = *(_DWORD *)(v15 + 1168);
      *(_DWORD *)(v15 + 1156) = *(_DWORD *)(v15 + 1156);
      *(_DWORD *)(v15 + 1160) = v41;
      *(_DWORD *)(v15 + 1164) = v40 | 0x2000000;
      *(_DWORD *)(v15 + 1168) = v42;
      CTaskComplexSequence::CTaskComplexSequence(&v77);
      v43 = (CTaskSimpleCarDrive *)CTask::operator new(0x60u);
      v44 = 0;
      CTaskSimpleCarDrive::CTaskSimpleCarDrive(v43, pTargetVehicle, 0, 1);
      CTaskComplexSequence::AddTask(&v77, v43);
      if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[0].m_pPed != (CPed *)v15 )
      {
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[1].m_pPed == (CPed *)v15 )
        {
          v44 = 1;
        }
        else if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[2].m_pPed == (CPed *)v15 )
        {
          v44 = 2;
        }
        else if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[3].m_pPed == (CPed *)v15 )
        {
          v44 = 3;
        }
        else if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[4].m_pPed == (CPed *)v15 )
        {
          v44 = 4;
        }
        else if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[5].m_pPed == (CPed *)v15 )
        {
          v44 = 5;
        }
        else if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[6].m_pPed == (CPed *)v15 )
        {
          v44 = 6;
        }
        else
        {
          if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pPed != (CPed *)v15 )
          {
LABEL_148:
            CPedGroupIntelligence::SetTask(0, (CPed *)v15, &v77, m_defaultPedTaskPairs, -1, 0);
            CTaskComplexSequence::~CTaskComplexSequence(&v77);
LABEL_149:
            CTaskComplexEnterCarAsPassengerWait::~CTaskComplexEnterCarAsPassengerWait(&v76);
            goto LABEL_150;
          }
          v44 = 7;
        }
      }
      m_pTask = pPedGroup->m_intelligence.m_defaultPedTaskPairs[v44].m_pTask;
      if ( m_pTask )
      {
        v56 = (CTask *)(*((int (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 2))(m_pTask);
        CTaskComplexSequence::AddTask(&v77, v56);
      }
      goto LABEL_148;
    }
    v19 = pPedGroup->m_membership.m_pMembers[0];
    v20 = *(_QWORD *)&pPedGroup->m_membership.m_pMembers[4];
    v21 = pPedGroup->m_membership.m_pMembers[6];
    v22 = pPedGroup->m_membership.m_pMembers[2];
    v23 = pPedGroup->m_membership.m_pMembers[1];
    v24 = v19 != 0;
    if ( v23 )
      ++v24;
    if ( v22 )
      ++v24;
    if ( pPedGroup->m_membership.m_pMembers[3] )
      ++v24;
    if ( (_DWORD)v20 )
      ++v24;
    if ( HIDWORD(v20) )
      ++v24;
    if ( v21 )
      ++v24;
    if ( v24 != 1 )
      goto LABEL_74;
    v25 = pPedGroup->m_membership.m_pMembers[0];
    v26 = pTargetVehicle->m_baseVehicleType;
    v27 = v26 == 9;
    if ( v26 != 9 )
      v27 = pTargetVehicle->m_vehicleType == 2;
    if ( v27 )
      goto LABEL_74;
    v49 = pTargetVehicle->pPassengers[0];
    v28 = 1;
    v50 = v49 == 0;
    if ( v49 )
      v50 = v49 == (CPed *)v15;
    if ( !v50 )
    {
      v51 = v25 == v49;
      if ( v25 != v49 )
        v51 = v23 == v49;
      if ( !v51 )
      {
        v52 = v22 == v49;
        if ( v22 != v49 )
          v52 = pPedGroup->m_membership.m_pMembers[3] == v49;
        if ( !v52 )
        {
          v53 = (_DWORD)v20 == (_DWORD)v49;
          if ( (CPed *)v20 != v49 )
            v53 = HIDWORD(v20) == (_DWORD)v49;
          if ( !v53 )
          {
            v54 = v21 == v49;
            if ( v21 != v49 )
              v54 = pPedGroup->m_membership.m_pMembers[7] == v49;
            if ( !v54 && (*((_BYTE *)&v49->m_nPedFlags + 3) & 0x20) == 0 )
            {
              v28 = 1;
              goto LABEL_75;
            }
          }
        }
      }
LABEL_74:
      v28 = 0;
    }
LABEL_75:
    v29 = v28;
    CTaskComplexSequence::CTaskComplexSequence(&v77);
    v30 = (CTaskComplexEnterCarAsPassengerWait *)CTask::operator new(0x24u);
    CTaskComplexEnterCarAsPassengerWait::CTaskComplexEnterCarAsPassengerWait(v30, pTargetVehicle, pWaitForPed, v29, 6);
    CTaskComplexSequence::AddTask(&v77, v30);
    v31 = (CTaskComplexUseSequence *)CTask::operator new(0x1Cu);
    CTaskComplexUseSequence::CTaskComplexUseSequence(v31, id);
    CTaskComplexSequence::AddTask(&v77, v31);
    CTaskSimple::CTaskSimple((CTaskSimple *)&v76);
    v76._vptr$CTask = (int (**)(void))&off_668FF0;
    CPedGroupIntelligence::SetTask(0, (CPed *)v15, &v77, p, -1, 0);
    CTask::~CTask(&v76);
    CTaskComplexSequence::~CTaskComplexSequence(&v77);
LABEL_150:
    ++v17;
  }
  while ( v18 < 6 );
LABEL_151:
  if ( !CPed::IsPlayer(v70) )
  {
    v57 = *((_DWORD *)&v70->m_nPedFlags + 2);
    if ( (v57 & 0x2000000) == 0 )
    {
      v58 = *((_DWORD *)&v70->m_nPedFlags + 1);
      v59 = *((_DWORD *)&v70->m_nPedFlags + 3);
      *(_DWORD *)&v70->m_nPedFlags = v70->m_nPedFlags;
      *((_DWORD *)&v70->m_nPedFlags + 1) = v58;
      *((_DWORD *)&v70->m_nPedFlags + 2) = v57 | 0x2000000;
      *((_DWORD *)&v70->m_nPedFlags + 3) = v59;
      CTaskComplexSequence::CTaskComplexSequence(&v77);
      v60 = (CTaskSimpleCarDrive *)CTask::operator new(0x60u);
      v61 = 0;
      CTaskSimpleCarDrive::CTaskSimpleCarDrive(v60, pTargetVehicle, 0, 1);
      CTaskComplexSequence::AddTask(&v77, v60);
      if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[0].m_pPed == v70 )
      {
LABEL_168:
        v62 = pPedGroup->m_intelligence.m_defaultPedTaskPairs[v61].m_pTask;
        if ( v62 )
        {
          v63 = (CTask *)(*((int (__fastcall **)(CTask *))v62->_vptr$CTask + 2))(v62);
          CTaskComplexSequence::AddTask(&v77, v63);
        }
      }
      else
      {
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[1].m_pPed == v70 )
        {
          v61 = 1;
          goto LABEL_168;
        }
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[2].m_pPed == v70 )
        {
          v61 = 2;
          goto LABEL_168;
        }
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[3].m_pPed == v70 )
        {
          v61 = 3;
          goto LABEL_168;
        }
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[4].m_pPed == v70 )
        {
          v61 = 4;
          goto LABEL_168;
        }
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[5].m_pPed == v70 )
        {
          v61 = 5;
          goto LABEL_168;
        }
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[6].m_pPed == v70 )
        {
          v61 = 6;
          goto LABEL_168;
        }
        if ( pPedGroup->m_intelligence.m_defaultPedTaskPairs[7].m_pPed == v70 )
        {
          v61 = 7;
          goto LABEL_168;
        }
      }
      CPedGroupIntelligence::SetTask(0, v70, &v77, m_defaultPedTaskPairs, -1, 0);
      CTaskComplexSequence::~CTaskComplexSequence(&v77);
    }
  }
  return 0;
}
// 0: using guessed type int dword_0;
// 668FF0: using guessed type void *off_668FF0;
// 66AF80: using guessed type void *off_66AF80;
// 677A98: using guessed type void *`vtable for'CTaskComplexLeaveAnyCar;

//----- (004B4E08) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseLeaderExitedCar(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CPed **m_pMembers; // r10
  int v4; // r11
  int v5; // r8
  CPed *v6; // r5
  CVehicle *m_pMyVehicle; // r4
  bool v8; // zf
  CTask *TaskByType; // r0
  bool v10; // zf
  CTask *v11; // r0
  bool v12; // zf
  FxSystem_c *m_fxSysEngFire; // r0
  unsigned __int16 v14; // r0
  CTaskComplexLeaveCarAsPassengerWait *v15; // r9
  CTaskComplexSmartFleeEntity *v16; // r6
  unsigned __int16 v17; // r6
  float v18; // s22
  CTaskComplexLeaveCar *v19; // r6
  CTaskComplexSmartFleeEntity *v20; // r6
  CPedTaskPair *p; // [sp+2Ch] [bp-8Ch]
  CTaskSimple v24; // [sp+30h] [bp-88h] BYREF
  CTaskComplexSequence v25[2]; // [sp+38h] [bp-80h] BYREF

  m_pMembers = pPedGroup->m_membership.m_pMembers;
  v4 = 250;
  v5 = 0;
  p = pPedGroup->m_intelligence.m_pedTaskPairs;
  do
  {
    v6 = m_pMembers[v5];
    if ( v6 )
    {
      m_pMyVehicle = v6->m_pMyVehicle;
      v8 = m_pMyVehicle == 0;
      if ( m_pMyVehicle )
        v8 = *((unsigned __int8 *)&v6->m_nPedFlags + 1) << 31 == 0;
      if ( !v8 && m_pMyVehicle == pPedGroup->m_membership.m_pMembers[7]->m_pMyVehicle )
        goto LABEL_14;
      TaskByType = CPedIntelligence::FindTaskByType(v6->m_pPedIntelligence, 718);
      v10 = TaskByType == 0;
      if ( TaskByType )
      {
        m_pMyVehicle = (CVehicle *)TaskByType[1].m_pParent;
        v10 = m_pMyVehicle == 0;
      }
      if ( !v10 )
        goto LABEL_14;
      v11 = CPedIntelligence::FindTaskByType(v6->m_pPedIntelligence, 700);
      v12 = v11 == 0;
      if ( v11 )
      {
        m_pMyVehicle = (CVehicle *)v11[1].m_pParent;
        v12 = m_pMyVehicle == 0;
      }
      if ( !v12 )
      {
LABEL_14:
        m_fxSysEngFire = m_pMyVehicle->m_fxSysEngFire;
        if ( (unsigned int)m_pMyVehicle->pHandling->AnimGroup - 15 > 1 )
        {
          if ( !m_fxSysEngFire || FxSystem_c::GetPlayStatus(m_fxSysEngFire) )
          {
            v14 = rand();
            CTaskComplexLeaveCar::CTaskComplexLeaveCar(
              (CTaskComplexLeaveCar *)v25,
              m_pMyVehicle,
              0,
              v4 + (int)(float)((float)((float)v14 * 0.000015259) * 500.0),
              0,
              0);
            CTaskSimple::CTaskSimple(&v24);
            v24._vptr$CTask = (int (**)(void))&off_668FF0;
            CPedGroupIntelligence::SetTask((CPedGroupIntelligence *)0xFFFFFFFF, v6, v25, p, -1, 0);
            CTask::~CTask(&v24);
            CTaskComplexLeaveCar::~CTaskComplexLeaveCar((CTaskComplexLeaveCar *)v25);
            goto LABEL_24;
          }
          v17 = rand();
          CTaskComplexSequence::CTaskComplexSequence(v25);
          v18 = (float)((float)v17 * 0.000015259) * 500.0;
          v19 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
          CTaskComplexLeaveCar::CTaskComplexLeaveCar(v19, m_pMyVehicle, 0, v4 + (int)v18, 0, 0);
          CTaskComplexSequence::AddTask(v25, v19);
          v20 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v20,
            m_pMyVehicle,
            0,
            15.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          CTaskComplexSequence::AddTask(v25, v20);
          CTaskSimple::CTaskSimple(&v24);
        }
        else
        {
          if ( !m_fxSysEngFire || FxSystem_c::GetPlayStatus(m_fxSysEngFire) )
          {
            CTaskComplexLeaveCarAsPassengerWait::CTaskComplexLeaveCarAsPassengerWait(
              (CTaskComplexLeaveCarAsPassengerWait *)v25,
              m_pMyVehicle);
            CTaskSimple::CTaskSimple(&v24);
            v24._vptr$CTask = (int (**)(void))&off_668FF0;
            CPedGroupIntelligence::SetTask(0, v6, v25, p, -1, 0);
            CTask::~CTask(&v24);
            CTaskComplexLeaveCarAsPassengerWait::~CTaskComplexLeaveCarAsPassengerWait((CTaskComplexLeaveCarAsPassengerWait *)v25);
            goto LABEL_24;
          }
          CTaskComplexSequence::CTaskComplexSequence(v25);
          v15 = (CTaskComplexLeaveCarAsPassengerWait *)CTask::operator new(0x10u);
          CTaskComplexLeaveCarAsPassengerWait::CTaskComplexLeaveCarAsPassengerWait(v15, m_pMyVehicle);
          CTaskComplexSequence::AddTask(v25, v15);
          v16 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v16,
            m_pMyVehicle,
            0,
            15.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          CTaskComplexSequence::AddTask(v25, v16);
          CTaskSimple::CTaskSimple(&v24);
        }
        v24._vptr$CTask = (int (**)(void))&off_668FF0;
        CPedGroupIntelligence::SetTask(0, v6, v25, p, -1, 0);
        CTask::~CTask(&v24);
        CTaskComplexSequence::~CTaskComplexSequence(v25);
      }
    }
LABEL_24:
    ++v5;
    v4 += 500;
  }
  while ( v5 != 7 );
  return 0;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 668FF0: using guessed type void *;

//----- (004B50D4) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponsLeaderQuitEnteringCar(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CVehicle *m_pParent; // r5
  CPed **m_pMembers; // r11
  int v5; // r4
  int i; // r9
  CPed *v7; // r6
  bool v8; // zf
  CTask *TaskByType; // r0
  bool v10; // zf
  CTask *v11; // r0
  bool v12; // zf
  unsigned __int16 v13; // r0
  CPedTaskPair *p; // [sp+10h] [bp-70h]
  CTaskSimple v16; // [sp+14h] [bp-6Ch] BYREF
  CTaskComplexLeaveCar v17; // [sp+1Ch] [bp-64h] BYREF

  p = pPedGroup->m_intelligence.m_pedTaskPairs;
  m_pMembers = pPedGroup->m_membership.m_pMembers;
  v5 = 0;
  for ( i = 0; i != 7; ++i )
  {
    v7 = m_pMembers[i];
    if ( !v7 )
      goto LABEL_16;
    v8 = *((unsigned __int8 *)&v7->m_nPedFlags + 1) << 31 == 0;
    if ( *((unsigned __int8 *)&v7->m_nPedFlags + 1) << 31 )
    {
      pPedGroup = (CPedGroup *)v7->m_pMyVehicle;
      v8 = pPedGroup == 0;
    }
    if ( !v8 )
    {
      CTaskComplexLeaveCar::CTaskComplexLeaveCar(&v17, (CVehicle *)pPedGroup, 0, v5, 1, 0);
      m_pParent = (CVehicle *)&v16;
      CTaskSimple::CTaskSimple(&v16);
LABEL_15:
      v16._vptr$CTask = (int (**)(void))&off_668FF0;
      CPedGroupIntelligence::SetTask((CPedGroupIntelligence *)0xFFFFFFFF, v7, &v17, p, -1, 0);
      CTask::~CTask(&v16);
      CTaskComplexLeaveCar::~CTaskComplexLeaveCar(&v17);
      goto LABEL_16;
    }
    TaskByType = CPedIntelligence::FindTaskByType(v7->m_pPedIntelligence, 718);
    v10 = TaskByType == 0;
    if ( TaskByType )
    {
      m_pParent = (CVehicle *)TaskByType[1].m_pParent;
      v10 = m_pParent == 0;
    }
    if ( !v10 )
      goto LABEL_14;
    v11 = CPedIntelligence::FindTaskByType(v7->m_pPedIntelligence, 700);
    v12 = v11 == 0;
    if ( v11 )
    {
      m_pParent = (CVehicle *)v11[1].m_pParent;
      v12 = m_pParent == 0;
    }
    if ( !v12 )
    {
LABEL_14:
      v13 = rand();
      CTaskComplexLeaveCar::CTaskComplexLeaveCar(
        &v17,
        m_pParent,
        0,
        (int)(float)((float)((float)v13 * 0.000015259) * 500.0) + v5 + 250,
        0,
        0);
      m_pParent = (CVehicle *)&v16;
      CTaskSimple::CTaskSimple(&v16);
      goto LABEL_15;
    }
LABEL_16:
    v5 += 500;
  }
  return 0;
}
// 4B51A6: variable 'pPedGroup' is possibly undefined
// 4B518A: variable 'm_pParent' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;

//----- (004B5204) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseLeaderEnterExit(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CPed *v3; // r8
  CPed **m_pMembers; // r4
  int i; // r9
  CPed *v6; // r5
  CTaskSimpleWaitUntilLeaderAreaCodesMatch *v7; // r0
  CPedTaskPair *p; // [sp+10h] [bp-60h]
  CTaskSimple v10; // [sp+14h] [bp-5Ch] BYREF
  CTaskSimpleWaitUntilAreaCodesMatch v11; // [sp+1Ch] [bp-54h] BYREF
  char v12; // [sp+40h] [bp-30h]
  char v13; // [sp+50h] [bp-20h]

  v3 = pPedGroup->m_membership.m_pMembers[7];
  if ( v3 )
  {
    p = pPedGroup->m_intelligence.m_pedTaskPairs;
    m_pMembers = pPedGroup->m_membership.m_pMembers;
    for ( i = 0; i != 7; ++i )
    {
      v6 = m_pMembers[i];
      if ( v6 && !(*((unsigned __int8 *)&v6->m_nPedFlags + 1) << 31) )
      {
        CTaskSimpleWaitUntilAreaCodesMatch::CTaskSimpleWaitUntilAreaCodesMatch(&v11, v3);
        v12 = 0;
        v13 = 0;
        v11._vptr$CTask = (int (**)(void))&off_66A848;
        if ( CTaskSimpleWaitUntilLeaderAreaCodesMatch::ProcessPed(v7, v6) )
        {
          *(_DWORD *)&v6->m_nFlags |= 1u;
        }
        else
        {
          CTaskSimple::CTaskSimple(&v10);
          v10._vptr$CTask = (int (**)(void))&off_668FF0;
          CPedGroupIntelligence::SetTask(0, v6, &v11, p, -1, 0);
          CTask::~CTask(&v10);
        }
        CTaskSimpleWaitUntilAreaCodesMatch::~CTaskSimpleWaitUntilAreaCodesMatch(&v11);
      }
    }
  }
  return 0;
}
// 4B5264: variable 'v7' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;
// 66A848: using guessed type void *;

//----- (004B52C8) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponsePedThreat(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CPed *m_iAccumulatedTime; // r5
  CTaskAllocatorKillThreatsDriveby *v5; // r4
  int m_iGroupCreatedBy; // r6
  CTaskAllocatorKillThreatsBasic *v7; // r0

  m_iAccumulatedTime = (CPed *)rEvent[1].m_iAccumulatedTime;
  if ( !m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[0] == m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[1] == m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[2] == m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[3] == m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[4] == m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[5] == m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[6] == m_iAccumulatedTime
    || pPedGroup->m_membership.m_pMembers[7] == m_iAccumulatedTime )
  {
    return 0;
  }
  v5 = 0;
  switch ( *((_WORD *)&rEvent->m_bIsPersistent + 1) )
  {
    case 0x5DE:
      if ( !CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, m_iAccumulatedTime) )
        goto LABEL_16;
      m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
      v7 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
      v5 = (CTaskAllocatorKillThreatsDriveby *)v7;
      if ( m_iGroupCreatedBy )
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v7, m_iAccumulatedTime);
      }
      else
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v7, m_iAccumulatedTime);
        v5->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
      }
      break;
    case 0x5E0:
      v5 = 0;
      CGroupEventHandler::ComputeStareResponse(pPedGroup, m_iAccumulatedTime, pOriginatorPed, 99999999, 0);
      break;
    case 0x5E1:
LABEL_16:
      v5 = 0;
      CGroupEventHandler::ComputeFleePedResponse(pPedGroup, m_iAccumulatedTime, pOriginatorPed, 0);
      break;
    case 0x5E5:
      CGroupEventHandler::ComputeHassleThreatResponse(pPedGroup, m_iAccumulatedTime, pOriginatorPed, 1);
      v5 = 0;
      break;
    case 0x5E6:
      CGroupEventHandler::ComputeMemberResponses(rEvent, pPedGroup, pOriginatorPed);
      v5 = 0;
      break;
    case 0x5EC:
      v5 = (CTaskAllocatorKillThreatsDriveby *)CTaskAllocator::operator new(0x14u);
      CTaskAllocatorKillThreatsDriveby::CTaskAllocatorKillThreatsDriveby(v5, m_iAccumulatedTime);
      break;
    case 0x5ED:
      v5 = 0;
      CGroupEventHandler::ComputeHassleThreatResponse(pPedGroup, m_iAccumulatedTime, pOriginatorPed, 0);
      break;
    default:
      return v5;
  }
  return v5;
}
// 4B5362: variable 'pOriginatorPed' is possibly undefined
// 66D654: using guessed type void *;

//----- (004B53C8) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponsePedFriend(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CPed *m_iAccumulatedTime; // r4
  int v5; // r8
  Int32 m_PlayerGroup; // r0
  CPed *v7; // r0
  bool v8; // zf
  CPed *v9; // r0
  bool v10; // zf
  CPed *v11; // r0
  bool v12; // zf
  CPed *v13; // r0
  bool v14; // zf
  CPed *v15; // r0
  bool v16; // zf

  m_iAccumulatedTime = (CPed *)rEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v5 = *((__int16 *)&rEvent->m_bIsPersistent + 1);
    if ( &CPedGroups::ms_groups[FindPlayerPed(-1)->m_pPlayerData->m_PlayerGroup] != pPedGroup )
    {
      m_PlayerGroup = FindPlayerPed(-1)->m_pPlayerData->m_PlayerGroup;
      if ( CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[0] != m_iAccumulatedTime
        && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[1] != m_iAccumulatedTime
        && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[2] != m_iAccumulatedTime
        && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[3] != m_iAccumulatedTime
        && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[4] != m_iAccumulatedTime
        && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[5] != m_iAccumulatedTime
        && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[6] != m_iAccumulatedTime )
      {
        v7 = *(CPed **)((char *)&CPedGroups::ms_groups[0].m_membership.m_pMembers[7]
                      + m_PlayerGroup * (_DWORD)&elf_hash_bucket[118]);
        v8 = v7 == m_iAccumulatedTime;
        if ( v7 != m_iAccumulatedTime )
          v8 = m_iAccumulatedTime == pPedGroup->m_lastPedRespondedTo;
        if ( !v8 )
        {
          v9 = pPedGroup->m_membership.m_pMembers[0];
          v10 = v9 == m_iAccumulatedTime;
          if ( v9 != m_iAccumulatedTime )
            v10 = pPedGroup->m_membership.m_pMembers[1] == m_iAccumulatedTime;
          if ( !v10 )
          {
            v11 = pPedGroup->m_membership.m_pMembers[2];
            v12 = v11 == m_iAccumulatedTime;
            if ( v11 != m_iAccumulatedTime )
              v12 = pPedGroup->m_membership.m_pMembers[3] == m_iAccumulatedTime;
            if ( !v12 )
            {
              v13 = pPedGroup->m_membership.m_pMembers[4];
              v14 = v13 == m_iAccumulatedTime;
              if ( v13 != m_iAccumulatedTime )
                v14 = pPedGroup->m_membership.m_pMembers[5] == m_iAccumulatedTime;
              if ( !v14 )
              {
                v15 = pPedGroup->m_membership.m_pMembers[6];
                v16 = v15 == m_iAccumulatedTime;
                if ( v15 != m_iAccumulatedTime )
                  v16 = pPedGroup->m_membership.m_pMembers[7] == m_iAccumulatedTime;
                if ( !v16 )
                {
                  if ( v5 == 1507 )
                  {
                    CGroupEventHandler::ComputeGreetResponse(
                      pPedGroup,
                      m_iAccumulatedTime,
                      (CPed *)&elf_hash_bucket[118]);
                  }
                  else if ( v5 == 1506 )
                  {
                    CGroupEventHandler::ComputeDoDealResponse(
                      pPedGroup,
                      m_iAccumulatedTime,
                      (CPed *)&elf_hash_bucket[118]);
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  return 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004B5520) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseSeenCop(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int v4; // r1
  CPed *m_iAccumulatedTime; // r4
  int m_iGroupCreatedBy; // r6
  CTaskAllocatorKillThreatsBasic *v7; // r0
  CTaskAllocator *v8; // r5

  v4 = *((__int16 *)&rEvent->m_bIsPersistent + 1);
  m_iAccumulatedTime = (CPed *)rEvent[1].m_iAccumulatedTime;
  if ( v4 == 1515 )
  {
    CGroupEventHandler::ComputeHandSignalResponse(pPedGroup, m_iAccumulatedTime, pOriginatorPed);
    return 0;
  }
  if ( v4 == 1505 )
  {
LABEL_7:
    v8 = 0;
    CGroupEventHandler::ComputeFleePedResponse(pPedGroup, m_iAccumulatedTime, pOriginatorPed, 0);
    return v8;
  }
  if ( v4 != 1502 )
    return 0;
  if ( !CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, m_iAccumulatedTime) )
    goto LABEL_7;
  m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
  v7 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
  v8 = v7;
  if ( m_iGroupCreatedBy )
  {
    CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v7, m_iAccumulatedTime);
  }
  else
  {
    CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v7, m_iAccumulatedTime);
    v8->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
  }
  return v8;
}
// 4B5572: variable 'pOriginatorPed' is possibly undefined
// 66D654: using guessed type void *off_66D654;

//----- (004B55A0) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseDamage(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int m_iAccumulatedTime; // r4
  int v6; // r6
  CPed *v7; // r9
  int v8; // r0
  CTaskAllocator *v9; // r6
  int m_iGroupCreatedBy; // r5
  CTaskAllocatorKillThreatsBasic *v11; // r0

  m_iAccumulatedTime = rEvent[1].m_iAccumulatedTime;
  if ( !m_iAccumulatedTime || (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) != 3 )
    return 0;
  v6 = *((__int16 *)&rEvent->m_bIsPersistent + 1);
  if ( !pPedGroup->m_iGroupCreatedBy && CPed::IsPlayer((const CPed *)m_iAccumulatedTime) )
  {
    v7 = pPedGroup->m_membership.m_pMembers[7];
    if ( v7 )
    {
      if ( !CWeapon::IsTypeMelee(&v7->m_WeaponSlots[v7->m_nCurrentWeapon])
        && !CPedIntelligence::IsFriendlyWith(v7->m_pPedIntelligence, (const CPed *)m_iAccumulatedTime) )
      {
        *((_WORD *)&rEvent->m_bIsPersistent + 1) = 1502;
      }
    }
  }
  v8 = v6 - 1502;
  v9 = 0;
  switch ( v8 )
  {
    case 0:
      if ( !CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, (CPed *)m_iAccumulatedTime) )
        goto LABEL_13;
      m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
      v11 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
      v9 = v11;
      if ( m_iGroupCreatedBy )
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v11, (CPed *)m_iAccumulatedTime);
      }
      else
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v11, (CPed *)m_iAccumulatedTime);
        v9->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
      }
      break;
    case 1:
      v9 = 0;
      CGroupEventHandler::ComputeKillPlayerBasicResponse(pPedGroup, (CPed *)m_iAccumulatedTime, pOriginatorPed, 0);
      return v9;
    case 3:
LABEL_13:
      v9 = 0;
      CGroupEventHandler::ComputeFleePedResponse(pPedGroup, (CPed *)m_iAccumulatedTime, pOriginatorPed, 0);
      break;
    case 8:
      CGroupEventHandler::ComputeMemberResponses(rEvent, pPedGroup, pOriginatorPed);
      return 0;
    default:
      return v9;
  }
  return v9;
}
// 4B5648: variable 'pOriginatorPed' is possibly undefined
// 66D654: using guessed type void *off_66D654;

//----- (004B5684) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseSexyPed(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CPed *m_iAccumulatedTime; // r4
  CPed *v5; // r1
  bool v6; // zf
  CPed *v7; // r1
  bool v8; // zf
  CPed *v9; // r1
  bool v10; // zf
  CPed *v11; // r1
  bool v12; // zf
  int v13; // r8
  Int32 m_PlayerGroup; // r0
  unsigned __int16 v15; // r0
  CPed *v16; // r2

  m_iAccumulatedTime = (CPed *)rEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v5 = pPedGroup->m_membership.m_pMembers[0];
    v6 = v5 == m_iAccumulatedTime;
    if ( v5 != m_iAccumulatedTime )
      v6 = pPedGroup->m_membership.m_pMembers[1] == m_iAccumulatedTime;
    if ( !v6 )
    {
      v7 = pPedGroup->m_membership.m_pMembers[2];
      v8 = v7 == m_iAccumulatedTime;
      if ( v7 != m_iAccumulatedTime )
        v8 = pPedGroup->m_membership.m_pMembers[3] == m_iAccumulatedTime;
      if ( !v8 )
      {
        v9 = pPedGroup->m_membership.m_pMembers[4];
        v10 = v9 == m_iAccumulatedTime;
        if ( v9 != m_iAccumulatedTime )
          v10 = pPedGroup->m_membership.m_pMembers[5] == m_iAccumulatedTime;
        if ( !v10 )
        {
          v11 = pPedGroup->m_membership.m_pMembers[6];
          v12 = v11 == m_iAccumulatedTime;
          if ( v11 != m_iAccumulatedTime )
            v12 = pPedGroup->m_membership.m_pMembers[7] == m_iAccumulatedTime;
          if ( !v12 )
          {
            v13 = *((__int16 *)&rEvent->m_bIsPersistent + 1);
            if ( &CPedGroups::ms_groups[FindPlayerPed(-1)->m_pPlayerData->m_PlayerGroup] != pPedGroup )
            {
              m_PlayerGroup = FindPlayerPed(-1)->m_pPlayerData->m_PlayerGroup;
              if ( CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[0] != m_iAccumulatedTime
                && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[1] != m_iAccumulatedTime
                && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[2] != m_iAccumulatedTime
                && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[3] != m_iAccumulatedTime
                && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[4] != m_iAccumulatedTime
                && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[5] != m_iAccumulatedTime
                && CPedGroups::ms_groups[m_PlayerGroup].m_membership.m_pMembers[6] != m_iAccumulatedTime
                && *(CPed **)((char *)&CPedGroups::ms_groups[0].m_membership.m_pMembers[7]
                            + m_PlayerGroup * (_DWORD)&elf_hash_bucket[118]) != m_iAccumulatedTime )
              {
                if ( v13 == 1508 )
                {
                  CGroupEventHandler::ComputeHassleSexyPedResponse(
                    pPedGroup,
                    m_iAccumulatedTime,
                    (CPed *)&elf_hash_bucket[118]);
                }
                else if ( v13 == 1504 )
                {
                  v15 = rand();
                  CGroupEventHandler::ComputeStareResponse(
                    pPedGroup,
                    m_iAccumulatedTime,
                    v16,
                    (int)(float)((float)((float)v15 * 0.000015259) * 2000.0) + 3000,
                    1000);
                }
              }
            }
          }
        }
      }
    }
  }
  return 0;
}
// 4B57D4: variable 'v16' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004B5818) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseGunAimedAt(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int v5; // r0
  CPed *v6; // r2
  CPed *v7; // r4
  CPed *v8; // r8
  int v9; // r0
  int m_iGroupCreatedBy; // r5
  CTaskAllocatorKillThreatsBasic *v11; // r0
  CTaskAllocator *v12; // r6

  v5 = (*((int (__fastcall **)(const CEvent *))rEvent->_vptr$CEvent + 11))(rEvent);
  v7 = (CPed *)v5;
  if ( !v5 || (*(_BYTE *)(v5 + 58) & 7) != 3 )
    return 0;
  if ( !pPedGroup->m_iGroupCreatedBy && CPed::IsPlayer((const CPed *)v5) )
  {
    v8 = pPedGroup->m_membership.m_pMembers[7];
    if ( v8 )
    {
      if ( !CWeapon::IsTypeMelee(&v8->m_WeaponSlots[v8->m_nCurrentWeapon])
        && !CPedIntelligence::IsFriendlyWith(v8->m_pPedIntelligence, v7) )
      {
        *((_WORD *)&rEvent->m_bIsPersistent + 1) = 1502;
      }
    }
  }
  v9 = *((__int16 *)&rEvent->m_bIsPersistent + 1);
  if ( v9 == 1510 )
  {
    CGroupEventHandler::ComputeMemberResponses(rEvent, pPedGroup, v6);
    return 0;
  }
  if ( v9 == 1505 )
  {
LABEL_15:
    v12 = 0;
    CGroupEventHandler::ComputeFleePedResponse(pPedGroup, v7, v6, 0);
    return v12;
  }
  if ( v9 != 1502 )
    return 0;
  if ( !CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, v7) )
    goto LABEL_15;
  m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
  v11 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
  v12 = v11;
  if ( m_iGroupCreatedBy )
  {
    CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v11, v7);
  }
  else
  {
    CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v11, v7);
    v12->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
  }
  return v12;
}
// 4B58C8: variable 'v6' is possibly undefined
// 66D654: using guessed type void *off_66D654;

//----- (004B58F4) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseShotFired(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int m_iAccumulatedTime; // r5
  int *v5; // r1
  CPed *v6; // r2
  int m_iGroupCreatedBy; // r6
  CTaskAllocatorKillThreatsBasic *v8; // r0
  CTaskAllocator *v9; // r4

  m_iAccumulatedTime = rEvent[1].m_iAccumulatedTime;
  if ( !m_iAccumulatedTime || (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) != 3 )
    return 0;
  v5 = (int *)*((__int16 *)&rEvent->m_bIsPersistent + 1);
  v6 = (CPed *)((char *)&elf_hash_bucket[314] + 2);
  if ( v5 == (int *)((char *)&elf_hash_bucket[314] + 2) )
  {
    CGroupEventHandler::ComputeMemberResponses(rEvent, pPedGroup, (CPed *)((char *)&elf_hash_bucket[314] + 2));
    return 0;
  }
  if ( v5 == (int *)((char *)&elf_hash_bucket[313] + 1) )
  {
LABEL_9:
    v9 = 0;
    CGroupEventHandler::ComputeFleePedResponse(pPedGroup, (CPed *)m_iAccumulatedTime, v6, 0);
    return v9;
  }
  if ( v5 != (int *)((char *)&elf_hash_bucket[312] + 2) )
    return 0;
  if ( !CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, (CPed *)m_iAccumulatedTime) )
    goto LABEL_9;
  m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
  v8 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
  v9 = v8;
  if ( m_iGroupCreatedBy )
  {
    CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v8, (CPed *)m_iAccumulatedTime);
  }
  else
  {
    CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v8, (CPed *)m_iAccumulatedTime);
    v9->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
  }
  return v9;
}
// 4B5954: variable 'v6' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 66D654: using guessed type void *off_66D654;

//----- (004B5980) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseDraggedOutCar(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int m_iAccumulatedTime; // r4
  CTaskAllocator *v6; // r5
  _BOOL4 IsPlayer; // r0
  _BOOL4 v8; // r0
  bool v9; // zf
  int m_iGroupCreatedBy; // r6
  CTaskAllocatorKillThreatsBasic *v11; // r0

  m_iAccumulatedTime = rEvent[1].m_iAccumulatedTime;
  if ( !m_iAccumulatedTime || (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) != 3 )
    return 0;
  v6 = 0;
  switch ( *((_WORD *)&rEvent->m_bIsPersistent + 1) )
  {
    case 0x5DE:
      IsPlayer = CPed::IsPlayer((const CPed *)rEvent[1].m_iAccumulatedTime);
      if ( pOriginatorPed && IsPlayer )
      {
        v8 = CPedIntelligence::Respects(pOriginatorPed->m_pPedIntelligence, (const CPed *)m_iAccumulatedTime);
        v9 = v8;
        if ( v8 )
          v9 = pPedGroup->m_iGroupCreatedBy == 0;
        if ( v9 )
          goto LABEL_12;
      }
      if ( !CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, (CPed *)m_iAccumulatedTime) )
        goto LABEL_12;
      m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
      v11 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
      v6 = v11;
      if ( m_iGroupCreatedBy )
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v11, (CPed *)m_iAccumulatedTime);
      }
      else
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v11, (CPed *)m_iAccumulatedTime);
        v6->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
      }
      break;
    case 0x5E1:
LABEL_12:
      v6 = 0;
      CGroupEventHandler::ComputeFleePedResponse(pPedGroup, (CPed *)m_iAccumulatedTime, pOriginatorPed, 0);
      break;
    case 0x5E6:
      CGroupEventHandler::ComputeMemberResponses(rEvent, pPedGroup, pOriginatorPed);
      return 0;
    case 0x5E7:
      CGroupEventHandler::ComputeResponseLeaderExitedCar(rEvent, pPedGroup, pOriginatorPed);
      return 0;
    default:
      return v6;
  }
  return v6;
}
// 4B5A06: variable 'pOriginatorPed' is possibly undefined
// 66D654: using guessed type void *off_66D654;

//----- (004B5A38) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseVehicleDamage(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int v3; // r5
  CTaskAllocatorKillThreatsDriveby *v5; // r4
  int m_iGroupCreatedBy; // r6
  CTaskAllocatorKillThreatsBasic *v7; // r0

  v3 = *(_DWORD *)&rEvent[1].m_bIsPersistent;
  if ( !v3 || (*(_BYTE *)(v3 + 58) & 7) != 3 )
    return 0;
  v5 = 0;
  switch ( *((_WORD *)&rEvent->m_bIsPersistent + 1) )
  {
    case 0x5DE:
      if ( !CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, (CPed *)v3) )
        goto LABEL_9;
      m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
      v7 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
      v5 = (CTaskAllocatorKillThreatsDriveby *)v7;
      if ( m_iGroupCreatedBy )
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v7, (CPed *)v3);
      }
      else
      {
        CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v7, (CPed *)v3);
        v5->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
      }
      break;
    case 0x5DF:
      v5 = 0;
      CGroupEventHandler::ComputeKillPlayerBasicResponse(pPedGroup, (CPed *)v3, pOriginatorPed, 0);
      break;
    case 0x5E1:
LABEL_9:
      v5 = 0;
      CGroupEventHandler::ComputeFleePedResponse(pPedGroup, (CPed *)v3, pOriginatorPed, 0);
      break;
    case 0x5E6:
      CGroupEventHandler::ComputeMemberResponses(rEvent, pPedGroup, pOriginatorPed);
      v5 = 0;
      break;
    case 0x5EC:
      v5 = (CTaskAllocatorKillThreatsDriveby *)CTaskAllocator::operator new(0x14u);
      CTaskAllocatorKillThreatsDriveby::CTaskAllocatorKillThreatsDriveby(v5, (CPed *)v3);
      break;
    default:
      return v5;
  }
  return v5;
}
// 4B5AAA: variable 'pOriginatorPed' is possibly undefined
// 66D654: using guessed type void *off_66D654;

//----- (004B5AEC) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseNewGangMember(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int (**v3)(void); // r4
  CPed *v5; // r0
  bool v6; // zf
  CPed *v7; // r0
  bool v8; // zf
  CPed *v9; // r0
  bool v10; // zf
  CTaskComplex *v11; // r6
  CTaskComplexGangJoinRespond *v12; // r6
  CPlayerPed *v13; // r6
  CTaskSimpleGoToPoint *v14; // r6
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  const CVector *p_tx; // r2
  CTaskSimple v19; // [sp+8h] [bp-60h] BYREF
  CTaskComplexSequence v20; // [sp+10h] [bp-58h] BYREF

  v3 = rEvent[1]._vptr$CEvent;
  if ( v3 )
  {
    if ( (int (**)(void))pPedGroup->m_membership.m_pMembers[0] == v3 )
      goto LABEL_13;
    v5 = pPedGroup->m_membership.m_pMembers[1];
    v6 = v5 == (CPed *)v3;
    if ( v5 != (CPed *)v3 )
      v6 = pPedGroup->m_membership.m_pMembers[2] == (CPed *)v3;
    if ( v6 )
      goto LABEL_13;
    v7 = pPedGroup->m_membership.m_pMembers[3];
    v8 = v7 == (CPed *)v3;
    if ( v7 != (CPed *)v3 )
      v8 = pPedGroup->m_membership.m_pMembers[4] == (CPed *)v3;
    if ( v8 )
      goto LABEL_13;
    v9 = pPedGroup->m_membership.m_pMembers[5];
    v10 = v9 == (CPed *)v3;
    if ( v9 != (CPed *)v3 )
      v10 = pPedGroup->m_membership.m_pMembers[6] == (CPed *)v3;
    if ( v10 || (int (**)(void))pPedGroup->m_membership.m_pMembers[7] == v3 )
    {
LABEL_13:
      CTaskComplexSequence::CTaskComplexSequence(&v20);
      v11 = (CTaskComplex *)CTask::operator new(0x14u);
      CTaskComplex::CTaskComplex(v11);
      v11[1]._vptr$CTask = 0;
      v11->_vptr$CTask = (int (**)(void))&off_66AF80;
      LOWORD(v11[1].m_pParent) = 256;
      CTaskComplexSequence::AddTask(&v20, v11);
      v12 = (CTaskComplexGangJoinRespond *)CTask::operator new(0x14u);
      CTaskComplexGangJoinRespond::CTaskComplexGangJoinRespond(v12, 1u);
      CTaskComplexSequence::AddTask(&v20, v12);
      v13 = (CPlayerPed *)pPedGroup->m_membership.m_pMembers[7];
      if ( v13 == FindPlayerPed(0) )
      {
        v14 = (CTaskSimpleGoToPoint *)CTask::operator new(0x2Cu);
        PlayerPed = FindPlayerPed(0);
        m_pMat = PlayerPed->m_pMat;
        p_tx = (const CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &PlayerPed->m_transform.m_translate;
        CTaskSimpleGoToPoint::CTaskSimpleGoToPoint(v14, 6, p_tx, 3.0, 1, 0);
        CTaskComplexSequence::AddTask(&v20, v14);
      }
      CTaskSimple::CTaskSimple(&v19);
      v19._vptr$CTask = (int (**)(void))&off_668FF0;
      CPedGroupIntelligence::SetTask(
        (CPedGroupIntelligence *)0xFFFFFFFF,
        (CPed *)v3,
        &v20,
        pPedGroup->m_intelligence.m_pedTaskPairs,
        -1,
        0);
      CTask::~CTask(&v19);
      CTaskComplexSequence::~CTaskComplexSequence(&v20);
    }
  }
  return 0;
}
// 668FF0: using guessed type void *off_668FF0;
// 66AF80: using guessed type void *off_66AF80;
// 677A98: using guessed type void *`vtable for'CTaskComplexLeaveAnyCar;

//----- (004B5C04) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponsePlayerCommand(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int m_iAccumulatedTime; // r3
  CPed *v4; // r4
  Int32 v5; // r5
  CPed **v6; // r0
  CPed *v7; // r2
  bool v8; // zf
  CPed *v9; // r2
  bool v10; // zf
  CPed *v11; // r2
  bool v12; // zf
  CTaskAllocator *result; // r0
  CTaskAllocatorPlayerCommandAttack *v15; // r0

  m_iAccumulatedTime = rEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime == 2 )
  {
    CGroupEventHandler::ComputeResponseGather(rEvent, pPedGroup, pOriginatorPed);
    return 0;
  }
  if ( m_iAccumulatedTime )
    return 0;
  v4 = *(CPed **)&rEvent[1].m_bIsPersistent;
  if ( !v4 )
    return 0;
  v5 = 0;
  v6 = &CPedGroups::ms_groups[0].m_membership.m_pMembers[7];
  while ( 1 )
  {
    if ( !CPedGroups::ms_activeGroups[v5] )
      goto LABEL_17;
    if ( *(v6 - 7) == v4 )
      break;
    if ( *(v6 - 6) == v4 )
      goto LABEL_22;
    v7 = *(v6 - 5);
    v8 = v7 == v4;
    if ( v7 != v4 )
      v8 = *(v6 - 4) == v4;
    if ( v8 )
      goto LABEL_22;
    v9 = *(v6 - 3);
    v10 = v9 == v4;
    if ( v9 != v4 )
      v10 = *(v6 - 2) == v4;
    if ( v10 )
      goto LABEL_22;
    v11 = *(v6 - 1);
    v12 = v11 == v4;
    if ( v11 != v4 )
      v12 = *v6 == v4;
    if ( v12 )
      goto LABEL_22;
LABEL_17:
    v6 += 181;
    if ( v5++ >= 7 )
      goto LABEL_18;
  }
  if ( v6 == (CPed **)&word_28 )
  {
LABEL_18:
    v5 = -1;
    goto LABEL_24;
  }
LABEL_22:
  if ( (unsigned int)v5 > 7 )
    v5 = -1;
LABEL_24:
  v15 = (CTaskAllocatorPlayerCommandAttack *)CTaskAllocator::operator new(0x20u);
  CTaskAllocatorPlayerCommandAttack::CTaskAllocatorPlayerCommandAttack(v15, v4, v5, v4->m_nPedType);
  return result;
}
// 28: using guessed type __int16 word_28;

//----- (004B5CAC) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseDanger(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int v5; // r0

  v5 = (*((int (__fastcall **)(const CEvent *))rEvent->_vptr$CEvent + 11))(rEvent);
  if ( v5
    && (*(_BYTE *)(v5 + 58) & 7) == 3
    && (int *)*((unsigned __int16 *)&rEvent->m_bIsPersistent + 1) == (int *)((char *)&elf_hash_bucket[313] + 1) )
  {
    CGroupEventHandler::ComputeFleePedResponse(pPedGroup, (CPed *)v5, (CPed *)((char *)&elf_hash_bucket[313] + 1), 0);
  }
  return 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004B5CE4) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeLeanOnVehicleResponse(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CPed *v4; // r6
  CTaskSimple v6; // [sp+Ch] [bp-3Ch] BYREF
  CTaskGoToVehicleAndLean v7; // [sp+14h] [bp-34h] BYREF

  v4 = pPedGroup->m_membership.m_pMembers[7];
  if ( v4 )
  {
    CTaskGoToVehicleAndLean::CTaskGoToVehicleAndLean(
      &v7,
      (CVehicle *)rEvent[1]._vptr$CEvent,
      rEvent[1].m_iAccumulatedTime);
    CTaskSimple::CTaskSimple(&v6);
    v6._vptr$CTask = (int (**)(void))&off_668FF0;
    CPedGroupIntelligence::SetTask(0, v4, &v7, pPedGroup->m_intelligence.m_pedTaskPairs, -1, 0);
    CTask::~CTask(&v6);
    CTaskGoToVehicleAndLean::~CTaskGoToVehicleAndLean(&v7);
  }
  return 0;
}
// 668FF0: using guessed type void *off_668FF0;

//----- (004B5D44) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeKillThreatsBasicResponse(
        CPedGroup *pPedGroup,
        CPed *pThreatPed,
        CPed *pOriginatorPed,
        bool8 bDamageOriginator)
{
  CPed *v6; // r2
  int m_iGroupCreatedBy; // r6
  CTaskAllocatorKillThreatsBasic *v8; // r0
  CTaskAllocator *v9; // r4

  if ( CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, pThreatPed) )
  {
    m_iGroupCreatedBy = (unsigned __int8)pPedGroup->m_iGroupCreatedBy;
    v8 = (CTaskAllocatorKillThreatsBasic *)CTaskAllocator::operator new(0x14u);
    v9 = v8;
    if ( m_iGroupCreatedBy )
    {
      CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v8, pThreatPed);
    }
    else
    {
      CTaskAllocatorKillThreatsBasic::CTaskAllocatorKillThreatsBasic(v8, pThreatPed);
      v9->_vptr$CTaskAllocator = (int (**)(void))&off_66D654;
    }
  }
  else
  {
    v9 = 0;
    CGroupEventHandler::ComputeFleePedResponse(pPedGroup, pThreatPed, v6, 0);
  }
  return v9;
}
// 4B5D76: variable 'v6' is possibly undefined
// 66D654: using guessed type void *off_66D654;

//----- (004B5D98) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeFleePedResponse(
        CPedGroup *pPedGroup,
        CPed *pThreatPed,
        CPed *pOriginatorPed,
        bool8 bDamageOriginator)
{
  CPed *v4; // r10
  bool v5; // zf
  CMatrix *m_pMat; // r2
  CMatrix *v7; // r3
  CSimpleTransform *p_tx; // r6
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v10; // d16
  unsigned __int64 v11; // d1
  CPed **m_pMembers; // r5
  int i; // r8
  CPed *v14; // r4
  CPedTaskPair *p; // [sp+14h] [bp-74h]
  CTask v17; // [sp+18h] [bp-70h] BYREF
  CTaskComplexSmartFleeEntity v18; // [sp+20h] [bp-68h] BYREF

  v4 = pThreatPed;
  v5 = pThreatPed == 0;
  if ( pThreatPed )
  {
    pThreatPed = pPedGroup->m_membership.m_pMembers[7];
    v5 = pThreatPed == 0;
  }
  if ( !v5 )
  {
    m_pMat = pThreatPed->m_pMat;
    v7 = v4->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pThreatPed->m_transform;
    p_m_transform = (CSimpleTransform *)&v7->tx;
    if ( !v7 )
      p_m_transform = &v4->m_transform;
    v10.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
    v11 = vmul_f32(v10, v10).n64_u64[0];
    if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                               * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                       + *(float *)&v11)
               + *((float *)&v11 + 1)) <= 64.0 )
    {
      m_pMembers = pPedGroup->m_membership.m_pMembers;
      p = pPedGroup->m_intelligence.m_pedTaskPairs;
      for ( i = 0; i != 8; ++i )
      {
        v14 = m_pMembers[i];
        if ( v14 )
        {
          rand();
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            &v18,
            v4,
            0,
            60.0,
            10000,
            (const int)&elf_hash_bucket[187],
            1.0);
          CTaskSimple::CTaskSimple((CTaskSimple *)&v17);
          v17._vptr$CTask = (int (**)(void))&off_668FF0;
          CPedGroupIntelligence::SetTask(0, v14, &v18, p, -1, 0);
          CTask::~CTask(&v17);
          CTaskComplexSmartFleeEntity::~CTaskComplexSmartFleeEntity(&v18);
        }
      }
    }
  }
  return 0;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 668FF0: using guessed type void *off_668FF0;
// 4B5D98: using guessed type CTaskComplexSmartFleeEntity var_68;

//----- (004B5EB4) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeStareResponse(
        CPedGroup *pPedGroup,
        CPed *pPedToStareAt,
        CPed *pOriginatorPed,
        int32 timeout,
        int32 timeoutBias)
{
  CPedGroup *v6; // r5
  bool v7; // zf
  CPed *v8; // r1
  CMatrix *m_pMat; // r2
  bool8 *p_m_nScanCode; // r6
  CSimpleTransform *p_tx; // r0
  float32x2_t v12; // d16
  unsigned __int64 v13; // d1
  int v14; // r11
  CPed *v15; // r4
  unsigned __int16 v16; // r0
  int v18; // [sp+Ch] [bp-64h]
  CTask v19; // [sp+10h] [bp-60h] BYREF
  CTaskComplexStareAtPed v20[2]; // [sp+18h] [bp-58h] BYREF

  v6 = pPedGroup;
  v7 = pPedToStareAt == 0;
  if ( pPedToStareAt )
  {
    pPedGroup = (CPedGroup *)pPedGroup->m_membership.m_pMembers[7];
    v7 = pPedGroup == 0;
  }
  if ( !v7 )
  {
    v8 = pPedGroup->m_membership.m_pMembers[2];
    m_pMat = pPedToStareAt->m_pMat;
    p_m_nScanCode = (bool8 *)&v8->m_nScanCode;
    if ( !v8 )
      p_m_nScanCode = &pPedGroup->m_followLeader;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPedToStareAt->m_transform;
    v12.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)(p_m_nScanCode + 4)).n64_u64[0];
    v13 = vmul_f32(v12, v12).n64_u64[0];
    if ( (float)((float)((float)((float)(p_tx->m_translate.x - *(float *)p_m_nScanCode)
                               * (float)(p_tx->m_translate.x - *(float *)p_m_nScanCode))
                       + *(float *)&v13)
               + *((float *)&v13 + 1)) <= 64.0 )
    {
      v14 = 3;
      v18 = timeout - timeoutBias;
      do
      {
        v15 = (CPed *)*((_DWORD *)&v6->m_lastPedRespondedTo + v14);
        if ( v15 )
        {
          v16 = rand();
          CTaskComplexStareAtPed::CTaskComplexStareAtPed(
            v20,
            v6,
            pPedToStareAt,
            v18 + (int)(float)((float)((float)v16 * 0.000015259) * (float)(2 * timeoutBias)));
          CTaskSimple::CTaskSimple((CTaskSimple *)&v19);
          v19._vptr$CTask = (int (**)(void))&off_668FF0;
          CPedGroupIntelligence::SetTask(0, v15, v20, v6->m_intelligence.m_pedTaskPairs, -1, 0);
          CTask::~CTask(&v19);
          CTaskComplexStareAtPed::~CTaskComplexStareAtPed(v20);
        }
        ++v14;
      }
      while ( v14 != 11 );
    }
  }
  return 0;
}
// 668FF0: using guessed type void *off_668FF0;

//----- (004B5FD8) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeHassleThreatResponse(
        CPedGroup *pPedGroup,
        CPed *pThreatPed,
        CPed *pOriginatorPed,
        const bool bBeAggressive)
{
  CPed *v4; // r9
  bool v5; // zf
  CMatrix *m_pMat; // r2
  CMatrix *v7; // r3
  CSimpleTransform *p_tx; // r6
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v10; // d16
  unsigned __int64 v11; // d1
  bool v12; // zf
  int m_pMyVehicle; // r1
  CPed **m_pMembers; // r5
  CPedTaskPair *m_pedTaskPairs; // r10
  int i; // r8
  CPed *v17; // r6
  CPed **v19; // r6
  int j; // r10
  CPed *v21; // r4
  CPedTaskPair *p; // [sp+10h] [bp-70h]
  _BOOL4 beAggressive; // [sp+14h] [bp-6Ch]
  CTask v24; // [sp+18h] [bp-68h] BYREF
  CTaskGangHassleVehicle v25; // [sp+20h] [bp-60h] BYREF

  v4 = pThreatPed;
  beAggressive = bBeAggressive;
  v5 = pThreatPed == 0;
  if ( pThreatPed )
  {
    pThreatPed = pPedGroup->m_membership.m_pMembers[7];
    v5 = pThreatPed == 0;
  }
  if ( !v5 )
  {
    m_pMat = pThreatPed->m_pMat;
    v7 = v4->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pThreatPed->m_transform;
    p_m_transform = (CSimpleTransform *)&v7->tx;
    if ( !v7 )
      p_m_transform = &v4->m_transform;
    v10.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
    v11 = vmul_f32(v10, v10).n64_u64[0];
    if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                               * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                       + *(float *)&v11)
               + *((float *)&v11 + 1)) <= 144.0 )
    {
      m_pMyVehicle = *((unsigned __int8 *)&v4->m_nPedFlags + 1) << 31;
      v12 = m_pMyVehicle == 0;
      if ( m_pMyVehicle )
      {
        m_pMyVehicle = (int)v4->m_pMyVehicle;
        v12 = m_pMyVehicle == 0;
      }
      if ( v12 || *(_DWORD *)(m_pMyVehicle + 1444) )
      {
        m_pMembers = pPedGroup->m_membership.m_pMembers;
        m_pedTaskPairs = pPedGroup->m_intelligence.m_pedTaskPairs;
        for ( i = 0; i != 8; ++i )
        {
          v17 = m_pMembers[i];
          if ( v17 )
          {
            if ( beAggressive )
              CTaskGangHasslePed::CTaskGangHasslePed((CTaskGangHasslePed *)&v25, v4, 2, 12000, 20000);
            else
              CTaskGangHasslePed::CTaskGangHasslePed((CTaskGangHasslePed *)&v25, v4, 1, 12000, 20000);
            CTaskSimple::CTaskSimple((CTaskSimple *)&v24);
            v24._vptr$CTask = (int (**)(void))&off_668FF0;
            CPedGroupIntelligence::SetTask(0, v17, &v25, m_pedTaskPairs, -1, 0);
            CTask::~CTask(&v24);
            CTaskGangHasslePed::~CTaskGangHasslePed((CTaskGangHasslePed *)&v25);
          }
        }
      }
      else if ( !beAggressive )
      {
        v19 = pPedGroup->m_membership.m_pMembers;
        p = pPedGroup->m_intelligence.m_pedTaskPairs;
        for ( j = 0; j != 8; ++j )
        {
          v21 = v19[j];
          if ( v21 && CVehicle::GetSpareHasslePosId(v4->m_pMyVehicle) != -1 )
          {
            CTaskGangHassleVehicle::CTaskGangHassleVehicle(&v25, v4->m_pMyVehicle, -1, 0, 0.25, 0.65);
            CTaskSimple::CTaskSimple((CTaskSimple *)&v24);
            v24._vptr$CTask = (int (**)(void))&off_668FF0;
            CPedGroupIntelligence::SetTask(0, v21, &v25, p, -1, 0);
            CTask::~CTask(&v24);
            CTaskGangHassleVehicle::~CTaskGangHassleVehicle(&v25);
          }
        }
      }
    }
  }
  return 0;
}
// 668FF0: using guessed type void *off_668FF0;

//----- (004B619C) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeMemberResponses(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  CEventEditableResponse *v4; // r4
  CPed **m_pMembers; // r10
  int i; // r8
  CPed *v7; // r5
  CTask *v8; // r6
  CPedTaskPair *p; // [sp+8h] [bp-28h]
  CTask v11[4]; // [sp+Ch] [bp-24h] BYREF

  v4 = (CEventEditableResponse *)(*((int (__fastcall **)(const CEvent *))rEvent->_vptr$CEvent + 5))(rEvent);
  p = pPedGroup->m_intelligence.m_pedTaskPairs;
  m_pMembers = pPedGroup->m_membership.m_pMembers;
  for ( i = 0; i != 8; ++i )
  {
    v7 = m_pMembers[i];
    if ( v7 && CPed::IsAlive(m_pMembers[i]) )
    {
      if ( (*((int (__fastcall **)(CEventEditableResponse *))v4->_vptr$CEvent + 10))(v4) == 1 )
      {
        v4->m_iTaskType = 200;
        CEventEditableResponse::ComputeResponseTaskType(v4, v7, 1);
      }
      v8 = CEventHandler::ComputeEventResponseTask(v7, (const CEvent *)v4);
      if ( v8 )
      {
        CTaskSimple::CTaskSimple((CTaskSimple *)v11);
        v11[0]._vptr$CTask = (int (**)(void))&off_668FF0;
        CPedGroupIntelligence::SetTask(0, v7, v8, p, -1, 0);
        CTask::~CTask(v11);
        (*((void (__fastcall **)(CTask *))v8->_vptr$CTask + 1))(v8);
      }
    }
  }
  if ( v4 )
    (*((void (__fastcall **)(CEventEditableResponse *))v4->_vptr$CEvent + 1))(v4);
  return 0;
}
// 668FF0: using guessed type void *off_668FF0;

//----- (004B6250) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeDrivebyResponse(
        CPedGroup *pPedGroup,
        CPed *pThreatPed,
        CPed *pOriginatorPed)
{
  CTaskAllocatorKillThreatsDriveby *v4; // r0
  CTaskAllocator *result; // r0

  v4 = (CTaskAllocatorKillThreatsDriveby *)CTaskAllocator::operator new(0x14u);
  sub_19F51C(v4, pThreatPed);
  return result;
}

//----- (004B6268) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeDoDealResponse(
        CPedGroup *pPedGroup,
        CPed *pFriendPed,
        CPed *pOriginatorPed)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  CTask *ActiveTaskByType; // r0
  bool v8; // zf
  CPed **m_pMembers; // r9
  int v10; // r0
  CPed *v11; // r6
  CPed *v12; // r1
  CMatrix *m_pMat; // r2
  CMatrix *v14; // r3
  CSimpleTransform *p_tx; // r5
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v17; // d16
  unsigned __int64 v18; // d2
  bool v19; // nf
  CEvent *v20; // r0
  int i; // r8
  CPed *v22; // r5
  bool v23; // zf
  unsigned __int16 v24; // r0
  CVector offsetBoneTag; // [sp+4h] [bp-E4h] BYREF
  CEvent v27; // [sp+24h] [bp-C4h] BYREF
  int v28; // [sp+30h] [bp-B8h]
  CEntity *v29; // [sp+34h] [bp-B4h] BYREF
  char v30; // [sp+38h] [bp-B0h]
  int v31; // [sp+3Ch] [bp-ACh]
  CTaskComplexPartnerDeal v32; // [sp+40h] [bp-A8h] BYREF

  if ( pFriendPed )
  {
    ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pFriendPed->m_pPedIntelligence->m_taskManager, 912);
    v8 = ActiveTaskByType == 0;
    if ( ActiveTaskByType )
    {
      ActiveTaskByType = (CTask *)pPedGroup->m_membership.m_pMembers[7];
      v8 = ActiveTaskByType == 0;
    }
    if ( !v8
      && ActiveTaskByType[138]._vptr$CTask == (int (**)(void))((char *)&dword_0 + 1)
      && pFriendPed->m_nPedType >= 2u )
    {
      v3.n64_u32[0] = 1232348144;
      m_pMembers = pPedGroup->m_membership.m_pMembers;
      v10 = 0;
      v11 = 0;
      do
      {
        v12 = m_pMembers[v10];
        if ( v12 )
        {
          m_pMat = v12->m_pMat;
          v14 = pFriendPed->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &v12->m_transform;
          p_m_transform = (CSimpleTransform *)&v14->tx;
          if ( !v14 )
            p_m_transform = &pFriendPed->m_transform;
          v17.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
          v18 = vmul_f32(v17, v17).n64_u64[0];
          v4.n64_f32[0] = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                        * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                                + *(float *)&v18)
                        + *((float *)&v18 + 1);
          v19 = v4.n64_f32[0] < v3.n64_f32[0];
          v3.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
          if ( v19 )
            v11 = m_pMembers[v10];
        }
        ++v10;
      }
      while ( v10 != 7 );
      if ( v11 && v3.n64_f32[0] >= 16.0 && v3.n64_f32[0] <= 100.0 )
      {
        memset(&offsetBoneTag, 0, sizeof(offsetBoneTag));
        CTaskComplexPartnerDeal::CTaskComplexPartnerDeal(&v32, "CompDoDealResp", pFriendPed, 1u, 0.0, offsetBoneTag);
        CTaskSimple::CTaskSimple((CTaskSimple *)&v27);
        v27._vptr$CEvent = (int (**)(void))&off_668FF0;
        CPedGroupIntelligence::SetTask(
          (CPedGroupIntelligence *)0xFFFFFFFF,
          v11,
          &v32,
          pPedGroup->m_intelligence.m_pedTaskPairs,
          -1,
          0);
        CTask::~CTask((CTask *)&v27);
        CEvent::CEvent(v20);
        v28 = 0;
        v27._vptr$CEvent = (int (**)(void))&off_669024;
        v29 = v11;
        v30 = 0;
        v31 = 0;
        CEntity::RegisterReference(v11, &v29);
        CEventGroup::Add(&pFriendPed->m_pPedIntelligence->m_eventGroup, &v27, 0);
        for ( i = 0; i != 8; ++i )
        {
          v22 = m_pMembers[i];
          v23 = v22 == 0;
          if ( v22 )
            v23 = v22 == v11;
          if ( !v23 )
          {
            v24 = rand();
            IKChainManager_c::LookAt(
              &g_ikChainMan,
              "CompDoDealResp",
              v22,
              v11,
              (int)(float)((float)((float)v24 * 0.000015259) * 3000.0) + 3000,
              5,
              0,
              1,
              0.25,
              500,
              3,
              0);
          }
        }
        pPedGroup->m_lastPedRespondedTo = pFriendPed;
        v27._vptr$CEvent = (int (**)(void))&off_669024;
        if ( v29 )
          CEntity::CleanUpOldReference(v29, &v29);
        CEvent::~CEvent(&v27);
        CTaskComplexPartnerShove::~CTaskComplexPartnerShove(&v32);
      }
    }
  }
  return 0;
}
// 4B630E: variable 'v4' is possibly undefined
// 4B630E: variable 'v3' is possibly undefined
// 4B6396: variable 'v20' is possibly undefined
// 0: using guessed type int dword_0;
// 668FF0: using guessed type void *off_668FF0;
// 669024: using guessed type void *;

//----- (004B64C4) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeGreetResponse(
        CPedGroup *pPedGroup,
        CPed *pFriendPed,
        CPed *pOriginatorPed)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  CTask *ActiveTaskByType; // r0
  bool v8; // zf
  CPed **m_pMembers; // r9
  int v10; // r0
  CPed *v11; // r6
  CPed *v12; // r1
  CMatrix *m_pMat; // r2
  CMatrix *v14; // r3
  CSimpleTransform *p_tx; // r5
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v17; // d16
  unsigned __int64 v18; // d2
  bool v19; // nf
  float v20; // s18
  CEvent *v21; // r0
  int i; // r8
  CPed *v23; // r5
  bool v24; // zf
  unsigned __int16 v25; // r0
  CVector targetPos; // [sp+8h] [bp-E8h] BYREF
  CEvent v28; // [sp+28h] [bp-C8h] BYREF
  int v29; // [sp+34h] [bp-BCh]
  CEntity *v30; // [sp+38h] [bp-B8h] BYREF
  char v31; // [sp+3Ch] [bp-B4h]
  int v32; // [sp+40h] [bp-B0h]
  CTaskComplexPartnerGreet v33; // [sp+44h] [bp-ACh] BYREF

  if ( pFriendPed )
  {
    ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pFriendPed->m_pPedIntelligence->m_taskManager, 912);
    v8 = ActiveTaskByType == 0;
    if ( ActiveTaskByType )
    {
      ActiveTaskByType = (CTask *)pPedGroup->m_membership.m_pMembers[7];
      v8 = ActiveTaskByType == 0;
    }
    if ( !v8
      && ActiveTaskByType[138]._vptr$CTask == (int (**)(void))((char *)&dword_0 + 1)
      && pFriendPed->m_nPedType >= 2u )
    {
      v3.n64_u32[0] = 1232348144;
      m_pMembers = pPedGroup->m_membership.m_pMembers;
      v10 = 0;
      v11 = 0;
      do
      {
        v12 = m_pMembers[v10];
        if ( v12 )
        {
          m_pMat = v12->m_pMat;
          v14 = pFriendPed->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &v12->m_transform;
          p_m_transform = (CSimpleTransform *)&v14->tx;
          if ( !v14 )
            p_m_transform = &pFriendPed->m_transform;
          v17.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
          v18 = vmul_f32(v17, v17).n64_u64[0];
          v4.n64_f32[0] = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                        * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                                + *(float *)&v18)
                        + *((float *)&v18 + 1);
          v19 = v4.n64_f32[0] < v3.n64_f32[0];
          v3.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
          if ( v19 )
            v11 = m_pMembers[v10];
        }
        ++v10;
      }
      while ( v10 != 7 );
      if ( v11 && v3.n64_f32[0] >= 16.0 && v3.n64_f32[0] <= 100.0 )
      {
        v20 = (float)((float)(unsigned __int16)rand() * 0.000015259) * 6.0;
        memset(&targetPos, 0, sizeof(targetPos));
        CTaskComplexPartnerGreet::CTaskComplexPartnerGreet(
          &v33,
          "CompGreetResp",
          pFriendPed,
          1u,
          0.0,
          (int)v20,
          targetPos);
        CTaskSimple::CTaskSimple((CTaskSimple *)&v28);
        v28._vptr$CEvent = (int (**)(void))&off_668FF0;
        CPedGroupIntelligence::SetTask(
          (CPedGroupIntelligence *)0xFFFFFFFF,
          v11,
          &v33,
          pPedGroup->m_intelligence.m_pedTaskPairs,
          -1,
          0);
        CTask::~CTask((CTask *)&v28);
        CEvent::CEvent(v21);
        v29 = (int)v20 + 1;
        v28._vptr$CEvent = (int (**)(void))&off_669024;
        v30 = v11;
        v31 = 0;
        v32 = 0;
        CEntity::RegisterReference(v11, &v30);
        CEventGroup::Add(&pFriendPed->m_pPedIntelligence->m_eventGroup, &v28, 0);
        for ( i = 0; i != 8; ++i )
        {
          v23 = m_pMembers[i];
          v24 = v23 == 0;
          if ( v23 )
            v24 = v23 == v11;
          if ( !v24 )
          {
            v25 = rand();
            IKChainManager_c::LookAt(
              &g_ikChainMan,
              "CompGreetResp",
              v23,
              v11,
              (int)(float)((float)((float)v25 * 0.000015259) * 3000.0) + 3000,
              5,
              0,
              1,
              0.25,
              500,
              3,
              0);
          }
        }
        pPedGroup->m_lastPedRespondedTo = pFriendPed;
        v28._vptr$CEvent = (int (**)(void))&off_669024;
        if ( v30 )
          CEntity::CleanUpOldReference(v30, &v30);
        CEvent::~CEvent(&v28);
        CTaskComplexPartnerShove::~CTaskComplexPartnerShove(&v33);
      }
    }
  }
  return 0;
}
// 4B656A: variable 'v4' is possibly undefined
// 4B656A: variable 'v3' is possibly undefined
// 4B6618: variable 'v21' is possibly undefined
// 0: using guessed type int dword_0;
// 668FF0: using guessed type void *off_668FF0;
// 669024: using guessed type void *off_669024;

//----- (004B674C) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeHandSignalResponse(
        CPedGroup *pPedGroup,
        CPed *pThreatPed,
        CPed *pOriginatorPed)
{
  CPed **m_pMembers; // r4
  int i; // r8
  CPed *v6; // r5
  CPedTaskPair *p; // [sp+8h] [bp-40h]
  CTask v9; // [sp+Ch] [bp-3Ch] BYREF
  CTaskComplexSignalAtPed v10[2]; // [sp+14h] [bp-34h] BYREF

  if ( pThreatPed )
  {
    m_pMembers = pPedGroup->m_membership.m_pMembers;
    p = pPedGroup->m_intelligence.m_pedTaskPairs;
    for ( i = 0; i != 8; ++i )
    {
      v6 = m_pMembers[i];
      if ( v6 && !CPed::IsPlayer(m_pMembers[i]) )
      {
        CTaskComplexSignalAtPed::CTaskComplexSignalAtPed(v10, pThreatPed, -1, 0);
        CTaskSimple::CTaskSimple((CTaskSimple *)&v9);
        v9._vptr$CTask = (int (**)(void))&off_668FF0;
        CPedGroupIntelligence::SetTask(0, v6, v10, p, -1, 0);
        CTask::~CTask(&v9);
        CTaskComplexSignalAtPed::~CTaskComplexSignalAtPed(v10);
      }
    }
  }
  return 0;
}
// 668FF0: using guessed type void *off_668FF0;

//----- (004B67D8) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeHassleSexyPedResponse(
        CPedGroup *pPedGroup,
        CPed *pSexyPed,
        CPed *pOriginatorPed)
{
  CPed **m_pMembers; // r4
  int i; // r8
  CPed *v6; // r5
  CPedTaskPair *p; // [sp+8h] [bp-68h]
  CTask v9; // [sp+Ch] [bp-64h] BYREF
  CTaskGangHasslePed v10[2]; // [sp+14h] [bp-5Ch] BYREF

  if ( pSexyPed )
  {
    m_pMembers = pPedGroup->m_membership.m_pMembers;
    p = pPedGroup->m_intelligence.m_pedTaskPairs;
    for ( i = 0; i != 7; ++i )
    {
      if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) >= 76 )
      {
        v6 = m_pMembers[i];
        if ( v6 )
        {
          CTaskGangHasslePed::CTaskGangHasslePed(v10, pSexyPed, 0, 8000, 12000);
          CTaskSimple::CTaskSimple((CTaskSimple *)&v9);
          v9._vptr$CTask = (int (**)(void))&off_668FF0;
          CPedGroupIntelligence::SetTask(0, v6, v10, p, -1, 0);
          CTask::~CTask(&v9);
          CTaskGangHasslePed::~CTaskGangHasslePed(v10);
        }
      }
    }
  }
  return 0;
}
// 668FF0: using guessed type void *off_668FF0;

//----- (004B68A0) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeKillPlayerBasicResponse(
        CPedGroup *pPedGroup,
        CPed *pThreatPed,
        CPed *pOriginatorPed,
        bool8 bDamageOriginator)
{
  CPed *v6; // r2
  CPed **m_pMembers; // r8
  int i; // r9
  CPed *v9; // r5
  CPedTaskPair *p; // [sp+10h] [bp-60h]
  CTaskSimple v12; // [sp+14h] [bp-5Ch] BYREF
  CTaskComplexKillPedOnFoot v13; // [sp+1Ch] [bp-54h] BYREF

  if ( pThreatPed )
  {
    if ( CGroupEventHandler::IsKillTaskAppropriate(pPedGroup, pThreatPed) )
    {
      p = pPedGroup->m_intelligence.m_pedTaskPairs;
      m_pMembers = pPedGroup->m_membership.m_pMembers;
      for ( i = 0; i != 8; ++i )
      {
        v9 = m_pMembers[i];
        if ( v9 )
        {
          CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(&v13, pThreatPed, -1, 0, 0, 0, 1);
          CTaskSimple::CTaskSimple(&v12);
          v12._vptr$CTask = (int (**)(void))&off_668FF0;
          CPedGroupIntelligence::SetTask((CPedGroupIntelligence *)0xFFFFFFFF, v9, &v13, p, -1, 0);
          CTask::~CTask(&v12);
          CTaskComplexKillPedOnFootStealth::~CTaskComplexKillPedOnFootStealth(&v13);
        }
      }
    }
    else
    {
      CGroupEventHandler::ComputeFleePedResponse(pPedGroup, pThreatPed, v6, 0);
    }
  }
  return 0;
}
// 4B6936: variable 'v6' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;

//----- (004B6948) --------------------------------------------------------
int32 __fastcall CPedGroups::GetGroupId(CPedGroup *pPedGroup)
{
  int32 v2; // r1

  if ( pPedGroup == CPedGroups::ms_groups )
    return 0;
  if ( pPedGroup == &CPedGroups::ms_groups[1] )
    return 1;
  if ( pPedGroup == &CPedGroups::ms_groups[2] )
    return 2;
  if ( pPedGroup == &CPedGroups::ms_groups[3] )
    return 3;
  if ( pPedGroup == &CPedGroups::ms_groups[4] )
    return 4;
  if ( pPedGroup == &CPedGroups::ms_groups[5] )
    return 5;
  if ( pPedGroup == &CPedGroups::ms_groups[6] )
    return 6;
  v2 = -1;
  if ( pPedGroup == &CPedGroups::ms_groups[7] )
    return 7;
  return v2;
}

//----- (004B6A00) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeResponseGather(
        const CEvent *rEvent,
        CPedGroup *pPedGroup,
        CPed *pOriginatorPed)
{
  int i; // r11
  CPed *v5; // r5
  CPedTaskPair *m_pedTaskPairs; // [sp+1Ch] [bp-94h]
  CPed **m_pMembers; // [sp+24h] [bp-8Ch]
  CTaskSimple v9; // [sp+28h] [bp-88h] BYREF
  CTaskComplex v10; // [sp+30h] [bp-80h] BYREF
  CEntity *v11[3]; // [sp+3Ch] [bp-74h] BYREF
  __int64 v12; // [sp+48h] [bp-68h]
  __int64 v13; // [sp+50h] [bp-60h]
  int v14; // [sp+58h] [bp-58h]
  int v15; // [sp+5Ch] [bp-54h]
  __int16 v16; // [sp+60h] [bp-50h]
  int v17; // [sp+64h] [bp-4Ch]
  int v18; // [sp+68h] [bp-48h]
  __int16 v19; // [sp+6Ch] [bp-44h]
  void **v20; // [sp+70h] [bp-40h]
  int v21; // [sp+74h] [bp-3Ch]
  char v22; // [sp+78h] [bp-38h]

  m_pMembers = pPedGroup->m_membership.m_pMembers;
  m_pedTaskPairs = pPedGroup->m_intelligence.m_pedTaskPairs;
  for ( i = 0; i != 7; ++i )
  {
    v5 = m_pMembers[i];
    if ( v5 )
    {
      CTaskComplex::CTaskComplex(&v10);
      v11[0] = pOriginatorPed;
      v11[1] = (CEntity *)(elf_hash_bucket + 49748);
      v11[2] = (CEntity *)(elf_hash_bucket + 748);
      v10._vptr$CTask = (int (**)(void))&off_6656D4;
      v12 = 0x4000000040F00000LL;
      v13 = 0x4000000000000000LL;
      v14 = 0;
      v15 = 0;
      v16 = 0;
      v17 = 0;
      v18 = 0;
      v19 = 0;
      v20 = &off_665710;
      v21 = 6;
      v22 = v22 & 0xF0 | 3;
      if ( pOriginatorPed )
        CEntity::RegisterReference(pOriginatorPed, v11);
      CTaskSimple::CTaskSimple(&v9);
      v9._vptr$CTask = (int (**)(void))&off_668FF0;
      CPedGroupIntelligence::SetTask((CPedGroupIntelligence *)0xFFFFFFFF, v5, &v10, m_pedTaskPairs, -1, 0);
      CTask::~CTask(&v9);
      v10._vptr$CTask = (int (**)(void))&off_6656D4;
      if ( v11[0] )
        CEntity::CleanUpOldReference(v11[0], v11);
      CTaskComplex::~CTaskComplex(&v10);
    }
  }
  return 0;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 668FF0: using guessed type void *off_668FF0;

//----- (004B6B40) --------------------------------------------------------
bool __fastcall CGroupEventHandler::IsKillTaskAppropriate(CPedGroup *pPedGroup, CPed *pOtherPed)
{
  CPed *v3; // r0
  CPed *v4; // r0
  CPed *v5; // r0
  CPed *v6; // r0
  CPed *v7; // r0
  CPed *v8; // r0
  CPed *v9; // r0
  CPed *v10; // r0

  if ( pPedGroup->m_iGroupCreatedBy == 1 )
    return 1;
  if ( CWeapon::IsTypeMelee(&pOtherPed->m_WeaponSlots[pOtherPed->m_nCurrentWeapon]) )
    return 1;
  v3 = pPedGroup->m_membership.m_pMembers[0];
  if ( v3 )
  {
    if ( !CWeapon::IsTypeMelee(&v3->m_WeaponSlots[v3->m_nCurrentWeapon]) )
      return 1;
  }
  v4 = pPedGroup->m_membership.m_pMembers[1];
  if ( v4 )
  {
    if ( !CWeapon::IsTypeMelee(&v4->m_WeaponSlots[v4->m_nCurrentWeapon]) )
      return 1;
  }
  v5 = pPedGroup->m_membership.m_pMembers[2];
  if ( v5 )
  {
    if ( !CWeapon::IsTypeMelee(&v5->m_WeaponSlots[v5->m_nCurrentWeapon]) )
      return 1;
  }
  v6 = pPedGroup->m_membership.m_pMembers[3];
  if ( v6 )
  {
    if ( !CWeapon::IsTypeMelee(&v6->m_WeaponSlots[v6->m_nCurrentWeapon]) )
      return 1;
  }
  v7 = pPedGroup->m_membership.m_pMembers[4];
  if ( v7 )
  {
    if ( !CWeapon::IsTypeMelee(&v7->m_WeaponSlots[v7->m_nCurrentWeapon]) )
      return 1;
  }
  v8 = pPedGroup->m_membership.m_pMembers[5];
  if ( v8 )
  {
    if ( !CWeapon::IsTypeMelee(&v8->m_WeaponSlots[v8->m_nCurrentWeapon]) )
      return 1;
  }
  v9 = pPedGroup->m_membership.m_pMembers[6];
  if ( v9 )
  {
    if ( !CWeapon::IsTypeMelee(&v9->m_WeaponSlots[v9->m_nCurrentWeapon]) )
      return 1;
  }
  v10 = pPedGroup->m_membership.m_pMembers[7];
  return v10 && !CWeapon::IsTypeMelee(&v10->m_WeaponSlots[v10->m_nCurrentWeapon]);
}

//----- (004B6C50) --------------------------------------------------------
CTaskAllocator *__fastcall CGroupEventHandler::ComputeWalkAlongsideResponse(
        CPedGroup *pPedGroup,
        CPed *pFriendPed,
        CPed *pOriginatorPed)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  CPed **m_pMembers; // r0
  int v8; // r1
  CPed *v9; // r6
  CPed *v10; // r2
  CMatrix *m_pMat; // r3
  CMatrix *v12; // r5
  CSimpleTransform *p_tx; // r4
  CSimpleTransform *p_m_transform; // r3
  float32x2_t v15; // d16
  unsigned __int64 v16; // d2
  bool v17; // nf
  CTaskSimple v19; // [sp+Ch] [bp-44h] BYREF
  CTaskComplexWalkAlongsidePed v20; // [sp+14h] [bp-3Ch] BYREF

  if ( pFriendPed )
  {
    v3.n64_u32[0] = 1232348144;
    m_pMembers = pPedGroup->m_membership.m_pMembers;
    v8 = 0;
    v9 = 0;
    do
    {
      v10 = m_pMembers[v8];
      if ( v10 )
      {
        m_pMat = v10->m_pMat;
        v12 = pFriendPed->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &v10->m_transform;
        p_m_transform = (CSimpleTransform *)&v12->tx;
        if ( !v12 )
          p_m_transform = &pFriendPed->m_transform;
        v15.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
        v16 = vmul_f32(v15, v15).n64_u64[0];
        v4.n64_f32[0] = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                      * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                              + *(float *)&v16)
                      + *((float *)&v16 + 1);
        v17 = v4.n64_f32[0] < v3.n64_f32[0];
        v3.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
        if ( v17 )
          v9 = m_pMembers[v8];
      }
      ++v8;
    }
    while ( v8 != 7 );
    if ( v9 )
    {
      CTaskComplexWalkAlongsidePed::CTaskComplexWalkAlongsidePed(&v20, pFriendPed, 10.0);
      CTaskSimple::CTaskSimple(&v19);
      v19._vptr$CTask = (int (**)(void))&off_668FF0;
      CPedGroupIntelligence::SetTask(0, v9, &v20, pPedGroup->m_intelligence.m_pedTaskPairs, -1, 0);
      CTask::~CTask(&v19);
      pPedGroup->m_lastPedRespondedTo = pFriendPed;
      CTaskComplexWalkAlongsidePed::~CTaskComplexWalkAlongsidePed(&v20);
    }
  }
  return 0;
}
// 4B6CBA: variable 'v4' is possibly undefined
// 4B6CBA: variable 'v3' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;

//----- (004B6D34) --------------------------------------------------------
void __fastcall CPedGroup::CPedGroup(CPedGroup *this)
{
  CPed **v2; // r0

  this->m_membership.m_fMaxSeparation = 60.0;
  v2 = &this->m_membership.m_pMembers[4];
  *(_QWORD *)v2 = 0LL;
  *((_QWORD *)v2 + 1) = 0LL;
  *(_QWORD *)this->m_membership.m_pMembers = 0LL;
  *(_QWORD *)&this->m_membership.m_pMembers[2] = 0LL;
  CPedGroupIntelligence::CPedGroupIntelligence(&this->m_intelligence);
  this->m_iGroupCreatedBy = 0;
  this->m_lastPedRespondedTo = 0;
  this->m_followLeader = 1;
  this->m_membership.m_pPedGroup = this;
  this->m_intelligence.m_pPedGroup = this;
}

//----- (004B6D72) --------------------------------------------------------
void __fastcall CPedGroup::~CPedGroup(CPedGroup *this)
{
  CPedGroupIntelligence::Flush(&this->m_intelligence);
  CPedGroupMembership::Flush(&this->m_membership);
}

//----- (004B6D8C) --------------------------------------------------------
void __fastcall CPedGroup::Process(CPedGroup *this)
{
  CPedGroupMembership::Process(&this->m_membership);
  CPedGroupIntelligence::Process(&this->m_intelligence);
}

//----- (004B6DA6) --------------------------------------------------------
void __fastcall CPedGroup::Flush(CPedGroup *this)
{
  CPedGroupMembership::Flush(&this->m_membership);
  CPedGroupIntelligence::Flush(&this->m_intelligence);
  this->m_iGroupCreatedBy = 0;
}

//----- (004B6DC4) --------------------------------------------------------
void __fastcall CPedGroup::RemoveAllFollowers(CPedGroup *this)
{
  CPedGroupMembership::RemoveAllFollowers(&this->m_membership, 0);
}

//----- (004B6DCC) --------------------------------------------------------
void __fastcall CPedGroup::Teleport(CPedGroup *this, const CVector *vNewPos)
{
  unsigned __int8 *v4; // r6
  CEventGroupEvent *m_pCurrentEvent; // r0
  int i; // r5
  CVehicle *m_pMyVehicle; // r11
  int v8; // r0
  CPed *v9; // r6
  bool v10; // zf
  CPed **m_pMembers; // r9
  int v12; // r6
  float *p_y; // r4
  CPed *v14; // r5
  CPedIntelligence *m_pPedIntelligence; // r1
  CTask *v16; // r0
  CTask *v17; // r0
  bool v18; // zf
  CTaskSimpleCarSetPedOut v19[2]; // [sp+8h] [bp-40h] BYREF

  v4 = (unsigned __int8 *)this->m_membership.m_pMembers[7];
  if ( v4 && CPed::IsAlive(this->m_membership.m_pMembers[7]) )
    (*(void (__fastcall **)(unsigned __int8 *, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)v4 + 60))(
      v4,
      LODWORD(vNewPos->x),
      LODWORD(vNewPos->y),
      LODWORD(vNewPos->z),
      0);
  m_pCurrentEvent = this->m_intelligence.m_pCurrentEvent;
  if ( !m_pCurrentEvent
    || (*((int (__fastcall **)(CEvent *))m_pCurrentEvent->m_pEvent->_vptr$CEvent + 2))(m_pCurrentEvent->m_pEvent) != 77 )
  {
    if ( v4 && !(v4[1157] << 31) )
    {
      for ( i = 0; i != 7; ++i )
      {
        v9 = this->m_membership.m_pMembers[i];
        if ( v9 )
        {
          v10 = *((unsigned __int8 *)&v9->m_nPedFlags + 1) << 31 == 0;
          if ( *((unsigned __int8 *)&v9->m_nPedFlags + 1) << 31 )
            v10 = v9->CharCreatedBy == 2;
          if ( !v10 && CPed::IsAlive(this->m_membership.m_pMembers[i]) )
          {
            m_pMyVehicle = v9->m_pMyVehicle;
            v8 = CCarEnterExit::ComputeTargetDoorToExit(m_pMyVehicle, v9);
            CTaskSimpleCarSetPedOut::CTaskSimpleCarSetPedOut(v19, m_pMyVehicle, v8, 0);
            v19[0].m_bWarpingOutOfCar = 1;
            CTaskSimpleCarSetPedOut::ProcessPed(v19, v9);
            CTaskSimpleCarSetPedOut::~CTaskSimpleCarSetPedOut(v19);
          }
        }
      }
    }
    m_pMembers = this->m_membership.m_pMembers;
    v12 = 0;
    p_y = &CTaskComplexFollowLeaderInFormation::ms_offsets.m_offsets[0].y;
    do
    {
      v14 = m_pMembers[v12];
      if ( v14 && CPed::IsAlive(m_pMembers[v12]) )
      {
        (*((void (__fastcall **)(CPed *, _DWORD, _DWORD, _DWORD, _DWORD))v14->_vptr$CPlaceable + 15))(
          v14,
          *(p_y - 1) + vNewPos->x,
          *p_y + vNewPos->y,
          vNewPos->z + 0.0,
          0);
        CPed::PositionAnyPedOutOfCollision(v14);
        m_pPedIntelligence = v14->m_pPedIntelligence;
        v16 = m_pPedIntelligence->m_taskManager.m_tasks[0];
        if ( !v16 )
        {
          v17 = m_pPedIntelligence->m_taskManager.m_tasks[1];
          v18 = v17 == 0;
          if ( !v17 )
            v18 = m_pPedIntelligence->m_taskManager.m_tasks[2] == 0;
          if ( v18 )
            goto LABEL_27;
          v16 = m_pPedIntelligence->m_taskManager.m_tasks[1];
          if ( !v16 )
            v16 = m_pPedIntelligence->m_taskManager.m_tasks[2];
        }
        (*((void (__fastcall **)(CTask *, CPed *, _DWORD, _DWORD))v16->_vptr$CTask + 7))(v16, v14, 0, 0);
      }
LABEL_27:
      ++v12;
      p_y += 2;
    }
    while ( v12 != 7 );
  }
}

//----- (004B6F2C) --------------------------------------------------------
void __fastcall CPedGroup::PlayerGaveCommand_Attack(CPedGroup *this, CPed *pOriginatorPed, CPed *pAttackedPed)
{
  CEventPlayerCommandToGroup *v6; // r4
  _BOOL4 v7; // r0
  int32 m_nPedType; // r0
  UInt16 v9; // r1
  CEventGroupEvent v10; // [sp+Ch] [bp-2Ch] BYREF

  v6 = (CEventPlayerCommandToGroup *)CEvent::operator new(0x18u);
  CEventPlayerCommandToGroup::CEventPlayerCommandToGroup(v6, 0, pAttackedPed);
  v6->_vptr$CEvent = (int (**)(void))&off_6671E8;
  CEventGroupEvent::CEventGroupEvent(&v10, pOriginatorPed, (CEvent *)v6);
  v7 = CPedGroupIntelligence::AddEvent(&this->m_intelligence, &v10);
  if ( pAttackedPed )
  {
    if ( v7 )
    {
      m_nPedType = pAttackedPed->m_nPedType;
      if ( m_nPedType != 8 )
      {
        if ( (unsigned int)(m_nPedType - 7) <= 9 )
          v9 = 147;
        else
          v9 = 148;
        CPed::Say(pOriginatorPed, v9, 0, 1.0, 0, 0, 0);
      }
    }
  }
  CEventGroupEvent::~CEventGroupEvent(&v10);
}
// 6671E8: using guessed type void *off_6671E8;

//----- (004B6FAC) --------------------------------------------------------
void __fastcall CPedGroup::PlayerGaveCommand_Gather(CPedGroup *this, CPed *pOriginatorPed)
{
  CVehicle *v4; // r0
  CVehicle *m_pMyVehicle; // r1
  bool v6; // zf
  Int32 v7; // r8
  CPed *v8; // r4
  CPedTaskPair *p; // [sp+Ch] [bp-DCh]
  CTaskSimple v10; // [sp+10h] [bp-D8h] BYREF
  CTaskSimpleGoToPoint v11; // [sp+18h] [bp-D0h] BYREF
  CPedList pPedList; // [sp+44h] [bp-A4h] BYREF
  CVector Dest; // [sp+C0h] [bp-28h] BYREF

  CPedList::Empty(&pPedList);
  CPedList::BuildListFromGroup_NotInCar_NoLeader(&pPedList, &this->m_membership);
  v4 = CPedIntelligence::IsInACarOrEnteringOne(pOriginatorPed->m_pPedIntelligence);
  v6 = v4 == 0;
  if ( v4 )
  {
    m_pMyVehicle = pOriginatorPed->m_pMyVehicle;
    v6 = m_pMyVehicle == 0;
  }
  if ( v6 )
    CFormation::GenerateGatherDestinations(&pPedList, pOriginatorPed);
  else
    CFormation::GenerateGatherDestinations_AroundCar(&pPedList, m_pMyVehicle);
  CFormation::DistributeDestinations(&pPedList);
  if ( pPedList.m_nMembers >= 1 )
  {
    p = this->m_intelligence.m_pedTaskPairs;
    v7 = 0;
    do
    {
      v8 = pPedList.m_aMembers[v7];
      if ( CFormation::ReturnDestinationForPed(v8, &Dest) )
      {
        CTaskSimpleGoToPoint::CTaskSimpleGoToPoint(&v11, 7, &Dest, 2.0, 1, 0);
        CTaskSimple::CTaskSimple(&v10);
        v10._vptr$CTask = (int (**)(void))&off_668FF0;
        CPedGroupIntelligence::SetTask((CPedGroupIntelligence *)0xFFFFFFFF, v8, &v11, p, -1, 0);
        CTask::~CTask(&v10);
        CTaskSimpleGoToPoint::~CTaskSimpleGoToPoint((CTaskSimpleGoTo *)&v11);
      }
      ++v7;
    }
    while ( v7 < pPedList.m_nMembers );
  }
}
// 4B6FE2: variable 'm_pMyVehicle' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;

//----- (004B7084) --------------------------------------------------------
CPed *__fastcall CPedGroup::GetClosestGroupPed(CPedGroup *this, CPed *pPed, float *retDistSqr)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  CPed **m_pMembers; // r12
  CPed *result; // r0
  int i; // r3
  CPed *v8; // lr
  bool v9; // zf
  CMatrix *m_pMat; // r4
  CMatrix *v11; // r5
  CSimpleTransform *p_tx; // r6
  CSimpleTransform *p_m_transform; // r4
  float32x2_t v14; // d16
  unsigned __int64 v15; // d2
  bool v16; // nf

  m_pMembers = this->m_membership.m_pMembers;
  v3.n64_u32[0] = 1287568416;
  result = 0;
  for ( i = 0; i != 8; ++i )
  {
    v8 = m_pMembers[i];
    v9 = v8 == 0;
    if ( v8 )
      v9 = v8 == pPed;
    if ( !v9 )
    {
      m_pMat = v8->m_pMat;
      v11 = pPed->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v8->m_transform;
      p_m_transform = (CSimpleTransform *)&v11->tx;
      if ( !v11 )
        p_m_transform = &pPed->m_transform;
      v14.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
      v15 = vmul_f32(v14, v14).n64_u64[0];
      v4.n64_f32[0] = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                    * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                            + *(float *)&v15)
                    + *((float *)&v15 + 1);
      v16 = v4.n64_f32[0] < v3.n64_f32[0];
      v3.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
      if ( v16 )
        result = m_pMembers[i];
    }
  }
  if ( retDistSqr )
    *retDistSqr = v3.n64_f32[0];
  return result;
}
// 4B70EA: variable 'v4' is possibly undefined
// 4B70EA: variable 'v3' is possibly undefined

//----- (004B7118) --------------------------------------------------------
bool __fastcall CPedGroup::IsAnyoneUsingCar(const CPedGroup *this, const CVehicle *vehicle)
{
  int v4; // r0
  int v5; // r6
  int v6; // r5
  const CVehicle *v7; // r0
  CTask *TaskByType; // r0
  CTask *v9; // r0

  v4 = 3;
  while ( 1 )
  {
    v5 = v4;
    v6 = *((_DWORD *)&this->m_lastPedRespondedTo + v4);
    if ( v6 )
    {
      v7 = *(const CVehicle **)(v6 + 1424);
      if ( v7 )
      {
        if ( v7 == vehicle && (*(_DWORD *)(v6 + 1156) & 0x100) != 0 )
          break;
      }
      TaskByType = CPedIntelligence::FindTaskByType(*(const CPedIntelligence **)(v6 + 1088), 701);
      if ( TaskByType )
      {
        if ( (const CVehicle *)TaskByType[1].m_pParent == vehicle )
          break;
      }
      v9 = CPedIntelligence::FindTaskByType(*(const CPedIntelligence **)(v6 + 1088), 700);
      if ( v9 )
      {
        if ( (const CVehicle *)v9[1].m_pParent == vehicle )
          break;
      }
    }
    v4 = v5 + 1;
    if ( v5 - 3 >= 7 )
      return 0;
  }
  return 1;
}

//----- (004B7184) --------------------------------------------------------
float __fastcall CPedGroup::FindDistanceToFurthestMember(CPedGroup *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  CPed *v3; // lr
  CPed **m_pMembers; // r12
  int i; // r2
  CPed *v6; // r3
  CMatrix *m_pMat; // r0
  CMatrix *v8; // r1
  CSimpleTransform *p_tx; // r4
  CSimpleTransform *p_m_transform; // r0
  float32x2_t v11; // d16
  unsigned __int64 v12; // d2

  v3 = this->m_membership.m_pMembers[7];
  v1.n64_u32[0] = 0;
  if ( v3 )
  {
    m_pMembers = this->m_membership.m_pMembers;
    for ( i = 0; i != 7; ++i )
    {
      v6 = m_pMembers[i];
      if ( v6 )
      {
        m_pMat = v3->m_pMat;
        v8 = v6->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &v3->m_transform;
        p_m_transform = (CSimpleTransform *)&v8->tx;
        if ( !v8 )
          p_m_transform = &v6->m_transform;
        v11.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
        v12 = vmul_f32(v11, v11).n64_u64[0];
        v2.n64_f32[0] = sqrtf(
                          (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                        * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                                + *(float *)&v12)
                        + *((float *)&v12 + 1));
        v1.n64_u64[0] = vmax_f32(v1, v2).n64_u64[0];
      }
    }
  }
  return v1.n64_f32[0];
}
// 4B71EA: variable 'v1' is possibly undefined
// 4B71EA: variable 'v2' is possibly undefined

//----- (004B7200) --------------------------------------------------------
float __fastcall CPedGroup::FindDistanceToNearestMember(CPedGroup *this, CPed **ppNearestPed)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  CPed *v4; // lr
  CPed **m_pMembers; // r12
  int i; // r3
  CPed *v7; // r0
  CMatrix *m_pMat; // r2
  CMatrix *v9; // r4
  CSimpleTransform *p_tx; // r5
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v12; // d16
  float x; // s4
  float32x2_t v14; // d17
  float32x2_t v15; // d16
  unsigned __int64 v16; // d2

  v4 = this->m_membership.m_pMembers[7];
  v2.n64_u32[0] = 1343554297;
  if ( v4 )
  {
    m_pMembers = this->m_membership.m_pMembers;
    for ( i = 0; i != 7; ++i )
    {
      v7 = m_pMembers[i];
      if ( v7 )
      {
        m_pMat = v4->m_pMat;
        v9 = v7->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &v4->m_transform;
        p_m_transform = (CSimpleTransform *)&v9->tx;
        v3.n64_u32[0] = LODWORD(p_tx->m_translate.x);
        if ( !v9 )
          p_m_transform = &v7->m_transform;
        v12.n64_u64[0] = *(unsigned __int64 *)&p_tx->m_translate.y;
        x = p_m_transform->m_translate.x;
        v14.n64_u64[0] = *(unsigned __int64 *)&p_m_transform->m_translate.y;
        if ( ppNearestPed )
          *ppNearestPed = v7;
        v3.n64_f32[0] = x - v3.n64_f32[0];
        v15.n64_u64[0] = vsub_f32(v14, v12).n64_u64[0];
        v16 = vmul_f32(v15, v15).n64_u64[0];
        v3.n64_f32[0] = sqrtf((float)((float)(v3.n64_f32[0] * v3.n64_f32[0]) + *(float *)&v16) + *((float *)&v16 + 1));
        v2.n64_u64[0] = vmin_f32(v2, v3).n64_u64[0];
      }
    }
  }
  return v2.n64_f32[0];
}
// 4B726C: variable 'v2' is possibly undefined
// 4B726C: variable 'v3' is possibly undefined

//----- (004B7280) --------------------------------------------------------
int32 CPedGroups::AddGroup()
{
  bool *v0; // r0
  int v1; // r4
  CPedGroup *v2; // r6

  v0 = CPedGroups::ms_activeGroups;
  if ( !CPedGroups::ms_activeGroups[0] )
  {
    v1 = 0;
LABEL_18:
    v2 = &CPedGroups::ms_groups[(__int16)v1];
    *v0 = 1;
    CPedGroupMembership::Flush(&v2->m_membership);
    CPedGroupIntelligence::Flush(&v2->m_intelligence);
    v2->m_iGroupCreatedBy = 0;
    return v1;
  }
  v0 = &CPedGroups::ms_activeGroups[1];
  if ( !CPedGroups::ms_activeGroups[1] )
  {
    v1 = 1;
    goto LABEL_18;
  }
  v0 = &CPedGroups::ms_activeGroups[2];
  if ( !CPedGroups::ms_activeGroups[2] )
  {
    v1 = 2;
    goto LABEL_18;
  }
  v0 = &CPedGroups::ms_activeGroups[3];
  if ( !CPedGroups::ms_activeGroups[3] )
  {
    v1 = 3;
    goto LABEL_18;
  }
  v0 = &CPedGroups::ms_activeGroups[4];
  if ( !CPedGroups::ms_activeGroups[4] )
  {
    v1 = 4;
    goto LABEL_18;
  }
  v0 = &CPedGroups::ms_activeGroups[5];
  if ( !CPedGroups::ms_activeGroups[5] )
  {
    v1 = 5;
    goto LABEL_18;
  }
  v0 = &CPedGroups::ms_activeGroups[6];
  if ( !CPedGroups::ms_activeGroups[6] )
  {
    v1 = 6;
    goto LABEL_18;
  }
  v0 = &CPedGroups::ms_activeGroups[7];
  if ( !CPedGroups::ms_activeGroups[7] )
  {
    v1 = 7;
    goto LABEL_18;
  }
  return -1;
}
// 677350: using guessed type char (*CPedGroups::ms_activeGroups)[8];

//----- (004B7360) --------------------------------------------------------
void __fastcall CPedGroups::RemoveGroup(const int iGroupID)
{
  CPedGroup *v1; // r4

  if ( CPedGroups::ms_activeGroups[iGroupID] )
  {
    v1 = &CPedGroups::ms_groups[iGroupID];
    CPedGroups::ms_activeGroups[iGroupID] = 0;
    CPedGroupMembership::Flush(&v1->m_membership);
    CPedGroupIntelligence::Flush(&v1->m_intelligence);
    v1->m_iGroupCreatedBy = 0;
  }
}
// 677350: using guessed type char (*CPedGroups::ms_activeGroups)[8];

//----- (004B73B0) --------------------------------------------------------
void __fastcall CPedGroups::RemoveAllFollowersFromGroup(const int iGroupID)
{
  if ( CPedGroups::ms_activeGroups[iGroupID] )
    CPedGroupMembership::RemoveAllFollowers(&CPedGroups::ms_groups[iGroupID].m_membership, 0);
}
// 677350: using guessed type char (*CPedGroups::ms_activeGroups)[8];

//----- (004B73DC) --------------------------------------------------------
void CPedGroups::Init()
{
  if ( CPedGroups::ms_activeGroups[0] )
  {
    CPedGroups::ms_activeGroups[0] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[0].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[0].m_intelligence);
    CPedGroups::ms_groups[0].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[0] = 1;
  if ( CPedGroups::ms_activeGroups[1] )
  {
    CPedGroups::ms_activeGroups[1] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[1].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[1].m_intelligence);
    CPedGroups::ms_groups[1].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[1] = 1;
  if ( CPedGroups::ms_activeGroups[2] )
  {
    CPedGroups::ms_activeGroups[2] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[2].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[2].m_intelligence);
    CPedGroups::ms_groups[2].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[2] = 1;
  if ( CPedGroups::ms_activeGroups[3] )
  {
    CPedGroups::ms_activeGroups[3] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[3].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[3].m_intelligence);
    CPedGroups::ms_groups[3].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[3] = 1;
  if ( CPedGroups::ms_activeGroups[4] )
  {
    CPedGroups::ms_activeGroups[4] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[4].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[4].m_intelligence);
    CPedGroups::ms_groups[4].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[4] = 1;
  if ( CPedGroups::ms_activeGroups[5] )
  {
    CPedGroups::ms_activeGroups[5] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[5].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[5].m_intelligence);
    CPedGroups::ms_groups[5].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[5] = 1;
  if ( CPedGroups::ms_activeGroups[6] )
  {
    CPedGroups::ms_activeGroups[6] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[6].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[6].m_intelligence);
    CPedGroups::ms_groups[6].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[6] = 1;
  if ( CPedGroups::ms_activeGroups[7] )
  {
    CPedGroups::ms_activeGroups[7] = 0;
    CPedGroupMembership::Flush(&CPedGroups::ms_groups[7].m_membership);
    CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[7].m_intelligence);
    CPedGroups::ms_groups[7].m_iGroupCreatedBy = 0;
  }
  CPedGroups::ScriptReferenceIndex[7] = 1;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 677350: using guessed type char (*CPedGroups::ms_activeGroups)[8];
// 677A44: using guessed type __int16 (*CPedGroups::ScriptReferenceIndex)[8];

//----- (004B7630) --------------------------------------------------------
void CPedGroups::Process()
{
  int v0; // r4
  bool *v1; // r6
  int v2; // r8
  int v3; // r0
  int v4; // r0
  _BOOL4 IsPlayerOnAMission; // r0

  v0 = 0;
  v1 = CPedGroups::ms_activeGroups;
  do
  {
    if ( *v1 )
    {
      CPedGroupMembership::Process(&CPedGroups::ms_groups[v0].m_membership);
      CPedGroupIntelligence::Process(&CPedGroups::ms_groups[v0].m_intelligence);
      v2 = (int)CPedGroups::ms_groups[v0].m_membership.m_pMembers[7];
      v3 = CPedGroups::ms_groups[v0].m_membership.m_pMembers[0] != 0;
      if ( CPedGroups::ms_groups[v0].m_membership.m_pMembers[1] )
        ++v3;
      if ( CPedGroups::ms_groups[v0].m_membership.m_pMembers[2] )
        ++v3;
      if ( CPedGroups::ms_groups[v0].m_membership.m_pMembers[3] )
        ++v3;
      if ( CPedGroups::ms_groups[v0].m_membership.m_pMembers[4] )
        ++v3;
      if ( CPedGroups::ms_groups[v0].m_membership.m_pMembers[5] )
        ++v3;
      if ( CPedGroups::ms_groups[v0].m_membership.m_pMembers[6] )
        ++v3;
      if ( v2 )
        v2 = -1;
      if ( v3 == v2 && *v1 )
      {
        *v1 = 0;
        CPedGroupMembership::Flush(&CPedGroups::ms_groups[v0].m_membership);
        CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[v0].m_intelligence);
        CPedGroups::ms_groups[v0].m_iGroupCreatedBy = 0;
      }
    }
    ++v0;
    ++v1;
  }
  while ( v0 != 8 );
  if ( CTheScripts::IsPlayerOnAMission() && !CPedGroups::ms_bIsPlayerOnAMission )
  {
    CPedGroups::ms_iNoOfPlayerKills = 0;
LABEL_24:
    v4 = 9;
    goto LABEL_31;
  }
  if ( CTheScripts::IsPlayerOnAMission() || !CPedGroups::ms_bIsPlayerOnAMission )
  {
    if ( !CTheScripts::IsPlayerOnAMission() || CPedGroups::ms_iNoOfPlayerKills != 8 )
    {
      if ( !CTheScripts::IsPlayerOnAMission() )
        goto LABEL_55;
      goto LABEL_24;
    }
  }
  else
  {
    CPedGroups::ms_iNoOfPlayerKills = 0;
  }
  v4 = -1;
LABEL_31:
  if ( CPedGroups::ms_activeGroups[0] && !CPedGroups::ms_groups[0].m_iGroupCreatedBy )
    CPedGroups::ms_groups[0].m_intelligence.m_iDecisionMaker = v4;
  if ( CPedGroups::ms_activeGroups[1] && !CPedGroups::ms_groups[1].m_iGroupCreatedBy )
    CPedGroups::ms_groups[1].m_intelligence.m_iDecisionMaker = v4;
  if ( CPedGroups::ms_activeGroups[2] && !CPedGroups::ms_groups[2].m_iGroupCreatedBy )
    CPedGroups::ms_groups[2].m_intelligence.m_iDecisionMaker = v4;
  if ( CPedGroups::ms_activeGroups[3] && !CPedGroups::ms_groups[3].m_iGroupCreatedBy )
    CPedGroups::ms_groups[3].m_intelligence.m_iDecisionMaker = v4;
  if ( CPedGroups::ms_activeGroups[4] && !CPedGroups::ms_groups[4].m_iGroupCreatedBy )
    CPedGroups::ms_groups[4].m_intelligence.m_iDecisionMaker = v4;
  if ( CPedGroups::ms_activeGroups[5] && !CPedGroups::ms_groups[5].m_iGroupCreatedBy )
    CPedGroups::ms_groups[5].m_intelligence.m_iDecisionMaker = v4;
  if ( CPedGroups::ms_activeGroups[6] && !CPedGroups::ms_groups[6].m_iGroupCreatedBy )
    CPedGroups::ms_groups[6].m_intelligence.m_iDecisionMaker = v4;
  if ( CPedGroups::ms_activeGroups[7] && !CPedGroups::ms_groups[7].m_iGroupCreatedBy )
    CPedGroups::ms_groups[7].m_intelligence.m_iDecisionMaker = v4;
LABEL_55:
  IsPlayerOnAMission = CTheScripts::IsPlayerOnAMission();
  CPedGroups::ms_bIsPlayerOnAMission = IsPlayerOnAMission;
  if ( !IsPlayerOnAMission )
    CPedGroups::ms_iNoOfPlayerKills = 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004B78FC) --------------------------------------------------------
void CPedGroups::RegisterKillByPlayer()
{
  if ( CPedGroups::ms_bIsPlayerOnAMission )
    ++CPedGroups::ms_iNoOfPlayerKills;
}

//----- (004B7920) --------------------------------------------------------
void CPedGroups::CleanUpForShutDown()
{
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[0].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[0].m_intelligence);
  CPedGroups::ms_groups[0].m_iGroupCreatedBy = 0;
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[1].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[1].m_intelligence);
  CPedGroups::ms_groups[1].m_iGroupCreatedBy = 0;
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[2].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[2].m_intelligence);
  CPedGroups::ms_groups[2].m_iGroupCreatedBy = 0;
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[3].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[3].m_intelligence);
  CPedGroups::ms_groups[3].m_iGroupCreatedBy = 0;
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[4].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[4].m_intelligence);
  CPedGroups::ms_groups[4].m_iGroupCreatedBy = 0;
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[5].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[5].m_intelligence);
  CPedGroups::ms_groups[5].m_iGroupCreatedBy = 0;
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[6].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[6].m_intelligence);
  CPedGroups::ms_groups[6].m_iGroupCreatedBy = 0;
  CPedGroupMembership::Flush(&CPedGroups::ms_groups[7].m_membership);
  CPedGroupIntelligence::Flush(&CPedGroups::ms_groups[7].m_intelligence);
  CPedGroups::ms_groups[7].m_iGroupCreatedBy = 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004B79E0) --------------------------------------------------------
bool __fastcall CPedGroups::IsGroupLeader(CPed *pPed)
{
  return CPedGroups::ms_groups[0].m_membership.m_pMembers[7] == pPed && pPed && CPedGroups::ms_activeGroups[0]
      || CPedGroups::ms_groups[1].m_membership.m_pMembers[7] == pPed && pPed && CPedGroups::ms_activeGroups[1]
      || CPedGroups::ms_groups[2].m_membership.m_pMembers[7] == pPed && pPed && CPedGroups::ms_activeGroups[2]
      || CPedGroups::ms_groups[3].m_membership.m_pMembers[7] == pPed && pPed && CPedGroups::ms_activeGroups[3]
      || CPedGroups::ms_groups[4].m_membership.m_pMembers[7] == pPed && pPed && CPedGroups::ms_activeGroups[4]
      || CPedGroups::ms_groups[5].m_membership.m_pMembers[7] == pPed && pPed && CPedGroups::ms_activeGroups[5]
      || CPedGroups::ms_groups[6].m_membership.m_pMembers[7] == pPed && pPed && CPedGroups::ms_activeGroups[6]
      || pPed != 0 && CPedGroups::ms_activeGroups[7] && CPedGroups::ms_groups[7].m_membership.m_pMembers[7] == pPed;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004B7B0C) --------------------------------------------------------
bool __fastcall CPedGroups::IsInPlayersGroup(const CPed *pPed)
{
  return !pPed->m_pPlayerData
      && (CPedGroups::ms_groups[0].m_membership.m_pMembers[0] == pPed
       || CPedGroups::ms_groups[0].m_membership.m_pMembers[1] == pPed
       || CPedGroups::ms_groups[0].m_membership.m_pMembers[2] == pPed
       || CPedGroups::ms_groups[0].m_membership.m_pMembers[3] == pPed
       || CPedGroups::ms_groups[0].m_membership.m_pMembers[4] == pPed
       || CPedGroups::ms_groups[0].m_membership.m_pMembers[5] == pPed
       || CPedGroups::ms_groups[0].m_membership.m_pMembers[6] == pPed
       || CPedGroups::ms_groups[0].m_membership.m_pMembers[7] == pPed);
}

//----- (004B7BB0) --------------------------------------------------------
bool __fastcall CPedGroups::AreInSameGroup(const CPed *pPed1, const CPed *pPed2)
{
  bool v2; // zf
  int v3; // r3
  CPed **i; // r2
  int v5; // r4
  const CPed *v6; // lr
  const CPed *v7; // r3
  bool v8; // zf
  const CPed *v9; // r3
  bool v10; // zf
  const CPed *v11; // r3
  bool v12; // zf
  bool v13; // zf
  bool v14; // zf
  const CPed *v15; // r3
  bool v16; // zf
  const CPed *v17; // r3
  bool v18; // zf

  v2 = pPed1 == 0;
  if ( pPed1 )
    v2 = pPed2 == 0;
  if ( v2 )
    return 0;
  v3 = 0;
  for ( i = &CPedGroups::ms_groups[0].m_membership.m_pMembers[2]; ; i += 181 )
  {
    v5 = v3;
    if ( CPedGroups::ms_activeGroups[v3] )
    {
      v6 = *(i - 2);
      if ( v6 == pPed1 )
        goto LABEL_28;
      v7 = *(i - 1);
      v8 = v7 == pPed1;
      if ( v7 != pPed1 )
        v8 = *i == pPed1;
      if ( v8 )
        goto LABEL_28;
      v9 = i[1];
      v10 = v9 == pPed1;
      if ( v9 != pPed1 )
        v10 = i[2] == pPed1;
      if ( v10 )
        goto LABEL_28;
      v11 = i[3];
      v12 = v11 == pPed1;
      if ( v11 != pPed1 )
        v12 = i[4] == pPed1;
      if ( v12 || i[5] == pPed1 )
      {
LABEL_28:
        v13 = v6 == pPed2;
        if ( v6 != pPed2 )
          v13 = *(i - 1) == pPed2;
        if ( v13 )
          break;
        v14 = *i == pPed2;
        if ( *i != pPed2 )
          v14 = i[1] == pPed2;
        if ( v14 )
          break;
        v15 = i[2];
        v16 = v15 == pPed2;
        if ( v15 != pPed2 )
          v16 = i[3] == pPed2;
        if ( v16 )
          break;
        v17 = i[4];
        v18 = v17 == pPed2;
        if ( v17 != pPed2 )
          v18 = i[5] == pPed2;
        if ( v18 )
          break;
      }
    }
    v3 = v5 + 1;
    if ( v5 >= 7 )
      return 0;
  }
  return 1;
}

//----- (004B7C5C) --------------------------------------------------------
bool __fastcall CPedGroupPlacer::PlaceGroup(
        const CPedGroupPlacer *this,
        const ePedType eGroupType,
        const int iGroupSize,
        const CVector *vLeaderPos,
        unsigned int a5)
{
  const CPedGroupPlacer *v5; // r0
  int v7; // [sp+0h] [bp-10h]

  if ( a5 < 2 )
    return CPedGroupPlacer::PlaceFormationGroup(this, eGroupType, iGroupSize, vLeaderPos, v7);
  v5 = (const CPedGroupPlacer *)(a5 - 2);
  if ( a5 - 2 < 2 )
    return CPedGroupPlacer::PlaceChatGroup(v5, eGroupType, iGroupSize, vLeaderPos, v7);
  if ( a5 == 5 )
    return CPedGroupPlacer::PlaceRandomGroup(v5, eGroupType, iGroupSize, vLeaderPos, v7);
  return 0;
}
// 4B7C74: variable 'v7' is possibly undefined

//----- (004B7C98) --------------------------------------------------------
bool __fastcall CPedGroupPlacer::PlaceFormationGroup(
        const CPedGroupPlacer *this,
        const ePedType eGroupType,
        const int iGroupSize,
        const CVector *vLeaderPos,
        const int iDefaultTaskAllocatorType)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d9
  float32x2_t v7; // d13
  bool *v10; // r0
  int v11; // r10
  CPedGroup *v12; // r5
  CPedGroupMembership *p_m_membership; // r8
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  float32x2_t *p_tx; // r2
  float32x2_t v17; // d16
  bool v18; // r6
  float GroundZFor3DCoord; // r5
  int v20; // r9
  ePedType v21; // r4
  int32 v22; // r1
  RwReal v23; // s18
  CPed *v24; // r0
  int v25; // r6
  CVector2D *v26; // r5
  int v27; // r9
  _DWORD *p_z; // r0
  int32 v29; // r1
  CPed *v30; // r9
  float *p_x; // r1
  CMatrix *v32; // r0
  float v33; // s4
  float v34; // s0
  CMatrix *v35; // r0
  float v36; // s2
  float *p_tz; // r0
  CMatrix *v38; // r0
  CSimpleTransform *v39; // r1
  RwReal x; // s24
  float y; // s22
  float v42; // r0
  float v43; // s0
  const CVector *v44; // r0
  const CVector *p_m_translate; // r1
  CMatrix *v46; // r0
  CPedGroup *v47; // r4
  const CPedGroupDefaultTaskAllocator *m_pDefaultTaskAllocator; // r0
  RwReal v49; // r4
  int v50; // r5
  CTaskComplexBeInGroup *v51; // r4
  int v52; // r5
  RwReal *p_y; // r6
  CPed *v54; // t1
  CPedIntelligence *m_pPedIntelligence; // r9
  CTaskComplexBeInGroup *v56; // r4
  int v58; // [sp+18h] [bp-A0h]
  CPed *v59; // [sp+20h] [bp-98h]
  CSimpleTransform *p_m_transform; // [sp+24h] [bp-94h]
  CPedGroupIntelligence *p_m_intelligence; // [sp+28h] [bp-90h]
  bool v63; // [sp+37h] [bp-81h] BYREF
  CVector vecStart; // [sp+38h] [bp-80h] BYREF
  CVector vecPosition; // [sp+44h] [bp-74h] BYREF
  bool pBool; // [sp+67h] [bp-51h] BYREF

  v10 = CPedGroups::ms_activeGroups;
  if ( CPedGroups::ms_activeGroups[0] )
  {
    v10 = &CPedGroups::ms_activeGroups[1];
    if ( CPedGroups::ms_activeGroups[1] )
    {
      v10 = &CPedGroups::ms_activeGroups[2];
      if ( CPedGroups::ms_activeGroups[2] )
      {
        v10 = &CPedGroups::ms_activeGroups[3];
        if ( CPedGroups::ms_activeGroups[3] )
        {
          v10 = &CPedGroups::ms_activeGroups[4];
          if ( CPedGroups::ms_activeGroups[4] )
          {
            v10 = &CPedGroups::ms_activeGroups[5];
            if ( CPedGroups::ms_activeGroups[5] )
            {
              v10 = &CPedGroups::ms_activeGroups[6];
              if ( CPedGroups::ms_activeGroups[6] )
              {
                v10 = &CPedGroups::ms_activeGroups[7];
                if ( CPedGroups::ms_activeGroups[7] )
                  return 0;
                v11 = 7;
              }
              else
              {
                v11 = 6;
              }
            }
            else
            {
              v11 = 5;
            }
          }
          else
          {
            v11 = 4;
          }
        }
        else
        {
          v11 = 3;
        }
      }
      else
      {
        v11 = 2;
      }
    }
    else
    {
      v11 = 1;
    }
  }
  else
  {
    v11 = 0;
  }
  *v10 = 1;
  v12 = &CPedGroups::ms_groups[(__int16)v11];
  p_m_membership = &v12->m_membership;
  CPedGroupMembership::Flush(&v12->m_membership);
  p_m_intelligence = &v12->m_intelligence;
  CPedGroupIntelligence::Flush(&v12->m_intelligence);
  v12->m_iGroupCreatedBy = 0;
  if ( CCamera::IsSphereVisible(&TheCamera, vLeaderPos, 3.0) )
  {
    PlayerPed = FindPlayerPed(-1);
    m_pMat = PlayerPed->m_pMat;
    p_tx = (float32x2_t *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (float32x2_t *)&PlayerPed->m_transform;
    v17.n64_u64[0] = vsub_f32(*(float32x2_t *)&vLeaderPos->x, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
    v5.n64_u64[0] = vmul_f32(v17, v17).n64_u64[0];
    if ( sqrtf(v5.n64_f32[0] + v5.n64_f32[1]) < (float)(CPopulation::PedCreationDistMultiplier() * 42.5) )
      return 0;
  }
  v18 = 0;
  if ( CPedPlacement::IsPositionClearForPed(vLeaderPos, 3.0, -1, 0, 1, 1, 1) != 1 )
    return v18;
  GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(vLeaderPos->x, vLeaderPos->y, vLeaderPos->z + 1.0, &pBool, 0);
  if ( !pBool )
    return v18;
  v20 = iGroupSize;
  v21 = eGroupType;
  v6.n64_u32[0] = LODWORD(vLeaderPos->z);
  v22 = CPopulation::ChooseGangOccupation(eGroupType - 7);
  if ( !CModelInfo::ms_modelInfoPtrs[v22]->m_pRwObject )
    return 0;
  *(_QWORD *)&vecPosition.x = *(_QWORD *)&vLeaderPos->x;
  v5.n64_f32[0] = GroundZFor3DCoord + 1.0;
  v18 = 0;
  LODWORD(v23) = vmax_f32(v6, v5).n64_u32[0];
  vecPosition.z = v23;
  v24 = CPopulation::AddPed(eGroupType, v22, &vecPosition, 0);
  if ( !v24 )
    return v18;
  LODWORD(vecPosition.x) = v24;
  if ( v20 >= 2 )
  {
    v25 = v20 - 1;
    v59 = v24;
    p_m_transform = &v24->m_transform;
    v58 = 1;
    v26 = &CTaskComplexFollowLeaderInFormation::ms_offsets.m_offsets[1];
    do
    {
      v29 = CPopulation::ChooseGangOccupation(eGroupType - 7);
      if ( CModelInfo::ms_modelInfoPtrs[v29]->m_pRwObject )
      {
        *(_QWORD *)&vecStart.x = *(_QWORD *)&vLeaderPos->x;
        vecStart.z = v23;
        v30 = CPopulation::AddPed(v21, v29, &vecStart, 0);
        if ( v30 )
        {
          p_x = &p_m_transform->m_translate.x;
          v32 = v59->m_pMat;
          if ( v32 )
            p_x = &v32->tx;
          v33 = v26->x + *p_x;
          v34 = p_x[2] + 0.0;
          v35 = v30->m_pMat;
          v36 = v26->y + p_x[1];
          if ( v35 )
          {
            v35->tx = v33;
            v30->m_pMat->ty = v36;
            p_tz = &v30->m_pMat->tz;
          }
          else
          {
            p_tz = &v30->m_transform.m_translate.z;
            v30->m_transform.m_translate.x = v33;
            v30->m_transform.m_translate.y = v36;
          }
          *p_tz = v34;
          v38 = v30->m_pMat;
          v39 = (CSimpleTransform *)&v38->tx;
          if ( !v38 )
            v39 = &v30->m_transform;
          v7.n64_u32[0] = LODWORD(v39->m_translate.z);
          x = v39->m_translate.x;
          y = v39->m_translate.y;
          v42 = CWorld::FindGroundZFor3DCoord(v39->m_translate.x, y, v7.n64_f32[0] + 1.0, &v63, 0);
          if ( !v63 )
            goto LABEL_46;
          v43 = v42;
          v44 = (const CVector *)v59->m_pMat;
          p_m_translate = &p_m_transform->m_translate;
          v5.n64_f32[0] = v43 + 1.0;
          if ( v44 )
            p_m_translate = v44 + 4;
          v7.n64_u64[0] = vmax_f32(v7, v5).n64_u64[0];
          if ( fabsf(v7.n64_f32[0] - p_m_translate->z) <= 1.0
            && (vecStart.y = y,
                vecStart.x = x,
                LODWORD(vecStart.z) = v7.n64_u32[0],
                CWorld::GetIsLineOfSightClear(&vecStart, p_m_translate, 1, 0, 0, 0, 0, 0, 0)) )
          {
            v46 = v30->m_pMat;
            if ( v46 )
            {
              v46->tx = x;
              v30->m_pMat->ty = y;
              p_z = (_DWORD *)&v30->m_pMat->tz;
            }
            else
            {
              p_z = (_DWORD *)&v30->m_transform.m_translate.z;
              v30->m_transform.m_translate.x = x;
              v30->m_transform.m_translate.y = y;
            }
            *p_z = v7.n64_u32[0];
            *((_DWORD *)&vecPosition.x + v58) = v30;
            CVisibilityPlugins::SetClumpAlpha((RpClump_0 *)v30->m_pRwObject, 0);
            ++v58;
          }
          else
          {
LABEL_46:
            CPopulation::RemovePed(v30);
          }
        }
        v21 = eGroupType;
      }
      ++v26;
      --v25;
    }
    while ( v25 );
    v27 = v58;
    if ( v58 >= 1 )
      goto LABEL_50;
    return 0;
  }
  v27 = 1;
LABEL_50:
  v47 = &CPedGroups::ms_groups[(__int16)v11];
  v47->m_intelligence.m_pDefaultTaskAllocator = &CPedGroupDefaultTaskAllocators::ms_followAnyMeansAllocator;
  CPedGroupIntelligence::FlushTasks(
    (CPedGroupIntelligence *)&CPedGroupDefaultTaskAllocators::ms_followAnyMeansAllocator,
    v47->m_intelligence.m_defaultPedTaskPairs,
    0);
  m_pDefaultTaskAllocator = v47->m_intelligence.m_pDefaultTaskAllocator;
  if ( m_pDefaultTaskAllocator )
    ((void (__fastcall *)(const CPedGroupDefaultTaskAllocator *, CPedGroup *, _DWORD))*m_pDefaultTaskAllocator->_vptr$CPedGroupDefaultTaskAllocator)(
      m_pDefaultTaskAllocator,
      p_m_intelligence->m_pPedGroup,
      0);
  v49 = vecPosition.x;
  CPedGroupMembership::SetLeader(p_m_membership, (CPed *)LODWORD(vecPosition.x));
  CPedGroupMembership::Process(p_m_membership);
  CPedGroupIntelligence::Process(p_m_intelligence);
  v50 = *(_DWORD *)(LODWORD(v49) + 1088);
  v51 = (CTaskComplexBeInGroup *)CTask::operator new(0x28u);
  v18 = 1;
  CTaskComplexBeInGroup::CTaskComplexBeInGroup(v51, v11, 1);
  CTaskManager::SetTask((CTaskManager *)(v50 + 4), v51, 3, 0);
  if ( v27 >= 2 )
  {
    v52 = v27 - 1;
    p_y = &vecPosition.y;
    do
    {
      v54 = *(CPed **)p_y++;
      CPedGroupMembership::AddFollower(p_m_membership, v54);
      CPedGroupMembership::Process(p_m_membership);
      CPedGroupIntelligence::Process(p_m_intelligence);
      m_pPedIntelligence = v54->m_pPedIntelligence;
      v56 = (CTaskComplexBeInGroup *)CTask::operator new(0x28u);
      CTaskComplexBeInGroup::CTaskComplexBeInGroup(v56, v11, 0);
      CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, v56, 3, 0);
      --v52;
    }
    while ( v52 );
    return 1;
  }
  return v18;
}
// 4B7E68: variable 'v6' is possibly undefined
// 4B7E68: variable 'v5' is possibly undefined
// 4B7FB6: variable 'v7' is possibly undefined

//----- (004B8148) --------------------------------------------------------
bool __fastcall CPedGroupPlacer::PlaceChatGroup(
        const CPedGroupPlacer *this,
        const ePedType eGroupType,
        const int iGroupSize,
        const CVector *vCentrePos,
        const int iDefaultTaskAllocatorType)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d3
  bool v8; // r11
  bool *v9; // r0
  int v10; // r3
  CPedGroup *v11; // r5
  float v12; // r0
  float v13; // s20
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  float32x2_t *p_tx; // r2
  float32x2_t v17; // d16
  int v18; // r8
  int v19; // r9
  float v20; // r6
  float v21; // r5
  float v22; // r6
  float v23; // s0
  float v24; // s17
  float v25; // s19
  float GroundZFor3DCoord; // r0
  RwReal v27; // s4
  RwReal v28; // s2
  int32 v29; // r5
  CBaseModelInfo *v30; // r0
  int v31; // r1
  int v32; // r1
  int v33; // r1
  int v34; // r1
  int v35; // r1
  int v36; // r6
  int v37; // r1
  int v38; // r1
  int v39; // r1
  _BOOL4 IsLineOfSightClear; // r0
  _BOOL4 v41; // r1
  int v42; // r1
  CPed *v43; // r0
  CPed *v44; // r6
  float RadianAngleBetweenPoints; // r0
  RpClump_0 *m_pRwObject; // r1
  CPedGroup *v47; // r4
  const CPedGroupDefaultTaskAllocator *m_pDefaultTaskAllocator; // r0
  CPed *v49; // r4
  CPedIntelligence *m_pPedIntelligence; // r5
  CTaskComplexBeInGroup *v51; // r4
  CPed **v52; // r6
  int v53; // r5
  CPed *v54; // t1
  CPedIntelligence *v55; // r8
  CTaskComplexBeInGroup *v56; // r4
  CPedGroupMembership *p_m_membership; // [sp+14h] [bp-E4h]
  CPedGroupIntelligence *p_m_intelligence; // [sp+18h] [bp-E0h]
  int v60; // [sp+1Ch] [bp-DCh]
  __int64 pKindaCollidingObjects; // [sp+30h] [bp-C8h] BYREF
  __int64 v64; // [sp+38h] [bp-C0h]
  __int64 v65; // [sp+40h] [bp-B8h]
  __int64 v66; // [sp+48h] [bp-B0h]
  CPed *v67; // [sp+50h] [bp-A8h]
  CVector vPos; // [sp+58h] [bp-A0h] BYREF
  bool pBool; // [sp+67h] [bp-91h] BYREF
  CVector vecEnd; // [sp+68h] [bp-90h] BYREF
  CPed *pLeader; // [sp+78h] [bp-80h]
  int v72; // [sp+7Ch] [bp-7Ch] BYREF

  if ( iGroupSize < 2 )
    return 0;
  v9 = CPedGroups::ms_activeGroups;
  if ( CPedGroups::ms_activeGroups[0] )
  {
    v9 = &CPedGroups::ms_activeGroups[1];
    if ( CPedGroups::ms_activeGroups[1] )
    {
      v9 = &CPedGroups::ms_activeGroups[2];
      if ( CPedGroups::ms_activeGroups[2] )
      {
        v9 = &CPedGroups::ms_activeGroups[3];
        if ( CPedGroups::ms_activeGroups[3] )
        {
          v9 = &CPedGroups::ms_activeGroups[4];
          if ( CPedGroups::ms_activeGroups[4] )
          {
            v9 = &CPedGroups::ms_activeGroups[5];
            if ( CPedGroups::ms_activeGroups[5] )
            {
              v9 = &CPedGroups::ms_activeGroups[6];
              if ( CPedGroups::ms_activeGroups[6] )
              {
                v9 = &CPedGroups::ms_activeGroups[7];
                if ( CPedGroups::ms_activeGroups[7] )
                  return 0;
                v10 = 7;
              }
              else
              {
                v10 = 6;
              }
            }
            else
            {
              v10 = 5;
            }
          }
          else
          {
            v10 = 4;
          }
        }
        else
        {
          v10 = 3;
        }
      }
      else
      {
        v10 = 2;
      }
    }
    else
    {
      v10 = 1;
    }
  }
  else
  {
    v10 = 0;
  }
  v60 = v10;
  *v9 = 1;
  v11 = &CPedGroups::ms_groups[(__int16)v10];
  CPedGroupMembership::Flush(&v11->m_membership);
  CPedGroupIntelligence::Flush(&v11->m_intelligence);
  v12 = cosf(6.2832 / (float)iGroupSize);
  v11->m_iGroupCreatedBy = 0;
  v13 = sqrtf(0.5 / (float)(1.0 - v12));
  if ( CCamera::IsSphereVisible(&TheCamera, vCentrePos, v13) )
  {
    PlayerPed = FindPlayerPed(-1);
    m_pMat = PlayerPed->m_pMat;
    p_tx = (float32x2_t *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (float32x2_t *)&PlayerPed->m_transform;
    v17.n64_u64[0] = vsub_f32(*(float32x2_t *)&vCentrePos->x, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
    v5.n64_u64[0] = vmul_f32(v17, v17).n64_u64[0];
    if ( sqrtf(v5.n64_f32[0] + v5.n64_f32[1]) < (float)(CPopulation::PedCreationDistMultiplier() * 42.5) )
      return 0;
  }
  p_m_intelligence = &v11->m_intelligence;
  v8 = 0;
  if ( CPedPlacement::IsPositionClearForPed(vCentrePos, v13, -1, 0, 1, 1, 1) != 1 )
    return v8;
  p_m_membership = &v11->m_membership;
  v18 = 0;
  v19 = 0;
  do
  {
    v20 = (float)((float)(6.2832 / (float)iGroupSize) * (float)v19)
        + (float)((float)(6.2832 / (float)iGroupSize)
                * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2));
    v21 = cosf(v20);
    v22 = sinf(v20);
    v23 = v13 + (float)(v13 * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2));
    v24 = v21 * v23;
    v25 = v22 * v23;
    GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(
                          vCentrePos->x + (float)(v21 * v23),
                          vCentrePos->y + (float)(v22 * v23),
                          vCentrePos->z + 1.0,
                          &pBool,
                          0);
    if ( pBool )
    {
      v5.n64_f32[0] = GroundZFor3DCoord + 1.0;
      v6.n64_u32[0] = LODWORD(vCentrePos->z);
      v27 = v25 + vCentrePos->y;
      v28 = v24 + vCentrePos->x;
      v5.n64_u64[0] = vmax_f32(v6, v5).n64_u64[0];
      LODWORD(vPos.z) = v5.n64_u32[0];
      vPos.y = v27;
      vPos.x = v28;
      if ( !v19 )
        vecEnd = vPos;
      v29 = CPopulation::ChooseGangOccupation(eGroupType - 7);
      v30 = CModelInfo::ms_modelInfoPtrs[v29];
      if ( v30->m_pRwObject )
      {
        pKindaCollidingObjects = 0LL;
        v64 = 0LL;
        v65 = 0LL;
        v66 = 0LL;
        v67 = 0;
        CPedPlacement::IsPositionClearForPed(
          &vPos,
          v30->m_pColModel->m_sphereBound.m_fRadius,
          9,
          (CEntity **)&pKindaCollidingObjects,
          1,
          1,
          1);
        if ( (_DWORD)pKindaCollidingObjects )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v31 = 0;
          while ( (CPed *)pKindaCollidingObjects != *(&pLeader + v31) )
          {
            if ( ++v31 >= v18 )
              goto LABEL_77;
          }
        }
        if ( HIDWORD(pKindaCollidingObjects) )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v32 = 0;
          while ( (CPed *)HIDWORD(pKindaCollidingObjects) != *(&pLeader + v32) )
          {
            if ( ++v32 >= v18 )
              goto LABEL_77;
          }
        }
        if ( (_DWORD)v64 )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v33 = 0;
          while ( (CPed *)v64 != *(&pLeader + v33) )
          {
            if ( ++v33 >= v18 )
              goto LABEL_77;
          }
        }
        if ( HIDWORD(v64) )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v34 = 0;
          while ( (CPed *)HIDWORD(v64) != *(&pLeader + v34) )
          {
            if ( ++v34 >= v18 )
              goto LABEL_77;
          }
        }
        if ( (_DWORD)v65 )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v35 = 0;
          while ( (CPed *)v65 != *(&pLeader + v35) )
          {
            ++v35;
            v36 = 1;
            if ( v35 >= v18 )
              goto LABEL_78;
          }
        }
        if ( HIDWORD(v65) )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v37 = 0;
          while ( (CPed *)HIDWORD(v65) != *(&pLeader + v37) )
          {
            ++v37;
            v36 = 1;
            if ( v37 >= v18 )
              goto LABEL_78;
          }
        }
        if ( (_DWORD)v66 )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v38 = 0;
          while ( (CPed *)v66 != *(&pLeader + v38) )
          {
            ++v38;
            v36 = 1;
            if ( v38 >= v18 )
              goto LABEL_78;
          }
        }
        if ( !HIDWORD(v66) )
          goto LABEL_80;
        if ( v18 >= 1 )
        {
          v39 = 0;
          while ( (CPed *)HIDWORD(v66) != *(&pLeader + v39) )
          {
            ++v39;
            v36 = 1;
            if ( v39 >= v18 )
              goto LABEL_78;
          }
LABEL_80:
          v36 = (int)v67;
          if ( v67 )
          {
            v36 = 1;
            if ( v18 >= 1 )
            {
              v42 = 0;
              while ( v67 != *(&pLeader + v42) )
              {
                ++v42;
                v36 = 1;
                if ( v42 >= v18 )
                  goto LABEL_78;
              }
              v36 = 0;
              if ( !v19 )
                goto LABEL_89;
              goto LABEL_79;
            }
          }
LABEL_78:
          if ( !v19 )
          {
LABEL_89:
            IsLineOfSightClear = 1;
            v41 = 1;
            goto LABEL_90;
          }
LABEL_79:
          IsLineOfSightClear = CWorld::GetIsLineOfSightClear(&vPos, &vecEnd, 1, 0, 0, 0, 0, 0, 0);
          v41 = fabsf(vPos.z - vecEnd.z) < 1.0;
LABEL_90:
          if ( !(!IsLineOfSightClear | v36) && v41 )
          {
            v43 = CPopulation::AddPed(eGroupType, v29, &vPos, 0);
            v44 = v43;
            if ( v43 )
            {
              *(&pLeader + v18) = v43;
              RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(
                                           vCentrePos->x,
                                           vCentrePos->y,
                                           vPos.x,
                                           vPos.y);
              m_pRwObject = (RpClump_0 *)v44->m_pRwObject;
              v44->m_fCurrentHeading = RadianAngleBetweenPoints;
              v44->m_fDesiredHeading = RadianAngleBetweenPoints;
              CVisibilityPlugins::SetClumpAlpha(m_pRwObject, 0);
              ++v18;
            }
            else
            {
              CPopulation::RemovePed(0);
            }
          }
          goto LABEL_95;
        }
LABEL_77:
        v36 = 1;
        goto LABEL_78;
      }
    }
LABEL_95:
    ++v19;
  }
  while ( v19 != iGroupSize );
  if ( v18 < 1 )
    return 0;
  v47 = &CPedGroups::ms_groups[(__int16)v60];
  v47->m_intelligence.m_pDefaultTaskAllocator = &CPedGroupDefaultTaskAllocators::ms_standStillAllocator;
  CPedGroupIntelligence::FlushTasks(
    (CPedGroupIntelligence *)&CPedGroupDefaultTaskAllocators::ms_standStillAllocator,
    v47->m_intelligence.m_defaultPedTaskPairs,
    0);
  m_pDefaultTaskAllocator = v47->m_intelligence.m_pDefaultTaskAllocator;
  if ( m_pDefaultTaskAllocator )
    ((void (__fastcall *)(const CPedGroupDefaultTaskAllocator *, CPedGroup *, _DWORD))*m_pDefaultTaskAllocator->_vptr$CPedGroupDefaultTaskAllocator)(
      m_pDefaultTaskAllocator,
      p_m_intelligence->m_pPedGroup,
      0);
  v49 = pLeader;
  CPedGroupMembership::SetLeader(p_m_membership, pLeader);
  CPedGroupMembership::Process(p_m_membership);
  CPedGroupIntelligence::Process(p_m_intelligence);
  m_pPedIntelligence = v49->m_pPedIntelligence;
  v51 = (CTaskComplexBeInGroup *)CTask::operator new(0x28u);
  v8 = 1;
  CTaskComplexBeInGroup::CTaskComplexBeInGroup(v51, v60, 1);
  CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, v51, 3, 0);
  if ( v18 >= 2 )
  {
    v52 = (CPed **)&v72;
    v53 = v18 - 1;
    do
    {
      v54 = *v52++;
      CPedGroupMembership::AddFollower(p_m_membership, v54);
      CPedGroupMembership::Process(p_m_membership);
      CPedGroupIntelligence::Process(p_m_intelligence);
      v55 = v54->m_pPedIntelligence;
      v56 = (CTaskComplexBeInGroup *)CTask::operator new(0x28u);
      CTaskComplexBeInGroup::CTaskComplexBeInGroup(v56, v60, 0);
      CTaskManager::SetTask(&v55->m_taskManager, v56, 3, 0);
      --v53;
    }
    while ( v53 );
    return 1;
  }
  return v8;
}
// 4B83DE: variable 'v6' is possibly undefined
// 4B83DE: variable 'v5' is possibly undefined

//----- (004B870C) --------------------------------------------------------
bool __fastcall CPedGroupPlacer::PlaceRandomGroup(
        const CPedGroupPlacer *this,
        const ePedType eGroupType,
        const int iGroupSize,
        const CVector *vCentrePos,
        const int iDefaultTaskAllocatorType)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d3
  bool v8; // r11
  bool *v9; // r0
  int v10; // r3
  CPedGroup *v11; // r4
  float v12; // r0
  float v13; // s20
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  float32x2_t *p_tx; // r2
  float32x2_t v17; // d16
  int v18; // r9
  int v19; // r8
  float v20; // r6
  float v21; // r4
  float v22; // r6
  float v23; // s0
  float v24; // s17
  float v25; // s19
  float GroundZFor3DCoord; // r0
  RwReal v27; // s4
  RwReal v28; // s2
  int32 v29; // r4
  CBaseModelInfo *v30; // r0
  int v31; // r1
  int v32; // r1
  int v33; // r1
  int v34; // r1
  int v35; // r1
  int v36; // r6
  int v37; // r1
  int v38; // r1
  int v39; // r1
  _BOOL4 IsLineOfSightClear; // r0
  _BOOL4 v41; // r1
  int v42; // r1
  CPed *v43; // r0
  CPed *v44; // r6
  float RadianAngleBetweenPoints; // r0
  RpClump_0 *m_pRwObject; // r1
  CPedGroup *v47; // r4
  const CPedGroupDefaultTaskAllocator *m_pDefaultTaskAllocator; // r0
  int v49; // r5
  CPed *v50; // r4
  CPedIntelligence *m_pPedIntelligence; // r8
  CTaskComplexWanderGang *v52; // r6
  unsigned __int16 v53; // r0
  CPedIntelligence *v54; // r6
  CTaskComplexBeInGroup *v55; // r4
  int v57; // [sp+14h] [bp-E4h]
  CPedGroupMembership *p_m_membership; // [sp+28h] [bp-D0h]
  CPedGroupIntelligence *p_m_intelligence; // [sp+2Ch] [bp-CCh]
  __int64 pKindaCollidingObjects; // [sp+30h] [bp-C8h] BYREF
  __int64 v63; // [sp+38h] [bp-C0h]
  __int64 v64; // [sp+40h] [bp-B8h]
  __int64 v65; // [sp+48h] [bp-B0h]
  int v66; // [sp+50h] [bp-A8h]
  CVector vPos; // [sp+58h] [bp-A0h] BYREF
  bool pBool; // [sp+67h] [bp-91h] BYREF
  CVector vecEnd; // [sp+68h] [bp-90h] BYREF
  _DWORD v70[32]; // [sp+78h] [bp-80h]

  if ( iGroupSize < 2 )
    return 0;
  v9 = CPedGroups::ms_activeGroups;
  if ( CPedGroups::ms_activeGroups[0] )
  {
    v9 = &CPedGroups::ms_activeGroups[1];
    if ( CPedGroups::ms_activeGroups[1] )
    {
      v9 = &CPedGroups::ms_activeGroups[2];
      if ( CPedGroups::ms_activeGroups[2] )
      {
        v9 = &CPedGroups::ms_activeGroups[3];
        if ( CPedGroups::ms_activeGroups[3] )
        {
          v9 = &CPedGroups::ms_activeGroups[4];
          if ( CPedGroups::ms_activeGroups[4] )
          {
            v9 = &CPedGroups::ms_activeGroups[5];
            if ( CPedGroups::ms_activeGroups[5] )
            {
              v9 = &CPedGroups::ms_activeGroups[6];
              if ( CPedGroups::ms_activeGroups[6] )
              {
                v9 = &CPedGroups::ms_activeGroups[7];
                if ( CPedGroups::ms_activeGroups[7] )
                  return 0;
                v10 = 7;
              }
              else
              {
                v10 = 6;
              }
            }
            else
            {
              v10 = 5;
            }
          }
          else
          {
            v10 = 4;
          }
        }
        else
        {
          v10 = 3;
        }
      }
      else
      {
        v10 = 2;
      }
    }
    else
    {
      v10 = 1;
    }
  }
  else
  {
    v10 = 0;
  }
  v57 = v10;
  *v9 = 1;
  v11 = &CPedGroups::ms_groups[(__int16)v10];
  CPedGroupMembership::Flush(&v11->m_membership);
  p_m_intelligence = &v11->m_intelligence;
  CPedGroupIntelligence::Flush(&v11->m_intelligence);
  v12 = cosf(6.2832 / (float)iGroupSize);
  v11->m_iGroupCreatedBy = 0;
  v13 = sqrtf(0.5 / (float)(1.0 - v12));
  if ( CCamera::IsSphereVisible(&TheCamera, vCentrePos, v13) )
  {
    PlayerPed = FindPlayerPed(-1);
    m_pMat = PlayerPed->m_pMat;
    p_tx = (float32x2_t *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (float32x2_t *)&PlayerPed->m_transform;
    v17.n64_u64[0] = vsub_f32(*(float32x2_t *)&vCentrePos->x, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
    v5.n64_u64[0] = vmul_f32(v17, v17).n64_u64[0];
    if ( sqrtf(v5.n64_f32[0] + v5.n64_f32[1]) < (float)(CPopulation::PedCreationDistMultiplier() * 42.5) )
      return 0;
  }
  p_m_membership = &v11->m_membership;
  v8 = 0;
  if ( CPedPlacement::IsPositionClearForPed(vCentrePos, v13, -1, 0, 1, 1, 1) != 1 )
    return v8;
  v18 = 0;
  v19 = 0;
  do
  {
    v20 = (float)((float)(6.2832 / (float)iGroupSize) * (float)v19)
        + (float)((float)(6.2832 / (float)iGroupSize)
                * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2));
    v21 = cosf(v20);
    v22 = sinf(v20);
    v23 = v13 + (float)(v13 * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2));
    v24 = v21 * v23;
    v25 = v22 * v23;
    GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(
                          vCentrePos->x + (float)(v21 * v23),
                          vCentrePos->y + (float)(v22 * v23),
                          vCentrePos->z + 1.0,
                          &pBool,
                          0);
    if ( pBool )
    {
      v5.n64_f32[0] = GroundZFor3DCoord + 1.0;
      v6.n64_u32[0] = LODWORD(vCentrePos->z);
      v27 = v25 + vCentrePos->y;
      v28 = v24 + vCentrePos->x;
      v5.n64_u64[0] = vmax_f32(v6, v5).n64_u64[0];
      LODWORD(vPos.z) = v5.n64_u32[0];
      vPos.y = v27;
      vPos.x = v28;
      if ( !v19 )
        vecEnd = vPos;
      v29 = CPopulation::ChooseGangOccupation(eGroupType - 7);
      v30 = CModelInfo::ms_modelInfoPtrs[v29];
      if ( v30->m_pRwObject )
      {
        pKindaCollidingObjects = 0LL;
        v63 = 0LL;
        v64 = 0LL;
        v65 = 0LL;
        v66 = 0;
        CPedPlacement::IsPositionClearForPed(
          &vPos,
          v30->m_pColModel->m_sphereBound.m_fRadius,
          9,
          (CEntity **)&pKindaCollidingObjects,
          1,
          1,
          1);
        if ( (_DWORD)pKindaCollidingObjects )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v31 = 0;
          while ( (_DWORD)pKindaCollidingObjects != v70[v31] )
          {
            if ( ++v31 >= v18 )
              goto LABEL_77;
          }
        }
        if ( HIDWORD(pKindaCollidingObjects) )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v32 = 0;
          while ( HIDWORD(pKindaCollidingObjects) != v70[v32] )
          {
            if ( ++v32 >= v18 )
              goto LABEL_77;
          }
        }
        if ( (_DWORD)v63 )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v33 = 0;
          while ( (_DWORD)v63 != v70[v33] )
          {
            if ( ++v33 >= v18 )
              goto LABEL_77;
          }
        }
        if ( HIDWORD(v63) )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v34 = 0;
          while ( HIDWORD(v63) != v70[v34] )
          {
            if ( ++v34 >= v18 )
              goto LABEL_77;
          }
        }
        if ( (_DWORD)v64 )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v35 = 0;
          while ( (_DWORD)v64 != v70[v35] )
          {
            ++v35;
            v36 = 1;
            if ( v35 >= v18 )
              goto LABEL_78;
          }
        }
        if ( HIDWORD(v64) )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v37 = 0;
          while ( HIDWORD(v64) != v70[v37] )
          {
            ++v37;
            v36 = 1;
            if ( v37 >= v18 )
              goto LABEL_78;
          }
        }
        if ( (_DWORD)v65 )
        {
          if ( v18 < 1 )
            goto LABEL_77;
          v38 = 0;
          while ( (_DWORD)v65 != v70[v38] )
          {
            ++v38;
            v36 = 1;
            if ( v38 >= v18 )
              goto LABEL_78;
          }
        }
        if ( !HIDWORD(v65) )
          goto LABEL_80;
        if ( v18 >= 1 )
        {
          v39 = 0;
          while ( HIDWORD(v65) != v70[v39] )
          {
            ++v39;
            v36 = 1;
            if ( v39 >= v18 )
              goto LABEL_78;
          }
LABEL_80:
          v36 = v66;
          if ( v66 )
          {
            v36 = 1;
            if ( v18 >= 1 )
            {
              v42 = 0;
              while ( v66 != v70[v42] )
              {
                ++v42;
                v36 = 1;
                if ( v42 >= v18 )
                  goto LABEL_78;
              }
              v36 = 0;
              if ( !v19 )
                goto LABEL_89;
              goto LABEL_79;
            }
          }
LABEL_78:
          if ( !v19 )
          {
LABEL_89:
            IsLineOfSightClear = 1;
            v41 = 1;
            goto LABEL_90;
          }
LABEL_79:
          IsLineOfSightClear = CWorld::GetIsLineOfSightClear(&vPos, &vecEnd, 1, 0, 0, 0, 0, 0, 0);
          v41 = fabsf(vPos.z - vecEnd.z) < 1.0;
LABEL_90:
          if ( !(!IsLineOfSightClear | v36) && v41 )
          {
            v43 = CPopulation::AddPed(eGroupType, v29, &vPos, 0);
            v44 = v43;
            if ( v43 )
            {
              v70[v18] = v43;
              RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(
                                           vCentrePos->x,
                                           vCentrePos->y,
                                           vPos.x,
                                           vPos.y);
              m_pRwObject = (RpClump_0 *)v44->m_pRwObject;
              v44->m_fCurrentHeading = RadianAngleBetweenPoints;
              v44->m_fDesiredHeading = RadianAngleBetweenPoints;
              CVisibilityPlugins::SetClumpAlpha(m_pRwObject, 0);
              ++v18;
            }
            else
            {
              CPopulation::RemovePed(0);
            }
          }
          goto LABEL_95;
        }
LABEL_77:
        v36 = 1;
        goto LABEL_78;
      }
    }
LABEL_95:
    ++v19;
  }
  while ( v19 != iGroupSize );
  if ( v18 < 1 )
    return 0;
  v47 = &CPedGroups::ms_groups[(__int16)v57];
  v47->m_intelligence.m_pDefaultTaskAllocator = &CPedGroupDefaultTaskAllocators::ms_randomAllocator;
  CPedGroupIntelligence::FlushTasks(
    (CPedGroupIntelligence *)&CPedGroupDefaultTaskAllocators::ms_randomAllocator,
    v47->m_intelligence.m_defaultPedTaskPairs,
    0);
  m_pDefaultTaskAllocator = v47->m_intelligence.m_pDefaultTaskAllocator;
  if ( m_pDefaultTaskAllocator )
    ((void (__fastcall *)(const CPedGroupDefaultTaskAllocator *, CPedGroup *, _DWORD))*m_pDefaultTaskAllocator->_vptr$CPedGroupDefaultTaskAllocator)(
      m_pDefaultTaskAllocator,
      p_m_intelligence->m_pPedGroup,
      0);
  v49 = 0;
  v8 = 1;
  do
  {
    v50 = (CPed *)v70[v49];
    if ( v49 )
      CPedGroupMembership::AddFollower(p_m_membership, (CPed *)v70[v49]);
    else
      CPedGroupMembership::SetLeader(p_m_membership, v50);
    CPedGroupMembership::Process(p_m_membership);
    CPedGroupIntelligence::Process(p_m_intelligence);
    m_pPedIntelligence = v50->m_pPedIntelligence;
    v52 = (CTaskComplexWanderGang *)CTask::operator new(0x38u);
    v53 = rand();
    CTaskComplexWanderGang::CTaskComplexWanderGang(
      v52,
      4,
      (int)(float)((float)((float)v53 * 0.000015259) * 8.0),
      5000,
      1,
      0.5);
    CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, v52, 4, 0);
    v54 = v50->m_pPedIntelligence;
    v55 = (CTaskComplexBeInGroup *)CTask::operator new(0x28u);
    CTaskComplexBeInGroup::CTaskComplexBeInGroup(v55, v57, 0);
    CTaskManager::SetTask(&v54->m_taskManager, v55, 3, 0);
    ++v49;
  }
  while ( v18 != v49 );
  return v8;
}
// 4B8998: variable 'v6' is possibly undefined
// 4B8998: variable 'v5' is possibly undefined
// 4B870C: using guessed type _DWORD var_80[32];

//----- (004B8CF8) --------------------------------------------------------
void __fastcall CEventCreatePartnerTask::~CEventCreatePartnerTask(CEventCreatePartnerTask *this)
{
  CPed *m_pPartner; // r0
  CEntity **p_m_pPartner; // r1

  p_m_pPartner = &this->m_pPartner;
  m_pPartner = this->m_pPartner;
  this->_vptr$CEvent = (int (**)(void))&off_669024;
  if ( m_pPartner )
    CEntity::CleanUpOldReference(m_pPartner, p_m_pPartner);
  sub_1911C4(this);
}
// 669024: using guessed type void *off_669024;

//----- (004B8D24) --------------------------------------------------------
int __fastcall CPedGroupDefaultTaskAllocatorFollowAnyMeans::GetType(
        const CPedGroupDefaultTaskAllocatorFollowAnyMeans *this)
{
  return 0;
}

//----- (004B8D28) --------------------------------------------------------
int __fastcall CPedGroupDefaultTaskAllocatorFollowLimited::GetType(
        const CPedGroupDefaultTaskAllocatorFollowLimited *this)
{
  return 1;
}

//----- (004B8D2C) --------------------------------------------------------
int __fastcall CPedGroupDefaultTaskAllocatorStandStill::GetType(const CPedGroupDefaultTaskAllocatorStandStill *this)
{
  return 2;
}

//----- (004B8D30) --------------------------------------------------------
int __fastcall CPedGroupDefaultTaskAllocatorChat::GetType(const CPedGroupDefaultTaskAllocatorChat *this)
{
  return 3;
}

//----- (004B8D34) --------------------------------------------------------
int __fastcall CPedGroupDefaultTaskAllocatorRandom::GetType(const CPedGroupDefaultTaskAllocatorRandom *this)
{
  return 5;
}

//----- (004B8D38) --------------------------------------------------------
int __fastcall CPedGroupDefaultTaskAllocatorSitInLeaderCar::GetType(
        const CPedGroupDefaultTaskAllocatorSitInLeaderCar *this)
{
  return 4;
}

//----- (004B8D3C) --------------------------------------------------------
void __fastcall CTaskSimpleNone::~CTaskSimpleNone(CTaskSimpleNone *this)
{
  void *v1; // r0

  CTask::~CTask(this);
  sub_197118(v1);
}
// 4B8D48: variable 'v1' is possibly undefined

//----- (004B8D4C) --------------------------------------------------------
CTask *__fastcall CTaskSimpleNone::Clone(const CTaskSimpleNone *this)
{
  CTaskSimple *v1; // r0
  CTask *result; // r0

  v1 = (CTaskSimple *)CTask::operator new(8u);
  CTaskSimple::CTaskSimple(v1);
  result->_vptr$CTask = (int (**)(void))&off_668FF0;
  return result;
}
// 4B8D62: variable 'result' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;

//----- (004B8D6C) --------------------------------------------------------
int __fastcall CTaskSimpleNone::GetTaskType(const CTaskSimpleNone *this)
{
  return 200;
}

//----- (004B8D70) --------------------------------------------------------
void __fastcall CEventCreatePartnerTask::~CEventCreatePartnerTask(CEventCreatePartnerTask *this)
{
  CPed *m_pPartner; // r0
  CEntity **p_m_pPartner; // r1
  void *v4; // r0

  p_m_pPartner = &this->m_pPartner;
  m_pPartner = this->m_pPartner;
  this->_vptr$CEvent = (int (**)(void))&off_669024;
  if ( m_pPartner )
    CEntity::CleanUpOldReference(m_pPartner, p_m_pPartner);
  CEvent::~CEvent(this);
  sub_1978E4(v4);
}
// 4B8D98: variable 'v4' is possibly undefined
// 669024: using guessed type void *off_669024;

//----- (004B8DA0) --------------------------------------------------------
int __fastcall CEventCreatePartnerTask::GetEventType(const CEventCreatePartnerTask *this)
{
  return 70;
}

//----- (004B8DA4) --------------------------------------------------------
int __fastcall CEventCreatePartnerTask::GetEventPriority(const CEventCreatePartnerTask *this)
{
  return 6;
}

//----- (004B8DA8) --------------------------------------------------------
int __fastcall CEventCreatePartnerTask::GetLifeTime(const CEventCreatePartnerTask *this)
{
  return 0;
}

//----- (004B8DAC) --------------------------------------------------------
CEvent *__fastcall CEventCreatePartnerTask::Clone(const CEventCreatePartnerTask *this)
{
  CEvent *v2; // r0
  __int64 v3; // kr00_8
  CEvent *v4; // r4
  float m_meetDist; // r9

  v2 = (CEvent *)CEvent::operator new(0x1Cu);
  v3 = *(_QWORD *)&this->m_type;
  v4 = v2;
  m_meetDist = this->m_meetDist;
  LOBYTE(this) = this->m_isLeader;
  CEvent::CEvent(v2);
  v4[1]._vptr$CEvent = (int (**)(void))v3;
  v4[1].m_bIsPersistent = (char)this;
  *(float *)&v4[2]._vptr$CEvent = m_meetDist;
  v4->_vptr$CEvent = (int (**)(void))&off_669024;
  v4[1].m_iAccumulatedTime = HIDWORD(v3);
  if ( HIDWORD(v3) )
    CEntity::RegisterReference((CEntity *)HIDWORD(v3), (CEntity **)&v4[1].m_iAccumulatedTime);
  return v4;
}
// 669024: using guessed type void *off_669024;

//----- (004B8E00) --------------------------------------------------------
bool __fastcall CEventCreatePartnerTask::AffectsPed(const CEventCreatePartnerTask *this, CPed *pPed)
{
  return 1;
}

//----- (004B8E04) --------------------------------------------------------
void __fastcall CPedIK::CPedIK(CPedIK *this, CPed *pPed)
{
  this->m_pPed = pPed;
  *(_QWORD *)&this->m_fSlopePitchLimitMult = 0LL;
  *(_QWORD *)&this->m_fBodyRoll = 0LL;
  this->m_torsoOrien = 0LL;
  *(_QWORD *)&this->m_fSlopePitch = 0LL;
}

//----- (004B8E1A) --------------------------------------------------------
RwMatrix *__fastcall CPedIK::GetWorldMatrix(RwFrame_0 *pFrame, RwMatrix *pMatrix)
{
  __int64 v3; // d16
  __int64 v4; // d17
  __int64 v5; // d18
  __int64 v6; // d19
  __int64 v7; // d20
  __int64 v8; // d21
  __int64 v9; // d23
  RwV3d_0 *p_pos; // r1
  char *i; // r5

  v3 = *(_QWORD *)&pFrame->modelling.at.x;
  v4 = *(_QWORD *)&pFrame->modelling.at.z;
  v5 = *(_QWORD *)&pFrame->modelling.right.x;
  v6 = *(_QWORD *)&pFrame->modelling.right.z;
  v7 = *(_QWORD *)&pFrame->modelling.up.x;
  v8 = *(_QWORD *)&pFrame->modelling.up.z;
  v9 = *(_QWORD *)&pFrame->modelling.pos.z;
  p_pos = &pMatrix->pos;
  *(_QWORD *)&p_pos->x = *(_QWORD *)&pFrame->modelling.pos.x;
  *(_QWORD *)&p_pos->z = v9;
  *(_QWORD *)&pMatrix->at.x = v3;
  *(_QWORD *)&pMatrix->at.z = v4;
  *(_QWORD *)&pMatrix->right.x = v5;
  *(_QWORD *)&pMatrix->right.z = v6;
  *(_QWORD *)&pMatrix->up.x = v7;
  *(_QWORD *)&pMatrix->up.z = v8;
  for ( i = (char *)pFrame->object.parent; i; i = (char *)*((_DWORD *)i + 1) )
    RwMatrixTransform(pMatrix, (const RwMatrix *)(i + 16), rwCOMBINEPOSTCONCAT);
  return pMatrix;
}

//----- (004B8E74) --------------------------------------------------------
void __fastcall CPedIK::ExtractYawAndPitchWorld(CPedIK *this, RwMatrix *pMatrix, float *yaw, float *pitch)
{
  float v7; // s0
  float v8; // s2
  float v9; // r0
  float v10; // s0
  float v11; // s2
  float v12; // r0

  v7 = -1.0;
  v8 = (float)((float)(pMatrix->up.x * 0.0) + pMatrix->up.y) + (float)(pMatrix->up.z * 0.0);
  if ( v8 >= -1.0 )
  {
    v7 = (float)((float)(pMatrix->up.x * 0.0) + pMatrix->up.y) + (float)(pMatrix->up.z * 0.0);
    if ( v8 > 1.0 )
      v7 = 1.0;
  }
  v9 = acosf(v7);
  *yaw = v9;
  if ( pMatrix->up.x > 0.0 )
    *yaw = -v9;
  v10 = -1.0;
  v11 = pMatrix->right.z + (float)((float)(pMatrix->right.x * 0.0) + (float)(pMatrix->right.y * 0.0));
  if ( v11 >= -1.0 )
  {
    v10 = pMatrix->right.z + (float)((float)(pMatrix->right.x * 0.0) + (float)(pMatrix->right.y * 0.0));
    if ( v11 > 1.0 )
      v10 = 1.0;
  }
  v12 = acosf(v10);
  *pitch = v12;
  if ( pMatrix->up.z > 0.0 )
    *pitch = -v12;
}

//----- (004B8F60) --------------------------------------------------------
MoveLimbResult __fastcall CPedIK::MoveLimb(
        CPedIK *this,
        LimbOrientation *limb,
        float yaw,
        float pitch,
        LimbMovementInfo *limbInfo)
{
  float v5; // s2
  float v6; // s0
  float yawD; // s4
  MoveLimbResult result; // r0
  float maxYaw; // s4
  float v10; // s0
  float v11; // s2
  float pitchD; // s4
  float maxPitch; // s2

  v5 = yaw;
  v6 = limb->yaw;
  yawD = limbInfo->yawD;
  if ( fabsf(limb->yaw - yaw) >= yawD )
  {
    if ( v6 >= yaw )
    {
      if ( v6 <= yaw )
      {
        result = HAVENT_REACHED_TARGET;
        v5 = limb->yaw;
        goto LABEL_9;
      }
      v5 = v6 - yawD;
    }
    else
    {
      v5 = v6 + yawD;
    }
    result = HAVENT_REACHED_TARGET;
  }
  else
  {
    result = REACHED_TARGET;
  }
  limb->yaw = v5;
LABEL_9:
  maxYaw = limbInfo->maxYaw;
  v10 = pitch;
  if ( v5 > limbInfo->maxYaw || (maxYaw = limbInfo->minYaw, v5 < maxYaw) )
  {
    result = CANT_REACH_TARGET;
    limb->yaw = maxYaw;
  }
  v11 = limb->pitch;
  pitchD = limbInfo->pitchD;
  if ( fabsf(v11 - pitch) >= pitchD )
  {
    if ( v11 >= pitch )
    {
      if ( v11 <= pitch )
      {
        v10 = limb->pitch;
        goto LABEL_19;
      }
      v10 = v11 - pitchD;
    }
    else
    {
      v10 = v11 + pitchD;
    }
    result = HAVENT_REACHED_TARGET;
  }
  limb->pitch = v10;
LABEL_19:
  maxPitch = limbInfo->maxPitch;
  if ( v10 > maxPitch || (maxPitch = limbInfo->minPitch, v10 < maxPitch) )
  {
    result = CANT_REACH_TARGET;
    limb->pitch = maxPitch;
  }
  return result;
}

//----- (004B9038) --------------------------------------------------------
MoveLimbResult __fastcall CPedIK::MoveLimb(
        CPedIK *this,
        LimbOrientation *limb,
        float yaw,
        float pitch,
        LimbMovementInfo *limbInfo,
        float fBlendAmount)
{
  float v6; // s2
  float maxYaw; // s4
  MoveLimbResult v8; // r2
  float maxPitch; // s4
  MoveLimbResult result; // r0

  v6 = pitch * fBlendAmount;
  limb->yaw = yaw * fBlendAmount;
  limb->pitch = pitch * fBlendAmount;
  maxYaw = limbInfo->maxYaw;
  if ( (float)(yaw * fBlendAmount) <= limbInfo->maxYaw
    && (maxYaw = limbInfo->minYaw, (float)(yaw * fBlendAmount) >= maxYaw) )
  {
    v8 = HAVENT_REACHED_TARGET;
  }
  else
  {
    v8 = CANT_REACH_TARGET;
    limb->yaw = maxYaw;
  }
  maxPitch = limbInfo->maxPitch;
  if ( v6 > maxPitch || (maxPitch = limbInfo->minPitch, v6 < maxPitch) )
  {
    v8 = CANT_REACH_TARGET;
    limb->pitch = maxPitch;
  }
  result = v8;
  if ( v8 )
    result = REACHED_TARGET;
  if ( fBlendAmount <= 0.9 )
    return v8;
  return result;
}

//----- (004B90BC) --------------------------------------------------------
bool __fastcall CPedIK::PointGunAtPosition(CPedIK *this, const CVector *pos, float fBlendAmount)
{
  CPed *m_pPed; // r0
  eWeaponType m_eWeaponType; // r4
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  float32x2_t *m_pMat; // r4
  int m_nPedFlags; // r3
  float32x2_t *p_m_transform; // r5
  tAnimAimOffsets *v13; // r0
  bool v14; // zf
  int v15; // r1
  float *p_fAimFromX; // r2
  float *p_fAimFromZ; // r3
  float v18; // s16
  float v19; // s18
  float v20; // s22
  float v21; // s24
  float v22; // s26
  float32x2_t v23; // d10
  float RadianAngleBetweenPoints; // r0
  float32x2_t v25; // d16
  float v26; // r4
  unsigned __int64 v27; // d0
  float v28; // r0

  m_pPed = this->m_pPed;
  m_eWeaponType = m_pPed->m_WeaponSlots[m_pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(m_pPed);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  m_pMat = (float32x2_t *)this->m_pPed->m_pMat;
  m_nPedFlags = (int)this->m_pPed->m_nPedFlags;
  p_m_transform = m_pMat + 6;
  v13 = &CWeaponInfo::ms_aWeaponAimOffsets[WeaponInfo->m_nAimOffsetIndex];
  if ( !m_pMat )
    p_m_transform = (float32x2_t *)&this->m_pPed->m_transform;
  v15 = m_nPedFlags & 0x4000000;
  v14 = (m_nPedFlags & 0x4000000) == 0;
  p_fAimFromX = &v13->fAimFromX;
  p_fAimFromZ = &v13->fAimFromZ;
  if ( !v14 )
    p_fAimFromX = &v13->fDuckAimX;
  v18 = *p_fAimFromX;
  if ( v15 )
    p_fAimFromZ = &v13->fDuckAimZ;
  v19 = *p_fAimFromZ;
  v20 = m_pMat[5].n64_f32[0];
  v21 = m_pMat[1].n64_f32[0];
  v22 = p_m_transform[1].n64_f32[0];
  v23.n64_u64[0] = vadd_f32(
                     vadd_f32((float32x2_t)p_m_transform->n64_u64[0], vmul_n_f32((float32x2_t)m_pMat->n64_u64[0], v18)),
                     vmul_n_f32(m_pMat[4], *p_fAimFromZ)).n64_u64[0];
  RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(pos->x, pos->y, v23.n64_f32[0], v23.n64_f32[1]);
  v25.n64_u64[0] = vsub_f32(v23, *(float32x2_t *)&pos->x).n64_u64[0];
  v26 = RadianAngleBetweenPoints;
  v27 = vmul_f32(v25, v25).n64_u64[0];
  v28 = CGeneral::GetRadianAngleBetweenPoints(
          pos->z,
          sqrtf(*(float *)&v27 + *((float *)&v27 + 1)),
          (float)(v22 + (float)(v18 * v21)) + (float)(v19 * v20),
          0.0);
  return CPedIK::PointGunInDirection(this, v26, v28, 0, fBlendAmount);
}

//----- (004B91C8) --------------------------------------------------------
int __fastcall CPedIK::PointGunInDirection(CPedIK *this, float yaw, float pitch, int bRollPitch, float fBlendAmount)
{
  float v8; // r10
  CPed *m_pPed; // r0
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r6
  RwInt32 v11; // r5
  RwMatrix *v12; // r4
  RwMatrix *v13; // r0
  __int64 *p_at; // r2
  __int64 *v15; // r1
  __int64 v16; // d23
  __int64 v17; // d16
  __int64 v18; // d17
  __int64 v19; // d18
  __int64 v20; // d19
  __int64 v21; // d20
  __int64 v22; // d21
  float v23; // s0
  float v24; // s4
  float v25; // s2
  int v26; // r0
  float v27; // s0
  float maxYaw; // s6
  int v29; // r1
  float maxPitch; // s4
  int v31; // r6
  float minYaw; // s2
  float v33; // s2
  float minPitch; // s2
  RpHAnimHierarchy_0 *v35; // r0
  RwMatrix *MatrixArray; // r0
  float v37; // r0
  float v38; // r5
  float v39; // r4
  float v40; // s0
  unsigned int v41; // s2
  float v42; // r4
  RwFrame_0 *pFrame; // r4
  CPed *v44; // r0
  int v45; // r3
  int v46; // r2
  int v47; // r5
  RwV3d_0 axis; // [sp+4h] [bp-3Ch] BYREF

  v8 = CGeneral::LimitRadianAngle(yaw - this->m_pPed->m_fCurrentHeading);
  m_pPed = this->m_pPed;
  this->m_flags = this->m_flags & 0xFFFFFFFC | 2;
  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)m_pPed->m_pRwObject);
  v11 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, this->m_pPed->m_aPedFrames[16]->boneTag);
  v12 = RwMatrixCreate();
  v13 = &RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump)[v11];
  p_at = (__int64 *)&v13->at;
  v15 = (__int64 *)v13;
  v13 = (RwMatrix *)((char *)v13 + 48);
  v16 = *(_QWORD *)&v13->right.z;
  v17 = *v15;
  v18 = v15[1];
  v15 += 2;
  v19 = *p_at;
  v20 = p_at[1];
  v21 = *v15;
  v22 = v15[1];
  *(_QWORD *)&v12->pos.x = *(_QWORD *)&v13->right.x;
  *(_QWORD *)&v12->pos.z = v16;
  *(_QWORD *)&v12->at.x = v19;
  *(_QWORD *)&v12->at.z = v20;
  *(_QWORD *)&v12->right.x = v17;
  *(_QWORD *)&v12->right.z = v18;
  *(_QWORD *)&v12->up.x = v21;
  *(_QWORD *)&v12->up.z = v22;
  RwMatrixDestroy(v12);
  v23 = pitch;
  v24 = v8;
  if ( fBlendAmount >= 0.0 )
  {
    v27 = pitch * fBlendAmount;
    this->m_torsoOrien.yaw = v8 * fBlendAmount;
    this->m_torsoOrien.pitch = pitch * fBlendAmount;
    maxYaw = CPedIK::ms_torsoInfo.maxYaw;
    if ( (float)(v8 * fBlendAmount) <= CPedIK::ms_torsoInfo.maxYaw
      && (maxYaw = CPedIK::ms_torsoInfo.minYaw, (float)(v8 * fBlendAmount) >= CPedIK::ms_torsoInfo.minYaw) )
    {
      v29 = 1;
    }
    else
    {
      v29 = 0;
      this->m_torsoOrien.yaw = maxYaw;
    }
    maxPitch = CPedIK::ms_torsoInfo.maxPitch;
    if ( v27 > CPedIK::ms_torsoInfo.maxPitch
      || (maxPitch = CPedIK::ms_torsoInfo.minPitch, v27 < CPedIK::ms_torsoInfo.minPitch) )
    {
      v29 = 0;
      this->m_torsoOrien.pitch = maxPitch;
    }
    v26 = v29;
    if ( v29 )
      v26 = 2;
    if ( fBlendAmount <= 0.9 )
      v26 = v29;
    goto LABEL_17;
  }
  v25 = this->m_torsoOrien.yaw;
  if ( fabsf(v25 - v8) >= CPedIK::ms_torsoInfo.yawD )
  {
    if ( v25 >= v8 )
    {
      if ( v25 <= v8 )
      {
        v26 = 1;
        v24 = this->m_torsoOrien.yaw;
        goto LABEL_25;
      }
      v24 = v25 - CPedIK::ms_torsoInfo.yawD;
    }
    else
    {
      v24 = v25 + CPedIK::ms_torsoInfo.yawD;
    }
    v26 = 1;
  }
  else
  {
    v26 = 2;
  }
  this->m_torsoOrien.yaw = v24;
LABEL_25:
  minYaw = CPedIK::ms_torsoInfo.maxYaw;
  if ( v24 > CPedIK::ms_torsoInfo.maxYaw || (minYaw = CPedIK::ms_torsoInfo.minYaw, v24 < CPedIK::ms_torsoInfo.minYaw) )
  {
    v26 = 0;
    this->m_torsoOrien.yaw = minYaw;
  }
  v33 = this->m_torsoOrien.pitch;
  if ( fabsf(v33 - pitch) >= CPedIK::ms_torsoInfo.pitchD )
  {
    if ( v33 >= pitch )
    {
      if ( v33 <= pitch )
      {
        v23 = this->m_torsoOrien.pitch;
        goto LABEL_35;
      }
      v23 = v33 - CPedIK::ms_torsoInfo.pitchD;
    }
    else
    {
      v23 = v33 + CPedIK::ms_torsoInfo.pitchD;
    }
    v26 = 1;
  }
  this->m_torsoOrien.pitch = v23;
LABEL_35:
  minPitch = CPedIK::ms_torsoInfo.maxPitch;
  if ( v23 > CPedIK::ms_torsoInfo.maxPitch
    || (minPitch = CPedIK::ms_torsoInfo.minPitch, v23 < CPedIK::ms_torsoInfo.minPitch) )
  {
    this->m_torsoOrien.pitch = minPitch;
    goto LABEL_38;
  }
LABEL_17:
  if ( !v26 )
  {
LABEL_38:
    v31 = 0;
    goto LABEL_39;
  }
  v31 = 1;
  if ( v26 == 2 )
    this->m_flags |= 1u;
LABEL_39:
  v35 = GetAnimHierarchyFromSkinClump((RpClump_0 *)this->m_pPed->m_pRwObject);
  MatrixArray = RpHAnimHierarchyGetMatrixArray(v35);
  v37 = atan2f(
          COERCE_FLOAT(LODWORD(MatrixArray[2].at.y) ^ 0x80000000),
          COERCE_FLOAT(LODWORD(MatrixArray[2].at.x) ^ 0x80000000));
  v38 = CGeneral::LimitRadianAngle(v37 - this->m_pPed->m_fCurrentHeading);
  axis.x = 0.0;
  if ( bRollPitch == 1 )
  {
    v39 = cosf(v38);
    v40 = sinf(-v38);
    v41 = LODWORD(v39);
  }
  else
  {
    v42 = sinf(-v38);
    v40 = cosf(v38);
    v41 = LODWORD(v42) ^ 0x80000000;
  }
  axis.z = v40;
  LODWORD(axis.y) = v41;
  pFrame = this->m_pPed->m_aPedFrames[1]->_anon_1.pFrame;
  RtQuatRotate((RtQuat_0 *)pFrame, &axis, (float)(this->m_torsoOrien.pitch * 180.0) / 3.1416, rwCOMBINEPOSTCONCAT);
  RtQuatRotate(
    (RtQuat_0 *)pFrame,
    &CPedIK::XaxisIK,
    (float)(this->m_torsoOrien.yaw * 180.0) / 3.1416,
    rwCOMBINEPOSTCONCAT);
  v44 = this->m_pPed;
  v45 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
  v46 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) | 0x4000;
  v47 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
  *(_DWORD *)&v44->m_nPedFlags = this->m_pPed->m_nPedFlags;
  *((_DWORD *)&v44->m_nPedFlags + 1) = v46;
  *((_DWORD *)&v44->m_nPedFlags + 2) = v45;
  *((_DWORD *)&v44->m_nPedFlags + 3) = v47;
  return v31;
}

//----- (004B9560) --------------------------------------------------------
void __fastcall CPedIK::RotateTorso(
        CPedIK *this,
        AnimBlendFrameData *pFrameData,
        LimbOrientation *torso,
        bool bCancelRoll)
{
  RwFrame_0 *pFrame; // r5
  CPed *m_pPed; // r0
  int v8; // r3
  int v9; // r2
  int v10; // r6

  pFrame = pFrameData->_anon_1.pFrame;
  RtQuatRotate(
    (RtQuat_0 *)pFrame,
    &CPedIK::XaxisIK,
    (float)(torso->yaw * 180.0) / 3.1416,
    (RwOpCombineType_0)bCancelRoll);
  RtQuatRotate((RtQuat_0 *)pFrame, &CPedIK::ZaxisIK, (float)(torso->pitch * 180.0) / 3.1416, rwCOMBINEPRECONCAT);
  m_pPed = this->m_pPed;
  v8 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
  v9 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) | 0x4000;
  v10 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
  *(_DWORD *)&m_pPed->m_nPedFlags = this->m_pPed->m_nPedFlags;
  *((_DWORD *)&m_pPed->m_nPedFlags + 1) = v9;
  *((_DWORD *)&m_pPed->m_nPedFlags + 2) = v8;
  *((_DWORD *)&m_pPed->m_nPedFlags + 3) = v10;
}

//----- (004B9608) --------------------------------------------------------
void __fastcall CPedIK::RotateTorsoForArm(CPedIK *this, const CVector *vecTarget)
{
  float x; // s0
  CPed *m_pPed; // r6
  float y; // s2
  CMatrix *m_pMat; // r0
  float *p_tx; // r1
  float v8; // r0
  float v9; // s4
  float m_fCurrentHeading; // s2
  float v11; // s6
  float v12; // s4
  float v13; // s2
  float v14; // s4

  x = vecTarget->x;
  m_pPed = this->m_pPed;
  y = vecTarget->y;
  m_pMat = this->m_pPed->m_pMat;
  p_tx = &m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pPed->m_transform.m_translate.x;
  v8 = atan2f(-(float)(x - *p_tx), y - p_tx[1]);
  v9 = v8;
  m_fCurrentHeading = m_pPed->m_fCurrentHeading;
  if ( v8 <= (float)(m_fCurrentHeading + 3.1416) )
  {
    if ( v8 >= (float)(m_fCurrentHeading + -3.1416) )
      goto LABEL_8;
    v11 = 6.2832;
  }
  else
  {
    v11 = -6.2832;
  }
  v9 = v8 + v11;
LABEL_8:
  v12 = v9 - m_fCurrentHeading;
  v13 = 0.7854;
  if ( v12 <= 0.7854 )
  {
    if ( v12 >= -1.0472 )
      return;
    v14 = v12 + 1.0472;
    v13 = -0.34907;
    if ( v14 < -0.34907 )
      goto LABEL_14;
LABEL_13:
    v13 = v14;
    if ( v14 == 0.0 )
      return;
    goto LABEL_14;
  }
  v14 = v12 + -0.7854;
  if ( v14 <= 0.7854 )
    goto LABEL_13;
LABEL_14:
  RtQuatRotate(
    (RtQuat_0 *)m_pPed->m_aPedFrames[17]->_anon_1.pFrame,
    &CPedIK::XaxisIK,
    (float)((float)(v13 * 0.5) * 180.0) / 3.1416,
    rwCOMBINEPOSTCONCAT);
  sub_18DD1C(
    (RtQuat_0 *)this->m_pPed->m_aPedFrames[1]->_anon_1.pFrame,
    &CPedIK::XaxisIK,
    (float)((float)(v13 * 0.5) * 180.0) / 3.1416,
    rwCOMBINEPOSTCONCAT);
}

//----- (004B9758) --------------------------------------------------------
void __fastcall CPedIK::PitchForSlope(CPedIK *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d11
  float32x2_t v3; // d14
  RpClump_0 *m_pRwObject; // r0
  int v6; // r10
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r9
  CPed *m_pPed; // r0
  int v9; // r6
  int v10; // r3
  unsigned __int32 v11; // r2
  int v12; // r1
  float m_fSlopePitch; // s0
  int *v14; // r3
  float v15; // s2
  float v16; // s4
  float m_fSlopeRoll; // s2
  int v18; // r2
  float m_fBodyRoll; // s2
  int v20; // r2
  RwObject_0 *v21; // r0
  RwMatrix *v22; // r1
  RtQuat_0 *v23; // r5
  CTask *ActiveTask; // r0
  CPed *v25; // r0
  int v26; // r3
  int v27; // r2
  int v28; // r6
  CPed *v29; // r0
  int v30; // r3
  int v31; // r2
  int v32; // r5
  RwMatrix *MatrixArray; // r5
  RwInt32 v34; // r0
  float v35; // r0
  float v36; // s2
  int v37; // r5
  RwInt32 v38; // r0
  int v39; // r5
  RwInt32 v40; // r0
  float32x2_t v41; // d0
  float v42; // s2
  int v43; // r5
  RwInt32 v44; // r0
  RwMatrix *v45; // r5
  RwInt32 v46; // r0
  int v47; // r5
  RwReal v48; // s26
  RwInt32 v49; // r0
  int v50; // r5
  RwInt32 v51; // r0
  float v52; // s2
  int v53; // r5
  RwInt32 v54; // r0
  RwObject_0 *v55; // r0
  RwMatrix *v56; // r1
  CPed *v57; // r6
  float v58; // r5
  float v59; // s24
  float v60; // s0
  float *p_xx; // r0
  float v62; // s0
  float v63; // s2
  float v64; // s4
  float v65; // s0
  float v66; // s0
  RwInt32 v67; // r6
  RtQuat_0 *v68; // r5
  RwMatrix *v69; // r0
  float v70; // r0
  float v71; // r6
  RwInt32 v72; // r6
  RtQuat_0 *v73; // r5
  RwMatrix *v74; // r0
  float v75; // r0
  float v76; // r6
  CPed *v77; // r0
  int v78; // r3
  int v79; // r2
  int v80; // r6
  CMatrix v81; // [sp+0h] [bp-138h] BYREF
  CMatrix v82; // [sp+48h] [bp-F0h] BYREF
  CMatrix v83; // [sp+90h] [bp-A8h] BYREF

  m_pRwObject = (RpClump_0 *)this->m_pPed->m_pRwObject;
  v6 = *(_DWORD *)(&m_pRwObject->object.type + ClumpOffset);
  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump(m_pRwObject);
  m_pPed = this->m_pPed;
  v9 = 0;
  v10 = 0;
  v11 = this->m_pPed->m_nPedState & 0xFFFFFFFE;
  if ( v11 == 54 )
    v12 = 1;
  else
    v12 = (*((unsigned __int8 *)&m_pPed->m_nPedFlags + 10) >> 4) & 1;
  m_fSlopePitch = this->m_fSlopePitch;
  if ( m_fSlopePitch <= 0.01 )
    v9 = 1;
  if ( m_fSlopePitch >= -0.01 )
    v10 = 1;
  if ( (v10 & v9) == 0 && v11 != 54 )
  {
    v14 = dword_4B9E38;
    if ( m_pPed->m_eMoveState == PEDMOVE_WALK )
      v14 = &dword_4B9E38[1];
    v15 = (float)(this->m_fSlopePitchLimitMult * 0.9) + *(float *)v14;
    v16 = 0.5236;
    this->m_fSlopePitchLimitMult = v15;
    if ( m_fSlopePitch > (float)(v15 * 0.5236) || (v16 = -0.61087, m_fSlopePitch < (float)(v15 * -0.61087)) )
    {
      m_fSlopePitch = v16 * v15;
      this->m_fSlopePitch = v16 * v15;
    }
  }
  m_fSlopeRoll = this->m_fSlopeRoll;
  if ( (m_fSlopeRoll > 0.01 || m_fSlopeRoll < -0.01) && (m_pPed->m_nPedState & 0xFFFFFFFE) != 54 )
  {
    if ( m_fSlopeRoll > 0.7854 )
    {
      v18 = 1061752795;
LABEL_22:
      LODWORD(this->m_fSlopeRoll) = v18;
      goto LABEL_23;
    }
    if ( m_fSlopeRoll < -0.7854 )
    {
      v18 = -1085730853;
      goto LABEL_22;
    }
  }
LABEL_23:
  m_fBodyRoll = this->m_fBodyRoll;
  if ( m_fBodyRoll > 0.01 || m_fBodyRoll < -0.01 )
  {
    if ( m_fBodyRoll <= 0.5236 )
    {
      if ( m_fBodyRoll >= -0.5236 )
        goto LABEL_30;
      v20 = -1090123118;
    }
    else
    {
      v20 = 1057360530;
    }
    LODWORD(this->m_fBodyRoll) = v20;
  }
LABEL_30:
  if ( v12 == 1 )
  {
    v21 = m_pPed->m_pRwObject;
    if ( v21 )
      v22 = (RwMatrix *)((char *)v21->parent + 16);
    else
      v22 = 0;
    CMatrix::CMatrix(&v82, v22, 0);
    v81.m_pRwMat = 0;
    v81.m_owner = 0;
    CMatrix::SetTranslate(&v81, 0.0, 0.0, 1.0);
    CMatrix::RotateX(&v81, COERCE_FLOAT(LODWORD(this->m_fSlopePitch) ^ 0x80000000));
    CMatrix::RotateY(&v81, this->m_fSlopeRoll);
    operator*(&v83, &v82, &v81);
    CMatrix::operator=(&v82, &v83);
    CMatrix::~CMatrix(&v83);
    v82.tx = v82.tx + 0.0;
    v82.ty = v82.ty + 0.0;
    v82.tz = v82.tz + -1.0;
    CMatrix::UpdateRW(&v82);
    CEntity::UpdateRwFrame(this->m_pPed);
    CMatrix::~CMatrix(&v81);
    CMatrix::~CMatrix(&v82);
  }
  else
  {
    if ( m_fSlopePitch > 0.01 || m_fSlopePitch < -0.01 )
    {
      v23 = *(RtQuat_0 **)(*(_DWORD *)(v6 + 16) + 24 * RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 2) + 16);
      if ( CTaskManager::GetActiveTask(&this->m_pPed->m_pPedIntelligence->m_taskManager)
        && (ActiveTask = CTaskManager::GetActiveTask(&this->m_pPed->m_pPedIntelligence->m_taskManager),
            (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 1027) )
      {
        RtQuatRotate(v23, &CPedIK::ZaxisIK, (float)(this->m_fSlopePitch * 180.0) / 3.1416, rwCOMBINEPRECONCAT);
        v25 = this->m_pPed;
        v26 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
        v27 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) | 0x4000;
        v28 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
        *(_DWORD *)&v25->m_nPedFlags = this->m_pPed->m_nPedFlags;
        *((_DWORD *)&v25->m_nPedFlags + 1) = v27;
        *((_DWORD *)&v25->m_nPedFlags + 2) = v26;
        *((_DWORD *)&v25->m_nPedFlags + 3) = v28;
      }
      else
      {
        RtQuatRotate(
          v23,
          &CPedIK::ZaxisIK,
          (float)((float)(this->m_fSlopePitch * -180.0) / 3.1416) * 0.75,
          rwCOMBINEPRECONCAT);
        v29 = this->m_pPed;
        v30 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
        v31 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) | 0x4000;
        v32 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
        *(_DWORD *)&v29->m_nPedFlags = this->m_pPed->m_nPedFlags;
        *((_DWORD *)&v29->m_nPedFlags + 1) = v31;
        *((_DWORD *)&v29->m_nPedFlags + 2) = v30;
        *((_DWORD *)&v29->m_nPedFlags + 3) = v32;
        MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
        v34 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 51);
        v35 = asinf(MatrixArray[v34].up.z);
        v36 = this->m_fSlopePitch;
        v3.n64_f32[0] = v35;
        v37 = *(_DWORD *)(v6 + 16);
        v38 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 51);
        RtQuatRotate(
          *(RtQuat_0 **)(v37 + 24 * v38 + 16),
          &CPedIK::ZaxisIK,
          (float)(v3.n64_f32[0] * 30.0) * v36,
          rwCOMBINEPOSTCONCAT);
        v2.n64_u32[0] = 0;
        v1.n64_f32[0] = -(float)(v3.n64_f32[0] * this->m_fSlopePitch);
        v39 = *(_DWORD *)(v6 + 16);
        v40 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 52);
        RtQuatRotate(
          *(RtQuat_0 **)(v39 + 24 * v40 + 16),
          &CPedIK::ZaxisIK,
          vmax_f32(v1, v2).n64_f32[0] * -30.0,
          rwCOMBINEPOSTCONCAT);
        v41.n64_u64[0] = vmax_f32(v3, v2).n64_u64[0];
        v42 = this->m_fSlopePitch;
        v43 = *(_DWORD *)(v6 + 16);
        v44 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 53);
        RtQuatRotate(
          *(RtQuat_0 **)(v43 + 24 * v44 + 16),
          &CPedIK::ZaxisIK,
          (float)(v41.n64_f32[0] * -30.0) * v42,
          rwCOMBINEPOSTCONCAT);
        v45 = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
        v46 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 41);
        v3.n64_u32[0] = asinf(v45[v46].up.z);
        v47 = *(_DWORD *)(v6 + 16);
        v48 = (float)(v3.n64_f32[0] * 30.0) * this->m_fSlopePitch;
        v49 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 41);
        RtQuatRotate(*(RtQuat_0 **)(v47 + 24 * v49 + 16), &CPedIK::ZaxisIK, v48, rwCOMBINEPOSTCONCAT);
        v50 = *(_DWORD *)(v6 + 16);
        v41.n64_f32[0] = -(float)(v3.n64_f32[0] * this->m_fSlopePitch);
        v51 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 42);
        RtQuatRotate(
          *(RtQuat_0 **)(v50 + 24 * v51 + 16),
          &CPedIK::ZaxisIK,
          vmax_f32(v41, v2).n64_f32[0] * -30.0,
          rwCOMBINEPOSTCONCAT);
        v52 = this->m_fSlopePitch;
        v53 = *(_DWORD *)(v6 + 16);
        v54 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 43);
        RtQuatRotate(
          *(RtQuat_0 **)(v53 + 24 * v54 + 16),
          &CPedIK::ZaxisIK,
          (float)(vmax_f32(v3, v2).n64_f32[0] * -30.0) * v52,
          rwCOMBINEPOSTCONCAT);
        v55 = this->m_pPed->m_pRwObject;
        if ( v55 )
          v56 = (RwMatrix *)((char *)v55->parent + 16);
        else
          v56 = 0;
        CMatrix::CMatrix(&v82, v56, 0);
        v81.m_pRwMat = 0;
        v81.m_owner = 0;
        CMatrix::SetTranslate(&v81, 0.0, 0.0, 0.0);
        CMatrix::RotateX(&v81, this->m_fSlopePitch * -0.5);
        operator*(&v83, &v82, &v81);
        CMatrix::operator=(&v82, &v83);
        CMatrix::~CMatrix(&v83);
        v57 = this->m_pPed;
        v58 = this->m_fSlopePitch;
        v59 = 0.3 / cosf(this->m_fSlopeRoll);
        v60 = sinf(v58);
        p_xx = &v57->m_pMat->xx;
        v62 = v60 * 0.75;
        v63 = v62 * p_xx[4];
        v64 = v62 * p_xx[5];
        v65 = v62 * p_xx[6];
        v82.tx = (float)(v63 + v82.tx) + 0.0;
        v82.ty = (float)(v64 + v82.ty) + 0.0;
        v82.tz = (float)(v59 + -0.3) + (float)(v65 + v82.tz);
        CMatrix::UpdateRW(&v82);
        CEntity::UpdateRwFrame(this->m_pPed);
        CMatrix::~CMatrix(&v81);
        CMatrix::~CMatrix(&v82);
      }
    }
    else
    {
      this->m_fSlopePitch = 0.0;
    }
    v66 = this->m_fSlopeRoll;
    if ( v66 > 0.01 || v66 < -0.01 )
    {
      v67 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 43);
      v68 = *(RtQuat_0 **)(*(_DWORD *)(v6 + 16) + 24 * v67 + 16);
      v69 = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
      v70 = atan2f(v69[v67].at.y, v69[v67].at.x);
      v71 = CGeneral::LimitRadianAngle(v70 - this->m_pPed->m_fCurrentHeading);
      v83.yx = cosf(v71);
      v83.xx = 0.0;
      v83.zx = sinf(v71);
      RtQuatRotate(v68, (const RwV3d_0 *)&v83, (float)(this->m_fSlopeRoll * 180.0) / 3.1416, rwCOMBINEPRECONCAT);
      v72 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 53);
      v73 = *(RtQuat_0 **)(*(_DWORD *)(v6 + 16) + 24 * v72 + 16);
      v74 = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
      v75 = atan2f(v74[v72].at.y, v74[v72].at.x);
      v76 = CGeneral::LimitRadianAngle(v75 - this->m_pPed->m_fCurrentHeading);
      v83.yx = cosf(v76);
      v83.zx = sinf(v76);
      RtQuatRotate(v73, (const RwV3d_0 *)&v83, (float)(this->m_fSlopeRoll * 180.0) / 3.1416, rwCOMBINEPRECONCAT);
      v77 = this->m_pPed;
      v78 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
      v79 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) | 0x4000;
      v80 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
      *(_DWORD *)&v77->m_nPedFlags = this->m_pPed->m_nPedFlags;
      *((_DWORD *)&v77->m_nPedFlags + 1) = v79;
      *((_DWORD *)&v77->m_nPedFlags + 2) = v78;
      *((_DWORD *)&v77->m_nPedFlags + 3) = v80;
    }
    else
    {
      this->m_fSlopeRoll = 0.0;
    }
  }
  this->m_flags &= ~8u;
}
// 4B9AFC: variable 'v1' is possibly undefined
// 4B9AFC: variable 'v2' is possibly undefined
// 4B9B1E: variable 'v3' is possibly undefined
// 4B9E38: using guessed type int dword_4B9E38[2];

//----- (004B9E60) --------------------------------------------------------
void __fastcall CPedStuckChecker::CPedStuckChecker(CPedStuckChecker *this)
{
  *(_DWORD *)&this->m_nStuckCounter = 0;
}

//----- (004B9E68) --------------------------------------------------------
bool __fastcall CPedStuckChecker::TestPedStuck(CPedStuckChecker *this, CPed *pPed, CEventGroup *pEventGroup)
{
  float32x2_t v3; // d3
  float32x2_t v4; // d6
  CEntity::CFlags *p_m_nFlags; // r5
  bool result; // r0
  CTask *SimplestActiveTask; // r0
  CPedIntelligence *m_pPedIntelligence; // r5
  CTask *v12; // r0
  CTask *v13; // r0
  CPedFlags *p_m_nPedFlags; // r8
  uint16 m_nStuckCounter; // r0
  uint16 v16; // r0
  float v17; // s0
  CMatrix *v18; // r1
  float v19; // s4
  float v20; // s2
  CSimpleTransform *p_m_transform; // r2
  __int64 v22; // d16
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  float z; // s2
  float v26; // s10
  float v27; // s8
  float v28; // s6
  unsigned int m_nNoOfCollisionRecords; // r0
  uint16 v30; // r0
  CEntity *v31; // r0
  CMatrix *v32; // r0
  CSimpleTransform *v33; // r9
  CSimpleTransform *v34; // r1
  float v35; // s10
  RwReal v36; // s2
  CMatrix *v37; // r1
  CSimpleTransform *v38; // r0
  RwReal v39; // s2
  RwReal v40; // s4
  float v41; // s18
  CMatrix *v42; // r0
  CSimpleTransform *v43; // r9
  CSimpleTransform *v44; // r1
  int v45; // r0
  int v46; // r1
  int v47; // r2
  int v48; // r3
  CMatrix *v49; // r5
  CEntity *v50; // r5
  float v51; // r0
  float v52; // s0
  CMatrix *v53; // r2
  float *v54; // r0
  CMatrix *v55; // r0
  CSimpleTransform *v56; // r1
  float v57; // s10
  RwReal v58; // s2
  CMatrix *v59; // r1
  CSimpleTransform *v60; // r0
  RwReal v61; // s2
  RwReal v62; // s4
  float v63; // s0
  int v64; // r10
  float x; // s2
  float y; // s0
  float v67; // s0
  float v68; // s2
  CMatrix *v69; // r1
  float v70; // s4
  float v71; // s6
  float v72; // s8
  float *p_tz; // r2
  CMatrix *v74; // r1
  CSimpleTransform *v75; // r2
  float v76; // s2
  CEntity *m_pDamageEntity; // r2
  RwReal v78; // r3
  RwReal v79; // r5
  RwReal v80; // r2
  float RadianAngleBetweenPoints; // r0
  float v82; // r3
  CMatrix *v83; // r0
  float tx; // s16
  float ty; // s18
  float tz; // s20
  CMatrix *v87; // r0
  float v88; // s2
  float v89; // s4
  RwReal *p_z; // r0
  CMatrix *v91; // r0
  CSimpleTransform *v92; // r1
  CVector v93; // [sp+1Ch] [bp-BCh] BYREF
  CVector vecEnd; // [sp+28h] [bp-B0h] BYREF
  CEntity *refEntityPtr; // [sp+34h] [bp-A4h] BYREF
  CVector m_translate; // [sp+38h] [bp-A0h] BYREF
  CColPoint vecStart; // [sp+48h] [bp-90h] BYREF
  CColPoint colPoint; // [sp+74h] [bp-64h] BYREF
  CVector v99; // 0:r1.12

  p_m_nFlags = &pPed->m_nFlags;
  if ( (*(_BYTE *)&pPed->m_nFlags & 1) == 0
    || pPed->m_pAttachToEntity
    || (pPed->m_nPedState & 0xFFFFFFFE) == 54
    || *(_BYTE *)&pPed->m_nPedFlags << 30
    || (!pPed->m_pDamageEntity || pPed->m_fDamageImpulseMagnitude <= 0.0)
    && (!CPed::IsPlayer(pPed) || (*(_BYTE *)p_m_nFlags & 0x10) == 0)
    || (SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager)) != 0
    && (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) == 1304
    || (m_pPedIntelligence = pPed->m_pPedIntelligence, CPed::IsPlayer(m_pPedIntelligence->m_pPed))
    && (v12 = CTaskManager::GetSimplestActiveTask(&m_pPedIntelligence->m_taskManager)) != 0
    && (*((int (__fastcall **)(CTask *))v12->_vptr$CTask + 5))(v12) == 1303
    || (v13 = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager)) != 0
    && (*((int (__fastcall **)(CTask *))v13->_vptr$CTask + 5))(v13) == 254 )
  {
    result = 0;
    *(_DWORD *)&this->m_nStuckCounter = 0;
    return result;
  }
  p_m_nPedFlags = &pPed->m_nPedFlags;
  refEntityPtr = 0;
  m_nStuckCounter = this->m_nStuckCounter;
  if ( (unsigned __int16)(m_nStuckCounter - 1) < 0x2710u )
  {
    m_pMat = pPed->m_pMat;
    v16 = m_nStuckCounter + 1;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    z = this->m_vecPreviousPos.z;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    v26 = p_tx->m_translate.z;
    v17 = p_tx->m_translate.x - this->m_vecPreviousPos.x;
    v19 = p_tx->m_translate.y - this->m_vecPreviousPos.y;
    this->m_nStuckCounter = v16;
    v20 = v26 - z;
  }
  else
  {
    v16 = 1;
    v17 = 0.0;
    *(_DWORD *)&this->m_nStuckCounter = 1;
    v18 = pPed->m_pMat;
    v19 = 0.0;
    v20 = 0.0;
    p_m_transform = (CSimpleTransform *)&v18->tx;
    if ( !v18 )
      p_m_transform = &pPed->m_transform;
    v22 = *(_QWORD *)&p_m_transform->m_translate.x;
    this->m_vecPreviousPos.z = p_m_transform->m_translate.z;
    *(_QWORD *)&this->m_vecPreviousPos.x = v22;
  }
  v4.n64_u32[0] = 1008981770;
  v3.n64_f32[0] = CTimer::ms_fTimeStep;
  v27 = vmax_f32(v3, v4).n64_f32[0];
  v28 = (float)v16;
  if ( (float)(50.0 / (float)(v27 * 4.0)) < v28
    && (float)((float)((float)(v17 * v17) + (float)(v19 * v19)) + (float)(v20 * v20)) < (float)(v28 * 0.01) )
  {
    goto LABEL_29;
  }
  m_nNoOfCollisionRecords = pPed->m_nNoOfCollisionRecords;
  if ( m_nNoOfCollisionRecords < 2 )
  {
    if ( m_nNoOfCollisionRecords != 1 )
      goto LABEL_62;
    v31 = pPed->m_aCollisionRecordPtrs[0];
    if ( !v31
      || (*(_BYTE *)&v31->m_info & 7) != 1
      || (float)(50.0 / (float)(v27 + v27)) >= v28
      || fabsf(v20) >= (float)(v28 * 0.004) )
    {
      goto LABEL_62;
    }
    m_translate.y = v17;
    m_translate.z = 1.0;
    m_translate.x = -v19;
    CVector::Normalise(&m_translate);
    v32 = pPed->m_pMat;
    v33 = &pPed->m_transform;
    v34 = &pPed->m_transform;
    if ( v32 )
      v34 = (CSimpleTransform *)&v32->tx;
    v35 = v34->m_translate.z;
    v36 = v34->m_translate.y + m_translate.y;
    vecStart.m_vecPosition.x = v34->m_translate.x + m_translate.x;
    vecStart.m_vecPosition.y = v36;
    vecStart.m_vecPosition.z = v35 + m_translate.z;
    if ( CWorld::ProcessVerticalLine(&vecStart.m_vecPosition, -20.0, &colPoint, &refEntityPtr, 1, 0, 0, 0, 0, 0, 0) )
    {
      v37 = pPed->m_pMat;
      v38 = &pPed->m_transform;
      if ( v37 )
        v38 = (CSimpleTransform *)&v37->tx;
      v39 = v38->m_translate.y + m_translate.y;
      v40 = v38->m_translate.z + m_translate.z;
      vecEnd.x = v38->m_translate.x + m_translate.x;
      vecEnd.y = v39;
      vecEnd.z = v40;
      if ( CWorld::GetIsLineOfSightClear(&v38->m_translate, &vecEnd, 1, 1, 0, 1, 0, 0, 0) )
        v41 = colPoint.m_vecPosition.z;
      else
        v41 = 5001.0;
    }
    else
    {
      v41 = 5001.0;
    }
    v55 = pPed->m_pMat;
    v56 = &pPed->m_transform;
    if ( v55 )
      v56 = (CSimpleTransform *)&v55->tx;
    v57 = v56->m_translate.z;
    v58 = v56->m_translate.y - m_translate.y;
    vecEnd.x = v56->m_translate.x - m_translate.x;
    vecEnd.y = v58;
    vecEnd.z = v57 - m_translate.z;
    if ( CWorld::ProcessVerticalLine(&vecEnd, -20.0, &vecStart, &refEntityPtr, 1, 0, 0, 0, 0, 0, 0) )
    {
      v59 = pPed->m_pMat;
      v60 = &pPed->m_transform;
      if ( v59 )
        v60 = (CSimpleTransform *)&v59->tx;
      v61 = v60->m_translate.y - m_translate.y;
      v62 = v60->m_translate.z - m_translate.z;
      v93.x = v60->m_translate.x - m_translate.x;
      v93.y = v61;
      v93.z = v62;
      if ( CWorld::GetIsLineOfSightClear(&v60->m_translate, &v93, 1, 1, 0, 1, 0, 0, 0) )
        v63 = vecStart.m_vecPosition.z;
      else
        v63 = 5002.0;
    }
    else
    {
      v63 = 5002.0;
    }
    if ( v41 > 5000.0 )
    {
      v64 = -1;
      goto LABEL_81;
    }
    v74 = pPed->m_pMat;
    v75 = (CSimpleTransform *)&v74->tx;
    if ( !v74 )
      v75 = &pPed->m_transform;
    v76 = v75->m_translate.z + -1.0;
    if ( v41 >= 5000.0 || v41 <= v76 || (v64 = 1, v63 >= 5001.0) )
    {
      v64 = 0;
      if ( v63 >= 5001.0 || v63 <= v76 )
        goto LABEL_81;
      v64 = 2;
    }
    if ( (*((_BYTE *)&pPed->m_nPedFlags + 6) & 0x20) != 0
      || pPed->m_fDamageImpulseMagnitude > 0.0
      && (m_pDamageEntity = pPed->m_pDamageEntity) != 0
      && (*(_BYTE *)&m_pDamageEntity->m_info & 7) == 3
      && pPed->m_vecDamageNormal.z > 0.3 )
    {
LABEL_81:
      x = m_translate.x;
      if ( v41 >= v63 )
      {
        y = m_translate.y;
      }
      else
      {
        x = -m_translate.x;
        y = -m_translate.y;
        m_translate.x = -m_translate.x;
        m_translate.y = -m_translate.y;
        m_translate.z = -m_translate.z;
      }
      m_translate.z = 1.0;
      v99.z = 4.0;
      v99.x = x * 4.0;
      v99.y = y * 4.0;
      CPhysical::ApplyMoveForce(pPed, v99);
      if ( v64 >= 0 )
      {
        v67 = m_translate.x;
        v68 = m_translate.y;
        v69 = pPed->m_pMat;
        if ( v69 )
          v33 = (CSimpleTransform *)&v69->tx;
        v70 = (float)(m_translate.z * 0.25) + v33->m_translate.z;
        v71 = (float)(m_translate.y * 0.25) + v33->m_translate.y;
        v72 = (float)(m_translate.x * 0.25) + v33->m_translate.x;
        if ( v69 )
        {
          v69->tx = v72;
          pPed->m_pMat->ty = v71;
          p_tz = &pPed->m_pMat->tz;
        }
        else
        {
          p_tz = &pPed->m_transform.m_translate.z;
          pPed->m_transform.m_translate.x = v72;
          pPed->m_transform.m_translate.y = v71;
        }
        *p_tz = v70;
        RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(v67, v68, 0.0, 0.0);
        pPed->m_fCurrentHeading = RadianAngleBetweenPoints;
        v82 = CGeneral::LimitRadianAngle(RadianAngleBetweenPoints);
        v83 = pPed->m_pMat;
        pPed->m_fCurrentHeading = v82;
        pPed->m_fDesiredHeading = v82;
        if ( v83 )
        {
          tx = v83->tx;
          ty = v83->ty;
          tz = v83->tz;
          CMatrix::SetRotate(v83, 0.0, 0.0, v82);
          v87 = pPed->m_pMat;
          v88 = ty + v87->ty;
          v89 = tz + v87->tz;
          v87->tx = tx + v87->tx;
          v87->ty = v88;
          v87->tz = v89;
          v30 = 2;
LABEL_31:
          this->m_nStuck = v30;
          goto LABEL_62;
        }
        pPed->m_transform.m_heading = v82;
      }
      v30 = 2;
      goto LABEL_31;
    }
    if ( v64 == 2 )
    {
      v79 = vecStart.m_vecPosition.x;
      v78 = vecStart.m_vecPosition.y;
      v80 = vecStart.m_vecPosition.z;
      if ( !v74 )
        goto LABEL_112;
    }
    else
    {
      v79 = colPoint.m_vecPosition.x;
      v78 = colPoint.m_vecPosition.y;
      v80 = colPoint.m_vecPosition.z;
      if ( !v74 )
      {
LABEL_112:
        p_z = &pPed->m_transform.m_translate.z;
        pPed->m_transform.m_translate.x = v79;
        pPed->m_transform.m_translate.y = v78;
        goto LABEL_113;
      }
    }
    v74->tx = v79;
    pPed->m_pMat->ty = v78;
    p_z = &pPed->m_pMat->tz;
LABEL_113:
    *p_z = v80;
    v91 = pPed->m_pMat;
    v92 = &pPed->m_transform;
    if ( v91 )
      v92 = (CSimpleTransform *)&v91->tx;
    v92->m_translate.z = v92->m_translate.z + 1.0;
    goto LABEL_81;
  }
  if ( (float)(50.0 / (float)(v27 + v27)) < v28 && fabsf(v20) < (float)(v28 * 0.004) )
  {
LABEL_29:
    if ( !((CTimer::m_FrameCounter + pPed->RandomSeed + 3) << 29) )
    {
      v42 = pPed->m_pMat;
      v43 = &pPed->m_transform;
      v44 = &pPed->m_transform;
      if ( v42 )
        v44 = (CSimpleTransform *)&v42->tx;
      m_translate = v44->m_translate;
      m_translate.z = m_translate.z + 1.0;
      if ( CWorld::ProcessVerticalLine(
             &m_translate,
             v44->m_translate.z + -1.0,
             &colPoint,
             &refEntityPtr,
             1,
             1,
             0,
             1,
             0,
             0,
             0) )
      {
        v45 = *(_DWORD *)p_m_nPedFlags;
        v46 = *((_DWORD *)&pPed->m_nPedFlags + 1);
        v47 = *((_DWORD *)&pPed->m_nPedFlags + 2);
        v48 = *((_DWORD *)&pPed->m_nPedFlags + 3);
        if ( (v46 & 0x200000) == 0 )
          goto LABEL_118;
        v49 = pPed->m_pMat;
        if ( v49 )
          v43 = (CSimpleTransform *)&v49->tx;
        if ( (float)(colPoint.m_vecPosition.z + 1.0) < v43->m_translate.z )
        {
LABEL_118:
          if ( pPed->m_fDamageImpulseMagnitude <= 0.0
            || (v50 = pPed->m_pDamageEntity) == 0
            || (*(_BYTE *)&v50->m_info & 7) != 3
            || pPed->m_vecDamageNormal.z <= 0.3 )
          {
            v51 = m_translate.y;
            v52 = colPoint.m_vecPosition.z + 1.0;
            m_translate.z = colPoint.m_vecPosition.z + 1.0;
            v53 = pPed->m_pMat;
            if ( v53 )
            {
              v53->tx = m_translate.x;
              pPed->m_pMat->ty = v51;
              v54 = &pPed->m_pMat->tz;
            }
            else
            {
              pPed->m_transform.m_translate.x = m_translate.x;
              pPed->m_transform.m_translate.y = v51;
              v54 = &pPed->m_transform.m_translate.z;
            }
            *v54 = v52;
            v45 = *(_DWORD *)p_m_nPedFlags;
            v46 = *((_DWORD *)&pPed->m_nPedFlags + 1);
            v47 = *((_DWORD *)&pPed->m_nPedFlags + 2);
            v48 = *((_DWORD *)&pPed->m_nPedFlags + 3);
            if ( (v46 & 0x200000) != 0 )
            {
              v46 &= ~0x200000u;
              *(_DWORD *)p_m_nPedFlags = v45;
              *((_DWORD *)&pPed->m_nPedFlags + 1) = v46;
              *((_DWORD *)&pPed->m_nPedFlags + 2) = v47;
              *((_DWORD *)&pPed->m_nPedFlags + 3) = v48;
            }
          }
        }
        *(_DWORD *)p_m_nPedFlags = v45 | 1;
        *((_DWORD *)&pPed->m_nPedFlags + 1) = v46;
        *((_DWORD *)&pPed->m_nPedFlags + 2) = v47;
        *((_DWORD *)&pPed->m_nPedFlags + 3) = v48;
        *(_DWORD *)&this->m_nStuckCounter = 0;
      }
      goto LABEL_62;
    }
    v30 = 1;
    goto LABEL_31;
  }
LABEL_62:
  if ( !this->m_nStuck )
    return 0;
  if ( CEventGroup::GetEventOfType(pEventGroup, 66)
    && *(float *)&CEventGroup::GetEventOfType(pEventGroup, 66)[1]._vptr$CEvent > 1.0 )
  {
    *(_DWORD *)p_m_nPedFlags &= ~1u;
    return 0;
  }
  else
  {
    CEventStuckInAir::CEventStuckInAir((CEventStuckInAir *)&colPoint, pPed);
    CEventGroup::Add(pEventGroup, (CEvent *)&colPoint, 0);
    CEventStuckInAir::~CEventStuckInAir((CEventStuckInAir *)&colPoint);
    return 1;
  }
}
// 4B9FBA: variable 'v3' is possibly undefined
// 4B9FBA: variable 'v4' is possibly undefined

//----- (004BA61C) --------------------------------------------------------
CTaskSimpleSwim *__fastcall CPedIntelligence::GetTaskSwim(const CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTaskSimpleSwim *v2; // r4

  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  v2 = (CTaskSimpleSwim *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    return 0;
  if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 1304 )
    return 0;
  return v2;
}

//----- (004BA644) --------------------------------------------------------
CTaskSimpleJetPack *__fastcall CPedIntelligence::GetTaskJetPack(const CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTaskSimpleJetPack *v3; // r4

  if ( !CPed::IsPlayer(this->m_pPed) )
    return 0;
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  v3 = (CTaskSimpleJetPack *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    return 0;
  if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 1303 )
    return 0;
  return v3;
}

//----- (004BA67A) --------------------------------------------------------
CTaskSimpleClimb *__fastcall CPedIntelligence::GetTaskClimb(const CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTaskSimpleClimb *v2; // r4

  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  v2 = (CTaskSimpleClimb *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    return 0;
  if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 254 )
    return 0;
  return v2;
}

//----- (004BA6A0) --------------------------------------------------------
void __fastcall CEntityScanner::CEntityScanner(CEntityScanner *this)
{
  *(_QWORD *)&this->m_entities[13] = 0LL;
  *(_QWORD *)&this->m_entities[15] = 0LL;
  *(_QWORD *)&this->m_entities[10] = 0LL;
  *(_QWORD *)&this->m_entities[12] = 0LL;
  *(_QWORD *)&this->m_entities[6] = 0LL;
  *(_QWORD *)&this->m_entities[8] = 0LL;
  this->_vptr$CEntityScanner = (int (**)(void))&off_669070;
  this->m_timer = 0LL;
  *(_QWORD *)this->m_entities = 0LL;
  this->m_timer.m_iPeriod = 16;
  *(_QWORD *)&this->m_entities[2] = 0LL;
  *(_QWORD *)&this->m_entities[4] = 0LL;
}
// 669070: using guessed type void *;

//----- (004BA6DC) --------------------------------------------------------
void __fastcall CEntityScanner::Clear(CEntityScanner *this)
{
  CEntity **m_entities; // r6
  int i; // r4
  CEntity *v4; // r0
  CEntity *v5; // r0
  CEntity **p_m_pClosestEntity; // r8
  CEntity *m_pClosestEntity; // t1

  m_entities = this->m_entities;
  for ( i = 0; i != 16; ++i )
  {
    v4 = m_entities[i];
    if ( v4 )
    {
      CEntity::CleanUpOldReference(v4, &m_entities[i]);
      m_entities[i] = 0;
    }
  }
  m_pClosestEntity = this->m_pClosestEntity;
  p_m_pClosestEntity = &this->m_pClosestEntity;
  v5 = m_pClosestEntity;
  if ( m_pClosestEntity )
  {
    CEntity::CleanUpOldReference(v5, p_m_pClosestEntity);
    *p_m_pClosestEntity = 0;
  }
}

//----- (004BA720) --------------------------------------------------------
void __fastcall CEntityScanner::ScanForEntitiesInRange(CEntityScanner *this, const int iScanType, const CPed *ped)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  CEntityScanner *v5; // r4
  bool v8; // cc
  CTickCounter m_timer; // r0
  CEntity **m_entities; // r10
  int i; // r5
  CEntity *v12; // r0
  CEntity *m_pClosestEntity; // r0
  CPedIntelligence *m_pPedIntelligence; // r0
  CMatrix *m_pMat; // r1
  float v16; // s16
  CSimpleTransform *p_tx; // r8
  float x; // s18
  float y; // s20
  float v20; // r6
  float v21; // r0
  int v22; // r5
  int v23; // r1
  int v24; // r0
  int v25; // r6
  int v26; // s0
  uint16 v27; // r0
  CEntityScanner *v28; // r3
  _BOOL4 v29; // r4
  float32x2_t *p_y; // r12
  CEntity **v31; // lr
  CEntity **v32; // r11
  int v33; // r6
  int v34; // r2
  int v35; // r2
  CRepeatSector *v36; // r2
  CPtrNode *m_pHead; // r9
  CPtrNode v38; // kr00_8
  bool v39; // zf
  int v40; // r3
  int v41; // r5
  float32x2_t v42; // d16
  float32x2_t v43; // d3
  float v44; // s4
  CEntityScanner *v45; // r4
  int v46; // r5
  float v47; // r12
  __int64 *v48; // r8
  int v49; // r5
  float v50; // r3
  int v51; // r3
  _DWORD *v52; // r11
  _DWORD *v53; // r10
  int v54; // lr
  int v55; // t1
  int v56; // r2
  CEntity *v57; // r0
  CEntity **ppAddress; // [sp+0h] [bp-140h]
  int v59; // [sp+20h] [bp-120h]
  int v60; // [sp+24h] [bp-11Ch]
  int v61; // [sp+48h] [bp-F8h]
  int v62; // [sp+58h] [bp-E8h]
  int v63; // [sp+60h] [bp-E0h]
  CEntity **v64; // [sp+64h] [bp-DCh]
  CEntity **v65; // [sp+68h] [bp-D8h]
  float32x2_t *v66; // [sp+6Ch] [bp-D4h]
  CSimpleTransform *v67; // [sp+70h] [bp-D0h]
  CEntity **v68; // [sp+74h] [bp-CCh]
  CEntity **v69; // [sp+78h] [bp-C8h]
  CEntity **v70; // [sp+7Ch] [bp-C4h]
  CEntity **v71; // [sp+80h] [bp-C0h]
  CEntity **v72; // [sp+84h] [bp-BCh]
  CEntity **v73; // [sp+88h] [bp-B8h]
  int v74; // [sp+8Ch] [bp-B4h]
  CEntity **v75; // [sp+90h] [bp-B0h]
  CEntity **v76; // [sp+94h] [bp-ACh]
  CEntity **v77; // [sp+98h] [bp-A8h]
  CEntity **v78; // [sp+9Ch] [bp-A4h]
  CEntity **v79; // [sp+A0h] [bp-A0h]
  CEntity **v80; // [sp+A4h] [bp-9Ch]
  CEntity **v81; // [sp+A8h] [bp-98h]
  _BOOL4 v82; // [sp+ACh] [bp-94h]
  CPlayerPed *PlayerPed; // [sp+B0h] [bp-90h]
  CEntityScanner *v84; // [sp+B0h] [bp-90h]
  float v85; // [sp+B4h] [bp-8Ch]
  __int64 v86; // [sp+B8h] [bp-88h] BYREF
  __int64 v87; // [sp+C0h] [bp-80h] BYREF
  __int64 v88; // [sp+C8h] [bp-78h] BYREF
  __int64 v89; // [sp+D0h] [bp-70h] BYREF
  __int64 v90; // [sp+D8h] [bp-68h] BYREF
  __int64 v91; // [sp+E0h] [bp-60h] BYREF
  __int64 v92; // [sp+E8h] [bp-58h] BYREF
  _QWORD v93[10]; // [sp+F0h] [bp-50h] BYREF

  v5 = this;
  m_timer = this->m_timer;
  v8 = m_timer.m_iCount < m_timer.m_iPeriod;
  m_timer.m_iPeriod = 0;
  if ( v8 )
    m_timer.m_iPeriod = m_timer.m_iCount + 1;
  v5->m_timer.m_iCount = m_timer.m_iPeriod;
  if ( !m_timer.m_iCount )
  {
    m_entities = v5->m_entities;
    for ( i = 0; i != 16; ++i )
    {
      v12 = m_entities[i];
      if ( v12 )
      {
        CEntity::CleanUpOldReference(v12, &m_entities[i]);
        m_entities[i] = 0;
      }
    }
    m_pClosestEntity = v5->m_pClosestEntity;
    if ( m_pClosestEntity )
    {
      CEntity::CleanUpOldReference(m_pClosestEntity, &v5->m_pClosestEntity);
      v5->m_pClosestEntity = 0;
    }
    ppAddress = &v5->m_pClosestEntity;
    PlayerPed = FindPlayerPed(-1);
    m_pPedIntelligence = ped->m_pPedIntelligence;
    v3.n64_u32[0] = LODWORD(m_pPedIntelligence->m_fHearingRange);
    v4.n64_u32[0] = LODWORD(m_pPedIntelligence->m_fSeeingRange);
    m_pMat = ped->m_pMat;
    LODWORD(v16) = vmax_f32(v3, v4).n64_u32[0];
    v90 = 0x7F7FFFFF7F7FFFFFLL;
    v91 = 0x7F7FFFFF7F7FFFFFLL;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    v92 = 0x7F7FFFFF7F7FFFFFLL;
    v93[0] = 0x7F7FFFFF7F7FFFFFLL;
    v86 = 0x7F7FFFFF7F7FFFFFLL;
    v87 = 0x7F7FFFFF7F7FFFFFLL;
    v88 = 0x7F7FFFFF7F7FFFFFLL;
    v89 = 0x7F7FFFFF7F7FFFFFLL;
    if ( !m_pMat )
      p_tx = &ped->m_transform;
    x = p_tx->m_translate.x;
    y = p_tx->m_translate.y;
    v85 = floorf((float)((float)(p_tx->m_translate.x - v16) / 50.0) + 60.0);
    v20 = floorf((float)((float)(y - v16) / 50.0) + 60.0);
    v21 = floorf((float)((float)(v16 + y) / 50.0) + 60.0);
    v22 = 119;
    v23 = 0;
    v24 = (int)v21;
    if ( v24 >= 119 )
      v24 = 119;
    v60 = v24;
    v25 = (int)v20;
    if ( v25 <= 0 )
      v25 = 0;
    if ( (int)v85 > 0 )
      v23 = (int)v85;
    v59 = v23;
    v26 = (int)floorf((float)((float)(v16 + x) / 50.0) + 60.0);
    if ( v26 < 119 )
      v22 = v26;
    v63 = v22;
    if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
    {
      CWorld::ClearScanCodes();
      v27 = 1;
    }
    else
    {
      v27 = CWorld::ms_nCurrentScanCode + 1;
    }
    CWorld::ms_nCurrentScanCode = v27;
    ped->m_nScanCode = v27;
    if ( v25 <= v60 )
    {
      v61 = v25;
      v28 = v5;
      v4.n64_u32[0] = 15.0;
      v29 = iScanType != 1 || PlayerPed == ped;
      v69 = &v28->m_entities[15];
      v70 = &v28->m_entities[14];
      v71 = &v28->m_entities[13];
      v72 = &v28->m_entities[12];
      v73 = &v28->m_entities[11];
      v75 = &v28->m_entities[10];
      v76 = &v28->m_entities[9];
      v77 = &v28->m_entities[6];
      p_y = (float32x2_t *)&p_tx->m_translate.y;
      v78 = &v28->m_entities[5];
      v79 = &v28->m_entities[4];
      v80 = &v28->m_entities[3];
      v81 = &v28->m_entities[2];
      LODWORD(v85) = &v28->m_entities[1];
      v31 = &v28->m_entities[8];
      v32 = &v28->m_entities[7];
      v33 = 0;
      v84 = v28;
      v68 = m_entities;
      v62 = iScanType;
      v66 = (float32x2_t *)&p_tx->m_translate.y;
      v67 = p_tx;
      v82 = v29;
      v64 = &v28->m_entities[7];
      v65 = &v28->m_entities[8];
      while ( 1 )
      {
        if ( v59 > v63 )
          goto LABEL_116;
        v34 = v59;
        do
        {
          v74 = v34;
          v35 = v34 & 0xF | (unsigned __int8)(16 * v61);
          if ( iScanType == 2 )
          {
            v36 = (CRepeatSector *)&CWorld::ms_aRepeatSectors[v35].m_ptrListArray[2];
          }
          else if ( iScanType == 1 )
          {
            v36 = (CRepeatSector *)&CWorld::ms_aRepeatSectors[v35].m_ptrListArray[1];
          }
          else if ( iScanType )
          {
            v36 = 0;
          }
          else
          {
            v36 = &CWorld::ms_aRepeatSectors[v35];
          }
          m_pHead = v36->m_ptrListArray[0].m_pHead;
          while ( m_pHead )
          {
            v38 = *m_pHead;
            m_pHead = m_pHead->m_pNext;
            if ( *((unsigned __int16 *)v38.m_pVoid + 24) != v27 )
            {
              *((_WORD *)v38.m_pVoid + 24) = v27;
              v39 = !v29;
              if ( !v29 )
                v39 = *((_DWORD *)v38.m_pVoid + 275) == 55;
              if ( !v39 )
              {
                v40 = *((_DWORD *)v38.m_pVoid + 5);
                v41 = v40 + 48;
                if ( !v40 )
                  v41 = (int)v38.m_pVoid + 4;
                v42.n64_u64[0] = vsub_f32(*(float32x2_t *)(v41 + 4), (float32x2_t)p_y->n64_u64[0]).n64_u64[0];
                v43.n64_u64[0] = vmul_f32(v42, v42).n64_u64[0];
                v44 = (float)((float)((float)(*(float *)v41 - p_tx->m_translate.x)
                                    * (float)(*(float *)v41 - p_tx->m_translate.x))
                            + v43.n64_f32[0])
                    + v43.n64_f32[1];
                if ( v44 < (float)(v16 * v16) )
                {
                  if ( !*m_entities )
                  {
                    v49 = 0;
                    v50 = *(float *)&m_entities;
                    goto LABEL_35;
                  }
                  if ( v44 < *(float *)&v86 )
                  {
                    v48 = &v86;
                    v46 = 0;
                    v47 = *(float *)&m_entities;
                    goto LABEL_107;
                  }
                  if ( !*(_DWORD *)LODWORD(v85) )
                  {
                    v49 = 1;
                    v50 = v85;
                    goto LABEL_35;
                  }
                  v45 = v84;
                  if ( v44 < *((float *)&v86 + 1) )
                  {
                    v46 = 1;
                    v47 = v85;
                    v48 = (__int64 *)((char *)&v86 + 4);
                    goto LABEL_108;
                  }
                  if ( !*v81 )
                  {
                    v49 = 2;
                    v50 = *(float *)&v81;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *(float *)&v87 )
                  {
                    v46 = 2;
                    v47 = *(float *)&v81;
                    v48 = &v87;
                    goto LABEL_108;
                  }
                  if ( !*v80 )
                  {
                    v49 = 3;
                    v50 = *(float *)&v80;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *((float *)&v87 + 1) )
                  {
                    v46 = 3;
                    v47 = *(float *)&v80;
                    v48 = (__int64 *)((char *)&v87 + 4);
                    goto LABEL_108;
                  }
                  if ( !*v79 )
                  {
                    v49 = 4;
                    v50 = *(float *)&v79;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *(float *)&v88 )
                  {
                    v46 = 4;
                    v47 = *(float *)&v79;
                    v48 = &v88;
                    goto LABEL_108;
                  }
                  if ( !*v78 )
                  {
                    v49 = 5;
                    v50 = *(float *)&v78;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *((float *)&v88 + 1) )
                  {
                    v46 = 5;
                    v47 = *(float *)&v78;
                    v48 = (__int64 *)((char *)&v88 + 4);
                    goto LABEL_108;
                  }
                  if ( !*v77 )
                  {
                    v49 = 6;
                    v50 = *(float *)&v77;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *(float *)&v89 )
                  {
                    v46 = 6;
                    v47 = *(float *)&v77;
                    v48 = &v89;
                    goto LABEL_108;
                  }
                  if ( !*v32 )
                  {
                    v49 = 7;
                    v50 = *(float *)&v32;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *((float *)&v89 + 1) )
                  {
                    v46 = 7;
                    v47 = *(float *)&v32;
                    v48 = (__int64 *)((char *)&v89 + 4);
                    goto LABEL_108;
                  }
                  if ( !*v31 )
                  {
                    v49 = 8;
                    v50 = *(float *)&v31;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *(float *)&v90 )
                  {
                    v46 = 8;
                    v47 = *(float *)&v31;
                    v48 = &v90;
                    goto LABEL_108;
                  }
                  if ( !*v76 )
                  {
                    v49 = 9;
                    v50 = *(float *)&v76;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *((float *)&v90 + 1) )
                  {
                    v46 = 9;
                    v47 = *(float *)&v76;
                    v48 = (__int64 *)((char *)&v90 + 4);
                    goto LABEL_108;
                  }
                  if ( !*v75 )
                  {
                    v49 = 10;
                    v50 = *(float *)&v75;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *(float *)&v91 )
                  {
                    v46 = 10;
                    v47 = *(float *)&v75;
                    v48 = &v91;
                    goto LABEL_108;
                  }
                  if ( !*v73 )
                  {
                    v49 = 11;
                    v50 = *(float *)&v73;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *((float *)&v91 + 1) )
                  {
                    v46 = 11;
                    v47 = *(float *)&v73;
                    v48 = (__int64 *)((char *)&v91 + 4);
                    goto LABEL_108;
                  }
                  if ( !*v72 )
                  {
                    v49 = 12;
                    v50 = *(float *)&v72;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *(float *)&v92 )
                  {
                    v46 = 12;
                    v47 = *(float *)&v72;
                    v48 = &v92;
                    goto LABEL_108;
                  }
                  if ( !*v71 )
                  {
                    v49 = 13;
                    v50 = *(float *)&v71;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  if ( v44 < *((float *)&v92 + 1) )
                  {
                    v46 = 13;
                    v47 = *(float *)&v71;
                    v48 = (__int64 *)((char *)&v92 + 4);
                    goto LABEL_108;
                  }
                  if ( !*v70 )
                  {
                    v49 = 14;
                    v50 = *(float *)&v70;
                    v29 = v82;
                    goto LABEL_35;
                  }
                  v29 = v82;
                  if ( v44 < *(float *)v93 )
                  {
                    v46 = 14;
                    v47 = *(float *)&v70;
                    v48 = v93;
                    goto LABEL_107;
                  }
                  if ( *v69 )
                  {
                    if ( v44 < *((float *)v93 + 1) )
                    {
                      v46 = 15;
                      v47 = *(float *)&v69;
                      v48 = (_QWORD *)((char *)v93 + 4);
LABEL_107:
                      v45 = v84;
LABEL_108:
                      v43.n64_f32[0] = (float)v33;
                      v51 = (int)vmin_f32(v43, v4).n64_f32[0];
                      if ( v46 < v51 )
                      {
                        v52 = (_DWORD *)&v86 + v51;
                        v53 = v52;
                        do
                        {
                          v54 = (int)v45 + 4 * v51--;
                          *(_DWORD *)(v54 + 12) = *(_DWORD *)(v54 + 8);
                          v55 = *--v53;
                          *v52 = v55;
                          v52 = v53;
                        }
                        while ( v51 > v46 );
                      }
                      *(_DWORD *)LODWORD(v47) = v38.m_pVoid;
                      v56 = 0;
                      *(float *)v48 = v44;
                      if ( v33 < 16 )
                        v56 = 1;
                      m_entities = v68;
                      p_y = v66;
                      p_tx = v67;
                      v33 += v56;
                      v29 = v82;
                      v32 = v64;
                      v31 = v65;
                    }
                  }
                  else
                  {
                    v49 = 15;
                    v50 = *(float *)&v69;
LABEL_35:
                    *(_DWORD *)LODWORD(v50) = v38.m_pVoid;
                    *((float *)&v86 + v49) = v44;
                    ++v33;
                  }
                }
              }
            }
          }
          iScanType = v62;
          v34 = v74 + 1;
        }
        while ( v74 < v63 );
LABEL_116:
        v8 = v61++ < v60;
        if ( !v8 )
        {
          v5 = v84;
          if ( v33 >= 1 )
          {
            do
            {
              if ( *m_entities )
                CEntity::RegisterReference(*m_entities, m_entities);
              ++m_entities;
              --v33;
            }
            while ( v33 );
          }
          break;
        }
      }
    }
    v57 = v5->m_entities[0];
    if ( v57 )
    {
      *ppAddress = v57;
      CEntity::RegisterReference(v57, ppAddress);
    }
  }
}
// 4BA7AE: variable 'v3' is possibly undefined
// 4BA7AE: variable 'v4' is possibly undefined

//----- (004BAE54) --------------------------------------------------------
void __fastcall CVehicleScanner::ScanForVehiclesInRange(CVehicleScanner *this, const CPed *ped)
{
  CVehicle *m_pMyVehicle; // r0
  bool v5; // zf
  CEntity *v6; // r0
  CEntity **p_m_pClosestEntity; // r4
  CEntity *m_pClosestEntity; // t1
  CVehicle *v9; // r0

  if ( CPed::IsAlive(ped) )
  {
    m_pMyVehicle = ped->m_pMyVehicle;
    v5 = m_pMyVehicle == 0;
    if ( m_pMyVehicle )
      v5 = *((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31 == 0;
    if ( v5 )
    {
      CEntityScanner::ScanForEntitiesInRange(this, 0, ped);
    }
    else
    {
      if ( ped->CharCreatedBy == 2 )
        CEntityScanner::ScanForEntitiesInRange(this, 0, ped);
      m_pClosestEntity = this->m_pClosestEntity;
      p_m_pClosestEntity = &this->m_pClosestEntity;
      v6 = m_pClosestEntity;
      if ( m_pClosestEntity )
        CEntity::CleanUpOldReference(v6, p_m_pClosestEntity);
      v9 = ped->m_pMyVehicle;
      *p_m_pClosestEntity = v9;
      if ( v9 )
        sub_196050(v9, p_m_pClosestEntity);
    }
  }
}

//----- (004BAEBC) --------------------------------------------------------
CVehicle *__fastcall CVehicleScanner::GetClosestVehicleInRange(const CVehicleScanner *this)
{
  return (CVehicle *)this->m_pClosestEntity;
}

//----- (004BAEC0) --------------------------------------------------------
void __fastcall CPedScanner::ScanForPedsInRange(CPedScanner *this, const CPed *ped)
{
  if ( CPed::IsAlive(ped) )
    CEntityScanner::ScanForEntitiesInRange(this, 1, ped);
}

//----- (004BAEE0) --------------------------------------------------------
CPed *__fastcall CPedScanner::GetClosestPedInRange(const CPedScanner *this)
{
  return (CPed *)this->m_pClosestEntity;
}

//----- (004BAEE4) --------------------------------------------------------
void __fastcall CObjectScanner::ScanForObjectsInRange(CObjectScanner *this, const CPed *ped)
{
  CVehicle *m_pMyVehicle; // r0
  bool v5; // zf

  m_pMyVehicle = ped->m_pMyVehicle;
  v5 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
    v5 = *((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31 == 0;
  if ( v5 && CPed::IsAlive(ped) )
    CEntityScanner::ScanForEntitiesInRange(this, 2, ped);
}

//----- (004BAF18) --------------------------------------------------------
CObject *__fastcall CObjectScanner::GetClosestObjectInRange(const CObjectScanner *this)
{
  return (CObject *)this->m_pClosestEntity;
}

//----- (004BAF1C) --------------------------------------------------------
void __fastcall CAttractorScanner::CAttractorScanner(CAttractorScanner *this)
{
  __int64 v1; // d16
  __int64 v2; // d17

  *(_WORD *)&this->m_timer.m_bIsActive = 0;
  this->m_bActivated = 1;
  *(float *)&v1 = 25.0;
  *((float *)&v1 + 1) = 25.0;
  *(float *)&v2 = 25.0;
  *((float *)&v2 + 1) = 25.0;
  *(_QWORD *)&this->m_pPreviousEntity = 0LL;
  *(_QWORD *)&this->m_entities[1] = 0LL;
  this->m_pPreviousEffect = 0;
  *(_QWORD *)this->m_effects = 0LL;
  *(_QWORD *)&this->m_effects[2] = 0LL;
  this->m_timer.m_iStartTime = 0;
  this->m_timer.m_iDuration = 0;
  *(_QWORD *)this->m_minDistanceSquared = v1;
  *(_QWORD *)&this->m_minDistanceSquared[2] = v2;
  this->m_entities[3] = 0;
  this->m_entities[4] = 0;
  this->m_minDistanceSquared[5] = 25.0;
  this->m_minDistanceSquared[6] = 25.0;
  this->m_minDistanceSquared[4] = 15.0 * 15.0;
  *(_QWORD *)&this->m_effects[4] = 0LL;
  *(_QWORD *)&this->m_effects[6] = 0LL;
  *(_QWORD *)&this->m_entities[5] = 0LL;
  *(_QWORD *)&this->m_entities[7] = 0LL;
  this->m_minDistanceSquared[7] = 15.0 * 15.0;
  this->m_entities[9] = 0;
  this->m_effects[8] = 0;
  this->m_effects[9] = 0;
  this->m_minDistanceSquared[8] = 25.0;
  this->m_minDistanceSquared[9] = 25.0;
}

//----- (004BAF90) --------------------------------------------------------
void __fastcall CAttractorScanner::Clear(CAttractorScanner *this)
{
  __int64 v1; // d16
  __int64 v2; // d17

  *(float *)&v1 = 25.0;
  *((float *)&v1 + 1) = 25.0;
  *(float *)&v2 = 25.0;
  *((float *)&v2 + 1) = 25.0;
  *(_QWORD *)this->m_entities = 0LL;
  *(_QWORD *)&this->m_entities[2] = 0LL;
  *(_QWORD *)this->m_minDistanceSquared = v1;
  *(_QWORD *)&this->m_minDistanceSquared[2] = v2;
  *(_QWORD *)this->m_effects = 0LL;
  *(_QWORD *)&this->m_effects[2] = 0LL;
  this->m_effects[4] = 0;
  this->m_minDistanceSquared[4] = 15.0 * 15.0;
  *(_QWORD *)&this->m_effects[5] = 0LL;
  *(_QWORD *)&this->m_effects[7] = 0LL;
  *(_QWORD *)&this->m_entities[6] = 0LL;
  *(_QWORD *)&this->m_entities[8] = 0LL;
  this->m_minDistanceSquared[7] = 15.0 * 15.0;
  this->m_entities[4] = 0;
  this->m_entities[5] = 0;
  this->m_minDistanceSquared[5] = 25.0;
  this->m_minDistanceSquared[6] = 25.0;
  this->m_effects[9] = 0;
  this->m_minDistanceSquared[8] = 25.0;
  this->m_minDistanceSquared[9] = 25.0;
}

//----- (004BAFF8) --------------------------------------------------------
void __fastcall CAttractorScanner::ScanForAttractorsInRange(CAttractorScanner *this, const CPed *ped)
{
  CTask *ActiveTask; // r0
  __int64 v5; // r0
  unsigned int v6; // r0
  int m_iStartTime; // r1
  __int64 v8; // d16
  __int64 v9; // d17
  int v10; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float x; // s18
  float y; // s20
  float v15; // s0
  float v16; // s2
  float v17; // s20
  float v18; // r9
  int v19; // r4
  int v20; // r1
  int v21; // r3
  int v22; // r0
  int v23; // r10
  int v24; // r9
  int v25; // r0
  int v27; // r6
  int v28; // r5
  C2dEffect (**m_nModelIndex)[64]; // r1
  bool *v30; // r4
  C2dEffect *v31; // r6
  int32 m_nPedType; // r12
  int m_bUseList; // r0
  bool v34; // zf
  int v35; // r3
  int v36; // r10
  int v37; // lr
  C2dEffect *v38; // r6
  CEntity *v39; // r8
  CEntity *v40; // r8
  int v41; // [sp+Ch] [bp-84h]
  CPed *v42; // [sp+10h] [bp-80h]
  int v43; // [sp+14h] [bp-7Ch]
  CAttractorScanner *v44; // [sp+18h] [bp-78h]
  int v45; // [sp+1Ch] [bp-74h]
  CEventAttractor v46; // [sp+24h] [bp-6Ch] BYREF
  CEntity *pEntity; // [sp+40h] [bp-50h] BYREF
  C2dEffect *pEffect; // [sp+44h] [bp-4Ch] BYREF

  if ( this->m_bActivated && !(*((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31) )
  {
    ActiveTask = CTaskManager::GetActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    if ( ActiveTask && (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 233 )
    {
      v5 = CTimer::m_snTimeInMilliseconds | 0xBB800000000LL;
      this->m_timer.m_bIsActive = 1;
      *(_QWORD *)&this->m_timer.m_iStartTime = v5;
    }
    else
    {
      if ( !this->m_timer.m_bIsActive )
      {
        *(_QWORD *)&this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds | 0x5DC00000000LL;
        this->m_timer.m_bIsActive = 1;
      }
      if ( this->m_timer.m_bIsStopped )
      {
        v6 = CTimer::m_snTimeInMilliseconds;
        this->m_timer.m_bIsStopped = 0;
        this->m_timer.m_iStartTime = v6;
        m_iStartTime = v6;
      }
      else
      {
        m_iStartTime = this->m_timer.m_iStartTime;
        v6 = CTimer::m_snTimeInMilliseconds;
      }
      if ( m_iStartTime + this->m_timer.m_iDuration <= v6 )
      {
        *(float *)&v8 = 25.0;
        *((float *)&v8 + 1) = 25.0;
        *(float *)&v9 = 25.0;
        *((float *)&v9 + 1) = 25.0;
        this->m_timer.m_bIsActive = 1;
        v10 = 0;
        this->m_timer.m_iStartTime = v6;
        this->m_timer.m_iDuration = 1500;
        *(_QWORD *)this->m_effects = 0LL;
        *(_QWORD *)&this->m_effects[2] = 0LL;
        *(_QWORD *)this->m_minDistanceSquared = v8;
        *(_QWORD *)&this->m_minDistanceSquared[2] = v9;
        *(_QWORD *)this->m_entities = 0LL;
        *(_QWORD *)&this->m_entities[2] = 0LL;
        this->m_entities[4] = 0;
        this->m_minDistanceSquared[5] = 25.0;
        this->m_minDistanceSquared[6] = 25.0;
        this->m_minDistanceSquared[4] = 15.0 * 15.0;
        *(_QWORD *)&this->m_effects[4] = 0LL;
        *(_QWORD *)&this->m_effects[6] = 0LL;
        *(_QWORD *)&this->m_entities[5] = 0LL;
        *(_QWORD *)&this->m_entities[7] = 0LL;
        this->m_minDistanceSquared[7] = 15.0 * 15.0;
        this->m_entities[9] = 0;
        this->m_effects[8] = 0;
        this->m_effects[9] = 0;
        this->m_minDistanceSquared[8] = 25.0;
        v44 = this;
        this->m_minDistanceSquared[9] = 25.0;
        m_pMat = ped->m_pMat;
        v42 = (CPed *)ped;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &ped->m_transform;
        x = p_tx->m_translate.x;
        y = p_tx->m_translate.y;
        v15 = y - 15.0;
        v16 = y + 15.0;
        v17 = floorf((float)((float)(p_tx->m_translate.x - 15.0) / 50.0) + 60.0);
        v18 = floorf((float)(v15 / 50.0) + 60.0);
        v19 = (int)floorf((float)((float)(x + 15.0) / 50.0) + 60.0);
        v20 = (int)floorf((float)(v16 / 50.0) + 60.0);
        v21 = (int)v18;
        if ( v20 >= 119 )
          v20 = 119;
        if ( v19 >= 119 )
          v19 = 119;
        if ( v21 <= 0 )
          v21 = 0;
        if ( (int)v17 > 0 )
          v10 = (int)v17;
        v43 = v10;
        v41 = v20;
        v45 = v21;
        if ( v21 <= v20 )
        {
          do
          {
            if ( v43 <= v19 )
            {
              v22 = 119;
              if ( v45 < 119 )
                v22 = v45;
              v23 = v43;
              v24 = 120 * v22;
              do
              {
                v25 = 119;
                if ( v23 < 119 )
                  v25 = v23;
                CAttractorScanner::ScanForAttractorsInPtrList(
                  v44,
                  &CWorld::ms_aSectors[v25 + v24].m_buildingPtrListArray,
                  ped);
                CAttractorScanner::ScanForAttractorsInPtrList(
                  v44,
                  &CWorld::ms_aRepeatSectors[v23 & 0xF | (unsigned __int8)(16 * v45)].m_ptrListArray[2],
                  ped);
              }
              while ( v23++ < v19 );
            }
            v27 = v45++;
          }
          while ( v27 < v41 );
        }
        v28 = 0;
        m_nModelIndex = &CScripted2dEffects::ms_effects;
        v30 = CScripted2dEffects::ms_activated;
        v31 = CScripted2dEffects::ms_effects;
        do
        {
          if ( *v30 )
          {
            m_bUseList = CScripted2dEffects::ms_userLists[v28].m_bUseList;
            v34 = m_bUseList == 0;
            if ( CScripted2dEffects::ms_userLists[v28].m_bUseList )
            {
              m_nModelIndex = (C2dEffect (**)[64])v42->m_nModelIndex;
              m_bUseList = CScripted2dEffects::ms_userLists[v28].m_userTypes[0];
              v34 = m_bUseList == (_DWORD)m_nModelIndex;
            }
            if ( v34
              || (v35 = CScripted2dEffects::ms_userLists[v28].m_userTypes[1], (C2dEffect (**)[64])v35 == m_nModelIndex)
              || (v36 = CScripted2dEffects::ms_userLists[v28].m_userTypes[2], (C2dEffect (**)[64])v36 == m_nModelIndex)
              || (v37 = CScripted2dEffects::ms_userLists[v28].m_userTypes[3], (C2dEffect (**)[64])v37 == m_nModelIndex)
              || (m_nPedType = v42->m_nPedType, m_bUseList == -2)
              && CScripted2dEffects::ms_userLists[v28].m_userTypesByPedType[0] == m_nPedType
              || v35 == -2 && CScripted2dEffects::ms_userLists[v28].m_userTypesByPedType[1] == m_nPedType
              || v36 == -2 && CScripted2dEffects::ms_userLists[v28].m_userTypesByPedType[2] == m_nPedType
              || v37 == -2 && CScripted2dEffects::ms_userLists[v28].m_userTypesByPedType[3] == m_nPedType )
            {
              CAttractorScanner::AddEffect(v44, v31, 0, v42);
            }
          }
          ++v28;
          ++v31;
          ++v30;
        }
        while ( v28 != 64 );
        pEntity = 0;
        pEffect = 0;
        CAttractorScanner::GetNearestAttractorInRange(v44, &pEffect, &pEntity);
        v38 = pEffect;
        if ( pEffect && (pEffect != v44->m_pPreviousEffect || v44->m_pPreviousEntity != pEntity) )
        {
          if ( pEffect->attr.q.m_type == 7 )
          {
            if ( CAttractorScanner::GetNearestPedNotUsingAttractor(pEffect) == v42 )
            {
              v39 = pEntity;
              CEventAttractor::CEventAttractor(&v46, v38, pEntity, 0);
              v46._vptr$CEvent = (int (**)(void))&off_66907C;
              if ( CEventGroup::Add(&v42->m_pPedIntelligence->m_eventGroup, (CEvent *)&v46, 0) )
              {
                v44->m_pPreviousEffect = v38;
                v44->m_pPreviousEntity = v39;
              }
              CEventAttractor::~CEventAttractor(&v46);
            }
          }
          else
          {
            v40 = pEntity;
            CEventAttractor::CEventAttractor(&v46, pEffect, pEntity, 0);
            if ( CEventGroup::Add(&v42->m_pPedIntelligence->m_eventGroup, (CEvent *)&v46, 0) )
            {
              v44->m_pPreviousEffect = v38;
              v44->m_pPreviousEntity = v40;
            }
            CEventAttractor::~CEventAttractor(&v46);
          }
        }
      }
    }
  }
}
// 4BB308: variable 'm_nModelIndex' is possibly undefined
// 66907C: using guessed type void *;
// 6786D8: using guessed type C2dEffect (*CScripted2dEffects::ms_effects)[64];

//----- (004BB440) --------------------------------------------------------
void __fastcall CAttractorScanner::ScanForAttractorsInPtrList(
        CAttractorScanner *this,
        CPtrList *ptrList,
        const CPed *ped)
{
  CPtrNode *m_pHead; // r10
  int v6; // r11
  CPtrNode v7; // kr00_8
  unsigned int v8; // r0
  CBaseModelInfo *v9; // r4
  int32 v10; // r5
  C2dEffect *v11; // r1

  m_pHead = ptrList->m_pHead;
  if ( ptrList->m_pHead )
  {
    v6 = 0;
    do
    {
      v7 = *m_pHead;
      m_pHead = m_pHead->m_pNext;
      if ( (*((_BYTE *)v7.m_pVoid + 58) & 7) == 4 )
      {
        v8 = *((_DWORD *)v7.m_pVoid + 81);
        v6 = HIBYTE(v8) & 1;
        if ( (v8 & 0x40) != 0 || (*((_DWORD *)v7.m_pVoid + 7) & 0x40004) == 0 )
          continue;
      }
      v9 = CModelInfo::ms_modelInfoPtrs[*((__int16 *)v7.m_pVoid + 19)];
      if ( v9->m_num2dEffects )
      {
        v10 = 0;
        do
        {
          v11 = CBaseModelInfo::Get2dEffect(v9, v10);
          if ( v11->m_type == 3 )
          {
            if ( ((v11->attr.q.m_flags << 31 == 0) | v6) << 31 )
              CAttractorScanner::AddEffect(this, v11, (CEntity *)v7.m_pVoid, ped);
          }
          ++v10;
        }
        while ( v10 < v9->m_num2dEffects );
      }
    }
    while ( m_pHead );
  }
}

//----- (004BB4E8) --------------------------------------------------------
void __fastcall CAttractorScanner::AddEffect(
        CAttractorScanner *this,
        C2dEffect *pEffect,
        CEntity *pEntity,
        const CPed *ped)
{
  int m_type; // r4
  CMatrix *m_pMat; // r1
  __int64 v10; // d16
  __int64 v11; // d16
  float zx; // r0
  CMatrix *v13; // r0
  bool *v14; // r6
  CSimpleTransform *p_tx; // r1
  float32x2_t v16; // d16
  unsigned __int64 v17; // d1
  float v18; // s16
  const CPedAttractorManager *PedAttractorManager; // r0
  CMatrix *v20; // r1
  CMatrix v21; // [sp+0h] [bp-88h] BYREF
  RwV3d_0 result; // [sp+48h] [bp-40h] BYREF
  CVector v; // [sp+58h] [bp-30h] BYREF

  m_type = pEffect->attr.q.m_type;
  if ( (m_type != 4 || CWeather::Rain < 0.2) && (m_type == 4 || CWeather::Rain >= 0.2) )
    return;
  if ( pEntity )
  {
    m_pMat = pEntity->m_pMat;
    if ( !m_pMat )
    {
      TransformPoint(&result, &pEntity->m_transform, &pEffect->m_posn);
      goto LABEL_11;
    }
    v10 = *(_QWORD *)&pEffect->m_posn.x;
    v.z = pEffect->m_posn.z;
    *(_QWORD *)&v.x = v10;
    operator*((CVector *)&v21, m_pMat, &v);
    v11 = *(_QWORD *)&v21.xx;
    zx = v21.zx;
  }
  else
  {
    zx = pEffect->m_posn.z;
    v11 = *(_QWORD *)&pEffect->m_posn.x;
  }
  result.z = zx;
  *(_QWORD *)&result.x = v11;
LABEL_11:
  v13 = ped->m_pMat;
  v14 = &this->m_bActivated + 4 * m_type;
  p_tx = (CSimpleTransform *)&v13->tx;
  if ( !v13 )
    p_tx = &ped->m_transform;
  v16.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&result.y).n64_u64[0];
  v17 = vmul_f32(v16, v16).n64_u64[0];
  v18 = (float)((float)((float)(p_tx->m_translate.x - result.x) * (float)(p_tx->m_translate.x - result.x))
              + *(float *)&v17)
      + *((float *)&v17 + 1);
  if ( v18 < *((float *)v14 + 26)
    && (pEffect->attr.q.m_type != 7 || CScripted2dEffects::ms_radii[CScripted2dEffects::GetIndex(pEffect)] < 0.0) )
  {
    PedAttractorManager = GetPedAttractorManager();
    if ( CPedAttractorManager::HasEmptySlot(PedAttractorManager, pEffect, pEntity) )
    {
      v21.m_pRwMat = 0;
      v21.m_owner = 0;
      if ( pEntity )
      {
        v20 = pEntity->m_pMat;
        if ( !v20 )
        {
          CPlaceable::AllocateMatrix(pEntity);
          CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
          v20 = pEntity->m_pMat;
        }
        CMatrix::operator=(&v21, v20);
      }
      else
      {
        CMatrix::SetScale(&v21, 1.0);
      }
      if ( CPedAttractorManager::IsApproachable(pEffect, &v21, 0, (CPed *)ped) )
      {
        *((_DWORD *)v14 + 16) = pEffect;
        *((_DWORD *)v14 + 6) = pEntity;
        *((float *)v14 + 26) = v18;
      }
      CMatrix::~CMatrix(&v21);
    }
  }
}

//----- (004BB67C) --------------------------------------------------------
void __fastcall CAttractorScanner::GetNearestAttractorInRange(
        const CAttractorScanner *this,
        C2dEffect **pEffect,
        CEntity **pEntity)
{
  CEntity *v3; // r0
  float v4; // s0
  float v5; // s2
  C2dEffect *v6; // r3
  float v7; // s2
  C2dEffect *v8; // r3
  float v9; // s2
  C2dEffect *v10; // r3
  float v11; // s2
  C2dEffect *v12; // r3
  float v13; // s2
  C2dEffect *v14; // r3
  float v15; // s2
  C2dEffect *v16; // r3
  float v17; // s2
  C2dEffect *v18; // r3
  float v19; // s2
  C2dEffect *v20; // r3
  float v21; // s2
  C2dEffect *v22; // r3
  C2dEffect *v23; // r3

  *pEffect = 0;
  *pEntity = 0;
  if ( this->m_entities[4] )
  {
    *pEffect = this->m_effects[4];
    v3 = this->m_entities[4];
LABEL_33:
    *pEntity = v3;
    return;
  }
  v4 = 3.4028e38;
  v5 = this->m_minDistanceSquared[0];
  if ( v5 < 3.4028e38 )
  {
    v6 = this->m_effects[0];
    if ( v6 )
    {
      *pEffect = v6;
      *pEntity = this->m_entities[0];
      v4 = v5;
    }
  }
  v7 = this->m_minDistanceSquared[1];
  if ( v7 < v4 )
  {
    v8 = this->m_effects[1];
    if ( v8 )
    {
      *pEffect = v8;
      *pEntity = this->m_entities[1];
      v4 = v7;
    }
  }
  v9 = this->m_minDistanceSquared[2];
  if ( v9 < v4 )
  {
    v10 = this->m_effects[2];
    if ( v10 )
    {
      *pEffect = v10;
      *pEntity = this->m_entities[2];
      v4 = v9;
    }
  }
  v11 = this->m_minDistanceSquared[3];
  if ( v11 < v4 )
  {
    v12 = this->m_effects[3];
    if ( v12 )
    {
      *pEffect = v12;
      *pEntity = this->m_entities[3];
      v4 = v11;
    }
  }
  v13 = this->m_minDistanceSquared[4];
  if ( v13 < v4 )
  {
    v14 = this->m_effects[4];
    if ( v14 )
    {
      *pEffect = v14;
      *pEntity = this->m_entities[4];
      v4 = v13;
    }
  }
  v15 = this->m_minDistanceSquared[5];
  if ( v15 < v4 )
  {
    v16 = this->m_effects[5];
    if ( v16 )
    {
      *pEffect = v16;
      *pEntity = this->m_entities[5];
      v4 = v15;
    }
  }
  v17 = this->m_minDistanceSquared[6];
  if ( v17 < v4 )
  {
    v18 = this->m_effects[6];
    if ( v18 )
    {
      *pEffect = v18;
      *pEntity = this->m_entities[6];
      v4 = v17;
    }
  }
  v19 = this->m_minDistanceSquared[7];
  if ( v19 < v4 )
  {
    v20 = this->m_effects[7];
    if ( v20 )
    {
      *pEffect = v20;
      *pEntity = this->m_entities[7];
      v4 = v19;
    }
  }
  v21 = this->m_minDistanceSquared[8];
  if ( v21 < v4 )
  {
    v22 = this->m_effects[8];
    if ( v22 )
    {
      *pEffect = v22;
      *pEntity = this->m_entities[8];
      v4 = v21;
    }
  }
  if ( this->m_minDistanceSquared[9] < v4 )
  {
    v23 = this->m_effects[9];
    if ( v23 )
    {
      *pEffect = v23;
      v3 = this->m_entities[9];
      goto LABEL_33;
    }
  }
}

//----- (004BB7C4) --------------------------------------------------------
CPed *__fastcall CAttractorScanner::GetNearestPedNotUsingAttractor(const C2dEffect *effect)
{
  int v1; // lr
  CPedPool *v3; // r8
  int32 m_nSize; // r5
  float v5; // s16
  CPed *result; // r0
  int v7; // r0
  int i; // r4
  int m_aStorage; // r6
  uint8 *v10; // r10
  CTask *ActiveTask; // r0
  int v12; // r0
  uint8 *v13; // r1
  float32x2_t v14; // d16
  unsigned __int64 v15; // d1
  float v16; // s18
  int Index; // r0
  int v18; // r2
  int v19; // r1
  bool v20; // zf
  int v21; // r11
  bool v22; // zf
  int v23; // r12
  CPed *v24; // r11
  _BOOL4 IsApproachable; // r10
  CPed *v26; // [sp+14h] [bp-94h]
  float32x2_t *p_y; // [sp+2Ch] [bp-7Ch]
  CMatrix v28; // [sp+30h] [bp-78h] BYREF

  v3 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( !m_nSize )
    return 0;
  p_y = (float32x2_t *)&effect->m_posn.y;
  v5 = 3.4028e38;
  result = 0;
  do
  {
    v26 = result;
    v7 = 1996 * m_nSize--;
    for ( i = v7 - 908; ; i -= 1996 )
    {
      if ( (v3->m_aFlags[m_nSize] & 0x80u) == 0 )
      {
        m_aStorage = (int)v3->m_aStorage;
        v10 = &(*v3->m_aStorage)[i];
        if ( v10 != (uint8 *)&elf_hash_bucket[209] )
        {
          ActiveTask = CTaskManager::GetActiveTask((const CTaskManager *)(*(_DWORD *)(m_aStorage + i) + 4));
          if ( !ActiveTask || (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 233 )
          {
            v12 = *((_DWORD *)v10 - 267);
            v13 = (uint8 *)(v12 + 48);
            if ( !v12 )
              v13 = v10 - 1084;
            v14.n64_u64[0] = vsub_f32((float32x2_t)p_y->n64_u64[0], *(float32x2_t *)(v13 + 4)).n64_u64[0];
            v15 = vmul_f32(v14, v14).n64_u64[0];
            v16 = (float)((float)((float)(effect->m_posn.x - *(float *)v13) * (float)(effect->m_posn.x - *(float *)v13))
                        + *(float *)&v15)
                + *((float *)&v15 + 1);
            if ( v16 < v5 )
            {
              Index = CScripted2dEffects::GetIndex(effect);
              if ( !CScripted2dEffects::ms_userLists[Index].m_bUseList )
                break;
              v18 = *(__int16 *)(m_aStorage - 1992 + i + 942);
              v19 = CScripted2dEffects::ms_userLists[Index].m_userTypes[0];
              v20 = v19 == v18;
              if ( v19 != v18 )
              {
                m_aStorage = CScripted2dEffects::ms_userLists[Index].m_userTypes[1];
                v20 = m_aStorage == v18;
              }
              if ( v20 )
                break;
              v21 = CScripted2dEffects::ms_userLists[Index].m_userTypes[2];
              v22 = v21 == v18;
              if ( v21 != v18 )
              {
                v1 = CScripted2dEffects::ms_userLists[Index].m_userTypes[3];
                v22 = v1 == v18;
              }
              if ( v22 )
                break;
              v23 = *((_DWORD *)v10 + 87);
              if ( v19 == -2 && CScripted2dEffects::ms_userLists[Index].m_userTypesByPedType[0] == v23 )
                break;
              if ( m_aStorage == -2 && CScripted2dEffects::ms_userLists[Index].m_userTypesByPedType[1] == v23
                || v21 == -2 && CScripted2dEffects::ms_userLists[Index].m_userTypesByPedType[2] == v23
                || v1 == -2 && CScripted2dEffects::ms_userLists[Index].m_userTypesByPedType[3] == v23 )
              {
                break;
              }
            }
          }
        }
      }
      if ( --m_nSize == -1 )
        return v26;
    }
    v28.m_pRwMat = 0;
    v28.m_owner = 0;
    CMatrix::SetScale(&v28, 1.0);
    v24 = (CPed *)(v10 - 1088);
    IsApproachable = CPedAttractorManager::IsApproachable((C2dEffect *)effect, &v28, 0, (CPed *)(v10 - 1088));
    CMatrix::~CMatrix(&v28);
    if ( IsApproachable )
      v5 = v16;
    result = v26;
    if ( IsApproachable )
      result = v24;
  }
  while ( m_nSize );
  return result;
}
// 4BB962: variable 'v1' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004BBA10) --------------------------------------------------------
int __fastcall CAttractorScanner::GetClosestAttractorOfType(
        const CVector *pos,
        const float radius,
        const Int32 ModelIndexToFind,
        const int32 queueType,
        const unsigned __int8 *pTriggeredScriptName,
        int bMustBeFree,
        const C2dEffect *pEffectToNeglect,
        C2dEffect **pClosestEffect,
        CEntity **pClosestEntity)
{
  Int16 v11; // r0
  int v12; // r8
  float v13; // s16
  bool v14; // zf
  int m_nModelIndex; // r1
  CBaseModelInfo *v16; // r9
  int32 v17; // r10
  C2dEffect *v18; // r0
  C2dEffect *v19; // r11
  const CPedAttractorManager *PedAttractorManager; // r0
  CEntity *v21; // r0
  const CMatrix *m_pMat; // r1
  __int64 v23; // d16
  float32x2_t v24; // d16
  unsigned __int64 v25; // d1
  char v27; // [sp+1Ch] [bp-1074h]
  float32x2_t *p_y; // [sp+24h] [bp-106Ch]
  const CVector *v29; // [sp+2Ch] [bp-1064h]
  CEntity *v31[1024]; // [sp+34h] [bp-105Ch] BYREF
  Int16 pNum; // [sp+1036h] [bp-5Ah] BYREF
  RwV3d_0 result; // [sp+1038h] [bp-58h] BYREF
  CVector v; // [sp+1048h] [bp-48h] BYREF
  CVector v35; // [sp+1058h] [bp-38h] BYREF

  *pClosestEffect = 0;
  *pClosestEntity = 0;
  pNum = -1;
  CWorld::FindObjectsInRange(pos, radius, 0, &pNum, 1024, v31, 1, 0, 0, 1, 0);
  v11 = pNum;
  if ( pNum < 1 )
  {
    v27 = 0;
  }
  else
  {
    v29 = pos;
    p_y = (float32x2_t *)&pos->y;
    v27 = 0;
    v12 = 0;
    v13 = 100000000.0;
    do
    {
      v14 = ModelIndexToFind == -1;
      m_nModelIndex = v31[v12]->m_nModelIndex;
      if ( ModelIndexToFind != -1 )
        v14 = m_nModelIndex == ModelIndexToFind;
      if ( v14 )
      {
        v16 = CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
        if ( v16->m_num2dEffects )
        {
          v17 = 0;
          do
          {
            v18 = CBaseModelInfo::Get2dEffect(v16, v17);
            v19 = v18;
            if ( (!pEffectToNeglect || v18 != pEffectToNeglect)
              && v18->m_type == 3
              && v18->attr.q.m_type == queueType
              && (!pTriggeredScriptName
               || !strcasecmp((const char *)pTriggeredScriptName, (const char *)v18->attr.q.m_scriptName)) )
            {
              if ( bMustBeFree != 1
                || (PedAttractorManager = GetPedAttractorManager(),
                    CPedAttractorManager::HasEmptySlot(PedAttractorManager, v19, v31[v12])) )
              {
                v21 = v31[v12];
                m_pMat = v21->m_pMat;
                if ( m_pMat )
                {
                  v23 = *(_QWORD *)&v19->m_posn.x;
                  v.z = v19->m_posn.z;
                  *(_QWORD *)&v.x = v23;
                  operator*(&v35, m_pMat, &v);
                  result = v35.RwV3d_0;
                }
                else
                {
                  TransformPoint(&result, &v21->m_transform, &v19->m_posn);
                }
                v24.n64_u64[0] = vsub_f32((float32x2_t)p_y->n64_u64[0], *(float32x2_t *)&result.y).n64_u64[0];
                v25 = vmul_f32(v24, v24).n64_u64[0];
                if ( (float)((float)((float)((float)(v29->x - result.x) * (float)(v29->x - result.x)) + *(float *)&v25)
                           + *((float *)&v25 + 1)) < v13 )
                {
                  v13 = (float)((float)((float)(v29->x - result.x) * (float)(v29->x - result.x)) + *(float *)&v25)
                      + *((float *)&v25 + 1);
                  *pClosestEffect = v19;
                  *pClosestEntity = v31[v12];
                  v27 = 1;
                }
              }
            }
            ++v17;
          }
          while ( v17 < v16->m_num2dEffects );
          v11 = pNum;
        }
      }
      ++v12;
    }
    while ( v12 < v11 );
  }
  return v27 & 1;
}

//----- (004BBBE0) --------------------------------------------------------
void __fastcall CPedPotentialCollisionScanner::ScanForPedPotentialCollisionEvents(
        const CPedPotentialCollisionScanner *this,
        const CPed *ped,
        CPed *pClosestPed)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d8
  bool v6; // zf
  CTask *SimplestActiveTask; // r0
  CTask *v8; // r5
  CTask *v9; // r0
  CTask *v10; // r6
  int IsGoToTask; // r0
  bool v12; // zf
  CEntity **m_entities; // r10
  int v14; // r9
  CPed *v15; // r6
  CEntity *v16; // r5
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r3
  const CVector *v19; // r1
  const CVector *p_m_translate; // r2
  float v21; // s18
  float v22; // s20
  float v23; // s22
  CMatrix *v24; // r0
  CSimpleTransform *p_tx; // r1
  bool v26; // nf
  CTask *v27; // r0
  float v28; // s2
  float32x2_t v29; // d16
  unsigned __int64 v30; // d2
  CTask *v31; // r0
  CTask *v32; // r5
  int v33; // r3
  CVector *end; // [sp+8h] [bp-80h]
  CEventPotentialWalkIntoPed v35; // [sp+Ch] [bp-7Ch] BYREF
  CVector v2; // [sp+30h] [bp-58h] BYREF
  CVector v1; // [sp+3Ch] [bp-4Ch] BYREF

  v6 = pClosestPed == 0;
  if ( pClosestPed )
    v6 = *(_BYTE *)&ped->m_nFlags << 31 == 0;
  if ( !v6 )
  {
    SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    v8 = SimplestActiveTask;
    if ( SimplestActiveTask )
    {
      if ( CTask::IsGoToTask(SimplestActiveTask) )
      {
        v9 = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
        v10 = v9;
        if ( v9 )
        {
          IsGoToTask = CTask::IsGoToTask(v9);
          v12 = IsGoToTask == 0;
          if ( IsGoToTask )
            v12 = v10[1]._vptr$CTask == (int (**)(void))((char *)&dword_0 + 1);
          if ( !v12 )
          {
            v4.n64_u32[0] = 6.25;
            m_entities = ped->m_pPedIntelligence->m_pedScanner.m_entities;
            v14 = 0;
            v15 = 0;
            end = (CVector *)&v8[1].m_pParent;
            do
            {
              v16 = m_entities[v14];
              if ( v16 && CPed::IsAlive((const CPed *)m_entities[v14]) && *(_BYTE *)&v16->m_nFlags << 31 )
              {
                m_pMat = ped->m_pMat;
                p_m_transform = &ped->m_transform;
                v19 = (const CVector *)v16->m_pMat;
                if ( m_pMat )
                  p_m_transform = (CSimpleTransform *)&m_pMat->tx;
                p_m_translate = v19 + 4;
                if ( !v19 )
                  p_m_translate = &v16->m_transform.m_translate;
                v21 = p_m_translate->x - p_m_transform->m_translate.x;
                v22 = p_m_translate->y - p_m_transform->m_translate.y;
                v23 = p_m_translate->z - p_m_transform->m_translate.z;
                if ( (float)((float)((float)(v21 * m_pMat->xy) + (float)(v22 * m_pMat->yy)) + (float)(v23 * m_pMat->zy)) > 0.0 )
                {
                  CColSphere::Set((CColSphere *)&v35, 0.7, p_m_translate, 0, 0, 0xFFu);
                  v24 = ped->m_pMat;
                  p_tx = &ped->m_transform;
                  if ( v24 )
                    p_tx = (CSimpleTransform *)&v24->tx;
                  if ( CColSphere::IntersectEdge((const CColSphere *)&v35, &p_tx->m_translate, end, &v1, &v2) == 1 )
                  {
                    v3.n64_f32[0] = (float)((float)(v21 * v21) + (float)(v22 * v22)) + (float)(v23 * v23);
                    v26 = v3.n64_f32[0] < v4.n64_f32[0];
                    v4.n64_u64[0] = vmin_f32(v3, v4).n64_u64[0];
                    if ( v26 )
                      v15 = (CPed *)v16;
                  }
                }
              }
              ++v14;
            }
            while ( v14 != 16 );
            if ( v15 )
            {
              v27 = CTaskManager::GetSimplestActiveTask(&v15->m_pPedIntelligence->m_taskManager);
              if ( !v27
                || !CTask::IsGoToTask(v27)
                || (float)((float)((float)(ped->m_pMat->xy * v15->m_pMat->xy)
                                 + (float)(ped->m_pMat->yy * v15->m_pMat->yy))
                         + (float)(ped->m_pMat->zy * v15->m_pMat->zy)) < 0.923
                || v4.n64_f32[0] <= 1.0
                || (v28 = (float)((float)((float)((float)(v15->m_vecMoveSpeed.x * 50.0)
                                                * (float)(v15->m_vecMoveSpeed.x * 50.0))
                                        + (float)((float)(v15->m_vecMoveSpeed.y * 50.0)
                                                * (float)(v15->m_vecMoveSpeed.y * 50.0)))
                                + 0.0)
                        + 0.25,
                    v28 < 0.01)
                || (v29.n64_u64[0] = vmul_f32(*(float32x2_t *)&ped->m_vecMoveSpeed.x, (float32x2_t)0x4248000042480000LL).n64_u64[0],
                    v30 = vmul_f32(v29, v29).n64_u64[0],
                    v28 <= (float)((float)(*(float *)&v30 + *((float *)&v30 + 1)) + 0.0)) )
              {
                v31 = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
                v32 = v31;
                if ( v31 )
                {
                  if ( CTask::IsGoToTask(v31) )
                    v33 = (int)v32[1]._vptr$CTask;
                  else
                    v33 = 1;
                }
                else
                {
                  v33 = 1;
                }
                CEventPotentialWalkIntoPed::CEventPotentialWalkIntoPed(&v35, v15, end, v33);
                CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v35, 0);
                CEventPotentialWalkIntoPed::~CEventPotentialWalkIntoPed(&v35);
              }
            }
          }
        }
      }
    }
  }
}
// 4BBD2A: variable 'v3' is possibly undefined
// 4BBD2A: variable 'v4' is possibly undefined
// 0: using guessed type int dword_0;

//----- (004BBE78) --------------------------------------------------------
int __fastcall CPedIntelligence::GetMoveStateFromGoToTask(const CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTask *v2; // r4

  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  v2 = SimplestActiveTask;
  if ( SimplestActiveTask && CTask::IsGoToTask(SimplestActiveTask) )
    return (int)v2[1]._vptr$CTask;
  else
    return 1;
}

//----- (004BBE98) --------------------------------------------------------
void __fastcall CVehiclePotentialCollisionScanner::ScanForVehiclePotentialCollisionEvents(
        CVehiclePotentialCollisionScanner *this,
        const CPed *ped,
        CEntity **ppNearbyVehicles,
        const int iMaxNumVehicles)
{
  CVehicle *m_pClosestEntity; // r8
  uint32 m_iStartTime; // r1
  CTask *SimplestActiveTask; // r0
  const CVector *v8; // r10
  int IsGoToTask; // r0
  bool v10; // zf
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r6
  CMatrix *v13; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *v15; // r0
  float32x2_t v16; // d8
  float x; // s20
  float32x2_t v18; // d9
  float v19; // s22
  CColModel *ColModel; // r0
  const CMatrix *v21; // r4
  const CVector *p_m_vecMin; // r5
  CMatrix *v23; // r0
  float xz; // s0
  float yz; // s2
  float zz; // s8
  float y; // s10
  float z; // s4
  float v29; // s2
  float v30; // s0
  float v31; // s8
  float v32; // s6
  float v33; // s0
  float v34; // s2
  float v35; // s4
  float v36; // s0
  float v37; // s2
  float32x2_t v38; // d16
  unsigned __int64 v39; // d2
  _BOOL4 IsLineOfSightClear; // r0
  CTask *v41; // r0
  CTask *v42; // r6
  int v43; // r2
  CEventPotentialWalkIntoVehicle v44; // [sp+4h] [bp-74h] BYREF
  float fIntersectionLength; // [sp+1Ch] [bp-5Ch] BYREF
  CVector v46; // [sp+20h] [bp-58h] BYREF
  CVector v47; // [sp+2Ch] [bp-4Ch] BYREF

  if ( !this->m_timer.m_bIsActive )
  {
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = 500;
    this->m_timer.m_bIsActive = 1;
  }
  if ( this->m_timer.m_bIsStopped )
  {
    m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_bIsStopped = 0;
    this->m_timer.m_iStartTime = m_iStartTime;
  }
  else
  {
    m_iStartTime = this->m_timer.m_iStartTime;
  }
  if ( m_iStartTime + this->m_timer.m_iDuration <= CTimer::m_snTimeInMilliseconds )
  {
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = 500;
    this->m_timer.m_bIsActive = 1;
    SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    v8 = (const CVector *)SimplestActiveTask;
    if ( SimplestActiveTask )
    {
      IsGoToTask = CTask::IsGoToTask(SimplestActiveTask);
      v10 = IsGoToTask == 0;
      if ( IsGoToTask )
      {
        m_pClosestEntity = (CVehicle *)ped->m_pPedIntelligence->m_vehicleScanner.m_pClosestEntity;
        v10 = m_pClosestEntity == 0;
      }
      if ( !v10 )
      {
        m_pMat = m_pClosestEntity->m_pMat;
        p_m_transform = &ped->m_transform;
        v13 = ped->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pClosestEntity->m_transform;
        v15 = &ped->m_transform;
        v16.n64_u64[0] = *(unsigned __int64 *)&p_tx->m_translate.y;
        if ( v13 )
          v15 = (CSimpleTransform *)&v13->tx;
        x = p_tx->m_translate.x;
        v18.n64_u64[0] = *(unsigned __int64 *)&v15->m_translate.y;
        v19 = v15->m_translate.x;
        ColModel = CEntity::GetColModel(m_pClosestEntity);
        v21 = m_pClosestEntity->m_pMat;
        p_m_vecMin = &ColModel->m_boxBound.m_vecMin;
        CVector::FromMultiply(&v47, v21, &ColModel->m_boxBound.m_vecMin);
        CVector::FromMultiply(&v46, v21, p_m_vecMin + 1);
        v23 = ped->m_pMat;
        xz = v21->xz;
        yz = v21->yz;
        zz = v21->zz;
        if ( v23 )
          p_m_transform = (CSimpleTransform *)&v23->tx;
        y = p_m_transform->m_translate.y;
        z = p_m_transform->m_translate.z;
        if ( (float)((float)((float)((float)(xz * p_m_transform->m_translate.x) + (float)(yz * y)) + (float)(zz * z))
                   - (float)((float)((float)(xz * v46.x) + (float)(yz * v46.y)) + (float)(zz * v46.z))) < 0.5 )
        {
          v29 = -yz;
          v30 = -xz;
          v31 = -zz;
          v32 = (float)(p_m_transform->m_translate.x * v30) + (float)(y * v29);
          v33 = (float)(v47.x * v30) + (float)(v47.y * v29);
          v34 = v32 + (float)(z * v31);
          v35 = v33 + (float)(v47.z * v31);
          v36 = 5.0;
          v37 = v34 - v35;
          if ( m_pClosestEntity->m_vehicleType == 6 )
            v36 = 10.0;
          if ( v37 < 0.5 )
          {
            if ( (*((_BYTE *)&ped->m_nPedFlags + 8) & 8) != 0
              || (v38.n64_u64[0] = vsub_f32(v18, v16).n64_u64[0],
                  v39 = vmul_f32(v38, v38).n64_u64[0],
                  (float)((float)((float)((float)(v19 - x) * (float)(v19 - x)) + *(float *)&v39) + *((float *)&v39 + 1)) < (float)(v36 * v36)) )
            {
              fIntersectionLength = 0.0;
              IsLineOfSightClear = CPedGeometryAnalyser::GetIsLineOfSightClear(
                                     ped,
                                     v8 + 1,
                                     m_pClosestEntity,
                                     &fIntersectionLength);
              if ( fIntersectionLength > 0.5 && !IsLineOfSightClear )
              {
                v41 = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
                v42 = v41;
                if ( v41 )
                {
                  if ( CTask::IsGoToTask(v41) )
                    v43 = (int)v42[1]._vptr$CTask;
                  else
                    v43 = 1;
                }
                else
                {
                  v43 = 1;
                }
                CEventPotentialWalkIntoVehicle::CEventPotentialWalkIntoVehicle(&v44, m_pClosestEntity, v43);
                CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v44, 0);
                CEventPotentialWalkIntoVehicle::~CEventPotentialWalkIntoVehicle(&v44);
              }
            }
          }
        }
      }
    }
  }
}
// 4BBF22: variable 'm_pClosestEntity' is possibly undefined

//----- (004BC0EC) --------------------------------------------------------
void __fastcall CObjectPotentialCollisionScanner::ScanForObjectPotentialCollisionEvents(
        CObjectPotentialCollisionScanner *this,
        const CPed *ped)
{
  uint32 m_iStartTime; // r1
  int v4; // r5
  CTask *SimplestActiveTask; // r0
  CTask *v6; // r6
  _BOOL4 IsPlayer; // r0
  CTask *v8; // r0
  CTask *v9; // r6
  CVehicle *m_pMyVehicle; // r0
  bool v11; // zf
  CObject *m_pClosestEntity; // r10
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r11
  CMatrix *v15; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *v17; // r0
  float32x2_t v18; // d16
  unsigned __int64 v19; // d1
  CMatrix *v20; // r2
  CSimpleTransform *v21; // r1
  float z; // s2
  float m_fRadius; // s4
  const CVector *p_m_pParent; // r6
  _BOOL4 IsLineOfSightClear; // r0
  CMatrix *v26; // r0
  float v27; // s2
  int v28; // r6
  CEntity *v29; // r0
  CEventPotentialWalkIntoObject v30; // [sp+0h] [bp-88h] BYREF
  float fIntersectionLength; // [sp+18h] [bp-70h] BYREF
  CEntityScanner v32; // [sp+1Ch] [bp-6Ch] BYREF

  if ( !this->m_timer.m_bIsActive )
  {
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = 500;
    this->m_timer.m_bIsActive = 1;
  }
  if ( this->m_timer.m_bIsStopped )
  {
    m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_bIsStopped = 0;
    this->m_timer.m_iStartTime = m_iStartTime;
  }
  else
  {
    m_iStartTime = this->m_timer.m_iStartTime;
  }
  if ( m_iStartTime + this->m_timer.m_iDuration <= CTimer::m_snTimeInMilliseconds )
  {
    v4 = 1;
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = 500;
    this->m_timer.m_bIsActive = 1;
    SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    v6 = SimplestActiveTask;
    if ( SimplestActiveTask )
    {
      if ( CTask::IsGoToTask(SimplestActiveTask) )
        v4 = (int)v6[1]._vptr$CTask;
      else
        v4 = 1;
    }
    IsPlayer = CPed::IsPlayer(ped);
    if ( v4 != 1 && !IsPlayer )
    {
      v8 = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
      v9 = v8;
      if ( v8 )
      {
        if ( CTask::IsGoToTask(v8) )
        {
          v32.m_timer.m_iCount = 0;
          memset(v32.m_entities, 0, 68);
          v32.m_timer.m_iPeriod = 16;
          v32._vptr$CEntityScanner = (int (**)(void))&off_6690CC;
          m_pMyVehicle = ped->m_pMyVehicle;
          v11 = m_pMyVehicle == 0;
          if ( m_pMyVehicle )
            v11 = *((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31 == 0;
          if ( v11 && CPed::IsAlive(ped) )
          {
            CEntityScanner::ScanForEntitiesInRange(&v32, 2, ped);
            m_pClosestEntity = (CObject *)v32.m_pClosestEntity;
            if ( v32.m_pClosestEntity )
            {
              if ( ((int)v32.m_pClosestEntity[5].m_pRwObject & 0x401) == 0
                && *(_BYTE *)&v32.m_pClosestEntity->m_nFlags << 31 )
              {
                m_pMat = v32.m_pClosestEntity->m_pMat;
                p_m_transform = &ped->m_transform;
                v15 = ped->m_pMat;
                p_tx = (CSimpleTransform *)&m_pMat->tx;
                if ( !m_pMat )
                  p_tx = &v32.m_pClosestEntity->m_transform;
                v17 = &ped->m_transform;
                if ( v15 )
                  v17 = (CSimpleTransform *)&v15->tx;
                v18.n64_u64[0] = vsub_f32(*(float32x2_t *)&v17->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
                v19 = vmul_f32(v18, v18).n64_u64[0];
                if ( (float)((float)((float)((float)(v17->m_translate.x - p_tx->m_translate.x)
                                           * (float)(v17->m_translate.x - p_tx->m_translate.x))
                                   + *(float *)&v19)
                           + *((float *)&v19 + 1)) < 56.25 )
                {
                  CEntity::GetBoundCentre((CVector *)&v30, v32.m_pClosestEntity);
                  v20 = ped->m_pMat;
                  v21 = &ped->m_transform;
                  if ( v20 )
                    v21 = (CSimpleTransform *)&v20->tx;
                  z = v21->m_translate.z;
                  m_fRadius = CModelInfo::ms_modelInfoPtrs[m_pClosestEntity->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
                  if ( (float)(z + -1.0) <= (float)(*(float *)&v30.m_bIsPersistent + m_fRadius)
                    && (float)(z + 1.0) >= (float)(*(float *)&v30.m_bIsPersistent - m_fRadius) )
                  {
                    p_m_pParent = (const CVector *)&v9[1].m_pParent;
                    fIntersectionLength = 0.0;
                    IsLineOfSightClear = CPedGeometryAnalyser::GetIsLineOfSightClear(
                                           ped,
                                           p_m_pParent,
                                           m_pClosestEntity,
                                           &fIntersectionLength);
                    if ( fIntersectionLength > 0.5 && !IsLineOfSightClear )
                    {
                      v26 = ped->m_pMat;
                      if ( v26 )
                        p_m_transform = (CSimpleTransform *)&v26->tx;
                      v27 = p_m_transform->m_translate.z;
                      *(_QWORD *)&v30._vptr$CEvent = *(_QWORD *)&p_m_transform->m_translate.x;
                      *(float *)&v30.m_bIsPersistent = v27 + -0.75;
                      if ( !CPedGeometryAnalyser::GetIsLineOfSightClear(
                              (const CVector *)&v30,
                              p_m_pParent,
                              m_pClosestEntity) )
                      {
                        CEventPotentialWalkIntoObject::CEventPotentialWalkIntoObject(&v30, m_pClosestEntity, v4);
                        CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v30, 0);
                        CEventPotentialWalkIntoObject::~CEventPotentialWalkIntoObject(&v30);
                      }
                    }
                  }
                }
              }
            }
          }
          v28 = 0;
          v32._vptr$CEntityScanner = (int (**)(void))&off_669070;
          do
          {
            v29 = v32.m_entities[v28];
            if ( v29 )
            {
              CEntity::CleanUpOldReference(v29, &v32.m_entities[v28]);
              v32.m_entities[v28] = 0;
            }
            ++v28;
          }
          while ( v28 != 16 );
          if ( v32.m_pClosestEntity )
            CEntity::CleanUpOldReference(v32.m_pClosestEntity, &v32.m_pClosestEntity);
        }
      }
    }
  }
}
// 669070: using guessed type void *off_669070;
// 6690CC: using guessed type void *;

//----- (004BC3AC) --------------------------------------------------------
void __fastcall CPedAcquaintanceScanner::ScanForPedAcquaintanceEvents(
        CPedAcquaintanceScanner *this,
        CPed *ped,
        CEntity **ppNearbyPeds,
        const int iMaxNumPeds)
{
  uint32 m_iStartTime; // r0
  int v9; // r0
  int iAcquaintancePedScanType; // [sp+10h] [bp-18h] BYREF
  CPed *v11; // [sp+14h] [bp-14h] BYREF

  if ( !this->m_timer.m_bIsActive )
  {
    *(_QWORD *)&this->m_timer.m_iStartTime = __PAIR64__(
                                               CPedAcquaintanceScanner::ms_iAcquaintanceScanPeriod,
                                               CTimer::m_snTimeInMilliseconds);
    this->m_timer.m_bIsActive = 1;
  }
  if ( this->m_timer.m_bIsStopped )
  {
    m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_bIsStopped = 0;
    this->m_timer.m_iStartTime = m_iStartTime;
  }
  else
  {
    m_iStartTime = this->m_timer.m_iStartTime;
  }
  if ( m_iStartTime + this->m_timer.m_iDuration <= CTimer::m_snTimeInMilliseconds )
  {
    v9 = CPedAcquaintanceScanner::ms_iAcquaintanceScanPeriod;
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = v9;
    this->m_timer.m_bIsActive = 1;
    if ( CPedAcquaintanceScanner::IsScanPermitted(this, ped) )
    {
      v11 = 0;
      iAcquaintancePedScanType = -1;
      CPedAcquaintanceScanner::FindClosestAcquaintance(
        this,
        ped,
        -1,
        ppNearbyPeds,
        iMaxNumPeds,
        &v11,
        &iAcquaintancePedScanType);
    }
  }
}

//----- (004BC45C) --------------------------------------------------------
bool __fastcall CPedAcquaintanceScanner::IsScanPermitted(const CPedAcquaintanceScanner *this, const CPed *ped)
{
  int CharCreatedBy; // r0
  bool v5; // zf
  CEvent *CurrentEvent; // r0
  const CEventEditableResponse *v7; // r5
  _BOOL4 m_bActivatedInVehicle; // r6
  _BOOL4 m_bActivatedDuringScriptCommands; // r0

  if ( !CPed::IsAlive(ped) )
    return 0;
  CharCreatedBy = ped->CharCreatedBy;
  v5 = CharCreatedBy == 2;
  if ( CharCreatedBy == 2 )
    v5 = !this->m_bActivatedEverywhere;
  if ( v5 )
  {
    if ( *((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31 )
    {
      m_bActivatedInVehicle = this->m_bActivatedInVehicle;
      if ( this->m_bActivatedInVehicle )
        m_bActivatedInVehicle = 1;
    }
    else
    {
      m_bActivatedInVehicle = 0;
    }
    if ( CPedScriptedTaskRecord::GetStatus(ped) )
    {
      m_bActivatedDuringScriptCommands = this->m_bActivatedDuringScriptCommands;
      if ( this->m_bActivatedDuringScriptCommands )
        m_bActivatedDuringScriptCommands = 1;
      if ( !m_bActivatedDuringScriptCommands && !m_bActivatedInVehicle )
        return 0;
    }
    else if ( !m_bActivatedInVehicle )
    {
      return 0;
    }
  }
  CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&ped->m_pPedIntelligence->m_eventHandler.m_history);
  v7 = (const CEventEditableResponse *)CurrentEvent;
  if ( !CurrentEvent || (*((int (__fastcall **)(CEvent *))CurrentEvent->_vptr$CEvent + 2))(CurrentEvent) != 36 )
    return 1;
  if ( ped->m_pPedIntelligence->m_iMaxNumFriendsToInform
    && CEventEditableResponse::ComputeResponseTaskOfType(v7, (CPed *)ped, 1700) )
  {
    return CPedIntelligence::FindRespectedFriendInInformRange(ped->m_pPedIntelligence);
  }
  return 0;
}

//----- (004BC510) --------------------------------------------------------
void __fastcall CPedAcquaintanceScanner::FindClosestAcquaintance(
        CPedAcquaintanceScanner *this,
        CPed *ped,
        const int iAcquaintanceScanTypeExclusive,
        CEntity **ppNearbyPeds,
        const int iMaxNumPeds,
        CPed **pAcquaintancePed,
        int *iAcquaintancePedScanType)
{
  CPed *v7; // r10
  int v8; // r11
  int v11; // r5
  CEntity *v12; // r4
  CMatrix *m_pMat; // r0
  CMatrix *v14; // r1
  float *p_tx; // r2
  float *p_x; // r0
  float v17; // s4
  float v18; // s10
  RwReal v19; // s0
  bool v20; // zf
  bool v21; // zf
  int v22; // r9
  int v23; // r6
  int32 v24; // r10
  bool v25; // zf
  int v26; // r11
  uint32 Acquaintances; // r8
  uint32 v28; // r0
  CPed *v29; // r11
  CDecisionMakerTypes *v30; // r0
  CDecisionMakerTypes *v31; // r0
  int v32; // r3
  int m_iDecisionMakerType; // r10
  int i; // r2
  int v35; // r6
  int p_m_defaultPlayerPedDecisionMaker; // r2
  int v37; // r6
  _DWORD *v38; // r6
  int v39; // r1
  bool v40; // zf
  int v41; // r1
  bool v42; // zf
  int v43; // r2
  int v44; // r4
  CPed **v45; // r5
  int v46; // r9
  CPed *v47; // r6
  char v48; // r0
  const CPed *v49; // [sp+10h] [bp-B8h]
  CEntity **v50; // [sp+18h] [bp-B0h]
  int v51; // [sp+28h] [bp-A0h]
  const CAcquaintance *p_m_acquaintances; // [sp+30h] [bp-98h]
  CPedFlags *p_m_nPedFlags; // [sp+34h] [bp-94h]
  int v55; // [sp+3Ch] [bp-8Ch]
  __int64 v56; // [sp+40h] [bp-88h]
  CVector v57; // [sp+4Ch] [bp-7Ch] BYREF
  _DWORD v58[28]; // [sp+58h] [bp-70h] BYREF

  v7 = ped;
  v8 = iMaxNumPeds;
  *pAcquaintancePed = 0;
  if ( iMaxNumPeds >= 1 )
  {
    v11 = 0;
    p_m_nPedFlags = &ped->m_nPedFlags;
    p_m_acquaintances = &ped->m_acquaintances;
    v51 = 0;
    do
    {
LABEL_3:
      while ( 1 )
      {
        v12 = ppNearbyPeds[v11++];
        if ( v12 )
        {
          if ( CPed::IsAlive((const CPed *)v12) )
          {
            m_pMat = v7->m_pMat;
            v14 = v12->m_pMat;
            p_tx = &m_pMat->tx;
            if ( !m_pMat )
              p_tx = &v7->m_transform.m_translate.x;
            p_x = &v14->tx;
            v17 = p_tx[2];
            if ( !v14 )
              p_x = &v12->m_transform.m_translate.x;
            v18 = p_x[2];
            v19 = *p_x - *p_tx;
            v57.y = p_x[1] - p_tx[1];
            v57.x = v19;
            v57.z = v18 - v17;
            CVector::Normalise(&v57);
            if ( (float)((float)((float)(v7->m_pMat->xy * v57.x) + (float)(v7->m_pMat->yy * v57.y))
                       + (float)(v7->m_pMat->zy * v57.z)) > CPedAcquaintanceScanner::ms_fThresholdDotProduct )
              break;
            v20 = *((unsigned __int8 *)p_m_nPedFlags + 1) << 31 == 0;
            if ( !(*((unsigned __int8 *)p_m_nPedFlags + 1) << 31) )
              v20 = BYTE1(v12[19].m_transform.m_heading) << 31 == 0;
            if ( !v20 )
              break;
          }
        }
        if ( v11 >= v8 )
          goto LABEL_59;
      }
      v50 = ppNearbyPeds;
      v22 = iAcquaintanceScanTypeExclusive + 1;
      v21 = iAcquaintanceScanTypeExclusive == -1;
      if ( iAcquaintanceScanTypeExclusive == -1 )
        v21 = *(_DWORD *)&v12[23].numLodChildren == 6;
      if ( v21 )
        goto LABEL_27;
      v49 = v7;
      v23 = 0;
      v24 = 4;
      do
      {
        v25 = v22 == 0;
        if ( v22 )
          v25 = iAcquaintanceScanTypeExclusive == v24;
        if ( v25 )
        {
          v26 = iAcquaintanceScanTypeExclusive;
          Acquaintances = CAcquaintance::GetAcquaintances(p_m_acquaintances, v24);
          v28 = CPedType::GetPedFlag(*(_DWORD *)&v12[23].numLodChildren) & Acquaintances;
          iAcquaintanceScanTypeExclusive = v26;
          v8 = iMaxNumPeds;
          v23 |= v28 != 0;
        }
        if ( v24 < 1 )
          break;
        --v24;
      }
      while ( !(v23 << 31) );
      v7 = (CPed *)v49;
      if ( v23 << 31
        || CGameLogic::LaRiotsActiveHere() && CPedAcquaintanceScanner::CanJoinLARiot(v49, (const CPed *)v12) )
      {
LABEL_27:
        if ( *(_DWORD *)&v12[23].numLodChildren != 6 )
        {
          v29 = v7;
          v55 = 37;
          v56 = 0x2800000027LL;
          if ( !CGameLogic::LaRiotsActiveHere() || !CPedAcquaintanceScanner::CanJoinLARiot(v7, (const CPed *)v12) )
          {
            v30 = CDecisionMakerTypes::m_pPedDecisionTypes;
            if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
            {
              v31 = (CDecisionMakerTypes *)operator new(0xF1C0u);
              CDecisionMakerTypes::CDecisionMakerTypes(v31);
              CDecisionMakerTypes::m_pPedDecisionTypes = v30;
            }
            v32 = 0;
            m_iDecisionMakerType = v7->m_pPedIntelligence->m_iDecisionMakerType;
            for ( i = 36; ; i = *(&v55 + v32++) )
            {
              v35 = v30->m_eventIndices[i];
              p_m_defaultPlayerPedDecisionMaker = (int)&v30->m_defaultPlayerPedDecisionMaker;
              if ( m_iDecisionMakerType != -2 )
              {
                if ( m_iDecisionMakerType == -1 )
                {
                  p_m_defaultPlayerPedDecisionMaker = (int)&v30->m_defaultRandomPedDecisionMaker;
                  if ( v29->CharCreatedBy == 2 )
                    p_m_defaultPlayerPedDecisionMaker = (int)&v30->m_defaultMissionPedDecisionMaker;
                }
                else
                {
                  p_m_defaultPlayerPedDecisionMaker = (int)&v30->m_decisionMakers[m_iDecisionMakerType];
                }
              }
              v37 = 15 * v35;
              if ( *(_DWORD *)(p_m_defaultPlayerPedDecisionMaker + 4 * v37) != 200 )
                break;
              v38 = (_DWORD *)(p_m_defaultPlayerPedDecisionMaker + 4 * v37);
              v39 = v38[1];
              v40 = v39 == 200;
              if ( v39 == 200 )
                v40 = v38[2] == 200;
              if ( !v40 )
                break;
              v41 = v38[3];
              v42 = v41 == 200;
              if ( v41 == 200 )
                v42 = v38[4] == 200;
              if ( !v42 )
                break;
              v43 = v38[5];
              if ( v32 > 3 || v43 != 200 )
              {
                if ( v43 != 200 )
                  break;
                v7 = v29;
                ppNearbyPeds = v50;
                v8 = iMaxNumPeds;
                if ( v11 < iMaxNumPeds )
                  goto LABEL_3;
                goto LABEL_59;
              }
            }
          }
          v7 = v29;
          v8 = iMaxNumPeds;
        }
        v58[v51++] = v12;
      }
      ppNearbyPeds = v50;
    }
    while ( v11 < v8 );
LABEL_59:
    v44 = v51;
    if ( v51 >= 1 )
    {
      v45 = (CPed **)v58;
      v46 = -1;
      do
      {
        if ( v46 == 4 )
        {
          v46 = 4;
        }
        else
        {
          v47 = *v45;
          if ( *((unsigned __int8 *)p_m_nPedFlags + 1) << 31 )
            v48 = 1;
          else
            v48 = *((_BYTE *)&v47->m_nPedFlags + 1) & 1;
          if ( CPedGeometryAnalyser::CanPedTargetPed(v7, *v45, v48 != 1) )
            v46 = CPedAcquaintanceScanner::ScanAcquaintanceTypes(
                    this,
                    v7,
                    iAcquaintanceScanTypeExclusive,
                    v46,
                    v47,
                    pAcquaintancePed,
                    iAcquaintancePedScanType);
        }
        --v44;
        ++v45;
      }
      while ( v44 );
    }
  }
}
// 4BC6C2: variable 'v30' is possibly undefined
// 4BC510: using guessed type _DWORD var_70[28];

//----- (004BC82C) --------------------------------------------------------
bool __fastcall CPedAcquaintanceScanner::CanJoinLARiot(const CPed *ped, const CPed *otherPed)
{
  unsigned int m_nPedType; // r6
  bool v5; // r5
  CPed *m_pPed; // r0
  uint32 Acquaintances; // r6
  CPedGroup *PedsGroup; // r0
  const CPedGroupMembership *p_m_membership; // r8
  CPed *Leader; // r0
  CPedIntelligence *m_pPedIntelligence; // r5
  int32 v13; // r0
  char v14; // r2
  char v15; // r1
  bool v16; // zf
  unsigned int v17; // r0

  m_nPedType = ped->m_nPedType;
  if ( m_nPedType <= 0x13 && ((1 << m_nPedType) & (unsigned int)"eObjectCarriedWithRopeEv") != 0
    || CPed::IsPlayer(ped)
    || ped->CharCreatedBy == 2 )
  {
    return 0;
  }
  if ( CPed::IsPlayer(otherPed) )
  {
    m_pPed = ped->m_pPedIntelligence->m_pPed;
    goto LABEL_9;
  }
  PedsGroup = CPedGroups::GetPedsGroup(otherPed);
  if ( PedsGroup )
  {
    p_m_membership = &PedsGroup->m_membership;
    if ( CPedGroupMembership::GetLeader(&PedsGroup->m_membership) )
    {
      Leader = CPedGroupMembership::GetLeader(p_m_membership);
      if ( CPed::IsPlayer(Leader) )
      {
        m_pPedIntelligence = ped->m_pPedIntelligence;
        otherPed = CPedGroupMembership::GetLeader(p_m_membership);
        m_pPed = m_pPedIntelligence->m_pPed;
LABEL_9:
        v5 = 0;
        Acquaintances = CAcquaintance::GetAcquaintances(&m_pPed->m_acquaintances, 0);
        if ( (CPedType::GetPedFlag(otherPed->m_nPedType) & Acquaintances) == 0 )
          return 1;
        return v5;
      }
    }
  }
  v13 = otherPed->m_nPedType;
  v14 = 0;
  v15 = 0;
  v16 = m_nPedType == v13;
  v17 = v13 - 7;
  if ( !v16 )
    v14 = 1;
  if ( v17 > 9 )
    v15 = 1;
  return (m_nPedType - 7 > 9) | v15 | v14;
}

//----- (004BC8FA) --------------------------------------------------------
bool __fastcall CDecisionMakerTypes::HasResponse(
        const CDecisionMakerTypes *this,
        const CPed *ped,
        const int *pEventTypes,
        const int iNoOfEventTypes)
{
  bool v4; // r12
  int v5; // r9
  int m_iDecisionMakerType; // lr
  CDecisionMaker *p_m_defaultPlayerPedDecisionMaker; // r6
  CDecision *v8; // r4
  CTaskTypes::eTaskType v9; // r6
  bool v10; // zf
  CTaskTypes::eTaskType v11; // r6
  bool v12; // zf
  CTaskTypes::eTaskType v13; // r4

  v4 = 0;
  if ( iNoOfEventTypes >= 1 )
  {
    v5 = 0;
    m_iDecisionMakerType = ped->m_pPedIntelligence->m_iDecisionMakerType;
    while ( 1 )
    {
      p_m_defaultPlayerPedDecisionMaker = &this->m_defaultPlayerPedDecisionMaker;
      if ( m_iDecisionMakerType != -2 )
      {
        if ( m_iDecisionMakerType == -1 )
        {
          p_m_defaultPlayerPedDecisionMaker = &this->m_defaultRandomPedDecisionMaker;
          if ( ped->CharCreatedBy == 2 )
            p_m_defaultPlayerPedDecisionMaker = &this->m_defaultMissionPedDecisionMaker;
        }
        else
        {
          p_m_defaultPlayerPedDecisionMaker = &this->m_decisionMakers[m_iDecisionMakerType];
        }
      }
      if ( p_m_defaultPlayerPedDecisionMaker->m_decisions[this->m_eventIndices[pEventTypes[v5]]].m_tasks[0] != TASK_NONE )
        break;
      v8 = &p_m_defaultPlayerPedDecisionMaker->m_decisions[this->m_eventIndices[pEventTypes[v5]]];
      v9 = v8->m_tasks[1];
      v10 = v9 == TASK_NONE;
      if ( v9 == TASK_NONE )
        v10 = v8->m_tasks[2] == TASK_NONE;
      if ( !v10 )
        break;
      v11 = v8->m_tasks[3];
      v12 = v11 == TASK_NONE;
      if ( v11 == TASK_NONE )
        v12 = v8->m_tasks[4] == TASK_NONE;
      if ( !v12 )
        break;
      v13 = v8->m_tasks[5];
      ++v5;
      v4 = v13 != TASK_NONE;
      if ( v5 >= iNoOfEventTypes || v13 != TASK_NONE )
        return v4;
    }
    return 1;
  }
  return v4;
}

//----- (004BC9B8) --------------------------------------------------------
int __fastcall CPedAcquaintanceScanner::ScanAcquaintanceTypes(
        CPedAcquaintanceScanner *this,
        const CPed *ped,
        const int iAcquaintanceScanTypeExclusive,
        const int iAddedType,
        CPed *pOtherPed,
        CPed **pAcquaintancePed,
        int *iAcquaintancePedScanType)
{
  float v11; // r0
  int result; // r0
  float v13; // s16
  CAcquaintance *p_m_acquaintances; // r10
  int v15; // r8
  int v16; // r6
  bool v17; // zf
  bool v18; // zf
  uint32 Acquaintances; // r5
  int v20; // r0
  int v21; // r1
  _BOOL4 v22; // r0
  int *v23; // r1
  uint32 v24; // r2
  int v25; // r1
  int v26; // r1
  CPedAcquaintanceScanner *v27; // [sp+8h] [bp-30h]
  CPed *v28; // [sp+Ch] [bp-2Ch]

  v11 = CPedIntelligence::CanSeeEntityWithLights(ped->m_pPedIntelligence, pOtherPed, 0);
  if ( iAddedType == 4 )
    return -1;
  v13 = v11;
  p_m_acquaintances = &ped->m_acquaintances;
  v27 = this;
  v15 = -iAddedType;
  v16 = 4;
  v28 = (CPed *)ped;
  while ( 1 )
  {
    v17 = iAcquaintanceScanTypeExclusive == -1;
    if ( iAcquaintanceScanTypeExclusive != -1 )
      v17 = iAcquaintanceScanTypeExclusive == v16;
    if ( !v17 )
      goto LABEL_30;
    v18 = iAcquaintanceScanTypeExclusive == -1;
    if ( iAcquaintanceScanTypeExclusive == -1 )
      v18 = v16 == 2;
    if ( !v18 || pOtherPed->m_nPedType != 6 )
    {
      Acquaintances = CAcquaintance::GetAcquaintances(p_m_acquaintances, v16);
      if ( (CPedType::GetPedFlag(pOtherPed->m_nPedType) & Acquaintances) == 0
        && (!CGameLogic::LaRiotsActiveHere() || !CPedAcquaintanceScanner::CanJoinLARiot(v28, pOtherPed)) )
      {
        goto LABEL_30;
      }
    }
    v20 = 0;
    v21 = 0;
    if ( v13 != 0.0 )
      v20 = 1;
    if ( v16 == 4 )
      v21 = 1;
    if ( v13 <= 0.0 && (v20 & v21) != 1 )
      goto LABEL_30;
    *pAcquaintancePed = pOtherPed;
    *iAcquaintancePedScanType = v16;
    if ( iAcquaintanceScanTypeExclusive != -1 )
      return iAcquaintanceScanTypeExclusive;
    if ( *pAcquaintancePed )
    {
      v22 = CPedAcquaintanceScanner::AddAcquaintanceEvent(
              (CPedAcquaintanceScanner *)iAcquaintancePedScanType,
              v28,
              v16,
              *pAcquaintancePed);
      v23 = &CPedAcquaintanceScanner::ms_iAcquaintanceLatencyPeriodDefinite;
      if ( *iAcquaintancePedScanType == 4 )
        v23 = &CPedAcquaintanceScanner::ms_iAcquaintanceLatencyPeriodMaybe;
      v24 = CTimer::m_snTimeInMilliseconds;
      if ( v13 >= 0.0 )
        v23 = &CPedAcquaintanceScanner::ms_iAcquaintanceLatencyPeriodDefinite;
      v25 = *v23;
      v27->m_timer.m_bIsActive = 1;
      v27->m_timer.m_iStartTime = v24;
      v27->m_timer.m_iDuration = v25;
      if ( v22 )
        return *iAcquaintancePedScanType;
    }
LABEL_30:
    result = -1;
    if ( v16 >= 1 )
    {
      v26 = v15 + v16--;
      if ( v26 != 1 )
        continue;
    }
    return result;
  }
}

//----- (004BCB04) --------------------------------------------------------
float __fastcall CPedIntelligence::CanSeeEntityWithLights(
        const CPedIntelligence *this,
        const CEntity *pTargetEnt,
        bool bHasSeenEnt)
{
  float LightingTotal; // s2
  float v6; // s0
  CMatrix *m_pMat; // r1
  CMatrix *v8; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v11; // d16
  unsigned __int64 v12; // d3
  float v13; // s4
  float v14; // s0

  if ( (*(_BYTE *)&pTargetEnt->m_info & 7) != 3 || !CPed::IsPlayer((const CPed *)pTargetEnt) )
    return LIGHT_AI_LEVEL_MAX;
  LightingTotal = CPhysical::GetLightingTotal((const CPhysical *)pTargetEnt);
  v6 = LIGHT_AI_LEVEL_MAX;
  if ( LightingTotal > LIGHT_AI_LEVEL_MAX )
    return v6;
  m_pMat = pTargetEnt->m_pMat;
  v8 = this->m_pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pTargetEnt->m_transform;
  p_m_transform = (CSimpleTransform *)&v8->tx;
  if ( !v8 )
    p_m_transform = &this->m_pPed->m_transform;
  v11.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
  v12 = vmul_f32(v11, v11).n64_u64[0];
  v13 = sqrtf(
          (float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                        * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                + *(float *)&v12)
        + *((float *)&v12 + 1))
      + -0.7;
  v6 = (float)(LightingTotal * LightingTotal)
     - (float)((float)(LIGHT_AI_LEVEL_MAX * LIGHT_AI_LEVEL_MAX) * (float)(v13 / LIGHT_AI_SCALE_RANGE));
  if ( v6 > 0.0 )
    return v6;
  v14 = (float)(v6 * v6)
      - (float)((float)(LIGHT_AI_LEVEL_MAX * LIGHT_AI_LEVEL_MAX) * (float)(v13 / LIGHT_AI_SCALE_RANGE2));
  if ( v14 > 0.0 )
    return -v14;
  return 0.0;
}

//----- (004BCC18) --------------------------------------------------------
bool __fastcall CPedAcquaintanceScanner::AddAcquaintanceEvent(
        CPedAcquaintanceScanner *this,
        const CPed *ped,
        const int iAcquaintanceType,
        CPed *pAcquaintancePed)
{
  void **v6; // r0
  bool v7; // r5
  CEvent *v8; // r5
  float v10; // r0
  CPedGroup *PedsGroup; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  double v14; // d16
  CEventAcquaintancePed v15; // [sp+0h] [bp-38h] BYREF
  uint32 v16; // [sp+14h] [bp-24h]
  double v17; // [sp+18h] [bp-20h]
  RwReal z; // [sp+20h] [bp-18h]

  switch ( iAcquaintanceType )
  {
    case 0:
      CEventAcquaintancePed::CEventAcquaintancePed(&v15, pAcquaintancePed);
      v6 = &`vtable for'CEventAcquaintancePedRespect;
      goto LABEL_8;
    case 1:
      CEventAcquaintancePed::CEventAcquaintancePed(&v15, pAcquaintancePed);
      v6 = &`vtable for'CEventAcquaintancePedLike;
      goto LABEL_8;
    case 2:
      if ( pAcquaintancePed->m_nPedType != 6 )
        return 0;
      CEventAcquaintancePed::CEventAcquaintancePed(&v15, pAcquaintancePed);
      v6 = &`vtable for'CEventSeenCop;
      goto LABEL_8;
    case 3:
      CEventAcquaintancePed::CEventAcquaintancePed(&v15, pAcquaintancePed);
      v6 = &`vtable for'CEventAcquaintancePedDislike;
      goto LABEL_8;
    case 4:
      v10 = CPedIntelligence::CanSeeEntityWithLights(ped->m_pPedIntelligence, pAcquaintancePed, 0);
      if ( v10 <= 0.0 )
      {
        v7 = 0;
        if ( v10 < 0.0 )
        {
          CEventAcquaintancePed::CEventAcquaintancePed(&v15, pAcquaintancePed);
          z = 0.0;
          v17 = 0.0;
          v15._vptr$CEvent = (int (**)(void))&off_666C68;
          v16 = CTimer::m_snTimeInMilliseconds;
          m_pMat = pAcquaintancePed->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &pAcquaintancePed->m_transform;
          v14 = *(double *)&p_tx->m_translate.x;
          z = p_tx->m_translate.z;
          v17 = v14;
LABEL_9:
          v8 = CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v15, 0);
          CEventAcquaintancePed::~CEventAcquaintancePed(&v15);
          return v8 != 0;
        }
      }
      else
      {
        if ( !CCheat::m_aCheatsActive[22]
          && (!CGameLogic::LaRiotsActiveHere() || !CPedAcquaintanceScanner::CanJoinLARiot(ped, pAcquaintancePed)) )
        {
          CEventAcquaintancePed::CEventAcquaintancePed(&v15, pAcquaintancePed);
          v6 = &`vtable for'CEventAcquaintancePedHate;
LABEL_8:
          v15._vptr$CEvent = (int (**)(void))((char *)*v6 + 8);
          goto LABEL_9;
        }
        CEventAcquaintancePed::CEventAcquaintancePed(&v15, pAcquaintancePed);
        v15._vptr$CEvent = (int (**)(void))&off_665394;
        PedsGroup = CPedGroups::GetPedsGroup(ped);
        if ( PedsGroup )
        {
          v15.m_iTaskType = 1502;
          v7 = CPedGroupIntelligence::AddEvent(&PedsGroup->m_intelligence, (CEvent *)&v15);
        }
        else
        {
          v15.m_iTaskType = 1000;
          v7 = CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v15, 0) != 0;
        }
        CEventAcquaintancePed::~CEventAcquaintancePed(&v15);
      }
      return v7;
    default:
      return 0;
  }
}
// 665394: using guessed type void *off_665394;
// 666C68: using guessed type void *;
// 676218: using guessed type void *`vtable for'CEventAcquaintancePedHate;
// 676A4C: using guessed type void *`vtable for'CEventAcquaintancePedRespect;
// 676FA8: using guessed type void *`vtable for'CEventAcquaintancePedDislike;
// 677584: using guessed type void *`vtable for'CEventAcquaintancePedLike;
// 67829C: using guessed type void *`vtable for'CEventSeenCop;

//----- (004BCDB8) --------------------------------------------------------
bool __fastcall CPedIntelligence::FindRespectedFriendInInformRange(CPedIntelligence *this)
{
  int v2; // r6
  uint32 Acquaintances; // r9
  char v4; // r8
  CPed **v5; // r0
  CPed *v6; // r5
  CMatrix *m_pMat; // r1
  CMatrix *v8; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *p_m_transform; // r1
  char v11; // r0
  float32x2_t v12; // d16
  float v13; // s4
  unsigned __int64 v14; // d1
  float v15; // s0

  v2 = 0;
  Acquaintances = CAcquaintance::GetAcquaintances(&this->m_pPed->m_acquaintances, 0);
  v4 = 0;
LABEL_2:
  if ( v2 <= 15 )
  {
    while ( v2 < this->m_iMaxNumFriendsToInform )
    {
      v5 = &this->m_pPed + v2++;
      v6 = v5[76];
      if ( v6 && (CPedType::GetPedFlag(v6->m_nPedType) & Acquaintances) != 0 )
      {
        m_pMat = v6->m_pMat;
        v8 = this->m_pPed->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &v6->m_transform;
        p_m_transform = (CSimpleTransform *)&v8->tx;
        if ( !v8 )
          p_m_transform = &this->m_pPed->m_transform;
        v11 = 0;
        v12.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
        v13 = this->m_fMaxInformFriendDistance * this->m_fMaxInformFriendDistance;
        v14 = vmul_f32(v12, v12).n64_u64[0];
        v15 = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                            * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                    + *(float *)&v14)
            + *((float *)&v14 + 1);
        if ( v15 < v13 )
          v11 = 1;
        v4 |= v11;
        if ( v15 >= v13 )
          goto LABEL_2;
        return v4 & 1;
      }
      if ( v2 - 1 >= 15 )
        return v4 & 1;
    }
  }
  return v4 & 1;
}

//----- (004BCE74) --------------------------------------------------------
bool __fastcall CPedIntelligence::Respects(const CPedIntelligence *this, const CPed *otherPed)
{
  uint32 Acquaintances; // r5

  Acquaintances = CAcquaintance::GetAcquaintances(&this->m_pPed->m_acquaintances, 0);
  return (CPedType::GetPedFlag(otherPed->m_nPedType) & Acquaintances) != 0;
}

//----- (004BCE98) --------------------------------------------------------
void __fastcall CPedAcquaintanceScanner::SetTimer(CPedAcquaintanceScanner *this, int32 msTime)
{
  this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
  this->m_timer.m_iDuration = msTime;
  this->m_timer.m_bIsActive = 1;
}

//----- (004BCEB0) --------------------------------------------------------
bool __fastcall CSexyPedScanner::IsScanPermitted(const CSexyPedScanner *this, const CPed *ped)
{
  return ped->CharCreatedBy == 2 || *((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31 == 0;
}

//----- (004BCECC) --------------------------------------------------------
void __fastcall CSexyPedScanner::ScanForSexyPedEvents(
        CSexyPedScanner *this,
        const CPed *ped,
        CEntity **ppNearbyPeds,
        const int iMaxNumPeds)
{
  int v5; // r6
  uint32 m_iStartTime; // r0
  int CharCreatedBy; // r0
  bool v10; // zf
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v13; // d16
  CPed *v14; // r9
  float v15; // s16
  CEntity *v16; // r11
  CMatrix *v17; // r0
  CSimpleTransform *p_m_transform; // r1
  float v19; // s24
  float v20; // s22
  float v21; // s26
  float v22; // s20
  CEventSexyPed vecEnd; // [sp+18h] [bp-78h] BYREF
  CVector vecStart; // [sp+30h] [bp-60h] BYREF

  v5 = iMaxNumPeds;
  if ( !this->m_timer.m_bIsActive )
  {
    *(_QWORD *)&this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds | 0x1F400000000LL;
    this->m_timer.m_bIsActive = 1;
  }
  if ( this->m_timer.m_bIsStopped )
  {
    m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_bIsStopped = 0;
    this->m_timer.m_iStartTime = m_iStartTime;
  }
  else
  {
    m_iStartTime = this->m_timer.m_iStartTime;
  }
  if ( m_iStartTime + this->m_timer.m_iDuration <= CTimer::m_snTimeInMilliseconds )
  {
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = 500;
    this->m_timer.m_bIsActive = 1;
    CharCreatedBy = ped->CharCreatedBy;
    v10 = CharCreatedBy == 2;
    if ( CharCreatedBy != 2 )
      v10 = *((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31 == 0;
    if ( v10 )
    {
      m_pMat = ped->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &ped->m_transform;
      v13 = *(_QWORD *)&p_tx->m_translate.x;
      vecStart.z = p_tx->m_translate.z;
      *(_QWORD *)&vecStart.x = v13;
      if ( iMaxNumPeds >= 1 )
      {
        v14 = 0;
        v15 = 1.0e10;
        do
        {
          v16 = *ppNearbyPeds;
          if ( *ppNearbyPeds
            && *(_DWORD *)&v16[23].numLodChildren == 5
            && *((char *)v16[24]._vptr$CPlaceable + 39) > ped->m_pPedStats->m_nSexiness
            && !(BYTE1(v16[19].m_transform.m_heading) << 31) )
          {
            v17 = v16->m_pMat;
            p_m_transform = (CSimpleTransform *)&v17->tx;
            if ( !v17 )
              p_m_transform = &v16->m_transform;
            *(_QWORD *)&vecEnd._vptr$CEvent = *(_QWORD *)&p_m_transform->m_translate.x;
            v19 = *(float *)&vecEnd._vptr$CEvent - vecStart.x;
            v20 = *(float *)&vecEnd.m_iAccumulatedTime - vecStart.y;
            *(RwReal *)&vecEnd.m_bIsPersistent = p_m_transform->m_translate.z;
            v21 = *(float *)&vecEnd.m_bIsPersistent - vecStart.z;
            v22 = (float)((float)(v19 * v19) + (float)(v20 * v20)) + (float)(v21 * v21);
            if ( v22 < 10000.0 )
            {
              if ( ped->m_pPlayerData )
                CInterestingEvents::Add(&g_InterestingEvents, ESexyPed, v16);
              if ( v22 < v15
                && (float)((float)((float)(v19 * ped->m_pMat->xy) + (float)(v20 * ped->m_pMat->yy))
                         + (float)(v21 * ped->m_pMat->zy)) > 0.0
                && CWorld::GetIsLineOfSightClear(&vecStart, (const CVector *)&vecEnd, 1, 0, 0, 1, 0, 0, 0) )
              {
                v15 = (float)((float)(v19 * v19) + (float)(v20 * v20)) + (float)(v21 * v21);
                v14 = (CPed *)v16;
              }
            }
          }
          --v5;
          ++ppNearbyPeds;
        }
        while ( v5 );
        if ( v14 )
        {
          CEventSexyPed::CEventSexyPed(&vecEnd, v14);
          CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&vecEnd, 0);
          *(_QWORD *)&this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds | 0xBB800000000LL;
          this->m_timer.m_bIsActive = 1;
          CEventSexyPed::~CEventSexyPed(&vecEnd);
        }
      }
    }
  }
}

//----- (004BD0E0) --------------------------------------------------------
void __fastcall CInterestingEvents::Add(CInterestingEvents *this, CInterestingEvents::EType eType, CEntity *pEntity)
{
  bool v5; // zf
  char *v6; // r0
  __int64 v7; // d16
  float m_fEventRadius; // s0
  float x; // s4
  float y; // s8
  CPlayerPed *PlayerPed; // r10
  float *p_x; // r4
  CMatrix *m_pMat; // r0
  float *p_tx; // r1
  float v15; // s2
  float v16; // s6
  RwReal v17; // s0
  CMatrix *v18; // r0
  __int64 v19; // d16
  CMatrix *v20; // r0
  RwReal v21; // s2
  CMatrix *v22; // r0
  float v23; // s0
  CSimpleTransform *p_m_transform; // r1
  float v25; // s6
  unsigned int v26; // r10
  CEntity **p_m_pEntity; // r4
  unsigned int m_iLookingAtEvent; // lr
  char *v29; // r2
  uint32 v30; // r12
  uint32 v31; // r11
  int v32; // r6
  int v33; // r1
  _BOOL4 v34; // r2
  _BOOL4 v35; // r1
  bool v36; // cc
  uint32 *v37; // [sp+18h] [bp-30h]
  CVector vecStart; // [sp+20h] [bp-28h] BYREF

  v5 = pEntity == 0;
  if ( pEntity )
    v5 = (*((_BYTE *)this + 300) & 1) == 0;
  if ( !v5 )
  {
    v6 = (char *)&TheCamera + 528 * TheCamera.ActiveCam;
    v7 = *(_QWORD *)(v6 + 740);
    vecStart.z = *((RwReal *)v6 + 187);
    *(_QWORD *)&vecStart.x = v7;
    if ( this->m_iCurrentFrameCounter == CTimer::m_FrameCounter )
    {
      m_fEventRadius = this->m_fEventRadius;
      x = this->m_ScanOrigin.x;
      y = this->m_ScanOrigin.y;
    }
    else
    {
      this->m_iCurrentFrameCounter = CTimer::m_FrameCounter;
      PlayerPed = FindPlayerPed(-1);
      p_x = &PlayerPed->m_transform.m_translate.x;
      m_pMat = PlayerPed->m_pMat;
      p_tx = &PlayerPed->m_transform.m_translate.x;
      v15 = vecStart.y;
      if ( m_pMat )
        p_tx = &m_pMat->tx;
      v16 = p_tx[1];
      v17 = *p_tx - vecStart.x;
      this->m_ViewVec.z = 0.0;
      this->m_ViewVec.x = v17;
      this->m_ViewVec.y = v16 - v15;
      if ( CVector::NormaliseAndMag(&this->m_ViewVec) == 0.0 )
      {
        v18 = PlayerPed->m_pMat;
        v19 = *(_QWORD *)&v18->xy;
        this->m_ViewVec.z = v18->zy;
        *(_QWORD *)&this->m_ViewVec.x = v19;
      }
      m_fEventRadius = this->m_fEventRadius;
      v20 = PlayerPed->m_pMat;
      if ( v20 )
        p_x = &v20->tx;
      x = (float)(m_fEventRadius * this->m_ViewVec.x) + *p_x;
      y = (float)(m_fEventRadius * this->m_ViewVec.y) + p_x[1];
      v21 = (float)(m_fEventRadius * this->m_ViewVec.z) + p_x[2];
      this->m_ScanOrigin.x = x;
      this->m_ScanOrigin.y = y;
      this->m_ScanOrigin.z = v21;
    }
    v22 = pEntity->m_pMat;
    v23 = m_fEventRadius * m_fEventRadius;
    p_m_transform = (CSimpleTransform *)&v22->tx;
    if ( !v22 )
      p_m_transform = &pEntity->m_transform;
    v25 = p_m_transform->m_translate.y;
    if ( (float)((float)((float)(x - p_m_transform->m_translate.x) * (float)(x - p_m_transform->m_translate.x))
               + (float)((float)(y - v25) * (float)(y - v25))) <= v23
      && ((*((_BYTE *)this + 300) & 2) == 0
       || (float)((float)((float)((float)(p_m_transform->m_translate.x * this->m_ViewVec.x)
                                + (float)(v25 * this->m_ViewVec.y))
                        + (float)(p_m_transform->m_translate.z * this->m_ViewVec.z))
                - (float)((float)((float)(this->m_ViewVec.x * vecStart.x) + (float)(this->m_ViewVec.y * vecStart.y))
                        + (float)(this->m_ViewVec.z * vecStart.z))) >= 0.0) )
    {
      v26 = 0;
      if ( CWorld::GetIsLineOfSightClear(&vecStart, &p_m_transform->m_translate, 1, 0, 0, 0, 0, 1, 0) )
      {
        p_m_pEntity = &this->m_Events[0].m_pEntity;
        m_iLookingAtEvent = this->m_iLookingAtEvent;
        v29 = (char *)this + 4 * eType;
        v30 = *((_DWORD *)v29 + 46);
        v37 = (uint32 *)(v29 + 184);
        v31 = CTimer::m_snTimeInMilliseconds;
        while ( 1 )
        {
          v32 = v26;
          if ( !*p_m_pEntity )
            break;
          v33 = (int)*(p_m_pEntity - 2);
          if ( !v33 )
            goto LABEL_29;
          v34 = CTimer::m_snTimeInMilliseconds <= (unsigned int)*(p_m_pEntity - 1) + this->m_EventDurations[v33];
          v35 = this->m_EventPriorities[eType] < (unsigned int)this->m_EventPriorities[v33];
          v36 = m_iLookingAtEvent > v26;
          if ( m_iLookingAtEvent != v26 )
            v36 = CTimer::m_snTimeInMilliseconds > v30;
          if ( v36 && (!v35 || !v34) )
          {
LABEL_29:
            CEntity::CleanUpOldReference(*p_m_pEntity, p_m_pEntity);
            goto LABEL_31;
          }
          p_m_pEntity += 3;
          ++v26;
          if ( v32 > 6 )
            return;
        }
        *p_m_pEntity = 0;
        *(p_m_pEntity - 2) = 0;
LABEL_31:
        *(p_m_pEntity - 2) = (CEntity *)eType;
        *(p_m_pEntity - 1) = (CEntity *)v31;
        *p_m_pEntity = pEntity;
        CEntity::RegisterReference(pEntity, p_m_pEntity);
        if ( (*((_BYTE *)this + 300) & 8) != 0 )
          v31 += this->m_EventDurations[eType] >> 1;
        *v37 = v31;
      }
    }
  }
}

//----- (004BD378) --------------------------------------------------------
void __fastcall CNearbyFireScanner::ScanForNearbyFires(CNearbyFireScanner *this, const CPed *ped)
{
  float v2; // s16
  uint32 m_iStartTime; // r1
  int v5; // r8
  CTask *SimplestActiveTask; // r0
  CTask *v7; // r5
  CTask *ActiveTask; // r5
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_m_transform; // r6
  CSimpleTransform *p_tx; // r1
  CFire *NearestFire; // r10
  CMatrix *v13; // r0
  CTask *v14; // r0
  int IsGoToTask; // r0
  bool v16; // zf
  CEventPotentialWalkIntoFire v17[2]; // [sp+0h] [bp-50h] BYREF

  if ( !this->m_timer.m_bIsActive )
  {
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = 0;
    this->m_timer.m_bIsActive = 1;
  }
  if ( this->m_timer.m_bIsStopped )
  {
    m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_bIsStopped = 0;
    this->m_timer.m_iStartTime = m_iStartTime;
  }
  else
  {
    m_iStartTime = this->m_timer.m_iStartTime;
  }
  if ( m_iStartTime + this->m_timer.m_iDuration <= CTimer::m_snTimeInMilliseconds )
  {
    v5 = 1;
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = 100;
    this->m_timer.m_bIsActive = 1;
    SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    v7 = SimplestActiveTask;
    if ( SimplestActiveTask )
    {
      if ( CTask::IsGoToTask(SimplestActiveTask) )
        v5 = (int)v7[1]._vptr$CTask;
      else
        v5 = 1;
    }
    ActiveTask = CTaskManager::GetActiveTask(&ped->m_pPedIntelligence->m_taskManager);
    m_pMat = ped->m_pMat;
    p_m_transform = &ped->m_transform;
    p_tx = &ped->m_transform;
    if ( m_pMat )
      p_tx = (CSimpleTransform *)&m_pMat->tx;
    NearestFire = CFireManager::FindNearestFire(&gFireManager, &p_tx->m_translate, 0, 0);
    if ( NearestFire )
    {
      v13 = ped->m_pMat;
      if ( v13 )
        p_m_transform = (CSimpleTransform *)&v13->tx;
      v2 = NearestFire->m_vLocation.z - p_m_transform->m_translate.z;
      if ( fabsf(v2) < 2.0 )
      {
        CEventFireNearby::CEventFireNearby((CEventFireNearby *)v17, &NearestFire->m_vLocation);
        CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)v17, 0);
        CEvent::~CEvent((CEvent *)v17);
      }
      if ( !ActiveTask )
        return;
    }
    else if ( !ActiveTask )
    {
      return;
    }
    if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 514 )
    {
      v14 = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
      if ( v14 )
      {
        IsGoToTask = CTask::IsGoToTask(v14);
        if ( fabsf(v2) < 2.0 )
        {
          v16 = NearestFire == 0;
          if ( NearestFire )
            v16 = IsGoToTask == 0;
          if ( !v16 )
          {
            CEventPotentialWalkIntoFire::CEventPotentialWalkIntoFire(
              v17,
              &NearestFire->m_vLocation,
              NearestFire->m_Strength,
              v5);
            CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)v17, 0);
            CEvent::~CEvent((CEvent *)v17);
          }
        }
      }
    }
  }
}
// 4BD4C0: variable 'v2' is possibly undefined

//----- (004BD530) --------------------------------------------------------
void __fastcall CDecision::CDecision(CDecision *this)
{
  *(_WORD *)&this->m_bools[2][0] = 0;
  *(_DWORD *)&this->m_probs[2][0] = 0;
  *(_DWORD *)&this->m_bools[0][0] = 0;
  *(_QWORD *)this->m_tasks = -1LL;
  *(_QWORD *)&this->m_tasks[2] = -1LL;
  *(_WORD *)&this->m_bools[3][0] = 0;
  *(_DWORD *)&this->m_probs[3][0] = 0;
  *(_DWORD *)&this->m_probs[4][0] = 0;
  *(_WORD *)&this->m_bools[4][0] = 0;
  *(_DWORD *)&this->m_probs[5][0] = 0;
  *(_WORD *)&this->m_bools[5][0] = 0;
  *(_QWORD *)&this->m_tasks[4] = -1LL;
  *(_QWORD *)&this->m_probs[0][0] = 0LL;
}

//----- (004BD570) --------------------------------------------------------
void __fastcall CDecision::SetDefault(CDecision *this)
{
  *(_WORD *)&this->m_bools[2][0] = 0;
  *(_DWORD *)&this->m_probs[2][0] = 0;
  *(_DWORD *)&this->m_bools[0][0] = 0;
  *(_QWORD *)this->m_tasks = -1LL;
  *(_QWORD *)&this->m_tasks[2] = -1LL;
  *(_WORD *)&this->m_bools[3][0] = 0;
  *(_DWORD *)&this->m_probs[3][0] = 0;
  *(_DWORD *)&this->m_probs[4][0] = 0;
  *(_WORD *)&this->m_bools[4][0] = 0;
  *(_DWORD *)&this->m_probs[5][0] = 0;
  *(_WORD *)&this->m_bools[5][0] = 0;
  *(_QWORD *)&this->m_tasks[4] = -1LL;
  *(_QWORD *)&this->m_probs[0][0] = 0LL;
}

//----- (004BD5B0) --------------------------------------------------------
void __fastcall CDecision::Set(
        CDecision *this,
        int *pTasks,
        float (*probs)[4],
        int (*bools)[2],
        float (*facialProbs)[6])
{
  int *v5; // r12
  float *v6; // r2
  int v7; // r3
  float v8; // s0
  char *v9; // r5
  float v10; // s2
  float v11; // s0
  char *v12; // r6
  int v13; // r5

  v5 = &(*bools)[1];
  v6 = &(*probs)[2];
  v7 = 0;
  do
  {
    this->m_tasks[v7] = pTasks[v7];
    v8 = *(v6 - 2);
    v9 = (char *)this + 1 * v7;
    v10 = (float)(((unsigned int)*(v6 - 1) + (unsigned int)v8 + (unsigned int)*v6 + (unsigned int)v6[1]) / 0xFF + 1);
    v9[24] = (unsigned int)(float)(v8 / v10);
    v9[25] = (unsigned int)(float)(*(v6 - 1) / v10);
    v9[26] = (unsigned int)(float)(*v6 / v10);
    v11 = v6[1];
    v6 += 4;
    v9[27] = (unsigned int)(float)(v11 / v10);
    v12 = (char *)this + v7 * 2;
    ++v7;
    v12[48] = *(v5 - 1) != 0;
    v13 = *v5;
    v5 += 2;
    v12[49] = v13 != 0;
  }
  while ( v7 != 6 );
}

//----- (004BD690) --------------------------------------------------------
void __fastcall CDecision::Add(CDecision *this, const int iTaskType, float *pProbs, int *pBools)
{
  bool v4; // zf
  bool v5; // zf
  bool v6; // zf
  bool v7; // zf
  bool v8; // zf
  bool v9; // zf
  bool v10; // zf
  bool v11; // zf
  int v12; // r12
  bool v13; // zf
  bool v14; // zf
  bool v15; // zf
  bool v16; // zf
  bool v17; // zf
  bool v18; // zf
  bool v19; // zf
  bool v20; // zf
  bool v21; // zf
  bool v22; // zf
  CTaskTypes::eTaskType *v23; // lr
  char *v24; // r0
  int v25; // r1

  v4 = this->m_tasks[0] == -1;
  if ( this->m_tasks[0] == -1 )
    v4 = this->m_probs[0][0] == 0;
  if ( v4 )
  {
    v10 = this->m_probs[0][1] == 0;
    if ( !this->m_probs[0][1] )
      v10 = this->m_probs[0][2] == 0;
    if ( v10 )
    {
      v11 = this->m_probs[0][3] == 0;
      if ( !this->m_probs[0][3] )
        v11 = !this->m_bools[0][0];
      if ( v11 && !this->m_bools[0][1] )
      {
        v12 = 0;
LABEL_80:
        this->m_tasks[v12] = iTaskType;
        v23 = &this->m_tasks[v12];
        v24 = (char *)this + 2 * v12;
        *((_BYTE *)v23 + 24) = (unsigned int)*pProbs;
        *((_BYTE *)v23 + 25) = (unsigned int)pProbs[1];
        *((_BYTE *)v23 + 26) = (unsigned int)pProbs[2];
        *((_BYTE *)v23 + 27) = (unsigned int)pProbs[3];
        v25 = *pBools;
        if ( *pBools )
          LOBYTE(v25) = 1;
        v24[48] = v25;
        v24[49] = pBools[1] != 0;
        return;
      }
    }
  }
  if ( this->m_tasks[1] == -1 )
  {
    v5 = this->m_probs[1][0] == 0;
    if ( !this->m_probs[1][0] )
      v5 = this->m_probs[1][1] == 0;
    if ( v5 )
    {
      v15 = this->m_probs[1][2] == 0;
      if ( !this->m_probs[1][2] )
        v15 = this->m_probs[1][3] == 0;
      if ( v15 )
      {
        v16 = !this->m_bools[1][0];
        if ( !this->m_bools[1][0] )
          v16 = !this->m_bools[1][1];
        if ( v16 )
        {
          v12 = 1;
          goto LABEL_80;
        }
      }
    }
  }
  if ( this->m_tasks[2] == -1 )
  {
    v6 = this->m_probs[2][0] == 0;
    if ( !this->m_probs[2][0] )
      v6 = this->m_probs[2][1] == 0;
    if ( v6 )
    {
      v17 = this->m_probs[2][2] == 0;
      if ( !this->m_probs[2][2] )
        v17 = this->m_probs[2][3] == 0;
      if ( v17 )
      {
        v18 = !this->m_bools[2][0];
        if ( !this->m_bools[2][0] )
          v18 = !this->m_bools[2][1];
        if ( v18 )
        {
          v12 = 2;
          goto LABEL_80;
        }
      }
    }
  }
  if ( this->m_tasks[3] == -1 )
  {
    v7 = this->m_probs[3][0] == 0;
    if ( !this->m_probs[3][0] )
      v7 = this->m_probs[3][1] == 0;
    if ( v7 )
    {
      v19 = this->m_probs[3][2] == 0;
      if ( !this->m_probs[3][2] )
        v19 = this->m_probs[3][3] == 0;
      if ( v19 )
      {
        v20 = !this->m_bools[3][0];
        if ( !this->m_bools[3][0] )
          v20 = !this->m_bools[3][1];
        if ( v20 )
        {
          v12 = 3;
          goto LABEL_80;
        }
      }
    }
  }
  if ( this->m_tasks[4] == -1 )
  {
    v8 = this->m_probs[4][0] == 0;
    if ( !this->m_probs[4][0] )
      v8 = this->m_probs[4][1] == 0;
    if ( v8 )
    {
      v21 = this->m_probs[4][2] == 0;
      if ( !this->m_probs[4][2] )
        v21 = this->m_probs[4][3] == 0;
      if ( v21 )
      {
        v22 = !this->m_bools[4][0];
        if ( !this->m_bools[4][0] )
          v22 = !this->m_bools[4][1];
        if ( v22 )
        {
          v12 = 4;
          goto LABEL_80;
        }
      }
    }
  }
  if ( this->m_tasks[5] == -1 )
  {
    v9 = this->m_probs[5][0] == 0;
    if ( !this->m_probs[5][0] )
      v9 = this->m_probs[5][1] == 0;
    if ( v9 )
    {
      v13 = this->m_probs[5][2] == 0;
      if ( !this->m_probs[5][2] )
        v13 = this->m_probs[5][3] == 0;
      if ( v13 )
      {
        v14 = !this->m_bools[5][0];
        if ( !this->m_bools[5][0] )
          v14 = !this->m_bools[5][1];
        if ( v14 )
        {
          v12 = 5;
          goto LABEL_80;
        }
      }
    }
  }
}

//----- (004BD8DC) --------------------------------------------------------
void __fastcall CDecision::From(CDecision *this, const CDecision *src)
{
  *this = *src;
}

//----- (004BD9F8) --------------------------------------------------------
void __fastcall CDecision::MakeDecision(
        const CDecision *this,
        const int iEventSourceType,
        int bInVehicle,
        const int iTaskTypeToReject1,
        const int iTaskTypeToReject2,
        const int iTaskTypeToReject3,
        const int iTaskTypeToSeek,
        int16 *iTask,
        int16 *iFacialTask)
{
  float *v9; // r10
  int v10; // r8
  char *v11; // r9
  uint8 v12; // r6
  CTaskTypes::eTaskType v13; // r1
  int v14; // r5
  bool v15; // zf
  bool v16; // zf
  char v17; // r6
  CTaskTypes::eTaskType v18; // r1
  bool v19; // zf
  bool v20; // zf
  char v21; // r6
  CTaskTypes::eTaskType v22; // r1
  bool v23; // zf
  bool v24; // zf
  char v25; // r6
  CTaskTypes::eTaskType v26; // r1
  bool v27; // zf
  bool v28; // zf
  CTaskTypes::eTaskType v29; // r6
  CTaskTypes::eTaskType v30; // r1
  bool v31; // zf
  bool v32; // zf
  int v33; // r1
  bool v34; // zf
  bool v35; // zf
  bool v36; // zf
  float v37; // s0
  int v38; // r1
  float *v39; // r3
  unsigned int v40; // r5
  int v41; // r5
  int v42; // r1
  float *v43; // r2
  float v44; // s0
  int v45; // r1
  float v46; // s0
  int v47; // r0
  float v48; // s0
  int v49; // [sp+0h] [bp-70h] BYREF
  __int16 v50; // [sp+4h] [bp-6Ch]
  _QWORD v51[2]; // [sp+8h] [bp-68h]
  int v52; // [sp+18h] [bp-58h]
  int v53; // [sp+1Ch] [bp-54h]
  _QWORD v54[2]; // [sp+20h] [bp-50h]
  int v55; // [sp+30h] [bp-40h]
  int v56; // [sp+34h] [bp-3Ch]
  _BYTE v57[16]; // [sp+38h] [bp-38h] BYREF
  int v58; // [sp+48h] [bp-28h]
  int v59; // [sp+4Ch] [bp-24h]
  int v60; // [sp+50h] [bp-20h]

  v9 = (float *)v57;
  v54[0] = 0xC8000000C8LL;
  v54[1] = 0xC8000000C8LL;
  v10 = 0;
  v55 = 200;
  v11 = (char *)this + iEventSourceType;
  memset(v57, 0, sizeof(v57));
  v58 = 0;
  v51[0] = 0xC8000000C8LL;
  v51[1] = 0xC8000000C8LL;
  v59 = 0;
  v50 = 0;
  v52 = 200;
  v56 = 200;
  v49 = 0;
  v53 = 200;
  v12 = this->m_probs[0][iEventSourceType];
  if ( v12 )
  {
    v13 = this->m_tasks[0];
    v10 = 0;
    v14 = iTaskTypeToReject3;
    v15 = this->m_tasks[0] == iTaskTypeToReject3;
    if ( this->m_tasks[0] != iTaskTypeToReject3 )
      v15 = v13 == iTaskTypeToReject2;
    if ( !v15 )
    {
      v16 = v13 == -1;
      if ( v13 != -1 )
        v16 = v13 == iTaskTypeToReject1;
      if ( !v16 )
      {
        if ( this->m_bools[0][bInVehicle] )
        {
          v10 = 1;
          LODWORD(v51[0]) = this->m_tasks[0];
          LOBYTE(v49) = v12;
        }
        else
        {
          v10 = 0;
        }
      }
    }
  }
  else
  {
    v14 = iTaskTypeToReject3;
  }
  v17 = v11[28];
  if ( v17 )
  {
    v18 = this->m_tasks[1];
    v19 = v18 == v14;
    if ( v18 != v14 )
      v19 = v18 == iTaskTypeToReject2;
    if ( !v19 )
    {
      v20 = v18 == -1;
      if ( v18 != -1 )
        v20 = v18 == iTaskTypeToReject1;
      if ( !v20 && this->m_bools[1][bInVehicle] )
      {
        *((_DWORD *)v51 + v10) = v18;
        *(_BYTE *)((unsigned int)&v49 | v10++) = v17;
      }
    }
  }
  v21 = v11[32];
  if ( v21 )
  {
    v22 = this->m_tasks[2];
    v23 = v22 == v14;
    if ( v22 != v14 )
      v23 = v22 == iTaskTypeToReject2;
    if ( !v23 )
    {
      v24 = v22 == -1;
      if ( v22 != -1 )
        v24 = v22 == iTaskTypeToReject1;
      if ( !v24 && this->m_bools[2][bInVehicle] )
      {
        *((_DWORD *)v51 + v10) = v22;
        *((_BYTE *)&v49 + v10++) = v21;
      }
    }
  }
  v25 = v11[36];
  if ( v25 )
  {
    v26 = this->m_tasks[3];
    v27 = v26 == v14;
    if ( v26 != v14 )
      v27 = v26 == iTaskTypeToReject2;
    if ( !v27 )
    {
      v28 = v26 == -1;
      if ( v26 != -1 )
        v28 = v26 == iTaskTypeToReject1;
      if ( !v28 && this->m_bools[3][bInVehicle] )
      {
        *((_DWORD *)v51 + v10) = v26;
        *((_BYTE *)&v49 + v10++) = v25;
      }
    }
  }
  v29 = (unsigned __int8)v11[40];
  if ( v11[40] )
  {
    v30 = this->m_tasks[4];
    v31 = v30 == v14;
    if ( v30 != v14 )
      v31 = v30 == iTaskTypeToReject2;
    if ( !v31 )
    {
      v32 = v30 == -1;
      if ( v30 != -1 )
        v32 = v30 == iTaskTypeToReject1;
      if ( !v32 && this->m_bools[4][bInVehicle] )
      {
        *((_DWORD *)v51 + v10) = v30;
        *((_BYTE *)&v49 + v10++) = v29;
      }
    }
  }
  v33 = (unsigned __int8)v11[44];
  v34 = v33 == 0;
  if ( v11[44] )
  {
    v29 = this->m_tasks[5];
    v34 = v29 == v14;
  }
  if ( v34 )
    goto LABEL_58;
  v35 = v29 == iTaskTypeToReject2;
  if ( v29 != iTaskTypeToReject2 )
    v35 = v29 == -1;
  if ( v35 )
    goto LABEL_58;
  v36 = v29 == iTaskTypeToReject1;
  if ( v29 != iTaskTypeToReject1 )
    v36 = !this->m_bools[5][bInVehicle];
  if ( v36 )
  {
LABEL_58:
    *iTask = 200;
    if ( v10 <= 0 )
      goto LABEL_77;
  }
  else
  {
    *((_DWORD *)v51 + v10) = v29;
    *((_BYTE *)&v49 + v10) = v33;
    *iTask = 200;
  }
  v37 = 0.0;
  v60 = 6;
  v38 = 0;
  v39 = (float *)v57;
  do
  {
    *(v39 - 6) = *((float *)v51 + v38);
    v40 = *((unsigned __int8 *)&v49 + v38++);
    v37 = v37 + (float)v40;
    *v39++ = v37;
    v41 = v60;
  }
  while ( v38 < v60 );
  if ( v60 >= 1 )
  {
    v42 = 0;
    v43 = (float *)v57;
    v44 = 1.0 / v37;
    do
    {
      ++v42;
      *v43 = v44 * *v43;
      ++v43;
      v41 = v60;
    }
    while ( v42 < v60 );
  }
  *iTask = 200;
  if ( iTaskTypeToSeek == -1 || v41 < 1 )
    goto LABEL_71;
  v45 = 0;
  while ( *((_DWORD *)v54 + v45) != iTaskTypeToSeek )
  {
    if ( ++v45 >= v41 )
      goto LABEL_71;
  }
  *iTask = iTaskTypeToSeek;
  if ( (unsigned __int16)iTaskTypeToSeek == 200 )
  {
LABEL_71:
    v46 = (float)rand();
    if ( v41 >= 1 )
    {
      v47 = 0;
      v48 = (float)(v46 * 4.6566e-10) + 0.0;
      while ( v48 > *v9 )
      {
        ++v47;
        ++v9;
        if ( v47 >= v41 )
          goto LABEL_77;
      }
      *iTask = *((_DWORD *)v9 - 6);
    }
  }
LABEL_77:
  *iFacialTask = -1;
}

//----- (004BDC78) --------------------------------------------------------
void __fastcall CDecisionSimple::Set(CDecisionSimple *this, int *pTasks, uint8 *pProbs, const int iSize)
{
  float v4; // s0
  int v5; // r4
  int v6; // r12
  unsigned int v7; // r3
  unsigned int v8; // s2
  float *v9; // r3
  int m_iSize; // lr
  float *m_probs; // r1
  int v12; // r2
  float v13; // s0

  this->m_iSize = iSize;
  if ( iSize >= 1 )
  {
    v4 = 0.0;
    v5 = 0;
    v6 = 24;
    do
    {
      this->m_tasks[v5] = pTasks[v5];
      v7 = pProbs[v5++];
      v8 = v7;
      v9 = (float *)((char *)this + v6);
      v6 += 4;
      v4 = v4 + (float)v8;
      *v9 = v4;
      m_iSize = this->m_iSize;
    }
    while ( v5 < m_iSize );
    if ( m_iSize >= 1 )
    {
      m_probs = this->m_probs;
      v12 = 0;
      v13 = 1.0 / v4;
      do
      {
        ++v12;
        *m_probs = v13 * *m_probs;
        ++m_probs;
      }
      while ( v12 < this->m_iSize );
    }
  }
}

//----- (004BDCEC) --------------------------------------------------------
void __fastcall CDecisionSimple::MakeDecision(
        const CDecisionSimple *this,
        const int iTaskTypeToSeek,
        int16 *iTaskType,
        int *index)
{
  int m_iSize; // r0
  int v8; // r2
  float v9; // s0
  int v10; // r0
  float *m_probs; // r2
  int v12; // r1
  float v13; // s0

  *iTaskType = 200;
  *index = -1;
  if ( iTaskTypeToSeek != -1 )
  {
    m_iSize = this->m_iSize;
    if ( m_iSize >= 1 )
    {
      v8 = 0;
      while ( this->m_tasks[v8] != iTaskTypeToSeek )
      {
        if ( ++v8 >= m_iSize )
          goto LABEL_8;
      }
      *iTaskType = iTaskTypeToSeek;
      *index = v8;
    }
  }
LABEL_8:
  if ( *iTaskType == 200 )
  {
    v9 = (float)rand();
    v10 = this->m_iSize;
    if ( v10 >= 1 )
    {
      m_probs = this->m_probs;
      v12 = 0;
      v13 = (float)(v9 * 4.6566e-10) + 0.0;
      while ( v13 > *m_probs )
      {
        ++v12;
        ++m_probs;
        if ( v12 >= v10 )
          return;
      }
      *iTaskType = *((_DWORD *)m_probs - 6);
      *index = v12;
    }
  }
}

//----- (004BDD84) --------------------------------------------------------
bool __fastcall CDecision::HasResponse(const CDecision *this)
{
  CTaskTypes::eTaskType v1; // r1
  bool v2; // zf
  CTaskTypes::eTaskType v3; // r1
  bool v4; // zf

  if ( this->m_tasks[0] != TASK_NONE )
    return 1;
  v1 = this->m_tasks[1];
  v2 = v1 == TASK_NONE;
  if ( v1 == TASK_NONE )
    v2 = this->m_tasks[2] == TASK_NONE;
  if ( !v2 )
    return 1;
  v3 = this->m_tasks[3];
  v4 = v3 == TASK_NONE;
  if ( v3 == TASK_NONE )
    v4 = this->m_tasks[4] == TASK_NONE;
  return !v4 || this->m_tasks[5] != TASK_NONE;
}

//----- (004BDDB2) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CDecisionSimple::SetDefault(CDecisionSimple *this)
{
  float v1; // s0
  int v2; // r2
  float *v3; // r3
  float v4; // s2
  int m_iSize; // r1
  float *m_probs; // r1
  int v7; // r2
  float v8; // s0
  char v9; // [sp+2h] [bp-26h]
  int v10; // [sp+3h] [bp-25h]
  char v11; // [sp+7h] [bp-21h]
  __int64 v12; // [sp+8h] [bp-20h] OVERLAPPED
  __int64 v13; // [sp+10h] [bp-18h]
  int v14; // [sp+18h] [bp-10h]
  int v15; // [sp+1Ch] [bp-Ch]

  v1 = 1.0;
  v11 = 0;
  v10 = 0;
  v12 = 0xC8000000C8LL;
  v13 = 0xC8000000C8LL;
  v2 = 1;
  v14 = 200;
  v15 = 200;
  v9 = 1;
  this->m_probs[0] = 1.0;
  this->m_tasks[0] = TASK_NONE;
  v3 = &this->m_probs[1];
  this->m_iSize = 6;
  do
  {
    v4 = (float)(unsigned __int8)*(&v9 + v2);
    *(v3 - 6) = *((float *)&v12 + v2++);
    v1 = v1 + v4;
    *v3++ = v1;
    m_iSize = this->m_iSize;
  }
  while ( v2 < m_iSize );
  if ( m_iSize >= 1 )
  {
    m_probs = this->m_probs;
    v7 = 0;
    v8 = 1.0 / v1;
    do
    {
      ++v7;
      *m_probs = v8 * *m_probs;
      ++m_probs;
    }
    while ( v7 < this->m_iSize );
  }
}
// 4BDDB2: variables would overlap: ^8.8 and stkvar "probs" ^A.6(has user info)

//----- (004BDE44) --------------------------------------------------------
void __fastcall CDecisionMakerTypes::LoadEventIndices(CDecisionMakerTypes *this)
{
  sub_18AB44(this, this->m_eventIndices, "PedEvent.txt");
}

//----- (004BDE60) --------------------------------------------------------
void __fastcall CDecisionMakerTypes::MakeDecision(
        const CDecisionMakerTypes *this,
        const CPed *ped,
        const int iEventType,
        const int iEventSourceType,
        const bool bInVehicle,
        const int iTaskToAvoid1,
        const int iTaskToAvoid2,
        const int iTaskToAvoid3,
        const int iTaskToSeek,
        int bUseInGroupDecisionMaker,
        int16 *iTaskType,
        int16 *iFacialTaskType)
{
  CPedIntelligence *m_pPedIntelligence; // r5
  int v13; // r4
  int *p_m_iDecisionMakerType; // r2
  int v15; // r5
  char *v16; // r0
  int v17; // r1
  const CDecision *v18; // r0
  int iTaskTypeToReject2; // [sp+0h] [bp-30h]
  int v20; // [sp+4h] [bp-2Ch]
  int v21; // [sp+8h] [bp-28h]
  int16 *v22; // [sp+Ch] [bp-24h]
  int16 *v23; // [sp+10h] [bp-20h]

  m_pPedIntelligence = ped->m_pPedIntelligence;
  v13 = this->m_eventIndices[iEventType];
  p_m_iDecisionMakerType = &m_pPedIntelligence->m_iDecisionMakerType;
  if ( bUseInGroupDecisionMaker )
    p_m_iDecisionMakerType = &m_pPedIntelligence->m_iDecisionMakerTypeInGroup;
  v15 = *p_m_iDecisionMakerType;
  *iTaskType = 200;
  *iFacialTaskType = -1;
  if ( v15 == -1 )
  {
    iTaskTypeToReject2 = iTaskToAvoid2;
    v20 = iTaskToAvoid3;
    v21 = iTaskToSeek;
    v22 = iTaskType;
    v23 = iFacialTaskType;
    v16 = (char *)this + 60 * v13;
    if ( ped->CharCreatedBy == 2 )
      v17 = 52048;
    else
      v17 = 49588;
  }
  else
  {
    if ( v15 != -2 )
    {
      iTaskTypeToReject2 = iTaskToAvoid2;
      v20 = iTaskToAvoid3;
      v21 = iTaskToSeek;
      v22 = iTaskType;
      v23 = iFacialTaskType;
      v18 = &this->m_decisionMakers[v15].m_decisions[v13];
      goto LABEL_11;
    }
    iTaskTypeToReject2 = iTaskToAvoid2;
    v20 = iTaskToAvoid3;
    v21 = iTaskToSeek;
    v22 = iTaskType;
    v23 = iFacialTaskType;
    v16 = (char *)this + 60 * v13;
    v17 = 54508;
  }
  v18 = (const CDecision *)&v16[v17];
LABEL_11:
  CDecision::MakeDecision(v18, iEventSourceType, bInVehicle, iTaskToAvoid1, iTaskTypeToReject2, v20, v21, v22, v23);
}

//----- (004BDF1C) --------------------------------------------------------
int __fastcall CDecisionMakerTypes::MakeDecision(
        const CDecisionMakerTypes *this,
        const CPedGroup *pedGroup,
        const int iEventType,
        const int iEventSourceType,
        const bool bInVehicle,
        const int iTaskToAvoid1,
        const int iTaskToAvoid2,
        const int iTaskToAvoid3,
        const int iTaskToSeek)
{
  int v9; // lr
  int m_iDecisionMaker; // r4
  char *v11; // r0
  int v12; // r1
  int16 iFacialTask; // [sp+14h] [bp-1Ch] BYREF
  int16 v15[13]; // [sp+16h] [bp-1Ah] BYREF

  v9 = this->m_eventIndices[iEventType];
  m_iDecisionMaker = pedGroup->m_intelligence.m_iDecisionMaker;
  v15[0] = 200;
  iFacialTask = -1;
  if ( m_iDecisionMaker == -1 )
  {
    v11 = (char *)this + 60 * v9;
    if ( pedGroup->m_iGroupCreatedBy == 1 )
      v12 = 59428;
    else
      v12 = 56968;
    CDecision::MakeDecision(
      (const CDecision *)&v11[v12],
      iEventSourceType,
      bInVehicle,
      iTaskToAvoid1,
      iTaskToAvoid2,
      iTaskToAvoid3,
      iTaskToSeek,
      v15,
      &iFacialTask);
  }
  else
  {
    CDecision::MakeDecision(
      &this->m_decisionMakers[m_iDecisionMaker].m_decisions[v9],
      iEventSourceType,
      bInVehicle,
      iTaskToAvoid1,
      iTaskToAvoid2,
      iTaskToAvoid3,
      iTaskToSeek,
      v15,
      &iFacialTask);
  }
  return v15[0];
}

//----- (004BDFB4) --------------------------------------------------------
unsigned int __fastcall CDecisionMakerTypes::AddDecisionMaker(
        CDecisionMakerTypes *this,
        const CDecisionMaker *decisionMaker,
        const uint8 iType,
        unsigned int bDecisionMakerForMission,
        int indexToReplace)
{
  unsigned int v5; // r4
  int v6; // lr
  CDecisionMaker *i; // r5
  char v10; // r3
  int v11; // r0
  bool v12; // zf
  int v13; // r6

  v5 = bDecisionMakerForMission;
  v6 = 20;
  if ( bDecisionMakerForMission )
    v5 = 15;
  else
    v6 = 15;
  if ( v5 >= v6 )
    return -1;
  for ( i = &this->m_decisionMakers[(__int16)v5]; ; ++i )
  {
    v10 = 0;
    v11 = CDecisionMakerTypes::m_bIsActive[v5] | ~indexToReplace;
    if ( indexToReplace > 0 )
      v10 = 1;
    v12 = v11 == 0;
    if ( v11 )
      v12 = ((unsigned __int8)v10 & (indexToReplace == v5)) == 1;
    if ( v12 )
      break;
    if ( (int)++v5 >= v6 )
      return -1;
  }
  v13 = 4;
  CDecisionMakerTypes::m_bIsActive[v5] = 1;
  CDecisionMakerTypes::m_types[v5] = iType;
  do
  {
    CDecision::operator=(i->m_decisions, (const CDecision *)((char *)decisionMaker->m_decisions + v13 - 4));
    v13 += 60;
    i = (CDecisionMaker *)((char *)i + 60);
  }
  while ( v13 != 2464 );
  ++this->m_iNoOfDecisionMakers;
  return v5;
}
// 6793D0: using guessed type char (*CDecisionMakerTypes::m_bIsActive)[20];

//----- (004BE068) --------------------------------------------------------
void __fastcall CDecisionMakerTypes::RemoveDecisionMaker(CDecisionMakerTypes *this, const int iDecisionMakerIndex)
{
  CPedPool *v4; // r0
  int32 m_nSize; // r2
  int v6; // r1
  int v7; // r2
  int v8; // r1
  uint8 *v9; // r4
  _DWORD *v10; // r3
  int v11; // r4
  _DWORD *v12; // r5

  if ( CDecisionMakerTypes::m_bIsActive[iDecisionMakerIndex] )
  {
    if ( CDecisionMakerTypes::m_types[iDecisionMakerIndex] )
    {
      if ( CPedGroups::ms_activeGroups[0]
        && CPedGroups::ms_groups[0].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[0].m_intelligence, -1);
      }
      if ( CPedGroups::ms_activeGroups[1]
        && CPedGroups::ms_groups[1].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[1].m_intelligence, -1);
      }
      if ( CPedGroups::ms_activeGroups[2]
        && CPedGroups::ms_groups[2].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[2].m_intelligence, -1);
      }
      if ( CPedGroups::ms_activeGroups[3]
        && CPedGroups::ms_groups[3].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[3].m_intelligence, -1);
      }
      if ( CPedGroups::ms_activeGroups[4]
        && CPedGroups::ms_groups[4].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[4].m_intelligence, -1);
      }
      if ( CPedGroups::ms_activeGroups[5]
        && CPedGroups::ms_groups[5].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[5].m_intelligence, -1);
      }
      if ( CPedGroups::ms_activeGroups[6]
        && CPedGroups::ms_groups[6].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[6].m_intelligence, -1);
      }
      if ( CPedGroups::ms_activeGroups[7]
        && CPedGroups::ms_groups[7].m_intelligence.m_iDecisionMaker == iDecisionMakerIndex )
      {
        CPedGroupIntelligence::SetGroupDecisionMakerType(&CPedGroups::ms_groups[7].m_intelligence, -1);
      }
    }
    else
    {
      v4 = CPools::ms_pPedPool;
      m_nSize = CPools::ms_pPedPool->m_nSize;
      if ( m_nSize )
      {
        v6 = 1996 * m_nSize;
        v7 = m_nSize - 1;
        v8 = v6 - 908;
        do
        {
          if ( (v4->m_aFlags[v7] & 0x80u) == 0 )
          {
            v9 = &(*v4->m_aStorage)[v8];
            if ( v9 != (uint8 *)&elf_hash_bucket[209] )
            {
              v10 = *(_DWORD **)&(*v4->m_aStorage)[v8];
              if ( v10[45] == iDecisionMakerIndex )
              {
                v11 = *(char *)(*((_DWORD *)v9 + 88) + 50);
                if ( iDecisionMakerIndex )
                {
                  v12 = v10 + 45;
                  if ( !(_BYTE)v11 )
                  {
                    v10[46] = iDecisionMakerIndex;
                    v12 = v10 + 45;
                  }
                }
                else
                {
                  v12 = v10 + 46;
                }
                *v12 = v11;
                if ( v10[45] == 7 )
                {
                  v10[49] = 15;
                  v10[50] = 1084227584;
                }
              }
            }
          }
          --v7;
          v8 -= 1996;
        }
        while ( v7 != -1 );
      }
    }
    CDecisionMakerTypes::m_bIsActive[iDecisionMakerIndex] = 0;
    CDecisionMakerTypes::m_types[iDecisionMakerIndex] = 0;
    --this->m_iNoOfDecisionMakers;
  }
}
// FC: using guessed type int elf_hash_bucket[16411];
// 677350: using guessed type char (*CPedGroups::ms_activeGroups)[8];
// 6793D0: using guessed type char (*CDecisionMakerTypes::m_bIsActive)[20];

//----- (004BE304) --------------------------------------------------------
void __fastcall CPedIntelligence::SetPedDecisionMakerType(CPedIntelligence *this, const int iType)
{
  int m_iDecisionMakerType; // r12
  int *p_m_iDecisionMakerType; // r3

  m_iDecisionMakerType = this->m_iDecisionMakerType;
  if ( m_iDecisionMakerType )
  {
    p_m_iDecisionMakerType = &this->m_iDecisionMakerType;
    if ( !iType )
    {
      this->m_iDecisionMakerTypeInGroup = m_iDecisionMakerType;
      p_m_iDecisionMakerType = &this->m_iDecisionMakerType;
    }
  }
  else
  {
    p_m_iDecisionMakerType = &this->m_iDecisionMakerTypeInGroup;
  }
  *p_m_iDecisionMakerType = iType;
  if ( this->m_iDecisionMakerType == 7 )
  {
    this->m_iMaxNumFriendsToInform = 15;
    this->m_fMaxInformFriendDistance = 5.0;
  }
}

//----- (004BE338) --------------------------------------------------------
int __fastcall CDecisionMakerTypes::CopyDecisionMaker(
        CDecisionMakerTypes *this,
        const int index,
        const int iType,
        const Bool8 bDecisionMakerForMission)
{
  int v5; // r4
  CDecisionMaker *v6; // r9
  int v7; // r0
  int v8; // r0
  CDecisionMaker *v9; // r6
  int v10; // r5

  v5 = bDecisionMakerForMission;
  if ( index == -1 )
  {
    if ( iType )
      v7 = 59428;
    else
      v7 = 52048;
    v6 = (CDecisionMaker *)((char *)this + v7);
  }
  else
  {
    v6 = &this->m_decisionMakers[index];
  }
  v8 = 20;
  if ( bDecisionMakerForMission )
    v5 = 15;
  else
    v8 = 15;
  if ( v5 >= (unsigned int)v8 )
    return -1;
  v9 = &this->m_decisionMakers[(__int16)v5];
  while ( CDecisionMakerTypes::m_bIsActive[v5] )
  {
    ++v5;
    ++v9;
    if ( v5 >= v8 )
      return -1;
  }
  v10 = 4;
  CDecisionMakerTypes::m_bIsActive[v5] = 1;
  CDecisionMakerTypes::m_types[v5] = iType;
  do
  {
    CDecision::operator=(v9->m_decisions, (const CDecision *)((char *)v6->m_decisions + v10 - 4));
    v10 += 60;
    v9 = (CDecisionMaker *)((char *)v9 + 60);
  }
  while ( v10 != 2464 );
  ++this->m_iNoOfDecisionMakers;
  return v5;
}
// 6793D0: using guessed type char (*CDecisionMakerTypes::m_bIsActive)[20];

//----- (004BE3E0) --------------------------------------------------------
void __fastcall CDecisionMakerTypes::FlushDecisionMakerEventResponse(
        CDecisionMakerTypes *this,
        const int iDecisionMakerIndex,
        const int iEventType)
{
  char *v3; // r0

  v3 = (char *)this + 2460 * iDecisionMakerIndex + 60 * this->m_eventIndices[iEventType];
  *((_WORD *)v3 + 28) = 0;
  *((_DWORD *)v3 + 9) = 0;
  *((_DWORD *)v3 + 13) = 0;
  *(_QWORD *)(v3 + 4) = -1LL;
  *(_QWORD *)(v3 + 12) = -1LL;
  *(_DWORD *)(v3 + 58) = 0;
  *((_DWORD *)v3 + 10) = 0;
  *((_DWORD *)v3 + 11) = 0;
  *((_DWORD *)v3 + 12) = 0;
  *((_WORD *)v3 + 31) = 0;
  *(_QWORD *)(v3 + 20) = -1LL;
  *(_QWORD *)(v3 + 28) = 0LL;
}

//----- (004BE440) --------------------------------------------------------
void __fastcall CDecisionMakerTypes::AddEventResponse(
        CDecisionMakerTypes *this,
        const int iDecisionMakerIndex,
        const int iEventType,
        const int iTaskType,
        float *pProbs,
        int *pBools)
{
  CDecision::Add(
    &this->m_decisionMakers[iDecisionMakerIndex].m_decisions[this->m_eventIndices[iEventType]],
    iTaskType,
    pProbs,
    pBools);
}

//----- (004BE468) --------------------------------------------------------
void __fastcall CDecisionMakerTypesFileLoader::GetPedDMName(const int index, unsigned __int8 *pName)
{
  sprintf(pName, CDecisionMakerTypesFileLoader::ms_ped_DM_Names[index]);
}

//----- (004BE480) --------------------------------------------------------
void __fastcall CDecisionMakerTypesFileLoader::GetGrpDMName(const int index, unsigned __int8 *pName)
{
  sprintf(pName, CDecisionMakerTypesFileLoader::ms_grp_DM_Names[index]);
}

//----- (004BE498) --------------------------------------------------------
void CDecisionMakerTypesFileLoader::ReStart()
{
  CDecisionMakerTypes *v0; // r0
  CDecisionMakerTypes *v1; // r0
  CDecisionMakerTypes *v2; // r0
  CDecisionMakerTypes *v3; // r0
  CDecisionMakerTypes *v4; // r0
  CDecisionMakerTypes *v5; // r0
  CDecisionMakerTypes *v6; // r0
  CDecisionMakerTypes *v7; // r0
  CDecisionMakerTypes *v8; // r0
  CDecisionMakerTypes *v9; // r0
  CDecisionMakerTypes *v10; // r0
  CDecisionMakerTypes *v11; // r0
  CDecisionMakerTypes *v12; // r0
  CDecisionMakerTypes *v13; // r0
  CDecisionMakerTypes *v14; // r0
  CDecisionMakerTypes *v15; // r0
  CDecisionMakerTypes *v16; // r0
  CDecisionMakerTypes *v17; // r0
  CDecisionMakerTypes *v18; // r0
  CDecisionMakerTypes *v19; // r0

  v0 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v1 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v1);
    CDecisionMakerTypes::m_pPedDecisionTypes = v0;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v0, 10);
  v2 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v3 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v3);
    CDecisionMakerTypes::m_pPedDecisionTypes = v2;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v2, 11);
  v4 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v5 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v5);
    CDecisionMakerTypes::m_pPedDecisionTypes = v4;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v4, 12);
  v6 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v7 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v7);
    CDecisionMakerTypes::m_pPedDecisionTypes = v6;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v6, 13);
  v8 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v9 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v9);
    CDecisionMakerTypes::m_pPedDecisionTypes = v8;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v8, 14);
  v10 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v11 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v11);
    CDecisionMakerTypes::m_pPedDecisionTypes = v10;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v10, 15);
  v12 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v13 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v13);
    CDecisionMakerTypes::m_pPedDecisionTypes = v12;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v12, 16);
  v14 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v15 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v15);
    CDecisionMakerTypes::m_pPedDecisionTypes = v14;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v14, 17);
  v16 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v17 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v17);
    CDecisionMakerTypes::m_pPedDecisionTypes = v16;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v16, 18);
  v18 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v19 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v19);
    CDecisionMakerTypes::m_pPedDecisionTypes = v18;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v18, 19);
}
// 4BE4B8: variable 'v0' is possibly undefined
// 4BE4DC: variable 'v2' is possibly undefined
// 4BE500: variable 'v4' is possibly undefined
// 4BE524: variable 'v6' is possibly undefined
// 4BE548: variable 'v8' is possibly undefined
// 4BE56C: variable 'v10' is possibly undefined
// 4BE590: variable 'v12' is possibly undefined
// 4BE5B4: variable 'v14' is possibly undefined
// 4BE5D8: variable 'v16' is possibly undefined
// 4BE5FC: variable 'v18' is possibly undefined

//----- (004BE658) --------------------------------------------------------
void __fastcall CDecisionMakerTypesFileLoader::UnloadDecisionMaker(const int iDecisionMakerIndex)
{
  CDecisionMakerTypes *v2; // r0
  CDecisionMakerTypes *v3; // r0

  v2 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v3 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v3);
    CDecisionMakerTypes::m_pPedDecisionTypes = v2;
  }
  CDecisionMakerTypes::RemoveDecisionMaker(v2, iDecisionMakerIndex);
}
// 4BE67A: variable 'v2' is possibly undefined

//----- (004BE68C) --------------------------------------------------------
int __fastcall CDecisionMakerTypesFileLoader::LoadDecisionMaker(
        const unsigned __int8 *pFileName,
        const uint8 iType,
        const Bool8 bDecisionMakerForMission,
        int indexToReplace)
{
  int v6; // r4
  CDecisionMakerTypes *v8; // r9
  int v9; // r0
  CDecision *m_decisions; // r5
  int v11; // r6
  CDecisionMaker v13; // [sp+4h] [bp-9B4h] BYREF

  v6 = bDecisionMakerForMission;
  CDecisionMaker::CDecisionMaker(&v13);
  CDecisionMakerTypesFileLoader::LoadDecisionMaker(pFileName, &v13);
  v8 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v8 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v8);
    CDecisionMakerTypes::m_pPedDecisionTypes = v8;
  }
  v9 = 20;
  if ( v6 )
    v6 = 15;
  else
    v9 = 15;
  if ( v6 >= (unsigned int)v9 )
    return -1;
  m_decisions = v8->m_decisionMakers[(__int16)v6].m_decisions;
  while ( (indexToReplace <= 0 || indexToReplace != v6) && (CDecisionMakerTypes::m_bIsActive[v6] | ~indexToReplace) != 0 )
  {
    ++v6;
    m_decisions += 41;
    if ( v6 >= v9 )
      return -1;
  }
  v11 = 4;
  CDecisionMakerTypes::m_bIsActive[v6] = 1;
  CDecisionMakerTypes::m_types[v6] = iType;
  do
  {
    CDecision::operator=(m_decisions, (const CDecision *)((char *)v13.m_decisions + v11 - 4));
    v11 += 60;
    ++m_decisions;
  }
  while ( v11 != 2464 );
  ++v8->m_iNoOfDecisionMakers;
  return v6;
}
// 6793D0: using guessed type char (*CDecisionMakerTypes::m_bIsActive)[20];

//----- (004BE790) --------------------------------------------------------
bool __fastcall CDecisionMakerTypesFileLoader::LoadDecisionMaker(
        const unsigned __int8 *pFileName,
        CDecisionMaker *decisionMaker)
{
  u_native v3; // r5
  unsigned __int8 *v4; // r1
  unsigned __int8 *v5; // r4
  int v6; // r0
  int *v7; // r2
  float *v8; // r1
  float v9; // s0
  float v10; // s2
  float v11; // s4
  float v12; // s6
  unsigned int v13; // s10
  char *v14; // r3
  float v15; // s8
  char *v16; // r6
  int v17; // r3
  CDecisionMakerTypes *v18; // r0
  CDecisionMakerTypes *v19; // r0
  unsigned int v20; // r0
  char *v21; // r0
  _BOOL4 Line; // r0
  __int64 v25; // [sp+270h] [bp-3B8h] BYREF
  __int64 v26; // [sp+278h] [bp-3B0h]
  __int64 v27; // [sp+280h] [bp-3A8h]
  __int64 v28; // [sp+288h] [bp-3A0h]
  __int64 v29; // [sp+290h] [bp-398h]
  int v30; // [sp+298h] [bp-390h]
  int v31; // [sp+29Ch] [bp-38Ch]
  int v32; // [sp+2A0h] [bp-388h]
  __int16 v33; // [sp+2A4h] [bp-384h]
  int v34; // [sp+2A6h] [bp-382h]
  __int16 v35; // [sp+2AAh] [bp-37Eh]
  char v36; // [sp+2B0h] [bp-378h] BYREF
  char v37; // [sp+2B4h] [bp-374h] BYREF
  char v38; // [sp+2B8h] [bp-370h] BYREF
  char v39; // [sp+2BCh] [bp-36Ch] BYREF
  char v40; // [sp+2C0h] [bp-368h] BYREF
  char v41; // [sp+2C4h] [bp-364h] BYREF
  char v42; // [sp+2C8h] [bp-360h] BYREF
  char v43; // [sp+2CCh] [bp-35Ch] BYREF
  char v44; // [sp+2D0h] [bp-358h] BYREF
  char v45; // [sp+2D4h] [bp-354h] BYREF
  char v46; // [sp+2D8h] [bp-350h] BYREF
  char v47; // [sp+2DCh] [bp-34Ch] BYREF
  char v48; // [sp+2E0h] [bp-348h] BYREF
  char v49; // [sp+2E4h] [bp-344h] BYREF
  char v50; // [sp+2E8h] [bp-340h] BYREF
  char v51; // [sp+2ECh] [bp-33Ch] BYREF
  char v52; // [sp+2F0h] [bp-338h] BYREF
  char v53; // [sp+2F4h] [bp-334h] BYREF
  char v54; // [sp+2F8h] [bp-330h] BYREF
  char v55; // [sp+2FCh] [bp-32Ch] BYREF
  char v56; // [sp+300h] [bp-328h] BYREF
  char v57; // [sp+304h] [bp-324h] BYREF
  char v58; // [sp+308h] [bp-320h] BYREF
  char v59; // [sp+30Ch] [bp-31Ch] BYREF
  char v60; // [sp+310h] [bp-318h] BYREF
  char v61; // [sp+314h] [bp-314h] BYREF
  char v62; // [sp+318h] [bp-310h] BYREF
  char v63; // [sp+31Ch] [bp-30Ch] BYREF
  char v64; // [sp+320h] [bp-308h] BYREF
  char v65; // [sp+324h] [bp-304h] BYREF
  char v66; // [sp+328h] [bp-300h] BYREF
  char v67; // [sp+32Ch] [bp-2FCh] BYREF
  char v68; // [sp+330h] [bp-2F8h] BYREF
  char v69; // [sp+334h] [bp-2F4h] BYREF
  char v70; // [sp+338h] [bp-2F0h] BYREF
  char v71; // [sp+33Ch] [bp-2ECh] BYREF
  char v72; // [sp+340h] [bp-2E8h] BYREF
  _BYTE v73[52]; // [sp+344h] [bp-2E4h] BYREF
  _BYTE v74[88]; // [sp+378h] [bp-2B0h] BYREF
  __int64 v75; // [sp+3D0h] [bp-258h] BYREF
  __int64 v76; // [sp+3D8h] [bp-250h] BYREF
  __int64 v77; // [sp+3E0h] [bp-248h] BYREF
  char v78; // [sp+3ECh] [bp-23Ch] BYREF
  int v79; // [sp+3F0h] [bp-238h] BYREF
  unsigned __int8 pLine[512]; // [sp+3F4h] [bp-234h] BYREF

  CFileMgr::SetDir("data\\decision\\allowed\\");
  v3 = CFileMgr::OpenFile(pFileName, "r");
  CFileMgr::SetDir((const unsigned __int8 *)&byte_61CADE);
  if ( !v3 )
    return 0;
  CFileMgr::ReadLine(v3, pLine, 512);
  if ( CFileMgr::ReadLine(v3, pLine, 512) )
  {
    v4 = pLine;
    do
    {
      v5 = v4;
      sscanf(
        (const char *)v4,
        "%d, %d, %d, %f, %f, %f, %f, %d, %d, %f, %f, %f, %f, %f, %f, %d, %f, %f, %f, %f, %d, %d, %f, %f, %f, %f, %f, %f, "
        "%d, %f, %f, %f, %f, %d, %d, %f, %f, %f, %f, %f, %f, %d, %f, %f, %f, %f, %d, %d, %f, %f, %f, %f, %f, %f, %d, %f, "
        "%f, %f, %f, %d, %d, %f, %f, %f, %f, %f, %f, %d, %f, %f, %f, %f, %d, %d, %f, %f, %f, %f, %f, %f \n",
        &v79,
        &v78,
        &v75,
        v74,
        &v74[4],
        &v73[48],
        &v73[44],
        v73,
        &v72,
        &v36,
        &v37,
        &v38,
        &v39,
        &v40,
        &v41,
        (char *)&v75 + 4,
        &v74[16],
        &v74[20],
        &v74[12],
        &v74[8],
        &v73[8],
        &v73[4],
        &v42,
        &v43,
        &v44,
        &v45,
        &v46,
        &v47,
        &v76,
        &v74[32],
        &v74[36],
        &v74[28],
        &v74[24],
        &v73[16],
        &v73[12],
        &v48,
        &v49,
        &v50,
        &v51,
        &v52,
        &v53,
        (char *)&v76 + 4,
        &v74[48],
        &v74[52],
        &v74[44],
        &v74[40],
        &v73[24],
        &v73[20],
        &v54,
        &v55,
        &v56,
        &v57,
        &v58,
        &v59,
        &v77,
        &v74[64],
        &v74[68],
        &v74[60],
        &v74[56],
        &v73[32],
        &v73[28],
        &v60,
        &v61,
        &v62,
        &v63,
        &v64,
        &v65,
        (char *)&v77 + 4,
        &v74[80],
        &v74[84],
        &v74[76],
        &v74[72],
        &v73[40],
        &v73[36],
        &v66,
        &v67,
        &v68,
        &v69,
        &v70,
        &v71);
      v6 = 0;
      v33 = 0;
      v7 = (int *)v73;
      v32 = 0;
      v28 = 0LL;
      v29 = 0LL;
      v25 = v75;
      v26 = v76;
      v27 = v77;
      v8 = (float *)v74;
      v30 = 0;
      v34 = 0;
      v31 = 0;
      v35 = 0;
      do
      {
        v9 = *(v8 - 2);
        v10 = *(v8 - 1);
        v11 = *v8;
        v12 = v8[1];
        v13 = (unsigned int)*v8;
        v8 += 4;
        v14 = (char *)&v25 + 2 * v6;
        v15 = (float)(((unsigned int)v9 + (unsigned int)v10 + v13 + (unsigned int)v12) / 0xFF + 1);
        v14[25] = (unsigned int)(float)(v10 / v15);
        v14[24] = (unsigned int)(float)(v9 / v15);
        v14[26] = (unsigned int)(float)(v11 / v15);
        v14[27] = (unsigned int)(float)(v12 / v15);
        v16 = (char *)&v25 + v6;
        v6 += 2;
        v16[48] = *(v7 - 1) != 0;
        v17 = *v7;
        v7 += 2;
        v16[49] = v17 != 0;
      }
      while ( v6 != 12 );
      v18 = CDecisionMakerTypes::m_pPedDecisionTypes;
      if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
      {
        v19 = (CDecisionMakerTypes *)operator new(0xF1C0u);
        CDecisionMakerTypes::CDecisionMakerTypes(v19);
        CDecisionMakerTypes::m_pPedDecisionTypes = v18;
      }
      v20 = 15 * v18->m_eventIndices[v79];
      decisionMaker->m_decisions[v20 / 0xF].m_tasks[0] = v25;
      v21 = (char *)decisionMaker + 4 * v20;
      *((_DWORD *)v21 + 6) = v28;
      *((_WORD *)v21 + 24) = v32;
      *((_DWORD *)v21 + 1) = HIDWORD(v25);
      *((_DWORD *)v21 + 7) = HIDWORD(v28);
      *((_WORD *)v21 + 25) = HIWORD(v32);
      *((_DWORD *)v21 + 2) = v26;
      *((_DWORD *)v21 + 8) = v29;
      *((_WORD *)v21 + 26) = v33;
      *((_DWORD *)v21 + 3) = HIDWORD(v26);
      *((_DWORD *)v21 + 9) = HIDWORD(v29);
      *((_WORD *)v21 + 27) = v34;
      *((_DWORD *)v21 + 4) = v27;
      *((_DWORD *)v21 + 10) = v30;
      *((_WORD *)v21 + 28) = HIWORD(v34);
      *((_DWORD *)v21 + 5) = HIDWORD(v27);
      *((_DWORD *)v21 + 11) = v31;
      *((_WORD *)v21 + 29) = v35;
      Line = CFileMgr::ReadLine(v3, v5, 512);
      v4 = v5;
    }
    while ( Line );
  }
  CFileMgr::CloseFile(v3);
  return 1;
}
// 4BEC14: variable 'v18' is possibly undefined
// 61CADE: using guessed type char byte_61CADE;

//----- (004BEDD0) --------------------------------------------------------
void __fastcall CMentalState::Process(CMentalState *this, const CPed *ped)
{
  CVehicle *m_pMyVehicle; // r2
  unsigned int m_nHealth; // r0
  int m_nPedFlags; // r1
  bool v7; // zf
  unsigned int m_iLastHealth; // r1
  unsigned int m_iLastCarHealth; // r0
  unsigned int m_iCarHealth; // r0
  void **v11; // r0
  unsigned int m_iLastAngerAtPlayer; // r0
  unsigned int m_iAngerAtPlayer; // r0
  void **v14; // r0
  uint16 v15; // r1
  uint8 v16; // r2
  CEventEditableResponse v17[2]; // [sp+0h] [bp-20h] BYREF

  m_nHealth = (unsigned int)ped->m_nHealth;
  this->m_iHealth = m_nHealth;
  m_nPedFlags = (int)ped->m_nPedFlags;
  v7 = (m_nPedFlags & 0x100) == 0;
  if ( (m_nPedFlags & 0x100) != 0 )
  {
    m_pMyVehicle = ped->m_pMyVehicle;
    v7 = m_pMyVehicle == 0;
  }
  if ( v7 )
  {
    if ( (m_nPedFlags & 0x100) != 0 )
    {
LABEL_10:
      m_iLastCarHealth = this->m_iLastCarHealth;
      if ( m_iLastCarHealth >= 0x258 )
      {
        m_iCarHealth = this->m_iCarHealth;
        if ( m_iCarHealth >> 2 <= 0x4A )
          goto LABEL_18;
        if ( m_iCarHealth >> 3 > 0x4A )
          goto LABEL_24;
        goto LABEL_22;
      }
      if ( m_iLastCarHealth >= 0x12C && this->m_iCarHealth >> 2 <= 0x4Au )
        goto LABEL_18;
      goto LABEL_24;
    }
  }
  else
  {
    this->m_iCarHealth = (unsigned int)m_pMyVehicle->m_nHealth;
    if ( (*(_DWORD *)&ped->m_nPedFlags & 0x100) != 0 )
      goto LABEL_10;
  }
  m_iLastHealth = this->m_iLastHealth;
  if ( m_iLastHealth >= 0x32 )
  {
    if ( m_nHealth <= 9 )
    {
LABEL_18:
      CEventEditableResponse::CEventEditableResponse(v17);
      v11 = &`vtable for'CEventHealthReallyLow;
LABEL_23:
      v17[0]._vptr$CEvent = (int (**)(void))((char *)*v11 + 8);
      CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)v17, 0);
      CEvent::~CEvent((CEvent *)v17);
      goto LABEL_24;
    }
    if ( m_nHealth > 0x31 )
      goto LABEL_24;
LABEL_22:
    CEventEditableResponse::CEventEditableResponse(v17);
    v11 = &`vtable for'CEventHealthLow;
    goto LABEL_23;
  }
  if ( m_iLastHealth >= 0xA && m_nHealth <= 9 )
    goto LABEL_18;
LABEL_24:
  m_iLastAngerAtPlayer = this->m_iLastAngerAtPlayer;
  if ( m_iLastAngerAtPlayer > 3 )
  {
    if ( m_iLastAngerAtPlayer <= 6 && this->m_iAngerAtPlayer >= 7u )
      goto LABEL_26;
  }
  else
  {
    m_iAngerAtPlayer = this->m_iAngerAtPlayer;
    if ( m_iAngerAtPlayer >= 7 )
    {
LABEL_26:
      CEventEditableResponse::CEventEditableResponse(v17);
      v14 = &`vtable for'CEventHighAngerAtPlayer;
LABEL_32:
      v17[0]._vptr$CEvent = (int (**)(void))((char *)*v14 + 8);
      CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)v17, 0);
      CEvent::~CEvent((CEvent *)v17);
      goto LABEL_33;
    }
    if ( m_iAngerAtPlayer >= 4 )
    {
      CEventEditableResponse::CEventEditableResponse(v17);
      v14 = &`vtable for'CEventLowAngerAtPlayer;
      goto LABEL_32;
    }
  }
LABEL_33:
  v15 = this->m_iCarHealth;
  v16 = this->m_iAngerAtPlayer;
  this->m_iLastHealth = this->m_iHealth;
  this->m_iLastCarHealth = v15;
  this->m_iLastAngerAtPlayer = v16;
}
// 4BEE1E: variable 'm_pMyVehicle' is possibly undefined
// 67703C: using guessed type void *`vtable for'CEventLowAngerAtPlayer;
// 6775FC: using guessed type void *`vtable for'CEventHealthReallyLow;
// 677E4C: using guessed type void *`vtable for'CEventHighAngerAtPlayer;
// 679DC0: using guessed type void *`vtable for'CEventHealthLow;

//----- (004BEF5C) --------------------------------------------------------
void __fastcall CCollisionEventScanner::ScanForCollisionEvents(
        CCollisionEventScanner *this,
        CPed *ped,
        CEventGroup *pEventGroup)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  float32x2_t v6; // d8
  CTask *SimplestActiveTask; // r0
  CTask *v11; // r6
  int iPedMoveState; // r11
  CEntity *m_pDamageEntity; // r10
  CTask *v14; // r0
  CTask *v15; // r6
  int v16; // r4
  float32x2_t v17; // d1
  int v18; // r0
  float v19; // s4
  bool v20; // zf
  float v21; // r0
  float v22; // s16
  bool v23; // nf
  CMatrix *m_pMat; // r0
  float m_heading; // s18
  CPedIntelligence *m_pPedIntelligence; // r0
  unsigned int v27; // r1
  unsigned int m_iStartTime; // r2
  CEntity *m_pAttachToEntity; // r0
  uint8 v30; // r4
  const CEventDamage *v31; // r0
  float m_fDamageImpulseMagnitude; // s16
  uint16 m_nDamagedPieceType; // r11
  CTask *v34; // r0
  CTask *v35; // r6
  int v36; // r0
  float v37; // s0
  float v38; // s4
  int32 LocalDirection; // r0
  CEntity *v40; // r0
  uint8 v41; // r4
  float v42; // r2
  uint8 m_iAngerAtPlayer; // r1
  uint32 Acquaintances; // r6
  float v45; // r0
  RwReal v46; // r0
  unsigned int v47; // r1
  unsigned int v48; // r2
  CColModel *ColModel; // r0
  float x; // s20
  float y; // s22
  float z; // s24
  CColModel *v53; // r0
  float v54; // s26
  float v55; // s28
  float v56; // s0
  CSimpleTransform *p_m_transform; // r4
  CSimpleTransform *p_tx; // r1
  CMatrix *v59; // r0
  float v60; // s2
  float v61; // s4
  float v62; // r0
  float v63; // r9
  float v64; // r6
  CMatrix *v65; // r0
  CMatrix *v66; // r1
  float *p_x; // r2
  float v68; // s0
  ePedPieceTypes v69; // s4
  float v70; // s0
  float *p_xx; // r0
  float v72; // s0
  float v73; // s0
  char v74; // r1
  uint32 v75; // r4
  CPlayerPedData *m_pPlayerData; // r0
  int v77; // r1
  bool v78; // zf
  CEntity *v79; // r0
  float v80; // s0
  uint32 v81; // r0
  uint32 v82; // s16
  uint32 *v83; // r1
  int v84; // r0
  CEntity **v85; // r4
  CMatrix *v86; // r0
  CSimpleTransform *v87; // r2
  __int64 v88; // d16
  CEventGlobalGroup *EventGlobalGroup; // r0
  CVehicle *pVehicle; // [sp+14h] [bp-C4h]
  CVector vNormal; // [sp+18h] [bp-C0h] BYREF
  CEventDamage v92; // [sp+28h] [bp-B0h] BYREF
  CPedDamageResponseCalculator v93; // [sp+68h] [bp-70h] BYREF

  if ( !ped->m_pDamageEntity )
    goto LABEL_130;
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
  v11 = SimplestActiveTask;
  if ( SimplestActiveTask )
  {
    if ( CTask::IsGoToTask(SimplestActiveTask) )
      iPedMoveState = (int)v11[1]._vptr$CTask;
    else
      iPedMoveState = 1;
  }
  else
  {
    iPedMoveState = 1;
  }
  m_pDamageEntity = ped->m_pDamageEntity;
  switch ( *(_BYTE *)&m_pDamageEntity->m_info & 7 )
  {
    case 1:
      CEventBuildingCollision::CEventBuildingCollision(
        (CEventBuildingCollision *)&v92,
        ped->m_nDamagedPieceType,
        ped->m_fDamageImpulseMagnitude,
        (const CBuilding *)m_pDamageEntity,
        &ped->m_vecDamageNormal,
        &ped->m_vecDamagePos,
        iPedMoveState);
      CEventGroup::Add(pEventGroup, (CEvent *)&v92, 0);
      CEventBuildingCollision::~CEventBuildingCollision((CEventBuildingCollision *)&v92);
      goto LABEL_107;
    case 2:
      if ( this->m_bAlreadyHitByCar )
        goto LABEL_107;
      v22 = (float)((float)(m_pDamageEntity[1].m_transform.m_translate.z * m_pDamageEntity[1].m_transform.m_translate.z)
                  + (float)(m_pDamageEntity[1].m_transform.m_heading * m_pDamageEntity[1].m_transform.m_heading))
          + (float)(*(float *)&m_pDamageEntity[1].m_pMat * *(float *)&m_pDamageEntity[1].m_pMat);
      if ( LODWORD(m_pDamageEntity[24].m_transform.m_translate.x) == 6 )
      {
        v23 = (LOBYTE(m_pDamageEntity[1].m_transform.m_translate.y) & 4) != 0;
        if ( (LOBYTE(m_pDamageEntity[1].m_transform.m_translate.y) & 4) != 0 )
          v23 = (*(_BYTE *)&ped->m_nFlags & 0x10) != 0;
        if ( v23 && *(_BYTE *)&ped->m_nPedFlags << 31 && v22 > 0.0001 && !ped->m_pGroundPhysical )
          CPed::KillPedWithCar(ped, (CVehicle *)ped->m_pDamageEntity, 15.0, 0);
      }
      if ( v22 <= 0.0025 )
      {
        m_pAttachToEntity = ped->m_pAttachToEntity;
        if ( !m_pAttachToEntity || (*(_BYTE *)&m_pAttachToEntity->m_info & 7) != 2 )
        {
          if ( !CPed::IsPlayer(ped) )
          {
            pVehicle = (CVehicle *)ped->m_pDamageEntity;
            m_fDamageImpulseMagnitude = ped->m_fDamageImpulseMagnitude;
            m_nDamagedPieceType = ped->m_nDamagedPieceType;
            v34 = CTaskManager::GetSimplestActiveTask(&ped->m_pPedIntelligence->m_taskManager);
            v35 = v34;
            if ( v34 && CTask::IsGoToTask(v34) )
              v36 = (int)v35[1]._vptr$CTask;
            else
              v36 = 1;
            CEventVehicleCollision::CEventVehicleCollision(
              (CEventVehicleCollision *)&v92,
              m_nDamagedPieceType,
              m_fDamageImpulseMagnitude,
              pVehicle,
              &ped->m_vecDamageNormal,
              &ped->m_vecDamagePos,
              v36,
              0);
            CEventGroup::Add(pEventGroup, (CEvent *)&v92, 0);
            CEventVehicleCollision::~CEventVehicleCollision((CEventVehicleCollision *)&v92);
          }
          goto LABEL_107;
        }
        v30 = CPedGeometryAnalyser::ComputePedHitSide(ped, (const CPhysical *)m_pDamageEntity);
        CPedDamageResponseCalculator::CPedDamageResponseCalculator(
          &v93,
          m_pDamageEntity,
          ped->m_fDamageImpulseMagnitude,
          WEAPONTYPE_RAMMEDBYCAR,
          PED_SPHERE_CHEST,
          0);
        CEventDamage::CEventDamage(
          &v92,
          m_pDamageEntity,
          CTimer::m_snTimeInMilliseconds,
          WEAPONTYPE_RAMMEDBYCAR,
          PED_SPHERE_CHEST,
          v30,
          0,
          *(_DWORD *)&ped->m_nPedFlags & 0x100);
LABEL_65:
        if ( CEventDamage::AffectsPed(v31, ped) )
          CPedDamageResponseCalculator::ComputeDamageResponse(&v93, ped, &v92.m_pedDamageResponse, 1);
        CEventDamage::~CEventDamage(&v92);
        CPedDamageResponseCalculator::~CPedDamageResponseCalculator(&v93);
        goto LABEL_107;
      }
      v6.n64_u32[0] = LODWORD(ped->m_fDamageImpulseMagnitude);
      if ( *(_BYTE *)&ped->m_nPedFlags << 31 )
      {
        v3.n64_f32[0] = (float)(ped->m_vecDamageNormal.x * ped->m_vecCurrentVelocity.x)
                      + (float)(ped->m_vecDamageNormal.y * ped->m_vecCurrentVelocity.y);
        if ( v3.n64_f32[0] < 0.0 )
        {
          v4.n64_u32[0] = 0;
          v3.n64_f32[0] = v6.n64_f32[0] + (float)(v3.n64_f32[0] * ped->m_fMass);
          v6.n64_u64[0] = vmax_f32(v3, v4).n64_u64[0];
        }
      }
      if ( !CPed::IsPlayer(ped) )
      {
        v40 = ped->m_pAttachToEntity;
        if ( !v40 || (*(_BYTE *)&v40->m_info & 7) != 2 )
        {
          v42 = ped->m_fDamageImpulseMagnitude;
LABEL_106:
          CPed::KillPedWithCar(ped, (CVehicle *)m_pDamageEntity, v42, 0);
          goto LABEL_107;
        }
        v41 = CPedGeometryAnalyser::ComputePedHitSide(ped, (const CPhysical *)m_pDamageEntity);
        CPedDamageResponseCalculator::CPedDamageResponseCalculator(
          &v93,
          m_pDamageEntity,
          ped->m_fDamageImpulseMagnitude,
          WEAPONTYPE_RAMMEDBYCAR,
          PED_SPHERE_CHEST,
          0);
        CEventDamage::CEventDamage(
          &v92,
          m_pDamageEntity,
          CTimer::m_snTimeInMilliseconds,
          WEAPONTYPE_RAMMEDBYCAR,
          PED_SPHERE_CHEST,
          v41,
          0,
          *(_DWORD *)&ped->m_nPedFlags & 0x100);
        goto LABEL_65;
      }
      m_pMat = m_pDamageEntity->m_pMat;
      if ( m_pMat )
        m_heading = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
      else
        m_heading = m_pDamageEntity->m_transform.m_heading;
      ColModel = CEntity::GetColModel(m_pDamageEntity);
      x = ColModel->m_boxBound.m_vecMin.x;
      y = ColModel->m_boxBound.m_vecMin.y;
      z = ColModel->m_boxBound.m_vecMin.z;
      v53 = CEntity::GetColModel(m_pDamageEntity);
      v54 = v53->m_boxBound.m_vecMax.x;
      v55 = v53->m_boxBound.m_vecMax.y;
      v56 = z + v53->m_boxBound.m_vecMax.z;
      *(float *)&v92.m_iAccumulatedTime = (float)(y + v55) * 0.5;
      *(float *)&v92._vptr$CEvent = (float)(x + v54) * 0.5;
      *(float *)&v92.m_bIsPersistent = v56 * 0.5;
      operator*((CVector *)&v93, m_pDamageEntity->m_pMat, (const CVector *)&v92);
      p_m_transform = &ped->m_transform;
      *(_DWORD *)&v92.m_bIsPersistent = v93.m_eHitZone;
      p_tx = &ped->m_transform;
      *(_QWORD *)&v92._vptr$CEvent = *(_QWORD *)&v93.m_pInflictor;
      v59 = ped->m_pMat;
      if ( v59 )
        p_tx = (CSimpleTransform *)&v59->tx;
      v60 = v93.m_fRawDamage - p_tx->m_translate.y;
      v61 = *(float *)&v93.m_eHitZone - p_tx->m_translate.z;
      *(float *)&v92._vptr$CEvent = *(float *)&v93.m_pInflictor - p_tx->m_translate.x;
      *(float *)&v92.m_iAccumulatedTime = v60;
      *(float *)&v92.m_bIsPersistent = v61;
      v62 = atan2f(COERCE_FLOAT((int)v92._vptr$CEvent ^ 0x80000000), v60);
      v63 = CGeneral::LimitRadianAngle(m_heading - v62);
      v64 = atan2f(v54 - x, v55 - y);
      v65 = m_pDamageEntity->m_pMat;
      v66 = ped->m_pMat;
      p_x = &v65->tx;
      if ( !v65 )
        p_x = &m_pDamageEntity->m_transform.m_translate.x;
      if ( v66 )
        p_m_transform = (CSimpleTransform *)&v66->tx;
      v68 = p_m_transform->m_translate.x - *p_x;
      *(float *)&v69 = p_m_transform->m_translate.z - p_x[2];
      v93.m_fRawDamage = p_m_transform->m_translate.y - p_x[1];
      *(float *)&v93.m_pInflictor = v68;
      v93.m_eHitZone = v69;
      CVector::Normalise((CVector *)&v93);
      v70 = fabsf(v63);
      if ( v70 < v64 || v70 > (float)(3.1416 - v64) )
      {
        v73 = (float)((float)(*(float *)&v93.m_pInflictor * m_pDamageEntity[1].m_transform.m_translate.z)
                    + (float)(v93.m_fRawDamage * m_pDamageEntity[1].m_transform.m_heading))
            + (float)(*(float *)&v93.m_eHitZone * *(float *)&m_pDamageEntity[1].m_pMat);
      }
      else
      {
        p_xx = &m_pDamageEntity->m_pMat->xx;
        v72 = *p_xx;
        if ( v63 <= 0.0 )
          v73 = (float)((float)(v72 * m_pDamageEntity[1].m_transform.m_translate.z)
                      + (float)(p_xx[1] * m_pDamageEntity[1].m_transform.m_heading))
              + (float)(p_xx[2] * *(float *)&m_pDamageEntity[1].m_pMat);
        else
          v73 = (float)((float)-(float)(p_xx[1] * m_pDamageEntity[1].m_transform.m_heading)
                      - (float)(v72 * m_pDamageEntity[1].m_transform.m_translate.z))
              - (float)(p_xx[2] * *(float *)&m_pDamageEntity[1].m_pMat);
      }
      if ( v73 > 0.1 )
      {
        v3.n64_u32[0] = 20.0;
        LODWORD(v42) = vmin_f32(v6, v3).n64_u32[0];
        goto LABEL_106;
      }
LABEL_107:
      m_pPlayerData = ped->m_pPlayerData;
      if ( m_pPlayerData )
      {
        v77 = *(_BYTE *)&ped->m_pDamageEntity->m_info & 7;
        v78 = v77 == 4;
        if ( v77 != 4 )
          v78 = v77 == 1;
        if ( v78 && CPedClothesDesc::GetIsWearingBalaclava(m_pPlayerData->m_pClothes) )
        {
          v79 = ped->m_pDamageEntity;
          if ( (unsigned __int8)((*(_BYTE *)&v79->m_info & 7) - 2) <= 2u
            && (LOBYTE(v79[1].m_transform.m_translate.y) & 0x20) != 0 )
          {
            if ( fabsf(*(float *)&v79[1].m_nFlags.bdummy) <= 0.04 )
              goto LABEL_130;
            v81 = CTimer::m_snTimeInMilliseconds;
            if ( CTimer::m_snTimeInMilliseconds <= CCollisionEventScanner::ScanForCollisionEvents(CPed &,CEventGroup *)::nLastDoorSoundEvent
                                                 + 2000 )
              goto LABEL_130;
            v82 = 1109393408;
            v83 = &CCollisionEventScanner::ScanForCollisionEvents(CPed &,CEventGroup *)::nLastDoorSoundEvent;
          }
          else
          {
            v80 = ped->m_fDamageImpulseMagnitude;
            if ( v80 <= 1.0 )
              goto LABEL_130;
            v81 = CTimer::m_snTimeInMilliseconds;
            if ( CTimer::m_snTimeInMilliseconds <= CCollisionEventScanner::ScanForCollisionEvents(CPed &,CEventGroup *)::nLastBumpSoundEvent
                                                 + 1000 )
              goto LABEL_130;
            v82 = 30.0;
            v83 = &CCollisionEventScanner::ScanForCollisionEvents(CPed &,CEventGroup *)::nLastBumpSoundEvent;
            if ( v80 > 3.0 )
              v82 = 1109393408;
          }
          *v83 = v81;
          CEventEditableResponse::CEventEditableResponse(&v92);
          v85 = (CEntity **)(v84 + 16);
          v92.m_pInflictor = ped;
          v92.m_nDamageTime = v82;
          v92.m_eWeaponUsed = -1;
          memset(&v92.m_eHitZone, 0, 12);
          v92._vptr$CEvent = (int (**)(void))&off_66714C;
          CEntity::RegisterReference(ped, (CEntity **)(v84 + 16));
          if ( v92.m_eWeaponUsed == -1 )
          {
            v92.m_eWeaponUsed = CTimer::m_snTimeInMilliseconds;
            v86 = v92.m_pInflictor->m_pMat;
            v87 = (CSimpleTransform *)&v86->tx;
            if ( !v86 )
              v87 = &v92.m_pInflictor->m_transform;
            v88 = *(_QWORD *)&v87->m_translate.x;
            v92.m_nAnimGroup = LODWORD(v87->m_translate.z);
            *(_QWORD *)&v92.m_eHitZone = v88;
          }
          EventGlobalGroup = GetEventGlobalGroup();
          CEventGroup::Add(EventGlobalGroup, (CEvent *)&v92, 0);
          v92._vptr$CEvent = (int (**)(void))&off_66714C;
          if ( v92.m_pInflictor )
            CEntity::CleanUpOldReference(v92.m_pInflictor, v85);
          CEvent::~CEvent((CEvent *)&v92);
        }
      }
LABEL_130:
      this->m_bAlreadyHitByCar = 0;
      return;
    case 3:
      v14 = CTaskManager::GetSimplestActiveTask((const CTaskManager *)(LODWORD(m_pDamageEntity[18].m_transform.m_translate.y)
                                                                     + 4));
      v15 = v14;
      if ( v14 )
      {
        if ( CTask::IsGoToTask(v14) )
          v16 = (int)v15[1]._vptr$CTask;
        else
          v16 = 1;
      }
      else
      {
        v16 = 1;
      }
      if ( CPed::IsPlayer(ped) )
      {
        CEventPedCollisionWithPed::CEventPedCollisionWithPed(
          (CEventPedCollisionWithPed *)&v92,
          ped->m_nDamagedPieceType,
          ped->m_fDamageImpulseMagnitude,
          (const CPed *)ped->m_pDamageEntity,
          &ped->m_vecDamageNormal,
          &ped->m_vecDamagePos,
          iPedMoveState,
          v16);
        v92._vptr$CEvent = (int (**)(void))&off_6691C8;
        CEventGroup::Add(pEventGroup, (CEvent *)&v92, 0);
        CPed::Say((CPed *)m_pDamageEntity, 0x1Cu, 0, 1.0, 0, 0, 0);
      }
      else
      {
        if ( !CPed::IsPlayer((const CPed *)m_pDamageEntity) )
        {
          CEventPedCollisionWithPed::CEventPedCollisionWithPed(
            (CEventPedCollisionWithPed *)&v92,
            ped->m_nDamagedPieceType,
            ped->m_fDamageImpulseMagnitude,
            (const CPed *)ped->m_pDamageEntity,
            &ped->m_vecDamageNormal,
            &ped->m_vecDamagePos,
            iPedMoveState,
            v16);
          CEventGroup::Add(pEventGroup, (CEvent *)&v92, 0);
          CEventPedCollisionWithPed::~CEventPedCollisionWithPed((CEventPedCollisionWithPed *)&v92);
          goto LABEL_75;
        }
        CEventPedCollisionWithPed::CEventPedCollisionWithPed(
          (CEventPedCollisionWithPed *)&v92,
          ped->m_nDamagedPieceType,
          ped->m_fDamageImpulseMagnitude,
          (const CPed *)ped->m_pDamageEntity,
          &ped->m_vecDamageNormal,
          &ped->m_vecDamagePos,
          iPedMoveState,
          v16);
        v92._vptr$CEvent = (int (**)(void))&off_669214;
        CEventGroup::Add(pEventGroup, (CEvent *)&v92, 0);
        m_pPedIntelligence = ped->m_pPedIntelligence;
        if ( m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsActive )
        {
          if ( m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsStopped )
          {
            v27 = CTimer::m_snTimeInMilliseconds;
            m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsStopped = 0;
            m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime = v27;
            m_iStartTime = v27;
          }
          else
          {
            m_iStartTime = m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime;
            v27 = CTimer::m_snTimeInMilliseconds;
          }
          if ( m_iStartTime + m_pPedIntelligence->m_mentalState.m_angerTimer.m_iDuration <= v27 )
          {
            m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime = v27;
            m_pPedIntelligence->m_mentalState.m_angerTimer.m_iDuration = 3000;
            m_iAngerAtPlayer = m_pPedIntelligence->m_mentalState.m_iAngerAtPlayer;
            m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsActive = 1;
            m_pPedIntelligence->m_mentalState.m_iAngerAtPlayer = m_iAngerAtPlayer + 1;
          }
        }
        CPed::Say(ped, 0x1Cu, 0, 1.0, 0, 0, 0);
        Acquaintances = CAcquaintance::GetAcquaintances(&ped->m_acquaintances, 4);
        if ( (CPedType::GetPedFlag(*(_DWORD *)&m_pDamageEntity[23].numLodChildren) & Acquaintances) != 0 )
        {
          CEventAcquaintancePed::CEventAcquaintancePed((CEventAcquaintancePed *)&v93, (CPed *)m_pDamageEntity);
          v93.m_pInflictor = (const CEntity *)&off_665394;
          CEventGroup::Add(pEventGroup, (CEvent *)&v93, 0);
          CEventAcquaintancePed::~CEventAcquaintancePed((CEventAcquaintancePed *)&v93);
        }
      }
      CEventPedCollisionWithPed::~CEventPedCollisionWithPed((CEventPedCollisionWithPed *)&v92);
LABEL_75:
      if ( !m_pDamageEntity[3].m_pLastRenderedLink )
      {
        v45 = ped->m_vecDamageNormal.z;
        *(_QWORD *)&vNormal.x = *(_QWORD *)&ped->m_vecDamageNormal.x;
        vNormal.x = -vNormal.x;
        vNormal.y = -vNormal.y;
        vNormal.z = -v45;
        if ( CPed::IsPlayer((const CPed *)m_pDamageEntity) )
        {
          CEventPedCollisionWithPed::CEventPedCollisionWithPed(
            (CEventPedCollisionWithPed *)&v92,
            ped->m_nDamagedPieceType,
            ped->m_fDamageImpulseMagnitude,
            ped,
            &vNormal,
            &ped->m_vecDamagePos,
            iPedMoveState,
            v16);
          v92._vptr$CEvent = (int (**)(void))&off_6691C8;
          CEventGroup::Add(
            (CEventGroup *)(LODWORD(m_pDamageEntity[18].m_transform.m_translate.y) + 104),
            (CEvent *)&v92,
            0);
          CEventPedCollisionWithPed::~CEventPedCollisionWithPed((CEventPedCollisionWithPed *)&v92);
        }
        else if ( CPed::IsPlayer(ped) )
        {
          CEventPedCollisionWithPed::CEventPedCollisionWithPed(
            (CEventPedCollisionWithPed *)&v92,
            ped->m_nDamagedPieceType,
            ped->m_fDamageImpulseMagnitude,
            ped,
            &vNormal,
            &ped->m_vecDamagePos,
            iPedMoveState,
            v16);
          v92._vptr$CEvent = (int (**)(void))&off_669214;
          CEventGroup::Add(
            (CEventGroup *)(LODWORD(m_pDamageEntity[18].m_transform.m_translate.y) + 104),
            (CEvent *)&v92,
            0);
          v46 = m_pDamageEntity[18].m_transform.m_translate.y;
          if ( *(_BYTE *)(LODWORD(v46) + 384) )
          {
            if ( *(_BYTE *)(LODWORD(v46) + 385) )
            {
              v47 = CTimer::m_snTimeInMilliseconds;
              *(_BYTE *)(LODWORD(v46) + 385) = 0;
              *(_DWORD *)(LODWORD(v46) + 376) = v47;
              v48 = v47;
            }
            else
            {
              v48 = *(_DWORD *)(LODWORD(v46) + 376);
              v47 = CTimer::m_snTimeInMilliseconds;
            }
            if ( v48 + *(_DWORD *)(LODWORD(v46) + 380) <= v47 )
            {
              *(_DWORD *)(LODWORD(v46) + 376) = v47;
              *(_DWORD *)(LODWORD(v46) + 380) = 3000;
              v74 = *(_BYTE *)(LODWORD(v46) + 372);
              *(_BYTE *)(LODWORD(v46) + 384) = 1;
              *(_BYTE *)(LODWORD(v46) + 372) = v74 + 1;
            }
          }
          v75 = CAcquaintance::GetAcquaintances((const CAcquaintance *)&m_pDamageEntity[21], 4);
          if ( (CPedType::GetPedFlag(ped->m_nPedType) & v75) != 0 )
          {
            CEventAcquaintancePed::CEventAcquaintancePed((CEventAcquaintancePed *)&v93, ped);
            v93.m_pInflictor = (const CEntity *)&off_665394;
            CEventGroup::Add(
              (CEventGroup *)(LODWORD(m_pDamageEntity[18].m_transform.m_translate.y) + 104),
              (CEvent *)&v93,
              0);
            CEventAcquaintancePed::~CEventAcquaintancePed((CEventAcquaintancePed *)&v93);
          }
          CEventPedCollisionWithPed::~CEventPedCollisionWithPed((CEventPedCollisionWithPed *)&v92);
        }
        else
        {
          CEventPedCollisionWithPed::CEventPedCollisionWithPed(
            (CEventPedCollisionWithPed *)&v92,
            ped->m_nDamagedPieceType,
            ped->m_fDamageImpulseMagnitude,
            ped,
            &vNormal,
            &ped->m_vecDamagePos,
            iPedMoveState,
            v16);
          CEventGroup::Add(
            (CEventGroup *)(LODWORD(m_pDamageEntity[18].m_transform.m_translate.y) + 104),
            (CEvent *)&v92,
            0);
          CEventPedCollisionWithPed::~CEventPedCollisionWithPed((CEventPedCollisionWithPed *)&v92);
        }
      }
      goto LABEL_107;
    case 4:
      v3.n64_u32[0] = LODWORD(ped->m_fDamageImpulseMagnitude);
      v17.n64_u32[0] = v3.n64_u32[0];
      v18 = *(_DWORD *)&ped->m_nPedFlags & 1;
      if ( v18 )
      {
        v17.n64_u32[0] = LODWORD(ped->m_fDamageImpulseMagnitude);
        if ( (*(_DWORD *)&m_pDamageEntity->m_nFlags & 0x40004) == 0 )
        {
          v5.n64_f32[0] = (float)(ped->m_vecDamageNormal.x * ped->m_vecCurrentVelocity.x)
                        + (float)(ped->m_vecDamageNormal.y * ped->m_vecCurrentVelocity.y);
          v17.n64_u64[0] = v3.n64_u64[0];
          if ( v5.n64_f32[0] < 0.0 )
          {
            v17.n64_f32[0] = v5.n64_f32[0] * ped->m_fMass;
            v5.n64_u32[0] = 0;
            v17.n64_f32[0] = v3.n64_f32[0] + v17.n64_f32[0];
            v17.n64_u32[0] = vmax_f32(v17, v5).n64_u32[0];
          }
        }
      }
      v19 = 2.0;
      if ( !ped->m_pPlayerData )
        v19 = 1.0;
      if ( v17.n64_f32[0] <= v19 || (*(_DWORD *)&m_pDamageEntity->m_nFlags & 0x40004) != 0 )
        goto LABEL_28;
      v20 = v18 == 0;
      if ( v18 )
        v20 = m_pDamageEntity == ped->m_pEntityStandingOn;
      if ( v20
        || (v21 = m_pDamageEntity[4].m_transform.m_heading, v21 != 0.0) && m_pDamageEntity == (CEntity *)LODWORD(v21) )
      {
LABEL_28:
        CEventObjectCollision::CEventObjectCollision(
          (CEventObjectCollision *)&v92,
          ped->m_nDamagedPieceType,
          ped->m_fDamageImpulseMagnitude,
          (const CObject *)m_pDamageEntity,
          &ped->m_vecDamageNormal,
          &ped->m_vecDamagePos,
          iPedMoveState);
        CEventGroup::Add(pEventGroup, (CEvent *)&v92, 0);
        CEventObjectCollision::~CEventObjectCollision((CEventObjectCollision *)&v92);
      }
      else
      {
        v37 = 10.0 / v19;
        v38 = ped->m_vecDamageNormal.x;
        *(float *)&v92.m_iAccumulatedTime = -ped->m_vecDamageNormal.y;
        *(float *)&v92._vptr$CEvent = -v38;
        LocalDirection = CPed::GetLocalDirection(ped, (const CVector2D *)&v92);
        CWeapon::GenerateDamageEvent(
          ped,
          ped->m_pDamageEntity,
          WEAPONTYPE_FALL,
          (int)(float)(v17.n64_f32[0] * v37),
          PED_SPHERE_CHEST,
          LocalDirection);
        ped->m_pNOCollisionVehicle = ped->m_pDamageEntity;
      }
      goto LABEL_107;
    default:
      goto LABEL_107;
  }
}
// 4BF068: variable 'v3' is possibly undefined
// 4BF086: variable 'v5' is possibly undefined
// 4BF1CA: variable 'v4' is possibly undefined
// 4BF44A: variable 'v31' is possibly undefined
// 4BF8D2: variable 'v6' is possibly undefined
// 4BF9B2: variable 'v84' is possibly undefined
// 665394: using guessed type void *off_665394;
// 66714C: using guessed type void *off_66714C;
// 6691C8: using guessed type void *;
// 669214: using guessed type void *;
// 676218: using guessed type void *`vtable for'CEventAcquaintancePedHate;

//----- (004BFAA4) --------------------------------------------------------
void __fastcall CEventScanner::CEventScanner(CEventScanner *this)
{
  __int64 v1; // d18
  __int64 v2; // d19
  uint32 v3; // r5

  *(float *)&v1 = 25.0;
  *((float *)&v1 + 1) = 25.0;
  *(float *)&v2 = 25.0;
  *((float *)&v2 + 1) = 25.0;
  *(_WORD *)&this->m_objectCollisionScanner.m_timer.m_bIsActive = 0;
  *(_WORD *)&this->m_vehicleCollisionScanner.m_timer.m_bIsActive = 0;
  this->m_vehicleCollisionScanner.m_timer.m_iStartTime = 0;
  this->m_vehicleCollisionScanner.m_timer.m_iDuration = 0;
  *(_WORD *)&this->m_attractorScanner.m_timer.m_bIsActive = 0;
  this->m_objectCollisionScanner.m_timer.m_iStartTime = 0;
  this->m_objectCollisionScanner.m_timer.m_iDuration = 0;
  this->m_attractorScanner.m_bActivated = 1;
  this->m_attractorScanner.m_pPreviousEffect = 0;
  *(_QWORD *)&this->m_attractorScanner.m_pPreviousEntity = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_entities[1] = 0LL;
  this->m_attractorScanner.m_entities[3] = 0;
  *(_QWORD *)this->m_attractorScanner.m_effects = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_effects[2] = 0LL;
  this->m_attractorScanner.m_timer.m_iStartTime = 0;
  this->m_attractorScanner.m_timer.m_iDuration = 0;
  *(_QWORD *)this->m_attractorScanner.m_minDistanceSquared = v1;
  *(_QWORD *)&this->m_attractorScanner.m_minDistanceSquared[2] = v2;
  this->m_attractorScanner.m_entities[4] = 0;
  this->m_attractorScanner.m_minDistanceSquared[5] = 25.0;
  this->m_attractorScanner.m_minDistanceSquared[6] = 25.0;
  this->m_attractorScanner.m_minDistanceSquared[4] = 15.0 * 15.0;
  *(_QWORD *)&this->m_attractorScanner.m_effects[4] = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_effects[6] = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_entities[5] = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_entities[7] = 0LL;
  this->m_attractorScanner.m_minDistanceSquared[7] = 15.0 * 15.0;
  this->m_attractorScanner.m_entities[9] = 0;
  this->m_attractorScanner.m_effects[8] = 0;
  this->m_attractorScanner.m_effects[9] = 0;
  this->m_attractorScanner.m_minDistanceSquared[8] = 25.0;
  this->m_attractorScanner.m_minDistanceSquared[9] = 25.0;
  *(_WORD *)&this->m_acquaintanceScanner.m_timer.m_bIsActive = 0;
  this->m_acquaintanceScanner.m_timer.m_iStartTime = 0;
  this->m_acquaintanceScanner.m_timer.m_iDuration = 0;
  *(_WORD *)&this->m_acquaintanceScanner.m_bActivatedEverywhere = 1;
  *(_WORD *)&this->m_sexyPedScanner.m_timer.m_bIsActive = 0;
  this->m_acquaintanceScanner.m_bActivatedDuringScriptCommands = 0;
  this->m_sexyPedScanner.m_timer.m_iStartTime = 0;
  this->m_sexyPedScanner.m_timer.m_iDuration = 0;
  *(_WORD *)&this->m_fireScanner.m_timer.m_bIsActive = 0;
  this->m_fireScanner.m_timer.m_iStartTime = 0;
  this->m_fireScanner.m_timer.m_iDuration = 0;
  v3 = CTimer::m_snTimeInMilliseconds;
  this->m_startTime = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3000.0) + v3;
}

//----- (004BFB94) --------------------------------------------------------
void __fastcall CEventScanner::ScanForEventsNow(CEventScanner *this, const CPed *ped, const int iScanType)
{
  int m_bIsActive; // r3

  if ( !iScanType )
  {
    m_bIsActive = this->m_vehicleCollisionScanner.m_timer.m_bIsActive;
    if ( this->m_vehicleCollisionScanner.m_timer.m_bIsActive )
    {
      this->m_vehicleCollisionScanner.m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
      this->m_vehicleCollisionScanner.m_timer.m_iDuration = -1;
      m_bIsActive = 1;
      this->m_vehicleCollisionScanner.m_timer.m_bIsActive = 1;
    }
    CVehiclePotentialCollisionScanner::ScanForVehiclePotentialCollisionEvents(
      &this->m_vehicleCollisionScanner,
      ped,
      (CEntity **)&this->m_vehicleCollisionScanner,
      m_bIsActive);
  }
}

//----- (004BFBC0) --------------------------------------------------------
void __fastcall CEventScanner::ScanForEvents(CEventScanner *this, CPed *ped)
{
  CEntity **v2; // r2
  int v3; // r3
  CPedIntelligence *m_pPedIntelligence; // r10
  const CPedPotentialCollisionScanner *v7; // r0
  __int64 v8; // r0
  int m_nPedFlags; // r0
  CPedFlags *p_m_nPedFlags; // r9
  CEvent *CurrentEvent; // r0
  CTask *SimplestActiveTask; // r0
  CTaskManager *p_m_taskManager; // r5
  CTask *TaskByType; // r0
  CPed *v15; // r1
  bool v16; // zf
  CEntity *m_pEntityStandingOn; // r2
  bool v18; // zf
  CEntity *v19; // r0
  int m_nModelIndex; // r0
  bool v21; // zf
  CVehicle *m_pMyVehicle; // r0
  CPlayerPed *PlayerPed; // r0
  CEventDamage v24; // [sp+14h] [bp-5Ch] BYREF
  int iAcquaintancePedScanType[7]; // [sp+54h] [bp-1Ch] BYREF

  if ( CTimer::m_snTimeInMilliseconds <= this->m_startTime )
    return;
  m_pPedIntelligence = ped->m_pPedIntelligence;
  CVehiclePotentialCollisionScanner::ScanForVehiclePotentialCollisionEvents(
    &this->m_vehicleCollisionScanner,
    ped,
    v2,
    v3);
  CPedPotentialCollisionScanner::ScanForPedPotentialCollisionEvents(
    v7,
    ped,
    (CPed *)m_pPedIntelligence->m_pedScanner.m_pClosestEntity);
  CObjectPotentialCollisionScanner::ScanForObjectPotentialCollisionEvents(&this->m_objectCollisionScanner, ped);
  if ( !this->m_acquaintanceScanner.m_timer.m_bIsActive )
  {
    *(_QWORD *)&this->m_acquaintanceScanner.m_timer.m_iStartTime = __PAIR64__(
                                                                     CPedAcquaintanceScanner::ms_iAcquaintanceScanPeriod,
                                                                     CTimer::m_snTimeInMilliseconds);
    this->m_acquaintanceScanner.m_timer.m_bIsActive = 1;
  }
  if ( this->m_acquaintanceScanner.m_timer.m_bIsStopped )
  {
    LODWORD(v8) = CTimer::m_snTimeInMilliseconds;
    this->m_acquaintanceScanner.m_timer.m_bIsStopped = 0;
    this->m_acquaintanceScanner.m_timer.m_iStartTime = v8;
    HIDWORD(v8) = v8;
  }
  else
  {
    HIDWORD(v8) = this->m_acquaintanceScanner.m_timer.m_iStartTime;
    LODWORD(v8) = CTimer::m_snTimeInMilliseconds;
  }
  if ( HIDWORD(v8) + this->m_acquaintanceScanner.m_timer.m_iDuration <= (unsigned int)v8 )
  {
    HIDWORD(v8) = CPedAcquaintanceScanner::ms_iAcquaintanceScanPeriod;
    *(_QWORD *)&this->m_acquaintanceScanner.m_timer.m_iStartTime = v8;
    this->m_acquaintanceScanner.m_timer.m_bIsActive = 1;
    if ( CPedAcquaintanceScanner::IsScanPermitted(&this->m_acquaintanceScanner, ped) )
    {
      v24._vptr$CEvent = 0;
      iAcquaintancePedScanType[0] = -1;
      CPedAcquaintanceScanner::FindClosestAcquaintance(
        &this->m_acquaintanceScanner,
        ped,
        -1,
        m_pPedIntelligence->m_pedScanner.m_entities,
        16,
        (CPed **)&v24,
        iAcquaintancePedScanType);
    }
  }
  CAttractorScanner::ScanForAttractorsInRange(&this->m_attractorScanner, ped);
  CNearbyFireScanner::ScanForNearbyFires(&this->m_fireScanner, ped);
  CMentalState::Process(&m_pPedIntelligence->m_mentalState, ped);
  m_nPedFlags = (int)ped->m_nPedFlags;
  p_m_nPedFlags = &ped->m_nPedFlags;
  if ( (m_nPedFlags & 1) != 0 )
    goto LABEL_15;
  if ( (m_nPedFlags & 0x200) == 0 && !CPedGeometryAnalyser::IsInAir(ped) )
  {
    m_nPedFlags = *(_DWORD *)p_m_nPedFlags;
LABEL_15:
    if ( (m_nPedFlags & 0x200) != 0 )
    {
      if ( !CEventHandlerHistory::GetCurrentEvent(&m_pPedIntelligence->m_eventHandler.m_history)
        || (CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&m_pPedIntelligence->m_eventHandler.m_history),
            (*((int (__fastcall **)(CEvent *))CurrentEvent->_vptr$CEvent + 2))(CurrentEvent) != 33) )
      {
        *(_DWORD *)p_m_nPedFlags &= ~0x200u;
      }
    }
    goto LABEL_19;
  }
  CEventInAir::CEventInAir((CEventInAir *)&v24);
  CEventGroup::Add(&m_pPedIntelligence->m_eventGroup, (CEvent *)&v24, 0);
  CEvent::~CEvent((CEvent *)&v24);
LABEL_19:
  if ( ped->m_pFire )
  {
    CEvent::CEvent((CEvent *)&v24);
    v24._vptr$CEvent = (int (**)(void))&off_666F34;
    if ( CPed::IsPlayer(ped)
      || (SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&m_pPedIntelligence->m_taskManager)) == 0
      || (*((int (__fastcall **)(CTask *, CPed *, int, CEventDamage *))SimplestActiveTask->_vptr$CTask + 7))(
           SimplestActiveTask,
           ped,
           1,
           &v24) )
    {
      CEventGroup::Add(&m_pPedIntelligence->m_eventGroup, (CEvent *)&v24, 0);
    }
    else
    {
      CWeapon::GenerateDamageEvent(
        ped,
        ped->m_pFire->m_pEntityStartedFire,
        WEAPONTYPE_FLAMETHROWER,
        5,
        PED_SPHERE_CHEST,
        0);
    }
    CEvent::~CEvent((CEvent *)&v24);
  }
  CSexyPedScanner::ScanForSexyPedEvents(&this->m_sexyPedScanner, ped, m_pPedIntelligence->m_pedScanner.m_entities, 16);
  p_m_taskManager = &ped->m_pPedIntelligence->m_taskManager;
  TaskByType = CTaskManager::FindTaskByType(p_m_taskManager, 4, 1000);
  if ( TaskByType
    || (TaskByType = CTaskManager::FindTaskByType(p_m_taskManager, 3, 1000)) != 0
    || (TaskByType = CTaskManager::FindTaskByType(p_m_taskManager, 1, 1000)) != 0
    || (TaskByType = CTaskManager::FindTaskByType(p_m_taskManager, 2, 1000)) != 0 )
  {
    v15 = (CPed *)TaskByType[2]._vptr$CTask;
    v16 = v15 == 0;
    if ( v15 )
    {
      TaskByType = (CTask *)v15->m_pEntityStandingOn;
      v16 = TaskByType == 0;
    }
    if ( !v16 )
    {
      m_pEntityStandingOn = ped->m_pEntityStandingOn;
      v18 = m_pEntityStandingOn == 0;
      if ( m_pEntityStandingOn )
        v18 = HIBYTE(TaskByType[6]._vptr$CTask) == m_pEntityStandingOn->m_areaCode;
      if ( !v18 )
      {
        CEventAreaCodes::CEventAreaCodes((CEventAreaCodes *)&v24, v15);
        CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v24, 0);
        CEventAreaCodes::~CEventAreaCodes((CEventAreaCodes *)&v24);
      }
    }
  }
  v19 = ped->m_pEntityStandingOn;
  if ( v19 )
  {
    m_nModelIndex = v19->m_nModelIndex;
    if ( m_nModelIndex == MI_ESCALATORSTEP || m_nModelIndex == MI_ESCALATORSTEP8 )
    {
      CEvent::CEvent((CEvent *)&v24);
      v24._vptr$CEvent = (int (**)(void))&off_667238;
      CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v24, 0);
      CEvent::~CEvent((CEvent *)&v24);
    }
  }
  m_pMyVehicle = (CVehicle *)(*((unsigned __int8 *)&ped->m_nPedFlags + 1) << 31);
  v21 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = ped->m_pMyVehicle;
    v21 = m_pMyVehicle == 0;
  }
  if ( !v21
    && m_pMyVehicle->m_baseVehicleType == 5
    && !CPed::IsPlayer(ped)
    && FindPlayerPed(-1)->m_pEntityStandingOn == ped->m_pMyVehicle )
  {
    PlayerPed = FindPlayerPed(-1);
    CEventPedEnteredMyVehicle::CEventPedEnteredMyVehicle(
      (CEventPedEnteredMyVehicle *)&v24,
      PlayerPed,
      ped->m_pMyVehicle,
      10);
    v24.m_iTaskType = 706;
    CEventGroup::Add(&ped->m_pPedIntelligence->m_eventGroup, (CEvent *)&v24, 0);
    CEventPedEnteredMyVehicle::~CEventPedEnteredMyVehicle((CEventPedEnteredMyVehicle *)&v24);
  }
  if ( ped->m_nHealth <= 0.0
    && CPed::IsAlive(ped)
    && CTimer::m_snTimeInMilliseconds > CEventScanner::m_sDeadPedWalkingTimer )
  {
    CEventDamage::CEventDamage(&v24, 0, 0, WEAPONTYPE_UNIDENTIFIED, PED_SPHERE_CHEST, 0, 0, 0);
    if ( !CEventGroup::HasEventOfType(&ped->m_pPedIntelligence->m_eventGroup, (const CEvent *)&v24) )
    {
      CWeapon::GenerateDamageEvent(ped, 0, WEAPONTYPE_FALL, 10, PED_SPHERE_CHEST, 0);
      CEventScanner::m_sDeadPedWalkingTimer = CTimer::m_snTimeInMilliseconds + 2000;
    }
    CEventDamage::~CEventDamage(&v24);
  }
}
// 4BFBE6: variable 'v2' is possibly undefined
// 4BFBE6: variable 'v3' is possibly undefined
// 4BFBF0: variable 'v7' is possibly undefined
// 666F34: using guessed type void *off_666F34;
// 667238: using guessed type void *off_667238;
// 4BFBC0: using guessed type int var_1C[7];

//----- (004BFF80) --------------------------------------------------------
CTask *__fastcall CPedIntelligence::FindTaskByType(const CPedIntelligence *this, const int iType)
{
  CTaskManager *p_m_taskManager; // r5
  CTask *result; // r0

  p_m_taskManager = &this->m_taskManager;
  result = CTaskManager::FindTaskByType(&this->m_taskManager, 4, iType);
  if ( !result )
  {
    result = CTaskManager::FindTaskByType(p_m_taskManager, 3, iType);
    if ( !result )
    {
      result = CTaskManager::FindTaskByType(p_m_taskManager, 1, iType);
      if ( !result )
        return sub_18C5C4(p_m_taskManager, 2, iType);
    }
  }
  return result;
}

//----- (004BFFC0) --------------------------------------------------------
void __fastcall CEventScanner::Clear(CEventScanner *this)
{
  __int64 v1; // d16
  __int64 v2; // d17

  *(float *)&v1 = 25.0;
  *((float *)&v1 + 1) = 25.0;
  *(float *)&v2 = 25.0;
  *((float *)&v2 + 1) = 25.0;
  *(_QWORD *)this->m_attractorScanner.m_entities = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_entities[2] = 0LL;
  *(_QWORD *)this->m_attractorScanner.m_minDistanceSquared = v1;
  *(_QWORD *)&this->m_attractorScanner.m_minDistanceSquared[2] = v2;
  *(_QWORD *)this->m_attractorScanner.m_effects = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_effects[2] = 0LL;
  this->m_attractorScanner.m_effects[4] = 0;
  this->m_attractorScanner.m_minDistanceSquared[4] = 15.0 * 15.0;
  *(_QWORD *)&this->m_attractorScanner.m_effects[5] = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_effects[7] = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_entities[6] = 0LL;
  *(_QWORD *)&this->m_attractorScanner.m_entities[8] = 0LL;
  this->m_attractorScanner.m_minDistanceSquared[7] = 15.0 * 15.0;
  this->m_attractorScanner.m_entities[4] = 0;
  this->m_attractorScanner.m_entities[5] = 0;
  this->m_attractorScanner.m_minDistanceSquared[5] = 25.0;
  this->m_attractorScanner.m_minDistanceSquared[6] = 25.0;
  this->m_attractorScanner.m_effects[9] = 0;
  this->m_attractorScanner.m_minDistanceSquared[8] = 25.0;
  this->m_attractorScanner.m_minDistanceSquared[9] = 25.0;
}

//----- (004C0028) --------------------------------------------------------
void __fastcall CPedIntelligence::CPedIntelligence(CPedIntelligence *this, CPed *pPed)
{
  int v4; // r8
  unsigned __int16 v5; // r0

  this->m_pPed = pPed;
  CTaskManager::CTaskManager(&this->m_taskManager, pPed);
  CEventHandler::CEventHandler(&this->m_eventHandler, pPed);
  CEventGroup::CEventGroup(&this->m_eventGroup, pPed);
  this->m_vehicleScanner.m_timer = 0LL;
  *(_QWORD *)this->m_vehicleScanner.m_entities = 0LL;
  this->m_pedScanner.m_timer = 0LL;
  *(_QWORD *)this->m_pedScanner.m_entities = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[13] = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[15] = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[10] = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[12] = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[6] = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[8] = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[2] = 0LL;
  *(_QWORD *)&this->m_vehicleScanner.m_entities[4] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[13] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[15] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[10] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[12] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[6] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[8] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[2] = 0LL;
  *(_QWORD *)&this->m_pedScanner.m_entities[4] = 0LL;
  this->m_iDecisionMakerType = -1;
  this->m_iDecisionMakerTypeInGroup = -1;
  this->m_fHearingRange = 15.0;
  this->m_fSeeingRange = 15.0;
  this->m_iMaxNumFriendsToInform = 3;
  this->m_fMaxInformFriendDistance = 15.0;
  this->m_fFollowNodeThresholdDistance = 30.0;
  *(_WORD *)&this->m_iNextEventResponseSequence = 255;
  this->m_iHighestPriorityEventPriority = 0;
  this->m_vehicleScanner._vptr$CEntityScanner = (int (**)(void))&off_669260;
  this->m_vehicleScanner.m_timer.m_iPeriod = 16;
  this->m_pedScanner.m_timer.m_iPeriod = 16;
  this->m_mentalState.m_iAngerAtPlayer = 0;
  this->m_pedScanner._vptr$CEntityScanner = (int (**)(void))&off_66926C;
  *(_WORD *)&this->m_mentalState.m_angerTimer.m_bIsActive = 0;
  this->m_mentalState.m_angerTimer.m_iStartTime = 0;
  this->m_mentalState.m_angerTimer.m_iDuration = 0;
  this->m_mentalState.m_bInCarLastTime = 0;
  v4 = CTimer::m_snTimeInMilliseconds;
  this->m_mentalState.m_angerTimer.m_bIsActive = 1;
  this->m_mentalState.m_angerTimer.m_iStartTime = v4;
  this->m_mentalState.m_angerTimer.m_iDuration = 0;
  *(_WORD *)&this->m_eventScanner.m_vehicleCollisionScanner.m_timer.m_bIsActive = 0;
  this->m_eventScanner.m_vehicleCollisionScanner.m_timer.m_iStartTime = 0;
  this->m_eventScanner.m_vehicleCollisionScanner.m_timer.m_iDuration = 0;
  *(_WORD *)&this->m_eventScanner.m_objectCollisionScanner.m_timer.m_bIsActive = 0;
  this->m_eventScanner.m_objectCollisionScanner.m_timer.m_iStartTime = 0;
  this->m_eventScanner.m_objectCollisionScanner.m_timer.m_iDuration = 0;
  this->m_eventScanner.m_attractorScanner.m_bActivated = 1;
  this->m_eventScanner.m_attractorScanner.m_timer.m_iStartTime = 0;
  this->m_eventScanner.m_attractorScanner.m_timer.m_iDuration = 0;
  *(_WORD *)&this->m_eventScanner.m_attractorScanner.m_timer.m_bIsActive = 0;
  this->m_eventScanner.m_attractorScanner.m_pPreviousEffect = 0;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_pPreviousEntity = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_entities[1] = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_entities[3] = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_entities[5] = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_effects[3] = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_effects[5] = 0LL;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[4] = 15.0 * 15.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[5] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[6] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[7] = 15.0 * 15.0;
  this->m_eventScanner.m_attractorScanner.m_entities[7] = 0;
  this->m_eventScanner.m_attractorScanner.m_entities[8] = 0;
  this->m_eventScanner.m_attractorScanner.m_entities[9] = 0;
  this->m_eventScanner.m_attractorScanner.m_effects[0] = 0;
  this->m_eventScanner.m_attractorScanner.m_effects[1] = 0;
  this->m_eventScanner.m_attractorScanner.m_effects[2] = 0;
  this->m_eventScanner.m_attractorScanner.m_effects[7] = 0;
  this->m_eventScanner.m_attractorScanner.m_effects[8] = 0;
  this->m_eventScanner.m_attractorScanner.m_effects[9] = 0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[0] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[1] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[2] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[3] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[8] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[9] = 25.0;
  *(_WORD *)&this->m_eventScanner.m_acquaintanceScanner.m_timer.m_bIsActive = 0;
  this->m_eventScanner.m_acquaintanceScanner.m_timer.m_iStartTime = 0;
  this->m_eventScanner.m_acquaintanceScanner.m_timer.m_iDuration = 0;
  *(_WORD *)&this->m_eventScanner.m_acquaintanceScanner.m_bActivatedEverywhere = 1;
  this->m_eventScanner.m_acquaintanceScanner.m_bActivatedDuringScriptCommands = 0;
  *(_WORD *)&this->m_eventScanner.m_sexyPedScanner.m_timer.m_bIsActive = 0;
  this->m_eventScanner.m_sexyPedScanner.m_timer.m_iStartTime = 0;
  this->m_eventScanner.m_sexyPedScanner.m_timer.m_iDuration = 0;
  *(_WORD *)&this->m_eventScanner.m_fireScanner.m_timer.m_bIsActive = 0;
  this->m_eventScanner.m_fireScanner.m_timer.m_iStartTime = 0;
  this->m_eventScanner.m_fireScanner.m_timer.m_iDuration = 0;
  v5 = rand();
  this->m_collisionEventScanner.m_bAlreadyHitByCar = 0;
  this->m_iStaticCounter = 0;
  *(_DWORD *)&this->m_stuckChecker.m_nStuckCounter = 0;
  this->m_iNumFramesWithoutCollision = 0;
  this->m_eventScanner.m_startTime = (int)(float)((float)((float)v5 * 0.000015259) * 3000.0) + v4;
  if ( (unsigned int)(pPed->m_nPedType - 7) < 0xA )
  {
    this->m_fHearingRange = 40.0;
    this->m_fSeeingRange = 40.0;
  }
  this->m_pInterestingEntities[0] = 0;
  this->m_pInterestingEntities[1] = 0;
  this->m_pInterestingEntities[2] = 0;
}
// 669260: using guessed type void *;
// 66926C: using guessed type void *;

//----- (004C0230) --------------------------------------------------------
void __fastcall CPedIntelligence::~CPedIntelligence(CPedIntelligence *this)
{
  CPlayerRelationshipRecorder *PlayerRelationshipRecorder; // r0
  int v3; // r5
  CEntity *v4; // r0
  CEntity *m_pClosestEntity; // r0
  int v6; // r5
  CEntity *v7; // r0
  CEntity *v8; // r0

  PlayerRelationshipRecorder = GetPlayerRelationshipRecorder();
  CPlayerRelationshipRecorder::ClearRelationshipWithPlayer(PlayerRelationshipRecorder, this->m_pPed);
  v3 = 304;
  this->m_pedScanner._vptr$CEntityScanner = (int (**)(void))&off_669070;
  do
  {
    v4 = *(CPed **)((char *)&this->m_pPed + v3);
    if ( v4 )
    {
      CEntity::CleanUpOldReference(v4, (CEntity **)((char *)&this->m_pPed + v3));
      *(CPed **)((char *)&this->m_pPed + v3) = 0;
    }
    v3 += 4;
  }
  while ( v3 != 368 );
  m_pClosestEntity = this->m_pedScanner.m_pClosestEntity;
  if ( m_pClosestEntity )
  {
    CEntity::CleanUpOldReference(m_pClosestEntity, &this->m_pedScanner.m_pClosestEntity);
    this->m_pedScanner.m_pClosestEntity = 0;
  }
  v6 = 224;
  this->m_vehicleScanner._vptr$CEntityScanner = (int (**)(void))&off_669070;
  do
  {
    v7 = *(CPed **)((char *)&this->m_pPed + v6);
    if ( v7 )
    {
      CEntity::CleanUpOldReference(v7, (CEntity **)((char *)&this->m_pPed + v6));
      *(CPed **)((char *)&this->m_pPed + v6) = 0;
    }
    v6 += 4;
  }
  while ( v6 != 288 );
  v8 = this->m_vehicleScanner.m_pClosestEntity;
  if ( v8 )
  {
    CEntity::CleanUpOldReference(v8, &this->m_vehicleScanner.m_pClosestEntity);
    this->m_vehicleScanner.m_pClosestEntity = 0;
  }
  CEventGlobalGroup::~CEventGlobalGroup(&this->m_eventGroup);
  CEventHandler::~CEventHandler(&this->m_eventHandler);
  CTaskManager::~CTaskManager(&this->m_taskManager);
}
// 669070: using guessed type void *off_669070;

//----- (004C02DC) --------------------------------------------------------
void __fastcall CEntityScanner::~CEntityScanner(CEntityScanner *this)
{
  int v2; // r5
  CEntity *v3; // r0
  CEntity *m_pClosestEntity; // r0

  v2 = 12;
  this->_vptr$CEntityScanner = (int (**)(void))&off_669070;
  do
  {
    v3 = *(CEntity **)((char *)&this->_vptr$CEntityScanner + v2);
    if ( v3 )
    {
      CEntity::CleanUpOldReference(v3, (CEntity **)((char *)this + v2));
      *(int (***)(void))((char *)&this->_vptr$CEntityScanner + v2) = 0;
    }
    v2 += 4;
  }
  while ( v2 != 76 );
  m_pClosestEntity = this->m_pClosestEntity;
  if ( m_pClosestEntity )
  {
    CEntity::CleanUpOldReference(m_pClosestEntity, &this->m_pClosestEntity);
    this->m_pClosestEntity = 0;
  }
}
// 669070: using guessed type void *off_669070;

//----- (004C0324) --------------------------------------------------------
void __fastcall CPedIntelligence::SetPedDecisionMakerTypeInGroup(CPedIntelligence *this, const int iType)
{
  this->m_iDecisionMakerTypeInGroup = iType;
}

//----- (004C032A) --------------------------------------------------------
void __fastcall CPedIntelligence::RestorePedDecisionMakerType(CPedIntelligence *this)
{
  if ( !this->m_iDecisionMakerType )
    this->m_iDecisionMakerType = this->m_iDecisionMakerTypeInGroup;
}

//----- (004C033C) --------------------------------------------------------
void __fastcall CPedIntelligence::SetHearingRange(CPedIntelligence *this, const float fRange)
{
  this->m_fHearingRange = fRange;
}

//----- (004C0342) --------------------------------------------------------
void __fastcall CPedIntelligence::SetSeeingRange(CPedIntelligence *this, const float fRange)
{
  this->m_fSeeingRange = fRange;
}

//----- (004C0348) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsInHearingRange(const CPedIntelligence *this, const CVector *vTarget)
{
  CMatrix *m_pMat; // r3
  CSimpleTransform *p_tx; // r2
  float m_fHearingRange; // s4
  float32x2_t v5; // d16
  bool result; // r0
  unsigned __int64 v7; // d1

  m_pMat = this->m_pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &this->m_pPed->m_transform;
  m_fHearingRange = this->m_fHearingRange;
  v5.n64_u64[0] = vsub_f32(*(float32x2_t *)&vTarget->y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
  result = 0;
  v7 = vmul_f32(v5, v5).n64_u64[0];
  if ( (float)((float)((float)((float)(vTarget->x - p_tx->m_translate.x) * (float)(vTarget->x - p_tx->m_translate.x))
                     + *(float *)&v7)
             + *((float *)&v7 + 1)) < (float)(m_fHearingRange * m_fHearingRange) )
    return 1;
  return result;
}

//----- (004C039C) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsInSeeingRange(const CPedIntelligence *this, const CVector *vTarget)
{
  CPed *m_pPed; // r2
  float x; // s0
  float y; // s2
  CMatrix *m_pMat; // r3
  float z; // s4
  float *p_tx; // r1
  float v8; // s0
  float v9; // s2
  float v10; // s4
  float m_fSeeingRange; // s8
  bool result; // r0

  m_pPed = this->m_pPed;
  x = vTarget->x;
  y = vTarget->y;
  m_pMat = this->m_pPed->m_pMat;
  z = vTarget->z;
  p_tx = &m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pPed->m_transform.m_translate.x;
  v8 = x - *p_tx;
  v9 = y - p_tx[1];
  v10 = z - p_tx[2];
  m_fSeeingRange = this->m_fSeeingRange;
  result = 0;
  if ( (float)((float)((float)(v8 * v8) + (float)(v9 * v9)) + (float)(v10 * v10)) < (float)(m_fSeeingRange
                                                                                          * m_fSeeingRange)
    && (float)((float)((float)(v8 * m_pPed->m_pMat->xy) + (float)(v9 * m_pPed->m_pMat->yy))
             + (float)(v10 * m_pPed->m_pMat->zy)) > 0.0 )
  {
    return 1;
  }
  return result;
}

//----- (004C0428) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsInSeeingRange(const CPedIntelligence *this, CEntity *entity)
{
  CPed *m_pPed; // r12
  CMatrix *m_pMat; // r3
  CMatrix *v4; // lr
  CSimpleTransform *p_tx; // r2
  float *p_x; // r3
  float x; // s0
  float y; // s4
  float z; // s2
  float v10; // s10
  float v11; // s8
  float m_fRadius; // s12
  float m_fSeeingRange; // s1
  bool result; // r0
  float *p_xx; // r1

  m_pPed = this->m_pPed;
  m_pMat = entity->m_pMat;
  v4 = this->m_pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &entity->m_transform;
  p_x = &v4->tx;
  x = p_tx->m_translate.x;
  y = p_tx->m_translate.y;
  z = p_tx->m_translate.z;
  if ( !v4 )
    p_x = &m_pPed->m_transform.m_translate.x;
  v10 = p_x[1];
  v11 = p_x[2];
  m_fRadius = CModelInfo::ms_modelInfoPtrs[entity->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  m_fSeeingRange = this->m_fSeeingRange;
  result = 0;
  if ( (float)((float)((float)((float)((float)(x - *p_x) * (float)(x - *p_x))
                             + (float)((float)(y - v10) * (float)(y - v10)))
                     + (float)((float)(z - v11) * (float)(z - v11)))
             - (float)(m_fRadius * m_fRadius)) <= (float)(m_fSeeingRange * m_fSeeingRange) )
  {
    p_xx = &m_pPed->m_pMat->xx;
    if ( (float)((float)((float)(p_xx[4] * (float)((float)(x + (float)(m_fRadius * p_xx[4])) - *p_x))
                       + (float)(p_xx[5] * (float)((float)(y + (float)(m_fRadius * p_xx[5])) - v10)))
               + (float)(p_xx[6] * (float)((float)(z + (float)(m_fRadius * p_xx[6])) - v11))) > 0.0 )
      return 1;
  }
  return result;
}

//----- (004C0514) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsRespondingToEvent(const CPedIntelligence *this, const int iEventType)
{
  return sub_19590C(&this->m_eventHandler.m_history, iEventType);
}

//----- (004C051A) --------------------------------------------------------
void __fastcall CPedIntelligence::AddTaskPhysResponse(CPedIntelligence *this, CTask *pTask, const bool bForce)
{
  sub_1951C0(&this->m_taskManager, pTask, 0, bForce);
}

//----- (004C0524) --------------------------------------------------------
void __fastcall CPedIntelligence::AddTaskEventResponseTemp(CPedIntelligence *this, CTask *pTask, const bool bForce)
{
  sub_1951C0(&this->m_taskManager, pTask, 1, bForce);
}

//----- (004C052E) --------------------------------------------------------
void __fastcall CPedIntelligence::AddTaskEventResponseNonTemp(CPedIntelligence *this, CTask *pTask, const bool bForce)
{
  sub_1951C0(&this->m_taskManager, pTask, 2, bForce);
}

//----- (004C0538) --------------------------------------------------------
void __fastcall CPedIntelligence::AddTaskPrimaryMaybeInGroup(
        CPedIntelligence *this,
        CTask *pTask,
        const bool bAcceptWhenDead)
{
  CPedGroup *PedsGroup; // r6
  _BOOL4 IsPlayer; // r0
  CEventScriptCommand v8; // [sp+0h] [bp-28h] BYREF

  PedsGroup = CPedGroups::GetPedsGroup(this->m_pPed);
  IsPlayer = CPed::IsPlayer(this->m_pPed);
  if ( !PedsGroup || IsPlayer )
  {
    CEventScriptCommand::CEventScriptCommand(&v8, 3, pTask, bAcceptWhenDead);
    CEventGroup::Add(&this->m_eventGroup, &v8, 0);
    CEventScriptCommand::~CEventScriptCommand(&v8);
  }
  else
  {
    CPedGroupIntelligence::SetScriptCommandTask(&PedsGroup->m_intelligence, this->m_pPed, pTask);
    (*((void (__fastcall **)(CTask *))pTask->_vptr$CTask + 1))(pTask);
  }
}

//----- (004C05A0) --------------------------------------------------------
CTaskSimpleFight *__fastcall CPedIntelligence::GetTaskFighting(const CPedIntelligence *this)
{
  CTaskManager *p_m_taskManager; // r5
  CTaskSimpleFight *v2; // r4
  CTask *TaskSecondary; // r0

  p_m_taskManager = &this->m_taskManager;
  v2 = 0;
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 0) )
  {
    v2 = 0;
    TaskSecondary = CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
    if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) == 1016 )
      return (CTaskSimpleFight *)CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
  }
  return v2;
}

//----- (004C05D6) --------------------------------------------------------
CTaskSimpleUseGun *__fastcall CPedIntelligence::GetTaskUseGun(const CPedIntelligence *this)
{
  CTaskManager *p_m_taskManager; // r5
  CTaskSimpleUseGun *v2; // r4
  CTask *TaskSecondary; // r0

  p_m_taskManager = &this->m_taskManager;
  v2 = 0;
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 0) )
  {
    v2 = 0;
    TaskSecondary = CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
    if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) == 1017 )
      return (CTaskSimpleUseGun *)CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
  }
  return v2;
}

//----- (004C060E) --------------------------------------------------------
CTaskSimpleThrowProjectile *__fastcall CPedIntelligence::GetTaskThrow(const CPedIntelligence *this)
{
  CTaskManager *p_m_taskManager; // r5
  CTaskSimpleThrowProjectile *v2; // r4
  CTask *TaskSecondary; // r0

  p_m_taskManager = &this->m_taskManager;
  v2 = 0;
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 0) )
  {
    v2 = 0;
    TaskSecondary = CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
    if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) == 1018 )
      return (CTaskSimpleThrowProjectile *)CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
  }
  return v2;
}

//----- (004C0646) --------------------------------------------------------
CTaskSimpleHoldEntity *__fastcall CPedIntelligence::GetTaskHold(
        const CPedIntelligence *this,
        const bool bOnlyReturnSecondaryTask)
{
  CTaskManager *p_m_taskManager; // r4
  _BOOL4 v3; // r5
  CTask *TaskSecondary; // r0
  CTask *SimplestActiveTask; // r0
  CTaskSimpleHoldEntity *v7; // r4

  p_m_taskManager = &this->m_taskManager;
  v3 = bOnlyReturnSecondaryTask;
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 4) )
  {
    TaskSecondary = CTaskManager::GetTaskSecondary(p_m_taskManager, 4);
    if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) == 307 )
      return (CTaskSimpleHoldEntity *)CTaskManager::GetTaskSecondary(p_m_taskManager, 4);
  }
  if ( v3 )
    return 0;
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(p_m_taskManager);
  v7 = (CTaskSimpleHoldEntity *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    return 0;
  if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 308
    && (*((int (__fastcall **)(CTaskSimpleHoldEntity *))v7->_vptr$CTask + 5))(v7) != 309 )
  {
    return 0;
  }
  return v7;
}

//----- (004C06AE) --------------------------------------------------------
CTaskSimpleDuck *__fastcall CPedIntelligence::GetTaskDuck(const CPedIntelligence *this, bool bSecondaryVersionOnly)
{
  CTaskManager *p_m_taskManager; // r4
  _BOOL4 v3; // r5
  CTask *TaskSecondary; // r0
  CTask *SimplestActiveTask; // r0
  CTaskSimpleDuck *v7; // r4

  p_m_taskManager = &this->m_taskManager;
  v3 = bSecondaryVersionOnly;
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 1) )
  {
    TaskSecondary = CTaskManager::GetTaskSecondary(p_m_taskManager, 1);
    if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) == 415 )
      return (CTaskSimpleDuck *)CTaskManager::GetTaskSecondary(p_m_taskManager, 1);
  }
  if ( v3 )
    return 0;
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(p_m_taskManager);
  v7 = (CTaskSimpleDuck *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    return 0;
  if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 415 )
    return 0;
  return v7;
}

//----- (004C0708) --------------------------------------------------------
CTaskSimpleInAir *__fastcall CPedIntelligence::GetTaskInAir(const CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTaskSimpleInAir *v2; // r4

  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  v2 = (CTaskSimpleInAir *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    return 0;
  if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 241 )
    return 0;
  return v2;
}

//----- (004C072C) --------------------------------------------------------
bool __fastcall CPedIntelligence::GetUsingParachute(const CPedIntelligence *this)
{
  CPed *m_pPed; // r0
  bool v2; // zf
  CAnimBlendAssociation *FirstAssociation; // r4

  m_pPed = this->m_pPed;
  if ( m_pPed->m_WeaponSlots[m_pPed->m_nCurrentWeapon].m_eWeaponType != WEAPONTYPE_PARACHUTE )
    return 0;
  v2 = *(_BYTE *)&m_pPed->m_nPedFlags << 31 == 0;
  if ( !(*(_BYTE *)&m_pPed->m_nPedFlags << 31) )
    v2 = *((unsigned __int8 *)&m_pPed->m_nPhysicalFlags + 1) << 31 == 0;
  if ( !v2 )
    return 0;
  FirstAssociation = RpAnimBlendClumpGetFirstAssociation((RpClump_0 *)m_pPed->m_pRwObject, 0x10u);
  if ( !FirstAssociation )
    return 0;
  while ( strcasecmp(
            (const char *)&CAnimManager::ms_aAnimBlocks[FirstAssociation->m_pAnimBlendHierarchy->m_animBlock],
            "parachute") )
  {
    FirstAssociation = RpAnimBlendGetNextAssociation(FirstAssociation);
    if ( !FirstAssociation )
      return 0;
  }
  return 1;
}

//----- (004C07B0) --------------------------------------------------------
void __fastcall CPedIntelligence::SetTaskDuckSecondary(CPedIntelligence *this, uint16 nTime)
{
  CTaskManager *p_m_taskManager; // r5
  CTask *v5; // r0
  CTask *v6; // r0
  CTaskSimpleDuck *v7; // r4
  CTask *TaskSecondary; // r0
  CTaskSimpleUseGun *v9; // r6
  CTask *v10; // r0
  CTask *v11; // r0

  p_m_taskManager = &this->m_taskManager;
  if ( !CTaskManager::GetTaskSecondary(&this->m_taskManager, 1)
    || (v5 = CTaskManager::GetTaskSecondary(p_m_taskManager, 1),
        (*((int (__fastcall **)(CTask *))v5->_vptr$CTask + 5))(v5) != 415)
    || !CTaskManager::GetTaskSecondary(p_m_taskManager, 1)
    || (CTaskManager::GetTaskSecondary(p_m_taskManager, 1),
        v6 = CTaskManager::GetTaskSecondary(p_m_taskManager, 1),
        (*((void (__fastcall **)(CTask *))v6->_vptr$CTask + 5))(v6),
        LOBYTE(CTaskManager::GetTaskSecondary(p_m_taskManager, 1)[4].m_pParent) != 4) )
  {
    v7 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
    CTaskSimpleDuck::CTaskSimpleDuck(v7, 2u, nTime, -1);
    CTaskManager::SetTaskSecondary(p_m_taskManager, v7, 1);
    if ( CTaskManager::GetTaskSecondary(p_m_taskManager, 0) )
    {
      TaskSecondary = CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
      if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) == 1017 )
      {
        if ( CTaskManager::GetTaskSecondary(p_m_taskManager, 0) )
        {
          v9 = 0;
          if ( CTaskManager::GetTaskSecondary(p_m_taskManager, 0) )
          {
            v9 = 0;
            v10 = CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
            if ( (*((int (__fastcall **)(CTask *))v10->_vptr$CTask + 5))(v10) == 1017 )
              v9 = (CTaskSimpleUseGun *)CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
          }
          CTaskSimpleUseGun::ClearAnim(v9, this->m_pPed);
        }
      }
    }
    v11 = CTaskManager::GetTaskSecondary(p_m_taskManager, 1);
    (*((void (__fastcall **)(CTask *, CPed *))v11->_vptr$CTask + 9))(v11, this->m_pPed);
  }
}

//----- (004C08A8) --------------------------------------------------------
void __fastcall CPedIntelligence::ClearTaskDuckSecondary(CPedIntelligence *this)
{
  CTaskManager *p_m_taskManager; // r5
  CTask *TaskSecondary; // r0
  CPlayerPedData *m_pPlayerData; // r1
  CTask *v5; // r0
  CTaskSimpleUseGun *v6; // r6
  CTask *v7; // r0

  p_m_taskManager = &this->m_taskManager;
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 1) )
  {
    TaskSecondary = CTaskManager::GetTaskSecondary(p_m_taskManager, 1);
    (*((void (__fastcall **)(CTask *, CPed *, _DWORD, _DWORD))TaskSecondary->_vptr$CTask + 7))(
      TaskSecondary,
      this->m_pPed,
      0,
      0);
    m_pPlayerData = this->m_pPed->m_pPlayerData;
    if ( m_pPlayerData )
      m_pPlayerData->m_moveBlendRatio = 0.0;
    else
      CPed::SetMoveState(this->m_pPed, PEDMOVE_STILL);
    if ( CTaskManager::GetTaskSecondary(p_m_taskManager, 0) )
    {
      v5 = CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
      if ( (*((int (__fastcall **)(CTask *))v5->_vptr$CTask + 5))(v5) == 1017 )
      {
        if ( CTaskManager::GetTaskSecondary(p_m_taskManager, 0) )
        {
          v6 = 0;
          if ( CTaskManager::GetTaskSecondary(p_m_taskManager, 0) )
          {
            v6 = 0;
            v7 = CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
            if ( (*((int (__fastcall **)(CTask *))v7->_vptr$CTask + 5))(v7) == 1017 )
              v6 = (CTaskSimpleUseGun *)CTaskManager::GetTaskSecondary(p_m_taskManager, 0);
          }
          sub_19D550(v6, this->m_pPed);
        }
      }
    }
  }
}

//----- (004C095C) --------------------------------------------------------
void __fastcall CPedIntelligence::ClearTasks(
        CPedIntelligence *this,
        const bool bClearMainTask,
        const bool bClearSecondaryTask)
{
  _BOOL4 v3; // r5
  bool v5; // zf
  char *v6; // r4
  CEventGroup *p_m_eventGroup; // r6
  int v9; // r0
  int v10; // r6
  CTask *TaskSecondary; // r0
  CTask *v12; // r4
  CEventScriptCommand v13; // [sp+8h] [bp-30h] BYREF

  v3 = bClearSecondaryTask;
  if ( bClearMainTask )
  {
    v5 = *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 == 0;
    if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
      v5 = this->m_pPed->m_pMyVehicle == 0;
    if ( v5 )
    {
      p_m_eventGroup = &this->m_eventGroup;
      if ( CEventGroup::HasScriptCommandOfTaskType(&this->m_eventGroup, 203) )
      {
LABEL_13:
        CEventHandler::HandleEvents(&this->m_eventHandler);
        CTaskManager::ManageTasks(&this->m_taskManager);
        CPedScriptedTaskRecord::Process();
        goto LABEL_14;
      }
      v6 = (char *)CTask::operator new(0x20u);
      CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v6, 0, 0, 0, 8.0);
    }
    else
    {
      p_m_eventGroup = &this->m_eventGroup;
      if ( CEventGroup::HasScriptCommandOfTaskType(&this->m_eventGroup, 709) )
        goto LABEL_13;
      if ( (*((int (__fastcall **)(CTask *))this->m_taskManager.m_tasks[4]->_vptr$CTask + 5))(this->m_taskManager.m_tasks[4]) == 709 )
      {
        v6 = (char *)CTask::operator new(0x70u);
        CTaskSimpleCarDrive::CTaskSimpleCarDrive((CTaskSimpleCarDrive *)v6, this->m_pPed->m_pMyVehicle, 0, 0);
        *(_DWORD *)(v6 + 106) = 0;
        *(_DWORD *)(v6 + 102) = 0;
        *((_DWORD *)v6 + 24) = 0;
        *((_DWORD *)v6 + 25) = 0;
        *(_DWORD *)v6 = &off_66571C;
      }
      else
      {
        v6 = (char *)CTask::operator new(0x60u);
        CTaskSimpleCarDrive::CTaskSimpleCarDrive((CTaskSimpleCarDrive *)v6, this->m_pPed->m_pMyVehicle, 0, 0);
      }
    }
    CEventScriptCommand::CEventScriptCommand(&v13, 3, (CTask *)v6, 0);
    CEventGroup::Add(p_m_eventGroup, &v13, 0);
    CEventScriptCommand::~CEventScriptCommand(&v13);
    goto LABEL_13;
  }
LABEL_14:
  if ( v3 )
  {
    v9 = 0;
    do
    {
      do
      {
        v10 = v9;
        v9 = 4;
      }
      while ( v10 == 3 );
      TaskSecondary = CTaskManager::GetTaskSecondary(&this->m_taskManager, v10);
      v12 = TaskSecondary;
      if ( TaskSecondary )
      {
        if ( (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))TaskSecondary->_vptr$CTask + 7))(
               TaskSecondary,
               this->m_pPed,
               1,
               0) == 1 )
          CTaskManager::SetTaskSecondary(&this->m_taskManager, 0, v10);
        else
          (*((void (__fastcall **)(CTask *, CPed *, _DWORD, _DWORD))v12->_vptr$CTask + 7))(v12, this->m_pPed, 0, 0);
      }
      v9 = v10 + 1;
    }
    while ( v10 != 5 );
  }
}
// 66571C: using guessed type void *;

//----- (004C0AB4) --------------------------------------------------------
void __fastcall CPedIntelligence::FlushImmediately(CPedIntelligence *this, const bool bRestartDefaultTasks)
{
  _BOOL4 v3; // r6
  CTask *v4; // r4
  CTask *v5; // r9
  CTask *TaskSecondary; // r0
  CTask *v7; // r0
  CTask *v8; // r4
  int (**v9)(void); // r0
  int v10; // r8
  int (*v11)(void); // r11
  CTask *v12; // r6
  int v13; // r0
  CTask *v14; // r0
  CTask *v15; // r4
  CTask *v16; // r11
  CPedGroup *PedsGroup; // r4
  int (**v18)(void); // r0
  __int64 v19; // kr00_8
  CTaskSimplePlayerOnFoot *v20; // r4
  CTaskManager *p_m_taskManager; // r0
  CTaskComplexWander *WanderTaskByPedType; // r1
  int v23; // [sp+Ch] [bp-24h]
  _BOOL4 v24; // [sp+10h] [bp-20h]

  v3 = bRestartDefaultTasks;
  v4 = this->m_taskManager.m_tasks[3];
  if ( v4 && (*((int (__fastcall **)(CTask *))v4->_vptr$CTask + 5))(this->m_taskManager.m_tasks[3]) == 243 )
    v5 = (CTask *)(*((int (__fastcall **)(CTask *))v4->_vptr$CTask + 2))(v4);
  else
    v5 = 0;
  v24 = v3;
  if ( !CTaskManager::GetTaskSecondary(&this->m_taskManager, 4)
    || (TaskSecondary = CTaskManager::GetTaskSecondary(&this->m_taskManager, 4),
        (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) != 307)
    || (v7 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 4), (v8 = v7) == 0)
    || (*((int (__fastcall **)(CTask *))v7->_vptr$CTask + 5))(v7) != 307
    || (v9 = v8[1]._vptr$CTask) == 0 )
  {
    v13 = 0;
    v12 = 0;
LABEL_13:
    v10 = -1;
    goto LABEL_14;
  }
  if ( (*((_BYTE *)v9 + 58) & 7) != 4 )
  {
    v12 = (CTask *)(*((int (__fastcall **)(CTask *))v8->_vptr$CTask + 2))(v8);
    v13 = 0;
    goto LABEL_13;
  }
  v10 = *((unsigned __int8 *)v9 + 320);
  v11 = v9[7];
  v12 = (CTask *)(*((int (__fastcall **)(CTask *))v8->_vptr$CTask + 2))(v8);
  v13 = (unsigned __int8)v11 & 0x80;
LABEL_14:
  v23 = v13;
  v14 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 3);
  v15 = v14;
  if ( v14 && (*((int (__fastcall **)(CTask *))v14->_vptr$CTask + 5))(v14) == 305 )
    v16 = (CTask *)(*((int (__fastcall **)(CTask *))v15->_vptr$CTask + 2))(v15);
  else
    v16 = 0;
  CEventGroup::Flush(&this->m_eventGroup, 1);
  CEventHandler::FlushImmediately(&this->m_eventHandler);
  CTaskManager::FlushImmediately(&this->m_taskManager);
  CPedScriptedTaskRecord::Process();
  if ( v5 )
  {
    PedsGroup = CPedGroups::GetPedsGroup(this->m_pPed);
    if ( PedsGroup && !CPed::IsPlayer(this->m_pPed) )
    {
      CPedGroupIntelligence::ComputeDefaultTasks(&PedsGroup->m_intelligence, this->m_pPed);
      CTaskManager::SetTask(&this->m_taskManager, v5, 3, 0);
      if ( !v12 )
        goto LABEL_26;
      goto LABEL_23;
    }
    (*((void (__fastcall **)(CTask *))v5->_vptr$CTask + 1))(v5);
  }
  if ( !v12 )
    goto LABEL_26;
LABEL_23:
  if ( v10 != -1 )
  {
    *((_BYTE *)v12[1]._vptr$CTask + 320) = v10;
    v18 = v12[1]._vptr$CTask;
    v19 = *(_QWORD *)(v18 + 7);
    v18[7] = (int (*)(void))(v19 & 0xFFFFFF7F | v23);
    v18[8] = (int (*)(void))HIDWORD(v19);
  }
  CTaskManager::SetTaskSecondary(&this->m_taskManager, v12, 4);
  (*((void (__fastcall **)(CTask *, CPed *))v12->_vptr$CTask + 9))(v12, this->m_pPed);
LABEL_26:
  if ( v16 )
    CTaskManager::SetTaskSecondary(&this->m_taskManager, v16, 3);
  if ( v24 )
  {
    if ( CPed::IsPlayer(this->m_pPed) )
    {
      v20 = (CTaskSimplePlayerOnFoot *)CTask::operator new(0x34u);
      CTaskSimplePlayerOnFoot::CTaskSimplePlayerOnFoot(v20);
    }
    else
    {
      if ( this->m_pPed->CharCreatedBy != 2 )
      {
        WanderTaskByPedType = CTaskComplexWander::GetWanderTaskByPedType(this->m_pPed);
        p_m_taskManager = &this->m_taskManager;
        goto LABEL_38;
      }
      v20 = (CTaskSimplePlayerOnFoot *)CTask::operator new(0x20u);
      CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v20, 0, 1, 0, 8.0);
    }
    p_m_taskManager = &this->m_taskManager;
    WanderTaskByPedType = (CTaskComplexWander *)v20;
LABEL_38:
    sub_1951C0(p_m_taskManager, WanderTaskByPedType, 4, 0);
  }
}

//----- (004C0CA6) --------------------------------------------------------
C2dEffect *__fastcall CPedIntelligence::GetEffectInUse(const CPedIntelligence *this)
{
  return this->m_eventScanner.m_attractorScanner.m_pPreviousEffect;
}

//----- (004C0CAC) --------------------------------------------------------
void __fastcall CPedIntelligence::SetEffectInUse(CPedIntelligence *this, C2dEffect *pEffect)
{
  this->m_eventScanner.m_attractorScanner.m_pPreviousEffect = pEffect;
}

//----- (004C0CB4) --------------------------------------------------------
void __fastcall CPedIntelligence::ProcessFirst(CPedIntelligence *this)
{
  CPed *m_pPed; // r0
  CEntity *m_pDamageEntity; // r1
  bool v4; // zf
  bool v5; // zf
  int m_pMyVehicle; // r1

  CLoadMonitor::StartTimer(&g_LoadMonitor, ePedAI);
  CPedIntelligence::ProcessStaticCounter(this);
  if ( !CPedStuckChecker::TestPedStuck(&this->m_stuckChecker, this->m_pPed, &this->m_eventGroup) )
    CCollisionEventScanner::ScanForCollisionEvents(&this->m_collisionEventScanner, this->m_pPed, &this->m_eventGroup);
  m_pPed = this->m_pPed;
  if ( this->m_pPed->m_fDamageImpulseMagnitude > 0.0 )
  {
    m_pDamageEntity = m_pPed->m_pDamageEntity;
    v4 = m_pDamageEntity == 0;
    if ( m_pDamageEntity )
      v4 = (*(_BYTE *)&m_pDamageEntity->m_info & 7) == 3;
    if ( !v4
      && (float)((float)((float)(m_pPed->m_vecDamageNormal.x * m_pPed->m_pMat->xy)
                       + (float)(m_pPed->m_vecDamageNormal.y * m_pPed->m_pMat->yy))
               + (float)(m_pPed->m_vecDamageNormal.z * m_pPed->m_pMat->zy)) < -0.5 )
    {
      *((_DWORD *)&m_pPed->m_nPedFlags + 3) |= 0x4000u;
      m_pPed = this->m_pPed;
    }
  }
  m_pMyVehicle = *((unsigned __int8 *)&m_pPed->m_nPedFlags + 1) << 31;
  v5 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = (int)m_pPed->m_pMyVehicle;
    v5 = m_pMyVehicle == 0;
  }
  if ( !v5 && *(_DWORD *)(m_pMyVehicle + 1440) == 9 )
  {
    *(_BYTE *)(m_pMyVehicle + 1992) = 0;
    BYTE1(this->m_pPed->m_pMyVehicle[1].m_VehicleAudioEntity.m_fEventVolume) = 0;
    m_pPed = this->m_pPed;
  }
  *((_DWORD *)&m_pPed->m_nPedFlags + 3) &= ~0x10000u;
  sub_18D9A4(&g_LoadMonitor, ePedAI);
}

//----- (004C0DA8) --------------------------------------------------------
void __fastcall CPedIntelligence::ProcessStaticCounter(CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTask *v3; // r0
  CTask *v4; // r5
  unsigned int v5; // r0
  CPed *m_pPed; // r0
  uint32 m_iNumFramesWithoutCollision; // r1
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v10; // d16
  uint32 v11; // r1
  uint32 v12; // r0
  uint32 v13; // r1
  CMatrix *v14; // r2
  CSimpleTransform *p_m_transform; // r1
  CSimpleTransform *v16; // r3
  float32x2_t v17; // d16
  unsigned __int64 v18; // d1
  CMatrix *v19; // r0
  __int64 v20; // d16

  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  if ( SimplestActiveTask )
  {
    if ( CTask::IsGoToTask(SimplestActiveTask) )
    {
      v3 = CTaskManager::GetSimplestActiveTask(&this->m_pPed->m_pPedIntelligence->m_taskManager);
      v4 = v3;
      if ( v3 )
      {
        if ( CTask::IsGoToTask(v3) )
        {
          v5 = (unsigned int)v4[1]._vptr$CTask;
          if ( v5 <= 7 && ((1 << v5) & 0xD0) != 0 )
          {
            m_pPed = this->m_pPed;
            m_iNumFramesWithoutCollision = this->m_iNumFramesWithoutCollision;
            if ( this->m_pPed->m_pDamageEntity )
            {
              if ( m_iNumFramesWithoutCollision < 5 )
              {
                v11 = 0;
              }
              else
              {
                m_pMat = m_pPed->m_pMat;
                p_tx = (CSimpleTransform *)&m_pMat->tx;
                if ( !m_pMat )
                  p_tx = &m_pPed->m_transform;
                v10 = *(_QWORD *)&p_tx->m_translate.x;
                this->m_vPedPositionAtFirstCollision.z = p_tx->m_translate.z;
                v11 = 0;
                *(_QWORD *)&this->m_vPedPositionAtFirstCollision.x = v10;
              }
            }
            else
            {
              v13 = m_iNumFramesWithoutCollision + 1;
              if ( v13 != -1 )
              {
                this->m_iNumFramesWithoutCollision = v13;
                if ( v13 >= 5 )
                {
                  this->m_iStaticCounter = 0;
                  return;
                }
                goto LABEL_22;
              }
              v11 = 4;
            }
            this->m_iNumFramesWithoutCollision = v11;
LABEL_22:
            v14 = m_pPed->m_pMat;
            p_m_transform = &m_pPed->m_transform;
            v16 = &m_pPed->m_transform;
            if ( v14 )
              v16 = (CSimpleTransform *)&v14->tx;
            v17.n64_u64[0] = vsub_f32(
                               *(float32x2_t *)&v16->m_translate.y,
                               *(float32x2_t *)&this->m_vPedPositionAtFirstCollision.y).n64_u64[0];
            v18 = vmul_f32(v17, v17).n64_u64[0];
            if ( (float)((float)((float)((float)(v16->m_translate.x - this->m_vPedPositionAtFirstCollision.x)
                                       * (float)(v16->m_translate.x - this->m_vPedPositionAtFirstCollision.x))
                               + *(float *)&v18)
                       + *((float *)&v18 + 1)) >= 0.0625 )
            {
              this->m_iStaticCounter = 0;
              v19 = m_pPed->m_pMat;
              if ( v19 )
                p_m_transform = (CSimpleTransform *)&v19->tx;
              v20 = *(_QWORD *)&p_m_transform->m_translate.x;
              this->m_vPedPositionAtFirstCollision.z = p_m_transform->m_translate.z;
              *(_QWORD *)&this->m_vPedPositionAtFirstCollision.x = v20;
            }
            else
            {
              ++this->m_iStaticCounter;
            }
            return;
          }
        }
      }
    }
  }
  v12 = this->m_iNumFramesWithoutCollision + 1;
  if ( this->m_iNumFramesWithoutCollision == -2 )
    v12 = 4;
  this->m_iStaticCounter = 0;
  this->m_iNumFramesWithoutCollision = v12;
}

//----- (004C0EC4) --------------------------------------------------------
void __fastcall CPedIntelligence::Process(CPedIntelligence *this)
{
  CPed *m_pPed; // r5
  CPlayerRelationshipRecorder *PlayerRelationshipRecorder; // r0

  CLoadMonitor::StartTimer(&g_LoadMonitor, ePedAI);
  CVehicleScanner::ScanForVehiclesInRange(&this->m_vehicleScanner, this->m_pPed);
  m_pPed = this->m_pPed;
  if ( CPed::IsAlive(this->m_pPed) )
    CEntityScanner::ScanForEntitiesInRange(&this->m_pedScanner, 1, m_pPed);
  CEventScanner::ScanForEvents(&this->m_eventScanner, this->m_pPed);
  CEventHandler::HandleEvents(&this->m_eventHandler);
  CTaskManager::ManageTasks(&this->m_taskManager);
  PlayerRelationshipRecorder = GetPlayerRelationshipRecorder();
  CPlayerRelationshipRecorder::RecordRelationshipWithPlayer(PlayerRelationshipRecorder, this->m_pPed);
  CPedIntelligence::LookAtInterestingEntities(this);
  sub_18D9A4(&g_LoadMonitor, ePedAI);
}

//----- (004C0F3C) --------------------------------------------------------
void __fastcall CPedIntelligence::LookAtInterestingEntities(CPedIntelligence *this)
{
  CPed *m_pPed; // r1
  CEntity *v3; // r0
  bool v4; // zf
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r0
  int v7; // r0
  CEntity *v8; // r1
  int v9; // r5
  int v10; // r2
  CEntity *v11; // r3
  bool v12; // zf
  float v13; // s18
  unsigned __int16 v14; // r0
  RwV3d_0 v15[2]; // [sp+24h] [bp-1044h] BYREF
  CEntity *v16[1024]; // [sp+3Ch] [bp-102Ch] BYREF
  Int16 pNum[21]; // [sp+103Eh] [bp-2Ah] BYREF

  m_pPed = this->m_pPed;
  if ( (*((_BYTE *)&this->m_pPed->m_nPedFlags + 10) & 0x40) == 0 )
  {
    v3 = this->m_pInterestingEntities[0];
    v4 = v3 == 0;
    if ( !v3 )
      v4 = this->m_pInterestingEntities[1] == 0;
    if ( (!v4 || this->m_pInterestingEntities[2])
      && !IKChainManager_c::IsLooking(&g_ikChainMan, m_pPed)
      && CEntity::GetIsOnScreen(this->m_pPed)
      && (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) == 50 )
    {
      pNum[0] = -1;
      m_pMat = this->m_pPed->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &this->m_pPed->m_transform;
      CWorld::FindObjectsInRange(&p_tx->m_translate, 15.0, 0, pNum, 1024, v16, 0, 1, 1, 1, 0);
      v7 = pNum[0];
      if ( pNum[0] >= 1 )
      {
        v8 = this->m_pInterestingEntities[0];
        v9 = 0;
        v10 = 0;
        do
        {
          v11 = v16[v10];
          v12 = v8 == v11;
          if ( v8 != v11 )
            v12 = this->m_pInterestingEntities[1] == v11;
          if ( v12 || this->m_pInterestingEntities[2] == v11 )
            *((_DWORD *)&v15[1].x + v9++) = v11;
          ++v10;
        }
        while ( v10 < v7 );
        if ( v9 )
        {
          v13 = (float)(unsigned __int16)rand();
          v14 = rand();
          memset(v15, 0, 12);
          IKChainManager_c::LookAt(
            &g_ikChainMan,
            "InterestingEntities",
            this->m_pPed,
            *((CEntity **)&v15[1].x + (int)(float)((float)(v13 * 0.000015259) * (float)v9)),
            (int)(float)((float)((float)v14 * 0.000015259) * 2000.0) + 3000,
            -1,
            v15,
            0,
            0.25,
            500,
            3,
            0);
        }
      }
    }
  }
}
// 4C0F3C: using guessed type Int16 pNum[21];

//----- (004C10F8) --------------------------------------------------------
void __fastcall CPedIntelligence::ProcessAfterProcCol(CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTask *v3; // r6
  CPed *m_pPed; // r2
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  const CMatrix *m_pMat; // r0
  RwMatrix *v8; // r1
  CTask *SimplestTask; // r0
  CTask *v10; // r5
  CPed *v11; // r1
  int v12; // r3
  unsigned int v13; // r6
  int v14; // r5

  CLoadMonitor::StartTimer(&g_LoadMonitor, ePedAI);
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  v3 = SimplestActiveTask;
  if ( SimplestActiveTask )
  {
    if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 4))(SimplestActiveTask) == 1 )
    {
      if ( (*((int (__fastcall **)(CTask *, CPed *))v3->_vptr$CTask + 10))(v3, this->m_pPed)
        || (SimplestTask = CTaskManager::GetSimplestTask(&this->m_taskManager, 4), (v10 = SimplestTask) != 0)
        && (*((int (__fastcall **)(CTask *))SimplestTask->_vptr$CTask + 4))(SimplestTask) == 1
        && (*((int (__fastcall **)(CTask *, CPed *))v10->_vptr$CTask + 10))(v10, this->m_pPed) == 1 )
      {
        m_pPed = this->m_pPed;
        m_pRwObject = this->m_pPed->m_pRwObject;
        if ( m_pRwObject )
        {
          parent = (char *)m_pRwObject->parent;
          m_pMat = m_pPed->m_pMat;
          v8 = (RwMatrix *)(parent + 16);
          if ( m_pMat )
            CMatrix::UpdateRwMatrix(m_pMat, v8);
          else
            CSimpleTransform::UpdateRwMatrix(&m_pPed->m_transform, v8);
        }
        CEntity::UpdateRwFrame(this->m_pPed);
      }
    }
  }
  v11 = this->m_pPed;
  v12 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1);
  v13 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2) & 0xFFFFFBFF;
  v14 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
  *(_DWORD *)&v11->m_nPedFlags = this->m_pPed->m_nPedFlags;
  *((_DWORD *)&v11->m_nPedFlags + 1) = v12;
  *((_DWORD *)&v11->m_nPedFlags + 2) = v13;
  *((_DWORD *)&v11->m_nPedFlags + 3) = v14;
  sub_18D9A4(&g_LoadMonitor, ePedAI);
}

//----- (004C11BC) --------------------------------------------------------
void __fastcall CPedIntelligence::ProcessAfterPreRender(CPedIntelligence *this)
{
  CTask *TaskSecondary; // r0
  CTask *v3; // r0
  CTask *v4; // r0
  CTask *v5; // r0
  CTask *v6; // r0
  CTask *v7; // r0
  CTask *v8; // r0
  CPed *m_pPed; // r1
  char *v10; // r0
  FxSystem_c **v11; // r8
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r5
  RwInt32 v13; // r6
  RwMatrix *MatrixArray; // r0
  RwObject_0 *m_pRwObject; // r0
  __int64 *v16; // r0
  _QWORD *v17; // r2
  __int64 *v18; // r1
  __int64 v19; // d16
  __int64 v20; // d17
  __int64 *v21; // r0
  __int64 v22; // d20
  __int64 v23; // d21
  __int64 v24; // d22
  __int64 v25; // d23
  __int64 v26; // d19
  bool v27; // zf
  CBike *m_pMyVehicle; // r0
  RwMatrix v29; // [sp+0h] [bp-70h] BYREF
  RwV3d_0 pointOut; // [sp+44h] [bp-2Ch] BYREF
  RwV3d_0 pointIn; // [sp+50h] [bp-20h] BYREF

  CLoadMonitor::StartTimer(&g_LoadMonitor, ePedAI);
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 4) )
  {
    TaskSecondary = CTaskManager::GetTaskSecondary(&this->m_taskManager, 4);
    if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 4))(TaskSecondary) == 1 )
    {
      v3 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 4);
      if ( (*((int (__fastcall **)(CTask *, CPed *))v3->_vptr$CTask + 10))(v3, this->m_pPed) == 1 )
      {
        if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 0) )
        {
          v4 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 0);
          if ( (*((int (__fastcall **)(CTask *))v4->_vptr$CTask + 5))(v4) == 307 )
          {
            v5 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 0);
            (*((void (__fastcall **)(CTask *, CPed *))v5->_vptr$CTask + 10))(v5, this->m_pPed);
          }
        }
      }
    }
  }
  if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 0) )
  {
    v6 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 0);
    if ( (*((int (__fastcall **)(CTask *))v6->_vptr$CTask + 5))(v6) == 1017 )
    {
      if ( CTaskManager::GetTaskSecondary(&this->m_taskManager, 0) )
      {
        CTaskManager::GetTaskSecondary(&this->m_taskManager, 0);
        v7 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 0);
        (*((void (__fastcall **)(CTask *))v7->_vptr$CTask + 5))(v7);
        v8 = CTaskManager::GetTaskSecondary(&this->m_taskManager, 0);
        (*((void (__fastcall **)(CTask *, CPed *))v8->_vptr$CTask + 10))(v8, this->m_pPed);
      }
    }
  }
  m_pPed = this->m_pPed;
  v10 = (char *)this->m_pPed + 28 * this->m_pPed->m_nCurrentWeapon;
  if ( *((_DWORD *)v10 + 361) == 18 && *((_DWORD *)v10 + 367) )
  {
    v11 = (FxSystem_c **)(v10 + 1468);
    AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)m_pPed->m_pRwObject);
    v13 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 24);
    MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
    pointIn.z = 0.14;
    *(_QWORD *)&pointIn.x = unk_61DC30;
    RwV3dTransformPoint(&pointOut, &pointIn, &MatrixArray[v13]);
    m_pRwObject = this->m_pPed->m_pRwObject;
    if ( m_pRwObject )
      v16 = (__int64 *)((char *)m_pRwObject->parent + 16);
    else
      v16 = 0;
    v17 = v16 + 6;
    v19 = *v16;
    v20 = v16[1];
    v18 = v16 + 2;
    v21 = v16 + 4;
    v22 = *v21;
    v23 = v21[1];
    v24 = *v18;
    v25 = v18[1];
    v26 = v17[1];
    *(_QWORD *)&v29.right.x = v19;
    *(_QWORD *)&v29.right.z = v20;
    v29.pad3 = HIDWORD(v26);
    *(_QWORD *)&v29.at.x = v22;
    *(_QWORD *)&v29.at.z = v23;
    *(_QWORD *)&v29.up.x = v24;
    *(_QWORD *)&v29.up.z = v25;
    v29.pos = pointOut;
    RwMatrixUpdate(&v29);
    FxSystem_c::SetMatrix(*v11, &v29);
    m_pPed = this->m_pPed;
  }
  m_pMyVehicle = (CBike *)(*((unsigned __int8 *)&m_pPed->m_nPedFlags + 1) << 31);
  v27 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = (CBike *)m_pPed->m_pMyVehicle;
    v27 = m_pMyVehicle == 0;
  }
  if ( !v27 && m_pMyVehicle->m_baseVehicleType == 9 )
    CBike::FixHandsToBars(m_pMyVehicle, m_pPed);
  CLoadMonitor::EndTimer(&g_LoadMonitor, ePedAI);
}

//----- (004C1374) --------------------------------------------------------
void __fastcall CPedIntelligence::ProcessEventHandler(CPedIntelligence *this)
{
  sub_19ED54(&this->m_eventHandler);
}

//----- (004C137A) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsFriendlyWith(const CPedIntelligence *this, const CPed *otherPed)
{
  uint32 Acquaintances; // r9
  char v5; // r4
  uint32 v6; // r8
  uint32 PedFlag; // r0

  Acquaintances = CAcquaintance::GetAcquaintances(&this->m_pPed->m_acquaintances, 0);
  v5 = 1;
  v6 = CAcquaintance::GetAcquaintances(&this->m_pPed->m_acquaintances, 1);
  PedFlag = CPedType::GetPedFlag(otherPed->m_nPedType);
  if ( (PedFlag & Acquaintances) == 0 && this->m_pPed->m_nPedType != otherPed->m_nPedType )
  {
    v5 = PedFlag & v6;
    if ( (PedFlag & v6) != 0 )
      return 1;
  }
  return v5;
}

//----- (004C13D0) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsThreatenedBy(const CPedIntelligence *this, const CPed *otherPed)
{
  uint32 Acquaintances; // r6
  uint32 v5; // r0

  Acquaintances = CAcquaintance::GetAcquaintances(&this->m_pPed->m_acquaintances, 3);
  v5 = CAcquaintance::GetAcquaintances(&this->m_pPed->m_acquaintances, 4);
  return (CPedType::GetPedFlag(otherPed->m_nPedType) & (v5 | Acquaintances)) != 0;
}

//----- (004C1410) --------------------------------------------------------
CVehicle *__fastcall CPedIntelligence::IsInACarOrEnteringOne(CPedIntelligence *this)
{
  CTaskManager *p_m_taskManager; // r4
  CTask *ActiveTaskByType; // r0
  CTask *v4; // r0

  p_m_taskManager = &this->m_taskManager;
  ActiveTaskByType = CTaskManager::FindActiveTaskByType(&this->m_taskManager, 701);
  if ( ActiveTaskByType )
    return (CVehicle *)ActiveTaskByType[1].m_pParent;
  ActiveTaskByType = CTaskManager::FindActiveTaskByType(p_m_taskManager, 700);
  if ( ActiveTaskByType )
    return (CVehicle *)ActiveTaskByType[1].m_pParent;
  v4 = CTaskManager::FindActiveTaskByType(p_m_taskManager, 709);
  if ( v4 )
    return (CVehicle *)v4[1]._vptr$CTask;
  else
    return 0;
}

//----- (004C144A) --------------------------------------------------------
bool __fastcall CPedIntelligence::AreFriends(const CPed *ped1, const CPed *ped2)
{
  CPedIntelligence *m_pPedIntelligence; // r4
  uint32 Acquaintances; // r10
  char v6; // r9
  uint32 v7; // r5
  CPedIntelligence *v8; // r5
  uint32 v9; // r4
  uint32 v10; // r6
  uint32 PedFlag; // r0

  m_pPedIntelligence = ped1->m_pPedIntelligence;
  Acquaintances = CAcquaintance::GetAcquaintances(&m_pPedIntelligence->m_pPed->m_acquaintances, 0);
  v6 = 1;
  v7 = CAcquaintance::GetAcquaintances(&m_pPedIntelligence->m_pPed->m_acquaintances, 1);
  if ( (CPedType::GetPedFlag(ped2->m_nPedType) & (v7 | Acquaintances)) == 0
    && m_pPedIntelligence->m_pPed->m_nPedType != ped2->m_nPedType )
  {
    v8 = ped2->m_pPedIntelligence;
    v9 = CAcquaintance::GetAcquaintances(&v8->m_pPed->m_acquaintances, 0);
    v6 = 1;
    v10 = CAcquaintance::GetAcquaintances(&v8->m_pPed->m_acquaintances, 1);
    PedFlag = CPedType::GetPedFlag(ped1->m_nPedType);
    if ( (PedFlag & v9) == 0 && v8->m_pPed->m_nPedType != ped1->m_nPedType )
    {
      v6 = PedFlag & v10;
      if ( (PedFlag & v10) != 0 )
        return 1;
    }
  }
  return v6;
}

//----- (004C14E8) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsPedGoingSomewhereOnFoot(const CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0

  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  return SimplestActiveTask && CTask::IsGoToTask(SimplestActiveTask) != 0;
}

//----- (004C1508) --------------------------------------------------------
void __fastcall CPedIntelligence::FlushIntelligence(CPedIntelligence *this)
{
  CEntity **m_entities; // r4
  int i; // r6
  CEntity *v4; // r0
  CEntity *m_pClosestEntity; // r0
  CEntity **v6; // r6
  int j; // r4
  CEntity *v8; // r0
  CEntity *v9; // r0
  __int64 v10; // d16
  __int64 v11; // d17

  CTaskManager::Flush(&this->m_taskManager);
  *(_QWORD *)&this->m_eventHandler.m_pTaskPhysResponse = 0LL;
  *(_QWORD *)&this->m_eventHandler.m_pTaskSecondaryAim = 0LL;
  this->m_eventHandler.m_pTaskSecondaryPartialAnim = 0;
  CEventHandlerHistory::ClearAllEvents(&this->m_eventHandler.m_history);
  CEventGroup::Flush(&this->m_eventGroup, 0);
  m_entities = this->m_vehicleScanner.m_entities;
  for ( i = 0; i != 16; ++i )
  {
    v4 = m_entities[i];
    if ( v4 )
    {
      CEntity::CleanUpOldReference(v4, &m_entities[i]);
      m_entities[i] = 0;
    }
  }
  m_pClosestEntity = this->m_vehicleScanner.m_pClosestEntity;
  if ( m_pClosestEntity )
  {
    CEntity::CleanUpOldReference(m_pClosestEntity, &this->m_vehicleScanner.m_pClosestEntity);
    this->m_vehicleScanner.m_pClosestEntity = 0;
  }
  v6 = this->m_pedScanner.m_entities;
  for ( j = 0; j != 16; ++j )
  {
    v8 = v6[j];
    if ( v8 )
    {
      CEntity::CleanUpOldReference(v8, &v6[j]);
      v6[j] = 0;
    }
  }
  v9 = this->m_pedScanner.m_pClosestEntity;
  if ( v9 )
  {
    CEntity::CleanUpOldReference(v9, &this->m_pedScanner.m_pClosestEntity);
    this->m_pedScanner.m_pClosestEntity = 0;
  }
  *(float *)&v10 = 25.0;
  *((float *)&v10 + 1) = 25.0;
  *(float *)&v11 = 25.0;
  *((float *)&v11 + 1) = 25.0;
  *(_QWORD *)this->m_eventScanner.m_attractorScanner.m_entities = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_entities[2] = 0LL;
  *(_QWORD *)this->m_eventScanner.m_attractorScanner.m_minDistanceSquared = v10;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[2] = v11;
  *(_QWORD *)this->m_eventScanner.m_attractorScanner.m_effects = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_effects[2] = 0LL;
  this->m_eventScanner.m_attractorScanner.m_effects[4] = 0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[4] = 15.0 * 15.0;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_effects[5] = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_effects[7] = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_entities[6] = 0LL;
  *(_QWORD *)&this->m_eventScanner.m_attractorScanner.m_entities[8] = 0LL;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[7] = 15.0 * 15.0;
  this->m_eventScanner.m_attractorScanner.m_entities[4] = 0;
  this->m_eventScanner.m_attractorScanner.m_entities[5] = 0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[5] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[6] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_effects[9] = 0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[8] = 25.0;
  this->m_eventScanner.m_attractorScanner.m_minDistanceSquared[9] = 25.0;
}

//----- (004C1610) --------------------------------------------------------
bool __fastcall CPedIntelligence::TestForStealthKill(CPedIntelligence *this, CPed *pTargetPed, bool bAboutToDoKill)
{
  _BOOL4 v5; // r9
  bool v6; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float z; // s0
  float x; // s2
  float y; // s4
  CMatrix *v12; // r3
  CSimpleTransform *p_m_transform; // r1
  float v14; // s2
  float v15; // s4
  float v16; // s0
  CTask *ActiveTask; // r0
  CTask *v18; // r4
  CEvent *CurrentEvent; // r0
  CPedGroup *PedsGroup; // r0
  bool v21; // zf
  uint32 Acquaintances; // r6
  uint32 v23; // r4
  CAcquaintance *p_m_acquaintances; // r4
  uint32 v25; // r5
  uint32 v26; // r4
  RwV3d_0 posn; // [sp+4h] [bp-24h] BYREF

  v5 = bAboutToDoKill;
  v6 = 0;
  if ( !(*((unsigned __int8 *)&pTargetPed->m_nPedFlags + 1) << 31) )
  {
    memset(&posn, 0, sizeof(posn));
    CPed::GetBonePosition(pTargetPed, &posn, 5u, 0);
    if ( (*((_BYTE *)&pTargetPed->m_nPedFlags + 3) & 4) == 0 )
    {
      v6 = 0;
      if ( pTargetPed->m_nHealth >= 1.0 )
      {
        m_pMat = pTargetPed->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pTargetPed->m_transform;
        z = p_tx->m_translate.z;
        if ( posn.z >= z )
        {
          v6 = 1;
          if ( !v5 )
          {
            if ( pTargetPed->m_eMoveState > PEDMOVE_JOG )
              return 0;
            x = p_tx->m_translate.x;
            y = p_tx->m_translate.y;
            v12 = this->m_pPed->m_pMat;
            p_m_transform = (CSimpleTransform *)&v12->tx;
            if ( !v12 )
              p_m_transform = &this->m_pPed->m_transform;
            v14 = x - p_m_transform->m_translate.x;
            v15 = y - p_m_transform->m_translate.y;
            v16 = z - p_m_transform->m_translate.z;
            if ( (float)((float)((float)(v14 * v14) + (float)(v15 * v15)) + (float)(v16 * v16)) > (float)(STEALTH_KILL_RANGE * STEALTH_KILL_RANGE) )
              return 0;
            if ( (float)((float)((float)(v14 * m_pMat->xy) + (float)(v15 * m_pMat->yy)) + (float)(v16 * m_pMat->zy)) <= 0.0 )
              return 0;
            ActiveTask = CTaskManager::GetActiveTask(&pTargetPed->m_pPedIntelligence->m_taskManager);
            v18 = ActiveTask;
            if ( ActiveTask )
            {
              if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 1000
                && v18[2]._vptr$CTask == (int (**)(void))this->m_pPed )
              {
                return 0;
              }
            }
            if ( CEventHandlerHistory::GetCurrentEvent(&pTargetPed->m_pPedIntelligence->m_eventHandler.m_history) )
            {
              CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&pTargetPed->m_pPedIntelligence->m_eventHandler.m_history);
              if ( (CPed *)(*((int (__fastcall **)(CEvent *))CurrentEvent->_vptr$CEvent + 11))(CurrentEvent) == this->m_pPed )
              {
                Acquaintances = CAcquaintance::GetAcquaintances(&pTargetPed->m_acquaintances, 4);
                if ( (CPedType::GetPedFlag(this->m_pPed->m_nPedType) & Acquaintances) != 0 )
                  return 0;
                v23 = CAcquaintance::GetAcquaintances(&pTargetPed->m_acquaintances, 3);
                if ( (CPedType::GetPedFlag(this->m_pPed->m_nPedType) & v23) != 0 )
                  return 0;
              }
            }
            PedsGroup = CPedGroups::GetPedsGroup(pTargetPed);
            v21 = PedsGroup == 0;
            if ( PedsGroup )
            {
              PedsGroup = (CPedGroup *)PedsGroup->m_intelligence.m_pCurrentEvent;
              v21 = PedsGroup == 0;
            }
            if ( !v21
              && (CPed *)((int (__fastcall *)(CPedGroup *))PedsGroup->m_lastPedRespondedTo->m_pLastRenderedLink)(PedsGroup) == this->m_pPed
              && ((p_m_acquaintances = &pTargetPed->m_acquaintances,
                   v25 = CAcquaintance::GetAcquaintances(&pTargetPed->m_acquaintances, 4),
                   (CPedType::GetPedFlag(this->m_pPed->m_nPedType) & v25) != 0)
               || (v26 = CAcquaintance::GetAcquaintances(p_m_acquaintances, 3),
                   (CPedType::GetPedFlag(this->m_pPed->m_nPedType) & v26) != 0)) )
            {
              return 0;
            }
            else
            {
              return 1;
            }
          }
        }
      }
    }
  }
  return v6;
}

//----- (004C1810) --------------------------------------------------------
void __fastcall CPedIntelligence::RecordEventForScript(
        CPedIntelligence *this,
        const int iEventType,
        const int iEventPriority)
{
  if ( iEventType != 32 && (!iEventType || this->m_iHighestPriorityEventPriority < iEventPriority) )
  {
    this->m_iHighestPriorityEventPriority = iEventPriority;
    this->m_iHighestPriorityEventType = iEventType;
  }
}

//----- (004C182A) --------------------------------------------------------
bool8 __fastcall CPedIntelligence::HasInterestingEntites(CPedIntelligence *this)
{
  CEntity *v1; // r1
  bool v2; // zf

  v1 = this->m_pInterestingEntities[0];
  v2 = v1 == 0;
  if ( !v1 )
    v2 = this->m_pInterestingEntities[1] == 0;
  return !v2 || this->m_pInterestingEntities[2] != 0;
}

//----- (004C184A) --------------------------------------------------------
bool8 __fastcall CPedIntelligence::IsInterestingEntity(CPedIntelligence *this, CEntity *pEntity)
{
  CEntity *v2; // r2
  bool v3; // zf

  v2 = this->m_pInterestingEntities[0];
  v3 = v2 == pEntity;
  if ( v2 != pEntity )
    v3 = this->m_pInterestingEntities[1] == pEntity;
  return v3 || this->m_pInterestingEntities[2] == pEntity;
}

//----- (004C186C) --------------------------------------------------------
void __fastcall CPedIntelligence::AddInterestingEntity(CPedIntelligence *this, CEntity *pEntity)
{
  CEntity **v3; // r4
  CEntity *v4; // r0
  CEntity *v6; // r0
  CEntity **v7; // r6
  CEntity *v8; // r0
  CEntity **m_pInterestingEntities; // r5

  v3 = &this->m_pInterestingEntities[2];
  v4 = this->m_pInterestingEntities[2];
  if ( v4 )
    CEntity::CleanUpOldReference(v4, v3);
  v6 = this->m_pInterestingEntities[1];
  v7 = &this->m_pInterestingEntities[1];
  this->m_pInterestingEntities[2] = v6;
  if ( v6 )
  {
    CEntity::RegisterReference(v6, v3);
    if ( *v7 )
      CEntity::CleanUpOldReference(*v7, &this->m_pInterestingEntities[1]);
  }
  v8 = this->m_pInterestingEntities[0];
  this->m_pInterestingEntities[1] = v8;
  m_pInterestingEntities = this->m_pInterestingEntities;
  if ( v8 )
  {
    CEntity::RegisterReference(v8, v7);
    if ( *m_pInterestingEntities )
      CEntity::CleanUpOldReference(*m_pInterestingEntities, m_pInterestingEntities);
  }
  *m_pInterestingEntities = pEntity;
  if ( pEntity )
    sub_196050(pEntity, m_pInterestingEntities);
}

//----- (004C18EA) --------------------------------------------------------
bool8 __fastcall CPedIntelligence::RemoveInterestingEntity(CPedIntelligence *this, CEntity *pEntity)
{
  int v4; // r0
  int v5; // r6
  CEntity **v6; // r5
  CEntity *v7; // r0
  CEntity *v8; // r0
  CEntity **v9; // r4

  if ( this->m_pInterestingEntities[0] == pEntity )
  {
    v4 = 0;
    goto LABEL_8;
  }
  if ( this->m_pInterestingEntities[1] == pEntity )
  {
    v4 = 1;
LABEL_8:
    v5 = v4 - 1;
    v6 = &this->m_pInterestingEntities[v4];
    do
    {
      if ( *v6 )
        CEntity::CleanUpOldReference(*v6, v6);
      v7 = v6[1];
      *v6 = v7;
      if ( v7 )
        CEntity::RegisterReference(v7, v6);
      ++v5;
      ++v6;
    }
    while ( v5 < 1 );
    goto LABEL_14;
  }
  if ( this->m_pInterestingEntities[2] != pEntity )
    return 0;
LABEL_14:
  v8 = this->m_pInterestingEntities[2];
  v9 = &this->m_pInterestingEntities[2];
  if ( v8 )
    CEntity::CleanUpOldReference(v8, v9);
  *v9 = 0;
  return 1;
}

//----- (004C1964) --------------------------------------------------------
void __fastcall CPedIntelligence::RemoveAllInterestingEntities(CPedIntelligence *this)
{
  CEntity *v2; // r0
  CEntity *v3; // r0
  CEntity *v4; // r0
  CEntity **v5; // r4

  v2 = this->m_pInterestingEntities[0];
  if ( v2 )
    CEntity::CleanUpOldReference(v2, this->m_pInterestingEntities);
  this->m_pInterestingEntities[0] = 0;
  v3 = this->m_pInterestingEntities[1];
  if ( v3 )
    CEntity::CleanUpOldReference(v3, &this->m_pInterestingEntities[1]);
  this->m_pInterestingEntities[1] = 0;
  v4 = this->m_pInterestingEntities[2];
  v5 = &this->m_pInterestingEntities[2];
  if ( v4 )
    CEntity::CleanUpOldReference(v4, v5);
  *v5 = 0;
}

//----- (004C19AC) --------------------------------------------------------
bool __fastcall CPedIntelligence::IsPedGoingForCarDoor(CPedIntelligence *this)
{
  CTask *SimplestActiveTask; // r0
  CTask *v2; // r4
  CTask *m_pParent; // r4
  CTask *v4; // r0
  bool result; // r0

  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_taskManager);
  v2 = SimplestActiveTask;
  result = 0;
  if ( SimplestActiveTask )
  {
    if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) == 800 )
      return 1;
    m_pParent = v2->m_pParent;
    if ( m_pParent )
    {
      if ( (*((int (__fastcall **)(CTask *))m_pParent->_vptr$CTask + 5))(m_pParent) == 800 )
        return 1;
      v4 = m_pParent->m_pParent;
      if ( v4 )
      {
        if ( (*((int (__fastcall **)(CTask *))v4->_vptr$CTask + 5))(v4) == 800 )
          return 1;
      }
    }
  }
  return result;
}

//----- (004C19F4) --------------------------------------------------------
void CPedIntelligence::SortAndStaggerAllPedsEventScannerTimers()
{
  CPedPool *v0; // r9
  int32 m_nSize; // r8
  int v2; // r6
  int v3; // r5
  int v4; // r11
  unsigned __int16 v5; // r0
  unsigned __int16 v6; // r0
  unsigned __int16 v7; // r0
  float v8; // s26
  unsigned __int16 v9; // r0
  unsigned __int16 v10; // r0
  float v11; // s0

  v0 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize >= 1 )
  {
    v2 = 0;
    v3 = 1088;
    do
    {
      if ( (v0->m_aFlags[v2] & 0x80u) == 0 && &(*v0->m_aStorage)[v3] != (uint8 *)&elf_hash_bucket[209] )
      {
        v4 = *(_DWORD *)&(*v0->m_aStorage)[v3];
        *(_DWORD *)(v4 + 216) = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 16.0);
        *(_DWORD *)(v4 + 296) = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 16.0);
        v5 = rand();
        *(_DWORD *)(v4 + 404) = CTimer::m_snTimeInMilliseconds;
        *(_BYTE *)(v4 + 412) = 1;
        *(_DWORD *)(v4 + 408) = (int)(float)((float)((float)v5 * 0.000015259) * 500.0);
        v6 = rand();
        *(_DWORD *)(v4 + 416) = CTimer::m_snTimeInMilliseconds;
        *(_BYTE *)(v4 + 424) = 1;
        *(_DWORD *)(v4 + 420) = (int)(float)((float)((float)v6 * 0.000015259) * 500.0);
        v7 = rand();
        *(_DWORD *)(v4 + 432) = CTimer::m_snTimeInMilliseconds;
        *(_BYTE *)(v4 + 440) = 1;
        *(_DWORD *)(v4 + 436) = (int)(float)((float)((float)v7 * 0.000015259) * 1500.0);
        v8 = (float)CPedAcquaintanceScanner::ms_iAcquaintanceScanPeriod;
        v9 = rand();
        *(_DWORD *)(v4 + 572) = CTimer::m_snTimeInMilliseconds;
        *(_BYTE *)(v4 + 580) = 1;
        *(_DWORD *)(v4 + 576) = (int)(float)((float)((float)v9 * 0.000015259) * v8);
        v10 = rand();
        *(_DWORD *)(v4 + 588) = CTimer::m_snTimeInMilliseconds;
        *(_BYTE *)(v4 + 596) = 1;
        *(_DWORD *)(v4 + 592) = (int)(float)((float)((float)v10 * 0.000015259) * 500.0);
        v11 = (float)(unsigned __int16)rand();
        *(_DWORD *)(v4 + 600) = CTimer::m_snTimeInMilliseconds;
        *(_BYTE *)(v4 + 608) = 1;
        *(_DWORD *)(v4 + 604) = (int)(float)((float)(v11 * 0.000015259) * 100.0);
      }
      ++v2;
      v3 += 1996;
    }
    while ( m_nSize != v2 );
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004C1BD0) --------------------------------------------------------
void __fastcall CInterestingEvents::CInterestingEvents(CInterestingEvents *this)
{
  int8x8_t v1; // d20
  char v2; // r3
  UInt32 v3; // r2
  uint32 *m_NextTimeToAcceptEvents; // r8
  uint8 *m_EventPriorities; // r12
  int v6; // r4
  uint16 *m_EventDurations; // lr
  int v8; // r5
  uint8 *v9; // r3
  char v10; // r2
  int v11; // r3
  unsigned __int64 v12; // d19
  unsigned int v13; // d18.s[0]
  char *v14; // r6

  this->m_iLookingAtEvent = -1;
  this->m_iLastScanTime = 0;
  v2 = *((_BYTE *)this + 300) & 0xF0 | 0xE;
  this->m_fEventRadius = 30.0;
  *((_BYTE *)this + 300) = v2;
  v3 = CTimer::m_FrameCounter;
  m_NextTimeToAcceptEvents = this->m_NextTimeToAcceptEvents;
  *(_QWORD *)&this->m_Events[6].m_pEntity = 0LL;
  *(_QWORD *)&this->m_Events[7].m_iStartTime = 0LL;
  m_EventPriorities = this->m_EventPriorities;
  *(_QWORD *)&this->m_Events[5].m_iStartTime = 0LL;
  *(_QWORD *)&this->m_Events[6].m_eType = 0LL;
  v6 = 0;
  *(_QWORD *)&this->m_Events[4].m_eType = 0LL;
  *(_QWORD *)&this->m_Events[4].m_pEntity = 0LL;
  m_EventDurations = this->m_EventDurations;
  v8 = 0;
  *(_QWORD *)&this->m_Events[2].m_pEntity = 0LL;
  *(_QWORD *)&this->m_Events[3].m_iStartTime = 0LL;
  v9 = &this->m_EventPriorities[29];
  this->m_iCurrentFrameCounter = v3 - 1;
  *(_QWORD *)&this->m_Events[0].m_eType = 0LL;
  *(_QWORD *)&this->m_Events[0].m_pEntity = 0LL;
  *(_QWORD *)&this->m_Events[1].m_iStartTime = 0LL;
  *(_QWORD *)&this->m_Events[2].m_eType = 0LL;
  if ( this->m_EventPriorities < (uint8 *)this->m_NextTimeToAcceptEvents )
    v6 = 1;
  v10 = 0;
  if ( v9 > (uint8 *)m_EventDurations )
    v8 = 1;
  if ( v9 > (uint8 *)m_NextTimeToAcceptEvents )
    v10 = 1;
  v11 = 0;
  if ( ((unsigned __int8)v10 & (m_EventPriorities < (uint8 *)this + 300)) == 0 && (v8 & v6) != 1 )
  {
    v12 = vdup_n_s16(0x7D0u).n64_u64[0];
    v11 = 28;
    *(_QWORD *)m_NextTimeToAcceptEvents = 0LL;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[2] = 0LL;
    *(_QWORD *)m_EventDurations = v12;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[4] = 0LL;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[6] = 0LL;
    v13 = (unsigned int)vuzp_s8((int8x8_t)0x5000500050005LL, v1);
    *(_DWORD *)m_EventPriorities = v13;
    *(_QWORD *)&this->m_EventDurations[4] = v12;
    *(_DWORD *)&this->m_EventPriorities[4] = v13;
    *(_DWORD *)&this->m_EventPriorities[8] = v13;
    *(_DWORD *)&this->m_EventPriorities[12] = v13;
    *(_DWORD *)&this->m_EventPriorities[16] = v13;
    *(_DWORD *)&this->m_EventPriorities[20] = v13;
    *(_DWORD *)&this->m_EventPriorities[24] = v13;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[8] = 0LL;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[10] = 0LL;
    *(_QWORD *)&this->m_EventDurations[8] = v12;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[12] = 0LL;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[14] = 0LL;
    *(_QWORD *)&this->m_EventDurations[12] = v12;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[16] = 0LL;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[18] = 0LL;
    *(_QWORD *)&this->m_EventDurations[16] = v12;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[20] = 0LL;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[22] = 0LL;
    *(_QWORD *)&this->m_EventDurations[20] = v12;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[24] = 0LL;
    *(_QWORD *)&this->m_NextTimeToAcceptEvents[26] = 0LL;
    *(_QWORD *)&this->m_EventDurations[24] = v12;
  }
  do
  {
    this->m_NextTimeToAcceptEvents[v11] = 0;
    this->m_EventDurations[v11] = 2000;
    v14 = (char *)this + v11++;
    v14[96] = 5;
  }
  while ( v11 != 29 );
  this->m_EventPriorities[26] = 9;
  *(_WORD *)&this->m_EventPriorities[27] = 2570;
  *(_DWORD *)&this->m_EventPriorities[22] = 151587081;
  *(_WORD *)&this->m_EventPriorities[20] = 2055;
  *(_DWORD *)&this->m_EventPriorities[4] = 33686018;
  *(_DWORD *)&this->m_EventPriorities[8] = 100992004;
  *(_DWORD *)&this->m_EventPriorities[12] = 151324166;
  *(_DWORD *)&this->m_EventPriorities[16] = 101124105;
  this->m_EventPriorities[3] = 1;
  *(_WORD *)&this->m_EventPriorities[1] = 257;
  *(_DWORD *)&this->m_EventDurations[27] = 262148000;
  *(_DWORD *)&this->m_EventDurations[25] = 524294000;
  *(_QWORD *)&this->m_EventDurations[17] = 0x1770138817701770LL;
  *(_QWORD *)&this->m_EventDurations[21] = 1688875630395400000LL;
  *(_QWORD *)&this->m_EventDurations[9] = 0x1F40177017700BB8LL;
  *(_QWORD *)&this->m_EventDurations[13] = 0x1770177017701388LL;
  *(_QWORD *)&this->m_EventDurations[1] = 0xBB8138813881388LL;
  *(_QWORD *)&this->m_EventDurations[5] = 0xBB80BB80BB80BB8LL;
}
// 4C1CAA: variable 'v1' is possibly undefined

//----- (004C1E24) --------------------------------------------------------
void __fastcall CInterestingEvents::~CInterestingEvents(CInterestingEvents *this)
{
  CEntity *m_pEntity; // r0
  CEntity **p_m_pEntity; // r5
  CEntity *v4; // r0
  CEntity *v5; // r0
  CEntity *v6; // r0
  CEntity *v7; // r0
  CEntity *v8; // r0
  CEntity *v9; // r0
  CEntity *v10; // r0

  p_m_pEntity = &this->m_Events[0].m_pEntity;
  m_pEntity = this->m_Events[0].m_pEntity;
  if ( m_pEntity )
  {
    CEntity::CleanUpOldReference(m_pEntity, p_m_pEntity);
    *p_m_pEntity = 0;
  }
  v4 = this->m_Events[1].m_pEntity;
  if ( v4 )
  {
    CEntity::CleanUpOldReference(v4, &this->m_Events[1].m_pEntity);
    this->m_Events[1].m_pEntity = 0;
  }
  v5 = this->m_Events[2].m_pEntity;
  if ( v5 )
  {
    CEntity::CleanUpOldReference(v5, &this->m_Events[2].m_pEntity);
    this->m_Events[2].m_pEntity = 0;
  }
  v6 = this->m_Events[3].m_pEntity;
  if ( v6 )
  {
    CEntity::CleanUpOldReference(v6, &this->m_Events[3].m_pEntity);
    this->m_Events[3].m_pEntity = 0;
  }
  v7 = this->m_Events[4].m_pEntity;
  if ( v7 )
  {
    CEntity::CleanUpOldReference(v7, &this->m_Events[4].m_pEntity);
    this->m_Events[4].m_pEntity = 0;
  }
  v8 = this->m_Events[5].m_pEntity;
  if ( v8 )
  {
    CEntity::CleanUpOldReference(v8, &this->m_Events[5].m_pEntity);
    this->m_Events[5].m_pEntity = 0;
  }
  v9 = this->m_Events[6].m_pEntity;
  if ( v9 )
  {
    CEntity::CleanUpOldReference(v9, &this->m_Events[6].m_pEntity);
    this->m_Events[6].m_pEntity = 0;
  }
  v10 = this->m_Events[7].m_pEntity;
  if ( v10 )
  {
    CEntity::CleanUpOldReference(v10, &this->m_Events[7].m_pEntity);
    this->m_Events[7].m_pEntity = 0;
  }
}

//----- (004C1EC0) --------------------------------------------------------
void __fastcall CInterestingEvents::ScanForNearbyEntities(CInterestingEvents *this)
{
  CPlayerPed *PlayerPed; // r8
  float m_fEventRadius; // s16
  float x; // s20
  float y; // s18
  float *p_x; // r4
  CMatrix *m_pMat; // r0
  float *p_tx; // r3
  float v9; // s2
  float *v10; // r0
  float v11; // s6
  RwReal v12; // s0
  CMatrix *v13; // r0
  __int64 v14; // d16
  CMatrix *v15; // r0
  RwReal v16; // s0
  float v17; // s26
  float v18; // r5
  float v19; // s0
  float v20; // s16
  float v21; // r0
  int v22; // r2
  int v23; // r1
  int v24; // r1
  int v25; // r2
  uint16 v26; // r0
  int v27; // r8
  CPtrNode *m_pHead; // r5
  CPtrNode v29; // kr00_8
  int v30; // r2
  CEntity *m_pVoid; // r2
  int v32; // r0
  CPtrNode *v33; // r5
  CPtrNode v34; // kr08_8
  char v35; // r1
  int v36; // r0
  bool v37; // zf
  bool v38; // cc
  int v39; // [sp+0h] [bp-78h]
  int v40; // [sp+4h] [bp-74h]
  int v41; // [sp+8h] [bp-70h]
  int v42; // [sp+18h] [bp-60h]
  int v43; // [sp+20h] [bp-58h]

  if ( *((unsigned __int8 *)&g_InterestingEvents + 300) << 31
    && CTimer::m_snTimeInMilliseconds - this->m_iLastScanTime >= 0x1F4 )
  {
    this->m_iLastScanTime = CTimer::m_snTimeInMilliseconds;
    PlayerPed = FindPlayerPed(-1);
    if ( this->m_iCurrentFrameCounter == CTimer::m_FrameCounter )
    {
      m_fEventRadius = this->m_fEventRadius;
      x = this->m_ScanOrigin.x;
      y = this->m_ScanOrigin.y;
    }
    else
    {
      p_x = &PlayerPed->m_transform.m_translate.x;
      this->m_iCurrentFrameCounter = CTimer::m_FrameCounter;
      m_pMat = PlayerPed->m_pMat;
      p_tx = &PlayerPed->m_transform.m_translate.x;
      if ( m_pMat )
        p_tx = &m_pMat->tx;
      v9 = p_tx[1];
      v10 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
      v11 = v10[186];
      v12 = *p_tx - v10[185];
      this->m_ViewVec.z = 0.0;
      this->m_ViewVec.x = v12;
      this->m_ViewVec.y = v9 - v11;
      if ( CVector::NormaliseAndMag(&this->m_ViewVec) == 0.0 )
      {
        v13 = PlayerPed->m_pMat;
        v14 = *(_QWORD *)&v13->xy;
        this->m_ViewVec.z = v13->zy;
        *(_QWORD *)&this->m_ViewVec.x = v14;
      }
      m_fEventRadius = this->m_fEventRadius;
      v15 = PlayerPed->m_pMat;
      if ( v15 )
        p_x = &v15->tx;
      x = (float)(m_fEventRadius * this->m_ViewVec.x) + *p_x;
      y = (float)(m_fEventRadius * this->m_ViewVec.y) + p_x[1];
      v16 = (float)(m_fEventRadius * this->m_ViewVec.z) + p_x[2];
      this->m_ScanOrigin.x = x;
      this->m_ScanOrigin.y = y;
      this->m_ScanOrigin.z = v16;
    }
    v17 = floorf((float)((float)(x - m_fEventRadius) / 50.0) + 60.0);
    v18 = floorf((float)((float)(y - m_fEventRadius) / 50.0) + 60.0);
    v19 = y + m_fEventRadius;
    v20 = floorf((float)((float)(x + m_fEventRadius) / 50.0) + 60.0);
    v21 = floorf((float)(v19 / 50.0) + 60.0);
    v22 = 119;
    v23 = (int)v21;
    if ( (int)v21 >= 119 )
      v23 = 119;
    v39 = v23;
    if ( (int)v20 < 119 )
      v22 = (int)v20;
    v24 = (int)v18;
    v43 = v22;
    v25 = 0;
    if ( (int)v18 <= 0 )
      v24 = 0;
    v41 = v24;
    if ( (int)v17 > 0 )
      v25 = (int)v17;
    v40 = v25;
    if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
    {
      CWorld::ClearScanCodes();
      v26 = 1;
    }
    else
    {
      v26 = CWorld::ms_nCurrentScanCode + 1;
    }
    CWorld::ms_nCurrentScanCode = v26;
    PlayerPed->m_nScanCode = v26;
    if ( v41 <= v39 )
    {
      do
      {
        if ( v40 <= v43 )
        {
          v27 = v40;
          v42 = (unsigned __int8)(16 * v41);
          do
          {
            m_pHead = CWorld::ms_aRepeatSectors[v27 & 0xF | v42].m_ptrListArray[1].m_pHead;
            while ( m_pHead )
            {
              v29 = *m_pHead;
              m_pHead = m_pHead->m_pNext;
              if ( *((unsigned __int16 *)v29.m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
              {
                v30 = *((_DWORD *)v29.m_pVoid + 275);
                *((_WORD *)v29.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
                if ( v30 != 55 )
                {
                  m_pVoid = (CEntity *)v29.m_pVoid;
                  if ( *((unsigned __int8 *)v29.m_pVoid + 1157) << 31 )
                  {
                    m_pVoid = (CEntity *)*((_DWORD *)v29.m_pVoid + 356);
                    if ( !m_pVoid )
                      m_pVoid = (CEntity *)v29.m_pVoid;
                  }
                  v32 = *((_DWORD *)v29.m_pVoid + 359);
                  switch ( v32 )
                  {
                    case 6:
                      CInterestingEvents::Add(&g_InterestingEvents, ECopNearby, m_pVoid);
                      break;
                    case 22:
                      CInterestingEvents::Add(&g_InterestingEvents, EProzzyNearby, m_pVoid);
                      break;
                    case 20:
                      CInterestingEvents::Add(&g_InterestingEvents, ECriminalNearby, m_pVoid);
                      break;
                    default:
                      if ( (unsigned int)(v32 - 7) <= 9 )
                        CInterestingEvents::Add(&g_InterestingEvents, EGangMemberNearby, m_pVoid);
                      break;
                  }
                }
              }
            }
            v33 = CWorld::ms_aRepeatSectors[v27 & 0xF | v42].m_ptrListArray[0].m_pHead;
            while ( v33 )
            {
              v34 = *v33;
              v33 = v33->m_pNext;
              if ( *((unsigned __int16 *)v34.m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
              {
                v35 = *((_BYTE *)v34.m_pVoid + 71);
                *((_WORD *)v34.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
                if ( (v35 & 0x20) == 0 )
                {
                  if ( *((_DWORD *)v34.m_pVoid + 281) )
                  {
                    v36 = *((unsigned __int8 *)v34.m_pVoid + 957);
                    v37 = v36 == 0;
                    if ( *((_BYTE *)v34.m_pVoid + 957) )
                      v37 = v36 == 6;
                    if ( !v37 )
                      CInterestingEvents::Add(&g_InterestingEvents, EMadDriver, (CEntity *)v34.m_pVoid);
                  }
                }
              }
            }
            v38 = v27++ < v43;
          }
          while ( v38 );
        }
        v38 = v41++ < v39;
      }
      while ( v38 );
    }
  }
}

//----- (004C2254) --------------------------------------------------------
const TInterestingEvent *__fastcall CInterestingEvents::GetInterestingEvent(CInterestingEvents *this)
{
  unsigned int v2; // r8
  int m_iLookingAtEvent; // r0
  const TInterestingEvent *result; // r0
  uint32 *p_m_iStartTime; // r6
  int v6; // r10
  int v7; // r5
  int v8; // r11
  int v9; // r0
  int v10; // r0

  v2 = CTimer::m_snTimeInMilliseconds;
  if ( (*((_BYTE *)this + 300) & 4) == 0
    || (m_iLookingAtEvent = this->m_iLookingAtEvent, m_iLookingAtEvent == -1)
    || (result = &this->m_Events[m_iLookingAtEvent], !result->m_pEntity)
    || CTimer::m_snTimeInMilliseconds >= this->m_EventDurations[result->m_eType] + result->m_iStartTime )
  {
    p_m_iStartTime = &this->m_Events[0].m_iStartTime;
    v6 = -1;
    v7 = 0;
    v8 = 0;
    while ( 1 )
    {
      if ( !p_m_iStartTime[1] )
        goto LABEL_12;
      v9 = *(p_m_iStartTime - 1);
      if ( v2 >= *p_m_iStartTime + this->m_EventDurations[v9] )
        goto LABEL_12;
      v10 = this->m_EventPriorities[v9];
      if ( v8 < v10 )
        goto LABEL_11;
      if ( (rand() & 0xFF80u) <= 0x7F )
        break;
LABEL_12:
      ++v7;
      p_m_iStartTime += 3;
      if ( v7 == 8 )
      {
        this->m_iLookingAtEvent = v6;
        result = &this->m_Events[v6];
        if ( v6 == -1 )
          return 0;
        return result;
      }
    }
    v10 = this->m_EventPriorities[*(p_m_iStartTime - 1)];
LABEL_11:
    v8 = v10;
    v6 = v7;
    goto LABEL_12;
  }
  return result;
}

//----- (004C230C) --------------------------------------------------------
void __fastcall CInterestingEvents::InvalidateEvent(CInterestingEvents *this, const TInterestingEvent *pInvalidEvent)
{
  int v3; // r6
  TInterestingEvent *v4; // r5
  CEntity *v5; // r0
  CEntity **p_m_pEntity; // r5
  CEntity *m_pEntity; // t1

  if ( this == (CInterestingEvents *)pInvalidEvent )
  {
    v3 = 0;
  }
  else if ( &this->m_Events[1] == pInvalidEvent )
  {
    v3 = 1;
  }
  else if ( &this->m_Events[2] == pInvalidEvent )
  {
    v3 = 2;
  }
  else if ( &this->m_Events[3] == pInvalidEvent )
  {
    v3 = 3;
  }
  else if ( &this->m_Events[4] == pInvalidEvent )
  {
    v3 = 4;
  }
  else if ( &this->m_Events[5] == pInvalidEvent )
  {
    v3 = 5;
  }
  else if ( &this->m_Events[6] == pInvalidEvent )
  {
    v3 = 6;
  }
  else
  {
    if ( &this->m_Events[7] != pInvalidEvent )
      return;
    v3 = 7;
  }
  v4 = &this->m_Events[v3];
  m_pEntity = v4->m_pEntity;
  p_m_pEntity = &v4->m_pEntity;
  v5 = m_pEntity;
  *(p_m_pEntity - 1) = 0;
  if ( m_pEntity )
  {
    CEntity::CleanUpOldReference(v5, p_m_pEntity);
    *p_m_pEntity = 0;
  }
  if ( v3 == this->m_iLookingAtEvent )
    this->m_iLookingAtEvent = -1;
}

//----- (004C23A4) --------------------------------------------------------
void __fastcall CInterestingEvents::InvalidateNonVisibleEvents(CInterestingEvents *this)
{
  CEntity **p_m_pEntity; // r5
  int v3; // r4
  char *v4; // r0
  __int64 v5; // d16
  CEntity *v6; // r0
  CMatrix *m_pMat; // r2
  const CVector *p_tx; // r1
  CEntity *v9; // r0
  CVector vecStart; // [sp+18h] [bp-28h] BYREF

  p_m_pEntity = &this->m_Events[0].m_pEntity;
  v3 = 0;
  v4 = (char *)&TheCamera + 528 * TheCamera.ActiveCam;
  v5 = *(_QWORD *)(v4 + 740);
  vecStart.z = *((RwReal *)v4 + 187);
  *(_QWORD *)&vecStart.x = v5;
  do
  {
    v6 = *p_m_pEntity;
    if ( *p_m_pEntity )
    {
      m_pMat = v6->m_pMat;
      p_tx = (const CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v6->m_transform.m_translate;
      if ( !CWorld::GetIsLineOfSightClear(&vecStart, p_tx, 1, 0, 0, 0, 0, 1, 0) )
      {
        v9 = *p_m_pEntity;
        *(p_m_pEntity - 1) = 0;
        if ( v9 )
          CEntity::CleanUpOldReference(v9, p_m_pEntity);
        *p_m_pEntity = 0;
        if ( v3 == this->m_iLookingAtEvent )
          this->m_iLookingAtEvent = -1;
      }
    }
    ++v3;
    p_m_pEntity += 3;
  }
  while ( v3 != 8 );
}

//----- (004C2440) --------------------------------------------------------
void *__fastcall CPedIntelligence::operator new(size_t nSize)
{
  int v1; // lr
  CPedIntelligencePool *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pPedIntelligencePool;
  result = (void *)CPools::ms_pPedIntelligencePool->m_nFreeIndex;
  m_nSize = (void *)CPools::ms_pPedIntelligencePool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (004C24A4) --------------------------------------------------------
void *__fastcall CPedIntelligence::operator new(size_t nSize, int32 index)
{
  int32 v2; // r4
  CPedIntelligencePool *v3; // r2
  __int64 v4; // kr00_8
  int32 v5; // r0
  uint8 *m_aFlags; // r1
  int v7; // r3

  v2 = index >> 8;
  v3 = CPools::ms_pPedIntelligencePool;
  v4 = *(_QWORD *)&CPools::ms_pPedIntelligencePool->m_aStorage;
  CPools::ms_pPedIntelligencePool->m_aFlags[v2] &= ~0x80u;
  v3->m_aFlags[v2] = v3->m_aFlags[index >> 8] & 0x80 | index & 0x7F;
  v5 = 0;
  m_aFlags = v3->m_aFlags;
  do
  {
    v3->m_nFreeIndex = v5;
    v7 = (char)m_aFlags[v5++];
  }
  while ( v7 > -1 );
  return (void *)(v4 + 664 * v2);
}

//----- (004C24F8) --------------------------------------------------------
void __fastcall CPedIntelligence::operator delete(void *pVoid)
{
  CPedIntelligencePool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pPedIntelligencePool;
  v2 = 724452315 * ((signed int)((int)pVoid - (unsigned int)CPools::ms_pPedIntelligencePool->m_aStorage) >> 3);
  CPools::ms_pPedIntelligencePool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (004C2528) --------------------------------------------------------
void __fastcall CPedIntelligence::operator delete(void *pVoid, int32 index)
{
  CPedIntelligencePool *v2; // r1
  int v3; // r0

  v2 = CPools::ms_pPedIntelligencePool;
  v3 = 724452315 * ((signed int)((int)pVoid - (unsigned int)CPools::ms_pPedIntelligencePool->m_aStorage) >> 3);
  CPools::ms_pPedIntelligencePool->m_aFlags[v3] |= 0x80u;
  if ( v3 < v2->m_nFreeIndex )
    v2->m_nFreeIndex = v3;
}

//----- (004C2558) --------------------------------------------------------
void __fastcall CEventScriptedAttractor::~CEventScriptedAttractor(CEventScriptedAttractor *this)
{
  void *v1; // r0

  CEventAttractor::~CEventAttractor(this);
  sub_1978E4(v1);
}
// 4C2564: variable 'v1' is possibly undefined

//----- (004C2568) --------------------------------------------------------
int __fastcall CEventScriptedAttractor::GetEventType(const CEventScriptedAttractor *this)
{
  return 48;
}

//----- (004C256C) --------------------------------------------------------
CEvent *__fastcall CEventScriptedAttractor::CloneEditable(const CEventScriptedAttractor *this)
{
  CEventAttractor *v2; // r0
  CEvent *result; // r0

  v2 = (CEventAttractor *)CEvent::operator new(0x1Cu);
  CEventAttractor::CEventAttractor(v2, this->m_pEffect, this->m_pEntity, 0);
  result->_vptr$CEvent = (int (**)(void))&off_66907C;
  return result;
}
// 4C258A: variable 'result' is possibly undefined
// 66907C: using guessed type void *off_66907C;

//----- (004C2594) --------------------------------------------------------
void __fastcall CEventAcquaintancePedRespect::~CEventAcquaintancePedRespect(CEventAcquaintancePedRespect *this)
{
  void *v1; // r0

  CEventAcquaintancePed::~CEventAcquaintancePed(this);
  sub_1978E4(v1);
}
// 4C25A0: variable 'v1' is possibly undefined

//----- (004C25A4) --------------------------------------------------------
int __fastcall CEventAcquaintancePedRespect::GetEventType(const CEventAcquaintancePedRespect *this)
{
  return 39;
}

//----- (004C25A8) --------------------------------------------------------
int __fastcall CEventAcquaintancePedRespect::GetEventPriority(const CEventAcquaintancePedRespect *this)
{
  return 23;
}

//----- (004C25AC) --------------------------------------------------------
CEvent *__fastcall CEventAcquaintancePedRespect::CloneEditable(const CEventAcquaintancePedRespect *this)
{
  CEventAcquaintancePed *v2; // r0
  CEvent *result; // r0

  v2 = (CEventAcquaintancePed *)CEvent::operator new(0x14u);
  CEventAcquaintancePed::CEventAcquaintancePed(v2, this->m_pAcquaintancePed);
  result->_vptr$CEvent = (int (**)(void))&off_6690D8;
  return result;
}
// 4C25C6: variable 'result' is possibly undefined
// 6690D8: using guessed type void *;
// 676A4C: using guessed type void *`vtable for'CEventAcquaintancePedRespect;

//----- (004C25D0) --------------------------------------------------------
void __fastcall CEventAcquaintancePedLike::~CEventAcquaintancePedLike(CEventAcquaintancePedLike *this)
{
  void *v1; // r0

  CEventAcquaintancePed::~CEventAcquaintancePed(this);
  sub_1978E4(v1);
}
// 4C25DC: variable 'v1' is possibly undefined

//----- (004C25E0) --------------------------------------------------------
int __fastcall CEventAcquaintancePedLike::GetEventType(const CEventAcquaintancePedLike *this)
{
  return 38;
}

//----- (004C25E4) --------------------------------------------------------
int __fastcall CEventAcquaintancePedLike::GetEventPriority(const CEventAcquaintancePedLike *this)
{
  return 22;
}

//----- (004C25E8) --------------------------------------------------------
CEvent *__fastcall CEventAcquaintancePedLike::CloneEditable(const CEventAcquaintancePedLike *this)
{
  CEventAcquaintancePed *v2; // r0
  CEvent *result; // r0

  v2 = (CEventAcquaintancePed *)CEvent::operator new(0x14u);
  CEventAcquaintancePed::CEventAcquaintancePed(v2, this->m_pAcquaintancePed);
  result->_vptr$CEvent = (int (**)(void))&off_669128;
  return result;
}
// 4C2602: variable 'result' is possibly undefined
// 669128: using guessed type void *;
// 677584: using guessed type void *`vtable for'CEventAcquaintancePedLike;

//----- (004C260C) --------------------------------------------------------
void __fastcall CEventAcquaintancePedDislike::~CEventAcquaintancePedDislike(CEventAcquaintancePedDislike *this)
{
  void *v1; // r0

  CEventAcquaintancePed::~CEventAcquaintancePed(this);
  sub_1978E4(v1);
}
// 4C2618: variable 'v1' is possibly undefined

//----- (004C261C) --------------------------------------------------------
int __fastcall CEventAcquaintancePedDislike::GetEventType(const CEventAcquaintancePedDislike *this)
{
  return 37;
}

//----- (004C2620) --------------------------------------------------------
int __fastcall CEventAcquaintancePedDislike::GetEventPriority(const CEventAcquaintancePedDislike *this)
{
  return 24;
}

//----- (004C2624) --------------------------------------------------------
CEvent *__fastcall CEventAcquaintancePedDislike::CloneEditable(const CEventAcquaintancePedDislike *this)
{
  CEventAcquaintancePed *v2; // r0
  CEvent *result; // r0

  v2 = (CEventAcquaintancePed *)CEvent::operator new(0x14u);
  CEventAcquaintancePed::CEventAcquaintancePed(v2, this->m_pAcquaintancePed);
  result->_vptr$CEvent = (int (**)(void))&off_669178;
  return result;
}
// 4C263E: variable 'result' is possibly undefined
// 669178: using guessed type void *;
// 676FA8: using guessed type void *`vtable for'CEventAcquaintancePedDislike;

//----- (004C2648) --------------------------------------------------------
CDecision *__fastcall CDecision::operator=(CDecision *this, const CDecision *src)
{
  *this = *src;
  return this;
}

//----- (004C2762) --------------------------------------------------------
void __fastcall CEventPlayerCollisionWithPed::~CEventPlayerCollisionWithPed(CEventPlayerCollisionWithPed *this)
{
  void *v1; // r0

  CEventPedCollisionWithPed::~CEventPedCollisionWithPed(this);
  sub_1978E4(v1);
}
// 4C276E: variable 'v1' is possibly undefined

//----- (004C2772) --------------------------------------------------------
int __fastcall CEventPlayerCollisionWithPed::GetEventType(const CEventPlayerCollisionWithPed *this)
{
  return 4;
}

//----- (004C2778) --------------------------------------------------------
CEvent *__fastcall CEventPlayerCollisionWithPed::Clone(const CEventPlayerCollisionWithPed *this)
{
  CEventPedCollisionWithPed *v2; // r0
  CEvent *result; // r0

  v2 = (CEventPedCollisionWithPed *)CEvent::operator new(0x30u);
  CEventPedCollisionWithPed::CEventPedCollisionWithPed(
    v2,
    this->m_iPieceType,
    this->m_fImpulseMagnitude,
    this->m_pOtherPed,
    &this->m_vNormal,
    &this->m_vPos,
    this->m_iPedMoveState,
    this->m_iOtherPedMoveState);
  result->_vptr$CEvent = (int (**)(void))&off_6691C8;
  return result;
}
// 4C27AA: variable 'result' is possibly undefined
// 6691C8: using guessed type void *off_6691C8;

//----- (004C27B4) --------------------------------------------------------
void __fastcall CEventPedCollisionWithPlayer::~CEventPedCollisionWithPlayer(CEventPedCollisionWithPlayer *this)
{
  void *v1; // r0

  CEventPedCollisionWithPed::~CEventPedCollisionWithPed(this);
  sub_1978E4(v1);
}
// 4C27C0: variable 'v1' is possibly undefined

//----- (004C27C4) --------------------------------------------------------
int __fastcall CEventPedCollisionWithPlayer::GetEventType(const CEventPedCollisionWithPlayer *this)
{
  return 3;
}

//----- (004C27C8) --------------------------------------------------------
CEvent *__fastcall CEventPedCollisionWithPlayer::Clone(const CEventPedCollisionWithPlayer *this)
{
  CEventPedCollisionWithPed *v2; // r0
  CEvent *result; // r0

  v2 = (CEventPedCollisionWithPed *)CEvent::operator new(0x30u);
  CEventPedCollisionWithPed::CEventPedCollisionWithPed(
    v2,
    this->m_iPieceType,
    this->m_fImpulseMagnitude,
    this->m_pOtherPed,
    &this->m_vNormal,
    &this->m_vPos,
    this->m_iPedMoveState,
    this->m_iOtherPedMoveState);
  result->_vptr$CEvent = (int (**)(void))&off_669214;
  return result;
}
// 4C27FA: variable 'result' is possibly undefined
// 669214: using guessed type void *off_669214;

//----- (004C2804) --------------------------------------------------------
int __fastcall CPedPlacement::IsPositionClearForPed(
        const CVector *vPos,
        float fRange,
        int MaxNum,
        CEntity **pKindaCollidingObjects,
        int considerVehicles,
        int considerPeds,
        int considerObjects)
{
  float v7; // s2
  int v8; // r8
  Int16 pNum[9]; // [sp+1Eh] [bp-12h] BYREF

  v7 = fRange;
  v8 = 0;
  if ( fRange == -1.0 )
    v7 = 0.75;
  if ( MaxNum == -1 )
    LOWORD(MaxNum) = 2;
  CWorld::FindObjectsKindaColliding(
    vPos,
    v7,
    1,
    pNum,
    (__int16)MaxNum,
    pKindaCollidingObjects,
    0,
    considerVehicles != 0,
    considerPeds != 0,
    considerObjects != 0,
    0);
  if ( !pNum[0] )
    return 1;
  return v8;
}
// 4C2804: using guessed type _DWORD considerPeds;
// 4C2804: using guessed type Int16 pNum[9];

//----- (004C2880) --------------------------------------------------------
CEntity *__fastcall CPedPlacement::IsPositionClearOfCars(const CVector *pCoors)
{
  return CWorld::TestSphereAgainstWorld(*pCoors, 0.25, 0, 0, 1, 0, 0, 0, 0);
}

//----- (004C28B0) --------------------------------------------------------
CEntity *__fastcall CPedPlacement::IsPositionClearOfCars(const CPed *pPed)
{
  CEntity *v2; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2
  CEntity *v5; // r0
  CEntity *v6; // r4
  const CMatrix *v7; // r2
  CColModel *m_pColModel; // r3
  CColModel *v9; // r1
  CMatrix *v10; // r0

  v2 = 0;
  m_pMat = pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  v5 = CWorld::TestSphereAgainstWorld(p_tx->m_translate, 0.25, 0, 0, 1, 0, 0, 0, 0);
  v6 = v5;
  if ( v5 )
  {
    if ( LODWORD(v5[24].m_transform.m_translate.x) )
    {
      v7 = v5->m_pMat;
      m_pColModel = CModelInfo::ms_modelInfoPtrs[v5->m_nModelIndex]->m_pColModel;
      v9 = CModelInfo::ms_modelInfoPtrs[pPed->m_nModelIndex]->m_pColModel;
      v10 = pPed->m_pMat;
    }
    else
    {
      if ( (v5[17].m_nScanCode & 0x400) == 0 )
        return v6;
      v7 = v5->m_pMat;
      m_pColModel = CModelInfo::ms_modelInfoPtrs[v5->m_nModelIndex]->m_pColModel;
      v9 = CModelInfo::ms_modelInfoPtrs[pPed->m_nModelIndex]->m_pColModel;
      v10 = pPed->m_pMat;
    }
    if ( !CCollision::ProcessColModels(v10, v9, v7, m_pColModel, aTempPedColPts, 0, 0, 0) )
      return 0;
    return v6;
  }
  return v2;
}

//----- (004C296C) --------------------------------------------------------
bool __fastcall CPedPlacement::FindZCoorForPed(CVector *pCoors)
{
  float32x2_t v1; // d8
  float z; // s4
  RwReal v4; // s0
  bool v5; // r5
  _BOOL4 v6; // r11
  RwReal v7; // s18
  _BOOL4 v8; // r0
  float32x2_t v9; // d1
  float v10; // s0
  CVector vecStart; // [sp+1Ch] [bp-6Ch] BYREF
  CEntity *refEntityPtr; // [sp+28h] [bp-60h] BYREF
  CColPoint colPoint; // [sp+2Ch] [bp-5Ch] BYREF

  v1.n64_u32[0] = -1027080192;
  z = pCoors->z;
  v4 = pCoors->x + 0.0;
  v5 = 0;
  vecStart.y = pCoors->y + 0.0;
  vecStart.x = v4;
  vecStart.z = z + 0.5;
  v6 = CWorld::ProcessVerticalLine(&vecStart, z + -100.0, &colPoint, &refEntityPtr, 1, 1, 0, 0, 1, 0, 0);
  v7 = colPoint.m_vecPosition.z;
  vecStart.x = vecStart.x + 0.1;
  vecStart.y = vecStart.y + 0.1;
  v8 = CWorld::ProcessVerticalLine(&vecStart, pCoors->z + -100.0, &colPoint, &refEntityPtr, 1, 1, 0, 0, 1, 0, 0);
  v9.n64_u64[0] = v1.n64_u64[0];
  if ( v6 )
    v9.n64_f32[0] = v7;
  if ( v8 )
    v1.n64_u32[0] = LODWORD(colPoint.m_vecPosition.z);
  v10 = vmax_f32(v9, v1).n64_f32[0];
  if ( v10 > -99.0 )
  {
    pCoors->z = v10 + 1.0;
    return 1;
  }
  return v5;
}
// 4C2A2C: variable 'v1' is possibly undefined

//----- (004C2A80) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::CPedScriptedTaskRecordData(CPedScriptedTaskRecordData *this)
{
  this->m_iCommandType = -1;
  this->m_pEvent = 0;
  this->m_pTask = 0;
  this->m_pPed = 0;
  this->m_iStage = 3;
}

//----- (004C2A94) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::Flush(CPedScriptedTaskRecordData *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  this->m_iCommandType = -1;
  this->m_pEvent = 0;
  this->m_pTask = 0;
  this->m_pPed = 0;
  this->m_iStage = 3;
}

//----- (004C2ABC) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::Set(
        CPedScriptedTaskRecordData *this,
        CPed *pPed,
        const int iCommandType,
        const CEventScriptCommand *pEvent)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r6

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  this->m_iCommandType = -1;
  this->m_pEvent = 0;
  this->m_pTask = 0;
  this->m_pPed = pPed;
  this->m_iStage = 3;
  CEntity::RegisterReference(pPed, p_m_pPed);
  this->m_iCommandType = iCommandType;
  this->m_pEvent = pEvent;
  this->m_pTask = 0;
  this->m_iStage = 0;
}

//----- (004C2B04) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::Set(
        CPedScriptedTaskRecordData *this,
        CPed *pPed,
        const int iCommandType,
        const CTask *pTask)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r6

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  this->m_iCommandType = -1;
  this->m_pEvent = 0;
  this->m_pTask = 0;
  this->m_pPed = pPed;
  this->m_iStage = 3;
  CEntity::RegisterReference(pPed, p_m_pPed);
  this->m_iCommandType = iCommandType;
  this->m_pEvent = 0;
  this->m_pTask = pTask;
  this->m_iStage = 1;
}

//----- (004C2B52) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::SetAsAttractorScriptTask(
        CPedScriptedTaskRecordData *this,
        CPed *pPed,
        const int iCommandType,
        const CTask *pTask)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r6

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  this->m_iCommandType = -1;
  this->m_pEvent = 0;
  this->m_pTask = 0;
  this->m_pPed = pPed;
  this->m_iStage = 3;
  CEntity::RegisterReference(pPed, p_m_pPed);
  this->m_iCommandType = iCommandType;
  this->m_pEvent = 0;
  this->m_pTask = pTask;
  this->m_iStage = 5;
}

//----- (004C2BA0) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::SetAsGroupTask(
        CPedScriptedTaskRecordData *this,
        CPed *pPed,
        const int iCommandType,
        const CTask *pTask)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r6

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  this->m_iCommandType = -1;
  this->m_pEvent = 0;
  this->m_pTask = 0;
  this->m_pPed = pPed;
  this->m_iStage = 3;
  CEntity::RegisterReference(pPed, p_m_pPed);
  this->m_iCommandType = iCommandType;
  this->m_pEvent = 0;
  this->m_pTask = pTask;
  this->m_iStage = 4;
}

//----- (004C2BEE) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::AssociateWithEvent(
        CPedScriptedTaskRecordData *this,
        CEventScriptCommand *p)
{
  this->m_iStage = 0;
  this->m_pEvent = p;
}

//----- (004C2BF6) --------------------------------------------------------
void __fastcall CPedScriptedTaskRecordData::AssociateWithTask(CPedScriptedTaskRecordData *this, CTask *p)
{
  this->m_pEvent = 0;
  this->m_pTask = p;
  this->m_iStage = 1;
}

//----- (004C2C04) --------------------------------------------------------
int CPedScriptedTaskRecord::GetVacantSlot()
{
  const CTask **p_m_pTask; // r1
  int v1; // r0
  int v3; // r2
  bool v4; // zf

  p_m_pTask = &CPedScriptedTaskRecord::ms_scriptedTasks[0].m_pTask;
  v1 = -1;
  while ( 1 )
  {
    v3 = (int)*(p_m_pTask - 1);
    v4 = v3 == 0;
    if ( !v3 )
      v4 = *p_m_pTask == 0;
    if ( v4 && !p_m_pTask[1] )
      break;
    ++v1;
    p_m_pTask += 5;
    if ( v1 >= 127 )
      return -1;
  }
  return v1 + 1;
}

//----- (004C2C40) --------------------------------------------------------
CPedScriptedTaskRecordData *__fastcall CPedScriptedTaskRecord::GetRecordAssociatedWithEvent(CEventScriptCommand *p)
{
  int v2; // r2
  CPedScriptedTaskRecordData *result; // r0

  v2 = -1;
  for ( result = CPedScriptedTaskRecord::ms_scriptedTasks; result->m_pEvent != p; ++result )
  {
    if ( ++v2 >= 127 )
      return 0;
  }
  return result;
}

//----- (004C2C64) --------------------------------------------------------
CPedScriptedTaskRecordData *__fastcall CPedScriptedTaskRecord::GetRecordAssociatedWithTask(CTask *p)
{
  int v2; // r2
  CPedScriptedTaskRecordData *result; // r0

  v2 = -1;
  for ( result = CPedScriptedTaskRecord::ms_scriptedTasks; result->m_pTask != p; ++result )
  {
    if ( ++v2 >= 127 )
      return 0;
  }
  return result;
}

//----- (004C2C88) --------------------------------------------------------
void CPedScriptedTaskRecord::Process()
{
  int i; // r9
  CPedScriptedTaskRecordData *v1; // r11
  CPedScriptedTaskRecordData *v2; // r4
  int m_iStage; // r1
  CEntity *v4; // r0
  CPedGroup *PedsGroup; // r0
  CEntity *v6; // r0
  CPedIntelligence *m_pPedIntelligence; // r4
  CTask *ActiveTask; // r0
  const CTask *m_pTask; // r1
  const CTask *v10; // r0
  CPedIntelligence *v11; // r2
  bool v12; // zf
  CPedScriptedTaskRecordData *v13; // r4
  CEntity *v14; // r0
  CPedScriptedTaskRecordData *v15; // r8
  const CEventScriptCommand *m_pEvent; // r1
  CPedScriptedTaskRecordData *v17; // r10
  CPed *m_pPed; // r0
  const CEventGroup *p_m_eventGroup; // r0
  CEntity *v20; // r0
  CPedScriptedTaskRecordData *v21; // r0
  CTaskManager *p_m_taskManager; // [sp+Ch] [bp-54h]
  CPedScriptedTaskRecordData *v23; // [sp+1Ch] [bp-44h]

  for ( i = 0; i != 128; ++i )
  {
    v15 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
    m_pEvent = CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pEvent;
    if ( m_pEvent
      || CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pTask
      || CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pPed )
    {
      v17 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
      m_pPed = CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pPed;
      if ( m_pPed )
      {
        if ( m_pEvent )
        {
          p_m_eventGroup = &m_pPed->m_pPedIntelligence->m_eventGroup;
          v13 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
          CPedScriptedTaskRecord::ms_scriptedTasks[i].m_iStage = 0;
          if ( CEventGroup::HasEvent(p_m_eventGroup, m_pEvent) )
            continue;
          v20 = v17->m_pPed;
          if ( v20 )
            CEntity::CleanUpOldReference(v20, &CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pPed);
          v17->m_pPed = 0;
          v15->m_pEvent = 0;
          CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pTask = 0;
          goto LABEL_38;
        }
        v1 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
        if ( !CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pTask )
          continue;
        v2 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
        m_iStage = CPedScriptedTaskRecord::ms_scriptedTasks[i].m_iStage;
        if ( m_iStage != 4 )
        {
          if ( m_iStage == 5 )
          {
            if ( CScriptedBrainTaskStore::GetTask(m_pPed) == v1->m_pTask )
              continue;
            v4 = v17->m_pPed;
            if ( v4 )
              CEntity::CleanUpOldReference(v4, &CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pPed);
            v17->m_pPed = 0;
            v15->m_pEvent = 0;
            v1->m_pTask = 0;
            v2->m_iStage = 3;
            goto LABEL_39;
          }
          v23 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
          m_pPedIntelligence = m_pPed->m_pPedIntelligence;
          p_m_taskManager = &m_pPedIntelligence->m_taskManager;
          ActiveTask = CTaskManager::GetActiveTask(&m_pPedIntelligence->m_taskManager);
          m_pTask = v1->m_pTask;
          if ( ActiveTask == m_pTask )
          {
            v23->m_iStage = 1;
            continue;
          }
          v10 = m_pPedIntelligence->m_taskManager.m_tasks[0];
          v11 = m_pPedIntelligence;
          if ( !v10 )
          {
            v10 = m_pPedIntelligence->m_taskManager.m_tasks[1];
            if ( !v10 )
              v10 = m_pPedIntelligence->m_taskManager.m_tasks[2];
          }
          v12 = v10 == m_pTask;
          v13 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
          if ( v10 != m_pTask )
            v12 = v11->m_taskManager.m_tasks[3] == m_pTask;
          if ( v12 || v11->m_taskManager.m_tasks[4] == m_pTask )
          {
            v23->m_iStage = 2;
            continue;
          }
          if ( CTaskManager::HasTaskSecondary(p_m_taskManager, m_pTask) )
          {
            v23->m_iStage = 6;
            continue;
          }
          v14 = v17->m_pPed;
          if ( v14 )
            CEntity::CleanUpOldReference(v14, &CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pPed);
          v17->m_pPed = 0;
          v15->m_pEvent = 0;
          v1->m_pTask = 0;
LABEL_38:
          v13->m_iStage = 3;
LABEL_39:
          CPedScriptedTaskRecord::ms_scriptedTasks[i].m_iCommandType = -1;
          continue;
        }
        PedsGroup = CPedGroups::GetPedsGroup(m_pPed);
        if ( !PedsGroup
          || CPedGroupIntelligence::GetTaskScriptCommand(&PedsGroup->m_intelligence, v17->m_pPed) != v1->m_pTask )
        {
          v6 = v17->m_pPed;
          if ( v6 )
            CEntity::CleanUpOldReference(v6, &CPedScriptedTaskRecord::ms_scriptedTasks[i].m_pPed);
          v17->m_pPed = 0;
          v15->m_pEvent = 0;
          v1->m_pTask = 0;
          v2->m_iStage = 3;
          goto LABEL_39;
        }
      }
      else
      {
        v17->m_pPed = 0;
        v15->m_pEvent = 0;
        CPedScriptedTaskRecord::ms_scriptedTasks[i].m_iCommandType = -1;
        v21 = &CPedScriptedTaskRecord::ms_scriptedTasks[i];
        v21->m_iStage = 3;
        v21->m_pTask = 0;
      }
    }
  }
}

//----- (004C2F00) --------------------------------------------------------
int __fastcall CPedScriptedTaskRecord::GetStatus(const CPed *pPed, const int iCommandType)
{
  int v2; // r12
  int *i; // r2
  bool v5; // zf

  v2 = -1;
  for ( i = &CPedScriptedTaskRecord::ms_scriptedTasks[0].m_iStage; ; i += 5 )
  {
    v5 = iCommandType == -1;
    if ( iCommandType != -1 )
      v5 = *(i - 4) == iCommandType;
    if ( v5 && (const CPed *)*(i - 1) == pPed )
      break;
    if ( ++v2 >= 127 )
      return -1;
  }
  return *i;
}

//----- (004C2F40) --------------------------------------------------------
int __fastcall CPedScriptedTaskRecord::GetStatus(const CPed *pPed)
{
  char v1; // r12
  int v2; // r3
  CPed **p_m_pPed; // r2

  v1 = 0;
  v2 = -1;
  p_m_pPed = &CPedScriptedTaskRecord::ms_scriptedTasks[0].m_pPed;
  do
  {
    v1 |= *p_m_pPed == pPed;
    if ( *p_m_pPed == pPed )
      break;
    ++v2;
    p_m_pPed += 5;
  }
  while ( v2 <= 126 );
  return v1 & 1;
}

//----- (004C2F78) --------------------------------------------------------
void CPedType::Initialise()
{
  int v0; // r0

  v0 = operator new[](0x288u);
  *(_DWORD *)v0 = 20;
  *(_DWORD *)(v0 + 4) = 32;
  CPedType::ms_apPedTypes = (CPedType *)(v0 + 8);
  memset((void *)(v0 + 8), 0, 0x280u);
  CPedType::LoadPedData();
}

//----- (004C2FA8) --------------------------------------------------------
void CPedType::LoadPedData()
{
  u_native v0; // r4
  char *Line; // r9
  int v2; // r6
  int v3; // r0
  bool v4; // zf
  bool v5; // cc
  uint32 v6; // r4
  char *v7; // r6
  int v8; // r5
  uint32 v9; // r4
  char *v10; // r6
  int v11; // r5
  uint32 v12; // r4
  char *v13; // r6
  int v14; // r5
  uint32 v15; // r4
  char *v16; // r6
  int v17; // r5
  u_native v18; // [sp+14h] [bp-4Ch]
  int v19; // [sp+18h] [bp-48h]
  int v20; // [sp+18h] [bp-48h]
  int v21; // [sp+18h] [bp-48h]
  int v22; // [sp+18h] [bp-48h]
  char v23[32]; // [sp+20h] [bp-40h] BYREF

  v0 = CFileMgr::OpenFile("DATA\\PED.DAT", "r");
  Line = (char *)CFileLoader::LoadLine(v0);
  if ( Line )
  {
    v2 = 32;
    v18 = v0;
    do
    {
      v3 = (unsigned __int8)*Line;
      v4 = v3 == 0;
      if ( *Line )
        v4 = v3 == 35;
      if ( !v4 )
      {
        sscanf(Line, "%s", v23);
        if ( !strcmp(v23, "Hate") )
        {
          v19 = v2;
          strtok(Line, (const char *)&off_4C3340);
          v6 = 0;
          v7 = strtok(0, (const char *)&off_4C3340);
          if ( v7 )
          {
            v6 = 0;
            do
            {
              v8 = 0;
              while ( strcmp(v7, (const char *)aPedTypeNames[v8]) )
              {
                v5 = v8++ < 31;
                if ( !v5 )
                {
                  if ( !strcmp(v7, "PLAYER_NETWORK") )
                  {
                    v8 = 2;
                  }
                  else
                  {
                    v8 = 32;
                    if ( !strcmp(v7, "PLAYER_UNUSED") )
                      v8 = 3;
                  }
                  break;
                }
              }
              if ( v8 < 32 )
                v6 |= 1 << v8;
              v7 = strtok(0, (const char *)&off_4C3340);
            }
            while ( v7 );
          }
          v2 = v19;
          CPedType::ms_apPedTypes[v19].m_acquaintances.m_nAcquaintances[4] = v6;
        }
        else if ( !strcmp(v23, "Dislike") )
        {
          v20 = v2;
          strtok(Line, (const char *)&off_4C3340);
          v9 = 0;
          v10 = strtok(0, (const char *)&off_4C3340);
          if ( v10 )
          {
            v9 = 0;
            do
            {
              v11 = 0;
              while ( strcmp(v10, (const char *)aPedTypeNames[v11]) )
              {
                v5 = v11++ < 31;
                if ( !v5 )
                {
                  if ( !strcmp(v10, "PLAYER_NETWORK") )
                  {
                    v11 = 2;
                  }
                  else
                  {
                    v11 = 32;
                    if ( !strcmp(v10, "PLAYER_UNUSED") )
                      v11 = 3;
                  }
                  break;
                }
              }
              if ( v11 < 32 )
                v9 |= 1 << v11;
              v10 = strtok(0, (const char *)&off_4C3340);
            }
            while ( v10 );
          }
          v2 = v20;
          CPedType::ms_apPedTypes[v20].m_acquaintances.m_nAcquaintances[3] = v9;
        }
        else if ( !strcmp(v23, "Like") )
        {
          v21 = v2;
          strtok(Line, (const char *)&off_4C3340);
          v12 = 0;
          v13 = strtok(0, (const char *)&off_4C3340);
          if ( v13 )
          {
            v12 = 0;
            do
            {
              v14 = 0;
              while ( strcmp(v13, (const char *)aPedTypeNames[v14]) )
              {
                v5 = v14++ < 31;
                if ( !v5 )
                {
                  if ( !strcmp(v13, "PLAYER_NETWORK") )
                  {
                    v14 = 2;
                  }
                  else
                  {
                    v14 = 32;
                    if ( !strcmp(v13, "PLAYER_UNUSED") )
                      v14 = 3;
                  }
                  break;
                }
              }
              if ( v14 < 32 )
                v12 |= 1 << v14;
              v13 = strtok(0, (const char *)&off_4C3340);
            }
            while ( v13 );
          }
          v2 = v21;
          CPedType::ms_apPedTypes[v21].m_acquaintances.m_nAcquaintances[1] = v12;
        }
        else
        {
          if ( strcmp(v23, "Respect") )
          {
            v2 = 0;
            while ( strcmp(v23, (const char *)aPedTypeNames[v2]) )
            {
              v5 = v2++ < 31;
              if ( !v5 )
              {
                if ( !strcmp(v23, "PLAYER_NETWORK") )
                {
                  v2 = 2;
                }
                else
                {
                  v2 = 32;
                  if ( !strcmp(v23, "PLAYER_UNUSED") )
                    v2 = 3;
                }
                goto LABEL_76;
              }
            }
            goto LABEL_76;
          }
          v22 = v2;
          strtok(Line, (const char *)&off_4C3340);
          v15 = 0;
          v16 = strtok(0, (const char *)&off_4C3340);
          if ( v16 )
          {
            v15 = 0;
            do
            {
              v17 = 0;
              while ( strcmp(v16, (const char *)aPedTypeNames[v17]) )
              {
                v5 = v17++ < 31;
                if ( !v5 )
                {
                  if ( !strcmp(v16, "PLAYER_NETWORK") )
                  {
                    v17 = 2;
                  }
                  else
                  {
                    v17 = 32;
                    if ( !strcmp(v16, "PLAYER_UNUSED") )
                      v17 = 3;
                  }
                  break;
                }
              }
              if ( v17 < 32 )
                v15 |= 1 << v17;
              v16 = strtok(0, (const char *)&off_4C3340);
            }
            while ( v16 );
          }
          v2 = v22;
          CPedType::ms_apPedTypes[v22].m_acquaintances.m_nAcquaintances[0] = v15;
        }
        v0 = v18;
      }
LABEL_76:
      Line = (char *)CFileLoader::LoadLine(v0);
    }
    while ( Line );
  }
  CFileMgr::CloseFile(v0);
}
// 4C3340: using guessed type void *off_4C3340;

//----- (004C3390) --------------------------------------------------------
void CPedType::Shutdown()
{
  if ( CPedType::ms_apPedTypes )
    sub_18E8E0(&CPedType::ms_apPedTypes[-1].m_acquaintances.m_nAcquaintances[3]);
}

//----- (004C33A8) --------------------------------------------------------
void __fastcall CAcquaintance::SetAcquaintances(CAcquaintance *this, int32 AcquaintanceType, uint32 acquaintances)
{
  this->m_nAcquaintances[AcquaintanceType] = acquaintances;
}

//----- (004C33B0) --------------------------------------------------------
ePedType __fastcall CPedType::FindPedType(unsigned __int8 *pString)
{
  ePedType v2; // r5

  v2 = PEDTYPE_PLAYER1;
  while ( strcmp((const char *)pString, (const char *)aPedTypeNames[v2]) )
  {
    if ( v2++ >= PEDTYPE_MISSION8 )
    {
      if ( !strcmp((const char *)pString, "PLAYER_NETWORK") )
        return 2;
      v2 = PEDTYPE_LAST_PEDTYPE;
      if ( !strcmp((const char *)pString, "PLAYER_UNUSED") )
        return 3;
      return v2;
    }
  }
  return v2;
}

//----- (004C340C) --------------------------------------------------------
uint32 __fastcall CPedType::GetPedFlag(int32 nPedType)
{
  uint32 v1; // r1

  v1 = 0;
  if ( nPedType < 32 )
    return 1 << nPedType;
  return v1;
}

//----- (004C341C) --------------------------------------------------------
void CPedStats::Shutdown()
{
  if ( CPedStats::ms_apPedStats )
    sub_18E8E0(CPedStats::ms_apPedStats);
}

//----- (004C3434) --------------------------------------------------------
CPedStats *__fastcall CPedStats::GetPedStatInfo(unsigned __int8 *pString)
{
  int v2; // r6
  CPedStats *i; // r4

  v2 = 0;
  for ( i = CPedStats::ms_apPedStats; strcmp((const char *)i->m_sPedStatName, (const char *)pString); ++i )
  {
    if ( (unsigned int)++v2 > 0x2A )
      return 0;
  }
  return i;
}

//----- (004C3468) --------------------------------------------------------
ePedStats __fastcall CPedStats::GetPedStatType(unsigned __int8 *pString)
{
  ePedStats v2; // r4
  unsigned __int8 *i; // r6

  v2 = PEDSTAT_PLAYER;
  for ( i = CPedStats::ms_apPedStats->m_sPedStatName; strcmp((const char *)i, (const char *)pString); i += 52 )
  {
    if ( (unsigned int)++v2 > PEDSTAT_COWARD )
      return 16;
  }
  return v2;
}

//----- (004C34A0) --------------------------------------------------------
Int32 __fastcall CPedStats::FindIndexWithPedStat(CPedStats *pTestPointer)
{
  int v1; // r1
  Int32 result; // r0

  v1 = (char *)pTestPointer - (char *)CPedStats::ms_apPedStats + 52;
  result = -1;
  while ( 1 )
  {
    ++result;
    v1 -= 52;
    if ( !v1 )
      break;
    if ( result >= 42 )
      return 0;
  }
  return result;
}

//----- (004C34C8) --------------------------------------------------------
uint32 __fastcall CAcquaintance::GetAcquaintances(const CAcquaintance *this, int32 AcquaintanceType)
{
  return this->m_nAcquaintances[AcquaintanceType];
}

//----- (004C34CE) --------------------------------------------------------
void __fastcall CAcquaintance::SetAsAcquaintance(
        CAcquaintance *this,
        int32 AcquaintanceType,
        uint32 AcquaintancePedTypeFlag)
{
  uint32 v3; // r3
  uint32 v4; // r12
  uint32 v5; // r3
  uint32 v6; // r3
  uint32 v7; // r3
  uint32 v8; // r1

  v3 = this->m_nAcquaintances[AcquaintanceType];
  if ( (v3 & AcquaintancePedTypeFlag) == 0 )
  {
    v4 = ~AcquaintancePedTypeFlag;
    this->m_nAcquaintances[AcquaintanceType] = v3 | AcquaintancePedTypeFlag;
    if ( AcquaintanceType )
    {
      if ( (this->m_nAcquaintances[0] & AcquaintancePedTypeFlag) != 0 )
        this->m_nAcquaintances[0] &= v4;
      if ( AcquaintanceType == 1 )
        goto LABEL_11;
    }
    v5 = this->m_nAcquaintances[1];
    if ( (v5 & AcquaintancePedTypeFlag) != 0 )
      this->m_nAcquaintances[1] = v5 & v4;
    if ( AcquaintanceType != 2 )
    {
LABEL_11:
      v6 = this->m_nAcquaintances[2];
      if ( (v6 & AcquaintancePedTypeFlag) != 0 )
        this->m_nAcquaintances[2] = v6 & v4;
      if ( AcquaintanceType == 3 )
        goto LABEL_15;
    }
    v7 = this->m_nAcquaintances[3];
    if ( (v7 & AcquaintancePedTypeFlag) != 0 )
      this->m_nAcquaintances[3] = v7 & v4;
    if ( AcquaintanceType != 4 )
    {
LABEL_15:
      v8 = this->m_nAcquaintances[4];
      if ( (v8 & AcquaintancePedTypeFlag) != 0 )
        this->m_nAcquaintances[4] = v8 & v4;
    }
  }
}

//----- (004C3536) --------------------------------------------------------
void __fastcall CAcquaintance::ClearAsAcquaintance(
        CAcquaintance *this,
        int32 AcquaintanceType,
        uint32 AcquaintancePedTypeFlag)
{
  uint32 v3; // r3

  v3 = this->m_nAcquaintances[AcquaintanceType];
  if ( (v3 & AcquaintancePedTypeFlag) != 0 )
    this->m_nAcquaintances[AcquaintanceType] = v3 & ~AcquaintancePedTypeFlag;
}

//----- (004C3548) --------------------------------------------------------
void __fastcall CAcquaintance::ClearAcquaintances(CAcquaintance *this, int32 AcquaintanceType)
{
  this->m_nAcquaintances[AcquaintanceType] = 0;
}

//----- (004C3550) --------------------------------------------------------
const CAcquaintance *__fastcall CPedType::GetPedTypeAcquaintances(int32 PedType)
{
  return &CPedType::ms_apPedTypes[PedType].m_acquaintances;
}

//----- (004C3568) --------------------------------------------------------
uint32 __fastcall CPedType::GetPedTypeAcquaintances(int32 AcquaintanceType, int32 PedType)
{
  return CPedType::ms_apPedTypes[PedType].m_acquaintances.m_nAcquaintances[AcquaintanceType];
}

//----- (004C3584) --------------------------------------------------------
void __fastcall CPedType::SetPedTypeAsAcquaintance(
        int32 AcquaintanceType,
        int32 PedType,
        uint32 AcquaintancePedTypeFlag)
{
  unsigned int v3; // r1
  CPedType *v4; // r4
  CPedType *v5; // lr
  uint32 v6; // r3
  uint32 v7; // r12
  uint32 v8; // r1
  uint32 v9; // r3
  uint32 v10; // r3
  uint32 v11; // r3
  uint32 v12; // r0
  uint32 *v13; // lr
  uint32 v14; // t1

  v3 = PedType;
  v4 = CPedType::ms_apPedTypes;
  v5 = &CPedType::ms_apPedTypes[v3];
  v6 = v5->m_acquaintances.m_nAcquaintances[AcquaintanceType];
  if ( (v6 & AcquaintancePedTypeFlag) == 0 )
  {
    v5->m_acquaintances.m_nAcquaintances[AcquaintanceType] = v6 | AcquaintancePedTypeFlag;
    v7 = ~AcquaintancePedTypeFlag;
    if ( AcquaintanceType )
    {
      v8 = v4[v3].m_acquaintances.m_nAcquaintances[0];
      if ( (v8 & AcquaintancePedTypeFlag) != 0 )
        v5->m_acquaintances.m_nAcquaintances[0] = v8 & v7;
      if ( AcquaintanceType == 1 )
        goto LABEL_11;
    }
    v9 = v5->m_acquaintances.m_nAcquaintances[1];
    if ( (v9 & AcquaintancePedTypeFlag) != 0 )
      v5->m_acquaintances.m_nAcquaintances[1] = v9 & v7;
    if ( AcquaintanceType != 2 )
    {
LABEL_11:
      v10 = v5->m_acquaintances.m_nAcquaintances[2];
      if ( (v10 & AcquaintancePedTypeFlag) != 0 )
        v5->m_acquaintances.m_nAcquaintances[2] = v10 & v7;
      if ( AcquaintanceType == 3 )
        goto LABEL_15;
    }
    v11 = v5->m_acquaintances.m_nAcquaintances[3];
    if ( (v11 & AcquaintancePedTypeFlag) != 0 )
      v5->m_acquaintances.m_nAcquaintances[3] = v11 & v7;
    if ( AcquaintanceType != 4 )
    {
LABEL_15:
      v14 = v5->m_acquaintances.m_nAcquaintances[4];
      v13 = &v5->m_acquaintances.m_nAcquaintances[4];
      v12 = v14;
      if ( (v14 & AcquaintancePedTypeFlag) != 0 )
        *v13 = v12 & v7;
    }
  }
}

//----- (004C361C) --------------------------------------------------------
void __fastcall CPedType::ClearPedTypeAsAcquaintance(
        int32 AcquaintanceType,
        int32 PedType,
        uint32 AcquaintancePedTypeFlag)
{
  CPedType *v3; // r3
  uint32 v4; // r1

  v3 = &CPedType::ms_apPedTypes[PedType];
  v4 = v3->m_acquaintances.m_nAcquaintances[AcquaintanceType];
  if ( (v4 & AcquaintancePedTypeFlag) != 0 )
    v3->m_acquaintances.m_nAcquaintances[AcquaintanceType] = v4 & ~AcquaintancePedTypeFlag;
}

//----- (004C3644) --------------------------------------------------------
void __fastcall CPedType::ClearPedTypeAcquaintances(int32 AcquaintanceType, int32 PedType)
{
  CPedType::ms_apPedTypes[PedType].m_acquaintances.m_nAcquaintances[AcquaintanceType] = 0;
}

//----- (004C3660) --------------------------------------------------------
bool __fastcall CPedType::PoliceDontCareAboutCrimesAgainstPedType(Int32 PedType)
{
  bool v1; // zf
  char v2; // r2
  unsigned int v3; // r0

  v1 = PedType == 20;
  v2 = 0;
  v3 = PedType - 7;
  if ( v1 )
    v2 = 1;
  return v2 | (v3 < 0xB);
}

//----- (004C367C) --------------------------------------------------------
void __fastcall CPlayerPed::CPlayerPed(CPlayerPed *this, int32 nPlayerInfoIndex, bool bForReplay)
{
  _BOOL4 v4; // r5
  CPlayerPedData *p_PlayerPedData; // r0
  float FatAndMuscleModifier; // r0
  CPedIntelligence *m_pPedIntelligence; // r0

  v4 = bForReplay;
  CPed::CPed(this, 0);
  this->_vptr$CPlaceable = (int (**)(void))&off_669278;
  p_PlayerPedData = &CWorld::Players[nPlayerInfoIndex].PlayerPedData;
  this->m_pPlayerData = p_PlayerPedData;
  CPlayerPedData::AllocateData(p_PlayerPedData);
  (*((void (__fastcall **)(CPlayerPed *, _DWORD))this->_vptr$CPlaceable + 6))(this, 0);
  CPlayerPed::SetInitialState(this, v4);
  CPed::SetWeaponLockOnTarget(this, 0);
  CPed::SetPedState(this, PED_IDLE);
  CAnimManager::GetAnimationBlockIndex("playidles");
  if ( !v4 )
  {
    this->m_pPlayerData->m_PlayerGroup = CPedGroups::AddGroup();
    CPedGroupIntelligence::SetDefaultTaskAllocatorType(
      &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_intelligence,
      5);
    CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_iGroupCreatedBy = 1;
    CPedGroupMembership::SetLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership, this);
    CPedGroup::Process(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup]);
    *((_WORD *)this->m_pPlayerData + 26) &= ~0x100u;
    *((_WORD *)this->m_pPlayerData + 26) &= ~0x200u;
    *((_WORD *)this->m_pPlayerData + 26) &= ~0x400u;
  }
  FatAndMuscleModifier = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_MAX_HEALTH);
  this->m_nHealth = FatAndMuscleModifier;
  this->m_nMaxHealth = FatAndMuscleModifier;
  *(_WORD *)&this->m_nExtraMeleeCombo = 3855;
  this->m_pMouseLockOnRecruitPed = 0;
  this->m_iMouseLockOnRecruitTimer = 0;
  CAEPedSpeechAudioEntity::Initialise(&this->m_PedSpeechAudioEntity, this);
  m_pPedIntelligence = this->m_pPedIntelligence;
  m_pPedIntelligence->m_iMaxNumFriendsToInform = 2;
  m_pPedIntelligence->m_fMaxInformFriendDistance = 30.0;
}
// 669278: using guessed type void *;

//----- (004C37B4) --------------------------------------------------------
void __fastcall CPlayerPed::SetInitialState(CPlayerPed *this, bool bReplay)
{
  _BOOL4 v2; // r8
  CEntity::CFlags *p_m_nFlags; // r9
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r1
  CFire *m_pFire; // r0
  CPedFlags *p_m_nPedFlags; // r5
  int v8; // r1
  CPedIntelligence *m_pPedIntelligence; // r10
  CTaskSimplePlayerOnFoot *v10; // r6
  CPlayerPedData *m_pPlayerData; // r0
  CEntity::CFlags v12; // r0
  CPedIntelligence *v13; // r5
  CTaskComplexFacial *v14; // r6
  CPlayerPedData *v15; // r0

  v2 = bReplay;
  CMBlur::ClearDrunkBlur();
  CTimer::ms_fTimeScale = 1.0;
  p_m_nFlags = &this->m_nFlags;
  m_nPhysicalFlags = this->m_nPhysicalFlags;
  *(_DWORD *)&this->m_nFlags |= 1u;
  this->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags | 2);
  CPed::ClearAimFlag(this);
  CPed::ClearLookFlag(this);
  m_pFire = this->m_pFire;
  p_m_nPedFlags = &this->m_nPedFlags;
  *(_DWORD *)&this->m_nPedFlags |= 0x2000u;
  if ( m_pFire )
    CFire::Extinguish(m_pFire);
  CPed::SetPedState(this, PED_IDLE);
  CPed::SetMoveState(this, PEDMOVE_STILL);
  v8 = *((_DWORD *)&this->m_nPedFlags + 2);
  *(_DWORD *)p_m_nPedFlags &= ~0x4000000u;
  *((_DWORD *)&this->m_nPedFlags + 2) = v8 & 0xFBFFFFBD | 0x4000000;
  CPedIntelligence::FlushIntelligence(this->m_pPedIntelligence);
  RpAnimBlendClumpRemoveAllAssociations((RpClump_0 *)this->m_pRwObject);
  m_pPedIntelligence = this->m_pPedIntelligence;
  v10 = (CTaskSimplePlayerOnFoot *)CTask::operator new(0x34u);
  CTaskSimplePlayerOnFoot::CTaskSimplePlayerOnFoot(v10);
  CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, v10, 4, 0);
  this->m_motionAnimGroup = ANIM_PLAYER_PED;
  *(_DWORD *)p_m_nPedFlags &= ~0x100000u;
  m_pPlayerData = this->m_pPlayerData;
  if ( m_pPlayerData )
    *((_WORD *)m_pPlayerData + 26) &= ~2u;
  CPlayerPed::SetRealMoveAnim(this);
  this->m_pPedStats->m_nTemper = 50;
  if ( this->m_pAttachToEntity && (*(_DWORD *)p_m_nFlags & 1) == 0 )
  {
    v12.bdummy = this->m_nFlags.bdummy;
    *(_DWORD *)&v12 = *(_DWORD *)p_m_nFlags | 1;
    *p_m_nFlags = v12;
  }
  v13 = this->m_pPedIntelligence;
  this->m_nOriginalWeaponAmmo = 0;
  this->m_pAttachToEntity = 0;
  v14 = (CTaskComplexFacial *)CTask::operator new(0x20u);
  CTaskComplexFacial::CTaskComplexFacial(v14);
  CTaskManager::SetTaskSecondary(&v13->m_taskManager, v14, 3);
  if ( !v2 )
    CPlayerPed::TellGroupToStartFollowingPlayer(this, 1, 0, 1);
  v15 = this->m_pPlayerData;
  if ( v15 )
    sub_1950F0(v15);
}

//----- (004C3900) --------------------------------------------------------
void __fastcall CPlayerPed::~CPlayerPed(CPlayerPed *this)
{
  CPlayerPedData *m_pPlayerData; // r0
  AssocGroupId m_MeleeWeaponAnimReferenced; // r1
  AssocGroupId m_MeleeWeaponAnimReferencedExtra; // r1

  m_pPlayerData = this->m_pPlayerData;
  this->_vptr$CPlaceable = (int (**)(void))&off_669278;
  m_MeleeWeaponAnimReferenced = m_pPlayerData->m_MeleeWeaponAnimReferenced;
  if ( m_MeleeWeaponAnimReferenced )
  {
    CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[m_MeleeWeaponAnimReferenced].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
    this->m_pPlayerData->m_MeleeWeaponAnimReferenced = ANIM_STD_PED;
    m_pPlayerData = this->m_pPlayerData;
  }
  m_MeleeWeaponAnimReferencedExtra = m_pPlayerData->m_MeleeWeaponAnimReferencedExtra;
  if ( m_MeleeWeaponAnimReferencedExtra )
  {
    CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[m_MeleeWeaponAnimReferencedExtra].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
    this->m_pPlayerData->m_MeleeWeaponAnimReferencedExtra = ANIM_STD_PED;
    m_pPlayerData = this->m_pPlayerData;
  }
  CPedGroups::RemoveGroup(m_pPlayerData->m_PlayerGroup);
  sub_18CED4(this);
}
// 669278: using guessed type void *off_669278;

//----- (004C3994) --------------------------------------------------------
void __fastcall CPlayerPed::~CPlayerPed(CPlayerPed *this)
{
  void *v1; // r0

  CPlayerPed::~CPlayerPed(this);
  sub_19B93C(v1);
}
// 4C39A0: variable 'v1' is possibly undefined

//----- (004C39A4) --------------------------------------------------------
void __fastcall CPlayerPed::SetupPlayerPed(int32 nPlayerNum)
{
  CPlayerPed *pPed; // r5
  CPlayerInfo *v3; // r6
  CMatrix *m_pMat; // r0
  float tx; // s16
  float ty; // s18
  float tz; // s20
  float *p_xx; // r0
  float v9; // s2
  float v10; // s4

  pPed = (CPlayerPed *)CPed::operator new(0x7ACu);
  CPlayerPed::CPlayerPed(pPed, nPlayerNum, 0);
  v3 = &CWorld::Players[nPlayerNum];
  v3->pPed = pPed;
  if ( nPlayerNum == 1 )
  {
    pPed->m_nPedType = 1;
    pPed = v3->pPed;
  }
  m_pMat = pPed->m_pMat;
  if ( m_pMat )
  {
    tx = m_pMat->tx;
    ty = m_pMat->ty;
    tz = m_pMat->tz;
    CMatrix::SetRotate(m_pMat, 0.0, 0.0, 0.0);
    p_xx = &pPed->m_pMat->xx;
    v9 = ty + p_xx[13];
    v10 = tz + p_xx[14];
    p_xx[12] = tx + p_xx[12];
    p_xx[13] = v9;
    p_xx[14] = v10;
  }
  else
  {
    pPed->m_transform.m_heading = 0.0;
  }
  CWorld::Add(v3->pPed);
  v3->pPed->m_nShootingAccuracy = 100;
  CWorld::Players[nPlayerNum].PlayerState = 0;
}

//----- (004C3A60) --------------------------------------------------------
void __fastcall CPlayerPed::RemovePlayerPed(int32 nPlayerNum)
{
  CPlayerPed *pPed; // r0
  CPlayerInfo *v3; // r4
  CVehicle *m_pMyVehicle; // r1

  pPed = CWorld::Players[nPlayerNum].pPed;
  if ( pPed )
  {
    v3 = &CWorld::Players[nPlayerNum];
    m_pMyVehicle = pPed->m_pMyVehicle;
    if ( m_pMyVehicle && m_pMyVehicle->pDriver == pPed )
    {
      m_pMyVehicle->m_info = (CEntity::CEntityInfo)(*(_BYTE *)&m_pMyVehicle->m_info & 7 | 0x18);
      pPed->m_pMyVehicle->m_fGasPedal = 0.0;
      pPed->m_pMyVehicle->m_fBrakePedal = 0.1;
      pPed = v3->pPed;
    }
    CWorld::Remove(pPed);
    if ( v3->pPed )
      (*((void (__fastcall **)(CPlayerPed *))v3->pPed->_vptr$CPlaceable + 1))(v3->pPed);
    v3->pPed = 0;
  }
}

//----- (004C3AD4) --------------------------------------------------------
void __fastcall CPlayerPed::DeactivatePlayerPed(int32 nPlayerNum)
{
  sub_19E5E8(CWorld::Players[nPlayerNum].pPed);
}

//----- (004C3AEC) --------------------------------------------------------
void __fastcall CPlayerPed::ReactivatePlayerPed(int32 nPlayerNum)
{
  sub_19B3E4(CWorld::Players[nPlayerNum].pPed);
}

//----- (004C3B04) --------------------------------------------------------
void __fastcall CPlayerPed::SetRealMoveAnim(CPlayerPed *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  CAnimBlendAssociation *Association; // r6
  CAnimBlendAssociation *v6; // r4
  CAnimBlendAssociation *p_m_bitsFlag; // r10
  CAnimBlendAssociation *v8; // r8
  CAnimBlendAssociation *v9; // r11
  bool v10; // zf
  CAnimBlendAssociation *v11; // r5
  bool v12; // zf
  CAnimBlendAssociation *v13; // r10
  CAnimBlendAssociation *v14; // r4
  int32 m_nPedType; // r0
  CAnimBlendAssociation *v16; // r5
  CPad *Pad; // r0
  CAnimBlendAssociation *v18; // r6
  float *v19; // r8
  CAnimBlendAssociation *v20; // r11
  uint16 m_bitsFlag; // r1
  CAnimBlendAssociation *v22; // r0
  CAnimBlendAssociation *v23; // r5
  int32 v24; // r0
  int32 v25; // r0
  CPad *v26; // r0
  int32 v27; // r0
  int32 v28; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2
  uint16 v31; // r0
  CPlayerPedData *m_pPlayerData; // r0
  __int16 v33; // r1
  float v34; // s0
  float m_fSprintControlCounter; // s2
  CAnimBlendAssociation *v36; // r0
  CAnimBlendAssociation *v37; // r6
  eMoveState *p_m_eMoveState; // r5
  int v39; // r8
  float m_fBlendAmount; // s4
  uint16 v41; // r0
  float m_moveBlendRatio; // s2
  int v43; // r0
  float v44; // s0
  CPad *v45; // r0
  float m_fBlendDelta; // s0
  CAnimBlendAssociation *v47; // r11
  int32 v48; // r0
  CPad *v49; // r0
  float v50; // s0
  int32 v51; // r0
  int32 v52; // r0
  RpClump_0 *m_pRwObject; // r0
  CAnimBlendAssociation *v54; // r0
  float v55; // s0
  int v56; // r1
  int v57; // r0
  float v58; // s0
  uint16 v59; // r0
  uint16 v60; // r1
  CAnimBlendAssociation *v61; // r0
  CAnimBlendAssociation *v62; // r0
  AssocGroupId DefaultPlayerMotionGroup; // r0
  AssocGroupId v64; // r1
  CAnimBlendAssociation *v65; // r0
  CAnimBlendAssociation *v66; // [sp+1Ch] [bp-3Ch]
  CAnimBlendAssociation *v67; // [sp+20h] [bp-38h]
  CAnimBlendAssociation *v68; // [sp+24h] [bp-34h]
  CAnimBlendAssociation *v69; // [sp+28h] [bp-30h]
  CAnimBlendAssociation *v70; // [sp+2Ch] [bp-2Ch]

  Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 0);
  v6 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 1u);
  v70 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 2u);
  p_m_bitsFlag = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 5u);
  v69 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 3u);
  v8 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 6u);
  v9 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 7u);
  v67 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 0x89u);
  v66 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 0x8Au);
  v68 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 0xAu);
  if ( *((unsigned __int8 *)&this->m_nPedFlags + 4) << 31 )
  {
    if ( Association )
      CAnimBlendAssociation::SetCurrentTime(Association, 0.0);
    if ( v6 )
      CAnimBlendAssociation::SetCurrentTime(v6, 0.0);
    if ( v70 )
      CAnimBlendAssociation::SetCurrentTime(v70, 0.0);
    *((_DWORD *)&this->m_nPedFlags + 1) &= ~1u;
  }
  v10 = v8 == 0;
  v11 = p_m_bitsFlag;
  if ( v8 )
  {
    p_m_bitsFlag = (CAnimBlendAssociation *)&v8->m_bitsFlag;
    v10 = (v8->m_bitsFlag & 1) == 0;
  }
  if ( !v10 )
  {
    CPed::SetMoveState(this, PEDMOVE_RUN);
    goto LABEL_28;
  }
  v12 = v9 == 0;
  if ( v9 )
    v12 = LOBYTE(v9->m_bitsFlag) << 31 == 0;
  if ( !v12 )
  {
    CPed::SetMoveState(this, PEDMOVE_RUN);
    if ( v8 )
    {
      p_m_bitsFlag = (CAnimBlendAssociation *)&v8->m_bitsFlag;
LABEL_28:
      v20 = v70;
      if ( ((int)p_m_bitsFlag->_vptr$CAnimBlendAssociation & 1) == 0
        && v8->m_fCurrentTime < v8->m_pAnimBlendHierarchy->m_fTotalTime )
      {
        LOWORD(p_m_bitsFlag->_vptr$CAnimBlendAssociation) |= 1u;
      }
      v13 = v6;
      v14 = v11;
      v16 = Association;
      goto LABEL_73;
    }
    v13 = v6;
LABEL_39:
    v14 = v11;
    v20 = v70;
    v16 = Association;
    goto LABEL_73;
  }
  v13 = v6;
  if ( v8 && v8->m_fBlendDelta >= 0.0 )
  {
    v9 = v8;
LABEL_36:
    m_bitsFlag = v9->m_bitsFlag;
    v9->m_fBlendAmount = 1.0;
    v9->m_fBlendDelta = -8.0;
    v9->m_bitsFlag = m_bitsFlag | 4;
    CPed::RestoreHeadingRate(this);
    v22 = v69;
    if ( !v69 )
      v22 = CAnimManager::BlendAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, ANIM_STD_IDLE, 8.0);
    v22->m_fBlendAmount = 0.0;
    v22->m_fBlendDelta = 8.0;
    goto LABEL_39;
  }
  v14 = v11;
  if ( v9 && v9->m_fBlendDelta >= 0.0 )
  {
    if ( v8 )
      v9 = v8;
    goto LABEL_36;
  }
  if ( !v70 )
  {
    m_nPedType = this->m_nPedType;
    v16 = Association;
    if ( m_nPedType == 1 )
    {
      v18 = v68;
      v19 = (float *)v69;
      Pad = CPad::GetPad(1);
    }
    else
    {
      v10 = m_nPedType == 0;
      Pad = 0;
      v18 = v68;
      v19 = (float *)v69;
      if ( v10 )
        Pad = CPad::GetPad(0);
    }
    if ( !CPad::GetForceCameraBehindPlayer(Pad) )
      goto LABEL_56;
    v24 = this->m_nPedType;
    if ( v24 == 1 )
    {
      v25 = 1;
    }
    else
    {
      if ( v24 )
      {
        v26 = 0;
        goto LABEL_51;
      }
      v25 = 0;
    }
    v26 = CPad::GetPad(v25);
LABEL_51:
    if ( CPad::AimWeaponLeftRight(v26, 0, 0) != 0.0 && TheCamera.Cams[TheCamera.ActiveCam].Mode == 4 )
    {
      v27 = this->m_nPedType;
      if ( v27 == 1 )
      {
        v28 = 1;
      }
      else
      {
        if ( v27 )
        {
          v45 = 0;
          goto LABEL_152;
        }
        v28 = 0;
      }
      v45 = CPad::GetPad(v28);
LABEL_152:
      if ( CPad::AimWeaponLeftRight(v45, 0, 0) < 0.0 )
      {
        if ( !v67 )
          goto LABEL_158;
        m_fBlendDelta = v67->m_fBlendDelta;
        if ( m_fBlendDelta < 0.0 )
          goto LABEL_158;
        if ( m_fBlendDelta > 0.0 )
        {
          v61 = v67;
          goto LABEL_159;
        }
        v61 = v67;
        if ( v67->m_fBlendAmount < 1.0 )
LABEL_158:
          v61 = CAnimManager::BlendAnimation((RpClump_0 *)this->m_pRwObject, ANIM_STD_PED, ANIM_STD_TURN_L, 16.0);
LABEL_159:
        v47 = v61;
        v48 = this->m_nPedType;
        if ( v48 != 1 )
        {
          if ( v48 )
          {
LABEL_161:
            v49 = 0;
LABEL_173:
            v47->m_fSpeed = COERCE_FLOAT(COERCE_UNSIGNED_INT(CPad::AimWeaponLeftRight(v49, 0, 0)) & 0x7FFFFFFF)
                          * 0.0078125;
            if ( v19 && v19[6] <= 0.01 )
              (*(void (__fastcall **)(float *))(*(_DWORD *)v19 + 4))(v19);
LABEL_58:
            if ( this->m_pPlayerData->m_fSprintEnergy >= 0.0
              || CPedIntelligence::GetTaskFighting(this->m_pPedIntelligence)
              || CPedIntelligence::GetTaskUseGun(this->m_pPedIntelligence)
              || CPedIntelligence::GetTaskDuck(this->m_pPedIntelligence, 1)
              || CPedIntelligence::GetTaskThrow(this->m_pPedIntelligence)
              || CPedIntelligence::GetTaskJetPack(this->m_pPedIntelligence) )
            {
              goto LABEL_69;
            }
            m_pMat = this->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &this->m_transform;
            v18 = v68;
            if ( CWorld::TestSphereAgainstWorld(p_tx->m_translate, 0.5, 0, 1, 0, 0, 0, 0, 0) )
            {
LABEL_69:
              if ( v18 && v18->m_fBlendAmount > 0.0 && v18->m_fBlendDelta >= 0.0 )
              {
                v31 = v18->m_bitsFlag;
                v18->m_fBlendDelta = -2.0;
                v18->m_bitsFlag = v31 & 0xFFFE;
              }
            }
            else if ( !v68 )
            {
              DefaultPlayerMotionGroup = CClothes::GetDefaultPlayerMotionGroup();
              v64 = ANIM_STD_PED;
              if ( DefaultPlayerMotionGroup == ANIM_PLAYER_FAT_PED )
                v64 = ANIM_PLAYER_FAT_TIRED_PED;
              v65 = CAnimManager::BlendAnimation((RpClump_0 *)this->m_pRwObject, v64, ANIM_STD_IDLE_TIRED, 4.0);
              v65->m_bitsFlag |= 1u;
            }
            CPed::SetMoveState(this, PEDMOVE_STILL);
            goto LABEL_72;
          }
          goto LABEL_170;
        }
        goto LABEL_171;
      }
      if ( !v66 )
        goto LABEL_167;
      v50 = v66->m_fBlendDelta;
      if ( v50 < 0.0 )
        goto LABEL_167;
      if ( v50 > 0.0 )
      {
        v62 = v66;
        goto LABEL_168;
      }
      v62 = v66;
      if ( v66->m_fBlendAmount < 1.0 )
LABEL_167:
        v62 = CAnimManager::BlendAnimation((RpClump_0 *)this->m_pRwObject, ANIM_STD_PED, ANIM_STD_TURN_R, 16.0);
LABEL_168:
      v47 = v62;
      v51 = this->m_nPedType;
      if ( v51 != 1 )
      {
        if ( v51 )
          goto LABEL_161;
LABEL_170:
        v52 = 0;
LABEL_172:
        v49 = CPad::GetPad(v52);
        goto LABEL_173;
      }
LABEL_171:
      v52 = 1;
      goto LABEL_172;
    }
LABEL_56:
    if ( !v19 )
      CAnimManager::BlendAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, ANIM_STD_IDLE, 4.0);
    goto LABEL_58;
  }
  v23 = Association;
  if ( v69 )
  {
    if ( v14 )
    {
      v14->m_fBlendAmount = 1.0;
      v14->m_fBlendDelta = 0.0;
    }
    else
    {
      v14 = CAnimManager::AddAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, ANIM_STD_STARTWALK);
    }
    if ( Association )
      CAnimBlendAssociation::SetCurrentTime(Association, 0.0);
    if ( v13 )
      CAnimBlendAssociation::SetCurrentTime(v13, 0.0);
    (*((void (__fastcall **)(CAnimBlendAssociation *))v69->_vptr$CAnimBlendAssociation + 1))(v69);
    if ( v68 )
      v68->m_fBlendDelta = -4.0;
    (*((void (__fastcall **)(CAnimBlendAssociation *))v70->_vptr$CAnimBlendAssociation + 1))(v70);
    CPed::SetMoveState(this, PEDMOVE_WALK);
    v70 = 0;
  }
  if ( v8 )
  {
    (*((void (__fastcall **)(CAnimBlendAssociation *))v8->_vptr$CAnimBlendAssociation + 1))(v8);
    CPed::RestoreHeadingRate(this);
  }
  if ( v9 )
  {
    (*((void (__fastcall **)(CAnimBlendAssociation *))v9->_vptr$CAnimBlendAssociation + 1))(v9);
    CPed::RestoreHeadingRate(this);
  }
  if ( v67 )
    (*((void (__fastcall **)(CAnimBlendAssociation *))v67->_vptr$CAnimBlendAssociation + 1))(v67);
  v20 = v70;
  if ( v66 )
    (*((void (__fastcall **)(CAnimBlendAssociation *))v66->_vptr$CAnimBlendAssociation + 1))(v66);
  if ( Association )
  {
    if ( v13 )
      goto LABEL_121;
  }
  else
  {
    v36 = CAnimManager::AddAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, ANIM_STD_WALK);
    v36->m_fBlendAmount = 0.0;
    v23 = v36;
    if ( v13 )
    {
LABEL_121:
      if ( !v14 )
        goto LABEL_131;
      goto LABEL_125;
    }
  }
  v13 = CAnimManager::AddAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, ANIM_STD_RUN);
  v13->m_fBlendAmount = 0.0;
  if ( !v14 )
  {
LABEL_131:
    v37 = v23;
    p_m_eMoveState = &this->m_eMoveState;
    v39 = 0;
    v14 = 0;
    goto LABEL_132;
  }
LABEL_125:
  if ( !(LOBYTE(v14->m_bitsFlag) << 31)
    || (float)(v14->m_fCurrentTime + v14->m_fTimeStep) >= v14->m_pAnimBlendHierarchy->m_fTotalTime )
  {
    (*((void (__fastcall **)(CAnimBlendAssociation *))v14->_vptr$CAnimBlendAssociation + 1))(v14);
    v23->m_bitsFlag |= 1u;
    v13->m_bitsFlag |= 1u;
    goto LABEL_131;
  }
  v37 = v23;
  p_m_eMoveState = &this->m_eMoveState;
  v39 = 1;
  if ( this->m_eMoveState == PEDMOVE_SPRINT )
  {
    CPed::SetMoveState(this, PEDMOVE_STILL);
    if ( !v70 )
      goto LABEL_137;
    goto LABEL_133;
  }
LABEL_132:
  if ( !v70 )
    goto LABEL_137;
LABEL_133:
  if ( *p_m_eMoveState != PEDMOVE_SPRINT || this->m_pPlayerData->m_moveBlendRatio < 0.4 )
  {
    m_fBlendAmount = v70->m_fBlendAmount;
    if ( m_fBlendAmount == 0.0 )
    {
      v41 = v70->m_bitsFlag;
      v16 = v37;
      v70->m_fBlendDelta = -1000.0;
      v70->m_bitsFlag = v41 | 4;
      goto LABEL_199;
    }
    v16 = v37;
    m_moveBlendRatio = this->m_pPlayerData->m_moveBlendRatio;
    if ( m_fBlendAmount >= 0.8 )
    {
      if ( m_moveBlendRatio >= 0.4 )
      {
        if ( v70->m_fBlendDelta < 0.0 )
          goto LABEL_199;
        v59 = v70->m_bitsFlag | 4;
        v70->m_fBlendDelta = -1.0;
        v70->m_bitsFlag = v59;
        v43 = 1065353216;
      }
      else
      {
        m_pRwObject = (RpClump_0 *)this->m_pRwObject;
        if ( (float)(v70->m_fCurrentTime / v70->m_pAnimBlendHierarchy->m_fTotalTime) >= 0.5 )
          v54 = CAnimManager::AddAnimation(m_pRwObject, ANIM_STD_PED, ANIM_STD_RUNSTOP2);
        else
          v54 = CAnimManager::AddAnimation(m_pRwObject, ANIM_STD_PED, ANIM_STD_RUNSTOP1);
        v54->m_fBlendAmount = 1.0;
        CAnimBlendAssociation::SetDeleteCallback(v54, CPed::RestoreHeadingRateCB, this);
        v43 = 0;
        this->m_fHeadingChangeRate = 0.0;
        v60 = v70->m_bitsFlag;
        v70->m_fBlendDelta = -1000.0;
        v70->m_bitsFlag = v60 | 4;
        v37->m_bitsFlag &= ~1u;
        v13->m_bitsFlag &= ~1u;
        v37->m_fBlendAmount = 0.0;
        v13->m_fBlendAmount = 0.0;
        v37->m_fBlendDelta = 0.0;
      }
    }
    else
    {
      if ( m_moveBlendRatio >= 1.0 )
        goto LABEL_199;
      v70->m_fBlendDelta = -8.0;
      v43 = 1090519040;
    }
    LODWORD(v13->m_fBlendDelta) = v43;
LABEL_199:
    if ( this->m_pPlayerData->m_moveBlendRatio > 1.0 )
    {
LABEL_200:
      CPed::SetMoveState(this, PEDMOVE_RUN);
      goto LABEL_73;
    }
    goto LABEL_201;
  }
LABEL_137:
  if ( v39 == 1 )
  {
    v16 = v37;
    v37->m_bitsFlag &= ~1u;
    v13->m_bitsFlag &= ~1u;
    v37->m_fBlendAmount = 0.0;
    v13->m_fBlendAmount = 0.0;
    goto LABEL_73;
  }
  if ( *p_m_eMoveState != PEDMOVE_SPRINT )
  {
    v44 = this->m_pPlayerData->m_moveBlendRatio;
    if ( v44 >= 1.0 )
    {
      v16 = v37;
      if ( v44 >= 2.0 )
      {
        v37->m_fBlendAmount = 0.0;
        v13->m_fBlendAmount = 1.0;
        v37->m_fBlendDelta = 0.0;
        v13->m_fBlendDelta = 0.0;
        CPed::SetMoveState(this, PEDMOVE_RUN);
        CStats::UpdateStatsWhenRunning();
        goto LABEL_73;
      }
      v37->m_fBlendAmount = 2.0 - v44;
      v13->m_fBlendAmount = this->m_pPlayerData->m_moveBlendRatio + -1.0;
      v37->m_fBlendDelta = 0.0;
      v13->m_fBlendDelta = 0.0;
      goto LABEL_200;
    }
    v16 = v37;
    v37->m_fBlendAmount = 1.0;
    v13->m_fBlendAmount = 0.0;
    v37->m_fBlendDelta = 0.0;
    v13->m_fBlendDelta = 0.0;
LABEL_201:
    CPed::SetMoveState(this, PEDMOVE_WALK);
    goto LABEL_73;
  }
  if ( v70 )
  {
    v16 = v37;
    if ( v70->m_fBlendDelta < 0.0 )
    {
      v70->m_fBlendDelta = 2.0;
      v13->m_fBlendDelta = -2.0;
    }
    goto LABEL_143;
  }
  v55 = v13->m_fBlendAmount;
  v16 = v37;
  if ( v55 >= 1.0 )
  {
    v20 = CAnimManager::BlendAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, ANIM_STD_RUNFAST, 2.0);
    if ( !v20 )
    {
LABEL_72:
      v20 = 0;
      goto LABEL_73;
    }
LABEL_143:
    CStats::UpdateStatsWhenSprinting();
    goto LABEL_73;
  }
  v56 = 0;
  v57 = 0;
  if ( v55 == 0.0 )
    v56 = 1;
  if ( v37->m_fBlendAmount == 0.0 )
    v57 = 1;
  if ( (v56 & v57) != 0 )
    v37->m_fBlendAmount = 1.0;
  v58 = v13->m_fBlendDelta;
  if ( v58 <= 0.0 )
  {
    v13 = CAnimManager::BlendAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, ANIM_STD_RUN, 4.0);
    v58 = v13->m_fBlendDelta;
  }
  v20 = 0;
  this->m_pPlayerData->m_moveBlendRatio = v58 + 1.0;
LABEL_73:
  m_pPlayerData = this->m_pPlayerData;
  v33 = *((_WORD *)m_pPlayerData + 26);
  if ( (v33 & 2) == 0 )
  {
    if ( !v20 )
      return;
    goto LABEL_95;
  }
  if ( CTimer::m_snTimeInMilliseconds <= m_pPlayerData->m_AdrenalineEndTime || CCheat::m_aCheatsActive[79] )
  {
    CTimer::ms_fTimeScale = 0.33333;
    if ( v14 )
      v14->m_fSpeed = 2.0;
    if ( v16 )
      v16->m_fSpeed = 2.0;
    if ( v13 )
      v13->m_fSpeed = 2.0;
    if ( v20 )
    {
      v34 = 2.0;
      goto LABEL_94;
    }
  }
  else
  {
    *((_WORD *)m_pPlayerData + 26) = v33 & 0xFFFD;
    CTimer::ms_fTimeScale = 1.0;
    if ( v14 )
      v14->m_fSpeed = 1.0;
    if ( v16 )
      v16->m_fSpeed = 1.0;
    if ( v13 )
      v13->m_fSpeed = 1.0;
    if ( v20 )
    {
      v34 = 1.0;
LABEL_94:
      v20->m_fSpeed = v34;
LABEL_95:
      if ( TheCamera.Cams[TheCamera.ActiveCam].Mode == 15 )
      {
        v20->m_fSpeed = 0.7;
      }
      else
      {
        m_fSprintControlCounter = this->m_pPlayerData->m_fSprintControlCounter;
        if ( m_fSprintControlCounter <= PLAYER_SPRINT_THRESHOLD )
        {
          v1.n64_u32[0] = 0;
          if ( m_fSprintControlCounter > 0.0 )
            v1.n64_u32[0] = 1.0;
        }
        else
        {
          v3.n64_u32[0] = 0;
          v1.n64_f32[0] = (float)(m_fSprintControlCounter / PLAYER_SPRINT_THRESHOLD) + -1.0;
          v1.n64_u64[0] = vmax_f32(v1, v3).n64_u64[0];
          v1.n64_f32[0] = (float)(v1.n64_f32[0] * PLAYER_SPRINT_SET[0].fResultMult) + 1.0;
        }
        v2.n64_u32[0] = 1.0;
        LODWORD(v20->m_fSpeed) = vmax_f32(v1, v2).n64_u32[0];
      }
    }
  }
}
// 4C3FEC: conditional instruction was optimized away because %var_2C.4!=0
// 4C3F66: variable 'v1' is possibly undefined
// 4C3F66: variable 'v3' is possibly undefined
// 4C3F92: variable 'v2' is possibly undefined
// 4C4544: using guessed type float **off_4C4544;

//----- (004C4554) --------------------------------------------------------
void __fastcall CPlayerPed::TellGroupToStartFollowingPlayer(
        CPlayerPed *this,
        bool bFollow,
        bool bPlaySound,
        bool bChangeFollowEvenWhenEmpty)
{
  _BOOL4 v5; // r5
  CPlayerPedData *m_pPlayerData; // r0
  _BOOL4 v7; // r6
  bool v8; // zf
  CEventPlayerCommandToGroup *v9; // r8
  int v10; // r6
  float DistanceToFurthestMember; // r0
  float v12; // s0
  UInt16 v13; // r1
  UInt16 v14; // r1
  CPlayerPed *v15; // r0
  CEventGroupEvent v16; // [sp+Ch] [bp-44h] BYREF
  CEventPlayerCommandToGroup v17; // [sp+20h] [bp-30h] BYREF

  v5 = bFollow;
  m_pPlayerData = this->m_pPlayerData;
  v7 = bPlaySound;
  v8 = (*((_WORD *)m_pPlayerData + 26) & 0x200) == 0;
  if ( (*((_WORD *)m_pPlayerData + 26) & 0x200) != 0 )
    v8 = bFollow;
  if ( v8 && ((*((_WORD *)m_pPlayerData + 26) & 0x400) == 0 || !bFollow) )
  {
    if ( !bChangeFollowEvenWhenEmpty )
    {
      if ( !CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[m_pPlayerData->m_PlayerGroup].m_membership) )
        return;
      m_pPlayerData = this->m_pPlayerData;
    }
    CPedGroups::ms_groups[m_pPlayerData->m_PlayerGroup].m_followLeader = v5;
    CPedGroupIntelligence::SetDefaultTaskAllocatorType(
      &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_intelligence,
      5);
    if ( v5 )
    {
      CEventPlayerCommandToGroup::CEventPlayerCommandToGroup(&v17, 0, 0);
      v17._vptr$CEvent = (int (**)(void))&off_6671E8;
      CEventEditableResponse::ComputeResponseTaskType(&v17, &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup]);
      if ( CEventEditableResponse::WillRespond(&v17) )
      {
        v9 = (CEventPlayerCommandToGroup *)CEvent::operator new(0x18u);
        CEventPlayerCommandToGroup::CEventPlayerCommandToGroup(v9, 2, 0);
        v9->_vptr$CEvent = (int (**)(void))&off_669384;
        v9->m_iTaskType = v17.m_iTaskType;
        CEventGroupEvent::CEventGroupEvent(&v16, this, (CEvent *)v9);
        CPedGroupIntelligence::AddEvent(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_intelligence, &v16);
        CEventGroupEvent::~CEventGroupEvent(&v16);
      }
      CEventPlayerCommandToGroup::~CEventPlayerCommandToGroup(&v17);
    }
    if ( v7 )
    {
      v10 = CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership);
      if ( v10 >= 1 )
      {
        DistanceToFurthestMember = CPedGroup::FindDistanceToFurthestMember(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup]);
        if ( v5 )
        {
          v12 = DistanceToFurthestMember;
          if ( v10 == 1 )
          {
            if ( DistanceToFurthestMember < 3.0 )
            {
              v13 = 156;
LABEL_26:
              CPed::Say(this, v13, 0, 1.0, 0, 0, 0);
              return;
            }
            v15 = this;
            if ( v12 < 10.0 )
              v14 = 154;
            else
              v14 = 152;
          }
          else
          {
            if ( DistanceToFurthestMember < 3.0 )
            {
              v13 = 155;
              goto LABEL_26;
            }
            v15 = this;
            if ( v12 < 10.0 )
              v14 = 153;
            else
              v14 = 151;
          }
        }
        else
        {
          if ( v10 == 1 )
            v14 = 160;
          else
            v14 = 159;
          v15 = this;
        }
        CPed::Say(v15, v14, 0, 1.0, 0, 0, 0);
      }
    }
  }
}
// 6671E8: using guessed type void *;
// 669384: using guessed type void *;

//----- (004C4748) --------------------------------------------------------
CPad *__fastcall CPlayerPed::GetPadFromPlayer(CPlayerPed *this)
{
  int32 m_nPedType; // r0
  bool v2; // zf
  CPad *result; // r0

  m_nPedType = this->m_nPedType;
  if ( m_nPedType == 1 )
    return sub_19F85C(1);
  v2 = m_nPedType == 0;
  result = 0;
  if ( v2 )
    return sub_19F85C(0);
  return result;
}

//----- (004C4764) --------------------------------------------------------
Bool8 __fastcall CPlayerPed::CanPlayerStartMission(CPlayerPed *this)
{
  CPedIntelligence *m_pPedIntelligence; // r1
  CTask *v3; // r0
  bool v4; // zf
  CTask *v6; // r0
  Bool8 v7; // r5

  if ( CGameLogic::GameState
    || CGameLogic::IsCoopGameGoingOn()
    || !CPed::IsPedInControl(this) && this->m_nPedState != PED_DRIVING )
  {
    return 0;
  }
  m_pPedIntelligence = this->m_pPedIntelligence;
  v3 = m_pPedIntelligence->m_taskManager.m_tasks[0];
  v4 = v3 == 0;
  if ( !v3 )
    v4 = m_pPedIntelligence->m_taskManager.m_tasks[2] == 0;
  if ( !v4 )
    return 0;
  v6 = m_pPedIntelligence->m_taskManager.m_tasks[3];
  if ( v6 )
  {
    if ( (*((int (__fastcall **)(CTask *))v6->_vptr$CTask + 5))(v6) != 709 )
      return 0;
    m_pPedIntelligence = this->m_pPedIntelligence;
  }
  v7 = 0;
  if ( !CTaskManager::GetTaskSecondary(&m_pPedIntelligence->m_taskManager, 0) )
  {
    v7 = 0;
    if ( CPed::IsAlive(this) && !CEventGroup::GetEventOfType(&this->m_pPedIntelligence->m_eventGroup, 32) )
      return 1;
  }
  return v7;
}

//----- (004C47E8) --------------------------------------------------------
void __fastcall CPlayerPed::ProcessControl(CPlayerPed *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d8
  int v4; // r10
  CPad *Pad; // r9
  CPlayerPedData *m_pPlayerData; // r0
  CPlayerPedData *v7; // r0
  CVehicle *PlayerVehicle; // r0
  CPlayerPedData *v9; // r0
  unsigned int m_nDrunkenness; // r1
  CPlayerPedData *v11; // r0
  __int16 v12; // r1
  char m_nFlags; // r0
  int32 m_nPedType; // r0
  int32 v15; // r0
  CPad *v16; // r0
  CPlayerPedData *v17; // r0
  CWanted *m_Wanted; // r0
  CWeaponInfo *WeaponInfo; // r6
  CAnimBlendAssociation *m_pAnim; // r5
  CPlayerPedData *v21; // r0
  float m_fGunSpinSpeed; // s2
  CPlayerPedData *v23; // r0
  CPlayerPedData *v24; // r0
  float v25; // s0
  CPlayerPedData *v26; // r0
  CEntity *m_pEntLockOnTarget; // r1
  CPed *m_pMouseLockOnRecruitPed; // r0
  int v29; // r0
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *v32; // r0
  CEntity *v33; // r6
  float TargetHeadRange; // r5
  CMatrix *v35; // r0
  CMatrix *v36; // r1
  CSimpleTransform *v37; // r2
  CSimpleTransform *v38; // r0
  float32x2_t v39; // d16
  unsigned __int64 v40; // d2
  int v41; // r0
  CMatrix *m_pMat; // r0
  float *p_tx; // r2
  float v44; // s2
  float y; // s8
  float z; // s10
  float v47; // s4
  float v48; // s0
  CMatrix *v49; // r0
  float v50; // s0
  float *p_x; // r2
  float x; // s6
  CMatrix *v53; // r0
  CSimpleTransform *p_m_transform; // r2
  __int64 v55; // d16
  uint32 v56; // r0
  int v57; // s0
  CPlayerPedData *v58; // r0
  __int64 v59; // d16
  float m_heading; // r0
  float *m_pLastRenderedLink; // r0
  float v62; // s2
  float v63; // s4
  unsigned int blue; // r12
  unsigned int v65; // lr
  unsigned int red; // r6
  CMatrix *v67; // r0
  float v68; // s6
  float v69; // s8
  float v70; // s10
  eMoveState m_eMoveState; // r0
  float v72; // s16
  CPlayerPedData *v73; // r0
  float v74; // s0
  CVehicle *m_pMyVehicle; // r0
  bool v76; // zf
  float v77; // s16
  float m_fSprintEnergy; // s16
  ePedState m_nPedState; // r0
  eWeaponType v80; // r5
  tAudioEvent v81; // r1
  int ActiveCam; // r0
  float v83; // r0
  float v84; // r0
  float v85; // s0
  float m_fCurrentHeading; // s2
  float v87; // s4
  float v88; // s16
  float v89; // r0
  float m_fLookHeading; // s2
  CPlayerPedData *v91; // r0
  uint32 m_nStandStillTimer; // r2
  __int16 v93; // r1
  CPlayerPedData *v94; // r0
  char v95; // r1
  CPlayerPedData *v96; // r0
  unsigned int v97; // r1
  CMatrix *v98; // r0
  CSimpleTransform *v99; // r1
  float v100; // s16
  float v101; // s18
  float v102; // s0
  float v103; // s0
  float m_waterHeight; // s2
  CPlayerPed *PlayerPed; // r0
  Int32 m_PlayerGroup; // r0
  int v107; // r5
  UInt16 v108; // r1
  int i; // r5
  CPed *Member; // r6
  unsigned __int16 v111; // r0
  CPad *pPad; // [sp+1Ch] [bp-6Ch]
  CVector v113; // [sp+20h] [bp-68h] BYREF
  RwV3d_0 posn; // [sp+30h] [bp-58h] BYREF
  CVector v115; // 0:r1.12

  CPad::GetPad(0);
  v4 = CHID::currentInstanceIndex;
  CHID::currentInstanceIndex = CWorld::Players[1].pPed == this;
  Pad = CPad::GetPad(0);
  CWeapon::StaticUpdate();
  m_pPlayerData = this->m_pPlayerData;
  if ( m_pPlayerData->m_nCarDangerCounter )
  {
    --m_pPlayerData->m_nCarDangerCounter;
    v7 = this->m_pPlayerData;
    if ( !v7->m_nCarDangerCounter )
      v7->m_pDangerCar = 0;
  }
  else
  {
    m_pPlayerData->m_pDangerCar = 0;
  }
  if ( CPlayerPed::bDebugPlayerInvincible && FindPlayerVehicle(-1, 0) )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    *(_DWORD *)&PlayerVehicle->m_nVehicleFlags &= ~0x200000u;
  }
  v9 = this->m_pPlayerData;
  if ( v9->m_bFadeDrunkenness )
  {
    m_nDrunkenness = v9->m_nDrunkenness;
    if ( m_nDrunkenness > 1 )
    {
      v9->m_nDrunkenness = m_nDrunkenness - 1;
    }
    else
    {
      v9->m_nDrunkenness = 0;
      CMBlur::ClearDrunkBlur();
      this->m_pPlayerData->m_bFadeDrunkenness = 0;
    }
  }
  v11 = this->m_pPlayerData;
  if ( v11->m_nDrunkenness )
  {
    CMBlur::SetDrunkBlur((float)v11->m_nDrunkenness / 255.0);
    v11 = this->m_pPlayerData;
  }
  v12 = *((_WORD *)v11 + 26);
  if ( (v12 & 0x80) != 0 )
  {
    CPlayerPed::HandlePlayerBreath(this, 0, 1.0);
    v11 = this->m_pPlayerData;
    v12 = *((_WORD *)v11 + 26);
  }
  *((_WORD *)v11 + 26) = v12 | 0x80;
  CPed::ProcessControl(this);
  m_nFlags = (char)this->m_nFlags;
  *((_DWORD *)&this->m_nPedFlags + 3) |= 0x100u;
  if ( (m_nFlags & 0x40) != 0 )
    goto LABEL_192;
  m_nPedType = this->m_nPedType;
  if ( m_nPedType == 1 )
  {
    v15 = 1;
    goto LABEL_22;
  }
  if ( !m_nPedType )
  {
    v15 = 0;
LABEL_22:
    v16 = CPad::GetPad(v15);
    goto LABEL_24;
  }
  v16 = 0;
LABEL_24:
  pPad = v16;
  v17 = this->m_pPlayerData;
  if ( v17 )
    m_Wanted = v17->m_Wanted;
  else
    m_Wanted = 0;
  CWanted::Update(m_Wanted);
  CEntity::PruneReferences(this);
  if ( this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_MINIGUN )
  {
    WeaponInfo = CWeaponInfo::GetWeaponInfo(WEAPONTYPE_MINIGUN, 1);
    if ( CPedIntelligence::GetTaskUseGun(this->m_pPedIntelligence)
      && (m_pAnim = CPedIntelligence::GetTaskUseGun(this->m_pPedIntelligence)->m_pAnim) != 0
      && (float)(m_pAnim->m_fCurrentTime - m_pAnim->m_fTimeStep) < WeaponInfo->m_animLoopEnd )
    {
      v21 = this->m_pPlayerData;
      m_fGunSpinSpeed = v21->m_fGunSpinSpeed;
      if ( m_fGunSpinSpeed < 0.45 )
      {
        v21->m_fGunSpinSpeed = m_fGunSpinSpeed + (float)(CTimer::ms_fTimeStep * 0.025);
        v23 = this->m_pPlayerData;
        if ( v23->m_fGunSpinSpeed > 0.45 )
          v23->m_fGunSpinSpeed = 0.45;
      }
      if ( CPad::GetWeapon(pPad, this, 1)
        && this->m_WeaponSlots[this->m_nCurrentWeapon].m_nAmmoTotal >= 1
        && m_pAnim->m_fCurrentTime >= WeaponInfo->m_animLoopStart )
      {
        CAEPedWeaponAudioEntity::AddAudioEvent(&this->m_PedWeaponAudioEntity, 150);
      }
      else
      {
        CAEPedWeaponAudioEntity::AddAudioEvent(&this->m_PedWeaponAudioEntity, 151);
      }
    }
    else
    {
      v24 = this->m_pPlayerData;
      v25 = v24->m_fGunSpinSpeed;
      if ( v25 > 0.0 )
      {
        v24->m_fGunSpinSpeed = v25 + (float)(CTimer::ms_fTimeStep * -0.003);
        v26 = this->m_pPlayerData;
        if ( v26->m_fGunSpinSpeed < 0.0 )
          v26->m_fGunSpinSpeed = 0.0;
      }
    }
  }
  m_pEntLockOnTarget = this->m_pEntLockOnTarget;
  if ( m_pEntLockOnTarget )
  {
    m_pMouseLockOnRecruitPed = this->m_pMouseLockOnRecruitPed;
    if ( m_pMouseLockOnRecruitPed )
    {
      CEntity::CleanUpOldReference(m_pMouseLockOnRecruitPed, &this->m_pMouseLockOnRecruitPed);
      m_pEntLockOnTarget = this->m_pEntLockOnTarget;
      this->m_pMouseLockOnRecruitPed = 0;
    }
    memset(&posn, 0, sizeof(posn));
    v29 = *(_BYTE *)&m_pEntLockOnTarget->m_info & 7;
    if ( v29 == 2 )
    {
      v2.n64_f32[0] = *(float *)&m_pEntLockOnTarget[20].m_nFlags / 1000.0;
      if ( m_pEntLockOnTarget == CVehicle::m_pTappedGasTankVehicle )
      {
        CVehicle::GetGasTankPosition(&v113, (CVehicle *)m_pEntLockOnTarget);
        posn = v113.RwV3d_0;
        goto LABEL_79;
      }
      m_pMat = m_pEntLockOnTarget->m_pMat;
      p_tx = &m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pEntLockOnTarget->m_transform.m_translate.x;
      v44 = (float)(m_pEntLockOnTarget[1].m_transform.m_heading + *(float *)&m_pEntLockOnTarget[1].m_nFlags)
          * CTimer::ms_fTimeStep;
      y = p_tx[1];
      z = p_tx[2];
      v47 = (float)(*(float *)&m_pEntLockOnTarget[1].m_pMat + *(float *)&m_pEntLockOnTarget[1].m_nFlags.bdummy)
          * CTimer::ms_fTimeStep;
      v48 = *p_tx
          + (float)((float)(m_pEntLockOnTarget[1].m_transform.m_translate.z
                          + *(float *)&m_pEntLockOnTarget[1].m_pRwObject)
                  * CTimer::ms_fTimeStep);
    }
    else
    {
      if ( v29 == 4 )
      {
        v2.n64_f32[0] = *(float *)&m_pEntLockOnTarget[5].m_pLastRenderedLink / 1000.0;
        v49 = m_pEntLockOnTarget->m_pMat;
        v50 = CTimer::ms_fTimeStep * m_pEntLockOnTarget[1].m_transform.m_translate.z;
        p_x = &v49->tx;
        v44 = CTimer::ms_fTimeStep * m_pEntLockOnTarget[1].m_transform.m_heading;
        if ( !v49 )
          p_x = &m_pEntLockOnTarget->m_transform.m_translate.x;
        v47 = CTimer::ms_fTimeStep * *(float *)&m_pEntLockOnTarget[1].m_pMat;
        x = *p_x;
        y = p_x[1];
        z = p_x[2];
      }
      else
      {
        if ( v29 != 3 )
        {
          v2.n64_u32[0] = 1.0;
          v53 = m_pEntLockOnTarget->m_pMat;
          p_m_transform = (CSimpleTransform *)&v53->tx;
          if ( !v53 )
            p_m_transform = &m_pEntLockOnTarget->m_transform;
          v55 = *(_QWORD *)&p_m_transform->m_translate.x;
          posn.z = p_m_transform->m_translate.z;
          *(_QWORD *)&posn.x = v55;
          goto LABEL_80;
        }
        m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
        WeaponSkill = CPed::GetWeaponSkill(this);
        v32 = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
        v33 = this->m_pEntLockOnTarget;
        v2.n64_f32[0] = *(float *)&v33[22].m_nFlags / *(float *)&v33[22].m_nFlags.bdummy;
        TargetHeadRange = CWeaponInfo::GetTargetHeadRange(v32);
        if ( !CPed::IsAlive((const CPed *)v33)
          || CWeaponInfo::GetWeaponInfo(this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType, 1)->m_eFireType != FIRETYPE_INSTANT_HIT )
        {
          goto LABEL_65;
        }
        v35 = this->m_pMat;
        v36 = v33->m_pMat;
        v37 = (CSimpleTransform *)&v35->tx;
        if ( !v35 )
          v37 = &this->m_transform;
        v38 = (CSimpleTransform *)&v36->tx;
        if ( !v36 )
          v38 = &v33->m_transform;
        v39.n64_u64[0] = vsub_f32(*(float32x2_t *)&v38->m_translate.y, *(float32x2_t *)&v37->m_translate.y).n64_u64[0];
        v40 = vmul_f32(v39, v39).n64_u64[0];
        if ( (float)((float)((float)((float)(v38->m_translate.x - v37->m_translate.x)
                                   * (float)(v38->m_translate.x - v37->m_translate.x))
                           + *(float *)&v40)
                   + *((float *)&v40 + 1)) < (float)(TargetHeadRange * TargetHeadRange) )
          v41 = 1;
        else
LABEL_65:
          v41 = CPlayerPed::bSwipeTargetHeads;
        v76 = v41 == 0;
        v56 = 3;
        v57 = 1045220557;
        if ( !v76 )
        {
          v57 = 1028443341;
          v56 = 5;
        }
        this->m_pPlayerData->m_nTargetBone = v56;
        LODWORD(this->m_pPlayerData->m_vecTargetBoneOffset.x) = v57;
        v58 = this->m_pPlayerData;
        v59 = *(_QWORD *)&v58->m_vecTargetBoneOffset.x;
        posn.z = v58->m_vecTargetBoneOffset.z;
        *(_QWORD *)&posn.x = v59;
        CPed::GetTransformedBonePosition((CPed *)v33, &posn, v58->m_nTargetBone, 0);
        m_heading = v33[19].m_transform.m_heading;
        if ( v2.n64_f32[0] <= 0.0
          || (LOWORD(m_heading) & 0x100) != 0
          || v33[18].m_pRwObject == (RwObject_0 *)((char *)&dword_0 + 1) )
        {
          if ( (LOWORD(m_heading) & 0x100) == 0 || (m_pLastRenderedLink = (float *)v33[23].m_pLastRenderedLink) == 0 )
          {
LABEL_79:
            if ( v2.n64_f32[0] <= 0.0 )
            {
              LOBYTE(blue) = 0;
              LOBYTE(v65) = 0;
              LOBYTE(red) = 0;
              goto LABEL_82;
            }
LABEL_80:
            v1.n64_u32[0] = 1.0;
            v62 = vmin_f32(v2, v1).n64_f32[0];
            v63 = (float)(1.0 - v62) * 0.0;
            blue = (unsigned int)(float)((float)(v62 * 0.0) + v63);
            v65 = (unsigned int)(float)((float)(v62 * 255.0) + v63);
            red = (unsigned int)(float)((float)(v62 * 0.0) + (float)((float)(1.0 - v62) * 255.0));
LABEL_82:
            v67 = this->m_pMat;
            LODWORD(v115.x) = &v67->tx;
            v115.y = posn.y;
            if ( !v67 )
              LODWORD(v115.x) = &this->m_transform;
            v115.z = posn.z;
            v68 = posn.x - *(float *)LODWORD(v115.x);
            v69 = posn.y - *(float *)(LODWORD(v115.x) + 4);
            v70 = posn.z - *(float *)(LODWORD(v115.x) + 8);
            v115.x = posn.x;
            CWeaponEffects::MarkTarget(
              this->m_nPedType,
              v115,
              red,
              v65,
              blue,
              0xFFu,
              (float)(sqrtf((float)((float)(v68 * v68) + (float)(v69 * v69)) + (float)(v70 * v70)) / -50.0) + 1.0,
              0);
            goto LABEL_85;
          }
          v50 = (float)(m_pLastRenderedLink[18] + m_pLastRenderedLink[21]) * CTimer::ms_fTimeStep;
          v44 = (float)(m_pLastRenderedLink[19] + m_pLastRenderedLink[22]) * CTimer::ms_fTimeStep;
          v47 = (float)(m_pLastRenderedLink[20] + m_pLastRenderedLink[23]) * CTimer::ms_fTimeStep;
        }
        else
        {
          v50 = CTimer::ms_fTimeStep * v33[1].m_transform.m_translate.z;
          v44 = CTimer::ms_fTimeStep * v33[1].m_transform.m_heading;
          v47 = CTimer::ms_fTimeStep * *(float *)&v33[1].m_pMat;
        }
        x = posn.x;
        y = posn.y;
        z = posn.z;
      }
      v48 = v50 + x;
    }
    posn.x = v48;
    posn.y = v44 + y;
    posn.z = v47 + z;
    goto LABEL_79;
  }
LABEL_85:
  m_eMoveState = this->m_eMoveState;
  if ( m_eMoveState )
  {
    if ( m_eMoveState == PEDMOVE_RUN )
    {
      m_fSprintEnergy = this->m_pPlayerData->m_fSprintEnergy;
      if ( m_fSprintEnergy >= CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY) )
        goto LABEL_99;
      v73 = this->m_pPlayerData;
      v74 = v73->m_fSprintEnergy + (float)((float)(CTimer::ms_fTimeStep * 0.3) * 0.5);
      goto LABEL_98;
    }
    if ( m_eMoveState != PEDMOVE_SPRINT )
    {
      v72 = this->m_pPlayerData->m_fSprintEnergy;
      if ( v72 < CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY) )
      {
LABEL_89:
        v73 = this->m_pPlayerData;
        v74 = (float)(CTimer::ms_fTimeStep * 0.5) + v73->m_fSprintEnergy;
LABEL_98:
        v73->m_fSprintEnergy = v74;
      }
    }
  }
  else if ( *((unsigned __int8 *)&this->m_nPedFlags + 1) << 31 )
  {
    m_pMyVehicle = this->m_pMyVehicle;
    v76 = m_pMyVehicle == 0;
    if ( m_pMyVehicle )
      v76 = m_pMyVehicle->m_vehicleType == 10;
    if ( !v76 )
    {
      v77 = this->m_pPlayerData->m_fSprintEnergy;
      if ( v77 < CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY) )
        goto LABEL_89;
    }
  }
LABEL_99:
  CWeapon::Update(&this->m_WeaponSlots[this->m_nCurrentWeapon], this);
  m_nPedState = this->m_nPedState;
  if ( m_nPedState != PED_DIE )
  {
    if ( m_nPedState == PED_DEAD )
    {
      if ( this->m_nPedType <= 1u )
        goto LABEL_104;
      goto LABEL_192;
    }
    if ( !pPad )
    {
      CPlayerPed::ProcessAnimGroups(this);
      goto LABEL_138;
    }
    if ( CPad::WeaponJustDown(pPad, this, 1, 0) )
    {
      v80 = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
      if ( (!CCamera::Using1stPersonWeaponMode(&TheCamera)
         || this->m_WeaponSlots[this->m_nCurrentWeapon].m_eState == WEAPONSTATE_OUT_OF_AMMO)
        && !CPedIntelligence::GetTaskSwim(this->m_pPedIntelligence) )
      {
        if ( v80 == WEAPONTYPE_SNIPERRIFLE )
        {
          v81 = 41;
        }
        else
        {
          if ( (unsigned int)(v80 - 35) > 1 )
            goto LABEL_119;
          v81 = 42;
        }
        CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, v81, 0.0, 1.0);
      }
    }
LABEL_119:
    if ( CPed::IsPedShootable(this)
      && this->m_nPedState != PED_ANSWER_MOBILE
      && !CWorld::Players[CWorld::FindPlayerSlotWithPedPointer(this)].pRemoteVehicle )
    {
      CPlayerPed::ProcessWeaponSwitch(this, pPad);
    }
    CPlayerPed::ProcessAnimGroups(this);
    ActiveCam = TheCamera.ActiveCam;
    if ( TheCamera.Cams[TheCamera.ActiveCam].Mode == 4 && !TheCamera.Cams[TheCamera.ActiveCam].DirectionWasLooking )
    {
      this->m_nLookTimer = 0;
      v83 = atan2f(
              COERCE_FLOAT(LODWORD(TheCamera.Cams[ActiveCam].Front.x) ^ 0x80000000),
              TheCamera.Cams[ActiveCam].Front.y);
      v84 = CGeneral::LimitRadianAngle(v83);
      if ( this->m_nPedState == PED_ATTACK
        || (v85 = v84, m_fCurrentHeading = this->m_fCurrentHeading, v87 = fabsf(v84 - m_fCurrentHeading), v87 <= 0.5236)
        || v87 >= 5.7596 )
      {
        CPed::ClearLookFlag(this);
      }
      else
      {
        if ( v87 > 2.618 && v87 < 3.6652 )
        {
          v88 = CGeneral::LimitRadianAngle(m_fCurrentHeading + -2.618);
          v89 = CGeneral::LimitRadianAngle(this->m_fCurrentHeading + 2.618);
          m_fLookHeading = this->m_fLookHeading;
          if ( m_fLookHeading == 1000000.0 || (*((_BYTE *)&this->m_nPedFlags + 3) & 4) != 0 )
          {
            v85 = v88;
          }
          else
          {
            v85 = v89;
            if ( fabsf(v88 - m_fLookHeading) < fabsf(v89 - m_fLookHeading) )
              v85 = v88;
          }
        }
        CPed::SetLookFlag(this, v85, 1, 0);
        CPed::SetLookTimer(
          this,
          (unsigned int)(float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) * 5.0));
      }
    }
LABEL_138:
    if ( this->m_eMoveState == PEDMOVE_SPRINT && (*(_BYTE *)&this->m_nPedFlags & 4) != 0 )
    {
      CPed::ClearLookFlag(this);
      CPed::SetLookTimer(this, 0xFAu);
    }
    v91 = this->m_pPlayerData;
    if ( sqrtf(
           (float)(this->m_vecMoveSpeed.x * this->m_vecMoveSpeed.x)
         + (float)(this->m_vecMoveSpeed.y * this->m_vecMoveSpeed.y)) >= 0.1 )
    {
      v91->m_nStandStillTimer = 0;
      v91 = this->m_pPlayerData;
      v93 = *((_WORD *)v91 + 26) & 0xFFFE;
    }
    else
    {
      m_nStandStillTimer = v91->m_nStandStillTimer;
      if ( !m_nStandStillTimer )
      {
        v91->m_nStandStillTimer = CTimer::m_snTimeInMilliseconds + 500;
        goto LABEL_148;
      }
      if ( CTimer::m_snTimeInMilliseconds <= m_nStandStillTimer )
      {
LABEL_148:
        if ( this->m_pPlayerData->m_bDontAllowWeaponChange && CPed::IsPlayer(this) && !CPad::GetTarget(Pad, 0) )
          this->m_pPlayerData->m_bDontAllowWeaponChange = 0;
        if ( this->m_nPedState != PED_SNIPER_MODE
          && this->m_WeaponSlots[this->m_nCurrentWeapon].m_eState == WEAPONSTATE_FIRING )
        {
          this->m_pPlayerData->m_LastTimeFiring = CTimer::m_snTimeInMilliseconds;
        }
        CPlayerPed::ProcessGroupBehaviour(this, pPad);
        if ( *((unsigned __int8 *)&this->m_nPedFlags + 1) << 31 )
          CCarCtrl::RegisterVehicleOfInterest(this->m_pMyVehicle);
        if ( !(*(_BYTE *)&this->m_nFlags >> 7) )
          CEntity::UpdateRpHAnim(this);
        if ( *((unsigned __int8 *)&this->m_nPedFlags + 1) << 31 )
        {
          if ( Pad->NewState.DPadDown && !Pad->OldState.DPadDown )
          {
            v94 = this->m_pPlayerData;
            v95 = 0;
            goto LABEL_166;
          }
          if ( Pad->NewState.DPadUp && !Pad->OldState.DPadUp )
          {
            v94 = this->m_pPlayerData;
            v95 = 1;
LABEL_166:
            v94->m_playersGangActive = v95;
          }
        }
        if ( *((unsigned __int8 *)&this->m_nPhysicalFlags + 1) << 31 )
        {
          v98 = this->m_pMat;
          v99 = (CSimpleTransform *)&v98->tx;
          if ( !v98 )
            v99 = &this->m_transform;
          v100 = v99->m_translate.z;
          if ( CWaterLevel::GetWaterLevel(
                 v99->m_translate.x,
                 v99->m_translate.y,
                 v100 + 1.5,
                 &this->m_pPlayerData->m_waterHeight,
                 1,
                 0) != 1 )
          {
            *(_DWORD *)&this->m_nPhysicalFlags &= ~0x100u;
            goto LABEL_178;
          }
          v101 = CEntity::GetColModel(this)->m_boxBound.m_vecMin.z;
          v102 = CEntity::GetColModel(this)->m_boxBound.m_vecMax.z;
          v96 = this->m_pPlayerData;
          v103 = v100 + v102;
          m_waterHeight = v96->m_waterHeight;
          if ( m_waterHeight >= v103 )
          {
            LOBYTE(v97) = 100;
            goto LABEL_170;
          }
          if ( m_waterHeight > (float)(v100 + v101) )
          {
            v97 = (unsigned int)(float)((float)((float)(m_waterHeight - (float)(v100 + v101))
                                              / (float)(v103 - (float)(v100 + v101)))
                                      * 100.0);
            goto LABEL_170;
          }
        }
        else
        {
          v96 = this->m_pPlayerData;
        }
        LOBYTE(v97) = 0;
LABEL_170:
        v96->m_waterCoverPerc = v97;
LABEL_178:
        if ( !((unsigned __int8)CTimer::m_FrameCounter << 25) && !FindPlayerVehicle(-1, 0) )
        {
          m_PlayerGroup = this->m_pPlayerData->m_PlayerGroup;
          if ( CPedGroups::ms_groups[m_PlayerGroup].m_followLeader )
          {
            v107 = CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[m_PlayerGroup].m_membership);
            if ( v107 >= 1
              && CPedGroup::FindDistanceToNearestMember(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup], 0) > 20.0
              && CPedGroup::FindDistanceToNearestMember(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup], 0) < 100.0
              && CGame::currArea == AREA_MAIN_MAP )
            {
              if ( v107 == 1 )
                v108 = 158;
              else
                v108 = 157;
              CPed::Say(this, v108, 0, 1.0, 0, 0, 0);
              for ( i = 0; i != 7; ++i )
              {
                Member = CPedGroupMembership::GetMember(
                           &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership,
                           i);
                if ( Member && (float)((float)((float)rand() * 4.6566e-10) + 0.0) < 0.5 )
                {
                  v111 = rand();
                  CPed::Say(
                    Member,
                    0x5Cu,
                    (int)(float)((float)((float)v111 * 0.000015259) * 1500.0) + 3000,
                    1.0,
                    0,
                    0,
                    0);
                }
              }
            }
          }
        }
        if ( !(*((unsigned __int8 *)&this->m_nPedFlags + 1) << 31)
          && CPhysical::GetLightingTotal(this) <= 0.05
          && !CEntryExitManager::WeAreInInteriorTransition() )
        {
          CPed::Say(this, 0x152u, 0, 1.0, 0, 0, 0);
        }
        if ( !FindPlayerPed(-1)
          || (PlayerPed = FindPlayerPed(-1), !CPedIntelligence::GetUsingParachute(PlayerPed->m_pPedIntelligence)) )
        {
          if ( (MobileSettings::IsLockOnMode() || CHID::GetInputType() == 1)
            && !CPad::WeaponUsesTargetingButton()
            && !CCamera::Using1stPersonWeaponMode(&TheCamera)
            && this->m_nPedState != PED_DRIVING
            && !CPedIntelligence::GetTaskHold(this->m_pPedIntelligence, 0)
            && !CPedIntelligence::GetTaskSwim(this->m_pPedIntelligence)
            && !CRopes::PlayerControlsCrane
            && CWeaponInfo::GetWeaponInfo(this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType, 1)->m_eFireType
            && CTouchInterface::IsReleased(WIDGET_ATTACK, 0, -1) )
          {
            *((_WORD *)this->m_pPlayerData + 26) &= ~8u;
            CPed::SetWeaponLockOnTarget(this, 0);
            goto LABEL_105;
          }
        }
        goto LABEL_192;
      }
      v93 = *((_WORD *)v91 + 26) | 1;
    }
    *((_WORD *)v91 + 26) = v93;
    goto LABEL_148;
  }
  if ( this->m_nPedType <= 1u )
  {
LABEL_104:
    CPed::SetWeaponLockOnTarget(this, 0);
    CCamera::ClearPlayerWeaponMode(&TheCamera);
LABEL_105:
    CWeaponEffects::ClearCrossHair(this->m_nPedType);
  }
LABEL_192:
  CHID::currentInstanceIndex = v4;
}
// 4C4DA4: variable 'v2' is possibly undefined
// 4C4DA4: variable 'v1' is possibly undefined
// 0: using guessed type int dword_0;

//----- (004C56F4) --------------------------------------------------------
void __fastcall CPlayerPed::HandlePlayerBreath(CPlayerPed *this, bool bUnderwater, float fRate)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d2
  bool v7; // zf
  CPlayerPedData **p_m_pPlayerData; // r5
  CPlayerPedData *m_pPlayerData; // r0
  float m_fBreath; // s2
  _BOOL4 IsAlive; // r0
  float v12; // s18

  v7 = CCheat::m_aCheatsActive[70] == 0;
  if ( !CCheat::m_aCheatsActive[70] )
    v7 = bUnderwater;
  if ( v7 )
  {
    p_m_pPlayerData = &this->m_pPlayerData;
    m_pPlayerData = this->m_pPlayerData;
    v3.n64_f32[0] = CTimer::ms_fTimeStep * fRate;
    m_fBreath = m_pPlayerData->m_fBreath;
    if ( m_fBreath > 0.0 && (*((_BYTE *)&this->m_nPedFlags + 6) & 0x10) != 0 )
    {
      v3.n64_f32[0] = m_fBreath - v3.n64_f32[0];
      v4.n64_u32[0] = 0;
      LODWORD(m_pPlayerData->m_fBreath) = vmax_f32(v3, v4).n64_u32[0];
    }
    else
    {
      CWeapon::GenerateDamageEvent(
        this,
        this,
        WEAPONTYPE_DROWNING,
        (int)(float)(v3.n64_f32[0] * 3.0),
        PED_SPHERE_CHEST,
        0);
    }
  }
  else
  {
    IsAlive = CPed::IsAlive(this);
    p_m_pPlayerData = &this->m_pPlayerData;
    if ( IsAlive )
    {
      v12 = (*p_m_pPlayerData)->m_fBreath;
      if ( v12 < CStats::GetFatAndMuscleModifier(STAT_MODIFIER_BREATH_UNDERWATER) )
        (*p_m_pPlayerData)->m_fBreath = (float)((float)(fRate + fRate) * CTimer::ms_fTimeStep)
                                      + (*p_m_pPlayerData)->m_fBreath;
    }
  }
  *((_WORD *)*p_m_pPlayerData + 26) &= ~0x80u;
}
// 4C57B8: variable 'v3' is possibly undefined
// 4C57B8: variable 'v4' is possibly undefined

//----- (004C57E4) --------------------------------------------------------
void __fastcall CPlayerPed::Clear3rdPersonMouseTarget(CPlayerPed *this)
{
  CPed *m_pMouseLockOnRecruitPed; // r0
  CPed **p_m_pMouseLockOnRecruitPed; // r4

  m_pMouseLockOnRecruitPed = this->m_pMouseLockOnRecruitPed;
  if ( m_pMouseLockOnRecruitPed )
  {
    p_m_pMouseLockOnRecruitPed = &this->m_pMouseLockOnRecruitPed;
    CEntity::CleanUpOldReference(m_pMouseLockOnRecruitPed, &this->m_pMouseLockOnRecruitPed);
    *p_m_pMouseLockOnRecruitPed = 0;
  }
}

//----- (004C5808) --------------------------------------------------------
bool __fastcall CPlayerPed::HandleSprintEnergy(CPlayerPed *this, bool bSprint, float fRate)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  bool result; // r0
  float m_fSprintEnergy; // s18
  CPlayerPedData *m_pPlayerData; // r1

  if ( !bSprint )
  {
    m_fSprintEnergy = this->m_pPlayerData->m_fSprintEnergy;
    if ( m_fSprintEnergy < CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY) )
      this->m_pPlayerData->m_fSprintEnergy = this->m_pPlayerData->m_fSprintEnergy
                                           + (float)((float)(CTimer::ms_fTimeStep * fRate) * 0.5);
    return 0;
  }
  if ( CWorld::Players[CWorld::PlayerInFocus].DoesNotGetTired )
    return 1;
  result = 1;
  if ( fRate != 0.0 )
  {
    m_pPlayerData = this->m_pPlayerData;
    if ( (*((_WORD *)m_pPlayerData + 26) & 2) == 0 )
    {
      v3.n64_u32[0] = -1021968384;
      v4.n64_u32[0] = LODWORD(m_pPlayerData->m_fSprintEnergy);
      if ( v4.n64_f32[0] > -150.0 )
      {
        v4.n64_f32[0] = v4.n64_f32[0] - (float)(CTimer::ms_fTimeStep * fRate);
        LODWORD(m_pPlayerData->m_fSprintEnergy) = vmax_f32(v4, v3).n64_u32[0];
        return 1;
      }
      return 0;
    }
  }
  return result;
}
// 4C58C4: variable 'v4' is possibly undefined
// 4C58C4: variable 'v3' is possibly undefined

//----- (004C58E4) --------------------------------------------------------
void __fastcall CPlayerPed::ClearWeaponTarget(CPlayerPed *this)
{
  if ( this->m_nPedType <= 1u )
  {
    CPed::SetWeaponLockOnTarget(this, 0);
    CCamera::ClearPlayerWeaponMode(&TheCamera);
    sub_193994(this->m_nPedType);
  }
}

//----- (004C5918) --------------------------------------------------------
void __fastcall CPlayerPed::ProcessWeaponSwitch(CPlayerPed *this, CPad *pPad)
{
  int v4; // r0
  bool v5; // zf
  CTaskSimpleUseGun *TaskUseGun; // r0
  int v7; // r0
  CPlayerPedData *m_pPlayerData; // r0
  unsigned int v9; // r0
  CPlayerPedData *v10; // r0
  int m_nChosenWeapon; // r1
  eWeaponType m_eWeaponType; // r2
  unsigned int v13; // r2
  CPlayerPedData *v14; // r0
  int v15; // r1
  char *v16; // r0
  unsigned int v17; // r0
  CPlayerPedData *v18; // r0
  int v19; // r1
  eWeaponType v20; // r2
  unsigned int v21; // r2
  CPlayerPedData *v22; // r1
  int v23; // r0
  char *v24; // r0
  CPlayerPed *PlayerPed; // r6
  CPlayerPed *v26; // r0
  bool v27; // zf
  eWeaponType v28; // r0
  bool v29; // zf
  int8 v30; // r0
  CPlayerPedData *v31; // r2
  char v32; // r1
  int8 *p_m_nChosenWeapon; // r2
  int v34; // t1
  bool v35; // zf

  v4 = CDarkel::FrenzyOnGoing();
  v5 = v4 == 0;
  if ( !v4 )
    v5 = this->m_pAttachToEntity == 0;
  if ( !v5 )
    goto LABEL_4;
  if ( !this->m_pEntLockOnTarget )
  {
    m_pPlayerData = this->m_pPlayerData;
    if ( (*((_WORD *)m_pPlayerData + 26) & 8) == 0
      && (*((_WORD *)m_pPlayerData + 26) & 0x800) == 0
      && !m_pPlayerData->m_bDontAllowWeaponChange
      && !CPedIntelligence::GetTaskJetPack(this->m_pPedIntelligence) )
    {
      if ( CPad::CycleWeaponRightJustDown(pPad) )
      {
        switch ( TheCamera.PlayerWeaponMode.Mode )
        {
          case 7:
          case 8:
          case 0x22:
          case 0x27:
          case 0x28:
          case 0x2A:
          case 0x2E:
          case 0x33:
          case 0x34:
            goto LABEL_56;
          default:
            this->m_pPlayerData->m_nChosenWeapon = this->m_nCurrentWeapon + 1;
            break;
        }
        while ( 1 )
        {
          v9 = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode - 48;
          if ( v9 <= 6 && ((1 << v9) & 0x47) != 0 )
          {
            v10 = this->m_pPlayerData;
            m_nChosenWeapon = v10->m_nChosenWeapon;
            m_eWeaponType = this->m_WeaponSlots[m_nChosenWeapon].m_eWeaponType;
            if ( (unsigned int)(m_eWeaponType - 33) <= 1 )
            {
              v10->m_nChosenWeapon = m_nChosenWeapon + 1;
              v10 = this->m_pPlayerData;
              m_nChosenWeapon = v10->m_nChosenWeapon;
              m_eWeaponType = this->m_WeaponSlots[m_nChosenWeapon].m_eWeaponType;
            }
            v13 = m_eWeaponType - 19;
            if ( v13 <= 0x11 && ((1 << v13) & 0x30003) != 0 )
              v10->m_nChosenWeapon = m_nChosenWeapon + 1;
          }
          v14 = this->m_pPlayerData;
          v15 = v14->m_nChosenWeapon;
          if ( v15 >= 13 )
            break;
          v16 = (char *)this + 28 * v15;
          if ( *((_DWORD *)v16 + 361)
            && CWeapon::HasWeaponAmmoToBeUsed((CWeapon *)(v16 + 1444))
            && (CGameLogic::IsCoopGameGoingOn() != 1
             || CWeapon::CanBeUsedFor2Player(&this->m_WeaponSlots[this->m_pPlayerData->m_nChosenWeapon])) )
          {
            goto LABEL_53;
          }
          ++this->m_pPlayerData->m_nChosenWeapon;
        }
        v14->m_nChosenWeapon = 0;
LABEL_53:
        PlayerPed = FindPlayerPed(-1);
        if ( PlayerPed->m_nPedType > 1u )
          goto LABEL_55;
        goto LABEL_54;
      }
      if ( CPad::CycleWeaponLeftJustDown(pPad) )
      {
        switch ( TheCamera.PlayerWeaponMode.Mode )
        {
          case 7:
          case 8:
          case 0x22:
          case 0x2E:
          case 0x33:
            break;
          default:
            for ( this->m_pPlayerData->m_nChosenWeapon = this->m_nCurrentWeapon - 1;
                  ;
                  --this->m_pPlayerData->m_nChosenWeapon )
            {
              v17 = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode - 48;
              if ( v17 <= 6 && ((1 << v17) & 0x47) != 0 )
              {
                v18 = this->m_pPlayerData;
                v19 = v18->m_nChosenWeapon;
                v20 = this->m_WeaponSlots[v19].m_eWeaponType;
                if ( (unsigned int)(v20 - 33) <= 1 )
                {
                  v18->m_nChosenWeapon = v19 + 1;
                  v18 = this->m_pPlayerData;
                  v19 = v18->m_nChosenWeapon;
                  v20 = this->m_WeaponSlots[v19].m_eWeaponType;
                }
                v21 = v20 - 19;
                if ( v21 <= 0x11 && ((1 << v21) & 0x30003) != 0 )
                  v18->m_nChosenWeapon = v19 - 1;
              }
              v22 = this->m_pPlayerData;
              v23 = v22->m_nChosenWeapon;
              if ( v23 <= -1 )
              {
                v22->m_nChosenWeapon = 12;
                v23 = (unsigned __int8)this->m_pPlayerData->m_nChosenWeapon;
              }
              if ( !(v23 << 24) )
                break;
              v24 = (char *)this + 28 * (char)v23;
              if ( *((_DWORD *)v24 + 361) )
              {
                if ( CWeapon::HasWeaponAmmoToBeUsed((CWeapon *)(v24 + 1444))
                  && (CGameLogic::IsCoopGameGoingOn() != 1
                   || CWeapon::CanBeUsedFor2Player(&this->m_WeaponSlots[this->m_pPlayerData->m_nChosenWeapon])) )
                {
                  break;
                }
              }
            }
            PlayerPed = FindPlayerPed(-1);
            if ( PlayerPed->m_nPedType <= 1u )
            {
LABEL_54:
              CPed::SetWeaponLockOnTarget(PlayerPed, 0);
              CCamera::ClearPlayerWeaponMode(&TheCamera);
              CWeaponEffects::ClearCrossHair(PlayerPed->m_nPedType);
            }
LABEL_55:
            v26 = FindPlayerPed(-1);
            *((_WORD *)v26->m_pPlayerData + 26) &= ~8u;
            break;
        }
      }
    }
  }
LABEL_56:
  if ( CWeaponInfo::GetWeaponInfo(this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType, 1)->m_eFireType == FIRETYPE_MELEE
    || this->m_WeaponSlots[this->m_nCurrentWeapon].m_nAmmoTotal > 0
    || CPad::GetWeapon(pPad, this, 1) && this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_MINIGUN )
  {
LABEL_4:
    if ( this->m_pPlayerData->m_nChosenWeapon != this->m_nCurrentWeapon )
    {
      if ( !CPedIntelligence::GetTaskUseGun(this->m_pPedIntelligence)
        || (TaskUseGun = CPedIntelligence::GetTaskUseGun(this->m_pPedIntelligence), TaskUseGun->m_nLastCommand != 4)
        || !TaskUseGun->m_pAnim )
      {
        CPed::RemoveWeaponAnims(this, this->m_nCurrentWeapon, -1000.0);
        v7 = this->m_pPlayerData->m_nChosenWeapon;
        if ( v7 != -1 )
          CPlayerPed::MakeChangesForNewWeapon(this, this->m_WeaponSlots[v7].m_eWeaponType);
      }
    }
    return;
  }
  if ( (unsigned int)(unsigned __int16)TheCamera.PlayerWeaponMode.Mode - 7 >= 2 )
  {
    v27 = TheCamera.PlayerWeaponMode.Mode == 34;
    if ( TheCamera.PlayerWeaponMode.Mode != 34 )
      v27 = TheCamera.PlayerWeaponMode.Mode == 51;
    if ( !v27 )
    {
      v28 = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
      v29 = v28 == WEAPONTYPE_DETONATOR;
      if ( v28 == WEAPONTYPE_DETONATOR )
        v29 = this->m_WeaponSlots[8].m_eWeaponType == WEAPONTYPE_REMOTE_SATCHEL_CHARGE;
      if ( v29 )
      {
        v30 = 1;
      }
      else if ( CPedIntelligence::GetTaskJetPack(this->m_pPedIntelligence) )
      {
        if ( this->m_WeaponSlots[2].m_eWeaponType == WEAPONTYPE_UNARMED || this->m_WeaponSlots[2].m_nAmmoTotal <= 0 )
          return;
        v30 = 2;
      }
      else if ( this->m_WeaponSlots[5].m_eWeaponType )
      {
        v30 = 5;
      }
      else if ( this->m_WeaponSlots[4].m_eWeaponType )
      {
        v30 = 4;
      }
      else if ( this->m_WeaponSlots[3].m_eWeaponType )
      {
        v30 = 3;
      }
      else
      {
        v30 = this->m_nCurrentWeapon - 1;
      }
      for ( this->m_pPlayerData->m_nChosenWeapon = v30; ; this->m_pPlayerData->m_nChosenWeapon = v32 - 1 )
      {
        v31 = this->m_pPlayerData;
        v34 = v31->m_nChosenWeapon;
        p_m_nChosenWeapon = &v31->m_nChosenWeapon;
        v32 = v34;
        if ( v34 < 0 )
          break;
        v35 = v32 == 5;
        if ( v32 == 5 )
          v35 = this->m_WeaponSlots[5].m_eWeaponType == WEAPONTYPE_BASEBALLBAT;
        if ( v35 || this->m_WeaponSlots[v32].m_nAmmoTotal >= 1 && (unsigned __int8)(v32 - 16) > 2u )
          goto LABEL_4;
      }
      *p_m_nChosenWeapon = 0;
      goto LABEL_4;
    }
  }
}
// 54: using guessed type int dword_54;

//----- (004C5E60) --------------------------------------------------------
void __fastcall CPlayerPed::ProcessAnimGroups(CPlayerPed *this)
{
  AssocGroupId m_motionAnimGroup; // r5
  float m_fFPSMoveHeading; // s0
  uint32 m_hashKey; // r0
  RpClump_0 *m_pWeaponClump; // r0
  CClumpModelInfo *ClumpModelInfo; // r0
  CClumpModelInfo *v7; // r5
  int (**v8)(void); // r4
  int v9; // r0
  int v10; // r4
  signed int v11; // r6
  CAnimBlendAssociation *Association; // r5
  CAnimBlendAssociation *v13; // r0
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  bool v17; // zf
  _BOOL4 v18; // r5
  AssocGroupId v19; // r0
  int m_defaultCombo; // r0
  _BOOL4 v21; // r9
  AssocGroupId m_MeleeWeaponAnimReferenced; // r9
  AssocGroupId nAnimGroup; // r5
  CAnimBlock *m_pAnimBlock; // r0
  const unsigned __int8 *AnimBlockName; // r0
  _BOOL4 m_loaded; // r2
  int v27; // r0
  int m_nExtraMeleeCombo; // r0
  int v29; // r6
  int v30; // r0
  AssocGroupId m_MeleeWeaponAnimReferencedExtra; // r5
  AssocGroupId v32; // r8
  AssocGroupId v33; // r0
  CAnimBlock *AnimationBlock; // r0
  const unsigned __int8 *v35; // r0
  _BOOL4 v36; // r2
  int v37; // r0

  m_motionAnimGroup = this->m_motionAnimGroup;
  m_fFPSMoveHeading = this->m_pPlayerData->m_fFPSMoveHeading;
  if ( (m_fFPSMoveHeading <= -0.87266 || m_fFPSMoveHeading >= 0.87266)
    && CCam::Using3rdPersonMouseCam(&TheCamera.Cams[TheCamera.ActiveCam])
    && CPed::CanStrafeOrMouseControl(this) )
  {
    if ( m_motionAnimGroup != ANIM_PLAYER_PED )
    {
LABEL_24:
      m_hashKey = CClothes::GetDefaultPlayerMotionGroup() + m_motionAnimGroup - 54;
      goto LABEL_25;
    }
  }
  else
  {
    m_pWeaponClump = this->m_pWeaponClump;
    if ( m_pWeaponClump
      && (ClumpModelInfo = CVisibilityPlugins::GetClumpModelInfo(m_pWeaponClump), (v7 = ClumpModelInfo) != 0)
      && (*((int (__fastcall **)(CClumpModelInfo *))ClumpModelInfo->_vptr$CBaseModelInfo + 5))(ClumpModelInfo) == 4 )
    {
      v8 = v7[1]._vptr$CBaseModelInfo;
      if ( (unsigned int)v8 - 35 < 2 )
      {
        m_motionAnimGroup = ANIM_PLAYER_ROCKET_PED;
        goto LABEL_24;
      }
    }
    else
    {
      v8 = 0;
    }
    if ( CPedIntelligence::GetTaskJetPack(this->m_pPedIntelligence) )
    {
      m_hashKey = 70;
      goto LABEL_25;
    }
    if ( (unsigned int)v8 - 5 < 3 )
    {
      m_motionAnimGroup = ANIM_PLAYER_BBBAT_PED;
      goto LABEL_24;
    }
    if ( (unsigned int)v8 - 9 <= 0x1D )
    {
      v9 = 1 << ((_BYTE)v8 - 9);
      if ( (v9 & 0x3650000) != 0 )
      {
        m_motionAnimGroup = ANIM_PLAYER_2ARMED_PED;
        goto LABEL_24;
      }
      if ( (v9 & 0x30000001) != 0 )
      {
        m_motionAnimGroup = ANIM_PLAYER_CHAINSAW_PED;
        goto LABEL_24;
      }
    }
    if ( CPedClothesDesc::GetIsWearingBalaclava(this->m_pPlayerData->m_pClothes) )
    {
      m_hashKey = 69;
      goto LABEL_25;
    }
  }
  if ( this->m_nPedType != 1
    || (m_hashKey = CModelInfo::ms_modelInfoPtrs[this->m_nModelIndex][1].m_hashKey, m_hashKey == 54) )
  {
    m_motionAnimGroup = ANIM_PLAYER_PED;
    goto LABEL_24;
  }
LABEL_25:
  if ( this->m_motionAnimGroup != m_hashKey )
  {
    v10 = 0;
    this->m_motionAnimGroup = m_hashKey;
    do
    {
      v11 = dword_61DEC8[v10];
      Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, v11);
      if ( Association
        && Association->m_pAnimBlendHierarchy->m_hashKey != CAnimManager::GetAnimAssociation(
                                                              this->m_motionAnimGroup,
                                                              (AnimationId)v11)->m_pAnimBlendHierarchy->m_hashKey )
      {
        v13 = CAnimManager::AddAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, (AnimationId)v11);
        v13->m_fBlendDelta = Association->m_fBlendDelta;
        v13->m_fBlendAmount = Association->m_fBlendAmount;
        LOWORD(v13) = Association->m_bitsFlag;
        Association->m_fBlendDelta = -1000.0;
        Association->m_bitsFlag = (unsigned __int16)v13 | 4;
      }
      ++v10;
    }
    while ( v10 != 5 );
  }
  m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(this);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  v17 = WeaponInfo->m_eFireType == FIRETYPE_MELEE;
  if ( WeaponInfo->m_eFireType == FIRETYPE_MELEE )
    v17 = *((unsigned __int8 *)&this->m_nPedFlags + 1) << 31 == 0;
  if ( !v17 )
    goto LABEL_34;
  m_defaultCombo = WeaponInfo->m_defaultCombo;
  if ( m_defaultCombo == 4 )
  {
    v21 = this->m_pPlayerData->m_MeleeWeaponAnimReferenced != ANIM_STD_PED;
  }
  else
  {
    m_MeleeWeaponAnimReferenced = this->m_pPlayerData->m_MeleeWeaponAnimReferenced;
    nAnimGroup = CTaskSimpleFight::m_aComboData[m_defaultCombo - 4].nAnimGroup;
    if ( nAnimGroup == m_MeleeWeaponAnimReferenced )
    {
      v21 = 0;
    }
    else
    {
      m_pAnimBlock = CAnimManager::ms_aAnimAssocGroups[nAnimGroup].m_pAnimBlock;
      v21 = m_MeleeWeaponAnimReferenced != ANIM_STD_PED;
      if ( !m_pAnimBlock )
      {
        AnimBlockName = CAnimManager::GetAnimBlockName(nAnimGroup);
        m_pAnimBlock = CAnimManager::GetAnimationBlock(AnimBlockName);
      }
      m_loaded = m_pAnimBlock->m_loaded;
      v27 = m_pAnimBlock - CAnimManager::ms_aAnimBlocks;
      if ( m_loaded )
      {
        if ( this->m_pPlayerData->m_MeleeWeaponAnimReferenced == ANIM_STD_PED )
        {
          CAnimManager::AddAnimBlockRef(v27);
          this->m_pPlayerData->m_MeleeWeaponAnimReferenced = nAnimGroup;
        }
      }
      else
      {
        CStreaming::RequestModel(v27 + 25575, 8);
      }
    }
  }
  m_nExtraMeleeCombo = this->m_nExtraMeleeCombo;
  if ( m_nExtraMeleeCombo != 4 )
  {
    v30 = m_nExtraMeleeCombo;
    v29 = v21;
    if ( v21 )
      v29 = 1;
    m_MeleeWeaponAnimReferencedExtra = this->m_pPlayerData->m_MeleeWeaponAnimReferencedExtra;
    v32 = CTaskSimpleFight::m_aComboData[v30 - 4].nAnimGroup;
    if ( v32 != m_MeleeWeaponAnimReferencedExtra )
    {
      AnimationBlock = CAnimManager::ms_aAnimAssocGroups[v32].m_pAnimBlock;
      v18 = m_MeleeWeaponAnimReferencedExtra != ANIM_STD_PED;
      if ( !AnimationBlock )
      {
        v35 = CAnimManager::GetAnimBlockName(v32);
        AnimationBlock = CAnimManager::GetAnimationBlock(v35);
      }
      v36 = AnimationBlock->m_loaded;
      v37 = AnimationBlock - CAnimManager::ms_aAnimBlocks;
      if ( v36 )
      {
        if ( this->m_pPlayerData->m_MeleeWeaponAnimReferencedExtra )
        {
LABEL_58:
          if ( v29 != 1 )
            goto LABEL_59;
          goto LABEL_35;
        }
        CAnimManager::AddAnimBlockRef(v37);
        this->m_pPlayerData->m_MeleeWeaponAnimReferencedExtra = v32;
      }
      else
      {
        CStreaming::RequestModel(v37 + 25575, 8);
      }
      if ( !v21 )
        goto LABEL_59;
      goto LABEL_35;
    }
LABEL_57:
    v18 = 0;
    goto LABEL_58;
  }
  v29 = v21;
  if ( v21 )
    v29 = 1;
  if ( this->m_pPlayerData->m_MeleeWeaponAnimReferencedExtra == ANIM_STD_PED )
    goto LABEL_57;
  if ( v21 )
  {
LABEL_34:
    v18 = 1;
LABEL_35:
    v19 = this->m_pPlayerData->m_MeleeWeaponAnimReferenced;
    if ( v19 )
    {
      CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[v19].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
      this->m_pPlayerData->m_MeleeWeaponAnimReferenced = ANIM_STD_PED;
      if ( !v18 )
        return;
      goto LABEL_60;
    }
LABEL_59:
    if ( !v18 )
      return;
  }
LABEL_60:
  v33 = this->m_pPlayerData->m_MeleeWeaponAnimReferencedExtra;
  if ( v33 )
  {
    CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[v33].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
    this->m_pPlayerData->m_MeleeWeaponAnimReferencedExtra = ANIM_STD_PED;
  }
}
// 61DEC8: using guessed type _DWORD dword_61DEC8[5];

//----- (004C6210) --------------------------------------------------------
void __fastcall CPlayerPed::ProcessGroupBehaviour(CPlayerPed *this, CPad *pPad)
{
  CPed *m_pEntLockOnTarget; // r10
  int InputType; // r0
  int v4; // r11
  char v5; // r6
  int v6; // r5
  int i; // r4
  CPed *Member; // r0
  char v9; // r2
  char v10; // r4
  int v11; // r4
  CPlayerPedData *m_pPlayerData; // r0
  int m_DPadUpPressedInMilliseconds; // r1
  bool v14; // zf
  int v15; // r0
  UInt16 v16; // r1
  _BOOL4 GroupControlForward; // r0
  bool v18; // zf
  char v19; // r4
  int v20; // r4
  CPlayerPedData *v21; // r0
  int v22; // r0
  UInt16 v23; // r1
  int v24; // r0
  bool v25; // zf
  CPedPool *v26; // r8
  int32 m_nSize; // r0
  int v28; // r5
  int v29; // r6
  CAcquaintance *v30; // r4
  eWantedLevel m_WantedLevel; // r10
  uint32 PedFlag; // r2

  m_pEntLockOnTarget = (CPed *)this->m_pEntLockOnTarget;
  if ( !m_pEntLockOnTarget )
    m_pEntLockOnTarget = (CPed *)this->m_pEntMagnetizeTarget;
  InputType = CHID::GetInputType();
  if ( !m_pEntLockOnTarget && InputType == 2 )
    m_pEntLockOnTarget = this->m_pMouseLockOnRecruitPed;
  v4 = CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership);
  v5 = 0;
  if ( FindPlayerVehicle(-1, 0) )
  {
    v6 = 0;
  }
  else
  {
    v6 = 0;
    if ( v4 >= 1 )
    {
      v6 = 0;
      v5 = 0;
      for ( i = 0; i != v4; ++i )
      {
        Member = CPedGroupMembership::GetMember(
                   &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership,
                   i);
        v9 = (char)Member;
        if ( Member )
          v9 = 1;
        v6 |= (Member == m_pEntLockOnTarget) & (unsigned __int8)v9;
        if ( Member )
          v5 |= Member->m_nPedType == 8;
      }
    }
  }
  v10 = 0;
  if ( !FindPlayerVehicle(-1, 0) )
  {
    if ( !m_pEntLockOnTarget )
      v10 = 1;
    v11 = (unsigned __int8)v10 & (v4 > 0);
    if ( v11 && CPad::GetGroupControlForward(pPad, v5 & 1, 1) )
    {
      this->m_pPlayerData->m_DPadUpPressedInMilliseconds += (unsigned int)(float)((float)(CTimer::ms_fTimeStepNonClipped
                                                                                        / 50.0)
                                                                                * 1000.0);
      m_pPlayerData = this->m_pPlayerData;
      m_DPadUpPressedInMilliseconds = m_pPlayerData->m_DPadUpPressedInMilliseconds;
      v14 = m_DPadUpPressedInMilliseconds == 1200;
      if ( m_DPadUpPressedInMilliseconds == 1200 )
        v14 = *((unsigned __int8 *)m_pPlayerData + 53) << 31 == 0;
      if ( v14 )
      {
        v15 = CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[m_pPlayerData->m_PlayerGroup].m_membership);
        if ( v15 >= 1 )
        {
          if ( v15 == 1 )
            v16 = 150;
          else
            v16 = 149;
          CPed::Say(this, v16, 0, 1.0, 0, 0, 0);
        }
        CPedGroupMembership::RemoveAllFollowers(
          &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership,
          1);
      }
    }
    else
    {
      if ( m_pEntLockOnTarget
        && (*(_BYTE *)&m_pEntLockOnTarget->m_info & 7) == 3
        && (m_pEntLockOnTarget->m_nPedType == 8
         || (CCheat::m_aCheatsActive[86] | CCheat::m_aCheatsActive[84] | CCheat::m_aCheatsActive[85]) << 24) )
      {
        if ( !(v6 << 31) )
        {
          GroupControlForward = CPad::GetGroupControlForward(pPad, 1, 0);
          v18 = GroupControlForward;
          if ( GroupControlForward )
            v18 = *((unsigned __int8 *)this->m_pPlayerData + 53) << 31 == 0;
          if ( v18 )
            CPlayerPed::MakeThisPedJoinOurGroup(this, m_pEntLockOnTarget);
        }
      }
      else if ( v11 == 1 && CPad::GroupControlForwardJustDown(pPad, v5 & 1) )
      {
        CPlayerPed::TellGroupToStartFollowingPlayer(this, 1, 1, 0);
      }
      this->m_pPlayerData->m_DPadUpPressedInMilliseconds = 0;
    }
  }
  if ( !(*((unsigned __int8 *)this->m_pPlayerData + 53) << 31) )
  {
    v19 = 0;
    if ( !FindPlayerVehicle(-1, 0) )
    {
      if ( !m_pEntLockOnTarget )
        v19 = 1;
      v20 = (unsigned __int8)v19 & (v4 > 0);
      if ( v20 && CPad::GetGroupControlBack(pPad, v5 & 1, 1) )
      {
        this->m_pPlayerData->m_DPadDownPressedInMilliseconds += (unsigned int)(float)((float)(CTimer::ms_fTimeStepNonClipped
                                                                                            / 50.0)
                                                                                    * 1000.0);
        v21 = this->m_pPlayerData;
        if ( v21->m_DPadDownPressedInMilliseconds >= 0x4B0u )
        {
          v22 = CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[v21->m_PlayerGroup].m_membership);
          if ( v22 >= 1 )
          {
            if ( v22 == 1 )
              v23 = 150;
            else
              v23 = 149;
            CPed::Say(this, v23, 0, 1.0, 0, 0, 0);
          }
          CPedGroupMembership::RemoveAllFollowers(
            &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership,
            1);
        }
      }
      else
      {
        if ( !m_pEntLockOnTarget )
          goto LABEL_63;
        v24 = *(_BYTE *)&m_pEntLockOnTarget->m_info & 7;
        v25 = v24 == 3;
        if ( v24 == 3 )
          v25 = m_pEntLockOnTarget->m_nPedType == 8;
        if ( v25 )
        {
          if ( !(v6 << 31) && CPad::GetGroupControlBack(pPad, 1, 0) && this->m_nPedType <= 1u )
          {
            CPed::SetWeaponLockOnTarget(this, 0);
            CCamera::ClearPlayerWeaponMode(&TheCamera);
            CWeaponEffects::ClearCrossHair(this->m_nPedType);
          }
        }
        else
        {
LABEL_63:
          if ( v20 == 1 && CPad::GroupControlBackJustDown(pPad, v5 & 1) )
            CPlayerPed::TellGroupToStartFollowingPlayer(this, 0, 1, 0);
        }
        this->m_pPlayerData->m_DPadDownPressedInMilliseconds = 0;
      }
    }
    if ( (CTimer::m_FrameCounter & 0x1F) == 6 )
    {
      v26 = CPools::ms_pPedPool;
      m_nSize = CPools::ms_pPedPool->m_nSize;
      if ( m_nSize )
      {
        v28 = m_nSize - 1;
        v29 = 1996 * m_nSize - 736;
        do
        {
          if ( (v26->m_aFlags[v28] & 0x80u) == 0 )
          {
            v30 = (CAcquaintance *)&(*v26->m_aStorage)[v29];
            if ( v30 != (CAcquaintance *)&elf_hash_bucket[252] && v30[8].m_nAcquaintances[4] == 8 )
            {
              m_WantedLevel = FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel;
              PedFlag = CPedType::GetPedFlag(6);
              if ( m_WantedLevel < WANTED_LEVEL1 )
                CAcquaintance::ClearAsAcquaintance(v30, 4, PedFlag);
              else
                CAcquaintance::SetAsAcquaintance(v30, 4, PedFlag);
            }
          }
          --v28;
          v29 -= 1996;
        }
        while ( v28 != -1 );
      }
    }
  }
}
// FC: using guessed type int elf_hash_bucket[16411];
// 676C84: using guessed type int CPools::ms_pPedPool[2];

//----- (004C665C) --------------------------------------------------------
bool __fastcall CPlayerPed::IsHidden(const CPlayerPed *this)
{
  bool v1; // r4

  v1 = 0;
  if ( !(*((unsigned __int8 *)&this->m_nPedFlags + 1) << 31) && CPhysical::GetLightingTotal(this) <= 0.05 )
    return 1;
  return v1;
}

//----- (004C668C) --------------------------------------------------------
void __fastcall CPlayerPed::ReApplyMoveAnims(CPlayerPed *this)
{
  int i; // r4
  signed int v3; // r6
  CAnimBlendAssociation *Association; // r5
  CAnimBlendAssociation *v5; // r0

  for ( i = 0; i != 5; ++i )
  {
    v3 = dword_61DEC8[i];
    Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, v3);
    if ( Association )
    {
      if ( Association->m_pAnimBlendHierarchy->m_hashKey != CAnimManager::GetAnimAssociation(
                                                              this->m_motionAnimGroup,
                                                              (AnimationId)v3)->m_pAnimBlendHierarchy->m_hashKey )
      {
        v5 = CAnimManager::AddAnimation((RpClump_0 *)this->m_pRwObject, this->m_motionAnimGroup, (AnimationId)v3);
        v5->m_fBlendDelta = Association->m_fBlendDelta;
        v5->m_fBlendAmount = Association->m_fBlendAmount;
        LOWORD(v5) = Association->m_bitsFlag;
        Association->m_fBlendDelta = -1000.0;
        Association->m_bitsFlag = (unsigned __int16)v5 | 4;
      }
    }
  }
}
// 61DEC8: using guessed type _DWORD dword_61DEC8[5];

//----- (004C6700) --------------------------------------------------------
float __fastcall CPlayerPed::GetButtonSprintResults(CPlayerPed *this, eSprintType nSprintType)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d2
  float m_fSprintControlCounter; // s2
  float v6; // s0

  m_fSprintControlCounter = this->m_pPlayerData->m_fSprintControlCounter;
  if ( m_fSprintControlCounter <= PLAYER_SPRINT_THRESHOLD )
  {
    v6 = 0.0;
    if ( m_fSprintControlCounter > 0.0 )
      return 1.0;
    return v6;
  }
  else
  {
    v3.n64_u32[0] = 0;
    v2.n64_f32[0] = (float)(m_fSprintControlCounter / PLAYER_SPRINT_THRESHOLD) + -1.0;
    return (float)(vmax_f32(v2, v3).n64_f32[0] * PLAYER_SPRINT_SET[nSprintType].fResultMult) + 1.0;
  }
}
// 4C673A: variable 'v2' is possibly undefined
// 4C673A: variable 'v3' is possibly undefined

//----- (004C6778) --------------------------------------------------------
bool __fastcall CPlayerPed::DoesPlayerWantNewWeapon(CPlayerPed *this, eWeaponType newWeapon, bool bInCar)
{
  _BOOL4 v4; // r8
  int32 m_nPedType; // r0
  int32 v7; // r0
  int32 m_nWeaponSlot; // r9
  int v9; // r1
  eWeaponType m_eWeaponType; // r5
  int v11; // r0
  bool v12; // zf
  int v13; // r0
  int8 WeaponSkill; // r0
  int8 v15; // r0
  ePedState m_nPedState; // r0
  bool v17; // zf

  v4 = bInCar;
  m_nPedType = this->m_nPedType;
  if ( m_nPedType == 1 )
  {
    v7 = 1;
  }
  else
  {
    if ( m_nPedType )
      goto LABEL_6;
    v7 = 0;
  }
  CPad::GetPad(v7);
LABEL_6:
  m_nWeaponSlot = CWeaponInfo::GetWeaponInfo(newWeapon, 1)->m_nWeaponSlot;
  v9 = 0;
  m_eWeaponType = this->m_WeaponSlots[m_nWeaponSlot].m_eWeaponType;
  v11 = 0;
  if ( m_eWeaponType == newWeapon )
    v9 = 1;
  if ( m_eWeaponType == WEAPONTYPE_UNARMED )
    v11 = 1;
  v13 = v11 | v9;
  v12 = v13 == 0;
  if ( !v13 )
    v12 = !v4;
  if ( v12 )
  {
    if ( CPedIntelligence::GetTaskJetPack(this->m_pPedIntelligence) )
    {
      if ( m_nWeaponSlot == this->m_nCurrentWeapon )
      {
        WeaponSkill = CPed::GetWeaponSkill(this, m_eWeaponType);
        if ( (CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_nFlags & 2) != 0 )
        {
          v15 = CPed::GetWeaponSkill(this, m_eWeaponType);
          if ( (CWeaponInfo::GetWeaponInfo(m_eWeaponType, v15)->m_nFlags & 2) == 0 )
            goto LABEL_23;
        }
      }
    }
    m_nPedState = this->m_nPedState;
    v17 = m_nPedState == PED_AIMGUN;
    if ( m_nPedState != PED_AIMGUN )
      v17 = m_nPedState == PED_ATTACK;
    if ( v17 && m_nWeaponSlot == this->m_nCurrentWeapon )
LABEL_23:
      LOBYTE(v13) = 0;
    else
      LOBYTE(v13) = 1;
  }
  return v13;
}

//----- (004C6830) --------------------------------------------------------
void __fastcall CPlayerPed::MakeChangesForNewWeapon(CPlayerPed *this, int weaponSlot)
{
  if ( weaponSlot != -1 )
    CPlayerPed::MakeChangesForNewWeapon(this, this->m_WeaponSlots[weaponSlot].m_eWeaponType);
}

//----- (004C6844) --------------------------------------------------------
void __fastcall CPlayerPed::PickWeaponAllowedFor2Player(CPlayerPed *this)
{
  if ( !CWeapon::CanBeUsedFor2Player(&this->m_WeaponSlots[this->m_pPlayerData->m_nChosenWeapon]) )
    this->m_pPlayerData->m_nChosenWeapon = 0;
}

//----- (004C6874) --------------------------------------------------------
void __fastcall CPlayerPed::UpdateCameraWeaponModes(CPlayerPed *this, CPad *pPad)
{
  Int16 v2; // r1

  switch ( this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType )
  {
    case WEAPONTYPE_M4:
      v2 = 34;
      goto LABEL_8;
    case WEAPONTYPE_SNIPERRIFLE:
      v2 = 7;
      goto LABEL_8;
    case WEAPONTYPE_ROCKETLAUNCHER:
      v2 = 8;
      goto LABEL_8;
    case WEAPONTYPE_ROCKETLAUNCHER_HS:
      v2 = 51;
      goto LABEL_8;
    case WEAPONTYPE_CAMERA:
      v2 = 46;
LABEL_8:
      sub_19A354(&TheCamera, v2, 0, 0);
      break;
    default:
      sub_1966A8(&TheCamera);
      break;
  }
}

//----- (004C68F0) --------------------------------------------------------
void __fastcall CPlayerPed::MakeChangesForNewWeapon(CPlayerPed *this, eWeaponType NewWeaponType)
{
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r5
  int32 m_nAmmo; // r1
  CWeapon *v8; // r0
  int32 m_nFlags; // r0
  CAnimBlendAssociation *Association; // r0

  CWeapon::StopWeaponEffect(&this->m_WeaponSlots[this->m_nCurrentWeapon]);
  if ( this->m_nPedState == PED_SNIPER_MODE )
    CCamera::ClearPlayerWeaponMode(&TheCamera);
  CPed::SetCurrentWeapon(this, NewWeaponType);
  this->m_pPlayerData->m_nChosenWeapon = this->m_nCurrentWeapon;
  this->m_pPlayerData->m_fAttackButtonCounter = 0.0;
  m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(this);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  m_nAmmo = WeaponInfo->m_nAmmo;
  v8 = &this->m_WeaponSlots[this->m_nCurrentWeapon];
  if ( v8->m_nAmmoTotal < m_nAmmo )
    m_nAmmo = v8->m_nAmmoTotal;
  v8->m_nAmmoInClip = m_nAmmo;
  m_nFlags = WeaponInfo->m_nFlags;
  if ( (m_nFlags & 1) == 0 && this->m_nPedType <= 1u )
  {
    CPed::SetWeaponLockOnTarget(this, 0);
    CCamera::ClearPlayerWeaponMode(&TheCamera);
    CWeaponEffects::ClearCrossHair(this->m_nPedType);
    m_nFlags = WeaponInfo->m_nFlags;
  }
  if ( (m_nFlags & 8) == 0 )
    *((_WORD *)this->m_pPlayerData + 26) &= ~8u;
  Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pRwObject, 0xE0u);
  if ( Association )
    Association->m_bitsFlag |= 9u;
  sub_1966A8(&TheCamera);
}

//----- (004C69E8) --------------------------------------------------------
float __fastcall CPlayerPed::GetWeaponRadiusOnScreen(CPlayerPed *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  float32x2_t v4; // d4
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  float v9; // s4
  float result; // r0

  m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(this);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  if ( WeaponInfo->m_eFireType == FIRETYPE_MELEE )
    return 0.0;
  v1.n64_f32[0] = 0.5 / WeaponInfo->m_fAccuracy;
  if ( (unsigned int)(m_eWeaponType - 25) >= 3 )
  {
    v4.n64_u32[0] = 1.0;
    v3.n64_f32[0] = 15.0 / WeaponInfo->m_fWeaponRange;
    v9 = (float)(v1.n64_f32[0] * vmin_f32(v3, v4).n64_f32[0])
       * (float)((float)(this->m_pPlayerData->m_fAttackButtonCounter * 0.5) + 1.0);
    v1.n64_f32[0] = v9 * 0.5;
    if ( (*((_BYTE *)&this->m_nPedFlags + 3) & 4) == 0 )
      v1.n64_f32[0] = v9;
  }
  v2.n64_u32[0] = 1045220557;
  LODWORD(result) = vmax_f32(v1, v2).n64_u32[0];
  return result;
}
// 4C6A3C: variable 'v3' is possibly undefined
// 4C6A3C: variable 'v4' is possibly undefined
// 4C6A64: variable 'v1' is possibly undefined
// 4C6A64: variable 'v2' is possibly undefined

//----- (004C6A80) --------------------------------------------------------
bool __fastcall CPlayerPed::PedCanBeTargettedVehicleWise(CPed *pPed)
{
  return 1;
}

//----- (004C6A84) --------------------------------------------------------
bool __fastcall LOSBlockedBetweenPeds(CEntity *pPed1, CEntity *pPed2)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v6; // d16
  CMatrix *v7; // r0
  CSimpleTransform *p_m_transform; // r1
  __int64 v9; // d16
  char v10; // r5
  char v11; // r0
  CEntity *refEntityPtr; // [sp+20h] [bp-58h] BYREF
  CColPoint colPoint; // [sp+24h] [bp-54h] BYREF
  RwV3d_0 v15; // [sp+50h] [bp-28h] BYREF
  RwV3d_0 posn; // [sp+60h] [bp-18h] BYREF

  memset(&posn, 0, sizeof(posn));
  memset(&v15, 0, sizeof(v15));
  if ( (*(_BYTE *)&pPed1->m_info & 7) == 3 )
  {
    CPed::GetBonePosition((CPed *)pPed1, &posn, 4u, 0);
    if ( (HIBYTE(pPed1[19].m_transform.m_heading) & 4) != 0 )
      posn.z = posn.z + 0.35;
  }
  else
  {
    m_pMat = pPed1->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed1->m_transform;
    v6 = *(_QWORD *)&p_tx->m_translate.x;
    posn.z = p_tx->m_translate.z;
    *(_QWORD *)&posn.x = v6;
  }
  if ( (*(_BYTE *)&pPed2->m_info & 7) == 3 )
  {
    CPed::GetBonePosition((CPed *)pPed2, &v15, 4u, 0);
  }
  else
  {
    v7 = pPed2->m_pMat;
    p_m_transform = (CSimpleTransform *)&v7->tx;
    if ( !v7 )
      p_m_transform = &pPed2->m_transform;
    v9 = *(_QWORD *)&p_m_transform->m_translate.x;
    v15.z = p_m_transform->m_translate.z;
    *(_QWORD *)&v15.x = v9;
  }
  v10 = 0;
  refEntityPtr = 0;
  v11 = CWorld::ProcessLineOfSight(
          (const CVector *)&posn,
          (const CVector *)&v15,
          &colPoint,
          &refEntityPtr,
          1,
          0,
          0,
          1,
          0,
          0,
          0,
          1);
  if ( refEntityPtr != pPed2 )
    v10 = 1;
  return v11 & v10;
}

//----- (004C6B4C) --------------------------------------------------------
CEntity *__fastcall CPlayerPed::FindSprayableBuilding(CPlayerPed *this)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r1
  float v4; // s4
  float y; // s8
  float v6; // s2
  float z; // s10
  float v8; // s0
  float x; // s6
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  int v13; // r5
  CEntity *v14; // r9
  float v15; // s16
  float v16; // s26
  CEntity *v17; // r4
  CSimpleTransform *p_tx; // r1
  CMatrix *v19; // r6
  CMatrix *v20; // r0
  float v21; // s2
  float v22; // s0
  float v23; // s4
  float *p_x; // r1
  float v25; // s2
  float v26; // s0
  float v27; // s28
  float m_heading; // s0
  float v29; // s0
  CEntity *v31[16]; // [sp+20h] [bp-A8h] BYREF
  Int16 pNum; // [sp+62h] [bp-66h] BYREF
  CVector Coors; // [sp+64h] [bp-64h] BYREF

  m_pMat = this->m_pMat;
  p_m_transform = &this->m_transform;
  if ( m_pMat )
    p_m_transform = (CSimpleTransform *)&m_pMat->tx;
  v4 = m_pMat->yy * 8.0;
  y = p_m_transform->m_translate.y;
  v6 = m_pMat->xy * 8.0;
  z = p_m_transform->m_translate.z;
  v8 = m_pMat->zy * 8.0;
  x = p_m_transform->m_translate.x;
  pNum = 0;
  memset(v31, 0, sizeof(v31));
  Coors.y = v4 + y;
  Coors.x = v6 + x;
  Coors.z = v8 + z;
  CWorld::FindObjectsInRange(&Coors, 8.0, 0, &pNum, 15, v31, 1, 0, 0, 0, 0);
  m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(this);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  if ( pNum < 1 )
    return 0;
  v13 = 0;
  v14 = 0;
  v15 = WeaponInfo->m_fTargetRange * WeaponInfo->m_fTargetRange;
  v16 = 6.2832;
  do
  {
    if ( CTagManager::IsTag(v31[v13]) && CTagManager::GetAlpha(v31[v13]) != 255 )
    {
      v17 = v31[v13];
      p_tx = &this->m_transform;
      v19 = this->m_pMat;
      v20 = v17->m_pMat;
      if ( v19 )
        p_tx = (CSimpleTransform *)&v19->tx;
      v21 = p_tx->m_translate.x;
      v22 = p_tx->m_translate.y;
      v23 = p_tx->m_translate.z;
      p_x = &v20->tx;
      if ( !v20 )
        p_x = &v17->m_transform.m_translate.x;
      v25 = *p_x - v21;
      v26 = p_x[1] - v22;
      if ( (float)((float)((float)(v25 * v25) + (float)(v26 * v26))
                 + (float)((float)(p_x[2] - v23) * (float)(p_x[2] - v23))) < v15 )
      {
        v27 = atan2f(COERCE_FLOAT(LODWORD(v25) ^ 0x80000000), v26);
        if ( v19 )
          m_heading = atan2f(COERCE_FLOAT(LODWORD(v19->xy) ^ 0x80000000), v19->yy);
        else
          m_heading = this->m_transform.m_heading;
        v29 = v27 - m_heading;
        if ( v29 >= -3.1416 )
        {
          if ( v29 > 3.1416 )
            v29 = v29 + -6.2832;
        }
        else
        {
          v29 = v29 + 6.2832;
        }
        if ( v29 < v16 )
        {
          v16 = v29;
          v14 = v17;
        }
      }
    }
    ++v13;
  }
  while ( v13 < pNum );
  if ( !v14 )
    return 0;
  if ( LOSBlockedBetweenPeds(this, v14) )
    return 0;
  return v14;
}

//----- (004C6D64) --------------------------------------------------------
bool __fastcall CPlayerPed::FindWeaponLockOnTarget(CPlayerPed *this)
{
  CPlayerPed *v1; // r10
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r5
  _BOOL4 v5; // r0
  CEntity **p_m_pEntLockOnTarget; // r1
  CEntity *v7; // r0
  CMatrix *m_pMat; // r1
  int v9; // r4
  CMatrix *v10; // r2
  float *p_tx; // r3
  float *p_x; // r1
  float v13; // s16
  float v14; // s18
  float v15; // s20
  float v16; // s22
  float m_fTargetRange; // s24
  float v18; // r0
  bool v19; // r5
  CEntity *SprayableBuilding; // r1
  float ATanOfXY; // r6
  float v22; // r5
  float v23; // r6
  float v24; // s18
  float v25; // s16
  CPedPool *v26; // r9
  int32 m_nSize; // r0
  int v28; // r11
  int v29; // r8
  CPool<CPed,CCopPed>::StorageType *m_aStorage; // r1
  int v31; // r2
  int v32; // r0
  int v33; // r2
  bool v34; // zf
  uint8 *v35; // r4
  int v36; // r0
  uint8 *v37; // r2
  float32x2_t v38; // d12
  float v39; // s22
  eWeaponType v40; // r5
  int8 v41; // r0
  float32x2_t *v42; // r0
  float32x2_t v43; // d16
  unsigned __int64 v44; // d0
  int v45; // r0
  float v46; // s22
  float v47; // s22
  CObjectPool *v48; // r8
  int32 v49; // r0
  int v50; // r5
  int v51; // r4
  CPool<CObject,CCutsceneObject>::StorageType *v52; // r6
  uint8 *v53; // r9
  int v54; // r0
  uint8 *v55; // r2
  float32x2_t v56; // d11
  float v57; // s20
  eWeaponType v58; // r11
  int8 v59; // r1
  float32x2_t *v60; // r0
  float32x2_t v61; // d16
  unsigned __int64 v62; // d0
  float v63; // s20
  float v64; // s20
  CVehiclePool *v65; // r4
  int32 v66; // r0
  int v67; // r5
  int v68; // r6
  uint8 *v69; // r9
  int v70; // r0
  uint8 *v71; // r2
  float32x2_t v72; // d11
  float v73; // s20
  eWeaponType v74; // r11
  int8 v75; // r1
  float32x2_t *v76; // r0
  float32x2_t v77; // d16
  unsigned __int64 v78; // d0
  float v79; // s20
  float v80; // s20
  CEntity *v81; // r5
  CWeaponInfo *v83; // [sp+14h] [bp-54h]
  float pOldTargetValue; // [sp+18h] [bp-50h] BYREF
  CEntity *ppOldTarget[19]; // [sp+1Ch] [bp-4Ch] BYREF

  while ( 1 )
  {
    v1 = this;
    if ( MobileSettings::IsFreeAimMode() == 1 && !CPed::UseFreeAimMagnetize(v1) && CHID::GetInputType() != 1 )
      return 0;
    m_eWeaponType = v1->m_WeaponSlots[v1->m_nCurrentWeapon].m_eWeaponType;
    WeaponSkill = CPed::GetWeaponSkill(v1);
    WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
    v5 = CPed::UseFreeAimMagnetize(v1);
    p_m_pEntLockOnTarget = &v1->m_pEntLockOnTarget;
    if ( v5 )
      p_m_pEntLockOnTarget = &v1->m_pEntMagnetizeTarget;
    v7 = *p_m_pEntLockOnTarget;
    if ( !*p_m_pEntLockOnTarget )
      break;
    m_pMat = v1->m_pMat;
    v9 = 0;
    v10 = v7->m_pMat;
    p_tx = &m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v1->m_transform.m_translate.x;
    p_x = &v10->tx;
    v13 = *p_tx;
    v14 = p_tx[1];
    if ( !v10 )
      p_x = &v7->m_transform.m_translate.x;
    v15 = *p_x;
    v16 = p_x[1];
    if ( (*(_BYTE *)&v7->m_info & 7) == 3 && ((int)v7[18].m_pMat & 0xFFFFFFFE) == 54 )
      v9 = 1;
    m_fTargetRange = WeaponInfo->m_fTargetRange;
    v18 = CWeapon::TargetWeaponRangeMultiplier(v7, v1);
    if ( !v9
      && sqrtf((float)((float)(v15 - v13) * (float)(v15 - v13)) + (float)((float)(v16 - v14) * (float)(v16 - v14))) <= (float)(m_fTargetRange * v18) )
    {
      return 1;
    }
    CPed::SetWeaponLockOnTarget(v1, 0);
    this = v1;
  }
  if ( v1->m_WeaponSlots[v1->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_SPRAYCAN )
  {
    SprayableBuilding = CPlayerPed::FindSprayableBuilding(v1);
    if ( SprayableBuilding )
    {
      CPed::SetWeaponLockOnTarget(v1, SprayableBuilding);
      v19 = 1;
      v1->m_pPlayerData->m_bDontAllowWeaponChange = 1;
      return v19;
    }
    return 0;
  }
  v83 = WeaponInfo;
  ATanOfXY = CGeneral::GetATanOfXY(TheCamera.m_cameraMatrix.xy, TheCamera.m_cameraMatrix.yy);
  v22 = CGeneral::GetATanOfXY(v1->m_pMat->xy, v1->m_pMat->yy);
  v23 = CGeneral::LimitRadianAngle(ATanOfXY);
  ppOldTarget[0] = 0;
  v24 = CGeneral::LimitRadianAngle(v22);
  pOldTargetValue = 0.0;
  v25 = v23;
  v26 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize )
  {
    v28 = m_nSize - 1;
    v29 = 1996 * m_nSize - 896;
    do
    {
      if ( (v26->m_aFlags[v28] & 0x80u) == 0 )
      {
        m_aStorage = v26->m_aStorage;
        v31 = (int)&(*v26->m_aStorage)[-1996];
        v32 = v31 + v29;
        if ( v31 + v29 != -896 )
        {
          v33 = v31 - (_DWORD)v1 + v29;
          v34 = v33 == -896;
          if ( v33 != -896 )
            v34 = (*(_DWORD *)&(*m_aStorage)[v29] & 0xFFFFFFFE) == 54;
          if ( !v34 )
          {
            v35 = &(*m_aStorage)[v29];
            if ( ((*m_aStorage)[v29 + 63] & 0x10) == 0 && !CPedGroups::AreInSameGroup((const CPed *)(v32 + 896), v1) )
            {
              v36 = *((_DWORD *)v35 - 270);
              v37 = (uint8 *)(v36 + 48);
              if ( !v36 )
                v37 = v35 - 1096;
              v38.n64_u64[0] = *(unsigned __int64 *)v37;
              v39 = *((float *)v37 + 2);
              v40 = v1->m_WeaponSlots[v1->m_nCurrentWeapon].m_eWeaponType;
              v41 = CPed::GetWeaponSkill(v1, v40);
              if ( (CWeaponInfo::GetWeaponInfo(v40, v41)->m_nFlags & 2) != 0
                || (v42 = (float32x2_t *)v1->m_pMat,
                    v43.n64_u64[0] = vsub_f32(v38, v42[6]).n64_u64[0],
                    v44 = vmul_f32(v43, v43).n64_u64[0],
                    (float)(v42[7].n64_f32[0] - v39) <= sqrtf(*(float *)&v44 + *((float *)&v44 + 1))) )
              {
                if ( (v45 = *((_DWORD *)v35 + 84)) != 0 && v45 != 1 || !CGameLogic::bPlayersCannotTargetEachother )
                {
                  v46 = v83->m_fTargetRange;
                  v47 = v46 * CWeapon::TargetWeaponRangeMultiplier((CEntity *)(v35 - 1100), v1);
                  if ( v1->m_WeaponSlots[v1->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_EXTINGUISHER )
                    v47 = 5.0;
                  CPlayerPed::EvaluateTarget(v1, (CEntity *)(v35 - 1100), ppOldTarget, &pOldTargetValue, v47, v23, 1);
                  CPlayerPed::EvaluateTarget(v1, (CEntity *)(v35 - 1100), ppOldTarget, &pOldTargetValue, v47, v24, 0);
                }
              }
            }
          }
        }
      }
      --v28;
      v29 -= 1996;
    }
    while ( v28 != -1 );
  }
  v48 = CPools::ms_pObjectPool;
  v49 = CPools::ms_pObjectPool->m_nSize;
  if ( v49 )
  {
    v50 = v49 - 1;
    v51 = 420 * v49 - 96;
    do
    {
      if ( (v48->m_aFlags[v50] & 0x80u) == 0 )
      {
        v52 = v48->m_aStorage;
        v53 = &(*v48->m_aStorage)[v51];
        if ( v53 != (uint8 *)&elf_hash_bucket[18]
          && CObject::CanBeTargetted((CObject *)(v53 - 324))
          && ((*v52)[v51] & 0x40) == 0
          && *((_DWORD *)v53 - 75) )
        {
          v54 = *((_DWORD *)v53 - 76);
          v55 = (uint8 *)(v54 + 48);
          if ( !v54 )
            v55 = v53 - 320;
          v56.n64_u64[0] = *(unsigned __int64 *)v55;
          v57 = *((float *)v55 + 2);
          v58 = v1->m_WeaponSlots[v1->m_nCurrentWeapon].m_eWeaponType;
          v59 = CPed::GetWeaponSkill(v1, v58);
          if ( (CWeaponInfo::GetWeaponInfo(v58, v59)->m_nFlags & 2) != 0
            || (v60 = (float32x2_t *)v1->m_pMat,
                v61.n64_u64[0] = vsub_f32(v56, v60[6]).n64_u64[0],
                v62 = vmul_f32(v61, v61).n64_u64[0],
                (float)(v60[7].n64_f32[0] - v57) <= sqrtf(*(float *)&v62 + *((float *)&v62 + 1))) )
          {
            v63 = v83->m_fTargetRange;
            v64 = v63 * CWeapon::TargetWeaponRangeMultiplier((CEntity *)(v53 - 324), v1);
            CPlayerPed::EvaluateTarget(v1, (CEntity *)(v53 - 324), ppOldTarget, &pOldTargetValue, v64, v25, 1);
            CPlayerPed::EvaluateTarget(v1, (CEntity *)(v53 - 324), ppOldTarget, &pOldTargetValue, v64, v24, 0);
          }
        }
      }
      --v50;
      v51 -= 420;
    }
    while ( v50 != -1 );
  }
  if ( CGameLogic::IsCoopGameGoingOn() == 1 )
  {
    v65 = CPools::ms_pVehiclePool;
    v66 = CPools::ms_pVehiclePool->m_nSize;
    if ( v66 )
    {
      v67 = v66 - 1;
      v68 = 2604 * v66 - 1160;
      do
      {
        if ( (v65->m_aFlags[v67] & 0x80u) == 0 )
        {
          v69 = &(*v65->m_aStorage)[v68];
          if ( v69 != (uint8 *)&elf_hash_bucket[298]
            && (*(v69 - 1373) & 0x20) == 0
            && *(_DWORD *)&(*v65->m_aStorage)[v68] != 10 )
          {
            v70 = *((_DWORD *)v69 - 356);
            v71 = (uint8 *)(v70 + 48);
            if ( !v70 )
              v71 = v69 - 1440;
            v72.n64_u64[0] = *(unsigned __int64 *)v71;
            v73 = *((float *)v71 + 2);
            v74 = v1->m_WeaponSlots[v1->m_nCurrentWeapon].m_eWeaponType;
            v75 = CPed::GetWeaponSkill(v1, v74);
            if ( (CWeaponInfo::GetWeaponInfo(v74, v75)->m_nFlags & 2) != 0
              || (v76 = (float32x2_t *)v1->m_pMat,
                  v77.n64_u64[0] = vsub_f32(v72, v76[6]).n64_u64[0],
                  v78 = vmul_f32(v77, v77).n64_u64[0],
                  (float)(v76[7].n64_f32[0] - v73) <= sqrtf(*(float *)&v78 + *((float *)&v78 + 1))) )
            {
              v79 = v83->m_fTargetRange;
              v80 = v79 * CWeapon::TargetWeaponRangeMultiplier((CEntity *)(v69 - 1444), v1);
              CPlayerPed::EvaluateTarget(v1, (CEntity *)(v69 - 1444), ppOldTarget, &pOldTargetValue, v80, v25, 1);
              CPlayerPed::EvaluateTarget(v1, (CEntity *)(v69 - 1444), ppOldTarget, &pOldTargetValue, v80, v24, 0);
            }
          }
        }
        --v67;
        v68 -= 2604;
      }
      while ( v67 != -1 );
    }
  }
  v81 = ppOldTarget[0];
  if ( ppOldTarget[0] )
  {
    v1->m_pPlayerData->m_bDontAllowWeaponChange = 1;
    CPed::SetWeaponLockOnTarget(v1, v81);
  }
  return v81 != 0;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 676C84: using guessed type int CPools::ms_pPedPool[2];
// 678534: using guessed type int *CPools::ms_pVehiclePool;

//----- (004C7320) --------------------------------------------------------
bool __fastcall CPlayerPed::CanIKReachThisTarget(CPlayerPed *this, CVector Target, CWeapon *pWeapon, bool bTestYaw)
{
  float x; // r9
  float z; // r8
  float y; // r6
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CMatrix *m_pMat; // r0
  _BOOL4 result; // r0

  x = Target.x;
  z = Target.z;
  y = Target.y;
  m_eWeaponType = pWeapon->m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(this, pWeapon->m_eWeaponType);
  result = 1;
  if ( (CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_nFlags & 2) == 0 )
  {
    m_pMat = this->m_pMat;
    if ( (float)(m_pMat->tz - z) > sqrtf(
                                     (float)((float)(x - m_pMat->tx) * (float)(x - m_pMat->tx))
                                   + (float)((float)(y - m_pMat->ty) * (float)(y - m_pMat->ty))) )
      return 0;
  }
  return result;
}

//----- (004C739C) --------------------------------------------------------
void __fastcall CPlayerPed::EvaluateTarget(
        CPlayerPed *this,
        CEntity *pTarget,
        CEntity **ppOldTarget,
        float *pOldTargetValue,
        float fWeaponRange,
        float fLookOrientation,
        int bTargetMustBeOnScreen)
{
  float32x2_t v7; // d2
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r6
  CMatrix *v12; // r1
  CSimpleTransform *v13; // r4
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *v17; // r0
  float32x2_t v18; // d16
  float32x2_t v19; // d1
  float v20; // s16
  CMatrix *v21; // r0
  CMatrix *v22; // r1
  float ATanOfXY; // r0
  float v24; // s18
  float v25; // s16
  RwV3d_0 pResult; // [sp+Ch] [bp-34h] BYREF

  m_pMat = this->m_pMat;
  p_m_transform = &this->m_transform;
  v12 = pTarget->m_pMat;
  v13 = &pTarget->m_transform;
  p_tx = &this->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v17 = &pTarget->m_transform;
  if ( v12 )
    v17 = (CSimpleTransform *)&v12->tx;
  v18.n64_u64[0] = vsub_f32(*(float32x2_t *)&v17->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
  v19.n64_u64[0] = vmul_f32(v18, v18).n64_u64[0];
  v20 = sqrtf(
          (float)((float)((float)(v17->m_translate.x - p_tx->m_translate.x)
                        * (float)(v17->m_translate.x - p_tx->m_translate.x))
                + v19.n64_f32[0])
        + v19.n64_f32[1]);
  if ( v20 <= fWeaponRange )
  {
    memset(&pResult, 0, sizeof(pResult));
    if ( (!bTargetMustBeOnScreen || CSprite::CalcScreenCoors(&v17->m_translate, &pResult, 0, 0, 1, 1) == 1)
      && !CPlayerPed::DoesTargetHaveToBeBroken(this, pTarget, &this->m_WeaponSlots[this->m_nCurrentWeapon]) )
    {
      v21 = this->m_pMat;
      v22 = pTarget->m_pMat;
      if ( v21 )
        p_m_transform = (CSimpleTransform *)&v21->tx;
      if ( v22 )
        v13 = (CSimpleTransform *)&v22->tx;
      ATanOfXY = CGeneral::GetATanOfXY(
                   v13->m_translate.x - p_m_transform->m_translate.x,
                   v13->m_translate.y - p_m_transform->m_translate.y);
      v7.n64_u32[0] = 0;
      v19.n64_f32[0] = (float)(fabsf(CGeneral::LimitRadianAngle(ATanOfXY) - fLookOrientation) * -0.7854) + 1.0;
      LODWORD(v24) = vmax_f32(v19, v7).n64_u32[0];
      if ( v20 > 1.0 )
        v24 = (float)(1.0 / sqrtf(sqrtf(v20))) * v24;
      v25 = v24 * CPlayerPed::FindTargetPriority(this, pTarget);
      if ( v25 > *pOldTargetValue && !LOSBlockedBetweenPeds(this, pTarget) )
      {
        *ppOldTarget = pTarget;
        *pOldTargetValue = v25;
      }
    }
  }
}
// 4C74B4: variable 'v7' is possibly undefined

//----- (004C7510) --------------------------------------------------------
void __fastcall CPlayerPed::DisplayTargettingDebug(CPlayerPed *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d11
  CRGBA v5; // r0
  CRGBA v6; // r0
  const unsigned __int8 *PedStateString; // r0
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r4
  float ATanOfXY; // r6
  float v12; // r5
  float v13; // r6
  float v14; // r0
  CPedPool *v15; // r11
  int32 m_nSize; // r10
  float v17; // s20
  int v18; // r9
  bool v19; // zf
  int v20; // r0
  int v21; // r2
  float32x2_t v22; // d14
  float v23; // s24
  eWeaponType v24; // r5
  int8 v25; // r0
  float32x2_t *v26; // r0
  float32x2_t v27; // d16
  int v28; // r0
  float32x2_t v29; // d16
  float32x2_t v30; // d17
  float32x2_t v31; // d2
  float32x2_t v32; // d3
  float m_fTargetRange; // s24
  float v34; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  int v37; // r2
  int v38; // r1
  float32x2_t v39; // d16
  float v40; // s29
  const unsigned __int8 *v41; // r0
  float *v42; // r4
  int v43; // r5
  float v44; // s31
  CMatrix *v45; // r0
  float *p_x; // r2
  int v47; // r1
  float *v48; // r0
  float v49; // r0
  float v50; // s2
  float y; // s2
  float v52; // s6
  float x; // s24
  float v54; // s6
  float v55; // s24
  float v56; // s28
  float v57; // s19
  float v58; // s27
  float TargetPriority; // r5
  float v60; // s24
  float v61; // s28
  float v62; // s19
  float v63; // s27
  int v64; // r0
  float v65; // s24
  float v66; // s28
  float v67; // s19
  float v68; // s27
  float v69; // s29
  float v70; // r5
  CWeaponInfo *v71; // [sp+1Ch] [bp-2ECh]
  CPlayerPed *v72; // [sp+30h] [bp-2D8h]
  CSimpleTransform *p_m_transform; // [sp+34h] [bp-2D4h]
  int *v74; // [sp+3Ch] [bp-2CCh]
  unsigned int v75; // [sp+44h] [bp-2C4h]
  CRGBA v76; // [sp+48h] [bp-2C0h] BYREF
  CRGBA v77; // [sp+4Ch] [bp-2BCh] BYREF
  CRGBA v78; // [sp+50h] [bp-2B8h] BYREF
  CRGBA v79; // [sp+54h] [bp-2B4h] BYREF
  CRGBA v80; // [sp+58h] [bp-2B0h] BYREF
  CRGBA v81; // [sp+5Ch] [bp-2ACh] BYREF
  CRGBA c2; // [sp+60h] [bp-2A8h] BYREF
  CRGBA c; // [sp+64h] [bp-2A4h] BYREF
  float v84; // [sp+68h] [bp-2A0h] BYREF
  float v85; // [sp+6Ch] [bp-29Ch]
  GxtChar pOutput[256]; // [sp+70h] [bp-298h] BYREF
  RwV3d_0 v87; // [sp+270h] [bp-98h] BYREF
  RwV3d_0 pResult; // [sp+27Ch] [bp-8Ch] BYREF
  CVector vecPedFeet; // [sp+288h] [bp-80h] BYREF
  CVector vecPedHead; // [sp+294h] [bp-74h] BYREF
  CRGBA v91; // [sp+2A0h] [bp-68h] BYREF
  CRGBA v92; // [sp+2A4h] [bp-64h] BYREF

  CFont::SetFontStyle(1u);
  CFont::SetBackground(0, 0);
  CFont::SetScale((float)RsGlobal.screenHeight / 448.0);
  CFont::SetOrientation(0);
  CFont::SetCentreSize((float)((float)RsGlobal.screenWidth / 640.0) * 640.0);
  CFont::SetProportional(1u);
  CRGBA::CRGBA(&v92, 0xFFu, 0xFFu, 0xFFu, 0xFFu);
  CFont::SetColor(v5);
  CRGBA::CRGBA(&v91, 0, 0, 0, 0xFFu);
  CFont::SetDropColor(v6);
  CFont::SetEdge(0);
  memset(&vecPedFeet, 0, sizeof(vecPedFeet));
  memset(&vecPedHead, 0, sizeof(vecPedHead));
  CPed::GetHeadAndFootPositions(this, &vecPedHead, &vecPedFeet, 1);
  memset(&v87, 0, sizeof(v87));
  memset(&pResult, 0, sizeof(pResult));
  if ( CSprite::CalcScreenCoors(&vecPedHead, &pResult, 0, 0, 1, 1) == 1
    && CSprite::CalcScreenCoors(&vecPedFeet, &v87, 0, 0, 1, 1) == 1 )
  {
    PedStateString = CPed::GetPedStateString(this);
    AsciiToGxtChar(PedStateString, pOutput);
    CFont::PrintString((float)(pResult.x + v87.x) * 0.5, pResult.y, pOutput);
  }
  m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(this);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  ATanOfXY = CGeneral::GetATanOfXY(TheCamera.m_cameraMatrix.xy, TheCamera.m_cameraMatrix.yy);
  v12 = CGeneral::GetATanOfXY(this->m_pMat->xy, this->m_pMat->yy);
  v13 = CGeneral::LimitRadianAngle(ATanOfXY);
  v14 = CGeneral::LimitRadianAngle(v12);
  v15 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize )
  {
    v17 = v14;
    p_m_transform = &this->m_transform;
    v3.n64_u32[0] = 0;
    do
    {
      if ( (v15->m_aFlags[--m_nSize] & 0x80u) == 0 )
      {
        v18 = (int)v15->m_aStorage[m_nSize];
        if ( v18 )
        {
          v19 = this == (CPlayerPed *)v18;
          if ( this != (CPlayerPed *)v18 )
            v19 = (*(_DWORD *)(v18 + 1100) & 0xFFFFFFFE) == 54;
          if ( !v19
            && (*(_BYTE *)(v18 + 1163) & 0x10) == 0
            && !CPedGroups::AreInSameGroup((const CPed *)v15->m_aStorage[m_nSize], this) )
          {
            v20 = *(_DWORD *)(v18 + 20);
            v74 = (int *)(v18 + 20);
            v21 = v18 + 4;
            if ( v20 )
              v21 = v20 + 48;
            v22.n64_u64[0] = *(unsigned __int64 *)v21;
            v23 = *(float *)(v21 + 8);
            v24 = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
            v25 = CPed::GetWeaponSkill(this, v24);
            if ( (CWeaponInfo::GetWeaponInfo(v24, v25)->m_nFlags & 2) != 0
              || (v26 = (float32x2_t *)this->m_pMat,
                  v27.n64_u64[0] = vsub_f32(v22, v26[6]).n64_u64[0],
                  v1.n64_u64[0] = vmul_f32(v27, v27).n64_u64[0],
                  (float)(v26[7].n64_f32[0] - v23) <= sqrtf(v1.n64_f32[0] + v1.n64_f32[1])) )
            {
              if ( (v28 = *(_DWORD *)(v18 + 1436)) != 0 && v28 != 1 || !CGameLogic::bPlayersCannotTargetEachother )
              {
                CPed::GetHeadAndFootPositions((CPed *)v18, &vecPedHead, &vecPedFeet, 1);
                if ( CSprite::CalcScreenCoors(&vecPedHead, &pResult, 0, 0, 1, 1) == 1
                  && CSprite::CalcScreenCoors(&vecPedFeet, &v87, 0, 0, 1, 1) == 1 )
                {
                  v1.n64_u32[0] = LODWORD(pResult.x);
                  v2.n64_u32[0] = LODWORD(pResult.y);
                  v29.n64_u64[0] = vmax_f32(v1, v3).n64_u64[0];
                  v30.n64_u64[0] = vmax_f32(v2, v3).n64_u64[0];
                  v1.n64_f32[0] = (float)RsGlobal.screenHeight;
                  v2.n64_f32[0] = (float)RsGlobal.screenWidth;
                  v31.n64_u64[0] = vmin_f32(v30, v1).n64_u64[0];
                  v32.n64_u64[0] = vmin_f32(v29, v2).n64_u64[0];
                  LODWORD(pResult.y) = v31.n64_u32[0];
                  LODWORD(pResult.x) = v32.n64_u32[0];
                  v31.n64_u32[0] = LODWORD(v87.y);
                  v32.n64_u32[0] = LODWORD(v87.x);
                  v1.n64_u64[0] = vmin_f32(vmax_f32(v31, v3), v1).n64_u64[0];
                  LODWORD(v87.y) = v1.n64_u32[0];
                  LODWORD(v87.x) = vmin_f32(vmax_f32(v32, v3), v2).n64_u32[0];
                  m_fTargetRange = WeaponInfo->m_fTargetRange;
                  v34 = CWeapon::TargetWeaponRangeMultiplier((CEntity *)v18, this);
                  m_pMat = this->m_pMat;
                  p_tx = p_m_transform;
                  v37 = *v74;
                  if ( m_pMat )
                    p_tx = (CSimpleTransform *)&m_pMat->tx;
                  v38 = v18 + 4;
                  if ( v37 )
                    v38 = v37 + 48;
                  v39.n64_u64[0] = vsub_f32(*(float32x2_t *)(v38 + 4), *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
                  v2.n64_u64[0] = vmul_f32(v39, v39).n64_u64[0];
                  v40 = sqrtf(
                          (float)((float)((float)(*(float *)v38 - p_tx->m_translate.x)
                                        * (float)(*(float *)v38 - p_tx->m_translate.x))
                                + v2.n64_f32[0])
                        + v2.n64_f32[1]);
                  if ( v40 < (float)(m_fTargetRange * v34) )
                  {
                    v71 = WeaponInfo;
                    v41 = CPed::GetPedStateString((CPed *)v18);
                    AsciiToGxtChar(v41, pOutput);
                    CFont::SetScale((float)((float)RsGlobal.screenHeight / 448.0) * 0.7);
                    v42 = &v84;
                    v43 = 0;
                    v84 = 0.0;
                    v85 = 0.0;
                    v72 = this;
                    v44 = 1.0 / sqrtf(sqrtf(v40));
                    do
                    {
                      v45 = this->m_pMat;
                      p_x = &p_m_transform->m_translate.x;
                      v47 = *v74;
                      if ( v45 )
                        p_x = &v45->tx;
                      v48 = (float *)(v18 + 4);
                      if ( v47 )
                        v48 = (float *)(v47 + 48);
                      v49 = CGeneral::GetATanOfXY(*v48 - *p_x, v48[1] - p_x[1]);
                      v50 = CGeneral::LimitRadianAngle(v49);
                      v1.n64_f32[0] = v17;
                      if ( !v43 )
                        v1.n64_f32[0] = v13;
                      v1.n64_f32[0] = (float)(fabsf(v50 - v1.n64_f32[0]) * -0.7854) + 1.0;
                      v1.n64_u64[0] = vmax_f32(v1, v3).n64_u64[0];
                      if ( v40 > 1.0 )
                        v1.n64_f32[0] = v44 * v1.n64_f32[0];
                      y = pResult.y;
                      v52 = v87.y;
                      *v42 = v1.n64_f32[0];
                      x = pResult.x;
                      v54 = (float)(v52 - y) * 0.1;
                      v75 = (unsigned int)(float)(v87.x - pResult.x);
                      if ( v43 )
                        CRGBA::CRGBA(&c, 0, 0xFFu, 0, 0xFFu);
                      else
                        CRGBA::CRGBA(&c, 0xFFu, 0, 0, 0xFFu);
                      CRGBA::CRGBA(&c2, 0, 0, 0, 0);
                      CSprite2d::DrawBarChart(
                        x,
                        y + (float)(v54 * (float)v43++),
                        v75,
                        (unsigned int)v54,
                        v1.n64_f32[0] * 100.0,
                        0,
                        0,
                        0,
                        (CRGBA)&c,
                        (CRGBA)&c2);
                      ++v42;
                      this = v72;
                    }
                    while ( v43 != 2 );
                    v55 = v87.x;
                    v56 = v87.y;
                    v57 = pResult.x;
                    v58 = pResult.y;
                    TargetPriority = CPlayerPed::FindTargetPriority(v72, (CEntity *)v18);
                    CRGBA::CRGBA(&v81, 0, 0, 0xFFu, 0xFFu);
                    CRGBA::CRGBA(&v80, 0, 0, 0, 0);
                    CSprite2d::DrawBarChart(
                      v57,
                      (float)(v58 + (float)((float)(v56 - v58) * 0.2)) + -1.0,
                      (unsigned int)(float)(v55 - v57),
                      (unsigned int)(float)((float)(v56 - v58) * 0.1),
                      TargetPriority * 100.0,
                      0,
                      0,
                      0,
                      (CRGBA)&v81,
                      (CRGBA)&v80);
                    if ( LOSBlockedBetweenPeds(v72, (CEntity *)v18) )
                    {
                      v60 = v87.x;
                      v61 = v87.y;
                      v62 = pResult.x;
                      v63 = pResult.y;
                      CRGBA::CRGBA(&v79, 0xFFu, 0, 0, 0xFFu);
                      CRGBA::CRGBA(&v78, 0, 0, 0, 0);
                      CSprite2d::DrawBarChart(
                        v62,
                        (float)(v63 + (float)((float)(v61 - v63) * 0.3)) + -1.0,
                        (unsigned int)(float)(v60 - v62),
                        (unsigned int)(float)((float)(v61 - v63) * 0.1),
                        100.0,
                        0,
                        0,
                        0,
                        (CRGBA)&v79,
                        (CRGBA)&v78);
                    }
                    else
                    {
                      v64 = 0;
                      v65 = v87.x;
                      v66 = v87.y;
                      v67 = pResult.x;
                      v68 = pResult.y;
                      if ( v84 <= v85 )
                        v64 = 1;
                      v69 = *(float *)((unsigned int)&v84 | (4 * v64));
                      v70 = CPlayerPed::FindTargetPriority(v72, (CEntity *)v18);
                      CRGBA::CRGBA(&v77, 0xFFu, 0xFFu, 0xFFu, 0xFFu);
                      CRGBA::CRGBA(&v76, 0, 0, 0, 0);
                      CSprite2d::DrawBarChart(
                        v67,
                        (float)(v68 + (float)((float)(v66 - v68) * 0.3)) + -1.0,
                        (unsigned int)(float)(v65 - v67),
                        (unsigned int)(float)((float)(v66 - v68) * 0.1),
                        (float)(v69 * v70) * 300.0,
                        0,
                        0,
                        0,
                        (CRGBA)&v77,
                        (CRGBA)&v76);
                    }
                    WeaponInfo = v71;
                  }
                }
              }
            }
          }
        }
      }
    }
    while ( m_nSize );
  }
}
// 4C7592: variable 'v5' is possibly undefined
// 4C75A4: variable 'v6' is possibly undefined
// 4C7828: variable 'v1' is possibly undefined
// 4C7828: variable 'v3' is possibly undefined
// 4C7830: variable 'v2' is possibly undefined

//----- (004C7C48) --------------------------------------------------------
float __fastcall CPlayerPed::FindTargetPriority(CPlayerPed *this, CEntity *pTarget)
{
  int v3; // r1
  int v4; // s0
  int v5; // s16
  CLink<CEntity *> *m_pLastRenderedLink; // r1
  _BOOL4 v7; // r5

  v3 = *(_BYTE *)&pTarget->m_info & 7;
  if ( v3 == 2 )
  {
    v4 = 1022739087;
  }
  else
  {
    v4 = 1036831949;
    if ( v3 == 4 )
    {
      if ( (LOBYTE(pTarget[5].m_pMat) | 4) != 6 )
        v4 = 1022739087;
    }
    else if ( v3 == 3 )
    {
      v5 = 1036831949;
      if ( LOBYTE(pTarget[18].m_transform.m_heading) == 2 )
        v5 = 0.25;
      if ( *(_DWORD *)&pTarget[23].numLodChildren == 8 )
        v5 = 1031127695;
      if ( BYTE1(pTarget[19].m_transform.m_heading) << 31 )
      {
        m_pLastRenderedLink = pTarget[23].m_pLastRenderedLink;
        if ( m_pLastRenderedLink && m_pLastRenderedLink[120].m_pPrev == (CLink<CEntity *> *)&byte_6 )
          v5 = 1008981770;
        else
          v5 = 1022739087;
      }
      v7 = CPedGroups::AreInSameGroup(this, (const CPed *)pTarget);
      if ( CTaskManager::FindActiveTaskByType(
             (const CTaskManager *)(LODWORD(pTarget[18].m_transform.m_translate.y) + 4),
             1000) )
      {
        v5 = 1061997773;
      }
      else
      {
        if ( v7 )
          v5 = 0;
        if ( CTaskManager::FindActiveTaskByType(
               (const CTaskManager *)(LODWORD(pTarget[18].m_transform.m_translate.y) + 4),
               1101) )
        {
          v5 = 1061997773;
        }
      }
      v4 = 1.0;
      if ( (HIBYTE(pTarget[19].m_pMat) & 0x20) == 0 )
        v4 = v5;
    }
  }
  return *(float *)&v4;
}
// 6: using guessed type char byte_6;

//----- (004C7D46) --------------------------------------------------------
bool __fastcall CPlayerPed::MovementDisabledBecauseOfTargeting(CPlayerPed *this)
{
  return 0;
}

//----- (004C7D4C) --------------------------------------------------------
bool __fastcall CPlayerPed::FindNextWeaponLockOnTarget(CPlayerPed *this, CEntity *pOldTarget, bool bDirection)
{
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  float m_fTargetRange; // s16
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r1
  float xy; // r0
  float yy; // r1
  float ATanOfXY; // s18
  CPedPool *v14; // r8
  int32 m_nSize; // r0
  int v16; // r4
  int v17; // r5
  int v18; // r11
  CPed *v19; // r9
  int v20; // r3
  uint8 *v21; // r2
  float32x2_t v22; // d11
  float v23; // s20
  eWeaponType v24; // r6
  int8 v25; // r0
  float32x2_t *v26; // r0
  float32x2_t v27; // d16
  unsigned __int64 v28; // d0
  float v29; // r0
  CPool<CPed,CCopPed>::StorageType *m_aStorage; // r0
  int v31; // r1
  bool v32; // zf
  int v33; // r1
  bool v34; // zf
  uint8 *v35; // r6
  int v36; // r0
  CObjectPool *v37; // r8
  int32 v38; // r0
  int v39; // r5
  int v40; // r6
  CPool<CObject,CCutsceneObject>::StorageType *v41; // r4
  uint8 *v42; // r10
  int v43; // r3
  uint8 *v44; // r2
  float32x2_t v45; // d11
  float v46; // s20
  eWeaponType v47; // r11
  int8 v48; // r1
  float32x2_t *v49; // r0
  float32x2_t v50; // d16
  unsigned __int64 v51; // d0
  float v52; // r0
  CVehiclePool *v53; // r6
  int32 v54; // r0
  int v55; // r5
  int v56; // r4
  uint8 *v57; // r10
  int v58; // r3
  uint8 *v59; // r2
  float32x2_t v60; // d11
  float v61; // s20
  eWeaponType v62; // r11
  int8 v63; // r1
  float32x2_t *v64; // r0
  float32x2_t v65; // d16
  unsigned __int64 v66; // d0
  float v67; // s0
  CPed *v68; // r5
  CPedGroup *PedsGroup; // r6
  CEventGunAimedAt *v70; // r8
  bool result; // r0
  CEntity *pTarget; // [sp+10h] [bp-70h]
  int v73; // [sp+1Ch] [bp-64h]
  CPlayerPed *pPed1; // [sp+20h] [bp-60h]
  CEventGroupEvent v75; // [sp+24h] [bp-5Ch] BYREF
  CEntity *ppOldTarget; // [sp+38h] [bp-48h] BYREF
  float pOldTargetValue[17]; // [sp+3Ch] [bp-44h] BYREF

  v73 = bDirection;
  m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(this);
  m_fTargetRange = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_fTargetRange;
  ppOldTarget = 0;
  pOldTargetValue[0] = -10000.0;
  pPed1 = this;
  CGeneral::GetATanOfXY(this->m_pMat->xy, this->m_pMat->yy);
  if ( pOldTarget )
  {
    m_pMat = pOldTarget->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pOldTarget->m_transform;
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    xy = p_tx->m_translate.x - p_m_transform->m_translate.x;
    yy = p_tx->m_translate.y - p_m_transform->m_translate.y;
  }
  else
  {
    xy = TheCamera.m_cameraMatrix.xy;
    yy = TheCamera.m_cameraMatrix.yy;
  }
  ATanOfXY = CGeneral::GetATanOfXY(xy, yy);
  v14 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize )
  {
    v16 = -1996 - (_DWORD)pOldTarget;
    v17 = m_nSize - 1;
    v18 = 1996 * m_nSize - 896;
    do
    {
      if ( (v14->m_aFlags[v17] & 0x80u) != 0 )
      {
        v19 = 0;
      }
      else
      {
        m_aStorage = v14->m_aStorage;
        v31 = (int)&(*v14->m_aStorage)[-1996];
        v32 = v31 + v18 == -896;
        v19 = (CPed *)(v31 + v18 + 896);
        if ( v31 + v18 != -896 )
          v32 = v31 - (_DWORD)pPed1 + v18 == -896;
        if ( !v32 )
        {
          v33 = (int)&(*m_aStorage)[v16 + v18];
          v34 = v33 == -896;
          if ( v33 != -896 )
            v34 = (*(_DWORD *)&(*m_aStorage)[v18] & 0xFFFFFFFE) == 54;
          if ( !v34 )
          {
            v35 = &(*m_aStorage)[v18];
            if ( ((*m_aStorage)[v18 + 63] & 0x10) == 0
              && !CPedGroups::AreInSameGroup(v19, pPed1)
              && ((v36 = *((_DWORD *)v35 + 84)) != 0 && v36 != 1 || !CGameLogic::bPlayersCannotTargetEachother) )
            {
              pTarget = (CEntity *)(v35 - 1100);
              if ( !LOSBlockedBetweenPeds(pPed1, (CEntity *)(v35 - 1100)) )
              {
                v20 = *((_DWORD *)v35 - 270);
                v21 = (uint8 *)(v20 + 48);
                if ( !v20 )
                  v21 = v35 - 1096;
                v22.n64_u64[0] = *(unsigned __int64 *)v21;
                v23 = *((float *)v21 + 2);
                v24 = pPed1->m_WeaponSlots[pPed1->m_nCurrentWeapon].m_eWeaponType;
                v25 = CPed::GetWeaponSkill(pPed1, v24);
                if ( (CWeaponInfo::GetWeaponInfo(v24, v25)->m_nFlags & 2) != 0
                  || (v26 = (float32x2_t *)pPed1->m_pMat,
                      v27.n64_u64[0] = vsub_f32(v22, v26[6]).n64_u64[0],
                      v28 = vmul_f32(v27, v27).n64_u64[0],
                      (float)(v26[7].n64_f32[0] - v23) <= sqrtf(*(float *)&v28 + *((float *)&v28 + 1))) )
                {
                  v29 = CWeapon::TargetWeaponRangeMultiplier(pTarget, pPed1);
                  CPlayerPed::EvaluateNeighbouringTarget(
                    pPed1,
                    pTarget,
                    &ppOldTarget,
                    pOldTargetValue,
                    m_fTargetRange * v29,
                    ATanOfXY,
                    v73);
                }
              }
            }
          }
        }
      }
      --v17;
      v18 -= 1996;
    }
    while ( v17 != -1 );
  }
  else
  {
    v19 = 0;
  }
  v37 = CPools::ms_pObjectPool;
  v38 = CPools::ms_pObjectPool->m_nSize;
  if ( v38 )
  {
    v39 = v38 - 1;
    v40 = 420 * v38 - 96;
    do
    {
      if ( (v37->m_aFlags[v39] & 0x80u) == 0 )
      {
        v41 = v37->m_aStorage;
        v42 = &(*v37->m_aStorage)[v40];
        if ( v42 != (uint8 *)&elf_hash_bucket[18]
          && CObject::CanBeTargetted((CObject *)(v42 - 324))
          && ((*v41)[v40] & 0x40) == 0
          && *((_DWORD *)v42 - 75) )
        {
          v43 = *((_DWORD *)v42 - 76);
          v44 = (uint8 *)(v43 + 48);
          if ( !v43 )
            v44 = v42 - 320;
          v45.n64_u64[0] = *(unsigned __int64 *)v44;
          v46 = *((float *)v44 + 2);
          v47 = pPed1->m_WeaponSlots[pPed1->m_nCurrentWeapon].m_eWeaponType;
          v48 = CPed::GetWeaponSkill(pPed1, v47);
          if ( (CWeaponInfo::GetWeaponInfo(v47, v48)->m_nFlags & 2) != 0
            || (v49 = (float32x2_t *)pPed1->m_pMat,
                v50.n64_u64[0] = vsub_f32(v45, v49[6]).n64_u64[0],
                v51 = vmul_f32(v50, v50).n64_u64[0],
                (float)(v49[7].n64_f32[0] - v46) <= sqrtf(*(float *)&v51 + *((float *)&v51 + 1))) )
          {
            v52 = CWeapon::TargetWeaponRangeMultiplier(v19, pPed1);
            CPlayerPed::EvaluateNeighbouringTarget(
              pPed1,
              (CEntity *)(v42 - 324),
              &ppOldTarget,
              pOldTargetValue,
              m_fTargetRange * v52,
              ATanOfXY,
              v73);
          }
        }
      }
      --v39;
      v40 -= 420;
    }
    while ( v39 != -1 );
  }
  if ( CGameLogic::IsCoopGameGoingOn() == 1 )
  {
    v53 = CPools::ms_pVehiclePool;
    v54 = CPools::ms_pVehiclePool->m_nSize;
    if ( v54 )
    {
      v55 = v54 - 1;
      v56 = 2604 * v54 - 1160;
      do
      {
        if ( (v53->m_aFlags[v55] & 0x80u) == 0 )
        {
          v57 = &(*v53->m_aStorage)[v56];
          if ( v57 != (uint8 *)&elf_hash_bucket[298]
            && (*(v57 - 1373) & 0x20) == 0
            && *(_DWORD *)&(*v53->m_aStorage)[v56] != 10 )
          {
            v58 = *((_DWORD *)v57 - 356);
            v59 = (uint8 *)(v58 + 48);
            if ( !v58 )
              v59 = v57 - 1440;
            v60.n64_u64[0] = *(unsigned __int64 *)v59;
            v61 = *((float *)v59 + 2);
            v62 = pPed1->m_WeaponSlots[pPed1->m_nCurrentWeapon].m_eWeaponType;
            v63 = CPed::GetWeaponSkill(pPed1, v62);
            if ( (CWeaponInfo::GetWeaponInfo(v62, v63)->m_nFlags & 2) != 0
              || (v64 = (float32x2_t *)pPed1->m_pMat,
                  v65.n64_u64[0] = vsub_f32(v60, v64[6]).n64_u64[0],
                  v66 = vmul_f32(v65, v65).n64_u64[0],
                  (float)(v64[7].n64_f32[0] - v61) <= sqrtf(*(float *)&v66 + *((float *)&v66 + 1))) )
            {
              v67 = m_fTargetRange * CWeapon::TargetWeaponRangeMultiplier(v19, pPed1);
              CPlayerPed::EvaluateNeighbouringTarget(
                pPed1,
                (CEntity *)(v57 - 1444),
                &ppOldTarget,
                pOldTargetValue,
                v67,
                ATanOfXY,
                v73);
            }
          }
        }
        --v55;
        v56 -= 2604;
      }
      while ( v55 != -1 );
    }
  }
  v68 = (CPed *)ppOldTarget;
  if ( !ppOldTarget )
    return 0;
  if ( (*(_BYTE *)&ppOldTarget->m_info & 7) == 3
    && CWeaponInfo::GetWeaponInfo(pPed1->m_WeaponSlots[pPed1->m_nCurrentWeapon].m_eWeaponType, 1)->m_eFireType )
  {
    PedsGroup = CPedGroups::GetPedsGroup(v68);
    if ( PedsGroup )
    {
      if ( !CPedGroups::AreInSameGroup(v68, pPed1) )
      {
        v70 = (CEventGunAimedAt *)CEvent::operator new(0x14u);
        CEventGunAimedAt::CEventGunAimedAt(v70, pPed1);
        CEventGroupEvent::CEventGroupEvent(&v75, v68, (CEvent *)v70);
        CPedGroupIntelligence::AddEvent(&PedsGroup->m_intelligence, &v75);
        CEventGroupEvent::~CEventGroupEvent(&v75);
      }
    }
    else
    {
      CEventGunAimedAt::CEventGunAimedAt((CEventGunAimedAt *)&v75, pPed1);
      CEventGroup::Add(&v68->m_pPedIntelligence->m_eventGroup, &v75, 0);
      CEventGunAimedAt::~CEventGunAimedAt((CEventGunAimedAt *)&v75);
    }
  }
  CPed::SetWeaponLockOnTarget(pPed1, v68);
  result = 1;
  pPed1->m_pPlayerData->m_bDontAllowWeaponChange = 1;
  return result;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004C826C) --------------------------------------------------------
void __fastcall CPlayerPed::EvaluateNeighbouringTarget(
        CPlayerPed *this,
        CEntity *pTarget,
        CEntity **ppOldTarget,
        float *pOldTargetValue,
        float fWeaponRange,
        float OrientationToTarget,
        int bDirection)
{
  CMatrix *m_pMat; // r1
  CMatrix *v10; // r2
  CSimpleTransform *p_m_transform; // r5
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *v14; // r1
  float32x2_t v15; // d16
  unsigned __int64 v16; // d1
  CMatrix *v17; // r1
  CSimpleTransform *v18; // r1
  float i; // s0
  float v20; // s2
  float v21; // s0

  m_pMat = this->m_pMat;
  v10 = pTarget->m_pMat;
  p_m_transform = &pTarget->m_transform;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &this->m_transform;
  v14 = &pTarget->m_transform;
  if ( v10 )
    v14 = (CSimpleTransform *)&v10->tx;
  v15.n64_u64[0] = vsub_f32(*(float32x2_t *)&v14->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
  v16 = vmul_f32(v15, v15).n64_u64[0];
  if ( sqrtf(
         (float)((float)((float)(v14->m_translate.x - p_tx->m_translate.x)
                       * (float)(v14->m_translate.x - p_tx->m_translate.x))
               + *(float *)&v16)
       + *((float *)&v16 + 1)) <= fWeaponRange
    && !CPlayerPed::DoesTargetHaveToBeBroken(this, pTarget, &this->m_WeaponSlots[this->m_nCurrentWeapon]) )
  {
    v17 = pTarget->m_pMat;
    if ( v17 )
      p_m_transform = (CSimpleTransform *)&v17->tx;
    v18 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      v18 = &TheCamera.m_transform;
    for ( i = CGeneral::GetATanOfXY(
                p_m_transform->m_translate.x - v18->m_translate.x,
                p_m_transform->m_translate.y - v18->m_translate.y)
            - OrientationToTarget; i > 3.1416; i = i + -6.2832 )
      ;
    for ( ; i < -3.1416; i = i + 6.2832 )
      ;
    v20 = fabsf(i);
    if ( v20 < 0.87266 )
    {
      if ( bDirection == 1 )
      {
        if ( i <= 0.0 )
        {
LABEL_18:
          v21 = -100000.0;
          goto LABEL_21;
        }
      }
      else if ( i >= 0.0 )
      {
        goto LABEL_18;
      }
      v21 = -v20;
LABEL_21:
      if ( v21 > *pOldTargetValue )
      {
        *ppOldTarget = pTarget;
        *pOldTargetValue = v21;
      }
    }
  }
}

//----- (004C83E8) --------------------------------------------------------
int __fastcall GetTouchDistance(
        bool bDebug,
        float fTapX,
        float fTapY,
        float fMinTouchDistance,
        CVector ScreenCoorsHead,
        CVector ScreenCoorsFeet,
        float *pfDistanceOut)
{
  int result; // r0
  float v8; // s8
  float v9; // s4
  float v10; // s10
  float v11; // s12
  float v12; // s8

  result = 0;
  v8 = fMinTouchDistance * 0.5;
  v9 = ScreenCoorsHead.x - (float)(fMinTouchDistance * 0.5);
  if ( v9 < fTapX )
  {
    v10 = ScreenCoorsHead.y - v8;
    v11 = v8 + ScreenCoorsFeet.x;
    if ( (float)(v8 + ScreenCoorsFeet.x) > fTapX )
    {
      result = 0;
      if ( pfDistanceOut )
      {
        v12 = v8 + ScreenCoorsFeet.y;
        if ( v12 > fTapY )
        {
          result = 1;
          *pfDistanceOut = sqrtf(
                             (float)((float)((float)(ScreenCoorsHead.z + ScreenCoorsFeet.z) * 0.5)
                                   * (float)((float)(ScreenCoorsHead.z + ScreenCoorsFeet.z) * 0.5))
                           + (float)((float)((float)((float)((float)(v9 + v11) * 0.5) - fTapX)
                                           * (float)((float)((float)(v9 + v11) * 0.5) - fTapX))
                                   + (float)((float)((float)((float)(v10 + v12) * 0.5) - fTapY)
                                           * (float)((float)((float)(v10 + v12) * 0.5) - fTapY))));
        }
      }
    }
  }
  return result;
}

//----- (004C849C) --------------------------------------------------------
void __fastcall CPlayerPed::HandleTapToTarget(CPlayerPed *this, float fTapX, float fTapY, bool bDebug)
{
  float32x2_t v4; // d2
  float32x2_t v5; // d3
  float32x2_t v6; // d4
  float32x2_t v7; // d11
  float32x2_t v8; // d14
  float32x2_t v9; // d15
  CWeapon *m_WeaponSlots; // r5
  float screenWidth; // s22
  eWeaponType m_eWeaponType; // r4
  float screenHeight; // s26
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  CPedPool *v19; // r8
  int32 m_nSize; // r10
  eWeaponType v21; // r4
  int8 v22; // r0
  float m_fTargetRange; // s20
  float v24; // s16
  float v25; // s18
  float v26; // s26
  float v27; // s28
  int v28; // r5
  int v29; // r4
  int v30; // r9
  bool v31; // zf
  uint8 *v32; // r11
  int v33; // r0
  int v34; // r0
  eWeaponType v35; // r6
  int8 v36; // r0
  eWeaponType v37; // r0
  bool v38; // zf
  float32x2_t *v39; // r1
  CMatrix *m_pMat; // r0
  float32x2_t *p_tx; // r2
  float32x2_t *v42; // r0
  float32x2_t v43; // d16
  unsigned __int64 v44; // d0
  float v45; // s0
  float v46; // s6
  float v47; // s10
  char v48; // r0
  CPlayerPed *v49; // r4
  CObjectPool *v50; // r5
  int32 v51; // r9
  int v52; // r11
  int i; // r10
  uint8 *v54; // r6
  int v55; // r0
  const RwV3d_0 *v56; // r8
  uint8 *v57; // r2
  float v58; // s25
  eWeaponType v59; // r4
  int8 v60; // r1
  eWeaponType v61; // r0
  char m_nFlags; // r1
  float32x2_t *v63; // r0
  float32x2_t v64; // d16
  unsigned __int64 v65; // d0
  float32x2_t *v66; // r1
  float32x2_t *p_m_transform; // r2
  float32x2_t *v68; // r0
  float32x2_t v69; // d16
  float32x2_t v70; // d0
  float v71; // s25
  const RwV3d_0 *v72; // r0
  float v73; // s2
  float v74; // s6
  float v75; // s8
  float v76; // s2
  uint8 *v77; // r0
  float32x2_t v78; // d0
  bool v79; // nf
  CVehiclePool *v80; // r5
  int32 v81; // r9
  int v82; // r11
  int j; // r10
  uint8 *v84; // r6
  int v85; // r1
  float x; // s21
  float *v87; // r0
  float y; // s27
  float z; // s25
  eWeaponType v90; // r4
  int8 v91; // r1
  eWeaponType v92; // r0
  char v93; // r1
  float *p_xx; // r0
  float32x2_t *v95; // r1
  float32x2_t v96; // d16
  float32x2_t v97; // d0
  float v98; // s21
  float v99; // s2
  float v100; // s6
  float v101; // s8
  float v102; // s2
  uint8 *v103; // r0
  float32x2_t v104; // d0
  CEntity *SprayableBuilding; // r0
  CEntity *v106; // r5
  CEntity *v107; // r0
  char v108; // [sp+10h] [bp-A8h]
  _BOOL4 v109; // [sp+14h] [bp-A4h]
  uint8 *v110; // [sp+18h] [bp-A0h]
  eFireType m_eFireType; // [sp+1Ch] [bp-9Ch]
  CPlayerPed *v112; // [sp+20h] [bp-98h]
  RwV3d_0 v113; // [sp+24h] [bp-94h] BYREF
  RwV3d_0 pResult; // [sp+30h] [bp-88h] BYREF
  CVector vecPedFeet; // [sp+3Ch] [bp-7Ch] BYREF
  CVector vecPedHead; // [sp+48h] [bp-70h] BYREF

  v109 = bDebug;
  m_WeaponSlots = this->m_WeaponSlots;
  screenWidth = (float)RsGlobal.screenWidth;
  m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  screenHeight = (float)RsGlobal.screenHeight;
  WeaponSkill = CPed::GetWeaponSkill(this);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  v19 = CPools::ms_pPedPool;
  m_eFireType = WeaponInfo->m_eFireType;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  v21 = m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
  v22 = CPed::GetWeaponSkill(this, v21);
  m_fTargetRange = CWeaponInfo::GetWeaponInfo(v21, v22)->m_fTargetRange;
  v24 = fTapY;
  v25 = fTapX;
  v112 = this;
  if ( m_nSize < 1 )
  {
    v7.n64_u32[0] = 0;
    v108 = 0;
    v110 = 0;
  }
  else
  {
    v26 = screenHeight * 0.125;
    v27 = screenWidth * 0.05;
    v7.n64_u32[0] = 0;
    v28 = -(int)this;
    v29 = 0;
    v30 = 0;
    v110 = 0;
    v108 = 0;
    do
    {
      if ( (v19->m_aFlags[v30] & 0x80u) == 0 )
      {
        v32 = v19->m_aStorage[v29];
        v31 = v32 == 0;
        if ( v32 )
          v31 = &(*v19->m_aStorage)[v28 + v29 * 1996] == 0;
        if ( !v31 && (v32[1163] & 0x10) == 0 )
        {
          v33 = *((_DWORD *)v32 + 275);
          if ( (unsigned int)(v33 - 54) >= 2
            && ((unsigned int)(v33 - 50) > 1
             || (v34 = *((_DWORD *)v32 + 356)) != 0 && (unsigned int)(*(_DWORD *)(v34 + 1444) - 9) <= 1) )
          {
            v35 = v112->m_WeaponSlots[v112->m_nCurrentWeapon].m_eWeaponType;
            v36 = CPed::GetWeaponSkill(v112);
            if ( CWeaponInfo::GetWeaponInfo(v35, v36)->m_eFireType || *((_DWORD *)v32 + 359) == 8 )
              goto LABEL_18;
            v37 = v112->m_WeaponSlots[v112->m_nCurrentWeapon].m_eWeaponType;
            v38 = v37 == WEAPONTYPE_KATANA;
            if ( v37 != WEAPONTYPE_KATANA )
              v38 = v37 == WEAPONTYPE_KNIFE;
            if ( v38 )
            {
LABEL_18:
              v39 = (float32x2_t *)*((_DWORD *)v32 + 5);
              m_pMat = v112->m_pMat;
              p_tx = (float32x2_t *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = (float32x2_t *)&v112->m_transform;
              v42 = v39 + 6;
              if ( !v39 )
                v42 = (float32x2_t *)(v32 + 4);
              v43.n64_u64[0] = vsub_f32((float32x2_t)v42->n64_u64[0], (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
              v44 = vmul_f32(v43, v43).n64_u64[0];
              v8.n64_f32[1] = sqrtf(*(float *)&v44 + *((float *)&v44 + 1));
              if ( v8.n64_f32[1] <= m_fTargetRange )
              {
                memset(&vecPedFeet, 0, sizeof(vecPedFeet));
                memset(&vecPedHead, 0, sizeof(vecPedHead));
                CPed::GetHeadAndFootPositions((CPed *)v32, &vecPedHead, &vecPedFeet, 1);
                memset(&v113, 0, sizeof(v113));
                memset(&pResult, 0, sizeof(pResult));
                if ( CSprite::CalcScreenCoors(&vecPedHead, &pResult, 0, 0, 1, 1) == 1
                  && CSprite::CalcScreenCoors(&vecPedFeet, &v113, 0, 0, 1, 1) == 1 )
                {
                  v45 = v27;
                  if ( *((_DWORD *)v32 + 275) == 50 )
                    v45 = v26;
                  v46 = v45 * 0.5;
                  if ( (float)((float)(v45 * 0.5) + v113.y) > v24 )
                  {
                    v6.n64_f32[0] = v46 + v113.x;
                    v47 = pResult.x - v46;
                    if ( (float)(pResult.x - v46) < v25 )
                    {
                      v5.n64_f32[0] = pResult.y - v46;
                      v4.n64_f32[0] = (float)((float)((float)((float)(v47 + v6.n64_f32[0]) * 0.5) - v25)
                                            * (float)((float)((float)(v47 + v6.n64_f32[0]) * 0.5) - v25))
                                    + (float)((float)((float)((float)(v5.n64_f32[0]
                                                                    + (float)((float)(v45 * 0.5) + v113.y))
                                                            * 0.5)
                                                    - v24)
                                            * (float)((float)((float)(v5.n64_f32[0]
                                                                    + (float)((float)(v45 * 0.5) + v113.y))
                                                            * 0.5)
                                                    - v24));
                      v6.n64_f32[0] = v8.n64_f32[1] / 20.0;
                      v4.n64_f32[0] = sqrtf(
                                        v4.n64_f32[0]
                                      + (float)((float)((float)(v113.z + pResult.z) * 0.5)
                                              * (float)((float)(v113.z + pResult.z) * 0.5)))
                                    / (float)((float)RsGlobal.screenWidth * 0.04);
                      v5.n64_u32[0] = 1.0;
                      v4.n64_u64[0] = vmin_f32(v4, v5).n64_u64[0];
                      v5.n64_u64[0] = vmin_f32(v6, v5).n64_u64[0];
                      v4.n64_f32[0] = (float)((float)(1.0 - v5.n64_f32[0]) * 0.35)
                                    + (float)((float)(1.0 - v4.n64_f32[0]) * 0.65);
                      if ( v4.n64_f32[0] >= v7.n64_f32[0] )
                      {
                        v48 = 0;
                        v7.n64_u64[0] = v4.n64_u64[0];
                        if ( (float)((float)(v24 - v113.y) / (float)(pResult.y - v113.y)) > 0.66 )
                          v48 = 1;
                        v110 = v32;
                        v108 |= v48;
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
      ++v30;
      ++v29;
    }
    while ( m_nSize != v30 );
  }
  v49 = v112;
  if ( m_eFireType || v112->m_WeaponSlots[v112->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_KATANA )
  {
    v50 = CPools::ms_pObjectPool;
    v51 = CPools::ms_pObjectPool->m_nSize;
    if ( v51 >= 1 )
    {
      v8.n64_u32[0] = 1.0;
      v52 = 0;
      for ( i = 0; i != v51; ++i )
      {
        if ( (v50->m_aFlags[i] & 0x80u) == 0 )
        {
          v54 = v50->m_aStorage[v52];
          if ( v54 )
          {
            if ( CObject::CanBeTargetted((CObject *)v50->m_aStorage[v52])
              && (v54[324] & 0x40) == 0
              && *((_DWORD *)v54 + 6) )
            {
              v55 = *((_DWORD *)v54 + 5);
              v56 = (const RwV3d_0 *)(v54 + 4);
              v57 = v54 + 4;
              if ( v55 )
                v57 = (uint8 *)(v55 + 48);
              v9.n64_u64[0] = *(unsigned __int64 *)v57;
              v58 = *((float *)v57 + 2);
              v59 = v49->m_WeaponSlots[v49->m_nCurrentWeapon].m_eWeaponType;
              v60 = CPed::GetWeaponSkill(v112, v59);
              v61 = v59;
              v49 = v112;
              m_nFlags = CWeaponInfo::GetWeaponInfo(v61, v60)->m_nFlags;
              v63 = (float32x2_t *)v112->m_pMat;
              if ( (m_nFlags & 2) != 0
                || (v64.n64_u64[0] = vsub_f32(v9, v63[6]).n64_u64[0],
                    v65 = vmul_f32(v64, v64).n64_u64[0],
                    (float)(v63[7].n64_f32[0] - v58) <= sqrtf(*(float *)&v65 + *((float *)&v65 + 1))) )
              {
                v66 = (float32x2_t *)*((_DWORD *)v54 + 5);
                p_m_transform = v63 + 6;
                v31 = v63 == 0;
                v68 = (float32x2_t *)(v54 + 4);
                if ( v31 )
                  p_m_transform = (float32x2_t *)&v112->m_transform;
                if ( v66 )
                  v68 = v66 + 6;
                v69.n64_u64[0] = vsub_f32((float32x2_t)v68->n64_u64[0], (float32x2_t)p_m_transform->n64_u64[0]).n64_u64[0];
                v70.n64_u64[0] = vmul_f32(v69, v69).n64_u64[0];
                v71 = sqrtf(v70.n64_f32[0] + v70.n64_f32[1]);
                if ( v71 <= m_fTargetRange )
                {
                  memset(&vecPedHead, 0, sizeof(vecPedHead));
                  v72 = (const RwV3d_0 *)*((_DWORD *)v54 + 5);
                  if ( v72 )
                    v56 = v72 + 4;
                  if ( CSprite::CalcScreenCoors(v56, &vecPedHead, 0, 0, 1, 1) == 1 )
                  {
                    v73 = (float)((float)RsGlobal.screenHeight * 0.125) * 0.5;
                    v70.n64_f32[0] = vecPedHead.y + v73;
                    if ( (float)(vecPedHead.y + v73) > v24 )
                    {
                      v74 = vecPedHead.x + v73;
                      v75 = vecPedHead.x - v73;
                      if ( (float)(vecPedHead.x - v73) < v25 )
                      {
                        v76 = vecPedHead.y - v73;
                        v77 = v110;
                        v4.n64_f32[0] = v71 / 20.0;
                        v70.n64_f32[0] = sqrtf(
                                           (float)((float)((float)((float)((float)(v75 + v74) * 0.5) - v25)
                                                         * (float)((float)((float)(v75 + v74) * 0.5) - v25))
                                                 + (float)((float)((float)((float)(v76 + v70.n64_f32[0]) * 0.5) - v24)
                                                         * (float)((float)((float)(v76 + v70.n64_f32[0]) * 0.5) - v24)))
                                         + (float)((float)((float)(vecPedHead.z + vecPedHead.z) * 0.5)
                                                 * (float)((float)(vecPedHead.z + vecPedHead.z) * 0.5)))
                                       / (float)((float)RsGlobal.screenWidth * 0.04);
                        v78.n64_u64[0] = vmin_f32(v70, v8).n64_u64[0];
                        v78.n64_f32[0] = (float)((float)(1.0 - vmin_f32(v4, v8).n64_f32[0]) * 0.35)
                                       + (float)((float)(1.0 - v78.n64_f32[0]) * 0.65);
                        v79 = v78.n64_f32[0] < v7.n64_f32[0];
                        v7.n64_u64[0] = vmax_f32(v78, v7).n64_u64[0];
                        if ( !v79 )
                          v77 = v54;
                        v110 = v77;
                      }
                    }
                  }
                }
              }
            }
          }
        }
        ++v52;
      }
    }
    if ( m_eFireType )
    {
      v80 = CPools::ms_pVehiclePool;
      v81 = CPools::ms_pVehiclePool->m_nSize;
      if ( v81 >= 1 )
      {
        v9.n64_u32[0] = 1.0;
        v82 = 0;
        for ( j = 0; j != v81; ++j )
        {
          if ( (v80->m_aFlags[j] & 0x80u) == 0 )
          {
            v84 = v80->m_aStorage[v82];
            if ( v84 )
            {
              CVehicle::GetGasTankPosition(&vecPedHead, (CVehicle *)v80->m_aStorage[v82]);
              v85 = *((_DWORD *)v84 + 5);
              x = vecPedHead.x;
              v87 = (float *)(v85 + 48);
              if ( !v85 )
                v87 = (float *)(v84 + 4);
              if ( (vecPedHead.x != *v87 || vecPedHead.y != v87[1] || vecPedHead.z != v87[2])
                && (v84[1070] & 0x20) != 0
                && *((float *)v84 + 307) > 0.0 )
              {
                y = vecPedHead.y;
                z = vecPedHead.z;
                v90 = v49->m_WeaponSlots[v49->m_nCurrentWeapon].m_eWeaponType;
                v91 = CPed::GetWeaponSkill(v112, v90);
                v92 = v90;
                v49 = v112;
                v93 = CWeaponInfo::GetWeaponInfo(v92, v91)->m_nFlags;
                p_xx = &v112->m_pMat->xx;
                if ( (v93 & 2) != 0
                  || (float)(p_xx[14] - z) <= sqrtf(
                                                (float)((float)(x - p_xx[12]) * (float)(x - p_xx[12]))
                                              + (float)((float)(y - p_xx[13]) * (float)(y - p_xx[13]))) )
                {
                  v95 = (float32x2_t *)(p_xx + 12);
                  if ( !p_xx )
                    v95 = (float32x2_t *)&v112->m_transform;
                  v96.n64_u64[0] = vsub_f32(*(float32x2_t *)&vecPedHead.x, (float32x2_t)v95->n64_u64[0]).n64_u64[0];
                  v97.n64_u64[0] = vmul_f32(v96, v96).n64_u64[0];
                  v98 = sqrtf(v97.n64_f32[0] + v97.n64_f32[1]);
                  if ( v98 <= m_fTargetRange )
                  {
                    memset(&vecPedFeet, 0, sizeof(vecPedFeet));
                    if ( CSprite::CalcScreenCoors(&vecPedHead, &vecPedFeet, 0, 0, 1, 1) == 1 )
                    {
                      v99 = (float)((float)RsGlobal.screenHeight * 0.04) * 0.5;
                      v97.n64_f32[0] = vecPedFeet.y + v99;
                      if ( (float)(vecPedFeet.y + v99) > v24 )
                      {
                        v100 = vecPedFeet.x + v99;
                        v101 = vecPedFeet.x - v99;
                        if ( (float)(vecPedFeet.x - v99) < v25 )
                        {
                          v102 = vecPedFeet.y - v99;
                          v103 = v110;
                          v4.n64_f32[0] = v98 / 20.0;
                          v97.n64_f32[0] = sqrtf(
                                             (float)((float)((float)((float)((float)(v101 + v100) * 0.5) - v25)
                                                           * (float)((float)((float)(v101 + v100) * 0.5) - v25))
                                                   + (float)((float)((float)((float)(v102 + v97.n64_f32[0]) * 0.5) - v24)
                                                           * (float)((float)((float)(v102 + v97.n64_f32[0]) * 0.5) - v24)))
                                           + (float)((float)((float)(vecPedFeet.z + vecPedFeet.z) * 0.5)
                                                   * (float)((float)(vecPedFeet.z + vecPedFeet.z) * 0.5)))
                                         / (float)((float)RsGlobal.screenWidth * 0.04);
                          v104.n64_u64[0] = vmin_f32(v97, v9).n64_u64[0];
                          v104.n64_f32[0] = (float)((float)(1.0 - vmin_f32(v4, v9).n64_f32[0]) * 0.35)
                                          + (float)((float)(1.0 - v104.n64_f32[0]) * 0.65);
                          v79 = v104.n64_f32[0] < v7.n64_f32[0];
                          v7.n64_u64[0] = vmax_f32(v104, v7).n64_u64[0];
                          if ( !v79 )
                            v103 = v84;
                          v110 = v103;
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          ++v82;
        }
      }
    }
  }
  if ( v49->m_WeaponSlots[v49->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_SPRAYCAN )
  {
    SprayableBuilding = CPlayerPed::FindSprayableBuilding(v49);
    v106 = (CEntity *)v110;
    if ( SprayableBuilding )
      v106 = SprayableBuilding;
    if ( v109 )
      return;
  }
  else
  {
    v106 = (CEntity *)v110;
    if ( v109 )
      return;
  }
  if ( v106 )
  {
    v107 = v106;
    if ( (*(_BYTE *)&v106->m_info & 7) != 2 )
      v107 = 0;
    CVehicle::SetTappedGasTankVehicle(v107);
    if ( v106 != v49->m_pEntLockOnTarget )
    {
      v49->m_pPlayerData->m_bDontAllowWeaponChange = 1;
      CPed::SetWeaponLockOnTarget(v49, v106);
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 33, 0.0, 1.0);
      CPlayerPed::bSwipeTargetHeads = v108 & 1;
      return;
    }
  }
  else
  {
    CVehicle::SetTappedGasTankVehicle(0);
  }
  if ( v49->m_nPedType <= 1u )
  {
    CPed::SetWeaponLockOnTarget(v49, 0);
    CCamera::ClearPlayerWeaponMode(&TheCamera);
    CWeaponEffects::ClearCrossHair(v49->m_nPedType);
  }
}
// 4C8762: variable 'v4' is possibly undefined
// 4C8762: variable 'v5' is possibly undefined
// 4C8766: variable 'v6' is possibly undefined
// 4C89F0: variable 'v8' is possibly undefined
// 4C8A0C: variable 'v7' is possibly undefined
// 4C8C56: variable 'v9' is possibly undefined

//----- (004C8D8C) --------------------------------------------------------
void __fastcall CPlayerPed::HandleMeleeTargeting(CPlayerPed *this)
{
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  bool v5; // zf
  CPad *Pad; // r0
  int32 m_nSize; // r2
  uint8 *m_aFlags; // r5
  float v9; // s0
  int v10; // r3
  CEntity *v11; // r1
  bool v12; // zf
  uint8 *v13; // r6
  unsigned int v14; // r0
  CMatrix *m_pMat; // r10
  float32x2_t *v16; // r9
  CSimpleTransform *p_tx; // r0
  float32x2_t *v18; // r10
  float32x2_t v19; // d16
  int v20; // r9
  int v21; // r0
  float32x2_t v22; // d16
  unsigned __int64 v23; // d2
  float v24; // s4
  bool v25; // zf

  if ( !CPad::GetPad(0)->DisablePlayerControls
    && !CTaskManager::FindActiveTaskByType(&this->m_pPedIntelligence->m_taskManager, 307) )
  {
    m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
    WeaponSkill = CPed::GetWeaponSkill(this);
    WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
    if ( m_eWeaponType == WEAPONTYPE_UNARMED )
      goto LABEL_8;
    v5 = (m_eWeaponType | 8) == 43;
    if ( (m_eWeaponType | 8) != 43 )
      v5 = WeaponInfo->m_eFireType == FIRETYPE_INSTANT_HIT;
    if ( !v5 )
    {
LABEL_8:
      Pad = CPad::GetPad(0);
      if ( !CPad::GetBlock(Pad) )
      {
        m_nSize = CPools::ms_pPedPool->m_nSize;
        if ( m_nSize >= 1 )
        {
          m_aFlags = CPools::ms_pPedPool->m_aFlags;
          v9 = 3.4028e38;
          v10 = 0;
          v11 = 0;
          do
          {
            if ( (*m_aFlags & 0x80u) == 0 )
            {
              v13 = CPools::ms_pPedPool->m_aStorage[v10];
              v12 = v13 == 0;
              if ( v13 )
                v12 = (char *)CPools::ms_pPedPool->m_aStorage - (char *)this + v10 * 1996 == 0;
              if ( !v12 && (v13[1163] & 0x10) == 0 )
              {
                v14 = *((_DWORD *)v13 + 275) - 50;
                if ( v14 > 5 || ((1 << v14) & 0x33) == 0 )
                {
                  m_pMat = this->m_pMat;
                  v16 = (float32x2_t *)*((_DWORD *)v13 + 5);
                  p_tx = (CSimpleTransform *)&m_pMat->tx;
                  if ( !m_pMat )
                    p_tx = &this->m_transform;
                  v18 = v16 + 6;
                  v19.n64_u64[0] = *(unsigned __int64 *)&p_tx->m_translate.x;
                  if ( !v16 )
                    v18 = (float32x2_t *)(v13 + 4);
                  v20 = 0;
                  v21 = 0;
                  v22.n64_u64[0] = vsub_f32((float32x2_t)v18->n64_u64[0], v19).n64_u64[0];
                  v23 = vmul_f32(v22, v22).n64_u64[0];
                  v24 = sqrtf(*(float *)&v23 + *((float *)&v23 + 1));
                  if ( v24 < v9 )
                    v20 = 1;
                  if ( v24 <= 10.0 )
                    v21 = 1;
                  if ( (v21 & v20) != 0 )
                  {
                    v9 = v24;
                    v11 = (CEntity *)CPools::ms_pPedPool->m_aStorage[v10];
                  }
                }
              }
            }
            ++v10;
            ++m_aFlags;
            --m_nSize;
          }
          while ( m_nSize );
          v25 = v11 == 0;
          if ( v11 )
            v25 = v11 == this->m_pEntLockOnTarget;
          if ( !v25 && v11 != this->m_pEntMagnetizeTarget )
          {
            this->m_pPlayerData->m_bDontAllowWeaponChange = 1;
            sub_192730(this, v11);
          }
        }
      }
    }
  }
}
// 676C84: using guessed type int CPools::ms_pPedPool[2];

//----- (004C8EFC) --------------------------------------------------------
bool __fastcall CPlayerPed::DoesTargetHaveToBeBroken(CPlayerPed *this, CEntity *pTargetEnt, CWeapon *pWeapon)
{
  float v6; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_m_transform; // r9
  CMatrix *v9; // r2
  float v10; // s18
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *v12; // r1
  eWeaponType m_eWeaponType; // r5
  float32x2_t v14; // d16
  unsigned __int64 v15; // d1
  float v16; // s16
  int8 WeaponSkill; // r0
  CMatrix *v19; // r0
  eWeaponType v20; // r5
  float32x2_t v21; // d9
  float z; // s16
  int8 v23; // r0
  float32x2_t *v24; // r0
  float32x2_t v25; // d16
  unsigned __int64 v26; // d0

  if ( (*(_BYTE *)&pTargetEnt->m_nFlags & 0x80) == 0 )
    return 1;
  v6 = CWeapon::TargetWeaponRangeMultiplier(pTargetEnt, this);
  m_pMat = this->m_pMat;
  p_m_transform = &pTargetEnt->m_transform;
  v9 = pTargetEnt->m_pMat;
  v10 = v6;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &this->m_transform;
  v12 = &pTargetEnt->m_transform;
  if ( v9 )
    v12 = (CSimpleTransform *)&v9->tx;
  m_eWeaponType = pWeapon->m_eWeaponType;
  v14.n64_u64[0] = vsub_f32(*(float32x2_t *)&v12->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
  v15 = vmul_f32(v14, v14).n64_u64[0];
  v16 = sqrtf(
          (float)((float)((float)(v12->m_translate.x - p_tx->m_translate.x)
                        * (float)(v12->m_translate.x - p_tx->m_translate.x))
                + *(float *)&v15)
        + *((float *)&v15 + 1));
  WeaponSkill = CPed::GetWeaponSkill(this, pWeapon->m_eWeaponType);
  if ( v16 > (float)(v10 * CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_fTargetRange)
    || pWeapon->m_eWeaponType == WEAPONTYPE_SPRAYCAN
    && (*(_BYTE *)&pTargetEnt->m_info & 7) == 1
    && CTagManager::IsTag(pTargetEnt)
    && CTagManager::GetAlpha(pTargetEnt) == 255 )
  {
    return 1;
  }
  v19 = pTargetEnt->m_pMat;
  if ( v19 )
    p_m_transform = (CSimpleTransform *)&v19->tx;
  v20 = pWeapon->m_eWeaponType;
  v21.n64_u64[0] = *(unsigned __int64 *)&p_m_transform->m_translate.x;
  z = p_m_transform->m_translate.z;
  v23 = CPed::GetWeaponSkill(this, pWeapon->m_eWeaponType);
  if ( (CWeaponInfo::GetWeaponInfo(v20, v23)->m_nFlags & 2) == 0
    && (v24 = (float32x2_t *)this->m_pMat,
        v25.n64_u64[0] = vsub_f32(v21, v24[6]).n64_u64[0],
        v26 = vmul_f32(v25, v25).n64_u64[0],
        (float)(v24[7].n64_f32[0] - z) > sqrtf(*(float *)&v26 + *((float *)&v26 + 1))) )
  {
    return 1;
  }
  else
  {
    return 0;
  }
}

//----- (004C901C) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CPlayerPed::Compute3rdPersonMouseTarget(CPlayerPed *this, bool bUseCrosshair)
{
  _BOOL4 v2; // r5
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_m_transform; // r8
  float m_fTargetRange; // s0
  CSimpleTransform *p_tx; // r0
  __int64 v11; // r2
  float z; // r0
  CPed *m_pMouseLockOnRecruitPed; // r0
  CPed **p_m_pMouseLockOnRecruitPed; // r5
  char *v15; // r1
  __int64 v16; // d16
  float v17; // s2
  float v18; // s4
  float v19; // s12
  __int64 v20; // d16
  float v21; // r1
  float v22; // s6
  float v23; // s14
  CPed *IsAlive; // r6
  CEntity *v25; // r5
  int m_nCurrentWeapon; // r1
  eWeaponType v27; // r5
  int8 v28; // r0
  CMatrix *v29; // r1
  CPedIntelligence *m_pPedIntelligence; // r1
  CTask *v31; // r0
  bool v32; // zf
  CPedGroup *PedsGroup; // r5
  CEventGunAimedAt *v34; // r8
  float bCheckBuildings; // [sp+0h] [bp-80h]
  CEntity *refEntityPtr; // [sp+20h] [bp-60h] BYREF
  CColPoint colPoint; // [sp+24h] [bp-5Ch] BYREF
  CVector vecEnd; // [sp+50h] [bp-30h] BYREF
  CVector vecStart; // [sp+60h] [bp-20h] BYREF

  v2 = bUseCrosshair;
  if ( CHID::GetInputType() == 2 )
  {
    m_eWeaponType = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
    WeaponSkill = CPed::GetWeaponSkill(this);
    WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
    m_pMat = this->m_pMat;
    p_m_transform = &this->m_transform;
    m_fTargetRange = WeaponInfo->m_fTargetRange;
    p_tx = &this->m_transform;
    if ( m_pMat )
      p_tx = (CSimpleTransform *)&m_pMat->tx;
    v11 = *(_QWORD *)&p_tx->m_translate.x;
    z = p_tx->m_translate.z;
    if ( v2 )
    {
      bCheckBuildings = z;
      CCamera::Find3rdPersonCamTargetVector(&TheCamera, m_fTargetRange, *(CVector *)&v11, &vecStart, &vecEnd);
    }
    else
    {
      v15 = (char *)&TheCamera + 528 * TheCamera.ActiveCam;
      v16 = *(_QWORD *)(v15 + 740);
      vecStart.z = *((RwReal *)v15 + 187);
      *(_QWORD *)&vecStart.x = v16;
      v17 = *((float *)&v16 + 1);
      v18 = *(float *)&v16;
      v19 = *((float *)&v16 + 1) - *((float *)&v11 + 1);
      v20 = *((_QWORD *)v15 + 91);
      v21 = *((float *)v15 + 184);
      *(_QWORD *)&vecEnd.x = v20;
      vecEnd.z = v21;
      v22 = vecStart.z;
      v23 = (float)((float)((float)(v18 - *(float *)&v11) * *(float *)&v20) + (float)(v19 * *((float *)&v20 + 1)))
          + (float)((float)(vecStart.z - z) * v21);
      if ( v23 < 0.0 )
      {
        v17 = v17 - (float)(*((float *)&v20 + 1) * v23);
        v18 = v18 - (float)(*(float *)&v20 * v23);
        v22 = vecStart.z - (float)(v21 * v23);
        vecStart.y = v17;
        vecStart.x = v18;
        vecStart.z = v22;
      }
      vecEnd.y = v17 + (float)(m_fTargetRange * *((float *)&v20 + 1));
      vecEnd.x = v18 + (float)(m_fTargetRange * *(float *)&v20);
      vecEnd.z = v22 + (float)(m_fTargetRange * v21);
    }
    IsAlive = 0;
    refEntityPtr = 0;
    CWorld::pIgnoreEntity = this;
    CWorld::bIncludeBikers = 1;
    if ( CWorld::ProcessLineOfSight(&vecStart, &vecEnd, &colPoint, &refEntityPtr, 0, 0, 1, 0, 0, 0, 0, 0) == 1 )
    {
      v25 = refEntityPtr;
      if ( refEntityPtr == this )
      {
        IsAlive = 0;
      }
      else
      {
        IsAlive = (CPed *)CPed::IsAlive((const CPed *)refEntityPtr);
        if ( IsAlive )
          IsAlive = (CPed *)v25;
      }
    }
    CWorld::ResetLineTestOptions();
    m_pMouseLockOnRecruitPed = this->m_pMouseLockOnRecruitPed;
    p_m_pMouseLockOnRecruitPed = &this->m_pMouseLockOnRecruitPed;
    if ( IsAlive )
    {
      if ( IsAlive != m_pMouseLockOnRecruitPed )
      {
        if ( m_pMouseLockOnRecruitPed )
          CEntity::CleanUpOldReference(m_pMouseLockOnRecruitPed, &this->m_pMouseLockOnRecruitPed);
        *p_m_pMouseLockOnRecruitPed = IsAlive;
        CEntity::RegisterReference(IsAlive, &this->m_pMouseLockOnRecruitPed);
      }
      m_nCurrentWeapon = this->m_nCurrentWeapon;
      this->m_iMouseLockOnRecruitTimer = CTimer::m_snTimeInMilliseconds + 1000;
      if ( CWeaponInfo::GetWeaponInfo(this->m_WeaponSlots[m_nCurrentWeapon].m_eWeaponType, 1)->m_eFireType )
      {
        v27 = this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType;
        v28 = CPed::GetWeaponSkill(this);
        if ( LOBYTE(CWeaponInfo::GetWeaponInfo(v27, v28)->m_nFlags) << 31 )
        {
          v29 = this->m_pMat;
          if ( v29 )
            p_m_transform = (CSimpleTransform *)&v29->tx;
          if ( CPedIntelligence::IsInSeeingRange(IsAlive->m_pPedIntelligence, &p_m_transform->m_translate) )
          {
            m_pPedIntelligence = IsAlive->m_pPedIntelligence;
            v31 = m_pPedIntelligence->m_taskManager.m_tasks[0];
            v32 = v31 == 0;
            if ( !v31 )
            {
              v31 = m_pPedIntelligence->m_taskManager.m_tasks[1];
              v32 = v31 == 0;
            }
            if ( v32 && (v31 = m_pPedIntelligence->m_taskManager.m_tasks[2]) == 0
              || (*((int (__fastcall **)(CTask *))v31->_vptr$CTask + 5))(v31) != 601 )
            {
              if ( this->m_WeaponSlots[this->m_nCurrentWeapon].m_eWeaponType != WEAPONTYPE_PISTOL_SILENCED )
                CPed::Say(this, 0xB0u, 0, 1.0, 0, 0, 0);
              PedsGroup = CPedGroups::GetPedsGroup(IsAlive);
              if ( PedsGroup )
              {
                if ( !CPedGroups::AreInSameGroup(IsAlive, this) )
                {
                  v34 = (CEventGunAimedAt *)CEvent::operator new(0x14u);
                  CEventGunAimedAt::CEventGunAimedAt(v34, this);
                  CEventGroupEvent::CEventGroupEvent((CEventGroupEvent *)&colPoint, IsAlive, (CEvent *)v34);
                  CPedGroupIntelligence::AddEvent(&PedsGroup->m_intelligence, (CEvent *)&colPoint);
                  CEventGroupEvent::~CEventGroupEvent((CEventGroupEvent *)&colPoint);
                }
              }
              else
              {
                CEventGunAimedAt::CEventGunAimedAt((CEventGunAimedAt *)&colPoint, this);
                CEventGroup::Add(&IsAlive->m_pPedIntelligence->m_eventGroup, (CEvent *)&colPoint, 0);
                CEventGunAimedAt::~CEventGunAimedAt((CEventGunAimedAt *)&colPoint);
              }
            }
          }
        }
      }
      return;
    }
  }
  else
  {
    m_pMouseLockOnRecruitPed = this->m_pMouseLockOnRecruitPed;
    p_m_pMouseLockOnRecruitPed = &this->m_pMouseLockOnRecruitPed;
  }
  if ( m_pMouseLockOnRecruitPed && this->m_iMouseLockOnRecruitTimer < CTimer::m_snTimeInMilliseconds )
    *p_m_pMouseLockOnRecruitPed = 0;
}
// 4C901C: fragmented variable at r2.8 may be wrong

//----- (004C9320) --------------------------------------------------------
void __fastcall CPlayerPed::DrawTriangleForMouseRecruitPed(const CPlayerPed *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d8
  float32x2_t v3; // d12
  unsigned int v5; // r11
  CPed *m_pMouseLockOnRecruitPed; // r6
  unsigned int v7; // r9
  unsigned int v8; // r10
  float32x2_t v9; // d0
  float v10; // s4
  CMatrix *m_pMat; // r0
  float *p_x; // r8
  CMatrix *v13; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r0
  float32x2_t v16; // d16
  unsigned __int64 v17; // d1
  CMatrix *v18; // r5
  float32x2_t v19; // d0
  float v20; // s19
  float xx; // s0
  float yx; // s2
  float zx; // s4
  float m_heading; // r4
  CMatrix *v25; // r0
  float v26; // s6
  float v27; // s4
  float v28; // s2
  float v29; // s0
  float v30; // s26
  float v31; // s22
  float v32; // s20
  float v33; // s16
  float v34; // s18
  float v35; // s24
  float v36; // s30
  float v37; // s17
  float v38; // s28
  CSimpleTransform *v39; // r6
  CSimpleTransform *v40; // r0
  float z; // s4
  RwReal v42; // s0
  CSimpleTransform *v43; // r1
  RwReal v44; // s2
  float x; // s19
  RwReal v46; // s4
  float y; // s21
  float v48; // s23
  RwReal v49; // s2
  float v50; // s25
  RwReal v51; // s4
  float v52; // s27
  float v53; // s29
  CVector v54; // [sp+4h] [bp-6Ch] BYREF

  if ( this->m_pMouseLockOnRecruitPed )
  {
    v5 = 0;
    RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, 0);
    RwRenderStateSet(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
    RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
    RwRenderStateSet(rwRENDERSTATEDESTBLEND, &byte_6);
    RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
    RwRenderStateSet(rwRENDERSTATETEXTURERASTER, 0);
    RwRenderStateSet(rwRENDERSTATEALPHATESTFUNCTION, byte_8);
    m_pMouseLockOnRecruitPed = this->m_pMouseLockOnRecruitPed;
    v2.n64_u32[0] = 1.0;
    v7 = 0;
    v8 = 0;
    v1.n64_f32[0] = m_pMouseLockOnRecruitPed->m_nHealth / m_pMouseLockOnRecruitPed->m_nMaxHealth;
    v9.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
    if ( v9.n64_f32[0] > 0.0 )
    {
      v10 = (float)(1.0 - v9.n64_f32[0]) * 0.0;
      v5 = (unsigned int)(float)((float)(v9.n64_f32[0] * 0.0) + v10);
      v7 = (unsigned int)(float)((float)(v9.n64_f32[0] * 255.0) + v10);
      v8 = (unsigned int)(float)((float)(v9.n64_f32[0] * 0.0) + (float)((float)(1.0 - v9.n64_f32[0]) * 255.0));
    }
    m_pMat = this->m_pMat;
    p_x = &m_pMouseLockOnRecruitPed->m_transform.m_translate.x;
    v13 = m_pMouseLockOnRecruitPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    p_m_transform = &m_pMouseLockOnRecruitPed->m_transform;
    if ( v13 )
      p_m_transform = (CSimpleTransform *)&v13->tx;
    v3.n64_u32[0] = 0;
    v16.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
    v17 = vmul_f32(v16, v16).n64_u64[0];
    v18 = TheCamera.m_pMat;
    v9.n64_f32[0] = sqrtf(
                      (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                    * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                            + *(float *)&v17)
                    + *((float *)&v17 + 1))
                  + -10.0;
    v19.n64_u64[0] = vmax_f32(v9, v3).n64_u64[0];
    v19.n64_f32[0] = v19.n64_f32[0] * 0.02;
    v20 = (float)(vmin_f32(v19, v2).n64_f32[0] * 0.825) + 0.175;
    if ( TheCamera.m_pMat )
    {
      xx = TheCamera.m_pMat->xx;
      yx = TheCamera.m_pMat->yx;
      zx = TheCamera.m_pMat->zx;
    }
    else
    {
      m_heading = TheCamera.m_transform.m_heading;
      zx = 0.0;
      xx = cosf(TheCamera.m_transform.m_heading);
      yx = sinf(m_heading);
    }
    v25 = m_pMouseLockOnRecruitPed->m_pMat;
    v26 = v20 * xx;
    v27 = v20 * zx;
    v28 = v20 * yx;
    if ( v25 )
      p_x = &v25->tx;
    v29 = v20 * 0.0;
    v30 = *p_x + 0.0;
    v31 = p_x[1] + 0.0;
    v32 = p_x[2] + 1.0;
    if ( m_pMouseLockOnRecruitPed->m_nPedType == 7 )
    {
      v33 = v20 + (float)(v27 + v32);
      v34 = v29 + (float)(v28 + v31);
      v35 = v29 + (float)(v26 + v30);
      v36 = v20 + (float)(v32 - v27);
      v37 = v29 + (float)(v31 - v28);
      v38 = v29 + (float)(v30 - v26);
    }
    else
    {
      v33 = v32 - v27;
      v36 = v27 + v32;
      v34 = v31 - v28;
      v37 = v28 + v31;
      v35 = v30 - v26;
      v38 = v26 + v30;
      v32 = v20 + v32;
      v31 = v29 + v31;
      v30 = v29 + v30;
    }
    v39 = &TheCamera.m_transform;
    v40 = &TheCamera.m_transform;
    if ( v18 )
      v40 = (CSimpleTransform *)&v18->tx;
    z = v40->m_translate.z;
    v42 = v40->m_translate.x - v30;
    v54.y = v40->m_translate.y - v31;
    v54.x = v42;
    v54.z = z - v32;
    CVector::Normalise(&v54);
    v43 = &TheCamera.m_transform;
    if ( TheCamera.m_pMat )
      v43 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    v44 = v43->m_translate.y - v37;
    x = v54.x;
    v46 = v43->m_translate.z - v36;
    y = v54.y;
    v48 = v54.z;
    v54.x = v43->m_translate.x - v38;
    v54.y = v44;
    v54.z = v46;
    CVector::Normalise(&v54);
    if ( TheCamera.m_pMat )
      v39 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    v49 = v39->m_translate.y - v34;
    v50 = v54.x;
    v51 = v39->m_translate.z - v33;
    v52 = v54.y;
    v53 = v54.z;
    v54.x = v39->m_translate.x - v35;
    v54.y = v49;
    v54.z = v51;
    CVector::Normalise(&v54);
    TempVertexBuffer.m_3d[0].position.x = v30 + x;
    TempVertexBuffer.m_3d[0].position.y = v31 + y;
    TempVertexBuffer.m_3d[0].position.z = v32 + v48;
    TempVertexBuffer.m_3d[0].color = (RwRGBA_0)((v5 << 16) | (v7 << 8) | v8 | 0xFF000000);
    TempVertexBuffer.m_3d[1].color = (RwRGBA_0)((v5 << 16) | (v7 << 8) | v8);
    TempVertexBuffer.m_3d[1].position.x = v38 + v50;
    TempVertexBuffer.m_3d[1].position.y = v37 + v52;
    TempVertexBuffer.m_3d[1].position.z = v36 + v53;
    TempVertexBuffer.m_3d[2].color = TempVertexBuffer.m_3d[1].color;
    TempBufferRenderIndexList[2] = 2;
    *(_DWORD *)TempBufferRenderIndexList = 0x10000;
    TempVertexBuffer.m_3d[2].position.x = v35 + v54.x;
    TempVertexBuffer.m_3d[2].position.y = v34 + v54.y;
    TempVertexBuffer.m_3d[2].position.z = v33 + v54.z;
    if ( RwIm3DTransform(TempVertexBuffer.m_3d, 3u, 0, 0x18u) )
    {
      RwIm3DRenderIndexedPrimitive(rwPRIMTYPETRILIST, TempBufferRenderIndexList, 3);
      RwIm3DEnd();
    }
    RwRenderStateSet(rwRENDERSTATETEXTURERASTER, 0);
    RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, (char *)&dword_0 + 1);
    RwRenderStateSet(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
    RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
    RwRenderStateSet(rwRENDERSTATEDESTBLEND, &byte_6);
    RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, 0);
    RwRenderStateSet(rwRENDERSTATEALPHATESTFUNCTION, &byte_5);
  }
}
// 4C939C: variable 'v1' is possibly undefined
// 4C939C: variable 'v2' is possibly undefined
// 4C9450: variable 'v3' is possibly undefined
// 0: using guessed type int dword_0;
// 5: using guessed type char byte_5;
// 6: using guessed type char byte_6;

//----- (004C970C) --------------------------------------------------------
void __fastcall CPlayerPed::Busted(CPlayerPed *this)
{
  this->m_pPlayerData->m_Wanted->m_nWantedLevel = 0;
}

//----- (004C9718) --------------------------------------------------------
void __fastcall CPlayerPed::SetWantedLevel(CPlayerPed *this, Int32 NewLevel)
{
  CPlayerPedData *m_pPlayerData; // r0
  CWanted *m_Wanted; // r0

  m_pPlayerData = this->m_pPlayerData;
  if ( m_pPlayerData )
    m_Wanted = m_pPlayerData->m_Wanted;
  else
    m_Wanted = 0;
  sub_1928C4(m_Wanted, NewLevel);
}

//----- (004C9728) --------------------------------------------------------
void __fastcall CPlayerPed::SetWantedLevelNoDrop(CPlayerPed *this, Int32 NewLevel)
{
  CPlayerPedData *m_pPlayerData; // r0
  CWanted *m_Wanted; // r0

  m_pPlayerData = this->m_pPlayerData;
  if ( m_pPlayerData )
    m_Wanted = m_pPlayerData->m_Wanted;
  else
    m_Wanted = 0;
  sub_18A9C0(m_Wanted, NewLevel);
}

//----- (004C9738) --------------------------------------------------------
void __fastcall CPlayerPed::CheatWantedLevel(CPlayerPed *this, Int32 NewLevel)
{
  CPlayerPedData *m_pPlayerData; // r0
  CWanted *m_Wanted; // r0

  m_pPlayerData = this->m_pPlayerData;
  if ( m_pPlayerData )
    m_Wanted = m_pPlayerData->m_Wanted;
  else
    m_Wanted = 0;
  sub_191A50(m_Wanted, NewLevel);
}

//----- (004C9748) --------------------------------------------------------
void __fastcall CPlayerPed::KeepAreaAroundPlayerClear(CPlayerPed *this)
{
  int v2; // r8
  CEntity **m_entities; // r5
  int *v4; // r10
  CTask *TaskByType; // r0
  CEvent *EventOfType; // r0
  bool v7; // zf
  CTaskComplexSmartFleeEntity *v8; // r10
  CTask *v9; // r2
  CEntity *v10; // r6
  int m_heading_low; // r0
  bool v12; // zf
  bool v13; // zf
  char *m_pMyVehicle; // r0
  int v15; // r1
  float *v16; // r2
  CMatrix *m_pMat; // r0
  float v18; // s16
  CSimpleTransform *p_tx; // r1
  float v20; // s18
  float v21; // s20
  __int64 v22; // d16
  Int16 v23; // r1
  int v24; // r6
  int v25; // r0
  unsigned int v26; // r2
  bool v27; // zf
  float *v28; // r1
  float *v29; // r2
  float v30; // s2
  int v31; // r1
  float v32; // s6
  float v33; // s4
  int iEntityPosCheckPeriod; // [sp+1Ch] [bp-74h]
  CVector Coors; // [sp+20h] [bp-70h] BYREF
  Int16 pNum; // [sp+2Eh] [bp-62h] BYREF
  CEventScriptCommand v37[4]; // [sp+30h] [bp-60h] BYREF

  v2 = 0;
  m_entities = this->m_pPedIntelligence->m_pedScanner.m_entities;
  v4 = &elf_hash_bucket[187];
  do
  {
    v10 = m_entities[v2];
    if ( v10 )
    {
      m_heading_low = LOBYTE(v10[18].m_transform.m_heading);
      v12 = m_heading_low == 1;
      if ( m_heading_low == 1 )
        v12 = BYTE1(v10[19].m_transform.m_heading) << 31 == 0;
      if ( v12
        && CPed::IsAlive((const CPed *)m_entities[v2])
        && !CPedGroupMembership::IsMember(&CPedGroups::ms_groups[0].m_membership, (const CPed *)v10) )
      {
        if ( !CEntity::GetIsOnScreen(v10) || (*(_BYTE *)&v10[19].m_nFlags & 0x10) != 0 )
        {
          (*((void (__fastcall **)(CEntity *))v10->_vptr$CPlaceable + 22))(v10);
        }
        else
        {
          TaskByType = CPedIntelligence::FindTaskByType(
                         (const CPedIntelligence *)LODWORD(v10[18].m_transform.m_translate.y),
                         911);
          if ( !TaskByType || (CPlayerPed *)TaskByType[1].m_pParent != this )
          {
            EventOfType = CEventGroup::GetEventOfType(
                            (const CEventGroup *)(LODWORD(v10[18].m_transform.m_translate.y) + 104),
                            32);
            v7 = EventOfType == 0;
            if ( EventOfType )
            {
              EventOfType = (CEvent *)EventOfType[1].m_iAccumulatedTime;
              v7 = EventOfType == 0;
            }
            if ( v7 || (*((int (__fastcall **)(CEvent *))EventOfType->_vptr$CEvent + 5))(EventOfType) != 911 )
            {
              iEntityPosCheckPeriod = (int)v4;
              v8 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
              CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
                v8,
                this,
                0,
                1000.0,
                (const int)&elf_hash_chain[8526],
                iEntityPosCheckPeriod,
                1.0);
              v8->m_iMoveState = 4;
              v9 = v8;
              v4 = (int *)iEntityPosCheckPeriod;
              CEventScriptCommand::CEventScriptCommand(v37, 3, v9, 0);
              CEventGroup::Add((CEventGroup *)(LODWORD(v10[18].m_transform.m_translate.y) + 104), v37, 0);
              CEventScriptCommand::~CEventScriptCommand(v37);
            }
          }
        }
      }
    }
    ++v2;
  }
  while ( v2 != 16 );
  m_pMyVehicle = (char *)(*((unsigned __int8 *)&this->m_nPedFlags + 1) << 31);
  v13 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = (char *)this->m_pMyVehicle;
    v13 = m_pMyVehicle == 0;
  }
  if ( v13 )
    m_pMyVehicle = (char *)this;
  v15 = *((_DWORD *)m_pMyVehicle + 5);
  v16 = (float *)(v15 + 48);
  if ( !v15 )
    v16 = (float *)(m_pMyVehicle + 4);
  m_pMat = this->m_pMat;
  v18 = *v16;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  v20 = v16[1];
  v21 = v16[2];
  if ( !m_pMat )
    p_tx = &this->m_transform;
  v22 = *(_QWORD *)&p_tx->m_translate.x;
  Coors.z = p_tx->m_translate.z;
  *(_QWORD *)&Coors.x = v22;
  CWorld::FindObjectsInRange(&Coors, 15.0, 1, &pNum, 6, (CEntity **)v37, 0, 1, 0, 0, 0);
  v23 = pNum;
  if ( pNum >= 1 )
  {
    v24 = 0;
    do
    {
      v25 = *((_DWORD *)&v37[0]._vptr$CEvent + v24);
      if ( *(_BYTE *)(v25 + 1192) != 2 )
      {
        v26 = *(unsigned __int8 *)(v25 + 58);
        v27 = v26 >> 3 == 0;
        if ( v26 >> 3 )
          v27 = v26 >> 3 == 9;
        if ( !v27 )
        {
          v28 = *(float **)(v25 + 20);
          v29 = v28 + 12;
          if ( !v28 )
            v29 = (float *)(v25 + 4);
          v30 = v29[1];
          if ( (float)((float)((float)((float)(*v29 - v18) * (float)(*v29 - v18))
                             + (float)((float)(v30 - v20) * (float)(v30 - v20)))
                     + (float)((float)(v29[2] - v21) * (float)(v29[2] - v21))) <= 25.0 )
          {
            v32 = v28[5];
            v33 = v28[4];
            v31 = 2000;
            if ( (float)((float)((float)(v18 - *v29) * v33) + (float)((float)(v20 - v30) * v32)) > 0.0 )
              *(_BYTE *)(v25 + 959) = 3;
            else
              *(_BYTE *)(v25 + 959) = 9;
          }
          else
          {
            *(_BYTE *)(v25 + 959) = 1;
            v31 = 5000;
          }
          *(_DWORD *)(v25 + 960) = v31 + CTimer::m_snTimeInMilliseconds;
          CCarCtrl::PossiblyRemoveVehicle((CVehicle *)v25);
          v23 = pNum;
        }
      }
      ++v24;
    }
    while ( v24 < v23 );
  }
}
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];

//----- (004C99CC) --------------------------------------------------------
CPlayerInfo *__fastcall CPlayerPed::GetPlayerInfoForThisPlayerPed(CPlayerPed *this)
{
  CPlayerInfo *result; // r0

  result = CWorld::Players;
  if ( CWorld::Players[0].pPed != this )
  {
    result = 0;
    if ( CWorld::Players[1].pPed == this )
      return &CWorld::Players[1];
  }
  return result;
}

//----- (004C99FC) --------------------------------------------------------
void __fastcall CPlayerPed::DoStuffToGoOnFire(CPlayerPed *this)
{
  if ( this->m_nPedState == PED_SNIPER_MODE )
    sub_1966A8(&TheCamera);
}

//----- (004C9A14) --------------------------------------------------------
void __fastcall CPlayerPed::AnnoyPlayerPed(CPlayerPed *this, bool bUsingVees)
{
  CPedStats *m_pPedStats; // r0
  int m_nTemper; // r2

  m_pPedStats = this->m_pPedStats;
  m_nTemper = m_pPedStats->m_nTemper;
  if ( m_nTemper > 51 )
  {
    if ( m_nTemper <= 54 && bUsingVees )
    {
      m_pPedStats->m_nTemper = m_nTemper + 1;
    }
    else if ( bUsingVees )
    {
      m_pPedStats->m_nTemper = 46;
    }
  }
  else
  {
    m_pPedStats->m_nTemper = m_nTemper + 1;
  }
}

//----- (004C9A48) --------------------------------------------------------
void __fastcall CPlayerPed::ClearAdrenaline(CPlayerPed *this)
{
  CPlayerPedData *m_pPlayerData; // r0

  m_pPlayerData = this->m_pPlayerData;
  if ( (*((_BYTE *)m_pPlayerData + 52) & 2) != 0 )
  {
    if ( m_pPlayerData->m_AdrenalineEndTime )
    {
      m_pPlayerData->m_AdrenalineEndTime = 0;
      CTimer::ms_fTimeScale = 1.0;
    }
  }
}

//----- (004C9A74) --------------------------------------------------------
void __fastcall CPlayerPed::SetPlayerMoveBlendRatio(CPlayerPed *this, CVector *pvecTarget)
{
  CMatrix *m_pMat; // r2
  float x; // s0
  float y; // s2
  CSimpleTransform *p_tx; // r1
  float v6; // s0
  CPlayerPedData *m_pPlayerData; // r1
  unsigned __int32 v8; // r1
  float v9; // s0

  if ( pvecTarget )
  {
    m_pMat = this->m_pMat;
    x = pvecTarget->x;
    y = pvecTarget->y;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &this->m_transform;
    v6 = sqrtf(
           (float)((float)(x - p_tx->m_translate.x) * (float)(x - p_tx->m_translate.x))
         + (float)((float)(y - p_tx->m_translate.y) * (float)(y - p_tx->m_translate.y)));
    this->m_pPlayerData->m_moveBlendRatio = v6 + v6;
    m_pPlayerData = this->m_pPlayerData;
    if ( m_pPlayerData->m_moveBlendRatio > 2.0 )
      m_pPlayerData->m_moveBlendRatio = 2.0;
  }
  else
  {
    v8 = this->m_eMoveState - 4;
    if ( v8 > 3 )
      v9 = 0.0;
    else
      v9 = *(float *)&dword_4C9B04[v8];
    this->m_pPlayerData->m_moveBlendRatio = v9;
  }
  CPlayerPed::SetRealMoveAnim(this);
}
// 4C9B04: using guessed type int dword_4C9B04[2];

//----- (004C9B14) --------------------------------------------------------
CPed *__fastcall CPlayerPed::FindPedToAttack(CPlayerPed *this)
{
  unsigned __int64 v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d13
  CPedPool *v4; // r6
  int32 m_nSize; // r8
  CPed *result; // r0
  int v7; // r0
  float32x2_t v8; // d14
  int i; // r11
  CPool<CPed,CCopPed>::StorageType *m_aStorage; // r4
  uint8 *v11; // r9
  int v12; // r0
  uint8 *v13; // r1
  float v14; // r0
  float32x2_t v15; // d16
  float32x2_t v16; // d0
  CPed *v17; // [sp+0h] [bp-90h]
  CVector pVecEnd; // [sp+Ch] [bp-84h] BYREF
  CVector pVecStart; // [sp+18h] [bp-78h] BYREF
  CVector pPoint; // [sp+28h] [bp-68h] BYREF

  v4 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  FindPlayerCoors(&pVecStart, -1);
  pVecEnd.z = 0.0;
  pVecStart.z = 0.0;
  pVecEnd.x = (float)(TheCamera.m_cameraMatrix.xy * 100.0) + pVecStart.x;
  pVecEnd.y = (float)(TheCamera.m_cameraMatrix.yy * 100.0) + pVecStart.y;
  if ( !m_nSize )
    return 0;
  LODWORD(v1) = 1203982323;
  v3.n64_u32[0] = 0;
  result = 0;
  do
  {
    v17 = result;
    v7 = 1996 * m_nSize;
    v8.n64_u64[0] = v1;
    --m_nSize;
    for ( i = v7 - 560; ; i -= 1996 )
    {
      if ( (v4->m_aFlags[m_nSize] & 0x80u) == 0 )
      {
        m_aStorage = v4->m_aStorage;
        v11 = &(*v4->m_aStorage)[i];
        if ( v11 != (uint8 *)&elf_hash_bucket[296]
          && !CPed::IsPlayer((const CPed *)(v11 - 1436))
          && CPed::IsAlive((const CPed *)(v11 - 1436))
          && !CPedGroupMembership::IsMember(
                &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership,
                (const CPed *)(v11 - 1436))
          && *(_DWORD *)&(*m_aStorage)[i] != 8 )
        {
          break;
        }
      }
      if ( --m_nSize == -1 )
        return v17;
    }
    v12 = *((_DWORD *)v11 - 354);
    v13 = (uint8 *)(v12 + 48);
    if ( !v12 )
      v13 = v11 - 1432;
    *(_QWORD *)&pPoint.x = *(_QWORD *)v13;
    pPoint.z = 0.0;
    v14 = CCollision::DistToLine(&pVecStart, &pVecEnd, &pPoint);
    v2.n64_f32[0] = v14;
    v15.n64_u64[0] = vsub_f32(*(float32x2_t *)&pPoint.x, *(float32x2_t *)&pVecStart.x).n64_u64[0];
    v16.n64_u64[0] = vmul_f32(v15, v15).n64_u64[0];
    v16.n64_f32[0] = sqrtf(v16.n64_f32[0] + v16.n64_f32[1]);
    if ( v16.n64_f32[0] > 20.0 )
      v2.n64_f32[0] = v14 + (float)((float)(v16.n64_f32[0] + -20.0) * 0.2);
    if ( (unsigned int)(*(_DWORD *)&(*m_aStorage)[i] - 7) <= 9 )
    {
      v16.n64_f32[0] = (float)(v2.n64_f32[0] * 0.5) + -2.0;
      v2.n64_u64[0] = vmax_f32(v16, v3).n64_u64[0];
    }
    result = v17;
    v1 = vmin_f32(v2, v8).n64_u64[0];
    if ( v2.n64_f32[0] < v8.n64_f32[0] )
      result = (CPed *)(v11 - 1436);
  }
  while ( m_nSize );
  return result;
}
// 4C9BBA: variable 'v1' is possibly undefined
// 4C9C9A: variable 'v3' is possibly undefined
// 4C9CA8: variable 'v2' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 676C84: using guessed type int CPools::ms_pPedPool[2];

//----- (004C9CEC) --------------------------------------------------------
void __fastcall CPlayerPed::DisbandPlayerGroup(CPlayerPed *this)
{
  int v2; // r0
  UInt16 v3; // r1

  v2 = CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership);
  if ( v2 >= 1 )
  {
    if ( v2 == 1 )
      v3 = 150;
    else
      v3 = 149;
    CPed::Say(this, v3, 0, 1.0, 0, 0, 0);
  }
  sub_199224(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership, 1);
}

//----- (004C9D58) --------------------------------------------------------
void __fastcall CPlayerPed::MakeThisPedJoinOurGroup(CPlayerPed *this, CPed *pCandidate)
{
  Int32 MaxNumberOfGroupMembers; // r8
  int m_nScriptLimitToGangSize; // r6
  float StatValue; // r0
  CPedGroup *PedsGroup; // r0
  CTaskComplexBeInGroup *v8; // r6
  CPlayerPed *PlayerPed; // r0
  void *v10; // r6
  int v11; // r10
  unsigned int v12; // r6
  CEventGroupEvent v13; // [sp+10h] [bp-48h] BYREF
  CEventScriptCommand v14; // [sp+24h] [bp-34h] BYREF

  if ( (*((_BYTE *)&pCandidate->m_nPedFlags + 13) & 4) != 0 )
  {
    CPed::Say(this, 0x52u, 0, 1.0, 0, 0, 0);
  }
  else if ( !CTaskManager::FindActiveTaskByType(&pCandidate->m_pPedIntelligence->m_taskManager, 1000)
         && (pCandidate->m_nPedType == 8
          || (CCheat::m_aCheatsActive[86] | CCheat::m_aCheatsActive[84] | CCheat::m_aCheatsActive[85]) << 24)
         && !CPedGroupMembership::IsMember(
               &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership,
               pCandidate) )
  {
    CAEPedSpeechAudioEntity::SetCJMood(-1, 0x2710u, 1, -1, -1);
    CPed::Say(this, 0x7Fu, 0, 1.0, 1, 0, 0);
    MaxNumberOfGroupMembers = CStats::FindMaxNumberOfGroupMembers();
    m_nScriptLimitToGangSize = this->m_pPlayerData->m_nScriptLimitToGangSize;
    if ( CStats::GetStatValue(0xB5u) == 1.0 )
    {
      m_nScriptLimitToGangSize = 0;
    }
    else
    {
      StatValue = CStats::GetStatValue(0xB5u);
      if ( MaxNumberOfGroupMembers < m_nScriptLimitToGangSize )
        m_nScriptLimitToGangSize = MaxNumberOfGroupMembers;
      if ( StatValue == 2.0 )
        m_nScriptLimitToGangSize = 0;
    }
    if ( (CCheat::m_aCheatsActive[86] | CCheat::m_aCheatsActive[84] | CCheat::m_aCheatsActive[85]) << 24
      && CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership) < 7
      || CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership) < m_nScriptLimitToGangSize
      && CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership) < m_nScriptLimitToGangSize )
    {
      PedsGroup = CPedGroups::GetPedsGroup(pCandidate);
      if ( PedsGroup )
        CPedGroupMembership::RemoveMember(&PedsGroup->m_membership, pCandidate);
      v8 = (CTaskComplexBeInGroup *)CTask::operator new(0x28u);
      PlayerPed = FindPlayerPed(-1);
      CTaskComplexBeInGroup::CTaskComplexBeInGroup(v8, PlayerPed->m_pPlayerData->m_PlayerGroup, 0);
      CEventScriptCommand::CEventScriptCommand(&v14, 3, v8, 0);
      CEventGroup::Add(&pCandidate->m_pPedIntelligence->m_eventGroup, &v14, 0);
      CPedGroupMembership::AddFollower(
        &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership,
        pCandidate);
      CPedGroup::Process(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup]);
      CPed::GiveWeaponWhenJoiningGang(pCandidate);
      v10 = CEvent::operator new(0x10u);
      CEvent::CEvent((CEvent *)v10);
      *(_DWORD *)v10 = &off_6692EC;
      *((_DWORD *)v10 + 3) = pCandidate;
      CEntity::RegisterReference(pCandidate, (CEntity **)v10 + 3);
      CEventGroupEvent::CEventGroupEvent(&v13, this, (CEvent *)v10);
      CPedGroupIntelligence::AddEvent(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_intelligence, &v13);
      *((_DWORD *)&pCandidate->m_nPedFlags + 1) &= ~0x100000u;
      CStats::IncrementStat(0xEEu, 1.0);
      CStats::DisplayScriptStatUpdateMessage(1u, 0x150u, 1.0);
      v11 = (gaGangColoursR[1] << 24) | (gaGangColoursG[1] << 16) | (gaGangColoursB[1] << 8) | 0xFF;
      v12 = CRadar::SetEntityBlip(
              BLIPTYPE_CHAR,
              CPools::ms_pPedPool->m_aFlags[-1093107909
                                          * (((char *)pCandidate - (char *)CPools::ms_pPedPool->m_aStorage) >> 2)] | (-662750464 * (((char *)pCandidate - (char *)CPools::ms_pPedPool->m_aStorage) >> 2)),
              v11,
              BLIPDISPLAY_BLIPONLY,
              (Char *)"CODEPLR");
      CRadar::ChangeBlipScale(v12, 2);
      CRadar::ChangeBlipColour(v12, v11);
      CRadar::SetBlipFriendly(v12, 1u);
      *((_DWORD *)&pCandidate->m_nPedFlags + 2) |= 0x2000u;
      CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership.m_fMaxSeparation = 120.0;
      CPed::Say(pCandidate, 0x7Eu, 0x9C4u, 1.0, 1, 0, 0);
      CEventGroupEvent::~CEventGroupEvent(&v13);
      CEventScriptCommand::~CEventScriptCommand(&v14);
    }
    else
    {
      CPed::Say(pCandidate, 0x7Du, 0x9C4u, 1.0, 1, 0, 0);
      CEvent::CEvent(&v14);
      v14.m_iTaskPriority = (int)this;
      v14._vptr$CEvent = (int (**)(void))&off_669338;
      CEntity::RegisterReference(this, (CEntity **)&v14.m_iTaskPriority);
      CEventGroup::Add(&pCandidate->m_pPedIntelligence->m_eventGroup, &v14, 0);
      v14._vptr$CEvent = (int (**)(void))&off_669338;
      if ( v14.m_iTaskPriority )
        CEntity::CleanUpOldReference((CEntity *)v14.m_iTaskPriority, (CEntity **)&v14.m_iTaskPriority);
      CEvent::~CEvent(&v14);
    }
  }
}
// 6692EC: using guessed type void *;
// 669338: using guessed type void *;
// 676C84: using guessed type int CPools::ms_pPedPool[2];

//----- (004CA110) --------------------------------------------------------
void __fastcall CPlayerPed::ForceGroupToAlwaysFollow(CPlayerPed *this, bool bOn)
{
  CPlayerPedData *m_pPlayerData; // r2
  __int16 v3; // r3

  m_pPlayerData = this->m_pPlayerData;
  v3 = *((_WORD *)m_pPlayerData + 26);
  if ( bOn )
  {
    *((_WORD *)m_pPlayerData + 26) = v3 | 0x200;
    CPlayerPed::TellGroupToStartFollowingPlayer(this, 1, 0, 1);
  }
  else
  {
    *((_WORD *)m_pPlayerData + 26) = v3 & 0xFDFF;
  }
}

//----- (004CA134) --------------------------------------------------------
void __fastcall CPlayerPed::ForceGroupToNeverFollow(CPlayerPed *this, bool bOn)
{
  CPlayerPedData *m_pPlayerData; // r2
  __int16 v3; // r3
  CPlayerPedData *v4; // r1

  m_pPlayerData = this->m_pPlayerData;
  v3 = *((_WORD *)m_pPlayerData + 26);
  if ( bOn )
  {
    *((_WORD *)m_pPlayerData + 26) = v3 | 0x400;
    v4 = this->m_pPlayerData;
    if ( (*((_BYTE *)v4 + 53) & 2) == 0 )
    {
      CPedGroups::ms_groups[v4->m_PlayerGroup].m_followLeader = 0;
      sub_1901D0(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_intelligence, 5);
    }
  }
  else
  {
    *((_WORD *)m_pPlayerData + 26) = v3 & 0xFBFF;
  }
}

//----- (004CA188) --------------------------------------------------------
void __fastcall CPlayerPed::PlayerWantsToAttack(CPlayerPed *this)
{
  Int32 m_PlayerGroup; // r0
  CPed *m_pEntLockOnTarget; // r5
  int InputType; // r0

  if ( CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership) >= 1 )
  {
    m_PlayerGroup = this->m_pPlayerData->m_PlayerGroup;
    if ( CPedGroups::ms_groups[m_PlayerGroup].m_followLeader )
    {
      CPedGroupIntelligence::ReportAllBarScriptTasksFinished(&CPedGroups::ms_groups[m_PlayerGroup].m_intelligence);
      m_pEntLockOnTarget = (CPed *)this->m_pEntLockOnTarget;
      InputType = CHID::GetInputType();
      if ( !m_pEntLockOnTarget && InputType == 2 )
        m_pEntLockOnTarget = this->m_pMouseLockOnRecruitPed;
      if ( !m_pEntLockOnTarget )
        goto LABEL_11;
      if ( (*(_BYTE *)&m_pEntLockOnTarget->m_info & 7) == 3 )
        goto LABEL_12;
      if ( !CTagManager::IsTag(m_pEntLockOnTarget)
        && ((*(_BYTE *)&m_pEntLockOnTarget->m_info & 7) != 4 || !CObject::CanBeTargetted((CObject *)m_pEntLockOnTarget)) )
      {
LABEL_11:
        m_pEntLockOnTarget = CPlayerPed::FindPedToAttack(this);
LABEL_12:
        if ( m_pEntLockOnTarget )
          j_CPedGroup::PlayerGaveCommand_Attack(
            &CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup],
            this,
            m_pEntLockOnTarget);
      }
    }
  }
}

//----- (004CA250) --------------------------------------------------------
void __fastcall CPlayerPed::MakeGroupRespondToPlayerTakingDamage(CPlayerPed *this, const CEventDamage *eventDamage)
{
  Int32 m_PlayerGroup; // r6
  CEvent *v5; // r0
  CEventGroupEvent v6; // [sp+4h] [bp-24h] BYREF

  if ( eventDamage->m_pInflictor
    && CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership) >= 1 )
  {
    m_PlayerGroup = this->m_pPlayerData->m_PlayerGroup;
    if ( CPedGroups::ms_groups[m_PlayerGroup].m_followLeader )
    {
      v5 = (CEvent *)(*((int (__fastcall **)(const CEventDamage *))eventDamage->_vptr$CEvent + 5))(eventDamage);
      CEventGroupEvent::CEventGroupEvent(&v6, this, v5);
      CPedGroupIntelligence::AddEvent(&CPedGroups::ms_groups[m_PlayerGroup].m_intelligence, &v6);
      CEventGroupEvent::~CEventGroupEvent(&v6);
    }
  }
}

//----- (004CA2D8) --------------------------------------------------------
void __fastcall CPlayerPed::MakePlayerGroupDisappear(CPlayerPed *this)
{
  int i; // r5
  CPed *Member; // r0
  bool v4; // zf
  int v5; // r3
  int m_nPedFlags; // r1
  int v7; // r2
  int v8; // r4

  for ( i = 0; i != 7; ++i )
  {
    Member = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership, i);
    v4 = Member == 0;
    if ( Member )
      v4 = Member->CharCreatedBy == 2;
    if ( !v4 )
    {
      v5 = *((_DWORD *)&Member->m_nPedFlags + 2);
      m_nPedFlags = (int)Member->m_nPedFlags;
      v7 = *((_DWORD *)&Member->m_nPedFlags + 1);
      v8 = *((_DWORD *)&Member->m_nPedFlags + 3);
      *(_DWORD *)&Member->m_nFlags &= 0xFFFFFF7E;
      abTempNeverLeavesGroup[i] = (v5 & 0x4000) != 0;
      *(_DWORD *)&Member->m_nPedFlags = m_nPedFlags;
      *((_DWORD *)&Member->m_nPedFlags + 1) = v7;
      *((_DWORD *)&Member->m_nPedFlags + 2) = v5 | 0x4000;
      *((_DWORD *)&Member->m_nPedFlags + 3) = v8;
    }
  }
}

//----- (004CA364) --------------------------------------------------------
void __fastcall CPlayerPed::MakePlayerGroupReappear(CPlayerPed *this)
{
  int i; // r5
  CPed *Member; // r0
  bool v4; // zf
  _DWORD *p_m_nFlags; // r0
  int v6; // r2
  int m_nFlags; // t1
  int v8; // r1
  int v9; // r12
  int v10; // r6
  int v11; // r3
  _DWORD *v12; // r4
  int v13; // lr
  int v14; // r0

  for ( i = 0; i != 7; ++i )
  {
    Member = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_pPlayerData->m_PlayerGroup].m_membership, i);
    v4 = Member == 0;
    if ( Member )
      v4 = Member->CharCreatedBy == 2;
    if ( !v4 )
    {
      m_nFlags = (int)Member->m_nFlags;
      p_m_nFlags = &Member->m_nFlags;
      v6 = m_nFlags;
      v8 = p_m_nFlags[282];
      v9 = p_m_nFlags[283];
      v10 = p_m_nFlags[284];
      v11 = p_m_nFlags[285];
      *p_m_nFlags = m_nFlags | 0x80;
      v12 = p_m_nFlags + 282;
      if ( (v8 & 0x100) == 0 )
      {
        v13 = p_m_nFlags[1];
        *p_m_nFlags = v6 | 0x81;
        p_m_nFlags[1] = v13;
      }
      v14 = abTempNeverLeavesGroup[i];
      *v12 = v8;
      v12[1] = v9;
      v12[2] = v10 & 0xFFFFBFFF | (v14 << 14);
      v12[3] = v11;
    }
  }
}

//----- (004CA400) --------------------------------------------------------
void __fastcall CPlayerPed::ResetSprintEnergy(CPlayerPed *this)
{
  this->m_pPlayerData->m_fSprintEnergy = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_SPRINT_ENERGY);
}

//----- (004CA414) --------------------------------------------------------
float __fastcall CPlayerPed::ControlButtonSprint(CPlayerPed *this, eSprintType nSprintType)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  CPlayerPedData *m_pPlayerData; // r1
  float v8; // s16
  int32 m_nPedType; // r0
  int32 v10; // r0
  CPad *Pad; // r0
  CPad *v12; // r6
  int v13; // r0
  float m_fSprintControlCounter; // s0
  SprintControlData *v15; // r0
  float fTapAdd; // s2
  float fThreshhold; // s2
  float v18; // s18
  float *p_fEnergyRateStd; // r0
  float v20; // s20
  CPlayerPedData *v22; // r0
  _BOOL4 Sprint; // r0
  int PedWalkUpDown; // r0

  m_pPlayerData = this->m_pPlayerData;
  v8 = 0.0;
  if ( !m_pPlayerData )
    return v8;
  m_nPedType = this->m_nPedType;
  if ( m_nPedType == 1 )
  {
    v10 = 1;
  }
  else
  {
    if ( m_nPedType )
    {
      v12 = 0;
      goto LABEL_8;
    }
    v10 = 0;
  }
  Pad = CPad::GetPad(v10);
  m_pPlayerData = this->m_pPlayerData;
  v12 = Pad;
LABEL_8:
  if ( m_pPlayerData->m_bPlayerSprintDisabled
    || m_pPlayerData->m_fSprintControlCounter <= 0.0 && m_pPlayerData->m_fSprintEnergy <= 0.0 )
  {
    v13 = 0;
LABEL_10:
    m_fSprintControlCounter = m_pPlayerData->m_fSprintControlCounter;
    if ( m_fSprintControlCounter <= 0.0 )
      goto LABEL_18;
    v4.n64_u32[0] = 0;
    v2.n64_f32[0] = m_fSprintControlCounter - (float)(PLAYER_SPRINT_SET[nSprintType].fReleaseSub * CTimer::ms_fTimeStep);
    goto LABEL_12;
  }
  if ( CPad::SprintJustDown(v12) )
  {
    m_pPlayerData = this->m_pPlayerData;
    v15 = &PLAYER_SPRINT_SET[nSprintType];
    fTapAdd = v15->fTapAdd;
    v4.n64_u32[0] = LODWORD(v15->fMaxLimit);
    v13 = 1;
    v2.n64_f32[0] = m_pPlayerData->m_fSprintControlCounter + fTapAdd;
    v2.n64_u64[0] = vmin_f32(v4, v2).n64_u64[0];
    goto LABEL_17;
  }
  Sprint = CPad::GetSprint(v12, nSprintType);
  m_pPlayerData = this->m_pPlayerData;
  if ( !Sprint )
  {
    v13 = 1;
    goto LABEL_10;
  }
  v4.n64_u32[0] = 1.0;
  v13 = 1;
  v2.n64_f32[0] = m_pPlayerData->m_fSprintControlCounter
                - (float)(PLAYER_SPRINT_SET[nSprintType].fHoldSub * CTimer::ms_fTimeStep);
LABEL_12:
  v2.n64_u64[0] = vmax_f32(v2, v4).n64_u64[0];
LABEL_17:
  LODWORD(m_pPlayerData->m_fSprintControlCounter) = v2.n64_u32[0];
  m_fSprintControlCounter = this->m_pPlayerData->m_fSprintControlCounter;
LABEL_18:
  fThreshhold = PLAYER_SPRINT_SET[nSprintType].fThreshhold;
  if ( m_fSprintControlCounter <= fThreshhold )
  {
    v20 = 1.0;
    v18 = 0.0;
    if ( m_fSprintControlCounter <= 0.0 || v13 != 1 )
      goto LABEL_24;
    v18 = 1.0;
    p_fEnergyRateStd = &PLAYER_SPRINT_SET[nSprintType].fEnergyRateStd;
  }
  else
  {
    v18 = m_fSprintControlCounter / fThreshhold;
    p_fEnergyRateStd = &PLAYER_SPRINT_SET[nSprintType].fEnergyRateBashing;
  }
  v20 = *p_fEnergyRateStd;
LABEL_24:
  if ( FindPlayerVehicle(-1, 0) || CPad::GetPedWalkLeftRight(v12) )
  {
    if ( v18 <= 0.0 )
      return v8;
  }
  else
  {
    PedWalkUpDown = CPad::GetPedWalkUpDown(v12);
    if ( v18 <= 0.0 || !PedWalkUpDown )
      return v8;
  }
  if ( !CWorld::Players[CWorld::PlayerInFocus].DoesNotGetTired && v20 != 0.0 )
  {
    v22 = this->m_pPlayerData;
    if ( (*((_WORD *)v22 + 26) & 2) == 0 )
    {
      v2.n64_u32[0] = -1021968384;
      v3.n64_u32[0] = LODWORD(v22->m_fSprintEnergy);
      if ( v3.n64_f32[0] <= -150.0 )
      {
        v22->m_fSprintControlCounter = 0.0;
        return v8;
      }
      v3.n64_f32[0] = v3.n64_f32[0] - (float)(v20 * CTimer::ms_fTimeStep);
      v2.n64_u64[0] = vmax_f32(v3, v2).n64_u64[0];
      LODWORD(v22->m_fSprintEnergy) = v2.n64_u32[0];
    }
  }
  v3.n64_u32[0] = 0;
  v2.n64_f32[0] = v18 + -1.0;
  return (float)(vmax_f32(v2, v3).n64_f32[0] * PLAYER_SPRINT_SET[nSprintType].fResultMult) + 1.0;
}
// 4CA48A: variable 'v2' is possibly undefined
// 4CA48A: variable 'v4' is possibly undefined
// 4CA594: variable 'v3' is possibly undefined

//----- (004CA68C) --------------------------------------------------------
void __fastcall CPlayerPed::ResetPlayerBreath(CPlayerPed *this)
{
  this->m_pPlayerData->m_fBreath = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_BREATH_UNDERWATER);
  *((_WORD *)this->m_pPlayerData + 26) &= ~0x80u;
}

//----- (004CA6AC) --------------------------------------------------------
void __fastcall CEventDontJoinPlayerGroup::~CEventDontJoinPlayerGroup(CEventDontJoinPlayerGroup *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_669338;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  sub_1911C4(this);
}
// 669338: using guessed type void *off_669338;

//----- (004CA6DC) --------------------------------------------------------
void __fastcall CEventNewGangMember::~CEventNewGangMember(CEventNewGangMember *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_6692EC;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  sub_1911C4(this);
}
// 6692EC: using guessed type void *off_6692EC;

//----- (004CA708) --------------------------------------------------------
void __fastcall CEventNewGangMember::~CEventNewGangMember(CEventNewGangMember *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1
  void *v4; // r0

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_6692EC;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  CEvent::~CEvent(this);
  sub_1978E4(v4);
}
// 4CA730: variable 'v4' is possibly undefined
// 6692EC: using guessed type void *off_6692EC;

//----- (004CA738) --------------------------------------------------------
int __fastcall CEventNewGangMember::GetEventType(const CEventNewGangMember *this)
{
  return 90;
}

//----- (004CA73C) --------------------------------------------------------
int __fastcall CEventNewGangMember::GetEventPriority(const CEventNewGangMember *this)
{
  return 42;
}

//----- (004CA740) --------------------------------------------------------
int __fastcall CEventNewGangMember::GetLifeTime(const CEventNewGangMember *this)
{
  return 0;
}

//----- (004CA744) --------------------------------------------------------
CEvent *__fastcall CEventNewGangMember::Clone(const CEventNewGangMember *this)
{
  void *v2; // r4
  CPed *m_pPed; // r5

  v2 = CEvent::operator new(0x10u);
  m_pPed = this->m_pPed;
  CEvent::CEvent((CEvent *)v2);
  *(_DWORD *)v2 = &off_6692EC;
  *((_DWORD *)v2 + 3) = m_pPed;
  if ( m_pPed )
    CEntity::RegisterReference(m_pPed, (CEntity **)v2 + 3);
  return (CEvent *)v2;
}
// 6692EC: using guessed type void *off_6692EC;

//----- (004CA77C) --------------------------------------------------------
bool __fastcall CEventNewGangMember::AffectsPed(const CEventNewGangMember *this, CPed *pPed)
{
  return 1;
}

//----- (004CA780) --------------------------------------------------------
void __fastcall CEventDontJoinPlayerGroup::~CEventDontJoinPlayerGroup(CEventDontJoinPlayerGroup *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1
  void *v4; // r0

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_669338;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  CEvent::~CEvent(this);
  sub_1978E4(v4);
}
// 4CA7A8: variable 'v4' is possibly undefined
// 669338: using guessed type void *off_669338;

//----- (004CA7B0) --------------------------------------------------------
int __fastcall CEventDontJoinPlayerGroup::GetEventType(const CEventDontJoinPlayerGroup *this)
{
  return 94;
}

//----- (004CA7B4) --------------------------------------------------------
int __fastcall CEventDontJoinPlayerGroup::GetEventPriority(const CEventDontJoinPlayerGroup *this)
{
  return 43;
}

//----- (004CA7B8) --------------------------------------------------------
int __fastcall CEventDontJoinPlayerGroup::GetLifeTime(const CEventDontJoinPlayerGroup *this)
{
  return 0;
}

//----- (004CA7BC) --------------------------------------------------------
CEvent *__fastcall CEventDontJoinPlayerGroup::Clone(const CEventDontJoinPlayerGroup *this)
{
  void *v2; // r4
  CPed *m_pPed; // r5

  v2 = CEvent::operator new(0x10u);
  m_pPed = this->m_pPed;
  CEvent::CEvent((CEvent *)v2);
  *(_DWORD *)v2 = &off_669338;
  *((_DWORD *)v2 + 3) = m_pPed;
  if ( m_pPed )
    CEntity::RegisterReference(m_pPed, (CEntity **)v2 + 3);
  return (CEvent *)v2;
}
// 669338: using guessed type void *off_669338;

//----- (004CA7F4) --------------------------------------------------------
bool __fastcall CEventDontJoinPlayerGroup::AffectsPed(const CEventDontJoinPlayerGroup *this, CPed *pPed)
{
  return 1;
}

//----- (004CA7F8) --------------------------------------------------------
void __fastcall CEventPlayerCommandToGroupGather::~CEventPlayerCommandToGroupGather(
        CEventPlayerCommandToGroupGather *this)
{
  void *v1; // r0

  CEventPlayerCommandToGroup::~CEventPlayerCommandToGroup(this);
  sub_1978E4(v1);
}
// 4CA804: variable 'v1' is possibly undefined

//----- (004CA808) --------------------------------------------------------
int __fastcall CEventPlayerCommandToGroupGather::GetEventType(const CEventPlayerCommandToGroupGather *this)
{
  return 76;
}

//----- (004CA80C) --------------------------------------------------------
int __fastcall CEventPlayerCommandToGroupGather::GetEventPriority(const CEventPlayerCommandToGroupGather *this)
{
  return 45;
}

//----- (004CA810) --------------------------------------------------------
CEvent *__fastcall CEventPlayerCommandToGroupGather::CloneEditable(const CEventPlayerCommandToGroupGather *this)
{
  CEventPlayerCommandToGroup *v2; // r0
  CEvent *result; // r0

  v2 = (CEventPlayerCommandToGroup *)CEvent::operator new(0x18u);
  CEventPlayerCommandToGroup::CEventPlayerCommandToGroup(v2, 2, this->m_pPed);
  result->_vptr$CEvent = (int (**)(void))&off_669384;
  return result;
}
// 4CA82C: variable 'result' is possibly undefined
// 669384: using guessed type void *off_669384;

//----- (004CA834) --------------------------------------------------------
void CPopCycle::Update()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d2
  Int32 v2; // r1
  _BOOL4 v3; // r2
  const CVector *PlayerCentreOfWorld; // r0
  __int64 v5; // d16
  unsigned int v6; // lr
  unsigned int v7; // r8
  unsigned int v8; // r12
  unsigned int v9; // r2
  unsigned int v10; // r4
  unsigned int v11; // r5
  CVector v12; // [sp+0h] [bp-28h] BYREF

  switch ( CClock::CurrentDay )
  {
    case 0u:
    case 7u:
      v2 = 1;
      goto LABEL_4;
    case 1u:
      v3 = CClock::ms_nGameClockHours < 0x14u;
      goto LABEL_8;
    case 2u:
    case 3u:
    case 4u:
    case 5u:
      v2 = 0;
LABEL_4:
      CPopCycle::m_nCurrentTimeOfWeek = v2;
      break;
    case 6u:
      v3 = CClock::ms_nGameClockHours > 0x13u;
LABEL_8:
      CPopCycle::m_nCurrentTimeOfWeek = v3;
      break;
    default:
      CClock::CurrentDay = 0;
      break;
  }
  CPopCycle::m_nCurrentTimeIndex = CClock::ms_nGameClockHours >> 1;
  PlayerCentreOfWorld = FindPlayerCentreOfWorld(CWorld::PlayerInFocus);
  v5 = *(_QWORD *)&PlayerCentreOfWorld->x;
  v12.z = PlayerCentreOfWorld->z;
  *(_QWORD *)&v12.x = v5;
  if ( v12.z < 950.0 || !CPopCycle::m_pCurrZoneInfo )
  {
    CPopCycle::m_pCurrZoneInfo = CTheZones::GetZoneInfo(&v12, &CPopCycle::m_pCurrZone);
    CPopCycle::m_nCurrentZoneType = *(_WORD *)((char *)CPopCycle::m_pCurrZoneInfo + 15) & 0x1F;
  }
  CPopCycle::UpdatePercentages();
  CPopCycle::UpdateDealerStrengths();
  CPopCycle::m_fCurrentZoneDodgyness = (float)((float)CPopCycle::m_pCurrZoneInfo->DealerStrength * 0.07) + 0.0;
  CPopCycle::m_fCurrentZoneDodgyness = CPopCycle::m_fCurrentZoneDodgyness
                                     + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[0] * 0.01);
  CPopCycle::m_fCurrentZoneDodgyness = CPopCycle::m_fCurrentZoneDodgyness
                                     + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[1] * 0.01);
  CPopCycle::m_fCurrentZoneDodgyness = CPopCycle::m_fCurrentZoneDodgyness
                                     + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[2] * 0.01);
  v6 = CPopCycle::m_pCurrZoneInfo->aGangStrengths[4];
  v7 = CPopCycle::m_pCurrZoneInfo->aGangStrengths[5];
  v8 = CPopCycle::m_pCurrZoneInfo->aGangStrengths[6];
  v9 = CPopCycle::m_pCurrZoneInfo->aGangStrengths[7];
  v10 = CPopCycle::m_pCurrZoneInfo->aGangStrengths[8];
  v11 = CPopCycle::m_pCurrZoneInfo->aGangStrengths[9];
  v1.n64_u32[0] = 1.0;
  v0.n64_f32[0] = (float)((float)((float)((float)((float)((float)(CPopCycle::m_fCurrentZoneDodgyness
                                                                + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[3]
                                                                        * 0.01))
                                                        + (float)((float)v6 * 0.01))
                                                + (float)((float)v7 * 0.01))
                                        + (float)((float)v8 * 0.01))
                                + (float)((float)v9 * 0.01))
                        + (float)((float)v10 * 0.01))
                + (float)((float)v11 * 0.01);
  LODWORD(CPopCycle::m_fCurrentZoneDodgyness) = vmin_f32(v0, v1).n64_u32[0];
  CPopCycle::m_bCurrentZoneIsGangArea = (int)(CPopCycle::m_pCurrZoneInfo->aGangStrengths[3]
                                            + CPopCycle::m_pCurrZoneInfo->aGangStrengths[0]
                                            + CPopCycle::m_pCurrZoneInfo->aGangStrengths[1]
                                            + CPopCycle::m_pCurrZoneInfo->aGangStrengths[2]
                                            + v6
                                            + v7
                                            + v8
                                            + v9
                                            + v10
                                            + v11) > 20;
}
// 4CAA12: variable 'v0' is possibly undefined
// 4CAA12: variable 'v1' is possibly undefined

//----- (004CAAA4) --------------------------------------------------------
void CPopCycle::UpdatePercentages()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d1
  float32x2_t v2; // d2
  float32x2_t v3; // d3
  float32x2_t v4; // d4
  float32x2_t v5; // d8
  float v6; // s0
  float32x2_t v7; // d1
  float32x2_t v8; // d2
  unsigned int v9; // r0
  float v10; // s6
  float v11; // s20
  unsigned int v12; // r5
  unsigned int v13; // r3
  unsigned int v14; // s8
  float v15; // s19
  float v16; // s24
  float v17; // s28
  float v18; // s21
  CPlayerPed *PlayerPed; // r0
  bool v20; // zf
  int m_nModelIndex; // r0
  bool v22; // zf
  float v23; // s22
  float v24; // s24
  float v25; // s26
  float v26; // s28
  float v27; // s20
  unsigned int v28; // r6
  _BOOL4 active; // r8
  float v30; // s19
  int v31; // r5
  float v32; // s20
  _BOOL4 v33; // r0
  float v34; // s0
  int v35; // r1
  unsigned int v36; // r0

  v5.n64_u32[0] = 0.5;
  v3.n64_u32[0] = 1036831949;
  v0.n64_f32[0] = (float)CPopCycle::m_pCurrZoneInfo->DealerStrength / 100.0;
  LODWORD(v6) = vmin_f32(v0, v3).n64_u32[0];
  CPopCycle::m_fPercDealers = v6;
  v1.n64_f32[0] = (float)(CPopCycle::m_pCurrZoneInfo->aGangStrengths[0]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[1]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[2]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[3]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[4]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[5]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[6]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[7]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[8]
                        + CPopCycle::m_pCurrZoneInfo->aGangStrengths[9])
                / 100.0;
  v7.n64_u64[0] = vmin_f32(v1, v5).n64_u64[0];
  CPopCycle::m_fPercGangs = v7.n64_f32[0];
  if ( v7.n64_f32[0] >= 0.15 )
  {
    v4.n64_u32[0] = 1022739087;
    v2.n64_f32[0] = 0.3 - v7.n64_f32[0];
    v8.n64_u64[0] = vmax_f32(v2, v4).n64_u64[0];
  }
  else
  {
    v2.n64_u32[0] = 1017370378;
    v8.n64_u64[0] = vmax_f32(v7, v2).n64_u64[0];
  }
  CPopCycle::m_fPercCops = v8.n64_f32[0];
  v9 = *(_WORD *)((char *)CPopCycle::m_pCurrZoneInfo + 15) & 0x1F;
  if ( v9 > 0x11 )
    goto LABEL_12;
  if ( ((1 << v9) & (unsigned int)&elf_hash_chain[4010]) != 0 )
  {
LABEL_10:
    v8.n64_u32[0] = vmax_f32(v8, v3).n64_u32[0];
    goto LABEL_11;
  }
  if ( ((1 << v9) & (unsigned int)&elf_hash_chain[16358]) == 0 )
  {
    if ( v9 != 5 )
      goto LABEL_12;
    v3.n64_u32[0] = 1028443341;
    goto LABEL_10;
  }
  v8.n64_u32[0] = 0;
LABEL_11:
  CPopCycle::m_fPercCops = v8.n64_f32[0];
LABEL_12:
  v10 = (float)(v6 + v7.n64_f32[0]) + v8.n64_f32[0];
  if ( v10 <= 1.0 )
  {
    v11 = (float)((float)(1.0 - v6) - v7.n64_f32[0]) - v8.n64_f32[0];
  }
  else
  {
    v7.n64_f32[0] = v7.n64_f32[0] / v10;
    v6 = v6 / v10;
    v8.n64_f32[0] = v8.n64_f32[0] / v10;
    v11 = 0.0;
    CPopCycle::m_fPercGangs = v7.n64_f32[0];
    CPopCycle::m_fPercDealers = v6;
    CPopCycle::m_fPercCops = v8.n64_f32[0];
  }
  v12 = CPopCycle::m_nPercGang[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
  v13 = CPopCycle::m_nPercCops[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
  v14 = CPopCycle::m_nPercOther[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
  CPopCycle::m_fPercOther = v11;
  v15 = (float)v14;
  v16 = v8.n64_f32[0] * (float)v13;
  v17 = v6
      * (float)CPopCycle::m_nPercDealers[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
  v18 = (float)(sqrtf(CWeather::Rain) * -0.8) + 1.0;
  if ( CTheScripts::IsPlayerOnAMission() )
  {
    PlayerPed = FindPlayerPed(-1);
    if ( PlayerPed )
    {
      v20 = *((unsigned __int8 *)&PlayerPed->m_nPedFlags + 1) << 31 == 0;
      if ( *((unsigned __int8 *)&PlayerPed->m_nPedFlags + 1) << 31 )
      {
        PlayerPed = (CPlayerPed *)PlayerPed->m_pMyVehicle;
        v20 = PlayerPed == 0;
      }
      if ( !v20 )
      {
        m_nModelIndex = PlayerPed->m_nModelIndex;
        v22 = m_nModelIndex == 438;
        if ( m_nModelIndex != 438 )
          v22 = m_nModelIndex == 420;
        if ( v22 )
          v18 = 1.0;
      }
    }
  }
  v23 = (float)(v11 * v15) * 0.01;
  v24 = v16 * 0.01;
  v25 = (float)(v7.n64_f32[0] * (float)v12) * 0.01;
  v26 = v17 * 0.01;
  if ( CDarkel::FrenzyOnGoing() )
    v18 = 1.0;
  v27 = v11 * (float)(int)(float)(v18 * v15);
  v28 = CPopCycle::m_nMaxNumPeds[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
  active = CGameLogic::LaRiotsActiveHere();
  v30 = CCustomBuildingDNPipeline::m_fDNBalanceParam;
  v31 = v28;
  v32 = v27 * 0.01;
  if ( v28 <= 0x14 )
    v31 = 20;
  v33 = CGameLogic::LaRiotsActiveHere();
  v34 = gfLaRiotsLightMult;
  if ( !active )
    v31 = v28;
  if ( v33 && (float)(1.0 - v30) > 0.5 )
  {
    gfLaRiotsLightMult = gfLaRiotsLightMult + -0.01;
    if ( (float)(v34 + -0.01) >= 0.6 )
      goto LABEL_38;
    v35 = 1058642330;
  }
  else
  {
    gfLaRiotsLightMult = gfLaRiotsLightMult + 0.01;
    if ( (float)(v34 + 0.01) <= 1.0 )
      goto LABEL_38;
    v35 = 1065353216;
  }
  LODWORD(gfLaRiotsLightMult) = v35;
LABEL_38:
  v36 = CPopCycle::m_nMaxNumCars[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
  CPopCycle::m_NumDealers_Peds = v26 * (float)v31;
  CPopCycle::m_NumGangs_Peds = v25 * (float)v31;
  CPopCycle::m_NumOther_Peds = v32 * (float)v31;
  CPopCycle::m_NumCops_Peds = v24 * (float)v31;
  CPopCycle::m_NumDealers_Cars = v26 * (float)v36;
  CPopCycle::m_NumGangs_Cars = v25 * (float)v36;
  CPopCycle::m_NumCops_Cars = v24 * (float)v36;
  CPopCycle::m_NumOther_Cars = v23 * (float)v36;
  if ( CGameLogic::LaRiotsActiveHere() )
  {
    CPopCycle::m_NumDealers_Cars = CPopCycle::m_NumDealers_Cars * 0.75;
    CPopCycle::m_NumGangs_Cars = CPopCycle::m_NumGangs_Cars * 0.75;
    CPopCycle::m_NumCops_Cars = CPopCycle::m_NumCops_Cars * 0.75;
    CPopCycle::m_NumOther_Cars = CPopCycle::m_NumOther_Cars * 0.75;
  }
}
// 4CAADC: variable 'v0' is possibly undefined
// 4CAADC: variable 'v3' is possibly undefined
// 4CAB22: variable 'v1' is possibly undefined
// 4CAB22: variable 'v5' is possibly undefined
// 4CAB3C: variable 'v2' is possibly undefined
// 4CAB4E: variable 'v4' is possibly undefined
// 10168: using guessed type int elf_hash_chain[22025];

//----- (004CAFD8) --------------------------------------------------------
void CPopCycle::UpdateDealerStrengths()
{
  int v0; // r5
  UInt8 *p_DealerStrength; // r4
  unsigned int v2; // r0
  bool v3; // cc
  float v4; // s0
  unsigned int v5; // r0
  int v6; // r1

  if ( CGangWars::bGangWarsActive
    && CTimer::m_snTimeInMilliseconds / 0xEA60 != CTimer::m_snPreviousTimeInMilliseconds / 0xEA60
    && CTheZones::TotalNumberOfZoneInfos )
  {
    v0 = 0;
    p_DealerStrength = &CTheZones::ZoneInfoArray[0].DealerStrength;
    do
    {
      v2 = *(p_DealerStrength - 9);
      v3 = v2 > 0xA;
      if ( v2 <= 0xA )
        v3 = *(p_DealerStrength - 10) > 0xAu;
      if ( v3 || *(p_DealerStrength - 8) >= 0xBu )
      {
        v4 = (float)rand();
        v5 = *p_DealerStrength;
        v6 = v5;
        if ( v5 >= 0xE )
          v6 = 14;
        if ( v5 <= 0xE && (float)((float)(v4 * 4.6566e-10) + 0.0) < aDealerIncreaseOdds[v6] )
          *p_DealerStrength = v5 + 1;
      }
      ++v0;
      p_DealerStrength += 17;
    }
    while ( v0 < CTheZones::TotalNumberOfZoneInfos );
  }
}

//----- (004CB100) --------------------------------------------------------
void CPopCycle::UpdateAreaDodgyness()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d2

  CPopCycle::m_fCurrentZoneDodgyness = (float)((float)CPopCycle::m_pCurrZoneInfo->DealerStrength * 0.07) + 0.0;
  CPopCycle::m_fCurrentZoneDodgyness = CPopCycle::m_fCurrentZoneDodgyness
                                     + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[0] * 0.01);
  CPopCycle::m_fCurrentZoneDodgyness = CPopCycle::m_fCurrentZoneDodgyness
                                     + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[1] * 0.01);
  CPopCycle::m_fCurrentZoneDodgyness = CPopCycle::m_fCurrentZoneDodgyness
                                     + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[2] * 0.01);
  v1.n64_u32[0] = 1.0;
  v0.n64_f32[0] = (float)((float)((float)((float)((float)((float)(CPopCycle::m_fCurrentZoneDodgyness
                                                                + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[3]
                                                                        * 0.01))
                                                        + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[4]
                                                                * 0.01))
                                                + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[5] * 0.01))
                                        + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[6] * 0.01))
                                + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[7] * 0.01))
                        + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[8] * 0.01))
                + (float)((float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[9] * 0.01);
  LODWORD(CPopCycle::m_fCurrentZoneDodgyness) = vmin_f32(v0, v1).n64_u32[0];
}
// 4CB1FC: variable 'v0' is possibly undefined
// 4CB1FC: variable 'v1' is possibly undefined

//----- (004CB21C) --------------------------------------------------------
void CPopCycle::UpdateIsGangArea()
{
  CPopCycle::m_bCurrentZoneIsGangArea = CPopCycle::m_pCurrZoneInfo->aGangStrengths[4]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[2]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[0]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[1]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[3]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[5]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[6]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[7]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[8]
                                      + CPopCycle::m_pCurrZoneInfo->aGangStrengths[9] > 20;
}

//----- (004CB27C) --------------------------------------------------------
int CPopCycle::PickGangToCreateMembersOf()
{
  float32x2_t v0; // d8
  float32x2_t v1; // d9
  int result; // r0
  float v3; // s6
  float v4; // s8
  float v5; // s10
  float v6; // s12
  float v7; // s14
  float32x2_t v8; // d0
  float32x2_t v9; // d1
  float32x2_t v10; // d2
  float v11; // s30
  float32x2_t v12; // d3
  float32x2_t v13; // d6
  float32x2_t v14; // d9
  float32x2_t v15; // d12
  float32x2_t v16; // d6
  float32x2_t v17; // d4
  float32x2_t v18; // d7
  float32x2_t v19; // d5
  float32x2_t v20; // d10
  float32x2_t v21; // d11
  float32x2_t v22; // d13
  float32x2_t v23; // d14
  float32x2_t v24; // d15
  float v25; // s6

  if ( CCheat::m_aCheatsActive[51] )
    return (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 8.0) + 7;
  v8.n64_f32[0] = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[1];
  v3 = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[0];
  v9.n64_f32[0] = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[2];
  v10.n64_f32[0] = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[3];
  v4 = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[4];
  v5 = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[5];
  v6 = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[6];
  v7 = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[7];
  v8.n64_f32[1] = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[8];
  v9.n64_f32[1] = (float)CPopCycle::m_pCurrZoneInfo->aGangStrengths[9];
  v10.n64_f32[1] = (float)((float)((float)((float)((float)((float)((float)((float)(v3 + v8.n64_f32[0]) + v9.n64_f32[0])
                                                                 + v10.n64_f32[0])
                                                         + v4)
                                                 + v5)
                                         + v6)
                                 + v7)
                         + v8.n64_f32[1])
                 + v9.n64_f32[1];
  if ( v10.n64_f32[1] <= 0.0 )
    return 0;
  v11 = v6 / v10.n64_f32[1];
  v12.n64_f32[1] = (float)CPopulation::ms_nNumGang[4];
  result = 7;
  v13.n64_f32[1] = (float)CPopulation::ms_nNumGang[0] / CPopCycle::m_NumGangs_Peds;
  v13.n64_f32[0] = (float)(v3 / v10.n64_f32[1]) - v13.n64_f32[1];
  v19.n64_f32[1] = (float)CPopulation::ms_nNumGang[6] / CPopCycle::m_NumGangs_Peds;
  v15.n64_f32[1] = (float)CPopulation::ms_nNumGang[7] / CPopCycle::m_NumGangs_Peds;
  v1.n64_u32[0] = 0;
  v12.n64_f32[0] = (float)(v8.n64_f32[0] / v10.n64_f32[1])
                 - (float)((float)CPopulation::ms_nNumGang[1] / CPopCycle::m_NumGangs_Peds);
  v14.n64_u64[0] = vmax_f32(v13, v1).n64_u64[0];
  v17.n64_f32[1] = (float)CPopulation::ms_nNumGang[5] / CPopCycle::m_NumGangs_Peds;
  v8.n64_f32[0] = (float)(v9.n64_f32[0] / v10.n64_f32[1])
                - (float)((float)CPopulation::ms_nNumGang[2] / CPopCycle::m_NumGangs_Peds);
  v0.n64_f32[0] = v11 - v19.n64_f32[1];
  v15.n64_f32[0] = (float)(v7 / v10.n64_f32[1]) - v15.n64_f32[1];
  v16.n64_u64[0] = vmax_f32(v12, v14).n64_u64[0];
  v9.n64_f32[0] = (float)(v10.n64_f32[0] / v10.n64_f32[1])
                - (float)((float)CPopulation::ms_nNumGang[3] / CPopCycle::m_NumGangs_Peds);
  v10.n64_f32[0] = (float)(v4 / v10.n64_f32[1])
                 - (float)((float)CPopulation::ms_nNumGang[4] / CPopCycle::m_NumGangs_Peds);
  v17.n64_f32[0] = (float)(v5 / v10.n64_f32[1]) - v17.n64_f32[1];
  v18.n64_u64[0] = vmax_f32(v8, v16).n64_u64[0];
  v19.n64_f32[0] = (float)(v8.n64_f32[1] / v10.n64_f32[1])
                 - (float)((float)CPopulation::ms_nNumGang[8] / CPopCycle::m_NumGangs_Peds);
  if ( v12.n64_f32[0] > v14.n64_f32[0] )
    result = 8;
  v20.n64_u64[0] = vmax_f32(v9, v18).n64_u64[0];
  v21.n64_u64[0] = vmax_f32(v10, v20).n64_u64[0];
  v22.n64_u64[0] = vmax_f32(v17, v21).n64_u64[0];
  v23.n64_u64[0] = vmax_f32(v0, v22).n64_u64[0];
  v24.n64_u64[0] = vmax_f32(v15, v23).n64_u64[0];
  if ( v8.n64_f32[0] > v16.n64_f32[0] )
    result = 9;
  LODWORD(v25) = vmax_f32(v19, v24).n64_u32[0];
  if ( v9.n64_f32[0] > v18.n64_f32[0] )
    result = 10;
  if ( v10.n64_f32[0] > v20.n64_f32[0] )
    result = 11;
  if ( v17.n64_f32[0] > v21.n64_f32[0] )
    result = 12;
  if ( v0.n64_f32[0] > v22.n64_f32[0] )
    result = 13;
  if ( v15.n64_f32[0] > v23.n64_f32[0] )
    result = 14;
  if ( v19.n64_f32[0] > v24.n64_f32[0] )
    result = 15;
  if ( (float)((float)(v9.n64_f32[1] / v10.n64_f32[1])
             - (float)((float)CPopulation::ms_nNumGang[9] / CPopCycle::m_NumGangs_Peds)) > v25 )
    return 16;
  return result;
}
// 4CB410: variable 'v1' is possibly undefined
// 4CB484: variable 'v0' is possibly undefined

//----- (004CB50C) --------------------------------------------------------
bool __fastcall CPopCycle::FindNewPedType(ePedType *pNewPedType, Int32 *pNewPedMI, bool bNoGangs, bool bNoCops)
{
  float32x2_t v4; // d8
  float32x2_t v5; // d10
  float32x2_t v6; // d11
  float32x2_t v7; // d12
  _BOOL4 v9; // r6
  _BOOL4 v10; // r8
  bool v11; // r6
  float v12; // s24
  float v13; // s26
  _BOOL4 v14; // r0
  float32x2_t v15; // d9
  float v16; // s24
  ePedType *v17; // r12
  float v18; // s2
  float v19; // s0
  UInt32 v20; // r0
  int v21; // r1
  int v22; // r2
  Int32 v23; // r3
  int MembersOf; // r0
  int32 v25; // r0
  int32 v27; // r0
  bool *v28; // [sp+18h] [bp-68h]

  v9 = bNoCops;
  v10 = bNoGangs;
  if ( !CPopCycle::m_pCurrZoneInfo )
    return 0;
  if ( !CPopulation::bInPoliceStation
    || (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) > 69 )
  {
    v12 = (float)CPopulation::ms_nNumDealers;
    v13 = CPopCycle::m_NumDealers_Peds;
    if ( CPopulation::m_bDontCreateRandomGangMembers )
    {
      v4.n64_u32[0] = -10.0;
    }
    else
    {
      v4.n64_f32[0] = CPopCycle::m_NumGangs_Peds
                    - (float)((float)((float)((float)((float)((float)((float)((float)((float)((float)CPopulation::ms_nNumGang[0]
                                                                                            + (float)CPopulation::ms_nNumGang[1])
                                                                                    + (float)CPopulation::ms_nNumGang[2])
                                                                            + (float)CPopulation::ms_nNumGang[3])
                                                                    + (float)CPopulation::ms_nNumGang[4])
                                                            + (float)CPopulation::ms_nNumGang[5])
                                                    + (float)CPopulation::ms_nNumGang[6])
                                            + (float)CPopulation::ms_nNumGang[7])
                                    + (float)CPopulation::ms_nNumGang[8])
                            + (float)CPopulation::ms_nNumGang[9]);
      if ( CPopulation::m_bOnlyCreateRandomGangMembers )
        v4.n64_u32[0] = 1112014848;
      if ( v10 )
        v4.n64_u32[0] = -10.0;
    }
    v6.n64_u32[0] = -10.0;
    v5.n64_f32[0] = CPopCycle::m_NumCops_Peds - (float)CPopulation::ms_nNumCop;
    if ( v9 )
      v5.n64_u32[0] = -10.0;
    v14 = CGangWars::GangWarFightingGoingOn();
    if ( CPopulation::m_bDontCreateRandomCops )
      v5.n64_u32[0] = -10.0;
    if ( v14 )
      v5.n64_u32[0] = -10.0;
    if ( CPopCycle::m_pCurrZoneInfo )
    {
      v15.n64_u64[0] = v6.n64_u64[0];
      if ( (*((_BYTE *)CPopCycle::m_pCurrZoneInfo + 15) & 0x80) == 0 )
        v15.n64_u32[0] = v5.n64_u32[0];
    }
    else
    {
      v15.n64_u64[0] = v5.n64_u64[0];
    }
    v5.n64_f32[0] = CPopCycle::m_NumOther_Peds - (float)(CPopulation::ms_nNumCivMale + CPopulation::ms_nNumCivFemale);
    if ( v5.n64_f32[0] < 2.0 )
      v5.n64_f32[0] = v5.n64_f32[0] * (float)((float)((float)rand() * 4.6566e-10) + 0.0);
    v16 = v13 - v12;
    if ( v15.n64_f32[0] < 2.0 )
      v15.n64_f32[0] = v15.n64_f32[0] * (float)((float)((float)rand() * 4.6566e-10) + 0.0);
    if ( v16 < 2.0 )
      v16 = v16 * (float)((float)((float)rand() * 4.6566e-10) + 0.0);
    if ( v4.n64_f32[0] < 2.0 )
      v4.n64_f32[0] = v4.n64_f32[0] * (float)((float)((float)rand() * 4.6566e-10) + 0.0);
    v17 = pNewPedType;
    if ( CGame::currArea == AREA_MAIN_MAP )
      v6.n64_f32[0] = v16;
    v7.n64_u32[0] = 0;
    v28 = &CPopulation::m_bOnlyCreateRandomGangMembers;
    while ( 1 )
    {
      v18 = vmax_f32(vmax_f32(vmax_f32(v6, v4), v15), v5).n64_f32[0];
      if ( v18 <= 0.0 )
        return 0;
      LODWORD(v19) = vmax_f32(vmax_f32(vmax_f32(v4, v7), v15), v5).n64_u32[0];
      while ( v18 == v6.n64_f32[0] )
      {
        *v17 = PEDTYPE_DEALER;
        *pNewPedMI = -1;
        v20 = CPopulation::m_TranslationArray[28][0];
        if ( CPopulation::m_nNumPedsInGroup[CPopulation::m_TranslationArray[28][0]] < 1 )
        {
          v18 = v19;
          v6.n64_u64[0] = v7.n64_u64[0];
          if ( v19 <= 0.0 )
            return 0;
        }
        else
        {
          v21 = 0;
          v22 = -1;
          do
          {
            v23 = CPopulation::m_PedGroups[v20][v21++];
            if ( CStreaming::ms_aInfoForModel[v23].m_status == 1 )
            {
              *pNewPedMI = v23;
              v20 = CPopulation::m_TranslationArray[28][0];
              v22 = v23;
            }
          }
          while ( v21 < CPopulation::m_nNumPedsInGroup[v20] );
          v11 = 0;
          if ( v22 > -1 )
            return 1;
          v18 = v19;
          v6.n64_u64[0] = v7.n64_u64[0];
          if ( v19 <= 0.0 )
            return v11;
        }
      }
      if ( v18 != v4.n64_f32[0] )
      {
        if ( v18 == v15.n64_f32[0] )
        {
          *v17 = PEDTYPE_COP;
          goto LABEL_5;
        }
        if ( v18 != v5.n64_f32[0] )
          return 1;
        v11 = 0;
        v27 = CPopulation::ChooseCivilianOccupation(0, 0, -1, -1, -1, 0, 1, 0, 0);
        *pNewPedMI = v27;
        if ( v27 >= 0 && v27 != 7 )
        {
          *pNewPedType = *(ePedType *)CModelInfo::ms_modelInfoPtrs[v27][1].m_modelName;
          return 1;
        }
        return v11;
      }
      MembersOf = CPopCycle::PickGangToCreateMembersOf();
      v17 = pNewPedType;
      *pNewPedType = MembersOf;
      if ( MembersOf )
      {
        v25 = CPopulation::ChooseGangOccupation(MembersOf - 7);
        v17 = pNewPedType;
        *pNewPedMI = v25;
        if ( v25 >= 0 )
          return 1;
      }
      else
      {
        *pNewPedMI = -1;
      }
      v4.n64_u64[0] = v7.n64_u64[0];
      v11 = (unsigned __int8)v28 & !CPopulation::m_bOnlyCreateRandomGangMembers;
      LOBYTE(v28) = v11;
      if ( CPopulation::m_bOnlyCreateRandomGangMembers )
        return v11;
    }
  }
  *pNewPedType = PEDTYPE_COP;
LABEL_5:
  *pNewPedMI = CPopulation::ChoosePolicePedOccupation();
  return 1;
}
// 4CB6A2: variable 'v6' is possibly undefined
// 4CB6B0: variable 'v5' is possibly undefined
// 4CB7E4: variable 'v4' is possibly undefined
// 4CB7FA: variable 'v7' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 675EF0: using guessed type int *CPopulation::ms_nNumCivFemale;
// 6772D4: using guessed type int CPopulation::ms_nNumDealers[2];
// 677D74: using guessed type int *CPopulation::ms_nNumCivMale;
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];
// 6783EC: using guessed type int *CPopulation::ms_nNumCop[2];

//----- (004CB9CC) --------------------------------------------------------
Int32 CPopCycle::GetCurrentPercDealers()
{
  return CPopCycle::m_nPercDealers[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
}

//----- (004CBA10) --------------------------------------------------------
Int32 CPopCycle::GetCurrentPercGangs()
{
  return CPopCycle::m_nPercGang[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
}

//----- (004CBA54) --------------------------------------------------------
Int32 CPopCycle::GetCurrentPercCops()
{
  return CPopCycle::m_nPercCops[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
}

//----- (004CBA98) --------------------------------------------------------
Int32 CPopCycle::GetCurrentPercOther_Cars()
{
  return CPopCycle::m_nPercOther[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
}

//----- (004CBADC) --------------------------------------------------------
Int32 CPopCycle::GetCurrentPercOther_Peds()
{
  unsigned int v0; // r4
  float v1; // s18
  CPlayerPed *PlayerPed; // r0
  bool v3; // zf
  int m_nModelIndex; // r0
  bool v5; // zf

  v0 = CPopCycle::m_nPercOther[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
  v1 = (float)(sqrtf(CWeather::Rain) * -0.8) + 1.0;
  if ( CTheScripts::IsPlayerOnAMission() )
  {
    PlayerPed = FindPlayerPed(-1);
    if ( PlayerPed )
    {
      v3 = *((unsigned __int8 *)&PlayerPed->m_nPedFlags + 1) << 31 == 0;
      if ( *((unsigned __int8 *)&PlayerPed->m_nPedFlags + 1) << 31 )
      {
        PlayerPed = (CPlayerPed *)PlayerPed->m_pMyVehicle;
        v3 = PlayerPed == 0;
      }
      if ( !v3 )
      {
        m_nModelIndex = PlayerPed->m_nModelIndex;
        v5 = m_nModelIndex == 438;
        if ( m_nModelIndex != 438 )
          v5 = m_nModelIndex == 420;
        if ( v5 )
          v1 = 1.0;
      }
    }
  }
  if ( CDarkel::FrenzyOnGoing() )
    v1 = 1.0;
  return (int)(float)(v1 * (float)v0);
}
// 678AD8: using guessed type int *CPopCycle::m_nCurrentZoneType[5];

//----- (004CBBA4) --------------------------------------------------------
Int32 CPopCycle::GetCurrentMaxNumPeds()
{
  return CPopCycle::m_nMaxNumPeds[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
}

//----- (004CBBE8) --------------------------------------------------------
Int32 CPopCycle::GetCurrentMaxNumCars()
{
  return CPopCycle::m_nMaxNumCars[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType];
}

//----- (004CBC2C) --------------------------------------------------------
Int32 CPopCycle::PickPedMIToStreamInForCurrentZone()
{
  int v0; // r8
  unsigned __int16 v1; // r0
  int v2; // r1
  int v3; // r0
  int v4; // r11
  int v5; // r3
  int v6; // r3
  int v7; // r10
  int v8; // r1
  Int32 result; // r0
  char v10; // r6
  bool v11; // r3
  int v12; // [sp+28h] [bp-58h]
  CZoneInfo *v13; // [sp+2Ch] [bp-54h]
  int v14; // [sp+30h] [bp-50h]
  Int32 v15; // [sp+40h] [bp-40h]
  Int32 v16; // [sp+44h] [bp-3Ch]
  Int32 v17; // [sp+48h] [bp-38h]
  UInt32 v18; // [sp+4Ch] [bp-34h]

  v0 = 0;
  do
  {
    v1 = rand();
    v13 = CPopCycle::m_pCurrZoneInfo;
    v2 = CPopCycle::m_nPercTypeGroup[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][*(_WORD *)((char *)CPopCycle::m_pCurrZoneInfo + 15) & 0x1F][0];
    v12 = v0;
    v3 = (int)(float)((float)((float)v1 * 0.000015259) * 100.0);
    if ( v3 >= v2 )
    {
      v4 = 0;
      do
      {
        v5 = CPopCycle::m_nPercTypeGroup[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][*(_WORD *)((char *)CPopCycle::m_pCurrZoneInfo + 15) & 0x1F][v4 + 1];
        v3 -= v2;
        ++v4;
        v2 = v5;
      }
      while ( v3 >= v5 );
    }
    else
    {
      v4 = 0;
    }
    v18 = CPopulation::m_TranslationArray[v4][CPopulation::CurrentWorldZone];
    v6 = CPopulation::m_nNumPedsInGroup[v18];
    if ( v6 >= 1 )
    {
      v7 = 0;
      v14 = CPopulation::m_nNumPedsInGroup[v18];
      v17 = CStreaming::ms_pedsLoaded[0];
      v16 = CStreaming::ms_pedsLoaded[1];
      v15 = CStreaming::ms_pedsLoaded[2];
      do
      {
        v8 = (CStreaming::ms_NextPedToLoadFromGroup[v4] + 1) % v6;
        result = CPopulation::m_PedGroups[v18][v8];
        CStreaming::ms_NextPedToLoadFromGroup[v4] = v8;
        v10 = 0;
        v11 = CStreaming::ms_pedsLoaded[4] != result
           && v16 != result
           && v17 != result
           && v15 != result
           && CStreaming::ms_pedsLoaded[3] != result;
        if ( CStreaming::ms_pedsLoaded[5] != result )
          v10 = 1;
        if ( CModelInfo::ms_modelInfoPtrs[result][1].m_modelName[18] )
        {
          if ( (v11 & (unsigned __int8)v10 & (CStreaming::ms_pedsLoaded[6] != result) & (CStreaming::ms_pedsLoaded[7] != result) & (((unsigned __int8)(1 << (CModelInfo::ms_modelInfoPtrs[result][1].m_modelName[18] - 1)) & *((_BYTE *)v13 + 16) & 0xF) != 0)) != 0 )
            return result;
        }
        else if ( (v11 & (unsigned __int8)v10 & (CStreaming::ms_pedsLoaded[6] != result) & (CStreaming::ms_pedsLoaded[7] != result)) != 0 )
        {
          return result;
        }
        v6 = v14;
        ++v7;
      }
      while ( v7 < v14 );
    }
    ++v0;
  }
  while ( v12 < 9 );
  return -1;
}

//----- (004CBE90) --------------------------------------------------------
bool __fastcall CPopCycle::IsPedAppropriateForCurrentZone(Int32 PedMI)
{
  unsigned __int8 v1; // r2
  unsigned int v2; // r1
  int v3; // r11
  int v4; // r4
  int v5; // r6
  UInt32 v6; // r1
  int v7; // r4
  UInt16 *v8; // r5
  int v9; // r1

  v1 = CModelInfo::ms_modelInfoPtrs[PedMI][1].m_modelName[18];
  if ( v1 )
  {
    v2 = *(unsigned __int16 *)((char *)CPopCycle::m_pCurrZoneInfo + 15);
    if ( !(((1 << (v1 - 1)) & (v2 >> 8)) << 28) )
      return 0;
  }
  else
  {
    LOWORD(v2) = *(_WORD *)((char *)CPopCycle::m_pCurrZoneInfo + 15);
  }
  v3 = v2 & 0x1F;
  v4 = 0;
  while ( 1 )
  {
    v5 = v4;
    if ( CPopCycle::m_nPercTypeGroup[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][v3][v4] )
    {
      v6 = CPopulation::m_TranslationArray[v4][CPopulation::CurrentWorldZone];
      v7 = CPopulation::m_nNumPedsInGroup[v6];
      if ( v7 >= 1 )
        break;
    }
LABEL_11:
    v4 = v5 + 1;
    if ( v5 >= 17 )
      return 0;
  }
  v8 = CPopulation::m_PedGroups[v6];
  v9 = 0;
  while ( v8[v9] != PedMI )
  {
    if ( ++v9 >= v7 )
      goto LABEL_11;
  }
  return 1;
}

//----- (004CBF98) --------------------------------------------------------
bool __fastcall CPopCycle::IsPedInGroup(Int32 PedMI, Int32 PopGroup)
{
  Int32 v2; // r12
  UInt32 v3; // r1
  int v4; // r4
  UInt16 *v5; // r3
  int v6; // r1
  UInt32 v7; // r1
  int v8; // r2
  UInt16 *v9; // r3
  int v10; // r1
  UInt32 v11; // r2
  int v12; // r1
  UInt16 *v13; // r2
  int v14; // r3

  v2 = PopGroup;
  v3 = CPopulation::m_TranslationArray[PopGroup][0];
  v4 = CPopulation::m_nNumPedsInGroup[v3];
  if ( v4 < 1 )
  {
LABEL_5:
    v7 = CPopulation::m_TranslationArray[v2][1];
    v8 = CPopulation::m_nNumPedsInGroup[v7];
    if ( v8 < 1 )
    {
LABEL_9:
      v11 = CPopulation::m_TranslationArray[v2][2];
      v12 = CPopulation::m_nNumPedsInGroup[v11];
      if ( v12 < 1 )
        return 0;
      v13 = CPopulation::m_PedGroups[v11];
      v14 = 0;
      while ( v13[v14] != PedMI )
      {
        if ( ++v14 >= v12 )
          return 0;
      }
    }
    else
    {
      v9 = CPopulation::m_PedGroups[v7];
      v10 = 0;
      while ( v9[v10] != PedMI )
      {
        if ( ++v10 >= v8 )
          goto LABEL_9;
      }
    }
  }
  else
  {
    v5 = CPopulation::m_PedGroups[v3];
    v6 = 0;
    while ( v5[v6] != PedMI )
    {
      if ( ++v6 >= v4 )
        goto LABEL_5;
    }
  }
  return 1;
}

//----- (004CC070) --------------------------------------------------------
Int32 __fastcall CPopCycle::GetCurrentPercTypeGroup(Int32 TypeGroup)
{
  return CPopCycle::m_nPercTypeGroup[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][CPopCycle::m_nCurrentZoneType][TypeGroup];
}

//----- (004CC0C4) --------------------------------------------------------
Int32 CPopCycle::PickARandomGroupOfOtherPeds()
{
  unsigned __int16 v0; // r0
  int v1; // r2
  int v2; // r6
  int v3; // r1
  uint8 *v4; // r3
  Int32 result; // r0
  int v6; // r2

  v0 = rand();
  v1 = *(_WORD *)((char *)CPopCycle::m_pCurrZoneInfo + 15) & 0x1F;
  v2 = CPopCycle::m_nPercTypeGroup[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][v1][0];
  v3 = (int)(float)((float)((float)v0 * 0.000015259) * 100.0);
  if ( v3 <= v2 )
    return 0;
  v4 = &CPopCycle::m_nPercTypeGroup[CPopCycle::m_nCurrentTimeIndex][CPopCycle::m_nCurrentTimeOfWeek][v1][1];
  result = 0;
  do
  {
    v6 = v4[result];
    v3 -= v2;
    ++result;
    v2 = v6;
  }
  while ( v3 > v6 );
  return result;
}

//----- (004CC180) --------------------------------------------------------
void CPopCycle::PlayerKilledADealer()
{
  if ( CPopCycle::m_pCurrZoneInfo )
  {
    if ( CPopCycle::m_pCurrZoneInfo->DealerStrength )
      --CPopCycle::m_pCurrZoneInfo->DealerStrength;
  }
}

//----- (004CC1A0) --------------------------------------------------------
bool __fastcall CPopCycle::PedIsAcceptableInCurrentZone(Int32 MI)
{
  bool result; // r0
  int v2; // r0

  result = 0;
  if ( CPopCycle::m_pCurrZoneInfo )
  {
    if ( (CCheat::m_aCheatsActive[48] | CCheat::m_aCheatsActive[47] | CCheat::m_aCheatsActive[49] | CCheat::m_aCheatsActive[50] | CCheat::m_aCheatsActive[52] | CCheat::m_aCheatsActive[53] | CCheat::m_aCheatsActive[78] | CCheat::m_aCheatsActive[83]) << 24 )
      return 1;
    v2 = CModelInfo::ms_modelInfoPtrs[MI][1].m_modelName[18];
    if ( !v2 || ((1 << (v2 - 1)) & *((unsigned __int8 *)CPopCycle::m_pCurrZoneInfo + 16)) << 28 )
      return 1;
  }
  return result;
}

//----- (004CC234) --------------------------------------------------------
void CPopulation::Initialise()
{
  CPopulation::ms_nNumCivFemale = 0;
  CPopulation::ms_nNumCivMale = 0;
  CPopulation::ms_nNumCop = 0;
  CPopulation::ms_nNumEmergency = 0;
  CPopulation::ms_nTotalCarPassengerPeds = 0;
  CPopulation::ms_nTotalCivPeds = 0;
  CPopulation::ms_nTotalGangPeds = 0;
  CPopulation::ms_nTotalPeds = 0;
  CPopulation::ms_nTotalMissionPeds = 0;
  CPopulation::m_CountDownToPedsAtStart = 5;
  CPopulation::m_bIsHospital = 0;
  CPopulation::bZoneChangeHasHappened = 0;
  CPopulation::PedDensityMultiplier = 1.0;
  CPopulation::ms_nNumGang[8] = 0;
  CPopulation::ms_nNumGang[9] = 0;
  *(_QWORD *)CPopulation::ms_nNumGang = 0LL;
  *(_QWORD *)&CPopulation::ms_nNumGang[2] = 0LL;
  *(_QWORD *)&CPopulation::ms_nNumGang[4] = 0LL;
  *(_QWORD *)&CPopulation::ms_nNumGang[6] = 0LL;
  CPopulation::m_AllRandomPedsThisType = -1;
  CPopulation::bInPoliceStation = 0;
  CPopulation::m_bDontCreateRandomGangMembers = 0;
  CPopulation::MaxNumberOfPedsInUse = 25;
  CPopulation::m_bOnlyCreateRandomGangMembers = 0;
  CPopulation::NumberOfPedsInUseInterior = 40;
  CPopulation::m_bDontCreateRandomCops = 0;
  CPopulation::m_bMoreCarsAndFewerPeds = 0;
  CPopulation::LoadPedGroups();
  sub_19AD60();
}
// 675EF0: using guessed type int *CPopulation::ms_nNumCivFemale;
// 677D74: using guessed type int *CPopulation::ms_nNumCivMale;
// 6783EC: using guessed type int *CPopulation::ms_nNumCop[2];
// 6784A0: using guessed type char *CPopulation::m_bOnlyCreateRandomGangMembers[3];
// 6797C8: using guessed type int *CPopulation::ms_nNumEmergency;

//----- (004CC380) --------------------------------------------------------
void __fastcall CPopulation::Update(bool bAddPeds)
{
  _BOOL4 v1; // r4
  float GenerationDistMultiplier; // s20
  float v3; // r4
  float v4; // s26
  float v5; // r5
  float v6; // s28
  float v7; // r0
  const CVector *PlayerCentreOfWorld; // r0
  RwReal x; // r8
  RwReal y; // r9
  RwReal z; // r10
  float v12; // s22
  float v13; // s0
  float v14; // s22
  float v15; // r4
  float v16; // r5
  float v17; // s18
  float v18; // s22
  float v19; // s0
  int32 decisionMaker; // [sp+Ch] [bp-6Ch]
  CVector v21; // 0:r0.12

  v1 = bAddPeds;
  if ( (unsigned int)CWeather::WeatherRegion <= 4 )
    CPopulation::CurrentWorldZone = dword_4CC594[CWeather::WeatherRegion];
  CPopulation::ManagePopulation();
  CPopulation::RemovePedsIfThePoolGetsFull();
  if ( CPopulation::m_CountDownToPedsAtStart )
  {
    if ( !--CPopulation::m_CountDownToPedsAtStart )
      CPopulation::GeneratePedsAtStartOfGame();
  }
  else
  {
    CPopulation::ms_nTotalCivPeds = CPopulation::ms_nNumCivMale + CPopulation::ms_nNumCivFemale;
    CPopulation::ms_nTotalGangPeds = CPopulation::ms_nNumGang[2]
                                   + CPopulation::ms_nNumGang[0]
                                   + CPopulation::ms_nNumGang[1]
                                   + CPopulation::ms_nNumGang[3]
                                   + CPopulation::ms_nNumGang[4]
                                   + CPopulation::ms_nNumGang[5]
                                   + CPopulation::ms_nNumGang[6]
                                   + CPopulation::ms_nNumGang[7]
                                   + CPopulation::ms_nNumGang[8]
                                   + CPopulation::ms_nNumGang[9];
    CPopulation::ms_nTotalPeds = CPopulation::ms_nTotalGangPeds
                               + CPopulation::ms_nNumCivMale
                               + CPopulation::ms_nNumCivFemale
                               + CPopulation::ms_nNumCop
                               + CPopulation::ms_nNumEmergency;
    if ( !CCutsceneMgr::ms_cutsceneProcessing && v1 )
    {
      GenerationDistMultiplier = TheCamera.GenerationDistMultiplier;
      v3 = CPopulation::PedCreationDistMultiplier();
      v4 = TheCamera.GenerationDistMultiplier * 50.5;
      v5 = CPopulation::PedCreationDistMultiplier();
      v6 = CPopulation::PedCreationDistMultiplier() * 25.0;
      v7 = CPopulation::PedCreationDistMultiplier();
      if ( CPopulation::AddToPopulation((float)(GenerationDistMultiplier * 42.5) * v3, v4 * v5, v6 + -10.0, v7 * 25.0) )
      {
        PlayerCentreOfWorld = FindPlayerCentreOfWorld(CWorld::PlayerInFocus);
        x = PlayerCentreOfWorld->x;
        y = PlayerCentreOfWorld->y;
        z = PlayerCentreOfWorld->z;
        v12 = TheCamera.GenerationDistMultiplier * 42.5;
        v13 = v12 * CPopulation::PedCreationDistMultiplier();
        v14 = TheCamera.GenerationDistMultiplier;
        v15 = v13;
        v16 = CPopulation::PedCreationDistMultiplier();
        v17 = v14 * 50.5;
        v18 = CPopulation::PedCreationDistMultiplier() * 25.0;
        v21.x = CPopulation::PedCreationDistMultiplier();
        LODWORD(v21.z) = 7;
        v19 = v21.x * 25.0;
        v21.x = x;
        if ( CGame::currArea == AREA_MAIN_MAP )
          v21.z = NAN;
        decisionMaker = LODWORD(v21.z);
        v21.y = y;
        v21.z = z;
        CPopulation::GeneratePedsAtAttractors(v21, v15, v17 * v16, v18 + -10.0, v19, decisionMaker, 1);
      }
    }
  }
}
// 4CC594: using guessed type int dword_4CC594[2];
// 675EF0: using guessed type int *CPopulation::ms_nNumCivFemale;
// 677D74: using guessed type int *CPopulation::ms_nNumCivMale;
// 6783EC: using guessed type int *CPopulation::ms_nNumCop[2];
// 6797C8: using guessed type int *CPopulation::ms_nNumEmergency;

//----- (004CC5EC) --------------------------------------------------------
void CPopulation::ManagePopulation()
{
  CDummyPool *v0; // r9
  char v1; // r4
  CPedPool *v2; // r5
  CObjectPool *v3; // r6
  const CVector *PlayerCentreOfWorld; // r0
  __int64 v5; // d16
  int32 m_nSize; // r0
  int v7; // r4
  signed int v8; // r0
  int v9; // kr04_4
  int v10; // r10
  int v11; // r8
  int32 v12; // r0
  int v13; // r2
  signed int v14; // r0
  int v15; // kr08_4
  int v16; // r4
  int v17; // r8
  float x; // s16
  int v19; // r6
  float y; // s18
  float z; // s20
  uint8 *v22; // r0
  int v23; // r1
  bool v24; // zf
  int v25; // r1
  float *v26; // r2
  int v27; // r1
  float v28; // s2
  float v29; // s0
  int *v30; // r1
  int32 v31; // r0
  int v32; // r4
  int v33; // r6
  int v34; // [sp+0h] [bp-58h]
  int v35; // [sp+4h] [bp-54h]
  CVector vecCentre; // [sp+8h] [bp-50h] BYREF

  v0 = CPools::ms_pDummyPool;
  v1 = CTimer::m_FrameCounter;
  v2 = CPools::ms_pPedPool;
  v3 = CPools::ms_pObjectPool;
  PlayerCentreOfWorld = FindPlayerCentreOfWorld(CWorld::PlayerInFocus);
  v5 = *(_QWORD *)&PlayerCentreOfWorld->x;
  vecCentre.z = PlayerCentreOfWorld->z;
  *(_QWORD *)&vecCentre.x = v5;
  m_nSize = v3->m_nSize;
  v35 = v1 & 0x1F;
  v34 = v35 + 1;
  v7 = m_nSize * v35 / 32;
  v9 = m_nSize * v34;
  v8 = m_nSize * v34 + ((unsigned int)((m_nSize * v34) >> 31) >> 27);
  if ( v7 < v9 / 32 )
  {
    v10 = v8 >> 5;
    v11 = v7;
    do
    {
      if ( (v3->m_aFlags[v7] & 0x80u) == 0 && v3->m_aStorage[v11] )
        CPopulation::ManageObject((CObject *)v3->m_aStorage[v11], &vecCentre);
      ++v7;
      ++v11;
    }
    while ( v10 != v7 );
  }
  v12 = v0->m_nSize;
  v13 = v35 * v12;
  v15 = v34 * v12;
  v14 = v34 * v12 + ((unsigned int)((v34 * v12) >> 31) >> 27);
  v16 = v13 / 32;
  if ( v13 / 32 < v15 / 32 )
  {
    v17 = v14 >> 5;
    x = vecCentre.x;
    v19 = v16;
    y = vecCentre.y;
    z = vecCentre.z;
    do
    {
      if ( (v0->m_aFlags[v16] & 0x80u) == 0 )
      {
        v22 = v0->m_aStorage[v19];
        if ( v22 )
        {
          v23 = v22[51];
          v24 = v23 == 13;
          if ( v23 != 13 )
            v24 = CGame::currArea == v23;
          if ( v24 && (v22[28] & 0x80) != 0 )
          {
            v25 = *((_DWORD *)v22 + 5);
            v26 = (float *)(v25 + 48);
            if ( !v25 )
              v26 = (float *)(v22 + 4);
            v27 = *((__int16 *)v22 + 19);
            v28 = 750.0;
            v29 = sqrtf(
                    (float)((float)((float)(*v26 - x) * (float)(*v26 - x))
                          + (float)((float)(v26[1] - y) * (float)(v26[1] - y)))
                  + (float)((float)(v26[2] - z) * (float)(v26[2] - z)));
            if ( MI_SAMSITE != v27 )
            {
              v24 = MI_SAMSITE2 == v27;
              v30 = dword_4CC7DC;
              if ( v24 )
                v30 = &dword_4CC7DC[1];
              v28 = *(float *)v30;
            }
            if ( v29 < v28 )
              CPopulation::ConvertToRealObject((CDummyObject *)v22);
          }
        }
      }
      ++v16;
      ++v19;
    }
    while ( v17 != v16 );
  }
  v31 = v2->m_nSize;
  if ( v31 )
  {
    v32 = v31 - 1;
    v33 = 1996 * v31 - 1996;
    do
    {
      if ( (v2->m_aFlags[v32] & 0x80u) == 0 )
      {
        if ( &(*v2->m_aStorage)[v33] )
          CPopulation::ManagePed((CPed *)&(*v2->m_aStorage)[v33], &vecCentre);
      }
      --v32;
      v33 -= 1996;
    }
    while ( v32 != -1 );
  }
}
// 4CC7DC: using guessed type int dword_4CC7DC[2];

//----- (004CC7E4) --------------------------------------------------------
void CPopulation::RemovePedsIfThePoolGetsFull()
{
  unsigned __int64 v0; // d19
  CPedPool *v1; // r11
  int32 m_nSize; // r4
  int v3; // r1
  int8x16_t v4; // q8
  unsigned int v5; // r3
  int64x2_t v6; // q10
  uint8 *m_aFlags; // r0
  int v8; // t1
  int32x4_t v9; // q8
  unsigned __int32 v10; // r2
  uint8 *v11; // r0
  int v12; // r1
  unsigned int v13; // t1
  CEntity *v14; // r8
  float v15; // s16
  int v16; // r0
  int v17; // r6
  CEntity *v18; // r5
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  CSimpleTransform *p_m_transform; // r0
  float32x2_t v22; // d16
  unsigned __int64 v23; // d1
  float v24; // s0

  if ( (CTimer::m_FrameCounter & 7) != 5 )
    return;
  v1 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize < 1 )
  {
    v10 = 0;
    goto LABEL_14;
  }
  if ( (unsigned int)m_nSize < 4 || (v3 = m_nSize & 0x7FFFFFFC, (m_nSize & 0xFFFFFFFC) == 0) )
  {
    v3 = 0;
    v10 = 0;
LABEL_10:
    v11 = &CPools::ms_pPedPool->m_aFlags[v3];
    v12 = m_nSize - v3;
    do
    {
      v13 = *v11++;
      --v12;
      v10 += (v13 >> 7) ^ 1;
    }
    while ( v12 );
    goto LABEL_14;
  }
  v4 = 0uLL;
  v5 = m_nSize & 0xFFFFFFFC;
  v6.n128_u64[0] = 0xFF000000FFLL;
  v6.n128_u64[1] = 0xFF000000FFLL;
  m_aFlags = CPools::ms_pPedPool->m_aFlags;
  do
  {
    v8 = *(_DWORD *)m_aFlags;
    m_aFlags += 4;
    v5 -= 4;
    LODWORD(v0) = v8;
    v0 = vshr_n_u16((uint16x4_t)vmovl_u8((uint8x8_t)v0).n128_u64[0], 7u).n64_u64[0] ^ 0x1000100010001LL;
    v4 = vaddq_s32(v4, vandq_s64(vmovl_u16((uint16x4_t)v0), v6));
  }
  while ( v5 );
  v9 = vaddq_s32(v4, vextq_s8(v4, v4, 8u));
  v10 = vaddq_s32(v9, vdupq_lane_s32((int32x2_t)v9.n128_u64[0], 1)).n128_u32[0];
  if ( m_nSize != v3 )
    goto LABEL_10;
LABEL_14:
  if ( (int)(m_nSize - v10) <= 7 && m_nSize )
  {
    v14 = 0;
    v15 = 10000000.0;
LABEL_17:
    v16 = 1996 * m_nSize--;
    v17 = v16 - 1996;
    do
    {
      if ( (v1->m_aFlags[m_nSize] & 0x80u) == 0 )
      {
        v18 = (CEntity *)&(*v1->m_aStorage)[v17];
        if ( v18 )
        {
          if ( CPed::CanBeDeleted((CPed *)&(*v1->m_aStorage)[v17]) )
          {
            m_pMat = v18->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &v18->m_transform;
            p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
            if ( !TheCamera.m_pMat )
              p_m_transform = &TheCamera.m_transform;
            v22.n64_u64[0] = vsub_f32(
                               *(float32x2_t *)&p_m_transform->m_translate.y,
                               *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
            v23 = vmul_f32(v22, v22).n64_u64[0];
            v24 = sqrtf(
                    (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                  * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                          + *(float *)&v23)
                  + *((float *)&v23 + 1));
            if ( v24 < v15 )
            {
              v15 = v24;
              v14 = v18;
              if ( m_nSize )
                goto LABEL_17;
              v14 = v18;
              goto LABEL_31;
            }
          }
        }
      }
      --m_nSize;
      v17 -= 1996;
    }
    while ( m_nSize != -1 );
    if ( !v14 )
      return;
LABEL_31:
    CWorld::Remove(v14);
    (*((void (__fastcall **)(CEntity *))v14->_vptr$CPlaceable + 1))(v14);
  }
}
// 4CC820: mask 0xFFFFFFFC is shortened because r4.4 <= 0x7FFFFFFF
// 4CC844: variable 'v0' is possibly undefined

//----- (004CC98C) --------------------------------------------------------
void CPopulation::GeneratePedsAtStartOfGame()
{
  int v0; // r5
  float v1; // s18
  float v2; // r0
  const CVector *PlayerCentreOfWorld; // r0
  RwReal x; // r5
  RwReal y; // r6
  RwReal z; // r8
  float v8; // s18
  float v9; // s0
  CVector v10; // 0:r0.12

  v0 = 0;
  do
  {
    CPopulation::ms_nTotalCivPeds = CPopulation::ms_nNumCivMale + CPopulation::ms_nNumCivFemale;
    CPopulation::ms_nTotalGangPeds = CPopulation::ms_nNumGang[0]
                                   + CPopulation::ms_nNumGang[1]
                                   + CPopulation::ms_nNumGang[2]
                                   + CPopulation::ms_nNumGang[3]
                                   + CPopulation::ms_nNumGang[4]
                                   + CPopulation::ms_nNumGang[5]
                                   + CPopulation::ms_nNumGang[6]
                                   + CPopulation::ms_nNumGang[7]
                                   + CPopulation::ms_nNumGang[8]
                                   + CPopulation::ms_nNumGang[9];
    CPopulation::ms_nTotalPeds = CPopulation::ms_nNumCivMale
                               + CPopulation::ms_nNumCivFemale
                               + CPopulation::ms_nTotalGangPeds
                               + CPopulation::ms_nNumCop
                               + CPopulation::ms_nNumEmergency
                               - CPopulation::ms_nTotalCarPassengerPeds;
    v1 = CPopulation::PedCreationDistMultiplier();
    v2 = CPopulation::PedCreationDistMultiplier();
    CPopulation::AddToPopulation(10.0, v1 * 50.5, 10.0, v2 * 50.5);
  }
  while ( (__int16)v0++ < 99 );
  CPopulation::m_bIsHospital = 0;
  PlayerCentreOfWorld = FindPlayerCentreOfWorld(CWorld::PlayerInFocus);
  x = PlayerCentreOfWorld->x;
  y = PlayerCentreOfWorld->y;
  z = PlayerCentreOfWorld->z;
  v8 = CPopulation::PedCreationDistMultiplier();
  v9 = CPopulation::PedCreationDistMultiplier() * 50.5;
  *(_QWORD *)&v10.x = __PAIR64__(LODWORD(y), LODWORD(x));
  v10.z = z;
  CPopulation::GeneratePedsAtAttractors(v10, 10.0, v8 * 50.5, 10.0, v9, -1, 1);
}
// 675EF0: using guessed type int *CPopulation::ms_nNumCivFemale;
// 677D74: using guessed type int *CPopulation::ms_nNumCivMale;
// 6783EC: using guessed type int *CPopulation::ms_nNumCop[2];
// 6797C8: using guessed type int *CPopulation::ms_nNumEmergency;

//----- (004CCB08) --------------------------------------------------------
bool __fastcall CPopulation::AddToPopulation(float fMinRad, float fMaxRad, float fMinRadClose, float fMaxRadClose)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d1
  float32x2_t v6; // d2
  __int16 v11; // r8
  Int32 Civilians; // r0
  bool v13; // r3
  bool v14; // zf
  CPlayerInfo *v15; // r10
  const CVector *PlayerCentreOfWorld; // r0
  float x; // s16
  float y; // s18
  float z; // s26
  float v20; // s20
  float v21; // s22
  float v22; // s24
  CWanted *m_Wanted; // r0
  CPlayerPed *pPed; // r0
  bool v25; // zf
  int v26; // r0
  _BOOL4 active; // r4
  int v28; // r11
  int v29; // r5
  float v30; // s28
  float v31; // s30
  eVisibleArea v32; // r6
  float v33; // s17
  float v34; // s19
  float v35; // s21
  float v36; // s2
  float v37; // s2
  bool v38; // r9
  float32x2_t v39; // d0
  float v40; // s4
  int v41; // r1
  float v42; // s2
  int v43; // r0
  float v44; // s0
  int v45; // r0
  int v46; // r0
  float v47; // s28
  float v48; // s30
  int v49; // r10
  Int32 v50; // r11
  Int32 v51; // r8
  int bIncludeSwitchedOffs; // r0
  ePedType v53; // r0
  int v54; // s0
  float v55; // r4
  CNodeAddress v56; // r1
  unsigned int v57; // r4
  CNodeAddress v58; // r4
  CNodeAddress v59; // r5
  UInt16 v60; // r0
  CColPoint *v62; // r4
  int v63; // r6
  CPed *v64; // r9
  int32 m_modelId; // r0
  float v66; // s27
  float v67; // s21
  float v68; // s19
  float v69; // s0
  float v70; // s21
  float v71; // s27
  char v72; // r6
  char v73; // r0
  CMatrix *m_pMat; // r1
  float v75; // s0
  float *p_tx; // r2
  float v77; // s4
  float GroundZFor3DCoord; // r0
  float v79; // s19
  _BOOL4 v80; // r10
  bool v81; // zf
  int32 m_nSize; // r3
  float v83; // s2
  int v84; // r6
  int v85; // r5
  uint8 *v86; // r6
  int v87; // r2
  uint8 *v88; // r4
  float32x2_t v89; // d17
  unsigned __int64 v90; // d3
  float v91; // s4
  CPed *v92; // r11
  bool v93; // zf
  unsigned int CanSunbathe; // r0
  bool v95; // zf
  _BOOL4 v96; // r4
  CMatrix *v97; // r0
  int m_nSurfaceType; // r4
  CSimpleTransform *p_m_transform; // r1
  __int64 v100; // d16
  float v101; // s0
  CMatrix *v102; // r0
  float v103; // s27
  CColPoint *v104; // r5
  CTaskComplexWander *v105; // r4
  unsigned __int16 v106; // r0
  CTask *v107; // r1
  CObject *v108; // r6
  CEntity *v109; // r0
  CPedIntelligence *v110; // r4
  CTaskComplexWander *WanderTaskByPedType; // r0
  CTaskSimpleHoldEntity *v112; // r4
  CEntity *v113; // r1
  CTask *v114; // r1
  CObject *v115; // r0
  CObject *v116; // r5
  CMatrix *v117; // r0
  CMatrix *v118; // r0
  __int64 v119; // d16
  CMatrix *v120; // r0
  __int64 v121; // d16
  CMatrix *v122; // r0
  __int64 v123; // d16
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  const CMatrix *v126; // r0
  RwMatrix *v127; // r1
  float *p_xx; // r4
  float v129; // s0
  RwReal v130; // s4
  RwReal v131; // s2
  RwReal v132; // s0
  float *v133; // r4
  int v134; // r0
  float v135; // s0
  RwReal v136; // s4
  RwReal v137; // s2
  RwReal v138; // s0
  char v139; // r4
  CPedIntelligence *m_pPedIntelligence; // r5
  CTaskComplexSunbathe *v141; // r6
  int v142; // r8
  CObject *v143; // [sp+24h] [bp-14Ch]
  bool v144; // [sp+58h] [bp-118h]
  int v145; // [sp+74h] [bp-FCh]
  int v146; // [sp+74h] [bp-FCh]
  int v147; // [sp+80h] [bp-F0h]
  int v148; // [sp+84h] [bp-ECh]
  float v149; // [sp+88h] [bp-E8h]
  float v150; // [sp+8Ch] [bp-E4h]
  CVector refEntityPtr; // [sp+90h] [bp-E0h] BYREF
  CEntity *v152; // [sp+A0h] [bp-D0h] BYREF
  bool pBool; // [sp+A7h] [bp-C9h] BYREF
  float pFraction; // [sp+A8h] [bp-C8h] BYREF
  CNodeAddress pToNode; // [sp+ACh] [bp-C4h] BYREF
  CNodeAddress pFromNode; // [sp+B0h] [bp-C0h] BYREF
  CVector vLeaderPos; // [sp+B4h] [bp-BCh] BYREF
  Int32 iPedFemaleOccupation; // [sp+C0h] [bp-B0h] BYREF
  Int32 iPedMaleOccupation; // [sp+C4h] [bp-ACh] BYREF
  Int32 pNewPedMI; // [sp+C8h] [bp-A8h] BYREF
  ePedType pNewPedType; // [sp+CCh] [bp-A4h] BYREF
  CVector vecStart; // [sp+D0h] [bp-A0h] BYREF
  CColPoint v163[3]; // [sp+E0h] [bp-90h] BYREF

  iPedMaleOccupation = -1;
  iPedFemaleOccupation = -1;
  pFromNode.Region = -1;
  pToNode.Region = -1;
  v11 = CWorld::PlayerInFocus;
  Civilians = CGangWars::DontCreateCivilians();
  v13 = 0;
  v14 = CCheat::m_aCheatsActive[82] == 0;
  if ( !CCheat::m_aCheatsActive[82] )
    v14 = Civilians == 0;
  if ( v14 )
  {
    v15 = &CWorld::Players[v11];
    PlayerCentreOfWorld = FindPlayerCentreOfWorld(CWorld::PlayerInFocus);
    x = PlayerCentreOfWorld->x;
    y = PlayerCentreOfWorld->y;
    z = PlayerCentreOfWorld->z;
    if ( (++CPopulation::AddToPopulation(float,float,float,float)::iter & 1) == 0 && FindPlayerVehicle(-1, 0) )
    {
      v20 = FindPlayerVehicle(-1, 0)->m_vecMoveSpeed.x;
      y = y + (float)(FindPlayerVehicle(-1, 0)->m_vecMoveSpeed.y * 1.5);
      x = x + (float)(v20 * 1.5);
    }
    v21 = fMaxRad;
    v22 = fMinRad;
    m_Wanted = v15->pPed->m_pPlayerData->m_Wanted;
    v149 = fMaxRadClose;
    v150 = fMinRadClose;
    if ( m_Wanted->m_WantedLevel < WANTED_LEVEL3 || CPopulation::ms_nNumCop >= m_Wanted->m_nMaxCopsInPursuit )
      goto LABEL_13;
    pPed = (CPlayerPed *)CGangWars::GangWarFightingGoingOn();
    v25 = pPed == 0;
    if ( !pPed )
    {
      pPed = v15->pPed;
      v25 = *((unsigned __int8 *)&v15->pPed->m_nPedFlags + 1) << 31 == 0;
    }
    if ( v25
      && (CCarCtrl::NumLawEnforcerCars >= pPed->m_pPlayerData->m_Wanted->m_nMaxCopCarsInPursuit
       || (float)(CCarCtrl::CarDensityMultiplier * (float)CWorld::Players[v11].CarDensityForCurrentZone) <= (float)CCarCtrl::NumRandomCars
       || CCarCtrl::NumLawEnforcerCars
        + CCarCtrl::NumRandomCars
        + CCarCtrl::NumMissionCars
        + CCarCtrl::NumParkedCars
        + CCarCtrl::NumAmbulancesOnDuty
        + CCarCtrl::NumFireTrucksOnDuty >= CCarCtrl::MaxNumberOfCarsInUse) )
    {
      v55 = CPopulation::PedCreationDistMultiplier();
      v21 = CPopulation::PedCreationDistMultiplier() * 50.5;
      v26 = 1;
      v22 = v55 * 42.5;
    }
    else
    {
LABEL_13:
      v26 = 0;
    }
    v148 = v26;
    active = CGameLogic::LaRiotsActiveHere();
    v28 = CPopulation::ms_nNumCop;
    v29 = 25;
    v30 = CPopulation::PedDensityMultiplier;
    if ( MobileSettings::settings[0].value < 3 )
      v29 = 17;
    CPopulation::MaxNumberOfPedsInUse = v29;
    CDarkel::FrenzyOnGoing();
    v31 = CPopulation::PedDensityMultiplier;
    v32 = CGame::currArea;
    v33 = CPopCycle::m_NumOther_Peds;
    v34 = (float)CPopulation::NumberOfPedsInUseInterior;
    v35 = (float)(CPopCycle::m_NumDealers_Peds + CPopCycle::m_NumGangs_Peds) + CPopCycle::m_NumCops_Peds;
    v36 = 1.0;
    if ( CCullZones::FewerPeds() )
      v36 = 0.6;
    v6.n64_f32[0] = v35 + v33;
    v4.n64_f32[0] = (float)v29;
    v37 = v31 * v36;
    v38 = 0;
    v13 = 0;
    v39.n64_u64[0] = vmin_f32(v6, v4).n64_u64[0];
    if ( v32 == AREA_MAIN_MAP )
      v34 = v39.n64_f32[0];
    v40 = v34 * v37;
    v41 = 0;
    v42 = (float)CPopulation::ms_nTotalPeds;
    v43 = 0;
    v44 = v40 * 0.42;
    if ( !CPopulation::m_bIsHospital )
      v44 = v40;
    if ( v44 > v42 )
      v38 = 1;
    if ( v30 > 0.1 )
      v43 = 1;
    v45 = v43 & active;
    if ( v28 < 1 )
      v41 = 1;
    v46 = v45 & v41 | v148;
    if ( v46 || v44 > v42 )
    {
      v47 = v149;
      v48 = v150;
      if ( v46 == 1 )
      {
        v49 = 1;
        pNewPedType = PEDTYPE_COP;
        v50 = -1;
        v51 = -1;
        pNewPedMI = 0;
LABEL_32:
        bIncludeSwitchedOffs = FindPlayerWanted(-1)->m_WantedLevel > WANTED_CLEAN;
        goto LABEL_54;
      }
      if ( !CPopCycle::FindNewPedType(&pNewPedType, &pNewPedMI, z > 950.0, z > 950.0) )
        return v38;
      if ( (pNewPedType | 1) == 5 && (float)((float)((float)rand() * 4.6566e-10) + 0.0) > 0.9 )
      {
        CPopulation::ChooseCivilianCoupleOccupations(&iPedMaleOccupation, &iPedFemaleOccupation);
        v50 = iPedMaleOccupation;
        if ( iPedMaleOccupation == -1 )
          return v38;
        v51 = iPedFemaleOccupation;
        if ( iPedFemaleOccupation == -1 )
          return v38;
        pNewPedType = *(_DWORD *)CModelInfo::ms_modelInfoPtrs[iPedMaleOccupation][1].m_modelName;
      }
      else
      {
        v51 = -1;
        v50 = -1;
      }
      v53 = CPopulation::m_AllRandomPedsThisType;
      if ( CPopulation::m_AllRandomPedsThisType <= 0 )
        v53 = pNewPedType;
      else
        pNewPedType = CPopulation::m_AllRandomPedsThisType;
      if ( (unsigned int)(v53 - 7) > 9 )
      {
        v49 = 1;
      }
      else
      {
        v54 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)4);
        v53 = pNewPedType;
        v49 = v54 + 1;
      }
      if ( (unsigned int)(v53 - 7) > 9 )
      {
        if ( v53 == PEDTYPE_COP )
          goto LABEL_32;
      }
      else
      {
        v47 = v149 + 0.0;
        v48 = v150 + 0.0;
        v21 = v21 + 30.0;
        v22 = v22 + 30.0;
      }
      bIncludeSwitchedOffs = 0;
LABEL_54:
      if ( !CPathFind::GeneratePedCreationCoors(
              &ThePaths,
              x,
              y,
              v22,
              v21,
              v48,
              v47,
              &vLeaderPos,
              &pFromNode,
              &pToNode,
              &pFraction,
              bIncludeSwitchedOffs,
              0) )
        return v38;
      v56 = pToNode;
      if ( (*((_BYTE *)&ThePaths.pNodes[pFromNode.Region][HIWORD(*(unsigned int *)&pFromNode)] + 26) & 0xFu) < (*((_BYTE *)&ThePaths.pNodes[pToNode.Region][HIWORD(*(unsigned int *)&pToNode)] + 26) & 0xFu) )
        v56 = pFromNode;
      v57 = *((_BYTE *)&ThePaths.pNodes[v56.Region][HIWORD(*(unsigned int *)&v56)] + 26) & 0xF;
      if ( (rand() & 0xFu) > v57 )
        return v38;
      v58 = pToNode;
      v59 = pFromNode;
      v60 = rand();
      CPathFind::TakeWidthIntoAccountForCoors(&ThePaths, v59, v58, v60, &vLeaderPos.x, &vLeaderPos.y);
      if ( (unsigned int)(pNewPedType - 7) <= 9 )
      {
        CPedGroupPlacer::PlaceGroup((const CPedGroupPlacer *)v163, pNewPedType, v49, &vLeaderPos, 5u);
        return v38;
      }
      if ( (v51 | v50) > -1 )
      {
        CPopulation::PlaceCouple(PEDTYPE_CIVMALE, v50, PEDTYPE_CIVFEMALE, v51, vLeaderPos);
        return v38;
      }
      v62 = v163;
      v63 = 0;
      v144 = v38;
      v64 = 0;
      v147 = v49;
      while ( 1 )
      {
        v142 = v63;
        if ( v63 >= v49 )
          return v144;
        if ( pNewPedType == PEDTYPE_COP )
        {
          switch ( pNewPedMI )
          {
            case 2:
              if ( CStreaming::ms_aInfoForModel[285].m_status != 1 )
                return v144;
              m_modelId = CWeaponInfo::GetWeaponInfo(WEAPONTYPE_MICRO_UZI, 1)->m_modelId;
LABEL_78:
              if ( CStreaming::ms_aInfoForModel[m_modelId].m_status != 1 )
                return v144;
              break;
            case 5:
              if ( CStreaming::ms_aInfoForModel[287].m_status != 1
                || CStreaming::ms_aInfoForModel[CWeaponInfo::GetWeaponInfo(WEAPONTYPE_MP5, 1)->m_modelId].m_status != 1 )
              {
                return v144;
              }
              m_modelId = CWeaponInfo::GetWeaponInfo(WEAPONTYPE_GRENADE, 1)->m_modelId;
              goto LABEL_78;
            case 4:
              if ( CStreaming::ms_aInfoForModel[286].m_status != 1 )
                return v144;
              m_modelId = CWeaponInfo::GetWeaponInfo(WEAPONTYPE_MP5, 1)->m_modelId;
              goto LABEL_78;
          }
        }
        else if ( !CModelInfo::ms_modelInfoPtrs[pNewPedMI]->m_pRwObject )
        {
          return v144;
        }
        vLeaderPos.z = vLeaderPos.z + 0.7;
        rand();
        if ( v64 )
        {
          v66 = (float)v63 * 0.75;
          v67 = (float)((float)((float)v63 + 1.0) * 0.75) - v66;
          v68 = v66 + (float)(v67 * (float)((float)rand() * 4.6566e-10));
          v69 = v67 * (float)((float)rand() * 4.6566e-10);
          v70 = -v68;
          v71 = v66 + v69;
          v72 = rand();
          v73 = rand();
          m_pMat = v64->m_pMat;
          if ( (v72 & 1) == 0 )
            v70 = v68;
          v75 = -v71;
          p_tx = &m_pMat->tx;
          if ( !m_pMat )
            p_tx = &v64->m_transform.m_translate.x;
          v77 = p_tx[1];
          if ( (v73 & 1) == 0 )
            v75 = v71;
          vLeaderPos.x = *p_tx + v70;
          vLeaderPos.y = v75 + v77;
        }
        if ( CPedPlacement::IsPositionClearForPed(&vLeaderPos, -1.0, -1, 0, 1, 1, 1) == 1 )
        {
          v63 = v142 + 1;
          if ( v142 + 1 < v49 )
          {
            GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(vLeaderPos.x, vLeaderPos.y, vLeaderPos.z + 2.0, &pBool, 0);
            if ( !pBool )
              return v144;
            v5.n64_u32[0] = LODWORD(vLeaderPos.z);
            v39.n64_f32[0] = GroundZFor3DCoord + 0.7;
            v39.n64_u64[0] = vmax_f32(v5, v39).n64_u64[0];
            LODWORD(vLeaderPos.z) = v39.n64_u32[0];
          }
          if ( CCamera::IsSphereVisible(&TheCamera, &vLeaderPos, 2.0)
            && (v79 = sqrtf(
                        (float)((float)(vLeaderPos.x - x) * (float)(vLeaderPos.x - x))
                      + (float)((float)(vLeaderPos.y - y) * (float)(vLeaderPos.y - y))),
                v79 < (float)(CPopulation::PedCreationDistMultiplier() * 42.5)) )
          {
            v80 = 0;
          }
          else if ( *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[pNewPedMI][1].m_modelName[4] == 40 )
          {
            v80 = 0;
            refEntityPtr.x = 0.0;
            vecStart.x = vLeaderPos.x + 0.0;
            vecStart.y = vLeaderPos.y + 0.0;
            vecStart.z = vLeaderPos.z + 2.0;
            CWorld::ProcessVerticalLine(
              &vecStart,
              vLeaderPos.z + -2.0,
              v62,
              (CEntity **)&refEntityPtr,
              1,
              0,
              0,
              0,
              0,
              0,
              0);
            if ( LODWORD(refEntityPtr.x) )
              v80 = SurfaceInfos_c::IsSkateable(&g_surfaceInfos, v163[0].m_dataB.m_nSurfaceType) != 0;
          }
          else
          {
            v80 = 1;
          }
          if ( (*(_DWORD *)&CModelInfo::ms_modelInfoPtrs[pNewPedMI][1].m_modelName[4] & 0xFFFFFFFE) != 38
            || (unsigned __int8)(CClock::ms_nGameClockHours - 8) <= 0xBu )
          {
            v81 = pNewPedType == PEDTYPE_DEALER;
            if ( pNewPedType == PEDTYPE_DEALER )
              v81 = v80;
            if ( !v81 )
              goto LABEL_120;
            m_nSize = CPools::ms_pPedPool->m_nSize;
            if ( !m_nSize )
              goto LABEL_120;
            v83 = 10000000.0;
            do
            {
              v84 = 1996 * m_nSize--;
              v85 = v84 - 1996;
              while ( 1 )
              {
                if ( (CPools::ms_pPedPool->m_aFlags[m_nSize] & 0x80u) == 0 )
                {
                  v86 = &(*CPools::ms_pPedPool->m_aStorage)[v85];
                  if ( v86 )
                  {
                    if ( *((_DWORD *)v86 + 359) == 17 )
                    {
                      v87 = *((_DWORD *)v86 + 5);
                      v88 = (uint8 *)(v87 + 48);
                      if ( !v87 )
                        v88 = v86 + 4;
                      v89.n64_u64[0] = vsub_f32(*(float32x2_t *)&vLeaderPos.y, *(float32x2_t *)(v88 + 4)).n64_u64[0];
                      v90 = vmul_f32(v89, v89).n64_u64[0];
                      v91 = sqrtf(
                              (float)((float)((float)(vLeaderPos.x - *(float *)v88)
                                            * (float)(vLeaderPos.x - *(float *)v88))
                                    + *(float *)&v90)
                            + *((float *)&v90 + 1));
                      if ( v91 < v83 )
                        break;
                    }
                  }
                }
                --m_nSize;
                v85 -= 1996;
                if ( m_nSize == -1 )
                {
                  v91 = v83;
                  goto LABEL_116;
                }
              }
              v83 = v91;
            }
            while ( m_nSize );
LABEL_116:
            v63 = v142 + 1;
            v62 = v163;
            if ( v91 >= 20.0 )
            {
LABEL_120:
              if ( pNewPedType == PEDTYPE_GANG2
                || (unsigned int)(pNewPedType - 7) >= 0xA
                || !v80
                || vLeaderPos.x <= 2400.0
                || vLeaderPos.x >= 2540.0 )
              {
                v14 = v80;
                v49 = v147;
                if ( !v14 )
                  return v144;
              }
              else
              {
                v49 = v147;
                if ( vLeaderPos.y > -1730.0 && vLeaderPos.y < -1625.0 )
                  return v144;
              }
              v92 = CPopulation::AddPed(pNewPedType, pNewPedMI, &vLeaderPos, 1);
              if ( (*(_DWORD *)&CModelInfo::ms_modelInfoPtrs[pNewPedMI][1].m_modelName[4] & 0xFFFFFFFE) != 38 )
                goto LABEL_146;
              if ( (rand() & 3) == 0 )
                goto LABEL_146;
              refEntityPtr.x = 0.0;
              vecStart.x = vLeaderPos.x + 0.0;
              vecStart.y = vLeaderPos.y + 0.0;
              vecStart.z = vLeaderPos.z + 2.0;
              CWorld::ProcessVerticalLine(
                &vecStart,
                vLeaderPos.z + -2.0,
                v62,
                (CEntity **)&refEntityPtr,
                1,
                0,
                0,
                0,
                0,
                0,
                0);
              if ( !LODWORD(refEntityPtr.x) )
                goto LABEL_146;
              if ( !SurfaceInfos_c::IsBeach(&g_surfaceInfos, v163[0].m_dataB.m_nSurfaceType) )
              {
                v93 = v163[0].m_dataB.m_nSurfaceType == 34;
                if ( v163[0].m_dataB.m_nSurfaceType != 34 )
                  v93 = v163[0].m_dataB.m_nSurfaceType == 160;
                if ( !v93 && !CCheat::m_aCheatsActive[49] )
                  goto LABEL_146;
              }
              CanSunbathe = CTaskComplexSunbathe::CanSunbathe();
              v95 = CCheat::m_aCheatsActive[49] == 0;
              if ( !CCheat::m_aCheatsActive[49] )
                v95 = CanSunbathe == 0;
              if ( v95 )
                goto LABEL_146;
              vecStart.x = 0.0;
              vecStart.y = 0.0;
              v96 = 1;
              if ( CPedPlacement::IsPositionClearForPed(&vLeaderPos, 3.0, 2, (CEntity **)&vecStart, 1, 1, 1) == 1 )
                v96 = (LODWORD(vecStart.y) == 0 || LODWORD(vecStart.y) == (_DWORD)v92)
                   && (LODWORD(vecStart.x) == 0 || LODWORD(vecStart.x) == (_DWORD)v92);
              v14 = !v96;
              v62 = v163;
              if ( !v14 )
              {
                v97 = v92->m_pMat;
                m_nSurfaceType = v163[0].m_dataB.m_nSurfaceType;
                p_m_transform = (CSimpleTransform *)&v97->tx;
                if ( !v97 )
                  p_m_transform = &v92->m_transform;
                v100 = *(_QWORD *)&p_m_transform->m_translate.x;
                vecStart.z = p_m_transform->m_translate.z;
                *(_QWORD *)&vecStart.x = v100;
                refEntityPtr.x = *(float *)&v100 + 0.0;
                refEntityPtr.y = *((float *)&v100 + 1) + 0.0;
                refEntityPtr.z = vecStart.z + 10.0;
                if ( CWorld::ProcessVerticalLine(&refEntityPtr, -10.0, v163, &v152, 1, 0, 0, 0, 1, 0, 0)
                  && (float)(v163[0].m_vecNormal.z
                           + (float)((float)(v163[0].m_vecNormal.x * 0.0) + (float)(v163[0].m_vecNormal.y * 0.0))) > 0.95 )
                {
                  v101 = (float)rand();
                  v102 = v92->m_pMat;
                  v103 = (float)((float)(v101 * 4.6566e-10) + 0.0) * 6.2832;
                  v92->m_fDesiredHeading = v103;
                  v92->m_fCurrentHeading = v103;
                  if ( v102 )
                    CMatrix::SetRotateZOnly(v102, (float)((float)(v101 * 4.6566e-10) + 0.0) * 6.2832);
                  else
                    v92->m_transform.m_heading = v103;
                  v146 = v63;
                  if ( m_nSurfaceType == 160
                    || (vecStart.z = v163[0].m_vecPosition.z + 0.04,
                        v115 = CWaterLevel::CreateBeachToy(&vecStart, BEACHTOY_BEACHTOWEL_ANY),
                        (v116 = v115) == 0) )
                  {
                    v143 = 0;
                  }
                  else
                  {
                    v117 = v115->m_pMat;
                    if ( v117 )
                    {
                      CMatrix::SetRotateZOnly(v117, v103);
                      v118 = v116->m_pMat;
                    }
                    else
                    {
                      v118 = 0;
                      v116->m_transform.m_heading = v103;
                    }
                    v119 = *(_QWORD *)&v163[0].m_vecNormal.x;
                    v118->zz = v163[0].m_vecNormal.z;
                    *(_QWORD *)&v118->xz = v119;
                    CrossProduct(&refEntityPtr, (const CVector *)&v116->m_pMat->xz, (const CVector *)&v116->m_pMat->xy);
                    v120 = v116->m_pMat;
                    v121 = *(_QWORD *)&refEntityPtr.x;
                    v120->zx = refEntityPtr.z;
                    *(_QWORD *)&v120->xx = v121;
                    CrossProduct(&refEntityPtr, (const CVector *)&v116->m_pMat->xz, (const CVector *)v116->m_pMat);
                    v122 = v116->m_pMat;
                    v123 = *(_QWORD *)&refEntityPtr.x;
                    v122->zy = refEntityPtr.z;
                    *(_QWORD *)&v122->xy = v123;
                    m_pRwObject = v116->m_pRwObject;
                    if ( m_pRwObject )
                    {
                      parent = (char *)m_pRwObject->parent;
                      v126 = v116->m_pMat;
                      v127 = (RwMatrix *)(parent + 16);
                      if ( v126 )
                        CMatrix::UpdateRwMatrix(v126, v127);
                      else
                        CSimpleTransform::UpdateRwMatrix(&v116->m_transform, v127);
                    }
                    CEntity::UpdateRwFrame(v116);
                    v143 = v116;
                    if ( (rand() & 3) == 0 )
                    {
                      refEntityPtr = vecStart;
                      p_xx = &v116->m_pMat->xx;
                      v129 = (float)((float)rand() * 4.6566e-10) + -0.5;
                      v130 = (float)(p_xx[1] * v129) + refEntityPtr.y;
                      v131 = (float)(*p_xx * v129) + refEntityPtr.x;
                      v132 = (float)(p_xx[2] * v129) + refEntityPtr.z;
                      refEntityPtr.x = v131;
                      refEntityPtr.y = v130;
                      refEntityPtr.z = v132;
                      v133 = &v116->m_pMat->xx;
                      v134 = rand();
                      v135 = (float)((float)((float)v134 * 4.6566e-10) + (float)((float)v134 * 4.6566e-10)) + -1.0;
                      v136 = (float)(v133[5] * v135) + refEntityPtr.y;
                      v137 = refEntityPtr.x + (float)(v133[4] * v135);
                      v138 = (float)(v133[6] * v135) + refEntityPtr.z;
                      refEntityPtr.x = v137;
                      refEntityPtr.y = v136;
                      refEntityPtr.z = v138;
                      CWaterLevel::CreateBeachToy(&refEntityPtr, BEACHTOY_LOTION);
                    }
                  }
                  v139 = rand();
                  m_pPedIntelligence = v92->m_pPedIntelligence;
                  v141 = (CTaskComplexSunbathe *)CTask::operator new(0x38u);
                  CTaskComplexSunbathe::CTaskComplexSunbathe(v141, v143, (v139 & 3) == 0);
                  CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, v141, 3, 0);
                  v63 = v146;
                }
                v62 = v163;
              }
              else
              {
LABEL_146:
                if ( CGameLogic::LaRiotsActiveHere() )
                {
                  if ( (rand() & 3) != 0 )
                  {
                    v104 = v62;
                    v105 = (CTaskComplexWander *)CTask::operator new(0x38u);
                    v106 = rand();
                    CTaskComplexWander::CTaskComplexWander(
                      v105,
                      6,
                      (int)(float)((float)((float)v106 * 0.000015259) * 8.0),
                      1,
                      0.5);
                    v107 = v105;
                    LOWORD(v105[1].m_pSubTask) = 0;
                    v105[1].m_iMoveState = 0;
                    v105[1]._vptr$CTask = 0;
                    v105[1].m_pParent = 0;
                    v105->_vptr$CTask = (int (**)(void))&off_66C624;
                    v62 = v104;
                    CTaskManager::SetTask(&v92->m_pPedIntelligence->m_taskManager, v107, 4, 0);
                  }
                  else if ( pNewPedType != PEDTYPE_COP )
                  {
                    v145 = v63;
                    v108 = (CObject *)CObject::operator new(0x184u);
                    CObject::CObject(v108, MI_TELLY, 1);
                    CWorld::Add(v109);
                    v110 = v92->m_pPedIntelligence;
                    WanderTaskByPedType = CTaskComplexWander::GetWanderTaskByPedType(v92);
                    CTaskManager::SetTask(&v110->m_taskManager, WanderTaskByPedType, 4, 0);
                    v163[0].m_vecPosition.y = 0.45;
                    v163[0].m_vecPosition.x = 0.0;
                    v163[0].m_vecPosition.z = 0.35;
                    v112 = (CTaskSimpleHoldEntity *)CTask::operator new(0x3Cu);
                    v113 = v108;
                    v63 = v145;
                    CTaskSimpleHoldEntity::CTaskSimpleHoldEntity(
                      v112,
                      v113,
                      &v163[0].m_vecPosition,
                      1u,
                      1u,
                      ANIM_CARRY_HOLD,
                      ANIM_CARRY_BOX,
                      0);
                    v114 = v112;
                    v62 = v163;
                    CTaskManager::SetTaskSecondary(&v92->m_pPedIntelligence->m_taskManager, v114, 4);
                  }
                }
                else
                {
                  CScriptsForBrains::CheckIfNewEntityNeedsScript(&CTheScripts::ScriptsForBrains, v92, 0, 0);
                }
              }
              CVisibilityPlugins::SetClumpAlpha((RpClump_0 *)v92->m_pRwObject, 0);
              if ( !v142 )
                v64 = v92;
              if ( v49 > 1 )
                continue;
            }
          }
        }
        return v144;
      }
    }
  }
  return v13;
}
// 4CCCFC: variable 'v6' is possibly undefined
// 4CCCFC: variable 'v4' is possibly undefined
// 4CD394: variable 'v5' is possibly undefined
// 4CD862: variable 'v109' is possibly undefined
// 50: using guessed type int dword_50;
// 66C624: using guessed type void *;
// 67664C: using guessed type int *CCarCtrl::NumRandomCars;
// 677AB4: using guessed type int CCarCtrl::NumParkedCars[2];
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];
// 67816C: using guessed type int *CCarCtrl::NumMissionCars;
// 6783D4: using guessed type void *`vtable for'CTaskComplexWanderCriminal;
// 6783EC: using guessed type int *CPopulation::ms_nNumCop[2];

//----- (004CDB74) --------------------------------------------------------
float CPopulation::PedCreationDistMultiplier()
{
  float32x2_t v0; // d0
  float32x2_t v1; // d1
  float32x2_t v2; // d2
  float x; // s16
  float v4; // s18
  float y; // s20
  float v6; // s0

  if ( !FindPlayerVehicle(-1, 0) )
    return 1.0;
  x = FindPlayerVehicle(-1, 0)->m_vecMoveSpeed.x;
  v4 = FindPlayerVehicle(-1, 0)->m_vecMoveSpeed.x;
  y = FindPlayerVehicle(-1, 0)->m_vecMoveSpeed.y;
  v2.n64_u32[0] = 1.0;
  v1.n64_u32[0] = 1.5;
  v0.n64_f32[0] = (float)(sqrtf((float)(x * v4) + (float)(y * FindPlayerVehicle(-1, 0)->m_vecMoveSpeed.y)) + -0.1) + 1.0;
  LODWORD(v6) = vmin_f32(vmax_f32(v0, v2), v1).n64_u32[0];
  return v6;
}
// 4CDBE4: variable 'v0' is possibly undefined
// 4CDBE4: variable 'v2' is possibly undefined
// 4CDBE8: variable 'v1' is possibly undefined

//----- (004CDC00) --------------------------------------------------------
Int32 __fastcall CPopulation::GeneratePedsAtAttractors(
        CVector Coors,
        float minRad,
        float maxRad,
        float minRadClose,
        float maxRadClose,
        int32 decisionMaker,
        Int32 NumToCreate)
{
  Int32 v7; // r4
  int v9; // r11
  float v10; // s22
  int v12; // r3
  Int16 v13; // r0
  int v14; // r8
  CEntity *v15; // r0
  C2dEffect *Random2dEffect; // r0
  C2dEffect *v17; // r5
  unsigned int m_type; // r0
  bool v19; // cf
  int v20; // r0
  bool v21; // cc
  CEntity *v22; // r6
  __int64 v23; // d16
  const CMatrix *m_pMat; // r1
  float32x2_t v25; // d16
  unsigned __int64 v26; // d1
  float v27; // s28
  _BOOL4 IsSphereVisible; // r0
  float v29; // s2
  float v30; // s0
  Int32 v31; // r0
  int DefaultCopModel; // r0
  int v34; // [sp+20h] [bp-8A0h]
  int32 v35; // [sp+30h] [bp-890h]
  CVector v36; // [sp+38h] [bp-888h] BYREF
  CVector v; // [sp+48h] [bp-878h] BYREF
  CEntity *v38[512]; // [sp+54h] [bp-86Ch] BYREF
  Int16 pNum; // [sp+856h] [bp-6Ah] BYREF
  CVector Coorsa; // [sp+858h] [bp-68h] BYREF

  v7 = NumToCreate;
  v9 = 0;
  Coorsa = Coors;
  if ( NumToCreate )
  {
    pNum = -1;
    CWorld::FindObjectsInRange(&Coorsa, maxRad, 0, &pNum, 512, v38, 1, 0, 0, 1, 0);
    if ( NumToCreate >= 1 )
    {
      v10 = minRad;
      v9 = 0;
      v12 = 0;
      v13 = pNum;
      while ( 1 )
      {
        ++v12;
        if ( v13 >= 1 )
          break;
LABEL_38:
        if ( v12 > 11 || v7 < 1 )
          return v9;
      }
      v14 = 0;
      v34 = v12;
      v35 = decisionMaker;
      while ( 1 )
      {
        if ( !v7 )
          return v9;
        v15 = v38[v14];
        if ( v15->m_pRwObject )
        {
          if ( CGame::currArea == v15->m_areaCode )
          {
            Random2dEffect = CEntity::GetRandom2dEffect(v15, 3, 1u);
            v17 = Random2dEffect;
            if ( Random2dEffect )
            {
              m_type = Random2dEffect->attr.q.m_type;
              v19 = m_type >= 8;
              if ( m_type > 8 )
                goto LABEL_43;
              v20 = 1 << m_type;
              v21 = (v20 & 0x107) != 0 && v19;
              if ( (v20 & 0x107) != 0 )
                v21 = (unsigned __int8)(CClock::ms_nGameClockHours - 9) > 0xAu;
              if ( !v21 )
              {
LABEL_43:
                if ( v17->attr.q.m_flags << 31 )
                {
                  v22 = v38[v14];
                  if ( (*(_BYTE *)&v22->m_info & 7) != 4 || !(HIBYTE(v22[5].m_pRwObject) << 31) )
                    goto LABEL_36;
                }
                else
                {
                  v22 = v38[v14];
                }
                v23 = *(_QWORD *)&v17->m_posn.x;
                v.z = v17->m_posn.z;
                *(_QWORD *)&v.x = v23;
                m_pMat = v22->m_pMat;
                if ( !m_pMat )
                {
                  CPlaceable::AllocateMatrix(v22);
                  CSimpleTransform::UpdateMatrix(&v22->m_transform, v22->m_pMat);
                  m_pMat = v22->m_pMat;
                }
                operator*(&v36, m_pMat, &v);
                v = v36;
                v25.n64_u64[0] = vsub_f32(*(float32x2_t *)&Coorsa.y, *(float32x2_t *)&v.y).n64_u64[0];
                v26 = vmul_f32(v25, v25).n64_u64[0];
                v27 = sqrtf(
                        (float)((float)((float)(Coorsa.x - v36.x) * (float)(Coorsa.x - v36.x)) + *(float *)&v26)
                      + *((float *)&v26 + 1));
                IsSphereVisible = CCamera::IsSphereVisible(&TheCamera, &v, 2.0);
                v29 = minRadClose;
                if ( IsSphereVisible )
                  v29 = v10;
                v30 = maxRadClose;
                if ( IsSphereVisible )
                  v30 = maxRad;
                if ( v27 > v29 && v27 < v30 )
                {
                  if ( CPopulation::bInPoliceStation
                    && (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) <= 70
                    && (v31 = CStreaming::GetDefaultCopModel(),
                        CPopulation::PedMICanBeCreatedAtThisAttractor(v31, v17->attr.q.m_scriptName)) )
                  {
                    v35 = 1;
                    DefaultCopModel = CStreaming::GetDefaultCopModel();
                    if ( DefaultCopModel >= 1 )
                      goto LABEL_28;
                  }
                  else
                  {
                    DefaultCopModel = CPopulation::ChooseCivilianOccupation(
                                        0,
                                        0,
                                        -1,
                                        -1,
                                        -1,
                                        1,
                                        1,
                                        1,
                                        v17->attr.q.m_scriptName);
                    if ( DefaultCopModel >= 1 )
                    {
LABEL_28:
                      if ( DefaultCopModel != 7
                        && CPopulation::AddPedAtAttractor(DefaultCopModel, v17, v, v38[v14], v35) )
                      {
                        ++v9;
                        if ( v35 == -1 )
                          return v9;
                        --v7;
                        v34 = 0;
                      }
                    }
                  }
                }
              }
            }
          }
        }
LABEL_36:
        v13 = pNum;
        if ( ++v14 >= pNum )
        {
          decisionMaker = v35;
          v12 = v34;
          goto LABEL_38;
        }
      }
    }
  }
  return v9;
}

//----- (004CDEC8) --------------------------------------------------------
float __fastcall CPopulation::FindDummyDistForModel(Int32 ModelIndex)
{
  int *v2; // r2

  if ( MI_SAMSITE == ModelIndex )
    return 750.0;
  v2 = &dword_4CDEFC;
  if ( MI_SAMSITE2 == ModelIndex )
    v2 = &dword_4CDF00;
  return *(float *)v2;
}
// 4CDEFC: using guessed type int dword_4CDEFC;
// 4CDF00: using guessed type int dword_4CDF00;

//----- (004CDF04) --------------------------------------------------------
void __fastcall CPopulation::ManageObject(CObject *pObj, const CVector *vecCentre)
{
  CMatrix *m_pMat; // r0
  float x; // s2
  CSimpleTransform *p_tx; // r1
  float y; // s6
  float z; // s4
  float v9; // s0
  unsigned int m_nModelIndex; // r0
  CDummyObject *m_pRelatedDummy; // r0
  CMatrix *v12; // r1
  float *p_x; // r2
  float v14; // s2
  int v15; // r0
  float v16; // s4
  int *v17; // r3
  float v18; // s0
  int *v19; // r2
  RpClump_0 *m_pRwObject; // r0
  _BOOL4 IsVisible; // r0

  if ( CObject::CanBeDeleted(pObj) )
  {
    m_pMat = pObj->m_pMat;
    x = vecCentre->x;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    y = vecCentre->y;
    z = vecCentre->z;
    if ( !m_pMat )
      p_tx = &pObj->m_transform;
    v9 = sqrtf(
           (float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
                 + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
         + (float)((float)(p_tx->m_translate.z - z) * (float)(p_tx->m_translate.z - z)));
    if ( pObj->ObjectCreatedBy == 3 )
    {
      m_nModelIndex = pObj->m_nModelIndex;
      if ( m_nModelIndex == MI_ROADWORKBARRIER1
        || m_nModelIndex == MI_ROADBLOCKFUCKEDCAR1
        || m_nModelIndex == MI_ROADBLOCKFUCKEDCAR2
        || m_nModelIndex == MI_BEACHBALL )
      {
        if ( v9 <= 120.0 )
          return;
        goto LABEL_10;
      }
      if ( m_nModelIndex >= MI_BEACHTOWEL01 && m_nModelIndex <= MI_BEACHTOWEL04 )
      {
        if ( v9 > 85.5 )
          goto LABEL_10;
        if ( v9 <= 35.0 )
          return;
        IsVisible = CEntity::GetIsOnScreen(pObj);
        goto LABEL_43;
      }
      if ( v9 > 75.5
        || v9 > 25.0 && !CEntity::GetIsOnScreen(pObj)
        || CTimer::m_snTimeInMilliseconds > pObj->m_nEndOfLifeTime )
      {
        goto LABEL_10;
      }
      m_pRwObject = (RpClump_0 *)pObj->m_pRwObject;
      if ( m_pRwObject && m_pRwObject->object.type == 2 && (*((_BYTE *)&pObj->m_nObjectFlags + 2) & 0x40) != 0 )
      {
        if ( !CVisibilityPlugins::GetClumpAlpha(m_pRwObject) )
          goto LABEL_10;
        IsVisible = CEntity::IsVisible(pObj);
LABEL_43:
        if ( IsVisible )
          return;
LABEL_10:
        CWorld::Remove(pObj);
        (*((void (__fastcall **)(CObject *))pObj->_vptr$CPlaceable + 1))(pObj);
      }
    }
    else
    {
      m_pRelatedDummy = pObj->m_pRelatedDummy;
      if ( m_pRelatedDummy )
      {
        v12 = m_pRelatedDummy->m_pMat;
        p_x = &v12->tx;
        if ( !v12 )
          p_x = &m_pRelatedDummy->m_transform.m_translate.x;
        v14 = sqrtf(
                (float)((float)((float)(*p_x - x) * (float)(*p_x - x))
                      + (float)((float)(p_x[1] - y) * (float)(p_x[1] - y)))
              + (float)((float)(p_x[2] - z) * (float)(p_x[2] - z)));
      }
      else
      {
        v14 = 100000.0;
      }
      v15 = pObj->m_nModelIndex;
      if ( MI_SAMSITE == v15 )
      {
        v16 = 750.0;
      }
      else
      {
        v17 = dword_4CE120;
        if ( MI_SAMSITE2 == v15 )
          v17 = &dword_4CE120[1];
        v16 = *(float *)v17;
      }
      if ( v9 > v16 )
      {
        if ( MI_SAMSITE == v15 )
        {
          v18 = 750.0;
        }
        else
        {
          v19 = dword_4CE120;
          if ( MI_SAMSITE2 == v15 )
            v19 = &dword_4CE120[1];
          v18 = *(float *)v19;
        }
        if ( v14 > v18 )
          CPopulation::ConvertToDummyObject(pObj);
      }
    }
  }
}
// 4CE120: using guessed type int dword_4CE120[2];

//----- (004CE158) --------------------------------------------------------
void __fastcall CPopulation::ConvertToDummyObject(CObject *pObject)
{
  CDummyObject *m_pRelatedDummy; // r4
  CBaseModelInfo *v3; // r0
  int v4; // r0
  CVector v5; // [sp+20h] [bp-28h] BYREF
  CVector Coors; // [sp+30h] [bp-18h] BYREF

  m_pRelatedDummy = pObject->m_pRelatedDummy;
  if ( m_pRelatedDummy )
  {
    CEntity::GetBoundCentre(&v5, m_pRelatedDummy);
    Coors = v5;
    CWorld::FindObjectsKindaColliding(
      &Coors,
      CModelInfo::ms_modelInfoPtrs[pObject->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius,
      0,
      (Int16 *)&v5,
      2,
      0,
      0,
      1,
      1,
      0,
      0);
    if ( LOWORD(v5.x) )
      return;
    *(_DWORD *)&m_pRelatedDummy->m_nFlags |= 0x80u;
    CDummyObject::UpdateFromObject(m_pRelatedDummy, pObject);
  }
  if ( (*(_BYTE *)&pObject->m_info & 7) == 4 )
  {
    v3 = CModelInfo::ms_modelInfoPtrs[pObject->m_nModelIndex];
    v4 = (*((int (__fastcall **)(CBaseModelInfo *))v3->_vptr$CBaseModelInfo + 2))(v3);
    if ( v4 )
    {
      if ( (*(_WORD *)(v4 + 40) & 0x7000 | 0x800) == 10240
        && (CModelInfo::ms_modelInfoPtrs[pObject->m_nModelIndex]->m_flags & 0x7800) != 10240 )
      {
        *(_DWORD *)&m_pRelatedDummy->m_nFlags &= ~0x80u;
      }
    }
  }
  CWorld::Remove(pObject);
  (*((void (__fastcall **)(CObject *))pObject->_vptr$CPlaceable + 1))(pObject);
  if ( m_pRelatedDummy )
    CWorld::Add(m_pRelatedDummy);
}

//----- (004CE240) --------------------------------------------------------
void __fastcall CPopulation::ManageDummy(CDummy *pDummy, const CVector *vecCentre)
{
  int m_areaCode; // r2
  CMatrix *m_pMat; // r2
  float x; // s0
  float y; // s2
  float z; // s4
  CSimpleTransform *p_tx; // r1
  float v8; // s8
  float v9; // s0
  float v10; // s10
  int m_nModelIndex; // r1
  float v12; // s0
  float v13; // s2
  int *v14; // r3

  m_areaCode = pDummy->m_areaCode;
  if ( (m_areaCode == 13 || CGame::currArea == m_areaCode) && (*(_BYTE *)&pDummy->m_nFlags & 0x80) != 0 )
  {
    m_pMat = pDummy->m_pMat;
    x = vecCentre->x;
    y = vecCentre->y;
    z = vecCentre->z;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pDummy->m_transform;
    v8 = p_tx->m_translate.y;
    v9 = p_tx->m_translate.x - x;
    v10 = p_tx->m_translate.z;
    m_nModelIndex = pDummy->m_nModelIndex;
    v12 = sqrtf(
            (float)((float)(v9 * v9) + (float)((float)(v8 - y) * (float)(v8 - y)))
          + (float)((float)(v10 - z) * (float)(v10 - z)));
    if ( MI_SAMSITE == m_nModelIndex )
    {
      v13 = 750.0;
    }
    else
    {
      v14 = dword_4CE2F0;
      if ( MI_SAMSITE2 == m_nModelIndex )
        v14 = &dword_4CE2F0[1];
      v13 = *(float *)v14;
    }
    if ( v12 < v13 )
      CPopulation::ConvertToRealObject((CDummyObject *)pDummy);
  }
}
// 4CE2F0: using guessed type int dword_4CE2F0[2];

//----- (004CE2F8) --------------------------------------------------------
void __fastcall CPopulation::ConvertToRealObject(CDummyObject *pDummyObject)
{
  CObject *Object; // r4
  CBaseModelInfo *v3; // r0
  int v4; // r0
  CPhysical::CPhysicalFlags m_nPhysicalFlags; // r0

  if ( CPopulation::TestSafeForRealObject(pDummyObject) )
  {
    Object = CDummyObject::CreateObject(pDummyObject);
    if ( Object )
    {
      CWorld::Remove(pDummyObject);
      *(_DWORD *)&pDummyObject->m_nFlags &= ~0x80u;
      CEntity::ResolveReferences(pDummyObject);
      CObject::SetRelatedDummy(Object, pDummyObject);
      CWorld::Add(Object);
      if ( (*(_BYTE *)&Object->m_info & 7) == 4
        && (v3 = CModelInfo::ms_modelInfoPtrs[Object->m_nModelIndex],
            (v4 = (*((int (__fastcall **)(CBaseModelInfo *))v3->_vptr$CBaseModelInfo + 2))(v3)) != 0)
        && (*(_WORD *)(v4 + 40) & 0x7000 | 0x800) == 10240
        && (CModelInfo::ms_modelInfoPtrs[Object->m_nModelIndex]->m_flags & 0x7800) != 10240 )
      {
        *(_DWORD *)&Object->m_nFlags &= ~0x80u;
      }
      else if ( Object->m_nModelIndex == MI_BUOY || (*((_BYTE *)&Object->m_nPhysicalFlags + 3) & 2) != 0 )
      {
        (*((void (__fastcall **)(CObject *, _DWORD))Object->_vptr$CPlaceable + 5))(Object, 0);
        Object->m_vecMoveSpeed.x = 0.0;
        Object->m_vecMoveSpeed.y = 0.0;
        m_nPhysicalFlags = Object->m_nPhysicalFlags;
        Object->m_vecMoveSpeed.z = -0.001;
        Object->m_nPhysicalFlags = (CPhysical::CPhysicalFlags)(*(_DWORD *)&m_nPhysicalFlags | 0x8000000);
        sub_18BF70(Object);
      }
    }
  }
}

//----- (004CE3DC) --------------------------------------------------------
void __fastcall CPopulation::ManagePed(CPed *pPed, const CVector *vecCentre)
{
  CEntity *m_pAttachToEntity; // r0
  signed int v5; // r6
  int v6; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float v9; // s0
  float v10; // s16
  float v11; // s18
  _BOOL4 v12; // r0
  int v13; // r2
  int Mode; // r6
  bool v15; // zf
  int v16; // r2
  int v17; // r3

  if ( !CPed::IsPlayer(pPed) )
  {
    if ( CPed::CanBeDeleted(pPed) )
    {
      if ( !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
      {
        m_pAttachToEntity = pPed->m_pAttachToEntity;
        if ( !m_pAttachToEntity || (*(_BYTE *)&m_pAttachToEntity->m_info & 7) != 2 )
        {
          if ( pPed->m_nPedState == PED_DEAD )
          {
            if ( (v5 = CTimer::m_snTimeInMilliseconds - pPed->m_nTimeOfDeath, v5 > 30000)
              || (v6 = CDarkel::FrenzyOnGoing(), v5 >= 15001) && v6
              || v5 > 8000 && CGangWars::GangWarFightingGoingOn() )
            {
              *((_DWORD *)&pPed->m_nPedFlags + 1) |= 8u;
            }
          }
          if ( (*((_BYTE *)&pPed->m_nPedFlags + 4) & 8) != 0
            && !CVisibilityPlugins::GetClumpAlpha((RpClump_0 *)pPed->m_pRwObject) )
          {
            goto LABEL_50;
          }
          m_pMat = pPed->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &pPed->m_transform;
          v9 = pPed->fRemoveRangeMultiplier
             * sqrtf(
                 (float)((float)(p_tx->m_translate.x - vecCentre->x) * (float)(p_tx->m_translate.x - vecCentre->x))
               + (float)((float)(p_tx->m_translate.y - vecCentre->y) * (float)(p_tx->m_translate.y - vecCentre->y)));
          if ( (unsigned int)(pPed->m_nPedType - 7) > 9 )
          {
            if ( (*((_BYTE *)&pPed->m_nPedFlags + 6) & 0x40) != 0 )
            {
              v10 = 0.0;
              if ( !pPed->m_pMyAccidentVehicle )
                v10 = v9;
            }
            else
            {
              v10 = v9;
            }
          }
          else
          {
            v10 = v9 + -30.0;
          }
          if ( TheCamera.GenerationDistMultiplier > 0.0001 )
          {
            v11 = TheCamera.GenerationDistMultiplier * 105.0;
            if ( v10 > (float)(v11 * CPopulation::PedCreationDistMultiplier())
              || (*((_BYTE *)&pPed->m_nPedFlags + 4) & 0x40) == 0
              && v10 > (float)((float)(CPopulation::PedCreationDistMultiplier() * 75.5)
                             * TheCamera.GenerationDistMultiplier) )
            {
              goto LABEL_47;
            }
            if ( v10 > (float)(CPopulation::PedCreationDistMultiplier() * 25.0) )
            {
              v12 = CEntity::GetIsOnScreen(pPed);
              v13 = 0;
              if ( !v12 && CTimer::m_snTimeInMilliseconds > pPed->DontUseSmallerRemovalRange )
              {
                Mode = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
                v13 = 0;
                if ( Mode != 7 )
                {
                  v15 = Mode == 39;
                  if ( Mode != 39 )
                    v15 = Mode == 46;
                  if ( !v15 )
                  {
                    if ( TheCamera.Cams[TheCamera.ActiveCam].LookingLeft )
                    {
                      v13 = 0;
                      goto LABEL_46;
                    }
                    v13 = 0;
                    if ( !TheCamera.Cams[TheCamera.ActiveCam].LookingRight
                      && !TheCamera.Cams[TheCamera.ActiveCam].LookingBehind )
                    {
                      v13 = 1;
                    }
                  }
                }
              }
              if ( v12 )
              {
                v17 = 4000;
                if ( pPed->m_nPedType == 6 )
                  v17 = 10000;
                pPed->DontUseSmallerRemovalRange = v17 + CTimer::m_snTimeInMilliseconds;
              }
LABEL_46:
              if ( v13 != 1 )
                return;
LABEL_47:
              if ( CEntity::GetIsOnScreen(pPed) )
              {
                *((_DWORD *)&pPed->m_nPedFlags + 1) |= 8u;
                return;
              }
LABEL_50:
              CWorld::Remove(pPed);
              (*((void (__fastcall **)(CPed *))pPed->_vptr$CPlaceable + 1))(pPed);
              return;
            }
            v16 = 4000;
            if ( pPed->m_nPedType == 6 )
              v16 = 10000;
            pPed->DontUseSmallerRemovalRange = CTimer::m_snTimeInMilliseconds + v16;
          }
        }
      }
    }
  }
}
// 4CE5C8: conditional instruction was optimized away because r0.4==0

//----- (004CE6A0) --------------------------------------------------------
void __fastcall CPopulation::RemovePed(CPed *pPed)
{
  CWorld::Remove(pPed);
  if ( pPed )
    (*((void (__fastcall **)(CPed *))pPed->_vptr$CPlaceable + 1))(pPed);
}

//----- (004CE6BC) --------------------------------------------------------
void CPopulation::ManageAllPopulation()
{
  const CVector *PlayerCentreOfWorld; // r0
  __int64 v1; // d16
  CEntity *m_pHoldEntity; // r9
  CPlayerPed *PlayerPed; // r0
  CTaskSimpleHoldEntity *TaskHold; // r0
  CTaskSimpleHoldEntity *v5; // r4
  CObjectPool *v6; // r6
  int32 m_nSize; // r0
  int v8; // r5
  int v9; // r4
  CPool<CObject,CCutsceneObject>::StorageType *m_aStorage; // r0
  bool v11; // zf
  CDummyPool *v12; // r4
  int32 v13; // r0
  int v14; // r6
  float x; // s16
  int v16; // r5
  float y; // s18
  float z; // s20
  uint8 *v19; // r0
  int v20; // r2
  bool v21; // zf
  int v22; // r2
  float *v23; // r3
  int v24; // r1
  float v25; // s2
  float v26; // s0
  int *v27; // r1
  CVector v28; // [sp+0h] [bp-50h] BYREF

  PlayerCentreOfWorld = FindPlayerCentreOfWorld(CWorld::PlayerInFocus);
  v1 = *(_QWORD *)&PlayerCentreOfWorld->x;
  m_pHoldEntity = 0;
  v28.z = PlayerCentreOfWorld->z;
  *(_QWORD *)&v28.x = v1;
  PlayerPed = FindPlayerPed(0);
  TaskHold = CPedIntelligence::GetTaskHold(PlayerPed->m_pPedIntelligence, 0);
  v5 = TaskHold;
  if ( TaskHold )
  {
    m_pHoldEntity = 0;
    if ( (*((int (__fastcall **)(CTaskSimpleHoldEntity *))TaskHold->_vptr$CTask + 5))(TaskHold) == 307
      && (*(_BYTE *)&v5->m_pHoldEntity->m_info & 7) == 4 )
    {
      m_pHoldEntity = v5->m_pHoldEntity;
    }
  }
  v6 = CPools::ms_pObjectPool;
  m_nSize = CPools::ms_pObjectPool->m_nSize;
  if ( m_nSize )
  {
    v8 = m_nSize - 1;
    v9 = 420 * m_nSize - 420;
    do
    {
      if ( (v6->m_aFlags[v8] & 0x80u) == 0 )
      {
        m_aStorage = v6->m_aStorage;
        v11 = &(*v6->m_aStorage)[v9] == 0;
        if ( &(*v6->m_aStorage)[v9] )
          v11 = (char *)m_pHoldEntity - (char *)m_aStorage == v9;
        if ( !v11 )
          CPopulation::ManageObject((CObject *)&(*m_aStorage)[v9], &v28);
      }
      --v8;
      v9 -= 420;
    }
    while ( v8 != -1 );
  }
  v12 = CPools::ms_pDummyPool;
  v13 = CPools::ms_pDummyPool->m_nSize;
  if ( v13 )
  {
    v14 = v13 - 1;
    x = v28.x;
    v16 = 60 * v13 - 22;
    y = v28.y;
    z = v28.z;
    do
    {
      if ( (v12->m_aFlags[v14] & 0x80u) == 0 )
      {
        v19 = &(*v12->m_aStorage)[v16];
        if ( v19 != (_BYTE *)&dword_24 + 2 )
        {
          v20 = v19[13];
          v21 = v20 == 13;
          if ( v20 != 13 )
            v21 = CGame::currArea == v20;
          if ( v21 && (*(v19 - 10) & 0x80) != 0 )
          {
            v22 = *(_DWORD *)(v19 - 18);
            v23 = (float *)(v22 + 48);
            if ( !v22 )
              v23 = (float *)(v19 - 34);
            v24 = *(__int16 *)&(*v12->m_aStorage)[v16];
            v25 = 750.0;
            v26 = sqrtf(
                    (float)((float)((float)(*v23 - x) * (float)(*v23 - x))
                          + (float)((float)(v23[1] - y) * (float)(v23[1] - y)))
                  + (float)((float)(v23[2] - z) * (float)(v23[2] - z)));
            if ( MI_SAMSITE != v24 )
            {
              v11 = MI_SAMSITE2 == v24;
              v27 = dword_4CE870;
              if ( v11 )
                v27 = &dword_4CE870[1];
              v25 = *(float *)v27;
            }
            if ( v26 < v25 )
              CPopulation::ConvertToRealObject((CDummyObject *)(v19 - 38));
          }
        }
      }
      --v14;
      v16 -= 60;
    }
    while ( v14 != -1 );
  }
}
// 24: using guessed type int dword_24;
// 4CE870: using guessed type int dword_4CE870[2];

//----- (004CE878) --------------------------------------------------------
Int32 CPopulation::FindNumberOfPedsWeCanPlaceOnBenches()
{
  float32x2_t v0; // d9
  float32x2_t v1; // d10
  float v2; // s16
  float v3; // s0
  int v4; // r1

  v2 = CPopulation::PedDensityMultiplier;
  v0.n64_f32[0] = CPopCycle::m_NumOther_Peds;
  v1.n64_f32[0] = (float)CPopulation::MaxNumberOfPedsInUse;
  v3 = 1.0;
  if ( CCullZones::FewerPeds() )
    v3 = 0.6;
  v4 = (int)(float)((float)(v2 * v3) * (float)(int)vmin_f32(v0, v1).n64_f32[0]);
  if ( CGame::currArea )
    v4 = CPopulation::NumberOfPedsInUseInterior;
  return 2 - CPopulation::ms_nNumCivMale - CPopulation::ms_nNumCivFemale + v4;
}
// 4CE8B8: variable 'v0' is possibly undefined
// 4CE8B8: variable 'v1' is possibly undefined
// 675EF0: using guessed type int *CPopulation::ms_nNumCivFemale;
// 677D74: using guessed type int *CPopulation::ms_nNumCivMale;

//----- (004CE92C) --------------------------------------------------------
float CPopulation::FindPedMultiplierMotorway()
{
  return 1.0;
}

//----- (004CE934) --------------------------------------------------------
float CPopulation::FindPedDensityMultiplierCullZone()
{
  float v0; // s0

  v0 = 1.0;
  if ( CCullZones::FewerPeds() )
    return 0.6;
  return v0;
}

//----- (004CE958) --------------------------------------------------------
void CPopulation::RemoveAllRandomPeds()
{
  CPedPool *v0; // r8
  int32 m_nSize; // r0
  int v2; // r5
  int v3; // r6
  CPool<CPed,CCopPed>::StorageType *m_aStorage; // r4
  CEntity *v5; // r9

  v0 = CPools::ms_pPedPool;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize )
  {
    v2 = m_nSize - 1;
    v3 = 1996 * m_nSize - 1996;
    do
    {
      if ( (v0->m_aFlags[v2] & 0x80u) == 0 )
      {
        m_aStorage = v0->m_aStorage;
        v5 = (CEntity *)&(*v0->m_aStorage)[v3];
        if ( v5 )
        {
          if ( CPed::CanBeDeleted((CPed *)&(*v0->m_aStorage)[v3]) )
          {
            CWorld::Remove(v5);
            (*(void (__fastcall **)(CEntity *))(*(_DWORD *)&(*m_aStorage)[v3] + 4))(v5);
          }
        }
      }
      --v2;
      v3 -= 1996;
    }
    while ( v2 != -1 );
  }
}

//----- (004CE9BC) --------------------------------------------------------
void CPopulation::ConvertAllObjectsToDummyObjects()
{
  CObjectPool *v0; // r0
  int32 m_nSize; // r1
  int v2; // r5
  int i; // r4
  CPool<CObject,CCutsceneObject>::StorageType *m_aStorage; // r1
  uint8 *v5; // r0

  v0 = CPools::ms_pObjectPool;
  m_nSize = CPools::ms_pObjectPool->m_nSize;
  if ( m_nSize )
  {
    v2 = m_nSize - 1;
    for ( i = 420 * m_nSize - 100; ; i -= 420 )
    {
      if ( (v0->m_aFlags[v2] & 0x80u) == 0 )
      {
        m_aStorage = v0->m_aStorage;
        v5 = &(*v0->m_aStorage)[i];
        if ( v5 != (uint8 *)&elf_hash_bucket[17] && (*m_aStorage)[i] == 1 )
          CPopulation::ConvertToDummyObject((CObject *)(v5 - 320));
      }
      if ( !v2 )
        break;
      --v2;
      v0 = CPools::ms_pObjectPool;
    }
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004CEA20) --------------------------------------------------------
bool __fastcall CPopulation::TestSafeForRealObject(CDummyObject *pDummy)
{
  CMatrix *m_pMat; // r2
  CColModel *m_pColModel; // r3
  CSimpleTransform *p_m_transform; // r0
  float x; // s18
  float y; // s20
  float m_fRadius; // s22
  float v8; // s28
  float v9; // r4
  float v10; // r5
  float v11; // r0
  int v12; // r2
  int v13; // s0
  char v14; // r0
  int v15; // s4
  int v16; // r4
  int v17; // r1
  int v18; // r5
  int v19; // r2
  bool v20; // r6
  int v21; // r10
  CPtrNode *m_pHead; // r9
  CPtrNode v23; // kr00_8
  CMatrix *v24; // r5
  const CMatrix *v25; // r4
  CColModel *ColModel; // r0
  int v29; // [sp+10h] [bp-88h]
  int v30; // [sp+14h] [bp-84h]
  int v31; // [sp+18h] [bp-80h]
  int v32; // [sp+20h] [bp-78h]
  int v33; // [sp+24h] [bp-74h]
  CSimpleTransform *v34; // [sp+28h] [bp-70h]
  CColModel *colModelA; // [sp+30h] [bp-68h]
  CVector centre; // [sp+34h] [bp-64h] BYREF

  m_pMat = pDummy->m_pMat;
  m_pColModel = CModelInfo::ms_modelInfoPtrs[pDummy->m_nModelIndex]->m_pColModel;
  p_m_transform = &pDummy->m_transform;
  v34 = p_m_transform;
  if ( m_pMat )
    p_m_transform = (CSimpleTransform *)&m_pMat->tx;
  x = p_m_transform->m_translate.x;
  y = p_m_transform->m_translate.y;
  m_fRadius = m_pColModel->m_sphereBound.m_fRadius;
  colModelA = m_pColModel;
  CEntity::GetBoundCentre(pDummy, &centre);
  v8 = floorf((float)((float)(x - m_fRadius) / 50.0) + 60.0);
  v9 = floorf((float)((float)(y - m_fRadius) / 50.0) + 60.0);
  v10 = floorf((float)((float)(x + m_fRadius) / 50.0) + 60.0);
  v11 = floorf((float)((float)(y + m_fRadius) / 50.0) + 60.0);
  v12 = 120;
  v13 = (int)v11;
  v14 = `guard variable for'CPopulation::TestSafeForRealObject(CDummyObject *)::aTempColPoints;
  v15 = (int)v9;
  v16 = v13;
  v17 = (int)v10;
  v18 = v15;
  if ( v13 >= 120 )
    v16 = 120;
  if ( v17 < 120 )
    v12 = v17;
  v33 = v12;
  v19 = 0;
  if ( v15 <= 0 )
    v18 = 0;
  if ( (int)v8 > 0 )
    v19 = (int)v8;
  v31 = v19;
  __dmb(0xBu);
  if ( (v14 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CPopulation::TestSafeForRealObject(CDummyObject *)::aTempColPoints) )
  {
    _cxa_guard_release((__guard *)&`guard variable for'CPopulation::TestSafeForRealObject(CDummyObject *)::aTempColPoints);
  }
  if ( v18 <= v16 )
  {
    v29 = v16;
    do
    {
      v30 = v18;
      if ( v31 <= v33 )
      {
        v21 = v31;
        v32 = (unsigned __int8)(16 * v18);
        do
        {
          m_pHead = CWorld::ms_aRepeatSectors[v21 & 0xF | v32].m_ptrListArray[0].m_pHead;
          while ( m_pHead )
          {
            v23 = *m_pHead;
            m_pHead = m_pHead->m_pNext;
            if ( *((unsigned __int16 *)v23.m_pVoid + 24) != CWorld::ms_nCurrentScanCode
              && CEntity::GetIsTouching((const CEntity *)v23.m_pVoid, &centre, m_fRadius) )
            {
              *((_WORD *)v23.m_pVoid + 24) = CWorld::ms_nCurrentScanCode;
              v24 = pDummy->m_pMat;
              if ( !v24 )
              {
                CPlaceable::AllocateMatrix(pDummy);
                CSimpleTransform::UpdateMatrix(v34, pDummy->m_pMat);
                v24 = pDummy->m_pMat;
              }
              v25 = (const CMatrix *)*((_DWORD *)v23.m_pVoid + 5);
              if ( !v25 )
              {
                CPlaceable::AllocateMatrix((CPlaceable *)v23.m_pVoid);
                CSimpleTransform::UpdateMatrix(
                  (const CSimpleTransform *)((char *)v23.m_pVoid + 4),
                  *((CMatrix **)v23.m_pVoid + 5));
                v25 = (const CMatrix *)*((_DWORD *)v23.m_pVoid + 5);
              }
              ColModel = CEntity::GetColModel((CEntity *)v23.m_pVoid);
              v20 = 0;
              if ( CCollision::ProcessColModels(
                     v24,
                     colModelA,
                     v25,
                     ColModel,
                     CPopulation::TestSafeForRealObject(CDummyObject *)::aTempColPoints,
                     0,
                     0,
                     0) > 0 )
                return v20;
            }
          }
        }
        while ( v21++ < v33 );
      }
      v18 = v30 + 1;
    }
    while ( v30 < v29 );
  }
  return 1;
}
// 9F5138: using guessed type char `guard variable for'CPopulation::TestSafeForRealObject(CDummyObject *)::aTempColPoints;

//----- (004CEC60) --------------------------------------------------------
bool __fastcall CPopulation::TestRoomForDummyObject(CObject *pObject)
{
  int m_nModelIndex; // r1
  bool v3; // r4
  CVector v5; // [sp+20h] [bp-28h] BYREF
  CVector Coors; // [sp+30h] [bp-18h] BYREF

  CEntity::GetBoundCentre(&v5, pObject->m_pRelatedDummy);
  Coors = v5;
  m_nModelIndex = pObject->m_nModelIndex;
  v3 = 0;
  CWorld::FindObjectsKindaColliding(
    &Coors,
    CModelInfo::ms_modelInfoPtrs[m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius,
    0,
    (Int16 *)&v5,
    2,
    0,
    0,
    1,
    1,
    0,
    0);
  if ( !LOWORD(v5.x) )
    return 1;
  return v3;
}

//----- (004CECC4) --------------------------------------------------------
int32 CPopulation::ChoosePolicePedOccupation()
{
  return 0;
}

//----- (004CECC8) --------------------------------------------------------
void __fastcall CPopulation::ChooseCivilianCoupleOccupations(Int32 *iPedMaleOccupation, Int32 *iPedFemaleOccupation)
{
  bool v4; // r5
  _BOOL4 v5; // r6
  int32 v6; // r0
  int v7; // r0
  int v8; // r0

  if ( CWeather::WeatherRegion == 2 )
  {
    if ( (rand() & 0x10) != 0 )
    {
      v5 = ((unsigned int)rand() >> 5) & 1;
      v4 = v5;
    }
    else
    {
      v4 = 1;
      LOBYTE(v5) = 0;
    }
  }
  else
  {
    LOBYTE(v5) = 0;
    v4 = 1;
  }
  v6 = CPopulation::ChooseCivilianOccupation(v4, v5, -1, -1, -1, 0, 1, 0, 0);
  *iPedMaleOccupation = v6;
  if ( v6 < 0 )
  {
    v7 = *iPedFemaleOccupation;
    if ( *iPedFemaleOccupation <= -1 )
      goto LABEL_14;
  }
  else
  {
    v7 = CPopulation::ChooseCivilianOccupation(
           v5,
           v4,
           -1,
           v6,
           *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[v6][1].m_modelName[4],
           0,
           1,
           0,
           0);
    *iPedFemaleOccupation = v7;
    if ( v7 <= -1 )
      goto LABEL_14;
  }
  v8 = *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[v7][1].m_modelName[4];
  if ( *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[*iPedMaleOccupation][1].m_modelName[4] != 40 )
  {
    if ( v8 != 40 )
      return;
    goto LABEL_14;
  }
  if ( v8 != 40 )
  {
LABEL_14:
    *iPedFemaleOccupation = -1;
    *iPedMaleOccupation = -1;
  }
}

//----- (004CEDAC) --------------------------------------------------------
void __fastcall CPopulation::PlaceGangMembers(
        const ePedType eGangPedType,
        const int iNoOfGangMembers,
        const CVector *vCentrePos)
{
  CPedGroupPlacer v3; // [sp+4h] [bp-Ch] BYREF

  CPedGroupPlacer::PlaceGroup(&v3, eGangPedType, iNoOfGangMembers, vCentrePos, 5u);
}

//----- (004CEDC8) --------------------------------------------------------
void __fastcall CPopulation::PlaceCouple(
        const ePedType malePedType,
        const Int32 iMaleOccupation,
        const ePedType femalePedType,
        const Int32 iFemaleOccupation,
        const CVector vManPos)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d11
  bool v10; // zf
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  float32x2_t *p_tx; // r2
  float32x2_t v14; // d16
  float GroundZFor3DCoord; // r0
  RwReal v16; // s18
  CPed *v17; // r0
  CPed *v18; // r5
  CPed *v19; // r0
  CPed *v20; // r6
  float WalkAnimSpeed; // s18
  float v22; // r0
  CPedIntelligence *v23; // r10
  CTaskComplexBeInCouple *v24; // r8
  CPedIntelligence *v25; // r10
  CTaskComplexBeInCouple *v26; // r8
  CPedIntelligence *m_pPedIntelligence; // r10
  CTaskComplexBeInCouple *v28; // r8
  CMatrix *v29; // r0
  float *p_x; // r2
  float x; // s20
  float v32; // s18
  float v33; // r0
  CMatrix *v34; // r0
  unsigned __int32 v35; // s0
  unsigned __int32 *p_tz; // r0
  bool v37; // zf
  bool v38; // zf
  bool v39; // zf
  CEntity *pKindaCollidingObjects; // [sp+10h] [bp-70h] BYREF
  CPed *v41; // [sp+14h] [bp-6Ch]
  CPed *v42; // [sp+18h] [bp-68h]
  bool v43; // [sp+1Fh] [bp-61h] BYREF
  CVector vecPosition; // [sp+20h] [bp-60h] BYREF
  bool pBool; // [sp+2Fh] [bp-51h] BYREF
  CVector posn; // [sp+30h] [bp-50h] BYREF

  v10 = malePedType == PEDTYPE_CIVMALE;
  posn = vManPos;
  if ( malePedType == PEDTYPE_CIVMALE )
    v10 = femalePedType == PEDTYPE_CIVFEMALE;
  if ( v10 && !CGameLogic::LaRiotsActiveHere() )
  {
    if ( !CCamera::IsSphereVisible(&TheCamera, &posn, 1.5) )
      goto LABEL_17;
    PlayerPed = FindPlayerPed(-1);
    m_pMat = PlayerPed->m_pMat;
    p_tx = (float32x2_t *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (float32x2_t *)&PlayerPed->m_transform;
    v14.n64_u64[0] = vsub_f32(*(float32x2_t *)&posn.x, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
    v5.n64_u64[0] = vmul_f32(v14, v14).n64_u64[0];
    if ( sqrtf(v5.n64_f32[0] + v5.n64_f32[1]) >= (float)(CPopulation::PedCreationDistMultiplier() * 42.5) )
    {
LABEL_17:
      if ( CPedPlacement::IsPositionClearForPed(
             &posn,
             CModelInfo::ms_modelInfoPtrs[iMaleOccupation]->m_pColModel->m_sphereBound.m_fRadius,
             -1,
             0,
             1,
             1,
             1) == 1 )
      {
        GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(posn.x, posn.y, posn.z + 1.0, &pBool, 0);
        if ( pBool )
        {
          if ( CModelInfo::ms_modelInfoPtrs[iMaleOccupation]->m_pRwObject )
          {
            v6.n64_u32[0] = LODWORD(posn.z);
            v5.n64_f32[0] = GroundZFor3DCoord + 1.0;
            LODWORD(v16) = vmax_f32(v6, v5).n64_u32[0];
            vecPosition.z = v16;
            vecPosition.x = posn.x;
            vecPosition.y = posn.y;
            v17 = CPopulation::AddPed(PEDTYPE_CIVMALE, iMaleOccupation, &vecPosition, 1);
            v18 = v17;
            if ( v17 )
            {
              CVisibilityPlugins::SetClumpAlpha((RpClump_0 *)v17->m_pRwObject, 0);
              if ( CModelInfo::ms_modelInfoPtrs[iFemaleOccupation]->m_pRwObject )
              {
                vecPosition.z = v16;
                vecPosition.x = posn.x;
                vecPosition.y = posn.y;
                v19 = CPopulation::AddPed(PEDTYPE_CIVFEMALE, iFemaleOccupation, &vecPosition, 1);
                v20 = v19;
                if ( v19 )
                {
                  WalkAnimSpeed = CPed::GetWalkAnimSpeed(v19);
                  v22 = CPed::GetWalkAnimSpeed(v18);
                  if ( WalkAnimSpeed >= 0.75 && fabsf(WalkAnimSpeed - v22) <= 0.45 )
                  {
                    if ( WalkAnimSpeed <= v22 )
                    {
                      m_pPedIntelligence = v20->m_pPedIntelligence;
                      v28 = (CTaskComplexBeInCouple *)CTask::operator new(0x20u);
                      CTaskComplexBeInCouple::CTaskComplexBeInCouple(v28, v18, 0, 1u, 1u, 10.0);
                      CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, v28, 3, 0);
                      v25 = v18->m_pPedIntelligence;
                      v26 = (CTaskComplexBeInCouple *)CTask::operator new(0x20u);
                      CTaskComplexBeInCouple::CTaskComplexBeInCouple(v26, v20, 1u, 1u, 1u, 10.0);
                    }
                    else
                    {
                      v23 = v18->m_pPedIntelligence;
                      v24 = (CTaskComplexBeInCouple *)CTask::operator new(0x20u);
                      CTaskComplexBeInCouple::CTaskComplexBeInCouple(v24, v20, 0, 1u, 1u, 10.0);
                      CTaskManager::SetTask(&v23->m_taskManager, v24, 3, 0);
                      v25 = v20->m_pPedIntelligence;
                      v26 = (CTaskComplexBeInCouple *)CTask::operator new(0x20u);
                      CTaskComplexBeInCouple::CTaskComplexBeInCouple(v26, v18, 1u, 1u, 1u, 10.0);
                    }
                    CTaskManager::SetTask(&v25->m_taskManager, v26, 3, 0);
                    v29 = v18->m_pMat;
                    p_x = &v29->tx;
                    if ( !v29 )
                      p_x = &v18->m_transform.m_translate.x;
                    v7.n64_f32[0] = p_x[2] + 0.0;
                    v32 = CTaskComplexFollowLeaderInFormation::ms_offsets.m_offsets[4].y + p_x[1];
                    vecPosition.x = CTaskComplexFollowLeaderInFormation::ms_offsets.m_offsets[4].x + *p_x;
                    x = vecPosition.x;
                    vecPosition.y = v32;
                    LODWORD(vecPosition.z) = v7.n64_u32[0];
                    v33 = CWorld::FindGroundZFor3DCoord(vecPosition.x, v32, v7.n64_f32[0] + 1.0, &v43, 0);
                    if ( !v43 )
                      goto LABEL_40;
                    v5.n64_f32[0] = v33;
                    v34 = v20->m_pMat;
                    v5.n64_f32[0] = v5.n64_f32[0] + 1.0;
                    v35 = vmax_f32(v7, v5).n64_u32[0];
                    if ( v34 )
                    {
                      v34->tx = x;
                      v20->m_pMat->ty = v32;
                      p_tz = (unsigned __int32 *)&v20->m_pMat->tz;
                    }
                    else
                    {
                      p_tz = (unsigned __int32 *)&v20->m_transform.m_translate.z;
                      v20->m_transform.m_translate.x = x;
                      v20->m_transform.m_translate.y = v32;
                    }
                    *p_tz = v35;
                    pKindaCollidingObjects = 0;
                    v41 = 0;
                    v42 = 0;
                    CPedPlacement::IsPositionClearForPed(
                      &vecPosition,
                      CModelInfo::ms_modelInfoPtrs[iFemaleOccupation]->m_pColModel->m_sphereBound.m_fRadius,
                      3,
                      &pKindaCollidingObjects,
                      1,
                      1,
                      1);
                    v37 = pKindaCollidingObjects == v20;
                    if ( pKindaCollidingObjects != v20 )
                      v37 = pKindaCollidingObjects == 0;
                    if ( !v37 && pKindaCollidingObjects != v18 )
                      goto LABEL_40;
                    if ( v41 != v20 )
                    {
                      v38 = v41 == 0;
                      if ( v41 )
                        v38 = v41 == v18;
                      if ( !v38 )
                        goto LABEL_40;
                    }
                    v39 = v42 == v20;
                    if ( v42 != v20 )
                      v39 = v42 == 0;
                    if ( v39 || v42 == v18 )
                    {
                      CVisibilityPlugins::SetClumpAlpha((RpClump_0 *)v20->m_pRwObject, 0);
                    }
                    else
                    {
LABEL_40:
                      CWorld::Remove(v18);
                      (*((void (__fastcall **)(CPed *))v18->_vptr$CPlaceable + 1))(v18);
                      CWorld::Remove(v20);
                      (*((void (__fastcall **)(CPed *))v20->_vptr$CPlaceable + 1))(v20);
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
// 4CEED0: variable 'v6' is possibly undefined
// 4CEED0: variable 'v5' is possibly undefined
// 4CF08C: variable 'v7' is possibly undefined

//----- (004CF15C) --------------------------------------------------------
bool __fastcall CPopulation::IsSkateable(const CVector *vPos)
{
  bool v1; // r4
  float z; // s6
  RwReal v3; // s2
  CVector vecStart; // [sp+1Ch] [bp-44h] BYREF
  CEntity *refEntityPtr; // [sp+28h] [bp-38h] BYREF
  CColPoint colPoint; // [sp+2Ch] [bp-34h] BYREF

  v1 = 0;
  refEntityPtr = 0;
  z = vPos->z;
  v3 = vPos->x + 0.0;
  vecStart.y = vPos->y + 0.0;
  vecStart.x = v3;
  vecStart.z = z + 2.0;
  CWorld::ProcessVerticalLine(&vecStart, z + -2.0, &colPoint, &refEntityPtr, 1, 0, 0, 0, 0, 0, 0);
  if ( refEntityPtr )
    return SurfaceInfos_c::IsSkateable(&g_surfaceInfos, colPoint.m_dataB.m_nSurfaceType) != 0;
  return v1;
}

//----- (004CF1E0) --------------------------------------------------------
bool __fastcall CPopulation::IsSunbather(const Int32 iModelID)
{
  int v1; // r1

  v1 = *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[iModelID][1].m_modelName[4];
  return v1 == 38 || v1 == 39;
}

//----- (004CF204) --------------------------------------------------------
float __fastcall CPopulation::FindDistanceToNearestPedOfType(ePedType PedType, CVector TestCoors)
{
  int32 m_nSize; // lr
  float v3; // s2
  float z; // s6
  int v5; // r3
  int i; // r3
  uint8 *v7; // r4
  int v8; // r5
  float *v9; // r6
  float v10; // s8

  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( !m_nSize )
    return 10000000.0;
  v3 = 10000000.0;
  z = TestCoors.z;
  do
  {
    v5 = 1996 * m_nSize--;
    for ( i = v5 - 1996; ; i -= 1996 )
    {
      if ( (CPools::ms_pPedPool->m_aFlags[m_nSize] & 0x80u) == 0 )
      {
        v7 = &(*CPools::ms_pPedPool->m_aStorage)[i];
        if ( v7 )
        {
          if ( *((_DWORD *)v7 + 359) == PedType )
          {
            v8 = *((_DWORD *)v7 + 5);
            v9 = (float *)(v8 + 48);
            if ( !v8 )
              v9 = (float *)(v7 + 4);
            v10 = sqrtf(
                    (float)((float)((float)(TestCoors.x - *v9) * (float)(TestCoors.x - *v9))
                          + (float)((float)(TestCoors.y - v9[1]) * (float)(TestCoors.y - v9[1])))
                  + (float)((float)(z - v9[2]) * (float)(z - v9[2])));
            if ( v10 < v3 )
              break;
          }
        }
      }
      if ( --m_nSize == -1 )
        return v3;
    }
    v3 = v10;
  }
  while ( m_nSize );
  return v10;
}

//----- (004CF2DC) --------------------------------------------------------
CPed *__fastcall CPopulation::AddPed(
        ePedType PedType,
        UInt32 PedOcc,
        const CVector *vecPosition,
        bool bGiveDefaultTask)
{
  int v4; // s0
  _BOOL4 v6; // r8
  char *v9; // r10
  eWeaponType ThirdWeapon; // r5
  int v11; // s0
  __int32 v12; // r0
  unsigned int v13; // r0
  CEmergencyPed *v14; // r0
  uint32 v15; // r1
  eWeaponType *p_FirstWeapon; // r0
  CWeaponInfo *WeaponInfo; // r0
  __int64 v18; // kr00_8
  int v19; // r3
  RwReal z; // r0
  RwReal *v21; // r1
  CMatrix *v22; // r0
  float tx; // s16
  float ty; // s18
  float tz; // s20
  float *v26; // r0
  float v27; // s2
  float v28; // s4
  int v29; // r6
  char *v30; // r5
  int v31; // r4
  CTaskSimpleStandStill *v32; // r5
  CTaskManager *v33; // r0
  CTaskComplexWander *WanderTaskByPedType; // r1
  CPlayerPed *PlayerPed; // r0
  int32 m_nSize; // r2
  CPed *v37; // r1
  int v38; // r3
  int v39; // r3
  bool v40; // zf
  uint8 *v41; // r5
  int v42; // r3
  int v43; // r8
  char *v44; // r4
  uint8 *v45; // r3
  float v46; // s2
  float32x2_t v47; // d16
  float v48; // s4
  int v49; // r4
  float32x2_t v50; // d17
  int v51; // r3
  float v52; // s2
  float32x2_t v53; // d16
  unsigned __int64 v54; // d2
  float v55; // s2
  CEventSexyPed v57; // [sp+4h] [bp-44h] BYREF

  v6 = bGiveDefaultTask;
  v9 = 0;
  switch ( PedType )
  {
    case PEDTYPE_CIVMALE:
    case PEDTYPE_CIVFEMALE:
      v9 = (char *)CPed::operator new(0x7A4u);
      CCivilianPed::CCivilianPed((CCivilianPed *)v9, PedType, PedOcc);
      if ( (CCheat::m_aCheatsActive[23] | CCheat::m_aCheatsActive[21]) << 24 )
      {
        v13 = rand() % 5 - 1;
        if ( v13 > 3 )
          ThirdWeapon = WEAPONTYPE_PISTOL;
        else
          ThirdWeapon = dword_4CF78C[v13];
        goto LABEL_25;
      }
      goto LABEL_26;
    case PEDTYPE_COP:
      v9 = (char *)CPed::operator new(0x7CCu);
      CCopPed::CCopPed((CCopPed *)v9, (eCopType)PedOcc);
      goto LABEL_26;
    case PEDTYPE_GANG1:
    case PEDTYPE_GANG2:
    case PEDTYPE_GANG3:
    case PEDTYPE_GANG4:
    case PEDTYPE_GANG5:
    case PEDTYPE_GANG6:
    case PEDTYPE_GANG7:
    case PEDTYPE_GANG8:
    case PEDTYPE_GANG9:
    case PEDTYPE_GANG10:
      v9 = (char *)CPed::operator new(0x7A4u);
      CCivilianPed::CCivilianPed((CCivilianPed *)v9, PedType, PedOcc);
      if ( PedType == PEDTYPE_GANG7 && CCheat::m_aCheatsActive[52] )
      {
        ThirdWeapon = WEAPONTYPE_KATANA;
        goto LABEL_25;
      }
      v4 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0);
      if ( v4 > 32 )
        goto LABEL_26;
      v11 = (unsigned __int16)rand();
      v12 = PedType - 7;
      ThirdWeapon = CGangs::Gang[PedType - 7].ThirdWeapon;
      v4 = (int)(float)((float)((float)v11 * 0.000015259) * 100.0);
      if ( ThirdWeapon == WEAPONTYPE_UNARMED )
      {
        ThirdWeapon = CGangs::Gang[v12].SecondWeapon;
        if ( ThirdWeapon && v4 > 49 )
          goto LABEL_25;
        goto LABEL_23;
      }
      if ( v4 <= 32 )
      {
LABEL_23:
        p_FirstWeapon = &CGangs::Gang[v12].FirstWeapon;
        goto LABEL_24;
      }
      if ( v4 > 65 )
        goto LABEL_25;
      p_FirstWeapon = &CGangs::Gang[v12].SecondWeapon;
LABEL_24:
      ThirdWeapon = *p_FirstWeapon;
      if ( *p_FirstWeapon == WEAPONTYPE_UNARMED )
        goto LABEL_26;
LABEL_25:
      CPed::GiveDelayedWeapon((CPed *)v9, ThirdWeapon, 0x61A9u);
      WeaponInfo = CWeaponInfo::GetWeaponInfo(ThirdWeapon, 1);
      CPed::SetCurrentWeapon((CPed *)v9, WeaponInfo->m_nWeaponSlot);
LABEL_26:
      v18 = *(_QWORD *)&vecPosition->x;
      v19 = *((_DWORD *)v9 + 5);
      z = vecPosition->z;
      if ( v19 )
      {
        *(_DWORD *)(v19 + 48) = v18;
        *(_DWORD *)(*((_DWORD *)v9 + 5) + 52) = HIDWORD(v18);
        v21 = (RwReal *)(*((_DWORD *)v9 + 5) + 56);
      }
      else
      {
        *(_QWORD *)(v9 + 4) = v18;
        v21 = (RwReal *)(v9 + 12);
      }
      *v21 = z;
      v22 = (CMatrix *)*((_DWORD *)v9 + 5);
      if ( v22 )
      {
        tx = v22->tx;
        ty = v22->ty;
        tz = v22->tz;
        CMatrix::SetRotate(v22, 0.0, 0.0, 0.0);
        v26 = (float *)*((_DWORD *)v9 + 5);
        *(float *)&v4 = tx + v26[12];
        v27 = ty + v26[13];
        v28 = tz + v26[14];
        v26[12] = *(float *)&v4;
        v26[13] = v27;
        v26[14] = v28;
      }
      else
      {
        *((_DWORD *)v9 + 4) = 0;
      }
      CWorld::Add((CEntity *)v9);
      if ( v6 )
      {
        v29 = *((_DWORD *)v9 + 272);
        if ( *((_DWORD *)v9 + 359) == 6 )
        {
          v30 = (char *)CTask::operator new(0x50u);
          v4 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 8.0);
          CTaskComplexWander::CTaskComplexWander((CTaskComplexWander *)v30, 4, v4, 1, 0.5);
          *((_QWORD *)v30 + 7) = 0LL;
          *((_QWORD *)v30 + 8) = 0LL;
          *(_DWORD *)(v30 + 50) = 0;
          *(_DWORD *)(v30 + 46) = 0;
          *(_DWORD *)v30 = &off_66C5D8;
          *(_DWORD *)(v30 + 74) = 0;
          *(_DWORD *)(v30 + 70) = 0;
          *((_DWORD *)v30 + 10) = 0;
          *((_DWORD *)v30 + 11) = 0;
          CTaskManager::SetTask((CTaskManager *)(v29 + 4), (CTask *)v30, 3, 0);
          v31 = *((_DWORD *)v9 + 272);
          v32 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
          CTaskSimpleStandStill::CTaskSimpleStandStill(v32, 0, 1, 0, 8.0);
          v33 = (CTaskManager *)(v31 + 4);
          WanderTaskByPedType = (CTaskComplexWander *)v32;
        }
        else
        {
          WanderTaskByPedType = CTaskComplexWander::GetWanderTaskByPedType((const CPed *)v9);
          v33 = (CTaskManager *)(v29 + 4);
        }
        CTaskManager::SetTask(v33, WanderTaskByPedType, 4, 0);
        if ( PedType == PEDTYPE_PROSTITUTE && CCheat::m_aCheatsActive[53] )
        {
          PlayerPed = FindPlayerPed(-1);
          CEventSexyPed::CEventSexyPed(&v57, PlayerPed);
          v57.m_iTaskType = 1212;
          CEventGroup::Add((CEventGroup *)(*((_DWORD *)v9 + 272) + 104), (CEvent *)&v57, 0);
          v4 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 4.0);
          CPed::GiveDelayedWeapon((CPed *)v9, (eWeaponType)(v4 + 10), 0);
          CPed::SetCurrentWeapon((CPed *)v9, (eWeaponType)(v4 + 10));
          CEventSexyPed::~CEventSexyPed(&v57);
        }
        if ( CCheat::m_aCheatsActive[21] )
        {
          m_nSize = CPools::ms_pPedPool->m_nSize;
          if ( m_nSize )
          {
            v37 = 0;
            do
            {
              v38 = 1996 * m_nSize--;
              v39 = v38 - 1996;
              while ( 1 )
              {
                if ( (CPools::ms_pPedPool->m_aFlags[m_nSize] & 0x80u) == 0 )
                {
                  v41 = &(*CPools::ms_pPedPool->m_aStorage)[v39];
                  v40 = v41 == 0;
                  if ( v41 )
                    v40 = (char *)CPools::ms_pPedPool->m_aStorage - v9 + v39 == 0;
                  if ( !v40 )
                    break;
                }
                --m_nSize;
                v39 -= 1996;
                if ( m_nSize == -1 )
                  goto LABEL_61;
              }
              v42 = *((_DWORD *)v9 + 5);
              v43 = *((_DWORD *)v41 + 5);
              v44 = (char *)(v42 + 48);
              if ( !v42 )
                v44 = v9 + 4;
              v45 = (uint8 *)(v43 + 48);
              v46 = *(float *)v44;
              if ( !v43 )
                v45 = v41 + 4;
              v47.n64_u64[0] = *(unsigned __int64 *)(v44 + 4);
              v48 = *(float *)v45;
              v49 = 0;
              v50.n64_u64[0] = *(unsigned __int64 *)(v45 + 4);
              v51 = 0;
              v52 = v46 - v48;
              v53.n64_u64[0] = vsub_f32(v47, v50).n64_u64[0];
              v54 = vmul_f32(v53, v53).n64_u64[0];
              v55 = (float)((float)(v52 * v52) + *(float *)&v54) + *((float *)&v54 + 1);
              if ( v55 < *(float *)&v4 )
                v51 = 1;
              if ( !v37 )
                v49 = 1;
              if ( v51 | v49 )
              {
                *(float *)&v4 = v55;
                v37 = (CPed *)v41;
              }
            }
            while ( m_nSize );
LABEL_61:
            if ( v37 )
            {
              CEventAcquaintancePed::CEventAcquaintancePed((CEventAcquaintancePed *)&v57, v37);
              v57.m_iTaskType = 1000;
              v57._vptr$CEvent = (int (**)(void))&off_665394;
              CEventGroup::Add((CEventGroup *)(*((_DWORD *)v9 + 272) + 104), (CEvent *)&v57, 0);
              CEventAcquaintancePed::~CEventAcquaintancePed((CEventAcquaintancePed *)&v57);
            }
          }
        }
      }
      return (CPed *)v9;
    case PEDTYPE_DEALER:
    case PEDTYPE_CRIMINAL:
    case PEDTYPE_PROSTITUTE:
    case PEDTYPE_SPECIAL:
    case PEDTYPE_MISSION1:
    case PEDTYPE_MISSION2:
    case PEDTYPE_MISSION3:
    case PEDTYPE_MISSION4:
    case PEDTYPE_MISSION5:
    case PEDTYPE_MISSION6:
    case PEDTYPE_MISSION7:
    case PEDTYPE_MISSION8:
      v9 = (char *)CPed::operator new(0x7A4u);
      CCivilianPed::CCivilianPed((CCivilianPed *)v9, PedType, PedOcc);
      goto LABEL_26;
    case PEDTYPE_MEDIC:
      v14 = (CEmergencyPed *)CPed::operator new(0x7A4u);
      v9 = (char *)v14;
      v15 = 18;
      goto LABEL_17;
    case PEDTYPE_FIRE:
      v14 = (CEmergencyPed *)CPed::operator new(0x7A4u);
      v9 = (char *)v14;
      v15 = 19;
LABEL_17:
      CEmergencyPed::CEmergencyPed(v14, v15, PedOcc);
      goto LABEL_26;
    default:
      goto LABEL_26;
  }
}
// 4CF710: variable 'v4' is possibly undefined
// 4CF78C: using guessed type int dword_4CF78C[4];
// 665394: using guessed type void *off_665394;
// 66C5D8: using guessed type void *off_66C5D8;

//----- (004CF7B4) --------------------------------------------------------
CPed *__fastcall CPopulation::AddDeadPedInFrontOfCar(const CVector *vPedPos, CVehicle *pVehicle)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  float32x2_t *p_tx; // r2
  float32x2_t v9; // d16
  CPed *v10; // r4
  float GroundZFor3DCoord; // r0
  CPed *v12; // r10
  CTaskComplexDie *v13; // r5
  int v14; // r0
  CMatrix *v15; // r4
  CColModel *ColModel; // r0
  bool v17; // zf
  bool v18; // zf
  bool v19; // zf
  CColPoint vecPosition[32]; // [sp+18h] [bp-5D8h] BYREF
  CEntity *pKindaCollidingObjects; // [sp+598h] [bp-58h] BYREF
  CVehicle *v23; // [sp+59Ch] [bp-54h]
  CEntity *pCollidingObjects[3]; // [sp+5A0h] [bp-50h] BYREF
  bool pBool; // [sp+5C3h] [bp-2Dh] BYREF

  if ( CCamera::IsSphereVisible(&TheCamera, vPedPos, 2.0) )
  {
    PlayerPed = FindPlayerPed(-1);
    m_pMat = PlayerPed->m_pMat;
    p_tx = (float32x2_t *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (float32x2_t *)&PlayerPed->m_transform;
    v9.n64_u64[0] = vsub_f32(*(float32x2_t *)&vPedPos->x, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
    v2.n64_u64[0] = vmul_f32(v9, v9).n64_u64[0];
    if ( sqrtf(v2.n64_f32[0] + v2.n64_f32[1]) < (float)(CPopulation::PedCreationDistMultiplier() * 42.5) )
      return 0;
  }
  v10 = 0;
  GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(vPedPos->x, vPedPos->y, vPedPos->z + 1.0, &pBool, 0);
  if ( pBool )
  {
    v10 = 0;
    if ( CModelInfo::ms_modelInfoPtrs[7]->m_pRwObject )
    {
      v3.n64_u32[0] = LODWORD(vPedPos->z);
      v2.n64_f32[0] = GroundZFor3DCoord + 1.0;
      *(_QWORD *)&vecPosition[0].m_vecPosition.x = *(_QWORD *)&vPedPos->x;
      LODWORD(vecPosition[0].m_vecPosition.z) = vmax_f32(v3, v2).n64_u32[0];
      v12 = CPopulation::AddPed(PEDTYPE_CIVMALE, 7u, &vecPosition[0].m_vecPosition, 0);
      v13 = (CTaskComplexDie *)CTask::operator new(0x28u);
      CTaskComplexDie::CTaskComplexDie(v13, WEAPONTYPE_UNARMED, ANIM_STD_PED, ANIM_STD_KO_FRONT, 4.0, 0.0, 0, 0, 0, 0);
      CEventScriptCommand::CEventScriptCommand((CEventScriptCommand *)&pCollidingObjects[2], 4, v13, 0);
      CEventGroup::Add(&v12->m_pPedIntelligence->m_eventGroup, (CEvent *)&pCollidingObjects[2], 0);
      v12->m_MoneyCarried = 0;
      v14 = *((_DWORD *)&v12->m_nPedFlags + 1);
      v12->m_pMyAccidentVehicle = pVehicle;
      *((_DWORD *)&v12->m_nPedFlags + 1) = v14 | 0x400000;
      CEntity::RegisterReference(pVehicle, &v12->m_pMyAccidentVehicle);
      pKindaCollidingObjects = 0;
      v23 = 0;
      pCollidingObjects[0] = 0;
      if ( CPedPlacement::IsPositionClearForPed(vPedPos, 2.0, 3, &pKindaCollidingObjects, 1, 1, 1) )
        goto LABEL_9;
      v17 = pKindaCollidingObjects == v12;
      if ( pKindaCollidingObjects != v12 )
        v17 = pKindaCollidingObjects == 0;
      if ( !v17 && pKindaCollidingObjects != pVehicle )
        goto LABEL_24;
      if ( v23 != (CVehicle *)v12 )
      {
        v18 = v23 == 0;
        if ( v23 )
          v18 = v23 == pVehicle;
        if ( !v18 )
          goto LABEL_24;
      }
      v19 = pCollidingObjects[0] == v12;
      if ( pCollidingObjects[0] != v12 )
        v19 = pCollidingObjects[0] == 0;
      if ( v19 || pCollidingObjects[0] == pVehicle )
      {
LABEL_9:
        v15 = pVehicle->m_pMat;
        ColModel = CEntity::GetColModel(pVehicle);
        if ( !CCollision::ProcessColModels(
                v15,
                ColModel,
                v12->m_pMat,
                CModelInfo::ms_modelInfoPtrs[v12->m_nModelIndex]->m_pColModel,
                vecPosition,
                0,
                0,
                0) )
        {
          CVisibilityPlugins::SetClumpAlpha((RpClump_0 *)v12->m_pRwObject, 0);
          v10 = v12;
          goto LABEL_28;
        }
        CWorld::Remove(v12);
      }
      else
      {
LABEL_24:
        CWorld::Remove(v12);
        if ( !v12 )
        {
LABEL_26:
          v10 = 0;
LABEL_28:
          CEventScriptCommand::~CEventScriptCommand((CEventScriptCommand *)&pCollidingObjects[2]);
          return v10;
        }
      }
      (*((void (__fastcall **)(CPed *))v12->_vptr$CPlaceable + 1))(v12);
      goto LABEL_26;
    }
  }
  return v10;
}
// 4CF884: variable 'v3' is possibly undefined
// 4CF884: variable 'v2' is possibly undefined

//----- (004CF9D0) --------------------------------------------------------
bool8 __fastcall CPopulation::ArePedStatsCompatible(int32 pedStat1, int32 pedStat2)
{
  bool v2; // zf
  bool8 result; // r0
  bool v5; // zf
  bool v6; // zf
  bool v7; // zf
  bool v8; // zf
  bool v9; // zf
  bool v10; // zf
  bool v11; // zf
  bool v12; // zf
  bool v13; // zf
  bool v14; // zf
  bool v15; // zf
  bool v16; // zf
  bool v17; // zf
  bool v18; // zf
  bool v19; // zf
  bool v20; // zf
  bool v21; // cf
  bool v22; // cf
  bool v23; // zf

  v2 = pedStat2 == 42;
  result = 0;
  if ( pedStat2 != 42 )
    v2 = pedStat1 == 42;
  if ( !v2 )
  {
    v5 = pedStat2 == 41;
    if ( pedStat2 != 41 )
      v5 = pedStat1 == 41;
    if ( !v5 )
    {
      v6 = pedStat2 == 40;
      if ( pedStat2 != 40 )
        v6 = pedStat1 == 40;
      if ( !v6 )
      {
        v7 = pedStat2 == 39;
        if ( pedStat2 != 39 )
          v7 = pedStat1 == 39;
        if ( !v7 )
        {
          v8 = pedStat2 == 38;
          if ( pedStat2 != 38 )
            v8 = pedStat1 == 38;
          if ( !v8 )
          {
            v9 = pedStat2 == 37;
            if ( pedStat2 != 37 )
              v9 = pedStat1 == 37;
            if ( !v9 )
            {
              v10 = pedStat2 == 36;
              if ( pedStat2 != 36 )
                v10 = pedStat1 == 36;
              if ( !v10 )
              {
                v11 = pedStat2 == 35;
                if ( pedStat2 != 35 )
                  v11 = pedStat1 == 35;
                if ( !v11 )
                {
                  v12 = pedStat2 == 34;
                  if ( pedStat2 != 34 )
                    v12 = pedStat1 == 34;
                  if ( !v12 )
                  {
                    v13 = pedStat2 == 33;
                    if ( pedStat2 != 33 )
                      v13 = pedStat1 == 33;
                    if ( !v13 )
                    {
                      v14 = pedStat2 == 32;
                      if ( pedStat2 != 32 )
                        v14 = pedStat1 == 32;
                      if ( !v14 )
                      {
                        v15 = pedStat2 == 31;
                        if ( pedStat2 != 31 )
                          v15 = pedStat1 == 31;
                        if ( !v15 )
                        {
                          v16 = pedStat2 == 30;
                          if ( pedStat2 != 30 )
                            v16 = pedStat1 == 30;
                          if ( !v16 )
                          {
                            v17 = pedStat2 == 29;
                            if ( pedStat2 != 29 )
                              v17 = pedStat1 == 29;
                            if ( !v17 )
                            {
                              v18 = pedStat2 == 28;
                              if ( pedStat2 != 28 )
                                v18 = pedStat1 == 28;
                              if ( !v18 )
                              {
                                v19 = pedStat2 == 27;
                                if ( pedStat2 != 27 )
                                  v19 = pedStat1 == 27;
                                if ( !v19 )
                                {
                                  v20 = pedStat2 == 26;
                                  if ( pedStat2 != 26 )
                                    v20 = pedStat1 == 26;
                                  if ( !v20 )
                                  {
                                    v21 = (unsigned int)pedStat1 >= 4;
                                    if ( (unsigned int)pedStat1 >= 4 )
                                      v21 = (unsigned int)pedStat2 >= 4;
                                    if ( v21 )
                                    {
                                      result = 0;
                                      v22 = (unsigned int)(pedStat1 - 4) >= 7;
                                      if ( (unsigned int)(pedStat1 - 4) >= 7 )
                                        v22 = (unsigned int)(pedStat2 - 4) >= 7;
                                      if ( v22 )
                                      {
                                        v23 = pedStat1 == 24;
                                        if ( pedStat1 != 24 )
                                          v23 = pedStat1 == 18;
                                        if ( v23 )
                                        {
                                          result = 1;
                                          if ( pedStat2 != 18 && pedStat2 != 24 )
                                            return 0;
                                        }
                                        else
                                        {
                                          return 1;
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  return result;
}

//----- (004CFA90) --------------------------------------------------------
bool __fastcall CPopulation::PedMICanBeCreatedAtAttractor(Int32 MI)
{
  return (unsigned int)(*(_DWORD *)CModelInfo::ms_modelInfoPtrs[MI][1].m_modelName - 17) > 5;
}

//----- (004CFAB0) --------------------------------------------------------
bool __fastcall CPopulation::PedMICanBeCreatedAtThisAttractor(Int32 MI, unsigned __int8 *pBrain)
{
  int v4; // r6
  bool result; // r0

  if ( !pBrain )
    return 1;
  v4 = *(_DWORD *)CModelInfo::ms_modelInfoPtrs[MI][1].m_modelName;
  if ( !strcasecmp((const char *)pBrain, "COPSIT")
    || !strcasecmp((const char *)pBrain, "COPLOOK")
    || !strcasecmp((const char *)pBrain, "BROWSE") )
  {
    return v4 == 6;
  }
  if ( v4 == 6 )
    return 0;
  if ( !strcasecmp((const char *)pBrain, "DANCER") )
  {
    result = 1;
    switch ( MI )
    {
      case 12:
      case 20:
      case 22:
      case 40:
      case 46:
      case 56:
      case 58:
      case 59:
      case 60:
      case 91:
      case 93:
      case 98:
      case 101:
        return result;
      default:
        return 0;
    }
  }
  else if ( !strcasecmp((const char *)pBrain, "BARGUY")
         || !strcasecmp((const char *)pBrain, "PEDROUL")
         || !strcasecmp((const char *)pBrain, "PEDCARD")
         || !strcasecmp((const char *)pBrain, "PEDSLOT") )
  {
    result = 0;
    switch ( MI )
    {
      case 27:
      case 35:
      case 50:
      case 69:
      case 71:
      case 72:
      case 73:
      case 77:
      case 134:
      case 135:
      case 136:
      case 137:
      case 142:
      case 153:
      case 170:
      case 218:
      case 225:
      case 226:
      case 229:
      case 230:
      case 232:
      case 233:
      case 236:
      case 239:
        return result;
      default:
        return 1;
    }
  }
  else if ( !strcasecmp((const char *)pBrain, "STRIPW") )
  {
    result = 1;
    if ( ((unsigned int)(MI - 244) > 0xD || ((1 << (MI + 12)) & 0x3005) == 0) && MI != 87 )
      return 0;
  }
  else
  {
    return (strcasecmp((const char *)pBrain, "STRIPM") | v4 ^ 5) != 0;
  }
  return result;
}

//----- (004CFE20) --------------------------------------------------------
bool __fastcall CPopulation::PedMICanBeCreatedInInterior(Int32 MI)
{
  return (unsigned int)(*(_DWORD *)CModelInfo::ms_modelInfoPtrs[MI][1].m_modelName - 6) > 0x10;
}

//----- (004CFE3C) --------------------------------------------------------
int32 __fastcall CPopulation::ChooseCivilianOccupation(
        int bMustBeMale,
        int bMustBeFemale,
        Int32 MustHaveAnimGroup,
        Int32 AvoidThisOccupation,
        Int32 compatibleWithThisPedStat,
        int bOnlyOnFoots,
        int bTestForUsedOccupations,
        int bAtAttractor,
        unsigned __int8 *pAttractorScriptName)
{
  int v10; // r3
  int v11; // r10
  int v12; // r0
  int v13; // r6
  Int32 v14; // r5
  _BOOL4 IsAcceptableInCurrentZone; // r0
  bool v16; // zf
  eVisibleArea v17; // r11
  int v19; // [sp+24h] [bp-44h]

  v10 = 3;
  v11 = 0;
  if ( CPopulation::NumberOfPedsInUseInterior > 20 )
    v10 = 5;
  if ( CGame::currArea == AREA_MAIN_MAP )
    v10 = 3;
  if ( !bTestForUsedOccupations )
    v10 = 7;
  v19 = v10;
LABEL_8:
  v12 = 0;
  while ( 1 )
  {
    v13 = v12;
    v14 = CStreaming::ms_pedsLoaded[v12];
    if ( v14 >= 0
      && CStreaming::ms_aInfoForModel[v14].m_status == 1
      && v14 != AvoidThisOccupation
      && v11 == CModelInfo::ms_modelInfoPtrs[v14]->m_numRefs )
    {
      IsAcceptableInCurrentZone = CPopCycle::PedIsAcceptableInCurrentZone(v14);
      v16 = !IsAcceptableInCurrentZone;
      v17 = CGame::currArea;
      if ( !IsAcceptableInCurrentZone )
        v16 = CGame::currArea == AREA_MAIN_MAP;
      if ( !v16
        && (bOnlyOnFoots != 1 || (CModelInfo::ms_modelInfoPtrs[v14][1].m_modelName[9] & 0x10) != 0)
        && (bMustBeMale != 1 || *(_DWORD *)CModelInfo::ms_modelInfoPtrs[v14][1].m_modelName == 4)
        && (bMustBeFemale != 1 || *(_DWORD *)CModelInfo::ms_modelInfoPtrs[v14][1].m_modelName == 5)
        && (MustHaveAnimGroup < 0 || CModelInfo::ms_modelInfoPtrs[v14][1].m_hashKey == MustHaveAnimGroup)
        && (bAtAttractor != 1
         || (unsigned int)(*(_DWORD *)CModelInfo::ms_modelInfoPtrs[v14][1].m_modelName - 17) >= 6
         && CPopulation::PedMICanBeCreatedAtThisAttractor(v14, pAttractorScriptName))
        && (v17 == AREA_MAIN_MAP
         || (unsigned int)(*(_DWORD *)CModelInfo::ms_modelInfoPtrs[v14][1].m_modelName - 6) >= 0x11)
        && (compatibleWithThisPedStat < 0
         || CPopulation::ArePedStatsCompatible(
              *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[v14][1].m_modelName[4],
              compatibleWithThisPedStat))
        && (CWeather::Rain < 0.1 || (*(_DWORD *)&CModelInfo::ms_modelInfoPtrs[v14][1].m_modelName[4] & 0xFFFFFFFE) != 38) )
      {
        return v14;
      }
    }
    v12 = v13 + 1;
    if ( v13 >= 7 )
    {
      if ( ++v11 < v19 )
        goto LABEL_8;
      v14 = 7;
      if ( bTestForUsedOccupations )
        return -1;
      return v14;
    }
  }
}
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];

//----- (004D0058) --------------------------------------------------------
bool __fastcall CPopulation::IsMale(const Int32 iOccupation)
{
  return *(_DWORD *)CModelInfo::ms_modelInfoPtrs[iOccupation][1].m_modelName == 4;
}

//----- (004D0074) --------------------------------------------------------
bool __fastcall CPopulation::IsFemale(const Int32 iOccupation)
{
  return *(_DWORD *)CModelInfo::ms_modelInfoPtrs[iOccupation][1].m_modelName == 5;
}

//----- (004D0090) --------------------------------------------------------
int32 __fastcall CPopulation::ChooseCivilianOccupationForVehicle(bool bMustBeMale, CVehicle *pVeh)
{
  int v3; // r0
  int v4; // r5
  int v5; // r0
  int v6; // r10
  int32 v7; // r6
  CPed *pDriver; // r0
  __int64 v9; // r0
  bool v10; // cc
  int v12; // [sp+8h] [bp-38h]
  int v13; // [sp+10h] [bp-30h]
  _BOOL4 v14; // [sp+18h] [bp-28h]
  int v15; // [sp+20h] [bp-20h]

  v14 = bMustBeMale;
  v3 = SBYTE1(CModelInfo::ms_modelInfoPtrs[pVeh->m_nModelIndex][1].m_pColModel);
  if ( v3 == -1 )
    return 7;
  v12 = 1 << v3;
  v13 = 0;
  do
  {
    v4 = 0;
    do
    {
      v5 = 0;
      v15 = v4;
      do
      {
        v6 = v5;
        v7 = CStreaming::ms_pedsLoaded[v5];
        if ( v7 >= 0
          && CStreaming::ms_aInfoForModel[v7].m_status == 1
          && (v4 == 4 || v4 == CModelInfo::ms_modelInfoPtrs[v7]->m_numRefs) )
        {
          v4 = v15;
          if ( ((CCheat::m_aCheatsActive[47] | CCheat::m_aCheatsActive[48] | CCheat::m_aCheatsActive[49] | CCheat::m_aCheatsActive[50] | CCheat::m_aCheatsActive[52] | CCheat::m_aCheatsActive[53] | CCheat::m_aCheatsActive[78] | CCheat::m_aCheatsActive[83]) << 24
             || CPopCycle::PedIsAcceptableInCurrentZone(v7)
             && ((unsigned __int16)v12 & *(_WORD *)&CModelInfo::ms_modelInfoPtrs[v7][1].m_modelName[8]) != 0)
            && (!v14 || *(_DWORD *)CModelInfo::ms_modelInfoPtrs[v7][1].m_modelName == 4) )
          {
            if ( v13 == 1 )
              return v7;
            pDriver = pVeh->pDriver;
            if ( pDriver )
              LODWORD(v9) = v7 == pDriver->m_nModelIndex;
            else
              LODWORD(v9) = 0;
            HIDWORD(v9) = pVeh->pPassengers[0];
            if ( HIDWORD(v9) )
              LODWORD(v9) = v9 | (v7 == *(__int16 *)(HIDWORD(v9) + 38));
            HIDWORD(v9) = pVeh->pPassengers[1];
            if ( HIDWORD(v9) )
              LODWORD(v9) = v9 | (v7 == *(__int16 *)(HIDWORD(v9) + 38));
            HIDWORD(v9) = pVeh->pPassengers[2];
            if ( HIDWORD(v9) )
            {
              HIDWORD(v9) = v7 == *(__int16 *)(HIDWORD(v9) + 38);
              if ( !v9 )
                return v7;
            }
            else if ( !(_DWORD)v9 )
            {
              return v7;
            }
          }
        }
        v5 = v6 + 1;
      }
      while ( v6 < 7 );
      v10 = v4++ < 4;
    }
    while ( v10 );
    v7 = 7;
    v10 = v13++ < 1;
  }
  while ( v10 );
  return v7;
}

//----- (004D0244) --------------------------------------------------------
bool __fastcall CPopulation::IsSecurityGuard(const ePedType pedType)
{
  return 0;
}

//----- (004D0248) --------------------------------------------------------
void __fastcall CPopulation::CreateWaitingCoppers(CVector SpawnCoors, float SpawnOrientation)
{
  RwReal x; // r11
  RwReal y; // r9
  float v5; // s18
  eWantedLevel m_WantedLevel; // r2
  int v7; // r4
  int v8; // r10
  int DefaultCopCarModel; // r5
  int i; // r11
  CAutomobile *v11; // r4
  CPathNode *v12; // r0
  int CoorsX; // r1
  int CoorsY; // r2
  float CoorsZ; // s0
  CMatrix *m_pMat; // r0
  float v17; // s0
  float v18; // s2
  float v19; // s4
  const CSimpleTransform *p_m_transform; // r6
  float *p_tz; // r0
  float *p_x; // r1
  CMatrix *v23; // r0
  float v24; // s6
  RwReal v25; // s0
  CMatrix *v26; // r0
  __int64 v27; // d16
  CMatrix *v28; // r0
  float v29; // s0
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  const CMatrix *v32; // r0
  RwMatrix *v33; // r1
  float v34; // s18
  CVector *v35; // r9
  int v36; // r10
  int v37; // r8
  CCopPed *v38; // r6
  RwReal v39; // r1
  CMatrix *v40; // r3
  RwReal z; // r0
  float v42; // s0
  float v43; // s2
  float v44; // s4
  RwReal *p_z; // r1
  float v46; // r1
  CMatrix *v47; // r0
  CPlayerPed *PlayerPed; // r4
  CTaskComplexKillPedOnFoot *v49; // r5
  int v50; // r6
  const CVector *v51; // r11
  float v52; // r9
  float v53; // s28
  float v54; // r0
  float v55; // s26
  float v56; // r0
  CNodeAddress *v57; // [sp+20h] [bp-B8h]
  int v58; // [sp+24h] [bp-B4h]
  float v59; // [sp+28h] [bp-B0h]
  eWantedLevel v60; // [sp+2Ch] [bp-ACh]
  CEventScriptCommand v61; // [sp+30h] [bp-A8h] BYREF
  CVector v62; // [sp+48h] [bp-90h] BYREF
  bool pBool; // [sp+57h] [bp-81h] BYREF
  CEntity *v64; // [sp+58h] [bp-80h] BYREF
  Int16 pNum; // [sp+5Eh] [bp-7Ah] BYREF
  CVector v66; // [sp+60h] [bp-78h] BYREF
  CVector vecStart; // [sp+70h] [bp-68h] BYREF
  CVector cvector; // 0:r2.8,8:^0.4

  x = SpawnCoors.x;
  y = SpawnCoors.y;
  vecStart.x = SpawnCoors.x;
  vecStart.y = SpawnCoors.y;
  v5 = SpawnCoors.z + 1.0;
  vecStart.z = SpawnCoors.z + 1.0;
  m_WantedLevel = FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel;
  v7 = 4;
  v8 = 1;
  switch ( m_WantedLevel )
  {
    case WANTED_LEVEL1:
    case WANTED_LEVEL2:
      break;
    case WANTED_LEVEL3:
      goto LABEL_7;
    case WANTED_LEVEL4:
      v7 = 5;
      v8 = 1;
      goto LABEL_7;
    case WANTED_LEVEL5:
      v7 = 6;
      goto LABEL_6;
    case WANTED_LEVEL6:
      v7 = 7;
LABEL_6:
      v8 = 2;
LABEL_7:
      DefaultCopCarModel = CStreaming::GetDefaultCopCarModel(1u);
      if ( DefaultCopCarModel < 1 )
      {
        m_WantedLevel = v7;
      }
      else
      {
        v58 = v7;
        v59 = SpawnOrientation;
        LOWORD(v61.m_iAccumulatedTime) = -1;
        *(_WORD *)&v61.m_bIsPersistent = -1;
        cvector.z = 0.0;
        *(_QWORD *)&cvector.x = __PAIR64__(LODWORD(v5), LODWORD(y));
        v61._vptr$CEvent = (int (**)(void))CPathFind::FindNthNodeClosestToCoors(
                                             (CNodeAddress *)&ThePaths,
                                             (CPathFind *)LODWORD(x),
                                             cvector,
                                             30.0,
                                             0.0,
                                             0,
                                             3,
                                             0,
                                             1,
                                             &v61.m_iAccumulatedTime,
                                             v57);
        for ( i = 0; i != 3; ++i )
        {
          if ( v8 )
          {
            if ( *((unsigned __int16 *)&v61._vptr$CEvent + 2 * i) != 0xFFFF )
            {
              v11 = (CAutomobile *)CVehicle::operator new(0x99Cu);
              CAutomobile::CAutomobile(v11, DefaultCopCarModel, 1u, 1u);
              v11->m_info = (CEntity::CEntityInfo)(*(_BYTE *)&v11->m_info & 7 | 0x20);
              v12 = &ThePaths.pNodes[(unsigned __int16)*((_DWORD *)&v61._vptr$CEvent + i)][HIWORD(*((_DWORD *)&v61._vptr$CEvent
                                                                                                  + i))];
              CoorsX = v12->CoorsX;
              CoorsY = v12->CoorsY;
              CoorsZ = (float)v12->CoorsZ;
              m_pMat = v11->m_pMat;
              v17 = CoorsZ * 0.125;
              v18 = (float)CoorsY * 0.125;
              v19 = (float)CoorsX * 0.125;
              if ( m_pMat )
              {
                m_pMat->tx = v19;
                p_m_transform = &v11->m_transform;
                v11->m_pMat->ty = v18;
                p_tz = &v11->m_pMat->tz;
              }
              else
              {
                p_tz = &v11->m_transform.m_translate.z;
                p_m_transform = &v11->m_transform;
                v11->m_transform.m_translate.x = v19;
                v11->m_transform.m_translate.y = v18;
              }
              *p_tz = v17;
              p_x = &p_m_transform->m_translate.x;
              v23 = v11->m_pMat;
              if ( v23 )
                p_x = &v23->tx;
              v24 = p_x[1];
              v25 = vecStart.x - *p_x;
              v66.z = 0.0;
              v66.x = v25;
              v66.y = vecStart.y - v24;
              CVector::Normalise(&v66);
              v26 = v11->m_pMat;
              v27 = *(_QWORD *)&v66.x;
              v26->zy = v66.z;
              *(_QWORD *)&v26->xy = v27;
              v28 = v11->m_pMat;
              v29 = -v66.y;
              v28->yx = v66.x;
              v28->zx = 0.0;
              v28->xx = v29;
              CAutomobile::PlaceOnRoadProperly(v11);
              (*((void (__fastcall **)(CAutomobile *, _DWORD))v11->_vptr$CPlaceable + 5))(v11, 0);
              m_pRwObject = v11->m_pRwObject;
              if ( m_pRwObject )
              {
                parent = (char *)m_pRwObject->parent;
                v32 = v11->m_pMat;
                v33 = (RwMatrix *)(parent + 16);
                if ( v32 )
                  CMatrix::UpdateRwMatrix(v32, v33);
                else
                  CSimpleTransform::UpdateRwMatrix(p_m_transform, v33);
              }
              CCarCtrl::JoinCarWithRoadSystem(v11);
              if ( CVehicle::UsesSiren(v11) && (rand() & 1) != 0 )
                *((_DWORD *)&v11->m_nVehicleFlags + 1) |= 0x8000u;
              CWorld::Add(v11);
              --v8;
            }
          }
          else
          {
            v8 = 0;
          }
        }
        m_WantedLevel = v58;
        SpawnOrientation = v59;
      }
      break;
    default:
      m_WantedLevel = WANTED_CLEAN;
      break;
  }
  v34 = SpawnOrientation;
  v35 = &v66;
  v36 = 0;
  v37 = 0;
  do
  {
    if ( m_WantedLevel )
    {
      v60 = m_WantedLevel;
      v50 = rand();
      v51 = v35;
      v52 = (float)((float)((float)v36 * 0.2)
                  + (float)((float)((float)((float)v37 * 0.2) - (float)((float)v36 * 0.2))
                          * (float)((float)rand() * 4.6566e-10)))
          + v34;
      v53 = sinf(v52);
      v54 = v52;
      v35 = (CVector *)v51;
      v55 = (float)((float)((float)v50 * 4.6566e-10) + (float)((float)v50 * 4.6566e-10)) + 8.0;
      v56 = cosf(v54);
      v66.z = vecStart.z;
      v66.x = vecStart.x + (float)(v53 * v55);
      v66.y = vecStart.y + (float)(v55 * v56);
      if ( CWorld::GetIsLineOfSightClear(&vecStart, v51, 1, 1, 0, 1, 0, 0, 0)
        && (CWorld::FindObjectsInRange(v51, 1.0, 1, &pNum, 1, &v64, 0, 1, 1, 0, 0), !pNum)
        && (v66.z = CWorld::FindGroundZFor3DCoord(v66.x, v66.y, v66.z, &pBool, 0) + 1.0, pBool) )
      {
        v38 = (CCopPed *)CPed::operator new(0x7CCu);
        CCopPed::CCopPed(v38, COPTYPE_NORMAL);
        v39 = v66.y;
        v40 = v38->m_pMat;
        z = v66.z;
        v42 = v66.x;
        if ( v40 )
        {
          v40->tx = v66.x;
          v43 = v39;
          v44 = z;
          v38->m_pMat->ty = v39;
          p_z = &v38->m_pMat->tz;
        }
        else
        {
          v38->m_transform.m_translate.x = v66.x;
          v38->m_transform.m_translate.y = v39;
          p_z = &v38->m_transform.m_translate.z;
          v43 = v66.y;
          v44 = v66.z;
        }
        *p_z = z;
        v62.x = vecStart.x - v42;
        v62.y = vecStart.y - v43;
        v62.z = vecStart.z - v44;
        CVector::Normalise(&v62);
        v46 = atan2f(COERCE_FLOAT(LODWORD(v62.x) ^ 0x80000000), v62.y);
        v47 = v38->m_pMat;
        v38->m_fCurrentHeading = v46;
        v38->m_fDesiredHeading = v46;
        if ( v47 )
          CMatrix::SetRotateZOnly(v47, v46);
        else
          v38->m_transform.m_heading = v46;
        CWorld::Add(v38);
        if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL2 )
        {
          CPed::GiveWeapon(v38, WEAPONTYPE_PISTOL, 0x7530u, 1);
          CPed::SetCurrentWeapon(v38, WEAPONTYPE_PISTOL);
        }
        PlayerPed = FindPlayerPed(-1);
        v49 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
        CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v49, PlayerPed, -1, 0, 0, 0, 2);
        *((_BYTE *)v49 + 12) |= 0x30u;
        CEventScriptCommand::CEventScriptCommand(&v61, 3, v49, 0);
        CEventGroup::Add(&v38->m_pPedIntelligence->m_eventGroup, &v61, 0);
        CPedIntelligence::Process(v38->m_pPedIntelligence);
        CEventScriptCommand::~CEventScriptCommand(&v61);
        m_WantedLevel = v60 - 1;
      }
      else
      {
        m_WantedLevel = v60;
      }
    }
    else
    {
      m_WantedLevel = WANTED_CLEAN;
    }
    --v36;
    ++v37;
  }
  while ( v36 != -20 );
}
// 4D030E: variable 'v57' is possibly undefined

//----- (004D0730) --------------------------------------------------------
int32 __fastcall CPopulation::ChooseGangOccupation(int32 gang)
{
  return sub_197FEC(gang);
}

//----- (004D0738) --------------------------------------------------------
CPed *__fastcall CPopulation::AddPedInCar(
        CVehicle *pVehicle,
        _BOOL4 bDriver,
        Int32 CarRating,
        int32 seat_num,
        bool bMustBeMale,
        int bCriminal)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v11; // d16
  int DefaultCabDriverModel; // r4
  int v13; // r8
  int v14; // r0
  int m_nModelIndex; // r0
  int v16; // r5
  CPed *v17; // r4
  int v18; // r6
  CPedFlags *p_m_nPedFlags; // r0
  __int64 m_nPedFlags; // r8
  int v21; // r5
  int32 *p_m_nPedType; // lr
  int32 m_nPedType; // r1
  int v24; // r6
  int v25; // r0
  int v26; // r0
  int v27; // r11
  _BOOL4 IsAcceptableInCurrentZone; // r0
  bool v29; // zf
  int **v30; // r1
  CVehicle *v32; // [sp+0h] [bp-60h]
  int v33; // [sp+8h] [bp-58h]
  CVector v35; // [sp+1Ch] [bp-44h] BYREF
  CVector vecPosition; // [sp+28h] [bp-38h] BYREF

  FindPlayerCoors(&v35, -1);
  m_pMat = pVehicle->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pVehicle->m_transform;
  v11 = *(_QWORD *)&p_tx->m_translate.x;
  vecPosition.z = p_tx->m_translate.z;
  *(_QWORD *)&vecPosition.x = v11;
  DefaultCabDriverModel = 23;
  switch ( pVehicle->m_nModelIndex )
  {
    case 0x199:
      DefaultCabDriverModel = 255;
      goto LABEL_6;
    case 0x1A4:
    case 0x1B6:
      DefaultCabDriverModel = CStreaming::GetDefaultCabDriverModel();
      goto LABEL_5;
    case 0x1A7:
      DefaultCabDriverModel = 264;
      goto LABEL_6;
    case 0x1AC:
      DefaultCabDriverModel = 71;
      goto LABEL_6;
    case 0x1C0:
      DefaultCabDriverModel = 155;
      goto LABEL_6;
    case 0x1CF:
      DefaultCabDriverModel = -1;
      v14 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3.0);
      if ( v14 == 1 )
        DefaultCabDriverModel = 248;
      if ( !v14 )
        DefaultCabDriverModel = 247;
      if ( DefaultCabDriverModel < 0 )
        goto LABEL_18;
      goto LABEL_6;
    case 0x1E1:
LABEL_5:
      if ( DefaultCabDriverModel < 0 )
        goto LABEL_18;
LABEL_6:
      if ( bDriver && CStreaming::ms_aInfoForModel[DefaultCabDriverModel].m_status == 1 )
      {
        v13 = *(_DWORD *)CModelInfo::ms_modelInfoPtrs[DefaultCabDriverModel][1].m_modelName;
        goto LABEL_23;
      }
LABEL_18:
      m_nModelIndex = pVehicle->m_nModelIndex;
      v13 = 6;
      DefaultCabDriverModel = 0;
      if ( m_nModelIndex <= 496 )
      {
        switch ( pVehicle->m_nModelIndex )
        {
          case 0x197:
            v13 = 19;
            DefaultCabDriverModel = CStreaming::GetDefaultFiremanModel();
            goto LABEL_23;
          case 0x198:
          case 0x199:
          case 0x19A:
          case 0x19B:
          case 0x19C:
          case 0x19D:
          case 0x19E:
          case 0x19F:
          case 0x1A1:
          case 0x1A2:
          case 0x1A3:
          case 0x1A4:
          case 0x1A5:
          case 0x1A6:
          case 0x1A7:
          case 0x1A8:
          case 0x1A9:
          case 0x1AA:
          case 0x1AC:
          case 0x1AD:
          case 0x1AF:
            goto LABEL_59;
          case 0x1A0:
            v13 = 18;
            DefaultCabDriverModel = CStreaming::GetDefaultMedicModel();
            goto LABEL_23;
          case 0x1AB:
            v13 = 6;
            DefaultCabDriverModel = 2;
            goto LABEL_23;
          case 0x1AE:
            goto LABEL_23;
          case 0x1B0:
          case 0x1B1:
            v13 = 6;
            DefaultCabDriverModel = 5;
            goto LABEL_23;
          default:
            if ( m_nModelIndex != 490 )
              goto LABEL_59;
            v13 = 6;
            DefaultCabDriverModel = 4;
            break;
        }
        goto LABEL_23;
      }
      if ( m_nModelIndex < 596 )
      {
        if ( m_nModelIndex != 497 )
        {
          if ( m_nModelIndex == 523 )
          {
            v13 = 6;
            DefaultCabDriverModel = 1;
          }
          else
          {
            if ( m_nModelIndex != 570 )
              goto LABEL_59;
            v24 = 0;
            v25 = 3;
            if ( CPopulation::NumberOfPedsInUseInterior > 20 )
              v25 = 5;
            if ( CGame::currArea == AREA_MAIN_MAP )
              v25 = 3;
            v32 = pVehicle;
            v33 = v25;
            do
            {
              v26 = 0;
              do
              {
                v27 = v26;
                DefaultCabDriverModel = CStreaming::ms_pedsLoaded[v26];
                if ( DefaultCabDriverModel >= 0
                  && CStreaming::ms_aInfoForModel[DefaultCabDriverModel].m_status == 1
                  && v24 == CModelInfo::ms_modelInfoPtrs[DefaultCabDriverModel]->m_numRefs )
                {
                  IsAcceptableInCurrentZone = CPopCycle::PedIsAcceptableInCurrentZone(DefaultCabDriverModel);
                  v29 = !IsAcceptableInCurrentZone;
                  if ( !IsAcceptableInCurrentZone )
                    v29 = CGame::currArea == AREA_MAIN_MAP;
                  if ( !v29
                    && (CGame::currArea == AREA_MAIN_MAP
                     || (unsigned int)(*(_DWORD *)CModelInfo::ms_modelInfoPtrs[DefaultCabDriverModel][1].m_modelName - 6) >= 0x11)
                    && (CWeather::Rain < 0.1
                     || (*(_DWORD *)&CModelInfo::ms_modelInfoPtrs[DefaultCabDriverModel][1].m_modelName[4] & 0xFFFFFFFE) != 38) )
                  {
                    goto LABEL_54;
                  }
                }
                v26 = v27 + 1;
              }
              while ( v27 < 7 );
              ++v24;
            }
            while ( v24 < v33 );
            DefaultCabDriverModel = -1;
LABEL_54:
            if ( DefaultCabDriverModel == -1 )
              DefaultCabDriverModel = 7;
            v13 = *(_DWORD *)CModelInfo::ms_modelInfoPtrs[DefaultCabDriverModel][1].m_modelName;
            pVehicle = v32;
          }
        }
LABEL_23:
        if ( DefaultCabDriverModel < 0 )
          DefaultCabDriverModel = 7;
        goto LABEL_25;
      }
      if ( (unsigned int)(m_nModelIndex - 596) < 4 )
        goto LABEL_23;
LABEL_59:
      if ( (unsigned int)(CarRating - 14) > 9 )
      {
        DefaultCabDriverModel = CPopulation::ChooseCivilianOccupationForVehicle(bMustBeMale, pVehicle);
        if ( DefaultCabDriverModel < 0 )
          DefaultCabDriverModel = 7;
        v13 = *(_DWORD *)CModelInfo::ms_modelInfoPtrs[DefaultCabDriverModel][1].m_modelName;
      }
      else
      {
        v13 = CarRating - 7;
        DefaultCabDriverModel = CGangs::ChooseGangPedModel(CarRating - 14);
      }
      if ( DefaultCabDriverModel < 0 )
        DefaultCabDriverModel = 7;
      if ( !CModelInfo::ms_modelInfoPtrs[DefaultCabDriverModel]->m_pRwObject )
      {
        DefaultCabDriverModel = 7;
        v13 = *(_DWORD *)CModelInfo::ms_modelInfoPtrs[7][1].m_modelName;
      }
LABEL_25:
      v16 = 0;
      v17 = CPopulation::AddPed((ePedType)v13, DefaultCabDriverModel, &vecPosition, 0);
      if ( seat_num >= 0 )
        v16 = CCarEnterExit::ComputeTargetDoorToEnterAsPassenger(pVehicle, seat_num);
      CCarEnterExit::SetPedInCarDirect(v17, pVehicle, v16, bDriver);
      if ( bCriminal == 1 )
      {
        v18 = *((_DWORD *)&v17->m_nPedFlags + 2);
        p_m_nPedFlags = &v17->m_nPedFlags;
        m_nPedFlags = (__int64)v17->m_nPedFlags;
        v21 = *((_DWORD *)&v17->m_nPedFlags + 3);
        if ( (v18 & 4) != 0 )
        {
          v18 &= ~4u;
          *(_QWORD *)p_m_nPedFlags = m_nPedFlags;
          *((_DWORD *)&v17->m_nPedFlags + 2) = v18;
          *((_DWORD *)&v17->m_nPedFlags + 3) = v21;
          p_m_nPedType = &v17->m_nPedType;
          m_nPedType = v17->m_nPedType;
          switch ( m_nPedType )
          {
            case 4:
              v30 = &CPopulation::ms_nNumCivMale;
              goto LABEL_79;
            case 5:
              v30 = &CPopulation::ms_nNumCivFemale;
              goto LABEL_79;
            case 6:
              v30 = CPopulation::ms_nNumCop;
              goto LABEL_79;
            case 7:
            case 8:
            case 9:
            case 10:
            case 11:
            case 12:
            case 13:
            case 14:
            case 15:
            case 16:
              --CPopulation::ms_nNumGang[m_nPedType - 7];
              m_nPedFlags = *(_QWORD *)p_m_nPedFlags;
              v21 = *((_DWORD *)&v17->m_nPedFlags + 3);
              v18 = *((_DWORD *)&v17->m_nPedFlags + 2);
              break;
            case 17:
              v30 = (int **)CPopulation::ms_nNumDealers;
              goto LABEL_79;
            case 18:
            case 19:
              v30 = &CPopulation::ms_nNumEmergency;
              goto LABEL_79;
            case 20:
              v30 = &CPopulation::ms_nNumCivMale;
              goto LABEL_79;
            case 22:
              v30 = &CPopulation::ms_nNumCivFemale;
LABEL_79:
              --**v30;
              break;
            default:
              break;
          }
        }
        else
        {
          p_m_nPedType = &v17->m_nPedType;
        }
        *p_m_nPedType = 20;
        if ( (v18 & 4) == 0 )
        {
          *(_QWORD *)p_m_nPedFlags = m_nPedFlags;
          *((_DWORD *)&v17->m_nPedFlags + 2) = v18 | 4;
          *((_DWORD *)&v17->m_nPedFlags + 3) = v21;
          ++CPopulation::ms_nNumCivMale;
        }
      }
      return v17;
    default:
      goto LABEL_18;
  }
}
// 675EF0: using guessed type int *CPopulation::ms_nNumCivFemale;
// 6772D4: using guessed type int CPopulation::ms_nNumDealers[2];
// 677D74: using guessed type int *CPopulation::ms_nNumCivMale;
// 6783EC: using guessed type int *CPopulation::ms_nNumCop[2];
// 6797C8: using guessed type int *CPopulation::ms_nNumEmergency;

//----- (004D0C10) --------------------------------------------------------
Int32 __fastcall CPopulation::FindSpecificDriverModelForCar_ToUse(Int32 CarMI)
{
  int v1; // r1
  Int32 result; // r0
  int v3; // s0
  int v4; // s0

  v1 = CarMI - 409;
  result = 23;
  switch ( v1 )
  {
    case 0:
      result = 255;
      break;
    case 11:
    case 29:
      result = sub_198C58();
      break;
    case 14:
      result = 264;
      break;
    case 19:
      result = 71;
      break;
    case 39:
      result = 155;
      break;
    case 54:
      v3 = (unsigned __int16)rand();
      result = -1;
      v4 = (int)(float)((float)((float)v3 * 0.000015259) * 3.0);
      if ( v4 == 1 )
        result = 248;
      if ( !v4 )
        result = 247;
      break;
    case 72:
      return result;
    default:
      result = -1;
      break;
  }
  return result;
}

//----- (004D0CC8) --------------------------------------------------------
void __fastcall CPopulation::UpdatePedCount(CPed *pPed, UInt8 AddOrSub)
{
  int v2; // r4
  CPedFlags *p_m_nPedFlags; // r3
  int m_nPedFlags; // r2
  int v5; // lr
  int v6; // r12
  int32 m_nPedType; // r0
  int32 v8; // r0
  int **v9; // r0
  int *v10; // r0
  int v11; // r1
  int **v12; // r0

  v2 = *((_DWORD *)&pPed->m_nPedFlags + 2);
  p_m_nPedFlags = &pPed->m_nPedFlags;
  m_nPedFlags = (int)pPed->m_nPedFlags;
  v5 = *((_DWORD *)&pPed->m_nPedFlags + 1);
  v6 = *((_DWORD *)&pPed->m_nPedFlags + 3);
  if ( AddOrSub )
  {
    if ( (v2 & 4) != 0 )
    {
      *(_DWORD *)p_m_nPedFlags = m_nPedFlags;
      *((_DWORD *)&pPed->m_nPedFlags + 1) = v5;
      *((_DWORD *)&pPed->m_nPedFlags + 2) = v2 & 0xFFFFFFFB;
      *((_DWORD *)&pPed->m_nPedFlags + 3) = v6;
      m_nPedType = pPed->m_nPedType;
      switch ( m_nPedType )
      {
        case 4:
          v9 = &CPopulation::ms_nNumCivMale;
          goto LABEL_15;
        case 5:
          v9 = &CPopulation::ms_nNumCivFemale;
          goto LABEL_15;
        case 6:
          v9 = CPopulation::ms_nNumCop;
          goto LABEL_15;
        case 7:
        case 8:
        case 9:
        case 10:
        case 11:
        case 12:
        case 13:
        case 14:
        case 15:
        case 16:
          --CPopulation::ms_nNumGang[m_nPedType - 7];
          return;
        case 17:
          v9 = (int **)CPopulation::ms_nNumDealers;
          goto LABEL_15;
        case 18:
        case 19:
          v9 = &CPopulation::ms_nNumEmergency;
          goto LABEL_15;
        case 20:
          v9 = &CPopulation::ms_nNumCivMale;
          goto LABEL_15;
        case 21:
          return;
        case 22:
          v9 = &CPopulation::ms_nNumCivFemale;
LABEL_15:
          v10 = *v9;
          v11 = *v10 - 1;
          break;
      }
LABEL_24:
      *v10 = v11;
    }
  }
  else if ( (v2 & 4) == 0 )
  {
    *(_DWORD *)p_m_nPedFlags = m_nPedFlags;
    *((_DWORD *)&pPed->m_nPedFlags + 1) = v5;
    *((_DWORD *)&pPed->m_nPedFlags + 2) = v2 | 4;
    *((_DWORD *)&pPed->m_nPedFlags + 3) = v6;
    v8 = pPed->m_nPedType;
    switch ( v8 )
    {
      case 4:
        v12 = &CPopulation::ms_nNumCivMale;
        goto LABEL_23;
      case 5:
        v12 = &CPopulation::ms_nNumCivFemale;
        goto LABEL_23;
      case 6:
        v12 = CPopulation::ms_nNumCop;
        goto LABEL_23;
      case 7:
      case 8:
      case 9:
      case 10:
      case 11:
      case 12:
      case 13:
      case 14:
      case 15:
      case 16:
        ++CPopulation::ms_nNumGang[v8 - 7];
        return;
      case 17:
        v12 = (int **)CPopulation::ms_nNumDealers;
        goto LABEL_23;
      case 18:
      case 19:
        v12 = &CPopulation::ms_nNumEmergency;
        goto LABEL_23;
      case 20:
        v12 = &CPopulation::ms_nNumCivMale;
        goto LABEL_23;
      case 22:
        v12 = &CPopulation::ms_nNumCivFemale;
LABEL_23:
        v10 = *v12;
        v11 = *v10 + 1;
        goto LABEL_24;
      default:
        return;
    }
  }
}
// 675EF0: using guessed type int *CPopulation::ms_nNumCivFemale;
// 6772D4: using guessed type int CPopulation::ms_nNumDealers[2];
// 677D74: using guessed type int *CPopulation::ms_nNumCivMale;
// 6783EC: using guessed type int *CPopulation::ms_nNumCop[2];
// 6797C8: using guessed type int *CPopulation::ms_nNumEmergency;

//----- (004D0E24) --------------------------------------------------------
bool __fastcall CPopulation::CanSolicitPlayerOnFoot(const Int32 iModelID)
{
  return 0;
}

//----- (004D0E28) --------------------------------------------------------
bool __fastcall CPopulation::CanSolicitPlayerInCar(const Int32 iModelID)
{
  return *(_DWORD *)CModelInfo::ms_modelInfoPtrs[iModelID][1].m_modelName == 22;
}

//----- (004D0E44) --------------------------------------------------------
bool __fastcall CPopulation::CanJeerAtStripper(const Int32 iModelID)
{
  return *(_DWORD *)CModelInfo::ms_modelInfoPtrs[iModelID][1].m_modelName == 4;
}

//----- (004D0E60) --------------------------------------------------------
void __fastcall CPopulation::PlaceMallPedsAsStationaryGroup(const CVector *vCentrePos, const Int32 iPedGroup)
{
  int v2; // r1
  int v3; // r10
  int v4; // r0
  int v5; // r9
  Int32 v6; // r5
  _BOOL4 IsAcceptableInCurrentZone; // r0
  bool v8; // zf
  ePedType v9; // r5
  unsigned __int16 v10; // r0
  int v12; // [sp+Ch] [bp-3Ch]
  CPedGroupPlacer v13; // [sp+1Ch] [bp-2Ch] BYREF

  if ( CGame::currArea == AREA_MALL )
  {
    v2 = 3;
    v3 = 0;
    if ( CPopulation::NumberOfPedsInUseInterior > 20 )
      v2 = 5;
    v12 = v2;
LABEL_5:
    v4 = 0;
    while ( 1 )
    {
      v5 = v4;
      v6 = CStreaming::ms_pedsLoaded[v4];
      if ( v6 >= 0
        && CStreaming::ms_aInfoForModel[v6].m_status == 1
        && v3 == CModelInfo::ms_modelInfoPtrs[v6]->m_numRefs )
      {
        IsAcceptableInCurrentZone = CPopCycle::PedIsAcceptableInCurrentZone(v6);
        v8 = !IsAcceptableInCurrentZone;
        if ( !IsAcceptableInCurrentZone )
          v8 = CGame::currArea == AREA_MAIN_MAP;
        if ( !v8
          && (CGame::currArea == AREA_MAIN_MAP
           || (unsigned int)(*(_DWORD *)CModelInfo::ms_modelInfoPtrs[v6][1].m_modelName - 6) >= 0x11)
          && (CWeather::Rain < 0.1 || (*(_DWORD *)&CModelInfo::ms_modelInfoPtrs[v6][1].m_modelName[4] & 0xFFFFFFFE) != 38) )
        {
          break;
        }
      }
      v4 = v5 + 1;
      if ( v5 >= 7 )
      {
        if ( ++v3 < v12 )
          goto LABEL_5;
        v6 = -1;
        break;
      }
    }
    v9 = *(_DWORD *)CModelInfo::ms_modelInfoPtrs[v6][1].m_modelName;
    v10 = rand();
    CPedGroupPlacer::PlaceGroup(
      &v13,
      v9,
      (int)(float)((float)((float)v10 * 0.000015259) * (float)4) + 1,
      vCentrePos,
      2u);
  }
}
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];

//----- (004D0FEC) --------------------------------------------------------
void __fastcall CPopulation::LoadSpecificDriverModelsForCar(Int32 CarMI)
{
  int32 DefaultCabDriverModel; // r0

  switch ( CarMI )
  {
    case 409:
      DefaultCabDriverModel = 255;
      goto LABEL_9;
    case 410:
    case 411:
    case 412:
    case 413:
    case 414:
    case 415:
    case 416:
    case 417:
    case 418:
    case 419:
    case 421:
    case 422:
    case 424:
    case 425:
    case 426:
    case 427:
    case 429:
    case 430:
    case 431:
    case 432:
    case 433:
    case 434:
    case 435:
    case 436:
    case 437:
    case 439:
    case 440:
    case 441:
    case 442:
    case 443:
    case 444:
    case 445:
    case 446:
    case 447:
    case 449:
    case 450:
    case 451:
    case 452:
    case 453:
    case 454:
    case 455:
    case 456:
    case 457:
    case 458:
    case 459:
    case 460:
    case 461:
    case 462:
    case 464:
    case 465:
    case 466:
    case 467:
    case 468:
    case 469:
    case 470:
    case 471:
    case 472:
    case 473:
    case 474:
    case 475:
    case 476:
    case 477:
    case 478:
    case 479:
    case 480:
      return;
    case 420:
    case 438:
      DefaultCabDriverModel = CStreaming::GetDefaultCabDriverModel();
      goto LABEL_9;
    case 423:
      DefaultCabDriverModel = 264;
      goto LABEL_9;
    case 428:
      DefaultCabDriverModel = 71;
      goto LABEL_9;
    case 448:
      DefaultCabDriverModel = 155;
      goto LABEL_9;
    case 463:
      CStreaming::RequestModel(247, 10);
      DefaultCabDriverModel = 248;
      goto LABEL_9;
    case 481:
      DefaultCabDriverModel = 23;
LABEL_9:
      sub_192918(DefaultCabDriverModel, 10);
      return;
  }
}

//----- (004D107C) --------------------------------------------------------
void __fastcall CPopulation::RemoveSpecificDriverModelsForCar(Int32 CarMI)
{
  int32 DefaultCabDriverModel; // r4

  switch ( CarMI )
  {
    case 409:
      CStreaming::SetModelIsDeletable(255);
      sub_198144(255);
      break;
    case 410:
    case 411:
    case 412:
    case 413:
    case 414:
    case 415:
    case 416:
    case 417:
    case 418:
    case 419:
    case 421:
    case 422:
    case 424:
    case 425:
    case 426:
    case 427:
    case 429:
    case 430:
    case 431:
    case 432:
    case 433:
    case 434:
    case 435:
    case 436:
    case 437:
    case 439:
    case 440:
    case 441:
    case 442:
    case 443:
    case 444:
    case 445:
    case 446:
    case 447:
    case 449:
    case 450:
    case 451:
    case 452:
    case 453:
    case 454:
    case 455:
    case 456:
    case 457:
    case 458:
    case 459:
    case 460:
    case 461:
    case 462:
    case 464:
    case 465:
    case 466:
    case 467:
    case 468:
    case 469:
    case 470:
    case 471:
    case 472:
    case 473:
    case 474:
    case 475:
    case 476:
    case 477:
    case 478:
    case 479:
    case 480:
      return;
    case 420:
    case 438:
      DefaultCabDriverModel = CStreaming::GetDefaultCabDriverModel();
      CStreaming::SetModelIsDeletable(DefaultCabDriverModel);
      sub_198144(DefaultCabDriverModel);
      break;
    case 423:
      CStreaming::SetModelIsDeletable(264);
      sub_198144(264);
      break;
    case 428:
      CStreaming::SetModelIsDeletable(71);
      sub_198144(71);
      break;
    case 448:
      CStreaming::SetModelIsDeletable(155);
      sub_198144(155);
      break;
    case 463:
      CStreaming::SetModelIsDeletable(247);
      CStreaming::SetModelTxdIsDeletable(247);
      CStreaming::SetModelIsDeletable(248);
      sub_198144(248);
      break;
    case 481:
      CStreaming::SetModelIsDeletable(23);
      sub_198144(23);
      break;
  }
}

//----- (004D1160) --------------------------------------------------------
void __fastcall CPopulation::PopulateInterior(Int32 NumPeds, CVector Coors)
{
  RwReal z; // r9
  CPedPool *v4; // r10
  int32 m_nSize; // r0
  int v6; // r4
  int v7; // r6
  CPool<CPed,CCopPed>::StorageType *m_aStorage; // r5
  CEntity *v9; // r11
  float v10; // r5
  int v11; // r4
  int i; // r6
  AssocGroupId v13; // r8
  int v14; // r1
  const unsigned __int8 *AnimGroupName; // r0
  int v16; // r0
  AssocGroupId v17; // r5
  const unsigned __int8 *v18; // r0
  int v19; // r0
  int v20; // r1
  RwReal posn; // [sp+14h] [bp-5Ch]
  CPed *v22; // [sp+1Ch] [bp-54h]
  CVector Coorsa; // [sp+24h] [bp-4Ch] BYREF
  float pFraction; // [sp+30h] [bp-40h] BYREF
  CNodeAddress pToNode; // [sp+34h] [bp-3Ch] BYREF
  CNodeAddress pFromNode; // [sp+38h] [bp-38h] BYREF
  CVector pResult; // [sp+3Ch] [bp-34h] BYREF
  CVector v28; // 0:r0.12
  CVector v29; // 0:r0.12

  z = Coors.z;
  Coorsa.x = Coors.x;
  if ( Coors.z >= 900.0 )
  {
    posn = Coors.y;
    v4 = CPools::ms_pPedPool;
    m_nSize = CPools::ms_pPedPool->m_nSize;
    if ( m_nSize )
    {
      v6 = m_nSize - 1;
      v7 = 1996 * m_nSize - 1996;
      do
      {
        if ( (v4->m_aFlags[v6] & 0x80u) == 0 )
        {
          m_aStorage = v4->m_aStorage;
          v9 = (CEntity *)&(*v4->m_aStorage)[v7];
          if ( v9 )
          {
            if ( CPed::CanBeDeleted((CPed *)&(*v4->m_aStorage)[v7]) )
            {
              CWorld::Remove(v9);
              (*(void (__fastcall **)(CEntity *))(*(_DWORD *)&(*m_aStorage)[v7] + 4))(v9);
            }
          }
        }
        --v6;
        v7 -= 1996;
      }
      while ( v6 != -1 );
    }
    v10 = posn;
    v28.z = z;
    *(_QWORD *)&v28.x = __PAIR64__(LODWORD(posn), LODWORD(Coorsa.x));
    CColStore::LoadCollision(v28, 1);
    CStreaming::LoadAllRequestedModels(0);
    if ( NumPeds >= 1 )
    {
      v29.z = z;
      *(_QWORD *)&v29.x = __PAIR64__(LODWORD(posn), LODWORD(Coorsa.x));
      v11 = NumPeds
          - CPopulation::GeneratePedsAtAttractors(v29, 0.0, 150.0, 0.0, 150.0, 7, (int)(float)((float)NumPeds * 0.95));
      if ( v11 >= 1 )
      {
        for ( i = 0; ; ++i )
        {
          pFromNode.Region = -1;
          pToNode.Region = -1;
          if ( CPathFind::GeneratePedCreationCoors_Interior(
                 &ThePaths,
                 Coorsa.x,
                 v10,
                 &pResult,
                 &pFromNode,
                 &pToNode,
                 &pFraction) != 1
            || !CPopCycle::FindNewPedType((ePedType *)&Coorsa.z, (Int32 *)&Coorsa.y, 1, 1) )
          {
            goto LABEL_27;
          }
          pResult.z = pResult.z + 0.9;
          v22 = CPopulation::AddPed(SLODWORD(Coorsa.z), LODWORD(Coorsa.y), &pResult, 1);
          CPedIntelligence::SetPedDecisionMakerType(v22->m_pPedIntelligence, 7);
          --v11;
          v13 = ANIM_STD_PED;
          v14 = CAnimManager::ms_numAnimAssocDefinitions;
          if ( CAnimManager::ms_numAnimAssocDefinitions >= 1 )
          {
            do
            {
              AnimGroupName = CAnimManager::GetAnimGroupName(v13);
              v16 = strcasecmp("jogger", (const char *)AnimGroupName);
              v14 = CAnimManager::ms_numAnimAssocDefinitions;
              v13 += v16 != 0;
            }
            while ( v16 && v13 < CAnimManager::ms_numAnimAssocDefinitions );
          }
          if ( v22->m_motionAnimGroup == v13 )
            break;
          if ( i > 23 )
            return;
LABEL_28:
          if ( v11 <= 0 )
            return;
        }
        if ( v14 >= 1 )
        {
          v17 = ANIM_STD_PED;
          do
          {
            v18 = CAnimManager::GetAnimGroupName(v17);
            v19 = strcasecmp((const char *)&dword_4D1378, (const char *)v18);
            v20 = v19;
            if ( v19 )
              v20 = 1;
            v17 += v20;
          }
          while ( v19 && v17 < CAnimManager::ms_numAnimAssocDefinitions );
          if ( !v19 )
            v22->m_motionAnimGroup = v17;
          v10 = posn;
        }
LABEL_27:
        if ( i > 23 )
          return;
        goto LABEL_28;
      }
    }
  }
}
// 4D1378: using guessed type int dword_4D1378;

//----- (004D1380) --------------------------------------------------------
bool __fastcall CPopulation::IsCorrectTimeOfDayForEffect(const C2dEffect *pEffect)
{
  bool result; // r0
  unsigned int m_type; // r1

  result = 1;
  m_type = pEffect->attr.q.m_type;
  if ( m_type <= 8 && ((1 << m_type) & 0x107) != 0 )
    return (unsigned __int8)(CClock::ms_nGameClockHours - 9) < 0xBu;
  return result;
}

//----- (004D13B4) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
int __fastcall CPopulation::AddPedAtAttractor(
        int32 pedModelIndex,
        C2dEffect *pEffect,
        CVector effectPos,
        CEntity *pEntity,
        int32 decisionMaker)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d4
  int32 m_nSize; // r1
  float y; // s2
  int v11; // r6
  int v12; // r6
  uint8 *v13; // r4
  int v14; // r6
  CPedAttractorManager *PedAttractorManager; // r0
  int v16; // r6
  CPed *v17; // r0
  CPed *v18; // r5
  int32 v19; // r4
  CPedIntelligence *m_pPedIntelligence; // r4
  CTaskComplexWander *WanderTaskByPedType; // r0
  CEventAttractor v23; // [sp+0h] [bp-40h] BYREF
  CVector vecPosition; // [sp+1Ch] [bp-24h] BYREF

  vecPosition = effectPos;
  m_nSize = CPools::ms_pPedPool->m_nSize;
  if ( m_nSize )
  {
    y = effectPos.y;
    v5.n64_u32[0] = 2139095039;
    do
    {
      v11 = 1996 * m_nSize--;
      v12 = v11 - 1996;
      while ( 1 )
      {
        if ( (CPools::ms_pPedPool->m_aFlags[m_nSize] & 0x80u) == 0 )
        {
          v13 = &(*CPools::ms_pPedPool->m_aStorage)[v12];
          if ( v13 )
            break;
        }
        --m_nSize;
        v12 -= 1996;
        if ( m_nSize == -1 )
          goto LABEL_11;
      }
      v14 = *((_DWORD *)v13 + 5);
      LODWORD(effectPos.y) = v14 + 48;
      if ( !v14 )
        LODWORD(effectPos.y) = v13 + 4;
      v6.n64_f32[0] = (float)((float)((float)(effectPos.x - *(float *)LODWORD(effectPos.y))
                                    * (float)(effectPos.x - *(float *)LODWORD(effectPos.y)))
                            + (float)((float)(y - *(float *)(LODWORD(effectPos.y) + 4))
                                    * (float)(y - *(float *)(LODWORD(effectPos.y) + 4))))
                    + 0.0;
      v5.n64_u64[0] = vmin_f32(v6, v5).n64_u64[0];
    }
    while ( m_nSize );
LABEL_11:
    if ( v5.n64_f32[0] <= 0.1225 )
      return 0;
  }
  PedAttractorManager = GetPedAttractorManager();
  if ( !CPedAttractorManager::HasQueueTailArrivedAtSlot(PedAttractorManager, pEffect, pEntity) )
    return 0;
  v16 = 0;
  v17 = CPopulation::AddPed(
          *(ePedType *)CModelInfo::ms_modelInfoPtrs[pedModelIndex][1].m_modelName,
          pedModelIndex,
          &vecPosition,
          0);
  v18 = v17;
  if ( v17 )
  {
    v19 = decisionMaker;
    v16 = 1;
    CPed::SetCharCreatedBy(v17, 1u);
    if ( decisionMaker == -1 )
      v19 = 2;
    CPedIntelligence::SetPedDecisionMakerType(v18->m_pPedIntelligence, v19);
    m_pPedIntelligence = v18->m_pPedIntelligence;
    WanderTaskByPedType = CTaskComplexWander::GetWanderTaskByPedType(v18);
    CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, WanderTaskByPedType, 4, 0);
    CPedAttractorPedPlacer::PlacePedAtEffect(pEffect, pEntity, v18, 0.02);
    *((_DWORD *)&v18->m_nPedFlags + 2) |= 0x200000u;
    CEventAttractor::CEventAttractor(&v23, pEffect, pEntity, 1u);
    v23.m_iTaskType = 233;
    CEventGroup::Add(&v18->m_pPedIntelligence->m_eventGroup, (CEvent *)&v23, 0);
    CPedIntelligence::ProcessEventHandler(v18->m_pPedIntelligence);
    CPedIntelligence::Process(v18->m_pPedIntelligence);
    CEventAttractor::~CEventAttractor(&v23);
  }
  return v16;
}
// 4D13B4: fragmented variable at 0:r2.8,8:^48.4 may be wrong
// 4D13B4: variables would overlap: 0:r2.8,8:^48.4 and ^48.4

//----- (004D152C) --------------------------------------------------------
Int32 __fastcall CPopulation::PickGangCar(Int32 Gang)
{
  return CLoadedCarGroup::PickRandomCar(&CPopulation::m_LoadedGangCars[Gang], 0, 0);
}

//----- (004D1544) --------------------------------------------------------
Int32 __fastcall CLoadedCarGroup::PickRandomCar(
        CLoadedCarGroup *this,
        bool bNotTooMany,
        const bool bOnlyPickNormalCars)
{
  _BOOL4 v3; // r4
  _BOOL4 v4; // r11
  Int32 v5; // r0
  int v6; // r5
  int v7; // r10
  CLoadedCarGroup *v8; // r3
  int v9; // r0
  int v10; // r2
  CBaseModelInfo *v11; // r6
  unsigned int v12; // r1
  CLoadedCarGroup *v13; // r2
  int v14; // t1
  float v15; // s16
  CLoadedCarGroup *v16; // r1
  int v17; // r0
  int v18; // r9
  float v19; // s0
  Int32 v20; // r5
  int m_lodDistance_high; // r0
  int v22; // r1
  Int16 *v23; // r2
  Int16 *v24; // r3
  __int16 *v25; // r6
  CBaseModelInfo **v26; // r10
  Int16 *v28; // [sp+8h] [bp-68h]
  CLoadedCarGroup *v30; // [sp+Ch] [bp-64h]
  _WORD v31[48]; // [sp+10h] [bp-60h] BYREF

  v3 = bOnlyPickNormalCars;
  v4 = bNotTooMany;
  v5 = CLoadedCarGroup::CountMembers(this);
  v6 = v5;
  if ( !v5 )
    return -1;
  if ( !v3 )
  {
    if ( v5 >= 1 )
    {
      v9 = 0;
      v13 = this;
      do
      {
        v14 = v13->aMembers[0];
        v13 = (CLoadedCarGroup *)((char *)v13 + 2);
        --v6;
        v9 += SHIWORD(CModelInfo::ms_modelInfoPtrs[v14][1].m_lodDistance);
      }
      while ( v6 );
      goto LABEL_13;
    }
    return -1;
  }
  memset(v31, 255, 0x2Eu);
  if ( v6 < 1 )
    return -1;
  v7 = 0;
  v8 = this;
  v9 = 0;
  do
  {
    v10 = v8->aMembers[0];
    v11 = CModelInfo::ms_modelInfoPtrs[v10];
    v12 = SBYTE1(v11[1].m_pColModel);
    if ( v12 <= 8 && ((1 << v12) & 0x107) != 0 )
    {
      v31[v7] = v10;
      v9 += SHIWORD(v11[1].m_lodDistance);
      ++v7;
    }
    v8 = (CLoadedCarGroup *)((char *)v8 + 2);
    --v6;
  }
  while ( v6 );
LABEL_13:
  if ( !v9 )
    return -1;
  v15 = (float)v9;
  v16 = this;
  v28 = &this->aMembers[1];
  if ( v3 )
    v16 = (CLoadedCarGroup *)v31;
  v30 = v16;
  v17 = 0;
  while ( 1 )
  {
    v18 = v17;
    v19 = (float)(unsigned __int16)rand();
    v20 = v30->aMembers[0];
    m_lodDistance_high = SHIWORD(CModelInfo::ms_modelInfoPtrs[v20][1].m_lodDistance);
    v22 = (int)(float)((float)(v19 * 0.000015259) * v15);
    if ( v22 <= m_lodDistance_high )
    {
      v26 = &CModelInfo::ms_modelInfoPtrs[v20];
    }
    else
    {
      v23 = &v31[1];
      v24 = v28;
      do
      {
        v25 = v24 + 1;
        if ( v3 )
          v24 = v23;
        v22 -= m_lodDistance_high;
        v20 = *v24;
        ++v23;
        m_lodDistance_high = SHIWORD(CModelInfo::ms_modelInfoPtrs[v20][1].m_lodDistance);
        v24 = v25;
      }
      while ( v22 > m_lodDistance_high );
      v26 = &CModelInfo::ms_modelInfoPtrs[v20];
    }
    if ( !CTheScripts::HasCarModelBeenSuppressed(v20)
      && !CTheScripts::HasVehicleModelBeenBlockedByScript(v20)
      && !CStreaming::WeAreTryingToPhaseVehicleOut(v20)
      && (!v4 || (*v26)->m_numRefs < 3) )
    {
      break;
    }
    v17 = v18 + 1;
    if ( v18 >= 9 )
      return -1;
  }
  return v20;
}
// 4D1544: using guessed type _WORD var_60[48];

//----- (004D16E4) --------------------------------------------------------
Int32 CPopulation::PickRiotRoadBlockCar()
{
  Int32 v0; // r4
  int v1; // r6
  int v2; // s0
  Int32 v3; // r0
  int v4; // r0
  unsigned int v5; // r6
  bool v6; // cc
  int v7; // r0
  unsigned int v8; // r6

  v1 = -1;
  v2 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 10.0);
  while ( 1 )
  {
    v3 = CLoadedCarGroup::PickRandomCar(&CPopulation::m_LoadedGangCars[(v2 + v1 + 1) % 10], 0, 0);
    if ( v3 > -1 )
      v0 = v3;
    if ( v3 >= 0 )
      break;
    if ( ++v1 >= 9 )
    {
      v4 = 0;
      while ( 1 )
      {
        v0 = CPopulation::m_AppropriateLoadedCars.aMembers[v4];
        v5 = SBYTE1(CModelInfo::ms_modelInfoPtrs[v0][1].m_pColModel);
        if ( v5 > 8 || ((1 << v5) & 0x1A0) == 0 )
          break;
        v6 = v4++ < 22;
        if ( !v6 )
        {
          v7 = 0;
          while ( 1 )
          {
            v0 = CPopulation::m_InAppropriateLoadedCars.aMembers[v7];
            v8 = SBYTE1(CModelInfo::ms_modelInfoPtrs[v0][1].m_pColModel);
            if ( v8 > 8 || ((1 << v8) & 0x1A0) == 0 )
              break;
            v6 = v7++ < 22;
            if ( !v6 )
              return sub_18AAB4(1u);
          }
          return v0;
        }
      }
      return v0;
    }
  }
  return v0;
}
// 4D17D0: variable 'v0' is possibly undefined
// 679BDC: using guessed type CLoadedCarGroup *CPopulation::m_AppropriateLoadedCars;
// 679EA4: using guessed type CLoadedCarGroup *CPopulation::m_InAppropriateLoadedCars;

//----- (004D17F0) --------------------------------------------------------
Int32 __fastcall CLoadedCarGroup::GetMember(CLoadedCarGroup *this, Int32 Member)
{
  return this->aMembers[Member];
}

//----- (004D17F8) --------------------------------------------------------
float CPopulation::FindCarMultiplierMotorway()
{
  float v0; // s0

  v0 = 1.7;
  if ( !CPopulation::m_bMoreCarsAndFewerPeds )
    return 1.0;
  return v0;
}

//----- (004D1820) --------------------------------------------------------
void __fastcall CLoadedCarGroup::Clear(CLoadedCarGroup *this)
{
  memset(this, 255, sizeof(CLoadedCarGroup));
}

//----- (004D182E) --------------------------------------------------------
void __fastcall CLoadedCarGroup::AddMember(CLoadedCarGroup *this, Int32 NewMember)
{
  CLoadedCarGroup *v2; // r2
  int v3; // r3
  bool v4; // nf
  int v5; // r3
  bool v6; // nf
  int v7; // r3
  bool v8; // nf
  int v9; // r3
  bool v10; // nf
  int v11; // r3
  bool v12; // nf
  int v13; // r3
  bool v14; // nf
  int v15; // r3
  bool v16; // nf
  int v17; // r3
  bool v18; // nf
  int v19; // r3
  bool v20; // nf
  int v21; // r3
  bool v22; // nf
  Int16 *v23; // r0
  int v24; // t1

  if ( this->aMembers[0] < 0 )
  {
    v2 = this;
LABEL_37:
    v2->aMembers[0] = NewMember;
    return;
  }
  v2 = (CLoadedCarGroup *)&this->aMembers[1];
  if ( this->aMembers[1] <= -1 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[2];
  v3 = this->aMembers[2];
  v4 = v3 < 0;
  if ( v3 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[3];
    v4 = this->aMembers[3] < 0;
  }
  if ( v4 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[4];
  v5 = this->aMembers[4];
  v6 = v5 < 0;
  if ( v5 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[5];
    v6 = this->aMembers[5] < 0;
  }
  if ( v6 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[6];
  v7 = this->aMembers[6];
  v8 = v7 < 0;
  if ( v7 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[7];
    v8 = this->aMembers[7] < 0;
  }
  if ( v8 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[8];
  v9 = this->aMembers[8];
  v10 = v9 < 0;
  if ( v9 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[9];
    v10 = this->aMembers[9] < 0;
  }
  if ( v10 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[10];
  v11 = this->aMembers[10];
  v12 = v11 < 0;
  if ( v11 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[11];
    v12 = this->aMembers[11] < 0;
  }
  if ( v12 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[12];
  v13 = this->aMembers[12];
  v14 = v13 < 0;
  if ( v13 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[13];
    v14 = this->aMembers[13] < 0;
  }
  if ( v14 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[14];
  v15 = this->aMembers[14];
  v16 = v15 < 0;
  if ( v15 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[15];
    v16 = this->aMembers[15] < 0;
  }
  if ( v16 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[16];
  v17 = this->aMembers[16];
  v18 = v17 < 0;
  if ( v17 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[17];
    v18 = this->aMembers[17] < 0;
  }
  if ( v18 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[18];
  v19 = this->aMembers[18];
  v20 = v19 < 0;
  if ( v19 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[19];
    v20 = this->aMembers[19] < 0;
  }
  if ( v20 )
    goto LABEL_37;
  v2 = (CLoadedCarGroup *)&this->aMembers[20];
  v21 = this->aMembers[20];
  v22 = v21 < 0;
  if ( v21 >= 0 )
  {
    v2 = (CLoadedCarGroup *)&this->aMembers[21];
    v22 = this->aMembers[21] < 0;
  }
  if ( v22 )
    goto LABEL_37;
  v24 = this->aMembers[22];
  v23 = &this->aMembers[22];
  if ( v24 < 0 )
    *v23 = NewMember;
}

//----- (004D191E) --------------------------------------------------------
void __fastcall CLoadedCarGroup::RemoveMember(CLoadedCarGroup *this, Int32 OldMember)
{
  int v2; // r12
  int v3; // r5
  unsigned int v4; // lr
  int v5; // r2
  Int16 *v6; // r1
  unsigned int v7; // r3
  __int64 v8; // d17
  bool v9; // cc

  if ( this->aMembers[0] == OldMember )
  {
    v2 = 0;
    goto LABEL_45;
  }
  if ( this->aMembers[1] == OldMember )
  {
    v2 = 1;
    goto LABEL_45;
  }
  if ( this->aMembers[2] == OldMember )
  {
    v2 = 2;
    goto LABEL_45;
  }
  if ( this->aMembers[3] == OldMember )
  {
    v2 = 3;
    goto LABEL_45;
  }
  if ( this->aMembers[4] == OldMember )
  {
    v2 = 4;
    goto LABEL_45;
  }
  if ( this->aMembers[5] == OldMember )
  {
    v2 = 5;
    goto LABEL_45;
  }
  if ( this->aMembers[6] == OldMember )
  {
    v2 = 6;
    goto LABEL_45;
  }
  if ( this->aMembers[7] == OldMember )
  {
    v2 = 7;
    goto LABEL_45;
  }
  if ( this->aMembers[8] == OldMember )
  {
    v2 = 8;
    goto LABEL_45;
  }
  if ( this->aMembers[9] == OldMember )
  {
    v2 = 9;
    goto LABEL_45;
  }
  if ( this->aMembers[10] == OldMember )
  {
    v2 = 10;
    goto LABEL_45;
  }
  if ( this->aMembers[11] == OldMember )
  {
    v2 = 11;
    goto LABEL_45;
  }
  if ( this->aMembers[12] == OldMember )
  {
    v2 = 12;
    goto LABEL_45;
  }
  if ( this->aMembers[13] == OldMember )
  {
    v2 = 13;
    goto LABEL_45;
  }
  if ( this->aMembers[14] == OldMember )
  {
    v2 = 14;
    goto LABEL_45;
  }
  if ( this->aMembers[15] == OldMember )
  {
    v2 = 15;
    goto LABEL_45;
  }
  if ( this->aMembers[16] == OldMember )
  {
    v2 = 16;
    goto LABEL_45;
  }
  if ( this->aMembers[17] == OldMember )
  {
    v2 = 17;
    goto LABEL_45;
  }
  if ( this->aMembers[18] == OldMember )
  {
    v2 = 18;
    goto LABEL_45;
  }
  if ( this->aMembers[19] == OldMember )
  {
    v2 = 19;
    goto LABEL_45;
  }
  if ( this->aMembers[20] == OldMember )
  {
    v2 = 20;
    goto LABEL_45;
  }
  if ( this->aMembers[21] == OldMember )
  {
    v2 = 21;
LABEL_45:
    v3 = 22 - v2;
    if ( (unsigned int)(22 - v2) > 7 && (v4 = v3 & 0xFFFFFFF8, (v3 & 0xFFFFFFF8) != 0) )
    {
      v5 = v2 + v4;
      v6 = &this->aMembers[v2];
      v7 = v3 & 0xFFFFFFF8;
      do
      {
        v7 -= 8;
        v8 = *(_QWORD *)(v6 + 5);
        *(_QWORD *)v6 = *(_QWORD *)(v6 + 1);
        *((_QWORD *)v6 + 1) = v8;
        v6 += 8;
      }
      while ( v7 );
      if ( v3 == v4 )
        goto LABEL_53;
    }
    else
    {
      v5 = v2;
    }
    do
    {
      v9 = v5 < 21;
      this->aMembers[v5] = this->aMembers[v5 + 1];
      ++v5;
    }
    while ( v9 );
LABEL_53:
    this->aMembers[22] = -1;
    return;
  }
  if ( this->aMembers[22] == OldMember )
    goto LABEL_53;
}

//----- (004D1AAE) --------------------------------------------------------
Int32 __fastcall CLoadedCarGroup::CountMembers(CLoadedCarGroup *this)
{
  Int32 result; // r0
  int v2; // r2

  if ( this->aMembers[0] < 0 )
    return 0;
  if ( this->aMembers[1] <= -1 )
    return 1;
  if ( this->aMembers[2] <= -1 )
    return 2;
  if ( this->aMembers[3] <= -1 )
    return 3;
  if ( this->aMembers[4] <= -1 )
    return 4;
  if ( this->aMembers[5] <= -1 )
    return 5;
  if ( this->aMembers[6] <= -1 )
    return 6;
  if ( this->aMembers[7] <= -1 )
    return 7;
  if ( this->aMembers[8] <= -1 )
    return 8;
  if ( this->aMembers[9] <= -1 )
    return 9;
  if ( this->aMembers[10] <= -1 )
    return 10;
  if ( this->aMembers[11] <= -1 )
    return 11;
  if ( this->aMembers[12] <= -1 )
    return 12;
  if ( this->aMembers[13] <= -1 )
    return 13;
  if ( this->aMembers[14] <= -1 )
    return 14;
  if ( this->aMembers[15] <= -1 )
    return 15;
  if ( this->aMembers[16] <= -1 )
    return 16;
  if ( this->aMembers[17] <= -1 )
    return 17;
  if ( this->aMembers[18] <= -1 )
    return 18;
  if ( this->aMembers[19] <= -1 )
    return 19;
  if ( this->aMembers[20] <= -1 )
    return 20;
  if ( this->aMembers[21] <= -1 )
    return 21;
  v2 = this->aMembers[22];
  result = 22;
  if ( v2 > -1 )
    return 23;
  return result;
}

//----- (004D1BC8) --------------------------------------------------------
void __fastcall CLoadedCarGroup::SortBasedOnUsage(CLoadedCarGroup *this)
{
  Int32 v2; // r0
  Int16 *v3; // r12
  int v4; // r2
  int v5; // lr
  bool v6; // zf
  Int16 *v7; // r1
  int v8; // r4
  int v9; // r5

  v2 = CLoadedCarGroup::CountMembers(this);
  v3 = &this->aMembers[1];
  v4 = 0;
  v5 = 0;
  do
  {
LABEL_5:
    v7 = &v3[v4];
    while ( v4 < v2 - 1 )
    {
      v8 = *v7;
      ++v4;
      v9 = *(v7++ - 1);
      if ( SLOBYTE(CModelInfo::ms_modelInfoPtrs[v9][1].m_lodDistance) < SLOBYTE(CModelInfo::ms_modelInfoPtrs[v8][1].m_lodDistance) )
      {
        *(v7 - 1) = v9;
        v5 = 1;
        *(v7 - 2) = v8;
        goto LABEL_5;
      }
    }
    v6 = v5 << 24 == 0;
    v4 = 0;
    v5 = 0;
  }
  while ( !v6 );
}

//----- (004D1C40) --------------------------------------------------------
Int32 __fastcall CLoadedCarGroup::PickLeastUsedModel(CLoadedCarGroup *this, Int32 MaxUsage)
{
  CLoadedCarGroup *v3; // r5
  Int32 v4; // r0
  Int32 v5; // r12
  Int32 v6; // lr
  int v7; // r6
  int v8; // r3
  int v9; // r4

  v3 = this;
  v4 = CLoadedCarGroup::CountMembers(this);
  if ( v4 >= 1 )
  {
    v5 = -1;
    v6 = 999;
    v7 = 999;
    while ( 1 )
    {
      v8 = (int)CModelInfo::ms_modelInfoPtrs[v3->aMembers[0]];
      v9 = *(__int16 *)(v8 + 30);
      if ( v7 <= v9 )
      {
        if ( v7 != v9 )
          goto LABEL_8;
        v8 = *(char *)(v8 + 104);
        if ( v6 <= v8 )
          goto LABEL_8;
      }
      else
      {
        LOBYTE(v8) = *(_BYTE *)(v8 + 104);
      }
      v6 = (char)v8;
      v5 = v3->aMembers[0];
      v7 = v9;
LABEL_8:
      v3 = (CLoadedCarGroup *)((char *)v3 + 2);
      if ( !--v4 )
        goto LABEL_11;
    }
  }
  v6 = 999;
  v5 = -1;
LABEL_11:
  if ( v6 > MaxUsage )
    return -1;
  return v5;
}

//----- (004D1CB8) --------------------------------------------------------
void __fastcall BoneNode_c::BoneNode_c(BoneNode_c *this)
{
  ListItem_c::ListItem_c(this);
  List_c::List_c(&this->m_childList);
}

//----- (004D1CCE) --------------------------------------------------------
void __fastcall BoneNode_c::~BoneNode_c(BoneNode_c *this)
{
  List_c::~List_c(&this->m_childList);
  sub_198660(this);
}

//----- (004D1CE8) --------------------------------------------------------
bool8 __fastcall BoneNode_c::Init(BoneNode_c *this, int32 boneTag, RpHAnimBlendInterpFrame *pAnimKeyFrame)
{
  __int64 v4; // d17
  int v5; // r5
  __int64 v6; // d16
  BoneInfo_t *v7; // r0
  BoneInfo_t *v9; // r0
  float v10; // s0
  float v11; // s2
  RwReal v12; // s6
  float v13; // s4
  RwReal v14; // s10
  RwReal v15; // s0
  RwReal v16; // s14
  RwReal v17; // s2
  RwReal v18; // s4
  bool8 result; // r0

  this->m_boneTag = boneTag;
  this->m_pAnimKeyFrame = pAnimKeyFrame;
  v4 = *(_QWORD *)&pAnimKeyFrame->q.imag.z;
  v5 = 0;
  *(_QWORD *)&this->m_keyFrameQuat.imag.x = *(_QWORD *)&pAnimKeyFrame->q.imag.x;
  *(_QWORD *)&this->m_keyFrameQuat.imag.z = v4;
  v6 = *(_QWORD *)&pAnimKeyFrame->t.x;
  this->m_keyFrameTrans.z = pAnimKeyFrame->t.z;
  this->m_parent = 0;
  *(_QWORD *)&this->m_keyFrameTrans.x = v6;
  List_c::RemoveAll(&this->m_childList);
  v7 = BoneNodeManager_c::ms_boneInfos;
  while ( this->m_boneTag != v7->boneTag )
  {
    ++v7;
    if ( v5++ >= 31 )
    {
      v5 = -1;
      break;
    }
  }
  v9 = &BoneNodeManager_c::ms_boneInfos[v5];
  v10 = v9->poseRots[0];
  v11 = v9->poseRots[1];
  v12 = v10 - v9->xLimits[0];
  v13 = v9->poseRots[2];
  v14 = v11 - v9->yLimits[0];
  v15 = v10 + v9->xLimits[1];
  v16 = v13 - v9->zLimits[0];
  v17 = v11 + v9->yLimits[1];
  v18 = v13 + v9->zLimits[1];
  this->m_speed = 1.0;
  result = 1;
  this->m_minLimit.x = v12;
  this->m_minLimit.y = v14;
  this->m_minLimit.z = v16;
  this->m_maxLimit.x = v15;
  this->m_maxLimit.y = v17;
  this->m_maxLimit.z = v18;
  return result;
}

//----- (004D1DAC) --------------------------------------------------------
void __fastcall BoneNode_c::InitLimits(BoneNode_c *this)
{
  BoneInfo_t *v1; // r3
  int v2; // r1
  BoneInfo_t *v4; // r1
  float v5; // s0
  float v6; // s2
  RwReal v7; // s6
  float v8; // s4
  RwReal v9; // s10
  RwReal v10; // s0
  RwReal v11; // s14
  RwReal v12; // s2
  RwReal v13; // s4

  v1 = BoneNodeManager_c::ms_boneInfos;
  v2 = 0;
  while ( this->m_boneTag != v1->boneTag )
  {
    ++v1;
    if ( v2++ >= 31 )
    {
      v2 = -1;
      break;
    }
  }
  v4 = &BoneNodeManager_c::ms_boneInfos[v2];
  v5 = v4->poseRots[0];
  v6 = v4->poseRots[1];
  v7 = v5 - v4->xLimits[0];
  v8 = v4->poseRots[2];
  v9 = v6 - v4->yLimits[0];
  v10 = v5 + v4->xLimits[1];
  v11 = v8 - v4->zLimits[0];
  v12 = v6 + v4->yLimits[1];
  v13 = v8 + v4->zLimits[1];
  this->m_minLimit.x = v7;
  this->m_minLimit.y = v9;
  this->m_minLimit.z = v11;
  this->m_maxLimit.x = v10;
  this->m_maxLimit.y = v12;
  this->m_maxLimit.z = v13;
}

//----- (004D1E3C) --------------------------------------------------------
void __fastcall BoneNode_c::AddChild(BoneNode_c *this, BoneNode_c *pChildBoneNode)
{
  pChildBoneNode->m_parent = this;
  sub_1955CC(&this->m_childList, pChildBoneNode);
}

//----- (004D1E44) --------------------------------------------------------
int32 __fastcall BoneNode_c::GetIdFromBoneTag(int32 boneTag)
{
  BoneInfo_t *v1; // r2
  int v2; // r1

  v1 = BoneNodeManager_c::ms_boneInfos;
  v2 = -1;
  do
  {
    if ( v1->boneTag == boneTag )
      return v2 + 1;
    ++v2;
    ++v1;
  }
  while ( v2 < 31 );
  return -1;
}

//----- (004D1E74) --------------------------------------------------------
void __fastcall BoneNode_c::QuatToEuler(RtQuat_0 *quat, RwV3d_0 *euler)
{
  float x; // s17
  float v5; // s28
  float z; // s22
  float v7; // s30
  float y; // s26
  float v9; // s19
  float v10; // s24
  float v11; // s2
  float v12; // r5
  float v13; // r0
  float v14; // s2
  float v15; // s0
  float v16; // s6

  x = quat->imag.x;
  v5 = x + x;
  z = quat->imag.z;
  v7 = quat->real + quat->real;
  y = quat->imag.y;
  v9 = (float)(z * (float)(x + x)) - (float)(y * v7);
  v10 = sqrtf(1.0 - (float)(v9 * v9));
  euler->y = (float)(atan2f(-v9, v10) * 180.0) / 3.1416;
  if ( v9 == -1.0 )
  {
    v16 = quat->imag.z;
    v15 = 0.0;
    v14 = atan2f(
            -(float)((float)(v16 * (float)(quat->imag.y + quat->imag.y))
                   - (float)(quat->imag.x * (float)(quat->real + quat->real))),
            (float)((float)(quat->imag.x * (float)(quat->imag.x * -2.0)) + 1.0) - (float)(v16 * (float)(v16 + v16)));
  }
  else
  {
    v11 = y * (float)(y + y);
    v12 = atan2f(
            (float)((float)((float)(y + y) * z) + (float)(x * v7)) / v10,
            (float)((float)(1.0 - (float)(x * v5)) - v11) / v10);
    v13 = atan2f(
            (float)((float)(y * v5) + (float)(z * v7)) / v10,
            (float)((float)(1.0 - v11) + (float)(z * (float)(z * -2.0))) / v10);
    v14 = v12;
    v15 = v13 * 180.0;
  }
  euler->z = v15 / 3.1416;
  euler->x = (float)(v14 * 180.0) / 3.1416;
}

//----- (004D1FEC) --------------------------------------------------------
void __fastcall BoneNode_c::GetLimits(BoneNode_c *this, int32 axis, float *min, float *max)
{
  RwReal z; // r1
  RwV3d_0 *p_z; // r0

  if ( axis == 2 )
  {
    z = this->m_minLimit.z;
    p_z = (RwV3d_0 *)&this->m_maxLimit.z;
  }
  else if ( axis == 1 )
  {
    z = this->m_minLimit.y;
    p_z = (RwV3d_0 *)&this->m_maxLimit.y;
  }
  else
  {
    if ( axis )
      return;
    z = this->m_minLimit.x;
    p_z = &this->m_maxLimit;
  }
  *min = z;
  *max = p_z->x;
}

//----- (004D2016) --------------------------------------------------------
void __fastcall BoneNode_c::SetLimits(BoneNode_c *this, int32 axis, float min, float max)
{
  RwV3d_0 *p_z; // r0

  if ( axis == 2 )
  {
    this->m_minLimit.z = min;
    p_z = (RwV3d_0 *)&this->m_maxLimit.z;
  }
  else if ( axis == 1 )
  {
    this->m_minLimit.y = min;
    p_z = (RwV3d_0 *)&this->m_maxLimit.y;
  }
  else
  {
    if ( axis )
      return;
    this->m_minLimit.x = min;
    p_z = &this->m_maxLimit;
  }
  p_z->x = max;
}

//----- (004D2048) --------------------------------------------------------
void __fastcall BoneNode_c::Limit(BoneNode_c *this, float blend)
{
  float32x2_t v2; // d4
  float32x2_t v3; // d7
  float x; // s2
  float v6; // s0
  float v7; // s2
  float y; // s2
  float v9; // s6
  float v10; // s4
  float z; // s4
  float v12; // s6
  BoneInfo_t *v13; // r1
  int v14; // r0
  float v16; // s12
  float v17; // s8
  float v18; // s8
  float v19; // r8
  float v20; // r9
  float v21; // r5
  float v22; // r0
  float v23; // r6
  float v24; // s16
  float v25; // s20
  float v26; // s24
  float v27; // r0
  float v28; // s2
  float v29; // s4
  float v30; // s8
  float v31; // s0
  float v32; // s6
  RwV3d_0 euler; // [sp+4h] [bp-4Ch] BYREF

  BoneNode_c::QuatToEuler(&this->m_keyFrameQuat, &euler);
  x = this->m_minLimit.x;
  v6 = euler.x;
  if ( euler.x < x )
  {
    euler.x = this->m_minLimit.x;
    v6 = x;
  }
  v7 = this->m_maxLimit.x;
  if ( v6 > v7 )
  {
    euler.x = this->m_maxLimit.x;
    v6 = v7;
  }
  y = euler.y;
  v9 = this->m_minLimit.y;
  v10 = this->m_maxLimit.y;
  if ( euler.y < v9 )
  {
    euler.y = this->m_minLimit.y;
    y = v9;
  }
  if ( y > v10 )
  {
    euler.y = v10;
    y = v10;
  }
  z = this->m_maxLimit.z;
  v12 = this->m_minLimit.z;
  if ( this->m_boneTag == 5 )
  {
    v13 = BoneNodeManager_c::ms_boneInfos;
    v14 = 0;
    while ( v13->boneTag != 5 )
    {
      ++v13;
      if ( v14++ >= 31 )
      {
        v14 = -1;
        break;
      }
    }
    v3.n64_u32[0] = 0;
    v16 = BoneNodeManager_c::ms_boneInfos[v14].poseRots[2];
    v2.n64_f32[0] = (float)(fabsf(v6) / -45.0) + 1.0;
    v17 = vmax_f32(v2, v3).n64_f32[0];
    z = v16 + (float)((float)(z - v16) * v17);
    v12 = v16 + (float)((float)(v12 - v16) * v17);
  }
  v18 = euler.z;
  if ( euler.z < v12 )
  {
    euler.z = v12;
    v18 = v12;
  }
  if ( v18 > z )
  {
    euler.z = z;
    v18 = z;
  }
  v19 = cosf((float)((float)(v6 * 3.1416) * 0.0055556) * 0.5);
  v20 = cosf((float)((float)(v18 * 3.1416) * 0.0055556) * 0.5);
  v21 = sinf((float)((float)(v6 * 3.1416) * 0.0055556) * 0.5);
  v22 = sinf((float)((float)(v18 * 3.1416) * 0.0055556) * 0.5);
  v23 = (float)((float)(y * 3.1416) * 0.0055556) * 0.5;
  v24 = v21 * v22;
  v25 = v19 * v22;
  v26 = cosf(v23);
  v27 = sinf(v23);
  v28 = (float)((float)(v19 * v20) * v27) + (float)(v26 * v24);
  v29 = (float)(v26 * (float)(v20 * v21)) - (float)(v27 * v25);
  v30 = (float)(v26 * v25) - (float)(v27 * (float)(v20 * v21));
  v31 = (float)(v26 * (float)(v19 * v20)) + (float)(v27 * v24);
  v32 = (float)(v31 * v31) + (float)((float)(v30 * v30) + (float)((float)(v29 * v29) + (float)(v28 * v28)));
  this->m_keyFrameQuat.imag.x = v29 / v32;
  this->m_keyFrameQuat.imag.y = v28 / v32;
  this->m_keyFrameQuat.imag.z = v30 / v32;
  this->m_keyFrameQuat.real = v31 / v32;
}
// 4D211E: variable 'v2' is possibly undefined
// 4D211E: variable 'v3' is possibly undefined

//----- (004D2278) --------------------------------------------------------
void __fastcall BoneNode_c::EulerToQuat(RwV3d_0 *euler, RtQuat_0 *quat)
{
  float v3; // s18
  float v4; // r5
  float v5; // s16
  float v6; // r8
  float v7; // r4
  float v8; // r5
  float v9; // r0
  float v10; // s16
  float v11; // s20
  float v12; // s24
  float v13; // r0
  float v14; // s2
  float v15; // s4
  float v16; // s8
  float v17; // s0
  float v18; // s6

  v3 = (float)((float)(euler->y * 3.1416) * 0.0055556) * 0.5;
  v4 = (float)((float)(euler->x * 3.1416) * 0.0055556) * 0.5;
  v5 = (float)((float)(euler->z * 3.1416) * 0.0055556) * 0.5;
  v6 = cosf(v4);
  v7 = cosf(v5);
  v8 = sinf(v4);
  v9 = sinf(v5);
  v10 = v8 * v9;
  v11 = v6 * v9;
  v12 = cosf(v3);
  v13 = sinf(v3);
  v14 = (float)((float)(v6 * v7) * v13) + (float)(v12 * v10);
  v15 = (float)(v12 * (float)(v7 * v8)) - (float)(v13 * v11);
  v16 = (float)(v12 * v11) - (float)(v13 * (float)(v7 * v8));
  v17 = (float)(v12 * (float)(v6 * v7)) + (float)(v13 * v10);
  v18 = (float)(v17 * v17) + (float)((float)((float)(v15 * v15) + (float)(v14 * v14)) + (float)(v16 * v16));
  quat->imag.x = v15 / v18;
  quat->imag.y = v14 / v18;
  quat->imag.z = v16 / v18;
  quat->real = v17 / v18;
}

//----- (004D23A0) --------------------------------------------------------
float __fastcall BoneNode_c::GetSpeed(BoneNode_c *this)
{
  return this->m_speed;
}

//----- (004D23A6) --------------------------------------------------------
void __fastcall BoneNode_c::SetSpeed(BoneNode_c *this, float speed)
{
  this->m_speed = speed;
}

//----- (004D23AC) --------------------------------------------------------
void __fastcall BoneNode_c::CalcWldMat(BoneNode_c *this, RwMatrix *pParentMat)
{
  float x; // s0
  RwMatrix *p_m_wldMat; // r5
  float y; // s2
  float z; // s4
  float real; // s6
  float v8; // s8
  float v9; // s10
  float v10; // s12
  float v11; // s8
  float v12; // s3
  float v13; // s5
  float v14; // s1
  float v15; // s14
  float v16; // s0
  float v17; // s12
  float v18; // s4
  float v19; // s6
  float v20; // s2
  __int64 v21; // d16
  BoneNode_c *i; // r4
  RwMatrix v23; // [sp+0h] [bp-48h] BYREF

  x = this->m_keyFrameQuat.imag.x;
  p_m_wldMat = &this->m_wldMat;
  y = this->m_keyFrameQuat.imag.y;
  z = this->m_keyFrameQuat.imag.z;
  real = this->m_keyFrameQuat.real;
  v8 = 2.0 / (float)((float)(real * real) + (float)((float)((float)(x * x) + (float)(y * y)) + (float)(z * z)));
  v9 = z * v8;
  v10 = y * v8;
  v11 = x * v8;
  v12 = z * v9;
  v13 = y * v10;
  v14 = x * v10;
  v15 = real * v9;
  v16 = x * v11;
  v17 = real * v10;
  v18 = z * v11;
  v19 = real * v11;
  v20 = y * v9;
  v23.right.y = v14 + v15;
  v23.right.z = v18 - v17;
  v23.up.x = v14 - v15;
  v23.up.z = v20 + v19;
  v23.at.y = v20 - v19;
  v23.at.x = v18 + v17;
  v23.flags = 2;
  v23.right.x = 1.0 - (float)(v13 + v12);
  v23.up.y = 1.0 - (float)(v12 + v16);
  v23.at.z = 1.0 - (float)(v16 + v13);
  v21 = *(_QWORD *)&this->m_keyFrameTrans.x;
  v23.pos.z = this->m_keyFrameTrans.z;
  *(_QWORD *)&v23.pos.x = v21;
  RwMatrixMultiply(&this->m_wldMat, &v23, pParentMat);
  for ( i = (BoneNode_c *)this->m_childList.m_head; i; i = (BoneNode_c *)i->m_next )
    BoneNode_c::CalcWldMat(i, p_m_wldMat);
}

//----- (004D24A8) --------------------------------------------------------
void __fastcall BoneNode_c::BlendKeyframe(BoneNode_c *this, float blend)
{
  float32x2_t v3; // d8
  RpHAnimBlendInterpFrame *v4; // r0
  __int64 v5; // d17
  __int64 v6; // d17
  RwReal *p_omega; // r0
  float32x2_t v8; // d16
  float32x2_t v9; // d16
  float32x2_t v10; // d17
  RpHAnimBlendInterpFrame *m_pAnimKeyFrame; // r0
  __int64 v12; // d16
  __int64 v13; // d17
  RtQuatSlerpCache_0 v14; // [sp+0h] [bp-68h] BYREF
  RtQuat_0 qpTo; // [sp+28h] [bp-40h] BYREF
  RtQuat_0 qpFrom; // [sp+38h] [bp-30h] BYREF

  v3.n64_f32[0] = blend;
  if ( blend >= 1.0 )
  {
    m_pAnimKeyFrame = this->m_pAnimKeyFrame;
    v12 = *(_QWORD *)&this->m_keyFrameQuat.imag.x;
    v13 = *(_QWORD *)&this->m_keyFrameQuat.imag.z;
LABEL_8:
    *(_QWORD *)&m_pAnimKeyFrame->q.imag.x = v12;
    *(_QWORD *)&m_pAnimKeyFrame->q.imag.z = v13;
    return;
  }
  if ( blend <= 0.0 )
    return;
  v4 = this->m_pAnimKeyFrame;
  v5 = *(_QWORD *)&v4->q.imag.z;
  *(_QWORD *)&qpFrom.imag.x = *(_QWORD *)&v4->q.imag.x;
  *(_QWORD *)&qpFrom.imag.z = v5;
  v6 = *(_QWORD *)&this->m_keyFrameQuat.imag.z;
  *(_QWORD *)&qpTo.imag.x = *(_QWORD *)&this->m_keyFrameQuat.imag.x;
  *(_QWORD *)&qpTo.imag.z = v6;
  RtQuatSetupSlerpCache(&qpFrom, &qpTo, &v14);
  if ( v3.n64_f32[0] <= 0.0 )
  {
    m_pAnimKeyFrame = this->m_pAnimKeyFrame;
    v12 = *(_QWORD *)&qpFrom.imag.x;
    v13 = *(_QWORD *)&qpFrom.imag.z;
    goto LABEL_8;
  }
  v3.n64_f32[1] = 1.0 - v3.n64_f32[0];
  if ( !v14.nearlyZeroOm )
  {
    p_omega = &v14.omega;
    v8.n64_u64[0] = vld1_dup_f32(p_omega).n64_u64[0];
    v9.n64_u64[0] = vmul_f32(v3, v8).n64_u64[0];
    v10.n64_u64[0] = vmul_f32(v9, v9).n64_u64[0];
    v3.n64_u64[0] = vadd_f32(
                      v9,
                      vmul_f32(
                        vmul_f32(v9, v10),
                        vadd_f32(
                          vmul_f32(
                            v10,
                            vadd_f32(
                              vmul_f32(
                                v10,
                                vadd_f32(
                                  vmul_f32(
                                    v10,
                                    vadd_f32(
                                      vmul_f32(
                                        v10,
                                        vadd_f32(
                                          vmul_f32(v10, (float32x2_t)0x2F2EC9D32F2EC9D3LL),
                                          (float32x2_t)0xB2D72F34B2D72F34LL)),
                                      (float32x2_t)0x3638EF1B3638EF1BLL)),
                                  (float32x2_t)0xB9500D01B9500D01LL)),
                              (float32x2_t)0x3C0888893C088889LL)),
                          (float32x2_t)0xBE2AAAABBE2AAAABLL))).n64_u64[0];
  }
  this->m_pAnimKeyFrame->q.imag.x = v3.n64_f32[1] * v14.raFrom.imag.x;
  this->m_pAnimKeyFrame->q.imag.y = v3.n64_f32[1] * v14.raFrom.imag.y;
  this->m_pAnimKeyFrame->q.imag.z = v3.n64_f32[1] * v14.raFrom.imag.z;
  this->m_pAnimKeyFrame->q.imag.x = (float)(v3.n64_f32[0] * v14.raTo.imag.x) + this->m_pAnimKeyFrame->q.imag.x;
  this->m_pAnimKeyFrame->q.imag.y = (float)(v3.n64_f32[0] * v14.raTo.imag.y) + this->m_pAnimKeyFrame->q.imag.y;
  this->m_pAnimKeyFrame->q.imag.z = (float)(v3.n64_f32[0] * v14.raTo.imag.z) + this->m_pAnimKeyFrame->q.imag.z;
  this->m_pAnimKeyFrame->q.real = (float)(v3.n64_f32[1] * v14.raFrom.real) + (float)(v3.n64_f32[0] * v14.raTo.real);
}

//----- (004D2648) --------------------------------------------------------
void __fastcall BoneNodeManager_c::BoneNodeManager_c(BoneNodeManager_c *this)
{
  int i; // r5
  List_c *v3; // r0

  for ( i = 0; i != 19456; i += 152 )
  {
    ListItem_c::ListItem_c((ListItem_c *)((char *)this + i));
    List_c::List_c(v3 + 4);
  }
  List_c::List_c(&this->m_boneNodePool);
}
// 4D2656: variable 'v3' is possibly undefined

//----- (004D2670) --------------------------------------------------------
void __fastcall BoneNodeManager_c::~BoneNodeManager_c(BoneNodeManager_c *this)
{
  int v2; // r5

  List_c::~List_c(&this->m_boneNodePool);
  v2 = 19456;
  do
  {
    List_c::~List_c((List_c *)((char *)this + v2 - 104));
    ListItem_c::~ListItem_c((ListItem_c *)((char *)this + v2 - 152));
    v2 -= 152;
  }
  while ( v2 );
}

//----- (004D26A4) --------------------------------------------------------
bool8 __fastcall BoneNodeManager_c::Init(BoneNodeManager_c *this)
{
  List_c *p_m_boneNodePool; // r5
  int i; // r6

  p_m_boneNodePool = &this->m_boneNodePool;
  for ( i = 0; i != 19456; i += 152 )
    List_c::AddItem(p_m_boneNodePool, (ListItem_c *)((char *)this + i));
  return 1;
}

//----- (004D26CC) --------------------------------------------------------
void __fastcall BoneNodeManager_c::Exit(BoneNodeManager_c *this)
{
  sub_19CBF0(&this->m_boneNodePool);
}

//----- (004D26D4) --------------------------------------------------------
void __fastcall BoneNodeManager_c::Reset(BoneNodeManager_c *this)
{
  List_c *p_m_boneNodePool; // r5
  int i; // r6

  p_m_boneNodePool = &this->m_boneNodePool;
  List_c::RemoveAll(&this->m_boneNodePool);
  for ( i = 0; i != 19456; i += 152 )
    List_c::AddItem(p_m_boneNodePool, (ListItem_c *)((char *)this + i));
}

//----- (004D2700) --------------------------------------------------------
BoneNode_c *__fastcall BoneNodeManager_c::GetBoneNode(BoneNodeManager_c *this)
{
  return (BoneNode_c *)sub_19049C(&this->m_boneNodePool);
}

//----- (004D2708) --------------------------------------------------------
void __fastcall BoneNodeManager_c::ReturnBoneNode(BoneNodeManager_c *this, BoneNode_c *pBoneNode)
{
  sub_1955CC(&this->m_boneNodePool, pBoneNode);
}

//----- (004D2710) --------------------------------------------------------
int32 __fastcall BoneNodeManager_c::GetNumBoneNodesLeft(BoneNodeManager_c *this)
{
  return sub_18A64C(&this->m_boneNodePool);
}

//----- (004D2720) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
int __fastcall IKChain_c::Init(
        IKChain_c *this,
        unsigned __int8 *idString,
        int32 slotId,
        CPed *pPed,
        int32 effectorBoneTag,
        RwV3d_0 effectorVec,
        int32 pivotBoneTag,
        CEntity *pEntity,
        int32 offsetBoneTag,
        RwV3d_0 offsetPos,
        float speed,
        int32 priority)
{
  uint8 v13; // r10
  CEntity **p_m_pPed; // r6
  RpClump_0 *m_pRwObject; // r0
  AnimBlendFrameData *v16; // r5
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r0
  RwFrame_0 *pFrame; // r0
  int result; // r0
  int v20; // [sp+0h] [bp-38h]

  v13 = slotId;
  this->m_pPed = pPed;
  p_m_pPed = &this->m_pPed;
  m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
  v16 = *(AnimBlendFrameData **)(*(_DWORD *)(&m_pRwObject->object.type + ClumpOffset) + 16);
  if ( (v16->Flags & 0xA0) != 128 )
    return 0;
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 11) & 0x20) == 0 )
    return 0;
  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump(m_pRwObject);
  pFrame = v16[RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, effectorBoneTag)]._anon_1.pFrame;
  if ( pFrame->modelling.right.x == 0.0 && pFrame->modelling.right.y == 0.0 )
    return 0;
  CEntity::RegisterReference(this->m_pPed, p_m_pPed);
  this->m_ppBoneNodes = 0;
  IKChain_c::SetupBones(this, effectorBoneTag, *(RwV3d_0 *)(&v20 - 2), pivotBoneTag, v16);
  this->m_pEntity = pEntity;
  this->m_effectorBoneTag = effectorBoneTag;
  this->m_blend = 0.0;
  this->m_effectorVec = effectorVec;
  if ( pEntity )
    CEntity::RegisterReference(pEntity, &this->m_pEntity);
  this->m_offsetBoneTag = offsetBoneTag;
  this->m_offsetPos = offsetPos;
  result = 1;
  this->m_speed = speed;
  this->m_slotId = v13;
  this->m_updateTarget = 1;
  this->m_priority = priority;
  return result;
}
// 4D2720: fragmented variable at ^0.4 may be wrong

//----- (004D2824) --------------------------------------------------------
void __fastcall IKChain_c::SetupBones(
        IKChain_c *this,
        int32 effectorBoneTag,
        RwV3d_0 effectorVec,
        int32 pivotBoneTag,
        AnimBlendFrameData *frameData)
{
  CPed *m_pPed; // r0
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r9
  RwInt32 v9; // r6
  BoneNode_c *BoneNode; // r6
  RwInt32 v11; // r0
  int32 m_numBoneNodes; // r0
  signed int v13; // r5
  __int64 v14; // r0
  BoneNode_c **v15; // r0
  int32 v16; // r2
  int i; // r0
  int32 v18; // r5
  int parentBoneTag; // r1
  int32 v20; // r3
  bool v21; // cc
  BoneNode_c **m_ppBoneNodes; // r2
  int v23; // r6
  BoneNode_c *v24; // r0
  int v25[39]; // [sp+4h] [bp-9Ch]

  m_pPed = this->m_pPed;
  this->m_numBoneNodes = 0;
  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)m_pPed->m_pRwObject);
  v9 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, pivotBoneTag);
  this->m_pPivotWldMat = &RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump)[v9];
  for ( this->m_pivotBoneTag = pivotBoneTag;
        effectorBoneTag != pivotBoneTag;
        effectorBoneTag = BoneNodeManager_c::ms_boneInfos[BoneNode_c::GetIdFromBoneTag(effectorBoneTag)].parentBoneTag )
  {
    BoneNode = BoneNodeManager_c::GetBoneNode(&g_boneNodeMan);
    v11 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, effectorBoneTag);
    BoneNode_c::Init(BoneNode, effectorBoneTag, frameData[v11]._anon_1.pStdKeyFrame);
    m_numBoneNodes = this->m_numBoneNodes;
    this->m_numBoneNodes = m_numBoneNodes + 1;
    v25[m_numBoneNodes] = (int)BoneNode;
  }
  v13 = this->m_numBoneNodes;
  v14 = 4LL * (unsigned int)v13;
  if ( !is_mul_ok(4u, v13) )
    HIDWORD(v14) = 1;
  if ( HIDWORD(v14) )
    LODWORD(v14) = -1;
  v15 = (BoneNode_c **)operator new[](v14);
  this->m_ppBoneNodes = v15;
  if ( v13 >= 1 )
  {
    *v15 = (BoneNode_c *)v25[0];
    v16 = this->m_numBoneNodes;
    if ( v16 >= 2 )
    {
      for ( i = 1; i < v16; ++i )
      {
        this->m_ppBoneNodes[i] = (BoneNode_c *)v25[i];
        v16 = this->m_numBoneNodes;
      }
    }
    if ( v16 >= 1 )
    {
      v18 = 0;
      do
      {
        parentBoneTag = BoneNodeManager_c::ms_boneInfos[BoneNode_c::GetIdFromBoneTag(this->m_ppBoneNodes[v18]->m_boneTag)].parentBoneTag;
        v21 = parentBoneTag < 0;
        if ( parentBoneTag >= 0 )
        {
          v20 = this->m_numBoneNodes;
          v21 = v20 < 1;
        }
        if ( !v21 )
        {
          m_ppBoneNodes = this->m_ppBoneNodes;
          v23 = 0;
          while ( 1 )
          {
            v24 = m_ppBoneNodes[v23];
            if ( v24->m_boneTag == parentBoneTag )
              break;
            if ( ++v23 >= v20 )
              goto LABEL_22;
          }
          if ( v24 )
            BoneNode_c::AddChild(v24, m_ppBoneNodes[v18]);
        }
LABEL_22:
        ++v18;
      }
      while ( v18 < this->m_numBoneNodes );
    }
  }
}
// 4D2950: variable 'v20' is possibly undefined
// 4D2824: using guessed type int var_9C[39];

//----- (004D2980) --------------------------------------------------------
void __fastcall IKChain_c::Exit(IKChain_c *this)
{
  BoneNode_c **m_ppBoneNodes; // r0
  __int64 v3; // kr00_8
  int32 v4; // r6

  v3 = *(_QWORD *)&this->m_numBoneNodes;
  m_ppBoneNodes = this->m_ppBoneNodes;
  if ( (int)v3 >= 1 )
  {
    v4 = 0;
    do
    {
      BoneNodeManager_c::ReturnBoneNode(&g_boneNodeMan, m_ppBoneNodes[v4]);
      m_ppBoneNodes = this->m_ppBoneNodes;
      ++v4;
    }
    while ( v4 < this->m_numBoneNodes );
  }
  if ( m_ppBoneNodes )
    operator delete[](m_ppBoneNodes);
  this->m_ppBoneNodes = 0;
}

//----- (004D29C4) --------------------------------------------------------
void __fastcall IKChain_c::Update(IKChain_c *this, float deltaTime)
{
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r5
  RwMatrix *MatrixArray; // r6
  RwInt32 v5; // r0
  __int64 v6; // r2
  RwMatrix *v7; // r1
  int32 v8; // r5

  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)this->m_pPed->m_pRwObject);
  MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
  v5 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, this->m_pivotBoneTag);
  v6 = *(_QWORD *)&this->m_numBoneNodes;
  v7 = &MatrixArray[v5];
  this->m_pPivotWldMat = v7;
  BoneNode_c::CalcWldMat(*(BoneNode_c **)(HIDWORD(v6) + 4 * v6 - 4), v7);
  IKChain_c::MoveBonesToTarget(this);
  if ( this->m_numBoneNodes >= 1 )
  {
    v8 = 0;
    do
      BoneNode_c::BlendKeyframe(this->m_ppBoneNodes[v8++], this->m_blend);
    while ( v8 < this->m_numBoneNodes );
  }
}

//----- (004D2A28) --------------------------------------------------------
void __fastcall IKChain_c::MoveBonesToTarget(IKChain_c *this)
{
  BoneNode_c *v2; // r10
  CEntity *m_pEntity; // r0
  RwObject_0 *m_pRwObject; // r0
  RwMatrix *v5; // r5
  int32 m_offsetBoneTag; // r2
  RwReal v7; // s2
  RwReal v8; // s4
  __int64 v9; // d16
  const RwMatrix *p_m_wldMat; // r8
  int32 v11; // r9
  float x; // s30
  float y; // s17
  BoneNode_c *v14; // r11
  float z; // s19
  float v16; // s28
  float v17; // s26
  float v18; // s24
  float v19; // s2
  float v20; // s4
  const RwMatrix *v21; // r6
  float v22; // r8
  float m_speed; // s24
  float Speed; // s26
  float v25; // s24
  BoneNode_c *m_parent; // r0
  RwMatrix *m_pPivotWldMat; // r1
  float v28; // s24
  float v29; // s8
  float v30; // s8
  BoneNode_c *v31; // r0
  RwMatrix *v32; // r1
  RwV3d_0 vectorsOut; // [sp+4h] [bp-BCh] BYREF
  RtQuat_0 quat; // [sp+10h] [bp-B0h] BYREF
  RtQuat_0 vectorOut; // [sp+20h] [bp-A0h] BYREF
  RwV3d_0 vectorsIn; // [sp+30h] [bp-90h] BYREF
  RwV3d_0 out; // [sp+3Ch] [bp-84h] BYREF
  RwV3d_0 v38; // [sp+48h] [bp-78h] BYREF
  RwV3d_0 in; // [sp+54h] [bp-6Ch] BYREF

  v2 = *this->m_ppBoneNodes;
  if ( this->m_updateTarget )
  {
    m_pEntity = this->m_pEntity;
    if ( m_pEntity )
    {
      m_pRwObject = m_pEntity->m_pRwObject;
      if ( m_pRwObject )
        v5 = (RwMatrix *)((char *)m_pRwObject->parent + 16);
      else
        v5 = 0;
      TestMatrix(v5);
      m_offsetBoneTag = this->m_offsetBoneTag;
      if ( m_offsetBoneTag == -1 )
      {
        if ( v5 )
          RwV3dTransformPoint(&this->m_targetPos, &this->m_offsetPos, v5);
      }
      else
      {
        CPed::GetBonePosition((CPed *)this->m_pEntity, &this->m_targetPos, m_offsetBoneTag, 0);
        if ( v5 )
        {
          TestMatrix(v5);
          RwV3dTransformVector(&vectorOut.imag, &this->m_offsetPos, v5);
          v7 = this->m_targetPos.y + vectorOut.imag.y;
          v8 = this->m_targetPos.z + vectorOut.imag.z;
          this->m_targetPos.x = this->m_targetPos.x + vectorOut.imag.x;
          this->m_targetPos.y = v7;
          this->m_targetPos.z = v8;
        }
      }
    }
    else
    {
      v9 = *(_QWORD *)&this->m_offsetPos.x;
      this->m_targetPos.z = this->m_offsetPos.z;
      *(_QWORD *)&this->m_targetPos.x = v9;
    }
  }
  if ( this->m_numBoneNodes >= 1 )
  {
    p_m_wldMat = &v2->m_wldMat;
    v11 = 0;
    do
    {
      x = v2->m_wldMat.pos.x;
      y = v2->m_wldMat.pos.y;
      v14 = this->m_ppBoneNodes[v11];
      z = v2->m_wldMat.pos.z;
      v16 = v14->m_wldMat.pos.x;
      v17 = v14->m_wldMat.pos.y;
      v18 = v14->m_wldMat.pos.z;
      RwV3dTransformVector(&v38, &this->m_effectorVec, p_m_wldMat);
      in.x = (float)(x + v38.x) - v16;
      in.y = (float)(y + v38.y) - v17;
      in.z = (float)(z + v38.z) - v18;
      if ( RwV3dLength(&in) > 0.00001 )
      {
        RwV3dNormalize(&in, &in);
        v19 = this->m_targetPos.y;
        v20 = this->m_targetPos.z;
        out.x = this->m_targetPos.x - v16;
        out.y = v19 - v17;
        out.z = v20 - v18;
        if ( RwV3dLength(&out) > 0.00001 )
        {
          RwV3dNormalize(&out, &out);
          if ( (float)((float)((float)(out.x * in.x) + (float)(out.y * in.y)) + (float)(out.z * in.z)) < 0.997 )
          {
            v21 = p_m_wldMat;
            v22 = acosf((float)((float)(out.x * in.x) + (float)(out.y * in.y)) + (float)(out.z * in.z));
            m_speed = this->m_speed;
            Speed = BoneNode_c::GetSpeed(v14);
            vectorsIn.x = (float)(in.y * out.z) - (float)(in.z * out.y);
            v25 = (float)(v22 * 57.296) * m_speed;
            vectorsIn.y = (float)(in.z * out.x) - (float)(in.x * out.z);
            vectorsIn.z = (float)(in.x * out.y) - (float)(in.y * out.x);
            m_parent = v14->m_parent;
            if ( m_parent )
              m_pPivotWldMat = &m_parent->m_wldMat;
            else
              m_pPivotWldMat = this->m_pPivotWldMat;
            RtQuatConvertFromMatrix(&vectorOut, m_pPivotWldMat);
            v28 = v25 * Speed;
            p_m_wldMat = v21;
            v29 = (float)(vectorOut.real * vectorOut.real)
                + (float)((float)((float)(vectorOut.imag.x * vectorOut.imag.x)
                                + (float)(vectorOut.imag.y * vectorOut.imag.y))
                        + (float)(vectorOut.imag.z * vectorOut.imag.z));
            if ( v29 > 0.0 )
            {
              v30 = 1.0 / v29;
              quat.imag.x = -(float)(v30 * vectorOut.imag.x);
              quat.real = vectorOut.real * v30;
              quat.imag.y = -(float)(v30 * vectorOut.imag.y);
              quat.imag.z = -(float)(v30 * vectorOut.imag.z);
            }
            RtQuatTransformVectors(&vectorsOut, &vectorsIn, 1, &quat);
            RtQuatRotate(&v14->m_keyFrameQuat, &vectorsOut, v28, rwCOMBINEPOSTCONCAT);
            BoneNode_c::Limit(v14, this->m_blend);
            v31 = v14->m_parent;
            if ( v31 )
              v32 = &v31->m_wldMat;
            else
              v32 = this->m_pPivotWldMat;
            BoneNode_c::CalcWldMat(v14, v32);
          }
        }
      }
      ++v11;
    }
    while ( v11 < this->m_numBoneNodes );
  }
}

//----- (004D2D30) --------------------------------------------------------
void __fastcall IKChain_c::SetBlend(IKChain_c *this, float blend)
{
  this->m_blend = blend;
}

//----- (004D2D34) --------------------------------------------------------
void __fastcall IKChain_c::SetOffsetBoneTag(IKChain_c *this, int32 offsetBoneTag)
{
  this->m_offsetBoneTag = offsetBoneTag;
}

//----- (004D2D38) --------------------------------------------------------
void __fastcall IKChain_c::SetOffsetPos(IKChain_c *this, RwV3d_0 offsetPos)
{
  this->m_offsetPos = offsetPos;
}

//----- (004D2D3E) --------------------------------------------------------
void __fastcall IKChain_c::ClampLimits(IKChain_c *this, int32 boneTag, bool8 xAxis, bool8 yAxis, bool8 a5, int a6)
{
  int32 m_numBoneNodes; // r4
  BoneNode_c **m_ppBoneNodes; // r8
  int v8; // r6
  BoneNode_c *v9; // r0

  m_numBoneNodes = this->m_numBoneNodes;
  if ( m_numBoneNodes < 1 )
  {
LABEL_5:
    v9 = 0;
  }
  else
  {
    m_ppBoneNodes = this->m_ppBoneNodes;
    v8 = 0;
    while ( 1 )
    {
      v9 = m_ppBoneNodes[v8];
      if ( v9->m_boneTag == boneTag )
        break;
      if ( ++v8 >= m_numBoneNodes )
        goto LABEL_5;
    }
  }
  if ( a6 )
    sub_19A7C0(v9, xAxis, yAxis, a5);
  else
    sub_18BD00(v9, xAxis, yAxis, a5);
}

//----- (004D2D8C) --------------------------------------------------------
BoneNode_c *__fastcall IKChain_c::GetBoneNodeFromTag(IKChain_c *this, int32 boneTag)
{
  int32 m_numBoneNodes; // lr
  BoneNode_c *result; // r0
  BoneNode_c **m_ppBoneNodes; // r12
  int v5; // r3

  m_numBoneNodes = this->m_numBoneNodes;
  if ( m_numBoneNodes < 1 )
    return 0;
  m_ppBoneNodes = this->m_ppBoneNodes;
  v5 = 0;
  while ( 1 )
  {
    result = m_ppBoneNodes[v5];
    if ( result->m_boneTag == boneTag )
      break;
    if ( ++v5 >= m_numBoneNodes )
      return 0;
  }
  return result;
}

//----- (004D2DBA) --------------------------------------------------------
void __fastcall IKChain_c::GetLimits(IKChain_c *this, int32 boneTag, int32 axis, float *min, float *a5)
{
  int32 m_numBoneNodes; // lr
  BoneNode_c **m_ppBoneNodes; // r4
  int v7; // r5
  BoneNode_c *v8; // r0

  m_numBoneNodes = this->m_numBoneNodes;
  if ( m_numBoneNodes < 1 )
  {
LABEL_5:
    v8 = 0;
  }
  else
  {
    m_ppBoneNodes = this->m_ppBoneNodes;
    v7 = 0;
    while ( 1 )
    {
      v8 = m_ppBoneNodes[v7];
      if ( v8->m_boneTag == boneTag )
        break;
      if ( ++v7 >= m_numBoneNodes )
        goto LABEL_5;
    }
  }
  sub_19ECA4(v8, axis, min, a5);
}

//----- (004D2DF8) --------------------------------------------------------
void __fastcall IKChain_c::SetLimits(IKChain_c *this, int32 boneTag, int32 axis, float min, float max)
{
  int32 m_numBoneNodes; // r12
  BoneNode_c **m_ppBoneNodes; // lr
  int v7; // r4
  BoneNode_c *v8; // r0

  m_numBoneNodes = this->m_numBoneNodes;
  if ( m_numBoneNodes < 1 )
  {
LABEL_5:
    v8 = 0;
  }
  else
  {
    m_ppBoneNodes = this->m_ppBoneNodes;
    v7 = 0;
    while ( 1 )
    {
      v8 = m_ppBoneNodes[v7];
      if ( v8->m_boneTag == boneTag )
        break;
      if ( ++v7 >= m_numBoneNodes )
        goto LABEL_5;
    }
  }
  sub_1A0D00(v8, axis, min, max);
}

//----- (004D2E34) --------------------------------------------------------
float __fastcall IKChain_c::GetBoneSpeed(IKChain_c *this, int32 boneTag)
{
  int32 m_numBoneNodes; // lr
  BoneNode_c **m_ppBoneNodes; // r12
  int v4; // r3
  BoneNode_c *v5; // r0

  m_numBoneNodes = this->m_numBoneNodes;
  if ( m_numBoneNodes < 1 )
  {
LABEL_5:
    v5 = 0;
  }
  else
  {
    m_ppBoneNodes = this->m_ppBoneNodes;
    v4 = 0;
    while ( 1 )
    {
      v5 = m_ppBoneNodes[v4];
      if ( v5->m_boneTag == boneTag )
        break;
      if ( ++v4 >= m_numBoneNodes )
        goto LABEL_5;
    }
  }
  return sub_18C2D0(v5);
}

//----- (004D2E6A) --------------------------------------------------------
void __fastcall IKChain_c::SetBoneSpeed(IKChain_c *this, int32 boneTag, float speed)
{
  int32 m_numBoneNodes; // lr
  BoneNode_c **m_ppBoneNodes; // r12
  int v5; // r3
  BoneNode_c *v6; // r0

  m_numBoneNodes = this->m_numBoneNodes;
  if ( m_numBoneNodes < 1 )
  {
LABEL_5:
    v6 = 0;
  }
  else
  {
    m_ppBoneNodes = this->m_ppBoneNodes;
    v5 = 0;
    while ( 1 )
    {
      v6 = m_ppBoneNodes[v5];
      if ( v6->m_boneTag == boneTag )
        break;
      if ( ++v5 >= m_numBoneNodes )
        goto LABEL_5;
    }
  }
  sub_18F7B8(v6, speed);
}

//----- (004D2E9A) --------------------------------------------------------
int32 __fastcall IKChain_c::GetPriority(IKChain_c *this)
{
  return this->m_priority;
}

//----- (004D2EA0) --------------------------------------------------------
void __fastcall IKChain_c::UpdateEntity(IKChain_c *this, CEntity *pEntity)
{
  this->m_pEntity = pEntity;
  if ( pEntity )
    sub_196050(pEntity, &this->m_pEntity);
}

//----- (004D2EB4) --------------------------------------------------------
void __fastcall IKChain_c::UpdateOffset(IKChain_c *this, int32 offsetBoneTag, int32 a3, int32 a4, int32 a5)
{
  int32 *p_m_offsetBoneTag; // r0

  p_m_offsetBoneTag = &this->m_offsetBoneTag;
  *p_m_offsetBoneTag = offsetBoneTag;
  p_m_offsetBoneTag[1] = a3;
  p_m_offsetBoneTag[2] = a4;
  p_m_offsetBoneTag[3] = a5;
}

//----- (004D2EC0) --------------------------------------------------------
void __fastcall IKChain_c::UpdateTarget(IKChain_c *this, bool8 update)
{
  this->m_updateTarget = update;
}

//----- (004D2EC8) --------------------------------------------------------
bool8 __fastcall IKChain_c::IsFacingTarget(IKChain_c *this)
{
  RwV3d_0 *p_m_effectorVec; // r1
  BoneNode_c *v3; // r0
  float x; // s16
  float y; // s18
  float z; // s20
  float v7; // s2
  float v8; // s4
  RwV3d_0 v10; // [sp+0h] [bp-38h] BYREF
  RwV3d_0 vectorOut; // [sp+Ch] [bp-2Ch] BYREF

  p_m_effectorVec = &this->m_effectorVec;
  v3 = *this->m_ppBoneNodes;
  x = v3->m_wldMat.pos.x;
  y = v3->m_wldMat.pos.y;
  z = v3->m_wldMat.pos.z;
  RwV3dTransformVector(&vectorOut, p_m_effectorVec, &v3->m_wldMat);
  RwV3dNormalize(&vectorOut, &vectorOut);
  v7 = this->m_targetPos.y;
  v8 = this->m_targetPos.z;
  v10.x = this->m_targetPos.x - x;
  v10.y = v7 - y;
  v10.z = v8 - z;
  RwV3dNormalize(&v10, &v10);
  return (float)((float)((float)(v10.x * vectorOut.x) + (float)(v10.y * vectorOut.y)) + (float)(v10.z * vectorOut.z)) >= 0.95
      && this->m_blend > 0.98;
}

//----- (004D2F8C) --------------------------------------------------------
bool8 __fastcall IKChain_c::IsAtTarget(IKChain_c *this, float range, float *dist)
{
  float x; // s6
  float y; // s8
  BoneNode_c *v8; // r0
  float z; // s10
  float v10; // s2
  float v11; // s4
  RwReal v12; // r0
  RwV3d_0 in; // [sp+4h] [bp-1Ch] BYREF

  x = this->m_targetPos.x;
  y = this->m_targetPos.y;
  v8 = *this->m_ppBoneNodes;
  z = this->m_targetPos.z;
  v10 = v8->m_wldMat.pos.y;
  v11 = v8->m_wldMat.pos.z;
  in.x = x - v8->m_wldMat.pos.x;
  in.y = y - v10;
  in.z = z - v11;
  v12 = RwV3dLength(&in);
  if ( dist )
    *dist = v12;
  return v12 <= range && this->m_blend > 0.98;
}

//----- (004D3014) --------------------------------------------------------
void __fastcall IKChainManager_c::IKChainManager_c(IKChainManager_c *this)
{
  ListItem_c::ListItem_c((ListItem_c *)this);
  ListItem_c::ListItem_c(&this->m_ikChains[1]);
  ListItem_c::ListItem_c(&this->m_ikChains[2]);
  ListItem_c::ListItem_c(&this->m_ikChains[3]);
  ListItem_c::ListItem_c(&this->m_ikChains[4]);
  ListItem_c::ListItem_c(&this->m_ikChains[5]);
  ListItem_c::ListItem_c(&this->m_ikChains[6]);
  ListItem_c::ListItem_c(&this->m_ikChains[7]);
  ListItem_c::ListItem_c(&this->m_ikChains[8]);
  ListItem_c::ListItem_c(&this->m_ikChains[9]);
  ListItem_c::ListItem_c(&this->m_ikChains[10]);
  ListItem_c::ListItem_c(&this->m_ikChains[11]);
  ListItem_c::ListItem_c(&this->m_ikChains[12]);
  ListItem_c::ListItem_c(&this->m_ikChains[13]);
  ListItem_c::ListItem_c(&this->m_ikChains[14]);
  ListItem_c::ListItem_c(&this->m_ikChains[15]);
  ListItem_c::ListItem_c(&this->m_ikChains[16]);
  ListItem_c::ListItem_c(&this->m_ikChains[17]);
  ListItem_c::ListItem_c(&this->m_ikChains[18]);
  ListItem_c::ListItem_c(&this->m_ikChains[19]);
  ListItem_c::ListItem_c(&this->m_ikChains[20]);
  ListItem_c::ListItem_c(&this->m_ikChains[21]);
  ListItem_c::ListItem_c(&this->m_ikChains[22]);
  ListItem_c::ListItem_c(&this->m_ikChains[23]);
  ListItem_c::ListItem_c(&this->m_ikChains[24]);
  ListItem_c::ListItem_c(&this->m_ikChains[25]);
  ListItem_c::ListItem_c(&this->m_ikChains[26]);
  ListItem_c::ListItem_c(&this->m_ikChains[27]);
  ListItem_c::ListItem_c(&this->m_ikChains[28]);
  ListItem_c::ListItem_c(&this->m_ikChains[29]);
  ListItem_c::ListItem_c(&this->m_ikChains[30]);
  ListItem_c::ListItem_c(&this->m_ikChains[31]);
  List_c::List_c(&this->m_ikChainList);
  List_c::List_c(&this->m_ikChainPool);
}

//----- (004D312A) --------------------------------------------------------
void __fastcall IKChainManager_c::~IKChainManager_c(IKChainManager_c *this)
{
  List_c::~List_c(&this->m_ikChainPool);
  List_c::~List_c(&this->m_ikChainList);
  ListItem_c::~ListItem_c(&this->m_ikChains[31]);
  ListItem_c::~ListItem_c(&this->m_ikChains[30]);
  ListItem_c::~ListItem_c(&this->m_ikChains[29]);
  ListItem_c::~ListItem_c(&this->m_ikChains[28]);
  ListItem_c::~ListItem_c(&this->m_ikChains[27]);
  ListItem_c::~ListItem_c(&this->m_ikChains[26]);
  ListItem_c::~ListItem_c(&this->m_ikChains[25]);
  ListItem_c::~ListItem_c(&this->m_ikChains[24]);
  ListItem_c::~ListItem_c(&this->m_ikChains[23]);
  ListItem_c::~ListItem_c(&this->m_ikChains[22]);
  ListItem_c::~ListItem_c(&this->m_ikChains[21]);
  ListItem_c::~ListItem_c(&this->m_ikChains[20]);
  ListItem_c::~ListItem_c(&this->m_ikChains[19]);
  ListItem_c::~ListItem_c(&this->m_ikChains[18]);
  ListItem_c::~ListItem_c(&this->m_ikChains[17]);
  ListItem_c::~ListItem_c(&this->m_ikChains[16]);
  ListItem_c::~ListItem_c(&this->m_ikChains[15]);
  ListItem_c::~ListItem_c(&this->m_ikChains[14]);
  ListItem_c::~ListItem_c(&this->m_ikChains[13]);
  ListItem_c::~ListItem_c(&this->m_ikChains[12]);
  ListItem_c::~ListItem_c(&this->m_ikChains[11]);
  ListItem_c::~ListItem_c(&this->m_ikChains[10]);
  ListItem_c::~ListItem_c(&this->m_ikChains[9]);
  ListItem_c::~ListItem_c(&this->m_ikChains[8]);
  ListItem_c::~ListItem_c(&this->m_ikChains[7]);
  ListItem_c::~ListItem_c(&this->m_ikChains[6]);
  ListItem_c::~ListItem_c(&this->m_ikChains[5]);
  ListItem_c::~ListItem_c(&this->m_ikChains[4]);
  ListItem_c::~ListItem_c(&this->m_ikChains[3]);
  ListItem_c::~ListItem_c(&this->m_ikChains[2]);
  ListItem_c::~ListItem_c(&this->m_ikChains[1]);
  sub_198660((ListItem_c *)this);
}

//----- (004D3242) --------------------------------------------------------
bool8 __fastcall IKChainManager_c::Init(IKChainManager_c *this)
{
  List_c *p_m_ikChainPool; // r5
  int i; // r6

  p_m_ikChainPool = &this->m_ikChainPool;
  for ( i = 0; i != 2816; i += 88 )
    List_c::AddItem(p_m_ikChainPool, (ListItem_c *)((char *)this + i));
  return 1;
}

//----- (004D326C) --------------------------------------------------------
void __fastcall IKChainManager_c::Exit(IKChainManager_c *this)
{
  List_c *p_m_ikChainList; // r8
  ListItem_c *m_head; // r5
  BoneNode_c **m_prev; // r0
  int v5; // r4
  ListItem_c *m_next; // r0

  p_m_ikChainList = &this->m_ikChainList;
  m_head = this->m_ikChainList.m_head;
  if ( m_head )
  {
    do
    {
      m_prev = (BoneNode_c **)m_head[2].m_prev;
      if ( (int)m_head[1].m_next >= 1 )
      {
        v5 = 0;
        do
        {
          BoneNodeManager_c::ReturnBoneNode(&g_boneNodeMan, m_prev[v5]);
          m_prev = (BoneNode_c **)m_head[2].m_prev;
          ++v5;
        }
        while ( v5 < (int)m_head[1].m_next );
      }
      if ( m_prev )
        operator delete[](m_prev);
      m_next = m_head->m_next;
      m_head[2].m_prev = 0;
      m_head = m_next;
    }
    while ( m_next );
  }
  List_c::RemoveAll(p_m_ikChainList);
  sub_19CBF0(&this->m_ikChainPool);
}

//----- (004D32D8) --------------------------------------------------------
void __fastcall IKChainManager_c::Reset(IKChainManager_c *this)
{
  List_c *p_m_ikChainList; // r8
  ListItem_c *m_head; // r5
  BoneNode_c **m_prev; // r0
  int v5; // r4
  ListItem_c *m_next; // r0
  int i; // r4

  p_m_ikChainList = &this->m_ikChainList;
  m_head = this->m_ikChainList.m_head;
  if ( m_head )
  {
    do
    {
      m_prev = (BoneNode_c **)m_head[2].m_prev;
      if ( (int)m_head[1].m_next >= 1 )
      {
        v5 = 0;
        do
        {
          BoneNodeManager_c::ReturnBoneNode(&g_boneNodeMan, m_prev[v5]);
          m_prev = (BoneNode_c **)m_head[2].m_prev;
          ++v5;
        }
        while ( v5 < (int)m_head[1].m_next );
      }
      if ( m_prev )
        operator delete[](m_prev);
      m_next = m_head->m_next;
      m_head[2].m_prev = 0;
      m_head = m_next;
    }
    while ( m_next );
  }
  List_c::RemoveAll(p_m_ikChainList);
  List_c::RemoveAll(&this->m_ikChainPool);
  for ( i = 0; i != 2816; i += 88 )
    List_c::AddItem(&this->m_ikChainPool, (ListItem_c *)((char *)this + i));
}

//----- (004D3358) --------------------------------------------------------
void __fastcall IKChainManager_c::Update(IKChainManager_c *this, float deltaTime)
{
  int i; // r6
  float v4; // r1
  uint16 v5; // r0
  IKChain_c *j; // r5
  CEntity *m_pPed; // r0
  bool v8; // zf

  for ( i = 0; i != 4; ++i )
  {
    LODWORD(v4) = 0xFFFF;
    if ( CWorld::ms_nCurrentScanCode == 0xFFFF )
    {
      CWorld::ClearScanCodes();
      v5 = 1;
    }
    else
    {
      v5 = CWorld::ms_nCurrentScanCode + 1;
    }
    CWorld::ms_nCurrentScanCode = v5;
    for ( j = (IKChain_c *)this->m_ikChainList.m_head; j; j = (IKChain_c *)j->m_next )
    {
      if ( i == j->m_slotId )
      {
        m_pPed = j->m_pPed;
        v8 = m_pPed == 0;
        if ( m_pPed )
        {
          LODWORD(v4) = m_pPed->m_nScanCode;
          v8 = LODWORD(v4) == CWorld::ms_nCurrentScanCode;
        }
        if ( !v8 )
        {
          CEntity::UpdateRpHAnim(m_pPed);
          LODWORD(v4) = CWorld::ms_nCurrentScanCode;
          j->m_pPed->m_nScanCode = CWorld::ms_nCurrentScanCode;
        }
        IKChain_c::Update(j, v4);
      }
    }
  }
}
// 4D33CE: variable 'v4' is possibly undefined

//----- (004D33F4) --------------------------------------------------------
ListItem_c *__fastcall IKChainManager_c::AddIKChain(
        IKChainManager_c *this,
        unsigned __int8 *idString,
        int32 slotId,
        CPed *pPed,
        int32 effectorBoneTag,
        RwV3d_0 effectorVec,
        int32 pivotBoneTag,
        CEntity *pEntity,
        int32 offsetBoneTag,
        RwV3d_0 offsetPos,
        float speed,
        int32 priority)
{
  List_c *p_m_ikChainPool; // r6
  IKChain_c *v16; // r0
  ListItem_c *v17; // r4

  p_m_ikChainPool = &this->m_ikChainPool;
  v16 = (IKChain_c *)List_c::RemoveHead(&this->m_ikChainPool);
  v17 = v16;
  if ( !v16 )
    return 0;
  if ( !IKChain_c::Init(
          v16,
          (unsigned __int8 *)pEntity,
          slotId,
          pPed,
          effectorBoneTag,
          effectorVec,
          pivotBoneTag,
          pEntity,
          offsetBoneTag,
          offsetPos,
          speed,
          priority) )
  {
    List_c::AddItem(p_m_ikChainPool, v17);
    return 0;
  }
  List_c::AddItem(&this->m_ikChainList, v17);
  return v17;
}

//----- (004D3478) --------------------------------------------------------
void __fastcall IKChainManager_c::RemoveIKChain(IKChainManager_c *this, IKChain_c *pIKChain)
{
  BoneNode_c **m_ppBoneNodes; // r0
  int32 v5; // r5

  m_ppBoneNodes = pIKChain->m_ppBoneNodes;
  if ( pIKChain->m_numBoneNodes >= 1 )
  {
    v5 = 0;
    do
    {
      BoneNodeManager_c::ReturnBoneNode(&g_boneNodeMan, m_ppBoneNodes[v5]);
      m_ppBoneNodes = pIKChain->m_ppBoneNodes;
      ++v5;
    }
    while ( v5 < pIKChain->m_numBoneNodes );
  }
  if ( m_ppBoneNodes )
    operator delete[](m_ppBoneNodes);
  pIKChain->m_ppBoneNodes = 0;
  List_c::RemoveItem(&this->m_ikChainList, pIKChain);
  sub_1955CC(&this->m_ikChainPool, pIKChain);
}

//----- (004D34D4) --------------------------------------------------------
bool8 __fastcall IKChainManager_c::CanAccept(IKChainManager_c *this, CPed *pPed, float range)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v8; // d16
  unsigned __int64 v9; // d2

  if ( !pPed->m_pRwObject || !CPed::IsAlive(pPed) || !CEntity::GetIsOnScreen(pPed) )
    return 0;
  if ( range >= 999.0 || TheCamera.PlayerWeaponMode.Mode == 7 )
    return 1;
  m_pMat = pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_m_transform = &TheCamera.m_transform;
  v8.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
  v9 = vmul_f32(v8, v8).n64_u64[0];
  return (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                               * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                       + *(float *)&v9)
               + *((float *)&v9 + 1)) <= (float)(range * range);
}

//----- (004D3580) --------------------------------------------------------
bool8 __fastcall IKChainManager_c::CanAcceptLookAt(IKChainManager_c *this, CPed *pPed)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v6; // d16
  unsigned __int64 v7; // d1
  bool8 v8; // r5
  CTaskSimpleIKManager *TaskSecondary; // r0
  CTaskSimpleIKManager *v10; // r0
  CTaskSimpleIKChain *TaskAtSlot; // r0

  if ( !pPed->m_pRwObject || !CPed::IsAlive(pPed) || !CEntity::GetIsOnScreen(pPed) )
    return 0;
  if ( TheCamera.PlayerWeaponMode.Mode != 7 )
  {
    m_pMat = pPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    v6.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
    v7 = vmul_f32(v6, v6).n64_u64[0];
    if ( (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                               * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                       + *(float *)&v7)
               + *((float *)&v7 + 1)) > 400.0 )
      return 0;
  }
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 10) & 0x40) == 0 )
  {
    if ( (pPed->m_ik.m_flags & 0x10) == 0
      && !RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x12Bu)
      && !RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x12Cu) )
    {
      v8 = 0;
      if ( !RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x12Du)
        && !RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x12Eu) )
      {
        return 1;
      }
      return v8;
    }
    return 0;
  }
  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  v8 = 0;
  if ( TaskSecondary )
  {
    if ( CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, 0) )
    {
      v10 = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
      v8 = 0;
      TaskAtSlot = CTaskSimpleIKManager::GetTaskAtSlot(v10, 0);
      if ( TaskAtSlot )
      {
        CTaskSimpleIKChain::BlendOut(TaskAtSlot, 250);
        return 0;
      }
    }
  }
  return v8;
}

//----- (004D3694) --------------------------------------------------------
bool8 __fastcall IKChainManager_c::IsLooking(IKChainManager_c *this, CPed *pPed)
{
  CTaskSimpleIKManager *TaskSecondary; // r0

  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  return TaskSecondary && CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, 0) != 0;
}

//----- (004D36BA) --------------------------------------------------------
void __fastcall IKChainManager_c::AbortLookAt(IKChainManager_c *this, CPed *pPed, int32 blendTime)
{
  CTaskSimpleIKManager *TaskSecondary; // r0
  CTaskSimpleIKChain *TaskAtSlot; // r0

  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  TaskAtSlot = CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, 0);
  if ( TaskAtSlot )
    sub_18BCA8(TaskAtSlot, blendTime);
}

//----- (004D36E2) --------------------------------------------------------
void __fastcall IKChainManager_c::LookAt(
        IKChainManager_c *this,
        unsigned __int8 *idString,
        CPed *pPed,
        CEntity *pEntity,
        int32 time,
        int32 offsetBoneTag,
        RwV3d_0 *pOffsetPos,
        int useTorso,
        float speed,
        int32 blendTime,
        int32 priority,
        int fromScript)
{
  CTaskSimpleIKManager *TaskSecondary; // r5
  __int64 v14; // r10
  RwReal z; // r9
  CPedIntelligence *m_pPedIntelligence; // r9
  CTaskSimpleIKManager *v17; // r5
  CTaskSimpleIKLookAt *TaskAtSlot; // r0
  bool8 v19; // r2
  CTaskSimpleIKLookAt *v20; // r4
  CTaskSimpleIKManager *v21; // r0
  CTaskSimpleIKChain *v22; // r0
  RwV3d_0 v23; // [sp+4h] [bp-64h]
  RwV3d_0 v24; // [sp+8h] [bp-60h]

  if ( !fromScript && !IKChainManager_c::CanAcceptLookAt(this, pPed) )
    return;
  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  if ( TaskSecondary )
  {
    if ( pOffsetPos )
    {
LABEL_5:
      v14 = *(_QWORD *)&pOffsetPos->x;
      z = pOffsetPos->z;
      goto LABEL_8;
    }
  }
  else
  {
    m_pPedIntelligence = pPed->m_pPedIntelligence;
    v17 = (CTaskSimpleIKManager *)CTask::operator new(0x1Cu);
    CTaskSimpleIKManager::CTaskSimpleIKManager(v17);
    CTaskManager::SetTaskSecondary(&m_pPedIntelligence->m_taskManager, v17, 5);
    TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
    if ( pOffsetPos )
      goto LABEL_5;
  }
  v14 = 0LL;
  z = 0.0;
LABEL_8:
  TaskAtSlot = (CTaskSimpleIKLookAt *)CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, 0);
  if ( !TaskAtSlot )
  {
    v20 = (CTaskSimpleIKLookAt *)CTask::operator new(0x5Cu);
    LODWORD(v23.x) = v14;
    *(_QWORD *)&v23.y = __PAIR64__(LODWORD(z), HIDWORD(v14));
    CTaskSimpleIKLookAt::CTaskSimpleIKLookAt(
      v20,
      idString,
      pEntity,
      time,
      offsetBoneTag,
      v23,
      useTorso,
      speed,
      blendTime,
      priority);
    sub_189EB8(TaskSecondary, v20, 0);
    return;
  }
  if ( TaskAtSlot->m_priority <= priority )
  {
    v19 = useTorso;
    if ( useTorso )
    {
      if ( !TaskAtSlot->m_useTorso )
        v19 = 0;
      goto LABEL_13;
    }
    if ( !TaskAtSlot->m_useTorso )
    {
      v19 = 0;
LABEL_13:
      LODWORD(v24.x) = v14;
      *(_QWORD *)&v24.y = __PAIR64__(LODWORD(z), HIDWORD(v14));
      CTaskSimpleIKLookAt::UpdateLookAtInfo(
        TaskAtSlot,
        idString,
        pPed,
        pEntity,
        time,
        offsetBoneTag,
        v24,
        v19,
        speed,
        blendTime,
        priority);
      return;
    }
    v21 = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
    v22 = CTaskSimpleIKManager::GetTaskAtSlot(v21, 0);
    if ( v22 )
      sub_18BCA8(v22, 250);
  }
}

//----- (004D383E) --------------------------------------------------------
CEntity *__fastcall IKChainManager_c::GetLookAtEntity(IKChainManager_c *this, CPed *pPed)
{
  CTaskSimpleIKManager *TaskSecondary; // r0
  CTaskSimpleIKLookAt *TaskAtSlot; // r0

  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  if ( TaskSecondary && (TaskAtSlot = (CTaskSimpleIKLookAt *)CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, 0)) != 0 )
    return sub_192644(TaskAtSlot);
  else
    return 0;
}

//----- (004D3866) --------------------------------------------------------
void __fastcall IKChainManager_c::GetLookAtOffset(IKChainManager_c *this, CPed *pPed, CVector *pOffset)
{
  CTaskSimpleIKManager *TaskSecondary; // r0
  CTaskSimpleIKLookAt *TaskAtSlot; // r1
  __int64 v6; // d16
  CVector v7; // [sp+0h] [bp-18h] BYREF

  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  if ( TaskSecondary )
  {
    TaskAtSlot = (CTaskSimpleIKLookAt *)CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, 0);
    if ( TaskAtSlot )
    {
      CTaskSimpleIKLookAt::GetLookAtOffset(&v7, TaskAtSlot);
      v6 = *(_QWORD *)&v7.x;
      pOffset->z = v7.z;
      *(_QWORD *)&pOffset->x = v6;
    }
    else
    {
      pOffset->x = 0.0;
      pOffset->y = 0.0;
      pOffset->z = 0.0;
    }
  }
  else
  {
    pOffset->x = 0.0;
    pOffset->y = 0.0;
    pOffset->z = 0.0;
  }
}

//----- (004D38B4) --------------------------------------------------------
void __fastcall IKChainManager_c::PointArm(
        IKChainManager_c *this,
        unsigned __int8 *idString,
        int32 armId,
        CPed *pPed,
        CEntity *pEntity,
        int32 offsetBoneTag,
        RwV3d_0 *pOffsetPos,
        float speed,
        int32 blendTime,
        float cullDist)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v16; // d16
  unsigned __int64 v17; // d1
  CTaskSimpleIKManager *TaskSecondary; // r10
  RwReal x; // r4
  RwReal y; // r6
  int z_low; // r8
  CPedIntelligence *m_pPedIntelligence; // r4
  CTaskSimpleIKManager *v23; // r10
  CTaskSimpleIKPointArm *TaskAtSlot; // r0
  CTaskSimpleIKChain *v25; // r4
  RwV3d_0 v26; // [sp+0h] [bp-58h]
  __int64 v27; // [sp+0h] [bp-58h]

  if ( pPed->m_pRwObject && CPed::IsAlive(pPed) && CEntity::GetIsOnScreen(pPed) )
  {
    if ( cullDist >= 999.0 || TheCamera.PlayerWeaponMode.Mode == 7 )
      goto LABEL_11;
    m_pMat = pPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    v16.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
    v17 = vmul_f32(v16, v16).n64_u64[0];
    if ( (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                               * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                       + *(float *)&v17)
               + *((float *)&v17 + 1)) <= (float)(cullDist * cullDist) )
    {
LABEL_11:
      TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(
                                                &pPed->m_pPedIntelligence->m_taskManager,
                                                5);
      if ( TaskSecondary )
      {
        if ( pOffsetPos )
        {
LABEL_13:
          x = pOffsetPos->x;
          y = pOffsetPos->y;
          z_low = LODWORD(pOffsetPos->z);
          goto LABEL_16;
        }
      }
      else
      {
        m_pPedIntelligence = pPed->m_pPedIntelligence;
        v23 = (CTaskSimpleIKManager *)CTask::operator new(0x1Cu);
        CTaskSimpleIKManager::CTaskSimpleIKManager(v23);
        CTaskManager::SetTaskSecondary(&m_pPedIntelligence->m_taskManager, v23, 5);
        TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(
                                                  &pPed->m_pPedIntelligence->m_taskManager,
                                                  5);
        if ( pOffsetPos )
          goto LABEL_13;
      }
      x = 0.0;
      y = 0.0;
      z_low = 0;
LABEL_16:
      TaskAtSlot = (CTaskSimpleIKPointArm *)CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, armId + 1);
      if ( TaskAtSlot )
      {
        v26.x = x;
        *(_QWORD *)&v26.y = __PAIR64__(z_low, LODWORD(y));
        CTaskSimpleIKPointArm::UpdatePointArmInfo(TaskAtSlot, idString, pEntity, offsetBoneTag, v26, speed, blendTime);
      }
      else
      {
        v27 = __PAIR64__(LODWORD(x), offsetBoneTag);
        v25 = (CTaskSimpleIKChain *)CTask::operator new(0x5Cu);
        CTaskSimpleIKPointArm::CTaskSimpleIKPointArm(
          (int)v25,
          (int)idString,
          armId,
          pEntity,
          v27,
          SLODWORD(y),
          z_low,
          SLODWORD(speed),
          blendTime);
        sub_189EB8(TaskSecondary, v25, armId + 1);
      }
    }
  }
}

//----- (004D3A44) --------------------------------------------------------
bool8 __fastcall IKChainManager_c::IsArmPointing(IKChainManager_c *this, int32 armId, CPed *pPed)
{
  CTaskSimpleIKManager *TaskSecondary; // r0

  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  return TaskSecondary && CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, armId + 1) != 0;
}

//----- (004D3A6A) --------------------------------------------------------
void __fastcall IKChainManager_c::AbortPointArm(IKChainManager_c *this, int32 armId, CPed *pPed, int32 blendTime)
{
  CTaskSimpleIKManager *TaskSecondary; // r0
  CTaskSimpleIKChain *TaskAtSlot; // r0

  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  TaskAtSlot = CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, armId + 1);
  if ( TaskAtSlot )
    sub_18BCA8(TaskAtSlot, blendTime);
}

//----- (004D3A94) --------------------------------------------------------
bool8 __fastcall IKChainManager_c::IsFacingTarget(IKChainManager_c *this, CPed *pPed, int32 slotId)
{
  CTaskSimpleIKManager *TaskSecondary; // r0
  CTaskSimpleIKChain *TaskAtSlot; // r0
  IKChain_c *IKChain; // r0

  TaskSecondary = (CTaskSimpleIKManager *)CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 5);
  if ( !TaskSecondary )
    return 0;
  TaskAtSlot = CTaskSimpleIKManager::GetTaskAtSlot(TaskSecondary, slotId);
  if ( !TaskAtSlot )
    return 0;
  IKChain = CTaskSimpleIKChain::GetIKChain(TaskAtSlot);
  return IKChain_c::IsFacingTarget(IKChain);
}

//----- (004D3AC0) --------------------------------------------------------
GxtChar *__fastcall GetSavedGameDateAndTime(int SlotNumber)
{
  return CGenericGameStorage::ms_SlotSaveDate[SlotNumber];
}

//----- (004D3AD4) --------------------------------------------------------
void __fastcall CDate::CDate(CDate *this)
{
  this->Year = 0;
  *(_QWORD *)&this->Sec = 0LL;
  *(_QWORD *)&this->Hour = 0LL;
  this->Month = 0;
}

//----- (004D3AE6) --------------------------------------------------------
bool __fastcall CDate::operator>(const CDate *this, const CDate *RhsDate)
{
  UInt32 Year; // r2
  UInt32 v3; // r3
  UInt32 Month; // r2
  UInt32 v5; // r3
  UInt32 Day; // r2
  UInt32 v7; // r3
  UInt32 Hour; // r2
  UInt32 v9; // r3
  bool result; // r0

  Year = RhsDate->Year;
  v3 = this->Year;
  result = 1;
  if ( v3 <= Year )
  {
    if ( v3 != Year )
      return 0;
    Month = RhsDate->Month;
    v5 = this->Month;
    if ( v5 <= Month )
    {
      if ( v5 != Month )
        return 0;
      Day = RhsDate->Day;
      v7 = this->Day;
      if ( v7 <= Day )
      {
        if ( v7 != Day )
          return 0;
        Hour = RhsDate->Hour;
        v9 = this->Hour;
        if ( v9 <= Hour && (v9 != Hour || *(_QWORD *)&this->Sec <= *(_QWORD *)&RhsDate->Sec) )
          return 0;
      }
    }
  }
  return result;
}

//----- (004D3B28) --------------------------------------------------------
bool __fastcall CDate::operator<(const CDate *this, const CDate *RhsDate)
{
  UInt32 Year; // r2
  UInt32 v3; // r3
  UInt32 Month; // r2
  UInt32 v5; // r3
  UInt32 Day; // r2
  UInt32 v7; // r3
  UInt32 Hour; // r2
  UInt32 v9; // r3
  bool result; // r0

  Year = RhsDate->Year;
  v3 = this->Year;
  result = 1;
  if ( v3 >= Year )
  {
    if ( v3 != Year )
      return 0;
    Month = RhsDate->Month;
    v5 = this->Month;
    if ( v5 >= Month )
    {
      if ( v5 != Month )
        return 0;
      Day = RhsDate->Day;
      v7 = this->Day;
      if ( v7 >= Day )
      {
        if ( v7 != Day )
          return 0;
        Hour = RhsDate->Hour;
        v9 = this->Hour;
        if ( v9 >= Hour && (v9 != Hour || *(_QWORD *)&this->Sec >= *(_QWORD *)&RhsDate->Sec) )
          return 0;
      }
    }
  }
  return result;
}

//----- (004D3B6A) --------------------------------------------------------
bool __fastcall CDate::operator==(const CDate *this, const CDate *RhsDate)
{
  return this->Year == RhsDate->Year
      && this->Month == RhsDate->Month
      && this->Day == RhsDate->Day
      && this->Hour == RhsDate->Hour
      && this->Min == RhsDate->Min
      && this->Sec == RhsDate->Sec;
}

//----- (004D3BA2) --------------------------------------------------------
void __fastcall CDate::PopulateDateFields(
        CDate *this,
        const unsigned __int8 *SecPara,
        const unsigned __int8 *MinPara,
        const unsigned __int8 *HourPara,
        const unsigned __int8 *DayPara,
        const unsigned __int8 *MonthPara,
        UInt32 YearPara)
{
  this->Sec = *SecPara;
  this->Min = *MinPara;
  this->Hour = *HourPara;
  this->Day = *DayPara;
  this->Month = *MonthPara;
  this->Year = YearPara;
}

//----- (004D3BC2) --------------------------------------------------------
UInt32 __fastcall CGenericGameStorage::GetSavedRadioStationPosition(Int32 i)
{
  return 0;
}

//----- (004D3BC8) --------------------------------------------------------
void CGenericGameStorage::DoAnytimeSavingStuffAfterSucessLoad()
{
  if ( anytimeMissionScript[0] )
  {
    SkipBriefsClear = 1;
    CText::LoadMissionText(&TheText, anytimeMissionScript);
    SkipBriefsClear = 0;
  }
  CMessages::ReloadPreviousBriefArray();
  anytimeMissionScript[0] = 0;
}

//----- (004D3C18) --------------------------------------------------------
void CGenericGameStorage::DoGameSpecificStuffAfterSucessLoad()
{
  bool v0; // r4
  CSimpleTransform *p_m_transform; // r6
  CSimpleTransform *p_tx; // r0

  v0 = 0;
  SkipBriefsClear = 1;
  CText::Load(&TheText, 0);
  SkipBriefsClear = 0;
  CCollision::SortOutCollisionAfterLoad();
  p_m_transform = &TheCamera.m_transform;
  p_tx = &TheCamera.m_transform;
  if ( TheCamera.m_pMat )
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  CStreaming::LoadSceneCollision(&p_tx->m_translate);
  if ( TheCamera.m_pMat )
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  CStreaming::LoadScene(&p_m_transform->m_translate);
  CStreaming::LoadAllRequestedModels(0);
  CGame::TidyUpMemory(1, 0);
  StillToFadeOut = 1;
  JustLoadedDontFadeInYet = 1;
  CCamera::Fade(&TheCamera, 0.0, 0);
  if ( IsMissionSave )
    CWorld::Process();
  CTheScripts::Process();
  CTagManager::UpdateNumTagged();
  CClothes::RebuildPlayer(CWorld::Players[0].pPed, 0);
  CPopCycle::Update();
  CStreaming::RemoveInappropriatePedModels();
  CGangWars::ClearSpecificZonesToTriggerGangWar();
  CGangWars::bTrainingMission = 0;
  if ( !CGangWars::bGangWarsActive )
    v0 = 1;
  sub_199EFC(v0);
}

//----- (004D3D10) --------------------------------------------------------
void CGenericGameStorage::DoGameSpecificStuffBeforeSave()
{
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v1; // r0

  CRopes::Shutdown();
  CPickups::RemovePickupObjects();
  CWorld::Players[0].pPed->m_nHealth = (float)CWorld::Players[0].MaxHealth;
  CGangWars::EndGangWar(0);
  CStats::IncrementStat(0x88u, 1.0);
  CGameLogic::PassTime(0x168u);
  CWorld::Players[CWorld::PlayerInFocus].TimeLastEaten = 0;
  PlayerPed = FindPlayerPed(-1);
  CPlayerPed::ResetSprintEnergy(PlayerPed);
  v1 = FindPlayerPed(-1);
  CPlayerPed::SetWantedLevel(v1, 0);
  j_CGame::TidyUpMemory(1, 0);
}

//----- (004D3D96) --------------------------------------------------------
int CGenericGameStorage::RestoreForStartLoad()
{
  return 0;
}

//----- (004D3D9C) --------------------------------------------------------
void __fastcall C_PcSave::SetSaveDirectory(const unsigned __int8 *pDirName)
{
  sprintf(DefaultPCSaveFileName, "%s\\%s", (const char *)pDirName, "GTASAmf");
  sprintf(DefaultPCSaveFileName, "%s\\%s", (const char *)pDirName, "GTASAsf");
}
// 6776F8: using guessed type char (*DefaultPCSaveFileName_ptr)[260];

//----- (004D3DEC) --------------------------------------------------------
Int8 __fastcall C_PcSave::SaveSlot(C_PcSave *this, int8 SlotNum, bool QuickSave)
{
  int v3; // r4
  _BOOL4 v4; // r5
  _BOOL4 v5; // r5
  _BOOL4 v6; // r0
  bool v7; // zf
  _BOOL4 v8; // r1
  Int8 result; // r0
  int v10; // r8
  void *v11; // r5
  OSFile intoFile; // [sp+4h] [bp-14h] BYREF

  v3 = SlotNum;
  v4 = QuickSave;
  g_bSaving = 1;
  CGenericGameStorage::MakeValidSaveName(SlotNum);
  PcSaveHelper.ErrorCode = 0;
  CFileMgr::SetDirMyDocuments();
  if ( !v4 )
    CGenericGameStorage::DoGameSpecificStuffBeforeSave();
  v5 = CGenericGameStorage::GenericSave(0);
  CFileMgr::SetDir((const unsigned __int8 *)&byte_61CADE);
  if ( v5 )
  {
    v6 = IsSCCloudAvailable();
    v7 = (v3 & 0xFFFFFFFE) == 6;
    v8 = v6;
    result = 0;
    if ( (v3 & 0xFFFFFFFE) == 6 )
      v7 = v8;
    if ( v7 )
    {
      if ( OS_FileOpen(OSFDA_User_0, &intoFile, CGenericGameStorage::ms_ValidSaveName, OSFAT_Read_0) == OSFE_NoError )
      {
        v10 = OS_FileSize(intoFile);
        v11 = malloc(v10);
        OS_FileRead(intoFile, v11, v10);
        OS_FileClose(intoFile);
        SaveGameToSCCloud(v3 - 6, (const unsigned __int8 *)v11, v10);
        free(v11);
      }
      result = 0;
    }
  }
  else
  {
    result = 2;
  }
  g_bSaving = 0;
  return result;
}
// 61CADE: using guessed type char byte_61CADE;

//----- (004D3EB8) --------------------------------------------------------
void __fastcall C_PcSave::GenerateGameFilename(C_PcSave *this, int SlotIndex, unsigned __int8 *pString)
{
  char (**v5)[260]; // r0
  int RockstarID; // [sp+0h] [bp-10h]

  if ( FrontEndMenuManager.m_UseDebugScripts )
  {
    v5 = &MarketingPCSaveFileName_ptr;
  }
  else
  {
    if ( IsCloudSlot(SlotIndex) )
    {
      RockstarID = GetRockstarID();
      sprintf(pString, "%s%i_%s%s", DefaultPCSaveFileName, SlotIndex + 1, RockstarID, &dword_4D3F18);
      return;
    }
    v5 = &DefaultPCSaveFileName_ptr;
  }
  sprintf(pString, "%s%i%s", *v5, SlotIndex + 1, &dword_4D3F18);
}
// 198C68: using guessed type int GetRockstarID(void);
// 4D3F18: using guessed type int dword_4D3F18;
// 6776F8: using guessed type char (*DefaultPCSaveFileName_ptr)[260];
// 678A28: using guessed type char (*MarketingPCSaveFileName_ptr)[260];

//----- (004D3F30) --------------------------------------------------------
void __fastcall C_PcSave::PopulateSlotInfo(C_PcSave *this)
{
  int v1; // r9
  GxtChar (*v2)[260]; // r8
  int32 v3; // r0
  u_native v4; // r0
  void *v5; // r10
  Char *v6; // r0
  GxtChar *v7; // r0
  __int64 *v8; // r1
  __int64 v9; // d16
  __int64 v10; // d17
  __int64 v11; // d18
  __int64 v12; // d19
  __int64 v13; // d20
  __int64 v14; // d21
  GxtChar *v15; // r0
  uint32 savedKey; // [sp+24h] [bp-304h] BYREF
  _QWORD v17[53]; // [sp+28h] [bp-300h] BYREF
  __int64 pInString[6]; // [sp+1D0h] [bp-158h] BYREF
  unsigned __int8 pString[260]; // [sp+204h] [bp-124h] BYREF

  v1 = 0;
  *(_QWORD *)CGenericGameStorage::ms_Slots = 0x100000001LL;
  *(_QWORD *)&CGenericGameStorage::ms_Slots[2] = 0x100000001LL;
  v2 = CGenericGameStorage::ms_SlotFileName;
  *(_QWORD *)&CGenericGameStorage::ms_Slots[4] = 0x100000001LL;
  *(_QWORD *)&CGenericGameStorage::ms_Slots[6] = 0x100000001LL;
  CGenericGameStorage::ms_Slots[8] = 1;
  CGenericGameStorage::ms_SlotFileName[0][0] = 0;
  CGenericGameStorage::ms_SlotFileName[1][0] = 0;
  CGenericGameStorage::ms_SlotFileName[2][0] = 0;
  CGenericGameStorage::ms_SlotFileName[3][0] = 0;
  CGenericGameStorage::ms_SlotFileName[4][0] = 0;
  CGenericGameStorage::ms_SlotFileName[5][0] = 0;
  CGenericGameStorage::ms_SlotFileName[6][0] = 0;
  CGenericGameStorage::ms_SlotFileName[7][0] = 0;
  CGenericGameStorage::ms_SlotFileName[8][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[0][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[1][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[2][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[3][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[4][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[5][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[6][0] = 0;
  CGenericGameStorage::ms_SlotSaveDate[7][0] = 0;
  PcSaveHelper.ErrorCode = 0;
  CGenericGameStorage::ms_SlotSaveDate[8][0] = 0;
  v3 = (int32)&TheText;
  do
  {
    C_PcSave::GenerateGameFilename((C_PcSave *)v3, v1, pString);
    CFileMgr::SetDirMyDocuments();
    v4 = CFileMgr::OpenFile(pString, (const unsigned __int8 *)&dword_4D4124);
    v5 = (void *)v4;
    if ( v4 )
    {
      CFileMgr::Seek(v4, 5, 0);
      OS_FileRead(v5, &savedKey, 428);
      if ( (int)CGenericGameStorage::GetSavedVersionNumber(savedKey) >= 2
        && strncmp((const char *)v17, (const char *)TopLineEmptyFile, 0x1Au) )
      {
        CGenericGameStorage::ms_Slots[v1] = 0;
        pInString[4] = v17[4];
        pInString[5] = v17[5];
        pInString[0] = v17[0];
        pInString[1] = v17[1];
        pInString[2] = v17[2];
        pInString[3] = v17[3];
        v6 = GxtCharToAscii((GxtChar *)pInString, 0);
        v7 = CText::Get(&TheText, v6);
        v8 = (__int64 *)(v7 + 16);
        v9 = *(_QWORD *)v7;
        v10 = *((_QWORD *)v7 + 1);
        v7 += 8;
        v11 = *(_QWORD *)v7;
        v12 = *((_QWORD *)v7 + 1);
        v13 = *v8;
        v14 = v8[1];
        (*v2)[24] = 0;
        *(_QWORD *)&(*v2)[16] = v13;
        *(_QWORD *)&(*v2)[20] = v14;
        *(_QWORD *)v2 = v9;
        *(_QWORD *)&(*v2)[4] = v10;
        *(_QWORD *)&(*v2)[8] = v11;
        *(_QWORD *)&(*v2)[12] = v12;
      }
      CFileMgr::CloseFile((u_native)v5);
    }
    v3 = CGenericGameStorage::ms_Slots[v1];
    if ( !v3 )
    {
      v3 = CGenericGameStorage::CheckDataNotCorrupt(v1, pString);
      if ( !v3 )
      {
        v15 = CText::Get(&TheText, "FEC_SLC");
        CMessages::InsertNumberInString(v15, v1 + 1, -1, -1, -1, -1, -1, (GxtChar *)v2);
      }
    }
    ++v1;
    ++v2;
  }
  while ( v1 != 9 );
  CFileMgr::SetDir((const unsigned __int8 *)&byte_61CADE);
}
// 4D3FFA: variable 'v3' is possibly undefined
// 4D4124: using guessed type int dword_4D4124;
// 61CADE: using guessed type char byte_61CADE;

//----- (004D414C) --------------------------------------------------------
bool __fastcall C_PcSave::DeleteSlot(C_PcSave *this, int8 SlotNumber)
{
  int v2; // r4
  char (**v3)[260]; // r1
  bool v4; // r4
  u_native v5; // r0
  int RockstarID; // [sp+0h] [bp-118h]
  unsigned __int8 s[260]; // [sp+8h] [bp-110h] BYREF

  v2 = SlotNumber;
  PcSaveHelper.ErrorCode = 0;
  if ( FrontEndMenuManager.m_UseDebugScripts )
  {
    v3 = &MarketingPCSaveFileName_ptr;
  }
  else
  {
    if ( IsCloudSlot(SlotNumber) )
    {
      RockstarID = GetRockstarID();
      sprintf(s, "%s%i_%s%s", DefaultPCSaveFileName, v2 + 1, RockstarID, &dword_4D4208);
      goto LABEL_7;
    }
    v3 = &DefaultPCSaveFileName_ptr;
  }
  sprintf(s, "%s%i.b", *v3, v2 + 1);
LABEL_7:
  v4 = 1;
  OS_FileDelete(OSFDA_User_0, s);
  v5 = CFileMgr::OpenFile(s, (const unsigned __int8 *)&dword_4D420C);
  if ( v5 )
  {
    CFileMgr::CloseFile(v5);
    return 0;
  }
  return v4;
}
// 198C68: using guessed type int GetRockstarID(void);
// 4D4208: using guessed type int dword_4D4208;
// 4D420C: using guessed type int dword_4D420C;
// 6776F8: using guessed type char (*DefaultPCSaveFileName_ptr)[260];
// 678A28: using guessed type char (*MarketingPCSaveFileName_ptr)[260];

//----- (004D4220) --------------------------------------------------------
RwUInt8 __fastcall RsKeyFromScanCode(RwUInt8 scan, RwBool shiftKeyDown)
{
  RwUInt16 *v2; // r3

  v2 = KeysShifted;
  if ( !shiftKeyDown )
    v2 = KeysNormal;
  return v2[scan];
}

//----- (004D4244) --------------------------------------------------------
void __fastcall RsErrorMessage(const RwChar *text)
{
  int v2[3]; // [sp+4h] [bp-Ch] BYREF

  v2[0] = 1056;
  if ( RsGlobal.keyboard.used )
    RsGlobal.keyboard.inputEventHandler(rsKEYUP, v2);
  psErrorMessage(text);
}
// 4D4244: using guessed type int var_C[3];

//----- (004D427C) --------------------------------------------------------
RsEventStatus_0 __fastcall RsKeyboardEventHandler(RsEvent_0 event, void *param)
{
  if ( RsGlobal.keyboard.used )
    return RsGlobal.keyboard.inputEventHandler(event, param);
  else
    return 2;
}

//----- (004D42A0) --------------------------------------------------------
void __fastcall RsWarningMessage(const RwChar *text)
{
  int v2[3]; // [sp+4h] [bp-Ch] BYREF

  v2[0] = 1056;
  if ( RsGlobal.keyboard.used )
    RsGlobal.keyboard.inputEventHandler(rsKEYUP, v2);
  psWarningMessage(text);
}
// 4D42A0: using guessed type int var_C[3];

//----- (004D42E8) --------------------------------------------------------
RwBool RsRegisterImageLoader()
{
  return 1;
}

//----- (004D42F8) --------------------------------------------------------
RwBool __fastcall RsInputDeviceAttach(RsInputDeviceType_0 inputDevice, RsInputEventHandler inputEventHandler)
{
  RwBool result; // r0
  RsInputEventHandler *v3; // r2
  _DWORD *v4; // r3

  if ( (unsigned int)inputDevice > rsPAD )
    return 0;
  v3 = (RsInputEventHandler *)*(&off_6693CC + inputDevice);
  v4 = *(&off_6693D8 + inputDevice);
  result = 1;
  *v3 = inputEventHandler;
  *v4 = 1;
  return result;
}
// 6693CC: using guessed type void *off_6693CC;
// 6693D8: using guessed type void *off_6693D8;

//----- (004D4320) --------------------------------------------------------
RsEventStatus_0 __fastcall RsMouseEventHandler(RsEvent_0 event, void *param)
{
  if ( RsGlobal.mouse.used )
    return RsGlobal.mouse.inputEventHandler(event, param);
  else
    return 2;
}

//----- (004D4344) --------------------------------------------------------
RsEventStatus_0 __fastcall RsPadEventHandler(RsEvent_0 event, void *param)
{
  if ( RsGlobal.pad.used )
    return RsGlobal.pad.inputEventHandler(event, param);
  else
    return 2;
}

//----- (004D4368) --------------------------------------------------------
void QuitApp()
{
  RsGlobal.quit = 1;
}

//----- (004D4380) --------------------------------------------------------
RsEventStatus_0 __fastcall RsEventHandler(RsEvent_0 event, void *param)
{
  RsEventStatus_0 result; // r0
  RwBool v5; // r0

  result = AppEventHandler(event, param);
  if ( event == rsQUITAPP )
    RsGlobal.quit = 1;
  if ( result == rsEVENTNOTPROCESSED )
  {
    result = rsEVENTNOTPROCESSED;
    switch ( event )
    {
      case rsCOMMANDLINE:
        AppEventHandler(rsFILELOAD, param);
        return 1;
      case rsINITDEBUG:
      case rsREGISTERIMAGELOADER:
        return 1;
      case rsRWINITIALIZE:
        v5 = RsRwInitialize(param);
        goto LABEL_11;
      case rsRWTERMINATE:
        RwEngineStop();
        RwEngineClose();
        RwEngineTerm();
        return 1;
      case rsSELECTDEVICE:
        v5 = psSelectDevice();
        goto LABEL_11;
      case rsINITIALIZE:
        RsGlobal.appName = (const RwChar *)"GTA: San Andreas";
        RsGlobal.keyboard.inputDeviceType = rsKEYBOARD;
        RsGlobal.keyboard.used = 0;
        RsGlobal.keyboard.inputEventHandler = 0;
        RsGlobal.mouse.inputDeviceType = rsMOUSE;
        RsGlobal.mouse.used = 0;
        RsGlobal.mouse.inputEventHandler = 0;
        RsGlobal.pad.inputDeviceType = rsPAD;
        RsGlobal.pad.used = 0;
        RsGlobal.pad.inputEventHandler = 0;
        *(_QWORD *)&RsGlobal.screenWidth = 0x1E000000280LL;
        *(_QWORD *)&RsGlobal.maxFPS = 30LL;
        v5 = psInitialize();
LABEL_11:
        result = v5 != 0;
        break;
      case rsTERMINATE:
        psTerminate();
        result = rsEVENTPROCESSED;
        break;
      case rsPREINITCOMMANDLINE:
        result = strcmp((const char *)param, "-vms") == 0;
        break;
      default:
        return result;
    }
  }
  return result;
}

//----- (004D4484) --------------------------------------------------------
void RsRwTerminate()
{
  RwEngineStop();
  RwEngineClose();
  sub_194270();
}

//----- (004D4498) --------------------------------------------------------
RwBool __fastcall RsRwInitialize(void *displayID)
{
  const RwMemoryFunctions_0 *MemoryFunctions; // r0
  RwBool v3; // r4
  __int32 v4; // r0
  RwEngineOpenParams_0 initParams; // [sp+4h] [bp-Ch] BYREF

  MemoryFunctions = psGetMemoryFunctions();
  v3 = 0;
  if ( RwEngineInit(MemoryFunctions, 0, 0x400000u) )
  {
    v3 = 0;
    AppEventHandler(rsINITDEBUG, 0);
    psInstallFileSystem();
    if ( AppEventHandler(rsPLUGINATTACH, 0) )
    {
      v3 = 0;
      if ( AppEventHandler(rsINPUTDEVICEATTACH, 0) )
      {
        initParams.displayID = displayID;
        if ( RwEngineOpen(&initParams) )
        {
          v4 = AppEventHandler(rsSELECTDEVICE, displayID);
          if ( v4 == 2 )
            v4 = psSelectDevice() != 0;
          if ( v4 && RwEngineStart() )
          {
            AppEventHandler(rsREGISTERIMAGELOADER, 0);
            psNativeTextureSupport();
            v3 = 1;
            RwTextureSetMipmapping(1);
            RwTextureSetAutoMipmapping(0);
            return v3;
          }
          RwEngineClose();
        }
        RwEngineTerm();
        return 0;
      }
    }
  }
  return v3;
}

//----- (004D4530) --------------------------------------------------------
RwBool RsInitialize()
{
  RsGlobal.appName = (const RwChar *)"GTA: San Andreas";
  RsGlobal.pad.inputEventHandler = 0;
  RsGlobal.keyboard.inputDeviceType = rsKEYBOARD;
  RsGlobal.keyboard.used = 0;
  RsGlobal.keyboard.inputEventHandler = 0;
  RsGlobal.mouse.inputDeviceType = rsMOUSE;
  RsGlobal.mouse.used = 0;
  RsGlobal.mouse.inputEventHandler = 0;
  RsGlobal.pad.inputDeviceType = rsPAD;
  RsGlobal.pad.used = 0;
  *(_QWORD *)&RsGlobal.screenWidth = 0x1E000000280LL;
  *(_QWORD *)&RsGlobal.maxFPS = 30LL;
  return sub_193C48();
}

//----- (004D4590) --------------------------------------------------------
RwBool __fastcall RsSetModelTexturePath(const RwChar *objectPathName)
{
  int Separator; // r4
  int v3; // r0
  int v4; // r1
  bool v5; // zf
  int v6; // r0
  int v7; // r1
  char v9[16]; // [sp+4h] [bp-824h] BYREF
  char v10[1024]; // [sp+14h] [bp-814h] BYREF
  RwChar v11[1024]; // [sp+414h] [bp-414h] BYREF

  Separator = psPathGetSeparator();
  (*((void (__fastcall **)(RwChar *, const RwChar *))RwEngineInstance + 62))(v11, objectPathName);
  v3 = (*((int (__fastcall **)(RwChar *))RwEngineInstance + 70))(v11);
  while ( v3 >= 1 )
  {
    v4 = v3 - 1;
    v5 = v11[--v3] == 46;
    if ( v5 )
    {
      v11[v4] = Separator;
      *(_WORD *)&v11[v4 + 1] = 59;
      break;
    }
  }
  (*((void (__fastcall **)(char *, const RwChar *))RwEngineInstance + 62))(v10, objectPathName);
  v6 = (*((int (__fastcall **)(char *))RwEngineInstance + 70))(v10);
  while ( v6 >= 1 )
  {
    v7 = v6 - 1;
    v5 = (unsigned __int8)v10[--v6] == Separator;
    if ( v5 )
    {
      v10[v7 + 1] = 0;
      break;
    }
  }
  (*((void (**)(char *, const char *, ...))RwEngineInstance + 60))(v9, "textures%c", Separator);
  (*((void (__fastcall **)(RwChar *, char *))RwEngineInstance + 64))(v11, v10);
  (*((void (__fastcall **)(RwChar *, char *))RwEngineInstance + 64))(v11, v9);
  RwImageSetPath(v11);
  return 1;
}
// 4D4590: using guessed type RwChar var_414[1024];
// 4D4590: using guessed type char var_814[1024];

//----- (004D46A0) --------------------------------------------------------
RwBool __fastcall RsSetPresetView(RwCamera_0 *camera, RwInt32 viewNum)
{
  RwBool result; // r0
  bool v4; // cc
  int v5; // r0
  PresetView_0 *v6; // r5
  RwFrame_0 *parent; // r6

  result = 0;
  if ( camera && NumPresetViews )
  {
    v4 = viewNum <= 0;
    result = 0;
    if ( viewNum >= 0 )
      v4 = NumPresetViews <= viewNum;
    if ( !v4 )
    {
      CurrentPresetView = viewNum;
      v5 = NumPresetViews - viewNum;
      v6 = PresetViews;
      parent = (RwFrame_0 *)camera->object.object.parent;
      if ( NumPresetViews - viewNum >= 2 )
      {
        while ( v6 )
        {
          v6 = v6->next;
          if ( v5 < 3 )
            break;
          --v5;
        }
      }
      RwFrameSetIdentity((RwFrame_0 *)camera->object.object.parent);
      RwFrameRotate(parent, &Xaxis, COERCE_RWREAL(LODWORD(v6->el) ^ 0x80000000), rwCOMBINEREPLACE);
      RwFrameRotate(parent, &Yaxis, v6->az, rwCOMBINEPOSTCONCAT);
      RwFrameTranslate(parent, &v6->pos, rwCOMBINEPOSTCONCAT);
      RwFrameUpdateObjects(parent);
      RwCameraSetNearClipPlane(camera, v6->nearClip);
      RwCameraSetFarClipPlane(camera, v6->farClip);
      return 1;
    }
  }
  return result;
}

//----- (004D4744) --------------------------------------------------------
RwBool __fastcall RsSetNextPresetView(RwCamera_0 *camera)
{
  RwBool result; // r0
  RwInt32 v3; // r1

  result = 0;
  if ( camera && NumPresetViews )
  {
    v3 = CurrentPresetView + 1;
    if ( CurrentPresetView + 1 >= NumPresetViews )
      v3 = 0;
    CurrentPresetView = v3;
    return RsSetPresetView(camera, v3) != 0;
  }
  return result;
}

//----- (004D4784) --------------------------------------------------------
RwBool __fastcall RsSetPreviousPresetView(RwCamera_0 *camera)
{
  RwBool result; // r0
  RwInt32 v3; // r1

  result = 0;
  if ( camera && NumPresetViews )
  {
    v3 = CurrentPresetView - 1;
    if ( CurrentPresetView < 1 )
      v3 = NumPresetViews - 1;
    CurrentPresetView = v3;
    return RsSetPresetView(camera, v3) != 0;
  }
  return result;
}

//----- (004D47C4) --------------------------------------------------------
RwBool RsDestroyPresetViews()
{
  PresetView_0 *v0; // r4
  __int64 v1; // kr00_8
  RwBool result; // r0

  v0 = PresetViews;
  if ( PresetViews )
  {
    do
    {
      v1 = *(_QWORD *)&v0->description;
      if ( (_DWORD)v1 )
        CMemoryMgr::Free((void *)v1);
      CMemoryMgr::Free(v0);
      v0 = (PresetView_0 *)HIDWORD(v1);
    }
    while ( HIDWORD(v1) );
  }
  NumPresetViews = 0;
  result = 1;
  PresetViews = 0;
  return result;
}

//----- (004D4808) --------------------------------------------------------
RwBool RsLoadPresetViews()
{
  PresetView_0 *v0; // r4
  __int64 v1; // kr00_8
  RwFileFunctions_0 *FileInterface; // r10
  RwChar *v3; // r6
  int v4; // r9
  char *v5; // r11
  char *v6; // r6
  unsigned __int8 v7; // r4
  unsigned __int8 *v8; // r5
  int v9; // t1
  int v10; // r0
  char *v11; // r4
  PresetView_0 *v12; // r0
  PresetView_0 *v13; // r11
  double v14; // d16
  int v15; // r0
  RwChar *v16; // r0
  RwBool result; // r0
  RwReal v18; // [sp+38h] [bp-488h] BYREF
  RwReal v19; // [sp+3Ch] [bp-484h] BYREF
  double v20; // [sp+40h] [bp-480h] BYREF
  RwReal v21[2]; // [sp+48h] [bp-478h] BYREF
  RwReal v22; // [sp+50h] [bp-470h] BYREF
  RwReal v23; // [sp+54h] [bp-46Ch] BYREF
  int v24; // [sp+58h] [bp-468h] BYREF
  char v25[64]; // [sp+5Ch] [bp-464h] BYREF
  unsigned __int8 v26; // [sp+9Ch] [bp-424h] BYREF
  _BYTE v27[3]; // [sp+9Dh] [bp-423h] BYREF

  v0 = PresetViews;
  if ( PresetViews )
  {
    do
    {
      v1 = *(_QWORD *)&v0->description;
      if ( (_DWORD)v1 )
        CMemoryMgr::Free((void *)v1);
      CMemoryMgr::Free(v0);
      v0 = (PresetView_0 *)HIDWORD(v1);
    }
    while ( HIDWORD(v1) );
  }
  NumPresetViews = 0;
  PresetViews = 0;
  CurrentPresetView = -1;
  FileInterface = RwOsGetFileInterface();
  if ( !FileInterface )
    goto LABEL_21;
  v3 = psPathnameCreate(ViewsFileName);
  v4 = (int)FileInterface->rwfopen(v3, (const RwChar *)&dword_4D4A8C);
  psPathnameDestroy(v3);
  if ( !v4 )
    goto LABEL_21;
  v5 = (char *)&v26;
  if ( !FileInterface->rwfgets(&v26, 1023, (void *)v4) )
  {
LABEL_20:
    FileInterface->rwfclose((void *)v4);
LABEL_21:
    result = NumPresetViews;
    if ( NumPresetViews )
      return 1;
    return result;
  }
  while ( 1 )
  {
    v6 = (char *)&v26;
    (*((void (__fastcall **)(unsigned __int8 *))RwEngineInstance + 70))(&v26);
    v7 = v26;
    if ( v26 )
    {
      v8 = v27;
      v6 = (char *)&v26;
      do
      {
        if ( isprint(v7) )
          *v6++ = v7;
        v9 = *v8++;
        v7 = v9;
      }
      while ( v9 );
    }
    *v6 = 0;
    v10 = (*((int (**)(char *, const char *, ...))RwEngineInstance + 74))(
            v5,
            "%f%f%f%f%f%f%f %[^",
            &v20,
            (char *)&v20 + 4,
            v21,
            &v23,
            &v22,
            &v18,
            &v19,
            v25);
    if ( v10 <= 6 )
      goto LABEL_19;
    v11 = v5;
    if ( v10 == 7 )
      (*((void (**)(char *, const char *, ...))RwEngineInstance + 60))(v25, "%s%d", "View", NumPresetViews);
    v12 = (PresetView_0 *)CMemoryMgr::Malloc(0x24u);
    v13 = v12;
    if ( !v12 )
      break;
    v14 = v20;
    v12->pos.z = v21[0];
    *(double *)&v12->pos.x = v14;
    v12->el = v23;
    v12->az = v22;
    v12->nearClip = v18;
    v12->farClip = v19;
    v15 = (*((int (__fastcall **)(char *))RwEngineInstance + 70))(v25);
    v16 = (RwChar *)CMemoryMgr::Malloc(v15 + 1);
    v13->description = v16;
    if ( !v16 )
    {
      v24 = 1056;
      if ( RsGlobal.keyboard.used )
        RsGlobal.keyboard.inputEventHandler(rsKEYUP, &v24);
      psErrorMessage((const RwChar *)"Out of memory - not all preset views loaded");
      CMemoryMgr::Free(v13);
      return 0;
    }
    (*((void (__fastcall **)(RwChar *, char *))RwEngineInstance + 62))(v16, v25);
    v13->next = PresetViews;
    PresetViews = v13;
    v5 = v11;
    ++NumPresetViews;
LABEL_19:
    if ( !FileInterface->rwfgets((RwChar *)v5, 1023, (void *)v4) )
      goto LABEL_20;
  }
  v24 = 1056;
  if ( RsGlobal.keyboard.used )
    RsGlobal.keyboard.inputEventHandler(rsKEYUP, &v24);
  psErrorMessage((const RwChar *)"Out of memory - not all preset views loaded");
  return 0;
}
// 4D4A8C: using guessed type int dword_4D4A8C;
// 4D4808: using guessed type RwReal var_478[2];

//----- (004D4B18) --------------------------------------------------------
RwChar *RsGetPresetViewDescription()
{
  RwChar *result; // r0
  int v1; // r1
  PresetView_0 *v2; // r0

  result = 0;
  if ( NumPresetViews && CurrentPresetView != -1 )
  {
    v1 = NumPresetViews - CurrentPresetView;
    v2 = PresetViews;
    if ( NumPresetViews - CurrentPresetView >= 2 )
    {
      while ( v2 )
      {
        v2 = v2->next;
        if ( v1 < 3 )
          break;
        --v1;
      }
    }
    return v2->description;
  }
  return result;
}

//----- (004D4B58) --------------------------------------------------------
RwBool __fastcall RsSavePresetView(RwCamera_0 *camera)
{
  RwFileFunctions_0 *FileInterface; // r10
  RwChar *v3; // r5
  int v4; // r8
  RwMatrix *LTM; // r0
  float v6; // s22
  float x; // s0
  float y; // s2
  float z; // s4
  float v10; // s8
  float v11; // s10
  float v12; // s20
  float v13; // s16
  float v14; // s18
  float v15; // s14
  float v16; // s12
  float v17; // s6
  float v18; // r5
  float v19; // s26
  float v20; // s30
  float v21; // s28
  float v22; // s0
  float v23; // s0
  RwBool PresetViews; // r5
  int v26; // [sp+3Ch] [bp-464h] BYREF
  RwV3d_0 in; // [sp+40h] [bp-460h] BYREF

  FileInterface = RwOsGetFileInterface();
  if ( FileInterface )
  {
    v3 = psPathnameCreate(ViewsFileName);
    v4 = (int)FileInterface->rwfopen(v3, (const RwChar *)&off_4D4E08);
    psPathnameDestroy(v3);
    if ( v4 )
    {
      LTM = RwFrameGetLTM((RwFrame_0 *)camera->object.object.parent);
      v6 = 1.0;
      x = LTM->at.x;
      y = LTM->at.y;
      z = LTM->at.z;
      v10 = Yaxis.y;
      v11 = Yaxis.z;
      v12 = LTM->pos.x;
      v13 = LTM->pos.y;
      v14 = LTM->pos.z;
      v15 = (float)((float)(x * Yaxis.x) + (float)(y * Yaxis.y)) + (float)(z * Yaxis.z);
      v16 = 1.0;
      if ( v15 <= 1.0 )
      {
        v16 = (float)((float)(x * Yaxis.x) + (float)(y * Yaxis.y)) + (float)(z * Yaxis.z);
        if ( v15 < -1.0 )
          v16 = -1.0;
      }
      v17 = v16 * Yaxis.x;
      v18 = acosf(v16);
      in.x = x - v17;
      in.y = y - (float)(v16 * v10);
      in.z = z - (float)(v16 * v11);
      RwV3dNormalize(&in, &in);
      v19 = in.x;
      v20 = in.y;
      v21 = in.z;
      v22 = in.z + (float)((float)(in.x * 0.0) + (float)(in.y * 0.0));
      if ( v22 <= 1.0 )
      {
        v6 = in.z + (float)((float)(in.x * 0.0) + (float)(in.y * 0.0));
        if ( v22 < -1.0 )
          v6 = -1.0;
      }
      v23 = (float)(acosf(v6) * 180.0) / 3.1416;
      if ( (float)((float)((float)(v19 * Xaxis.x) + (float)(v20 * Xaxis.y)) + (float)(v21 * Xaxis.z)) < 0.0 )
        v23 = -v23;
      (*((void (**)(RwV3d_0 *, const char *, ...))RwEngineInstance + 60))(
        &in,
        "%0.6f %0.6f %0.6f  %0.6f %0.6f  %0.6f %0.6f %s%d\n",
        v12,
        v13,
        v14,
        (float)((float)((float)(v18 * -180.0) / 3.1416) + 90.0),
        v23,
        camera->nearPlane,
        camera->farPlane,
        "View",
        NumPresetViews);
      (*((void (__fastcall **)(RwV3d_0 *))RwEngineInstance + 70))(&in);
      if ( FileInterface->rwfputs((const RwChar *)&in, (void *)v4) < 1 )
      {
        v26 = 1056;
        if ( RsGlobal.keyboard.used )
          RsGlobal.keyboard.inputEventHandler(rsKEYUP, &v26);
        psErrorMessage((const RwChar *)"Cannot write to preset view file");
      }
      else
      {
        PresetViews = RsLoadPresetViews();
        if ( PresetViews )
        {
          RsSetPresetView(camera, NumPresetViews - 1);
LABEL_22:
          FileInterface->rwfclose((void *)v4);
          return PresetViews;
        }
      }
      PresetViews = 0;
      goto LABEL_22;
    }
    LODWORD(in.x) = 1056;
    if ( RsGlobal.keyboard.used )
      RsGlobal.keyboard.inputEventHandler(rsKEYUP, &in);
    psErrorMessage((const RwChar *)"Cannot open preset view file");
  }
  return 0;
}
// 4D4E08: using guessed type void *off_4D4E08;

//----- (004D4EC8) --------------------------------------------------------
void CCover::Init()
{
  int i; // r1

  CCover::m_NumPoints = 0;
  CPtrListDoubleLink::Flush(&CCover::m_ListOfProcessedBuildings);
  for ( i = 0; i != 100; ++i )
    CCover::m_aPoints[i].m_Type = 0;
}

//----- (004D4F00) --------------------------------------------------------
void CCover::Update()
{
  int v0; // r11
  CCoverPoint *v1; // r10
  CCoverPoint *v2; // r1
  CCoverPoint *v3; // r3
  int m_Type; // r0
  float *v5; // r0
  CEntity *m_pEntity; // r4
  CMatrix *m_pMat; // r0
  CPlaceable *v8; // r0
  CCoverPoint *v9; // r9
  CCoverPoint *v10; // r8
  CCoverPoint *v11; // r10
  Int32 v12; // r0
  Int32 v13; // r0
  CObjectPool *v14; // r9
  int32 v15; // r0
  int v16; // r6
  int v17; // r4
  CEntity *v18; // r5
  CMatrix *v19; // r0
  float32x2_t *p_tx; // r1
  float32x2_t v21; // d16
  unsigned __int64 v22; // d0
  CVehiclePool *v23; // r5
  int32 m_nSize; // r0
  int v25; // r4
  int v26; // r6
  CPool<CVehicle,CHeli>::StorageType *m_aStorage; // r11
  uint8 *v28; // r8
  float32x2_t *v29; // r0
  float32x2_t *v30; // r1
  float32x2_t v31; // d16
  unsigned __int64 v32; // d0
  CPtrNode *m_pHead; // r5
  CEntity *m_pVoid; // r4
  float32x2_t v35; // d16
  unsigned __int64 v36; // d1
  int i; // r8
  Int32 v38; // r0
  _DWORD *v39; // r0
  CPtrNode *v40; // r0
  float x; // s16
  float y; // s18
  float v43; // s20
  float v44; // s26
  float v45; // r0
  int v46; // r8
  float v47; // r1
  int v48; // s18
  float v49; // r4
  float v50; // s20
  float v51; // r0
  int v52; // r6
  int v53; // r4
  int v54; // s18
  int v55; // s20
  float v56; // s0
  int v57; // r5
  int v58; // r0
  int v59; // s0
  uint16 v60; // r0
  int v61; // r0
  int v62; // r5
  int v63; // r0
  CPtrNode *v64; // r6
  CBuilding *v65; // r4
  float32x2_t v66; // d16
  unsigned __int64 v67; // d1
  CPtrListDoubleLink *v69; // r0
  CPtrNode *v70; // r1
  int v71; // [sp+10h] [bp-88h]
  int v72; // [sp+14h] [bp-84h]
  int v73; // [sp+18h] [bp-80h]
  int v74; // [sp+20h] [bp-78h]
  CPtrNode *m_pNext; // [sp+24h] [bp-74h]
  int v76; // [sp+24h] [bp-74h]
  CVector v77; // [sp+2Ch] [bp-6Ch] BYREF
  CVector v78; // [sp+38h] [bp-60h] BYREF

  v0 = 0;
  v1 = CCover::m_aPoints;
  v2 = CCover::m_aPoints;
  v3 = CCover::m_aPoints;
  do
  {
    m_Type = CCover::m_aPoints[v0].m_Type;
    switch ( m_Type )
    {
      case 1:
        m_pEntity = v1[v0].m_pEntity;
        if ( m_pEntity )
        {
          m_pMat = m_pEntity->m_pMat;
          if ( !m_pMat )
          {
            v8 = v1[v0].m_pEntity;
            v9 = v1;
            v10 = v3;
            v11 = v2;
            CPlaceable::AllocateMatrix(v8);
            CSimpleTransform::UpdateMatrix(&m_pEntity->m_transform, m_pEntity->m_pMat);
            v2 = v11;
            v1 = v9;
            v3 = v10;
            m_pMat = m_pEntity->m_pMat;
          }
          if ( m_pMat->zz < 0.9 )
          {
            CCover::m_aPoints[v0].m_Type = 0;
            --CCover::m_NumPoints;
          }
        }
        else
        {
          v13 = CCover::m_NumPoints;
          CCover::m_aPoints[v0].m_Type = 0;
          CCover::m_NumPoints = v13 - 1;
        }
        break;
      case 3:
        if ( !v2[v0].m_pEntity )
        {
          v12 = CCover::m_NumPoints;
          CCover::m_aPoints[v0].m_Type = 0;
          CCover::m_NumPoints = v12 - 1;
        }
        break;
      case 2:
        v5 = (float *)v3[v0].m_pEntity;
        if ( !v5
          || sqrtf((float)((float)(v5[18] * v5[18]) + (float)(v5[19] * v5[19])) + (float)(v5[20] * v5[20])) > 0.01 )
        {
          CCover::m_aPoints[v0].m_Type = 0;
          --CCover::m_NumPoints;
        }
        break;
    }
    ++v0;
  }
  while ( v0 != 100 );
  if ( (CTimer::m_FrameCounter & 0x1F) == 26 )
  {
    v23 = CPools::ms_pVehiclePool;
    m_nSize = CPools::ms_pVehiclePool->m_nSize;
    if ( m_nSize )
    {
      v25 = m_nSize;
      v26 = m_nSize - 1;
      do
      {
        if ( (v23->m_aFlags[v26] & 0x80u) == 0 )
        {
          m_aStorage = v23->m_aStorage;
          v28 = v23->m_aStorage[v25];
          if ( v28 != (uint8 *)&elf_hash_bucket[588]
            && !*((_DWORD *)v28 - 291)
            && sqrtf(
                 (float)((float)(*((float *)v28 - 633) * *((float *)v28 - 633))
                       + (float)(*((float *)v28 - 632) * *((float *)v28 - 632)))
               + (float)(*((float *)v28 - 631) * *((float *)v28 - 631))) < 0.005
            && (*(v28 - 1530) & 4) != 0 )
          {
            FindPlayerCoors(&v78, -1);
            v29 = (float32x2_t *)&(*m_aStorage)[v25 * 2604 - 2600];
            v30 = (float32x2_t *)v29[2].n64_u32[0];
            if ( v30 )
              v29 = v30 + 6;
            v31.n64_u64[0] = vsub_f32(*(float32x2_t *)&v78.x, (float32x2_t)v29->n64_u64[0]).n64_u64[0];
            v32 = vmul_f32(v31, v31).n64_u64[0];
            if ( sqrtf(*(float *)&v32 + *((float *)&v32 + 1)) < 25.0 )
              CCover::AddCoverPoint(2, (CEntity *)(v28 - 2604), 0, 0, 255);
          }
        }
        --v26;
        --v25;
      }
      while ( v26 != -1 );
    }
  }
  else if ( (CTimer::m_FrameCounter & 0x1F) == 28 )
  {
    v14 = CPools::ms_pObjectPool;
    v15 = CPools::ms_pObjectPool->m_nSize;
    if ( v15 )
    {
      v16 = v15 - 1;
      v17 = 420 * v15 - 420;
      do
      {
        if ( (v14->m_aFlags[v16] & 0x80u) == 0 )
        {
          v18 = (CEntity *)&(*v14->m_aStorage)[v17];
          if ( v18 )
          {
            if ( v18->m_pMat->zz > 0.95 && CObject::CanBeUsedToTakeCoverBehind((CObject *)&(*v14->m_aStorage)[v17]) )
            {
              FindPlayerCoors(&v78, -1);
              v19 = v18->m_pMat;
              p_tx = (float32x2_t *)&v19->tx;
              if ( !v19 )
                p_tx = (float32x2_t *)&v18->m_transform;
              v21.n64_u64[0] = vsub_f32(*(float32x2_t *)&v78.x, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
              v22 = vmul_f32(v21, v21).n64_u64[0];
              if ( sqrtf(*(float *)&v22 + *((float *)&v22 + 1)) < 25.0 )
                CCover::AddCoverPoint(1, v18, 0, 0, 255);
            }
          }
        }
        --v16;
        v17 -= 420;
      }
      while ( v16 != -1 );
    }
  }
  else if ( (CTimer::m_FrameCounter & 7) == 5 )
  {
    m_pHead = CCover::m_ListOfProcessedBuildings.m_pHead;
    if ( CCover::m_ListOfProcessedBuildings.m_pHead )
    {
      do
      {
        m_pVoid = (CEntity *)m_pHead->m_pVoid;
        m_pNext = m_pHead->m_pNext;
        CEntity::GetBoundCentre(&v78, (const CEntity *)m_pHead->m_pVoid);
        FindPlayerCoors(&v77, -1);
        v35.n64_u64[0] = vsub_f32(*(float32x2_t *)&v78.y, *(float32x2_t *)&v77.y).n64_u64[0];
        v36 = vmul_f32(v35, v35).n64_u64[0];
        if ( sqrtf((float)((float)((float)(v78.x - v77.x) * (float)(v78.x - v77.x)) + *(float *)&v36) + *((float *)&v36 + 1)) >= (float)(CModelInfo::ms_modelInfoPtrs[m_pVoid->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius + 30.0) )
        {
          for ( i = 0; i != 100; ++i )
          {
            if ( CCover::m_aPoints[i].m_Type && CCover::m_aPoints[i].m_pEntity == m_pVoid )
            {
              if ( m_pVoid )
                CEntity::CleanUpOldReference(m_pVoid, &CCover::m_aPoints[i].m_pEntity);
              CCover::m_aPoints[i].m_Type = 0;
              v38 = CCover::m_NumPoints;
              CCover::m_aPoints[i].m_pEntity = 0;
              CCover::m_NumPoints = v38 - 1;
            }
          }
          if ( CCover::m_ListOfProcessedBuildings.m_pHead == m_pHead )
            CCover::m_ListOfProcessedBuildings.m_pHead = m_pHead->m_pNext;
          v39 = m_pHead[1].m_pVoid;
          if ( v39 )
            v39[1] = m_pHead->m_pNext;
          v40 = m_pHead->m_pNext;
          if ( v40 )
            v40[1].m_pVoid = m_pHead[1].m_pVoid;
          CPtrNodeDoubleLink::operator delete(m_pHead);
        }
        m_pHead = m_pNext;
      }
      while ( m_pNext );
    }
    if ( !FindPlayerVehicle(-1, 0) )
    {
      FindPlayerCoors(&v78, -1);
      x = v78.x;
      FindPlayerCoors(&v78, -1);
      y = v78.y;
      FindPlayerCoors(&v78, -1);
      v43 = v78.x;
      FindPlayerCoors(&v78, -1);
      v44 = v78.y + 30.0;
      v45 = floorf((float)((float)(x + -30.0) / 50.0) + 60.0);
      v46 = CWorld::ms_nCurrentScanCode;
      v47 = (float)((float)(y + -30.0) / 50.0) + 60.0;
      v48 = (int)v45;
      v49 = (float)((float)(v43 + 30.0) / 50.0) + 60.0;
      v50 = floorf(v47);
      v51 = v49;
      v52 = v48;
      v53 = 0;
      v54 = (int)v50;
      v55 = (int)floorf(v51);
      v56 = floorf((float)(v44 / 50.0) + 60.0);
      if ( v52 <= 0 )
        v52 = 0;
      v73 = v52;
      v57 = 119;
      if ( v54 > 0 )
        v53 = v54;
      v58 = v55;
      v59 = (int)v56;
      if ( v55 >= 119 )
        v58 = 119;
      v76 = v58;
      if ( v59 < 119 )
        v57 = v59;
      if ( v46 == 0xFFFF )
      {
        CWorld::ClearScanCodes();
        v60 = 1;
      }
      else
      {
        v60 = v46 + 1;
      }
      CWorld::ms_nCurrentScanCode = v60;
      if ( v53 <= v57 )
      {
        v71 = v57;
        while ( 1 )
        {
          v72 = v53;
          if ( v73 <= v76 )
            break;
LABEL_90:
          v53 = v72 + 1;
          if ( v72 >= v71 )
            return;
        }
        v61 = 119;
        if ( v53 < 119 )
          v61 = v53;
        v62 = v73;
        v74 = 120 * v61;
        while ( 1 )
        {
          v63 = 119;
          if ( v62 < 119 )
            v63 = v62;
          v64 = CWorld::ms_aSectors[v63 + v74].m_buildingPtrListArray.m_pHead;
          if ( v64 )
            break;
LABEL_87:
          if ( v62++ >= v76 )
            goto LABEL_90;
        }
        while ( 1 )
        {
          v65 = (CBuilding *)v64->m_pVoid;
          if ( *((unsigned __int16 *)v64->m_pVoid + 24) != CWorld::ms_nCurrentScanCode )
          {
            v65->m_nScanCode = CWorld::ms_nCurrentScanCode;
            CEntity::GetBoundCentre(&v78, v65);
            FindPlayerCoors(&v77, -1);
            v66.n64_u64[0] = vsub_f32(*(float32x2_t *)&v78.y, *(float32x2_t *)&v77.y).n64_u64[0];
            v67 = vmul_f32(v66, v66).n64_u64[0];
            if ( sqrtf(
                   (float)((float)((float)(v78.x - v77.x) * (float)(v78.x - v77.x)) + *(float *)&v67)
                 + *((float *)&v67 + 1)) < (float)(CModelInfo::ms_modelInfoPtrs[v65->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius
                                                 + 30.0)
              && !CPtrList::IsMemberOfList(&CCover::m_ListOfProcessedBuildings, v65) )
            {
              break;
            }
          }
          v64 = v64->m_pNext;
          if ( !v64 )
            goto LABEL_87;
        }
        CCover::FindCoverPointsForThisBuilding(v65);
        v69 = (CPtrListDoubleLink *)CPtrNodeDoubleLink::operator new(0xCu);
        v69->m_pHead = (CPtrNode *)v65;
        v69[2].m_pHead = 0;
        v70 = CCover::m_ListOfProcessedBuildings.m_pHead;
        v69[1].m_pHead = CCover::m_ListOfProcessedBuildings.m_pHead;
        if ( v70 )
          v70[1].m_pVoid = v69;
        CCover::m_ListOfProcessedBuildings.m_pHead = (CPtrNode *)v69;
      }
    }
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004D5684) --------------------------------------------------------
void __fastcall CCover::AddCoverPoint(Int32 Type, CEntity *pEntity, CVector *pCoors, Int8 Usage, char a5)
{
  float x; // s4
  float32x2_t v6; // d16
  Int32 v8; // lr
  CEntity **p_m_pEntity; // r5
  int v10; // r2
  int v11; // r6
  bool v12; // zf
  CSimpleTransform *p_tx; // r6
  CMatrix *m_pMat; // r4
  float32x2_t v15; // d17
  unsigned __int64 v16; // d4
  float v17; // s6
  RwCamera_0 **p_camera; // r5
  int v19; // r2
  int v20; // r0
  bool v21; // zf
  __int64 v22; // d16

  v8 = CCover::m_NumPoints;
  if ( CCover::m_NumPoints > 99 )
    return;
  p_m_pEntity = &CCover::m_aPoints[0].m_pEntity;
  v10 = -1;
  do
  {
    v11 = *((char *)p_m_pEntity - 16);
    if ( v11 == Type )
    {
      if ( Type == 3 )
      {
        if ( pCoors->x == *((float *)p_m_pEntity - 3)
          && pCoors->y == *((float *)p_m_pEntity - 2)
          && pCoors->z == *((float *)p_m_pEntity - 1) )
        {
          return;
        }
      }
      else
      {
        v12 = Type == 2;
        if ( Type != 2 )
          v12 = Type == 1;
        if ( v12 && *p_m_pEntity == pEntity )
          return;
      }
    }
    if ( (_BYTE)v11 )
    {
      p_tx = (CSimpleTransform *)pCoors;
      if ( !pCoors )
      {
        if ( !pEntity )
        {
LABEL_16:
          v15.n64_u64[0] = vsub_f32(*((float32x2_t *)p_m_pEntity - 1), v6).n64_u64[0];
          v16 = vmul_f32(v15, v15).n64_u64[0];
          v17 = sqrtf(
                  (float)((float)((float)(*((float *)p_m_pEntity - 3) - x) * (float)(*((float *)p_m_pEntity - 3) - x))
                        + *(float *)&v16)
                + *((float *)&v16 + 1));
          if ( v17 < 0.8 || v17 < 2.0 && (unsigned int)(unsigned __int8)(*((_BYTE *)p_m_pEntity - 14) - a5) - 32 > 0xBF )
            return;
          goto LABEL_19;
        }
        m_pMat = pEntity->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pEntity->m_transform;
      }
      v6.n64_u64[0] = *(unsigned __int64 *)&p_tx->m_translate.y;
      x = p_tx->m_translate.x;
      goto LABEL_16;
    }
LABEL_19:
    ++v10;
    p_m_pEntity += 7;
  }
  while ( v10 < 99 );
  p_camera = &Scene.camera;
  do
  {
    v19 = *((unsigned __int8 *)p_camera + 12);
    p_camera += 7;
  }
  while ( v19 );
  *((_BYTE *)p_camera - 15) = Usage;
  *((_BYTE *)p_camera - 14) = a5;
  *((_BYTE *)p_camera - 16) = Type;
  CCover::m_NumPoints = v8 + 1;
  *p_camera = (RwCamera_0 *)pEntity;
  p_camera[1] = 0;
  p_camera[2] = 0;
  if ( pEntity )
  {
    v20 = *(_BYTE *)&pEntity->m_info & 7;
    v21 = v20 == 1;
    if ( v20 == 1 )
      v21 = pEntity->m_iplIndex == 0;
    if ( !v21 )
      CEntity::RegisterReference(pEntity, (CEntity **)p_camera);
  }
  if ( pCoors )
  {
    v22 = *(_QWORD *)&pCoors->x;
    *(p_camera - 1) = (RwCamera_0 *)LODWORD(pCoors->z);
    *(_QWORD *)(p_camera - 3) = v22;
  }
}
// 4D5708: variable 'v6' is possibly undefined
// 4D5704: variable 'x' is possibly undefined

//----- (004D580C) --------------------------------------------------------
bool __fastcall CCover::ShouldThisBuildingHaveItsCoverPointsCreated(CBuilding *pBuilding)
{
  float32x2_t v2; // d16
  unsigned __int64 v3; // d1
  CVector v5; // [sp+0h] [bp-20h] BYREF
  CVector v6; // [sp+Ch] [bp-14h] BYREF

  CEntity::GetBoundCentre(&v6, pBuilding);
  FindPlayerCoors(&v5, -1);
  v2.n64_u64[0] = vsub_f32(*(float32x2_t *)&v6.y, *(float32x2_t *)&v5.y).n64_u64[0];
  v3 = vmul_f32(v2, v2).n64_u64[0];
  return sqrtf((float)((float)((float)(v6.x - v5.x) * (float)(v6.x - v5.x)) + *(float *)&v3) + *((float *)&v3 + 1)) < (float)(CModelInfo::ms_modelInfoPtrs[pBuilding->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius + 30.0);
}

//----- (004D5884) --------------------------------------------------------
void __fastcall CCover::RemoveCoverPointsForThisEntity(CEntity *pEntity)
{
  int i; // r8

  for ( i = 0; i != 100; ++i )
  {
    if ( CCover::m_aPoints[i].m_Type && CCover::m_aPoints[i].m_pEntity == pEntity )
    {
      if ( pEntity )
        CEntity::CleanUpOldReference(pEntity, &CCover::m_aPoints[i].m_pEntity);
      CCover::m_aPoints[i].m_Type = 0;
      CCover::m_aPoints[i].m_pEntity = 0;
      --CCover::m_NumPoints;
    }
  }
}

//----- (004D5904) --------------------------------------------------------
void __fastcall CCover::FindCoverPointsForThisBuilding(CBuilding *pBuilding)
{
  CBaseModelInfo *v2; // r5
  int m_num2dEffects; // r9
  int32 v4; // r6
  C2dEffect *v5; // r8
  CMatrix *m_pMat; // r1
  float v7; // r0
  float v8; // s2
  CMatrix *v9; // r1
  const CSimpleTransform *p_m_transform; // [sp+8h] [bp-58h]
  CVector v11; // [sp+Ch] [bp-54h] BYREF
  CVector v12; // [sp+18h] [bp-48h] BYREF
  CVector v; // [sp+24h] [bp-3Ch] BYREF

  v2 = CModelInfo::ms_modelInfoPtrs[pBuilding->m_nModelIndex];
  m_num2dEffects = v2->m_num2dEffects;
  if ( v2->m_num2dEffects )
  {
    v4 = 0;
    p_m_transform = &pBuilding->m_transform;
    do
    {
      v5 = CBaseModelInfo::Get2dEffect(v2, v4);
      if ( v5->m_type == 9 )
      {
        *(_QWORD *)&v.x = *(_QWORD *)&v5->attr.l.m_colour._anon_0._anon_0.red;
        v.z = 0.0;
        m_pMat = pBuilding->m_pMat;
        if ( !m_pMat )
        {
          CPlaceable::AllocateMatrix(pBuilding);
          CSimpleTransform::UpdateMatrix(p_m_transform, pBuilding->m_pMat);
          m_pMat = pBuilding->m_pMat;
        }
        Multiply3x3(&v12, m_pMat, &v);
        v7 = atan2f(COERCE_FLOAT(LODWORD(v12.x) ^ 0x80000000), v12.y);
        v8 = v7 + 6.2832;
        if ( v7 > 0.0 )
          v8 = v7;
        v9 = pBuilding->m_pMat;
        if ( !v9 )
        {
          CPlaceable::AllocateMatrix(pBuilding);
          CSimpleTransform::UpdateMatrix(p_m_transform, pBuilding->m_pMat);
          v9 = pBuilding->m_pMat;
        }
        operator*(&v11, v9, &v5->m_posn);
        CCover::AddCoverPoint(
          3,
          pBuilding,
          &v11,
          v5->attr.i.m_rDoorStart,
          (unsigned int)(float)((float)(v8 * 255.0) / 6.2832));
      }
      ++v4;
    }
    while ( m_num2dEffects != v4 );
  }
}

//----- (004D59FC) --------------------------------------------------------
UInt8 __fastcall CCover::FindDirFromVector(CVector Dir)
{
  float v1; // r0
  float v2; // s4

  v1 = atan2f(COERCE_FLOAT(LODWORD(Dir.x) ^ 0x80000000), Dir.y);
  v2 = v1 + 6.2832;
  if ( v1 > 0.0 )
    v2 = v1;
  return (unsigned int)(float)((float)(v2 * 255.0) / 6.2832);
}

//----- (004D5A40) --------------------------------------------------------
CVector *__fastcall CCover::FindVectorFromFirstToMissingVertex(
        CVector *retstr,
        CColTriangle *pTriangle,
        Int32 *pSharedVert,
        CVector *pVertices)
{
  Int32 v4; // r12
  int32 m_nIndex1; // lr
  bool v6; // zf
  bool v7; // zf
  CVector *v8; // r1
  float x; // s0
  float y; // s2
  float z; // s4
  CVector *v12; // r1
  RwReal v13; // s2
  RwReal v14; // s4

  v4 = *pSharedVert;
  m_nIndex1 = pTriangle->m_nIndex1;
  v6 = pTriangle->m_nIndex1 == *pSharedVert;
  if ( pTriangle->m_nIndex1 != *pSharedVert )
    v6 = m_nIndex1 == pSharedVert[1];
  if ( v6 )
  {
    m_nIndex1 = pTriangle->m_nIndex2;
    v7 = m_nIndex1 == v4;
    if ( m_nIndex1 != v4 )
      v7 = m_nIndex1 == pSharedVert[1];
    if ( v7 )
      m_nIndex1 = pTriangle->m_nIndex3;
  }
  v8 = &pVertices[v4];
  x = v8->x;
  y = v8->y;
  z = v8->z;
  v12 = &pVertices[m_nIndex1];
  v13 = v12->y - y;
  v14 = v12->z - z;
  retstr->x = v12->x - x;
  retstr->y = v13;
  retstr->z = v14;
  return retstr;
}

//----- (004D5AAA) --------------------------------------------------------
float __fastcall CCover::CalculateHorizontalSize(CColTriangle *pTriangle, CVector *pVertices)
{
  float32x2_t v2; // d17
  float32x2_t v3; // d16
  unsigned __int64 v4; // d0

  v2.n64_u64[0] = *(unsigned __int64 *)&pVertices[pTriangle->m_nIndex3].x;
  v3.n64_u64[0] = vsub_f32(
                    vmax_f32(
                      vmax_f32(
                        *(float32x2_t *)&pVertices[pTriangle->m_nIndex1].x,
                        *(float32x2_t *)&pVertices[pTriangle->m_nIndex2].x),
                      v2),
                    vmin_f32(
                      vmin_f32(
                        *(float32x2_t *)&pVertices[pTriangle->m_nIndex1].x,
                        *(float32x2_t *)&pVertices[pTriangle->m_nIndex2].x),
                      v2)).n64_u64[0];
  v4 = vmul_f32(v3, v3).n64_u64[0];
  return sqrtf(*(float *)&v4 + *((float *)&v4 + 1));
}

//----- (004D5AFA) --------------------------------------------------------
void __fastcall CCover::Find2HighestPoints(CColTriangle *pTriangle, CVector *pVertices, Int32 *Vertex1, Int32 *Vertex2)
{
  int32 m_nIndex1; // lr
  int32 m_nIndex2; // r4
  int32 *p_m_nIndex2; // r12
  float z; // s0
  float v8; // s2
  int32 *v9; // r5
  int32 *p_m_nIndex3; // r0
  int32 m_nIndex3; // t1

  m_nIndex1 = pTriangle->m_nIndex1;
  p_m_nIndex2 = &pTriangle->m_nIndex2;
  m_nIndex2 = pTriangle->m_nIndex2;
  z = pVertices[m_nIndex2].z;
  v8 = pVertices[pTriangle->m_nIndex1].z;
  if ( v8 >= z || (v9 = &pTriangle->m_nIndex3, v8 >= pVertices[pTriangle->m_nIndex3].z) )
  {
    if ( z >= v8 || (m_nIndex3 = pTriangle->m_nIndex3, p_m_nIndex3 = &pTriangle->m_nIndex3, z >= pVertices[m_nIndex3].z) )
    {
      m_nIndex2 = m_nIndex1;
      v9 = p_m_nIndex2;
    }
    else
    {
      m_nIndex2 = m_nIndex1;
      v9 = p_m_nIndex3;
    }
  }
  *Vertex1 = m_nIndex2;
  *Vertex2 = *v9;
}

//----- (004D5B84) --------------------------------------------------------
int __fastcall CCover::DoLineCheckWithinObject(
        CColTriangle *pTriangles,
        Int32 NumTriangles,
        CVector *pVertices,
        CVector *pNormals,
        CVector Point1,
        CVector Point2)
{
  RwReal *p_y; // r6
  int32 *p_m_nIndex2; // r5
  Int32 v10; // r8
  float v11; // s14
  float v12; // s3
  CVector *v13; // r0
  float x; // s0
  float y; // s4
  float z; // s2
  float v17; // s8
  float v18; // s6
  float v19; // s6
  float v20; // s6
  float v21; // s17
  float v22; // s30
  float v23; // s19
  CVector *v24; // r0
  float v25; // s10
  RwReal v26; // s0
  float v27; // s27
  float v28; // s29
  float v29; // s31
  float v30; // s21
  CVector *v31; // r0
  float v32; // s23
  float v33; // s25
  float v34; // s0
  float v35; // s2
  float v36; // s4
  RwReal v37; // s8
  CVector *v38; // r0
  float v39; // s10
  RwReal v40; // s0
  float v41; // s21
  CVector *v42; // r0
  float v43; // s0
  float v44; // s2
  float v45; // s4
  RwReal v46; // s8
  CVector *v47; // r0
  float v48; // s10
  RwReal v49; // s0
  CVector v2; // [sp+4h] [bp-84h] BYREF
  CVector v1; // [sp+10h] [bp-78h] BYREF
  CVector v53; // [sp+1Ch] [bp-6Ch] BYREF

  if ( NumTriangles < 1 )
    return 0;
  p_y = &pNormals->y;
  p_m_nIndex2 = &pTriangles->m_nIndex2;
  v10 = 0;
  while ( 1 )
  {
    v11 = *(p_y - 1);
    v12 = p_y[1];
    v13 = &pVertices[*(p_m_nIndex2 - 1)];
    x = v13->x;
    y = v13->y;
    z = v13->z;
    v17 = (float)((float)((float)(Point2.x - v13->x) * v11) + (float)((float)(Point2.y - y) * *p_y))
        + (float)((float)(Point2.z - z) * v12);
    v18 = (float)((float)((float)(Point1.x - v13->x) * v11) + (float)((float)(Point1.y - y) * *p_y))
        + (float)((float)(Point1.z - z) * v12);
    if ( (float)(v18 * v17) < 0.0 )
    {
      v19 = fabsf(v18);
      v20 = v19 / (float)(v19 + fabsf(v17));
      v21 = (float)(v20 * Point2.y) + (float)((float)(1.0 - v20) * Point1.y);
      v22 = (float)(v20 * Point2.x) + (float)((float)(1.0 - v20) * Point1.x);
      v23 = (float)(v20 * Point2.z) + (float)((float)(1.0 - v20) * Point1.z);
      v1.y = v21 - y;
      v1.x = v22 - x;
      v1.z = v23 - z;
      v24 = &pVertices[*p_m_nIndex2];
      v25 = v24->z;
      v26 = v24->x - x;
      v2.y = v24->y - y;
      v2.x = v26;
      v2.z = v25 - z;
      CrossProduct(&v53, &v1, &v2);
      v27 = *(p_y - 1);
      v28 = *p_y;
      v29 = p_y[1];
      v30 = v53.x;
      v31 = &pVertices[*p_m_nIndex2];
      v32 = v53.y;
      v33 = v53.z;
      v34 = v31->x;
      v35 = v31->y;
      v36 = v31->z;
      v37 = v22 - v31->x;
      v1.y = v21 - v35;
      v1.x = v37;
      v1.z = v23 - v36;
      v38 = &pVertices[p_m_nIndex2[1]];
      v39 = v38->z;
      v40 = v38->x - v34;
      v2.y = v38->y - v35;
      v2.x = v40;
      v2.z = v39 - v36;
      CrossProduct(&v53, &v1, &v2);
      v41 = (float)((float)(v30 * v27) + (float)(v32 * v28)) + (float)(v33 * v29);
      if ( (float)(v41 * (float)((float)((float)(v53.x * *(p_y - 1)) + (float)(v53.y * *p_y)) + (float)(v53.z * p_y[1]))) > 0.0 )
      {
        v42 = &pVertices[p_m_nIndex2[1]];
        v43 = v42->x;
        v44 = v42->y;
        v45 = v42->z;
        v46 = v22 - v42->x;
        v1.y = v21 - v44;
        v1.x = v46;
        v1.z = v23 - v45;
        v47 = &pVertices[*(p_m_nIndex2 - 1)];
        v48 = v47->z;
        v49 = v47->x - v43;
        v2.y = v47->y - v44;
        v2.x = v49;
        v2.z = v48 - v45;
        CrossProduct(&v53, &v1, &v2);
        if ( (float)(v41
                   * (float)((float)((float)(v53.x * *(p_y - 1)) + (float)(v53.y * *p_y)) + (float)(v53.z * p_y[1]))) > 0.0 )
          break;
      }
    }
    ++v10;
    p_y += 3;
    p_m_nIndex2 += 4;
    if ( v10 >= NumTriangles )
      return 0;
  }
  return 1;
}

//----- (004D5E70) --------------------------------------------------------
CCoverPoint *__fastcall CCover::FindAndReserveCoverPoint(CPed *pPed, CVector *TargetCoors, bool bForAttack)
{
  float x; // s26
  float y; // s28
  float z; // s30
  float v7; // s16
  int v8; // r4
  int v9; // r9
  int m_Type; // r1
  int v11; // r0
  CEntity *m_pEntity; // r2
  CMatrix *v13; // r3
  CVector *p_m_Coors; // r1
  float v15; // r5
  float v16; // s25
  float v17; // s2
  float v18; // s6
  float v19; // s21
  float v20; // s17
  float v21; // s19
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r0
  float v24; // s2
  float v25; // s4
  float v26; // s0
  float v27; // s8
  int v28; // r0
  int v29; // r1
  float v30; // s2
  bool v31; // zf
  int v32; // r0
  int v33; // r0
  CCoverPoint *v34; // r5
  CEntity **m_pPedsUsingThisCover; // r1
  CPed *v36; // r2
  CCoverPoint *v37; // r1
  CPed *v38; // r0
  CPed *v39; // t1
  _BOOL4 v41; // [sp+8h] [bp-88h]
  int v42; // [sp+Ch] [bp-84h]

  v42 = -1;
  v7 = 100000.0;
  v8 = 0;
  v9 = 0;
  v41 = bForAttack;
  do
  {
    m_Type = CCover::m_aPoints[v8].m_Type;
    v11 = (unsigned __int8)m_Type;
    if ( (unsigned int)(m_Type - 1) <= 2 && !CCover::m_aPoints[v8].m_pEntity )
    {
      v11 = 0;
      CCover::m_aPoints[v8].m_Type = 0;
      --CCover::m_NumPoints;
    }
    if ( v11 )
    {
      if ( (char)v11 == 2 )
      {
        if ( CCover::m_aPoints[v8].m_pPedsUsingThisCover[0] && !CCover::m_aPoints[v8].m_pPedsUsingThisCover[1] )
          goto LABEL_35;
      }
      else
      {
        if ( CCover::m_aPoints[v8].m_pPedsUsingThisCover[0] )
          goto LABEL_35;
        if ( (unsigned int)((char)v11 - 1) >= 2 )
        {
          if ( (char)v11 != 3 )
            goto LABEL_15;
          p_m_Coors = &CCover::m_aPoints[v8].m_Coors;
LABEL_14:
          x = p_m_Coors->x;
          y = p_m_Coors->y;
          z = p_m_Coors->z;
LABEL_15:
          if ( v11 != 3
            || (v15 = (float)CCover::m_aPoints[v8].m_CoverDirection * 0.024544,
                v16 = sinf(v15),
                v17 = TargetCoors->y,
                v18 = CCover::m_aPoints[v8].m_Coors.y,
                v19 = TargetCoors->x - CCover::m_aPoints[v8].m_Coors.x,
                v20 = TargetCoors->z,
                v21 = CCover::m_aPoints[v8].m_Coors.z,
                (float)((float)((float)(cosf(v15) * (float)(v17 - v18)) - (float)(v16 * v19))
                      + (float)((float)(v20 - v21) * 0.0)) > 0.0) )
          {
            m_pMat = pPed->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &pPed->m_transform;
            if ( fabsf(p_tx->m_translate.z - z) < 4.0 )
            {
              v24 = p_tx->m_translate.x;
              v25 = p_tx->m_translate.y;
              v26 = sqrtf(
                      (float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
                    + (float)((float)(v25 - y) * (float)(v25 - y)));
              if ( v26 < 15.0 )
              {
                if ( v41 )
                {
                  v27 = TargetCoors->y;
                  v28 = 0;
                  v29 = 0;
                  v30 = (float)((float)(v24 - TargetCoors->x) * (float)(v24 - TargetCoors->x))
                      + (float)((float)(v25 - v27) * (float)(v25 - v27));
                  if ( v26 < v7 )
                    v28 = 1;
                  if ( sqrtf(
                         (float)((float)(x - TargetCoors->x) * (float)(x - TargetCoors->x))
                       + (float)((float)(y - v27) * (float)(y - v27))) < (float)(sqrtf(v30) + 4.0) )
                    v29 = 1;
                  v32 = v28 & v29;
                  v31 = v32 == 0;
                  if ( v32 )
                    v7 = v26;
                  v33 = v42;
                  if ( !v31 )
                    v33 = v9;
                  v42 = v33;
                }
                else if ( v26 < v7 )
                {
                  v7 = v26;
                  v42 = v9;
                }
              }
            }
          }
          goto LABEL_35;
        }
      }
      m_pEntity = CCover::m_aPoints[v8].m_pEntity;
      v13 = m_pEntity->m_pMat;
      p_m_Coors = (CVector *)&v13->tx;
      if ( !v13 )
        p_m_Coors = &m_pEntity->m_transform.m_translate;
      goto LABEL_14;
    }
LABEL_35:
    ++v8;
    ++v9;
  }
  while ( v8 != 100 );
  if ( v42 <= -1 )
    return 0;
  v34 = &CCover::m_aPoints[v42];
  m_pPedsUsingThisCover = v34->m_pPedsUsingThisCover;
  v36 = v34->m_pPedsUsingThisCover[0];
  if ( v36 != pPed )
  {
    if ( !v36
      || (v37 = &CCover::m_aPoints[v42],
          v39 = v37->m_pPedsUsingThisCover[1],
          m_pPedsUsingThisCover = &v37->m_pPedsUsingThisCover[1],
          v38 = v39,
          v39 != pPed)
      && !v38 )
    {
      *m_pPedsUsingThisCover = pPed;
      CEntity::RegisterReference(pPed, m_pPedsUsingThisCover);
    }
  }
  return v34;
}
// 4D5FEC: variable 'z' is possibly undefined
// 4D6006: variable 'x' is possibly undefined
// 4D600A: variable 'y' is possibly undefined

//----- (004D6158) --------------------------------------------------------
void __fastcall CCover::RemoveCoverPointIfEntityLost(CCoverPoint *pPoint)
{
  if ( (unsigned int)(pPoint->m_Type - 1) <= 2 && !pPoint->m_pEntity )
  {
    pPoint->m_Type = 0;
    --CCover::m_NumPoints;
  }
}

//----- (004D6180) --------------------------------------------------------
bool __fastcall CCoverPoint::CanAccomodateAnotherPed(CCoverPoint *this)
{
  if ( !this->m_Type )
    return 0;
  if ( this->m_Type != 2 )
    return this->m_pPedsUsingThisCover[0] == 0;
  if ( this->m_pPedsUsingThisCover[0] )
    return this->m_pPedsUsingThisCover[1] != 0;
  return 1;
}

//----- (004D61B0) --------------------------------------------------------
CVector *__fastcall CCover::FindVectorFromDir(CVector *retstr, UInt8 Dir)
{
  float v3; // r5
  CVector *result; // r0

  retstr->z = 0.0;
  v3 = (float)Dir * 0.024544;
  LODWORD(retstr->x) = COERCE_UNSIGNED_INT(sinf(v3)) ^ 0x80000000;
  *(float *)&result = cosf(v3);
  retstr->y = *(float *)&result;
  return result;
}

//----- (004D61E8) --------------------------------------------------------
void __fastcall CCoverPoint::ReserveCoverPointForPed(CCoverPoint *this, CPed *pPed)
{
  CPed **m_pPedsUsingThisCover; // r2
  CPed *v3; // r3
  CPed **v4; // r0
  CPed *v5; // r2
  CPed *v6; // t1
  bool v7; // zf

  m_pPedsUsingThisCover = this->m_pPedsUsingThisCover;
  v3 = this->m_pPedsUsingThisCover[0];
  if ( v3 != pPed )
  {
    if ( !v3
      || (v6 = this->m_pPedsUsingThisCover[1], v4 = &this->m_pPedsUsingThisCover[1], v5 = v6, v6 != pPed)
      && (v7 = v5 == 0, m_pPedsUsingThisCover = v4, v7) )
    {
      *m_pPedsUsingThisCover = pPed;
      sub_196050(pPed, m_pPedsUsingThisCover);
    }
  }
}

//----- (004D6210) --------------------------------------------------------
bool __fastcall CCover::FindCoordinatesCoverPoint(
        CCoverPoint *pCoverPoint,
        CPed *pPed,
        CVector *TargetCoors,
        CVector *ResultCoors)
{
  float32x2_t v4; // d8
  float32x2_t v5; // d9
  CPed *v9; // r1
  bool v10; // zf
  bool result; // r0
  int m_Type; // r1
  CEntity *v13; // r5
  float x; // s0
  float y; // s2
  float *p_x; // r6
  float *v17; // r2
  CColModel *v18; // r1
  CMatrix *v19; // r1
  float v20; // s6
  Int32 v21; // s0
  CMatrix *v22; // r0
  float v23; // s0
  RwReal v24; // s4
  RwReal v25; // s2
  __int64 v26; // d16
  RwReal z; // r0
  CEntity *m_pEntity; // r4
  CColModel *m_pColModel; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  CVector *m_aPoints; // r0
  CPointList v33; // [sp+18h] [bp-168h] BYREF

  v9 = pCoverPoint->m_pPedsUsingThisCover[0];
  v10 = v9 == pPed;
  if ( v9 != pPed )
    v10 = pCoverPoint->m_pPedsUsingThisCover[1] == pPed;
  if ( !v10 )
    return 0;
  m_Type = pCoverPoint->m_Type;
  if ( m_Type == 3 )
  {
    v26 = *(_QWORD *)&pCoverPoint->m_Coors.x;
    z = pCoverPoint->m_Coors.z;
    goto LABEL_24;
  }
  if ( m_Type == 2 )
  {
    m_pEntity = pCoverPoint->m_pEntity;
    if ( !m_pEntity )
      return 0;
    CPointList::Empty(&v33);
    m_pColModel = CModelInfo::ms_modelInfoPtrs[m_pEntity->m_nModelIndex]->m_pColModel;
    CFormation::FindCoverPointsBehindBox(
      &v33,
      *TargetCoors,
      m_pEntity->m_pMat,
      &m_pColModel->m_sphereBound.m_vecCentre,
      &m_pColModel->m_boxBound.m_vecMin,
      &m_pColModel->m_boxBound.m_vecMax,
      1000000.0);
    if ( v33.m_nPoints != 2 )
      return 0;
    m_pMat = pPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    if ( sqrtf(
           (float)((float)(v33.m_aPoints[0].x - p_tx->m_translate.x) * (float)(v33.m_aPoints[0].x - p_tx->m_translate.x))
         + (float)((float)(v33.m_aPoints[0].y - p_tx->m_translate.y) * (float)(v33.m_aPoints[0].y - p_tx->m_translate.y))) < sqrtf((float)((float)(v33.m_aPoints[1].x - p_tx->m_translate.x) * (float)(v33.m_aPoints[1].x - p_tx->m_translate.x)) + (float)((float)(v33.m_aPoints[1].y - p_tx->m_translate.y) * (float)(v33.m_aPoints[1].y - p_tx->m_translate.y))) )
      m_aPoints = v33.m_aPoints;
    else
      m_aPoints = &v33.m_aPoints[1];
    v26 = *(_QWORD *)&m_aPoints->x;
    z = m_aPoints->z;
LABEL_24:
    ResultCoors->z = z;
    *(_QWORD *)&ResultCoors->x = v26;
    return 1;
  }
  if ( m_Type != 1 )
    return 0;
  v13 = pCoverPoint->m_pEntity;
  result = 0;
  if ( v13 )
  {
    x = TargetCoors->x;
    y = TargetCoors->y;
    p_x = &v13->m_transform.m_translate.x;
    v17 = &v13->m_transform.m_translate.x;
    v18 = CModelInfo::ms_modelInfoPtrs[v13->m_nModelIndex]->m_pColModel;
    v4.n64_u32[0] = LODWORD(v18->m_boxBound.m_vecMax.x);
    v5.n64_u32[0] = LODWORD(v18->m_boxBound.m_vecMax.y);
    v19 = v13->m_pMat;
    if ( v19 )
      v17 = &v19->tx;
    v20 = v17[1];
    *(float *)&v21 = x - *v17;
    v33.m_aPoints[0].y = 0.0;
    v33.m_aPoints[0].x = y - v20;
    v33.m_nPoints = v21;
    CVector::Normalise((CVector *)&v33);
    v22 = v13->m_pMat;
    v23 = vmax_f32(v4, v5).n64_f32[0] + 0.4;
    if ( v22 )
      p_x = &v22->tx;
    v24 = p_x[1] - (float)(v23 * v33.m_aPoints[0].x);
    v25 = p_x[2] - (float)(v23 * v33.m_aPoints[0].y);
    ResultCoors->x = *p_x - (float)(v23 * *(float *)&v33.m_nPoints);
    ResultCoors->y = v24;
    ResultCoors->z = v25;
    return 1;
  }
  return result;
}
// 4D62C0: variable 'v4' is possibly undefined
// 4D62C0: variable 'v5' is possibly undefined

//----- (004D63FC) --------------------------------------------------------
bool __fastcall CCover::DoesCoverPointStillProvideCover(CCoverPoint *pPoint, CVector TargetCoors)
{
  float z; // r8
  float y; // r9
  float x; // r6
  int m_Type; // r1
  int v7; // r0
  float v8; // r5
  float v9; // r0
  float v10; // s2
  float v11; // s16
  float v12; // s18

  z = TargetCoors.z;
  y = TargetCoors.y;
  x = TargetCoors.x;
  if ( !pPoint )
    return 0;
  m_Type = pPoint->m_Type;
  v7 = (unsigned __int8)m_Type;
  if ( (unsigned int)(m_Type - 1) > 2 || pPoint->m_pEntity )
  {
    if ( !(_BYTE)m_Type )
      return 0;
  }
  else
  {
    pPoint->m_Type = 0;
    --CCover::m_NumPoints;
    v7 = (unsigned __int8)pPoint->m_Type;
    if ( !pPoint->m_Type )
      return 0;
  }
  if ( v7 != 3 )
    return 1;
  v8 = (float)pPoint->m_CoverDirection * 0.024544;
  v9 = sinf(v8);
  v10 = pPoint->m_Coors.y;
  v11 = pPoint->m_Coors.z;
  v12 = x - pPoint->m_Coors.x;
  return (float)((float)((float)(cosf(v8) * (float)(y - v10)) - (float)(v9 * v12)) + (float)((float)(z - v11) * 0.0)) > 0.0;
}

//----- (004D64D0) --------------------------------------------------------
void __fastcall CCoverPoint::ReleaseCoverPointForPed(CCoverPoint *this, CPed *pPed)
{
  CEntity **m_pPedsUsingThisCover; // r6
  CEntity **v5; // r4
  CPed *v6; // t1

  m_pPedsUsingThisCover = this->m_pPedsUsingThisCover;
  if ( this->m_pPedsUsingThisCover[0] == pPed )
  {
    if ( pPed )
      CEntity::CleanUpOldReference(pPed, m_pPedsUsingThisCover);
    *m_pPedsUsingThisCover = 0;
  }
  v6 = this->m_pPedsUsingThisCover[1];
  v5 = &this->m_pPedsUsingThisCover[1];
  if ( v6 == pPed )
  {
    if ( pPed )
      CEntity::CleanUpOldReference(pPed, v5);
    *v5 = 0;
  }
}

//----- (004D651C) --------------------------------------------------------
CPlayerRelationshipRecorder *GetPlayerRelationshipRecorder()
{
  CPlayerRelationshipRecorder *result; // r0

  result = GetPlayerRelationshipRecorder(void)::pRecorder;
  if ( !GetPlayerRelationshipRecorder(void)::pRecorder )
  {
    result = (CPlayerRelationshipRecorder *)operator new(0x80u);
    result->m_records[0].m_pPed = 0;
    result->m_records[0].m_iType = 0;
    result->m_records[1].m_pPed = 0;
    result->m_records[1].m_iType = 0;
    result->m_records[2].m_pPed = 0;
    result->m_records[2].m_iType = 0;
    result->m_records[3].m_pPed = 0;
    result->m_records[3].m_iType = 0;
    result->m_records[4].m_pPed = 0;
    result->m_records[4].m_iType = 0;
    result->m_records[5].m_pPed = 0;
    result->m_records[5].m_iType = 0;
    result->m_records[6].m_pPed = 0;
    result->m_records[6].m_iType = 0;
    result->m_records[7].m_pPed = 0;
    result->m_records[7].m_iType = 0;
    result->m_records[8].m_pPed = 0;
    result->m_records[8].m_iType = 0;
    result->m_records[9].m_iType = 0;
    result->m_records[9].m_pPed = 0;
    result->m_records[10].m_pPed = 0;
    result->m_records[10].m_iType = 0;
    result->m_records[11].m_pPed = 0;
    result->m_records[11].m_iType = 0;
    result->m_records[12].m_pPed = 0;
    result->m_records[12].m_iType = 0;
    result->m_records[13].m_pPed = 0;
    result->m_records[13].m_iType = 0;
    result->m_records[14].m_pPed = 0;
    result->m_records[14].m_iType = 0;
    result->m_records[15].m_pPed = 0;
    result->m_records[15].m_iType = 0;
    GetPlayerRelationshipRecorder(void)::pRecorder = result;
  }
  return result;
}

//----- (004D65A0) --------------------------------------------------------
void __fastcall CPlayerRelationshipRecorder::CPlayerRelationshipRecorder(CPlayerRelationshipRecorder *this)
{
  this->m_records[0].m_iType = 0;
  this->m_records[0].m_pPed = 0;
  this->m_records[1].m_pPed = 0;
  this->m_records[1].m_iType = 0;
  this->m_records[2].m_iType = 0;
  this->m_records[2].m_pPed = 0;
  this->m_records[3].m_pPed = 0;
  this->m_records[3].m_iType = 0;
  this->m_records[4].m_pPed = 0;
  this->m_records[4].m_iType = 0;
  this->m_records[5].m_pPed = 0;
  this->m_records[5].m_iType = 0;
  this->m_records[6].m_pPed = 0;
  this->m_records[6].m_iType = 0;
  this->m_records[7].m_iType = 0;
  this->m_records[7].m_pPed = 0;
  this->m_records[8].m_iType = 0;
  this->m_records[8].m_pPed = 0;
  this->m_records[9].m_iType = 0;
  this->m_records[9].m_pPed = 0;
  this->m_records[10].m_iType = 0;
  this->m_records[10].m_pPed = 0;
  this->m_records[11].m_iType = 0;
  this->m_records[11].m_pPed = 0;
  this->m_records[12].m_iType = 0;
  this->m_records[12].m_pPed = 0;
  this->m_records[13].m_iType = 0;
  this->m_records[13].m_pPed = 0;
  this->m_records[14].m_iType = 0;
  this->m_records[14].m_pPed = 0;
  this->m_records[15].m_iType = 0;
  this->m_records[15].m_pPed = 0;
}

//----- (004D65FC) --------------------------------------------------------
void __fastcall CPlayerRelationshipRecorder::Flush(CPlayerRelationshipRecorder *this)
{
  this->m_records[0].m_iType = 0;
  this->m_records[0].m_pPed = 0;
  this->m_records[1].m_pPed = 0;
  this->m_records[1].m_iType = 0;
  this->m_records[2].m_iType = 0;
  this->m_records[2].m_pPed = 0;
  this->m_records[3].m_pPed = 0;
  this->m_records[3].m_iType = 0;
  this->m_records[4].m_pPed = 0;
  this->m_records[4].m_iType = 0;
  this->m_records[5].m_pPed = 0;
  this->m_records[5].m_iType = 0;
  this->m_records[6].m_pPed = 0;
  this->m_records[6].m_iType = 0;
  this->m_records[7].m_iType = 0;
  this->m_records[7].m_pPed = 0;
  this->m_records[8].m_iType = 0;
  this->m_records[8].m_pPed = 0;
  this->m_records[9].m_iType = 0;
  this->m_records[9].m_pPed = 0;
  this->m_records[10].m_iType = 0;
  this->m_records[10].m_pPed = 0;
  this->m_records[11].m_iType = 0;
  this->m_records[11].m_pPed = 0;
  this->m_records[12].m_iType = 0;
  this->m_records[12].m_pPed = 0;
  this->m_records[13].m_iType = 0;
  this->m_records[13].m_pPed = 0;
  this->m_records[14].m_iType = 0;
  this->m_records[14].m_pPed = 0;
  this->m_records[15].m_iType = 0;
  this->m_records[15].m_pPed = 0;
}

//----- (004D6658) --------------------------------------------------------
void __fastcall CPlayerRelationshipRecorder::~CPlayerRelationshipRecorder(CPlayerRelationshipRecorder *this)
{
  this->m_records[0].m_iType = 0;
  this->m_records[0].m_pPed = 0;
  this->m_records[1].m_pPed = 0;
  this->m_records[1].m_iType = 0;
  this->m_records[2].m_iType = 0;
  this->m_records[2].m_pPed = 0;
  this->m_records[3].m_pPed = 0;
  this->m_records[3].m_iType = 0;
  this->m_records[4].m_pPed = 0;
  this->m_records[4].m_iType = 0;
  this->m_records[5].m_pPed = 0;
  this->m_records[5].m_iType = 0;
  this->m_records[6].m_pPed = 0;
  this->m_records[6].m_iType = 0;
  this->m_records[7].m_iType = 0;
  this->m_records[7].m_pPed = 0;
  this->m_records[8].m_iType = 0;
  this->m_records[8].m_pPed = 0;
  this->m_records[9].m_iType = 0;
  this->m_records[9].m_pPed = 0;
  this->m_records[10].m_iType = 0;
  this->m_records[10].m_pPed = 0;
  this->m_records[11].m_iType = 0;
  this->m_records[11].m_pPed = 0;
  this->m_records[12].m_iType = 0;
  this->m_records[12].m_pPed = 0;
  this->m_records[13].m_iType = 0;
  this->m_records[13].m_pPed = 0;
  this->m_records[14].m_iType = 0;
  this->m_records[14].m_pPed = 0;
  this->m_records[15].m_iType = 0;
  this->m_records[15].m_pPed = 0;
}

//----- (004D66B4) --------------------------------------------------------
void __fastcall CPlayerRelationshipRecorder::ClearRelationshipWithPlayer(
        CPlayerRelationshipRecorder *this,
        const CPed *pPed)
{
  CPlayerRelationshipRecorder *v2; // r3
  int v3; // r1

  if ( this->m_records[0].m_pPed == pPed )
  {
    v3 = 0;
    v2 = this;
  }
  else
  {
    v2 = (CPlayerRelationshipRecorder *)&this->m_records[1];
    if ( this->m_records[1].m_pPed == pPed )
    {
      v3 = 1;
    }
    else
    {
      v2 = (CPlayerRelationshipRecorder *)&this->m_records[2];
      if ( this->m_records[2].m_pPed == pPed )
      {
        v3 = 2;
      }
      else
      {
        v2 = (CPlayerRelationshipRecorder *)&this->m_records[3];
        if ( this->m_records[3].m_pPed == pPed )
        {
          v3 = 3;
        }
        else
        {
          v2 = (CPlayerRelationshipRecorder *)&this->m_records[4];
          if ( this->m_records[4].m_pPed == pPed )
          {
            v3 = 4;
          }
          else
          {
            v2 = (CPlayerRelationshipRecorder *)&this->m_records[5];
            if ( this->m_records[5].m_pPed == pPed )
            {
              v3 = 5;
            }
            else
            {
              v2 = (CPlayerRelationshipRecorder *)&this->m_records[6];
              if ( this->m_records[6].m_pPed == pPed )
              {
                v3 = 6;
              }
              else
              {
                v2 = (CPlayerRelationshipRecorder *)&this->m_records[7];
                if ( this->m_records[7].m_pPed == pPed )
                {
                  v3 = 7;
                }
                else
                {
                  v2 = (CPlayerRelationshipRecorder *)&this->m_records[8];
                  if ( this->m_records[8].m_pPed == pPed )
                  {
                    v3 = 8;
                  }
                  else
                  {
                    v2 = (CPlayerRelationshipRecorder *)&this->m_records[9];
                    if ( this->m_records[9].m_pPed == pPed )
                    {
                      v3 = 9;
                    }
                    else
                    {
                      v2 = (CPlayerRelationshipRecorder *)&this->m_records[10];
                      if ( this->m_records[10].m_pPed == pPed )
                      {
                        v3 = 10;
                      }
                      else
                      {
                        v2 = (CPlayerRelationshipRecorder *)&this->m_records[11];
                        if ( this->m_records[11].m_pPed == pPed )
                        {
                          v3 = 11;
                        }
                        else
                        {
                          v2 = (CPlayerRelationshipRecorder *)&this->m_records[12];
                          if ( this->m_records[12].m_pPed == pPed )
                          {
                            v3 = 12;
                          }
                          else
                          {
                            v2 = (CPlayerRelationshipRecorder *)&this->m_records[13];
                            if ( this->m_records[13].m_pPed == pPed )
                            {
                              v3 = 13;
                            }
                            else
                            {
                              v2 = (CPlayerRelationshipRecorder *)&this->m_records[14];
                              if ( this->m_records[14].m_pPed == pPed )
                              {
                                v3 = 14;
                              }
                              else
                              {
                                v2 = (CPlayerRelationshipRecorder *)&this->m_records[15];
                                if ( this->m_records[15].m_pPed != pPed )
                                  return;
                                v3 = 15;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  v2->m_records[0].m_pPed = 0;
  this->m_records[v3].m_iType = 0;
}

//----- (004D67A4) --------------------------------------------------------
void __fastcall CPlayerRelationshipRecorder::AddRelationship(
        CPlayerRelationshipRecorder *this,
        const CPed *pPed,
        const int iType)
{
  if ( this->m_records[0].m_pPed )
  {
    this->m_records[0].m_iType = iType;
    this->m_records[0].m_pPed = pPed;
  }
}

//----- (004D67B0) --------------------------------------------------------
uint8 __fastcall CPlayerRelationshipRecorder::GetRelationshipWithPlayer(
        const CPlayerRelationshipRecorder *this,
        const CPed *pPed)
{
  int v3; // r1

  if ( this->m_records[0].m_pPed == pPed )
  {
    v3 = 0;
  }
  else if ( this->m_records[1].m_pPed == pPed )
  {
    v3 = 1;
  }
  else if ( this->m_records[2].m_pPed == pPed )
  {
    v3 = 2;
  }
  else if ( this->m_records[3].m_pPed == pPed )
  {
    v3 = 3;
  }
  else if ( this->m_records[4].m_pPed == pPed )
  {
    v3 = 4;
  }
  else if ( this->m_records[5].m_pPed == pPed )
  {
    v3 = 5;
  }
  else if ( this->m_records[6].m_pPed == pPed )
  {
    v3 = 6;
  }
  else if ( this->m_records[7].m_pPed == pPed )
  {
    v3 = 7;
  }
  else if ( this->m_records[8].m_pPed == pPed )
  {
    v3 = 8;
  }
  else if ( this->m_records[9].m_pPed == pPed )
  {
    v3 = 9;
  }
  else if ( this->m_records[10].m_pPed == pPed )
  {
    v3 = 10;
  }
  else if ( this->m_records[11].m_pPed == pPed )
  {
    v3 = 11;
  }
  else if ( this->m_records[12].m_pPed == pPed )
  {
    v3 = 12;
  }
  else if ( this->m_records[13].m_pPed == pPed )
  {
    v3 = 13;
  }
  else if ( this->m_records[14].m_pPed == pPed )
  {
    v3 = 14;
  }
  else
  {
    if ( this->m_records[15].m_pPed != pPed )
      return 0;
    v3 = 15;
  }
  return this->m_records[v3].m_iType;
}

//----- (004D685A) --------------------------------------------------------
void __fastcall CPlayerRelationshipRecorder::RecordRelationshipWithPlayer(
        CPlayerRelationshipRecorder *this,
        const CPed *pPed)
{
  CPlayerRelationshipRecorder *v4; // r1
  int v5; // r2
  CTask *ActiveTask; // r0
  const CTask *v7; // r6
  uint8 v8; // r0
  bool v9; // zf
  bool v10; // [sp+2h] [bp-16h] BYREF
  bool v11; // [sp+3h] [bp-15h] BYREF
  bool bIsFollowPlayerTask; // [sp+4h] [bp-14h] BYREF
  bool bIsFollowPedTask; // [sp+5h] [bp-13h] BYREF
  bool bIsKillPlayerTask; // [sp+6h] [bp-12h] BYREF
  bool bIsKillPedTask; // [sp+7h] [bp-11h] BYREF

  if ( this->m_records[0].m_pPed == pPed )
  {
    v5 = 0;
    v4 = this;
  }
  else
  {
    v4 = (CPlayerRelationshipRecorder *)&this->m_records[1];
    if ( this->m_records[1].m_pPed == pPed )
    {
      v5 = 1;
    }
    else
    {
      v4 = (CPlayerRelationshipRecorder *)&this->m_records[2];
      if ( this->m_records[2].m_pPed == pPed )
      {
        v5 = 2;
      }
      else
      {
        v4 = (CPlayerRelationshipRecorder *)&this->m_records[3];
        if ( this->m_records[3].m_pPed == pPed )
        {
          v5 = 3;
        }
        else
        {
          v4 = (CPlayerRelationshipRecorder *)&this->m_records[4];
          if ( this->m_records[4].m_pPed == pPed )
          {
            v5 = 4;
          }
          else
          {
            v4 = (CPlayerRelationshipRecorder *)&this->m_records[5];
            if ( this->m_records[5].m_pPed == pPed )
            {
              v5 = 5;
            }
            else
            {
              v4 = (CPlayerRelationshipRecorder *)&this->m_records[6];
              if ( this->m_records[6].m_pPed == pPed )
              {
                v5 = 6;
              }
              else
              {
                v4 = (CPlayerRelationshipRecorder *)&this->m_records[7];
                if ( this->m_records[7].m_pPed == pPed )
                {
                  v5 = 7;
                }
                else
                {
                  v4 = (CPlayerRelationshipRecorder *)&this->m_records[8];
                  if ( this->m_records[8].m_pPed == pPed )
                  {
                    v5 = 8;
                  }
                  else
                  {
                    v4 = (CPlayerRelationshipRecorder *)&this->m_records[9];
                    if ( this->m_records[9].m_pPed == pPed )
                    {
                      v5 = 9;
                    }
                    else
                    {
                      v4 = (CPlayerRelationshipRecorder *)&this->m_records[10];
                      if ( this->m_records[10].m_pPed == pPed )
                      {
                        v5 = 10;
                      }
                      else
                      {
                        v4 = (CPlayerRelationshipRecorder *)&this->m_records[11];
                        if ( this->m_records[11].m_pPed == pPed )
                        {
                          v5 = 11;
                        }
                        else
                        {
                          v4 = (CPlayerRelationshipRecorder *)&this->m_records[12];
                          if ( this->m_records[12].m_pPed == pPed )
                          {
                            v5 = 12;
                          }
                          else
                          {
                            v4 = (CPlayerRelationshipRecorder *)&this->m_records[13];
                            if ( this->m_records[13].m_pPed == pPed )
                            {
                              v5 = 13;
                            }
                            else
                            {
                              v4 = (CPlayerRelationshipRecorder *)&this->m_records[14];
                              if ( this->m_records[14].m_pPed == pPed )
                              {
                                v5 = 14;
                              }
                              else
                              {
                                v4 = (CPlayerRelationshipRecorder *)&this->m_records[15];
                                if ( this->m_records[15].m_pPed != pPed )
                                  goto LABEL_34;
                                v5 = 15;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  v4->m_records[0].m_pPed = 0;
  this->m_records[v5].m_iType = 0;
LABEL_34:
  ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  v7 = ActiveTask;
  if ( !ActiveTask )
    return;
  bIsKillPedTask = 0;
  bIsKillPlayerTask = 0;
  CTaskCategories::IsKillPedTask(ActiveTask, &bIsKillPedTask, &bIsKillPlayerTask);
  if ( bIsKillPlayerTask
    || (bIsFollowPedTask = 0,
        bIsFollowPlayerTask = 0,
        CTaskCategories::IsFollowPedTask(v7, &bIsFollowPedTask, &bIsFollowPlayerTask),
        bIsFollowPlayerTask) )
  {
    if ( !this->m_records[0].m_pPed )
      return;
    v8 = 3;
    goto LABEL_39;
  }
  v11 = 0;
  v10 = 0;
  CTaskCategories::IsKillPedTask(v7, &v11, &v10);
  v9 = !v10;
  if ( v10 )
    v9 = this->m_records[0].m_pPed == 0;
  if ( !v9 )
  {
    v8 = 7;
LABEL_39:
    this->m_records[0].m_iType = v8;
    this->m_records[0].m_pPed = pPed;
  }
}

//----- (004D69D8) --------------------------------------------------------
void __fastcall CTask::CTask(CTask *this)
{
  this->_vptr$CTask = (int (**)(void))&off_6693EC;
  this->m_pParent = 0;
}
// 6693EC: using guessed type void *;

//----- (004D69F0) --------------------------------------------------------
bool __fastcall CTask::IsTaskPtr(void *pData)
{
  int32 m_nSize; // r2
  int i; // r1

  m_nSize = CPools::ms_pTaskPool->m_nSize;
  if ( !m_nSize )
    return 0;
  for ( i = (m_nSize << 7) - 128;
        (CPools::ms_pTaskPool->m_aFlags[m_nSize - 1] & 0x80u) != 0
     || !&(*CPools::ms_pTaskPool->m_aStorage)[i]
     || (_BYTE *)pData - (_BYTE *)CPools::ms_pTaskPool->m_aStorage != i;
        i -= 128 )
  {
    if ( !--m_nSize )
      return 0;
  }
  return 1;
}

//----- (004D6A40) --------------------------------------------------------
bool8 __fastcall CTask::IsGoToTask(const CTask *pTask)
{
  return (*((int (__fastcall **)(const CTask *))pTask->_vptr$CTask + 5))(pTask) == 900
      || (*((int (__fastcall **)(const CTask *))pTask->_vptr$CTask + 5))(pTask) == 926;
}

//----- (004D6A70) --------------------------------------------------------
void *__fastcall CTask::operator new(size_t nSize)
{
  int v1; // lr
  CTaskPool *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pTaskPool;
  result = (void *)CPools::ms_pTaskPool->m_nFreeIndex;
  m_nSize = (void *)CPools::ms_pTaskPool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (004D6AD0) --------------------------------------------------------
void __fastcall CTask::operator delete(void *pVoid)
{
  CTaskPool *v1; // r1
  signed int v2; // r0

  v1 = CPools::ms_pTaskPool;
  v2 = (signed int)((int)pVoid - (unsigned int)CPools::ms_pTaskPool->m_aStorage) >> 7;
  CPools::ms_pTaskPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (004D6AF8) --------------------------------------------------------
void __fastcall CTaskSimple::CTaskSimple(CTaskSimple *this)
{
  this->_vptr$CTask = (int (**)(void))&off_669418;
  this->m_pParent = 0;
}
// 669418: using guessed type void *;

//----- (004D6B10) --------------------------------------------------------
void __fastcall CTaskComplex::CTaskComplex(CTaskComplex *this)
{
  this->_vptr$CTask = (int (**)(void))&off_66944C;
  this->m_pParent = 0;
  this->m_pSubTask = 0;
}
// 66944C: using guessed type void *;

//----- (004D6B28) --------------------------------------------------------
void __fastcall CTaskComplex::~CTaskComplex(CTaskComplex *this)
{
  CTask *m_pSubTask; // r0

  m_pSubTask = this->m_pSubTask;
  this->_vptr$CTask = (int (**)(void))&off_66944C;
  if ( m_pSubTask )
    (*((void (__fastcall **)(CTask *))m_pSubTask->_vptr$CTask + 1))(m_pSubTask);
  this->m_pSubTask = 0;
}
// 66944C: using guessed type void *off_66944C;

//----- (004D6B52) --------------------------------------------------------
void __fastcall CTaskComplex::SetSubTask(CTaskComplex *this, CTask *pSubTask)
{
  CTask *m_pSubTask; // r0

  m_pSubTask = this->m_pSubTask;
  if ( m_pSubTask != pSubTask )
  {
    if ( m_pSubTask )
      (*((void (__fastcall **)(CTask *))m_pSubTask->_vptr$CTask + 1))(m_pSubTask);
    this->m_pSubTask = pSubTask;
    if ( pSubTask )
      pSubTask->m_pParent = this;
  }
}

//----- (004D6B78) --------------------------------------------------------
void __fastcall CTaskSimpleAnim::CTaskSimpleAnim(CTaskSimpleAnim *this, bool bHoldLastFrame)
{
  int v3; // r0
  char v4; // r2

  CTaskSimple::CTaskSimple(this);
  v4 = *(_BYTE *)(v3 + 12);
  *(_DWORD *)(v3 + 8) = 0;
  *(_BYTE *)(v3 + 12) = v4 & 0xF8 | (4 * bHoldLastFrame);
  *(_DWORD *)v3 = &off_669488;
}
// 4D6B86: variable 'v3' is possibly undefined
// 669488: using guessed type void *;

//----- (004D6BA8) --------------------------------------------------------
bool __fastcall CTaskSimpleAnim::MakeAbortable(
        CTaskSimpleAnim *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  char v6; // r0
  int v9; // s16
  bool v10; // zf
  int m_iAccumulatedTime; // r0
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v13; // r0
  CAnimBlendAssociation *v14; // r0
  CAnimBlendAssociation *v16; // r0
  char v17; // r0

  v6 = *((_BYTE *)this + 12);
  if ( iPriority == 2 )
  {
    v9 = -998637568;
    *((_BYTE *)this + 12) = v6 & 0xFB;
    goto LABEL_8;
  }
  v9 = -4.0;
  v10 = pEvent == 0;
  if ( pEvent )
    v10 = (v6 & 2) == 0;
  if ( v10 )
  {
LABEL_8:
    if ( !pEvent )
      goto LABEL_15;
    goto LABEL_9;
  }
  if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) != 32 )
    return 0;
  v9 = -4.0;
LABEL_9:
  if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 32 )
  {
    m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
    if ( m_iAccumulatedTime )
    {
      if ( (*(int (__fastcall **)(int))(*(_DWORD *)m_iAccumulatedTime + 20))(m_iAccumulatedTime) == 401 )
      {
        m_pAnim = this->m_pAnim;
        if ( m_pAnim )
          m_pAnim->m_bitsFlag |= 4u;
        goto LABEL_20;
      }
    }
  }
LABEL_15:
  v13 = this->m_pAnim;
  if ( v13 )
  {
    v13->m_bitsFlag |= 4u;
    if ( (*((_BYTE *)this + 12) & 4) == 0 )
    {
      v14 = this->m_pAnim;
      if ( (v14->m_bitsFlag & 0x10) != 0 )
        LODWORD(v14->m_fBlendDelta) = v9;
      else
        CAnimManager::BlendAnimation(
          (RpClump_0 *)pPed->m_pRwObject,
          pPed->m_motionAnimGroup,
          ANIM_STD_IDLE,
          COERCE_FLOAT(v9 ^ 0x80000000));
    }
  }
LABEL_20:
  if ( (unsigned int)(iPriority - 1) >= 2 && (*((_BYTE *)this + 12) & 4) == 0 )
    return 0;
  v16 = this->m_pAnim;
  if ( v16 )
  {
    CAnimBlendAssociation::SetFinishCallback(v16, CDefaultAnimCallback::DefaultAnimCB, 0);
    v17 = *((_BYTE *)this + 12);
    this->m_pAnim = 0;
    *((_BYTE *)this + 12) = v17 | 1;
  }
  return 1;
}

//----- (004D6C98) --------------------------------------------------------
void __fastcall CTaskSimpleAnim::FinishRunAnimCB(CAnimBlendAssociation *pAnim, void *pData)
{
  char v2; // r0

  v2 = *((_BYTE *)pData + 12);
  *((_DWORD *)pData + 2) = 0;
  *((_BYTE *)pData + 12) = v2 | 1;
}

//----- (004D6CA8) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnim::CTaskSimpleRunAnim(
        CTaskSimpleRunAnim *this,
        const AssocGroupId animGroup,
        const AnimationId animID,
        const float fBlendDelta,
        const bool bHoldLastFrame)
{
  int v8; // r0
  char v9; // r3

  CTaskSimple::CTaskSimple(this);
  *(_DWORD *)(v8 + 8) = 0;
  *(_DWORD *)(v8 + 16) = animGroup;
  *(_DWORD *)(v8 + 20) = animID;
  *(const float *)(v8 + 24) = fBlendDelta;
  v9 = *(_BYTE *)(v8 + 12) & 0xF8;
  *(_WORD *)(v8 + 28) = 400;
  *(_BYTE *)(v8 + 12) = v9 | (4 * bHoldLastFrame);
  *(_DWORD *)v8 = &off_6694BC;
}
// 4D6CBE: variable 'v8' is possibly undefined
// 6694BC: using guessed type void *off_6694BC;

//----- (004D6CEC) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnim::CTaskSimpleRunAnim(
        CTaskSimpleRunAnim *this,
        const AssocGroupId animGroup,
        const AnimationId animID,
        const float fBlendDelta,
        const int iTaskType,
        const unsigned __int8 *pTaskName,
        const bool bHoldLastFrame)
{
  int v10; // r0
  char v11; // r2

  CTaskSimple::CTaskSimple(this);
  *(_DWORD *)(v10 + 8) = 0;
  v11 = *(_BYTE *)(v10 + 12) & 0xF8;
  *(_DWORD *)(v10 + 16) = animGroup;
  *(_DWORD *)(v10 + 20) = animID;
  *(const float *)(v10 + 24) = fBlendDelta;
  *(_WORD *)(v10 + 28) = iTaskType;
  *(_BYTE *)(v10 + 12) = v11 | (4 * bHoldLastFrame);
  *(_DWORD *)v10 = &off_6694BC;
}
// 4D6D02: variable 'v10' is possibly undefined
// 6694BC: using guessed type void *;

//----- (004D6D30) --------------------------------------------------------
bool __fastcall CTaskSimpleRunAnim::ProcessPed(CTaskSimpleRunAnim *this, CPed *pPed)
{
  CAnimBlendAssociation *v5; // r0

  if ( *((unsigned __int8 *)&this->CTaskSimpleAnim + 12) << 31 )
    return 1;
  if ( !this->m_pAnim && !RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, this->m_animID) )
  {
    v5 = CAnimManager::BlendAnimation(
           (RpClump_0 *)pPed->m_pRwObject,
           this->m_animGroup,
           this->m_animID,
           this->m_fBlendDelta);
    this->m_pAnim = v5;
    CAnimBlendAssociation::SetFinishCallback(v5, CTaskSimpleAnim::FinishRunAnimCB, this);
  }
  return *((_BYTE *)&this->CTaskSimpleAnim + 12) & 1;
}

//----- (004D6D78) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnim::StartAnim(CTaskSimpleRunAnim *this, CPed *pPed)
{
  CAnimBlendAssociation *v3; // r0

  v3 = CAnimManager::BlendAnimation(
         (RpClump_0 *)pPed->m_pRwObject,
         this->m_animGroup,
         this->m_animID,
         this->m_fBlendDelta);
  this->m_pAnim = v3;
  sub_18C19C(v3, CTaskSimpleAnim::FinishRunAnimCB, this);
}

//----- (004D6DA4) --------------------------------------------------------
void __fastcall CTaskSimpleRunNamedAnim::CTaskSimpleRunNamedAnim(
        CTaskSimpleRunNamedAnim *this,
        const unsigned __int8 *pAnimName,
        const unsigned __int8 *pAnimGroupName,
        const int32 flags,
        const float fBlendDelta,
        const int iTime,
        const bool bDontInterrupt,
        const bool bRunInSequence,
        const bool bOffsetPed,
        const bool bHoldLastFrame)
{
  CAnimBlendHierarchy *Animation; // r5
  char v15; // r1
  CAnimBlock *AnimationBlock; // r1

  CTaskSimple::CTaskSimple(this);
  Animation = 0;
  this->m_iTime = iTime;
  v15 = *((_BYTE *)&this->CTaskSimpleAnim:104 + 12);
  this->m_pAnim = 0;
  this->m_fBlendDelta = fBlendDelta;
  *(_WORD *)&this->m_timer.m_bIsActive = 0;
  this->m_offsetAtEnd.x = 0.0;
  this->m_offsetAtEnd.y = 0.0;
  this->m_offsetAtEnd.z = 0.0;
  this->m_flags = flags;
  this->m_timer.m_iStartTime = 0;
  this->m_timer.m_iDuration = 0;
  this->_vptr$CTask = (int (**)(void))&off_6694F0;
  *((_BYTE *)&this->CTaskSimpleAnim:104 + 12) = (16 * bRunInSequence) | (2 * bDontInterrupt) | (32 * bOffsetPed) | v15 & 0x88 | (4 * bHoldLastFrame);
  strcpy((char *)this->m_animName, (const char *)pAnimName);
  strcpy((char *)this->m_animGroupName, (const char *)pAnimGroupName);
  AnimationBlock = CAnimManager::GetAnimationBlock(this->m_animGroupName);
  if ( AnimationBlock )
    Animation = CAnimManager::GetAnimation(this->m_animName, AnimationBlock);
  this->m_pAnimHierarchy = Animation;
}
// 6694F0: using guessed type void *;

//----- (004D6E3C) --------------------------------------------------------
bool __fastcall CTaskSimpleRunNamedAnim::ProcessPed(CTaskSimpleRunNamedAnim *this, CPed *pPed)
{
  int v4; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float y; // s4
  float z; // s6
  CAnimBlendHierarchy *m_pAnimHierarchy; // r1
  unsigned int v10; // r0
  int m_iStartTime; // r1
  CAnimBlendAssociation *Association; // r6
  CMatrix *v13; // r1
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v15; // d16
  unsigned __int64 v16; // d1
  CAnimBlendAssociation *m_pAnim; // r0
  char v18; // r0
  CAnimBlendAssociation *v20; // r0
  bool v21; // zf
  CVector v22; // [sp+4h] [bp-1Ch] BYREF

  v4 = *((unsigned __int8 *)&this->CTaskSimpleAnim:104 + 12);
  if ( (v4 & 0x40) != 0 )
  {
    CEntity::UpdateRpHAnim(pPed);
    *(_DWORD *)&pPed->m_nFlags |= 0x800000u;
    Multiply3x3(&v22, pPed->m_pMat, &this->m_offsetAtEnd);
    m_pMat = pPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    y = p_tx->m_translate.y;
    z = p_tx->m_translate.z;
    p_tx->m_translate.x = v22.x + p_tx->m_translate.x;
    p_tx->m_translate.y = v22.y + y;
    p_tx->m_translate.z = v22.z + z;
    v4 = *((_BYTE *)&this->CTaskSimpleAnim:104 + 12) & 0xBF;
    *((_BYTE *)&this->CTaskSimpleAnim:104 + 12) = v4;
  }
  if ( v4 << 31 )
  {
    if ( (v4 & 0x20) == 0 )
    {
      Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 1, this->m_pAnimHierarchy);
      memset(&v22, 0, sizeof(v22));
      CPed::GetBonePosition(pPed, &v22, 3u, 0);
      if ( Association )
      {
        if ( this->m_fBlendDelta > 100.0 )
        {
          v13 = pPed->m_pMat;
          p_m_transform = (CSimpleTransform *)&v13->tx;
          if ( !v13 )
            p_m_transform = &pPed->m_transform;
          v15.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&v22.y).n64_u64[0];
          v16 = vmul_f32(v15, v15).n64_u64[0];
          if ( sqrtf(
                 (float)((float)((float)(p_m_transform->m_translate.x - v22.x)
                               * (float)(p_m_transform->m_translate.x - v22.x))
                       + *(float *)&v16)
               + *((float *)&v16 + 1)) > 1.0 )
          {
            Association->m_bitsFlag |= 4u;
            Association->m_fBlendDelta = -this->m_fBlendDelta;
          }
        }
      }
    }
    return 1;
  }
  m_pAnimHierarchy = this->m_pAnimHierarchy;
  if ( !m_pAnimHierarchy || !m_pAnimHierarchy->m_pSequences )
    return 1;
  if ( (v4 & 2) != 0 && (this->m_flags & 0xA) != 8 )
  {
    CEventGroup::RemoveInvalidEvents(&pPed->m_pPedIntelligence->m_eventGroup, 1);
    CEventGroup::Reorganise(&pPed->m_pPedIntelligence->m_eventGroup);
  }
  if ( !this->m_timer.m_bIsActive
    || (!this->m_timer.m_bIsStopped ? (m_iStartTime = this->m_timer.m_iStartTime, v10 = CTimer::m_snTimeInMilliseconds) : (v10 = CTimer::m_snTimeInMilliseconds, this->m_timer.m_bIsStopped = 0, this->m_timer.m_iStartTime = v10, m_iStartTime = v10),
        m_iStartTime + this->m_timer.m_iDuration > v10) )
  {
LABEL_28:
    if ( !this->m_pAnim )
    {
      v20 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 1, this->m_pAnimHierarchy);
      v21 = v20 == 0;
      if ( v20 )
        v21 = v20->m_pCBData == 0;
      if ( !v21 )
        return 1;
      CTaskSimpleRunNamedAnim::StartAnim(this, pPed);
    }
    return *((_BYTE *)&this->CTaskSimpleAnim:104 + 12) & 1;
  }
  if ( (this->m_flags & 8) != 0 )
  {
    (*((void (__fastcall **)(CTaskSimpleRunNamedAnim *, CPed *, _DWORD, _DWORD))this->_vptr$CTask + 7))(
      this,
      pPed,
      0,
      0);
    goto LABEL_28;
  }
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  v18 = *((_BYTE *)&this->CTaskSimpleAnim:104 + 12);
  this->m_pAnim = 0;
  *((_BYTE *)&this->CTaskSimpleAnim:104 + 12) = v18 | 1;
  return 1;
}

//----- (004D7038) --------------------------------------------------------
void __fastcall CTaskSimpleRunNamedAnim::OffsetPedPosition(CTaskSimpleRunNamedAnim *this, CPed *pPed)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float y; // s4
  float z; // s6
  CVector v8; // [sp+4h] [bp-14h] BYREF

  CEntity::UpdateRpHAnim(pPed);
  *(_DWORD *)&pPed->m_nFlags |= 0x800000u;
  Multiply3x3(&v8, pPed->m_pMat, &this->m_offsetAtEnd);
  m_pMat = pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  y = p_tx->m_translate.y;
  z = p_tx->m_translate.z;
  p_tx->m_translate.x = v8.x + p_tx->m_translate.x;
  p_tx->m_translate.y = v8.y + y;
  p_tx->m_translate.z = v8.z + z;
  *((_BYTE *)&this->CTaskSimpleAnim:104 + 12) &= ~0x40u;
}

//----- (004D70A4) --------------------------------------------------------
void __fastcall CTaskSimpleRunNamedAnim::StartAnim(CTaskSimpleRunNamedAnim *this, CPed *pPed)
{
  int m_iTime; // r0
  int v4; // r2
  int32 m_flags; // r2
  CAnimBlendAssociation *v6; // r0
  char v7; // r1
  void **v8; // r1

  m_iTime = this->m_iTime;
  if ( m_iTime >= 0 )
  {
    v4 = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_bIsActive = 1;
    this->m_timer.m_iStartTime = v4;
    this->m_timer.m_iDuration = m_iTime;
  }
  m_flags = this->m_flags;
  if ( (m_flags & 8) == 0 )
  {
    m_flags |= 4u;
    this->m_flags = m_flags;
  }
  v6 = CAnimManager::BlendAnimation(
         (RpClump_0 *)pPed->m_pRwObject,
         this->m_pAnimHierarchy,
         m_flags,
         this->m_fBlendDelta);
  v7 = *((_BYTE *)&this->CTaskSimpleAnim:104 + 12);
  this->m_pAnim = v6;
  if ( (v7 & 0x20) != 0 )
  {
    v8 = &CTaskSimpleRunNamedAnim::FinishRunAnimMovePedCB;
LABEL_11:
    CAnimBlendAssociation::SetFinishCallback(v6, (CAnimBlendAssocationCallback)*v8, this);
    goto LABEL_12;
  }
  if ( (v7 & 0x10) != 0 || (this->m_flags & 8) != 0 )
  {
    v8 = &CTaskSimpleAnim::FinishRunAnimCB;
    goto LABEL_11;
  }
  CAnimBlendAssociation::SetDeleteCallback(v6, CTaskSimpleAnim::FinishRunAnimCB, this);
LABEL_12:
  this->m_animID = this->m_pAnim->m_animId;
}
// 678B5C: using guessed type void *CTaskSimpleAnim::FinishRunAnimCB;
// 679E20: using guessed type void *CTaskSimpleRunNamedAnim::FinishRunAnimMovePedCB;

//----- (004D712C) --------------------------------------------------------
void __fastcall CTaskSimpleRunNamedAnim::FinishRunAnimMovePedCB(CAnimBlendAssociation *pAnim, void *pData)
{
  CAnimBlendNode *Node; // r0
  uint16 m_bitsFlag; // r0
  char v6; // r0

  Node = CAnimBlendAssociation::GetNode(pAnim, 0);
  CAnimBlendNode::GetCurrentTranslation(Node, (CVector *)((char *)pData + 80), 0.0);
  *((_BYTE *)pData + 12) |= 0x40u;
  m_bitsFlag = pAnim->m_bitsFlag;
  pAnim->m_bitsFlag = m_bitsFlag | 0x2000;
  if ( (m_bitsFlag & 8) != 0 || pAnim->m_cbType == ABCB_DELETE )
  {
    v6 = *((_BYTE *)pData + 12);
    *((_DWORD *)pData + 2) = 0;
    *((_BYTE *)pData + 12) = v6 | 1;
  }
  else
  {
    sub_1929E0(pAnim, CTaskSimpleAnim::FinishRunAnimCB, pData);
  }
}

//----- (004D7190) --------------------------------------------------------
void __fastcall CTaskSimpleRunTimedAnim::CTaskSimpleRunTimedAnim(
        CTaskSimpleRunTimedAnim *this,
        const AssocGroupId animGroup,
        const AnimationId animID,
        const float fBlendDelta,
        const float fBlendOutDelta,
        const int iDuration,
        const bool bHoldLastFrame)
{
  int v10; // r0
  char v11; // r3

  CTaskSimple::CTaskSimple(this);
  *(_DWORD *)(v10 + 8) = 0;
  *(_DWORD *)(v10 + 16) = animGroup;
  *(_DWORD *)(v10 + 20) = animID;
  *(const float *)(v10 + 24) = fBlendDelta;
  *(const float *)(v10 + 28) = fBlendOutDelta;
  *(_DWORD *)(v10 + 32) = iDuration;
  *(_WORD *)(v10 + 44) = 0;
  v11 = *(_BYTE *)(v10 + 12);
  *(_WORD *)(v10 + 48) = 402;
  *(_DWORD *)(v10 + 36) = 0;
  *(_DWORD *)(v10 + 40) = 0;
  *(_BYTE *)(v10 + 12) = v11 & 0xF8 | (4 * bHoldLastFrame);
  *(_DWORD *)v10 = &off_669524;
}
// 4D71B0: variable 'v10' is possibly undefined
// 669524: using guessed type void *off_669524;

//----- (004D71E8) --------------------------------------------------------
void __fastcall CTaskSimpleRunTimedAnim::CTaskSimpleRunTimedAnim(
        CTaskSimpleRunTimedAnim *this,
        const AssocGroupId animGroup,
        const AnimationId animID,
        const float fBlendDelta,
        const float fBlendOutDelta,
        const int iDuration,
        const int iTaskType,
        const unsigned __int8 *pTaskName,
        const bool bHoldLastFrame)
{
  int v12; // r0
  char v13; // r2

  CTaskSimple::CTaskSimple(this);
  *(_DWORD *)(v12 + 8) = 0;
  v13 = *(_BYTE *)(v12 + 12);
  *(_DWORD *)(v12 + 16) = animGroup;
  *(_DWORD *)(v12 + 20) = animID;
  *(const float *)(v12 + 24) = fBlendDelta;
  *(const float *)(v12 + 28) = fBlendOutDelta;
  *(_DWORD *)(v12 + 32) = iDuration;
  *(_WORD *)(v12 + 44) = 0;
  *(_WORD *)(v12 + 48) = iTaskType;
  *(_DWORD *)(v12 + 36) = 0;
  *(_DWORD *)(v12 + 40) = 0;
  *(_BYTE *)(v12 + 12) = v13 & 0xF8 | (4 * bHoldLastFrame);
  *(_DWORD *)v12 = &off_669524;
}
// 4D7204: variable 'v12' is possibly undefined
// 669524: using guessed type void *;

//----- (004D7244) --------------------------------------------------------
bool __fastcall CTaskSimpleRunTimedAnim::ProcessPed(CTaskSimpleRunTimedAnim *this, CPed *pPed)
{
  unsigned int v5; // r0
  int m_iStartTime; // r1
  AssocGroupId m_animGroup; // r1
  AnimationId m_animID; // r2
  float m_fBlendDelta; // r3
  int m_iDuration; // r0
  CAnimBlendAssociation *v11; // r0

  if ( *((unsigned __int8 *)&this->CTaskSimpleAnim + 12) << 31 )
    return 1;
  if ( this->m_timer.m_bIsActive )
  {
    if ( this->m_timer.m_bIsStopped )
    {
      v5 = CTimer::m_snTimeInMilliseconds;
      this->m_timer.m_bIsStopped = 0;
      this->m_timer.m_iStartTime = v5;
      m_iStartTime = v5;
    }
    else
    {
      m_iStartTime = this->m_timer.m_iStartTime;
      v5 = CTimer::m_snTimeInMilliseconds;
    }
    if ( m_iStartTime + this->m_timer.m_iDuration <= v5 )
      (*((void (__fastcall **)(CTaskSimpleRunTimedAnim *, CPed *, _DWORD, _DWORD))this->_vptr$CTask + 7))(
        this,
        pPed,
        0,
        0);
  }
  if ( !this->m_pAnim && !RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, this->m_animID) )
  {
    m_animGroup = this->m_animGroup;
    m_animID = this->m_animID;
    m_fBlendDelta = this->m_fBlendDelta;
    m_iDuration = this->m_iDuration;
    this->m_timer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_iDuration = m_iDuration;
    this->m_timer.m_bIsActive = 1;
    v11 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, m_animGroup, m_animID, m_fBlendDelta);
    this->m_pAnim = v11;
    CAnimBlendAssociation::SetDeleteCallback(v11, CTaskSimpleAnim::FinishRunAnimCB, this);
  }
  return *((_BYTE *)&this->CTaskSimpleAnim + 12) & 1;
}

//----- (004D72F0) --------------------------------------------------------
void __fastcall CTaskSimpleRunTimedAnim::StartAnim(CTaskSimpleRunTimedAnim *this, CPed *pPed)
{
  CAnimBlendAssociation *v3; // r0

  v3 = CAnimManager::BlendAnimation(
         (RpClump_0 *)pPed->m_pRwObject,
         this->m_animGroup,
         this->m_animID,
         this->m_fBlendDelta);
  this->m_pAnim = v3;
  sub_1929E0(v3, CTaskSimpleAnim::FinishRunAnimCB, this);
}

//----- (004D731C) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnimLoopedMiddle::CTaskSimpleRunAnimLoopedMiddle(
        CTaskSimpleRunAnimLoopedMiddle *this,
        const AssocGroupId animGroup,
        const AnimationId animID,
        const float fBlendDelta,
        float loopStartRatio,
        float loopEndRatio,
        int32 loopTime,
        const bool bHoldLastFrame)
{
  int v11; // r0
  char v12; // r2

  CTaskSimple::CTaskSimple(this);
  *(_DWORD *)(v11 + 8) = 0;
  *(_WORD *)(v11 + 104) = 0;
  v12 = *(_BYTE *)(v11 + 12);
  *(_WORD *)(v11 + 108) = 424;
  *(float *)(v11 + 76) = loopStartRatio;
  *(float *)(v11 + 80) = loopEndRatio;
  *(_DWORD *)(v11 + 68) = 0;
  *(const float *)(v11 + 72) = fBlendDelta;
  *(_DWORD *)(v11 + 16) = animGroup;
  *(_DWORD *)(v11 + 20) = animID;
  *(_DWORD *)(v11 + 24) = 0;
  *(_DWORD *)(v11 + 92) = loopTime;
  *(_DWORD *)(v11 + 96) = 0;
  *(_DWORD *)(v11 + 100) = 0;
  *(_BYTE *)(v11 + 12) = v12 & 0xF8 | (4 * bHoldLastFrame);
  *(_DWORD *)v11 = &off_669558;
}
// 4D7334: variable 'v11' is possibly undefined
// 669558: using guessed type void *;

//----- (004D738C) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnimLoopedMiddle::CTaskSimpleRunAnimLoopedMiddle(
        CTaskSimpleRunAnimLoopedMiddle *this,
        const unsigned __int8 *pAnimName,
        const unsigned __int8 *pAnimGroupName,
        const int32 flags,
        const float fBlendDelta,
        float loopStartRatio,
        float loopEndRatio,
        int32 loopTime,
        const bool bHoldLastFrame)
{
  char v13; // r3
  CAnimBlock *AnimationBlock; // r0

  CTaskSimple::CTaskSimple(this);
  this->m_pAnim = 0;
  this->m_flags = flags;
  *(_WORD *)&this->m_timer.m_bIsActive = 0;
  v13 = *((_BYTE *)&this->CTaskSimpleAnim + 12);
  this->m_iTaskType = 424;
  this->m_fBlendDelta = fBlendDelta;
  this->m_loopStartRatio = loopStartRatio;
  this->m_loopEndRatio = loopEndRatio;
  *(_QWORD *)&this->m_loopTime = (unsigned int)loopTime;
  this->m_timer.m_iDuration = 0;
  *((_BYTE *)&this->CTaskSimpleAnim + 12) = v13 & 0xF8 | (4 * bHoldLastFrame);
  this->_vptr$CTask = (int (**)(void))&off_669558;
  strcpy((char *)this->m_animName, (const char *)pAnimName);
  strcpy((char *)this->m_animGroupName, (const char *)pAnimGroupName);
  AnimationBlock = CAnimManager::GetAnimationBlock(this->m_animGroupName);
  this->m_pAnimHierarchy = CAnimManager::GetAnimation(this->m_animName, AnimationBlock);
  this->m_animGroup = ANIM_STD_PED;
  this->m_animID = ANIM_STD_NUM;
}
// 669558: using guessed type void *off_669558;

//----- (004D742C) --------------------------------------------------------
bool __fastcall CTaskSimpleRunAnimLoopedMiddle::ProcessPed(CTaskSimpleRunAnimLoopedMiddle *this, CPed *pPed)
{
  CAnimBlendHierarchy *m_pAnimHierarchy; // r1
  RpClump_0 *m_pRwObject; // r0
  CAnimBlendAssociation *v7; // r0
  CAnimBlendAssociation *v8; // r0
  __int64 v9; // r0
  unsigned int v10; // r0
  int m_iStartTime; // r1
  CAnimBlendAssociation *m_pAnim; // r0
  float m_loopEndTime; // s0
  float m_fCurrentTime; // s2

  if ( *((unsigned __int8 *)&this->CTaskSimpleAnim + 12) << 31 )
    return 1;
  if ( this->m_pAnim && !RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, this->m_animID == ANIM_STD_WALK) )
  {
    if ( !this->m_timer.m_bIsActive
      || (!this->m_timer.m_bIsStopped ? (m_iStartTime = this->m_timer.m_iStartTime, v10 = CTimer::m_snTimeInMilliseconds) : (v10 = CTimer::m_snTimeInMilliseconds, this->m_timer.m_bIsStopped = 0, this->m_timer.m_iStartTime = v10, m_iStartTime = v10),
          m_iStartTime + this->m_timer.m_iDuration > v10) )
    {
      m_pAnim = this->m_pAnim;
      if ( m_pAnim )
      {
        m_loopEndTime = this->m_loopEndTime;
        m_fCurrentTime = m_pAnim->m_fCurrentTime;
        if ( m_fCurrentTime > m_loopEndTime && (float)(m_fCurrentTime - m_pAnim->m_fTimeStep) <= m_loopEndTime )
        {
          CAnimBlendAssociation::SetCurrentTime(m_pAnim, this->m_loopStartTime);
          this->m_pAnim->m_bitsFlag |= 1u;
        }
      }
    }
    return 0;
  }
  else
  {
    m_pAnimHierarchy = this->m_pAnimHierarchy;
    m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
    if ( m_pAnimHierarchy )
      v7 = CAnimManager::BlendAnimation(m_pRwObject, m_pAnimHierarchy, this->m_flags, this->m_fBlendDelta);
    else
      v7 = CAnimManager::BlendAnimation(m_pRwObject, this->m_animGroup, this->m_animID, this->m_fBlendDelta);
    this->m_pAnim = v7;
    CAnimBlendAssociation::SetFinishCallback(v7, CTaskSimpleAnim::FinishRunAnimCB, this);
    v8 = this->m_pAnim;
    this->m_loopStartTime = this->m_loopStartRatio * v8->m_pAnimBlendHierarchy->m_fTotalTime;
    HIDWORD(v9) = this->m_loopTime;
    this->m_loopEndTime = this->m_loopEndRatio * v8->m_pAnimBlendHierarchy->m_fTotalTime;
    LODWORD(v9) = CTimer::m_snTimeInMilliseconds;
    this->m_timer.m_bIsActive = 1;
    *(_QWORD *)&this->m_timer.m_iStartTime = v9;
    return 0;
  }
}

//----- (004D7538) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnimLoopedMiddle::StartAnim(CTaskSimpleRunAnimLoopedMiddle *this, CPed *pPed)
{
  RpClump_0 *m_pRwObject; // r0
  CAnimBlendHierarchy *m_pAnimHierarchy; // r1
  CAnimBlendAssociation *v5; // r0

  m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
  m_pAnimHierarchy = this->m_pAnimHierarchy;
  if ( m_pAnimHierarchy )
    v5 = CAnimManager::BlendAnimation(m_pRwObject, m_pAnimHierarchy, this->m_flags, this->m_fBlendDelta);
  else
    v5 = CAnimManager::BlendAnimation(m_pRwObject, this->m_animGroup, this->m_animID, this->m_fBlendDelta);
  this->m_pAnim = v5;
  sub_18C19C(v5, CTaskSimpleAnim::FinishRunAnimCB, this);
}

//----- (004D7570) --------------------------------------------------------
void __fastcall CTaskSimplePlayHandSignalAnim::CTaskSimplePlayHandSignalAnim(
        CTaskSimplePlayHandSignalAnim *this,
        const AnimationId animId,
        const float fBlendDelta,
        int useFatHands,
        const bool bHoldLastFrame)
{
  int v8; // r0

  CTaskSimple::CTaskSimple(this);
  *(_DWORD *)(v8 + 8) = 0;
  *(_DWORD *)(v8 + 16) = animId;
  *(const float *)(v8 + 20) = fBlendDelta;
  LOBYTE(animId) = *(_BYTE *)(v8 + 12);
  *(_BYTE *)(v8 + 24) = useFatHands != 0;
  *(_DWORD *)(v8 + 28) = 0;
  *(_DWORD *)(v8 + 32) = 0;
  *(_BYTE *)(v8 + 12) = animId & 0xF8 | (4 * bHoldLastFrame);
  *(_DWORD *)v8 = &off_66958C;
}
// 4D7586: variable 'v8' is possibly undefined
// 66958C: using guessed type void *off_66958C;

//----- (004D75B8) --------------------------------------------------------
void __fastcall CTaskSimplePlayHandSignalAnim::~CTaskSimplePlayHandSignalAnim(CTaskSimplePlayHandSignalAnim *this)
{
  CHandObject *m_pLeftHand; // r0
  CHandObject *v3; // r0
  CHandObject *m_pRightHand; // r0
  CHandObject *v5; // r0
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v7; // r0

  m_pLeftHand = this->m_pLeftHand;
  this->_vptr$CTask = (int (**)(void))&off_66958C;
  if ( m_pLeftHand )
  {
    CWorld::Remove(m_pLeftHand);
    v3 = this->m_pLeftHand;
    if ( v3 )
      (*((void (__fastcall **)(CHandObject *))v3->_vptr$CPlaceable + 1))(v3);
    --CObject::nNoTempObjects;
  }
  m_pRightHand = this->m_pRightHand;
  if ( m_pRightHand )
  {
    CWorld::Remove(m_pRightHand);
    v5 = this->m_pRightHand;
    if ( v5 )
      (*((void (__fastcall **)(CHandObject *))v5->_vptr$CPlaceable + 1))(v5);
    --CObject::nNoTempObjects;
  }
  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669488;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim->m_bitsFlag |= 4u;
    if ( (*((_BYTE *)&this->CTaskSimpleAnim + 12) & 4) == 0 )
    {
      v7 = this->m_pAnim;
      if ( v7->m_fBlendAmount > 0.0 && v7->m_fBlendDelta >= 0.0 )
        v7->m_fBlendDelta = -4.0;
    }
    this->m_pAnim = 0;
  }
  sub_1A01F4(this);
}
// 669488: using guessed type void *off_669488;
// 66958C: using guessed type void *;

//----- (004D767C) --------------------------------------------------------
void __fastcall CTaskSimplePlayHandSignalAnim::~CTaskSimplePlayHandSignalAnim(CTaskSimplePlayHandSignalAnim *this)
{
  void *v1; // r0

  CTaskSimplePlayHandSignalAnim::~CTaskSimplePlayHandSignalAnim(this);
  sub_197118(v1);
}
// 4D7688: variable 'v1' is possibly undefined

//----- (004D768C) --------------------------------------------------------
bool __fastcall CTaskSimplePlayHandSignalAnim::ProcessPed(CTaskSimplePlayHandSignalAnim *this, CPed *pPed)
{
  bool v4; // r6
  char v5; // r0

  v4 = 1;
  if ( !IKChainManager_c::IsArmPointing(&g_ikChainMan, 1, pPed) )
  {
    v5 = *((_BYTE *)&this->CTaskSimpleAnim + 12);
    if ( (v5 & 1) == 0 )
    {
      if ( !this->m_pAnim )
      {
        if ( CObject::nNoTempObjects > 0x94u )
          return 1;
        CTaskSimplePlayHandSignalAnim::StartAnim(this, pPed);
        v5 = *((_BYTE *)&this->CTaskSimpleAnim + 12);
      }
      return v5 & 1;
    }
    return 1;
  }
  return v4;
}

//----- (004D76E4) --------------------------------------------------------
void __fastcall CTaskSimplePlayHandSignalAnim::StartAnim(CTaskSimplePlayHandSignalAnim *this, CPed *pPed)
{
  int v4; // r6
  CAnimBlendAssociation *v5; // r0
  _BOOL4 m_useFatHands; // r6
  CHandObject *v7; // r0
  CHandObject *v8; // r0
  CAnimBlendStaticAssociation *AnimAssociation; // r0
  CAnimBlendAssociation *v10; // r0
  _BOOL4 v11; // r6
  CHandObject *v12; // r0
  CHandObject *v13; // r0
  CAnimBlendStaticAssociation *v14; // r0
  _BOOL4 v15; // r6
  CHandObject *v16; // r0
  CHandObject *v17; // r0
  CAnimBlendStaticAssociation *v18; // r0

  v4 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 5.0) + 320;
  if ( CPed::GetEntityThatThisPedIsHolding(pPed)
    || IKChainManager_c::IsArmPointing(&g_ikChainMan, 0, pPed)
    || pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType )
  {
    v5 = CAnimManager::BlendAnimation(
           (RpClump_0 *)pPed->m_pRwObject,
           ANIM_HANDSIGNAL_PEDL,
           (AnimationId)v4,
           this->m_fBlendDelta);
    this->m_pAnim = v5;
    CAnimBlendAssociation::SetFinishCallback(v5, CTaskSimpleAnim::FinishRunAnimCB, this);
    if ( this->m_animId == -1 )
      return;
    m_useFatHands = this->m_useFatHands;
    v7 = (CHandObject *)CObject::operator new(0x194u);
    if ( m_useFatHands )
    {
      CHandObject::CHandObject(v7, 396, pPed, 1);
      this->m_pLeftHand = v8;
      if ( !v8 )
        return;
    }
    else
    {
      CHandObject::CHandObject(v7, 394, pPed, 1);
      this->m_pLeftHand = v8;
      if ( !v8 )
        return;
    }
    CWorld::Add(v8);
    AnimAssociation = CAnimManager::GetAnimAssociation(ANIM_HANDSIGNAL_LHAND, this->m_animId);
    CAnimManager::AddAnimation((RpClump_0 *)this->m_pLeftHand->m_pRwObject, AnimAssociation->m_pAnimBlendHierarchy, 0);
    goto LABEL_10;
  }
  v10 = CAnimManager::BlendAnimation(
          (RpClump_0 *)pPed->m_pRwObject,
          ANIM_HANDSIGNAL_PED,
          (AnimationId)v4,
          this->m_fBlendDelta);
  this->m_pAnim = v10;
  CAnimBlendAssociation::SetFinishCallback(v10, CTaskSimpleAnim::FinishRunAnimCB, this);
  if ( this->m_animId == -1 )
    return;
  v11 = this->m_useFatHands;
  v12 = (CHandObject *)CObject::operator new(0x194u);
  if ( v11 )
  {
    CHandObject::CHandObject(v12, 396, pPed, 1);
    this->m_pLeftHand = v13;
    if ( !v13 )
      goto LABEL_18;
  }
  else
  {
    CHandObject::CHandObject(v12, 394, pPed, 1);
    this->m_pLeftHand = v13;
    if ( !v13 )
      goto LABEL_18;
  }
  CWorld::Add(v13);
  v14 = CAnimManager::GetAnimAssociation(ANIM_HANDSIGNAL_LHAND, this->m_animId);
  CAnimManager::AddAnimation((RpClump_0 *)this->m_pLeftHand->m_pRwObject, v14->m_pAnimBlendHierarchy, 0);
  ++CObject::nNoTempObjects;
LABEL_18:
  if ( this->m_animId != -1 )
  {
    v15 = this->m_useFatHands;
    v16 = (CHandObject *)CObject::operator new(0x194u);
    if ( v15 )
    {
      CHandObject::CHandObject(v16, 397, pPed, 0);
      this->m_pRightHand = v17;
      if ( v17 )
      {
LABEL_21:
        CWorld::Add(v17);
        v18 = CAnimManager::GetAnimAssociation(ANIM_HANDSIGNAL_RHAND, this->m_animId);
        CAnimManager::AddAnimation((RpClump_0 *)this->m_pRightHand->m_pRwObject, v18->m_pAnimBlendHierarchy, 0);
LABEL_10:
        ++CObject::nNoTempObjects;
      }
    }
    else
    {
      CHandObject::CHandObject(v16, 395, pPed, 0);
      this->m_pRightHand = v17;
      if ( v17 )
        goto LABEL_21;
    }
  }
}
// 4D7780: variable 'v8' is possibly undefined
// 4D7818: variable 'v13' is possibly undefined
// 4D7890: variable 'v17' is possibly undefined

//----- (004D7910) --------------------------------------------------------
void __fastcall CTaskComplexPlayHandSignalAnim::CTaskComplexPlayHandSignalAnim(
        CTaskComplexPlayHandSignalAnim *this,
        const AnimationId animId,
        const float fBlendDelta)
{
  int v5; // r0
  char v6; // r2

  CTaskComplex::CTaskComplex(this);
  v6 = *(_BYTE *)(v5 + 20);
  *(_DWORD *)(v5 + 12) = animId;
  *(const float *)(v5 + 16) = fBlendDelta;
  *(_BYTE *)(v5 + 20) = v6 & 0xF8;
  *(_DWORD *)v5 = &off_6695C0;
}
// 4D791E: variable 'v5' is possibly undefined
// 6695C0: using guessed type void *off_6695C0;

//----- (004D7938) --------------------------------------------------------
void __fastcall CTaskComplexPlayHandSignalAnim::~CTaskComplexPlayHandSignalAnim(CTaskComplexPlayHandSignalAnim *this)
{
  char v2; // r0
  CBaseModelInfo *v3; // r0
  CBaseModelInfo *v4; // r0
  int32 v5; // r0

  v2 = *((_BYTE *)this + 20);
  this->_vptr$CTask = (int (**)(void))&off_6695C0;
  if ( (v2 & 1) != 0 )
  {
    if ( (v2 & 8) != 0 )
      v3 = CModelInfo::ms_modelInfoPtrs[396];
    else
      v3 = CModelInfo::ms_modelInfoPtrs[394];
    CBaseModelInfo::RemoveRef(v3);
  }
  if ( (*((_BYTE *)this + 20) & 2) != 0 )
  {
    if ( (*((_BYTE *)this + 20) & 8) != 0 )
      v4 = CModelInfo::ms_modelInfoPtrs[397];
    else
      v4 = CModelInfo::ms_modelInfoPtrs[395];
    CBaseModelInfo::RemoveRef(v4);
  }
  if ( (*((_BYTE *)this + 20) & 4) != 0 )
  {
    CAnimManager::RemoveAnimBlockRef(CTaskComplexPlayHandSignalAnim::ms_animBlock);
    goto LABEL_25;
  }
  if ( (*((_BYTE *)this + 20) & 8) != 0 )
  {
    if ( !CModelInfo::ms_modelInfoPtrs[396]->m_numRefs || !CModelInfo::ms_modelInfoPtrs[397]->m_numRefs )
    {
      v5 = CTaskComplexPlayHandSignalAnim::ms_animBlock;
      if ( CTaskComplexPlayHandSignalAnim::ms_animBlock != -1 )
        goto LABEL_23;
    }
  }
  else if ( !CModelInfo::ms_modelInfoPtrs[394]->m_numRefs || !CModelInfo::ms_modelInfoPtrs[395]->m_numRefs )
  {
    v5 = CTaskComplexPlayHandSignalAnim::ms_animBlock;
    if ( CTaskComplexPlayHandSignalAnim::ms_animBlock != -1 )
    {
LABEL_23:
      if ( !CAnimManager::ms_aAnimBlocks[v5].m_numRefs )
        CStreaming::RemoveModel(v5 + 25575);
    }
  }
LABEL_25:
  sub_18EDB4(this);
}
// 6695C0: using guessed type void *;

//----- (004D7A74) --------------------------------------------------------
void __fastcall CTaskComplexPlayHandSignalAnim::~CTaskComplexPlayHandSignalAnim(CTaskComplexPlayHandSignalAnim *this)
{
  void *v1; // r0

  CTaskComplexPlayHandSignalAnim::~CTaskComplexPlayHandSignalAnim(this);
  sub_197118(v1);
}
// 4D7A80: variable 'v1' is possibly undefined

//----- (004D7A84) --------------------------------------------------------
CTask *__fastcall CTaskComplexPlayHandSignalAnim::CreateSubTask(
        CTaskComplexPlayHandSignalAnim *this,
        const int iSubTaskType)
{
  CTaskSimpleStandStill *v3; // r4
  CTaskComplexSequence *v4; // r8
  CTaskSimpleStandStill *v5; // r5
  unsigned __int16 v6; // r0
  CTaskSimple *v7; // r0
  CTaskSimple v8; // kr00_8
  CTaskSimple *v9; // r5
  char v10; // r6
  char m_pParent; // r0

  v3 = 0;
  if ( iSubTaskType == 425 )
  {
    v4 = (CTaskComplexSequence *)CTask::operator new(0x40u);
    CTaskComplexSequence::CTaskComplexSequence(v4);
    v5 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
    v6 = rand();
    CTaskSimpleStandStill::CTaskSimpleStandStill(v5, (int)(float)((float)((float)v6 * 0.000015259) * 1500.0), 0, 0, 8.0);
    CTaskComplexSequence::AddTask(v4, v5);
    v7 = (CTaskSimple *)CTask::operator new(0x24u);
    v8 = *(CTaskSimple *)&this->m_animId;
    v9 = v7;
    v10 = *((_BYTE *)this + 20);
    CTaskSimple::CTaskSimple(v7);
    v9[1]._vptr$CTask = 0;
    v9->_vptr$CTask = (int (**)(void))&off_66958C;
    v9[2] = v8;
    m_pParent = (char)v9[1].m_pParent;
    LOBYTE(v9[3]._vptr$CTask) = (v10 & 8) != 0;
    v9[3].m_pParent = 0;
    v9[4]._vptr$CTask = 0;
    LOBYTE(v9[1].m_pParent) = m_pParent & 0xF8;
    CTaskComplexSequence::AddTask(v4, v9);
    return v4;
  }
  else if ( iSubTaskType == 203 )
  {
    v3 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
    CTaskSimpleStandStill::CTaskSimpleStandStill(v3, 0, 1, 0, 8.0);
  }
  return v3;
}
// 66958C: using guessed type void *off_66958C;

//----- (004D7B60) --------------------------------------------------------
AnimationId __fastcall CTaskComplexPlayHandSignalAnim::GetAnimIdForPed(
        CTaskComplexPlayHandSignalAnim *this,
        CPed *pPed)
{
  int32 m_nPedType; // r1
  int v3; // r0
  AnimationId result; // r0

  m_nPedType = pPed->m_nPedType;
  v3 = m_nPedType - 7;
  if ( (unsigned int)(m_nPedType - 7) < 5 && 0x17u >> v3 << 31 )
    return (AnimationId)*(&off_4D7B8C + v3);
  result = -1;
  if ( m_nPedType == 14 )
    return 323;
  return result;
}
// 4D7B8C: using guessed type void *off_4D7B8C;

//----- (004D7BA0) --------------------------------------------------------
bool8 __fastcall CTaskComplexPlayHandSignalAnim::UseFatHands(CTaskComplexPlayHandSignalAnim *this, CPed *pPed)
{
  int m_nModelIndex; // r0

  m_nModelIndex = pPed->m_nModelIndex;
  return (unsigned int)(m_nModelIndex - 103) <= 4 && ((1 << (m_nModelIndex - 103)) & 0x15) != 0;
}

//----- (004D7BC0) --------------------------------------------------------
CTask *__fastcall CTaskComplexPlayHandSignalAnim::CreateFirstSubTask(CTaskComplexPlayHandSignalAnim *this, CPed *pPed)
{
  CTask *result; // r0
  unsigned int v5; // r0
  _BYTE *v6; // r4
  char v7; // t1
  char v8; // r0
  unsigned int v9; // r0
  char v10; // t1
  CTaskSimpleStandStill *v11; // r0

  if ( IKChainManager_c::IsArmPointing(&g_ikChainMan, 1, pPed) )
    return 0;
  if ( this->m_animId == -1 )
  {
    v9 = pPed->m_nPedType - 7;
    if ( v9 > 7 || !(0x97u >> v9 << 31) )
    {
      this->m_animId = -1;
      return 0;
    }
    this->m_animId = (AnimationId)*(&off_4D7C58 + v9);
  }
  v5 = pPed->m_nModelIndex - 103;
  if ( v5 <= 4 && ((1 << v5) & 0x15) != 0 )
  {
    v7 = *((_BYTE *)this + 20);
    v6 = (char *)this + 20;
    v8 = v7 | 8;
  }
  else
  {
    v10 = *((_BYTE *)this + 20);
    v6 = (char *)this + 20;
    v8 = v10 & 0xF7;
  }
  *v6 = v8;
  v11 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
  CTaskSimpleStandStill::CTaskSimpleStandStill(v11, 0, 1, 0, 8.0);
  return result;
}
// 4D7C58: using guessed type void *off_4D7C58;

//----- (004D7C78) --------------------------------------------------------
CTask *__fastcall CTaskComplexPlayHandSignalAnim::CreateNextSubTask(CTaskComplexPlayHandSignalAnim *this, CPed *pPed)
{
  return 0;
}

//----- (004D7C7C) --------------------------------------------------------
CTask *__fastcall CTaskComplexPlayHandSignalAnim::ControlSubTask(CTaskComplexPlayHandSignalAnim *this, CPed *pPed)
{
  int v3; // r0
  CTask *m_pSubTask; // r5
  CBaseModelInfo *v5; // r0
  int32 v6; // r0
  char v7; // r1
  int32 AnimationBlockIndex; // r0

  v3 = *((unsigned __int8 *)this + 20);
  m_pSubTask = this->m_pSubTask;
  if ( (v3 & 8) != 0 )
  {
    if ( CStreaming::ms_aInfoForModel[396].m_status == 1 )
    {
      if ( !(v3 << 31) )
      {
        CBaseModelInfo::AddRef(CModelInfo::ms_modelInfoPtrs[396]);
        *((_BYTE *)this + 20) |= 1u;
      }
    }
    else
    {
      CStreaming::RequestModel(396, 8);
    }
    if ( CStreaming::ms_aInfoForModel[397].m_status == 1 )
    {
      if ( (*((_BYTE *)this + 20) & 2) != 0 )
        goto LABEL_20;
      v5 = CModelInfo::ms_modelInfoPtrs[397];
      goto LABEL_16;
    }
    v6 = 397;
  }
  else
  {
    if ( CStreaming::ms_aInfoForModel[394].m_status == 1 )
    {
      if ( !(v3 << 31) )
      {
        CBaseModelInfo::AddRef(CModelInfo::ms_modelInfoPtrs[394]);
        *((_BYTE *)this + 20) |= 1u;
      }
    }
    else
    {
      CStreaming::RequestModel(394, 8);
    }
    if ( CStreaming::ms_aInfoForModel[395].m_status == 1 )
    {
      if ( (*((_BYTE *)this + 20) & 2) != 0 )
        goto LABEL_20;
      v5 = CModelInfo::ms_modelInfoPtrs[395];
LABEL_16:
      CBaseModelInfo::AddRef(v5);
      *((_BYTE *)this + 20) |= 2u;
      goto LABEL_20;
    }
    v6 = 395;
  }
  CStreaming::RequestModel(v6, 8);
LABEL_20:
  v7 = *((_BYTE *)this + 20);
  if ( (v7 & 3) != 3 )
    goto LABEL_26;
  AnimationBlockIndex = CTaskComplexPlayHandSignalAnim::ms_animBlock;
  if ( CTaskComplexPlayHandSignalAnim::ms_animBlock == -1 )
  {
    AnimationBlockIndex = CAnimManager::GetAnimationBlockIndex("ghands");
    CTaskComplexPlayHandSignalAnim::ms_animBlock = AnimationBlockIndex;
  }
  if ( CStreaming::ms_aInfoForModel[AnimationBlockIndex + 25575].m_status == 1 )
  {
    v7 = *((_BYTE *)this + 20);
    if ( (v7 & 4) == 0 )
    {
      CAnimManager::AddAnimBlockRef(AnimationBlockIndex);
      v7 = *((_BYTE *)this + 20) | 4;
      *((_BYTE *)this + 20) = v7;
    }
LABEL_26:
    if ( (v7 & 4) == 0 )
      return m_pSubTask;
    goto LABEL_27;
  }
  CStreaming::RequestModel(AnimationBlockIndex + 25575, 8);
  if ( (*((_BYTE *)this + 20) & 4) == 0 )
    return m_pSubTask;
LABEL_27:
  if ( (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) == 203 )
    return CTaskComplexPlayHandSignalAnim::CreateSubTask(this, 425);
  return m_pSubTask;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];

//----- (004D7E0C) --------------------------------------------------------
void __fastcall CTaskSimpleAnim::~CTaskSimpleAnim(CTaskSimpleAnim *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v3; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669488;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim->m_bitsFlag |= 4u;
    if ( (*((_BYTE *)this + 12) & 4) == 0 )
    {
      v3 = this->m_pAnim;
      if ( v3->m_fBlendAmount > 0.0 && v3->m_fBlendDelta >= 0.0 )
        v3->m_fBlendDelta = -4.0;
    }
    this->m_pAnim = 0;
  }
  sub_1A01F4(this);
}
// 669488: using guessed type void *off_669488;

//----- (004D7E78) --------------------------------------------------------
void __fastcall CTaskSimpleRunNamedAnim::~CTaskSimpleRunNamedAnim(CTaskSimpleRunNamedAnim *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v3; // r0
  void *v4; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669488;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim->m_bitsFlag |= 4u;
    if ( (*((_BYTE *)&this->CTaskSimpleAnim:104 + 12) & 4) == 0 )
    {
      v3 = this->m_pAnim;
      if ( v3->m_fBlendAmount > 0.0 && v3->m_fBlendDelta >= 0.0 )
        v3->m_fBlendDelta = -4.0;
    }
    this->m_pAnim = 0;
  }
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4D7EDC: variable 'v4' is possibly undefined
// 669488: using guessed type void *off_669488;

//----- (004D7EE8) --------------------------------------------------------
CTask *__fastcall CTaskSimpleRunNamedAnim::Clone(const CTaskSimpleRunNamedAnim *this)
{
  CTaskSimpleRunNamedAnim *v2; // r0
  CTask *result; // r0

  v2 = (CTaskSimpleRunNamedAnim *)CTask::operator new(0x64u);
  CTaskSimpleRunNamedAnim::CTaskSimpleRunNamedAnim(
    v2,
    this->m_animName,
    this->m_animGroupName,
    this->m_flags,
    this->m_fBlendDelta,
    this->m_iTime,
    (*((_BYTE *)&this->CTaskSimpleAnim:104 + 12) & 2) != 0,
    (*((_BYTE *)&this->CTaskSimpleAnim:104 + 12) & 0x10) != 0,
    (*((_BYTE *)&this->CTaskSimpleAnim:104 + 12) & 0x20) != 0,
    (*((_BYTE *)&this->CTaskSimpleAnim:104 + 12) & 4) != 0);
  return result;
}

//----- (004D7F30) --------------------------------------------------------
int __fastcall CTaskSimpleRunNamedAnim::GetTaskType(const CTaskSimpleRunNamedAnim *this)
{
  return 401;
}

//----- (004D7F38) --------------------------------------------------------
void __fastcall CTaskSimpleRunNamedAnim::Serialize(CTaskSimpleRunNamedAnim *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  _DWORD *v4; // r5
  float m_fBlendDelta; // r6
  float *v6; // r5
  _DWORD *v7; // r5
  int v8; // r0

  v2 = (*((int (__fastcall **)(CTaskSimpleRunNamedAnim *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskSimpleRunNamedAnim *))this->_vptr$CTask + 5))(this) == 401 )
  {
    if ( UseDataFence )
      AddDataFence();
    CGenericGameStorage::_SaveDataToWorkBuffer(this->m_animName, 24);
    if ( UseDataFence )
      AddDataFence();
    CGenericGameStorage::_SaveDataToWorkBuffer(this->m_animGroupName, 16);
    if ( UseDataFence )
      AddDataFence();
    v4 = malloc(4u);
    *v4 = this->m_flags;
    CGenericGameStorage::_SaveDataToWorkBuffer(v4, 4);
    free(v4);
    m_fBlendDelta = this->m_fBlendDelta;
    if ( UseDataFence )
      AddDataFence();
    v6 = (float *)malloc(4u);
    *v6 = m_fBlendDelta;
    CGenericGameStorage::_SaveDataToWorkBuffer(v6, 4);
    free(v6);
    if ( UseDataFence )
      AddDataFence();
    v7 = malloc(4u);
    *v7 = this->m_iTime;
    CGenericGameStorage::_SaveDataToWorkBuffer(v7, 4);
    j_free(v7);
  }
  else
  {
    v8 = (*((int (__fastcall **)(CTaskSimpleRunNamedAnim *))this->_vptr$CTask + 5))(this);
    sub_1941C4(401, v8);
  }
}

//----- (004D806C) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnim::~CTaskSimpleRunAnim(CTaskSimpleRunAnim *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v3; // r0
  void *v4; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669488;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim->m_bitsFlag |= 4u;
    if ( (*((_BYTE *)&this->CTaskSimpleAnim + 12) & 4) == 0 )
    {
      v3 = this->m_pAnim;
      if ( v3->m_fBlendAmount > 0.0 && v3->m_fBlendDelta >= 0.0 )
        v3->m_fBlendDelta = -4.0;
    }
    this->m_pAnim = 0;
  }
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4D80D0: variable 'v4' is possibly undefined
// 669488: using guessed type void *off_669488;

//----- (004D80DC) --------------------------------------------------------
CTask *__fastcall CTaskSimpleRunAnim::Clone(const CTaskSimpleRunAnim *this)
{
  CTaskSimple *v2; // r0
  char v3; // r8
  CTask v4; // kr00_8
  float m_fBlendDelta; // r4
  CTask *result; // r0
  char m_pParent; // r2

  v2 = (CTaskSimple *)CTask::operator new(0x20u);
  v3 = *((_BYTE *)&this->CTaskSimpleAnim + 12);
  v4 = *(CTask *)&this->m_animGroup;
  m_fBlendDelta = this->m_fBlendDelta;
  CTaskSimple::CTaskSimple(v2);
  result[1]._vptr$CTask = 0;
  result[2] = v4;
  *(float *)&result[3]._vptr$CTask = m_fBlendDelta;
  LOWORD(result[3].m_pParent) = 400;
  m_pParent = (char)result[1].m_pParent;
  result->_vptr$CTask = (int (**)(void))&off_6694BC;
  LOBYTE(result[1].m_pParent) = v3 & 4 | m_pParent & 0xF8;
  return result;
}
// 4D80FE: variable 'result' is possibly undefined
// 6694BC: using guessed type void *off_6694BC;

//----- (004D812C) --------------------------------------------------------
void __fastcall CTaskSimpleRunTimedAnim::~CTaskSimpleRunTimedAnim(CTaskSimpleRunTimedAnim *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v3; // r0
  void *v4; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669488;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim->m_bitsFlag |= 4u;
    if ( (*((_BYTE *)&this->CTaskSimpleAnim + 12) & 4) == 0 )
    {
      v3 = this->m_pAnim;
      if ( v3->m_fBlendAmount > 0.0 && v3->m_fBlendDelta >= 0.0 )
        v3->m_fBlendDelta = -4.0;
    }
    this->m_pAnim = 0;
  }
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4D8190: variable 'v4' is possibly undefined
// 669488: using guessed type void *off_669488;

//----- (004D819C) --------------------------------------------------------
CTask *__fastcall CTaskSimpleRunTimedAnim::Clone(const CTaskSimpleRunTimedAnim *this)
{
  CTaskSimple *v2; // r0
  char v3; // r5
  CTask v4; // d8
  CTask v5; // d9
  int (**m_iDuration)(void); // r4
  CTask *result; // r0
  int m_pParent_low; // r2

  v2 = (CTaskSimple *)CTask::operator new(0x34u);
  v3 = *((_BYTE *)&this->CTaskSimpleAnim + 12);
  v4 = *(CTask *)&this->m_animGroup;
  v5 = *(CTask *)&this->m_fBlendDelta;
  m_iDuration = (int (**)(void))this->m_iDuration;
  CTaskSimple::CTaskSimple(v2);
  result[2] = v4;
  result[3] = v5;
  result[1]._vptr$CTask = 0;
  result[4]._vptr$CTask = m_iDuration;
  LOWORD(result[5].m_pParent) = 0;
  LOWORD(result[6]._vptr$CTask) = 402;
  result[4].m_pParent = 0;
  result[5]._vptr$CTask = 0;
  m_pParent_low = LOBYTE(result[1].m_pParent);
  result->_vptr$CTask = (int (**)(void))&off_669524;
  LOBYTE(result[1].m_pParent) = v3 & 4 | m_pParent_low & 0xF8;
  return result;
}
// 4D81BE: variable 'result' is possibly undefined
// 669524: using guessed type void *off_669524;

//----- (004D81F8) --------------------------------------------------------
void __fastcall CTaskSimpleRunTimedAnim::Serialize(CTaskSimpleRunTimedAnim *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  int m_iTaskType; // r5
  _DWORD *v5; // r5
  _DWORD *v6; // r5
  float m_fBlendDelta; // r6
  float *v8; // r5
  float m_fBlendOutDelta; // r5
  float *v10; // r4
  int v11; // r5
  int v12; // r1

  v2 = (*((int (__fastcall **)(CTaskSimpleRunTimedAnim *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  m_iTaskType = this->m_iTaskType;
  if ( (*((int (__fastcall **)(CTaskSimpleRunTimedAnim *))this->_vptr$CTask + 5))(this) == m_iTaskType )
  {
    if ( UseDataFence )
      AddDataFence();
    v5 = malloc(4u);
    *v5 = this->m_animGroup;
    CGenericGameStorage::_SaveDataToWorkBuffer(v5, 4);
    free(v5);
    if ( UseDataFence )
      AddDataFence();
    v6 = malloc(4u);
    *v6 = this->m_animID;
    CGenericGameStorage::_SaveDataToWorkBuffer(v6, 4);
    free(v6);
    m_fBlendDelta = this->m_fBlendDelta;
    if ( UseDataFence )
      AddDataFence();
    v8 = (float *)malloc(4u);
    *v8 = m_fBlendDelta;
    CGenericGameStorage::_SaveDataToWorkBuffer(v8, 4);
    free(v8);
    m_fBlendOutDelta = this->m_fBlendOutDelta;
    if ( UseDataFence )
      AddDataFence();
    v10 = (float *)malloc(4u);
    *v10 = m_fBlendOutDelta;
    CGenericGameStorage::_SaveDataToWorkBuffer(v10, 4);
    j_free(v10);
  }
  else
  {
    v11 = this->m_iTaskType;
    v12 = (*((int (__fastcall **)(CTaskSimpleRunTimedAnim *))this->_vptr$CTask + 5))(this);
    sub_1941C4(v11, v12);
  }
}

//----- (004D831C) --------------------------------------------------------
void __fastcall CTaskSimpleRunAnimLoopedMiddle::~CTaskSimpleRunAnimLoopedMiddle(CTaskSimpleRunAnimLoopedMiddle *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v3; // r0
  void *v4; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669488;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim->m_bitsFlag |= 4u;
    if ( (*((_BYTE *)&this->CTaskSimpleAnim + 12) & 4) == 0 )
    {
      v3 = this->m_pAnim;
      if ( v3->m_fBlendAmount > 0.0 && v3->m_fBlendDelta >= 0.0 )
        v3->m_fBlendDelta = -4.0;
    }
    this->m_pAnim = 0;
  }
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4D8380: variable 'v4' is possibly undefined
// 669488: using guessed type void *off_669488;

//----- (004D838C) --------------------------------------------------------
CTask *__fastcall CTaskSimpleRunAnimLoopedMiddle::Clone(const CTaskSimpleRunAnimLoopedMiddle *this)
{
  CAnimBlendHierarchy *m_pAnimHierarchy; // r6
  CTaskSimple *v3; // r0
  CTaskSimple *v4; // r4
  int32 m_loopTime; // r10
  __int64 v6; // kr00_8
  float m_loopEndRatio; // r8
  int32 m_flags; // r6
  char m_pParent; // r1
  CAnimBlock *AnimationBlock; // r0
  int v11; // r0
  int v12; // r1
  int32 v13; // r9
  float m_fBlendDelta; // r6
  __int64 v15; // r10
  CTaskSimple v16; // kr08_8
  char v17; // r2
  char v19; // [sp+0h] [bp-20h]

  m_pAnimHierarchy = this->m_pAnimHierarchy;
  v3 = (CTaskSimple *)CTask::operator new(0x70u);
  v4 = v3;
  v19 = *((_BYTE *)&this->CTaskSimpleAnim + 12);
  if ( m_pAnimHierarchy )
  {
    m_loopTime = this->m_loopTime;
    v6 = *(_QWORD *)&this->m_fBlendDelta;
    m_loopEndRatio = this->m_loopEndRatio;
    m_flags = this->m_flags;
    CTaskSimple::CTaskSimple(v3);
    v4[3]._vptr$CTask = (int (**)(void))m_flags;
    v4[9]._vptr$CTask = (int (**)(void))v6;
    LOWORD(v4[13].m_pParent) = 424;
    v4[1]._vptr$CTask = 0;
    LOWORD(v4[13]._vptr$CTask) = 0;
    v4[9].m_pParent = (CTask *)HIDWORD(v6);
    *(float *)&v4[10]._vptr$CTask = m_loopEndRatio;
    v4[11].m_pParent = (CTask *)m_loopTime;
    v4[12]._vptr$CTask = 0;
    v4[12].m_pParent = 0;
    m_pParent = (char)v4[1].m_pParent;
    v4->_vptr$CTask = (int (**)(void))&off_669558;
    LOBYTE(v4[1].m_pParent) = v19 & 4 | m_pParent & 0xF8;
    strcpy((char *)&v4[3].m_pParent, (const char *)this->m_animName);
    strcpy((char *)&v4[6].m_pParent, (const char *)this->m_animGroupName);
    AnimationBlock = CAnimManager::GetAnimationBlock((const unsigned __int8 *)&v4[6].m_pParent);
    v4[8].m_pParent = (CTask *)CAnimManager::GetAnimation((const unsigned __int8 *)&v4[3].m_pParent, AnimationBlock);
    v11 = 191;
    v4[2]._vptr$CTask = 0;
    v12 = 20;
  }
  else
  {
    v13 = this->m_loopTime;
    m_fBlendDelta = this->m_fBlendDelta;
    v15 = *(_QWORD *)&this->m_loopStartRatio;
    v16 = *(CTaskSimple *)&this->m_animGroup;
    CTaskSimple::CTaskSimple(v3);
    v11 = 0;
    v4[2] = v16;
    v4[1]._vptr$CTask = 0;
    *(float *)&v4[9]._vptr$CTask = m_fBlendDelta;
    LOWORD(v4[13]._vptr$CTask) = 0;
    LOWORD(v4[13].m_pParent) = 424;
    *(_QWORD *)&v4[9].m_pParent = v15;
    v4[8].m_pParent = 0;
    v4[11].m_pParent = (CTask *)v13;
    v4[12]._vptr$CTask = 0;
    v4[12].m_pParent = 0;
    v17 = (char)v4[1].m_pParent;
    v4->_vptr$CTask = (int (**)(void))&off_669558;
    LOBYTE(v4[1].m_pParent) = v19 & 4 | v17 & 0xF8;
    v12 = 24;
  }
  *(int (***)(void))((char *)&v4->_vptr$CTask + v12) = (int (**)(void))v11;
  return v4;
}
// 669558: using guessed type void *off_669558;

//----- (004D84A4) --------------------------------------------------------
int __fastcall CTaskSimpleRunAnimLoopedMiddle::GetTaskType(const CTaskSimpleRunAnimLoopedMiddle *this)
{
  return this->m_iTaskType;
}

//----- (004D84AC) --------------------------------------------------------
CTask *__fastcall CTaskSimplePlayHandSignalAnim::Clone(const CTaskSimplePlayHandSignalAnim *this)
{
  CTaskSimple *v2; // r0
  char v3; // r8
  bool m_useFatHands; // r6
  CTask v5; // kr00_8
  CTask *result; // r0
  int m_pParent_low; // r2

  v2 = (CTaskSimple *)CTask::operator new(0x24u);
  v3 = *((_BYTE *)&this->CTaskSimpleAnim + 12);
  m_useFatHands = this->m_useFatHands;
  v5 = *(CTask *)&this->m_animId;
  CTaskSimple::CTaskSimple(v2);
  result[1]._vptr$CTask = 0;
  result[2] = v5;
  LOBYTE(result[3]._vptr$CTask) = m_useFatHands;
  result[3].m_pParent = 0;
  result[4]._vptr$CTask = 0;
  m_pParent_low = LOBYTE(result[1].m_pParent);
  result->_vptr$CTask = (int (**)(void))&off_66958C;
  LOBYTE(result[1].m_pParent) = v3 & 4 | m_pParent_low & 0xF8;
  return result;
}
// 4D84CE: variable 'result' is possibly undefined
// 66958C: using guessed type void *off_66958C;

//----- (004D84FC) --------------------------------------------------------
int __fastcall CTaskSimplePlayHandSignalAnim::GetTaskType(const CTaskSimplePlayHandSignalAnim *this)
{
  return 425;
}

//----- (004D8504) --------------------------------------------------------
void __fastcall CTaskSimplePlayHandSignalAnim::Serialize(CTaskSimplePlayHandSignalAnim *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  _DWORD *v4; // r5
  float *v5; // r5
  int v6; // r0
  char pData[17]; // [sp+7h] [bp-11h] BYREF

  v2 = (*((int (__fastcall **)(CTaskSimplePlayHandSignalAnim *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskSimplePlayHandSignalAnim *))this->_vptr$CTask + 5))(this) == 425 )
  {
    if ( UseDataFence )
      AddDataFence();
    v4 = malloc(4u);
    *v4 = this->m_animId;
    CGenericGameStorage::_SaveDataToWorkBuffer(v4, 4);
    free(v4);
    if ( UseDataFence )
      AddDataFence();
    v5 = (float *)malloc(4u);
    *v5 = this->m_fBlendDelta;
    CGenericGameStorage::_SaveDataToWorkBuffer(v5, 4);
    free(v5);
    if ( UseDataFence )
      AddDataFence();
    CGenericGameStorage::_SaveDataToWorkBuffer(&this->m_useFatHands, 1);
    pData[0] = (*((_BYTE *)&this->CTaskSimpleAnim + 12) & 4) != 0;
    if ( UseDataFence )
      AddDataFence();
    CGenericGameStorage::_SaveDataToWorkBuffer(pData, 1);
  }
  else
  {
    v6 = (*((int (__fastcall **)(CTaskSimplePlayHandSignalAnim *))this->_vptr$CTask + 5))(this);
    sub_1941C4(425, v6);
  }
}
// 4D8504: using guessed type char pData[17];

//----- (004D861C) --------------------------------------------------------
CTask *__fastcall CTaskComplexPlayHandSignalAnim::Clone(const CTaskComplexPlayHandSignalAnim *this)
{
  CTaskComplex *v2; // r0
  __int64 v3; // kr00_8
  CTask *result; // r0
  char m_pParent; // r2

  v2 = (CTaskComplex *)CTask::operator new(0x18u);
  v3 = *(_QWORD *)&this->m_animId;
  CTaskComplex::CTaskComplex(v2);
  *(_QWORD *)&result[1].m_pParent = v3;
  m_pParent = (char)result[2].m_pParent;
  result->_vptr$CTask = (int (**)(void))&off_6695C0;
  LOBYTE(result[2].m_pParent) = m_pParent & 0xF8;
  return result;
}
// 4D8632: variable 'result' is possibly undefined
// 6695C0: using guessed type void *off_6695C0;

//----- (004D864C) --------------------------------------------------------
int __fastcall CTaskComplexPlayHandSignalAnim::GetTaskType(const CTaskComplexPlayHandSignalAnim *this)
{
  return 426;
}

//----- (004D8654) --------------------------------------------------------
void __fastcall CTaskComplexPlayHandSignalAnim::Serialize(CTaskComplexPlayHandSignalAnim *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  _DWORD *v4; // r5
  float *v5; // r5
  int v6; // r0

  v2 = (*((int (__fastcall **)(CTaskComplexPlayHandSignalAnim *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskComplexPlayHandSignalAnim *))this->_vptr$CTask + 5))(this) == 426 )
  {
    if ( UseDataFence )
      AddDataFence();
    v4 = malloc(4u);
    *v4 = this->m_animId;
    CGenericGameStorage::_SaveDataToWorkBuffer(v4, 4);
    free(v4);
    if ( UseDataFence )
      AddDataFence();
    v5 = (float *)malloc(4u);
    *v5 = this->m_fBlendDelta;
    CGenericGameStorage::_SaveDataToWorkBuffer(v5, 4);
    j_free(v5);
  }
  else
  {
    v6 = (*((int (__fastcall **)(CTaskComplexPlayHandSignalAnim *))this->_vptr$CTask + 5))(this);
    sub_1941C4(426, v6);
  }
}

//----- (004D8720) --------------------------------------------------------
void __fastcall CTaskSimpleFight::CTaskSimpleFight(
        CTaskSimpleFight *this,
        CEntity *pTargetEntity,
        int nCommand,
        uint32 nIdlePeriod)
{
  int8 v5; // r8
  uint16 v8; // r0

  v5 = nCommand;
  CTaskSimple::CTaskSimple(this);
  *(_WORD *)&this->m_bIsFinished = 256;
  this->m_bAnimsReferenced = 0;
  this->m_nRequiredAnimGroup = ANIM_MELEE_UNARMED_1;
  *(_DWORD *)&this->m_nIdleCounter = 0;
  this->m_pAnim = 0;
  this->m_pIdleAnim = 0;
  this->m_nComboSet = -1;
  this->m_nCurrentMove = -1;
  this->m_nNextCommand = v5;
  this->m_nLastCommand = 0;
  this->_vptr$CTask = (int (**)(void))&off_6695FC;
  this->m_pTargetEntity = pTargetEntity;
  if ( pTargetEntity )
    CEntity::RegisterReference(pTargetEntity, &this->m_pTargetEntity);
  v8 = -5536;
  if ( nIdlePeriod < 0xEA60 )
    v8 = nIdlePeriod;
  this->m_nIdlePeriod = v8;
}
// 6695FC: using guessed type void *off_6695FC;

//----- (004D8794) --------------------------------------------------------
void __fastcall CTaskSimpleFight::~CTaskSimpleFight(CTaskSimpleFight *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *m_pIdleAnim; // r0
  __int32 m_bAnimsReferenced; // r0
  bool v7; // zf

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_6695FC;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  m_pIdleAnim = this->m_pIdleAnim;
  if ( m_pIdleAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pIdleAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  m_bAnimsReferenced = this->m_bAnimsReferenced;
  v7 = m_bAnimsReferenced == 0;
  if ( this->m_bAnimsReferenced )
  {
    m_bAnimsReferenced = this->m_nRequiredAnimGroup;
    v7 = m_bAnimsReferenced == 33;
  }
  if ( !v7 )
  {
    CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[m_bAnimsReferenced].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
    this->m_bAnimsReferenced = 0;
  }
  sub_1A01F4(this);
}
// 6695FC: using guessed type void *off_6695FC;

//----- (004D8820) --------------------------------------------------------
void __fastcall CTaskSimpleFight::~CTaskSimpleFight(CTaskSimpleFight *this)
{
  void *v1; // r0

  CTaskSimpleFight::~CTaskSimpleFight(this);
  sub_197118(v1);
}
// 4D882C: variable 'v1' is possibly undefined

//----- (004D8830) --------------------------------------------------------
bool __fastcall CTaskSimpleFight::MakeAbortable(
        CTaskSimpleFight *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *m_pIdleAnim; // r0
  CAnimBlendAssociation *v10; // r0
  int v11; // r3
  bool result; // r0
  CPlayerPedData *m_pPlayerData; // r0

  if ( (unsigned int)(iPriority - 1) > 1 )
  {
    this->m_nNextCommand = 1;
    return 0;
  }
  if ( pEvent
    && ((*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 3))(pEvent) < 32
     || (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 3))(pEvent) == 60) )
  {
    return 0;
  }
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
  {
    if ( iPriority == 2 )
    {
      m_pAnim->m_fBlendDelta = -1000.0;
      m_pAnim = this->m_pAnim;
    }
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim = 0;
  }
  m_pIdleAnim = this->m_pIdleAnim;
  if ( m_pIdleAnim )
  {
    CAnimBlendAssociation::SetDeleteCallback(m_pIdleAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    v10 = this->m_pIdleAnim;
    if ( v10->m_fBlendAmount > 0.0 && v10->m_fBlendDelta >= 0.0 )
    {
      if ( iPriority == 2 )
        v11 = 1148846080;
      else
        v11 = 1098907648;
      CAnimManager::BlendAnimation(
        (RpClump_0 *)pPed->m_pRwObject,
        pPed->m_motionAnimGroup,
        ANIM_STD_IDLE,
        *(float *)&v11);
    }
    this->m_pIdleAnim = 0;
  }
  if ( pPed )
  {
    if ( CPed::IsPlayer(pPed) )
    {
      m_pPlayerData = pPed->m_pPlayerData;
      m_pPlayerData->m_vecFightMovement.x = 0.0;
      m_pPlayerData->m_vecFightMovement.y = 0.0;
      CTaskSimpleFight::SetPlayerMoveAnim(this, (CPlayerPed *)pPed);
    }
  }
  result = 1;
  this->m_bIsFinished = 1;
  return result;
}

//----- (004D8918) --------------------------------------------------------
void __fastcall CTaskSimpleFight::SetPlayerMoveAnim(CTaskSimpleFight *this, CPlayerPed *pPlayerPed)
{
  CAnimBlendAssociation *Association; // r9
  CAnimBlendAssociation *v5; // r5
  CAnimBlendAssociation *v6; // r8
  CAnimBlendAssociation *v7; // r0
  bool v8; // zf
  CPlayerPedData *m_pPlayerData; // r1
  float x; // s0
  float y; // s2
  int8 m_nNextCommand; // r0
  float v13; // s4
  float v14; // s18
  float v15; // s16

  Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPlayerPed->m_pRwObject, 0x29u);
  v5 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPlayerPed->m_pRwObject, 0x2Au);
  v6 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPlayerPed->m_pRwObject, 0x2Bu);
  v7 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPlayerPed->m_pRwObject, 0x2Cu);
  v8 = this->m_nNextCommand == 0;
  if ( !this->m_nNextCommand )
    v8 = this->m_nComboSet == 0;
  if ( !v8 )
  {
    m_pPlayerData = pPlayerPed->m_pPlayerData;
    x = m_pPlayerData->m_vecFightMovement.x;
    y = m_pPlayerData->m_vecFightMovement.y;
    if ( sqrtf((float)(x * x) + (float)(y * y)) >= 0.1 )
    {
      v13 = fabsf(x) + fabsf(y);
      v14 = x / v13;
      v15 = y / v13;
      if ( (float)(x / v13) <= 0.0 )
      {
        if ( (float)(x / v13) >= 0.0 )
          goto LABEL_27;
        if ( v7 )
          v7->m_fBlendAmount = 0.0;
        if ( !v5 )
          v5 = CAnimManager::AddAnimation((RpClump_0 *)pPlayerPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_MELEE_LEFT);
        v14 = -v14;
      }
      else
      {
        if ( v5 )
          v5->m_fBlendAmount = 0.0;
        if ( !v7 )
          v7 = CAnimManager::AddAnimation((RpClump_0 *)pPlayerPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_MELEE_RIGHT);
        v5 = v7;
      }
      v5->m_fBlendAmount = v14;
LABEL_27:
      if ( v15 >= 0.0 )
      {
        if ( v15 <= 0.0 )
        {
LABEL_40:
          this->m_nComboSet = 1;
          m_nNextCommand = this->m_nNextCommand;
          this->m_nNextCommand = 0;
          goto LABEL_41;
        }
        if ( Association )
          Association->m_fBlendAmount = 0.0;
        if ( v6 )
          Association = v6;
        else
          Association = CAnimManager::AddAnimation(
                          (RpClump_0 *)pPlayerPed->m_pRwObject,
                          ANIM_STD_PED,
                          ANIM_STD_MELEE_BACK);
      }
      else
      {
        if ( v6 )
          v6->m_fBlendAmount = 0.0;
        if ( !Association )
          Association = CAnimManager::AddAnimation(
                          (RpClump_0 *)pPlayerPed->m_pRwObject,
                          ANIM_STD_PED,
                          ANIM_STD_MELEE_FWD);
        v15 = -v15;
      }
      Association->m_fBlendAmount = v15;
      goto LABEL_40;
    }
  }
  if ( Association )
    Association->m_fBlendDelta = -8.0;
  if ( v5 )
    v5->m_fBlendDelta = -8.0;
  if ( v6 )
    v6->m_fBlendDelta = -8.0;
  if ( v7 )
    v7->m_fBlendDelta = -8.0;
  m_nNextCommand = 0;
  this->m_nNextCommand = 0;
  this->m_nComboSet = 0;
LABEL_41:
  this->m_nLastCommand = m_nNextCommand;
}

//----- (004D8A94) --------------------------------------------------------
bool __fastcall CTaskSimpleFight::ProcessPed(CTaskSimpleFight *this, CPed *pPed)
{
  CAnimBlendAssociation *m_pIdleAnim; // r0
  CAnimBlendAssociation *v5; // r0
  bool result; // r0
  _BOOL4 m_bIsInControl; // r0
  unsigned int m_nLastCommand; // r1
  AssocGroupId m_nRequiredAnimGroup; // r0
  CAnimBlock *m_pAnimBlock; // r1
  const unsigned __int8 *AnimBlockName; // r0
  TouchSense *v12; // r0
  int m_nComboSet; // r0
  int v14; // r1
  bool v15; // zf
  CAnimBlendAssociation *v16; // r0
  float v17; // s0
  int v18; // r0
  bool v19; // zf
  CAnimBlendAssociation *v20; // r1
  int m_nNextCommand; // r3
  uint16 m_bitsFlag; // r2
  float m_fCurrentTime; // s0
  int v24; // r3
  tMeleeComboSet *v25; // r0
  float aBlockLoopStart; // s2
  float aBlockLoopEnd; // s2
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *v29; // r2
  int m_nCurrentMove; // r1
  int v31; // r6
  float v32; // s0
  float v33; // s2
  unsigned int v34; // r0
  int v35; // r0
  RwReal v36; // s2
  RwReal v37; // s4
  int v38; // r0
  int AvailableComboSet; // r0
  CAnimBlendAssociation *v40; // r0
  int8 v41; // r2
  CTaskSimpleFight *v42; // r0
  CPed *v43; // r1
  int v44; // r2
  CEntity *m_pTargetEntity; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v47; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float v50; // s0
  __int64 v51; // r0
  CPad *PadFromPlayer; // r0
  CVector vec; // [sp+14h] [bp-1Ch] BYREF

  if ( !this->m_bIsFinished )
  {
    m_bIsInControl = this->m_bIsInControl;
    if ( this->m_nComboSet )
    {
      if ( this->m_bIsInControl )
      {
        this->m_nIdleCounter = 0;
        goto LABEL_13;
      }
      m_bIsInControl = 0;
    }
    this->m_nIdleCounter += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    if ( !m_bIsInControl )
    {
      if ( this->m_nNextCommand < 1 )
        return 0;
      m_pAnim = this->m_pAnim;
      if ( m_pAnim )
      {
        if ( m_pAnim->m_animId == 47 )
          return 0;
      }
    }
LABEL_13:
    if ( !this->m_pIdleAnim )
    {
      m_nLastCommand = (unsigned __int8)this->m_nLastCommand;
      if ( m_nLastCommand <= 0x11 && ((1 << m_nLastCommand) & ((unsigned int)&stru_37FFC.st_value + 2)) != 0 )
      {
        this->m_bIsFinished = 1;
      }
      else if ( !this->m_pAnim && (pPed->m_eMoveState < PEDMOVE_JOG || !CPed::IsPlayer(pPed)) )
      {
        AvailableComboSet = CTaskSimpleFight::GetAvailableComboSet(this, pPed, 0);
        this->m_nComboSet = AvailableComboSet;
        v40 = CAnimManager::BlendAnimation(
                (RpClump_0 *)pPed->m_pRwObject,
                CTaskSimpleFight::m_aComboData[AvailableComboSet - 4].nAnimGroup,
                ANIM_MELEE_IDLE,
                4.0);
        this->m_pIdleAnim = v40;
        CAnimBlendAssociation::SetDeleteCallback(v40, CTaskSimpleFight::FinishMeleeAnimCB, this);
        CPed::SetMoveState(pPed, PEDMOVE_STILL);
        pPed->m_eMoveStateAnim = PEDMOVE_STILL;
        this->m_nLastCommand = 0;
        this->m_nComboSet = 0;
      }
    }
    m_nRequiredAnimGroup = this->m_nRequiredAnimGroup;
    if ( m_nRequiredAnimGroup != ANIM_MELEE_UNARMED_1 && !this->m_bAnimsReferenced )
    {
      m_pAnimBlock = CAnimManager::ms_aAnimAssocGroups[m_nRequiredAnimGroup].m_pAnimBlock;
      if ( !m_pAnimBlock )
      {
        AnimBlockName = CAnimManager::GetAnimBlockName(m_nRequiredAnimGroup);
        m_pAnimBlock = CAnimManager::GetAnimationBlock(AnimBlockName);
      }
      if ( m_pAnimBlock->m_loaded )
      {
        CAnimManager::AddAnimBlockRef(m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
        this->m_bAnimsReferenced = 1;
      }
    }
    if ( this->m_pAnim )
    {
      if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_CHAINSAW )
        CAEPedWeaponAudioEntity::AddAudioEvent(&pPed->m_PedWeaponAudioEntity, 154);
      if ( FindPlayerPed(-1) == pPed && pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_CHAINSAW )
      {
        TouchSense::instance();
        TouchSense::startContinuousBuiltinEffect(v12, 2, 116, 115, 20);
      }
      m_nComboSet = this->m_nComboSet;
      v14 = (unsigned __int8)this->m_nLastCommand;
      if ( m_nComboSet <= 3 )
      {
        if ( v14 != 3 )
        {
          v15 = v14 == 10;
          if ( v14 != 10 )
            v15 = v14 == 8;
          if ( v15 )
          {
            v16 = this->m_pAnim;
            if ( (float)(v16->m_fCurrentTime / v16->m_pAnimBlendHierarchy->m_fTotalTime) > 0.4 )
            {
              v17 = -4.0;
              goto LABEL_77;
            }
          }
LABEL_110:
          m_pTargetEntity = this->m_pTargetEntity;
          if ( m_pTargetEntity )
          {
            m_pMat = pPed->m_pMat;
            v47 = m_pTargetEntity->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &pPed->m_transform;
            p_x = &v47->tx;
            if ( !v47 )
              p_x = &m_pTargetEntity->m_transform.m_translate.x;
            v50 = *p_x - p_tx->m_translate.x;
            *((float *)&v51 + 1) = p_x[1] - p_tx->m_translate.y;
            LODWORD(v51) = LODWORD(v50) ^ 0x80000000;
          }
          else
          {
            if ( !CPed::IsPlayer(pPed) )
              goto LABEL_121;
            if ( CHID::GetInputType() != 2 )
              goto LABEL_121;
            PadFromPlayer = CPlayerPed::GetPadFromPlayer((CPlayerPed *)pPed);
            if ( !CPad::GetTarget(PadFromPlayer, 0) )
              goto LABEL_121;
            v51 = *(_QWORD *)&TheCamera.Cams[0].Front.x ^ 0x80000000LL;
          }
          pPed->m_fDesiredHeading = atan2f(*(float *)&v51, *((float *)&v51 + 1));
LABEL_121:
          result = 0;
          this->m_bIsInControl = 0;
          return result;
        }
        if ( this->m_nNextCommand != 3 )
        {
          v17 = -4.0;
          v16 = this->m_pAnim;
LABEL_77:
          if ( v16->m_fBlendDelta > v17 )
            v16->m_fBlendDelta = -4.0;
          goto LABEL_110;
        }
LABEL_88:
        this->m_nNextCommand = 0;
        goto LABEL_110;
      }
      if ( v14 == 2 )
      {
        v20 = this->m_pAnim;
        m_nNextCommand = (unsigned __int8)this->m_nNextCommand;
        m_bitsFlag = v20->m_bitsFlag;
        if ( m_nNextCommand == 2 )
        {
          if ( (m_bitsFlag & 1) == 0 )
            goto LABEL_88;
          m_fCurrentTime = v20->m_fCurrentTime;
          v24 = m_nComboSet - 4;
          v25 = &CTaskSimpleFight::m_aComboData[m_nComboSet - 4];
          aBlockLoopStart = v25->aBlockLoopStart;
          if ( m_fCurrentTime < aBlockLoopStart && (float)(m_fCurrentTime + v20->m_fTimeStep) >= aBlockLoopStart
            || (aBlockLoopEnd = CTaskSimpleFight::m_aComboData[v24].aBlockLoopEnd, m_fCurrentTime < aBlockLoopEnd)
            && (float)(m_fCurrentTime + v20->m_fTimeStep) >= aBlockLoopEnd )
          {
            v20->m_bitsFlag = m_bitsFlag & 0xFFFE;
            CAnimBlendAssociation::SetCurrentTime(this->m_pAnim, v25->aBlockLoopStart);
          }
        }
        else
        {
          if ( (m_bitsFlag & 1) == 0 && v20->m_fBlendAmount > 0.0 && v20->m_fBlendDelta >= 0.0 )
          {
            v20->m_fBlendDelta = -4.0;
            m_nNextCommand = (unsigned __int8)this->m_nNextCommand;
          }
          if ( (char)m_nNextCommand < 11 )
          {
LABEL_87:
            if ( m_nNextCommand != 2 )
              goto LABEL_110;
            goto LABEL_88;
          }
          CAnimBlendAssociation::SetDeleteCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
          this->m_pAnim = 0;
        }
        m_nNextCommand = (unsigned __int8)this->m_nNextCommand;
        goto LABEL_87;
      }
      v29 = this->m_pAnim;
      if ( v29->m_fBlendAmount <= 0.9 || v29->m_fBlendDelta < 0.0 )
        goto LABEL_110;
      m_nCurrentMove = this->m_nCurrentMove;
      v31 = m_nComboSet - 4;
      v32 = v29->m_fCurrentTime;
      v33 = CTaskSimpleFight::m_aComboData[m_nComboSet - 4].aFireTime[m_nCurrentMove];
      if ( v32 > v33 && (float)(v32 - v29->m_fTimeStep) < v33 )
      {
        CAEPedAudioEntity::AddAudioEvent(
          &pPed->m_PedAudioEntity,
          60,
          0.0,
          1.0,
          0,
          0,
          CTaskSimpleFight::m_aComboData[m_nComboSet - 4].aHitSound[m_nCurrentMove],
          0);
        if ( this->m_nComboSet == 5 )
        {
          v34 = this->m_nCurrentMove;
          if ( v34 <= 2 )
            CAEPedAudioEntity::AddAudioEvent(
              &pPed->m_PedAudioEntity,
              60,
              0.0,
              1.0,
              0,
              0,
              CTaskSimpleFight::m_aComboData[v31].aHitSound[v34],
              AE_DOUBLE_HIT_DELAYS_MS[v34]);
        }
        if ( (unsigned __int8)(this->m_nNextCommand - 11) <= 3u )
          this->m_nNextCommand = 0;
        v35 = CTaskSimpleFight::m_aComboData[v31].aHitLevel[this->m_nCurrentMove];
        if ( v35 != 7 )
        {
          operator*(&vec, pPed->m_pMat, &CTaskSimpleFight::m_aHitOffset[v35]);
          if ( this->m_nCurrentMove == 4 )
          {
            v36 = (float)(CTimer::ms_fTimeStep * pPed->m_vecMoveSpeed.y) + vec.y;
            v37 = (float)(CTimer::ms_fTimeStep * pPed->m_vecMoveSpeed.z) + vec.z;
            vec.x = (float)(CTimer::ms_fTimeStep * pPed->m_vecMoveSpeed.x) + vec.x;
            vec.y = v36;
            vec.z = v37;
          }
          CTaskSimpleFight::FightStrike(this, pPed, &vec);
        }
        goto LABEL_110;
      }
      if ( v32 < CTaskSimpleFight::m_aComboData[m_nComboSet - 4].aComboTime[m_nCurrentMove] )
        goto LABEL_110;
      v41 = this->m_nNextCommand;
      if ( (unsigned __int8)(v41 - 11) > 3u )
        goto LABEL_110;
      if ( (unsigned __int8)m_nCurrentMove >= 2u )
      {
        if ( (unsigned __int8)m_nCurrentMove == 3 )
        {
          if ( !CPed::IsPlayer(pPed) || CTaskSimpleFight::ChooseAttackPlayer(this, pPed) != 3 )
            goto LABEL_110;
          v42 = this;
          v43 = pPed;
          v44 = 3;
LABEL_109:
          CTaskSimpleFight::StartAnim(v42, v43, v44);
          goto LABEL_110;
        }
        if ( (unsigned __int8)m_nCurrentMove != 4 )
          goto LABEL_110;
        if ( m_nComboSet == 12 )
        {
          if ( CPed::IsPlayer(pPed) )
          {
            CAnimBlendAssociation::SetCurrentTime(
              this->m_pAnim,
              CTaskSimpleFight::m_aComboData[v31].aFireTime[this->m_nCurrentMove] + -0.01);
            goto LABEL_110;
          }
          v41 = this->m_nNextCommand;
        }
      }
      this->m_nComboSet = CTaskSimpleFight::GetAvailableComboSet(this, pPed, v41);
      if ( !CPed::IsPlayer(pPed) )
      {
        v44 = this->m_nCurrentMove + 1;
        goto LABEL_108;
      }
    }
    else
    {
      if ( CPed::IsPlayer(pPed)
        && this->m_nIdleCounter > (unsigned int)this->m_nIdlePeriod
        && !this->m_nNextCommand
        && !this->m_nComboSet )
      {
        this->m_nNextCommand = 1;
      }
      v18 = (unsigned __int8)this->m_nNextCommand;
      v19 = v18 == 0;
      if ( !this->m_nNextCommand )
        v19 = this->m_nComboSet == 0;
      if ( v19 || this->m_nLastCommand == 16 )
        goto LABEL_110;
      this->m_nComboSet = CTaskSimpleFight::GetAvailableComboSet(this, pPed, v18);
      if ( !CPed::IsPlayer(pPed) )
      {
        v38 = CTaskSimpleFight::ChooseAttackAI(this, pPed);
LABEL_107:
        v44 = v38;
LABEL_108:
        v42 = this;
        v43 = pPed;
        goto LABEL_109;
      }
      if ( (unsigned __int8)(this->m_nNextCommand - 3) <= 3u )
      {
        CTaskSimpleFight::SetPlayerMoveAnim(this, (CPlayerPed *)pPed);
        goto LABEL_110;
      }
    }
    v38 = CTaskSimpleFight::ChooseAttackPlayer(this, pPed);
    goto LABEL_107;
  }
  m_pIdleAnim = this->m_pIdleAnim;
  if ( m_pIdleAnim )
  {
    CAnimBlendAssociation::SetDeleteCallback(m_pIdleAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    v5 = this->m_pIdleAnim;
    if ( v5->m_fBlendAmount > 0.0 && v5->m_fBlendDelta >= 0.0 )
      CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, pPed->m_motionAnimGroup, ANIM_STD_IDLE, 8.0);
    this->m_pIdleAnim = 0;
  }
  return 1;
}
// 4D8BE6: variable 'v12' is possibly undefined
// 37FFC: using guessed type Elf32_Sym stru_37FFC;

//----- (004D9168) --------------------------------------------------------
int8 __fastcall CTaskSimpleFight::GetAvailableComboSet(CTaskSimpleFight *this, CPed *pPed, int8 nNextCommand)
{
  int v3; // r5
  int v6; // r4
  CWeaponInfo *WeaponInfo; // r0
  int m_defaultCombo; // r9
  AssocGroupId v9; // r0
  CAnimBlock *AnimationBlock; // r1
  const unsigned __int8 *v11; // r0
  tMeleeComboSet *v12; // r2
  AssocGroupId nAnimGroup; // r0
  AssocGroupId m_nRequiredAnimGroup; // r1
  AssocGroupId *p_nAnimGroup; // r4
  CAnimBlock *m_pAnimBlock; // r1
  const unsigned __int8 *AnimBlockName; // r0
  int v18; // r0

  v3 = nNextCommand;
  if ( nNextCommand > -1 )
  {
    v6 = nNextCommand | 2;
    if ( (nNextCommand | 2) != 2 && (unsigned __int8)(nNextCommand - 11) > 3u )
    {
LABEL_18:
      LOBYTE(m_defaultCombo) = 0;
      return m_defaultCombo;
    }
    WeaponInfo = CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
    if ( v3 == 12 )
    {
      LOBYTE(m_defaultCombo) = pPed->m_nExtraMeleeCombo;
LABEL_20:
      v12 = &CTaskSimpleFight::m_aComboData[(char)m_defaultCombo];
      nAnimGroup = v12[-4].nAnimGroup;
      if ( nAnimGroup == ANIM_MELEE_UNARMED_1 )
        return m_defaultCombo;
      m_nRequiredAnimGroup = this->m_nRequiredAnimGroup;
      if ( nAnimGroup == m_nRequiredAnimGroup )
      {
        if ( this->m_bAnimsReferenced )
          return m_defaultCombo;
      }
      else
      {
        if ( this->m_bAnimsReferenced )
        {
          p_nAnimGroup = &v12[-4].nAnimGroup;
          CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[m_nRequiredAnimGroup].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
          this->m_bAnimsReferenced = 0;
          nAnimGroup = *p_nAnimGroup;
        }
        this->m_nRequiredAnimGroup = nAnimGroup;
      }
      m_pAnimBlock = CAnimManager::ms_aAnimAssocGroups[nAnimGroup].m_pAnimBlock;
      if ( !m_pAnimBlock )
      {
        AnimBlockName = CAnimManager::GetAnimBlockName(nAnimGroup);
        m_pAnimBlock = CAnimManager::GetAnimationBlock(AnimBlockName);
      }
      v18 = m_pAnimBlock - CAnimManager::ms_aAnimBlocks;
      if ( m_pAnimBlock->m_loaded )
      {
        CAnimManager::AddAnimBlockRef(v18);
        this->m_bAnimsReferenced = 1;
        return m_defaultCombo;
      }
      CStreaming::RequestModel(v18 + 25575, 8);
      if ( (unsigned __int8)(this->m_nNextCommand - 11) <= 3u )
        this->m_nNextCommand = 11;
LABEL_33:
      LOBYTE(m_defaultCombo) = 4;
      return m_defaultCombo;
    }
    m_defaultCombo = (unsigned __int8)WeaponInfo->m_defaultCombo;
    if ( m_defaultCombo == 4 )
    {
      if ( v6 != 2 )
      {
        LOBYTE(m_defaultCombo) = 4;
        goto LABEL_20;
      }
      LOBYTE(m_defaultCombo) = pPed->m_nExtraMeleeCombo;
    }
    if ( !v3 && (*((_BYTE *)&CTaskSimpleFight::m_aComboData[(char)m_defaultCombo - 3] - 3) & 4) == 0 )
      goto LABEL_33;
    goto LABEL_20;
  }
  v9 = this->m_nRequiredAnimGroup;
  if ( v9 == ANIM_MELEE_UNARMED_1 || this->m_bAnimsReferenced )
    goto LABEL_18;
  AnimationBlock = CAnimManager::ms_aAnimAssocGroups[v9].m_pAnimBlock;
  if ( !AnimationBlock )
  {
    v11 = CAnimManager::GetAnimBlockName(v9);
    AnimationBlock = CAnimManager::GetAnimationBlock(v11);
  }
  if ( !AnimationBlock->m_loaded )
    goto LABEL_18;
  CAnimManager::AddAnimBlockRef(AnimationBlock - CAnimManager::ms_aAnimBlocks);
  LOBYTE(m_defaultCombo) = 0;
  this->m_bAnimsReferenced = 1;
  return m_defaultCombo;
}

//----- (004D931C) --------------------------------------------------------
void __fastcall CTaskSimpleFight::FinishMeleeAnimCB(CAnimBlendAssociation *pAnim, void *pData)
{
  char *v2; // r2
  CAnimBlendAssociation *v3; // r3
  bool v4; // zf
  unsigned int v5; // r2

  v2 = (char *)pData + 28;
  v3 = (CAnimBlendAssociation *)*((_DWORD *)pData + 7);
  v4 = v3 == pAnim;
  if ( v3 != pAnim )
  {
    v2 = (char *)pData + 32;
    v4 = *((_DWORD *)pData + 8) == (_DWORD)pAnim;
  }
  if ( v4 )
    *(_DWORD *)v2 = 0;
  if ( pAnim->m_animId == 47 )
    *((_BYTE *)pData + 8) = 1;
  if ( !*((_DWORD *)pData + 8) )
  {
    v5 = *((unsigned __int8 *)pData + 39);
    if ( v5 <= 0x11 && ((1 << v5) & ((unsigned int)&stru_37FFC.st_value + 2)) != 0 )
      *((_BYTE *)pData + 8) = 1;
  }
}
// 37FFC: using guessed type Elf32_Sym stru_37FFC;

//----- (004D9364) --------------------------------------------------------
void __fastcall CTaskSimpleFight::StartAnim(CTaskSimpleFight *this, CPed *pPed, int nNewMove)
{
  int8 v3; // r6
  CAnimBlendAssociation *m_pAnim; // r0
  int8 *p_m_nNextCommand; // r8
  int v8; // r2
  int8 v9; // r1
  int v10; // r2
  RpClump_0 *v11; // r0
  int m_nNextCommand; // r6
  CPlayerPedData *v13; // r0
  int v14; // r2
  CAnimBlendAssociation *v15; // r0
  CAnimBlendAssociation *v16; // r0
  CAnimBlendAssociation *v17; // r5
  int8 m_nComboSet; // r1
  CAnimBlendAssociation *v19; // r0
  CAnimBlendAssociation *v20; // r0
  int v21; // r1
  int AvailableComboSet; // r0
  CAnimBlendAssociation *m_pIdleAnim; // r1
  AssocGroupId m_motionAnimGroup; // r1
  AnimationId v25; // r2
  RpClump_0 *m_pRwObject; // r0
  int v27; // r3
  CAnimBlendAssociation *v28; // r0
  CAnimBlendAssociation *v29; // r0
  CPlayerPedData *m_pPlayerData; // r0

  v3 = nNewMove;
  if ( nNewMove <= -1 )
  {
    p_m_nNextCommand = &this->m_nNextCommand;
    goto LABEL_57;
  }
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim = 0;
  }
  p_m_nNextCommand = &this->m_nNextCommand;
  switch ( this->m_nNextCommand )
  {
    case 0:
      this->m_nCurrentMove = 0;
      this->m_nComboSet = 0;
      this->m_nContinueStrike = 0;
      if ( pPed->m_eMoveState >= PEDMOVE_WALK && CPed::IsPlayer(pPed) )
      {
        this->m_bIsFinished = 1;
      }
      else
      {
        AvailableComboSet = CTaskSimpleFight::GetAvailableComboSet(this, pPed, 0);
        m_pIdleAnim = this->m_pIdleAnim;
        this->m_nComboSet = AvailableComboSet;
        if ( m_pIdleAnim )
        {
          if ( m_pIdleAnim->m_fBlendAmount < 1.0 && m_pIdleAnim->m_fBlendDelta <= 0.0 )
            this->m_pIdleAnim = CAnimManager::BlendAnimation(
                                  (RpClump_0 *)pPed->m_pRwObject,
                                  CTaskSimpleFight::m_aComboData[AvailableComboSet - 4].nAnimGroup,
                                  ANIM_MELEE_IDLE,
                                  8.0);
        }
        else
        {
          v29 = CAnimManager::BlendAnimation(
                  (RpClump_0 *)pPed->m_pRwObject,
                  CTaskSimpleFight::m_aComboData[AvailableComboSet - 4].nAnimGroup,
                  ANIM_MELEE_IDLE,
                  8.0);
          this->m_pIdleAnim = v29;
          CAnimBlendAssociation::SetDeleteCallback(v29, CTaskSimpleFight::FinishMeleeAnimCB, this);
        }
        if ( CPed::IsPlayer(pPed) )
        {
          m_pPlayerData = pPed->m_pPlayerData;
          m_pPlayerData->m_vecFightMovement.x = 0.0;
          m_pPlayerData->m_vecFightMovement.y = 0.0;
          CTaskSimpleFight::SetPlayerMoveAnim(this, (CPlayerPed *)pPed);
        }
        this->m_nComboSet = 0;
      }
      goto LABEL_56;
    case 1:
    case 0xF:
    case 0x10:
    case 0x11:
    case 0x12:
      m_nNextCommand = (unsigned __int8)this->m_nNextCommand;
      v13 = pPed->m_pPlayerData;
      if ( v13 )
      {
        v13->m_vecFightMovement.x = 0.0;
        v13->m_vecFightMovement.y = 0.0;
        CTaskSimpleFight::SetPlayerMoveAnim(this, (CPlayerPed *)pPed);
        switch ( m_nNextCommand )
        {
          case 15:
            goto LABEL_50;
          case 16:
            pPed->m_pPlayerData->m_moveBlendRatio = 1.0;
            goto LABEL_42;
          case 17:
            pPed->m_pPlayerData->m_moveBlendRatio = 2.0;
            goto LABEL_40;
          case 18:
            goto LABEL_46;
          default:
            goto LABEL_49;
        }
      }
      if ( m_nNextCommand == 16 )
      {
        CPed::SetMoveState(pPed, PEDMOVE_WALK);
        pPed->m_eMoveStateAnim = pPed->m_eMoveState;
LABEL_42:
        m_motionAnimGroup = pPed->m_motionAnimGroup;
        v25 = ANIM_STD_WALK;
        goto LABEL_43;
      }
      if ( m_nNextCommand == 17 )
      {
        CPed::SetMoveState(pPed, PEDMOVE_RUN);
        pPed->m_eMoveStateAnim = pPed->m_eMoveState;
LABEL_40:
        m_motionAnimGroup = pPed->m_motionAnimGroup;
        v25 = ANIM_STD_RUN;
LABEL_43:
        m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
        v27 = 1090519040;
        goto LABEL_52;
      }
      CPed::SetMoveState(pPed, PEDMOVE_STILL);
      pPed->m_eMoveStateAnim = pPed->m_eMoveState;
      if ( m_nNextCommand != 15 )
      {
        if ( m_nNextCommand == 18 )
        {
LABEL_46:
          if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0
            && CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1) )
          {
            m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
            m_motionAnimGroup = ANIM_STD_PED;
            v25 = ANIM_STD_WEAPON_CROUCH;
            goto LABEL_51;
          }
        }
LABEL_49:
        m_motionAnimGroup = pPed->m_motionAnimGroup;
        v25 = ANIM_STD_IDLE;
        m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
        v27 = 0x40000000;
        goto LABEL_52;
      }
LABEL_50:
      m_motionAnimGroup = pPed->m_motionAnimGroup;
      v25 = ANIM_STD_IDLE;
      m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
LABEL_51:
      v27 = 1082130432;
LABEL_52:
      CAnimManager::BlendAnimation(m_pRwObject, m_motionAnimGroup, v25, *(float *)&v27);
      v28 = this->m_pIdleAnim;
      if ( v28 )
        v28->m_bitsFlag &= ~1u;
      else
        this->m_bIsFinished = 1;
      *p_m_nNextCommand = 16;
LABEL_56:
      this->m_nLastCommand = this->m_nNextCommand;
LABEL_57:
      *p_m_nNextCommand = 0;
      return;
    case 2:
      m_nComboSet = this->m_nComboSet;
      this->m_nContinueStrike = 0;
      this->m_nCurrentMove = 0;
      if ( (*((_BYTE *)&CTaskSimpleFight::m_aComboData[m_nComboSet - 3] - 3) & 2) == 0 )
      {
        m_nComboSet = 4;
        this->m_nComboSet = 4;
      }
      v19 = CAnimManager::BlendAnimation(
              (RpClump_0 *)pPed->m_pRwObject,
              CTaskSimpleFight::m_aComboData[m_nComboSet - 4].nAnimGroup,
              ANIM_MELEE_BLOCK,
              8.0);
      this->m_pAnim = v19;
      goto LABEL_34;
    case 3:
    case 4:
    case 5:
    case 6:
    case 7:
    case 8:
    case 9:
    case 0xA:
      if ( !CPed::IsPlayer(pPed) )
      {
        v8 = (unsigned __int8)this->m_nNextCommand;
        v9 = 1;
        this->m_nComboSet = 1;
        this->m_nContinueStrike = 0;
        switch ( v8 )
        {
          case 7:
            this->m_nCurrentMove = 0;
            v10 = 45;
            v11 = (RpClump_0 *)pPed->m_pRwObject;
            goto LABEL_31;
          case 8:
            goto LABEL_30;
          case 9:
            this->m_nCurrentMove = 2;
            v10 = 46;
            v11 = (RpClump_0 *)pPed->m_pRwObject;
            goto LABEL_31;
          case 10:
            v9 = 2;
            goto LABEL_30;
          default:
            v9 = v8 - 3;
LABEL_30:
            this->m_nCurrentMove = v9;
            v11 = (RpClump_0 *)pPed->m_pRwObject;
            v10 = v9 + 41;
LABEL_31:
            v20 = CAnimManager::BlendAnimation(v11, ANIM_STD_PED, (AnimationId)v10, 8.0);
            v21 = (unsigned __int8)this->m_nNextCommand;
            this->m_pAnim = v20;
            if ( v21 == 3 )
            {
              CAnimBlendAssociation::SetDeleteCallback(v20, CTaskSimpleFight::FinishMeleeAnimCB, this);
              this->m_pAnim->m_bitsFlag |= 4u;
              goto LABEL_56;
            }
            v20->m_bitsFlag &= ~2u;
            this->m_pAnim->m_bitsFlag &= ~0x20u;
            this->m_pAnim->m_bitsFlag |= 8u;
            v19 = this->m_pAnim;
            break;
        }
LABEL_34:
        CAnimBlendAssociation::SetFinishCallback(v19, CTaskSimpleFight::FinishMeleeAnimCB, this);
      }
      goto LABEL_56;
    case 0xB:
    case 0xC:
    case 0xD:
    case 0xE:
      this->m_nContinueStrike = 1;
      v14 = this->m_nComboSet;
      this->m_nCurrentMove = v3;
      v15 = CAnimManager::BlendAnimation(
              (RpClump_0 *)pPed->m_pRwObject,
              CTaskSimpleFight::m_aComboData[v14 - 4].nAnimGroup,
              (AnimationId)(v3 + 214),
              8.0);
      this->m_pAnim = v15;
      CAnimBlendAssociation::SetFinishCallback(v15, CTaskSimpleFight::FinishMeleeAnimCB, this);
      if ( this->m_nCurrentMove == 3 )
      {
        v16 = this->m_pAnim;
        if ( v16->m_fCurrentTime != 0.0 )
          CAnimBlendAssociation::SetCurrentTime(
            v16,
            *((float *)&CTaskSimpleFight::m_aComboData[this->m_nComboSet - 3] - 17));
      }
      if ( pPed->m_pPlayerData )
      {
        v17 = this->m_pAnim;
        v17->m_fSpeed = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_FIGHT_SPEED);
        if ( this->m_nCurrentMove <= 3 )
          CPed::SetMoveState(pPed, PEDMOVE_STILL);
      }
      goto LABEL_56;
    default:
      goto LABEL_56;
  }
}

//----- (004D978C) --------------------------------------------------------
int16 __fastcall CTaskSimpleFight::ChooseAttackPlayer(CTaskSimpleFight *this, CPed *pPed)
{
  int v4; // r2
  int m_nComboSet; // r1
  int v6; // r9
  CEntity *m_pTargetEntity; // r8
  __int16 v8; // r6
  unsigned int v9; // r0
  int v10; // r0
  CAnimBlendAssociation *m_pAnim; // r0
  bool v12; // zf
  unsigned __int16 v13; // r10
  int m_nNextCommand; // r0
  int m_nLastCommand; // r1
  int m_nChainCounter; // r2
  int m_nCurrentMove; // r0
  float v18; // s16
  float v19; // s18
  CEntity **m_entities; // r5
  int i; // r6
  const CPed *v22; // r0
  CEntity *v23; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v25; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float v28; // s0
  float v29; // r0
  float v30; // s2
  float v31; // s2
  CEntity *v33; // r0
  char v34; // r0

  v4 = 0;
  m_nComboSet = this->m_nComboSet;
  LOWORD(v6) = -1;
  m_pTargetEntity = this->m_pTargetEntity;
  LOBYTE(v8) = 0;
  v9 = (unsigned __int8)(this->m_nNextCommand - 11);
  if ( m_nComboSet < 4 )
    v4 = 1;
  v10 = (v9 > 3) | v4;
  if ( v10 )
    LOWORD(v6) = 1;
  if ( m_nComboSet >= 4 )
    v8 = *((_WORD *)&CTaskSimpleFight::m_aComboData[m_nComboSet - 3] - 2);
  if ( (unsigned __int8)(m_nComboSet - 5) <= 2u )
    LOBYTE(v8) = v8 & pPed->m_nExtraMeleeComboFlags;
  if ( v10 )
    goto LABEL_31;
  LOWORD(v6) = -1;
  if ( this->m_pAnim && (unsigned __int8)(this->m_nCurrentMove - 3) >= 2u )
  {
    CPed::SetMoveState(pPed, PEDMOVE_STILL);
    v13 = 2;
    if ( (v8 & 2) == 0 )
      v13 = v8 & 1;
    if ( !CTaskSimpleFight::FindTargetOnGround(this, pPed) )
    {
      m_nNextCommand = (unsigned __int8)this->m_nNextCommand;
      m_nLastCommand = (unsigned __int8)this->m_nLastCommand;
      if ( m_nNextCommand != m_nLastCommand )
      {
        m_nChainCounter = this->m_nChainCounter;
        if ( CHAIN_COUNT_LIMIT >= m_nChainCounter )
        {
          this->m_nChainCounter = m_nChainCounter + 1;
          v34 = m_nNextCommand - m_nLastCommand + this->m_nCurrentMove;
          if ( (v34 & 1) != 0 )
            LOWORD(v6) = 0;
          else
            v6 = 2 - ((unsigned __int8)(v34 & 2) >> 1);
          if ( (unsigned __int16)v6 > (unsigned int)v13 )
            LOWORD(v6) = 0;
          if ( !m_pTargetEntity )
            goto LABEL_32;
          return v6;
        }
      }
      m_nCurrentMove = this->m_nCurrentMove;
      if ( m_nCurrentMove < v13 )
        LOWORD(v6) = m_nCurrentMove + 1;
    }
LABEL_31:
    if ( m_pTargetEntity )
      return v6;
    goto LABEL_32;
  }
  if ( pPed->m_eMoveState < PEDMOVE_JOG )
  {
    if ( !CTaskSimpleFight::FindTargetOnGround(this, pPed) )
    {
      LOWORD(v6) = 0;
      this->m_nChainCounter = 0;
      if ( m_pTargetEntity )
        return v6;
      goto LABEL_32;
    }
    m_pAnim = this->m_pAnim;
    v12 = m_pAnim == 0;
    if ( m_pAnim )
      v12 = this->m_nNextCommand == this->m_nLastCommand;
    if ( v12 )
    {
      if ( (v8 & 4) == 0
        || (v33 = this->m_pTargetEntity) != 0
        && (*(_BYTE *)&v33->m_info & 7) == 3
        && (HIBYTE(v33[19].m_transform.m_heading) & 4) != 0 )
      {
        this->m_nComboSet = 4;
      }
      LOWORD(v6) = 3;
    }
  }
  else
  {
    LOWORD(v6) = 4;
    if ( (v8 & 8) == 0 )
      this->m_nComboSet = 4;
    if ( !m_pTargetEntity )
    {
LABEL_32:
      v18 = -1000.0;
      v19 = 1000.0;
      m_entities = pPed->m_pPedIntelligence->m_pedScanner.m_entities;
      for ( i = 0; i != 16; ++i )
      {
        v22 = (const CPed *)m_entities[i];
        if ( v22 && CPed::IsAlive(v22) )
        {
          v23 = m_entities[i];
          m_pMat = pPed->m_pMat;
          v25 = v23->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &pPed->m_transform;
          p_x = &v25->tx;
          if ( !v25 )
            p_x = &v23->m_transform.m_translate.x;
          v28 = p_x[1] - p_tx->m_translate.y;
          if ( (float)((float)((float)((float)(*p_x - p_tx->m_translate.x) * (float)(*p_x - p_tx->m_translate.x))
                             + (float)(v28 * v28))
                     + (float)((float)(p_x[2] - p_tx->m_translate.z) * (float)(p_x[2] - p_tx->m_translate.z))) < 4.0 )
          {
            v29 = atan2f(-(float)(*p_x - p_tx->m_translate.x), p_x[1] - p_tx->m_translate.y);
            v30 = v29 - pPed->m_fCurrentHeading;
            if ( v30 <= 3.1416 )
            {
              if ( v30 < -3.1416 )
                v30 = v30 + 6.2832;
            }
            else
            {
              v30 = v30 + -6.2832;
            }
            v31 = fabsf(v30);
            if ( v31 < v19 )
            {
              v18 = v29;
              v19 = v31;
            }
          }
        }
      }
      if ( v18 > -10.0 )
        pPed->m_fDesiredHeading = v18;
    }
  }
  return v6;
}

//----- (004D9A58) --------------------------------------------------------
int16 __fastcall CTaskSimpleFight::ChooseAttackAI(CTaskSimpleFight *this, CPed *pPed)
{
  int m_nComboSet; // r0
  unsigned __int8 v5; // r5
  float v6; // s16
  CEntity *m_pTargetEntity; // r0

  m_nComboSet = this->m_nComboSet;
  if ( m_nComboSet < 4 )
    v5 = 0;
  else
    v5 = *((_BYTE *)&CTaskSimpleFight::m_aComboData[m_nComboSet - 3] - 4);
  if ( (unsigned __int8)(m_nComboSet - 5) <= 2u )
    v5 &= pPed->m_nExtraMeleeComboFlags;
  v6 = (float)((float)rand() * 4.6566e-10) + 0.0;
  if ( v6 > 0.8 && (v5 & 2) != 0 )
  {
    if ( (v5 & 0x40) == 0 )
      return 2;
    m_pTargetEntity = this->m_pTargetEntity;
    if ( !m_pTargetEntity
      || (*(_BYTE *)&m_pTargetEntity->m_info & 7) != 3
      || !LODWORD(m_pTargetEntity[18].m_transform.m_translate.z)
      || *(int *)(*(_DWORD *)LODWORD(m_pTargetEntity[18].m_transform.m_translate.z) + 44) < 1
      || *(float *)&m_pTargetEntity[22].m_nFlags <= 20.0 )
    {
      return 2;
    }
  }
  else if ( (v5 & 4) != 0 && CTaskSimpleFight::FindTargetOnGround(this, pPed) )
  {
    return 3;
  }
  return (v6 > 0.5) & v5;
}

//----- (004D9B4C) --------------------------------------------------------
uint8 __fastcall CTaskSimpleFight::FightStrike(CTaskSimpleFight *this, CPed *pPed, CVector *vec)
{
  float v3; // s20
  float v4; // s22
  float v5; // s24
  CPed *v6; // r8
  int m_nComboSet; // r0
  int v10; // r4
  float v11; // s16
  CColSphere *m_pSphereArray; // r0
  int v13; // r5
  CMatrix *v14; // r0
  int v15; // r0
  CTaskSimpleFight *v16; // r12
  int v17; // lr
  float v18; // s0
  int v19; // r10
  CVehicle *v20; // r5
  CEntity *v21; // r8
  CEntity *v22; // r11
  CEntity *v23; // r4
  CObject *v24; // r6
  int m_nCurrentMove; // r0
  float v26; // s0
  float v27; // s26
  float v28; // s0
  bool v29; // zf
  int m_pLastRenderedLink; // r0
  CCollisionData *m_pColData; // r4
  int v32; // r2
  int v33; // r0
  CPed *v34; // r0
  int v35; // r1
  float x; // s0
  float y; // s2
  float v38; // s4
  int v39; // r3
  float *p_xx; // r0
  float v41; // s8
  float v42; // s10
  float v43; // s6
  float v44; // s12
  int v45; // r1
  int m_nNoOfSpheres; // r2
  float *p_z; // r3
  float v48; // s6
  int v49; // r6
  const CMatrix *v50; // r4
  CColModel *ColModel; // r0
  CTaskSimpleFight *v52; // r4
  int v53; // r1
  CEntity *v54; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  __int64 v57; // d16
  CEventGlobalGroup *EventGlobalGroup; // r0
  CTaskSimpleFight *v59; // r2
  int v60; // r0
  bool v61; // zf
  __int64 v62; // d16
  CAnimBlendAssociation *m_pAnim; // r0
  CAnimBlendAssociation *Association; // r0
  CPedIntelligence *m_pPedIntelligence; // [sp+44h] [bp-174h]
  CPed *v67; // [sp+48h] [bp-170h]
  int v68; // [sp+4Ch] [bp-16Ch]
  int v69; // [sp+50h] [bp-168h]
  CTaskSimpleFight *v70; // [sp+54h] [bp-164h]
  tMeleeComboSet *v71; // [sp+58h] [bp-160h]
  int v72; // [sp+5Ch] [bp-15Ch]
  CEventEditableResponse v73; // [sp+60h] [bp-158h] BYREF
  CEntity *v74[2]; // [sp+70h] [bp-148h] BYREF
  uint32 v75; // [sp+78h] [bp-140h]
  __int64 v76; // [sp+7Ch] [bp-13Ch]
  RwReal z; // [sp+84h] [bp-134h]
  CMatrix vecCentre; // [sp+88h] [bp-130h] BYREF
  Int16 pNum; // [sp+D2h] [bp-E6h] BYREF
  CEntity *v80; // [sp+D4h] [bp-E4h] BYREF
  CMatrix v81; // [sp+114h] [bp-A4h] BYREF
  CVector vecDelta; // [sp+15Ch] [bp-5Ch] BYREF

  v6 = pPed;
  CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
  v70 = this;
  m_nComboSet = this->m_nComboSet;
  v81.m_pRwMat = 0;
  v81.m_owner = 0;
  v10 = m_nComboSet - 4;
  if ( FindPlayerPed(-1) == v6 && v6->m_WeaponSlots[v6->m_nCurrentWeapon].m_eWeaponType )
    CGlass::BreakGlassPhysically(*vec, CTaskSimpleFight::m_aComboData[v10].aRadius[v70->m_nCurrentMove]);
  m_pPedIntelligence = v6->m_pPedIntelligence;
  pNum = 0;
  if ( CPed::IsPlayer(v6) )
    CWorld::FindObjectsInRange(vec, 5.0, 1, &pNum, 16, &v80, 0, 0, 0, 1, 0);
  v69 = 17 * v10;
  v11 = CTaskSimpleFight::m_aComboData[v10].aRadius[v70->m_nCurrentMove];
  if ( CTaskSimpleFight::m_sStrikeColModel.m_pColData )
  {
    m_pSphereArray = CTaskSimpleFight::m_sStrikeColData.m_pSphereArray;
  }
  else
  {
    m_pSphereArray = CTaskSimpleFight::m_sStrikeSpheres;
    CTaskSimpleFight::m_sStrikeColModel.m_pColData = &CTaskSimpleFight::m_sStrikeColData;
    CTaskSimpleFight::m_sStrikeColData.m_pSphereArray = CTaskSimpleFight::m_sStrikeSpheres;
    CTaskSimpleFight::m_sStrikeColData.m_nNoOfSpheres = 1;
  }
  v13 = 0;
  memset(&vecCentre, 0, 12);
  CColSphere::Set(m_pSphereArray, v11, (const CVector *)&vecCentre, 0, 0, 0xFFu);
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_fRadius = v11;
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_vecCentre.x = 0.0;
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_vecCentre.y = 0.0;
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_vecCentre.z = 0.0;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMin.x = -v11;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMin.y = -v11;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMin.z = -v11;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMax.x = v11;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMax.y = v11;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMax.z = v11;
  CMatrix::CMatrix(&vecCentre, v6->m_pMat);
  CMatrix::SetTranslateOnly(v14, vec->x, vec->y, vec->z);
  v67 = v6;
  if ( pNum < -31 )
  {
LABEL_67:
    if ( !CPed::IsPlayer(v6) )
    {
LABEL_77:
      v53 = v13;
      goto LABEL_78;
    }
    CEventEditableResponse::CEventEditableResponse(&v73);
    v74[0] = v6;
    v74[1] = (CEntity *)1109393408;
    v75 = -1;
    v76 = 0LL;
    z = 0.0;
    v73._vptr$CEvent = (int (**)(void))&off_66714C;
    v54 = v6;
    if ( v6 )
    {
      CEntity::RegisterReference(v6, v74);
      if ( v75 != -1 )
      {
LABEL_74:
        EventGlobalGroup = GetEventGlobalGroup();
        CEventGroup::Add(EventGlobalGroup, (CEvent *)&v73, 0);
        v73._vptr$CEvent = (int (**)(void))&off_66714C;
        if ( v74[0] )
          CEntity::CleanUpOldReference(v74[0], v74);
        CEvent::~CEvent((CEvent *)&v73);
        v6 = v67;
        goto LABEL_77;
      }
      v54 = v74[0];
    }
    v75 = CTimer::m_snTimeInMilliseconds;
    m_pMat = v54->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v54->m_transform;
    v57 = *(_QWORD *)&p_tx->m_translate.x;
    z = p_tx->m_translate.z;
    v76 = v57;
    goto LABEL_74;
  }
  v68 = 1;
  v71 = CTaskSimpleFight::m_aComboData;
  v72 = 0;
  v15 = 0;
  v17 = 17 * v10;
  v16 = v70;
  do
  {
    v19 = v15;
    if ( v15 <= 15 )
    {
      v20 = 0;
      v21 = m_pPedIntelligence->m_pedScanner.m_entities[v15];
      v22 = v21;
      goto LABEL_21;
    }
    if ( v15 <= 31 )
    {
      v22 = 0;
      v21 = (CEntity *)m_pPedIntelligence->m_eventGroup.m_events[v15 + 11];
      v20 = (CVehicle *)v21;
LABEL_21:
      v23 = 0;
      v24 = 0;
      if ( !v21 )
        goto LABEL_38;
      goto LABEL_24;
    }
    v22 = 0;
    v20 = 0;
    v21 = (CEntity *)*(&v70 + v15);
    v23 = v21;
    v24 = (CObject *)v21;
    if ( !v21 )
      goto LABEL_38;
LABEL_24:
    m_nCurrentMove = v16->m_nCurrentMove;
    v26 = CTaskSimpleFight::m_aComboData[0].aRadius[2 * v17 + m_nCurrentMove];
    v27 = v26 + CModelInfo::ms_modelInfoPtrs[v21->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
    if ( v22 )
    {
      v28 = (float)(v26 * 0.5) + v27;
      if ( CTaskSimpleFight::m_aComboData[0].aHitLevel[8 * v17 + m_nCurrentMove] > 3u )
        v27 = v28;
      if ( *(_BYTE *)&v22->m_nFlags << 31 || !CPed::IsAlive((const CPed *)v22) )
        goto LABEL_40;
      m_pLastRenderedLink = BYTE1(v22[19].m_transform.m_heading) << 31;
      v29 = m_pLastRenderedLink == 0;
      if ( m_pLastRenderedLink )
      {
        m_pLastRenderedLink = (int)v22[23].m_pLastRenderedLink;
        v29 = m_pLastRenderedLink == 0;
      }
      if ( v29 )
      {
        v17 = v69;
        v16 = v70;
      }
      else
      {
        v17 = v69;
        v16 = v70;
        if ( *(_DWORD *)(m_pLastRenderedLink + 1440) == 9 )
          goto LABEL_40;
      }
    }
    if ( (!v20 || v20->m_baseVehicleType) && (!v24 || !(*(_BYTE *)&v23->m_nFlags << 31)) )
    {
LABEL_38:
      v6 = v67;
      goto LABEL_65;
    }
    if ( !v22 )
    {
      CEntity::GetBoundCentre((CVector *)&v73, v21);
      v18 = (float)((float)((float)(*(float *)&v73._vptr$CEvent - vec->x) * (float)(*(float *)&v73._vptr$CEvent - vec->x))
                  + (float)((float)(*(float *)&v73.m_iAccumulatedTime - vec->y)
                          * (float)(*(float *)&v73.m_iAccumulatedTime - vec->y)))
          + (float)((float)(*(float *)&v73.m_bIsPersistent - vec->z) * (float)(*(float *)&v73.m_bIsPersistent - vec->z));
      goto LABEL_41;
    }
LABEL_40:
    CEntity::GetBoundCentre((CVector *)&v73, v21);
    v18 = (float)((float)(*(float *)&v73._vptr$CEvent - vec->x) * (float)(*(float *)&v73._vptr$CEvent - vec->x))
        + (float)((float)(*(float *)&v73.m_iAccumulatedTime - vec->y)
                * (float)(*(float *)&v73.m_iAccumulatedTime - vec->y));
LABEL_41:
    if ( v18 >= (float)(v27 * v27) )
      goto LABEL_63;
    if ( !v22 )
    {
      v50 = v21->m_pMat;
      if ( !v50 )
      {
        CPlaceable::AllocateMatrix(v21);
        CSimpleTransform::UpdateMatrix(&v21->m_transform, v21->m_pMat);
        v50 = v21->m_pMat;
      }
      ColModel = CEntity::GetColModel(v21);
      if ( CCollision::ProcessColModels(
             &vecCentre,
             &CTaskSimpleFight::m_sStrikeColModel,
             v50,
             ColModel,
             CWorld::m_aTempColPts,
             0,
             0,
             0) < 1 )
      {
LABEL_63:
        v6 = v67;
      }
      else
      {
        if ( v20 )
        {
          v6 = v67;
          v52 = v70;
          CTaskSimpleFight::FightHitCar(
            v70,
            v67,
            v20,
            &CWorld::m_aTempColPts[0].m_vecPosition,
            &CWorld::m_aTempColPts[0].m_vecNormal,
            CWorld::m_aTempColPts[0].m_dataB.m_nPieceType,
            CWorld::m_aTempColPts[0].m_dataB.m_nSurfaceType);
          v16 = v52;
          v17 = v69;
          goto LABEL_65;
        }
        v6 = v67;
        v16 = v70;
        if ( !v24 )
        {
          v17 = v69;
          goto LABEL_65;
        }
        CTaskSimpleFight::FightHitObj(
          v70,
          v67,
          v24,
          &CWorld::m_aTempColPts[0].m_vecPosition,
          &CWorld::m_aTempColPts[0].m_vecNormal,
          0,
          (CVector *)CWorld::m_aTempColPts[0].m_dataB.m_nSurfaceType);
      }
      v17 = v69;
      v16 = v70;
      goto LABEL_65;
    }
    m_pColData = CPedModelInfo::AnimatePedColModelSkinnedWorld(
                   (CPedModelInfo *)CModelInfo::ms_modelInfoPtrs[v22->m_nModelIndex],
                   (RpClump_0 *)v22->m_pRwObject)->m_pColData;
    v32 = 0;
    v6 = v67;
    v33 = 0;
    v17 = v69;
    v16 = v70;
LABEL_47:
    x = vec->x;
    y = vec->y;
    v38 = vec->z;
    while ( 1 )
    {
      v45 = v32;
      if ( v32 > 1 )
        break;
      m_nNoOfSpheres = m_pColData->m_nNoOfSpheres;
      if ( m_nNoOfSpheres >= 1 )
      {
        p_z = &m_pColData->m_pSphereArray->m_vecCentre.z;
        v49 = 0;
        while ( 1 )
        {
          v5 = *(p_z - 2) - x;
          v3 = *(p_z - 1) - y;
          v4 = *p_z - v38;
          v48 = v71->aRadius[2 * v17 + v16->m_nCurrentMove];
          if ( (float)((float)((float)(v5 * v5) + (float)(v3 * v3)) + (float)(v4 * v4)) < (float)((float)(p_z[1] + v48)
                                                                                                * (float)(p_z[1] + v48)) )
            break;
          ++v49;
          p_z += 5;
          if ( v49 >= m_nNoOfSpheres )
            goto LABEL_50;
        }
        vecDelta.y = *(p_z - 1) - y;
        vecDelta.x = v5;
        vecDelta.z = v4;
        v34 = CTaskSimpleFight::FightHitPed(v16, v67, (CPed *)v22, vec, &vecDelta, PED_SPHERE_CHEST);
        v17 = v69;
        v16 = v70;
        v35 = v72;
        v32 = 10;
        if ( v34 )
          v35 = (int)v34;
        v33 = 1;
        v72 = v35;
        v68 = 0;
        goto LABEL_47;
      }
LABEL_50:
      v32 = 10;
      if ( !(v33 << 24) )
      {
        v39 = v16->m_nCurrentMove;
        v33 = 0;
        v32 = 10;
        if ( CTaskSimpleFight::m_aComboData[0].aHitLevel[8 * v17 + v39] >= 4u )
        {
          p_xx = &v67->m_pMat->xx;
          v32 = v45 + 1;
          v41 = p_xx[5];
          v42 = p_xx[6];
          v43 = p_xx[4] * 1.5;
          v44 = CTaskSimpleFight::m_aComboData[0].aRadius[2 * v17 + v39];
          v33 = 0;
          y = (float)((float)(v41 * 1.5) * v44) + y;
          x = (float)(v43 * v44) + x;
          v38 = (float)((float)(v42 * 1.5) * v44) + v38;
          vec->x = x;
          vec->y = y;
          vec->z = v38;
        }
      }
    }
    vecDelta.y = v3;
    vecDelta.x = v5;
    vecDelta.z = v4;
LABEL_65:
    v15 = v19 + 1;
  }
  while ( v19 < pNum + 31 );
  v53 = v72;
  v13 = v72;
  if ( v68 << 24 )
    goto LABEL_67;
LABEL_78:
  v59 = v70;
  v60 = (unsigned __int8)v70->m_nComboSet;
  v61 = v60 == 7;
  if ( v60 == 7 )
    v61 = v70->m_nCurrentMove == 1;
  if ( v61 )
  {
    m_pAnim = v70->m_pAnim;
    if ( m_pAnim )
    {
      if ( !v53 )
        goto LABEL_86;
      Association = RpAnimBlendClumpGetAssociation(*(RpClump_0 **)(v53 + 24), 0xDCu);
      v59 = v70;
      if ( !Association )
      {
        m_pAnim = v70->m_pAnim;
LABEL_86:
        m_pAnim->m_fBlendDelta = -4.0;
        v59->m_pAnim->m_bitsFlag &= ~1u;
        v59->m_pAnim->m_bitsFlag |= 4u;
      }
    }
  }
  v62 = *(_QWORD *)&vec->x;
  v6->m_vecWeaponPrevPos.z = vec->z;
  *(_QWORD *)&v6->m_vecWeaponPrevPos.x = v62;
  CMatrix::~CMatrix(&vecCentre);
  CMatrix::~CMatrix(&v81);
  return 0;
}
// 4D9CB4: variable 'v14' is possibly undefined
// 4DA040: variable 'v3' is possibly undefined
// 4DA044: variable 'v5' is possibly undefined
// 4DA048: variable 'v4' is possibly undefined
// 66714C: using guessed type void *off_66714C;

//----- (004DA254) --------------------------------------------------------
bool __fastcall CTaskSimpleFight::ControlFight(CTaskSimpleFight *this, CEntity *pTargetEntity, int8 nCommand)
{
  int v5; // r8
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r4
  bool result; // r0

  v5 = nCommand;
  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  *((_BYTE *)p_m_pTargetEntity - 15) = 1;
  if ( m_pTargetEntity != pTargetEntity )
  {
    if ( m_pTargetEntity )
      CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
    *p_m_pTargetEntity = pTargetEntity;
    if ( pTargetEntity )
      CEntity::RegisterReference(pTargetEntity, p_m_pTargetEntity);
  }
  result = 1;
  if ( this->m_nNextCommand < v5 )
    this->m_nNextCommand = v5;
  return result;
}

//----- (004DA2A0) --------------------------------------------------------
float __fastcall CTaskSimpleFight::GetRange(const CTaskSimpleFight *this)
{
  int m_nComboSet; // r0
  bool v2; // cc
  int v3; // r0

  m_nComboSet = this->m_nComboSet;
  v2 = m_nComboSet < 4;
  v3 = m_nComboSet - 4;
  if ( v2 )
    v3 = 0;
  return CTaskSimpleFight::m_aComboData[v3].fGroupRange;
}

//----- (004DA2C0) --------------------------------------------------------
int __fastcall CTaskSimpleFight::BeHitWhileBlocking(
        CTaskSimpleFight *this,
        CPed *pPed,
        CPed *pAttacker,
        int nAttackCombo,
        int nAttackMove)
{
  CAnimBlendAssociation *m_pAnim; // r12
  uint16 m_bitsFlag; // lr
  CMatrix *m_pMat; // r4
  CMatrix *v8; // r5
  CSimpleTransform *p_tx; // r6
  CSimpleTransform *p_m_transform; // r1
  unsigned __int64 v11; // d1
  float v12; // s0
  int m_nComboSet; // r1
  int result; // r0

  if ( this->m_nLastCommand != 2 )
    return 0;
  m_pAnim = this->m_pAnim;
  if ( !m_pAnim )
    return 0;
  m_bitsFlag = m_pAnim->m_bitsFlag;
  if ( (m_bitsFlag & 1) != 0 || m_pAnim->m_fCurrentTime >= m_pAnim->m_pAnimBlendHierarchy->m_fTotalTime )
    return 0;
  m_pMat = pPed->m_pMat;
  v8 = pAttacker->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  p_m_transform = (CSimpleTransform *)&v8->tx;
  if ( !v8 )
    p_m_transform = &pAttacker->m_transform;
  v11 = vmul_f32(
          vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y),
          *(float32x2_t *)&m_pMat->yy).n64_u64[0];
  v12 = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x) * m_pMat->xy) + *(float *)&v11)
      + *((float *)&v11 + 1);
  switch ( nAttackCombo )
  {
    case 7:
      result = 0;
      if ( nAttackMove != 1 && v12 >= 0.3 )
        goto LABEL_22;
      break;
    case 8:
    case 10:
    case 11:
    case 12:
      m_nComboSet = (unsigned __int8)this->m_nComboSet;
      result = 0;
      if ( m_nComboSet != 9 && (unsigned __int8)(m_nComboSet - 8) <= 4u )
      {
        if ( nAttackCombo == 9 )
          goto LABEL_20;
        goto LABEL_13;
      }
      break;
    case 9:
      LOBYTE(m_nComboSet) = this->m_nComboSet;
LABEL_20:
      result = 0;
      if ( v12 >= 0.3 && (unsigned __int8)(m_nComboSet - 8) <= 4u )
        goto LABEL_22;
      break;
    default:
LABEL_13:
      if ( v12 < 0.3 )
        return 0;
LABEL_22:
      m_pAnim->m_bitsFlag = m_bitsFlag | 1;
      result = 1;
      break;
  }
  return result;
}

//----- (004DA3CC) --------------------------------------------------------
float __fastcall CTaskSimpleFight::GetStrikeDamage(CTaskSimpleFight *this, CPed *pPed)
{
  float v3; // s16
  float FatAndMuscleModifier; // s0
  eWeaponType m_eWeaponType; // r0

  v3 = (float)*((unsigned __int8 *)&CTaskSimpleFight::m_aComboData[this->m_nComboSet - 3] + this->m_nCurrentMove - 51);
  if ( CPed::IsPlayer(pPed) )
  {
    if ( (*((_BYTE *)pPed->m_pPlayerData + 52) & 2) == 0 )
    {
      FatAndMuscleModifier = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_FIGHT_DAMAGE);
      return FatAndMuscleModifier * v3;
    }
    return 50.0;
  }
  else
  {
    m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    if ( m_eWeaponType == WEAPONTYPE_UNARMED )
    {
      FatAndMuscleModifier = pPed->m_pPedStats->m_fAttackMult;
      return FatAndMuscleModifier * v3;
    }
    if ( m_eWeaponType == WEAPONTYPE_BRASSKNUCKLE )
      return v3 * 1.5;
  }
  return v3;
}

//----- (004DA464) --------------------------------------------------------
CPed *__fastcall CTaskSimpleFight::FightHitPed(
        CTaskSimpleFight *this,
        CPed *pPed,
        CPed *pHitPed,
        CVector *vecHitPoint,
        CVector *vecDelta,
        ePedPieceTypes nColPieceType)
{
  CPed *v6; // r4
  CTask *ActiveTask; // r0
  int v11; // r6
  CTaskSimpleFight *TaskFighting; // r0
  int8 *p_m_nCurrentMove; // r11
  int8 *p_m_nComboSet; // r10
  CAEPedAudioEntity *p_m_PedAudioEntity; // r5
  int v16; // r1
  int v17; // r8
  unsigned int v18; // r0
  int v19; // r1
  int v20; // r9
  float v21; // s16
  float FatAndMuscleModifier; // s0
  eWeaponType m_eWeaponType; // r0
  CSimpleTransform *p_m_transform; // r8
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  int v27; // r6
  CPlayerPed *PlayerPed; // r0
  unsigned int v29; // r0
  TouchSense *v30; // r0
  int v31; // r2
  CAEPedAudioEntity *v32; // r6
  unsigned int v33; // r0
  AssocGroupId *v34; // r1
  UInt32 v35; // r0
  tAudioEvent v36; // r1
  int v37; // r0
  unsigned int v38; // r0
  tAudioEvent *v39; // r9
  int v40; // r2
  int8 v41; // r1
  int v42; // r0
  tAudioEvent *aHitSound; // r9
  int v44; // r0
  CAEPedAudioEntity *v45; // r0
  int v46; // r0
  CEntity **v47; // r9
  CMatrix *v48; // r0
  CSimpleTransform *v49; // r2
  double v50; // d16
  CEventGlobalGroup *EventGlobalGroup; // r0
  int v52; // r0
  int v53; // r6
  bool v54; // zf
  __int64 v55; // d16
  CMatrix *v56; // r0
  CMatrix *v57; // r1
  float *p_x; // r2
  RwReal v59; // s0
  RwReal v60; // s4
  int32 v61; // r3
  CPhysical *nAttackMove; // [sp+0h] [bp-88h]
  UInt32 v64; // [sp+Ch] [bp-7Ch]
  CVector *v65; // [sp+14h] [bp-74h]
  int DamageEvent; // [sp+18h] [bp-70h]
  CVector dir; // [sp+1Ch] [bp-6Ch] BYREF
  CVector pos; // [sp+28h] [bp-60h] BYREF
  CEventEditableResponse v69; // [sp+38h] [bp-50h] BYREF
  CEntity *v70; // [sp+48h] [bp-40h]
  int v71; // [sp+4Ch] [bp-3Ch]
  uint32 v72; // [sp+50h] [bp-38h]
  double v73; // [sp+54h] [bp-34h]
  RwReal z; // [sp+5Ch] [bp-2Ch]

  v6 = pHitPed;
  if ( CPed::IsPlayer(pHitPed) )
  {
    ActiveTask = CTaskManager::GetActiveTask(&v6->m_pPedIntelligence->m_taskManager);
    if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 205 )
      return 0;
  }
  if ( CPedIntelligence::GetTaskFighting(v6->m_pPedIntelligence) )
  {
    TaskFighting = CPedIntelligence::GetTaskFighting(v6->m_pPedIntelligence);
    p_m_nCurrentMove = &this->m_nCurrentMove;
    p_m_nComboSet = &this->m_nComboSet;
    if ( CTaskSimpleFight::BeHitWhileBlocking(TaskFighting, v6, pPed, this->m_nComboSet, this->m_nCurrentMove) == 1 )
    {
      p_m_PedAudioEntity = &pPed->m_PedAudioEntity;
      v16 = *p_m_nComboSet;
      v11 = 0;
      v17 = v16 - 4;
      CAEPedAudioEntity::AddAudioEvent(
        p_m_PedAudioEntity,
        CTaskSimpleFight::m_aComboData[v16 - 4].aAltHitSound[*p_m_nCurrentMove],
        -9.0,
        1.0,
        v6,
        0,
        0,
        0);
      if ( *p_m_nComboSet == 5 )
      {
        v18 = *p_m_nCurrentMove;
        v11 = 0;
        if ( v18 <= 2 )
          CAEPedAudioEntity::AddAudioEvent(
            p_m_PedAudioEntity,
            CTaskSimpleFight::m_aComboData[v17].aAltHitSound[v18],
            -9.0,
            1.0,
            v6,
            0,
            0,
            AE_DOUBLE_HIT_DELAYS_MS[v18]);
      }
      return (CPed *)v11;
    }
  }
  else
  {
    p_m_nCurrentMove = &this->m_nCurrentMove;
    p_m_nComboSet = &this->m_nComboSet;
  }
  CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
  v19 = *p_m_nComboSet - 4;
  v20 = v19;
  v21 = (float)CTaskSimpleFight::m_aComboData[v19].aDamage[*p_m_nCurrentMove];
  v65 = vecHitPoint;
  if ( CPed::IsPlayer(pPed) )
  {
    if ( (*((_BYTE *)pPed->m_pPlayerData + 52) & 2) != 0 )
    {
      v21 = 50.0;
      goto LABEL_20;
    }
    FatAndMuscleModifier = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_FIGHT_DAMAGE);
    goto LABEL_19;
  }
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  if ( m_eWeaponType == WEAPONTYPE_UNARMED )
  {
    FatAndMuscleModifier = pPed->m_pPedStats->m_fAttackMult;
LABEL_19:
    v21 = FatAndMuscleModifier * v21;
    goto LABEL_20;
  }
  if ( m_eWeaponType == WEAPONTYPE_BRASSKNUCKLE )
    v21 = v21 * 1.5;
LABEL_20:
  p_m_transform = &pPed->m_transform;
  this->m_nContinueStrike = -1;
  m_pMat = pPed->m_pMat;
  p_tx = &pPed->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v27 = CPedGeometryAnalyser::ComputePedShotSide(v6, &p_tx->m_translate);
  DamageEvent = CWeapon::GenerateDamageEvent(
                  v6,
                  pPed,
                  pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType,
                  (int)v21,
                  nColPieceType,
                  v27);
  if ( FindPlayerPed(-1) == pPed )
  {
    if ( DamageEvent )
    {
      PlayerPed = FindPlayerPed(-1);
      v29 = PlayerPed->m_WeaponSlots[PlayerPed->m_nCurrentWeapon].m_eWeaponType;
      if ( v29 <= 0xF )
      {
        if ( ((1 << v29) & 0xFDFE) != 0 )
        {
          TouchSense::instance();
          v31 = 9;
LABEL_27:
          TouchSense::playBuiltinEffect(v30, 2, v31, 115, 20);
          goto LABEL_28;
        }
        if ( !v29 )
        {
          TouchSense::instance();
          v31 = 6;
          goto LABEL_27;
        }
      }
    }
  }
LABEL_28:
  if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_CHAINSAW )
    CAEPedWeaponAudioEntity::AddAudioEvent(&pPed->m_PedWeaponAudioEntity, 155);
  if ( v27 )
  {
    v32 = &pPed->m_PedAudioEntity;
    CAEPedAudioEntity::AddAudioEvent(
      &pPed->m_PedAudioEntity,
      CTaskSimpleFight::m_aComboData[v20].aAltHitSound[*p_m_nCurrentMove],
      0.0,
      1.0,
      v6,
      0,
      0,
      0);
    if ( *p_m_nComboSet != 5 )
      goto LABEL_45;
    v33 = *p_m_nCurrentMove;
    if ( v33 > 2 )
      goto LABEL_45;
    nAttackMove = v6;
    v34 = &CTaskSimpleFight::m_aComboData[v20].nAnimGroup + v33;
    v35 = AE_DOUBLE_HIT_DELAYS_MS[v33];
    v36 = *((_DWORD *)v34 + 28);
    goto LABEL_38;
  }
  v37 = (unsigned __int8)*p_m_nComboSet;
  if ( v37 == 7 )
  {
    v42 = *p_m_nCurrentMove;
    v41 = v42;
    if ( (unsigned __int8)v42 == 1 )
    {
      v32 = &pPed->m_PedAudioEntity;
      aHitSound = CTaskSimpleFight::m_aComboData[v20].aHitSound;
      CAEPedAudioEntity::AddAudioEvent(
        &pPed->m_PedAudioEntity,
        aHitSound[v42],
        0.0,
        1.0,
        v6,
        0,
        0,
        AE_DOUBLE_HIT_DELAYS_MS[v42]);
      v44 = *p_m_nCurrentMove;
      v36 = aHitSound[v44];
      nAttackMove = v6;
      v64 = (unsigned int)(float)((float)AE_DOUBLE_HIT_DELAYS_MS[v44] * 2.8);
      goto LABEL_42;
    }
LABEL_43:
    v36 = CTaskSimpleFight::m_aComboData[v20].aHitSound[v41];
    nAttackMove = v6;
    v64 = 0;
    v45 = &pPed->m_PedAudioEntity;
    goto LABEL_44;
  }
  if ( v37 != 5 || (v38 = *p_m_nCurrentMove, v38 > 2) )
  {
    v41 = *p_m_nCurrentMove;
    goto LABEL_43;
  }
  v32 = &pPed->m_PedAudioEntity;
  v39 = CTaskSimpleFight::m_aComboData[v20].aHitSound;
  CAEPedAudioEntity::AddAudioEvent(&pPed->m_PedAudioEntity, v39[v38], 0.0, 1.0, v6, 0, 0, 0);
  v40 = *p_m_nCurrentMove;
  nAttackMove = v6;
  v36 = v39[v40];
  v35 = AE_DOUBLE_HIT_DELAYS_MS[v40];
LABEL_38:
  v64 = v35;
LABEL_42:
  v45 = v32;
LABEL_44:
  CAEPedAudioEntity::AddAudioEvent(v45, v36, 0.0, 1.0, nAttackMove, 0, 0, v64);
LABEL_45:
  if ( CPed::IsPlayer(pPed) )
    CPed::Say(pPed, 0x59u, 0, 1.0, 0, 0, 0);
  CEventEditableResponse::CEventEditableResponse(&v69);
  v70 = pPed;
  v71 = 1113325568;
  v47 = (CEntity **)(v46 + 16);
  v72 = -1;
  v73 = 0.0;
  z = 0.0;
  v69._vptr$CEvent = (int (**)(void))&off_66714C;
  CEntity::RegisterReference(pPed, (CEntity **)(v46 + 16));
  if ( v72 == -1 )
  {
    v72 = CTimer::m_snTimeInMilliseconds;
    v48 = v70->m_pMat;
    v49 = (CSimpleTransform *)&v48->tx;
    if ( !v48 )
      v49 = &v70->m_transform;
    v50 = *(double *)&v49->m_translate.x;
    z = v49->m_translate.z;
    v73 = v50;
  }
  EventGlobalGroup = GetEventGlobalGroup();
  CEventGroup::Add(EventGlobalGroup, (CEvent *)&v69, 0);
  v52 = (unsigned __int8)*p_m_nComboSet;
  if ( (unsigned int)(v52 - 8) >= 5 )
  {
    v54 = v52 == 4;
    if ( v52 == 4 )
      v54 = *p_m_nCurrentMove == 4;
    if ( v54 )
      v53 = -1;
    else
      v53 = (int)(float)(100.0 - v6->m_nHealth);
  }
  else
  {
    v53 = 100;
  }
  if ( v53 > (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) )
  {
    v55 = *(_QWORD *)&v65->x;
    pos.z = v65->z;
    *(_QWORD *)&pos.x = v55;
    v56 = v6->m_pMat;
    v57 = pPed->m_pMat;
    p_x = &v56->tx;
    if ( !v56 )
      p_x = &v6->m_transform.m_translate.x;
    if ( v57 )
      p_m_transform = (CSimpleTransform *)&v57->tx;
    v59 = p_m_transform->m_translate.x - *p_x;
    v60 = p_m_transform->m_translate.z - p_x[2];
    dir.y = p_m_transform->m_translate.y - p_x[1];
    dir.x = v59;
    dir.z = v60;
    CVector::Normalise(&dir);
    if ( !CPed::IsAlive(v6) )
    {
      dir.x = 0.0;
      dir.y = 0.0;
      dir.z = 2.0;
    }
    if ( (unsigned __int8)(*p_m_nComboSet - 8) > 4u )
    {
      v61 = 8;
    }
    else
    {
      if ( CPed::IsAlive(v6) )
      {
        dir.x = dir.x * 1.5;
        dir.y = dir.y * 1.5;
        dir.z = dir.z * 1.5;
      }
      v61 = 16;
    }
    Fx_c::AddBlood(&g_fx, &pos, &dir, v61, v6->m_lightingFromCollision);
  }
  v69._vptr$CEvent = (int (**)(void))&off_66714C;
  if ( !DamageEvent )
    v6 = 0;
  if ( v70 )
    CEntity::CleanUpOldReference(v70, v47);
  CEvent::~CEvent((CEvent *)&v69);
  return v6;
}
// 4DA680: variable 'v30' is possibly undefined
// 4DA83A: variable 'v46' is possibly undefined
// 66714C: using guessed type void *off_66714C;

//----- (004DAA58) --------------------------------------------------------
void __fastcall CTaskSimpleFight::FightHitCar(
        CTaskSimpleFight *this,
        CPed *pPed,
        CVehicle *pHitCar,
        CVector *vecHitPoint,
        CVector *vecDelta,
        int16 nColPieceType,
        uint32 nColSurfaceType)
{
  float m_nHealth; // s16
  float v11; // s18
  float FatAndMuscleModifier; // s0
  eWeaponType m_eWeaponType; // r0
  eWeaponType v14; // r2
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r4
  RwMatrix *MatrixArray; // r11
  RwMatrix *v17; // r0
  __int64 v18; // d16
  CVector *v19; // r8
  uint8 m_nMaxPassengers; // r0
  int v21; // r5
  CPed *v22; // r6
  CVector *v23; // r6
  CVector vecMoveSpeed; // [sp+4h] [bp-74h] BYREF
  int v25; // [sp+1Ch] [bp-5Ch]
  CTaskSimpleFight *v26; // [sp+20h] [bp-58h]
  float *p_m_nHealth; // [sp+24h] [bp-54h]
  CEventVehicleDamage dir[2]; // [sp+28h] [bp-50h] BYREF

  v26 = this;
  p_m_nHealth = &pHitCar->m_nHealth;
  m_nHealth = pHitCar->m_nHealth;
  v11 = (float)*((unsigned __int8 *)&CTaskSimpleFight::m_aComboData[this->m_nComboSet - 3] + this->m_nCurrentMove - 51);
  if ( CPed::IsPlayer(pPed) )
  {
    if ( (*((_BYTE *)pPed->m_pPlayerData + 52) & 2) != 0 )
    {
      v11 = 50.0;
      goto LABEL_11;
    }
    FatAndMuscleModifier = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_FIGHT_DAMAGE);
    goto LABEL_10;
  }
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  if ( m_eWeaponType == WEAPONTYPE_UNARMED )
  {
    FatAndMuscleModifier = pPed->m_pPedStats->m_fAttackMult;
LABEL_10:
    v11 = FatAndMuscleModifier * v11;
    goto LABEL_11;
  }
  if ( m_eWeaponType == WEAPONTYPE_BRASSKNUCKLE )
    v11 = v11 * 1.5;
LABEL_11:
  v14 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  LOBYTE(v25) = v14;
  if ( v14 == WEAPONTYPE_CHAINSAW )
  {
    AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)pPed->m_pRwObject);
    MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
    v17 = &MatrixArray[RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 24)];
    v18 = *(_QWORD *)&v17->at.x;
    *(RwReal *)&dir[0].m_bIsPersistent = v17->at.z;
    *(_QWORD *)&dir[0]._vptr$CEvent = v18;
    memset(&vecMoveSpeed, 0, sizeof(vecMoveSpeed));
    Fx_c::AddSparks(&g_fx, vecHitPoint, (CVector *)dir, 5.0, 32, vecMoveSpeed, 1, 0.3, 1.0);
    (*((void (__fastcall **)(CVehicle *, _DWORD, _DWORD, CPed *, CVector *, CVector *, int))pHitCar->_vptr$CPlaceable
     + 57))(
      pHitCar,
      v11 * (float)(pHitCar->pHandling->fMass * 0.00075),
      (unsigned __int16)nColPieceType,
      pPed,
      vecHitPoint,
      vecDelta,
      9);
  }
  else
  {
    (*((void (__fastcall **)(CVehicle *, _DWORD, _DWORD, CPed *, CVector *, CVector *, eWeaponType))pHitCar->_vptr$CPlaceable
     + 57))(
      pHitCar,
      v11 * (float)(pHitCar->pHandling->fMass * 0.01),
      (unsigned __int16)nColPieceType,
      pPed,
      vecHitPoint,
      vecDelta,
      v14);
  }
  v19 = vecHitPoint;
  CCrime::ReportCrime(CRIME_DAMAGE_TO_PROPERTY, pHitCar, pPed);
  if ( pHitCar->pDriver )
  {
    CEventVehicleDamage::CEventVehicleDamage(dir, pHitCar, pPed, WEAPONTYPE_BASEBALLBAT);
    dir[0]._vptr$CEvent = (int (**)(void))&off_669BAC;
    CEventGroup::Add(&pHitCar->pDriver->m_pPedIntelligence->m_eventGroup, (CEvent *)dir, 0);
    CEventVehicleDamage::~CEventVehicleDamage(dir);
  }
  m_nMaxPassengers = pHitCar->m_nMaxPassengers;
  if ( m_nMaxPassengers )
  {
    v21 = 0;
    do
    {
      v22 = pHitCar->pPassengers[v21];
      if ( v22 )
      {
        CEventVehicleDamage::CEventVehicleDamage(dir, pHitCar, pPed, WEAPONTYPE_BASEBALLBAT);
        dir[0]._vptr$CEvent = (int (**)(void))&off_669BAC;
        CEventGroup::Add(&v22->m_pPedIntelligence->m_eventGroup, (CEvent *)dir, 0);
        CEventVehicleDamage::~CEventVehicleDamage(dir);
        m_nMaxPassengers = pHitCar->m_nMaxPassengers;
      }
      ++v21;
    }
    while ( v21 < m_nMaxPassengers );
  }
  if ( *p_m_nHealth >= m_nHealth )
  {
    v23 = vecDelta;
    if ( !pPed )
      goto LABEL_28;
  }
  else
  {
    v23 = vecDelta;
    pHitCar->LastDamagedWeaponType = v25;
    if ( !pPed )
      goto LABEL_28;
    pHitCar->pLastDamageEntity = pPed;
    CEntity::RegisterReference(pPed, &pHitCar->pLastDamageEntity);
  }
  if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_CHAINSAW )
    CAEPedWeaponAudioEntity::AddAudioEvent(&pPed->m_PedWeaponAudioEntity, 155);
  CAEPedAudioEntity::AddAudioEvent(
    &pPed->m_PedAudioEntity,
    *((_DWORD *)&CTaskSimpleFight::m_aComboData[v26->m_nComboSet - 3] + v26->m_nCurrentMove - 11),
    0.0,
    1.0,
    pHitCar,
    nColSurfaceType,
    0,
    0);
LABEL_28:
  Fx_c::AddPunchImpact(&g_fx, v19, v23, 4);
}
// 669BAC: using guessed type void *off_669BAC;

//----- (004DAD28) --------------------------------------------------------
void __fastcall CTaskSimpleFight::FightHitObj(
        CTaskSimpleFight *this,
        CPed *pPed,
        CObject *pHitObj,
        CVector *vecHitPoint,
        CVector *vecDelta,
        int16 nColPieceType,
        CVector *vecDeltaa)
{
  __int64 v11; // d16
  float v12; // s16
  float FatAndMuscleModifier; // s0
  eWeaponType m_eWeaponType; // r0
  CObjectInfo *m_pObjectInfo; // r1
  int m_nFlags; // r0
  float v17; // s0
  CMatrix *m_pMat; // r12
  CSimpleTransform *p_tx; // r0
  CVector pTargetPhysical; // [sp+0h] [bp-40h]
  CVector colNormal; // [sp+10h] [bp-30h] BYREF
  CVector v22; // 0:r1.12

  v11 = *(_QWORD *)&vecDelta->x;
  colNormal.z = vecDelta->z;
  *(_QWORD *)&colNormal.x = v11;
  v12 = (float)*((unsigned __int8 *)&CTaskSimpleFight::m_aComboData[this->m_nComboSet - 3] + this->m_nCurrentMove - 51);
  if ( CPed::IsPlayer(pPed) )
  {
    if ( (*((_BYTE *)pPed->m_pPlayerData + 52) & 2) == 0 )
    {
      FatAndMuscleModifier = CStats::GetFatAndMuscleModifier(STAT_MODIFIER_FIGHT_DAMAGE);
LABEL_10:
      v12 = FatAndMuscleModifier * v12;
      goto LABEL_11;
    }
    v12 = 50.0;
  }
  else
  {
    m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    if ( m_eWeaponType == WEAPONTYPE_UNARMED )
    {
      FatAndMuscleModifier = pPed->m_pPedStats->m_fAttackMult;
      goto LABEL_10;
    }
    if ( m_eWeaponType == WEAPONTYPE_BRASSKNUCKLE )
      v12 = v12 * 1.5;
  }
LABEL_11:
  if ( pHitObj->m_nCollisionDamageEffect < 0xC8u && (*(_BYTE *)&pHitObj->m_nPhysicalFlags & 4) == 0 )
  {
    m_pObjectInfo = pHitObj->m_pObjectInfo;
    if ( m_pObjectInfo->m_fCollisionDamageMultiplier < 99.9 )
    {
      m_nFlags = (int)pHitObj->m_nFlags;
      if ( (m_nFlags & 0x40004) != 0 && m_pObjectInfo->m_fUprootLimit <= 0.0 )
      {
        (*((void (__fastcall **)(CObject *, _DWORD))pHitObj->_vptr$CPlaceable + 5))(pHitObj, 0);
        CPhysical::AddToMovingList(pHitObj);
        m_nFlags = (int)pHitObj->m_nFlags;
      }
      if ( (m_nFlags & 0x40004) == 0 )
      {
        v17 = -0.1;
        m_pMat = pHitObj->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( (*(_DWORD *)&pHitObj->m_nPhysicalFlags & 0x80) == 0 )
          v17 = -0.5;
        if ( !m_pMat )
          p_tx = &pHitObj->m_transform;
        pTargetPhysical.x = vecHitPoint->x - p_tx->m_translate.x;
        *(_QWORD *)&pTargetPhysical.y = __PAIR64__(
                                          vecHitPoint->z - p_tx->m_translate.z,
                                          vecHitPoint->y - p_tx->m_translate.y);
        v22.x = colNormal.x * v17;
        v22.y = colNormal.y * v17;
        v22.z = colNormal.z * v17;
        CPhysical::ApplyForce(pHitObj, v22, pTargetPhysical, 1);
      }
    }
  }
  CObject::ObjectDamage(
    pHitObj,
    v12 * 10.0,
    vecHitPoint,
    &colNormal,
    (int)pPed,
    pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType);
  if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_CHAINSAW )
    CAEPedWeaponAudioEntity::AddAudioEvent(&pPed->m_PedWeaponAudioEntity, 155);
  CAEPedAudioEntity::AddAudioEvent(
    &pPed->m_PedAudioEntity,
    *((_DWORD *)&CTaskSimpleFight::m_aComboData[this->m_nComboSet - 3] + this->m_nCurrentMove - 11),
    0.0,
    1.0,
    pHitObj,
    (uint32)vecDeltaa,
    0,
    0);
  Fx_c::AddPunchImpact(&g_fx, vecHitPoint, &colNormal, 4);
}

//----- (004DAF60) --------------------------------------------------------
void __fastcall CTaskSimpleFight::FightSetUpCol(CTaskSimpleFight *this, float fRadius)
{
  CColSphere *m_pSphereArray; // r0
  CVector vecCentre; // [sp+Ch] [bp-1Ch] BYREF

  if ( CTaskSimpleFight::m_sStrikeColModel.m_pColData )
  {
    m_pSphereArray = CTaskSimpleFight::m_sStrikeColData.m_pSphereArray;
  }
  else
  {
    m_pSphereArray = CTaskSimpleFight::m_sStrikeSpheres;
    CTaskSimpleFight::m_sStrikeColModel.m_pColData = &CTaskSimpleFight::m_sStrikeColData;
    CTaskSimpleFight::m_sStrikeColData.m_pSphereArray = CTaskSimpleFight::m_sStrikeSpheres;
    CTaskSimpleFight::m_sStrikeColData.m_nNoOfSpheres = 1;
  }
  memset(&vecCentre, 0, sizeof(vecCentre));
  CColSphere::Set(m_pSphereArray, fRadius, &vecCentre, 0, 0, 0xFFu);
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_fRadius = fRadius;
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_vecCentre.x = 0.0;
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_vecCentre.y = 0.0;
  CTaskSimpleFight::m_sStrikeColModel.m_sphereBound.m_vecCentre.z = 0.0;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMin.x = -fRadius;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMin.y = -fRadius;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMin.z = -fRadius;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMax.x = fRadius;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMax.y = fRadius;
  CTaskSimpleFight::m_sStrikeColModel.m_boxBound.m_vecMax.z = fRadius;
}

//----- (004DB008) --------------------------------------------------------
bool __fastcall CTaskSimpleFight::FindTargetOnGround(CTaskSimpleFight *this, CPed *pPed)
{
  int v4; // r1
  bool result; // r0
  CEntity *m_pTargetEntity; // r0
  float v7; // s0
  float v8; // s16
  float v9; // s18
  CMatrix *v10; // r0
  CSimpleTransform *v11; // r1
  CTask *SimplestActiveTask; // r0
  CTask *v13; // r6
  CTask *m_pParent; // r0
  CEntity *v15; // r6
  CSimpleTransform *v16; // r4
  CMatrix *v17; // r1
  CSimpleTransform *v18; // r2
  CMatrix *v19; // r0
  CSimpleTransform *v20; // r1
  float v21; // s20
  float32x2_t v22; // d11
  unsigned __int64 v23; // d1
  CEntity *v24; // r6
  CMatrix *v25; // r1
  CMatrix *v26; // r0
  CSimpleTransform *v27; // r1
  float v28; // s20
  float32x2_t v29; // d11
  unsigned __int64 v30; // d1
  float v31; // s19
  float v32; // s20
  CEntity **m_entities; // r4
  int v34; // r5
  CEntity *v35; // r8
  CEntity *v36; // r6
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_m_transform; // r0
  float *p_xx; // r0
  CSimpleTransform *p_tx; // r2
  float *p_x; // r1
  float v42; // s2
  float v43; // s0
  float v44; // s4
  float v45; // s0
  float v46; // s2
  float v47; // s2
  CPhysical *m_pGroundPhysical; // r0
  int v49; // r1
  bool v50; // zf
  RwV3d_0 posn; // [sp+4h] [bp-6Ch] BYREF

  v4 = CLocalisation::KickingWhenDown();
  result = 0;
  if ( v4 )
  {
    memset(&posn, 0, sizeof(posn));
    m_pTargetEntity = this->m_pTargetEntity;
    v7 = CTaskSimpleFight::m_aHitOffset[2].y + *((float *)&CTaskSimpleFight::m_aComboData[this->m_nComboSet - 3] - 19);
    v8 = v7 + 0.4;
    v9 = v7 + 0.2;
    if ( !m_pTargetEntity )
    {
LABEL_31:
      if ( !CPed::IsPlayer(pPed) )
        return 0;
      v31 = 3.1416;
      v32 = 0.0;
      m_entities = pPed->m_pPedIntelligence->m_pedScanner.m_entities;
      v34 = 0;
      v35 = 0;
      while ( 1 )
      {
        v36 = m_entities[v34];
        if ( v36 )
        {
          CPed::GetBonePosition((CPed *)m_entities[v34], &posn, 3u, 0);
          if ( v36[18].m_pMat == (CMatrix *)((char *)&dword_34 + 3) )
          {
            m_pMat = pPed->m_pMat;
          }
          else
          {
            m_pMat = pPed->m_pMat;
            p_m_transform = &pPed->m_transform;
            if ( m_pMat )
              p_m_transform = (CSimpleTransform *)&m_pMat->tx;
            if ( posn.z >= (float)(p_m_transform->m_translate.z + -0.2) )
              goto LABEL_57;
          }
          p_xx = &v36->m_pMat->xx;
          p_tx = &pPed->m_transform;
          if ( m_pMat )
            p_tx = (CSimpleTransform *)&m_pMat->tx;
          p_x = p_xx + 12;
          if ( !p_xx )
            p_x = &v36->m_transform.m_translate.x;
          v42 = *p_x - p_tx->m_translate.x;
          v43 = p_x[1] - p_tx->m_translate.y;
          v44 = p_x[2] - p_tx->m_translate.z;
          if ( fabsf((float)((float)(v42 * p_xx[4]) + (float)(v43 * p_xx[5])) + (float)(v44 * p_xx[6])) < v8
            && fabsf((float)((float)(v42 * *p_xx) + (float)(v43 * p_xx[1])) + (float)(v44 * p_xx[2])) < v9 )
          {
            v45 = atan2f(-(float)(*p_x - p_tx->m_translate.x), p_x[1] - p_tx->m_translate.y);
            v46 = v45 - pPed->m_fCurrentHeading;
            if ( v46 >= -3.1416 )
            {
              if ( v46 > 3.1416 )
                v46 = v46 + -6.2832;
            }
            else
            {
              v46 = v46 + 6.2832;
            }
            v47 = fabsf(v46);
            if ( v47 < 1.0472 )
            {
              if ( v35 )
              {
                if ( *(float *)&v35[22].m_nFlags <= 0.0 )
                {
                  if ( v47 >= v31 && *(float *)&v36[22].m_nFlags <= 0.0 )
                    goto LABEL_57;
                }
                else if ( v47 >= v31 )
                {
                  goto LABEL_57;
                }
              }
              v32 = v45;
              v35 = v36;
              v31 = v47;
            }
          }
        }
LABEL_57:
        if ( ++v34 == 16 )
        {
          if ( v35 )
          {
            pPed->m_fDesiredHeading = v32;
            return 1;
          }
          m_pGroundPhysical = pPed->m_pGroundPhysical;
          if ( !m_pGroundPhysical )
            return 0;
          v49 = *(_BYTE *)&m_pGroundPhysical->m_info & 7;
          v50 = v49 == 2;
          if ( v49 == 2 )
            return LODWORD(m_pGroundPhysical[4].m_vecCOM.z) == 0;
          return v50;
        }
      }
    }
    if ( (*(_BYTE *)&m_pTargetEntity->m_info & 7) == 3 )
    {
      CPed::GetBonePosition((CPed *)m_pTargetEntity, &posn, 3u, 0);
      if ( !CPed::IsAlive((const CPed *)this->m_pTargetEntity) )
        goto LABEL_10;
      v10 = pPed->m_pMat;
      v11 = (CSimpleTransform *)&v10->tx;
      if ( !v10 )
        v11 = &pPed->m_transform;
      if ( posn.z < (float)(v11->m_translate.z + -0.2) )
      {
LABEL_10:
        SimplestActiveTask = CTaskManager::GetSimplestActiveTask((const CTaskManager *)(LODWORD(this->m_pTargetEntity[18].m_transform.m_translate.y)
                                                                                      + 4));
        v13 = SimplestActiveTask;
        if ( SimplestActiveTask )
        {
          if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) == 207 )
          {
            m_pParent = v13[2].m_pParent;
            if ( m_pParent )
            {
              if ( *(float *)&m_pParent[4]._vptr$CTask < *(float *)&m_pParent[2].m_pParent[2]._vptr$CTask )
                return 0;
            }
          }
        }
        v15 = this->m_pTargetEntity;
        v16 = &pPed->m_transform;
        v17 = pPed->m_pMat;
        v18 = &pPed->m_transform;
        v19 = v15->m_pMat;
        if ( v17 )
          v18 = (CSimpleTransform *)&v17->tx;
        v20 = &v15->m_transform;
        if ( v19 )
          v20 = (CSimpleTransform *)&v19->tx;
        v21 = v20->m_translate.x - v18->m_translate.x;
        v22.n64_u64[0] = vsub_f32(*(float32x2_t *)&v20->m_translate.y, *(float32x2_t *)&v18->m_translate.y).n64_u64[0];
        if ( !v19 )
        {
          CPlaceable::AllocateMatrix(this->m_pTargetEntity);
          CSimpleTransform::UpdateMatrix(&v15->m_transform, v15->m_pMat);
          v19 = v15->m_pMat;
        }
        v23 = vmul_f32(v22, *(float32x2_t *)&v19->yy).n64_u64[0];
        if ( fabsf((float)((float)(v21 * v19->xy) + *(float *)&v23) + *((float *)&v23 + 1)) < v8 )
        {
          v24 = this->m_pTargetEntity;
          v25 = pPed->m_pMat;
          v26 = v24->m_pMat;
          if ( v25 )
            v16 = (CSimpleTransform *)&v25->tx;
          v27 = &v24->m_transform;
          if ( v26 )
            v27 = (CSimpleTransform *)&v26->tx;
          v28 = v27->m_translate.x - v16->m_translate.x;
          v29.n64_u64[0] = vsub_f32(*(float32x2_t *)&v27->m_translate.y, *(float32x2_t *)&v16->m_translate.y).n64_u64[0];
          if ( !v26 )
          {
            CPlaceable::AllocateMatrix(this->m_pTargetEntity);
            CSimpleTransform::UpdateMatrix(&v24->m_transform, v24->m_pMat);
            v26 = v24->m_pMat;
          }
          v30 = vmul_f32(v29, *(float32x2_t *)&v26->yx).n64_u64[0];
          if ( fabsf((float)((float)(v28 * v26->xx) + *(float *)&v30) + *((float *)&v30 + 1)) < v9 )
            return 1;
        }
        goto LABEL_30;
      }
      if ( (HIBYTE(this->m_pTargetEntity[19].m_transform.m_heading) & 4) != 0 )
      {
        v8 = v8 + -0.4;
        goto LABEL_10;
      }
    }
    else if ( m_pTargetEntity == pPed->m_pGroundPhysical )
    {
      return 1;
    }
LABEL_30:
    if ( this->m_pTargetEntity )
      return 0;
    goto LABEL_31;
  }
  return result;
}
// 34: using guessed type int dword_34;

//----- (004DB430) --------------------------------------------------------
eMeleeCombo __fastcall CTaskSimpleFight::GetComboType(unsigned __int8 *pComboName)
{
  int v2; // r1
  eMeleeCombo result; // r0

  if ( !strcmp((const char *)pComboName, "UNARMED") )
    return 4;
  if ( !strcmp((const char *)pComboName, "BBALLBAT") )
    return 8;
  if ( !strcmp((const char *)pComboName, "KNIFE") )
    return 9;
  if ( !strcmp((const char *)pComboName, "GOLFCLUB") )
    return 10;
  if ( !strcmp((const char *)pComboName, "SWORD") )
    return 11;
  if ( !strcmp((const char *)pComboName, "CHAINSAW") )
    return 12;
  if ( !strcmp((const char *)pComboName, "DILDO") )
    return 13;
  v2 = strcmp((const char *)pComboName, "FLOWERS");
  result = MCOMBO_UNARMED_1;
  if ( !v2 )
    return 14;
  return result;
}

//----- (004DB4F8) --------------------------------------------------------
void __fastcall CTaskSimpleFightingControl::CTaskSimpleFightingControl(
        CTaskSimpleFightingControl *this,
        CEntity *pTargetEntity,
        float fAngle,
        float fRange)
{
  CTaskSimple::CTaskSimple(this);
  this->m_bIsFinished = 0;
  this->m_nComboSet = 0;
  this->_vptr$CTask = (int (**)(void))&off_669630;
  this->m_pTargetEntity = pTargetEntity;
  if ( pTargetEntity )
    CEntity::RegisterReference(pTargetEntity, &this->m_pTargetEntity);
  this->m_fAttackAngle = fAngle;
  this->m_fAttackRange = fRange;
  this->m_fAttackFreq = 1.0;
  this->m_nNextAttackTime = 0;
  this->m_nBlockCounter = 0;
}
// 669630: using guessed type void *;

//----- (004DB564) --------------------------------------------------------
void __fastcall CTaskSimpleFightingControl::~CTaskSimpleFightingControl(CTaskSimpleFightingControl *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669630;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  sub_1A01F4(this);
}
// 669630: using guessed type void *off_669630;

//----- (004DB590) --------------------------------------------------------
void __fastcall CTaskSimpleFightingControl::~CTaskSimpleFightingControl(CTaskSimpleFightingControl *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1
  void *v4; // r0

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669630;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4DB5B8: variable 'v4' is possibly undefined
// 669630: using guessed type void *off_669630;

//----- (004DB5C0) --------------------------------------------------------
bool __fastcall CTaskSimpleFightingControl::MakeAbortable(
        CTaskSimpleFightingControl *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CEntity *m_pTargetEntity; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v11; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float y; // s2
  float z; // s4
  CTask *TaskSecondary; // r0
  CVector v17; // [sp+4h] [bp-1Ch] BYREF

  if ( !iPriority )
    return 0;
  if ( iPriority == 2 )
    return 1;
  if ( iPriority == 1 && pEvent )
  {
    if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 3))(pEvent) < 22
      || (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 2
      || (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 3
      || (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 4 )
    {
      return 0;
    }
    if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 1
      || (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 5
      || (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 6 )
    {
      m_pTargetEntity = this->m_pTargetEntity;
      if ( !m_pTargetEntity )
        return 1;
      m_pMat = pPed->m_pMat;
      v11 = m_pTargetEntity->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
      p_x = &v11->tx;
      y = p_tx->m_translate.y;
      z = p_tx->m_translate.z;
      if ( !v11 )
        p_x = &m_pTargetEntity->m_transform.m_translate.x;
      v17.x = *p_x - p_tx->m_translate.x;
      v17.y = p_x[1] - y;
      v17.z = p_x[2] - z;
      CVector::Normalise(&v17);
      if ( (float)((float)((float)(*(float *)&pEvent[2]._vptr$CEvent * v17.x)
                         + (float)(*(float *)&pEvent[2].m_iAccumulatedTime * v17.y))
                 + (float)(*(float *)&pEvent[2].m_bIsPersistent * v17.z)) > -0.707 )
        return 0;
    }
  }
  if ( !CPedIntelligence::GetTaskFighting(pPed->m_pPedIntelligence) )
    return 1;
  TaskSecondary = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
  return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))TaskSecondary->_vptr$CTask + 7))(
           TaskSecondary,
           pPed,
           iPriority,
           pEvent);
}

//----- (004DB708) --------------------------------------------------------
bool __fastcall CTaskSimpleFightingControl::ProcessPed(CTaskSimpleFightingControl *this, CPed *pPed)
{
  bool v4; // r5
  float m_nShootRate; // s16
  CTask *TaskSecondary; // r0
  CPedIntelligence *m_pPedIntelligence; // r9
  CTask *v9; // r0
  uint32 *p_m_nNextAttackTime; // r8
  uint32 m_nBlockCounter; // r0
  int v12; // r9
  int v13; // r6
  uint32 v14; // r0
  char *v15; // r6
  CEntity *m_pTargetEntity; // r8
  float v17; // s18
  unsigned int v18; // r0
  CTaskManager *p_m_taskManager; // r0
  char v20; // r9
  CTask *v21; // r0
  unsigned int v22; // r1
  bool v23; // cc
  CTask *v24; // r6
  int m_pParent_low; // r1
  int v26; // r1
  int v27; // r0
  CEntity *v28; // r5
  CEntity *v29; // r0

  if ( !this->m_pTargetEntity || this->m_bIsFinished )
    return 1;
  m_nShootRate = (float)pPed->m_nShootRate;
  if ( pPed->CharCreatedBy != 2 && pPed->m_nShootRate == 40 && pPed->m_nPedType != 6 )
    m_nShootRate = (float)pPed->m_pPedStats->m_nStatFlags;
  CPed::GiveWeaponAtStartOfFight(pPed);
  TaskSecondary = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
  m_pPedIntelligence = pPed->m_pPedIntelligence;
  if ( !TaskSecondary )
  {
    v15 = (char *)CTask::operator new(0x28u);
    m_pTargetEntity = this->m_pTargetEntity;
    v17 = FIGHT_CONTROL_TIME_TO_IDLE;
    CTaskSimple::CTaskSimple((CTaskSimple *)v15);
    *(_DWORD *)v15 = &off_6695FC;
    *((_WORD *)v15 + 4) = 256;
    v15[10] = 0;
    *((_DWORD *)v15 + 3) = 33;
    *(_DWORD *)(v15 + 18) = 0;
    *((_DWORD *)v15 + 7) = 0;
    *((_DWORD *)v15 + 8) = 0;
    v15[36] = -1;
    v15[37] = -1;
    v15[38] = 0;
    v15[39] = 0;
    *((_DWORD *)v15 + 6) = m_pTargetEntity;
    if ( m_pTargetEntity )
      CEntity::RegisterReference(m_pTargetEntity, (CEntity **)v15 + 6);
    LOWORD(v18) = -5536;
    if ( (unsigned int)v17 < 0xEA60 )
      v18 = (unsigned int)v17;
    *((_WORD *)v15 + 8) = v18;
    p_m_taskManager = &m_pPedIntelligence->m_taskManager;
    v20 = 0;
    CTaskManager::SetTaskSecondary(p_m_taskManager, (CTask *)v15, 0);
    this->m_nNextAttackTime = 0;
    p_m_nNextAttackTime = &this->m_nNextAttackTime;
    goto LABEL_31;
  }
  v9 = CTaskManager::GetTaskSecondary(&m_pPedIntelligence->m_taskManager, 0);
  if ( (*((int (__fastcall **)(CTask *))v9->_vptr$CTask + 5))(v9) != 1016 )
  {
    v4 = 0;
    v21 = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
    (*((void (__fastcall **)(CTask *, CPed *, int, _DWORD))v21->_vptr$CTask + 7))(v21, pPed, 1, 0);
    return v4;
  }
  p_m_nNextAttackTime = &this->m_nNextAttackTime;
  if ( this->m_nNextAttackTime <= CTimer::m_snTimeInMilliseconds )
  {
    v20 = 11;
    *p_m_nNextAttackTime = 0;
    if ( pPed->m_nExtraMeleeCombo != 4
      && pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_UNARMED )
    {
      v20 = 12;
    }
    goto LABEL_31;
  }
  if ( (*(_BYTE *)&this->m_pTargetEntity->m_info & 7) != 3 )
    goto LABEL_26;
  m_nBlockCounter = this->m_nBlockCounter;
  if ( m_nBlockCounter )
  {
LABEL_27:
    v22 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    v23 = m_nBlockCounter > v22;
    v14 = m_nBlockCounter - v22;
    if ( !v23 )
      v14 = 0;
    goto LABEL_29;
  }
  if ( (float)((float)((float)((float)rand() * 4.6566e-10) * 100.0) + 0.0) >= (float)((float)(m_nShootRate
                                                                                            * FIGHT_CONTROL_BLOCK_CHANCE)
                                                                                    / 40.0) )
  {
LABEL_26:
    m_nBlockCounter = this->m_nBlockCounter;
    if ( !m_nBlockCounter )
    {
      v20 = 0;
      goto LABEL_31;
    }
    goto LABEL_27;
  }
  v12 = FIGHT_CONTROL_BLOCK_MAXTIME;
  v13 = FIGHT_CONTROL_BLOCK_MINTIME;
  v14 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)(v12 - v13)) + v13;
LABEL_29:
  v20 = 2;
  this->m_nBlockCounter = v14;
LABEL_31:
  v24 = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
  m_pParent_low = SLOBYTE(v24[4].m_pParent);
  v23 = m_pParent_low < 4;
  v26 = m_pParent_low - 4;
  if ( v23 )
    v26 = 0;
  this->m_fAttackRange = CTaskSimpleFight::m_aComboData[v26].fGroupRange;
  if ( !*p_m_nNextAttackTime )
    *p_m_nNextAttackTime = CTimer::m_snTimeInMilliseconds
                         + (unsigned int)(float)((float)((float)((float)((float)rand() * 4.6566e-10) + 0.25)
                                                       / (float)((float)((float)((float)(m_nShootRate
                                                                                       * this->m_fAttackFreq)
                                                                               / 40.0)
                                                                       * 0.7)
                                                               + 0.3))
                                               * (float)CTaskSimpleFightingControl::DEFAULT_FIGHT_ATTACK_PERIOD);
  if ( v24 )
  {
    if ( SLOBYTE(v24[4].m_pParent) <= 1 )
    {
      v27 = CTaskSimpleFightingControl::CalcMoveCommand(this, pPed);
      if ( v27 > -1 )
        v20 = v27;
    }
    v28 = this->m_pTargetEntity;
    v29 = (CEntity *)v24[3]._vptr$CTask;
    BYTE1(v24[1]._vptr$CTask) = 1;
    if ( v29 != v28 )
    {
      if ( v29 )
        CEntity::CleanUpOldReference(v29, (CEntity **)&v24[3]);
      v24[3]._vptr$CTask = (int (**)(void))v28;
      if ( v28 )
        CEntity::RegisterReference(v28, (CEntity **)&v24[3]);
    }
    if ( SBYTE2(v24[4].m_pParent) < v20 )
      BYTE2(v24[4].m_pParent) = v20;
  }
  return 0;
}
// 6695FC: using guessed type void *off_6695FC;

//----- (004DBA98) --------------------------------------------------------
int16 __fastcall CTaskSimpleFightingControl::CalcMoveCommand(CTaskSimpleFightingControl *this, CPed *pPed)
{
  CEntity *m_pTargetEntity; // r6
  int16 v5; // r10
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r11
  CMatrix *v8; // r1
  CSimpleTransform *p_tx; // r2
  float *p_x; // r0
  float z; // s16
  float v12; // s22
  float v13; // s18
  float v14; // s20
  float v15; // s0
  float v16; // s2
  int v17; // r0
  float v18; // s16
  char v19; // r0
  float v20; // s0
  CMatrix *v21; // r2
  CSimpleTransform *v22; // r0
  int v23; // r0
  int v24; // r2
  CMatrix *v25; // r1
  float *v26; // r0
  CVector *v27; // r2
  float v28; // s0
  float v29; // s2
  int v31; // r0
  float v32[4]; // [sp+0h] [bp-80h] BYREF
  CVector out_normals[9]; // [sp+10h] [bp-70h] BYREF

  m_pTargetEntity = this->m_pTargetEntity;
  v5 = -1;
  if ( !m_pTargetEntity )
    return v5;
  m_pMat = pPed->m_pMat;
  p_m_transform = &pPed->m_transform;
  v8 = m_pTargetEntity->m_pMat;
  p_tx = &pPed->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  p_x = &v8->tx;
  z = p_tx->m_translate.z;
  if ( !v8 )
    p_x = &m_pTargetEntity->m_transform.m_translate.x;
  v12 = *p_x - p_tx->m_translate.x;
  v13 = p_x[2];
  v14 = p_x[1] - p_tx->m_translate.y;
  v15 = atan2f(-v12, v14) - pPed->m_fCurrentHeading;
  if ( v15 <= 3.1416 )
  {
    if ( v15 >= -3.1416 )
      goto LABEL_11;
    v16 = 6.2832;
  }
  else
  {
    v16 = -6.2832;
  }
  v15 = v15 + v16;
LABEL_11:
  if ( fabsf(v15) > FIGHTING_MAX_HEADING_DIFF )
  {
    v5 = 0;
    this->m_nNextAttackTime += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    return v5;
  }
  v17 = *(_BYTE *)&m_pTargetEntity->m_info & 7;
  if ( v17 == 2 )
  {
    CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanes(v13, m_pTargetEntity, out_normals, v32);
    v21 = pPed->m_pMat;
    v22 = &pPed->m_transform;
    if ( v21 )
      v22 = (CSimpleTransform *)&v21->tx;
    v23 = CPedGeometryAnalyser::ComputeEntityHitSide(&v22->m_translate, this->m_pTargetEntity);
    v24 = v23;
    v25 = pPed->m_pMat;
    v26 = &v32[v23];
    v27 = &out_normals[v24];
    if ( v25 )
      p_m_transform = (CSimpleTransform *)&v25->tx;
    v28 = *v26
        + (float)((float)((float)(p_m_transform->m_translate.x * v27->x) + (float)(p_m_transform->m_translate.y * v27->y))
                + (float)(p_m_transform->m_translate.z * v27->z));
    v29 = 0.7;
  }
  else
  {
    v18 = sqrtf((float)((float)(v12 * v12) + (float)(v14 * v14)) + (float)((float)(v13 - z) * (float)(v13 - z)));
    if ( v17 == 3 )
    {
      v19 = rand();
      v20 = v18 - this->m_fAttackRange;
      if ( v20 > 0.1 )
        return 3;
      v31 = v19 & 0xF;
      if ( v20 <= -0.1 )
      {
        if ( v18 >= 0.8 )
        {
          if ( (rand() & 0x3F) != 0 )
          {
            if ( (rand() & 0x3F) == 0 )
              return 10;
          }
          else
          {
            return 8;
          }
        }
        else if ( !v31 )
        {
          return 9;
        }
      }
      else if ( !v31 )
      {
        return 7;
      }
      return v5;
    }
    v29 = 0.3;
    v28 = v18 - this->m_fAttackRange;
  }
  if ( v28 > v29 )
    return 3;
  return v5;
}
// 4DBA98: using guessed type CVector out_normals[9];

//----- (004DBCFC) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CTaskSimpleUseGun::CTaskSimpleUseGun(
        CTaskSimpleUseGun *this,
        CEntity *pTargetEntity,
        CVector vecTarget,
        int8 nCommand,
        int16 nBurstLength,
        bool8 bAimImmediate)
{
  RwReal y; // r8
  RwReal x; // r6
  bool8 v10; // r3

  y = vecTarget.y;
  x = vecTarget.x;
  CTaskSimple::CTaskSimple(this);
  v10 = bAimImmediate;
  *(_WORD *)&this->m_bIsFinished = 256;
  this->m_bSkipAim = 0;
  this->m_nNextCommand = nCommand;
  this->m_vecMoveCommand.x = 0.0;
  this->m_vecMoveCommand.y = 0.0;
  *(_DWORD *)&this->m_bMoveControl = 0;
  this->m_nLastCommand = -1;
  this->_vptr$CTask = (int (**)(void))&off_669664;
  this->m_pTargetEntity = pTargetEntity;
  if ( pTargetEntity )
  {
    CEntity::RegisterReference(pTargetEntity, &this->m_pTargetEntity);
    v10 = bAimImmediate;
  }
  this->m_vecCoords.x = x;
  this->m_vecCoords.y = y;
  this->m_vecCoords.z = vecTarget.z;
  this->m_pAnim = 0;
  this->m_pWeaponInfo = 0;
  this->m_nBurstLength = nBurstLength;
  *(_DWORD *)&this->m_nBurstShots = 16711680;
  this->m_lookIkInUse = 0;
  this->m_bAimImmediate = v10;
}
// 4DBCFC: fragmented variable at 0:r2.8,8:^28.4 may be wrong
// 4DBCFC: variables would overlap: 0:r2.8,8:^28.4 and ^28.4
// 669664: using guessed type void *off_669664;

//----- (004DBD88) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::~CTaskSimpleUseGun(CTaskSimpleUseGun *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1
  CAnimBlendAssociation *m_pAnim; // r0

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669664;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  sub_1A01F4(this);
}
// 669664: using guessed type void *off_669664;

//----- (004DBDC8) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::~CTaskSimpleUseGun(CTaskSimpleUseGun *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1
  CAnimBlendAssociation *m_pAnim; // r0
  void *v5; // r0

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669664;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  CTask::~CTask(this);
  sub_197118(v5);
}
// 4DBE00: variable 'v5' is possibly undefined
// 669664: using guessed type void *off_669664;

//----- (004DBE0C) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CTaskSimpleUseGun::Reset(
        CTaskSimpleUseGun *this,
        CPed *pPed,
        CEntity *pTargetEntity,
        CVector vecTarget,
        int8 nCommand,
        int16 nBurstLength)
{
  CEntity *v8; // r0
  CEntity **p_m_pTargetEntity; // r5
  CEntity *m_pTargetEntity; // t1

  this->m_vecCoords = vecTarget;
  *(_DWORD *)&this->m_nBurstLength = (unsigned __int16)nBurstLength;
  this->m_nCountDownFrames = -1;
  this->m_bBlockedLOS = 0;
  CTaskSimpleUseGun::AbortIK(this, pPed);
  m_pTargetEntity = this->m_pTargetEntity;
  p_m_pTargetEntity = &this->m_pTargetEntity;
  v8 = m_pTargetEntity;
  *(_WORD *)((char *)p_m_pTargetEntity + 29) = 0;
  if ( m_pTargetEntity != pTargetEntity )
  {
    if ( v8 )
      CEntity::CleanUpOldReference(v8, p_m_pTargetEntity);
    *p_m_pTargetEntity = pTargetEntity;
    if ( pTargetEntity )
      sub_196050(pTargetEntity, p_m_pTargetEntity);
  }
}
// 4DBE0C: fragmented variable at 0:r3.4,4:^18.8 may be wrong
// 4DBE0C: variables would overlap: 0:r3.4,4:^18.8 and ^18.8

//----- (004DBE6C) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::AbortIK(CTaskSimpleUseGun *this, CPed *pPed)
{
  if ( this->m_armIkInUse )
  {
    if ( IKChainManager_c::IsArmPointing(&g_ikChainMan, 0, pPed) )
      IKChainManager_c::AbortPointArm(&g_ikChainMan, 0, pPed, 250);
    if ( IKChainManager_c::IsArmPointing(&g_ikChainMan, 1, pPed) )
      IKChainManager_c::AbortPointArm(&g_ikChainMan, 1, pPed, 250);
    this->m_armIkInUse = 0;
  }
  if ( this->m_lookIkInUse )
  {
    if ( IKChainManager_c::IsLooking(&g_ikChainMan, pPed) )
      IKChainManager_c::AbortLookAt(&g_ikChainMan, pPed, 250);
    this->m_lookIkInUse = 0;
  }
  pPed->m_ik.m_flags &= ~0x10u;
}

//----- (004DBF10) --------------------------------------------------------
bool __fastcall CTaskSimpleUseGun::MakeAbortable(
        CTaskSimpleUseGun *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CAnimBlendAssociation *m_pAnim; // r0
  bool v8; // r6
  CPlayerPedData *m_pPlayerData; // r0

  if ( (unsigned int)(iPriority - 1) > 1 )
  {
    v8 = 0;
    this->m_nNextCommand = 6;
  }
  else
  {
    CTaskSimpleUseGun::RemoveStanceAnims(this, pPed, *(float *)&iPriority);
    if ( iPriority == 2 )
      CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, pPed->m_motionAnimGroup, ANIM_STD_IDLE, 1000.0);
    m_pAnim = this->m_pAnim;
    if ( m_pAnim )
    {
      if ( iPriority == 2 )
      {
        m_pAnim->m_fBlendDelta = -1000.0;
        m_pAnim = this->m_pAnim;
      }
      CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
      this->m_pAnim = 0;
    }
    v8 = 1;
    this->m_bIsFinished = 1;
    CTaskSimpleUseGun::AbortIK(this, pPed);
    m_pPlayerData = pPed->m_pPlayerData;
    if ( m_pPlayerData )
    {
      m_pPlayerData->m_fAttackButtonCounter = 0.0;
      return 1;
    }
  }
  return v8;
}

//----- (004DBF94) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::RemoveStanceAnims(CTaskSimpleUseGun *this, CPed *pPed, float fBlendDelta)
{
  CAnimBlendAssociation *m_pAnim; // r0
  uint16 m_bitsFlag; // r1
  float m_fCurrentTime; // s0
  CWeaponInfo *m_pWeaponInfo; // r2
  CAnimBlendAssociation *Association; // r0
  int v10; // r6
  CAnimBlendAssociation *v11; // r0
  CAnimBlendAssociation *v12; // r0
  CAnimBlendAssociation *v13; // r0
  CAnimBlendAssociation *v14; // r0
  CPad *PadFromPlayer; // r0
  CPad *v16; // r6
  CAnimBlendAssociation *v17; // r0
  CPlayerPedData *m_pPlayerData; // r0
  CAnimBlendAssociation *v19; // r0

  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
  {
    m_bitsFlag = m_pAnim->m_bitsFlag;
    if ( (m_bitsFlag & 1) == 0 )
    {
      m_fCurrentTime = m_pAnim->m_fCurrentTime;
      if ( m_fCurrentTime < m_pAnim->m_pAnimBlendHierarchy->m_fTotalTime )
      {
        m_pWeaponInfo = this->m_pWeaponInfo;
        if ( m_pWeaponInfo && m_pWeaponInfo->m_animLoopStart == m_fCurrentTime )
        {
          CAnimBlendAssociation::SetCurrentTime(m_pAnim, m_pWeaponInfo->m_animLoopEnd);
          m_pAnim = this->m_pAnim;
          m_bitsFlag = m_pAnim->m_bitsFlag;
        }
        m_pAnim->m_bitsFlag = m_bitsFlag | 1;
      }
    }
  }
  Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x31u);
  if ( Association )
  {
    v10 = 1;
    Association->m_bitsFlag |= 4u;
  }
  else
  {
    v10 = 0;
  }
  v11 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x32u);
  if ( v11 )
  {
    v11->m_bitsFlag |= 4u;
    v10 = 1;
  }
  v12 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x33u);
  if ( v12 )
  {
    v12->m_bitsFlag |= 4u;
    v10 = 1;
  }
  v13 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x34u);
  if ( v13 )
  {
    v13->m_bitsFlag |= 4u;
    v10 = 1;
  }
  v14 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x35u);
  if ( v14 )
  {
    v14->m_bitsFlag |= 4u;
    CPed::SetMoveState(pPed, PEDMOVE_STILL);
    pPed->m_eMoveStateAnim = PEDMOVE_STILL;
  }
  else
  {
    CPed::SetMoveState(pPed, PEDMOVE_STILL);
    pPed->m_eMoveStateAnim = PEDMOVE_STILL;
    if ( v10 != 1 )
      return;
  }
  if ( CPed::IsPlayer(pPed)
    && (PadFromPlayer = CPlayerPed::GetPadFromPlayer((CPlayerPed *)pPed), (v16 = PadFromPlayer) != 0)
    && (CPad::GetPedWalkUpDown(PadFromPlayer) > 50
     || CPad::GetPedWalkUpDown(v16) < -50
     || CPad::GetPedWalkLeftRight(v16) > 50
     || CPad::GetPedWalkLeftRight(v16) < -50) )
  {
    v17 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, pPed->m_motionAnimGroup, ANIM_STD_WALK, 8.0);
    v17->m_bitsFlag |= 1u;
    CPed::SetMoveState(pPed, PEDMOVE_WALK);
    m_pPlayerData = pPed->m_pPlayerData;
    pPed->m_eMoveStateAnim = PEDMOVE_WALK;
    if ( m_pPlayerData )
      m_pPlayerData->m_moveBlendRatio = 1.0;
  }
  else
  {
    v19 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, pPed->m_motionAnimGroup, ANIM_STD_IDLE, 8.0);
    v19->m_bitsFlag |= 1u;
    if ( this->m_nNextCommand == 6 && (unsigned int)(pPed->m_motionAnimGroup - 57) >= 3 )
      sub_197F5C((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_WEAPON_2IDLE, 8.0);
  }
}

//----- (004DC140) --------------------------------------------------------
bool __fastcall CTaskSimpleUseGun::ProcessPed(CTaskSimpleUseGun *this, CPed *pPed)
{
  CWeaponInfo *m_pWeaponInfo; // r5
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  float v7; // r2
  CPlayerPedData *v8; // r0
  bool v9; // r6
  CPlayerPedData *m_pPlayerData; // r0
  int m_nChosenWeapon; // r0
  CPlayerPedData *v12; // r6
  float m_fAttackButtonCounter; // s16
  int m_nPedFlags; // r0
  CPedFlags *p_m_nPedFlags; // r11
  int v16; // r1
  int v17; // r1
  CAnimBlendAssociation *v18; // r0
  eWeaponType v19; // r6
  int8 v20; // r0
  CWeaponInfo *WeaponInfo; // r0
  CPlayerPedData *v22; // r0
  int m_nCountDownFrames; // r0
  CAnimBlendAssociation *m_pAnim; // r0
  int v25; // r1
  __int64 v26; // r0
  int m_nLastCommand; // r1
  int v28; // r6
  float v29; // s0
  float v30; // s2
  CEntity *m_pTargetEntity; // r5
  int v32; // r0
  CEntity *v33; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v35; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  CWeaponInfo *v38; // r2
  int v39; // r1
  float *p_m_animLoopStart; // r6
  float *p_m_animLoopEnd; // r5
  float v42; // s16
  float *p_m_animFireTime; // r6
  float v44; // s18
  float v45; // s20
  __int16 v46; // r2
  float v47; // s0
  CWeaponInfo *v48; // r1
  CAnimBlendAssociation *v49; // r0
  float v50; // s2
  float v51; // s0
  int16 v52; // r2
  uint8 v53; // r3
  float v54; // s0
  float v55; // s2
  int16 m_nBurstShots; // r0
  uint8 v57; // r1
  int v58; // r1
  CAnimBlendAssociation *v59; // r0
  float m_fCurrentTime; // s0
  uint16 m_bitsFlag; // r2
  uint8 m_nFireGunThisFrame; // r2
  int v63; // r0
  int16 v64; // r0
  CAnimBlendAssociation *v65; // r0
  int v66; // r3
  uint16 v67; // r2
  float v68; // s0
  int v69; // r3
  float m_fTimeStep; // s2
  int v71; // r1
  bool v72; // cc
  CAnimBlendAssociation *v73; // r0
  int v74; // r0
  CAnimBlendAssociation *v75; // r0
  float v76; // s0
  int v77; // r1
  CAnimBlendAssociation *v78; // r0
  uint16 v79; // r2
  uint16 v80; // r3
  CEntity *v81; // r0
  unsigned int v82; // r6
  CMatrix *v83; // r0
  CSimpleTransform *v84; // r1
  CMatrix *v85; // r1
  CSimpleTransform *v86; // r2
  CTaskSimple v87; // d16
  RwReal v88; // r0
  __int64 v89; // r0
  CMatrix *v90; // r0
  CSimpleTransform *p_m_transform; // r1
  float y; // s6
  float z; // s8
  int (**v94)(void); // s16
  CTask *m_pParent; // s18
  float v96; // s0
  float v97; // s2
  float v98; // s2
  CMatrix *v99; // r0
  float xz; // s4
  float yz; // s2
  float zz; // s0
  int m_nNextCommand; // r0
  CTaskSimpleFight v105; // [sp+10h] [bp-70h] BYREF
  CVector vec; // [sp+3Ch] [bp-44h] BYREF
  CVector v107; // 0:r2.8,8:^0.4

  if ( this->m_lookIkInUse && !IKChainManager_c::IsLooking(&g_ikChainMan, pPed) )
    this->m_lookIkInUse = 0;
  if ( this->m_armIkInUse && !IKChainManager_c::IsArmPointing(&g_ikChainMan, 0, pPed) )
    this->m_armIkInUse = 0;
  m_pWeaponInfo = this->m_pWeaponInfo;
  this->m_nFireGunThisFrame = 0;
  if ( m_pWeaponInfo )
  {
    m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    WeaponSkill = CPed::GetWeaponSkill(pPed);
    if ( m_pWeaponInfo != CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill) )
      (*((void (__fastcall **)(CTaskSimpleUseGun *, CPed *, int, _DWORD))this->_vptr$CTask + 7))(this, pPed, 1, 0);
  }
  else
  {
    m_pPlayerData = pPed->m_pPlayerData;
    if ( m_pPlayerData )
    {
      m_nChosenWeapon = (unsigned __int8)m_pPlayerData->m_nChosenWeapon;
      if ( m_nChosenWeapon != (unsigned __int8)pPed->m_nCurrentWeapon )
        return 0;
    }
    else
    {
      m_nChosenWeapon = (unsigned __int8)pPed->m_nCurrentWeapon;
    }
    v19 = pPed->m_WeaponSlots[(char)m_nChosenWeapon].m_eWeaponType;
    v20 = CPed::GetWeaponSkill(pPed);
    WeaponInfo = CWeaponInfo::GetWeaponInfo(v19, v20);
    this->m_pWeaponInfo = WeaponInfo;
    if ( WeaponInfo->m_eFireType == FIRETYPE_MELEE || BYTE1(WeaponInfo->m_nFlags) << 31 )
    {
      v9 = 1;
      this->m_pWeaponInfo = 0;
      this->m_bIsFinished = 1;
      CTaskSimpleUseGun::AbortIK(this, pPed);
      v22 = pPed->m_pPlayerData;
      if ( v22 )
      {
        v22->m_fAttackButtonCounter = 0.0;
        return 1;
      }
      return v9;
    }
    this->m_vecMoveCommand.x = 0.0;
    this->m_vecMoveCommand.y = 0.0;
  }
  if ( (this->m_pWeaponInfo->m_nFlags & 4) == 0 || !pPed->m_pPlayerData )
    *((_DWORD *)&pPed->m_nPedFlags + 2) |= 0x8000u;
  if ( this->m_bIsFinished )
  {
    CTaskSimpleUseGun::RemoveStanceAnims(this, pPed, v7);
    CTaskSimpleUseGun::AbortIK(this, pPed);
    v8 = pPed->m_pPlayerData;
    if ( !v8 )
      return 1;
    goto LABEL_15;
  }
  v12 = pPed->m_pPlayerData;
  if ( v12 )
  {
    m_fAttackButtonCounter = v12->m_fAttackButtonCounter;
    if ( m_fAttackButtonCounter > 0.0 )
      v12->m_fAttackButtonCounter = m_fAttackButtonCounter
                                  * powf(CTaskSimpleUseGun::WEAPON_RE_AIM_RATE, CTimer::ms_fTimeStep);
  }
  if ( this->m_bIsInControl )
  {
    this->m_nCountDownFrames = -1;
    m_nPedFlags = (int)pPed->m_nPedFlags;
    p_m_nPedFlags = &pPed->m_nPedFlags;
    v16 = *((_DWORD *)&pPed->m_nPedFlags + 2);
    if ( ~v16 & 0x40000 | ~m_nPedFlags & 0x4000000
      && (m_nPedFlags & 0x4000000 | v16 & 0x10000 ^ 0x10000 || (this->m_pWeaponInfo->m_nFlags & 2) != 0) )
    {
      if ( this->m_nNextCommand == 5 && this->m_nLastCommand <= 3 )
      {
        m_pAnim = this->m_pAnim;
        if ( m_pAnim )
          CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
        this->m_pAnim = 0;
        CTaskSimpleUseGun::AbortIK(this, pPed);
      }
LABEL_52:
      LODWORD(v26) = this->m_pAnim;
      if ( !(_DWORD)v26 )
      {
        CTaskSimpleUseGun::StartAnim(this, pPed);
        if ( this->m_pAnim )
          goto LABEL_219;
        goto LABEL_218;
      }
      m_nLastCommand = (unsigned __int8)this->m_nLastCommand;
      if ( m_nLastCommand == 5 )
      {
        v28 = (*(_DWORD *)p_m_nPedFlags >> 26) & 1;
        if ( *(float *)(v26 + 24) > 0.9 && *(float *)(v26 + 28) >= 0.0 )
        {
          v29 = *(float *)(v26 + 32);
          v30 = CTaskSimpleFight::m_aComboData[12].aFireTime[v28];
          if ( v29 > v30 && (float)(v29 - *(float *)(v26 + 40)) < v30 )
          {
            operator*(
              &vec,
              pPed->m_pMat,
              &CTaskSimpleFight::m_aHitOffset[CTaskSimpleFight::m_aComboData[12].aHitLevel[v28]]);
            m_pTargetEntity = this->m_pTargetEntity;
            CTaskSimple::CTaskSimple(&v105);
            v105._vptr$CTask = (int (**)(void))&off_6695FC;
            *(_WORD *)&v105.m_bIsFinished = 256;
            v105.m_bAnimsReferenced = 0;
            v105.m_nRequiredAnimGroup = ANIM_MELEE_UNARMED_1;
            *(_DWORD *)&v105.m_nIdleCounter = 0;
            v105.m_pTargetEntity = m_pTargetEntity;
            v105.m_pAnim = 0;
            v105.m_pIdleAnim = 0;
            v105.m_nComboSet = -1;
            v105.m_nCurrentMove = -1;
            v105.m_nNextCommand = 11;
            v105.m_nLastCommand = 0;
            if ( m_pTargetEntity )
              CEntity::RegisterReference(m_pTargetEntity, (CEntity **)(v32 + 24));
            v105.m_nComboSet = 16;
            v105.m_nIdlePeriod = 20000;
            v105.m_nCurrentMove = v28;
            v105.m_nLastCommand = 11;
            v105.m_pAnim = this->m_pAnim;
            CTaskSimpleFight::FightStrike(&v105, pPed, &vec);
            v105.m_pAnim = 0;
            CTaskSimpleFight::~CTaskSimpleFight(&v105);
          }
        }
        v33 = this->m_pTargetEntity;
        if ( v33 )
        {
          m_pMat = pPed->m_pMat;
          v35 = v33->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &pPed->m_transform;
          p_x = &v35->tx;
          if ( !v35 )
            p_x = &v33->m_transform.m_translate.x;
          pPed->m_fDesiredHeading = atan2f(-(float)(*p_x - p_tx->m_translate.x), p_x[1] - p_tx->m_translate.y);
        }
        goto LABEL_176;
      }
      if ( m_nLastCommand == 4 )
      {
        if ( (*(__int16 *)(v26 + 44) & 0xFFFFFFFE) == 226 )
          goto LABEL_176;
LABEL_56:
        if ( *(float *)(v26 + 28) < 0.0 )
          goto LABEL_176;
        goto LABEL_57;
      }
      if ( (unsigned __int8)(m_nLastCommand - 1) > 2u )
      {
        if ( !this->m_nLastCommand && *(float *)(v26 + 24) > 0.0 )
          goto LABEL_56;
LABEL_176:
        this->m_bSkipAim = 0;
        if ( (pPed->m_ik.m_flags & 4) == 0 )
          goto LABEL_215;
        v81 = this->m_pTargetEntity;
        if ( v81 )
        {
          if ( (*(_BYTE *)&v81->m_info & 7) == 3 )
          {
            v82 = 0;
            CPed::GetBonePosition((CPed *)v81, (RwV3d_0 *)&v105, 3u, 0);
            if ( *(float *)&this->m_pTargetEntity[22].m_nFlags <= 0.0 )
              v82 = 1;
LABEL_193:
            v89 = 0LL;
            if ( *(float *)&v105.m_pParent != 0.0 )
              HIDWORD(v89) = 1;
            if ( *(float *)&v105._vptr$CTask != 0.0 )
              LODWORD(v89) = 1;
            if ( !v89 )
              goto LABEL_213;
            v90 = pPed->m_pMat;
            p_m_transform = (CSimpleTransform *)&v90->tx;
            if ( !v90 )
              p_m_transform = &pPed->m_transform;
            y = p_m_transform->m_translate.y;
            z = p_m_transform->m_translate.z;
            *(float *)&v105._vptr$CTask = *(float *)&v105._vptr$CTask - p_m_transform->m_translate.x;
            *(float *)&v105.m_pParent = *(float *)&v105.m_pParent - y;
            *(float *)&v105.m_bIsFinished = *(float *)&v105.m_bIsFinished - z;
            CVector::Normalise((CVector *)&v105);
            v94 = v105._vptr$CTask;
            m_pParent = v105.m_pParent;
            v96 = atan2f(COERCE_FLOAT((int)v105._vptr$CTask ^ 0x80000000), *(float *)&v105.m_pParent)
                - pPed->m_fCurrentHeading;
            if ( v96 <= 3.1416 )
            {
              if ( v96 >= -3.1416 )
                goto LABEL_205;
              v97 = 6.2832;
            }
            else
            {
              v97 = -6.2832;
            }
            v96 = v96 + v97;
LABEL_205:
            v98 = (float)v82 * 0.69813;
            if ( v96 > (float)(2.0071 - v98) || v96 < (float)(v98 + -2.2689) )
              this->m_bSkipAim = 1;
            v99 = pPed->m_pMat;
            if ( v99 )
            {
              xz = v99->xz;
              yz = v99->yz;
              zz = v99->zz;
            }
            else
            {
              yz = 0.0;
              zz = 1.0;
              xz = 0.0;
            }
            if ( (((float)((float)((float)(xz * *(float *)&v94) + (float)(yz * *(float *)&m_pParent))
                         + (float)(zz * *(float *)&v105.m_bIsFinished)) < -0.8) & (unsigned __int8)v82) == 1 )
              this->m_bSkipAim = 1;
LABEL_213:
            if ( !(*(_DWORD *)p_m_nPedFlags & 0x4000000 | *((_DWORD *)&pPed->m_nPedFlags + 2) & 0x10000 ^ 0x10000) )
              this->m_bSkipAim = 1;
LABEL_215:
            if ( this->m_nLastCommand && this->m_nLastCommand <= 3 && !this->m_bSkipAim )
            {
              CTaskSimpleUseGun::AimGun(this, pPed);
LABEL_219:
              if ( (this->m_pWeaponInfo->m_nFlags & 2) == 0
                || (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0
                || this->m_bMoveControl )
              {
                CTaskSimpleUseGun::SetMoveAnim(this, pPed);
              }
              m_nNextCommand = this->m_nNextCommand;
              if ( m_nNextCommand <= 5 && (m_nNextCommand != 4 || (this->m_nLastCommand & 0xFE) != 2) )
                this->m_nNextCommand = 0;
              v9 = 0;
              this->m_bIsInControl = 0;
              return v9;
            }
LABEL_218:
            CTaskSimpleUseGun::AbortIK(this, pPed);
            goto LABEL_219;
          }
          v85 = v81->m_pMat;
          v86 = (CSimpleTransform *)&v85->tx;
          if ( !v85 )
            v86 = &v81->m_transform;
          v87 = *(CTaskSimple *)&v86->m_translate.x;
          v88 = v86->m_translate.z;
        }
        else
        {
          if ( CPed::IsPlayer(pPed) && TheCamera.Cams[0].Mode == 53 )
          {
            v83 = pPed->m_pMat;
            v84 = (CSimpleTransform *)&v83->tx;
            if ( !v83 )
              v84 = &pPed->m_transform;
            v107.x = v84->m_translate.x + 0.0;
            v107.y = v84->m_translate.y + 0.0;
            v107.z = v84->m_translate.z + 0.7;
            CCamera::Find3rdPersonCamTargetVector(&TheCamera, 20.0, v107, &vec, (CVector *)&v105);
            goto LABEL_192;
          }
          v88 = this->m_vecCoords.z;
          v87 = *(CTaskSimple *)&this->m_vecCoords.x;
        }
        *(RwReal *)&v105.m_bIsFinished = v88;
        v105.CTaskSimple = v87;
LABEL_192:
        v82 = 0;
        goto LABEL_193;
      }
      if ( *(float *)(v26 + 28) < 0.0 )
        goto LABEL_176;
      v38 = this->m_pWeaponInfo;
      v39 = m_nLastCommand & 0xFE;
      p_m_animLoopStart = &v38->m_animLoopStart;
      p_m_animLoopEnd = &v38->m_animLoopEnd;
      if ( (*(_DWORD *)p_m_nPedFlags & 0x4000000) != 0 )
        p_m_animLoopStart = &v38->m_anim2LoopStart;
      v42 = *p_m_animLoopStart;
      if ( (*(_DWORD *)p_m_nPedFlags & 0x4000000) != 0 )
        p_m_animLoopEnd = &v38->m_anim2LoopEnd;
      p_m_animFireTime = &v38->m_animFireTime;
      v44 = *p_m_animLoopEnd;
      if ( (*(_DWORD *)p_m_nPedFlags & 0x4000000) != 0 )
        p_m_animFireTime = &v38->m_anim2FireTime;
      v45 = *p_m_animFireTime;
      if ( v39 == 2 )
      {
        if ( *(float *)(v26 + 24) < 0.99
          || pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eState == WEAPONSTATE_RELOADING )
        {
          v46 = *(_WORD *)(v26 + 46);
          if ( (v46 & 1) != 0 )
          {
            v47 = *(float *)(v26 + 32);
            if ( v47 >= v42 && (float)(v47 - *(float *)(v26 + 40)) < v42 )
            {
              *(_WORD *)(v26 + 46) = v46 & 0xFFFE;
              CAnimBlendAssociation::SetCurrentTime(this->m_pAnim, v42);
            }
          }
        }
        else
        {
          WORD2(v26) = *(_WORD *)(v26 + 46);
          if ( (v26 & 0x100000000LL) == 0 && *(float *)(v26 + 32) == v42 )
            *(_WORD *)(v26 + 46) = WORD2(v26) | 1;
        }
      }
      v48 = this->m_pWeaponInfo;
      if ( (v48->m_nFlags & 0x400) != 0 )
      {
        LOBYTE(v58) = this->m_nLastCommand;
        if ( (v58 & 0xFE) != 2 )
          goto LABEL_123;
        v59 = this->m_pAnim;
        m_fCurrentTime = v59->m_fCurrentTime;
        if ( m_fCurrentTime <= v42 )
          goto LABEL_123;
        if ( m_fCurrentTime >= v44 )
          goto LABEL_123;
        m_bitsFlag = v59->m_bitsFlag;
        if ( (m_bitsFlag & 1) == 0 )
          goto LABEL_123;
        v58 = (char)v58;
        if ( this->m_bFiredGun && (v58 != 3 || this->m_nBurstShots <= 0) && (this->m_nNextCommand & 0xFE) != 2 )
        {
          v59->m_bitsFlag = m_bitsFlag & 0xFFFE;
          this->m_pAnim->m_fBlendDelta = -4.0;
          goto LABEL_123;
        }
        m_nFireGunThisFrame = this->m_nFireGunThisFrame;
        this->m_bFiredGun = 1;
        v63 = this->m_nNextCommand;
        this->m_nFireGunThisFrame = m_nFireGunThisFrame | 1;
        if ( v63 > v58 )
        {
          this->m_nLastCommand = v63;
          v58 = v63;
        }
        v64 = 0;
        this->m_nNextCommand = 0;
        if ( v58 != 3 || this->m_nBurstShots < 1 )
        {
LABEL_122:
          this->m_nBurstShots = v64;
LABEL_123:
          v65 = this->m_pAnim;
          v66 = this->m_nLastCommand;
          v67 = v65->m_bitsFlag;
          if ( (v67 & 1) != 0 )
            goto LABEL_129;
          if ( v66 == 1 && this->m_nNextCommand < 2 )
            goto LABEL_155;
          if ( v65->m_fCurrentTime >= v65->m_pAnimBlendHierarchy->m_fTotalTime && v65->m_fBlendDelta < 0.0 )
          {
LABEL_129:
            if ( v66 == 1 && (v67 & 1) != 0 )
            {
              v68 = v65->m_fCurrentTime;
              v69 = 0;
              m_fTimeStep = v65->m_fTimeStep;
              v71 = 0;
              if ( v68 < v42 )
                v69 = 1;
              if ( (float)(v68 - m_fTimeStep) >= v42 )
                v71 = 1;
              if ( !(v71 | v69) || (float)(v68 + m_fTimeStep) >= v42 )
              {
                v65->m_bitsFlag = v67 & 0xFFFE;
                CAnimBlendAssociation::SetCurrentTime(this->m_pAnim, v42);
              }
            }
          }
          else
          {
            v72 = v66 < 4;
            if ( v66 <= 4 )
              v72 = this->m_nNextCommand < 5;
            if ( v72 )
            {
              if ( v65->m_fBlendAmount > 0.0
                && v65->m_fBlendDelta >= 0.0
                && pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eState != WEAPONSTATE_RELOADING )
              {
                v65->m_bitsFlag = v67 | 1;
              }
            }
            else if ( (this->m_pWeaponInfo->m_nFlags & 0x40000) != 0 )
            {
              v65->m_bitsFlag = v67 | 1;
              v73 = this->m_pAnim;
              if ( v73->m_fCurrentTime <= v42 )
                CAnimBlendAssociation::SetCurrentTime(v73, v44);
            }
            else
            {
              v65->m_fBlendDelta = -4.0;
            }
            v74 = (unsigned __int8)this->m_nNextCommand;
            if ( (v74 & 0xFE) == 2 )
            {
              this->m_nNextCommand = 0;
              this->m_nLastCommand = v74;
              if ( v74 == 3 )
                this->m_nBurstShots = this->m_nBurstLength;
            }
            else if ( v74 != 1 && this->m_nLastCommand == 1 )
            {
              this->m_nLastCommand = 0;
            }
          }
LABEL_155:
          v75 = this->m_pAnim;
          v76 = v75->m_fCurrentTime;
          if ( v76 > v44 && (float)(v76 - v75->m_fTimeStep) <= v44 )
          {
            v77 = (unsigned __int8)this->m_nNextCommand;
            if ( (v77 & 0xFE) == 2 || this->m_nLastCommand == 3 && v77 != 4 && this->m_nBurstShots >= 1 )
            {
              CAnimBlendAssociation::SetCurrentTime(v75, v42);
              v78 = this->m_pAnim;
              v79 = v78->m_bitsFlag;
              v80 = v79 | 1;
              if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eState == WEAPONSTATE_RELOADING )
                v80 = v79 & 0xFFFE;
              v78->m_bitsFlag = v80;
              LOBYTE(v78) = this->m_nNextCommand;
              if ( ((unsigned __int8)v78 & 0xFE) == 2 )
              {
                v78 = (CAnimBlendAssociation *)(char)v78;
                if ( (char)v78 > this->m_nLastCommand )
                  this->m_nLastCommand = (char)v78;
                if ( v78 == (CAnimBlendAssociation *)((char *)&dword_0 + 3) && !this->m_nBurstShots )
                  this->m_nBurstShots = this->m_nBurstLength;
                this->m_nNextCommand = 0;
              }
            }
            else if ( v77 == 1 )
            {
              CAnimBlendAssociation::SetCurrentTime(v75, v42);
              this->m_pAnim->m_bitsFlag &= ~1u;
              *(_WORD *)&this->m_nNextCommand = 256;
            }
          }
          v26 = *(_QWORD *)&this->m_pAnim;
          if ( *(float *)(v26 + 32) > *(float *)(HIDWORD(v26) + 88) && this->m_nNextCommand == 7 )
          {
            this->m_bIsFinished = 1;
            if ( (*(_BYTE *)(v26 + 47) & 4) != 0 )
            {
              HIDWORD(v26) = -1082130432;
              goto LABEL_58;
            }
LABEL_57:
            HIDWORD(v26) = -1065353216;
LABEL_58:
            *(_DWORD *)(v26 + 28) = HIDWORD(v26);
            goto LABEL_176;
          }
          goto LABEL_176;
        }
        m_nBurstShots = this->m_nBurstShots;
      }
      else
      {
        v49 = this->m_pAnim;
        if ( !(LOBYTE(v49->m_bitsFlag) << 31) || (this->m_nLastCommand & 0xFE) != 2 )
          goto LABEL_123;
        v50 = v49->m_fCurrentTime;
        v51 = v45 + 0.01;
        if ( v50 > (float)(v45 + 0.01) && (float)(v50 - v49->m_fTimeStep) <= v51 )
        {
          v52 = this->m_nBurstShots;
          v53 = this->m_nFireGunThisFrame | 1;
          this->m_bFiredGun = 1;
          this->m_nFireGunThisFrame = v53;
          if ( v52 >= 1 )
            this->m_nBurstShots = v52 - 1;
        }
        if ( (v48->m_nFlags & 0x800) == 0 )
          goto LABEL_123;
        if ( (*((_BYTE *)&pPed->m_nPedFlags + 10) & 2) != 0 )
          goto LABEL_123;
        v54 = v51 + (float)((float)(v44 - v42) * 0.5);
        v55 = v49->m_fCurrentTime;
        if ( v55 <= v54 )
          goto LABEL_123;
        if ( (float)(v55 - v49->m_fTimeStep) > v54 )
          goto LABEL_123;
        m_nBurstShots = this->m_nBurstShots;
        v57 = this->m_nFireGunThisFrame | 2;
        this->m_bFiredGun = 1;
        this->m_nFireGunThisFrame = v57;
        if ( m_nBurstShots < 1 )
          goto LABEL_123;
      }
      v64 = m_nBurstShots - 1;
      goto LABEL_122;
    }
    if ( this->m_nLastCommand == 5 )
      goto LABEL_52;
    v17 = (unsigned __int8)this->m_nNextCommand;
    v18 = this->m_pAnim;
    if ( v17 == 5 )
    {
      if ( !v18 )
        goto LABEL_52;
    }
    else if ( !v18 )
    {
      if ( (unsigned __int8)(v17 - 1) >= 3u )
        goto LABEL_52;
LABEL_48:
      CTaskSimpleUseGun::AbortIK(this, pPed);
      v25 = (unsigned __int8)this->m_nLastCommand;
      this->m_bBlockedLOS = 1;
      if ( v25 == 3 )
        this->m_nLastCommand = 1;
      goto LABEL_219;
    }
    v18->m_fBlendDelta = -4.0;
    this->m_pAnim->m_bitsFlag &= ~1u;
    this->m_pAnim->m_bitsFlag |= 4u;
    goto LABEL_48;
  }
  m_nCountDownFrames = this->m_nCountDownFrames;
  v9 = 0;
  this->m_bFiredGun = 0;
  this->m_vecMoveCommand.x = 0.0;
  this->m_vecMoveCommand.y = 0.0;
  this->m_nCountDownFrames = m_nCountDownFrames - 1;
  if ( !m_nCountDownFrames )
  {
    v9 = 1;
    this->m_bIsFinished = 1;
    CTaskSimpleUseGun::RemoveStanceAnims(this, pPed, v7);
    CTaskSimpleUseGun::AbortIK(this, pPed);
    v8 = pPed->m_pPlayerData;
    if ( v8 )
    {
LABEL_15:
      v9 = 1;
      v8->m_fAttackButtonCounter = 0.0;
    }
  }
  return v9;
}
// 4DC1EC: variable 'v7' is possibly undefined
// 4DC4D8: variable 'v32' is possibly undefined
// 0: using guessed type int dword_0;
// 6695FC: using guessed type void *off_6695FC;

//----- (004DCCA4) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::StartAnim(CTaskSimpleUseGun *this, CPed *pPed)
{
  float v2; // r2
  CTaskSimpleDuck *TaskDuck; // r9
  CAnimBlendAssociation *m_pAnim; // r0
  int8 m_nNextCommand; // r0
  CPedFlags *p_m_nPedFlags; // r8
  CAnimBlendAssociation *v9; // r1
  CWeaponInfo *m_pWeaponInfo; // r0
  bool v11; // nf
  AnimationId v12; // r2
  CAnimBlendAssociation *v13; // r0
  CAnimBlendAssociation *v14; // r0
  CAnimBlendAssociation *v15; // r0
  int m_nLastCommand; // r1
  CWeaponInfo *v17; // r1
  float *p_m_animLoopStart; // r3
  CWeaponInfo *v19; // r0
  bool v20; // nf
  AnimationId v21; // r2
  CAnimBlendAssociation *v22; // r0
  CAnimBlendAssociation *m_pDuckAnim; // r0

  if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 )
    TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
  else
    TaskDuck = 0;
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
  {
    if ( this->m_nNextCommand == 7
      && m_pAnim->m_fBlendDelta > -8.0
      && m_pAnim->m_fBlendAmount > 0.0
      && this->m_nLastCommand <= 3 )
    {
      m_pAnim->m_fBlendDelta = -8.0;
      m_pAnim = this->m_pAnim;
    }
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim = 0;
  }
  m_nNextCommand = this->m_nNextCommand;
  p_m_nPedFlags = &pPed->m_nPedFlags;
  switch ( m_nNextCommand )
  {
    case 0:
    case 6:
    case 7:
      CTaskSimpleUseGun::RemoveStanceAnims(this, pPed, v2);
      this->m_bIsFinished = 1;
      goto LABEL_58;
    case 1:
    case 2:
    case 3:
      if ( m_nNextCommand == 1 )
      {
        if ( (this->m_vecMoveCommand.x != 0.0 || this->m_vecMoveCommand.y != 0.0)
          && (this->m_pWeaponInfo->m_nFlags & 0x20) == 0
          || TaskDuck
          && (TaskDuck->m_vecMoveCommand.x != 0.0
           || TaskDuck->m_vecMoveCommand.y != 0.0
           || (m_pDuckAnim = TaskDuck->m_pDuckAnim) == 0
           || m_pDuckAnim->m_fBlendAmount < 1.0
           || TaskDuck->m_bIsAborting
           || TaskDuck->m_nShotWhizzingCounter >= 1) )
        {
          if ( (this->m_nLastCommand & 0xFE) == 2 )
            this->m_nLastCommand = 1;
          return;
        }
      }
      else
      {
        if ( TaskDuck )
        {
          if ( TaskDuck->m_vecMoveCommand.x != 0.0 )
            return;
          v9 = TaskDuck->m_pDuckAnim;
          if ( !v9 || v9->m_fBlendAmount < 1.0 || TaskDuck->m_bIsAborting || TaskDuck->m_nShotWhizzingCounter > 0 )
            return;
        }
        if ( m_nNextCommand == 3 )
          this->m_nBurstShots = this->m_nBurstLength;
      }
      m_pWeaponInfo = this->m_pWeaponInfo;
      v11 = (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0;
      if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 )
        v11 = (m_pWeaponInfo->m_nFlags & 0x2000) != 0;
      if ( v11 )
        v12 = ANIM_WEAPON_ATTACK_CROUCH;
      else
        v12 = ANIM_WEAPON_ATTACK;
      v15 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, m_pWeaponInfo->m_animGroup, v12, 8.0);
      m_nLastCommand = (unsigned __int8)this->m_nLastCommand;
      this->m_pAnim = v15;
      if ( m_nLastCommand == 4 )
      {
        v17 = this->m_pWeaponInfo;
        if ( (v17->m_nFlags & 0x4000) != 0 )
        {
          p_m_animLoopStart = &v17->m_animLoopStart;
          if ( (*(_DWORD *)p_m_nPedFlags & 0x4000000) != 0 )
            p_m_animLoopStart = &v17->m_anim2LoopStart;
          CAnimBlendAssociation::SetCurrentTime(v15, *p_m_animLoopStart);
          this->m_pAnim->m_bitsFlag &= ~1u;
          v15 = this->m_pAnim;
        }
      }
LABEL_57:
      CAnimBlendAssociation::SetFinishCallback(v15, CTaskSimpleUseGun::FinishGunAnimCB, this);
      goto LABEL_58;
    case 4:
      if ( TaskDuck )
      {
        if ( TaskDuck->m_vecMoveCommand.x != 0.0 )
          return;
        v13 = TaskDuck->m_pDuckAnim;
        if ( !v13 || v13->m_fBlendAmount < 1.0 || TaskDuck->m_bIsAborting || TaskDuck->m_nShotWhizzingCounter > 0 )
          return;
      }
      if ( this->m_nLastCommand == 4 )
      {
        if ( this->m_nBurstShots < 1 )
        {
          this->m_nNextCommand = 0;
          goto LABEL_58;
        }
      }
      else
      {
        this->m_nBurstShots = ((this->m_pWeaponInfo->m_nFlags & 0x800u) >> 11) + 1;
      }
      v19 = this->m_pWeaponInfo;
      v20 = (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0;
      if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 )
        v20 = (v19->m_nFlags & 0x2000) != 0;
      if ( v20 )
        v21 = ANIM_WEAPON_RELOAD_CROUCH;
      else
        v21 = ANIM_WEAPON_RELOAD;
      v22 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, v19->m_animGroup, v21, 8.0);
      this->m_pAnim = v22;
      CAnimBlendAssociation::Start(v22, 0.0);
      CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CTaskSimpleUseGun::FinishGunAnimCB, this);
      --this->m_nBurstShots;
LABEL_58:
      this->m_nLastCommand = this->m_nNextCommand;
      this->m_nNextCommand = 0;
      return;
    case 5:
      if ( TaskDuck )
      {
        if ( TaskDuck->m_vecMoveCommand.x != 0.0 )
          return;
        if ( TaskDuck->m_vecMoveCommand.y != 0.0 )
          return;
        v14 = TaskDuck->m_pDuckAnim;
        if ( !v14 || v14->m_fBlendAmount < 1.0 || TaskDuck->m_bIsAborting || TaskDuck->m_nShotWhizzingCounter > 0 )
          return;
      }
      v15 = CAnimManager::BlendAnimation(
              (RpClump_0 *)pPed->m_pRwObject,
              CTaskSimpleFight::m_aComboData[12].nAnimGroup,
              (AnimationId)((*(_DWORD *)p_m_nPedFlags >> 26) & 1 | 0xD6),
              8.0);
      this->m_pAnim = v15;
      goto LABEL_57;
    default:
      goto LABEL_58;
  }
}
// 4DCD96: variable 'v2' is possibly undefined

//----- (004DCFC8) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::AimGun(CTaskSimpleUseGun *this, CPed *pPed)
{
  float v4; // s16
  int32 v5; // r10
  uint32 *p_m_flags; // r6
  int v7; // r0
  CEntity *m_pTargetEntity; // r3
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v11; // d16
  int v12; // r0
  CPlayerPedData *m_pPlayerData; // r0
  __int64 v14; // d16
  CPedIK *p_m_ik; // r6
  CAnimBlendAssociation *m_pAnim; // r0
  const CVector *p_posn; // r1
  CPlayerPedData *v18; // r0
  bool v19; // zf
  CMatrix *v20; // r0
  CSimpleTransform *p_m_transform; // r1
  bool v22; // zf
  float m_fCurrentHeading; // r1
  float m_fBlendAmount; // s0
  float m_fLookPitch; // r2
  bool v27; // zf
  int32 m_nTargetBone; // r9
  CVector vecTarget; // [sp+20h] [bp-48h] BYREF
  RwV3d_0 posn; // [sp+30h] [bp-38h] BYREF
  CVector v31; // 0:r2.8,8:^0.4

  if ( this->m_bAimImmediate )
  {
    v4 = 1.0;
    v5 = 0;
    this->m_bAimImmediate = 0;
  }
  else
  {
    v5 = ARM_IK_AIM_BLEND_TIME;
    v4 = ARM_IK_AIM_RATE;
  }
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) == 0 && (this->m_pWeaponInfo->m_nFlags & 2) != 0 )
  {
    p_m_flags = &pPed->m_ik.m_flags;
    v7 = 4;
  }
  else
  {
    p_m_flags = &pPed->m_ik.m_flags;
    if ( (pPed->m_ik.m_flags & 0x10) == 0 )
      CTaskSimpleUseGun::AbortIK(this, pPed);
    v7 = 16;
  }
  *p_m_flags = *p_m_flags & 0xFFFFFFEB | v7;
  m_pTargetEntity = this->m_pTargetEntity;
  if ( m_pTargetEntity )
  {
    m_pMat = m_pTargetEntity->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pTargetEntity->m_transform;
    v11 = *(_QWORD *)&p_tx->m_translate.x;
    posn.z = p_tx->m_translate.z;
    *(_QWORD *)&posn.x = v11;
    v12 = *(_BYTE *)&m_pTargetEntity->m_info & 7;
    if ( v12 == 2 )
    {
      if ( m_pTargetEntity == CVehicle::m_pTappedGasTankVehicle )
      {
        CVehicle::GetGasTankPosition(&vecTarget, (CVehicle *)m_pTargetEntity);
        posn = vecTarget.RwV3d_0;
      }
    }
    else if ( v12 == 3 )
    {
      m_pPlayerData = pPed->m_pPlayerData;
      if ( m_pPlayerData )
      {
        v14 = *(_QWORD *)&m_pPlayerData->m_vecTargetBoneOffset.x;
        posn.z = m_pPlayerData->m_vecTargetBoneOffset.z;
        *(_QWORD *)&posn.x = v14;
        CPed::GetTransformedBonePosition((CPed *)m_pTargetEntity, &posn, m_pPlayerData->m_nTargetBone, 0);
      }
      else
      {
        CPed::GetBonePosition((CPed *)m_pTargetEntity, &posn, 3u, 0);
      }
    }
    if ( !CPed::IsPlayer(pPed) )
      CPed::Say(pPed, 0xDCu, 0, 1.0, 0, 0, 0);
    p_m_ik = &pPed->m_ik;
    if ( (pPed->m_ik.m_flags & 4) == 0 )
    {
      m_pAnim = this->m_pAnim;
      p_posn = (const CVector *)&posn;
      goto LABEL_55;
    }
    v27 = this->m_armIkInUse == 0;
    if ( this->m_armIkInUse )
      v27 = this->m_lookIkInUse == 0;
    if ( v27 )
    {
      if ( (*(_BYTE *)&this->m_pTargetEntity->m_info & 7) == 3 )
      {
        if ( CPed::IsPlayer(pPed) )
          m_nTargetBone = pPed->m_pPlayerData->m_nTargetBone;
        else
          m_nTargetBone = 3;
      }
      else
      {
        m_nTargetBone = -1;
      }
      if ( !this->m_lookIkInUse && this->m_pAnim->m_fBlendAmount > 0.98 )
      {
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "TaskUseGun",
          pPed,
          this->m_pTargetEntity,
          (int32)&CWorld::m_aTempColPts[2].m_vecNormal.y + 3,
          m_nTargetBone,
          0,
          1,
          0.25,
          250,
          3,
          0);
        this->m_lookIkInUse = 1;
      }
      if ( !this->m_armIkInUse )
      {
        IKChainManager_c::PointArm(
          &g_ikChainMan,
          "CTaskSimpleUseGun",
          0,
          pPed,
          this->m_pTargetEntity,
          m_nTargetBone,
          0,
          v4,
          v5,
          100.0);
        if ( (this->m_pWeaponInfo->m_nFlags & 0x800) != 0 && (*((_DWORD *)&pPed->m_nPedFlags + 2) & 0x20000) == 0 )
          IKChainManager_c::PointArm(
            &g_ikChainMan,
            "CTaskSimpleUseGun",
            1,
            pPed,
            this->m_pTargetEntity,
            m_nTargetBone,
            0,
            v4,
            v5,
            100.0);
        this->m_armIkInUse = 1;
      }
    }
    CPedIK::RotateTorsoForArm(&pPed->m_ik, (const CVector *)&posn);
  }
  else
  {
    p_m_ik = &pPed->m_ik;
    if ( (v7 & 4) != 0 )
    {
      v18 = pPed->m_pPlayerData;
      if ( !v18 || (*((_BYTE *)v18 + 52) & 8) == 0 || this->m_vecCoords.x != 0.0 )
        goto LABEL_38;
      v19 = TheCamera.Cams[0].Mode == 65;
      if ( TheCamera.Cams[0].Mode != 65 )
        v19 = TheCamera.Cams[0].Mode == 53;
      if ( v19 )
      {
        v20 = pPed->m_pMat;
        p_m_transform = (CSimpleTransform *)&v20->tx;
        if ( !v20 )
          p_m_transform = &pPed->m_transform;
        v31.x = p_m_transform->m_translate.x + 0.0;
        v31.y = p_m_transform->m_translate.y + 0.0;
        v31.z = p_m_transform->m_translate.z + 0.7;
        CCamera::Find3rdPersonCamTargetVector(&TheCamera, 20.0, v31, (CVector *)&posn, &vecTarget);
        if ( this->m_pAnim->m_fBlendAmount > 0.98 )
        {
          IKChainManager_c::LookAt(
            &g_ikChainMan,
            "TaskUseGun",
            pPed,
            0,
            (int32)&CWorld::m_aTempColPts[2].m_vecNormal.y + 3,
            -1,
            &vecTarget,
            1,
            0.25,
            250,
            3,
            0);
          this->m_lookIkInUse = 1;
        }
        IKChainManager_c::PointArm(&g_ikChainMan, "CTaskSimpleUseGun", 0, pPed, 0, -1, &vecTarget, v4, v5, 100.0);
        if ( (this->m_pWeaponInfo->m_nFlags & 0x800) != 0 && (*((_DWORD *)&pPed->m_nPedFlags + 2) & 0x20000) == 0 )
          IKChainManager_c::PointArm(&g_ikChainMan, "CTaskSimpleUseGun", 1, pPed, 0, -1, &vecTarget, v4, v5, 100.0);
        this->m_armIkInUse = 1;
        CPedIK::RotateTorsoForArm(&pPed->m_ik, &vecTarget);
      }
      else
      {
LABEL_38:
        v22 = this->m_armIkInUse == 0;
        if ( this->m_armIkInUse )
          v22 = this->m_lookIkInUse == 0;
        if ( v22 )
        {
          if ( this->m_vecCoords.x == 0.0 )
          {
            posn.z = 0.0;
            *(_QWORD *)&posn.x = unk_61E310;
            if ( this->m_pAnim->m_fBlendAmount > 0.98 && !this->m_lookIkInUse )
            {
              IKChainManager_c::LookAt(
                &g_ikChainMan,
                "TaskUseGun",
                pPed,
                pPed,
                (int32)&CWorld::m_aTempColPts[2].m_vecNormal.y + 3,
                22,
                &posn,
                1,
                0.25,
                250,
                3,
                0);
              this->m_lookIkInUse = 1;
            }
            IKChainManager_c::PointArm(&g_ikChainMan, "CTaskSimpleUseGun", 0, pPed, pPed, 22, &posn, v4, v5, 100.0);
            if ( (this->m_pWeaponInfo->m_nFlags & 0x800) != 0 && (*((_DWORD *)&pPed->m_nPedFlags + 2) & 0x20000) == 0 )
              IKChainManager_c::PointArm(&g_ikChainMan, "CTaskSimpleUseGun", 1, pPed, pPed, 22, &posn, v4, v5, 100.0);
          }
          else
          {
            if ( this->m_pAnim->m_fBlendAmount > 0.98 )
              IKChainManager_c::LookAt(
                &g_ikChainMan,
                "TaskUseGun",
                pPed,
                0,
                (int32)&CWorld::m_aTempColPts[2].m_vecNormal.y + 3,
                -1,
                &this->m_vecCoords,
                1,
                0.25,
                250,
                3,
                0);
            IKChainManager_c::PointArm(
              &g_ikChainMan,
              "CTaskSimpleUseGun",
              0,
              pPed,
              0,
              -1,
              &this->m_vecCoords,
              v4,
              v5,
              100.0);
            if ( (this->m_pWeaponInfo->m_nFlags & 0x800) != 0 && (*((_DWORD *)&pPed->m_nPedFlags + 2) & 0x20000) == 0 )
              IKChainManager_c::PointArm(
                &g_ikChainMan,
                "CTaskSimpleUseGun",
                1,
                pPed,
                0,
                -1,
                &this->m_vecCoords,
                v4,
                v5,
                100.0);
          }
          this->m_armIkInUse = 1;
        }
      }
    }
    else
    {
      if ( this->m_vecCoords.x != 0.0 )
      {
        m_pAnim = this->m_pAnim;
        p_posn = &this->m_vecCoords;
LABEL_55:
        CPedIK::PointGunAtPosition(p_m_ik, p_posn, m_pAnim->m_fBlendAmount);
        goto LABEL_83;
      }
      if ( CPed::IsPlayer(pPed) )
      {
        m_fCurrentHeading = pPed->m_fCurrentHeading;
        m_fBlendAmount = this->m_pAnim->m_fBlendAmount;
        m_fLookPitch = pPed->m_pPlayerData->m_fLookPitch;
      }
      else
      {
        m_fLookPitch = 0.0;
        m_fCurrentHeading = pPed->m_fLookHeading;
        m_fBlendAmount = this->m_pAnim->m_fBlendAmount;
      }
      CPedIK::PointGunInDirection(&pPed->m_ik, m_fCurrentHeading, m_fLookPitch, 0, m_fBlendAmount);
    }
  }
LABEL_83:
  if ( (this->m_pWeaponInfo->m_nFlags & 0x800) != 0 && (*((_DWORD *)&pPed->m_nPedFlags + 2) & 0x20000) != 0 )
  {
    if ( IKChainManager_c::IsArmPointing(&g_ikChainMan, 1, pPed) )
      IKChainManager_c::AbortPointArm(&g_ikChainMan, 1, pPed, 250);
  }
}

//----- (004DD658) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::SetMoveAnim(CTaskSimpleUseGun *this, CPed *pPed)
{
  float32x2_t v2; // d1
  float32x2_t v3; // d3
  CAnimBlendAssociation *Association; // r5
  CAnimBlendAssociation *v7; // r9
  CAnimBlendAssociation *v8; // r11
  CAnimBlendAssociation *v9; // r8
  CAnimBlendAssociation *v10; // r10
  float v11; // s16
  float v12; // s0
  float x; // s0
  float y; // s2
  float v15; // s6
  CTaskSimpleDuck *TaskDuck; // r0
  int v17; // r0
  int32 m_nPedType; // r0
  AssocGroupId m_motionAnimGroup; // r1
  AnimationId v20; // r2
  RpClump_0 *m_pRwObject; // r0
  float v22; // s0
  RpClump_0 *v23; // r0
  AnimationId v24; // r2
  int v25; // r3
  float m_fBlendAmount; // s6
  float v27; // s4
  CAnimBlendAssociation *v28; // r0
  float v29; // s2
  float v30; // s4
  bool v31; // nf
  float v32; // s6
  CAnimBlendAssociation *v33; // r0
  float v34; // s20
  float v35; // s18
  float v36; // s0
  float v37; // s0
  CAnimBlendAssociation *m_pAnim; // r0

  Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x31u);
  v7 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x32u);
  v8 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x33u);
  v9 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x34u);
  v10 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0x35u);
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 )
  {
    TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
    if ( TaskDuck && (unsigned __int8)(this->m_nLastCommand - 2) <= 2u )
      CTaskSimpleDuck::ForceStopMove(TaskDuck);
    goto LABEL_44;
  }
  v11 = 0.0;
  if ( this->m_bMoveControl )
  {
    if ( this->m_nLastCommand != 2 || (v12 = 0.0, (this->m_pWeaponInfo->m_nFlags & 0x20) != 0) )
    {
      x = this->m_vecMoveCommand.x;
      y = this->m_vecMoveCommand.y;
      v15 = x * x;
      v12 = fabsf(x) + fabsf(y);
      v11 = sqrtf(v15 + (float)(y * y));
    }
  }
  else
  {
    v12 = 0.0;
  }
  v17 = this->m_pWeaponInfo->m_nFlags & 2;
  if ( v12 < 0.1 )
  {
    if ( !v17 )
    {
      m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
      m_motionAnimGroup = ANIM_STD_PED;
      v20 = ANIM_STD_WEAPON_STANCE;
      goto LABEL_20;
    }
    CPed::SetMoveState(pPed, PEDMOVE_STILL);
    m_nPedType = pPed->m_nPedType;
    if ( m_nPedType < 7 )
    {
      if ( m_nPedType != 6 )
        goto LABEL_15;
    }
    else if ( m_nPedType >= 16 )
    {
LABEL_15:
      m_motionAnimGroup = pPed->m_motionAnimGroup;
      v20 = ANIM_STD_IDLE;
      m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
LABEL_20:
      v25 = 1090519040;
LABEL_26:
      v28 = CAnimManager::BlendAnimation(m_pRwObject, m_motionAnimGroup, v20, *(float *)&v25);
      if ( v7 )
        v7->m_bitsFlag &= ~1u;
      if ( v8 )
        v8->m_bitsFlag &= ~1u;
      if ( v9 )
        v9->m_bitsFlag &= ~1u;
      if ( v10 )
        v10->m_bitsFlag &= ~1u;
      if ( v28 && v28->m_fBlendAmount > 0.95 )
      {
        if ( v7 )
          CAnimBlendAssociation::SetCurrentTime(v7, 0.0);
        if ( v8 )
          CAnimBlendAssociation::SetCurrentTime(v8, 0.0);
        if ( v9 )
          CAnimBlendAssociation::SetCurrentTime(v9, 0.0);
        if ( v10 )
          CAnimBlendAssociation::SetCurrentTime(v10, 0.0);
      }
LABEL_44:
      this->m_vecMoveCommand.x = 0.0;
      this->m_vecMoveCommand.y = 0.0;
LABEL_45:
      this->m_bMoveControl = 0;
      return;
    }
    m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
    m_motionAnimGroup = ANIM_STD_PED;
    v20 = ANIM_STD_GANG_WEAPON_IDLE;
    v25 = 1082130432;
    goto LABEL_26;
  }
  if ( !v17 )
  {
    if ( Association )
    {
      v2.n64_u32[0] = LODWORD(Association->m_fBlendDelta);
      if ( v2.n64_f32[0] >= 0.0 )
      {
        Association->m_fBlendDelta = 0.0;
        v27 = CTimer::ms_fTimeStep;
        v3.n64_f32[0] = Association->m_fBlendAmount + (float)((float)(CTimer::ms_fTimeStep * -8.0) / 50.0);
        v2.n64_u32[0] = 0;
        LODWORD(m_fBlendAmount) = vmax_f32(v3, v2).n64_u32[0];
        Association->m_fBlendAmount = m_fBlendAmount;
      }
      else
      {
        m_fBlendAmount = Association->m_fBlendAmount;
        v27 = CTimer::ms_fTimeStep;
      }
      v30 = m_fBlendAmount + (float)((float)(v2.n64_f32[0] * v27) / 50.0);
      v31 = v30 < 1.0;
      if ( v30 <= 1.0 )
        v31 = v30 < 0.0;
      if ( v31 )
      {
        v32 = 0.0;
      }
      else
      {
        v32 = 1.0;
        if ( v30 <= 1.0 )
          v32 = v30;
      }
      v29 = 1.0 - v32;
    }
    else
    {
      v29 = 1.0;
    }
    v34 = (float)(v29 * this->m_vecMoveCommand.x) / v12;
    v35 = (float)(v29 * this->m_vecMoveCommand.y) / v12;
    if ( v34 <= 0.0 )
    {
      if ( v34 >= 0.0 )
        goto LABEL_75;
      if ( v10 )
      {
        v10->m_fBlendAmount = 0.0;
        v10->m_fBlendDelta = 0.0;
      }
      if ( !v8 )
        v8 = CAnimManager::AddAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_WEAPON_LEFT);
      v34 = -v34;
    }
    else
    {
      if ( v8 )
      {
        v8->m_fBlendAmount = 0.0;
        v8->m_fBlendDelta = 0.0;
      }
      if ( v10 )
        v8 = v10;
      else
        v8 = CAnimManager::AddAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_WEAPON_RIGHT);
    }
    v8->m_fBlendDelta = 0.0;
    v8->m_fBlendAmount = v34;
    v36 = v11 * this->m_pWeaponInfo->m_fMoveSpeed;
    v8->m_bitsFlag |= 1u;
    v8->m_fSpeed = v36;
LABEL_75:
    if ( v35 >= 0.0 )
    {
      if ( v35 <= 0.0 )
      {
LABEL_88:
        if ( this->m_nLastCommand == 1 )
        {
          m_pAnim = this->m_pAnim;
          if ( m_pAnim )
          {
            if ( m_pAnim->m_fBlendAmount > 0.0
              && m_pAnim->m_fBlendDelta >= 0.0
              && (this->m_pWeaponInfo->m_nFlags & 0x10) == 0 )
            {
              m_pAnim->m_fBlendDelta = -4.0;
            }
          }
        }
        goto LABEL_45;
      }
      if ( v7 )
      {
        v7->m_fBlendAmount = 0.0;
        v7->m_fBlendDelta = 0.0;
      }
      if ( v9 )
        v7 = v9;
      else
        v7 = CAnimManager::AddAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_WEAPON_BACK);
    }
    else
    {
      if ( v9 )
      {
        v9->m_fBlendAmount = 0.0;
        v9->m_fBlendDelta = 0.0;
      }
      if ( !v7 )
        v7 = CAnimManager::AddAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_WEAPON_FWD);
      v35 = -v35;
    }
    v7->m_fBlendDelta = 0.0;
    v7->m_fBlendAmount = v35;
    v37 = v11 * this->m_pWeaponInfo->m_fMoveSpeed;
    v7->m_bitsFlag |= 1u;
    v7->m_fSpeed = v37;
    goto LABEL_88;
  }
  v22 = this->m_vecMoveCommand.x;
  if ( v22 <= 0.75 )
  {
    if ( v22 >= -0.75 )
    {
      v23 = (RpClump_0 *)pPed->m_pRwObject;
      if ( this->m_vecMoveCommand.y > 0.0 )
        v24 = ANIM_STD_WEAPON_BACK;
      else
        v24 = ANIM_STD_WEAPON_FWD;
    }
    else
    {
      v23 = (RpClump_0 *)pPed->m_pRwObject;
      v24 = ANIM_STD_WEAPON_LEFT;
    }
  }
  else
  {
    v23 = (RpClump_0 *)pPed->m_pRwObject;
    v24 = ANIM_STD_WEAPON_RIGHT;
  }
  v33 = CAnimManager::BlendAnimation(v23, ANIM_STD_PED, v24, 8.0);
  v33->m_bitsFlag |= 1u;
  sub_1A1104(pPed, PEDMOVE_NONE);
}
// 4DD888: variable 'v3' is possibly undefined
// 4DD888: variable 'v2' is possibly undefined

//----- (004DDA6C) --------------------------------------------------------
bool __fastcall CTaskSimpleUseGun::ControlGun(
        CTaskSimpleUseGun *this,
        CPed *pPed,
        CEntity *pTargetEntity,
        int8 nCommand)
{
  int v6; // r9
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r4
  bool result; // r0

  v6 = nCommand;
  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  *((_BYTE *)p_m_pTargetEntity - 19) = 1;
  if ( m_pTargetEntity != pTargetEntity )
  {
    if ( m_pTargetEntity )
      CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
    *p_m_pTargetEntity = pTargetEntity;
    if ( pTargetEntity )
      CEntity::RegisterReference(pTargetEntity, p_m_pTargetEntity);
    CTaskSimpleUseGun::AbortIK(this, pPed);
    *(_WORD *)&this->m_armIkInUse = 0;
  }
  result = 1;
  if ( this->m_nNextCommand < v6 )
    this->m_nNextCommand = v6;
  return result;
}

//----- (004DDAC8) --------------------------------------------------------
bool __fastcall CTaskSimpleUseGun::PlayerPassiveControlGun(CTaskSimpleUseGun *this)
{
  int m_nLastCommand; // r1
  bool v2; // cc

  this->m_bIsInControl = 1;
  m_nLastCommand = this->m_nLastCommand;
  v2 = m_nLastCommand <= 1;
  if ( m_nLastCommand <= 1 )
    v2 = this->m_nNextCommand <= 1;
  if ( !v2 )
    return 0;
  this->m_nNextCommand = 6;
  return 1;
}

//----- (004DDAE8) --------------------------------------------------------
bool __fastcall CTaskSimpleUseGun::ControlGunMove(CTaskSimpleUseGun *this, CVector2D *pMoveVec)
{
  float y; // s4
  float v3; // s2
  float v4; // s0
  float x; // s4
  float v6; // s2
  float v7; // s6

  y = this->m_vecMoveCommand.y;
  v3 = pMoveVec->y;
  v4 = CTimer::ms_fTimeStep * 0.07;
  if ( (float)(v3 - y) <= (float)(CTimer::ms_fTimeStep * 0.07) )
  {
    if ( (float)(v3 - y) < (float)-v4 )
      v3 = y - v4;
  }
  else
  {
    v3 = v4 + y;
  }
  this->m_vecMoveCommand.y = v3;
  x = this->m_vecMoveCommand.x;
  v6 = pMoveVec->x;
  v7 = pMoveVec->x - x;
  if ( v7 <= v4 )
  {
    if ( v7 < (float)-v4 )
      v6 = x - v4;
  }
  else
  {
    v6 = v4 + x;
  }
  this->m_bMoveControl = 1;
  this->m_vecMoveCommand.x = v6;
  return 1;
}

//----- (004DDB70) --------------------------------------------------------
bool __fastcall CTaskSimpleUseGun::SetPedPosition(CTaskSimpleUseGun *this, CPed *pPed)
{
  CWeaponInfo *m_pWeaponInfo; // r4
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  uint8 m_nFireGunThisFrame; // r0

  m_pWeaponInfo = this->m_pWeaponInfo;
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  if ( m_pWeaponInfo == CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill) )
  {
    m_nFireGunThisFrame = this->m_nFireGunThisFrame;
    if ( (m_nFireGunThisFrame & 1) != 0 )
    {
      CTaskSimpleUseGun::FireGun(this, pPed, 0);
      m_nFireGunThisFrame = this->m_nFireGunThisFrame;
    }
    if ( (m_nFireGunThisFrame & 2) != 0 )
      CTaskSimpleUseGun::FireGun(this, pPed, 1);
    this->m_nFireGunThisFrame = 0;
  }
  return 0;
}

//----- (004DDBD8) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::FireGun(CTaskSimpleUseGun *this, CPed *pPed, bool bLHand)
{
  CWeaponInfo *m_pWeaponInfo; // r0
  __int64 v7; // d16
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  uint32 v10; // r0
  uint32 v11; // r0
  CPed *v12; // r1
  int32 v13; // r2
  int IsFacingTarget; // r0
  uint32 m_flags; // r1
  RwV3d_0 v16; // [sp+10h] [bp-30h] BYREF
  RwV3d_0 posn; // [sp+20h] [bp-20h] BYREF

  memset(&posn, 0, sizeof(posn));
  m_pWeaponInfo = this->m_pWeaponInfo;
  v7 = *(_QWORD *)&m_pWeaponInfo->m_vecFireOffset.x;
  v16.z = m_pWeaponInfo->m_vecFireOffset.z;
  *(_QWORD *)&v16.x = v7;
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 9) & 4) != 0 )
  {
    if ( bLHand )
    {
      CPed::GetBonePosition(pPed, &posn, 0x22u, 0);
      posn.z = posn.z + (float)(v16.z + 0.15);
      CPed::GetTransformedBonePosition(pPed, &v16, 0x22u, 0);
      if ( (pPed->m_ik.m_flags & 4) == 0 )
        goto LABEL_15;
      v12 = pPed;
      v13 = 2;
    }
    else
    {
      CPed::GetBonePosition(pPed, &posn, 0x18u, 0);
      posn.z = posn.z + (float)(v16.z + 0.15);
      CPed::GetTransformedBonePosition(pPed, &v16, 0x18u, 0);
      if ( (pPed->m_ik.m_flags & 4) == 0 )
        goto LABEL_15;
      v12 = pPed;
      v13 = 1;
    }
    IsFacingTarget = IKChainManager_c::IsFacingTarget(&g_ikChainMan, v12, v13);
    m_flags = pPed->m_ik.m_flags;
    if ( IsFacingTarget )
      v11 = m_flags | 1;
    else
      v11 = m_flags & 0xFFFFFFFE;
    goto LABEL_14;
  }
  m_pMat = pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  posn.z = p_tx->m_translate.z;
  *(_QWORD *)&v16.x = *(_QWORD *)&p_tx->m_translate.x;
  posn.z = posn.z + 0.7;
  *(_QWORD *)&posn.x = *(_QWORD *)&v16.x;
  v16.z = posn.z;
  v10 = pPed->m_ik.m_flags;
  if ( (v10 & 4) != 0 )
  {
    v11 = v10 | 1;
LABEL_14:
    pPed->m_ik.m_flags = v11;
  }
LABEL_15:
  if ( this->m_vecCoords.x == 0.0 )
    CWeapon::Fire(
      &pPed->m_WeaponSlots[pPed->m_nCurrentWeapon],
      pPed,
      (CVector *)&posn,
      (CVector *)&v16,
      this->m_pTargetEntity,
      0,
      0);
  else
    CWeapon::Fire(
      &pPed->m_WeaponSlots[pPed->m_nCurrentWeapon],
      pPed,
      (CVector *)&posn,
      (CVector *)&v16,
      this->m_pTargetEntity,
      &this->m_vecCoords,
      0);
  if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eState == WEAPONSTATE_FIRING )
    CPed::DoGunFlash(pPed, 250, bLHand);
}

//----- (004DDD70) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::StartCountDown(CTaskSimpleUseGun *this, uint8 nNumIdleFrames, bool bMax)
{
  if ( bMax && (unsigned int)this->m_nCountDownFrames < nNumIdleFrames )
    nNumIdleFrames = this->m_nCountDownFrames;
  this->m_bFiredGun = 0;
  this->m_nCountDownFrames = nNumIdleFrames;
}

//----- (004DDD88) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::ClearAnim(CTaskSimpleUseGun *this, CPed *pPed)
{
  CAnimBlendAssociation *m_pAnim; // r0
  int m_nLastCommand; // r1

  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
  {
    if ( m_pAnim->m_fBlendAmount <= 0.0
      || m_pAnim->m_fBlendDelta < 0.0
      || (m_pAnim->m_fBlendDelta = -8.0, (m_pAnim = this->m_pAnim) != 0) )
    {
      CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    }
  }
  m_nLastCommand = this->m_nLastCommand;
  this->m_pAnim = 0;
  if ( m_nLastCommand <= 5 )
    this->m_nLastCommand = 0;
  CTaskSimpleUseGun::AbortIK(this, pPed);
}

//----- (004DDDE4) --------------------------------------------------------
bool __fastcall CTaskSimpleUseGun::RequirePistolWhip(CPed *pPed, CEntity *pTargetEnt)
{
  CEntity *v3; // r6
  CPedIntelligence *m_pPedIntelligence; // r8
  int v5; // r4
  CTaskSimpleUseGun *TaskUseGun; // r0
  int i; // r4
  bool v8; // zf
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r1
  float z; // s2
  CTask *SimplestActiveTask; // r0
  CMatrix *v13; // r1
  CSimpleTransform *p_tx; // r2
  float *p_x; // r3
  float v16; // s0
  float v17; // s2
  float v18; // s4
  float v19; // s6
  RwV3d_0 posn; // [sp+4h] [bp-34h] BYREF

  v3 = pTargetEnt;
  m_pPedIntelligence = pPed->m_pPedIntelligence;
  v5 = 0;
  if ( pTargetEnt )
  {
    if ( (*(_BYTE *)&pTargetEnt->m_info & 7) == 3 )
      v5 = 15;
    else
      v3 = 0;
  }
  else
  {
    v3 = 0;
  }
  TaskUseGun = CPedIntelligence::GetTaskUseGun(m_pPedIntelligence);
  if ( !TaskUseGun || TaskUseGun->m_nLastCommand != 5 )
  {
    for ( i = v5 + 76; ; ++i )
    {
      v8 = v3 == 0;
      if ( !v3 )
      {
        v3 = (CEntity *)*((_DWORD *)&m_pPedIntelligence->m_pPed + i);
        v8 = v3 == 0;
      }
      if ( v8 )
        goto LABEL_28;
      CPed::GetBonePosition((CPed *)v3, &posn, 5u, 0);
      if ( !CPed::IsAlive((const CPed *)v3) )
        goto LABEL_28;
      m_pMat = pPed->m_pMat;
      p_m_transform = &pPed->m_transform;
      if ( m_pMat )
        p_m_transform = (CSimpleTransform *)&m_pMat->tx;
      z = p_m_transform->m_translate.z;
      if ( posn.z <= z || posn.z >= (float)(z + 1.5) )
        goto LABEL_28;
      if ( (BYTE2(v3[19].m_pRwObject) & 0x10) != 0 )
      {
        SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
        if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 205 )
          goto LABEL_28;
        m_pMat = pPed->m_pMat;
      }
      v13 = v3->m_pMat;
      p_tx = &pPed->m_transform;
      if ( m_pMat )
        p_tx = (CSimpleTransform *)&m_pMat->tx;
      p_x = &v13->tx;
      if ( !v13 )
        p_x = &v3->m_transform.m_translate.x;
      v16 = *p_x - p_tx->m_translate.x;
      v17 = p_x[1] - p_tx->m_translate.y;
      v18 = p_x[2] - p_tx->m_translate.z;
      v19 = (float)((float)(v16 * m_pMat->xy) + (float)(v17 * m_pMat->yy)) + (float)(v18 * m_pMat->zy);
      if ( v19 > 0.0
        && sqrtf((float)(v16 * v16) + (float)(v17 * v17)) < USE_GUN_REQ_PISTOL_WHIP_RANGE
        && (float)(fabsf((float)((float)(v16 * m_pMat->xx) + (float)(v17 * m_pMat->yx)) + (float)(v18 * m_pMat->zx))
                 / v19) < USE_GUN_REQ_PISTOL_WHIP_ANGLE_TAN )
      {
        LOBYTE(v3) = 1;
        return (char)v3;
      }
LABEL_28:
      v3 = 0;
      if ( i - 76 >= 15 )
        return (char)v3;
    }
  }
  LOBYTE(v3) = 0;
  return (char)v3;
}

//----- (004DDFA0) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::FinishGunAnimCB(CAnimBlendAssociation *pAnim, void *pData)
{
  unsigned int v2; // r2
  bool v3; // zf

  if ( *((__int16 *)pData + 27) >= 1 )
  {
    v2 = pAnim->m_animId & 0xFFFFFFFE;
    v3 = v2 == 226;
    if ( v2 == 226 )
      v3 = *((_BYTE *)pData + 16) == 4;
    if ( v3 && *((char *)pData + 15) <= 5 )
      *((_BYTE *)pData + 15) = 4;
  }
  if ( *((CAnimBlendAssociation **)pData + 11) == pAnim )
    *((_DWORD *)pData + 11) = 0;
}

//----- (004DDFD4) --------------------------------------------------------
void __fastcall CTaskSimpleGunControl::CTaskSimpleGunControl(
        CTaskSimpleGunControl *this,
        CEntity *pTargetEntity,
        const CVector *pTargetPos,
        const CVector *pMoveTarget,
        int8 nFiringTask,
        int16 nBurstLength,
        int32 nMaxDuration)
{
  CVector *p_m_vecMoveTarget; // r3
  __int64 v12; // d16

  CTaskSimple::CTaskSimple(this);
  v12 = 0LL;
  this->m_bIsFinished = 0;
  this->m_vecMoveTarget.z = 0.0;
  *(_QWORD *)&this->m_vecTargetPos.x = 0LL;
  *(_QWORD *)&this->m_vecTargetPos.z = 0LL;
  this->m_vecMoveTarget.y = 0.0;
  this->_vptr$CTask = (int (**)(void))&off_669698;
  this->m_pTargetEntity = pTargetEntity;
  if ( pTargetEntity )
    CEntity::RegisterReference(pTargetEntity, &this->m_pTargetEntity);
  if ( pTargetPos )
  {
    v12 = *(_QWORD *)&pTargetPos->x;
    this->m_vecTargetPos.z = pTargetPos->z;
    *(_QWORD *)&this->m_vecTargetPos.x = v12;
  }
  if ( pMoveTarget )
  {
    p_m_vecMoveTarget = &this->m_vecMoveTarget;
    v12 = *(_QWORD *)&pMoveTarget->x;
    this->m_vecMoveTarget.z = pMoveTarget->z;
  }
  if ( pMoveTarget )
    *(_QWORD *)&p_m_vecMoveTarget->x = v12;
  this->m_nBurstLength = nBurstLength;
  this->m_nFiringTask = nFiringTask;
  this->m_fAttackFreq = 1.0;
  this->m_nNextAttackTime = 0;
  this->m_nDuration = nMaxDuration;
  *(_WORD *)&this->m_bFirstTime = 1;
}
// 4DE048: variable 'p_m_vecMoveTarget' is possibly undefined
// 669698: using guessed type void *;

//----- (004DE070) --------------------------------------------------------
void __fastcall CTaskSimpleGunControl::~CTaskSimpleGunControl(CTaskSimpleGunControl *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669698;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  sub_1A01F4(this);
}
// 669698: using guessed type void *off_669698;

//----- (004DE09C) --------------------------------------------------------
void __fastcall CTaskSimpleGunControl::~CTaskSimpleGunControl(CTaskSimpleGunControl *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1
  void *v4; // r0

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669698;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4DE0C4: variable 'v4' is possibly undefined
// 669698: using guessed type void *off_669698;

//----- (004DE0CC) --------------------------------------------------------
bool __fastcall CTaskSimpleGunControl::MakeAbortable(
        CTaskSimpleGunControl *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  bool v7; // r5
  char v8; // r6
  CTask *TaskSecondary; // r0
  CTaskSimpleDuck *TaskDuck; // r0

  if ( iPriority == 1
    && pEvent
    && ((*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 3))(pEvent) < 22
     || (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) >= 1
     && (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) < 7) )
  {
    return 0;
  }
  if ( CPedIntelligence::GetTaskUseGun(pPed->m_pPedIntelligence) )
  {
    v8 = 10;
    if ( iPriority == 1 )
      v8 = 2;
    TaskSecondary = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
    LOBYTE(TaskSecondary[7]._vptr$CTask) = v8;
    HIBYTE(TaskSecondary[1]._vptr$CTask) = 0;
  }
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) == 0 )
    return 1;
  v7 = 1;
  if ( CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1) )
  {
    v7 = 1;
    TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
    CTaskSimpleDuck::ForceStopMove(TaskDuck);
  }
  return v7;
}

//----- (004DE168) --------------------------------------------------------
bool __fastcall CTaskSimpleGunControl::ProcessPed(CTaskSimpleGunControl *this, CPed *pPed)
{
  CTaskSimpleUseGun *TaskUseGun; // r0
  unsigned int m_nCountDownFrames; // r2
  CTask *TaskSecondary; // r0
  CPedIntelligence *m_pPedIntelligence; // r10
  CTask *v8; // r0
  CTask *v9; // r6
  int16 m_nBurstLength; // r0
  __int64 v11; // kr00_8
  __int64 v12; // r2
  CEntity *v13; // r0
  CTask **p_m_pParent; // r6
  CEntity *m_pParent; // t1
  char *v16; // r6
  __int64 v17; // kr08_8
  CTaskSimpleUseGun *v18; // r6
  int32 m_nPedType; // r0
  CAnimBlendAssociation *Association; // r0
  int v21; // r9
  bool v22; // zf
  CWeaponInfo **p_m_pWeaponInfo; // r0
  CWeaponInfo *WeaponInfo; // r8
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  int v27; // r0
  uint32 m_nNextAttackTime; // r1
  int v29; // r5
  int v30; // r0
  bool v31; // r6
  CTask *v32; // r0
  CWeaponInfo *m_pWeaponInfo; // r1
  bool v34; // zf
  uint32 v35; // r0
  _BOOL4 v36; // r1
  int m_nAmmo; // r0
  unsigned int m_nShootRate; // r1
  signed int v39; // r5
  unsigned __int16 v40; // r0
  int16 v41; // r5
  int m_nDuration; // r1
  signed int v43; // r2
  bool v44; // cc
  bool v45; // zf
  CEntity *m_pTargetEntity; // r0
  CEntity *v47; // r10
  int v48; // r10
  int v49; // r9
  uint32 v50; // r5
  unsigned int v51; // s4
  int v52; // r0
  int m_nPedFlags; // r0
  int v54; // r1
  bool v55; // zf
  int v56; // r10
  CTaskSimpleUseGun *v57; // r9
  CEntity *v58; // r0
  CEntity **p_m_pTargetEntity; // r6
  CEntity *v60; // t1
  CEntity *v61; // r5
  CEntity *v62; // r1
  CMatrix *m_pMat; // r2
  CVector *p_tx; // r0
  CMatrix *v65; // r1
  float v66; // s0
  float v67; // s2
  float v68; // s16
  CSimpleTransform *p_m_transform; // r0
  float v70; // s6
  float v71; // s20
  float v72; // s18
  float v73; // s0
  float v74; // s2
  float v75; // s4
  float v76; // s0
  CTaskSimpleDuck *TaskDuck; // r0
  float v78; // s6
  float v79; // s4
  RwReal z; // [sp+4h] [bp-54h]
  RwReal y; // [sp+8h] [bp-50h]
  RwReal x; // [sp+Ch] [bp-4Ch]
  int16 v84; // [sp+10h] [bp-48h]
  bool8 m_bAimImmediate; // [sp+14h] [bp-44h]
  int v86; // [sp+14h] [bp-44h]

  if ( this->m_bIsFinished )
  {
    TaskUseGun = CPedIntelligence::GetTaskUseGun(pPed->m_pPedIntelligence);
    if ( TaskUseGun )
    {
      m_nCountDownFrames = TaskUseGun->m_nCountDownFrames;
      TaskUseGun->m_bFiredGun = 0;
      if ( m_nCountDownFrames >= 4 )
        LOBYTE(m_nCountDownFrames) = 4;
      TaskUseGun->m_nCountDownFrames = m_nCountDownFrames;
    }
    goto LABEL_143;
  }
  CPed::SetMoveState(pPed, PEDMOVE_STILL);
  if ( this->m_nFiringTask <= 5 )
  {
    TaskSecondary = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
    m_pPedIntelligence = pPed->m_pPedIntelligence;
    if ( TaskSecondary )
    {
      v8 = CTaskManager::GetTaskSecondary(&m_pPedIntelligence->m_taskManager, 0);
      if ( (*((int (__fastcall **)(CTask *))v8->_vptr$CTask + 5))(v8) != 1017 )
      {
        v31 = 0;
        v32 = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
        (*((void (__fastcall **)(CTask *, CPed *, int, _DWORD))v32->_vptr$CTask + 7))(v32, pPed, 1, 0);
        return v31;
      }
      if ( this->m_bFirstTime )
      {
        this->m_bFirstTime = 0;
        this->m_nNextAttackTime = 0;
        v9 = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
        m_nBurstLength = this->m_nBurstLength;
        v11 = *(_QWORD *)&this->m_pTargetEntity;
        v12 = *(_QWORD *)&this->m_vecTargetPos.y;
        v9[4]._vptr$CTask = (int (**)(void))HIDWORD(v11);
        *(_QWORD *)&v9[4].m_pParent = v12;
        LOWORD(v9[6].m_pParent) = m_nBurstLength;
        LOBYTE(v9[7]._vptr$CTask) = -1;
        HIWORD(v9[6].m_pParent) = 0;
        LOBYTE(v9[1].m_pParent) = 0;
        CTaskSimpleUseGun::AbortIK((CTaskSimpleUseGun *)v9, pPed);
        m_pParent = (CEntity *)v9[3].m_pParent;
        p_m_pParent = &v9[3].m_pParent;
        v13 = m_pParent;
        *(_WORD *)((char *)p_m_pParent + 29) = 0;
        if ( m_pParent != (CEntity *)v11 )
        {
          if ( v13 )
            CEntity::CleanUpOldReference(v13, (CEntity **)p_m_pParent);
          *p_m_pParent = (CTask *)v11;
          if ( (_DWORD)v11 )
            CEntity::RegisterReference((CEntity *)v11, (CEntity **)p_m_pParent);
        }
      }
    }
    else
    {
      v16 = (char *)CTask::operator new(0x3Cu);
      v17 = *(_QWORD *)&this->m_pTargetEntity;
      x = this->m_vecTargetPos.x;
      y = this->m_vecTargetPos.y;
      z = this->m_vecTargetPos.z;
      v84 = this->m_nBurstLength;
      m_bAimImmediate = this->m_bAimImmediate;
      CTaskSimple::CTaskSimple((CTaskSimple *)v16);
      *((_WORD *)v16 + 4) = 256;
      v16[14] = 0;
      *((_DWORD *)v16 + 5) = 0;
      *((_DWORD *)v16 + 6) = 0;
      *(_DWORD *)(v16 + 10) = 0;
      *(_WORD *)(v16 + 15) = -255;
      *(_DWORD *)v16 = &off_669664;
      *((_DWORD *)v16 + 7) = v17;
      if ( (_DWORD)v17 )
        CEntity::RegisterReference((CEntity *)v17, (CEntity **)v16 + 7);
      *((RwReal *)v16 + 8) = x;
      *((RwReal *)v16 + 9) = y;
      *((RwReal *)v16 + 10) = z;
      *((_DWORD *)v16 + 11) = 0;
      *((_DWORD *)v16 + 12) = 0;
      *((_WORD *)v16 + 26) = v84;
      *(_DWORD *)(v16 + 54) = 16711680;
      v16[58] = 0;
      v16[59] = m_bAimImmediate;
      CTaskManager::SetTaskSecondary(&m_pPedIntelligence->m_taskManager, (CTask *)v16, 0);
      this->m_bFirstTime = 0;
      this->m_nNextAttackTime = 0;
      this->m_bAimImmediate = 0;
    }
  }
  v18 = CPedIntelligence::GetTaskUseGun(pPed->m_pPedIntelligence);
  m_nPedType = pPed->m_nPedType;
  if ( m_nPedType >= 7 )
  {
    if ( m_nPedType >= 16 )
      goto LABEL_29;
    goto LABEL_21;
  }
  v22 = m_nPedType == 6;
  if ( m_nPedType == 6 )
    v22 = pPed->m_eMoveState == PEDMOVE_STILL;
  if ( !v22 || !v18 || pPed->m_eMoveStateAnim != PEDMOVE_STILL )
    goto LABEL_29;
  p_m_pWeaponInfo = &v18->m_pWeaponInfo;
  m_pWeaponInfo = v18->m_pWeaponInfo;
  if ( m_pWeaponInfo && (m_pWeaponInfo->m_nFlags & 2) != 0 )
  {
LABEL_21:
    Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, 0xBEu);
    if ( !Association || Association->m_fBlendAmount < 1.0 && Association->m_fBlendDelta <= 0.0 )
    {
      CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_GANG_WEAPON_IDLE, 4.0);
      if ( !v18 )
      {
LABEL_25:
        v21 = 0;
LABEL_32:
        m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
        WeaponSkill = CPed::GetWeaponSkill(pPed);
        WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
        goto LABEL_33;
      }
      goto LABEL_30;
    }
LABEL_29:
    if ( !v18 )
      goto LABEL_25;
LABEL_30:
    p_m_pWeaponInfo = &v18->m_pWeaponInfo;
  }
  v21 = 1;
  this->m_bBlockedLOS = v18->m_bBlockedLOS;
  WeaponInfo = *p_m_pWeaponInfo;
  if ( !*p_m_pWeaponInfo )
    goto LABEL_32;
LABEL_33:
  if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eState == WEAPONSTATE_RELOADING
    && (WeaponInfo->m_nFlags & 0x1000) != 0 )
  {
    v29 = 4;
  }
  else
  {
    LOBYTE(v27) = this->m_nFiringTask;
    switch ( (char)v27 )
    {
      case 0:
        v29 = 1;
        break;
      case 1:
      case 2:
        m_nNextAttackTime = this->m_nNextAttackTime;
        v29 = 1;
        v27 = (unsigned __int8)v27;
        if ( !m_nNextAttackTime )
          v29 = 3;
        if ( v27 != 1 )
          LOBYTE(v27) = 0;
        v30 = (unsigned __int8)v27 & (m_nNextAttackTime != 0);
        goto LABEL_74;
      case 3:
        v35 = this->m_nNextAttackTime;
        if ( CTimer::m_snTimeInMilliseconds < v35 )
        {
          v36 = v35 == -1;
          v30 = 0;
          if ( (v36 & v21) == 1 )
          {
            v30 = 0;
            v29 = 1;
            if ( v18->m_nLastCommand != 3 )
              this->m_nNextAttackTime = 0;
          }
          else
          {
            v29 = 1;
          }
          goto LABEL_74;
        }
        this->m_nNextAttackTime = -1;
        m_nAmmo = WeaponInfo->m_nAmmo;
        this->m_nBurstLength = m_nAmmo;
        if ( m_nAmmo >= 2 )
        {
          m_nShootRate = pPed->m_nShootRate;
          if ( m_nShootRate <= 0x63 )
          {
            v39 = 4 * m_nShootRate / 0x1E;
            if ( v39 > m_nAmmo )
              v39 = m_nAmmo;
            this->m_nBurstLength = v39;
            v40 = rand();
            if ( v39 <= (int)(float)((float)((float)v40 * 0.000015259) + (float)((float)v40 * 0.000015259)) )
            {
              LOWORD(m_nAmmo) = 1;
            }
            else
            {
              v41 = this->m_nBurstLength;
              LOWORD(m_nAmmo) = rand();
              LOWORD(m_nAmmo) = v41
                              - (int)(float)((float)((float)(unsigned __int16)m_nAmmo * 0.000015259)
                                           + (float)((float)(unsigned __int16)m_nAmmo * 0.000015259));
            }
            this->m_nBurstLength = m_nAmmo;
          }
        }
        if ( v21 == 1 )
          v18->m_nBurstLength = m_nAmmo;
LABEL_72:
        v29 = 3;
        break;
      case 4:
        v34 = v21 == 1;
        if ( v21 == 1 )
          v34 = v18->m_nLastCommand == 4;
        if ( !v34 )
          goto LABEL_72;
        v29 = 6;
        v30 = 0;
        this->m_nFiringTask = 6;
        goto LABEL_74;
      case 5:
        goto LABEL_72;
      case 6:
        v29 = 6;
        v30 = 1;
        goto LABEL_74;
      default:
        v30 = 0;
        v29 = 0;
        goto LABEL_74;
    }
  }
  v30 = 0;
LABEL_74:
  m_nDuration = this->m_nDuration;
  if ( m_nDuration >= 0 )
  {
    v43 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    v44 = m_nDuration < v43;
    m_nDuration -= v43;
    if ( v44 )
      m_nDuration = 0;
    this->m_nDuration = m_nDuration;
  }
  if ( v30 | (m_nDuration == 0) )
  {
    if ( !v18 || this->m_nFiringTask == 6 && v18->m_bIsFinished )
      goto LABEL_142;
    v45 = !v18->m_bFiredGun;
    if ( v18->m_bFiredGun )
      v45 = (v18->m_nLastCommand & 0xFE) == 2;
    if ( !v45 )
    {
      v18->m_bFiredGun = 0;
      v18->m_nCountDownFrames = 2;
LABEL_142:
      this->m_bIsFinished = 1;
LABEL_143:
      if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) == 0 )
        return 1;
      v31 = 1;
      if ( CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1) )
      {
        v31 = 1;
        TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
        CTaskSimpleDuck::ForceStopMove(TaskDuck);
      }
      return v31;
    }
    if ( this->m_bIsFinished )
      goto LABEL_143;
    if ( ((m_nDuration == 0) & (unsigned __int8)v21) == 1 )
    {
      this->m_nFiringTask = 6;
      m_pTargetEntity = v18->m_pTargetEntity;
      v47 = this->m_pTargetEntity;
      v18->m_bIsInControl = 1;
      if ( m_pTargetEntity != v47 )
      {
        if ( m_pTargetEntity )
          CEntity::CleanUpOldReference(m_pTargetEntity, &v18->m_pTargetEntity);
        v18->m_pTargetEntity = v47;
        if ( v47 )
          CEntity::RegisterReference(v47, &v18->m_pTargetEntity);
        CTaskSimpleUseGun::AbortIK(v18, pPed);
        *(_WORD *)&v18->m_armIkInUse = 0;
      }
      if ( v18->m_nNextCommand <= 5 )
        v18->m_nNextCommand = 6;
    }
  }
  if ( this->m_nNextAttackTime )
  {
    if ( v29 != 3 )
      goto LABEL_104;
  }
  else
  {
    v48 = v21;
    v49 = v29;
    v50 = CTaskSimpleGunControl::DEFAULT_GUN_ATTACK_PERIOD;
    this->m_nNextAttackTime = CTaskSimpleGunControl::DEFAULT_GUN_ATTACK_PERIOD;
    if ( WeaponInfo->m_eFireType == FIRETYPE_PROJECTILE )
    {
      v50 *= 2;
      this->m_nNextAttackTime = v50;
    }
    v51 = v50;
    v29 = v49;
    v21 = v48;
    this->m_nNextAttackTime = CTimer::m_snTimeInMilliseconds
                            + (unsigned int)(float)((float)((float)((float)((float)((float)rand() * 4.6566e-10) * 0.5)
                                                                  + 0.75)
                                                          * (float)v51)
                                                  / (float)((float)(this->m_fAttackFreq * (float)pPed->m_nShootRate)
                                                          / 25.0));
    if ( v29 != 3 )
      goto LABEL_104;
  }
  if ( CTaskSimpleUseGun::RequirePistolWhip(pPed, this->m_pTargetEntity) )
  {
    v52 = 0;
    v29 = 5;
    goto LABEL_109;
  }
LABEL_104:
  m_nPedFlags = (int)pPed->m_nPedFlags;
  v54 = *((_DWORD *)&pPed->m_nPedFlags + 2);
  v55 = (~v54 & 0x40000 | ~m_nPedFlags & 0x4000000) == 0;
  if ( ~v54 & 0x40000 | ~m_nPedFlags & 0x4000000 )
    v55 = (m_nPedFlags & 0x4000000 | ~v54 & 0x10000) == 0;
  if ( v55 )
  {
    v29 = 1;
    v52 = 1;
  }
  else
  {
    v52 = 0;
  }
LABEL_109:
  v86 = v52;
  if ( v21 == 1 )
  {
    v56 = v29;
    v57 = v18;
    v60 = v18->m_pTargetEntity;
    p_m_pTargetEntity = &v18->m_pTargetEntity;
    v58 = v60;
    v61 = this->m_pTargetEntity;
    *((_BYTE *)p_m_pTargetEntity - 19) = 1;
    if ( v60 != v61 )
    {
      if ( v58 )
        CEntity::CleanUpOldReference(v58, p_m_pTargetEntity);
      *p_m_pTargetEntity = v61;
      if ( v61 )
        CEntity::RegisterReference(v61, p_m_pTargetEntity);
      CTaskSimpleUseGun::AbortIK(v57, pPed);
      *(_WORD *)&v57->m_armIkInUse = 0;
    }
    v18 = v57;
    if ( v57->m_nNextCommand < v56 )
      v57->m_nNextCommand = v56;
    v21 = 1;
  }
  v62 = this->m_pTargetEntity;
  if ( v62 )
  {
    m_pMat = v62->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v62->m_transform.m_translate;
  }
  else
  {
    if ( this->m_vecTargetPos.x == 0.0 && this->m_vecTargetPos.y == 0.0 )
      return 0;
    p_tx = &this->m_vecTargetPos;
  }
  v65 = pPed->m_pMat;
  v66 = p_tx->x;
  v67 = p_tx->y;
  v68 = p_tx->z;
  p_m_transform = (CSimpleTransform *)&v65->tx;
  if ( !v65 )
    p_m_transform = &pPed->m_transform;
  v70 = p_m_transform->m_translate.y;
  v71 = v66 - p_m_transform->m_translate.x;
  v72 = p_m_transform->m_translate.z;
  pPed->m_fDesiredHeading = atan2f(-v71, v67 - v70);
  v73 = (float)((float)(v71 * v71) + (float)((float)(v67 - v70) * (float)(v67 - v70)))
      + (float)((float)(v68 - v72) * (float)(v68 - v72));
  if ( v21 != 1 )
    goto LABEL_137;
  if ( v73 >= 6.0 )
  {
    if ( v86 != 1 )
      goto LABEL_137;
  }
  else if ( v18->m_nLastCommand == 3 && !(v86 | ((unsigned __int8)(WeaponInfo->m_nFlags & 0x20) >> 5)) )
  {
    goto LABEL_137;
  }
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
  {
    v74 = 1.0;
    v75 = v18->m_vecMoveCommand.y;
    v76 = CTimer::ms_fTimeStep * 0.07;
    if ( (float)(1.0 - v75) <= (float)(CTimer::ms_fTimeStep * 0.07) )
    {
      if ( (float)(1.0 - v75) < (float)-v76 )
        v74 = v75 - v76;
    }
    else
    {
      v74 = v76 + v75;
    }
    v78 = v18->m_vecMoveCommand.x;
    v79 = 0.0;
    v18->m_vecMoveCommand.y = v74;
    if ( (float)(0.0 - v78) <= v76 )
    {
      if ( (float)(0.0 - v78) < (float)-v76 )
        v79 = v78 - v76;
    }
    else
    {
      v79 = v76 + v78;
    }
    v18->m_bMoveControl = 1;
    v18->m_vecMoveCommand.x = v79;
    return 0;
  }
LABEL_137:
  if ( !this->m_pTargetEntity || (*((_BYTE *)&pPed->m_nPedFlags + 13) & 2) != 0 )
    return 0;
  v31 = 0;
  if ( v73 > (float)(WeaponInfo->m_fWeaponRange * WeaponInfo->m_fWeaponRange) )
    this->m_nDuration = 0;
  return v31;
}
// 669664: using guessed type void *off_669664;

//----- (004DE924) --------------------------------------------------------
void __fastcall CTaskSimpleGunControl::ChangeFiringTask(
        CTaskSimpleGunControl *this,
        int8 nFiringTask,
        CEntity *pTargetEntity,
        CVector *pTargetPos,
        CVector *pMoveTarget)
{
  CEntity *m_pTargetEntity; // r0
  __int64 v9; // d16
  __int64 v10; // d16

  if ( this->m_nFiringTask != nFiringTask )
  {
    this->m_nNextAttackTime = 0;
    this->m_nFiringTask = nFiringTask;
  }
  if ( pTargetEntity )
  {
    m_pTargetEntity = this->m_pTargetEntity;
    if ( m_pTargetEntity && m_pTargetEntity != pTargetEntity )
      CEntity::CleanUpOldReference(m_pTargetEntity, &this->m_pTargetEntity);
    this->m_pTargetEntity = pTargetEntity;
    CEntity::RegisterReference(pTargetEntity, &this->m_pTargetEntity);
  }
  if ( pTargetPos )
  {
    v9 = *(_QWORD *)&pTargetPos->x;
    this->m_vecTargetPos.z = pTargetPos->z;
    *(_QWORD *)&this->m_vecTargetPos.x = v9;
  }
  if ( pMoveTarget )
  {
    v10 = *(_QWORD *)&pMoveTarget->x;
    this->m_vecMoveTarget.z = pMoveTarget->z;
    *(_QWORD *)&this->m_vecMoveTarget.x = v10;
  }
}

//----- (004DE990) --------------------------------------------------------
int __fastcall CTaskSimpleThrowProjectile::CTaskSimpleThrowProjectile(int a1, CEntity *a2, int a3, int a4, int a5)
{
  CTaskSimple::CTaskSimple((CTaskSimple *)a1);
  *(_WORD *)(a1 + 8) = 0;
  *(_BYTE *)(a1 + 10) = 0;
  *(_DWORD *)(a1 + 12) = 0;
  *(_DWORD *)(a1 + 20) = a3;
  *(_DWORD *)(a1 + 28) = a5;
  *(_DWORD *)(a1 + 24) = a4;
  *(_DWORD *)a1 = &off_6696CC;
  *(_DWORD *)(a1 + 16) = a2;
  if ( a2 )
    CEntity::RegisterReference(a2, (CEntity **)(a1 + 16));
  *(_DWORD *)(a1 + 32) = CTimer::m_snTimeInMilliseconds;
  return a1;
}
// 6696CC: using guessed type void *off_6696CC;

//----- (004DE9EC) --------------------------------------------------------
void __fastcall CTaskSimpleThrowProjectile::~CTaskSimpleThrowProjectile(CTaskSimpleThrowProjectile *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CEntity *m_pTargetEntity; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_6696CC;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim = 0;
  }
  m_pTargetEntity = this->m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, &this->m_pTargetEntity);
  sub_1A01F4(this);
}
// 6696CC: using guessed type void *off_6696CC;

//----- (004DEA30) --------------------------------------------------------
void __fastcall CTaskSimpleThrowProjectile::~CTaskSimpleThrowProjectile(CTaskSimpleThrowProjectile *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CEntity *m_pTargetEntity; // r0
  void *v4; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_6696CC;
  if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim = 0;
  }
  m_pTargetEntity = this->m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, &this->m_pTargetEntity);
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4DEA6C: variable 'v4' is possibly undefined
// 6696CC: using guessed type void *off_6696CC;

//----- (004DEA78) --------------------------------------------------------
bool __fastcall CTaskSimpleThrowProjectile::MakeAbortable(
        CTaskSimpleThrowProjectile *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CAnimBlendAssociation *m_pAnim; // r0
  bool result; // r0
  bool v8; // zf
  CAnimBlendAssociation *v9; // r0

  if ( iPriority == 2 )
  {
    m_pAnim = this->m_pAnim;
    if ( m_pAnim )
    {
      CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
      this->m_pAnim->m_fBlendDelta = -1000.0;
      result = 1;
      this->m_pAnim = 0;
      return result;
    }
  }
  else if ( pEvent && (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 9 )
  {
    v8 = LOBYTE(pEvent[5]._vptr$CEvent) == 0;
    if ( LOBYTE(pEvent[5]._vptr$CEvent) )
      v8 = !*(&pEvent->m_bIsPersistent + 1);
    if ( !v8 || (*(&pEvent[2].m_bIsPersistent + 1) & 2) != 0 )
    {
      v9 = this->m_pAnim;
      if ( v9 )
      {
        CAnimBlendAssociation::SetFinishCallback(v9, CDefaultAnimCallback::DefaultAnimCB, 0);
        this->m_pAnim->m_fBlendDelta = -4.0;
        this->m_pAnim = 0;
      }
      this->m_bIsFinished = 1;
    }
  }
  return 1;
}

//----- (004DEAF8) --------------------------------------------------------
bool __fastcall CTaskSimpleThrowProjectile::ProcessPed(CTaskSimpleThrowProjectile *this, CPed *pPed)
{
  bool v4; // r6
  CWeaponInfo *WeaponInfo; // r8
  CAnimBlendAssociation *m_pAnim; // r0
  int m_animId; // r1
  float *p_m_animFireTime; // r2
  float m_fCurrentTime; // s0
  int32 *p_m_nButtonCounter; // r0
  signed int m_nButtonCounter; // r1
  CEntity *m_pTargetEntity; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v16; // d16
  __int64 v17; // d16
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r6
  RwInt32 v19; // r8
  RwMatrix *MatrixArray; // r0
  CWeapon *v21; // r0
  RwV3d_0 pointsIn; // [sp+10h] [bp-28h] BYREF

  v4 = 1;
  WeaponInfo = CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
  if ( !this->m_bIsFinished )
  {
    if ( !(BYTE1(WeaponInfo->m_nFlags) << 31) )
      return 1;
    m_pAnim = this->m_pAnim;
    if ( m_pAnim )
    {
      m_animId = m_pAnim->m_animId;
      if ( (unsigned int)(m_animId - 229) > 1 )
        return 0;
      p_m_animFireTime = &WeaponInfo->m_animFireTime;
      m_fCurrentTime = m_pAnim->m_fCurrentTime;
      if ( (unsigned __int16)m_animId == 230 )
        p_m_animFireTime = &WeaponInfo->m_anim2FireTime;
      if ( m_fCurrentTime <= *p_m_animFireTime
        || (float)(m_fCurrentTime - m_pAnim->m_fTimeStep) > *p_m_animFireTime
        || !(LOBYTE(m_pAnim->m_bitsFlag) << 31) )
      {
        return 0;
      }
      if ( CPed::IsPlayer(pPed) )
      {
        if ( this->m_bButtonReleased )
        {
          p_m_nButtonCounter = &this->m_nButtonCounter;
          m_nButtonCounter = this->m_nButtonCounter;
        }
        else
        {
          p_m_nButtonCounter = &this->m_nButtonCounter;
          m_nButtonCounter = CTimer::m_snTimeInMilliseconds - this->m_nButtonCounter;
          this->m_nButtonCounter = m_nButtonCounter;
        }
        if ( m_nButtonCounter >= 534 )
        {
          m_nButtonCounter = 533;
          *p_m_nButtonCounter = 533;
        }
        pPed->m_pPlayerData->m_fAttackButtonCounter = (float)((float)m_nButtonCounter * 50.0) / 1000.0;
      }
      m_pTargetEntity = this->m_pTargetEntity;
      if ( m_pTargetEntity )
      {
        m_pMat = m_pTargetEntity->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pTargetEntity->m_transform;
        v16 = *(_QWORD *)&p_tx->m_translate.x;
        this->m_vecTargetPos.z = p_tx->m_translate.z;
        *(_QWORD *)&this->m_vecTargetPos.x = v16;
      }
      v17 = *(_QWORD *)&WeaponInfo->m_vecFireOffset.x;
      pointsIn.z = WeaponInfo->m_vecFireOffset.z;
      *(_QWORD *)&pointsIn.x = v17;
      AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)pPed->m_pRwObject);
      v19 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, pPed->m_aPedFrames[6]->boneTag);
      MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
      RwV3dTransformPoints(&pointsIn, &pointsIn, 1, &MatrixArray[v19]);
      if ( this->m_vecTargetPos.x == 0.0 )
      {
        v21 = &pPed->m_WeaponSlots[pPed->m_nCurrentWeapon];
        if ( this->m_vecTargetPos.z == 0.0 )
        {
          CWeapon::Fire(v21, pPed, (CVector *)&pointsIn, (CVector *)&pointsIn, 0, 0, 0);
          return 0;
        }
      }
      else
      {
        v21 = &pPed->m_WeaponSlots[pPed->m_nCurrentWeapon];
      }
      CWeapon::Fire(v21, pPed, (CVector *)&pointsIn, (CVector *)&pointsIn, 0, &this->m_vecTargetPos, 0);
    }
    else
    {
      CTaskSimpleThrowProjectile::StartAnim(this, pPed);
    }
    return 0;
  }
  return v4;
}

//----- (004DECB0) --------------------------------------------------------
void __fastcall CTaskSimpleThrowProjectile::StartAnim(CTaskSimpleThrowProjectile *this, CPed *pPed)
{
  CWeaponInfo *WeaponInfo; // r0
  CEntity *m_pTargetEntity; // r1
  CMatrix *m_pMat; // r2
  CMatrix *v7; // r3
  CSimpleTransform *p_tx; // r4
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v10; // d16
  unsigned __int64 v11; // d1
  float y; // s2
  int v13; // r2
  float x; // s0
  int v15; // r1
  CMatrix *v16; // r1
  CSimpleTransform *v17; // r2
  AnimationId v18; // r2
  AssocGroupId m_animGroup; // r1
  RpClump_0 *m_pRwObject; // r0
  int v21; // r3
  CAnimBlendAssociation *v22; // r0

  WeaponInfo = CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
  if ( this->m_bStartThrowFinished )
  {
    m_pTargetEntity = this->m_pTargetEntity;
    if ( m_pTargetEntity )
    {
      m_pMat = pPed->m_pMat;
      v7 = m_pTargetEntity->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
      p_m_transform = (CSimpleTransform *)&v7->tx;
      if ( !v7 )
        p_m_transform = &m_pTargetEntity->m_transform;
      v10.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
      v11 = vmul_f32(v10, v10).n64_u64[0];
      if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                 * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                         + *(float *)&v11)
                 + *((float *)&v11 + 1)) > 100.0 )
        goto LABEL_17;
    }
    y = this->m_vecTargetPos.y;
    v13 = 0;
    x = this->m_vecTargetPos.x;
    v15 = 0;
    if ( y == 0.0 )
      v13 = 1;
    if ( x == 0.0 )
      v15 = 1;
    if ( (v15 & v13) != 0 && this->m_vecTargetPos.z == 0.0 )
      goto LABEL_19;
    v16 = pPed->m_pMat;
    v17 = (CSimpleTransform *)&v16->tx;
    if ( !v16 )
      v17 = &pPed->m_transform;
    if ( (float)((float)((float)((float)(x - v17->m_translate.x) * (float)(x - v17->m_translate.x))
                       + (float)((float)(y - v17->m_translate.y) * (float)(y - v17->m_translate.y)))
               + (float)((float)(this->m_vecTargetPos.z - v17->m_translate.z)
                       * (float)(this->m_vecTargetPos.z - v17->m_translate.z))) <= 100.0 )
    {
LABEL_19:
      v18 = ANIM_WEAPON_THROW_LO;
      if ( !this->m_bButtonReleased
        && pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType != WEAPONTYPE_REMOTE_SATCHEL_CHARGE )
      {
        v18 = ANIM_WEAPON_THROW_HI;
      }
    }
    else
    {
LABEL_17:
      v18 = ANIM_WEAPON_THROW_HI;
    }
    m_animGroup = WeaponInfo->m_animGroup;
    v21 = 1148846080;
    m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
  }
  else
  {
    m_animGroup = WeaponInfo->m_animGroup;
    v18 = ANIM_WEAPON_THROW_START;
    m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
    v21 = 1098907648;
  }
  v22 = CAnimManager::BlendAnimation(m_pRwObject, m_animGroup, v18, *(float *)&v21);
  this->m_pAnim = v22;
  sub_18C19C(v22, CTaskSimpleThrowProjectile::FinishAnimThrowProjectileCB, this);
}

//----- (004DEE04) --------------------------------------------------------
bool __fastcall CTaskSimpleThrowProjectile::ControlThrow(
        CTaskSimpleThrowProjectile *this,
        bool bButtonReleased,
        CEntity *pEntity,
        CVector *pVecCoords)
{
  CEntity **p_m_pTargetEntity; // r4
  int32 m_bIsFinished; // r0
  bool v10; // zf
  int32 m_nButtonCounter; // r1
  uint32 v12; // r0
  bool v13; // zf
  __int64 v14; // d16

  m_bIsFinished = this->m_bIsFinished;
  if ( m_bIsFinished )
    return 1;
  v10 = bButtonReleased;
  if ( bButtonReleased )
  {
    m_bIsFinished = this->m_bButtonReleased;
    v10 = m_bIsFinished == 0;
  }
  if ( v10 )
  {
    m_nButtonCounter = this->m_nButtonCounter;
    v12 = CTimer::m_snTimeInMilliseconds;
    this->m_bButtonReleased = 1;
    m_bIsFinished = v12 - m_nButtonCounter;
    this->m_nButtonCounter = m_bIsFinished;
  }
  v13 = pEntity == 0;
  if ( pEntity )
  {
    p_m_pTargetEntity = &this->m_pTargetEntity;
    m_bIsFinished = (int32)this->m_pTargetEntity;
    v13 = m_bIsFinished == (_DWORD)pEntity;
  }
  if ( !v13 )
  {
    if ( m_bIsFinished )
      CEntity::CleanUpOldReference((CEntity *)m_bIsFinished, p_m_pTargetEntity);
    *p_m_pTargetEntity = pEntity;
    CEntity::RegisterReference(pEntity, p_m_pTargetEntity);
  }
  if ( pVecCoords )
  {
    v14 = *(_QWORD *)&pVecCoords->x;
    this->m_vecTargetPos.z = pVecCoords->z;
    *(_QWORD *)&this->m_vecTargetPos.x = v14;
  }
  return 0;
}
// 4DEE50: variable 'p_m_pTargetEntity' is possibly undefined

//----- (004DEE80) --------------------------------------------------------
void __fastcall CTaskSimpleThrowProjectile::FinishAnimThrowProjectileCB(CAnimBlendAssociation *pAnim, void *pData)
{
  if ( *((_BYTE *)pData + 9) )
    *((_BYTE *)pData + 8) = 1;
  else
    *((_BYTE *)pData + 9) = 1;
  *((_DWORD *)pData + 3) = 0;
}

//----- (004DEE94) --------------------------------------------------------
void __fastcall CTaskSimpleThrowControl::CTaskSimpleThrowControl(
        CTaskSimpleThrowControl *this,
        CEntity *pTargetEntity,
        const CVector *pTargetPos)
{
  __int64 v6; // d16

  CTaskSimple::CTaskSimple(this);
  *(_WORD *)&this->m_bIsFinished = 0;
  this->m_vecTargetPos.y = 0.0;
  this->m_vecTargetPos.z = 0.0;
  this->_vptr$CTask = (int (**)(void))&off_669700;
  this->m_vecTargetPos.x = 0.0;
  this->m_pTargetEntity = pTargetEntity;
  if ( pTargetEntity )
    CEntity::RegisterReference(pTargetEntity, &this->m_pTargetEntity);
  if ( pTargetPos )
  {
    v6 = *(_QWORD *)&pTargetPos->x;
    this->m_vecTargetPos.z = pTargetPos->z;
    *(_QWORD *)&this->m_vecTargetPos.x = v6;
  }
}
// 669700: using guessed type void *;

//----- (004DEEF0) --------------------------------------------------------
void __fastcall CTaskSimpleThrowControl::~CTaskSimpleThrowControl(CTaskSimpleThrowControl *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669700;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  sub_1A01F4(this);
}
// 669700: using guessed type void *off_669700;

//----- (004DEF1C) --------------------------------------------------------
void __fastcall CTaskSimpleThrowControl::~CTaskSimpleThrowControl(CTaskSimpleThrowControl *this)
{
  CEntity *m_pTargetEntity; // r0
  CEntity **p_m_pTargetEntity; // r1
  void *v4; // r0

  p_m_pTargetEntity = &this->m_pTargetEntity;
  m_pTargetEntity = this->m_pTargetEntity;
  this->_vptr$CTask = (int (**)(void))&off_669700;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, p_m_pTargetEntity);
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4DEF44: variable 'v4' is possibly undefined
// 669700: using guessed type void *off_669700;

//----- (004DEF4C) --------------------------------------------------------
bool __fastcall CTaskSimpleThrowControl::MakeAbortable(
        CTaskSimpleThrowControl *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CTask *TaskSecondary; // r0

  if ( !CPedIntelligence::GetTaskThrow(pPed->m_pPedIntelligence) )
    return 1;
  TaskSecondary = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
  return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))TaskSecondary->_vptr$CTask + 7))(
           TaskSecondary,
           pPed,
           iPriority,
           pEvent);
}

//----- (004DEF90) --------------------------------------------------------
bool __fastcall CTaskSimpleThrowControl::ProcessPed(CTaskSimpleThrowControl *this, CPed *pPed)
{
  bool v4; // r5
  CTask *TaskSecondary; // r0
  CVector *p_m_vecTargetPos; // r9
  void *v8; // r6
  CEntity *m_pTargetEntity; // r8
  __int64 v10; // r10
  CTaskSimpleThrowProjectile *TaskThrow; // r0
  float v12; // s0
  CTaskSimpleThrowProjectile *v13; // r6
  CEntity **p_m_pTargetEntity; // r0
  CEntity *v15; // r1
  CEntity *v16; // r0
  CMatrix *m_pMat; // r2
  CMatrix *v18; // r3
  CSimpleTransform *p_tx; // r1
  float *p_x; // r2
  RwReal *p_y; // r0
  float v22; // s0
  CTask *v23; // r0
  CMatrix *v24; // r2
  __int64 v25; // d16
  RwReal x; // [sp+4h] [bp-24h]
  CPedIntelligence *m_pPedIntelligence; // [sp+8h] [bp-20h]

  if ( this->m_bIsFinished )
    return 1;
  CPed::SetMoveState(pPed, PEDMOVE_STILL);
  if ( CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0) )
  {
    TaskSecondary = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
    if ( (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) != 1018 )
    {
      v4 = 0;
      v23 = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0);
      (*((void (__fastcall **)(CTask *, CPed *, int, _DWORD))v23->_vptr$CTask + 7))(v23, pPed, 1, 0);
      return v4;
    }
    p_m_vecTargetPos = &this->m_vecTargetPos;
  }
  else
  {
    if ( this->m_bStartedThrowTask )
      return 1;
    m_pPedIntelligence = pPed->m_pPedIntelligence;
    v8 = CTask::operator new(0x24u);
    p_m_vecTargetPos = &this->m_vecTargetPos;
    x = this->m_vecTargetPos.x;
    m_pTargetEntity = this->m_pTargetEntity;
    v10 = *(_QWORD *)&this->m_vecTargetPos.y;
    CTaskSimple::CTaskSimple((CTaskSimple *)v8);
    *(_DWORD *)v8 = &off_6696CC;
    *((_WORD *)v8 + 4) = 0;
    *((_BYTE *)v8 + 10) = 0;
    *((_DWORD *)v8 + 3) = 0;
    *((RwReal *)v8 + 5) = x;
    *((_QWORD *)v8 + 3) = v10;
    *((_DWORD *)v8 + 4) = m_pTargetEntity;
    if ( m_pTargetEntity )
      CEntity::RegisterReference(m_pTargetEntity, (CEntity **)v8 + 4);
    *((_DWORD *)v8 + 8) = CTimer::m_snTimeInMilliseconds;
    CTaskManager::SetTaskSecondary(&m_pPedIntelligence->m_taskManager, (CTask *)v8, 0);
    this->m_bStartedThrowTask = 1;
  }
  TaskThrow = CPedIntelligence::GetTaskThrow(pPed->m_pPedIntelligence);
  v12 = this->m_vecTargetPos.x;
  v13 = TaskThrow;
  if ( v12 != 0.0 )
  {
    p_m_pTargetEntity = &this->m_pTargetEntity;
    v15 = this->m_pTargetEntity;
LABEL_13:
    if ( v15 )
    {
      v16 = *p_m_pTargetEntity;
      m_pMat = pPed->m_pMat;
      v18 = v16->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
      p_x = &v18->tx;
      if ( !v18 )
        p_x = &v16->m_transform.m_translate.x;
      p_y = p_x + 1;
      v22 = *p_x - p_tx->m_translate.x;
    }
    else
    {
      v24 = pPed->m_pMat;
      p_y = &this->m_vecTargetPos.y;
      p_tx = (CSimpleTransform *)&v24->tx;
      if ( !v24 )
        p_tx = &pPed->m_transform;
      v22 = v12 - p_tx->m_translate.x;
    }
    pPed->m_fDesiredHeading = atan2f(COERCE_FLOAT(LODWORD(v22) ^ 0x80000000), *p_y - p_tx->m_translate.y);
    goto LABEL_29;
  }
  p_m_pTargetEntity = &this->m_pTargetEntity;
  v15 = this->m_pTargetEntity;
  if ( this->m_vecTargetPos.z != 0.0 )
    goto LABEL_13;
  p_m_vecTargetPos = 0;
  if ( v15 )
    goto LABEL_13;
LABEL_29:
  if ( !this->m_bStartedThrowTask )
    return 0;
  if ( !v13->m_bIsFinished )
  {
    if ( p_m_vecTargetPos )
    {
      v25 = *(_QWORD *)&p_m_vecTargetPos->x;
      v13->m_vecTargetPos.z = p_m_vecTargetPos->z;
      *(_QWORD *)&v13->m_vecTargetPos.x = v25;
    }
    return 0;
  }
  return 1;
}
// 6696CC: using guessed type void *off_6696CC;

//----- (004DF150) --------------------------------------------------------
void __fastcall CTaskSimpleBeKickedOnGround::CTaskSimpleBeKickedOnGround(CTaskSimpleBeKickedOnGround *this)
{
  int v1; // r0

  CTaskSimple::CTaskSimple(this);
  *(_BYTE *)(v1 + 8) = 0;
  *(_DWORD *)(v1 + 12) = 0;
  *(_DWORD *)v1 = &off_669734;
}
// 4DF15C: variable 'v1' is possibly undefined
// 669734: using guessed type void *off_669734;

//----- (004DF170) --------------------------------------------------------
void __fastcall CTaskSimpleBeKickedOnGround::~CTaskSimpleBeKickedOnGround(CTaskSimpleBeKickedOnGround *this)
{
  CAnimBlendAssociation *m_pAnim; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669734;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  sub_1A01F4(this);
}
// 669734: using guessed type void *off_669734;

//----- (004DF1AC) --------------------------------------------------------
void __fastcall CTaskSimpleBeKickedOnGround::~CTaskSimpleBeKickedOnGround(CTaskSimpleBeKickedOnGround *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  void *v3; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669734;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  CTask::~CTask(this);
  sub_197118(v3);
}
// 4DF1E0: variable 'v3' is possibly undefined
// 669734: using guessed type void *off_669734;

//----- (004DF1EC) --------------------------------------------------------
bool __fastcall CTaskSimpleBeKickedOnGround::MakeAbortable(
        CTaskSimpleBeKickedOnGround *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CAnimBlendAssociation *m_pAnim; // r0
  bool result; // r0

  m_pAnim = this->m_pAnim;
  if ( (unsigned int)(iPriority - 1) > 1 )
  {
    if ( m_pAnim )
    {
      m_pAnim->m_bitsFlag |= 4u;
      this->m_pAnim->m_fBlendDelta = -4.0;
    }
    return 0;
  }
  else if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    result = 1;
    this->m_pAnim = 0;
  }
  else
  {
    return 1;
  }
  return result;
}

//----- (004DF230) --------------------------------------------------------
void __fastcall CTaskSimpleBeKickedOnGround::FinishAnimBeKickedOnGroundCB(CAnimBlendAssociation *pAnim, void *pData)
{
  *((_BYTE *)pData + 8) = 1;
  *((_DWORD *)pData + 3) = 0;
}

//----- (004DF23C) --------------------------------------------------------
void __fastcall CTaskSimpleBeKickedOnGround::StartAnim(CTaskSimpleBeKickedOnGround *this, CPed *pPed)
{
  CAnimBlendAssociation *FirstAssociation; // r0
  AnimationId v5; // r2
  CAnimBlendAssociation *v6; // r0
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r6
  RwInt32 v8; // r5
  RwMatrix *MatrixArray; // r0
  RwV3d_0 pointsIn; // [sp+4h] [bp-1Ch] BYREF

  if ( CLocalisation::KickingWhenDown() )
  {
    FirstAssociation = RpAnimBlendClumpGetFirstAssociation((RpClump_0 *)pPed->m_pRwObject, 0x800u);
    v5 = ANIM_STD_HIT_FLOOR_FRONT;
    if ( !FirstAssociation )
      v5 = ANIM_STD_HIT_FLOOR;
    v6 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, v5, 8.0);
    this->m_pAnim = v6;
    CAnimBlendAssociation::SetCurrentTime(v6, 0.0);
    this->m_pAnim->m_bitsFlag |= 1u;
    this->m_pAnim->m_bitsFlag &= ~8u;
    if ( CLocalisation::KickingWhenDown() )
    {
      memset(&pointsIn, 0, sizeof(pointsIn));
      AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)pPed->m_pRwObject);
      v8 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, pPed->m_aPedFrames[2]->boneTag);
      MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
      RwV3dTransformPoints(&pointsIn, &pointsIn, 1, &MatrixArray[v8]);
    }
    CAnimBlendAssociation::SetFinishCallback(
      this->m_pAnim,
      CTaskSimpleBeKickedOnGround::FinishAnimBeKickedOnGroundCB,
      this);
  }
  else
  {
    this->m_bIsFinished = 1;
  }
}

//----- (004DF2E8) --------------------------------------------------------
bool __fastcall CTaskSimpleBeKickedOnGround::ProcessPed(CTaskSimpleBeKickedOnGround *this, CPed *pPed)
{
  if ( this->m_bIsFinished )
    return 1;
  if ( !this->m_pAnim )
    CTaskSimpleBeKickedOnGround::StartAnim(this, pPed);
  return 0;
}

//----- (004DF308) --------------------------------------------------------
void __fastcall CTaskSimpleBeHitWhileMoving::CTaskSimpleBeHitWhileMoving(
        CTaskSimpleBeHitWhileMoving *this,
        int nHitLevel,
        int nDir)
{
  int v5; // r0

  CTaskSimple::CTaskSimple(this);
  *(_BYTE *)(v5 + 8) = 0;
  *(_DWORD *)(v5 + 12) = nHitLevel;
  *(_DWORD *)(v5 + 16) = nDir;
  *(_DWORD *)(v5 + 20) = 0;
  *(_DWORD *)v5 = &off_669768;
}
// 4DF318: variable 'v5' is possibly undefined
// 669768: using guessed type void *;

//----- (004DF330) --------------------------------------------------------
void __fastcall CTaskSimpleBeHitWhileMoving::~CTaskSimpleBeHitWhileMoving(CTaskSimpleBeHitWhileMoving *this)
{
  CAnimBlendAssociation *m_pAnim; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669768;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  sub_1A01F4(this);
}
// 669768: using guessed type void *off_669768;

//----- (004DF36C) --------------------------------------------------------
void __fastcall CTaskSimpleBeHitWhileMoving::~CTaskSimpleBeHitWhileMoving(CTaskSimpleBeHitWhileMoving *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  void *v3; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_669768;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  CTask::~CTask(this);
  sub_197118(v3);
}
// 4DF3A0: variable 'v3' is possibly undefined
// 669768: using guessed type void *off_669768;

//----- (004DF3AC) --------------------------------------------------------
bool __fastcall CTaskSimpleBeHitWhileMoving::MakeAbortable(
        CTaskSimpleBeHitWhileMoving *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CAnimBlendAssociation *m_pAnim; // r0
  bool result; // r0

  m_pAnim = this->m_pAnim;
  if ( (unsigned int)(iPriority - 1) > 1 )
  {
    if ( m_pAnim )
    {
      m_pAnim->m_bitsFlag |= 4u;
      this->m_pAnim->m_fBlendDelta = -4.0;
    }
    return 0;
  }
  else if ( m_pAnim )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    result = 1;
    this->m_pAnim = 0;
  }
  else
  {
    return 1;
  }
  return result;
}

//----- (004DF3F0) --------------------------------------------------------
void __fastcall CTaskSimpleBeHitWhileMoving::FinishAnimBeHitWhileMovingCB(CAnimBlendAssociation *pAnim, void *pData)
{
  *((_BYTE *)pData + 8) = 1;
  *((_DWORD *)pData + 5) = 0;
}

//----- (004DF3FC) --------------------------------------------------------
void __fastcall CTaskSimpleBeHitWhileMoving::StartAnim(CTaskSimpleBeHitWhileMoving *this, CPed *pPed)
{
  int m_nHitLevel; // r0
  bool v5; // zf
  int m_nDirn; // r1
  uint32 v7; // r6
  CAnimBlendAssociation *Association; // r0
  RpClump_0 *m_pRwObject; // r0
  AnimationId v10; // r2
  int v11; // r0
  int v12; // r0
  signed int v13; // r8
  CAnimBlendAssociation *v14; // r0
  CAnimBlendAssociation *v15; // r6
  uint16 m_bitsFlag; // r0
  float v17; // s0
  float v18; // s2
  uint32 v19; // r0
  float v20; // s0

  m_nHitLevel = this->m_nHitLevel;
  v5 = m_nHitLevel == 4;
  if ( m_nHitLevel != 4 )
    v5 = m_nHitLevel == 2;
  if ( !v5 || (CPed::IsPlayer(pPed) || (rand() & 1) == 0) && (rand() & 7) != 0 )
  {
    if ( !CPed::IsPlayer(pPed) && (rand() & 1) == 0 )
    {
      rand();
      goto LABEL_42;
    }
    m_nDirn = this->m_nDirn;
    v7 = 28;
    if ( (unsigned int)(m_nDirn - 1) < 3 )
      v7 = m_nDirn + 28;
    Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, v7);
    this->m_pAnim = Association;
    if ( Association && Association->m_fBlendDelta >= 0.0 )
    {
LABEL_17:
      CAnimBlendAssociation::SetCurrentTime(Association, 0.0);
      this->m_pAnim->m_bitsFlag |= 1u;
      this->m_pAnim->m_bitsFlag |= 8u;
      goto LABEL_42;
    }
    m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
    v10 = v7;
LABEL_16:
    Association = CAnimManager::BlendAnimation(m_pRwObject, ANIM_STD_PED, v10, 8.0);
    this->m_pAnim = Association;
    goto LABEL_17;
  }
  v11 = this->m_nDirn;
  switch ( v11 )
  {
    case 1:
      v13 = 25;
      break;
    case 3:
      v13 = 27;
      break;
    case 2:
      v12 = rand() & 1;
      v13 = 8 * v12 + 26;
      if ( v12 )
      {
LABEL_44:
        Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, v13);
        this->m_pAnim = Association;
        if ( Association && Association->m_fBlendDelta >= 0.0 )
          goto LABEL_17;
        m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
        v10 = v13;
        goto LABEL_16;
      }
      break;
    default:
      if ( this->m_nHitLevel == 2 )
      {
        v13 = 20;
      }
      else
      {
        if ( (rand() & 1) != 0 )
        {
          v13 = 37;
          goto LABEL_44;
        }
        if ( (rand() & 1) != 0 )
        {
          v13 = 32;
          goto LABEL_44;
        }
        v13 = 19;
      }
      break;
  }
  if ( !pPed->m_pAttachToEntity )
  {
    CPed::ClearLookFlag(pPed);
    CPed::ClearAimFlag(pPed);
    v14 = RpAnimBlendClumpGetAssociation((RpClump_0 *)pPed->m_pRwObject, v13);
    v15 = v14;
    if ( v14 )
    {
      CAnimBlendAssociation::SetCurrentTime(v14, 0.0);
      m_bitsFlag = v15->m_bitsFlag;
      v15->m_fBlendAmount = 0.0;
      v15->m_fBlendDelta = 8.0;
      v15->m_bitsFlag = m_bitsFlag | 1;
      if ( CPed::IsPlayer(pPed) )
      {
        v17 = (float)(v15->m_pAnimBlendHierarchy->m_fTotalTime * 1000.0) + (float)CTimer::m_snTimeInMilliseconds;
        if ( (v15->m_animId & 0xFFFFFFFE) == 110 )
        {
          v17 = v17 + (float)(v15->m_fCurrentTime * -1000.0);
          v18 = 100.0;
        }
        else
        {
          v18 = 500.0;
        }
        v20 = v17 + v18;
      }
      else
      {
        v20 = (float)((float)((float)(v15->m_pAnimBlendHierarchy->m_fTotalTime * 1000.0)
                            + (float)CTimer::m_snTimeInMilliseconds)
                    + 500.0)
            + (float)((pPed->RandomSeed + CTimer::m_FrameCounter) % 0x3E8);
      }
      v19 = (unsigned int)v20;
    }
    else
    {
      this->m_pAnim = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, (AnimationId)v13, 8.0);
      CPed::IsPlayer(pPed);
      v19 = (CTimer::m_FrameCounter + pPed->RandomSeed) % 0x3E8 + CTimer::m_snTimeInMilliseconds + 1000;
    }
    pPed->m_nUnconsciousTimer = v19;
  }
LABEL_42:
  sub_18C19C(this->m_pAnim, CTaskSimpleBeHitWhileMoving::FinishAnimBeHitWhileMovingCB, this);
}

//----- (004DF6A0) --------------------------------------------------------
bool __fastcall CTaskSimpleBeHitWhileMoving::ProcessPed(CTaskSimpleBeHitWhileMoving *this, CPed *pPed)
{
  if ( this->m_bIsFinished )
    return 1;
  if ( !this->m_pAnim )
    CTaskSimpleBeHitWhileMoving::StartAnim(this, pPed);
  return 0;
}

//----- (004DF6C0) --------------------------------------------------------
void __fastcall CTaskSimpleChoking::CTaskSimpleChoking(CTaskSimpleChoking *this, CPed *pAttacker, bool8 isTeargas)
{
  int v6; // s0
  uint32 v7; // r0

  CTaskSimple::CTaskSimple(this);
  this->m_pAnim = 0;
  this->m_bIsTeargas = isTeargas;
  this->m_bIsFinished = 0;
  this->_vptr$CTask = (int (**)(void))&off_66979C;
  this->m_pAttacker = pAttacker;
  if ( pAttacker )
    CEntity::RegisterReference(pAttacker, &this->m_pAttacker);
  v6 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 1000.0);
  v7 = CTimer::m_snTimeInMilliseconds;
  this->m_nTimeRemaining = v6 + 1000;
  this->m_nTimeStarted = v7;
}
// 66979C: using guessed type void *off_66979C;

//----- (004DF744) --------------------------------------------------------
void __fastcall CTaskSimpleChoking::~CTaskSimpleChoking(CTaskSimpleChoking *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CPed *m_pAttacker; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_66979C;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  m_pAttacker = this->m_pAttacker;
  if ( m_pAttacker )
    CEntity::CleanUpOldReference(m_pAttacker, &this->m_pAttacker);
  sub_1A01F4(this);
}
// 66979C: using guessed type void *off_66979C;

//----- (004DF790) --------------------------------------------------------
void __fastcall CTaskSimpleChoking::~CTaskSimpleChoking(CTaskSimpleChoking *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CPed *m_pAttacker; // r0
  void *v4; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_66979C;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  m_pAttacker = this->m_pAttacker;
  if ( m_pAttacker )
    CEntity::CleanUpOldReference(m_pAttacker, &this->m_pAttacker);
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4DF7D2: variable 'v4' is possibly undefined
// 66979C: using guessed type void *off_66979C;

//----- (004DF7E0) --------------------------------------------------------
bool __fastcall CTaskSimpleChoking::MakeAbortable(
        CTaskSimpleChoking *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  bool result; // r0
  CAnimBlendAssociation *v6; // r0
  CAnimBlendAssociation *m_pAnim; // r0

  if ( (unsigned int)(iPriority - 1) > 1 )
  {
    m_pAnim = this->m_pAnim;
    if ( m_pAnim )
    {
      m_pAnim->m_bitsFlag |= 4u;
      this->m_pAnim->m_fBlendDelta = -4.0;
      CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
      this->m_pAnim = 0;
    }
    return 1;
  }
  else if ( pEvent && (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 3))(pEvent) < 57 )
  {
    return 0;
  }
  else
  {
    v6 = this->m_pAnim;
    if ( v6 )
    {
      v6->m_fBlendDelta = -4.0;
      CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
      this->m_pAnim = 0;
    }
    result = 1;
    this->m_bIsFinished = 1;
  }
  return result;
}

//----- (004DF858) --------------------------------------------------------
void __fastcall CTaskSimpleChoking::DeleteAnimChokeCB(CAnimBlendAssociation *pAnim, void *pData)
{
  *((_BYTE *)pData + 25) = 1;
  *((_DWORD *)pData + 3) = 0;
}

//----- (004DF864) --------------------------------------------------------
bool __fastcall CTaskSimpleChoking::ProcessPed(CTaskSimpleChoking *this, CPed *pPed)
{
  bool v4; // r5
  _BOOL4 IsPlayer; // r0
  bool v6; // zf
  unsigned int v7; // r2
  bool v8; // cc
  __int64 v9; // r0
  CAnimBlendAssociation *v10; // r0
  uint32 v11; // r6
  int m_nTimeRemaining; // r0
  CAnimBlendAssociation *v13; // r0
  CAnimBlendAssociation *m_pAnim; // r5
  CPed *m_pAttacker; // r12
  CMatrix *m_pMat; // r1
  CMatrix *v17; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *p_m_transform; // r0
  float32x2_t v20; // d1
  unsigned __int64 v21; // d3

  if ( this->m_bIsFinished )
    return 1;
  if ( this->m_pAttacker )
  {
    IsPlayer = CPed::IsPlayer(pPed);
    v6 = !IsPlayer;
    if ( !IsPlayer )
      v6 = this->m_bIsTeargas == 0;
    if ( v6 )
    {
      m_pAttacker = this->m_pAttacker;
      m_pMat = pPed->m_pMat;
      v17 = m_pAttacker->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
      p_m_transform = (CSimpleTransform *)&v17->tx;
      if ( !v17 )
        p_m_transform = &m_pAttacker->m_transform;
      v20.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
      v21 = vmul_f32(v20, *(float32x2_t *)&m_pMat->yy).n64_u64[0];
      if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x) * m_pMat->xy)
                         + *(float *)&v21)
                 + *((float *)&v21 + 1)) > 0.0 )
        pPed->m_fDesiredHeading = atan2f(-(float)(p_m_transform->m_translate.x - p_tx->m_translate.x), v20.n64_f32[0]);
    }
  }
  v9 = *(_QWORD *)&this->m_pAnim;
  v7 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  v8 = HIDWORD(v9) > v7;
  HIDWORD(v9) -= v7;
  if ( !v8 )
    HIDWORD(v9) = 0;
  this->m_nTimeRemaining = HIDWORD(v9);
  if ( (_DWORD)v9 )
  {
    if ( !HIDWORD(v9) )
    {
      if ( *(_WORD *)(v9 + 44) == 21 )
      {
        CAnimBlendAssociation::SetFinishCallback((CAnimBlendAssociation *)v9, CDefaultAnimCallback::DefaultAnimCB, 0);
        v10 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_IDLE_TIRED, 4.0);
        this->m_pAnim = v10;
        CAnimBlendAssociation::SetFinishCallback(v10, CTaskSimpleChoking::DeleteAnimChokeCB, this);
        v11 = CTimer::m_snTimeInMilliseconds - this->m_nTimeStarted;
        this->m_nTimeRemaining = v11;
        if ( v11 >= (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 4000.0) + 8000 )
          m_nTimeRemaining = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 4000.0) + 8000;
        else
          m_nTimeRemaining = this->m_nTimeRemaining;
        this->m_nTimeRemaining = m_nTimeRemaining;
      }
      else
      {
        *(_DWORD *)(v9 + 28) = -1065353216;
        this->m_pAnim->m_bitsFlag |= 4u;
      }
    }
  }
  else
  {
    v13 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_CHOKING_GAS, 4.0);
    this->m_pAnim = v13;
    CAnimBlendAssociation::SetFinishCallback(v13, CTaskSimpleChoking::DeleteAnimChokeCB, this);
    m_pAnim = this->m_pAnim;
    m_pAnim->m_fSpeed = (float)((float)((float)rand() * 4.6566e-10) * 0.25) + 0.75;
  }
  v4 = 0;
  CPed::Say(pPed, 0x154u, 0, 1.0, 0, 0, 0);
  return v4;
}

//----- (004DFA7C) --------------------------------------------------------
void __fastcall CTaskSimpleChoking::UpdateChoke(CTaskSimpleChoking *this, CPed *pPed, CPed *pAttacker, bool8 isTeargas)
{
  CPed *m_pAttacker; // r0
  CPed **p_m_pAttacker; // r5
  CAnimBlendAssociation *m_pAnim; // r0
  bool v10; // zf
  CAnimBlendAssociation *v11; // r0
  CAnimBlendAssociation *v12; // r5

  p_m_pAttacker = &this->m_pAttacker;
  m_pAttacker = this->m_pAttacker;
  *((_BYTE *)p_m_pAttacker + 16) = isTeargas;
  if ( m_pAttacker != pAttacker )
  {
    if ( m_pAttacker )
      CEntity::CleanUpOldReference(m_pAttacker, p_m_pAttacker);
    *p_m_pAttacker = pAttacker;
    if ( pAttacker )
      CEntity::RegisterReference(pAttacker, p_m_pAttacker);
  }
  if ( this->m_bIsFinished )
    this->m_bIsFinished = 0;
  m_pAnim = this->m_pAnim;
  v10 = m_pAnim == 0;
  if ( m_pAnim )
    v10 = m_pAnim->m_animId == 21;
  if ( !v10 )
  {
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
    v11 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, ANIM_STD_PED, ANIM_STD_CHOKING_GAS, 4.0);
    this->m_pAnim = v11;
    CAnimBlendAssociation::SetFinishCallback(v11, CTaskSimpleChoking::DeleteAnimChokeCB, this);
    v12 = this->m_pAnim;
    v12->m_fSpeed = (float)((float)((float)rand() * 4.6566e-10) * 0.3) + 0.8;
    this->m_nTimeStarted = CTimer::m_snTimeInMilliseconds - this->m_nTimeRemaining;
  }
  this->m_nTimeRemaining = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 1000.0) + 1000;
}

//----- (004DFB78) --------------------------------------------------------
void __fastcall CTaskSimpleBeHit::CTaskSimpleBeHit(
        CTaskSimpleBeHit *this,
        CPed *pAttacker,
        const ePedPieceTypes eHitZone,
        const int nDir,
        const int nHitPower)
{
  CTaskSimple::CTaskSimple(this);
  *(_WORD *)&this->m_bIsFinished = 0;
  this->m_nAnimId = ANIM_STD_NUM;
  this->m_nAnimGroup = ANIM_STD_PED;
  this->m_eHitZone = eHitZone;
  this->m_nHitPower = nHitPower;
  this->m_nDirn = nDir;
  this->m_pAnim = 0;
  this->_vptr$CTask = (int (**)(void))&off_6697D0;
  this->m_pAttacker = pAttacker;
  if ( pAttacker )
    CEntity::RegisterReference(pAttacker, &this->m_pAttacker);
}
// 6697D0: using guessed type void *;

//----- (004DFBC8) --------------------------------------------------------
void __fastcall CTaskSimpleBeHit::~CTaskSimpleBeHit(CTaskSimpleBeHit *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CPed *m_pAttacker; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_6697D0;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  m_pAttacker = this->m_pAttacker;
  if ( m_pAttacker )
    CEntity::CleanUpOldReference(m_pAttacker, &this->m_pAttacker);
  sub_1A01F4(this);
}
// 6697D0: using guessed type void *off_6697D0;

//----- (004DFC14) --------------------------------------------------------
void __fastcall CTaskSimpleBeHit::~CTaskSimpleBeHit(CTaskSimpleBeHit *this)
{
  CAnimBlendAssociation *m_pAnim; // r0
  CPed *m_pAttacker; // r0
  void *v4; // r0

  m_pAnim = this->m_pAnim;
  this->_vptr$CTask = (int (**)(void))&off_6697D0;
  if ( m_pAnim )
  {
    m_pAnim->m_fBlendDelta = -4.0;
    CAnimBlendAssociation::SetFinishCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  m_pAttacker = this->m_pAttacker;
  if ( m_pAttacker )
    CEntity::CleanUpOldReference(m_pAttacker, &this->m_pAttacker);
  CTask::~CTask(this);
  sub_197118(v4);
}
// 4DFC56: variable 'v4' is possibly undefined
// 6697D0: using guessed type void *off_6697D0;

//----- (004DFC64) --------------------------------------------------------
bool __fastcall CTaskSimpleBeHit::MakeAbortable(
        CTaskSimpleBeHit *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CAnimBlendAssociation *v5; // r0
  bool result; // r0
  CAnimBlendAssociation *m_pAnim; // r0
  uint16 m_bitsFlag; // r1

  if ( (unsigned int)(iPriority - 1) > 1 )
  {
    m_pAnim = this->m_pAnim;
    if ( m_pAnim )
    {
      m_bitsFlag = m_pAnim->m_bitsFlag;
      if ( (m_bitsFlag & 1) == 0 )
      {
        m_pAnim->m_bitsFlag = m_bitsFlag | 4;
        this->m_pAnim->m_fBlendDelta = -4.0;
      }
    }
    return 0;
  }
  if ( pEvent && (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 3))(pEvent) < 62 )
    return 0;
  v5 = this->m_pAnim;
  if ( v5 )
  {
    CAnimBlendAssociation::SetFinishCallback(v5, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim = 0;
  }
  result = 1;
  this->m_bIsFinished = 1;
  return result;
}

//----- (004DFCBC) --------------------------------------------------------
void __fastcall CTaskSimpleBeHit::FinishAnimBeHitCB(CAnimBlendAssociation *pAnim, void *pData)
{
  *((_BYTE *)pData + 12) = 1;
  *((_DWORD *)pData + 9) = 0;
}

//----- (004DFCC8) --------------------------------------------------------
void __fastcall CTaskSimpleBeHit::StartAnim(CTaskSimpleBeHit *this, CPed *pPed)
{
  AnimationId m_nAnimId; // r2
  RpClump_0 *m_pRwObject; // r0
  CAnimBlendAssociation *Association; // r0
  CAnimBlendAssociation *v7; // r0
  int m_nDirn; // r0
  CPed *m_pAttacker; // r0
  CTaskSimpleFight *TaskFighting; // r0
  int m_nComboSet; // r1
  int m_nCurrentMove; // r0

  m_nAnimId = this->m_nAnimId;
  if ( m_nAnimId == ANIM_STD_NUM )
  {
    if ( !this->m_nDirn
      && (m_pAttacker = this->m_pAttacker) != 0
      && (TaskFighting = CPedIntelligence::GetTaskFighting(m_pAttacker->m_pPedIntelligence)) != 0
      && (m_nComboSet = TaskFighting->m_nComboSet, m_nComboSet >= 4)
      && (m_nCurrentMove = TaskFighting->m_nCurrentMove, m_nCurrentMove <= 2) )
    {
      m_nAnimId = m_nCurrentMove + 219;
      this->m_nAnimId = m_nCurrentMove + 219;
      this->m_nAnimGroup = CTaskSimpleFight::m_aComboData[m_nComboSet - 4].nAnimGroup;
    }
    else
    {
      if ( this->m_eHitZone == PED_SPHERE_CHEST )
      {
        m_nAnimId = ANIM_STD_HIT_FRONT;
      }
      else
      {
        m_nDirn = this->m_nDirn;
        switch ( m_nDirn )
        {
          case 3:
            m_nAnimId = ANIM_STD_HIT_RIGHT;
            break;
          case 2:
            m_nAnimId = ANIM_STD_HIT_BACK;
            break;
          case 1:
            m_nAnimId = ANIM_STD_HIT_LEFT;
            break;
          default:
            m_nAnimId = ANIM_STD_HIT_FRONT;
            if ( this->m_nHitPower > 5 )
              m_nAnimId = ANIM_STD_HIT_WALK;
            break;
        }
      }
      this->m_nAnimId = m_nAnimId;
    }
  }
  m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
  if ( this->m_bAnimAdded )
  {
    Association = RpAnimBlendClumpGetAssociation(m_pRwObject, m_nAnimId);
    this->m_pAnim = Association;
    if ( !Association )
    {
      this->m_bIsFinished = 1;
      return;
    }
  }
  else
  {
    v7 = CAnimManager::BlendAnimation(m_pRwObject, this->m_nAnimGroup, m_nAnimId, 8.0);
    this->m_pAnim = v7;
    CAnimBlendAssociation::SetCurrentTime(v7, 0.0);
    Association = this->m_pAnim;
    this->m_bAnimAdded = 1;
  }
  sub_18C19C(Association, CTaskSimpleBeHit::FinishAnimBeHitCB, this);
}

//----- (004DFD98) --------------------------------------------------------
bool __fastcall CTaskSimpleBeHit::ProcessPed(CTaskSimpleBeHit *this, CPed *pPed)
{
  CPed *v5; // r0
  _BOOL4 IsPlayer; // r0
  bool v7; // zf
  CPed *m_pAttacker; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v10; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1

  if ( this->m_bIsFinished )
    return 1;
  if ( !this->m_nDirn && this->m_pAttacker && !CPed::IsPlayer(pPed) )
  {
    m_pAttacker = this->m_pAttacker;
    m_pMat = pPed->m_pMat;
    v10 = m_pAttacker->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    p_x = &v10->tx;
    if ( !v10 )
      p_x = &m_pAttacker->m_transform.m_translate.x;
    pPed->m_fDesiredHeading = atan2f(-(float)(*p_x - p_tx->m_translate.x), p_x[1] - p_tx->m_translate.y);
  }
  if ( !this->m_pAnim )
  {
    v5 = this->m_pAttacker;
    if ( !v5 )
      goto LABEL_9;
    IsPlayer = CPed::IsPlayer(v5);
    v7 = IsPlayer;
    if ( IsPlayer )
      v7 = pPed->m_nPedType == 8;
    if ( !v7
      || (CPed::DisablePedSpeech(pPed, 1),
          CPed::EnablePedSpeech(pPed),
          CPed::Say(pPed, 0x10u, 0x3E8u, 1.0, 0, 0, 0) <= -1) )
    {
LABEL_9:
      CPed::Say(pPed, 0x159u, 0, 1.0, 0, 0, 0);
    }
    CTaskSimpleBeHit::StartAnim(this, pPed);
  }
  return 0;
}

//----- (004DFE80) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CTaskComplexReactToAttack::CTaskComplexReactToAttack(
        CTaskComplexReactToAttack *this,
        const eWeaponType eWeaponUsed,
        CEntity *pInflictor,
        float fDamage,
        const int iPedHitDir,
        const ePedPieceTypes eHitZone)
{
  CTaskComplex::CTaskComplex(this);
  *(_WORD *)&this->m_bNewTarget = 0;
  this->m_eWeaponUsed = eWeaponUsed;
  this->m_fDamage = fDamage;
  *(_QWORD *)&this->m_iPedHitDir = *(_QWORD *)&iPedHitDir;
  this->_vptr$CTask = (int (**)(void))&off_669804;
  this->m_pInflictor = pInflictor;
  if ( pInflictor )
    CEntity::RegisterReference(pInflictor, &this->m_pInflictor);
}
// 4DFE80: variables would overlap: ^18.4 and ^18.8
// 669804: using guessed type void *;

//----- (004DFECC) --------------------------------------------------------
void __fastcall CTaskComplexReactToAttack::~CTaskComplexReactToAttack(CTaskComplexReactToAttack *this)
{
  CEntity *m_pInflictor; // r0
  CEntity **p_m_pInflictor; // r1

  p_m_pInflictor = &this->m_pInflictor;
  m_pInflictor = this->m_pInflictor;
  this->_vptr$CTask = (int (**)(void))&off_669804;
  if ( m_pInflictor )
    CEntity::CleanUpOldReference(m_pInflictor, p_m_pInflictor);
  sub_18EDB4(this);
}
// 669804: using guessed type void *off_669804;

//----- (004DFEF8) --------------------------------------------------------
void __fastcall CTaskComplexReactToAttack::~CTaskComplexReactToAttack(CTaskComplexReactToAttack *this)
{
  CEntity *m_pInflictor; // r0
  CEntity **p_m_pInflictor; // r1
  void *v4; // r0

  p_m_pInflictor = &this->m_pInflictor;
  m_pInflictor = this->m_pInflictor;
  this->_vptr$CTask = (int (**)(void))&off_669804;
  if ( m_pInflictor )
    CEntity::CleanUpOldReference(m_pInflictor, p_m_pInflictor);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4DFF20: variable 'v4' is possibly undefined
// 669804: using guessed type void *off_669804;

//----- (004DFF28) --------------------------------------------------------
bool __fastcall CTaskComplexReactToAttack::MakeAbortable(
        CTaskComplexReactToAttack *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  bool result; // r0

  if ( this->m_bHasAborted )
    return 1;
  if ( (unsigned int)(iPriority - 1) > 1 )
    return 0;
  result = (*((int (__fastcall **)(CTask *, CPed *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
             this->m_pSubTask,
             pPed);
  this->m_bHasAborted = result;
  return result;
}

//----- (004DFF4E) --------------------------------------------------------
CTask *__fastcall CTaskComplexReactToAttack::CreateNextSubTask(CTaskComplexReactToAttack *this, CPed *pPed)
{
  if ( !this->m_bHasAborted )
    (*((void (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  return 0;
}

//----- (004DFF6C) --------------------------------------------------------
CTask *__fastcall CTaskComplexReactToAttack::CreateSubTask(CTaskComplexReactToAttack *this, int iSubTaskType)
{
  int m_iPedHitDir; // r5
  CTaskComplexFallAndGetUp *v4; // r0
  AnimationId v5; // r1
  void *v6; // r4
  CEntity *m_pInflictor; // r0
  CTaskSimple *v8; // r0
  CEntity *v9; // r6
  __int64 v10; // r8
  float m_fDamage; // s16
  CTaskSimple *v12; // r0
  __int64 v13; // kr00_8
  float v14; // s16

  switch ( iSubTaskType )
  {
    case 200:
      v6 = CTask::operator new(8u);
      CTaskSimple::CTaskSimple((CTaskSimple *)v6);
      *(_DWORD *)v6 = &off_668FF0;
      break;
    case 1008:
      m_pInflictor = this->m_pInflictor;
      if ( m_pInflictor && (*(_BYTE *)&m_pInflictor->m_info & 7) == 3 )
      {
        v8 = (CTaskSimple *)CTask::operator new(0x28u);
        v9 = this->m_pInflictor;
        v6 = v8;
        v10 = *(_QWORD *)&this->m_iPedHitDir;
        m_fDamage = this->m_fDamage;
        CTaskSimple::CTaskSimple(v8);
        *((_WORD *)v6 + 6) = 0;
        *((_DWORD *)v6 + 4) = 191;
        *((_DWORD *)v6 + 5) = 0;
        *((_DWORD *)v6 + 6) = HIDWORD(v10);
        *((_QWORD *)v6 + 4) = (unsigned int)v10;
        *(_DWORD *)v6 = &off_6697D0;
        *((_DWORD *)v6 + 7) = (int)m_fDamage;
        *((_DWORD *)v6 + 2) = v9;
        if ( v9 )
          CEntity::RegisterReference(v9, (CEntity **)v6 + 2);
      }
      else
      {
        v12 = (CTaskSimple *)CTask::operator new(0x28u);
        v13 = *(_QWORD *)&this->m_iPedHitDir;
        v6 = v12;
        v14 = this->m_fDamage;
        CTaskSimple::CTaskSimple(v12);
        *((_DWORD *)v6 + 2) = 0;
        *((_WORD *)v6 + 6) = 0;
        *((_DWORD *)v6 + 4) = 191;
        *((_DWORD *)v6 + 5) = 0;
        *((_DWORD *)v6 + 6) = HIDWORD(v13);
        *((_QWORD *)v6 + 4) = (unsigned int)v13;
        *(_DWORD *)v6 = &off_6697D0;
        *((_DWORD *)v6 + 7) = (int)v14;
      }
      break;
    case 208:
      m_iPedHitDir = this->m_iPedHitDir;
      v4 = (CTaskComplexFallAndGetUp *)CTask::operator new(0x18u);
      if ( m_iPedHitDir == 2 )
        v5 = ANIM_STD_HIGHIMPACT_BACK;
      else
        v5 = ANIM_STD_KO_SHOT_STOMACH;
      v6 = v4;
      CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp(v4, v5, ANIM_STD_PED, 1000);
      break;
    default:
      return 0;
  }
  return (CTask *)v6;
}
// 668FF0: using guessed type void *off_668FF0;
// 6697D0: using guessed type void *off_6697D0;

//----- (004E0074) --------------------------------------------------------
CTask *__fastcall CTaskComplexReactToAttack::CreateFirstSubTask(CTaskComplexReactToAttack *this, CPed *pPed)
{
  CPad *Pad; // r6
  eWeaponType m_eWeaponUsed; // r0
  bool v6; // zf
  CSimpleTransform *p_m_transform; // r6
  float v8; // s2
  float v9; // s0
  float v10; // s4
  float v11; // s4
  CTask *result; // r0
  bool v13; // zf
  CTaskSimple *v14; // r0
  int m_iPedHitDir; // r4
  CTaskComplexFallAndGetUp *v16; // r0
  AnimationId v17; // r1
  bool v18; // zf
  bool v19; // zf
  CVector v20; // 0:r1.12

  this->m_bNewTarget = 0;
  if ( CPed::IsPlayer(pPed) && this->m_eWeaponUsed >= WEAPONTYPE_DILDO1 )
  {
    Pad = CPad::GetPad(0);
    if ( !Pad->DisablePlayerControls )
    {
      if ( CPad::GetTarget(Pad, 0) )
        goto LABEL_25;
      v13 = Pad->NewState.LeftStickX == 0;
      if ( !Pad->NewState.LeftStickX )
        v13 = Pad->NewState.LeftStickY == 0;
      if ( !v13 )
        goto LABEL_25;
      v18 = Pad->NewState.DPadUp == 0;
      if ( !Pad->NewState.DPadUp )
        v18 = Pad->NewState.DPadDown == 0;
      if ( !v18 )
        goto LABEL_25;
      v19 = Pad->NewState.DPadLeft == 0;
      if ( !Pad->NewState.DPadLeft )
        v19 = Pad->NewState.DPadRight == 0;
      if ( !v19 )
      {
LABEL_25:
        v14 = (CTaskSimple *)CTask::operator new(8u);
        CTaskSimple::CTaskSimple(v14);
        result->_vptr$CTask = (int (**)(void))&off_668FF0;
        return result;
      }
    }
  }
  if ( this->m_eHitZone != PED_SPHERE_CHEST )
    return CTaskComplexReactToAttack::CreateSubTask(this, 1008);
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 7) & 4) != 0 )
  {
    m_eWeaponUsed = this->m_eWeaponUsed;
    v6 = m_eWeaponUsed == WEAPONTYPE_SPAS12_SHOTGUN;
    if ( m_eWeaponUsed != WEAPONTYPE_SPAS12_SHOTGUN )
      v6 = m_eWeaponUsed == WEAPONTYPE_SHOTGUN;
    if ( v6 )
      goto LABEL_12;
    if ( m_eWeaponUsed != WEAPONTYPE_DESERT_EAGLE )
      goto LABEL_18;
    if ( !CPed::IsPlayer(pPed) )
    {
LABEL_12:
      LODWORD(v20.x) = this->m_pInflictor;
      LODWORD(v20.y) = pPed->m_pMat;
      v20.z = *(RwReal *)(LODWORD(v20.x) + 20);
      p_m_transform = (CSimpleTransform *)(LODWORD(v20.y) + 48);
      if ( !LODWORD(v20.y) )
        p_m_transform = &pPed->m_transform;
      LODWORD(v20.y) = LODWORD(v20.z) + 48;
      if ( !LODWORD(v20.z) )
        LODWORD(v20.y) = LODWORD(v20.x) + 4;
      v20.z = 5.0;
      v8 = *(float *)LODWORD(v20.y) - p_m_transform->m_translate.x;
      v9 = *(float *)(LODWORD(v20.y) + 4) - p_m_transform->m_translate.y;
      v10 = (float)(v8 * v8) + (float)(v9 * v9);
      if ( v10 <= 0.0 )
      {
        v20.x = -5.0;
      }
      else
      {
        v11 = 1.0 / sqrtf(v10);
        v9 = v9 * v11;
        v20.x = (float)(v8 * v11) * -5.0;
      }
      *(_DWORD *)&pPed->m_nPedFlags &= ~1u;
      v20.y = v9 * -5.0;
      CPhysical::ApplyMoveForce(pPed, v20);
      goto LABEL_28;
    }
  }
  m_eWeaponUsed = this->m_eWeaponUsed;
LABEL_18:
  if ( m_eWeaponUsed > WEAPONTYPE_KATANA || pPed->m_nHealth >= 30.0 )
    return CTaskComplexReactToAttack::CreateSubTask(this, 1008);
LABEL_28:
  m_iPedHitDir = this->m_iPedHitDir;
  v16 = (CTaskComplexFallAndGetUp *)CTask::operator new(0x18u);
  if ( m_iPedHitDir == 2 )
    v17 = ANIM_STD_HIGHIMPACT_BACK;
  else
    v17 = ANIM_STD_KO_SHOT_STOMACH;
  CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp(v16, v17, ANIM_STD_PED, 1000);
  return result;
}
// 4E0194: variable 'result' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;

//----- (004E01FC) --------------------------------------------------------
CTask *__fastcall CTaskComplexReactToAttack::ControlSubTask(CTaskComplexReactToAttack *this, CPed *pPed)
{
  if ( this->m_bNewTarget )
    return (CTask *)(*((int (__fastcall **)(CTaskComplexReactToAttack *, CPed *))this->_vptr$CTask + 11))(this, pPed);
  (*((void (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  return this->m_pSubTask;
}

//----- (004E0220) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(
        CTaskComplexKillPedOnFoot *this,
        CPed *pTargetPed,
        int32 nDuration,
        uint32 nDuckingConditions,
        uint32 nTimeToDuck,
        uint32 nPercentageDuckChance,
        Int32 nCompetence)
{
  char v11; // r0
  char v12; // r0
  uint32 v13; // r1

  CTaskComplex::CTaskComplex(this);
  this->m_nDuckingConditions = nDuckingConditions;
  this->m_nTimeToDuck = nTimeToDuck;
  this->m_nPercentageDuckChance = nPercentageDuckChance;
  this->m_nCompetence = nCompetence;
  this->m_nDuration = nDuration;
  v11 = *((_BYTE *)this + 12);
  *(_WORD *)&this->m_RoomToLeaveCarTimer.m_bIsActive = 0;
  this->m_RoomToLeaveCarTimer.m_iStartTime = 0;
  this->m_RoomToLeaveCarTimer.m_iDuration = 0;
  v12 = v11 & 0x8B | 4;
  *((_BYTE *)this + 12) = v12;
  this->_vptr$CTask = (int (**)(void))&off_669840;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
  {
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
    v12 = *((_BYTE *)this + 12);
  }
  v13 = CTimer::m_snTimeInMilliseconds;
  *((_BYTE *)this + 12) = v12 & 0xF7;
  this->m_nStartTime = v13;
}
// 669840: using guessed type void *;

//----- (004E029C) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootStealth::~CTaskComplexKillPedOnFootStealth(CTaskComplexKillPedOnFoot *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669840;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  sub_18EDB4(this);
}
// 669840: using guessed type void *off_669840;

//----- (004E02C8) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFoot::~CTaskComplexKillPedOnFoot(CTaskComplexKillPedOnFoot *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  void *v4; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669840;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E02F0: variable 'v4' is possibly undefined
// 669840: using guessed type void *off_669840;

//----- (004E02F8) --------------------------------------------------------
bool __fastcall CTaskComplexKillPedOnFoot::MakeAbortable(
        CTaskComplexKillPedOnFoot *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CTask *m_pSubTask; // r0

  *((_DWORD *)&pPed->m_nPedFlags + 2) &= ~0x400000u;
  m_pSubTask = this->m_pSubTask;
  if ( m_pSubTask )
    return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))m_pSubTask->_vptr$CTask + 7))(
             m_pSubTask,
             pPed,
             iPriority,
             pEvent);
  else
    return 1;
}

//----- (004E0318) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFoot::AbortIK(CTaskComplexKillPedOnFoot *this, CPed *pPed)
{
  *((_DWORD *)&pPed->m_nPedFlags + 2) &= ~0x400000u;
}

//----- (004E0328) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFoot::CreateNextSubTask(CTaskComplexKillPedOnFoot *this, CPed *pPed)
{
  int v4; // r0
  CTaskComplexLeaveCar *v5; // r6
  CPed *m_pTargetPed; // r5
  CPed *v7; // r2
  CMatrix *m_pMat; // r1
  CMatrix *v9; // r3
  CSimpleTransform *p_tx; // r0
  float *p_x; // r1
  float x; // s16
  float y; // s20
  float z; // s18
  float v15; // s22
  float v16; // s26
  float v17; // s24
  CTaskComplexKillPedOnFoot *v18; // r0
  int v19; // r1
  _BOOL4 IsTypeMelee; // r0
  int (**v21)(void); // r0
  int v23; // r2
  int v24; // r3
  int v25; // r1
  CPhysical *m_pGroundPhysical; // r0
  bool v27; // zf
  unsigned int m_nPedType; // r0
  bool v29; // cc
  CTaskSimpleStandStill *v30; // r0
  char v31; // r4
  int v32; // r2
  CTaskSimpleStandStill v33; // [sp+8h] [bp-68h] BYREF

  if ( !this->m_pTargetPed )
    goto LABEL_36;
  v4 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  v5 = 0;
  if ( v4 > 718 )
  {
    if ( (unsigned int)(v4 - 1001) >= 2 && v4 != 1003 )
    {
      if ( v4 == 719 )
      {
        v5 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
        CTaskComplexLeaveCar::CTaskComplexLeaveCar(v5, pPed->m_pMyVehicle, 0, 0, 1, 1);
      }
      return v5;
    }
    goto LABEL_36;
  }
  if ( v4 > 202 )
  {
    if ( v4 != 203 )
    {
      if ( v4 == 703 )
      {
        if ( ((int)this->m_pSubTask[2]._vptr$CTask & 4) == 0 )
          goto LABEL_30;
        v19 = 1003;
        goto LABEL_40;
      }
      if ( v4 == 704 )
      {
        if ( CPed::IsPlayer(this->m_pTargetPed) )
          m_pTargetPed = this->m_pTargetPed;
        else
          m_pTargetPed = 0;
        if ( !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
        {
          v7 = this->m_pTargetPed;
          m_pMat = pPed->m_pMat;
          v9 = v7->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &pPed->m_transform;
          p_x = &v9->tx;
          if ( !v9 )
            p_x = &v7->m_transform.m_translate.x;
          if ( !v7 )
            goto LABEL_30;
          x = p_tx->m_translate.x;
          y = p_tx->m_translate.y;
          z = p_tx->m_translate.z;
          v15 = *p_x;
          v16 = p_x[1];
          v17 = p_x[2];
          if ( CCullZones::NoPolice() )
          {
            if ( !m_pTargetPed )
            {
LABEL_30:
              IsTypeMelee = CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]);
              v19 = 1002;
              if ( IsTypeMelee )
                v19 = 1001;
              goto LABEL_40;
            }
          }
          else
          {
            m_pGroundPhysical = this->m_pTargetPed->m_pGroundPhysical;
            v27 = m_pGroundPhysical == 0;
            if ( m_pGroundPhysical )
              v27 = m_pTargetPed == 0;
            if ( v27
              || sqrtf(
                   (float)((float)((float)(v15 - x) * (float)(v15 - x)) + (float)((float)(v16 - y) * (float)(v16 - y)))
                 + (float)((float)(v17 - z) * (float)(v17 - z))) >= 5.0
              || m_pGroundPhysical == pPed->m_pGroundPhysical )
            {
              goto LABEL_30;
            }
          }
          if ( *((unsigned __int8 *)&dword_34 + *(int *)((char *)&elf_hash_bucket[210] + (_DWORD)m_pTargetPed)) << 31 )
          {
            m_nPedType = pPed->m_nPedType;
            v29 = m_nPedType > 6;
            if ( m_nPedType != 6 )
              v29 = m_nPedType - 7 > 9;
            if ( !v29 && pPed->CharCreatedBy != 2 )
            {
              CPed::GiveWeapon(pPed, WEAPONTYPE_PISTOL, 0x3E8u, 1);
              CPed::SetCurrentWeapon(pPed, WEAPONTYPE_PISTOL);
              CPed::SetMoveState(pPed, PEDMOVE_STILL);
            }
          }
          goto LABEL_30;
        }
        v19 = 719;
LABEL_40:
        v18 = this;
        return CTaskComplexKillPedOnFoot::CreateSubTask(v18, v19, pPed);
      }
      return v5;
    }
LABEL_36:
    v5 = 0;
    v23 = *((_DWORD *)&pPed->m_nPedFlags + 2);
    v24 = *((_DWORD *)&pPed->m_nPedFlags + 3);
    v25 = *((_DWORD *)&pPed->m_nPedFlags + 1);
    *(_DWORD *)&pPed->m_nPedFlags = pPed->m_nPedFlags;
    *((_DWORD *)&pPed->m_nPedFlags + 1) = v25;
    *((_DWORD *)&pPed->m_nPedFlags + 2) = v23 & 0xFFBFFFFF;
    *((_DWORD *)&pPed->m_nPedFlags + 3) = v24;
    return v5;
  }
  if ( v4 == 200 )
    goto LABEL_36;
  if ( v4 != 202 )
    return v5;
  if ( pPed->m_nPedType != 6 || !LOBYTE(pPed[1]._vptr$CPlaceable) )
  {
    if ( (*((_BYTE *)this + 12) & 0x60) == 96 && (*((_BYTE *)FindPlayerWanted(-1) + 30) & 4) == 0 )
    {
      v21 = this->_vptr$CTask;
      *((_BYTE *)this + 12) &= ~0x40u;
      return (CTask *)((int (__fastcall *)(CTaskComplexKillPedOnFoot *, CPed *))v21[11])(this, pPed);
    }
    goto LABEL_36;
  }
  if ( !FindPlayerWanted(-1)->m_nChanceOnRoadBlock )
  {
    CTaskSimpleStandStill::CTaskSimpleStandStill(&v33, 0, 0, 0, 8.0);
    CTaskSimpleStandStill::ProcessPed(v30, pPed);
    v31 = *((_BYTE *)this + 12);
    v5 = (CTaskComplexLeaveCar *)CTask::operator new(0x18u);
    CTaskSimple::CTaskSimple((CTaskSimple *)v5);
    v32 = 10000;
    LOWORD(v5->m_iTargetDoor) = 0;
    if ( (v31 & 0x60) != 96 )
      v32 = 2000;
    v5->m_iDelayTime = v32;
    v5->m_pSubTask = 0;
    v5->m_pTargetVehicle = 0;
    v5->_vptr$CTask = (int (**)(void))&off_665750;
    CTaskSimpleStandStill::~CTaskSimpleStandStill(&v33);
    return v5;
  }
  v18 = this;
  v19 = 1002;
  return CTaskComplexKillPedOnFoot::CreateSubTask(v18, v19, pPed);
}
// 4E05B8: variable 'v30' is possibly undefined
// 34: using guessed type int dword_34;
// FC: using guessed type int elf_hash_bucket[16411];
// 665750: using guessed type void *off_665750;

//----- (004E0600) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFoot::CreateSubTask(
        CTaskComplexKillPedOnFoot *this,
        int iSubTaskType,
        CPed *pPed)
{
  char *v5; // r4
  CPed *v6; // r6
  uint32 m_nDuckingConditions; // r8
  uint32 m_nTimeToDuck; // r9
  uint32 m_nPercentageDuckChance; // r10
  int8 m_nCompetence; // r11
  CTaskSimpleStandStill *v11; // r0
  char v12; // r5
  int v13; // r2
  void **v14; // r0
  CPed *v15; // r6
  int v16; // r0
  CVehicle *m_pMyVehicle; // r5
  CPlayerPed *m_pTargetPed; // r4
  CPedGroup *PedsGroup; // r0
  CPlayerPed *Leader; // r4
  float v21; // s16
  CTaskSimpleStandStill v23; // [sp+10h] [bp-48h] BYREF

  v5 = 0;
  if ( iSubTaskType > 718 )
  {
    if ( iSubTaskType > 1002 )
    {
      switch ( iSubTaskType )
      {
        case 1003:
          v5 = (char *)CTask::operator new(0x20u);
          m_pMyVehicle = this->m_pTargetPed->m_pMyVehicle;
          CTaskComplex::CTaskComplex((CTaskComplex *)v5);
          *(_DWORD *)v5 = &off_669964;
          *((_DWORD *)v5 + 5) = 0;
          *((_DWORD *)v5 + 6) = 0;
          *((_DWORD *)v5 + 7) = 0;
          *((_DWORD *)v5 + 4) = m_pMyVehicle;
          if ( m_pMyVehicle )
            CEntity::RegisterReference(m_pMyVehicle, (CEntity **)v5 + 4);
          break;
        case 1210:
          m_pTargetPed = (CPlayerPed *)this->m_pTargetPed;
          if ( m_pTargetPed == FindPlayerPed(0) )
          {
            CPed::Say(pPed, 0x103u, 0, 1.0, 0, 0, 0);
          }
          else if ( !CPedGroups::GetPedsGroup(this->m_pTargetPed)
                 || (PedsGroup = CPedGroups::GetPedsGroup(this->m_pTargetPed),
                     Leader = (CPlayerPed *)CPedGroupMembership::GetLeader(&PedsGroup->m_membership),
                     Leader != FindPlayerPed(0)) )
          {
            CPed::Say(pPed, 0x102u, 0, 1.0, 0, 0, 0);
          }
          v21 = (float)((float)(unsigned __int16)rand() * 0.000015259) * 1500.0;
          v5 = (char *)CTask::operator new(0x18u);
          CTaskComplexSignalAtPed::CTaskComplexSignalAtPed(
            (CTaskComplexSignalAtPed *)v5,
            this->m_pTargetPed,
            (int)v21,
            1u);
          break;
        case 1302:
          *((_DWORD *)&pPed->m_nPedFlags + 2) &= ~0x400000u;
          return 0;
      }
      return (CTask *)v5;
    }
    if ( iSubTaskType != 719 )
    {
      if ( iSubTaskType == 1001 )
      {
        v5 = (char *)CTask::operator new(0x38u);
        v15 = this->m_pTargetPed;
        CTaskComplex::CTaskComplex((CTaskComplex *)v5);
        *((_QWORD *)v5 + 2) = 0LL;
        *((_QWORD *)v5 + 3) = 0LL;
        *((_DWORD *)v5 + 8) = 0;
        *((_DWORD *)v5 + 9) = 0;
        *((_DWORD *)v5 + 10) = -1;
        *((_DWORD *)v5 + 11) = 0;
        *((_DWORD *)v5 + 13) = -1;
        *((_WORD *)v5 + 24) = 0;
        *(_DWORD *)v5 = &off_6698B8;
        *((_DWORD *)v5 + 3) = v15;
        if ( v15 )
          CEntity::RegisterReference(v15, (CEntity **)v5 + 3);
        goto LABEL_30;
      }
      if ( iSubTaskType == 1002 )
      {
        v5 = (char *)CTask::operator new(0x5Cu);
        v6 = this->m_pTargetPed;
        m_nDuckingConditions = this->m_nDuckingConditions;
        m_nTimeToDuck = this->m_nTimeToDuck;
        m_nPercentageDuckChance = this->m_nPercentageDuckChance;
        m_nCompetence = this->m_nCompetence;
        CTaskComplex::CTaskComplex((CTaskComplex *)v5);
        *((_QWORD *)v5 + 7) = 0LL;
        *((_QWORD *)v5 + 8) = 3323739136LL;
        *((_DWORD *)v5 + 4) = 0;
        *((_DWORD *)v5 + 5) = 0;
        *((_DWORD *)v5 + 6) = 0;
        *((_DWORD *)v5 + 7) = m_nDuckingConditions;
        *((_DWORD *)v5 + 8) = m_nTimeToDuck;
        *((_DWORD *)v5 + 9) = m_nPercentageDuckChance;
        *((_DWORD *)v5 + 10) = 0;
        *((_DWORD *)v5 + 11) = 0;
        v5[48] = m_nCompetence;
        *(_DWORD *)(v5 + 50) = 0;
        *((_DWORD *)v5 + 18) = 0;
        *((_DWORD *)v5 + 19) = -971228160;
        *((_DWORD *)v5 + 20) = 0;
        *((_DWORD *)v5 + 21) = 0;
        *((_DWORD *)v5 + 22) = 0;
        *(_DWORD *)v5 = &off_6698F4;
        *((_DWORD *)v5 + 3) = v6;
        if ( v6 )
          CEntity::RegisterReference(v6, (CEntity **)v5 + 3);
        v5[53] = (*((_BYTE *)this + 12) & 0x10) != 0;
        *((_BYTE *)this + 12) &= ~0x10u;
        goto LABEL_30;
      }
      return (CTask *)v5;
    }
    v5 = (char *)CTask::operator new(0x70u);
    CTaskSimpleCarDrive::CTaskSimpleCarDrive((CTaskSimpleCarDrive *)v5, pPed->m_pMyVehicle, 0, 0);
    *((_DWORD *)v5 + 24) = 2000;
    v14 = &`vtable for'CTaskSimpleCarDriveTimed;
    *((_WORD *)v5 + 54) = 0;
    *((_DWORD *)v5 + 25) = 0;
    *((_DWORD *)v5 + 26) = 0;
LABEL_38:
    *(_DWORD *)v5 = (char *)*v14 + 8;
    return (CTask *)v5;
  }
  if ( iSubTaskType <= 202 )
  {
    if ( iSubTaskType != 200 )
    {
      if ( iSubTaskType == 202 )
      {
        CTaskSimpleStandStill::CTaskSimpleStandStill(&v23, 0, 0, 0, 8.0);
        CTaskSimpleStandStill::ProcessPed(v11, pPed);
        v12 = *((_BYTE *)this + 12);
        v5 = (char *)CTask::operator new(0x18u);
        CTaskSimple::CTaskSimple((CTaskSimple *)v5);
        v13 = 10000;
        *((_WORD *)v5 + 8) = 0;
        if ( (v12 & 0x60) != 96 )
          v13 = 2000;
        *((_DWORD *)v5 + 5) = v13;
        *((_DWORD *)v5 + 2) = 0;
        *((_DWORD *)v5 + 3) = 0;
        *(_DWORD *)v5 = &off_665750;
        CTaskSimpleStandStill::~CTaskSimpleStandStill(&v23);
      }
      return (CTask *)v5;
    }
    v5 = (char *)CTask::operator new(8u);
    CTaskSimple::CTaskSimple((CTaskSimple *)v5);
    v14 = &`vtable for'CTaskSimpleNone;
    goto LABEL_38;
  }
  switch ( iSubTaskType )
  {
    case 203:
      v5 = (char *)CTask::operator new(0x20u);
      CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v5, 0, 0, 0, 8.0);
      break;
    case 703:
      v5 = (char *)CTask::operator new(0x54u);
      CTaskComplexDragPedFromCar::CTaskComplexDragPedFromCar((CTaskComplexDragPedFromCar *)v5, this->m_pTargetPed, 0);
LABEL_30:
      v16 = CTimer::m_snTimeInMilliseconds;
      this->m_RoomToLeaveCarTimer.m_bIsActive = 1;
      this->m_RoomToLeaveCarTimer.m_iStartTime = v16;
      this->m_RoomToLeaveCarTimer.m_iDuration = 2000;
      return (CTask *)v5;
    case 704:
      v5 = (char *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar((CTaskComplexLeaveCar *)v5, pPed->m_pMyVehicle, 0, 0, 1, 1);
      break;
  }
  return (CTask *)v5;
}
// 4E075A: variable 'v11' is possibly undefined
// 665750: using guessed type void *off_665750;
// 6698B8: using guessed type void *;
// 6698F4: using guessed type void *;
// 669964: using guessed type void *off_669964;
// 676B38: using guessed type void *`vtable for'CTaskSimpleCarDriveTimed;
// 678150: using guessed type void *`vtable for'CTaskSimpleNone;

//----- (004E098C) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFoot::CreateFirstSubTask(CTaskComplexKillPedOnFoot *this, CPed *pPed)
{
  char v4; // r1
  CPed *m_pTargetPed; // r0
  char v6; // r1
  CMatrix *m_pMat; // r1
  CMatrix *v8; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float x; // s16
  float y; // s20
  float z; // s18
  float v14; // s22
  float v15; // s26
  float v16; // s24
  CPed *v17; // r6
  CVehicle *m_pMyVehicle; // r0
  bool v19; // zf
  CPhysical *m_pGroundPhysical; // r0
  unsigned int m_nPedType; // r0
  bool v22; // cc
  CPed *v23; // r1
  bool v24; // zf
  const CVehicle *v25; // r0
  CPed *v26; // r8
  __int64 v27; // r0
  CTaskComplexLeaveCar *SubTask; // r6
  _BOOL4 IsDriver; // r0
  CPed *v30; // r0
  CVehicle *v31; // r1
  float v32; // s0
  float v33; // s2
  const CVehicle *v34; // r0
  CPed *v35; // r1
  const CVehicle *v36; // r6
  int32 m_baseVehicleType; // r0
  int v38; // r1
  CTaskComplexKillPedOnFoot *v39; // r0
  int v41; // r0
  _BOOL4 IsRoomForPedToLeaveCar; // r0

  v4 = *((_BYTE *)this + 12);
  m_pTargetPed = this->m_pTargetPed;
  v6 = v4 & 0xF9;
  *((_BYTE *)this + 12) = v6 | 4;
  if ( m_pTargetPed )
  {
    if ( m_pTargetPed->m_nHealth <= 0.0 )
      *((_BYTE *)this + 12) = v6 | 0xC;
    m_pMat = pPed->m_pMat;
    v8 = m_pTargetPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    p_x = &v8->tx;
    x = p_tx->m_translate.x;
    y = p_tx->m_translate.y;
    z = p_tx->m_translate.z;
    if ( !v8 )
      p_x = &m_pTargetPed->m_transform.m_translate.x;
    v14 = *p_x;
    v15 = p_x[1];
    v16 = p_x[2];
    if ( CPed::IsPlayer(m_pTargetPed) )
      v17 = this->m_pTargetPed;
    else
      v17 = 0;
    m_pMyVehicle = pPed->m_pMyVehicle;
    v19 = m_pMyVehicle == 0;
    if ( m_pMyVehicle )
      v19 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
    if ( !v19 )
    {
      SubTask = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar(SubTask, pPed->m_pMyVehicle, 0, 0, 1, 1);
LABEL_48:
      CPed::DropEntityThatThisPedIsHolding(pPed, 1u);
      return SubTask;
    }
    if ( v17 )
    {
      if ( CCullZones::NoPolice()
        || (m_pGroundPhysical = this->m_pTargetPed->m_pGroundPhysical) != 0
        && sqrtf(
             (float)((float)((float)(v14 - x) * (float)(v14 - x)) + (float)((float)(v15 - y) * (float)(v15 - y)))
           + (float)((float)(v16 - z) * (float)(v16 - z))) < 5.0
        && m_pGroundPhysical != pPed->m_pGroundPhysical )
      {
        if ( *((unsigned __int8 *)&dword_34 + *(int *)((char *)&elf_hash_bucket[210] + (_DWORD)v17)) << 31 )
        {
          m_nPedType = pPed->m_nPedType;
          v22 = m_nPedType > 6;
          if ( m_nPedType != 6 )
            v22 = m_nPedType - 7 > 9;
          if ( !v22 && pPed->CharCreatedBy != 2 )
          {
            CPed::GiveWeapon(pPed, WEAPONTYPE_PISTOL, 0x3E8u, 1);
            CPed::SetCurrentWeapon(pPed, WEAPONTYPE_PISTOL);
            CPed::SetMoveState(pPed, PEDMOVE_STILL);
          }
        }
      }
    }
    v23 = this->m_pTargetPed;
    v25 = (const CVehicle *)(*((unsigned __int8 *)&v23->m_nPedFlags + 1) << 31);
    v24 = v25 == 0;
    if ( v25 )
    {
      v25 = v23->m_pMyVehicle;
      v24 = v25 == 0;
    }
    if ( v24
      || (IsDriver = CVehicle::IsDriver(v25, v23),
          !IsDriver && !CVehicle::IsPassenger(this->m_pTargetPed->m_pMyVehicle, this->m_pTargetPed)) )
    {
      if ( CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]) )
      {
        SubTask = (CTaskComplexLeaveCar *)CTask::operator new(0x38u);
        v26 = this->m_pTargetPed;
        CTaskComplex::CTaskComplex(SubTask);
        *(_QWORD *)&SubTask->m_iTargetDoor = 0LL;
        *(_QWORD *)&SubTask->m_bSensibleLeaveCar = 0LL;
        *(_DWORD *)&SubTask->m_nDoorFlagsSet = 0;
        SubTask->m_dieAnim = ANIM_STD_WALK;
        SubTask->m_fDieAnimBlendDelta = NAN;
        SubTask->m_fDieAnimSpeed = 0.0;
        SubTask[1]._vptr$CTask = (int (**)(void))-1;
        *(_WORD *)&SubTask->m_bIsInAir = 0;
        SubTask->_vptr$CTask = (int (**)(void))&off_6698B8;
        SubTask->m_pTargetVehicle = (CVehicle *)v26;
        if ( v26 )
          CEntity::RegisterReference(v26, &SubTask->m_pTargetVehicle);
        v27 = CTimer::m_snTimeInMilliseconds | 0x7D000000000LL;
        this->m_RoomToLeaveCarTimer.m_bIsActive = 1;
        *(_QWORD *)&this->m_RoomToLeaveCarTimer.m_iStartTime = v27;
        goto LABEL_48;
      }
      v39 = this;
      v38 = 1002;
      goto LABEL_47;
    }
    v30 = this->m_pTargetPed;
    v31 = v30->m_pMyVehicle;
    v32 = v31->m_vecMoveSpeed.x;
    v33 = v31->m_vecMoveSpeed.y;
    *((_BYTE *)this + 12) |= 4u;
    v34 = v30->m_pMyVehicle;
    if ( (unsigned int)(v34->m_vehicleType - 3) < 2
      || (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0
      || sqrtf((float)(v32 * v32) + (float)(v33 * v33)) > 0.1
      || !CVehicle::CanPedOpenLocks(v34, pPed) )
    {
      goto LABEL_45;
    }
    v35 = this->m_pTargetPed;
    v36 = v35->m_pMyVehicle;
    m_baseVehicleType = v36->m_baseVehicleType;
    if ( m_baseVehicleType == 9 )
    {
      if ( !CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]) )
        goto LABEL_45;
      v35 = this->m_pTargetPed;
      v36 = v35->m_pMyVehicle;
      m_baseVehicleType = v36->m_baseVehicleType;
    }
    if ( m_baseVehicleType != 5 )
    {
      v41 = CCarEnterExit::ComputeTargetDoorToExit(v36, v35);
      IsRoomForPedToLeaveCar = CCarEnterExit::IsRoomForPedToLeaveCar(v36, v41, 0);
      *((_BYTE *)this + 12) = *((_BYTE *)this + 12) & 0xFB | (4 * IsRoomForPedToLeaveCar);
      v38 = 1003;
      if ( IsRoomForPedToLeaveCar && (*((_BYTE *)&this->m_pTargetPed->m_nPedFlags + 3) & 0x20) == 0 )
        v38 = 703;
      v39 = this;
      goto LABEL_47;
    }
LABEL_45:
    v38 = 1003;
    v39 = this;
LABEL_47:
    SubTask = (CTaskComplexLeaveCar *)CTaskComplexKillPedOnFoot::CreateSubTask(v39, v38, pPed);
    goto LABEL_48;
  }
  SubTask = 0;
  *((_DWORD *)&pPed->m_nPedFlags + 2) &= ~0x400000u;
  return SubTask;
}
// 34: using guessed type int dword_34;
// FC: using guessed type int elf_hash_bucket[16411];
// 6698B8: using guessed type void *off_6698B8;

//----- (004E0C70) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFoot::ControlSubTask(CTaskComplexKillPedOnFoot *this, CPed *pPed)
{
  int v4; // r9
  int32 m_nDuration; // r0
  int m_pEntityStandingOn; // r0
  CTaskSimpleStandStill *v7; // r0
  CTask *result; // r0
  CPed *m_pTargetPed; // r0
  CTask *m_pSubTask; // r0
  CTaskSimple *v11; // r0
  int v12; // r0
  CPed *v13; // r0
  const CVehicle *v14; // r0
  CPed *v15; // r1
  int m_nPedFlags; // r2
  CPed *v17; // r1
  const CVehicle *m_pMyVehicle; // r0
  CPed *v19; // r1
  unsigned int v20; // r0
  int m_iStartTime; // r2
  const CVehicle *v22; // r0
  const CVehicle *v23; // r0
  int32 m_baseVehicleType; // r1
  bool v25; // zf
  unsigned int v26; // r0
  int v27; // r1
  int v28; // r1
  const CVehicle *v29; // r0
  CPed *v30; // r1
  const CVehicle *v31; // r6
  int v32; // r0
  _BOOL4 IsRoomForPedToLeaveCar; // r0
  CPed *v34; // r1
  const CVehicle *v35; // r8
  int v36; // r0
  _BOOL4 v37; // r0
  CPed *v38; // r1
  bool v39; // zf
  const CVehicle *v40; // r0
  CVehicle *v41; // r0
  CPed *v42; // r1
  bool v43; // zf
  CEntity *v44; // r2
  bool v45; // zf
  CPed *v46; // r1
  int32 v47; // r1
  bool v48; // zf
  CPed *v49; // r1
  const CVehicle *v50; // r6
  int v51; // r0
  CEventAreaCodes v52; // [sp+10h] [bp-28h] BYREF

  *((_DWORD *)&pPed->m_nPedFlags + 2) |= 0x400000u;
  if ( !this->m_pTargetPed )
  {
    v4 = 1302;
    goto LABEL_141;
  }
  if ( (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) == 202 )
  {
    if ( (*((_BYTE *)this + 12) & 0x60) == 96 && (*((_BYTE *)FindPlayerWanted(-1) + 30) & 4) == 0 )
      (*((void (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
        this->m_pSubTask,
        pPed,
        1,
        0);
    return this->m_pSubTask;
  }
  m_nDuration = this->m_nDuration;
  if ( m_nDuration >= 1 && CTimer::m_snTimeInMilliseconds > m_nDuration + this->m_nStartTime )
  {
    m_pEntityStandingOn = (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask
                           + 7))(
                            this->m_pSubTask,
                            pPed,
                            1,
                            0);
    if ( m_pEntityStandingOn == 1 )
    {
      v7 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
      CTaskSimpleStandStill::CTaskSimpleStandStill(v7, 0, 0, 0, 8.0);
      return result;
    }
LABEL_24:
    v4 = 200;
    goto LABEL_133;
  }
  if ( (*((_BYTE *)this + 12) & 2) != 0 )
  {
    m_pEntityStandingOn = (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask
                           + 7))(
                            this->m_pSubTask,
                            pPed,
                            1,
                            0);
    if ( m_pEntityStandingOn == 1 )
      return (CTask *)(*((int (__fastcall **)(CTaskComplexKillPedOnFoot *, CPed *))this->_vptr$CTask + 11))(this, pPed);
    goto LABEL_24;
  }
  if ( (*((_BYTE *)this + 12) & 8) != 0 )
    goto LABEL_32;
  m_pTargetPed = this->m_pTargetPed;
  if ( m_pTargetPed->m_nHealth > 0.0 )
  {
    if ( CPed::IsPlayer(m_pTargetPed)
      && ((*((_BYTE *)this->m_pTargetPed->m_pPlayerData->m_Wanted + 30) & 4) != 0
       || pPed->m_nPedType == 6 && LOBYTE(pPed[1]._vptr$CPlaceable) && !FindPlayerWanted(-1)->m_nChanceOnRoadBlock)
      && (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) != 202 )
    {
      if ( (*((_BYTE *)this + 12) & 0x20) != 0 )
      {
        v4 = 202;
        if ( (*((_BYTE *)this->m_pTargetPed->m_pPlayerData->m_Wanted + 30) & 4) != 0 )
          *((_BYTE *)this + 12) |= 0x40u;
      }
      else
      {
        v4 = 202;
      }
      goto LABEL_132;
    }
LABEL_32:
    v12 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
    v4 = 200;
    if ( v12 <= 1001 )
    {
      if ( v12 == 703 )
      {
        v17 = this->m_pTargetPed;
        if ( !(*((unsigned __int8 *)&v17->m_nPedFlags + 1) << 31) )
          goto LABEL_95;
        m_pMyVehicle = v17->m_pMyVehicle;
        if ( !m_pMyVehicle
          || !CVehicle::IsDriver(m_pMyVehicle, v17)
          && !CVehicle::IsPassenger(this->m_pTargetPed->m_pMyVehicle, this->m_pTargetPed) )
        {
          goto LABEL_95;
        }
        v19 = this->m_pTargetPed;
        if ( sqrtf(
               (float)(v19->m_pMyVehicle->m_vecMoveSpeed.x * v19->m_pMyVehicle->m_vecMoveSpeed.x)
             + (float)(v19->m_pMyVehicle->m_vecMoveSpeed.y * v19->m_pMyVehicle->m_vecMoveSpeed.y)) <= 0.1 )
        {
          if ( this->m_RoomToLeaveCarTimer.m_bIsActive )
          {
            if ( this->m_RoomToLeaveCarTimer.m_bIsStopped )
            {
              v20 = CTimer::m_snTimeInMilliseconds;
              this->m_RoomToLeaveCarTimer.m_bIsStopped = 0;
              this->m_RoomToLeaveCarTimer.m_iStartTime = v20;
              m_iStartTime = v20;
            }
            else
            {
              m_iStartTime = this->m_RoomToLeaveCarTimer.m_iStartTime;
              v20 = CTimer::m_snTimeInMilliseconds;
            }
            if ( m_iStartTime + this->m_RoomToLeaveCarTimer.m_iDuration <= v20 )
            {
              v29 = v19->m_pMyVehicle;
              if ( v29 )
              {
                if ( CVehicle::IsPassenger(v29, v19)
                  || CVehicle::IsDriver(this->m_pTargetPed->m_pMyVehicle, this->m_pTargetPed) )
                {
                  v30 = this->m_pTargetPed;
                  v31 = v30->m_pMyVehicle;
                  v32 = CCarEnterExit::ComputeTargetDoorToExit(v31, v30);
                  IsRoomForPedToLeaveCar = CCarEnterExit::IsRoomForPedToLeaveCar(v31, v32, 0);
                  v4 = 1003;
                  *((_BYTE *)this + 12) = *((_BYTE *)this + 12) & 0xFB | (4 * IsRoomForPedToLeaveCar);
                  this->m_RoomToLeaveCarTimer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
                  this->m_RoomToLeaveCarTimer.m_iDuration = 2000;
                  this->m_RoomToLeaveCarTimer.m_bIsActive = 1;
                  if ( IsRoomForPedToLeaveCar )
                    v4 = 200;
                  goto LABEL_132;
                }
              }
            }
          }
          goto LABEL_95;
        }
        goto LABEL_131;
      }
      if ( v12 == 1001 )
      {
        LOBYTE(this->m_pSubTask[6]._vptr$CTask) = *((_BYTE *)this + 12) & 1;
        if ( CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]) )
        {
          v13 = this->m_pTargetPed;
          if ( !(*((unsigned __int8 *)&v13->m_nPedFlags + 1) << 31) )
          {
LABEL_95:
            v4 = 200;
            goto LABEL_132;
          }
          if ( (unsigned int)(v13->m_pMyVehicle->m_vehicleType - 3) >= 2 )
          {
            v14 = v13->m_pMyVehicle;
            if ( !v14
              || v14->m_baseVehicleType == 5
              || (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0
              || !CVehicle::CanPedOpenLocks(v14, pPed) )
            {
              goto LABEL_95;
            }
            goto LABEL_152;
          }
          goto LABEL_131;
        }
        v4 = 1002;
      }
      goto LABEL_132;
    }
    if ( v12 != 1002 )
    {
      if ( v12 == 1003 )
      {
        v15 = this->m_pTargetPed;
        m_nPedFlags = (int)v15->m_nPedFlags;
        if ( (m_nPedFlags & 0x100) == 0 )
        {
          v4 = 1002;
          if ( CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]) )
            v4 = 1001;
          goto LABEL_132;
        }
        v22 = v15->m_pMyVehicle;
        if ( v22 )
        {
          if ( !CCarEnterExit::IsVehicleHealthy(v22) )
          {
            v4 = 1210;
            goto LABEL_132;
          }
          v15 = this->m_pTargetPed;
          m_nPedFlags = (int)v15->m_nPedFlags;
        }
        if ( (m_nPedFlags & 0x20000000) != 0 )
          goto LABEL_95;
        v23 = v15->m_pMyVehicle;
        if ( (unsigned int)(v23->m_vehicleType - 3) < 2 )
          goto LABEL_95;
        m_baseVehicleType = v23->m_baseVehicleType;
        v4 = 200;
        v25 = m_baseVehicleType == 5;
        if ( m_baseVehicleType != 5 )
          v25 = m_baseVehicleType == 9;
        if ( v25 )
          goto LABEL_132;
        if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0
          || sqrtf(
               (float)(v23->m_vecMoveSpeed.x * v23->m_vecMoveSpeed.x)
             + (float)(v23->m_vecMoveSpeed.y * v23->m_vecMoveSpeed.y)) > 0.1
          || !CVehicle::CanPedOpenLocks(v23, pPed) )
        {
          goto LABEL_95;
        }
        if ( (*((_BYTE *)this + 12) & 4) != 0 )
        {
          v4 = 703;
          goto LABEL_132;
        }
        if ( !this->m_RoomToLeaveCarTimer.m_bIsActive )
          goto LABEL_95;
        if ( this->m_RoomToLeaveCarTimer.m_bIsStopped )
        {
          v26 = CTimer::m_snTimeInMilliseconds;
          this->m_RoomToLeaveCarTimer.m_bIsStopped = 0;
          this->m_RoomToLeaveCarTimer.m_iStartTime = v26;
          v27 = v26;
        }
        else
        {
          v27 = this->m_RoomToLeaveCarTimer.m_iStartTime;
          v26 = CTimer::m_snTimeInMilliseconds;
        }
        v4 = 200;
        if ( v27 + this->m_RoomToLeaveCarTimer.m_iDuration > v26 )
          goto LABEL_132;
        v34 = this->m_pTargetPed;
        v35 = v34->m_pMyVehicle;
        v36 = CCarEnterExit::ComputeTargetDoorToExit(v35, v34);
        v37 = CCarEnterExit::IsRoomForPedToLeaveCar(v35, v36, 0);
        *((_BYTE *)this + 12) = *((_BYTE *)this + 12) & 0xFB | (4 * v37);
        this->m_RoomToLeaveCarTimer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
        this->m_RoomToLeaveCarTimer.m_iDuration = 2000;
        this->m_RoomToLeaveCarTimer.m_bIsActive = 1;
LABEL_153:
        if ( v37 )
          v4 = 703;
      }
LABEL_132:
      m_pEntityStandingOn = *((_BYTE *)this + 12) & 0xFE;
      *((_BYTE *)this + 12) = m_pEntityStandingOn;
LABEL_133:
      v42 = this->m_pTargetPed;
      v43 = v42 == 0;
      if ( v42 )
      {
        m_pEntityStandingOn = (int)v42->m_pEntityStandingOn;
        v43 = m_pEntityStandingOn == 0;
      }
      if ( !v43 )
      {
        v44 = pPed->m_pEntityStandingOn;
        v45 = v44 == 0;
        if ( v44 )
          v45 = *(unsigned __int8 *)(m_pEntityStandingOn + 51) == v44->m_areaCode;
        if ( !v45 )
        {
          CEventAreaCodes::CEventAreaCodes(&v52, v42);
          CEventGroup::Add(&pPed->m_pPedIntelligence->m_eventGroup, &v52, 0);
          CEventAreaCodes::~CEventAreaCodes(&v52);
        }
      }
      if ( v4 == 200 )
      {
LABEL_143:
        v46 = this->m_pTargetPed;
        if ( v46 )
          CTaskComplexGangLeader::DoGangAttackSpeech(pPed, v46);
        return this->m_pSubTask;
      }
LABEL_141:
      if ( (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
             this->m_pSubTask,
             pPed,
             1,
             0) == 1 )
        return CTaskComplexKillPedOnFoot::CreateSubTask(this, v4, pPed);
      goto LABEL_143;
    }
    HIBYTE(this->m_pSubTask[6]._vptr$CTask) = *((_BYTE *)this + 12) & 1;
    if ( !CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]) || CPed::IsPlayer(pPed) )
    {
      if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_nAmmoTotal || CPed::IsPlayer(pPed) )
      {
        v4 = 200;
        goto LABEL_125;
      }
      if ( pPed->m_WeaponSlots[0].m_nAmmoTotal >= 1 )
      {
        v28 = 0;
LABEL_122:
        CPed::SetCurrentWeapon(pPed, v28);
        v4 = 200;
        goto LABEL_125;
      }
      if ( pPed->m_WeaponSlots[1].m_nAmmoTotal > 0 )
      {
        v28 = 1;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[2].m_nAmmoTotal > 0 )
      {
        v28 = 2;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[3].m_nAmmoTotal > 0 )
      {
        v28 = 3;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[4].m_nAmmoTotal > 0 )
      {
        v28 = 4;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[5].m_nAmmoTotal > 0 )
      {
        v28 = 5;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[6].m_nAmmoTotal > 0 )
      {
        v28 = 6;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[7].m_nAmmoTotal > 0 )
      {
        v28 = 7;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[8].m_nAmmoTotal > 0 )
      {
        v28 = 8;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[9].m_nAmmoTotal > 0 )
      {
        v28 = 9;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[10].m_nAmmoTotal > 0 )
      {
        v28 = 10;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[11].m_nAmmoTotal > 0 )
      {
        v28 = 11;
        goto LABEL_122;
      }
      if ( pPed->m_WeaponSlots[12].m_nAmmoTotal > 0 )
      {
        v28 = 12;
        goto LABEL_122;
      }
      CPed::SetCurrentWeapon(pPed, WEAPONTYPE_UNARMED);
    }
    v4 = 1001;
LABEL_125:
    v38 = this->m_pTargetPed;
    v40 = (const CVehicle *)(*((unsigned __int8 *)&v38->m_nPedFlags + 1) << 31);
    v39 = v40 == 0;
    if ( v40 )
    {
      v40 = v38->m_pMyVehicle;
      v39 = v40 == 0;
    }
    if ( v39
      || !CVehicle::IsDriver(v40, v38) && !CVehicle::IsPassenger(this->m_pTargetPed->m_pMyVehicle, this->m_pTargetPed) )
    {
      goto LABEL_132;
    }
    v41 = this->m_pTargetPed->m_pMyVehicle;
    if ( (unsigned int)(v41->m_vehicleType - 3) >= 2 )
    {
      v47 = v41->m_baseVehicleType;
      v48 = v47 == 5;
      if ( v47 != 5 )
        v48 = v47 == 9;
      if ( v48
        || (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0
        || sqrtf(
             (float)(v41->m_vecMoveSpeed.x * v41->m_vecMoveSpeed.x)
           + (float)(v41->m_vecMoveSpeed.y * v41->m_vecMoveSpeed.y)) > 0.1
        || !CVehicle::CanPedOpenLocks(v41, pPed) )
      {
        goto LABEL_132;
      }
LABEL_152:
      v49 = this->m_pTargetPed;
      v50 = v49->m_pMyVehicle;
      v51 = CCarEnterExit::ComputeTargetDoorToExit(v50, v49);
      v37 = CCarEnterExit::IsRoomForPedToLeaveCar(v50, v51, 0);
      v4 = 1003;
      *((_BYTE *)this + 12) = *((_BYTE *)this + 12) & 0xFB | (4 * v37);
      goto LABEL_153;
    }
LABEL_131:
    v4 = 1003;
    goto LABEL_132;
  }
  if ( (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
         this->m_pSubTask,
         pPed,
         1,
         0) != 1 )
    goto LABEL_32;
  m_pSubTask = this->m_pSubTask;
  *((_BYTE *)this + 12) |= 8u;
  if ( (*((int (__fastcall **)(CTask *))m_pSubTask->_vptr$CTask + 5))(m_pSubTask) == 1210 )
    return this->m_pSubTask;
  if ( pPed->m_nPedType == 6 && !CPed::IsPlayer(this->m_pTargetPed) )
    CPed::Say(pPed, 0xEu, 0, 1.0, 0, 0, 0);
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 13) & 0x10) != 0 )
    return CTaskComplexKillPedOnFoot::CreateSubTask(this, 1210, pPed);
  v11 = (CTaskSimple *)CTask::operator new(8u);
  CTaskSimple::CTaskSimple(v11);
  result->_vptr$CTask = (int (**)(void))&off_668FF0;
  return result;
}
// 4E0E20: variable 'result' is possibly undefined
// 668FF0: using guessed type void *off_668FF0;
// 678150: using guessed type void *`vtable for'CTaskSimpleNone;

//----- (004E1388) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootStealth::CTaskComplexKillPedOnFootStealth(
        CTaskComplexKillPedOnFootStealth *this,
        CPed *pTargetPed)
{
  char v4; // r0
  char v5; // r0
  uint32 v6; // r1
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v9; // d16

  CTaskComplex::CTaskComplex(this);
  this->m_nDuckingConditions = 0;
  this->m_nTimeToDuck = 0;
  this->m_nPercentageDuckChance = 0;
  this->m_nCompetence = 1;
  v4 = *((_BYTE *)&this->CTaskComplexKillPedOnFoot + 12) & 0x8B;
  this->m_nDuration = -1;
  *(_WORD *)&this->m_RoomToLeaveCarTimer.m_bIsActive = 0;
  this->m_RoomToLeaveCarTimer.m_iStartTime = 0;
  this->m_RoomToLeaveCarTimer.m_iDuration = 0;
  v5 = v4 | 4;
  *((_BYTE *)&this->CTaskComplexKillPedOnFoot + 12) = v5;
  this->_vptr$CTask = (int (**)(void))&off_669840;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
  {
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
    v5 = *((_BYTE *)&this->CTaskComplexKillPedOnFoot + 12);
  }
  v6 = CTimer::m_snTimeInMilliseconds;
  *((_BYTE *)&this->CTaskComplexKillPedOnFoot + 12) = v5 & 0xF7;
  this->m_nStartTime = v6;
  this->_vptr$CTask = (int (**)(void))&off_66987C;
  this->m_vecLastPositionSeen.y = 0.0;
  this->m_vecLastPositionSeen.z = -9999.9;
  this->m_iCantSeePedStartTime = -1;
  this->m_vecLastPositionSeen.x = 0.0;
  if ( pTargetPed )
  {
    m_pMat = pTargetPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pTargetPed->m_transform;
    v9 = *(_QWORD *)&p_tx->m_translate.x;
    this->m_vecLastPositionSeen.z = p_tx->m_translate.z;
    *(_QWORD *)&this->m_vecLastPositionSeen.x = v9;
  }
}
// 669840: using guessed type void *off_669840;
// 66987C: using guessed type void *;

//----- (004E1440) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootStealth::~CTaskComplexKillPedOnFootStealth(
        CTaskComplexKillPedOnFootStealth *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  void *v4; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669840;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E1468: variable 'v4' is possibly undefined
// 669840: using guessed type void *off_669840;

//----- (004E1470) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootStealth::CreateNextSubTask(
        CTaskComplexKillPedOnFootStealth *this,
        CPed *pPed)
{
  CTask *m_pSubTask; // r0
  CPed *m_pTargetPed; // r2
  int v6; // r5
  int v7; // r1
  int v8; // r3
  int v9; // r0
  int v10; // r3
  int v11; // r2

  m_pSubTask = this->m_pSubTask;
  if ( m_pSubTask
    && ((*((int (__fastcall **)(CTask *))m_pSubTask->_vptr$CTask + 5))(m_pSubTask) == 244
     || (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplexKillPedOnFoot::CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) == 935)
    && this->m_iCantSeePedStartTime == -1 )
  {
    return CTaskComplexKillPedOnFoot::CreateFirstSubTask(this, pPed);
  }
  m_pTargetPed = this->m_pTargetPed;
  if ( m_pTargetPed && m_pTargetPed->m_nHealth >= 1.0 )
  {
    v10 = *((_DWORD *)&pPed->m_nPedFlags + 2);
    v11 = *((_DWORD *)&pPed->m_nPedFlags + 1);
    v9 = *((_DWORD *)&pPed->m_nPedFlags + 3);
    *(_DWORD *)&pPed->m_nPedFlags = pPed->m_nPedFlags;
    *((_DWORD *)&pPed->m_nPedFlags + 1) = v11;
    *((_DWORD *)&pPed->m_nPedFlags + 2) = v10 & 0xFFBFFFFF;
  }
  else
  {
    v6 = *((_DWORD *)&pPed->m_nPedFlags + 2);
    v7 = *((_DWORD *)&pPed->m_nPedFlags + 3);
    v8 = *((_DWORD *)&pPed->m_nPedFlags + 1);
    *(_DWORD *)&pPed->m_nPedFlags = pPed->m_nPedFlags;
    *((_DWORD *)&pPed->m_nPedFlags + 1) = v8;
    v9 = v7;
    *((_DWORD *)&pPed->m_nPedFlags + 2) = v6 & 0xFFBFFFFF;
  }
  *((_DWORD *)&pPed->m_nPedFlags + 3) = v9;
  return 0;
}

//----- (004E1520) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootStealth::CreateFirstSubTask(
        CTaskComplexKillPedOnFootStealth *this,
        CPed *pPed)
{
  CPed::Say(pPed, 0xCDu, 0, 1.0, 0, 0, 0);
  return CTaskComplexKillPedOnFoot::CreateFirstSubTask(this, pPed);
}

//----- (004E1550) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootStealth::ControlSubTask(CTaskComplexKillPedOnFootStealth *this, CPed *pPed)
{
  CPed *m_pTargetPed; // r1
  _BOOL4 CanPedTargetPed; // r0
  int m_iCantSeePedStartTime; // r1
  CPed *v7; // r0
  CMatrix *v8; // r1
  CMatrix *v9; // r2
  CSimpleTransform *p_m_transform; // r3
  float *p_x; // r1
  float y; // s2
  float z; // s4
  CMatrix *v14; // r0
  float x; // s16
  float xy; // s22
  float yy; // s26
  float zy; // s24
  float v19; // s20
  float v20; // s18
  CPed *v21; // r0
  CMatrix *v22; // r2
  CSimpleTransform *v23; // r3
  __int64 v24; // d16
  CPed *v26; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v29; // d16
  float v30; // s0
  CTask *v31; // r0
  CTaskComplexSequence *v32; // r6
  CTask *m_pSubTask; // r0
  CTask *v34; // r0
  CTaskSimpleStandStill *v35; // r5
  CTaskSimpleRunAnim *v36; // r5
  CTaskSimpleRunAnim *v37; // r4
  CVector v38; // [sp+Ch] [bp-4Ch] BYREF

  m_pTargetPed = this->m_pTargetPed;
  if ( !m_pTargetPed )
    return CTaskComplexKillPedOnFoot::ControlSubTask(this, pPed);
  CanPedTargetPed = CPedGeometryAnalyser::CanPedTargetPed(pPed, m_pTargetPed, 1);
  m_iCantSeePedStartTime = this->m_iCantSeePedStartTime;
  if ( m_iCantSeePedStartTime == -1 )
  {
    if ( CanPedTargetPed )
    {
      v26 = this->m_pTargetPed;
      this->m_iCantSeePedStartTime = -1;
      m_pMat = v26->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v26->m_transform;
      v29 = *(_QWORD *)&p_tx->m_translate.x;
      this->m_vecLastPositionSeen.z = p_tx->m_translate.z;
      *(_QWORD *)&this->m_vecLastPositionSeen.x = v29;
LABEL_26:
      m_pSubTask = this->m_pSubTask;
      if ( m_pSubTask
        && ((*((int (__fastcall **)(CTask *))m_pSubTask->_vptr$CTask + 5))(m_pSubTask) == 935
         || (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplexKillPedOnFoot::CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) == 244)
        && (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplexKillPedOnFoot::CTaskComplex::_vptr$CTask
            + 7))(
             this->m_pSubTask,
             pPed,
             1,
             0) == 1 )
      {
        return CTaskComplexKillPedOnFoot::CreateFirstSubTask(this, pPed);
      }
      return this->m_pSubTask;
    }
    m_iCantSeePedStartTime = CTimer::m_snTimeInMilliseconds;
    this->m_iCantSeePedStartTime = CTimer::m_snTimeInMilliseconds;
    if ( m_iCantSeePedStartTime == -1 )
      goto LABEL_26;
  }
  else if ( CanPedTargetPed )
  {
    v7 = this->m_pTargetPed;
    v8 = pPed->m_pMat;
    v9 = v7->m_pMat;
    p_m_transform = (CSimpleTransform *)&v8->tx;
    if ( !v8 )
      p_m_transform = &pPed->m_transform;
    p_x = &v9->tx;
    y = p_m_transform->m_translate.y;
    z = p_m_transform->m_translate.z;
    if ( !v9 )
      p_x = &v7->m_transform.m_translate.x;
    v38.x = *p_x - p_m_transform->m_translate.x;
    v38.y = p_x[1] - y;
    v38.z = p_x[2] - z;
    CVector::Normalise(&v38);
    v14 = pPed->m_pMat;
    x = v38.x;
    xy = v14->xy;
    yy = v14->yy;
    zy = v14->zy;
    v19 = v38.y;
    v20 = v38.z;
    if ( CPedIntelligence::CanSeeEntityWithLights(pPed->m_pPedIntelligence, this->m_pTargetPed, 1) > 0.0
      && (float)((float)((float)(xy * x) + (float)(yy * v19)) + (float)(zy * v20)) > CPedAcquaintanceScanner::ms_fThresholdDotProduct )
    {
      v21 = this->m_pTargetPed;
      this->m_iCantSeePedStartTime = -1;
      v22 = v21->m_pMat;
      v23 = (CSimpleTransform *)&v22->tx;
      if ( !v22 )
        v23 = &v21->m_transform;
      v24 = *(_QWORD *)&v23->m_translate.x;
      this->m_vecLastPositionSeen.z = v23->m_translate.z;
      *(_QWORD *)&this->m_vecLastPositionSeen.x = v24;
      goto LABEL_26;
    }
    m_iCantSeePedStartTime = this->m_iCantSeePedStartTime;
    if ( m_iCantSeePedStartTime == -1 )
      goto LABEL_26;
  }
  if ( (int)(CTimer::m_snTimeInMilliseconds - m_iCantSeePedStartTime) < 5001 )
    return this->m_pSubTask;
  CPed::Say(pPed, 0xCEu, 0, 1.0, 0, 0, 0);
  v30 = this->m_vecLastPositionSeen.z;
  if ( v30 <= -9999.9 )
  {
LABEL_32:
    if ( v30 <= -9999.9 )
    {
      v34 = this->m_pSubTask;
      if ( v34 )
      {
        if ( (*((int (__fastcall **)(CTask *))v34->_vptr$CTask + 5))(v34) != 244
          && (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplexKillPedOnFoot::CTaskComplex::_vptr$CTask
              + 7))(
               this->m_pSubTask,
               pPed,
               1,
               0) == 1 )
        {
          v32 = (CTaskComplexSequence *)CTask::operator new(0x40u);
          CTaskComplexSequence::CTaskComplexSequence(v32);
          v35 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
          CTaskSimpleStandStill::CTaskSimpleStandStill(v35, 1000, 0, 0, 8.0);
          CTaskComplexSequence::AddTask(v32, v35);
          v36 = (CTaskSimpleRunAnim *)CTask::operator new(0x20u);
          CTaskSimpleRunAnim::CTaskSimpleRunAnim(
            v36,
            (const AssocGroupId)pPed->m_motionAnimGroup,
            ANIM_STD_ROADCROSS,
            4.0,
            0);
          CTaskComplexSequence::AddTask(v32, v36);
          v37 = (CTaskSimpleRunAnim *)CTask::operator new(0x20u);
          CTaskSimpleRunAnim::CTaskSimpleRunAnim(v37, ANIM_STD_PED, ANIM_STD_XPRESS_SCRATCH, 4.0, 421, "ScratchHead", 0);
          v37->_vptr$CTask = (int (**)(void))&off_665860;
          CTaskComplexSequence::AddTask(v32, v37);
          return v32;
        }
      }
    }
    return this->m_pSubTask;
  }
  v31 = this->m_pSubTask;
  if ( !v31
    || (*((int (__fastcall **)(CTask *))v31->_vptr$CTask + 5))(v31) == 935
    || (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplexKillPedOnFoot::CTaskComplex::_vptr$CTask
        + 7))(
         this->m_pSubTask,
         pPed,
         1,
         0) != 1 )
  {
    v30 = this->m_vecLastPositionSeen.z;
    goto LABEL_32;
  }
  v32 = (CTaskComplexSequence *)CTask::operator new(0x1Cu);
  CTaskComplexInvestigateDisturbance::CTaskComplexInvestigateDisturbance(
    (CTaskComplexInvestigateDisturbance *)v32,
    &this->m_vecLastPositionSeen,
    this->m_pTargetPed);
  return v32;
}
// 665860: using guessed type void *off_665860;
// 6784D8: using guessed type void *`vtable for'CTaskSimpleScratchHead;

//----- (004E183C) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootMelee::CTaskComplexKillPedOnFootMelee(
        CTaskComplexKillPedOnFootMelee *this,
        CPed *pTargetPed)
{
  CTaskComplex::CTaskComplex(this);
  this->m_fAttackRange = 0.0;
  this->m_fAttackAngle = 0.0;
  this->m_nAttackPointIndex = -1;
  this->m_nLastAttackTime = 0;
  this->m_pauseTimer = -1;
  *(_QWORD *)&this->m_vecTargetPos.x = 0LL;
  *(_QWORD *)&this->m_vecTargetPos.z = 0LL;
  *(_WORD *)&this->m_bShotFiredByPlayerFlag = 0;
  this->_vptr$CTask = (int (**)(void))&off_6698B8;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
}
// 6698B8: using guessed type void *off_6698B8;

//----- (004E188C) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootMelee::~CTaskComplexKillPedOnFootMelee(CTaskComplexKillPedOnFootMelee *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_6698B8;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  sub_18EDB4(this);
}
// 6698B8: using guessed type void *off_6698B8;

//----- (004E18B8) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootMelee::~CTaskComplexKillPedOnFootMelee(CTaskComplexKillPedOnFootMelee *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  void *v4; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_6698B8;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E18E0: variable 'v4' is possibly undefined
// 6698B8: using guessed type void *off_6698B8;

//----- (004E18E8) --------------------------------------------------------
bool __fastcall CTaskComplexKillPedOnFootMelee::MakeAbortable(
        CTaskComplexKillPedOnFootMelee *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
          + 7))(
           this->m_pSubTask,
           pPed,
           iPriority,
           pEvent);
}

//----- (004E1900) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootMelee::CreateNextSubTask(CTaskComplexKillPedOnFootMelee *this, CPed *pPed)
{
  int v4; // r0
  unsigned __int8 *v5; // r6
  int m_pParent_low; // r0
  bool v7; // cc
  int v8; // r0
  tMeleeComboSet *v9; // r0
  int v11; // r0
  int v12; // r0
  tMeleeComboSet *v13; // r0
  CTaskSimpleStandStill *v14; // r0
  float v15; // r1
  CPed *v16; // r0
  float v17; // s0
  CMatrix *v18; // r1
  CSimpleTransform *v19; // r2
  __int64 v20; // d16
  CMatrix *v21; // r0
  float v22; // s0
  CSimpleTransform *v23; // r1
  float32x2_t v24; // d16
  unsigned __int64 v25; // d2
  CTaskSimple *v26; // r0
  CPed *v27; // r5
  __int64 v28; // r8
  int32 m_pauseTimer; // r0
  float v30; // r1
  CPed *m_pTargetPed; // r0
  float v32; // s0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v35; // d16
  CMatrix *v36; // r0
  float v37; // s0
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v39; // d16
  unsigned __int64 v40; // d2
  CPed *v41; // r4
  int v42; // r1
  CTaskSimpleStandStill *v43; // r0
  CTaskSimpleStandStill *v44; // r0
  CTaskSimpleStandStill v45; // [sp+8h] [bp-38h] BYREF

  if ( !this->m_pTargetPed )
    return 0;
  v4 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  v5 = 0;
  if ( v4 > 243 )
  {
    if ( v4 != 244 )
    {
      if ( v4 != 907 )
      {
        if ( v4 == 1019 )
        {
          if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
          {
            CTaskSimpleStandStill::CTaskSimpleStandStill(&v45, 0, 0, 0, 8.0);
            CTaskSimpleStandStill::ProcessPed(v14, pPed);
            CTaskSimpleStandStill::~CTaskSimpleStandStill(&v45);
            if ( this->m_pauseTimer == -1 )
              this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
          }
          else
          {
            this->m_fAttackRange = 8.0;
            if ( CPedIntelligence::GetTaskFighting(pPed->m_pPedIntelligence) )
            {
              m_pParent_low = SLOBYTE(CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0)[4].m_pParent);
              v7 = m_pParent_low < 4;
              v8 = m_pParent_low - 4;
              if ( v7 )
                v8 = 0;
              v9 = &CTaskSimpleFight::m_aComboData[v8];
            }
            else
            {
              v9 = CTaskSimpleFight::m_aComboData;
            }
            v30 = *(float *)&byte_4[(_DWORD)v9];
            m_pTargetPed = this->m_pTargetPed;
            this->m_fArriveRange = v30;
            v32 = v30;
            if ( m_pTargetPed )
            {
              m_pMat = m_pTargetPed->m_pMat;
              p_tx = (CSimpleTransform *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = &m_pTargetPed->m_transform;
              v35 = *(_QWORD *)&p_tx->m_translate.x;
              this->m_vecTargetPos.z = p_tx->m_translate.z;
              *(_QWORD *)&this->m_vecTargetPos.x = v35;
            }
            v36 = pPed->m_pMat;
            v37 = v32 * v32;
            p_m_transform = (CSimpleTransform *)&v36->tx;
            if ( !v36 )
              p_m_transform = &pPed->m_transform;
            v39.n64_u64[0] = vsub_f32(
                               *(float32x2_t *)&this->m_vecTargetPos.y,
                               *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
            v40 = vmul_f32(v39, v39).n64_u64[0];
            if ( (float)((float)((float)((float)(this->m_vecTargetPos.x - p_m_transform->m_translate.x)
                                       * (float)(this->m_vecTargetPos.x - p_m_transform->m_translate.x))
                               + *(float *)&v40)
                       + *((float *)&v40 + 1)) > v37 )
              goto LABEL_49;
            CTaskSimpleStandStill::CTaskSimpleStandStill(&v45, 0, 0, 0, 8.0);
            CTaskSimpleStandStill::ProcessPed(v43, pPed);
            CTaskSimpleStandStill::~CTaskSimpleStandStill(&v45);
            if ( this->m_pauseTimer == -1 )
              this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
          }
          goto LABEL_56;
        }
        return (CTask *)v5;
      }
LABEL_35:
      this->m_pauseTimer = -1;
      v26 = (CTaskSimple *)CTask::operator new(0x24u);
      v27 = this->m_pTargetPed;
      v5 = (unsigned __int8 *)v26;
      v28 = *(_QWORD *)&this->m_fAttackRange;
      CTaskSimple::CTaskSimple(v26);
      v5[8] = 0;
      *(_DWORD *)v5 = &off_669630;
      *((_WORD *)v5 + 5) = 0;
      *((_DWORD *)v5 + 3) = v27;
      if ( v27 )
        CEntity::RegisterReference(v27, (CEntity **)v5 + 3);
      *((_DWORD *)v5 + 4) = HIDWORD(v28);
      *((_DWORD *)v5 + 5) = v28;
      *((_DWORD *)v5 + 6) = 1065353216;
      *((_DWORD *)v5 + 7) = 0;
      *((_DWORD *)v5 + 8) = 0;
      return (CTask *)v5;
    }
LABEL_14:
    if ( !(*((unsigned __int8 *)&this->m_pTargetPed->m_nPhysicalFlags + 1) << 31) )
      return (CTask *)(*((int (__fastcall **)(CTaskComplexKillPedOnFootMelee *, CPed *))this->_vptr$CTask + 11))(
                        this,
                        pPed);
    this->m_pauseTimer = -1;
    v5 = (unsigned __int8 *)CTask::operator new(0x20u);
    CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v5, 2000, 0, 0, 8.0);
    return (CTask *)v5;
  }
  if ( v4 != 202 )
  {
    if ( v4 != 203 )
      return (CTask *)v5;
    goto LABEL_14;
  }
  this->m_fAttackRange = 8.0;
  if ( CPedIntelligence::GetTaskFighting(pPed->m_pPedIntelligence) )
  {
    v11 = SLOBYTE(CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0)[4].m_pParent);
    v7 = v11 < 4;
    v12 = v11 - 4;
    if ( v7 )
      v12 = 0;
    v13 = &CTaskSimpleFight::m_aComboData[v12];
  }
  else
  {
    v13 = CTaskSimpleFight::m_aComboData;
  }
  v15 = *(float *)&byte_4[(_DWORD)v13];
  v16 = this->m_pTargetPed;
  this->m_fArriveRange = v15;
  v17 = v15;
  if ( v16 )
  {
    v18 = v16->m_pMat;
    v19 = (CSimpleTransform *)&v18->tx;
    if ( !v18 )
      v19 = &v16->m_transform;
    v20 = *(_QWORD *)&v19->m_translate.x;
    this->m_vecTargetPos.z = v19->m_translate.z;
    *(_QWORD *)&this->m_vecTargetPos.x = v20;
  }
  v21 = pPed->m_pMat;
  v22 = v17 * v17;
  v23 = (CSimpleTransform *)&v21->tx;
  if ( !v21 )
    v23 = &pPed->m_transform;
  v24.n64_u64[0] = vsub_f32(*(float32x2_t *)&this->m_vecTargetPos.y, *(float32x2_t *)&v23->m_translate.y).n64_u64[0];
  v25 = vmul_f32(v24, v24).n64_u64[0];
  if ( (float)((float)((float)((float)(this->m_vecTargetPos.x - v23->m_translate.x)
                             * (float)(this->m_vecTargetPos.x - v23->m_translate.x))
                     + *(float *)&v25)
             + *((float *)&v25 + 1)) <= v22 )
    goto LABEL_35;
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
  {
LABEL_49:
    this->m_pauseTimer = -1;
    v5 = (unsigned __int8 *)CTask::operator new(0x4Cu);
    v41 = this->m_pTargetPed;
    CTaskComplex::CTaskComplex((CTaskComplex *)v5);
    *((_QWORD *)v5 + 3) = 0x400000003F800000LL;
    *((_QWORD *)v5 + 4) = 0x4000000000000000LL;
    *(_DWORD *)v5 = &off_6656D4;
    *((_DWORD *)v5 + 4) = 50000;
    *((_DWORD *)v5 + 5) = 1000;
    *((_WORD *)v5 + 24) = 0;
    *((_WORD *)v5 + 30) = 0;
    *((_DWORD *)v5 + 10) = 0;
    *((_DWORD *)v5 + 11) = 0;
    *((_DWORD *)v5 + 13) = 0;
    *((_DWORD *)v5 + 14) = 0;
    v42 = v5[72];
    *((_DWORD *)v5 + 16) = &off_665710;
    *((_DWORD *)v5 + 17) = 6;
    v5[72] = v42 & 0xF0 | 3;
    *((_DWORD *)v5 + 3) = v41;
    if ( v41 )
      CEntity::RegisterReference(v41, (CEntity **)v5 + 3);
    return (CTask *)v5;
  }
  m_pauseTimer = this->m_pauseTimer;
  if ( m_pauseTimer == -1 || CTimer::m_snTimeInMilliseconds - m_pauseTimer < 0xBB9 )
  {
    CTaskSimpleStandStill::CTaskSimpleStandStill(&v45, 0, 0, 0, 8.0);
    CTaskSimpleStandStill::ProcessPed(v44, pPed);
    CTaskSimpleStandStill::~CTaskSimpleStandStill(&v45);
    if ( this->m_pauseTimer == -1 )
      this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
LABEL_56:
    v5 = (unsigned __int8 *)CTask::operator new(0x18u);
    CTaskSimple::CTaskSimple((CTaskSimple *)v5);
    *((_WORD *)v5 + 8) = 0;
    *((_DWORD *)v5 + 5) = 100;
    *((_DWORD *)v5 + 2) = 0;
    *((_DWORD *)v5 + 3) = 0;
    *(_DWORD *)v5 = &off_665750;
    return (CTask *)v5;
  }
  v5 = 0;
  this->m_pauseTimer = -1;
  return (CTask *)v5;
}
// 4E1A3A: variable 'v14' is possibly undefined
// 4E1C70: variable 'v43' is possibly undefined
// 4E1CB6: variable 'v44' is possibly undefined
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669630: using guessed type void *off_669630;

//----- (004E1D54) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootMelee::CalculateSearchPositionAndRanges(
        CTaskComplexKillPedOnFootMelee *this,
        CPed *pPed)
{
  int m_pParent_low; // r0
  bool v5; // cc
  int v6; // r0
  tMeleeComboSet *v7; // r0
  float *p_fGroupRange; // r1
  CPed *m_pTargetPed; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v12; // d16

  this->m_fAttackRange = 8.0;
  if ( CPedIntelligence::GetTaskFighting(pPed->m_pPedIntelligence) )
  {
    m_pParent_low = SLOBYTE(CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0)[4].m_pParent);
    v5 = m_pParent_low < 4;
    v6 = m_pParent_low - 4;
    if ( v5 )
      v6 = 0;
    v7 = &CTaskSimpleFight::m_aComboData[v6];
  }
  else
  {
    v7 = CTaskSimpleFight::m_aComboData;
  }
  p_fGroupRange = &v7->fGroupRange;
  m_pTargetPed = this->m_pTargetPed;
  this->m_fArriveRange = *p_fGroupRange;
  if ( m_pTargetPed )
  {
    m_pMat = m_pTargetPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pTargetPed->m_transform;
    v12 = *(_QWORD *)&p_tx->m_translate.x;
    this->m_vecTargetPos.z = p_tx->m_translate.z;
    *(_QWORD *)&this->m_vecTargetPos.x = v12;
  }
}

//----- (004E1DD0) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootMelee::CreateSubTask(
        CTaskComplexKillPedOnFootMelee *this,
        int iSubTaskType,
        CPed *pPed)
{
  unsigned __int8 *v5; // r4
  CTaskComplexTurnToFaceEntityOrCoord *v6; // r6
  CTaskSimpleShakeFist *v7; // r5
  CTaskSimple *v8; // r0
  CPed *v9; // r6
  __int64 v10; // r8
  CTaskSimpleStandStill *v11; // r0
  CPed *m_pTargetPed; // r5
  int v13; // r1
  CTaskSimpleStandStill v15; // [sp+8h] [bp-38h] BYREF

  v5 = 0;
  if ( iSubTaskType > 906 )
  {
    switch ( iSubTaskType )
    {
      case 907:
        this->m_pauseTimer = -1;
        v5 = (unsigned __int8 *)CTask::operator new(0x4Cu);
        m_pTargetPed = this->m_pTargetPed;
        CTaskComplex::CTaskComplex((CTaskComplex *)v5);
        *((_QWORD *)v5 + 3) = 0x400000003F800000LL;
        *((_QWORD *)v5 + 4) = 0x4000000000000000LL;
        *(_DWORD *)v5 = &off_6656D4;
        *((_DWORD *)v5 + 4) = 50000;
        *((_DWORD *)v5 + 5) = 1000;
        *((_WORD *)v5 + 24) = 0;
        *((_WORD *)v5 + 30) = 0;
        *((_DWORD *)v5 + 10) = 0;
        *((_DWORD *)v5 + 11) = 0;
        *((_DWORD *)v5 + 13) = 0;
        *((_DWORD *)v5 + 14) = 0;
        v13 = v5[72];
        *((_DWORD *)v5 + 16) = &off_665710;
        *((_DWORD *)v5 + 17) = 6;
        v5[72] = v13 & 0xF0 | 3;
        *((_DWORD *)v5 + 3) = m_pTargetPed;
        if ( m_pTargetPed )
          CEntity::RegisterReference(m_pTargetPed, (CEntity **)v5 + 3);
        break;
      case 1302:
        v5 = 0;
        this->m_pauseTimer = -1;
        break;
      case 1019:
        this->m_pauseTimer = -1;
        v8 = (CTaskSimple *)CTask::operator new(0x24u);
        v9 = this->m_pTargetPed;
        v5 = (unsigned __int8 *)v8;
        v10 = *(_QWORD *)&this->m_fAttackRange;
        CTaskSimple::CTaskSimple(v8);
        v5[8] = 0;
        *(_DWORD *)v5 = &off_669630;
        *((_WORD *)v5 + 5) = 0;
        *((_DWORD *)v5 + 3) = v9;
        if ( v9 )
          CEntity::RegisterReference(v9, (CEntity **)v5 + 3);
        *((_DWORD *)v5 + 4) = HIDWORD(v10);
        *((_DWORD *)v5 + 5) = v10;
        *((_DWORD *)v5 + 6) = 1065353216;
        *((_DWORD *)v5 + 7) = 0;
        *((_DWORD *)v5 + 8) = 0;
        break;
    }
  }
  else
  {
    switch ( iSubTaskType )
    {
      case 202:
        CTaskSimpleStandStill::CTaskSimpleStandStill(&v15, 0, 0, 0, 8.0);
        CTaskSimpleStandStill::ProcessPed(v11, pPed);
        CTaskSimpleStandStill::~CTaskSimpleStandStill(&v15);
        if ( this->m_pauseTimer == -1 )
          this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
        v5 = (unsigned __int8 *)CTask::operator new(0x18u);
        CTaskSimple::CTaskSimple((CTaskSimple *)v5);
        *((_WORD *)v5 + 8) = 0;
        *((_DWORD *)v5 + 5) = 100;
        *((_DWORD *)v5 + 2) = 0;
        *((_DWORD *)v5 + 3) = 0;
        *(_DWORD *)v5 = &off_665750;
        break;
      case 203:
        this->m_pauseTimer = -1;
        v5 = (unsigned __int8 *)CTask::operator new(0x20u);
        CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v5, 2000, 0, 0, 8.0);
        break;
      case 244:
        this->m_pauseTimer = -1;
        v5 = (unsigned __int8 *)CTask::operator new(0x40u);
        CTaskComplexSequence::CTaskComplexSequence((CTaskComplexSequence *)v5);
        v6 = (CTaskComplexTurnToFaceEntityOrCoord *)CTask::operator new(0x28u);
        CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(v6, this->m_pTargetPed, 0.5, 0.2);
        CTaskComplexSequence::AddTask((CTaskComplexSequence *)v5, v6);
        v7 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
        CTaskSimpleShakeFist::CTaskSimpleShakeFist(v7);
        CTaskComplexSequence::AddTask((CTaskComplexSequence *)v5, v7);
        break;
    }
  }
  return (CTask *)v5;
}
// 4E1EC8: variable 'v11' is possibly undefined
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669630: using guessed type void *off_669630;

//----- (004E1FEC) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootMelee::CreateFirstSubTask(CTaskComplexKillPedOnFootMelee *this, CPed *pPed)
{
  int m_pParent_low; // r0
  bool v5; // cc
  int v6; // r0
  tMeleeComboSet *v7; // r0
  float v9; // r1
  CPed *m_pTargetPed; // r0
  float v11; // s0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v14; // d16
  CMatrix *v15; // r0
  float v16; // s0
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v18; // d16
  unsigned __int64 v19; // d2
  int v20; // r1

  CInterestingEvents::Add(&g_InterestingEvents, EFistFight, pPed);
  this->m_bNewTarget = 0;
  CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
  if ( !this->m_pTargetPed )
    return 0;
  this->m_fAttackRange = 8.0;
  if ( CPedIntelligence::GetTaskFighting(pPed->m_pPedIntelligence) )
  {
    m_pParent_low = SLOBYTE(CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0)[4].m_pParent);
    v5 = m_pParent_low < 4;
    v6 = m_pParent_low - 4;
    if ( v5 )
      v6 = 0;
    v7 = &CTaskSimpleFight::m_aComboData[v6];
  }
  else
  {
    v7 = CTaskSimpleFight::m_aComboData;
  }
  v9 = *(float *)&byte_4[(_DWORD)v7];
  m_pTargetPed = this->m_pTargetPed;
  this->m_fArriveRange = v9;
  v11 = v9;
  if ( m_pTargetPed )
  {
    m_pMat = m_pTargetPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pTargetPed->m_transform;
    v14 = *(_QWORD *)&p_tx->m_translate.x;
    this->m_vecTargetPos.z = p_tx->m_translate.z;
    *(_QWORD *)&this->m_vecTargetPos.x = v14;
  }
  v15 = pPed->m_pMat;
  v16 = v11 * v11;
  p_m_transform = (CSimpleTransform *)&v15->tx;
  if ( !v15 )
    p_m_transform = &pPed->m_transform;
  v18.n64_u64[0] = vsub_f32(*(float32x2_t *)&this->m_vecTargetPos.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
  v19 = vmul_f32(v18, v18).n64_u64[0];
  if ( (float)((float)((float)((float)(this->m_vecTargetPos.x - p_m_transform->m_translate.x)
                             * (float)(this->m_vecTargetPos.x - p_m_transform->m_translate.x))
                     + *(float *)&v19)
             + *((float *)&v19 + 1)) <= v16 )
  {
    v20 = 1019;
  }
  else
  {
    v20 = 202;
    if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
      v20 = 907;
  }
  return CTaskComplexKillPedOnFootMelee::CreateSubTask(this, v20, pPed);
}

//----- (004E2100) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootMelee::ControlSubTask(CTaskComplexKillPedOnFootMelee *this, CPed *pPed)
{
  unsigned __int8 *m_pSubTask; // r4
  CPed *m_pTargetPed; // r0
  int v7; // r0
  int m_pParent_low; // r0
  bool v9; // cc
  int v10; // r0
  tMeleeComboSet *v11; // r0
  int v12; // r0
  int v13; // r0
  tMeleeComboSet *v14; // r0
  CTaskComplexTurnToFaceEntityOrCoord *v15; // r6
  CTaskSimpleShakeFist *v16; // r5
  float v17; // r1
  CPed *v18; // r0
  float v19; // s0
  CMatrix *v20; // r1
  CSimpleTransform *v21; // r2
  __int64 v22; // d16
  CMatrix *v23; // r0
  float v24; // s0
  CSimpleTransform *v25; // r1
  float32x2_t v26; // d16
  unsigned __int64 v27; // d2
  CTaskSimple *v28; // r0
  CPed *v29; // r6
  __int64 v30; // kr00_8
  float *p_fGroupRange; // r1
  CPed *v32; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v35; // d16
  CMatrix *v36; // r0
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v38; // d16
  unsigned __int64 v39; // d1
  CPed *v40; // r5
  int v41; // r1
  CTaskSimpleStandStill *v42; // r0
  CTaskSimpleStandStill v43; // [sp+10h] [bp-38h] BYREF

  m_pSubTask = (unsigned __int8 *)this->m_pSubTask;
  CPed::Say(pPed, 0x59u, 0, 1.0, 0, 0, 0);
  if ( this->m_bNewTarget )
    return (CTask *)(*((int (__fastcall **)(CTaskComplexKillPedOnFootMelee *, CPed *))this->_vptr$CTask + 11))(
                      this,
                      pPed);
  m_pTargetPed = this->m_pTargetPed;
  if ( !m_pTargetPed || m_pTargetPed->m_nHealth <= 0.0 )
    return 0;
  v7 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  if ( v7 <= 243 )
  {
    if ( v7 == 202 )
      goto LABEL_21;
    if ( v7 != 203 )
      return (CTask *)m_pSubTask;
LABEL_18:
    if ( *((unsigned __int8 *)&this->m_pTargetPed->m_nPhysicalFlags + 1) << 31
      || (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
           this->m_pSubTask,
           pPed,
           1,
           0) != 1 )
    {
      return (CTask *)m_pSubTask;
    }
LABEL_39:
    this->m_pauseTimer = -1;
    v28 = (CTaskSimple *)CTask::operator new(0x24u);
    v29 = this->m_pTargetPed;
    m_pSubTask = (unsigned __int8 *)v28;
    v30 = *(_QWORD *)&this->m_fAttackRange;
    CTaskSimple::CTaskSimple(v28);
    m_pSubTask[8] = 0;
    *(_DWORD *)m_pSubTask = &off_669630;
    *((_WORD *)m_pSubTask + 5) = 0;
    *((_DWORD *)m_pSubTask + 3) = v29;
    if ( v29 )
      CEntity::RegisterReference(v29, (CEntity **)m_pSubTask + 3);
    *((_DWORD *)m_pSubTask + 4) = HIDWORD(v30);
    *((_DWORD *)m_pSubTask + 5) = v30;
    *((_DWORD *)m_pSubTask + 6) = 1065353216;
    *((_DWORD *)m_pSubTask + 7) = 0;
    *((_DWORD *)m_pSubTask + 8) = 0;
    return (CTask *)m_pSubTask;
  }
  if ( v7 == 244 )
    goto LABEL_18;
  if ( v7 != 907 )
  {
    if ( v7 == 1019 )
    {
      if ( !(*((unsigned __int8 *)&this->m_pTargetPed->m_nPhysicalFlags + 1) << 31) )
      {
        this->m_fAttackRange = 8.0;
        if ( CPedIntelligence::GetTaskFighting(pPed->m_pPedIntelligence) )
        {
          m_pParent_low = SLOBYTE(CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0)[4].m_pParent);
          v9 = m_pParent_low < 4;
          v10 = m_pParent_low - 4;
          if ( v9 )
            v10 = 0;
          v11 = &CTaskSimpleFight::m_aComboData[v10];
        }
        else
        {
          v11 = CTaskSimpleFight::m_aComboData;
        }
        p_fGroupRange = &v11->fGroupRange;
        v32 = this->m_pTargetPed;
        this->m_fArriveRange = *p_fGroupRange;
        if ( v32 )
        {
          m_pMat = v32->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &v32->m_transform;
          v35 = *(_QWORD *)&p_tx->m_translate.x;
          this->m_vecTargetPos.z = p_tx->m_translate.z;
          *(_QWORD *)&this->m_vecTargetPos.x = v35;
        }
        v36 = pPed->m_pMat;
        p_m_transform = (CSimpleTransform *)&v36->tx;
        if ( !v36 )
          p_m_transform = &pPed->m_transform;
        v38.n64_u64[0] = vsub_f32(
                           *(float32x2_t *)&this->m_vecTargetPos.y,
                           *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
        v39 = vmul_f32(v38, v38).n64_u64[0];
        if ( (float)((float)((float)((float)(this->m_vecTargetPos.x - p_m_transform->m_translate.x)
                                   * (float)(this->m_vecTargetPos.x - p_m_transform->m_translate.x))
                           + *(float *)&v39)
                   + *((float *)&v39 + 1)) > (float)(this->m_fAttackRange * this->m_fAttackRange)
          && (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
               this->m_pSubTask,
               pPed,
               1,
               0) == 1 )
        {
          if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
          {
            CTaskSimpleStandStill::CTaskSimpleStandStill(&v43, 0, 0, 0, 8.0);
            CTaskSimpleStandStill::ProcessPed(v42, pPed);
            CTaskSimpleStandStill::~CTaskSimpleStandStill(&v43);
            if ( this->m_pauseTimer == -1 )
              this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
            m_pSubTask = (unsigned __int8 *)CTask::operator new(0x18u);
            CTaskSimple::CTaskSimple((CTaskSimple *)m_pSubTask);
            *((_WORD *)m_pSubTask + 8) = 0;
            *((_DWORD *)m_pSubTask + 5) = 100;
            *((_DWORD *)m_pSubTask + 2) = 0;
            *((_DWORD *)m_pSubTask + 3) = 0;
            *(_DWORD *)m_pSubTask = &off_665750;
          }
          else
          {
            this->m_pauseTimer = -1;
            m_pSubTask = (unsigned __int8 *)CTask::operator new(0x4Cu);
            v40 = this->m_pTargetPed;
            CTaskComplex::CTaskComplex((CTaskComplex *)m_pSubTask);
            *((_QWORD *)m_pSubTask + 3) = 0x400000003F800000LL;
            *((_QWORD *)m_pSubTask + 4) = 0x4000000000000000LL;
            *(_DWORD *)m_pSubTask = &off_6656D4;
            *((_DWORD *)m_pSubTask + 4) = 50000;
            *((_DWORD *)m_pSubTask + 5) = 1000;
            *((_WORD *)m_pSubTask + 24) = 0;
            *((_WORD *)m_pSubTask + 30) = 0;
            *((_DWORD *)m_pSubTask + 10) = 0;
            *((_DWORD *)m_pSubTask + 11) = 0;
            *((_DWORD *)m_pSubTask + 13) = 0;
            *((_DWORD *)m_pSubTask + 14) = 0;
            v41 = m_pSubTask[72];
            *((_DWORD *)m_pSubTask + 16) = &off_665710;
            *((_DWORD *)m_pSubTask + 17) = 6;
            m_pSubTask[72] = v41 & 0xF0 | 3;
            *((_DWORD *)m_pSubTask + 3) = v40;
            if ( v40 )
              CEntity::RegisterReference(v40, (CEntity **)m_pSubTask + 3);
          }
        }
        return (CTask *)m_pSubTask;
      }
      if ( (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
             this->m_pSubTask,
             pPed,
             1,
             0) == 1 )
        goto LABEL_29;
    }
    return (CTask *)m_pSubTask;
  }
LABEL_21:
  if ( !(*((unsigned __int8 *)&this->m_pTargetPed->m_nPhysicalFlags + 1) << 31) )
  {
    this->m_fAttackRange = 8.0;
    if ( CPedIntelligence::GetTaskFighting(pPed->m_pPedIntelligence) )
    {
      v12 = SLOBYTE(CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 0)[4].m_pParent);
      v9 = v12 < 4;
      v13 = v12 - 4;
      if ( v9 )
        v13 = 0;
      v14 = &CTaskSimpleFight::m_aComboData[v13];
    }
    else
    {
      v14 = CTaskSimpleFight::m_aComboData;
    }
    v17 = *(float *)&byte_4[(_DWORD)v14];
    v18 = this->m_pTargetPed;
    this->m_fArriveRange = v17;
    v19 = v17;
    if ( v18 )
    {
      v20 = v18->m_pMat;
      v21 = (CSimpleTransform *)&v20->tx;
      if ( !v20 )
        v21 = &v18->m_transform;
      v22 = *(_QWORD *)&v21->m_translate.x;
      this->m_vecTargetPos.z = v21->m_translate.z;
      *(_QWORD *)&this->m_vecTargetPos.x = v22;
    }
    v23 = pPed->m_pMat;
    v24 = v19 * v19;
    v25 = (CSimpleTransform *)&v23->tx;
    if ( !v23 )
      v25 = &pPed->m_transform;
    v26.n64_u64[0] = vsub_f32(*(float32x2_t *)&this->m_vecTargetPos.y, *(float32x2_t *)&v25->m_translate.y).n64_u64[0];
    v27 = vmul_f32(v26, v26).n64_u64[0];
    if ( (float)((float)((float)((float)(this->m_vecTargetPos.x - v25->m_translate.x)
                               * (float)(this->m_vecTargetPos.x - v25->m_translate.x))
                       + *(float *)&v27)
               + *((float *)&v27 + 1)) >= v24
      || (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
           this->m_pSubTask,
           pPed,
           1,
           0) != 1 )
    {
      return (CTask *)m_pSubTask;
    }
    goto LABEL_39;
  }
  if ( (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
         this->m_pSubTask,
         pPed,
         1,
         0) == 1 )
  {
LABEL_29:
    this->m_pauseTimer = -1;
    m_pSubTask = (unsigned __int8 *)CTask::operator new(0x40u);
    CTaskComplexSequence::CTaskComplexSequence((CTaskComplexSequence *)m_pSubTask);
    v15 = (CTaskComplexTurnToFaceEntityOrCoord *)CTask::operator new(0x28u);
    CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(v15, this->m_pTargetPed, 0.5, 0.2);
    CTaskComplexSequence::AddTask((CTaskComplexSequence *)m_pSubTask, v15);
    v16 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
    CTaskSimpleShakeFist::CTaskSimpleShakeFist(v16);
    CTaskComplexSequence::AddTask((CTaskComplexSequence *)m_pSubTask, v16);
  }
  return (CTask *)m_pSubTask;
}
// 4E24F4: variable 'v42' is possibly undefined
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669630: using guessed type void *off_669630;

//----- (004E2590) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootArmed::CTaskComplexKillPedOnFootArmed(
        CTaskComplexKillPedOnFootArmed *this,
        CPed *pTargetPed,
        uint32 nDuckingConditions,
        uint32 nTimeToDuck,
        uint32 nPercentageDuckChance,
        Int32 nCompetence)
{
  CTaskComplex::CTaskComplex(this);
  this->m_nShootTimer = 0;
  this->m_nLastAttackTime = 0;
  this->m_nTimeOfLastRoll = 0;
  this->m_nDuckingConditions = nDuckingConditions;
  this->m_nTimeToDuck = nTimeToDuck;
  *(_QWORD *)&this->m_nPercentageDuckChance = nPercentageDuckChance;
  this->m_nStrafeTimer = 0;
  this->m_nCompetence = nCompetence;
  *(_DWORD *)&this->m_bStrafeBack = 0;
  this->m_vecLosBlockedTargetPos.y = 0.0;
  this->m_nLosBlockedTime = 0;
  this->m_nLosClearTime = 0;
  *(_QWORD *)&this->m_vecLosBlockedOurPos.x = 0LL;
  *(_QWORD *)&this->m_vecLosBlockedOurPos.z = 3323739136LL;
  this->m_iNeedToMoveInCloserTime = 0;
  this->m_vecLosBlockedTargetPos.z = -9999.0;
  this->_vptr$CTask = (int (**)(void))&off_6698F4;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
}
// 6698F4: using guessed type void *off_6698F4;
// 4E2590: using guessed type Int32 anonymous_0;

//----- (004E2624) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootArmed::~CTaskComplexKillPedOnFootArmed(CTaskComplexKillPedOnFootArmed *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_6698F4;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  sub_18EDB4(this);
}
// 6698F4: using guessed type void *off_6698F4;

//----- (004E2650) --------------------------------------------------------
void __fastcall CTaskComplexKillPedOnFootArmed::~CTaskComplexKillPedOnFootArmed(CTaskComplexKillPedOnFootArmed *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  void *v4; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_6698F4;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E2678: variable 'v4' is possibly undefined
// 6698F4: using guessed type void *off_6698F4;

//----- (004E2680) --------------------------------------------------------
bool __fastcall CTaskComplexKillPedOnFootArmed::MakeAbortable(
        CTaskComplexKillPedOnFootArmed *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  if ( iPriority == 1 && pEvent )
  {
    if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) != 31
      || (CPed *)pEvent[1].m_iAccumulatedTime != this->m_pTargetPed )
    {
      return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
              + 7))(
               this->m_pSubTask,
               pPed,
               iPriority,
               pEvent);
    }
  }
  else if ( (unsigned int)(iPriority - 1) <= 1 )
  {
    return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
            + 7))(
             this->m_pSubTask,
             pPed,
             iPriority,
             pEvent);
  }
  return 0;
}

//----- (004E26D0) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootArmed::CreateFirstSubTask(CTaskComplexKillPedOnFootArmed *this, CPed *pPed)
{
  CTaskSimpleGoToPoint *v3; // r6
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r8
  CPed *m_pTargetPed; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_m_transform; // r9
  CMatrix *v11; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float v14; // s16
  _BOOL4 IsTypeMelee; // r6
  float v16; // s0
  CPed *v17; // r0
  CMatrix *v18; // r2
  CVector *p_m_translate; // r1
  CCoverPoint *v20; // r0
  CPed *v21; // r1
  CMatrix *v22; // r3
  CVector *v23; // r2
  _BOOL4 CoordinatesCoverPoint; // r0
  CMatrix *v25; // r0
  _BOOL4 v26; // r0
  bool v27; // zf
  int v28; // r1
  CVector ResultCoors; // [sp+14h] [bp-34h] BYREF

  v3 = 0;
  this->m_bNewTarget = 0;
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  m_pTargetPed = this->m_pTargetPed;
  if ( m_pTargetPed )
  {
    m_pMat = pPed->m_pMat;
    p_m_transform = &pPed->m_transform;
    v11 = m_pTargetPed->m_pMat;
    p_tx = &pPed->m_transform;
    if ( m_pMat )
      p_tx = (CSimpleTransform *)&m_pMat->tx;
    p_x = &v11->tx;
    if ( !v11 )
      p_x = &m_pTargetPed->m_transform.m_translate.x;
    v14 = (float)((float)((float)(*p_x - p_tx->m_translate.x) * (float)(*p_x - p_tx->m_translate.x))
                + (float)((float)(p_x[1] - p_tx->m_translate.y) * (float)(p_x[1] - p_tx->m_translate.y)))
        + (float)((float)(p_x[2] - p_tx->m_translate.z) * (float)(p_x[2] - p_tx->m_translate.z));
    IsTypeMelee = CWeapon::IsTypeMelee(&m_pTargetPed->m_WeaponSlots[m_pTargetPed->m_nCurrentWeapon]);
    if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
      goto LABEL_23;
    if ( (rand() & 1) == 0 )
      goto LABEL_23;
    if ( this->m_nCompetence < 1 )
      goto LABEL_23;
    v16 = sqrtf(v14);
    if ( v16 <= 30.0 && (v16 <= 6.0 || IsTypeMelee) )
      goto LABEL_23;
    CPed::ReleaseCoverPoint(pPed);
    v17 = this->m_pTargetPed;
    v18 = v17->m_pMat;
    p_m_translate = (CVector *)&v18->tx;
    if ( !v18 )
      p_m_translate = &v17->m_transform.m_translate;
    v20 = CCover::FindAndReserveCoverPoint(pPed, p_m_translate, 0);
    pPed->m_pCoverPoint = v20;
    if ( !v20 )
      goto LABEL_23;
    v21 = this->m_pTargetPed;
    v22 = v21->m_pMat;
    v23 = (CVector *)&v22->tx;
    if ( !v22 )
      v23 = &v21->m_transform.m_translate;
    CoordinatesCoverPoint = CCover::FindCoordinatesCoverPoint(v20, pPed, v23, &ResultCoors);
    ResultCoors.z = ResultCoors.z + 1.0;
    if ( !CoordinatesCoverPoint )
      goto LABEL_22;
    v25 = pPed->m_pMat;
    if ( v25 )
      p_m_transform = (CSimpleTransform *)&v25->tx;
    if ( !CWorld::GetIsLineOfSightClear(&ResultCoors, &p_m_transform->m_translate, 1, 1, 0, 0, 0, 0, 0) )
    {
LABEL_22:
      CPed::ReleaseCoverPoint(pPed);
      goto LABEL_23;
    }
    CPedIntelligence::SetTaskDuckSecondary(pPed->m_pPedIntelligence, 0x1770u);
    v3 = (CTaskSimpleGoToPoint *)CTask::operator new(0x2Cu);
    CTaskSimpleGoToPoint::CTaskSimpleGoToPoint(v3, 6, &ResultCoors, 0.5, 1, 0);
    if ( !v3 )
    {
LABEL_23:
      if ( v14 <= (float)(WeaponInfo->m_fTargetRange * (float)(WeaponInfo->m_fTargetRange * 0.25))
        && CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed) )
      {
        goto LABEL_30;
      }
      if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x60) == 0 )
      {
        v28 = 907;
        return CTaskComplexKillPedOnFootArmed::CreateSubTask(this, v28, pPed);
      }
      v26 = CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed);
      v27 = !v26;
      if ( !v26 )
        v27 = BYTE1(WeaponInfo->m_nFlags) << 31 == 0;
      if ( v27 )
LABEL_30:
        v28 = 1020;
      else
        v28 = 202;
      return CTaskComplexKillPedOnFootArmed::CreateSubTask(this, v28, pPed);
    }
  }
  return v3;
}

//----- (004E28D8) --------------------------------------------------------
bool __fastcall CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(
        CTaskComplexKillPedOnFootArmed *this,
        CPed *pPed)
{
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  float v6; // s16
  uint32 v7; // r0
  CPed *m_pTargetPed; // r0
  bool result; // r0
  CPed *v10; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  float32x2_t v13; // d16
  unsigned __int64 v14; // d1
  CMatrix *v15; // r0
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v17; // d16
  unsigned __int64 v18; // d1
  CMatrix *v19; // r0
  CSimpleTransform *v20; // r1
  RwReal v21; // s0
  RwReal v22; // s2
  CPed *v23; // r0
  bool v24; // zf
  int v25; // r10
  int v26; // r8
  uint32 v27; // r0
  CPed *v28; // r2
  CMatrix *v29; // r1
  CSimpleTransform *v30; // r3
  __int64 v31; // d16
  CMatrix *v32; // r1
  CSimpleTransform *v33; // r2
  __int64 v34; // d16
  CVehicle *v35; // r1
  CEntity::CFlags m_nFlags; // r2
  CVehicle *m_pMyVehicle; // r0
  RwV3d_0 v38; // [sp+18h] [bp-38h] BYREF
  RwV3d_0 posn; // [sp+24h] [bp-2Ch] BYREF

  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  if ( pPed->m_areaCode
    || (v6 = 9.0, (m_pTargetPed = this->m_pTargetPed) != 0)
    && CPed::IsPlayer(m_pTargetPed)
    && (CGame::currArea || pPed->CharCreatedBy == 2) )
  {
    v6 = 9.0;
    v7 = 5000;
    if ( g_LoadMonitor.m_eProcLevel < eProcLevelHigh )
      v6 = 4.0;
  }
  else
  {
    v7 = 10000;
  }
  if ( CTimer::m_snTimeInMilliseconds - this->m_nLosClearTime < v7 )
    return 1;
  if ( CTimer::m_snTimeInMilliseconds - this->m_nLosBlockedTime <= v7 )
  {
    v10 = this->m_pTargetPed;
    if ( !v10 )
      goto LABEL_17;
    m_pMat = v10->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v10->m_transform;
    v13.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&this->m_vecLosBlockedTargetPos.y).n64_u64[0];
    v14 = vmul_f32(v13, v13).n64_u64[0];
    if ( (float)((float)((float)((float)(p_tx->m_translate.x - this->m_vecLosBlockedTargetPos.x)
                               * (float)(p_tx->m_translate.x - this->m_vecLosBlockedTargetPos.x))
                       + *(float *)&v14)
               + *((float *)&v14 + 1)) <= v6 )
    {
LABEL_17:
      v15 = pPed->m_pMat;
      p_m_transform = (CSimpleTransform *)&v15->tx;
      if ( !v15 )
        p_m_transform = &pPed->m_transform;
      v17.n64_u64[0] = vsub_f32(
                         *(float32x2_t *)&p_m_transform->m_translate.y,
                         *(float32x2_t *)&this->m_vecLosBlockedOurPos.y).n64_u64[0];
      v18 = vmul_f32(v17, v17).n64_u64[0];
      if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - this->m_vecLosBlockedOurPos.x)
                                 * (float)(p_m_transform->m_translate.x - this->m_vecLosBlockedOurPos.x))
                         + *(float *)&v18)
                 + *((float *)&v18 + 1)) <= v6 )
        return 0;
    }
  }
  posn.y = 0.0;
  posn.x = 0.1;
  posn.z = 0.0;
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 )
  {
    v19 = pPed->m_pMat;
    v20 = (CSimpleTransform *)&v19->tx;
    if ( !v19 )
      v20 = &pPed->m_transform;
    v21 = v20->m_translate.z + 0.25;
    v22 = v20->m_translate.x + 0.0;
    posn.y = v20->m_translate.y + 0.0;
    posn.x = v22;
    posn.z = v21;
  }
  else
  {
    CPed::GetTransformedBonePosition(pPed, &posn, 5u, 0);
  }
  v38.x = 0.1;
  v38.y = 0.0;
  v38.z = 0.0;
  CPed::GetTransformedBonePosition(this->m_pTargetPed, &v38, 5u, 0);
  v23 = this->m_pTargetPed;
  v24 = v23 == 0;
  if ( v23 )
    v24 = *((unsigned __int8 *)&v23->m_nPedFlags + 1) << 31 == 0;
  if ( v24 || (m_pMyVehicle = v23->m_pMyVehicle) == 0 )
  {
    v25 = 0;
    v26 = 0;
  }
  else
  {
    v25 = 1;
    v26 = *(_DWORD *)&m_pMyVehicle->m_nFlags & 1;
    *(_DWORD *)&m_pMyVehicle->m_nFlags &= ~1u;
  }
  if ( CWorld::GetIsLineOfSightClear((const CVector *)&posn, (const CVector *)&v38, 1, 1, 0, 1, 0, 1, 0) )
  {
    v27 = CTimer::m_snTimeInMilliseconds;
    this->m_nLosBlockedTime = 0;
    this->m_nLosClearTime = v27;
    result = 1;
    if ( v25 != 1 )
      return result;
LABEL_38:
    v35 = this->m_pTargetPed->m_pMyVehicle;
    m_nFlags = v35->m_nFlags;
    *(_DWORD *)&m_nFlags = *(_DWORD *)&m_nFlags & 0xFFFFFFFE | v26;
    v35->m_nFlags = m_nFlags;
    return result;
  }
  v28 = this->m_pTargetPed;
  result = 0;
  this->m_nLosClearTime = 0;
  this->m_nLosBlockedTime = CTimer::m_snTimeInMilliseconds;
  v29 = v28->m_pMat;
  v30 = (CSimpleTransform *)&v29->tx;
  if ( !v29 )
    v30 = &v28->m_transform;
  v31 = *(_QWORD *)&v30->m_translate.x;
  this->m_vecLosBlockedTargetPos.z = v30->m_translate.z;
  *(_QWORD *)&this->m_vecLosBlockedTargetPos.x = v31;
  v32 = pPed->m_pMat;
  v33 = (CSimpleTransform *)&v32->tx;
  if ( !v32 )
    v33 = &pPed->m_transform;
  v34 = *(_QWORD *)&v33->m_translate.x;
  this->m_vecLosBlockedOurPos.z = v33->m_translate.z;
  *(_QWORD *)&this->m_vecLosBlockedOurPos.x = v34;
  if ( v25 == 1 )
    goto LABEL_38;
  return result;
}

//----- (004E2B60) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootArmed::CreateSubTask(
        CTaskComplexKillPedOnFootArmed *this,
        int iSubTaskType,
        CPed *pPed)
{
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  void *v9; // r5
  int v10; // r8
  CPed *v11; // r4
  bool8 m_bAimImmediate; // r1
  uint32 v13; // r4
  int32 m_iNeedToMoveInCloserTime; // r0
  CPed **p_m_pTargetPed; // r4
  unsigned int v16; // r0
  float v17; // s16
  CMatrix *m_pMat; // r1
  CMatrix *v19; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float y; // s2
  float v23; // s6
  CMatrix *v24; // r2
  const CVector *p_m_translate; // r0
  float v26; // s0
  float z; // s4
  float v28; // s8
  CTaskSimpleStandStill *v29; // r0
  CPed *m_pTargetPed; // r4
  uint32 v31; // r0
  CPed *v32; // r6
  int *v33; // r2
  __int64 v34; // d17
  char v35; // r3
  UInt16 v36; // r1
  char v37; // r3
  CMatrix *v39; // r2
  const CVector *v40; // r0
  CVector vTarget; // [sp+18h] [bp-58h] BYREF
  CVector vecEnd; // [sp+24h] [bp-4Ch] BYREF
  CTaskSimpleStandStill v43[2]; // [sp+30h] [bp-40h] BYREF

  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  v9 = 0;
  if ( iSubTaskType > 414 )
  {
    if ( iSubTaskType == 415 )
    {
      v9 = CTask::operator new(0x28u);
      CTaskSimpleDuck::CTaskSimpleDuck((CTaskSimpleDuck *)v9, 0, this->m_nTimeToDuck, -1);
      return (CTask *)v9;
    }
    if ( iSubTaskType != 907 )
    {
      if ( iSubTaskType == 1020 )
      {
        if ( BYTE1(WeaponInfo->m_nFlags) << 31 )
        {
          v9 = CTask::operator new(0x1Cu);
          m_pTargetPed = this->m_pTargetPed;
          CTaskSimple::CTaskSimple((CTaskSimple *)v9);
          *((_DWORD *)v9 + 4) = 0;
          *((_DWORD *)v9 + 5) = 0;
          *((_DWORD *)v9 + 6) = 0;
          *((_WORD *)v9 + 4) = 0;
          *(_DWORD *)v9 = &off_669700;
          *((_DWORD *)v9 + 3) = m_pTargetPed;
          if ( m_pTargetPed )
            CEntity::RegisterReference(m_pTargetPed, (CEntity **)v9 + 3);
        }
        else
        {
          v10 = CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed);
          v9 = CTask::operator new(0x3Cu);
          v11 = this->m_pTargetPed;
          CTaskSimple::CTaskSimple((CTaskSimple *)v9);
          *((_QWORD *)v9 + 2) = 0LL;
          *((_QWORD *)v9 + 3) = 0LL;
          *((_BYTE *)v9 + 8) = 0;
          *(_DWORD *)v9 = &off_669698;
          *((_DWORD *)v9 + 8) = 0;
          *((_DWORD *)v9 + 9) = 0;
          *((_DWORD *)v9 + 3) = v11;
          if ( v10 )
            LOBYTE(v10) = 3;
          if ( v11 )
            CEntity::RegisterReference(v11, (CEntity **)v9 + 3);
          *((_WORD *)v9 + 22) = 5;
          *((_BYTE *)v9 + 46) = v10;
          *((_DWORD *)v9 + 12) = 1065353216;
          *((_DWORD *)v9 + 13) = 0;
          *((_DWORD *)v9 + 10) = -1;
          *((_WORD *)v9 + 28) = 1;
          m_bAimImmediate = this->m_bAimImmediate;
          *((_BYTE *)v9 + 58) = m_bAimImmediate != 0;
          this->m_bAimImmediate = 0;
          v13 = CTimer::m_snTimeInMilliseconds;
          this->m_nShootTimer = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 4000.0)
                              + v13
                              + 4000;
          if ( CPedGroups::GetPedsGroup(pPed) )
            CPed::Say(pPed, 0xCFu, 0, 1.0, 0, 0, 0);
        }
        v31 = CTimer::m_snTimeInMilliseconds;
        this->m_nLosBlockedTime = 0;
        this->m_nLastAttackTime = v31;
      }
      return (CTask *)v9;
    }
    m_iNeedToMoveInCloserTime = this->m_iNeedToMoveInCloserTime;
    if ( m_iNeedToMoveInCloserTime )
    {
      p_m_pTargetPed = &this->m_pTargetPed;
      v16 = CTimer::m_snTimeInMilliseconds - m_iNeedToMoveInCloserTime;
      v17 = (float)v16;
      if ( v16 > 0xBB7 )
      {
        if ( v16 <= 0x1F40 )
        {
          v9 = CTask::operator new(0x4Cu);
          v32 = *p_m_pTargetPed;
          CTaskComplex::CTaskComplex((CTaskComplex *)v9);
          *((_QWORD *)v9 + 2) = 0x3E80000C350LL;
          *((_DWORD *)v9 + 7) = 0x40000000;
          *((_DWORD *)v9 + 8) = 0;
          *((_DWORD *)v9 + 9) = 0x40000000;
          *((_WORD *)v9 + 24) = 0;
          *((_WORD *)v9 + 30) = 0;
          *((_DWORD *)v9 + 10) = 0;
          *((_DWORD *)v9 + 11) = 0;
          *((_DWORD *)v9 + 13) = 0;
          *((_DWORD *)v9 + 14) = 0;
          v37 = *((_BYTE *)v9 + 72);
          *(_DWORD *)v9 = &off_6656D4;
          *((_DWORD *)v9 + 16) = &off_665710;
          *((_DWORD *)v9 + 17) = 6;
          *((_BYTE *)v9 + 72) = v37 & 0xF0 | 3;
          *((float *)v9 + 6) = (float)((float)((float)(v17 + -3000.0) * -5.0) / 5000.0) + 6.0;
LABEL_34:
          *((_DWORD *)v9 + 3) = v32;
          if ( v32 )
            CEntity::RegisterReference(v32, (CEntity **)v9 + 3);
          goto LABEL_36;
        }
        m_pMat = pPed->m_pMat;
        v19 = (*p_m_pTargetPed)->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pPed->m_transform;
        p_x = &v19->tx;
        y = p_tx->m_translate.y;
        if ( !v19 )
          p_x = &(*p_m_pTargetPed)->m_transform.m_translate.x;
        v23 = p_x[1];
        *(float *)&v43[0]._vptr$CTask = *p_x - p_tx->m_translate.x;
        v43[0].m_iDuration = 0;
        *(float *)&v43[0].m_pParent = v23 - y;
        CVector::Normalise((CVector *)v43);
        v24 = (*p_m_pTargetPed)->m_pMat;
        p_m_translate = (const CVector *)&v24->tx;
        v26 = *(float *)&v43[0].m_pParent * -1.5;
        if ( !v24 )
          p_m_translate = &(*p_m_pTargetPed)->m_transform.m_translate;
        vecEnd.x = v26 + p_m_translate->x;
        vecEnd.y = (float)(*(float *)&v43[0]._vptr$CTask * 1.5) + p_m_translate->y;
        z = p_m_translate->z;
        vecEnd.z = z + 0.0;
        v28 = p_m_translate->y;
        vTarget.x = p_m_translate->x - v26;
        vTarget.z = z;
        vTarget.y = v28 - (float)(*(float *)&v43[0]._vptr$CTask * 1.5);
        if ( CWorld::GetIsLineOfSightClear(p_m_translate, &vecEnd, 1, 1, 0, 0, 1, 0, 0) )
        {
          v9 = CTask::operator new(0x28u);
          CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(
            (CTaskComplexGoToPointAndStandStill *)v9,
            6,
            &vecEnd,
            0.5,
            2.0,
            0,
            0);
LABEL_36:
          if ( *p_m_pTargetPed && CPed::IsPlayer(*p_m_pTargetPed) )
          {
            if ( pPed->m_nPedType == 6 )
            {
              if ( FindPlayerWanted(-1)->m_nCopsInPursuit < 2u )
                v36 = 199;
              else
                v36 = 43;
              if ( CPed::Say(pPed, v36, 0, 1.0, 0, 0, 0) > -1 )
                CPed::Say(*p_m_pTargetPed, 0x2Cu, 0xDACu, 1.0, 0, 0, 0);
            }
            else if ( CPedGroups::GetPedsGroup(pPed) )
            {
              CPed::Say(pPed, 0x2Bu, 0, 1.0, 0, 0, 0);
            }
          }
          return (CTask *)v9;
        }
        v39 = (*p_m_pTargetPed)->m_pMat;
        v40 = (const CVector *)&v39->tx;
        if ( !v39 )
          v40 = &(*p_m_pTargetPed)->m_transform.m_translate;
        if ( CWorld::GetIsLineOfSightClear(v40, &vTarget, 1, 1, 0, 0, 1, 0, 0) )
        {
          v9 = CTask::operator new(0x28u);
          CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(
            (CTaskComplexGoToPointAndStandStill *)v9,
            6,
            &vTarget,
            0.5,
            2.0,
            0,
            0);
          goto LABEL_36;
        }
        v9 = CTask::operator new(0x4Cu);
        v32 = *p_m_pTargetPed;
        CTaskComplex::CTaskComplex((CTaskComplex *)v9);
        v33 = dword_4E3080;
LABEL_33:
        v34 = *((_QWORD *)v33 + 1);
        *((_QWORD *)v9 + 3) = *(_QWORD *)v33;
        *((_QWORD *)v9 + 4) = v34;
        *((_DWORD *)v9 + 4) = 50000;
        *((_DWORD *)v9 + 5) = 1000;
        *((_WORD *)v9 + 24) = 0;
        *((_WORD *)v9 + 30) = 0;
        *((_DWORD *)v9 + 10) = 0;
        *((_DWORD *)v9 + 11) = 0;
        *((_DWORD *)v9 + 13) = 0;
        *((_DWORD *)v9 + 14) = 0;
        v35 = *((_BYTE *)v9 + 72);
        *(_DWORD *)v9 = &off_6656D4;
        *((_DWORD *)v9 + 16) = &off_665710;
        *((_DWORD *)v9 + 17) = 6;
        *((_BYTE *)v9 + 72) = v35 & 0xF0 | 3;
        goto LABEL_34;
      }
    }
    else
    {
      p_m_pTargetPed = &this->m_pTargetPed;
    }
    v9 = CTask::operator new(0x4Cu);
    v32 = *p_m_pTargetPed;
    CTaskComplex::CTaskComplex((CTaskComplex *)v9);
    v33 = dword_4E3090;
    goto LABEL_33;
  }
  if ( iSubTaskType == 202 )
  {
    CTaskSimpleStandStill::CTaskSimpleStandStill(v43, 0, 0, 0, 8.0);
    CTaskSimpleStandStill::ProcessPed(v29, pPed);
    CTaskSimpleStandStill::~CTaskSimpleStandStill(v43);
    v9 = CTask::operator new(0x18u);
    CTaskSimple::CTaskSimple((CTaskSimple *)v9);
    *((_WORD *)v9 + 8) = 0;
    *(_DWORD *)v9 = &off_665750;
    *((_DWORD *)v9 + 5) = 100;
    *((_DWORD *)v9 + 2) = 0;
    *((_DWORD *)v9 + 3) = 0;
  }
  else if ( iSubTaskType == 203 )
  {
    v9 = CTask::operator new(0x20u);
    CTaskSimpleStandStill::CTaskSimpleStandStill(
      (CTaskSimpleStandStill *)v9,
      (const int)&elf_hash_bucket[4937],
      0,
      0,
      8.0);
  }
  return (CTask *)v9;
}
// 4E2E22: variable 'v29' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 4E3080: using guessed type int dword_4E3080[3];
// 4E3090: using guessed type int dword_4E3090[3];
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669698: using guessed type void *off_669698;
// 669700: using guessed type void *off_669700;

//----- (004E30F0) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedOnFootArmed::CreateNextSubTask(CTaskComplexKillPedOnFootArmed *this, CPed *pPed)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  CPed *m_pTargetPed; // r0
  _BOOL4 IsTypeMelee; // r8
  eWeaponType m_eWeaponType; // r4
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r4
  __int64 v11; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_m_transform; // r11
  int v14; // r3
  CSimpleTransform *p_tx; // r6
  float *v16; // r2
  float x; // s16
  float y; // s22
  float z; // s20
  float v20; // s24
  float v21; // s28
  float v22; // s26
  float m_fTargetRange; // s18
  int v24; // r0
  void *SubTask; // r6
  eWeaponType v26; // r4
  int8 v27; // r0
  CTaskSimpleStandStill *v28; // r0
  eWeaponType v29; // r4
  int8 v30; // r0
  CWeaponInfo *v31; // r0
  CPed *v32; // r1
  int v33; // r4
  CMatrix *v34; // r2
  CMatrix *v35; // r3
  CSimpleTransform *v36; // r2
  float32x2_t v37; // d16
  unsigned __int64 v38; // d1
  CTaskComplexKillPedOnFootArmed *v39; // r0
  int v40; // r1
  int m_nPedFlags; // r0
  float v42; // s16
  _BOOL4 v43; // r0
  int v44; // r1
  int32 *p_m_iNeedToMoveInCloserTime; // r9
  int32 m_iNeedToMoveInCloserTime; // t1
  uint32 v47; // r0
  float32x2_t v48; // d0
  CPed *v49; // r4
  char v50; // r3
  eWeaponType v51; // r4
  int8 v52; // r0
  CTaskSimpleStandStill *v53; // r0
  CCoverPoint *m_pCoverPoint; // r0
  CPed *v55; // r1
  CMatrix *v56; // r2
  CVector *p_m_translate; // r3
  CPed *v58; // r1
  CMatrix *v59; // r3
  CVector *v60; // r2
  CMatrix *v61; // r0
  CSimpleTransform *v62; // r1
  float32x2_t v63; // d16
  unsigned __int64 v64; // d0
  char v65; // r0
  bool v66; // zf
  CPed *v67; // r4
  bool8 m_bAimImmediate; // r1
  uint32 v69; // r0
  char v70; // r1
  int v71; // r2
  int v72; // r1
  CPed *v73; // r0
  CMatrix *v74; // r2
  CVector *v75; // r1
  CCoverPoint *v76; // r0
  CPed *v77; // r1
  CMatrix *v78; // r3
  CVector *v79; // r2
  _BOOL4 CoordinatesCoverPoint; // r0
  CPed *v81; // r0
  CMatrix *v82; // r1
  float32x2_t *v83; // r2
  float32x2_t v84; // d16
  unsigned __int64 v85; // d0
  CMatrix *v86; // r0
  CSimpleTransform *v87; // r1
  int v88; // r0
  void *v89; // r4
  CPed *v90; // r8
  char v91; // r1
  int m_StrafeDirection; // r0
  uint32 v93; // r0
  CMatrix *v94; // r1
  CTaskSimple v95; // d16
  float v96; // s4
  float v97; // s2
  float v98; // s0
  uint8 v99; // r4
  _BOOL4 IsLineOfSightClear; // r0
  uint32 v101; // r0
  uint32 v102; // r0
  eWeaponType v103; // r4
  int8 v104; // r0
  CTaskSimpleStandStill *v105; // r0
  CCoverPoint *v106; // r0
  CPed *v108; // [sp+18h] [bp-88h]
  CVector vecEnd; // [sp+1Ch] [bp-84h] BYREF
  CTaskSimpleStandStill v110; // [sp+28h] [bp-78h] BYREF

  m_pTargetPed = this->m_pTargetPed;
  if ( !m_pTargetPed )
    return 0;
  IsTypeMelee = CWeapon::IsTypeMelee(&m_pTargetPed->m_WeaponSlots[m_pTargetPed->m_nCurrentWeapon]);
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  v11 = *(_QWORD *)&this->m_pSubTask;
  m_pMat = pPed->m_pMat;
  p_m_transform = &pPed->m_transform;
  v14 = *(_DWORD *)(HIDWORD(v11) + 20);
  p_tx = &pPed->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v16 = (float *)(v14 + 48);
  x = p_tx->m_translate.x;
  y = p_tx->m_translate.y;
  z = p_tx->m_translate.z;
  if ( !v14 )
    v16 = (float *)(HIDWORD(v11) + 4);
  v20 = *v16;
  v21 = v16[1];
  v22 = v16[2];
  m_fTargetRange = WeaponInfo->m_fTargetRange;
  v24 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)v11 + 20))(v11);
  SubTask = 0;
  if ( v24 >= 900 )
  {
    switch ( v24 )
    {
      case 900:
        if ( CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed) )
          goto LABEL_32;
        v51 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
        v52 = CPed::GetWeaponSkill(pPed);
        CWeaponInfo::GetWeaponInfo(v51, v52);
        CTaskSimpleStandStill::CTaskSimpleStandStill(&v110, 0, 0, 0, 8.0);
        CTaskSimpleStandStill::ProcessPed(v53, pPed);
        CTaskSimpleStandStill::~CTaskSimpleStandStill(&v110);
        SubTask = CTask::operator new(0x18u);
        CTaskSimple::CTaskSimple((CTaskSimple *)SubTask);
        *((_WORD *)SubTask + 8) = 0;
        *(_DWORD *)SubTask = &off_665750;
        *((_DWORD *)SubTask + 5) = 100;
        *((_DWORD *)SubTask + 2) = 0;
        *((_DWORD *)SubTask + 3) = 0;
        goto LABEL_137;
      case 901:
        goto LABEL_22;
      case 902:
      case 904:
      case 905:
      case 906:
        goto LABEL_137;
      case 903:
      case 907:
        if ( !CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed) )
        {
          v26 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
          v27 = CPed::GetWeaponSkill(pPed);
          CWeaponInfo::GetWeaponInfo(v26, v27);
          CTaskSimpleStandStill::CTaskSimpleStandStill(&v110, 0, 0, 0, 8.0);
          CTaskSimpleStandStill::ProcessPed(v28, pPed);
          CTaskSimpleStandStill::~CTaskSimpleStandStill(&v110);
          SubTask = CTask::operator new(0x18u);
          CTaskSimple::CTaskSimple((CTaskSimple *)SubTask);
          *((_WORD *)SubTask + 8) = 0;
          *(_DWORD *)SubTask = &off_665750;
          *((_DWORD *)SubTask + 5) = 100;
          *((_DWORD *)SubTask + 2) = 0;
          *((_DWORD *)SubTask + 3) = 0;
          goto LABEL_35;
        }
LABEL_32:
        v39 = this;
        v40 = 1020;
        goto LABEL_33;
      default:
        if ( (unsigned int)(v24 - 1020) >= 2 )
          goto LABEL_137;
LABEL_22:
        m_nPedFlags = (int)pPed->m_nPedFlags;
        if ( (m_nPedFlags & 0x200000) != 0 )
          goto LABEL_130;
        v42 = sqrtf(
                (float)((float)((float)(v20 - x) * (float)(v20 - x)) + (float)((float)(v21 - y) * (float)(v21 - y)))
              + (float)((float)(v22 - z) * (float)(v22 - z)));
        if ( v42 < 3.0 )
          goto LABEL_24;
        v3.n64_u32[0] = 23.0;
        v2.n64_f32[0] = m_fTargetRange * 0.8;
        v48.n64_u64[0] = vmin_f32(v2, v3).n64_u64[0];
        if ( v42 > v48.n64_f32[0] )
        {
          if ( (m_nPedFlags & 0x400000) == 0 )
          {
            SubTask = CTask::operator new(0x4Cu);
            v49 = this->m_pTargetPed;
            CTaskComplex::CTaskComplex((CTaskComplex *)SubTask);
            v3.n64_u32[0] = 20.0;
            v48.n64_f32[0] = m_fTargetRange * 0.6;
            *((_QWORD *)SubTask + 2) = 0x3E80000C350LL;
            *((_DWORD *)SubTask + 6) = vmin_f32(v48, v3).n64_u32[0];
            *((_DWORD *)SubTask + 7) = 0x40000000;
            *((_DWORD *)SubTask + 8) = 0;
            *((_DWORD *)SubTask + 9) = 0x40000000;
            *((_WORD *)SubTask + 24) = 0;
            *((_WORD *)SubTask + 30) = 0;
            *((_DWORD *)SubTask + 10) = 0;
            *((_DWORD *)SubTask + 11) = 0;
            *((_DWORD *)SubTask + 13) = 0;
            *((_DWORD *)SubTask + 14) = 0;
            v50 = *((_BYTE *)SubTask + 72);
            *(_DWORD *)SubTask = &off_6656D4;
            *((_DWORD *)SubTask + 16) = &off_665710;
            *((_DWORD *)SubTask + 17) = 6;
            *((_BYTE *)SubTask + 72) = v50 & 0xF0 | 3;
            *((_DWORD *)SubTask + 3) = v49;
            if ( v49 )
              CEntity::RegisterReference(v49, (CEntity **)SubTask + 3);
LABEL_25:
            if ( SubTask )
              goto LABEL_131;
            goto LABEL_130;
          }
          goto LABEL_130;
        }
        if ( (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) == 1020
          && BYTE1(this->m_pSubTask[7]._vptr$CTask)
          && (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x60) == 0 )
        {
          CPed::Say(pPed, 0x90u, 0, 1.0, 0, 0, 0);
          SubTask = CTask::operator new(0x4Cu);
          v108 = this->m_pTargetPed;
          CTaskComplex::CTaskComplex((CTaskComplex *)SubTask);
          *((_QWORD *)SubTask + 3) = 0x4000000040000000LL;
          *((_QWORD *)SubTask + 4) = 0x4000000000000000LL;
          *(_DWORD *)SubTask = &off_6656D4;
          *((_DWORD *)SubTask + 4) = 50000;
          *((_DWORD *)SubTask + 5) = 1000;
          *((_WORD *)SubTask + 24) = 0;
          *((_WORD *)SubTask + 30) = 0;
          *((_DWORD *)SubTask + 10) = 0;
          *((_DWORD *)SubTask + 11) = 0;
          *((_DWORD *)SubTask + 13) = 0;
          *((_DWORD *)SubTask + 14) = 0;
          v70 = *((_BYTE *)SubTask + 72);
          *((_DWORD *)SubTask + 16) = &off_665710;
          *((_DWORD *)SubTask + 17) = 6;
          *((_BYTE *)SubTask + 72) = v70 & 0xF0 | 3;
          *((_DWORD *)SubTask + 3) = v108;
          if ( v108 )
          {
            CEntity::RegisterReference(v108, (CEntity **)SubTask + 3);
            if ( SubTask )
              goto LABEL_131;
            goto LABEL_78;
          }
          goto LABEL_77;
        }
        if ( IsTypeMelee )
          goto LABEL_101;
        m_pCoverPoint = pPed->m_pCoverPoint;
        if ( !m_pCoverPoint )
          goto LABEL_78;
        v55 = this->m_pTargetPed;
        v56 = v55->m_pMat;
        p_m_translate = (CVector *)&v56->tx;
        if ( !v56 )
          p_m_translate = &v55->m_transform.m_translate;
        if ( !CCover::DoesCoverPointStillProvideCover(m_pCoverPoint, *p_m_translate) )
          goto LABEL_78;
        v58 = this->m_pTargetPed;
        v59 = v58->m_pMat;
        v60 = (CVector *)&v59->tx;
        if ( !v59 )
          v60 = &v58->m_transform.m_translate;
        if ( !CCover::FindCoordinatesCoverPoint(pPed->m_pCoverPoint, pPed, v60, (CVector *)&v110) )
          goto LABEL_76;
        v61 = pPed->m_pMat;
        v62 = &pPed->m_transform;
        if ( v61 )
          v62 = (CSimpleTransform *)&v61->tx;
        v63.n64_u64[0] = vsub_f32(*(float32x2_t *)&v62->m_translate.x, (float32x2_t)v110.CTaskSimple).n64_u64[0];
        v64 = vmul_f32(v63, v63).n64_u64[0];
        if ( sqrtf(*(float *)&v64 + *((float *)&v64 + 1)) >= 0.75 )
          goto LABEL_75;
        if ( !pPed->m_pCoverPoint->m_Usage )
        {
          if ( v42 < 12.0
            && !(*((unsigned __int8 *)&pPed->m_nPedFlags + 3) << 31)
            && (rand() & 3) == 0
            && !CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 1) )
          {
            CPed::Say(pPed, 0x55u, 0, 1.0, 0, 0, 0);
            SubTask = CTask::operator new(0x28u);
            CTaskSimpleDuck::CTaskSimpleDuck((CTaskSimpleDuck *)SubTask, 0, 0x9C4u, -1);
            if ( SubTask )
              goto LABEL_77;
          }
          goto LABEL_75;
        }
        v65 = rand();
        v66 = (v65 & 1) == 0;
        if ( (v65 & 1) == 0 )
          v66 = BYTE1(WeaponInfo->m_nFlags) << 31 == 0;
        if ( !v66 )
        {
LABEL_75:
          CPed::ReleaseCoverPoint(pPed);
LABEL_76:
          SubTask = 0;
LABEL_77:
          if ( SubTask )
            goto LABEL_131;
          goto LABEL_78;
        }
        SubTask = CTask::operator new(0x3Cu);
        v67 = this->m_pTargetPed;
        CTaskSimple::CTaskSimple((CTaskSimple *)SubTask);
        *((_QWORD *)SubTask + 2) = 0LL;
        *((_QWORD *)SubTask + 3) = 0LL;
        *((_BYTE *)SubTask + 8) = 0;
        *((_DWORD *)SubTask + 8) = 0;
        *((_DWORD *)SubTask + 9) = 0;
        *(_DWORD *)SubTask = &off_669698;
        *((_DWORD *)SubTask + 3) = v67;
        if ( v67 )
          CEntity::RegisterReference(v67, (CEntity **)SubTask + 3);
        *((_WORD *)SubTask + 22) = 5;
        *((_BYTE *)SubTask + 46) = 3;
        *((_DWORD *)SubTask + 12) = 1065353216;
        *((_DWORD *)SubTask + 13) = 0;
        *((_DWORD *)SubTask + 10) = -1;
        *((_BYTE *)SubTask + 56) = 1;
        *((_BYTE *)SubTask + 57) = 0;
        m_bAimImmediate = this->m_bAimImmediate;
        *((_BYTE *)SubTask + 58) = m_bAimImmediate != 0;
        this->m_bAimImmediate = 0;
        v69 = CTimer::m_snTimeInMilliseconds;
        *(_WORD *)&this->m_StrafeDirection = 257;
        this->m_nShootTimer = v69 + 5000;
        this->m_nLastAttackTime = v69;
        this->m_nStrafeTimer = v69 + 2500;
        if ( pPed->m_pCoverPoint->m_Usage == 1 )
          this->m_StrafeDirection = 0;
        CPedIntelligence::ClearTaskDuckSecondary(pPed->m_pPedIntelligence);
        if ( SubTask )
          goto LABEL_131;
LABEL_78:
        v71 = 0;
        v72 = 0;
        if ( v42 <= 6.0 )
          v71 = 1;
        if ( this->m_nCompetence < 1 )
          v72 = 1;
        if ( !(v71 | v72 | IsTypeMelee) && (rand() & 1) != 0 )
        {
          CPed::ReleaseCoverPoint(pPed);
          v73 = this->m_pTargetPed;
          v74 = v73->m_pMat;
          v75 = (CVector *)&v74->tx;
          if ( !v74 )
            v75 = &v73->m_transform.m_translate;
          v76 = CCover::FindAndReserveCoverPoint(pPed, v75, this->m_nCompetence == 2);
          pPed->m_pCoverPoint = v76;
          if ( v76 )
          {
            v77 = this->m_pTargetPed;
            v78 = v77->m_pMat;
            v79 = (CVector *)&v78->tx;
            if ( !v78 )
              v79 = &v77->m_transform.m_translate;
            CoordinatesCoverPoint = CCover::FindCoordinatesCoverPoint(v76, pPed, v79, (CVector *)&v110);
            *(float *)&v110.m_iDuration = *(float *)&v110.m_iDuration + 1.0;
            if ( !CoordinatesCoverPoint )
              goto LABEL_100;
            v81 = this->m_pTargetPed;
            v82 = v81->m_pMat;
            v83 = (float32x2_t *)&v82->tx;
            if ( !v82 )
              v83 = (float32x2_t *)&v81->m_transform;
            v84.n64_u64[0] = vsub_f32((float32x2_t)v110.CTaskSimple, (float32x2_t)v83->n64_u64[0]).n64_u64[0];
            v85 = vmul_f32(v84, v84).n64_u64[0];
            if ( sqrtf(*(float *)&v85 + *((float *)&v85 + 1)) >= (float)(m_fTargetRange * 0.75) )
              goto LABEL_100;
            v86 = pPed->m_pMat;
            v87 = &pPed->m_transform;
            if ( v86 )
              v87 = (CSimpleTransform *)&v86->tx;
            if ( CWorld::GetIsLineOfSightClear((const CVector *)&v110, &v87->m_translate, 1, 1, 0, 0, 0, 0, 0) )
            {
              if ( CPedGroups::GetPedsGroup(pPed) )
                CPed::Say(pPed, 0x41u, 0, 1.0, 0, 0, 0);
              CPedIntelligence::SetTaskDuckSecondary(pPed->m_pPedIntelligence, 0x1770u);
              SubTask = CTask::operator new(0x2Cu);
              CTaskSimpleGoToPoint::CTaskSimpleGoToPoint(
                (CTaskSimpleGoToPoint *)SubTask,
                6,
                (const CVector *)&v110,
                0.5,
                1,
                0);
              if ( SubTask )
                goto LABEL_131;
            }
            else
            {
LABEL_100:
              CPed::ReleaseCoverPoint(pPed);
            }
          }
        }
LABEL_101:
        if ( v42 <= 10.0 )
          goto LABEL_108;
        v88 = rand() & 3;
        if ( v88 == 1 )
        {
          SubTask = 0;
          if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x40) == 0 )
          {
            this->m_StrafeDirection = 2;
            v93 = CTimer::m_snTimeInMilliseconds;
            this->m_bStrafeBack = 0;
            this->m_nStrafeTimer = v93 + 2000;
          }
        }
        else if ( v88 )
        {
LABEL_108:
          SubTask = 0;
        }
        else
        {
          SubTask = 0;
          if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x40) == 0 )
          {
            CPed::Say(pPed, 0x90u, 0, 1.0, 0, 0, 0);
            v89 = CTask::operator new(0x4Cu);
            v90 = this->m_pTargetPed;
            CTaskComplex::CTaskComplex((CTaskComplex *)v89);
            *(_DWORD *)v89 = &off_6656D4;
            *((_DWORD *)v89 + 4) = 50000;
            *((_DWORD *)v89 + 5) = 1000;
            *((_DWORD *)v89 + 7) = 0x40000000;
            *((_DWORD *)v89 + 8) = 0;
            *((_DWORD *)v89 + 9) = 0x40000000;
            *((_WORD *)v89 + 24) = 0;
            *((_WORD *)v89 + 30) = 0;
            *((_DWORD *)v89 + 10) = 0;
            *((_DWORD *)v89 + 11) = 0;
            *((_DWORD *)v89 + 13) = 0;
            *((_DWORD *)v89 + 14) = 0;
            v91 = *((_BYTE *)v89 + 72);
            *((_DWORD *)v89 + 16) = &off_665710;
            *((_DWORD *)v89 + 17) = 6;
            *((_BYTE *)v89 + 72) = v91 & 0xF0 | 3;
            *((float *)v89 + 6) = v42 + -4.0;
            *((_DWORD *)v89 + 3) = v90;
            if ( v90 )
              CEntity::RegisterReference(v90, (CEntity **)v89 + 3);
            SubTask = v89;
          }
        }
        if ( v42 > 5.0 && (rand() & 3) == 0 )
        {
          this->m_StrafeDirection = 0;
          if ( (rand() & 1) != 0 )
          {
            m_StrafeDirection = 1;
            this->m_StrafeDirection = 1;
          }
          else
          {
            m_StrafeDirection = this->m_StrafeDirection;
            if ( m_StrafeDirection != 1 )
              m_StrafeDirection = 0;
          }
          v94 = pPed->m_pMat;
          if ( v94 )
            p_m_transform = (CSimpleTransform *)&v94->tx;
          v95 = *(CTaskSimple *)&p_m_transform->m_translate.x;
          v110.m_iDuration = LODWORD(p_m_transform->m_translate.z);
          v110.CTaskSimple = v95;
          v96 = v94->xx * 2.5;
          v97 = v94->yx * 2.5;
          v98 = v94->zx * 2.5;
          vecEnd.x = v96;
          vecEnd.y = v97;
          vecEnd.z = v98;
          if ( m_StrafeDirection )
          {
            v99 = 0;
            vecEnd.x = *(float *)&v95._vptr$CTask + v96;
            vecEnd.y = *(float *)&v110.m_pParent + v97;
            vecEnd.z = v98 + *(float *)&v110.m_iDuration;
            IsLineOfSightClear = CWorld::GetIsLineOfSightClear((const CVector *)&v110, &vecEnd, 1, 1, 0, 1, 0, 0, 0);
          }
          else
          {
            v99 = 1;
            vecEnd.x = *(float *)&v95._vptr$CTask - v96;
            vecEnd.y = *(float *)&v110.m_pParent - v97;
            vecEnd.z = *(float *)&v110.m_iDuration - v98;
            IsLineOfSightClear = CWorld::GetIsLineOfSightClear((const CVector *)&v110, &vecEnd, 1, 1, 0, 1, 0, 0, 0);
          }
          if ( !IsLineOfSightClear )
            this->m_StrafeDirection = v99;
          v101 = CTimer::m_snTimeInMilliseconds;
          this->m_bStrafeBack = 0;
          this->m_nStrafeTimer = v101 + 2000;
        }
        if ( !SubTask )
        {
          if ( CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed) )
          {
LABEL_24:
            SubTask = CTaskComplexKillPedOnFootArmed::CreateSubTask(this, 1020, pPed);
            goto LABEL_25;
          }
          if ( (rand() & 3) == 0 )
          {
            this->m_StrafeDirection = rand() & 1;
            v102 = CTimer::m_snTimeInMilliseconds;
            this->m_bStrafeBack = 0;
            this->m_nStrafeTimer = v102 + 2000;
          }
LABEL_130:
          v103 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
          v104 = CPed::GetWeaponSkill(pPed);
          CWeaponInfo::GetWeaponInfo(v103, v104);
          CTaskSimpleStandStill::CTaskSimpleStandStill(&v110, 0, 0, 0, 8.0);
          CTaskSimpleStandStill::ProcessPed(v105, pPed);
          CTaskSimpleStandStill::~CTaskSimpleStandStill(&v110);
          SubTask = CTask::operator new(0x18u);
          CTaskSimple::CTaskSimple((CTaskSimple *)SubTask);
          *((_WORD *)SubTask + 8) = 0;
          *((_DWORD *)SubTask + 5) = 100;
          *((_DWORD *)SubTask + 2) = 0;
          *((_DWORD *)SubTask + 3) = 0;
          *(_DWORD *)SubTask = &off_665750;
          this->m_nLastAttackTime = CTimer::m_snTimeInMilliseconds;
        }
LABEL_131:
        if ( (rand() & 1) != 0 && this->m_nCompetence >= 1 && !(*((unsigned __int8 *)&pPed->m_nPedFlags + 3) << 31) )
        {
          v106 = pPed->m_pCoverPoint;
          if ( !v106 || (unsigned __int8)(v106->m_Usage - 1) >= 2u )
            CPedIntelligence::SetTaskDuckSecondary(pPed->m_pPedIntelligence, 0x1770u);
        }
        break;
    }
    goto LABEL_137;
  }
  if ( (unsigned int)(v24 - 202) >= 2 )
  {
    if ( v24 == 415 )
    {
      v43 = CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed);
      v44 = 202;
      if ( v43 )
        v44 = 1020;
      SubTask = CTaskComplexKillPedOnFootArmed::CreateSubTask(this, v44, pPed);
      *(_DWORD *)&pPed->m_nPedFlags &= ~0x4000000u;
    }
    goto LABEL_137;
  }
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x60) != 0 )
  {
    v29 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    v30 = CPed::GetWeaponSkill(pPed);
    v31 = CWeaponInfo::GetWeaponInfo(v29, v30);
    v32 = this->m_pTargetPed;
    v33 = 202;
    v34 = pPed->m_pMat;
    v35 = v32->m_pMat;
    if ( v34 )
      p_m_transform = (CSimpleTransform *)&v34->tx;
    v36 = (CSimpleTransform *)&v35->tx;
    if ( !v35 )
      v36 = &v32->m_transform;
    v37.n64_u64[0] = vsub_f32(*(float32x2_t *)&v36->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
    v38 = vmul_f32(v37, v37).n64_u64[0];
    if ( (float)((float)((float)((float)(v36->m_translate.x - p_m_transform->m_translate.x)
                               * (float)(v36->m_translate.x - p_m_transform->m_translate.x))
                       + *(float *)&v38)
               + *((float *)&v38 + 1)) < (float)(v31->m_fTargetRange * v31->m_fTargetRange)
      && CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed) )
    {
      v33 = 1020;
    }
    v39 = this;
    v40 = v33;
LABEL_33:
    SubTask = CTaskComplexKillPedOnFootArmed::CreateSubTask(v39, v40, pPed);
LABEL_137:
    p_m_iNeedToMoveInCloserTime = &this->m_iNeedToMoveInCloserTime;
    v47 = 0;
    goto LABEL_138;
  }
  CPed::Say(pPed, 0x90u, 0, 1.0, 0, 0, 0);
  SubTask = CTaskComplexKillPedOnFootArmed::CreateSubTask(this, 907, pPed);
LABEL_35:
  m_iNeedToMoveInCloserTime = this->m_iNeedToMoveInCloserTime;
  p_m_iNeedToMoveInCloserTime = &this->m_iNeedToMoveInCloserTime;
  if ( !m_iNeedToMoveInCloserTime )
  {
    v47 = CTimer::m_snTimeInMilliseconds;
LABEL_138:
    *p_m_iNeedToMoveInCloserTime = v47;
  }
  return (CTask *)SubTask;
}
// 4E31F2: variable 'v28' is possibly undefined
// 4E33C4: variable 'v2' is possibly undefined
// 4E33C4: variable 'v3' is possibly undefined
// 4E349E: variable 'v53' is possibly undefined
// 4E3B10: variable 'v105' is possibly undefined
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669698: using guessed type void *off_669698;

//----- (004E3BF0) --------------------------------------------------------
bool __fastcall CTaskComplexKillPedOnFootArmed::IsPedInLeaderFiringLine(
        const CTaskComplexKillPedOnFootArmed *this,
        CPed *pPed)
{
  CPedGroup *PedsGroup; // r0
  CPed *Leader; // r0
  CPed *v5; // r4
  bool v6; // r5
  CEntity *m_pEntLockOnTarget; // r1
  float *p_x; // r8
  CMatrix *m_pMat; // r0
  float *p_tx; // r9
  CMatrix *v11; // r2
  float *v12; // r0
  float v13; // s2
  float v14; // s6
  CMatrix *v15; // r1
  float v16; // s8
  CSimpleTransform *p_m_transform; // r0
  float v18; // s10
  float v19; // s4
  float x; // s0
  float y; // s12
  float v22; // s1
  float z; // s2
  float v24; // s7
  float v25; // s14
  CEntity *v26; // r1
  float v27; // s8
  CMatrix *v28; // r2
  float *v29; // r0
  CMatrix *v30; // r0
  CVector v32; // [sp+4h] [bp-24h] BYREF

  PedsGroup = CPedGroups::GetPedsGroup(pPed);
  if ( !PedsGroup )
    return 0;
  Leader = CPedGroupMembership::GetLeader(&PedsGroup->m_membership);
  v5 = Leader;
  if ( !Leader || !CPed::IsPlayer(Leader) || !v5->m_pEntLockOnTarget )
    return 0;
  v6 = 0;
  if ( !CWeapon::IsTypeMelee(&v5->m_WeaponSlots[v5->m_nCurrentWeapon]) )
  {
    m_pEntLockOnTarget = v5->m_pEntLockOnTarget;
    p_x = &v5->m_transform.m_translate.x;
    m_pMat = v5->m_pMat;
    p_tx = &v5->m_transform.m_translate.x;
    v11 = m_pEntLockOnTarget->m_pMat;
    if ( m_pMat )
      p_tx = &m_pMat->tx;
    v12 = &v11->tx;
    v13 = p_tx[1];
    if ( !v11 )
      v12 = &m_pEntLockOnTarget->m_transform.m_translate.x;
    v14 = v12[1];
    v32.x = *v12 - *p_tx;
    v32.z = 0.0;
    v32.y = v14 - v13;
    CVector::Normalise(&v32);
    v15 = pPed->m_pMat;
    v16 = *p_tx;
    p_m_transform = (CSimpleTransform *)&v15->tx;
    v18 = p_tx[1];
    v19 = p_tx[2];
    if ( !v15 )
      p_m_transform = &pPed->m_transform;
    x = p_m_transform->m_translate.x;
    y = p_m_transform->m_translate.y;
    v22 = p_m_transform->m_translate.x - v16;
    z = p_m_transform->m_translate.z;
    v24 = v32.z;
    v32.z = 0.0;
    v25 = (float)((float)(v22 * v32.x) + (float)((float)(y - v18) * v32.y)) + (float)((float)(z - v19) * v24);
    v32.x = (float)(v16 + (float)(v32.x * v25)) - x;
    v32.y = (float)(v18 + (float)(v32.y * v25)) - y;
    if ( (float)((float)((float)(v32.x * v32.x) + (float)(v32.y * v32.y)) + 0.0) < 4.0 )
    {
      v26 = v5->m_pEntLockOnTarget;
      v27 = p_m_transform->m_translate.y;
      v28 = v26->m_pMat;
      v29 = &v28->tx;
      if ( !v28 )
        v29 = &v26->m_transform.m_translate.x;
      if ( (float)((float)((float)((float)(*v29 - *p_tx) * (float)(x - *p_tx))
                         + (float)((float)(v29[1] - p_tx[1]) * (float)(v27 - p_tx[1])))
                 + (float)((float)(v29[2] - v19) * (float)(z - v19))) > 0.0 )
      {
        v30 = v5->m_pMat;
        if ( v30 )
          p_x = &v30->tx;
        if ( (float)((float)((float)((float)(x - *p_x) * (float)(x - *p_x))
                           + (float)((float)(v27 - p_x[1]) * (float)(v27 - p_x[1])))
                   + (float)((float)(z - p_x[2]) * (float)(z - p_x[2]))) < 100.0 )
          return 1;
      }
    }
    return 0;
  }
  return v6;
}

//----- (004E3DDC) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
CTask *__fastcall CTaskComplexKillPedOnFootArmed::ControlSubTask(CTaskComplexKillPedOnFootArmed *this, CPed *pPed)
{
  CTask *m_pSubTask; // r9
  eWeaponType m_eWeaponType; // r4
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r11
  CPed *m_pTargetPed; // r0
  uint32 m_nDuckingConditions; // r1
  CMatrix *m_pMat; // r1
  CMatrix *v12; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v15; // d16
  unsigned __int64 v16; // d1
  bool v17; // zf
  CTaskSimpleDuck *TaskDuck; // r1
  CPedIntelligence *m_pPedIntelligence; // r0
  CTaskSimpleDuck *v20; // r0
  CTaskSimpleDuck *v21; // r0
  CTaskSimpleDuck *v22; // r8
  int v23; // r0
  CPed *v24; // r0
  CMatrix *v25; // r1
  CMatrix *v26; // r2
  CSimpleTransform *v27; // r3
  CSimpleTransform *v28; // r4
  float32x2_t v29; // d16
  unsigned __int64 v30; // d1
  int v31; // r4
  CPed *v32; // r0
  CMatrix *v33; // r1
  CMatrix *v34; // r2
  CSimpleTransform *v35; // r3
  CSimpleTransform *v36; // r1
  float32x2_t v37; // d16
  unsigned __int64 v38; // d1
  float v39; // s16
  float m_fTargetRange; // s0
  CTask *v41; // r0
  CTaskSimpleUseGun *TaskUseGun; // r4
  float v43; // s0
  uint32 v44; // r0
  unsigned int v45; // r0
  int v46; // r2 OVERLAPPED
  float v47; // s2
  int v48; // r1 OVERLAPPED
  float y; // s6
  float v50; // s4
  unsigned int m_StrafeDirection; // r1
  CTaskSimpleDuck *v52; // r0
  float x; // s6

  m_pSubTask = this->m_pSubTask;
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  if ( this->m_bNewTarget )
    return (CTask *)(*((int (__fastcall **)(CTaskComplexKillPedOnFootArmed *, CPed *))this->_vptr$CTask + 11))(
                      this,
                      pPed);
  m_pTargetPed = this->m_pTargetPed;
  if ( !m_pTargetPed || m_pTargetPed->m_nHealth <= 0.0 )
    return 0;
  m_nDuckingConditions = this->m_nDuckingConditions;
  if ( (m_nDuckingConditions & 4) == 0
    || CTimer::m_snTimeInMilliseconds <= this->m_nTimeToDuck + this->m_nDuckTimer + 2000
    || (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 )
  {
    v17 = m_nDuckingConditions << 31 == 0;
    if ( m_nDuckingConditions << 31 )
      v17 = !this->m_bShotFiredByPlayerFlag;
    if ( !v17
      && this->m_nPercentageDuckChance > (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) )
    {
      TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
      m_pPedIntelligence = pPed->m_pPedIntelligence;
      if ( TaskDuck )
      {
        v20 = CPedIntelligence::GetTaskDuck(m_pPedIntelligence, 1);
        CTaskSimpleDuck::SetDuckTimer(v20, this->m_nTimeToDuck);
      }
      else
      {
        CPedIntelligence::SetTaskDuckSecondary(m_pPedIntelligence, this->m_nTimeToDuck);
      }
    }
  }
  else
  {
    m_pMat = pPed->m_pMat;
    v12 = m_pTargetPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    p_m_transform = (CSimpleTransform *)&v12->tx;
    if ( !v12 )
      p_m_transform = &m_pTargetPed->m_transform;
    v15.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
    v16 = vmul_f32(v15, v15).n64_u64[0];
    if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                               * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                       + *(float *)&v16)
               + *((float *)&v16 + 1)) < 400.0
      && this->m_nPercentageDuckChance > (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) )
    {
      CPedIntelligence::SetTaskDuckSecondary(pPed->m_pPedIntelligence, this->m_nTimeToDuck);
    }
    this->m_nDuckTimer = CTimer::m_snTimeInMilliseconds;
  }
  v21 = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
  v22 = v21;
  if ( v21 )
    v21->m_bIsInControl = 1;
  if ( m_pSubTask != this->m_pSubTask )
    return m_pSubTask;
  v23 = (*((int (__fastcall **)(CTask *))m_pSubTask->_vptr$CTask + 5))(m_pSubTask);
  if ( v23 == 1020 )
  {
    v32 = this->m_pTargetPed;
    v33 = pPed->m_pMat;
    v34 = v32->m_pMat;
    v35 = (CSimpleTransform *)&v33->tx;
    if ( !v33 )
      v35 = &pPed->m_transform;
    v36 = (CSimpleTransform *)&v34->tx;
    if ( !v34 )
      v36 = &v32->m_transform;
    v37.n64_u64[0] = vsub_f32(*(float32x2_t *)&v36->m_translate.y, *(float32x2_t *)&v35->m_translate.y).n64_u64[0];
    v38 = vmul_f32(v37, v37).n64_u64[0];
    v39 = sqrtf(
            (float)((float)((float)(v36->m_translate.x - v35->m_translate.x)
                          * (float)(v36->m_translate.x - v35->m_translate.x))
                  + *(float *)&v38)
          + *((float *)&v38 + 1));
    m_fTargetRange = WeaponInfo->m_fTargetRange;
    if ( v39 > m_fTargetRange
      || v39 > (float)(m_fTargetRange * 0.5)
      && (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0
      && CTimer::m_snTimeInMilliseconds > this->m_nLastAttackTime + 2500
      || v39 > 4.0
      && (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0
      && CTimer::m_snTimeInMilliseconds > this->m_nShootTimer
      || !CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed) )
    {
      v41 = this->m_pSubTask;
      if ( BYTE2(v41[5].m_pParent) != 6 )
      {
        v41[6].m_pParent = 0;
        BYTE2(v41[5].m_pParent) = 6;
      }
    }
    TaskUseGun = CPedIntelligence::GetTaskUseGun(pPed->m_pPedIntelligence);
    if ( !TaskUseGun )
      return m_pSubTask;
    if ( CPedGroups::GetPedsGroup(pPed) )
      CPed::Say(pPed, 0xCFu, 0, 1.0, 0, 0, 0);
    v43 = 0.0;
    if ( !(*((unsigned __int8 *)&this->m_pTargetPed->m_nPhysicalFlags + 1) << 31) )
    {
      v44 = CTimer::m_snTimeInMilliseconds;
      if ( CTimer::m_snTimeInMilliseconds >= this->m_nStrafeTimer || (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
      {
        if ( v39 < 4.0 && (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
        {
          v47 = 1.0;
          v46 = 1065353216;
          v48 = 0;
          if ( v22 )
            goto LABEL_82;
          goto LABEL_74;
        }
        if ( this->m_bStrafeBack )
        {
          m_StrafeDirection = this->m_StrafeDirection;
          if ( m_StrafeDirection <= 3 )
            this->m_StrafeDirection = 0x2030001u >> (8 * m_StrafeDirection);
          v48 = 0;
          this->m_nStrafeTimer = v44 + 2500;
          this->m_bStrafeBack = 0;
LABEL_81:
          v47 = 0.0;
          v46 = 0;
          if ( v22 )
            goto LABEL_82;
LABEL_74:
          y = TaskUseGun->m_vecMoveCommand.y;
          v50 = CTimer::ms_fTimeStep * 0.07;
          if ( (float)(v47 - y) <= (float)(CTimer::ms_fTimeStep * 0.07) )
          {
            if ( (float)(v47 - y) < (float)-v50 )
              v47 = y - v50;
          }
          else
          {
            v47 = v50 + y;
          }
          x = TaskUseGun->m_vecMoveCommand.x;
          TaskUseGun->m_vecMoveCommand.y = v47;
          if ( (float)(v43 - x) <= v50 )
          {
            if ( (float)(v43 - x) < (float)-v50 )
              v43 = x - v50;
          }
          else
          {
            v43 = v50 + x;
          }
          TaskUseGun->m_bMoveControl = 1;
          TaskUseGun->m_vecMoveCommand.x = v43;
          return m_pSubTask;
        }
      }
      else
      {
        v45 = (char)this->m_StrafeDirection;
        if ( v45 < 4 )
        {
          v46 = dword_4E436C[v45];
          v47 = *(float *)&dword_4E438C[v45];
          v48 = dword_4E437C[v45];
          v43 = *(float *)&dword_4E439C[v45];
          if ( !v22 )
            goto LABEL_74;
LABEL_82:
          if ( this->m_StrafeDirection > 1u )
          {
            v52 = v22;
          }
          else
          {
            if ( CTimer::m_snTimeInMilliseconds > this->m_nTimeOfLastRoll + 3000 )
            {
              CTaskSimpleDuck::ControlDuckMove(v22, *(CVector2D *)&v48);
              this->m_nTimeOfLastRoll = CTimer::m_snTimeInMilliseconds;
              return m_pSubTask;
            }
            v52 = v22;
            v48 = 0;
            v46 = 0;
          }
          CTaskSimpleDuck::ControlDuckMove(v52, *(CVector2D *)&v48);
          return m_pSubTask;
        }
      }
    }
    v48 = 0;
    goto LABEL_81;
  }
  if ( v23 != 907 )
    return m_pSubTask;
  v24 = (CPed *)(*((unsigned __int8 *)&pPed->m_nPedFlags + 2) << 26);
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
    goto LABEL_61;
  v24 = this->m_pTargetPed;
  v25 = pPed->m_pMat;
  v26 = v24->m_pMat;
  v27 = (CSimpleTransform *)&v25->tx;
  if ( !v25 )
    v27 = &pPed->m_transform;
  v28 = (CSimpleTransform *)&v26->tx;
  if ( !v26 )
    v28 = &v24->m_transform;
  v29.n64_u64[0] = vsub_f32(*(float32x2_t *)&v28->m_translate.y, *(float32x2_t *)&v27->m_translate.y).n64_u64[0];
  v30 = vmul_f32(v29, v29).n64_u64[0];
  if ( sqrtf(
         (float)((float)((float)(v28->m_translate.x - v27->m_translate.x)
                       * (float)(v28->m_translate.x - v27->m_translate.x))
               + *(float *)&v30)
       + *((float *)&v30 + 1)) >= (float)(WeaponInfo->m_fTargetRange * 0.5) )
  {
LABEL_61:
    v31 = 0;
  }
  else if ( (float)((float)((float)(v24->m_vecMoveSpeed.x * v25->xy) + (float)(v24->m_vecMoveSpeed.y * v25->yy))
                  + (float)(v24->m_vecMoveSpeed.z * v25->zy)) >= 0.0 )
  {
    v31 = 0;
    v24 = (CPed *)(CTimer::m_snTimeInMilliseconds - this->m_nLastAttackTime);
    if ( (unsigned int)v24 > 0x7D0 )
      v31 = 1;
  }
  else
  {
    v31 = 1;
  }
  if ( !CTaskComplexKillPedOnFootArmed::IsPedInLeaderFiringLine((const CTaskComplexKillPedOnFootArmed *)v24, pPed)
    && (!v31 && (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0
     || !CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed))
    && (!(*((unsigned __int8 *)&this->m_pTargetPed->m_nPhysicalFlags + 1) << 31)
     || !CTaskComplexKillPedOnFootArmed::LineOfSightClearForAttack(this, pPed)) )
  {
    if ( CPedGroups::GetPedsGroup(pPed) )
      CPed::Say(pPed, 0x41u, 0, 1.0, 0, 0, 0);
    return m_pSubTask;
  }
  return CTaskComplexKillPedOnFootArmed::CreateSubTask(this, 1020, pPed);
}
// 4E3DDC: variables would overlap: r1.4 and r1.8
// 4E3DDC: variables would overlap: r2.4 and r1.8
// 4E436C: using guessed type int dword_4E436C[2];
// 4E437C: using guessed type int dword_4E437C[4];
// 4E438C: using guessed type int dword_4E438C[2];
// 4E439C: using guessed type int dword_4E439C[4];

//----- (004E43BC) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::CTaskSimpleGangDriveBy(
        CTaskSimpleGangDriveBy *this,
        CEntity *pTargetEntity,
        const CVector *pVecTarget,
        float fAbortRange,
        int8 FrequencyPercentage,
        int8 nDrivebyStyle,
        bool bSeatRHS)
{
  __int64 v11; // d16

  CTaskSimple::CTaskSimple(this);
  *(_WORD *)&this->m_bIsFinished = 0;
  this->m_bSeatRHS = bSeatRHS;
  *(_DWORD *)&this->m_bInRangeToShoot = 0;
  this->m_nDrivebyStyle = nDrivebyStyle;
  this->m_nFrequencyPercentage = FrequencyPercentage;
  this->m_vecCoords.y = 0.0;
  this->m_vecCoords.z = 0.0;
  this->m_nLOSCheckTime = 0;
  this->m_fAbortRange = fAbortRange;
  this->m_nRequiredAnim = ANIM_STD_NUM;
  this->m_nRequiredAnimGroup = ANIM_STD_PED;
  this->m_pAnim = 0;
  this->m_pWeaponInfo = 0;
  this->m_nBurstShots = -1;
  *(_WORD *)&this->m_nNextCommand = 1;
  this->m_nFakeShootDirn = -1;
  this->m_nAttackTimer = -1;
  this->m_nLOSBlocked = 1;
  this->_vptr$CTask = (int (**)(void))&off_669930;
  this->m_vecCoords.x = 0.0;
  this->m_pTargetEntity = pTargetEntity;
  if ( pTargetEntity )
    CEntity::RegisterReference(pTargetEntity, &this->m_pTargetEntity);
  if ( pVecTarget )
  {
    v11 = *(_QWORD *)&pVecTarget->x;
    this->m_vecCoords.z = pVecTarget->z;
    *(_QWORD *)&this->m_vecCoords.x = v11;
  }
}
// 669930: using guessed type void *;

//----- (004E4458) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::~CTaskSimpleGangDriveBy(CTaskSimpleGangDriveBy *this)
{
  _BOOL4 m_bAnimsReferenced; // r1
  CAnimBlendAssociation *m_pAnim; // r0
  CEntity *m_pTargetEntity; // r0

  m_bAnimsReferenced = this->m_bAnimsReferenced;
  this->_vptr$CTask = (int (**)(void))&off_669930;
  if ( m_bAnimsReferenced )
    CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[this->m_nRequiredAnimGroup].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  m_pTargetEntity = this->m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, &this->m_pTargetEntity);
  sub_1A01F4(this);
}
// 669930: using guessed type void *off_669930;

//----- (004E44C8) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::~CTaskSimpleGangDriveBy(CTaskSimpleGangDriveBy *this)
{
  _BOOL4 m_bAnimsReferenced; // r1
  CAnimBlendAssociation *m_pAnim; // r0
  CEntity *m_pTargetEntity; // r0
  void *v5; // r0

  m_bAnimsReferenced = this->m_bAnimsReferenced;
  this->_vptr$CTask = (int (**)(void))&off_669930;
  if ( m_bAnimsReferenced )
    CAnimManager::RemoveAnimBlockRef(CAnimManager::ms_aAnimAssocGroups[this->m_nRequiredAnimGroup].m_pAnimBlock - CAnimManager::ms_aAnimBlocks);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  m_pTargetEntity = this->m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::CleanUpOldReference(m_pTargetEntity, &this->m_pTargetEntity);
  CTask::~CTask(this);
  sub_197118(v5);
}
// 4E4528: variable 'v5' is possibly undefined
// 669930: using guessed type void *off_669930;

//----- (004E453C) --------------------------------------------------------
bool __fastcall CTaskSimpleGangDriveBy::MakeAbortable(
        CTaskSimpleGangDriveBy *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  bool v8; // zf
  CAnimBlendAssociation *m_pAnim; // r0
  bool result; // r0
  uint16 m_bitsFlag; // r1
  CPlayerPedData *m_pPlayerData; // r0
  CAnimBlendAssociation *v13; // r0
  float m_fBlendDelta; // s0
  bool v15; // cc

  if ( (unsigned int)(iPriority - 1) > 1 )
  {
    this->m_nNextCommand = 6;
    return 0;
  }
  if ( pEvent && (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 9 )
  {
    v8 = LOBYTE(pEvent[5]._vptr$CEvent) == 0;
    if ( LOBYTE(pEvent[5]._vptr$CEvent) )
      v8 = !*(&pEvent->m_bIsPersistent + 1);
    if ( v8 )
      return 0;
  }
  this->m_nNextCommand = 7;
  if ( CTaskSimpleGangDriveBy::ManageAnim(this, pPed) )
  {
    m_pAnim = this->m_pAnim;
    this->m_nLastCommand = this->m_nNextCommand;
    if ( iPriority == 2 )
    {
      m_pAnim->m_fBlendDelta = -1000.0;
    }
    else
    {
      m_bitsFlag = m_pAnim->m_bitsFlag;
      if ( (m_bitsFlag & 1) == 0 )
        m_pAnim->m_bitsFlag = m_bitsFlag | 1;
    }
  }
  m_pPlayerData = pPed->m_pPlayerData;
  if ( m_pPlayerData )
    *((_WORD *)m_pPlayerData + 26) |= 8u;
  if ( CPed::IsPlayer(pPed) )
    CPlayerPed::GetPlayerInfoForThisPlayerPed((CPlayerPed *)pPed)->bCanDoDriveBy = 1;
  v13 = this->m_pAnim;
  if ( v13 )
  {
    if ( !(LOBYTE(v13->m_bitsFlag) << 31) )
    {
      m_fBlendDelta = v13->m_fBlendDelta;
      v15 = m_fBlendDelta <= 0.0;
      if ( m_fBlendDelta > 0.0 )
        goto LABEL_24;
      if ( m_fBlendDelta >= 0.0 )
        v15 = v13->m_fBlendAmount <= 0.0;
      if ( !v15 )
      {
LABEL_24:
        v13->m_fBlendDelta = -8.0;
        v13 = this->m_pAnim;
      }
    }
    CAnimBlendAssociation::SetDeleteCallback(v13, CDefaultAnimCallback::DefaultAnimCB, 0);
    this->m_pAnim = 0;
  }
  result = 1;
  this->m_bIsFinished = 1;
  return result;
}

//----- (004E4624) --------------------------------------------------------
bool __fastcall CTaskSimpleGangDriveBy::ManageAnim(CTaskSimpleGangDriveBy *this, CPed *pPed)
{
  AssocGroupId m_nRequiredAnimGroup; // r1
  CAnimBlock *m_pAnimBlock; // r0
  const unsigned __int8 *AnimBlockName; // r0
  _BOOL4 m_loaded; // r2
  int v8; // r0
  AnimationId m_nRequiredAnim; // r2
  CAnimBlendAssociation *m_pAnim; // r0
  int v12; // r6
  CAnimBlendAssociation *v13; // r0
  int m_nAmmo; // r8
  CAnimBlendAssociation *v15; // r0

  m_nRequiredAnimGroup = this->m_nRequiredAnimGroup;
  m_pAnimBlock = CAnimManager::ms_aAnimAssocGroups[m_nRequiredAnimGroup].m_pAnimBlock;
  if ( !m_pAnimBlock )
  {
    AnimBlockName = CAnimManager::GetAnimBlockName(m_nRequiredAnimGroup);
    m_pAnimBlock = CAnimManager::GetAnimationBlock(AnimBlockName);
  }
  m_loaded = m_pAnimBlock->m_loaded;
  v8 = m_pAnimBlock - CAnimManager::ms_aAnimBlocks;
  if ( !m_loaded )
  {
    CStreaming::RequestModel(v8 + 25575, 8);
    return 0;
  }
  if ( !this->m_bAnimsReferenced )
  {
    CAnimManager::AddAnimBlockRef(v8);
    this->m_bAnimsReferenced = 1;
  }
  m_nRequiredAnim = this->m_nRequiredAnim;
  m_pAnim = this->m_pAnim;
  if ( m_nRequiredAnim == ANIM_STD_NUM )
  {
    if ( !m_pAnim )
      return 0;
  }
  else if ( !m_pAnim )
  {
    if ( this->m_nAttackTimer > 0 || !this->m_bInWeaponRange )
      return 0;
    v12 = 0;
    goto LABEL_19;
  }
  if ( m_nRequiredAnim == m_pAnim->m_animId
    || (unsigned __int8)(this->m_nNextCommand - 1) > 2u
    || this->m_nLastCommand > 3 )
  {
    goto LABEL_27;
  }
  CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  v12 = 1;
  this->m_pAnim->m_bitsFlag &= ~1u;
  m_nRequiredAnim = this->m_nRequiredAnim;
LABEL_19:
  v13 = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, this->m_nRequiredAnimGroup, m_nRequiredAnim, 4.0);
  this->m_pAnim = v13;
  CAnimBlendAssociation::SetDeleteCallback(v13, CTaskSimpleGangDriveBy::FinishAnimGangDriveByCB, this);
  if ( this->m_nNextCommand == 3 && this->m_nBurstShots <= 1 )
  {
    m_nAmmo = this->m_pWeaponInfo->m_nAmmo;
    this->m_nBurstShots = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)(m_nAmmo - 2))
                        + 2;
  }
  if ( v12 == 1 )
  {
    CAnimBlendAssociation::SetCurrentTime(this->m_pAnim, CTaskSimpleGangDriveBy::ANIM_LOOP_START);
    this->m_pAnim->m_bitsFlag &= ~1u;
    *(_WORD *)&this->m_nNextCommand = 256;
    if ( !CPed::IsPlayer(pPed) )
      this->m_nAttackTimer = 100;
  }
  else
  {
    this->m_nLastCommand = this->m_nNextCommand;
    this->m_nNextCommand = 0;
  }
LABEL_27:
  v15 = this->m_pAnim;
  return v15 && v15->m_fBlendAmount > 0.9 && v15->m_fBlendDelta >= 0.0;
}

//----- (004E47C4) --------------------------------------------------------
bool __fastcall CTaskSimpleGangDriveBy::ProcessPed(CTaskSimpleGangDriveBy *this, CPed *pPed)
{
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  bool v7; // zf
  CVehicle *m_pMyVehicle; // r0
  bool v9; // r6
  uint32 v11; // r6
  eWeaponType v12; // r6
  int8 v13; // r0
  bool v14; // zf
  CVehicle *v15; // r0
  int32 m_vehicleType; // r1
  AssocGroupId v17; // r0
  AssocGroupId v18; // r1
  bool v19; // r0
  uint8 v20; // r1
  _BOOL4 IsPlayer; // r0
  bool v22; // zf
  CWeaponInfo *v23; // r0
  CVehicle *v24; // r0
  CAnimBlendAssociation *m_pAnim; // r0
  int m_bitsFlag; // r2
  float m_fCurrentTime; // s0
  float v28; // s2
  float v29; // r1
  float v30; // s16
  unsigned __int16 v31; // r0
  int8 m_nNextCommand; // r1
  CAnimBlendAssociation *v33; // r0
  float v34; // s0
  int v35; // r1
  int m_nLastCommand; // r0
  int v37; // r1
  int8 v38; // r1
  CAnimBlendAssociation *v39; // r0
  int m_nAttackTimer; // r0
  int16 v41; // r0
  __int16 v42; // r5
  _BOOL4 v43; // r0
  int v44; // r6
  CPad *PadFromPlayer; // r0
  int v46; // r0
  bool v47; // zf
  float v48; // s0

  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  v7 = WeaponInfo == 0;
  if ( WeaponInfo )
    v7 = WeaponInfo->m_eFireType == FIRETYPE_INSTANT_HIT;
  if ( !v7 )
    return 1;
  m_pMyVehicle = pPed->m_pMyVehicle;
  if ( m_pMyVehicle )
  {
    if ( !CVehicle::CanPedLeanOut(m_pMyVehicle, pPed) )
      return 1;
  }
  if ( this->m_bIsFinished )
    return 1;
  if ( !this->m_nLOSCheckTime )
  {
    v11 = CTimer::m_snTimeInMilliseconds;
    this->m_nLOSCheckTime = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 1000.0) + v11;
  }
  if ( !this->m_pWeaponInfo )
  {
    v12 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    v13 = CPed::GetWeaponSkill(pPed);
    this->m_pWeaponInfo = CWeaponInfo::GetWeaponInfo(v12, v13);
  }
  v14 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
    v14 = pPed->m_pMyVehicle == 0;
  if ( v14 || pPed->m_nHealth < 1.0 )
  {
    v9 = 1;
    (*((void (__fastcall **)(CTaskSimpleGangDriveBy *, CPed *, int, _DWORD))this->_vptr$CTask + 7))(this, pPed, 1, 0);
    return v9;
  }
  if ( !CPed::IsPlayer(pPed) )
    *((_DWORD *)&pPed->m_nPedFlags + 3) |= 0x100000u;
  if ( this->m_nRequiredAnimGroup == ANIM_STD_PED )
  {
    v15 = pPed->m_pMyVehicle;
    m_vehicleType = v15->m_vehicleType;
    if ( m_vehicleType == 2 )
    {
      this->m_bSeatRHS = 0;
      v17 = ANIM_QUAD_DRIVEBY;
LABEL_38:
      this->m_nRequiredAnimGroup = v17;
LABEL_39:
      IsPlayer = CPed::IsPlayer(pPed);
      v22 = !IsPlayer;
      if ( !IsPlayer )
        v22 = pPed->m_pWeaponClump == 0;
      if ( v22 )
      {
        v23 = CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
        CPed::AddWeaponModel(pPed, v23->m_modelId);
      }
      goto LABEL_44;
    }
    if ( v15->m_baseVehicleType == 9 )
    {
      v18 = ANIM_BIKE_DRIVEBY;
      if ( LODWORD(v15[1].m_fElasticity) == 2 && v15->pDriver == pPed )
        v18 = ANIM_COP_DRIVEBY;
      this->m_bSeatRHS = 0;
      this->m_nRequiredAnimGroup = v18;
      goto LABEL_39;
    }
    if ( !m_vehicleType )
    {
      if ( v15->pPassengers[0] == pPed )
      {
        v19 = 1;
        v20 = 8;
        goto LABEL_36;
      }
      if ( v15->pPassengers[1] == pPed )
      {
        v19 = 0;
        v20 = 11;
        goto LABEL_36;
      }
      if ( v15->pPassengers[2] == pPed )
      {
        v19 = 1;
        v20 = 9;
LABEL_36:
        this->m_bSeatRHS = v19;
        CVehicle::SetWindowOpenFlag(pPed->m_pMyVehicle, v20);
      }
    }
    v17 = ANIM_GANG_DRIVEBY;
    goto LABEL_38;
  }
LABEL_44:
  if ( CPed::IsPlayer(pPed) )
    CTaskSimpleGangDriveBy::PlayerTarget(this, pPed);
  else
    CTaskSimpleGangDriveBy::LookForTarget(this, pPed);
  if ( this->m_nRequiredAnimGroup == ANIM_COP_DRIVEBY )
  {
    v24 = pPed->m_pMyVehicle;
    if ( v24->m_baseVehicleType == 9 )
      LOBYTE(v24[1].m_VehicleAudioEntity.m_fEventVolume) = 1;
  }
  if ( !CTaskSimpleGangDriveBy::ManageAnim(this, pPed) )
    goto LABEL_90;
  m_pAnim = this->m_pAnim;
  m_bitsFlag = m_pAnim->m_bitsFlag;
  if ( (m_bitsFlag & 1) != 0 )
  {
    m_fCurrentTime = m_pAnim->m_fCurrentTime;
    if ( m_fCurrentTime > CTaskSimpleGangDriveBy::ANIM_LOOP_FIRE
      && (float)(m_fCurrentTime - m_pAnim->m_fTimeStep) <= CTaskSimpleGangDriveBy::ANIM_LOOP_FIRE
      && (this->m_nLastCommand & 0xFE) == 2 )
    {
      CTaskSimpleGangDriveBy::FireGun(this, pPed);
      m_pAnim = this->m_pAnim;
      m_bitsFlag = m_pAnim->m_bitsFlag;
    }
  }
  if ( !(m_bitsFlag << 31)
    && this->m_nAttackTimer <= 0
    && (this->m_nNextCommand & 0xFE) == 2
    && (m_pAnim->m_fCurrentTime < m_pAnim->m_pAnimBlendHierarchy->m_fTotalTime || m_pAnim->m_fBlendDelta >= 0.0) )
  {
    m_pAnim->m_bitsFlag = m_bitsFlag | 1;
    v30 = (float)this->m_pWeaponInfo->m_nAmmo * 0.5;
    v31 = rand();
    m_nNextCommand = this->m_nNextCommand;
    this->m_nNextCommand = 0;
    this->m_nLastCommand = m_nNextCommand;
    this->m_nBurstShots = (int)(float)((float)((float)v31 * 0.000015259) * (float)((int)v30 - 1)) + 1;
    goto LABEL_73;
  }
  if ( (m_bitsFlag & 1) != 0 )
    goto LABEL_65;
  if ( this->m_nNextCommand != 7 )
  {
    if ( this->m_nRequiredAnim != m_pAnim->m_animId )
    {
      m_pAnim->m_bitsFlag = m_bitsFlag | 1;
      goto LABEL_73;
    }
LABEL_65:
    if ( this->m_nLastCommand == 1 && (m_bitsFlag & 1) != 0 && this->m_nRequiredAnim == m_pAnim->m_animId )
    {
      v28 = m_pAnim->m_fCurrentTime;
      if ( v28 > CTaskSimpleGangDriveBy::ANIM_LOOP_START
        && (float)(v28 - m_pAnim->m_fTimeStep) <= CTaskSimpleGangDriveBy::ANIM_LOOP_START )
      {
        v29 = CTaskSimpleGangDriveBy::ANIM_LOOP_START;
        m_pAnim->m_bitsFlag = m_bitsFlag & 0xFFFE;
        CAnimBlendAssociation::SetCurrentTime(this->m_pAnim, v29);
      }
    }
    goto LABEL_73;
  }
  m_pAnim->m_bitsFlag = m_bitsFlag | 1;
  this->m_nLastCommand = this->m_nNextCommand;
  this->m_nNextCommand = 7;
LABEL_73:
  v33 = this->m_pAnim;
  if ( this->m_nRequiredAnim == v33->m_animId )
  {
    v34 = v33->m_fCurrentTime;
    if ( v34 > CTaskSimpleGangDriveBy::ANIM_LOOP_END
      && (float)(v34 - v33->m_fTimeStep) <= CTaskSimpleGangDriveBy::ANIM_LOOP_END )
    {
      v35 = this->m_nNextCommand;
      if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eState == WEAPONSTATE_RELOADING && v35 <= 2 )
      {
        this->m_nAttackTimer = 2000;
        this->m_nNextCommand = 2;
      }
      else if ( ((v35 & 0xFFFFFFFE) == 2 || this->m_nLastCommand == 3 && this->m_nBurstShots >= 1)
             && this->m_bInRangeToShoot )
      {
        CAnimBlendAssociation::SetCurrentTime(v33, CTaskSimpleGangDriveBy::ANIM_LOOP_START);
        this->m_pAnim->m_bitsFlag |= 1u;
        m_nLastCommand = this->m_nLastCommand;
        v37 = this->m_nNextCommand;
        if ( v37 > m_nLastCommand )
        {
          this->m_nLastCommand = v37;
          m_nLastCommand = v37;
        }
        v38 = 0;
        this->m_nNextCommand = 0;
        if ( m_nLastCommand == 3 )
          v38 = this->m_nBurstShots - 1;
        this->m_nBurstShots = v38;
      }
      else if ( v35 == 1 )
      {
        CAnimBlendAssociation::SetCurrentTime(v33, CTaskSimpleGangDriveBy::ANIM_LOOP_START);
        this->m_pAnim->m_bitsFlag &= ~1u;
        this->m_nAttackTimer = -1;
        *(_WORD *)&this->m_nNextCommand = 256;
      }
    }
  }
LABEL_90:
  if ( this->m_nLastCommand )
  {
    if ( this->m_nLastCommand <= 3 )
    {
      v39 = this->m_pAnim;
      if ( v39 )
      {
        if ( v39->m_fBlendAmount > 0.5 || v39->m_fBlendDelta > 0.0 && !(LOBYTE(v39->m_bitsFlag) << 31) )
          CTaskSimpleGangDriveBy::AimGun(this, pPed);
      }
    }
  }
  m_nAttackTimer = this->m_nAttackTimer;
  if ( m_nAttackTimer <= -1 )
  {
    v42 = 100 - this->m_nFrequencyPercentage;
    v41 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)(100 * v42 - 200)) + 200;
  }
  else
  {
    v41 = m_nAttackTimer - (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  }
  this->m_nAttackTimer = v41;
  v43 = CPed::IsPlayer(pPed);
  v44 = this->m_nNextCommand;
  if ( v43 )
  {
    if ( v44 <= 3 )
    {
      this->m_nAttackTimer = 0;
      PadFromPlayer = CPlayerPed::GetPadFromPlayer((CPlayerPed *)pPed);
      v44 = 1;
      if ( CPad::GetWeapon(PadFromPlayer, pPed, 1) )
        v44 = 2;
LABEL_110:
      this->m_nNextCommand = v44;
    }
  }
  else if ( !this->m_nNextCommand )
  {
    switch ( this->m_nLastCommand )
    {
      case 1:
        if ( !this->m_nFrequencyPercentage && this->m_bInWeaponRange )
          goto LABEL_108;
        if ( this->m_bInRangeToShoot )
        {
          v44 = 3;
          goto LABEL_110;
        }
        if ( this->m_nAttackTimer <= 0 )
        {
          v44 = 0;
          this->m_nAttackTimer = 2 * (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
        }
        else
        {
LABEL_130:
          v44 = 0;
        }
        break;
      case 6:
      case 7:
        v44 = 7;
        goto LABEL_110;
      default:
        if ( !this->m_bInWeaponRange )
          goto LABEL_130;
LABEL_108:
        v44 = 1;
        goto LABEL_110;
    }
  }
  v46 = (unsigned __int8)this->m_nLastCommand;
  if ( v46 != 4 && !this->m_pAnim )
  {
    v47 = v46 == 7;
    if ( v46 != 7 )
      v47 = v44 == 7;
    if ( v47 )
      this->m_bIsFinished = 1;
  }
  if ( CPed::IsPlayer(pPed) )
    CWeapon::Update(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon], pPed);
  v48 = (float)(pPed->m_pMyVehicle->m_vecMoveSpeed.x * pPed->m_pMyVehicle->m_vecMoveSpeed.x)
      + (float)(pPed->m_pMyVehicle->m_vecMoveSpeed.y * pPed->m_pMyVehicle->m_vecMoveSpeed.y);
  if ( v48 <= 0.5 )
  {
    v9 = 0;
    if ( v48 < 0.01 )
      CPed::Say(pPed, 0x1Eu, 0, 1.0, 0, 0, 0);
  }
  else
  {
    v9 = 0;
    CPed::Say(pPed, 0x1Fu, 0, 1.0, 0, 0, 0);
  }
  return v9;
}

//----- (004E4E70) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::PlayerTarget(CTaskSimpleGangDriveBy *this, CPed *pPed)
{
  int Mode; // r0
  bool v5; // zf
  float *v6; // r1
  RwReal v7; // r2
  __int64 v8; // d16
  int v9; // r1
  float v10; // r0
  CVehicle *m_pMyVehicle; // r1
  float v12; // s16
  CMatrix *m_pMat; // r0
  float m_heading; // s0
  float v15; // s0
  float v16; // s2
  float v17; // s0
  AnimationId v18; // r0
  CPlayerPedData *m_pPlayerData; // r0
  CVector v20; // [sp+0h] [bp-20h] BYREF

  Mode = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
  v5 = Mode == 55;
  if ( Mode != 55 )
    v5 = Mode == 49;
  if ( !v5 )
  {
    *(_WORD *)&this->m_bInRangeToShoot = 256;
    goto LABEL_30;
  }
  *(_WORD *)&this->m_bInRangeToShoot = 257;
  v6 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
  v7 = v6[184];
  v8 = *((_QWORD *)v6 + 91);
  v9 = *((unsigned __int16 *)v6 + 191);
  v20.z = v7;
  *(_QWORD *)&v20.x = v8;
  if ( v9 == 49 )
    CCam::Get_TwoPlayer_AimVector(&TheCamera.Cams[TheCamera.ActiveCam], &v20);
  v10 = atan2f(COERCE_FLOAT(LODWORD(v20.x) ^ 0x80000000), COERCE_FLOAT((*(_QWORD *)&v20.x ^ 0x80000000uLL) >> 32));
  m_pMyVehicle = pPed->m_pMyVehicle;
  v12 = v10;
  m_pMat = m_pMyVehicle->m_pMat;
  if ( m_pMat )
    m_heading = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
  else
    m_heading = m_pMyVehicle->m_transform.m_heading;
  v15 = v12 - m_heading;
  if ( v15 > 3.1416 )
  {
    v16 = -6.2832;
LABEL_14:
    v15 = v15 + v16;
    goto LABEL_15;
  }
  if ( v15 < -3.1416 )
  {
    v16 = 6.2832;
    goto LABEL_14;
  }
LABEL_15:
  v17 = v15 + 0.7854;
  if ( v17 < 0.0 )
    v17 = v17 + 6.2832;
  switch ( (unsigned __int8)(int)(float)(v17 / 1.5708) )
  {
    case 0u:
      v18 = ANIM_GANGDB_FWD_LHS;
      if ( this->m_bSeatRHS )
        v18 = ANIM_GANGDB_FWD_RHS;
      goto LABEL_29;
    case 1u:
      v18 = ANIM_GANGDB_WINDOW_LHS;
      if ( this->m_bSeatRHS )
        v18 = ANIM_GANGDB_ROOF_RHS;
      goto LABEL_29;
    case 2u:
      v18 = ANIM_GANGDB_BAK_LHS;
      if ( this->m_bSeatRHS )
        v18 = ANIM_GANGDB_BAK_RHS;
      goto LABEL_29;
    case 3u:
      v18 = ANIM_GANGDB_ROOF_LHS;
      if ( this->m_bSeatRHS )
        v18 = ANIM_GANGDB_WINDOW_RHS;
LABEL_29:
      this->m_nRequiredAnim = v18;
      break;
    default:
      break;
  }
LABEL_30:
  if ( !CGameLogic::IsCoopGameGoingOn() )
    CCamera::SetNewPlayerWeaponMode(&TheCamera, 55, 0, 0);
  m_pPlayerData = pPed->m_pPlayerData;
  if ( m_pPlayerData )
    *((_WORD *)m_pPlayerData + 26) |= 8u;
  if ( CPed::IsPlayer(pPed) )
    CPlayerPed::GetPlayerInfoForThisPlayerPed((CPlayerPed *)pPed)->bCanDoDriveBy = 0;
}

//----- (004E5020) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::LookForTarget(CTaskSimpleGangDriveBy *this, CPed *pPed)
{
  __int64 v4; // kr00_8
  float v5; // s16
  const CMatrix *v6; // r1
  CMatrix *m_pMat; // r0
  float x; // s0
  float y; // s2
  float z; // s4
  CSimpleTransform *p_tx; // r1
  float v12; // s26
  float v13; // s24
  float v14; // s22
  float v15; // r0
  CVehicle *m_pMyVehicle; // r1
  float v17; // s28
  CMatrix *v18; // r0
  float m_heading; // s0
  float v20; // s20
  float v21; // s18
  float v22; // s0
  float m_fAbortRange; // s0
  _BOOL4 m_bReachedAbortRange; // r1
  CEntity *m_pTargetEntity; // r0
  int v26; // r1
  float *p_m_nFlags; // r0
  CMatrix *v28; // r0
  CSimpleTransform *p_m_transform; // r1
  float v30; // s4
  RwReal v31; // s0
  unsigned int m_nDrivebyStyle; // r0
  unsigned int v33; // r1
  int v34; // r2
  int v35; // r0
  int v36; // r3
  bool v37; // r0
  float v38; // s0
  int v39; // r1
  bool v40; // zf
  int v41; // r6
  int v42; // r3
  AnimationId v43; // r1
  bool v44; // nf
  float v45; // s0
  AnimationId v46; // r1
  bool v47; // nf
  AnimationId v48; // r1
  AnimationId v49; // r1
  bool v50; // nf
  CVector vecTarget; // [sp+4h] [bp-54h] BYREF

  v4 = *(_QWORD *)&this->m_pWeaponInfo;
  v5 = *(float *)(v4 + 8);
  if ( HIDWORD(v4) )
  {
    v6 = *(const CMatrix **)(HIDWORD(v4) + 20);
    if ( !v6 )
    {
      CPlaceable::AllocateMatrix((CPlaceable *)HIDWORD(v4));
      CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(HIDWORD(v4) + 4), *(CMatrix **)(HIDWORD(v4) + 20));
      v6 = *(const CMatrix **)(HIDWORD(v4) + 20);
    }
    operator*(&vecTarget, v6, &this->m_vecCoords);
    m_pMat = pPed->m_pMat;
    x = vecTarget.x;
    y = vecTarget.y;
    z = vecTarget.z;
  }
  else
  {
    m_pMat = pPed->m_pMat;
    x = this->m_vecCoords.x;
    y = this->m_vecCoords.y;
    z = this->m_vecCoords.z;
  }
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  v12 = x - p_tx->m_translate.x;
  v13 = y - p_tx->m_translate.y;
  v14 = z - p_tx->m_translate.z;
  v15 = atan2f(-v12, v13);
  m_pMyVehicle = pPed->m_pMyVehicle;
  v17 = v15;
  v18 = m_pMyVehicle->m_pMat;
  if ( v18 )
    m_heading = atan2f(COERCE_FLOAT(LODWORD(v18->xy) ^ 0x80000000), v18->yy);
  else
    m_heading = m_pMyVehicle->m_transform.m_heading;
  v20 = sqrtf((float)((float)(v12 * v12) + (float)(v13 * v13)) + (float)(v14 * v14));
  v21 = v17 - m_heading;
  if ( (float)(v17 - m_heading) <= 3.1416 )
  {
    if ( v21 >= -3.1416 )
      goto LABEL_16;
    v22 = 6.2832;
  }
  else
  {
    v22 = -6.2832;
  }
  v21 = v21 + v22;
LABEL_16:
  m_fAbortRange = this->m_fAbortRange;
  m_bReachedAbortRange = this->m_bReachedAbortRange;
  this->m_bInWeaponRange = v20 < v5;
  this->m_bInRangeToShoot = 0;
  if ( m_bReachedAbortRange )
  {
    if ( v20 > m_fAbortRange )
      goto LABEL_36;
  }
  else if ( v20 < m_fAbortRange )
  {
    this->m_bReachedAbortRange = 1;
  }
  m_pTargetEntity = this->m_pTargetEntity;
  if ( m_pTargetEntity )
  {
    v26 = *(_BYTE *)&m_pTargetEntity->m_info & 7;
    if ( v26 == 2 )
    {
      p_m_nFlags = (float *)&m_pTargetEntity[20].m_nFlags;
    }
    else
    {
      if ( v26 != 3 )
        goto LABEL_27;
      p_m_nFlags = (float *)&m_pTargetEntity[22].m_nFlags;
    }
    if ( *p_m_nFlags <= 0.0 )
    {
LABEL_36:
      this->m_nNextCommand = 7;
      return;
    }
  }
LABEL_27:
  v28 = pPed->m_pMat;
  p_m_transform = (CSimpleTransform *)&v28->tx;
  if ( !v28 )
    p_m_transform = &pPed->m_transform;
  v30 = p_m_transform->m_translate.z;
  v31 = v12 + p_m_transform->m_translate.x;
  vecTarget.y = v13 + p_m_transform->m_translate.y;
  vecTarget.x = v31;
  vecTarget.z = v14 + v30;
  if ( !CTaskSimpleGangDriveBy::LineOfSightClearForAttack(this, pPed, &vecTarget) )
  {
    v37 = 0;
LABEL_111:
    this->m_bInRangeToShoot = v37;
    return;
  }
  m_nDrivebyStyle = (unsigned __int8)this->m_nDrivebyStyle;
  v33 = (char)m_nDrivebyStyle;
  if ( m_nDrivebyStyle <= 6 && ((1 << m_nDrivebyStyle) & 0x63) != 0 )
  {
    v34 = 0;
    LOBYTE(v35) = -1;
    v36 = 0;
    goto LABEL_33;
  }
  v38 = v21 + 0.7854;
  if ( (float)(v21 + 0.7854) < 0.0 )
    v38 = (float)(v21 + 0.7854) + 6.2832;
  v35 = (int)(float)(v38 / 1.5708);
  if ( v21 <= 0.2618 || v21 >= 2.8798 )
  {
    v34 = 0;
    if ( v21 > -2.8798 )
      v34 = 0x1000000;
    if ( v21 >= -0.2618 )
      v34 = 0;
  }
  else
  {
    v34 = -16777216;
  }
  if ( v21 >= 1.309 || v21 <= -1.309 )
  {
    v41 = 0;
    v42 = 0;
    if ( v21 < -1.8326 )
      v41 = 1;
    if ( v21 > 1.8326 )
      v42 = 1;
    v36 = v42 & v41;
    if ( v33 <= 8 )
      goto LABEL_33;
  }
  else
  {
    v36 = -1;
    if ( v33 <= 8 )
    {
LABEL_33:
      switch ( v33 )
      {
        case 0u:
          goto LABEL_35;
        case 1u:
          goto LABEL_44;
        case 2u:
          if ( this->m_nRequiredAnim != ANIM_STD_NUM )
            goto LABEL_51;
LABEL_35:
          LOBYTE(v35) = 1;
          goto LABEL_81;
        case 3u:
          if ( this->m_nRequiredAnim != ANIM_STD_NUM )
            goto LABEL_51;
LABEL_44:
          LOBYTE(v35) = 3;
          goto LABEL_81;
        case 4u:
          if ( this->m_nRequiredAnim != ANIM_STD_NUM )
          {
LABEL_51:
            v39 = (unsigned __int8)v35;
            if ( (unsigned __int8)v35 != 3 )
              LOBYTE(v35) = -1;
            v40 = v39 == 1;
            goto LABEL_79;
          }
          LOBYTE(v35) = -1;
          if ( v34 >> 24 == 1 )
            LOBYTE(v35) = 3;
          if ( v34 >> 24 == -1 )
            LOBYTE(v35) = 1;
          break;
        case 5u:
          LOBYTE(v35) = 0;
          goto LABEL_81;
        case 6u:
          LOBYTE(v35) = 2;
          goto LABEL_81;
        case 7u:
          if ( this->m_nRequiredAnim == ANIM_STD_NUM )
          {
            LOBYTE(v35) = -1;
            if ( v36 == 1 )
              LOBYTE(v35) = 2;
            if ( v36 == -1 )
              LOBYTE(v35) = 0;
          }
          else
          {
            v39 = (unsigned __int8)v35;
            if ( (unsigned __int8)v35 != 2 )
              LOBYTE(v35) = -1;
            v40 = v39 == 0;
LABEL_79:
            if ( v40 )
              LOBYTE(v35) = v39;
          }
          break;
        case 8u:
          goto LABEL_81;
        default:
          goto LABEL_75;
      }
      goto LABEL_81;
    }
  }
LABEL_75:
  LOBYTE(v35) = -1;
LABEL_81:
  switch ( (char)v35 )
  {
    case 0:
      v43 = ANIM_GANGDB_FWD_LHS;
      if ( this->m_bSeatRHS )
        v43 = ANIM_GANGDB_FWD_RHS;
      v44 = v21 < 0.7854;
      this->m_nRequiredAnim = v43;
      if ( v21 <= 0.7854 )
        v44 = v20 < v5;
      if ( v44 )
      {
        v45 = -0.7854;
        goto LABEL_109;
      }
      break;
    case 1:
      v46 = ANIM_GANGDB_WINDOW_LHS;
      if ( this->m_bSeatRHS )
        v46 = ANIM_GANGDB_ROOF_RHS;
      v47 = v21 < 2.3562;
      this->m_nRequiredAnim = v46;
      if ( v21 <= 2.3562 )
        v47 = v20 < v5;
      if ( v47 )
      {
        v45 = 0.7854;
        goto LABEL_109;
      }
      break;
    case 2:
      v48 = ANIM_GANGDB_BAK_LHS;
      if ( this->m_bSeatRHS )
        v48 = ANIM_GANGDB_BAK_RHS;
      this->m_nRequiredAnim = v48;
      if ( v20 < v5 && (v21 >= -2.3562 || v21 <= 2.3562) )
        goto LABEL_110;
      break;
    case 3:
      v49 = ANIM_GANGDB_ROOF_LHS;
      if ( this->m_bSeatRHS )
        v49 = ANIM_GANGDB_WINDOW_RHS;
      v50 = v21 < -0.7854;
      this->m_nRequiredAnim = v49;
      if ( v21 <= -0.7854 )
        v50 = v20 < v5;
      if ( v50 )
      {
        v45 = -2.3562;
LABEL_109:
        if ( v21 >= v45 )
        {
LABEL_110:
          v37 = 1;
          goto LABEL_111;
        }
      }
      break;
    default:
      return;
  }
}

//----- (004E544C) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::FireGun(CTaskSimpleGangDriveBy *this, CPed *pPed)
{
  CWeaponInfo *m_pWeaponInfo; // r0
  __int64 v5; // d16
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r6
  RwInt32 v7; // r5
  RwMatrix *MatrixArray; // r0
  CVehicle *m_pMyVehicle; // r1
  CColModel *m_pColModel; // r9
  CMatrix *m_pMat; // r0
  float *p_tx; // r2
  RwReal v13; // s2
  RwReal v14; // s4
  int Mode; // r1
  CMatrix *v16; // r2
  CSimpleTransform *p_m_transform; // r3
  float *v18; // r0
  float v19; // s0
  CEntity *m_pTargetEntity; // r6
  const CMatrix *v21; // r1
  float x; // s0
  float y; // s2
  float z; // s4
  float v25; // s6
  float v26; // s8
  float v27; // s10
  CAnimBlendAssociation *m_pAnim; // r0
  int m_animId; // r1
  bool v30; // zf
  int m_nFakeShootDirn; // r1
  float v32; // s0
  float v33; // s2
  CMatrix *v34; // r0
  float v35; // s4
  float yx; // s12
  float zx; // s10
  float v38; // s8
  float v39; // s6
  float v40; // s10
  float v41; // s6
  int v42; // r2
  bool v43; // zf
  CMatrix *v44; // r0
  float v45; // s12
  float v46; // s10
  float v47; // s6
  float v48; // s8
  float v49; // s10
  CMatrix *v50; // r0
  float v51; // s6
  float v52; // s12
  float v53; // s10
  CMatrix *v54; // r0
  float xy; // s8
  float yy; // s12
  float zy; // s10
  __int64 v58; // d16
  CEntity *v59; // r6
  const CMatrix *v60; // r1
  CEntity *pTargetEnt; // r0
  int m_nCurrentWeapon; // r1
  CVector *p_v; // r3
  CVector v64; // [sp+10h] [bp-60h] BYREF
  CVector v; // [sp+20h] [bp-50h] BYREF
  CVector pAltPosn; // [sp+30h] [bp-40h] BYREF
  CVector vecTarget; // [sp+3Ch] [bp-34h] BYREF
  RwV3d_0 pointsIn; // [sp+48h] [bp-28h] BYREF

  m_pWeaponInfo = this->m_pWeaponInfo;
  v5 = *(_QWORD *)&m_pWeaponInfo->m_vecFireOffset.x;
  pointsIn.z = m_pWeaponInfo->m_vecFireOffset.z;
  *(_QWORD *)&pointsIn.x = v5;
  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)pPed->m_pRwObject);
  v7 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, pPed->m_aPedFrames[6]->boneTag);
  MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
  RwV3dTransformPoints(&pointsIn, &pointsIn, 1, &MatrixArray[v7]);
  m_pMyVehicle = pPed->m_pMyVehicle;
  m_pColModel = CModelInfo::ms_modelInfoPtrs[m_pMyVehicle->m_nModelIndex]->m_pColModel;
  m_pMat = m_pMyVehicle->m_pMat;
  p_tx = &m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pMyVehicle->m_transform.m_translate.x;
  v13 = pointsIn.y - p_tx[1];
  v14 = pointsIn.z - p_tx[2];
  pAltPosn.x = pointsIn.x - *p_tx;
  pAltPosn.y = v13;
  pAltPosn.z = v14;
  if ( CPed::IsPlayer(pPed) )
  {
    Mode = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
    if ( Mode == 55 )
    {
      v19 = 20.0;
    }
    else
    {
      if ( Mode != 49 )
        return;
      v16 = pPed->m_pMat;
      p_m_transform = (CSimpleTransform *)&v16->tx;
      if ( !v16 )
        p_m_transform = &pPed->m_transform;
      v18 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
      v19 = sqrtf(
              (float)((float)((float)(p_m_transform->m_translate.x - v18[185])
                            * (float)(p_m_transform->m_translate.x - v18[185]))
                    + (float)((float)(p_m_transform->m_translate.y - v18[186])
                            * (float)(p_m_transform->m_translate.y - v18[186])))
            + (float)((float)(p_m_transform->m_translate.z - v18[187]) * (float)(p_m_transform->m_translate.z - v18[187])))
          + 20.0;
    }
    CCamera::Find3rdPersonCamTargetVector(&TheCamera, v19, (CVector)pointsIn, &v, &vecTarget);
    vecTarget.x = vecTarget.x - pointsIn.x;
    vecTarget.y = vecTarget.y - pointsIn.y;
    vecTarget.z = vecTarget.z - pointsIn.z;
    pPed->m_pPlayerData->m_fAttackButtonCounter = 0.0;
  }
  else
  {
    m_pTargetEntity = this->m_pTargetEntity;
    if ( m_pTargetEntity )
    {
      v21 = m_pTargetEntity->m_pMat;
      if ( !v21 )
      {
        CPlaceable::AllocateMatrix(this->m_pTargetEntity);
        CSimpleTransform::UpdateMatrix(&m_pTargetEntity->m_transform, m_pTargetEntity->m_pMat);
        v21 = m_pTargetEntity->m_pMat;
      }
      operator*(&v, v21, &this->m_vecCoords);
      x = pointsIn.x;
      y = pointsIn.y;
      z = pointsIn.z;
      v25 = v.x;
      v26 = v.y;
      v27 = v.z;
    }
    else
    {
      x = pointsIn.x;
      y = pointsIn.y;
      z = pointsIn.z;
      v25 = this->m_vecCoords.x;
      v26 = this->m_vecCoords.y;
      v27 = this->m_vecCoords.z;
    }
    vecTarget.x = v25 - x;
    vecTarget.y = v26 - y;
    vecTarget.z = v27 - z;
  }
  CVector::Normalise(&vecTarget);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
  {
    m_animId = m_pAnim->m_animId;
    v30 = m_animId == 231;
    if ( m_animId != 231 )
      v30 = m_animId == 236;
    if ( v30 )
      goto LABEL_22;
  }
  m_nFakeShootDirn = (unsigned __int8)this->m_nFakeShootDirn;
  if ( m_nFakeShootDirn == 1 )
  {
LABEL_22:
    v32 = vecTarget.x;
    v33 = vecTarget.y;
    v34 = pPed->m_pMyVehicle->m_pMat;
    v35 = vecTarget.z;
    yx = v34->yx;
    zx = v34->zx;
    v38 = (float)((float)(v34->xx * vecTarget.x) + (float)(yx * vecTarget.y)) + (float)(zx * vecTarget.z);
    if ( v38 < -0.1 )
    {
      v39 = (float)((float)(v34->xx * pAltPosn.x) + (float)(yx * pAltPosn.y)) + (float)(zx * pAltPosn.z);
      v40 = m_pColModel->m_boxBound.m_vecMin.x;
LABEL_24:
      v41 = (float)((float)(v40 - v39) + -0.2) / (float)-v38;
LABEL_33:
      pAltPosn.x = pointsIn.x + (float)(v32 * v41);
      pAltPosn.y = pointsIn.y + (float)(v33 * v41);
      pAltPosn.z = pointsIn.z + (float)(v35 * v41);
      goto LABEL_42;
    }
    goto LABEL_41;
  }
  if ( m_pAnim )
  {
    v42 = m_pAnim->m_animId;
    v43 = v42 == 232;
    if ( v42 != 232 )
      v43 = v42 == 235;
    if ( v43 )
      goto LABEL_30;
  }
  if ( m_nFakeShootDirn == 3 )
  {
LABEL_30:
    v32 = vecTarget.x;
    v33 = vecTarget.y;
    v44 = pPed->m_pMyVehicle->m_pMat;
    v35 = vecTarget.z;
    v45 = v44->yx;
    v46 = v44->zx;
    v47 = (float)((float)(v44->xx * vecTarget.x) + (float)(v45 * vecTarget.y)) + (float)(v46 * vecTarget.z);
    if ( v47 <= 0.1 )
      goto LABEL_41;
    v48 = (float)((float)(v44->xx * pAltPosn.x) + (float)(v45 * pAltPosn.y)) + (float)(v46 * pAltPosn.z);
    v49 = m_pColModel->m_boxBound.m_vecMax.x;
LABEL_32:
    v41 = (float)((float)(v49 - v48) + 0.2) / v47;
    goto LABEL_33;
  }
  if ( (!m_pAnim || (m_pAnim->m_animId | 4) != 238) && m_nFakeShootDirn != 2 )
  {
    v32 = vecTarget.x;
    v33 = vecTarget.y;
    v54 = pPed->m_pMyVehicle->m_pMat;
    v35 = vecTarget.z;
    xy = v54->xy;
    yy = v54->yy;
    zy = v54->zy;
    v47 = (float)((float)(xy * vecTarget.x) + (float)(yy * vecTarget.y)) + (float)(zy * vecTarget.z);
    if ( v47 <= 0.1 )
      goto LABEL_41;
    v48 = (float)((float)(xy * pAltPosn.x) + (float)(yy * pAltPosn.y)) + (float)(zy * pAltPosn.z);
    v49 = m_pColModel->m_boxBound.m_vecMax.y;
    goto LABEL_32;
  }
  v32 = vecTarget.x;
  v33 = vecTarget.y;
  v50 = pPed->m_pMyVehicle->m_pMat;
  v35 = vecTarget.z;
  v51 = v50->xy;
  v52 = v50->yy;
  v53 = v50->zy;
  v38 = (float)((float)(v51 * vecTarget.x) + (float)(v52 * vecTarget.y)) + (float)(v53 * vecTarget.z);
  if ( v38 < -0.1 )
  {
    v39 = (float)((float)(v51 * pAltPosn.x) + (float)(v52 * pAltPosn.y)) + (float)(v53 * pAltPosn.z);
    v40 = m_pColModel->m_boxBound.m_vecMin.y;
    goto LABEL_24;
  }
LABEL_41:
  pAltPosn = (CVector)pointsIn;
LABEL_42:
  pPed->m_ik.m_flags |= 1u;
  if ( this->m_vecCoords.x == 0.0 && this->m_vecCoords.y == 0.0 && this->m_vecCoords.z == 0.0 )
  {
    pTargetEnt = this->m_pTargetEntity;
    m_nCurrentWeapon = pPed->m_nCurrentWeapon;
    p_v = 0;
  }
  else
  {
    v58 = *(_QWORD *)&this->m_vecCoords.x;
    v.z = this->m_vecCoords.z;
    *(_QWORD *)&v.x = v58;
    v59 = this->m_pTargetEntity;
    if ( v59 )
    {
      v60 = v59->m_pMat;
      if ( !v60 )
      {
        CPlaceable::AllocateMatrix(this->m_pTargetEntity);
        CSimpleTransform::UpdateMatrix(&v59->m_transform, v59->m_pMat);
        v60 = v59->m_pMat;
      }
      operator*(&v64, v60, &v);
      v = v64;
      pTargetEnt = this->m_pTargetEntity;
    }
    else
    {
      pTargetEnt = 0;
    }
    m_nCurrentWeapon = pPed->m_nCurrentWeapon;
    p_v = &v;
  }
  CWeapon::Fire(
    &pPed->m_WeaponSlots[m_nCurrentWeapon],
    pPed,
    (CVector *)&pointsIn,
    (CVector *)&pointsIn,
    pTargetEnt,
    p_v,
    &pAltPosn);
  CPed::DoGunFlash(pPed, 250, 0);
}

//----- (004E595C) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::AimGun(CTaskSimpleGangDriveBy *this, CPed *pPed)
{
  int Mode; // r0
  float v5; // s0
  CMatrix *v6; // r1
  CSimpleTransform *p_m_transform; // r6
  float x; // s0
  CEntity *m_pTargetEntity; // r4
  const CMatrix *v10; // r1
  __int64 v11; // d16
  RwReal z; // r0
  CSimpleTransform *v13; // r0
  float v14; // s0
  float y; // s2
  float v16; // s4
  float *v17; // r0
  CPedIK *p_m_ik; // r6
  CMatrix *v19; // r0
  CSimpleTransform *v20; // r1
  float RadianAngleBetweenPoints; // s16
  CVehicle *m_pMyVehicle; // r0
  float v23; // s0
  float v24; // r0
  CVehicle *v25; // r5
  float v26; // r4
  CMatrix *v27; // r0
  float m_heading; // s0
  float v29; // s2
  CMatrix *v30; // r0
  float v31; // s20
  float v32; // s0
  float v33; // r0
  float v34; // s0
  CMatrix *v35; // r1
  float zy; // s2
  bool v37; // cc
  bool v38; // r3
  float v39; // s2
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  CVector vecSource; // [sp+10h] [bp-48h] BYREF
  RwV3d_0 fY1[4]; // [sp+20h] [bp-38h] BYREF
  CVector v44; // 0:r2.8,8:^0.4

  pPed->m_ik.m_flags &= ~4u;
  memset(fY1, 0, 12);
  if ( !CPed::IsPlayer(pPed) )
  {
    x = this->m_vecCoords.x;
    m_pTargetEntity = this->m_pTargetEntity;
    if ( m_pTargetEntity )
    {
      if ( x == 0.0 && this->m_vecCoords.y == 0.0 && this->m_vecCoords.z == 0.0 )
      {
        if ( (*(_BYTE *)&m_pTargetEntity->m_info & 7) == 3 )
        {
          CPed::GetBonePosition((CPed *)this->m_pTargetEntity, fY1, 3u, 0);
          goto LABEL_23;
        }
        m_pMat = m_pTargetEntity->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pTargetEntity->m_transform;
        v11 = *(_QWORD *)&p_tx->m_translate.x;
        z = p_tx->m_translate.z;
      }
      else
      {
        v10 = m_pTargetEntity->m_pMat;
        if ( !v10 )
        {
          CPlaceable::AllocateMatrix(this->m_pTargetEntity);
          CSimpleTransform::UpdateMatrix(&m_pTargetEntity->m_transform, m_pTargetEntity->m_pMat);
          v10 = m_pTargetEntity->m_pMat;
        }
        operator*(&vecSource, v10, &this->m_vecCoords);
        v11 = *(_QWORD *)&vecSource.x;
        z = vecSource.z;
      }
    }
    else
    {
      if ( x == 0.0 && this->m_vecCoords.y == 0.0 && this->m_vecCoords.z == 0.0 )
        goto LABEL_23;
      z = this->m_vecCoords.z;
      v11 = *(_QWORD *)&this->m_vecCoords.x;
    }
    fY1[0].z = z;
    *(_QWORD *)&fY1[0].x = v11;
    goto LABEL_23;
  }
  Mode = (unsigned __int16)TheCamera.Cams[TheCamera.ActiveCam].Mode;
  if ( Mode == 49 )
  {
    p_m_transform = &pPed->m_transform;
    v6 = pPed->m_pMat;
    v13 = &pPed->m_transform;
    if ( v6 )
      v13 = (CSimpleTransform *)&v6->tx;
    v14 = v13->m_translate.x;
    y = v13->m_translate.y;
    v16 = v13->m_translate.z;
    v17 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
    v5 = sqrtf(
           (float)((float)((float)(v14 - v17[185]) * (float)(v14 - v17[185]))
                 + (float)((float)(y - v17[186]) * (float)(y - v17[186])))
         + (float)((float)(v16 - v17[187]) * (float)(v16 - v17[187])))
       + 20.0;
  }
  else
  {
    if ( Mode != 55 )
      return;
    v5 = 20.0;
    v6 = pPed->m_pMat;
    p_m_transform = &pPed->m_transform;
  }
  if ( v6 )
    p_m_transform = (CSimpleTransform *)&v6->tx;
  v44.x = p_m_transform->m_translate.x + 0.0;
  v44.y = p_m_transform->m_translate.y + 0.0;
  v44.z = p_m_transform->m_translate.z + 0.7;
  CCamera::Find3rdPersonCamTargetVector(&TheCamera, v5, v44, &vecSource, (CVector *)fY1);
LABEL_23:
  memset(&vecSource, 0, sizeof(vecSource));
  p_m_ik = &pPed->m_ik;
  CPed::GetBonePosition(pPed, &vecSource, 0x16u, 0);
  v19 = pPed->m_pMat;
  v20 = (CSimpleTransform *)&v19->tx;
  if ( !v19 )
    v20 = &pPed->m_transform;
  vecSource.x = v20->m_translate.x;
  vecSource.y = v20->m_translate.y;
  RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(fY1[0].x, fY1[0].y, vecSource.x, vecSource.y);
  m_pMyVehicle = pPed->m_pMyVehicle;
  v23 = 0.0;
  if ( m_pMyVehicle && m_pMyVehicle->m_baseVehicleType == 9 )
  {
    v24 = CGeneral::GetRadianAngleBetweenPoints(
            fY1[0].z,
            sqrtf(
              (float)((float)(vecSource.x - fY1[0].x) * (float)(vecSource.x - fY1[0].x))
            + (float)((float)(vecSource.y - fY1[0].y) * (float)(vecSource.y - fY1[0].y))),
            vecSource.z,
            0.0);
    v25 = pPed->m_pMyVehicle;
    v26 = v24;
    v27 = v25->m_pMat;
    if ( v27 )
      m_heading = atan2f(COERCE_FLOAT(LODWORD(v27->xy) ^ 0x80000000), v27->yy);
    else
      m_heading = v25->m_transform.m_heading;
    v29 = sinf(RadianAngleBetweenPoints - m_heading);
    v30 = v25->m_pMat;
    v31 = v29 * v25[1].m_vecCOM.x;
    if ( v30 )
      v32 = atan2f(COERCE_FLOAT(LODWORD(v30->xy) ^ 0x80000000), v30->yy);
    else
      v32 = v25->m_transform.m_heading;
    v33 = cosf(RadianAngleBetweenPoints - v32);
    v34 = -1.0;
    v35 = v25->m_pMat;
    zy = v35->zy;
    v37 = zy <= -1.0;
    if ( zy >= -1.0 )
      v37 = zy <= 1.0;
    if ( v37 )
    {
      if ( zy >= -1.0 )
        v34 = v35->zy;
    }
    else
    {
      v34 = 1.0;
    }
    v23 = (float)(v26 + v31) + (float)(v33 * asinf(v34));
  }
  v38 = 0;
  if ( (unsigned int)(this->m_pAnim->m_animId - 231) > 7 )
    goto LABEL_49;
  if ( ((1 << (this->m_pAnim->m_animId + 25)) & 0x21) != 0 )
  {
    v39 = -1.5708;
    v23 = -v23;
  }
  else
  {
    if ( ((1 << (this->m_pAnim->m_animId + 25)) & 0x12) == 0 )
    {
      if ( ((1 << (this->m_pAnim->m_animId + 25)) & 0x88) != 0 )
      {
        v23 = -v23;
        RadianAngleBetweenPoints = RadianAngleBetweenPoints + -3.1416;
        v38 = 0;
      }
      goto LABEL_49;
    }
    v39 = 1.5708;
  }
  RadianAngleBetweenPoints = RadianAngleBetweenPoints + v39;
  v38 = 1;
LABEL_49:
  CPedIK::PointGunInDirection(p_m_ik, RadianAngleBetweenPoints, v23, v38, -1.0);
}

//----- (004E5CEC) --------------------------------------------------------
bool __fastcall CTaskSimpleGangDriveBy::LineOfSightClearForAttack(
        CTaskSimpleGangDriveBy *this,
        CPed *pPed,
        CVector *vecTarget)
{
  uint32 v4; // r5
  CEntity *m_pTargetEntity; // r3
  CMatrix *m_pMat; // r5
  CSimpleTransform *p_tx; // r0
  RwReal v8; // s0
  RwReal v9; // s2
  CVector vecStart; // [sp+14h] [bp-14h] BYREF

  v4 = CTimer::m_snTimeInMilliseconds;
  if ( CTimer::m_snTimeInMilliseconds > this->m_nLOSCheckTime )
  {
    m_pTargetEntity = this->m_pTargetEntity;
    this->m_nLOSBlocked = 0;
    if ( m_pTargetEntity )
    {
      m_pMat = pPed->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
      v8 = p_tx->m_translate.z + 0.5;
      v9 = p_tx->m_translate.x + 0.0;
      vecStart.y = p_tx->m_translate.y + 0.0;
      CWorld::pIgnoreEntity = m_pTargetEntity;
      vecStart.x = v9;
      vecStart.z = v8;
      if ( !CWorld::GetIsLineOfSightClear(&vecStart, vecTarget, 1, 0, 0, 0, 0, 1, 0) )
        this->m_nLOSBlocked = 1;
      v4 = CTimer::m_snTimeInMilliseconds;
      CWorld::pIgnoreEntity = 0;
    }
    this->m_nLOSCheckTime = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 500.0) + v4 + 1750;
  }
  return !this->m_nLOSBlocked;
}

//----- (004E5DD8) --------------------------------------------------------
void __fastcall CTaskSimpleGangDriveBy::FinishAnimGangDriveByCB(CAnimBlendAssociation *pAnim, void *pData)
{
  if ( *((CAnimBlendAssociation **)pData + 11) == pAnim )
    *((_DWORD *)pData + 11) = 0;
}

//----- (004E5DE4) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCar::CTaskComplexDestroyCar(
        CTaskComplexDestroyCar *this,
        CVehicle *pTargetVehicle,
        uint32 nDuckingConditions,
        uint32 nTimeToDuck,
        uint32 nPercentageDuckChance)
{
  CTaskComplex::CTaskComplex(this);
  this->m_nDuckingConditions = nDuckingConditions;
  this->m_nTimeToDuck = nTimeToDuck;
  this->m_nPercentageDuckChance = nPercentageDuckChance;
  this->_vptr$CTask = (int (**)(void))&off_669964;
  this->m_pTargetVehicle = pTargetVehicle;
  if ( pTargetVehicle )
    CEntity::RegisterReference(pTargetVehicle, &this->m_pTargetVehicle);
}
// 669964: using guessed type void *;

//----- (004E5E28) --------------------------------------------------------
bool __fastcall CTaskComplexDestroyCar::MakeAbortable(
        CTaskComplexDestroyCar *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  if ( (unsigned int)(iPriority - 1) <= 1 )
    return (*((int (__fastcall **)(CTask *, CPed *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
             this->m_pSubTask,
             pPed);
  else
    return 0;
}

//----- (004E5E44) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCar::~CTaskComplexDestroyCar(CTaskComplexDestroyCar *this)
{
  CVehicle *m_pTargetVehicle; // r0
  CEntity **p_m_pTargetVehicle; // r1

  p_m_pTargetVehicle = &this->m_pTargetVehicle;
  m_pTargetVehicle = this->m_pTargetVehicle;
  this->_vptr$CTask = (int (**)(void))&off_669964;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, p_m_pTargetVehicle);
  sub_18EDB4(this);
}
// 669964: using guessed type void *off_669964;

//----- (004E5E70) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCar::~CTaskComplexDestroyCar(CTaskComplexDestroyCar *this)
{
  CVehicle *m_pTargetVehicle; // r0
  CEntity **p_m_pTargetVehicle; // r1
  void *v4; // r0

  p_m_pTargetVehicle = &this->m_pTargetVehicle;
  m_pTargetVehicle = this->m_pTargetVehicle;
  this->_vptr$CTask = (int (**)(void))&off_669964;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, p_m_pTargetVehicle);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E5E98: variable 'v4' is possibly undefined
// 669964: using guessed type void *off_669964;

//----- (004E5EA0) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCar::CreateNextSubTask(CTaskComplexDestroyCar *this, CPed *pPed)
{
  int v4; // r0
  int v5; // r1
  bool v6; // zf
  _BOOL4 IsTypeMelee; // r0
  unsigned int v8; // r0

  v4 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  v5 = 1302;
  if ( v4 < 1004 )
  {
    if ( v4 != 208 )
    {
      v6 = v4 == 703;
      if ( v4 != 703 )
        v6 = v4 == 704;
      if ( !v6 )
        return 0;
      IsTypeMelee = CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]);
      v5 = 1005;
      if ( IsTypeMelee )
        v5 = 1004;
    }
    return CTaskComplexDestroyCar::CreateSubTask(this, v5, 0);
  }
  v8 = v4 - 1004;
  if ( v8 <= 4 && ((1 << v8) & 0x13) != 0 )
    return CTaskComplexDestroyCar::CreateSubTask(this, v5, 0);
  return 0;
}

//----- (004E5F10) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCar::CreateSubTask(CTaskComplexDestroyCar *this, int iSubTaskType, CPed *pPed)
{
  char *v5; // r4
  CVehicle *m_pTargetVehicle; // r5
  uint32 m_nDuckingConditions; // r8
  uint32 m_nTimeToDuck; // r9
  uint32 m_nPercentageDuckChance; // r6
  char *v10; // r0

  switch ( iSubTaskType )
  {
    case 1005:
      v5 = (char *)CTask::operator new(0x64u);
      m_pTargetVehicle = this->m_pTargetVehicle;
      m_nDuckingConditions = this->m_nDuckingConditions;
      m_nTimeToDuck = this->m_nTimeToDuck;
      m_nPercentageDuckChance = this->m_nPercentageDuckChance;
      CTaskComplex::CTaskComplex((CTaskComplex *)v5);
      *(_QWORD *)(v5 + 65) = 0LL;
      *(_QWORD *)(v5 + 73) = 0LL;
      *(_QWORD *)(v5 + 52) = 0LL;
      *(_QWORD *)(v5 + 60) = 0LL;
      v10 = (char *)&`vtable for'CTaskComplexDestroyCarArmed;
      *(_QWORD *)(v5 + 36) = 0LL;
      *(_QWORD *)(v5 + 44) = 0LL;
      *(_QWORD *)(v5 + 20) = 0LL;
      *(_QWORD *)(v5 + 28) = 0LL;
      *((_DWORD *)v5 + 21) = -1;
      *((_DWORD *)v5 + 22) = m_nDuckingConditions;
      *((_DWORD *)v5 + 23) = m_nTimeToDuck;
      *((_DWORD *)v5 + 24) = m_nPercentageDuckChance;
      break;
    case 1004:
      v5 = (char *)CTask::operator new(0x34u);
      m_pTargetVehicle = this->m_pTargetVehicle;
      CTaskComplex::CTaskComplex((CTaskComplex *)v5);
      *(_QWORD *)(v5 + 20) = 0LL;
      *(_QWORD *)(v5 + 28) = 0LL;
      *((_WORD *)v5 + 6) = 0;
      *((_DWORD *)v5 + 10) = 0;
      *((_DWORD *)v5 + 11) = 0;
      v10 = (char *)&`vtable for'CTaskComplexDestroyCarMelee;
      *((_DWORD *)v5 + 12) = -1;
      break;
    case 704:
      v5 = (char *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar((CTaskComplexLeaveCar *)v5, pPed->m_pMyVehicle, 0, 0, 1, 0);
      return (CTask *)v5;
    default:
      return 0;
  }
  *(_DWORD *)v5 = v10 + 8;
  *((_DWORD *)v5 + 4) = m_pTargetVehicle;
  if ( m_pTargetVehicle )
    CEntity::RegisterReference(m_pTargetVehicle, (CEntity **)v5 + 4);
  return (CTask *)v5;
}

//----- (004E5FFC) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCar::CreateFirstSubTask(CTaskComplexDestroyCar *this, CPed *pPed)
{
  CVehicle *m_pTargetVehicle; // r0
  char *v5; // r4
  CVehicle *m_pMyVehicle; // r0
  bool v7; // zf
  CVehicle *v8; // r5
  CEntity **v9; // r1
  CEntity *v10; // r0
  CVehicle *v11; // r6
  uint32 m_nDuckingConditions; // r8
  uint32 m_nTimeToDuck; // r9
  uint32 m_nPercentageDuckChance; // r5

  m_pTargetVehicle = this->m_pTargetVehicle;
  v5 = 0;
  this->m_bNewTarget = 0;
  if ( m_pTargetVehicle )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    v7 = m_pMyVehicle == 0;
    if ( m_pMyVehicle )
      v7 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
    if ( v7 )
    {
      if ( CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]) )
      {
        v5 = (char *)CTask::operator new(0x34u);
        v8 = this->m_pTargetVehicle;
        CTaskComplex::CTaskComplex((CTaskComplex *)v5);
        *(_QWORD *)(v5 + 20) = 0LL;
        *(_QWORD *)(v5 + 28) = 0LL;
        *((_WORD *)v5 + 6) = 0;
        *((_DWORD *)v5 + 10) = 0;
        *((_DWORD *)v5 + 11) = 0;
        *((_DWORD *)v5 + 12) = -1;
        *(_DWORD *)v5 = &off_6699A0;
        *((_DWORD *)v5 + 4) = v8;
        v9 = (CEntity **)(v5 + 16);
        if ( !v8 )
          return (CTask *)v5;
        v10 = v8;
      }
      else
      {
        v5 = (char *)CTask::operator new(0x64u);
        v11 = this->m_pTargetVehicle;
        m_nDuckingConditions = this->m_nDuckingConditions;
        m_nTimeToDuck = this->m_nTimeToDuck;
        m_nPercentageDuckChance = this->m_nPercentageDuckChance;
        CTaskComplex::CTaskComplex((CTaskComplex *)v5);
        *(_QWORD *)(v5 + 65) = 0LL;
        *(_QWORD *)(v5 + 73) = 0LL;
        *(_QWORD *)(v5 + 52) = 0LL;
        *(_QWORD *)(v5 + 60) = 0LL;
        *(_QWORD *)(v5 + 36) = 0LL;
        *(_QWORD *)(v5 + 44) = 0LL;
        *(_QWORD *)(v5 + 20) = 0LL;
        *(_QWORD *)(v5 + 28) = 0LL;
        *((_DWORD *)v5 + 21) = -1;
        *((_DWORD *)v5 + 22) = m_nDuckingConditions;
        *((_DWORD *)v5 + 23) = m_nTimeToDuck;
        *((_DWORD *)v5 + 24) = m_nPercentageDuckChance;
        *(_DWORD *)v5 = &off_6699DC;
        *((_DWORD *)v5 + 4) = v11;
        v9 = (CEntity **)(v5 + 16);
        if ( !v11 )
          return (CTask *)v5;
        v10 = v11;
      }
      CEntity::RegisterReference(v10, v9);
      return (CTask *)v5;
    }
    v5 = (char *)CTask::operator new(0x34u);
    CTaskComplexLeaveCar::CTaskComplexLeaveCar((CTaskComplexLeaveCar *)v5, pPed->m_pMyVehicle, 0, 0, 1, 0);
  }
  return (CTask *)v5;
}
// 6699A0: using guessed type void *;
// 6699DC: using guessed type void *;

//----- (004E6118) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCar::ControlSubTask(CTaskComplexDestroyCar *this, CPed *pPed)
{
  CVehicle *m_pTargetVehicle; // r0
  int v6; // r0
  int v7; // r8
  int v8; // r1

  m_pTargetVehicle = this->m_pTargetVehicle;
  if ( !m_pTargetVehicle || m_pTargetVehicle->m_nHealth <= 0.0 )
    return 0;
  if ( this->m_bNewTarget )
    return (CTask *)(*((int (__fastcall **)(CTaskComplexDestroyCar *, CPed *))this->_vptr$CTask + 11))(this, pPed);
  v6 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  if ( v6 != 1005 )
  {
    if ( v6 != 1004 || CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon]) )
      return this->m_pSubTask;
    v7 = 1005;
    goto LABEL_10;
  }
  if ( pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_nAmmoTotal || CPed::IsPlayer(pPed) )
    return this->m_pSubTask;
  if ( pPed->m_WeaponSlots[0].m_nAmmoTotal >= 1 )
  {
    v8 = 0;
LABEL_40:
    CPed::SetCurrentWeapon(pPed, v8);
    return this->m_pSubTask;
  }
  if ( pPed->m_WeaponSlots[1].m_nAmmoTotal > 0 )
  {
    v8 = 1;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[2].m_nAmmoTotal > 0 )
  {
    v8 = 2;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[3].m_nAmmoTotal > 0 )
  {
    v8 = 3;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[4].m_nAmmoTotal > 0 )
  {
    v8 = 4;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[5].m_nAmmoTotal > 0 )
  {
    v8 = 5;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[6].m_nAmmoTotal > 0 )
  {
    v8 = 6;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[7].m_nAmmoTotal > 0 )
  {
    v8 = 7;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[8].m_nAmmoTotal > 0 )
  {
    v8 = 8;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[9].m_nAmmoTotal > 0 )
  {
    v8 = 9;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[10].m_nAmmoTotal > 0 )
  {
    v8 = 10;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[11].m_nAmmoTotal > 0 )
  {
    v8 = 11;
    goto LABEL_40;
  }
  if ( pPed->m_WeaponSlots[12].m_nAmmoTotal > 0 )
  {
    v8 = 12;
    goto LABEL_40;
  }
  CPed::SetCurrentWeapon(pPed, 0);
  v7 = 1004;
LABEL_10:
  if ( (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
         this->m_pSubTask,
         pPed,
         1,
         0) == 1 )
    return CTaskComplexDestroyCar::CreateSubTask(this, v7, pPed);
  return this->m_pSubTask;
}

//----- (004E6280) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarMelee::CTaskComplexDestroyCarMelee(
        CTaskComplexDestroyCarMelee *this,
        CVehicle *pTargetVehicle)
{
  CTaskComplex::CTaskComplex(this);
  *(_WORD *)&this->m_bAbortAtLeisure = 0;
  this->m_fArriveRange = 0.0;
  *(_QWORD *)&this->m_vecTargetPos.x = 0LL;
  *(_QWORD *)&this->m_vecTargetPos.z = 0LL;
  this->m_nLastAttackTime = 0;
  this->m_pauseTimer = -1;
  this->_vptr$CTask = (int (**)(void))&off_6699A0;
  this->m_pTargetVehicle = pTargetVehicle;
  if ( pTargetVehicle )
    CEntity::RegisterReference(pTargetVehicle, &this->m_pTargetVehicle);
}
// 6699A0: using guessed type void *off_6699A0;

//----- (004E62CC) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarMelee::~CTaskComplexDestroyCarMelee(CTaskComplexDestroyCarMelee *this)
{
  CVehicle *m_pTargetVehicle; // r0
  CEntity **p_m_pTargetVehicle; // r1

  p_m_pTargetVehicle = &this->m_pTargetVehicle;
  m_pTargetVehicle = this->m_pTargetVehicle;
  this->_vptr$CTask = (int (**)(void))&off_6699A0;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, p_m_pTargetVehicle);
  sub_18EDB4(this);
}
// 6699A0: using guessed type void *off_6699A0;

//----- (004E62F8) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarMelee::~CTaskComplexDestroyCarMelee(CTaskComplexDestroyCarMelee *this)
{
  CVehicle *m_pTargetVehicle; // r0
  CEntity **p_m_pTargetVehicle; // r1
  void *v4; // r0

  p_m_pTargetVehicle = &this->m_pTargetVehicle;
  m_pTargetVehicle = this->m_pTargetVehicle;
  this->_vptr$CTask = (int (**)(void))&off_6699A0;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, p_m_pTargetVehicle);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E6320: variable 'v4' is possibly undefined
// 6699A0: using guessed type void *off_6699A0;

//----- (004E6328) --------------------------------------------------------
bool __fastcall CTaskComplexDestroyCarMelee::MakeAbortable(
        CTaskComplexDestroyCarMelee *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CVehicle *m_pTargetVehicle; // r0
  CVehicle *v9; // r0
  float v10; // s0
  CVehicle *v11; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v13; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *p_m_transform; // r1
  unsigned __int64 v16; // d1
  CVector m_vecMoveSpeed; // [sp+0h] [bp-20h] BYREF

  if ( iPriority == 1 )
  {
    if ( !pEvent )
      return (*((int (__fastcall **)(CTask *, CPed *, int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
              + 7))(
               this->m_pSubTask,
               pPed,
               1,
               pEvent);
    if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) != 1 )
      goto LABEL_10;
    m_pTargetVehicle = this->m_pTargetVehicle;
    if ( !m_pTargetVehicle || *(CVehicle **)&pEvent[1].m_bIsPersistent != m_pTargetVehicle )
      goto LABEL_10;
    m_vecMoveSpeed = m_pTargetVehicle->m_vecMoveSpeed;
    v10 = (float)((float)(m_vecMoveSpeed.x * m_vecMoveSpeed.x) + (float)(m_vecMoveSpeed.y * m_vecMoveSpeed.y))
        + (float)(m_vecMoveSpeed.z * m_vecMoveSpeed.z);
    if ( v10 != 0.0 )
    {
      if ( v10 >= 0.0225 )
        goto LABEL_10;
      CVector::Normalise(&m_vecMoveSpeed);
      v11 = this->m_pTargetVehicle;
      m_pMat = pPed->m_pMat;
      v13 = v11->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
      p_m_transform = (CSimpleTransform *)&v13->tx;
      if ( !v13 )
        p_m_transform = &v11->m_transform;
      v16 = vmul_f32(
              vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y),
              *(float32x2_t *)&m_vecMoveSpeed.y).n64_u64[0];
      if ( (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x) * m_vecMoveSpeed.x)
                         + *(float *)&v16)
                 + *((float *)&v16 + 1)) <= 0.0 )
      {
LABEL_10:
        if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) != 56 )
          return (*((int (__fastcall **)(CTask *, CPed *, int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
                  + 7))(
                   this->m_pSubTask,
                   pPed,
                   1,
                   pEvent);
        v9 = this->m_pTargetVehicle;
        if ( !v9 || (CVehicle *)pEvent[1].m_iAccumulatedTime != v9 )
          return (*((int (__fastcall **)(CTask *, CPed *, int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
                  + 7))(
                   this->m_pSubTask,
                   pPed,
                   1,
                   pEvent);
      }
    }
  }
  else
  {
    if ( iPriority == 2 )
      return (*((int (__fastcall **)(CTask *, CPed *, int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
              + 7))(
               this->m_pSubTask,
               pPed,
               2,
               pEvent);
    this->m_bAbortAtLeisure = 1;
  }
  return 0;
}

//----- (004E6450) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarMelee::CreateFirstSubTask(CTaskComplexDestroyCarMelee *this, CPed *pPed)
{
  CVehicle *m_pTargetVehicle; // r9
  CSimpleTransform *p_m_transform; // r4
  float *p_x; // r6
  CSimpleTransform *v7; // r2
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v10; // d16
  CMatrix *v11; // r0
  float x; // s16
  float y; // s18
  float v14; // r1
  float v15; // r0
  float v16; // s20
  CMatrix *v17; // r0
  CMatrix *v18; // r1
  int v19; // r1
  float RadianAngleBetweenPoints; // r0

  this->m_bNewTarget = 0;
  CWeaponInfo::GetWeaponInfo(pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType, 1);
  m_pTargetVehicle = this->m_pTargetVehicle;
  p_m_transform = &pPed->m_transform;
  p_x = &m_pTargetVehicle->m_transform.m_translate.x;
  v7 = &pPed->m_transform;
  m_pMat = m_pTargetVehicle->m_pMat;
  p_tx = &m_pTargetVehicle->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v10 = *(_QWORD *)&p_tx->m_translate.x;
  this->m_vecTargetPos.z = p_tx->m_translate.z;
  *(_QWORD *)&this->m_vecTargetPos.x = v10;
  v11 = pPed->m_pMat;
  x = this->m_vecTargetPos.x;
  y = this->m_vecTargetPos.y;
  if ( v11 )
    v7 = (CSimpleTransform *)&v11->tx;
  v14 = v7->m_translate.y - y;
  v15 = v7->m_translate.x - x;
  v16 = CModelInfo::ms_modelInfoPtrs[m_pTargetVehicle->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius + 0.35;
  this->m_fAttackRange = v16;
  this->m_fArriveRange = v16;
  this->m_fAttackAngle = atan2f(v15, COERCE_FLOAT(LODWORD(v14) ^ 0x80000000));
  v17 = pPed->m_pMat;
  v18 = m_pTargetVehicle->m_pMat;
  if ( v17 )
    p_m_transform = (CSimpleTransform *)&v17->tx;
  if ( v18 )
    p_x = &v18->tx;
  if ( (float)((float)((float)((float)(*p_x - p_m_transform->m_translate.x)
                             * (float)(*p_x - p_m_transform->m_translate.x))
                     + (float)((float)(p_x[1] - p_m_transform->m_translate.y)
                             * (float)(p_x[1] - p_m_transform->m_translate.y)))
             + (float)((float)(p_x[2] - p_m_transform->m_translate.z) * (float)(p_x[2] - p_m_transform->m_translate.z))) <= (float)(v16 * v16) )
  {
    RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(
                                 x,
                                 y,
                                 p_m_transform->m_translate.x,
                                 p_m_transform->m_translate.y);
    v19 = 1019;
    pPed->m_fDesiredHeading = RadianAngleBetweenPoints;
  }
  else
  {
    v19 = 202;
    if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
      v19 = 907;
  }
  return CTaskComplexDestroyCarMelee::CreateSubTask(this, v19, pPed);
}

//----- (004E65A0) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarMelee::CalculateSearchPositionAndRanges(
        CTaskComplexDestroyCarMelee *this,
        CPed *pPed)
{
  CVehicle *m_pTargetVehicle; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  __int64 v6; // d16
  CMatrix *v7; // r2
  CSimpleTransform *p_m_transform; // r3
  float v9; // r2
  CBaseModelInfo *v10; // r1
  float v11; // r0
  float v12; // s0

  m_pTargetVehicle = this->m_pTargetVehicle;
  m_pMat = m_pTargetVehicle->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pTargetVehicle->m_transform;
  v6 = *(_QWORD *)&p_tx->m_translate.x;
  this->m_vecTargetPos.z = p_tx->m_translate.z;
  *(_QWORD *)&this->m_vecTargetPos.x = v6;
  v7 = pPed->m_pMat;
  p_m_transform = (CSimpleTransform *)&v7->tx;
  if ( !v7 )
    p_m_transform = &pPed->m_transform;
  v9 = p_m_transform->m_translate.y - this->m_vecTargetPos.y;
  v10 = CModelInfo::ms_modelInfoPtrs[m_pTargetVehicle->m_nModelIndex];
  v11 = p_m_transform->m_translate.x - this->m_vecTargetPos.x;
  v12 = v10->m_pColModel->m_sphereBound.m_fRadius + 0.35;
  this->m_fAttackRange = v12;
  this->m_fArriveRange = v12;
  this->m_fAttackAngle = atan2f(v11, COERCE_FLOAT(LODWORD(v9) ^ 0x80000000));
}

//----- (004E6630) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarMelee::CreateSubTask(
        CTaskComplexDestroyCarMelee *this,
        int iSubTaskType,
        CPed *pPed)
{
  unsigned __int8 *v5; // r4
  CTaskSimple *v6; // r0
  CVehicle *v7; // r6
  __int64 v8; // r8
  CVehicle *m_pTargetVehicle; // r5
  int v10; // r1
  CTaskSimpleStandStill *v11; // r0
  CTaskSimpleStandStill v13; // [sp+10h] [bp-38h] BYREF

  v5 = 0;
  if ( iSubTaskType <= 906 )
  {
    if ( iSubTaskType == 202 )
    {
      CTaskSimpleStandStill::CTaskSimpleStandStill(&v13, 0, 0, 0, 8.0);
      CTaskSimpleStandStill::ProcessPed(v11, pPed);
      CTaskSimpleStandStill::~CTaskSimpleStandStill(&v13);
      if ( this->m_pauseTimer == -1 )
        this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
      v5 = (unsigned __int8 *)CTask::operator new(0x18u);
      CTaskSimple::CTaskSimple((CTaskSimple *)v5);
      *((_WORD *)v5 + 8) = 0;
      *((_DWORD *)v5 + 5) = 100;
      *((_DWORD *)v5 + 2) = 0;
      *((_DWORD *)v5 + 3) = 0;
      *(_DWORD *)v5 = &off_665750;
    }
    else if ( iSubTaskType == 903 )
    {
      this->m_pauseTimer = -1;
      v5 = (unsigned __int8 *)CTask::operator new(0x28u);
      CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(
        (CTaskComplexGoToPointAndStandStill *)v5,
        6,
        &this->m_vecTargetPos,
        0.25,
        0.5,
        0,
        0);
    }
  }
  else
  {
    switch ( iSubTaskType )
    {
      case 907:
        this->m_pauseTimer = -1;
        v5 = (unsigned __int8 *)CTask::operator new(0x4Cu);
        m_pTargetVehicle = this->m_pTargetVehicle;
        CTaskComplex::CTaskComplex((CTaskComplex *)v5);
        *((_QWORD *)v5 + 3) = 0x400000003F800000LL;
        *((_QWORD *)v5 + 4) = 0x4000000000000000LL;
        *(_DWORD *)v5 = &off_6656D4;
        *((_DWORD *)v5 + 4) = 50000;
        *((_DWORD *)v5 + 5) = 1000;
        *((_WORD *)v5 + 24) = 0;
        *((_WORD *)v5 + 30) = 0;
        *((_DWORD *)v5 + 10) = 0;
        *((_DWORD *)v5 + 11) = 0;
        *((_DWORD *)v5 + 13) = 0;
        *((_DWORD *)v5 + 14) = 0;
        v10 = v5[72];
        *((_DWORD *)v5 + 16) = &off_665710;
        *((_DWORD *)v5 + 17) = 6;
        v5[72] = v10 & 0xF0 | 3;
        *((_DWORD *)v5 + 3) = m_pTargetVehicle;
        if ( m_pTargetVehicle )
          CEntity::RegisterReference(m_pTargetVehicle, (CEntity **)v5 + 3);
        break;
      case 1302:
        v5 = 0;
        this->m_pauseTimer = -1;
        break;
      case 1019:
        this->m_pauseTimer = -1;
        v6 = (CTaskSimple *)CTask::operator new(0x24u);
        v7 = this->m_pTargetVehicle;
        v5 = (unsigned __int8 *)v6;
        v8 = *(_QWORD *)&this->m_fAttackRange;
        CTaskSimple::CTaskSimple(v6);
        v5[8] = 0;
        *(_DWORD *)v5 = &off_669630;
        *((_WORD *)v5 + 5) = 0;
        *((_DWORD *)v5 + 3) = v7;
        if ( v7 )
          CEntity::RegisterReference(v7, (CEntity **)v5 + 3);
        *((_DWORD *)v5 + 4) = HIDWORD(v8);
        *((_DWORD *)v5 + 5) = v8;
        *((_DWORD *)v5 + 6) = 1065353216;
        *((_DWORD *)v5 + 7) = 0;
        *((_DWORD *)v5 + 8) = 0;
        break;
    }
  }
  return (CTask *)v5;
}
// 4E678A: variable 'v11' is possibly undefined
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669630: using guessed type void *off_669630;

//----- (004E6800) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarMelee::CreateNextSubTask(CTaskComplexDestroyCarMelee *this, CPed *pPed)
{
  unsigned __int8 *v4; // r5
  int v6; // r0
  CVehicle *v7; // r8
  CSimpleTransform *v8; // r5
  CSimpleTransform *v9; // r9
  CSimpleTransform *v10; // r2
  CMatrix *v11; // r0
  CSimpleTransform *v12; // r1
  __int64 v13; // d16
  CMatrix *v14; // r0
  float v15; // r1
  float v16; // r0
  float m_fRadius; // s2
  float v18; // s4
  CMatrix *v19; // r0
  CMatrix *v20; // r1
  float32x2_t v21; // d16
  unsigned __int64 v22; // d1
  CVehicle *v23; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v26; // d16
  CMatrix *v27; // r1
  CSimpleTransform *p_m_transform; // r2
  float v29; // s0
  float v30; // r2
  CBaseModelInfo *v31; // r1
  float v32; // r0
  float v33; // s0
  CVehicle *v34; // r4
  int v35; // r1
  CTaskSimple *v36; // r0
  CVehicle *m_pTargetVehicle; // r6
  __int64 v38; // r8
  int32 m_pauseTimer; // r0
  CTaskSimpleStandStill *v40; // r0
  CTaskSimpleStandStill *v41; // r0
  CTaskSimpleStandStill v42; // [sp+8h] [bp-40h] BYREF

  if ( this->m_bAbortAtLeisure )
    return 0;
  v6 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  v4 = 0;
  if ( v6 > 906 )
  {
    if ( v6 == 907 )
    {
LABEL_27:
      this->m_pauseTimer = -1;
      v36 = (CTaskSimple *)CTask::operator new(0x24u);
      m_pTargetVehicle = this->m_pTargetVehicle;
      v4 = (unsigned __int8 *)v36;
      v38 = *(_QWORD *)&this->m_fAttackRange;
      CTaskSimple::CTaskSimple(v36);
      v4[8] = 0;
      *(_DWORD *)v4 = &off_669630;
      *((_WORD *)v4 + 5) = 0;
      *((_DWORD *)v4 + 3) = m_pTargetVehicle;
      if ( m_pTargetVehicle )
        CEntity::RegisterReference(m_pTargetVehicle, (CEntity **)v4 + 3);
      *((_DWORD *)v4 + 4) = HIDWORD(v38);
      *((_DWORD *)v4 + 5) = v38;
      *((_DWORD *)v4 + 6) = 1065353216;
      *((_DWORD *)v4 + 7) = 0;
      *((_DWORD *)v4 + 8) = 0;
      return (CTask *)v4;
    }
    if ( v6 != 1019 )
      return (CTask *)v4;
    goto LABEL_19;
  }
  if ( v6 == 202 )
  {
LABEL_19:
    if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
    {
      v23 = this->m_pTargetVehicle;
      m_pMat = v23->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v23->m_transform;
      v26 = *(_QWORD *)&p_tx->m_translate.x;
      this->m_vecTargetPos.z = p_tx->m_translate.z;
      *(_QWORD *)&this->m_vecTargetPos.x = v26;
      v27 = pPed->m_pMat;
      p_m_transform = (CSimpleTransform *)&v27->tx;
      if ( !v27 )
        p_m_transform = &pPed->m_transform;
      v29 = p_m_transform->m_translate.x - this->m_vecTargetPos.x;
      v30 = p_m_transform->m_translate.y - this->m_vecTargetPos.y;
      v31 = CModelInfo::ms_modelInfoPtrs[v23->m_nModelIndex];
      v32 = v29;
      v33 = v31->m_pColModel->m_sphereBound.m_fRadius + 0.35;
      this->m_fAttackRange = v33;
      this->m_fArriveRange = v33;
      this->m_fAttackAngle = atan2f(v32, COERCE_FLOAT(LODWORD(v30) ^ 0x80000000));
      this->m_pauseTimer = -1;
      v4 = (unsigned __int8 *)CTask::operator new(0x4Cu);
      v34 = this->m_pTargetVehicle;
      CTaskComplex::CTaskComplex((CTaskComplex *)v4);
      goto LABEL_25;
    }
    m_pauseTimer = this->m_pauseTimer;
    if ( m_pauseTimer != -1 && CTimer::m_snTimeInMilliseconds - m_pauseTimer >= 0xBB9 )
    {
      v4 = 0;
      this->m_pauseTimer = -1;
      return (CTask *)v4;
    }
    CTaskSimpleStandStill::CTaskSimpleStandStill(&v42, 0, 0, 0, 8.0);
    CTaskSimpleStandStill::ProcessPed(v40, pPed);
    CTaskSimpleStandStill::~CTaskSimpleStandStill(&v42);
    if ( this->m_pauseTimer == -1 )
      this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
LABEL_40:
    v4 = (unsigned __int8 *)CTask::operator new(0x18u);
    CTaskSimple::CTaskSimple((CTaskSimple *)v4);
    *((_WORD *)v4 + 8) = 0;
    *((_DWORD *)v4 + 5) = 100;
    *((_DWORD *)v4 + 2) = 0;
    *((_DWORD *)v4 + 3) = 0;
    *(_DWORD *)v4 = &off_665750;
    return (CTask *)v4;
  }
  if ( v6 != 903 )
    return (CTask *)v4;
  v7 = this->m_pTargetVehicle;
  v8 = &pPed->m_transform;
  v9 = &v7->m_transform;
  v10 = &pPed->m_transform;
  v11 = v7->m_pMat;
  v12 = &v7->m_transform;
  if ( v11 )
    v12 = (CSimpleTransform *)&v11->tx;
  v13 = *(_QWORD *)&v12->m_translate.x;
  this->m_vecTargetPos.z = v12->m_translate.z;
  *(_QWORD *)&this->m_vecTargetPos.x = v13;
  v14 = pPed->m_pMat;
  if ( v14 )
    v10 = (CSimpleTransform *)&v14->tx;
  v15 = v10->m_translate.y - this->m_vecTargetPos.y;
  v16 = v10->m_translate.x - this->m_vecTargetPos.x;
  m_fRadius = CModelInfo::ms_modelInfoPtrs[v7->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
  this->m_fAttackRange = m_fRadius + 0.35;
  this->m_fArriveRange = m_fRadius + 0.35;
  this->m_fAttackAngle = atan2f(v16, COERCE_FLOAT(LODWORD(v15) ^ 0x80000000));
  v18 = (float)(m_fRadius + 0.35) * (float)(m_fRadius + 0.35);
  v19 = pPed->m_pMat;
  v20 = v7->m_pMat;
  if ( v19 )
    v8 = (CSimpleTransform *)&v19->tx;
  if ( v20 )
    v9 = (CSimpleTransform *)&v20->tx;
  v21.n64_u64[0] = vsub_f32(*(float32x2_t *)&v9->m_translate.y, *(float32x2_t *)&v8->m_translate.y).n64_u64[0];
  v22 = vmul_f32(v21, v21).n64_u64[0];
  if ( (float)((float)((float)((float)(v9->m_translate.x - v8->m_translate.x)
                             * (float)(v9->m_translate.x - v8->m_translate.x))
                     + *(float *)&v22)
             + *((float *)&v22 + 1)) < v18 )
    goto LABEL_27;
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
  {
    CTaskSimpleStandStill::CTaskSimpleStandStill(&v42, 0, 0, 0, 8.0);
    CTaskSimpleStandStill::ProcessPed(v41, pPed);
    CTaskSimpleStandStill::~CTaskSimpleStandStill(&v42);
    if ( this->m_pauseTimer == -1 )
      this->m_pauseTimer = CTimer::m_snTimeInMilliseconds;
    goto LABEL_40;
  }
  this->m_pauseTimer = -1;
  v4 = (unsigned __int8 *)CTask::operator new(0x4Cu);
  v34 = this->m_pTargetVehicle;
  CTaskComplex::CTaskComplex((CTaskComplex *)v4);
LABEL_25:
  *((_QWORD *)v4 + 3) = 0x400000003F800000LL;
  *((_QWORD *)v4 + 4) = 0x4000000000000000LL;
  *(_DWORD *)v4 = &off_6656D4;
  *((_DWORD *)v4 + 4) = 50000;
  *((_DWORD *)v4 + 5) = 1000;
  *((_WORD *)v4 + 24) = 0;
  *((_WORD *)v4 + 30) = 0;
  *((_DWORD *)v4 + 10) = 0;
  *((_DWORD *)v4 + 11) = 0;
  *((_DWORD *)v4 + 13) = 0;
  *((_DWORD *)v4 + 14) = 0;
  v35 = v4[72];
  *((_DWORD *)v4 + 16) = &off_665710;
  *((_DWORD *)v4 + 17) = 6;
  v4[72] = v35 & 0xF0 | 3;
  *((_DWORD *)v4 + 3) = v34;
  if ( v34 )
    CEntity::RegisterReference(v34, (CEntity **)v4 + 3);
  return (CTask *)v4;
}
// 4E6AC8: variable 'v40' is possibly undefined
// 4E6B34: variable 'v41' is possibly undefined
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669630: using guessed type void *off_669630;

//----- (004E6BD0) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarMelee::ControlSubTask(CTaskComplexDestroyCarMelee *this, CPed *pPed)
{
  unsigned __int8 *m_pSubTask; // r8
  int v6; // r0
  bool v7; // zf
  CVehicle *v8; // r9
  CSimpleTransform *v9; // r4
  CSimpleTransform *v10; // r10
  CSimpleTransform *v11; // r2
  CMatrix *v12; // r0
  CSimpleTransform *v13; // r1
  __int64 v14; // d16
  CMatrix *v15; // r0
  float v16; // r1
  float v17; // r0
  float v18; // s16
  float v19; // r0
  CMatrix *v20; // r1
  CMatrix *v21; // r2
  float32x2_t v22; // d16
  unsigned __int64 v23; // d1
  CVehicle *v24; // r5
  int v25; // r1
  CVehicle *m_pTargetVehicle; // r9
  CSimpleTransform *p_m_transform; // r4
  CSimpleTransform *v28; // r10
  CSimpleTransform *v29; // r2
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v32; // d16
  CMatrix *v33; // r0
  float v34; // r1
  float v35; // r0
  float m_fRadius; // s2
  float v37; // s4
  CMatrix *v38; // r0
  CMatrix *v39; // r1
  float32x2_t v40; // d16
  unsigned __int64 v41; // d1
  CTaskSimple *v42; // r0
  CVehicle *v43; // r6
  __int64 v44; // kr00_8
  float v45; // s0
  CTask *v46; // r0

  if ( this->m_bNewTarget )
    return (CTask *)(*((int (__fastcall **)(CTaskComplexDestroyCarMelee *, CPed *))this->_vptr$CTask + 11))(this, pPed);
  if ( this->m_pTargetVehicle->m_nHealth <= 0.0 )
    return 0;
  m_pSubTask = (unsigned __int8 *)this->m_pSubTask;
  v6 = (*(int (__fastcall **)(unsigned __int8 *))(*(_DWORD *)m_pSubTask + 20))(m_pSubTask);
  v7 = v6 == 903;
  if ( v6 != 903 )
    v7 = v6 == 907;
  if ( v7 )
  {
    m_pTargetVehicle = this->m_pTargetVehicle;
    p_m_transform = &pPed->m_transform;
    v28 = &m_pTargetVehicle->m_transform;
    v29 = &pPed->m_transform;
    m_pMat = m_pTargetVehicle->m_pMat;
    p_tx = &m_pTargetVehicle->m_transform;
    if ( m_pMat )
      p_tx = (CSimpleTransform *)&m_pMat->tx;
    v32 = *(_QWORD *)&p_tx->m_translate.x;
    this->m_vecTargetPos.z = p_tx->m_translate.z;
    *(_QWORD *)&this->m_vecTargetPos.x = v32;
    v33 = pPed->m_pMat;
    if ( v33 )
      v29 = (CSimpleTransform *)&v33->tx;
    v34 = v29->m_translate.y - this->m_vecTargetPos.y;
    v35 = v29->m_translate.x - this->m_vecTargetPos.x;
    m_fRadius = CModelInfo::ms_modelInfoPtrs[m_pTargetVehicle->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
    this->m_fAttackRange = m_fRadius + 0.35;
    this->m_fArriveRange = m_fRadius + 0.35;
    this->m_fAttackAngle = atan2f(v35, COERCE_FLOAT(LODWORD(v34) ^ 0x80000000));
    v37 = (float)(m_fRadius + 0.35) * (float)(m_fRadius + 0.35);
    v38 = pPed->m_pMat;
    v39 = m_pTargetVehicle->m_pMat;
    if ( v38 )
      p_m_transform = (CSimpleTransform *)&v38->tx;
    if ( v39 )
      v28 = (CSimpleTransform *)&v39->tx;
    v40.n64_u64[0] = vsub_f32(*(float32x2_t *)&v28->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
    v41 = vmul_f32(v40, v40).n64_u64[0];
    if ( (float)((float)((float)((float)(v28->m_translate.x - p_m_transform->m_translate.x)
                               * (float)(v28->m_translate.x - p_m_transform->m_translate.x))
                       + *(float *)&v41)
               + *((float *)&v41 + 1)) < v37 )
    {
      this->m_pauseTimer = -1;
      v42 = (CTaskSimple *)CTask::operator new(0x24u);
      v43 = this->m_pTargetVehicle;
      m_pSubTask = (unsigned __int8 *)v42;
      v44 = *(_QWORD *)&this->m_fAttackRange;
      CTaskSimple::CTaskSimple(v42);
      m_pSubTask[8] = 0;
      *(_DWORD *)m_pSubTask = &off_669630;
      *((_WORD *)m_pSubTask + 5) = 0;
      *((_DWORD *)m_pSubTask + 3) = v43;
      if ( v43 )
        CEntity::RegisterReference(v43, (CEntity **)m_pSubTask + 3);
      *((_DWORD *)m_pSubTask + 4) = HIDWORD(v44);
      *((_DWORD *)m_pSubTask + 5) = v44;
      *((_DWORD *)m_pSubTask + 6) = 1065353216;
      *((_DWORD *)m_pSubTask + 7) = 0;
      *((_DWORD *)m_pSubTask + 8) = 0;
    }
  }
  else if ( v6 == 1019 )
  {
    v8 = this->m_pTargetVehicle;
    v9 = &pPed->m_transform;
    v10 = &v8->m_transform;
    v11 = &pPed->m_transform;
    v12 = v8->m_pMat;
    v13 = &v8->m_transform;
    if ( v12 )
      v13 = (CSimpleTransform *)&v12->tx;
    v14 = *(_QWORD *)&v13->m_translate.x;
    this->m_vecTargetPos.z = v13->m_translate.z;
    *(_QWORD *)&this->m_vecTargetPos.x = v14;
    v15 = pPed->m_pMat;
    if ( v15 )
      v11 = (CSimpleTransform *)&v15->tx;
    v16 = v11->m_translate.y - this->m_vecTargetPos.y;
    v17 = v11->m_translate.x - this->m_vecTargetPos.x;
    v18 = CModelInfo::ms_modelInfoPtrs[v8->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius + 0.35;
    this->m_fAttackRange = v18;
    this->m_fArriveRange = v18;
    v19 = atan2f(v17, COERCE_FLOAT(LODWORD(v16) ^ 0x80000000));
    this->m_fAttackAngle = v19;
    v20 = pPed->m_pMat;
    v21 = v8->m_pMat;
    if ( v20 )
      v9 = (CSimpleTransform *)&v20->tx;
    if ( v21 )
      v10 = (CSimpleTransform *)&v21->tx;
    v22.n64_u64[0] = vsub_f32(*(float32x2_t *)&v10->m_translate.y, *(float32x2_t *)&v9->m_translate.y).n64_u64[0];
    v23 = vmul_f32(v22, v22).n64_u64[0];
    if ( sqrtf(
           (float)((float)((float)(v10->m_translate.x - v9->m_translate.x)
                         * (float)(v10->m_translate.x - v9->m_translate.x))
                 + *(float *)&v23)
         + *((float *)&v23 + 1)) <= (float)(v18 + 0.6) )
    {
      v45 = v19;
      v46 = this->m_pSubTask;
      *(float *)&v46[2]._vptr$CTask = v45;
      *(float *)&v46[2].m_pParent = v18;
    }
    else
    {
      this->m_pauseTimer = -1;
      m_pSubTask = (unsigned __int8 *)CTask::operator new(0x4Cu);
      v24 = this->m_pTargetVehicle;
      CTaskComplex::CTaskComplex((CTaskComplex *)m_pSubTask);
      *((_QWORD *)m_pSubTask + 3) = 0x400000003F800000LL;
      *((_QWORD *)m_pSubTask + 4) = 0x4000000000000000LL;
      *(_DWORD *)m_pSubTask = &off_6656D4;
      *((_DWORD *)m_pSubTask + 4) = 50000;
      *((_DWORD *)m_pSubTask + 5) = 1000;
      *((_WORD *)m_pSubTask + 24) = 0;
      *((_WORD *)m_pSubTask + 30) = 0;
      *((_DWORD *)m_pSubTask + 10) = 0;
      *((_DWORD *)m_pSubTask + 11) = 0;
      *((_DWORD *)m_pSubTask + 13) = 0;
      *((_DWORD *)m_pSubTask + 14) = 0;
      v25 = m_pSubTask[72];
      *((_DWORD *)m_pSubTask + 16) = &off_665710;
      *((_DWORD *)m_pSubTask + 17) = 6;
      m_pSubTask[72] = v25 & 0xF0 | 3;
      *((_DWORD *)m_pSubTask + 3) = v24;
      if ( v24 )
        CEntity::RegisterReference(v24, (CEntity **)m_pSubTask + 3);
    }
  }
  return (CTask *)m_pSubTask;
}
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 669630: using guessed type void *off_669630;

//----- (004E6EFC) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarArmed::CTaskComplexDestroyCarArmed(
        CTaskComplexDestroyCarArmed *this,
        CVehicle *pTargetVehicle,
        uint32 nDuckingConditions,
        uint32 nTimeToDuck,
        uint32 nPercentageDuckChance)
{
  CTaskComplex::CTaskComplex(this);
  *(_QWORD *)((char *)&this->m_fArriveRange + 1) = 0LL;
  *(_QWORD *)((char *)&this->m_fDistanceToTarget + 1) = 0LL;
  *(_QWORD *)&this->m_vecToTarget.z = 0LL;
  *(_QWORD *)&this->m_nShootTimer = 0LL;
  *(_QWORD *)&this->m_vecTargetPos.y = 0LL;
  *(_QWORD *)&this->m_vecToTarget.x = 0LL;
  this->m_nAttackPointIndex = -1;
  this->m_nDuckingConditions = nDuckingConditions;
  this->m_nTimeToDuck = nTimeToDuck;
  *(_QWORD *)&this->m_vecAttackerPos.x = 0LL;
  *(_QWORD *)&this->m_vecAttackerPos.z = 0LL;
  this->m_nPercentageDuckChance = nPercentageDuckChance;
  this->_vptr$CTask = (int (**)(void))&off_6699DC;
  this->m_pTargetVehicle = pTargetVehicle;
  if ( pTargetVehicle )
    CEntity::RegisterReference(pTargetVehicle, &this->m_pTargetVehicle);
}
// 6699DC: using guessed type void *off_6699DC;

//----- (004E6F6C) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarArmed::~CTaskComplexDestroyCarArmed(CTaskComplexDestroyCarArmed *this)
{
  CVehicle *m_pTargetVehicle; // r0
  CEntity **p_m_pTargetVehicle; // r1

  p_m_pTargetVehicle = &this->m_pTargetVehicle;
  m_pTargetVehicle = this->m_pTargetVehicle;
  this->_vptr$CTask = (int (**)(void))&off_6699DC;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, p_m_pTargetVehicle);
  sub_18EDB4(this);
}
// 6699DC: using guessed type void *off_6699DC;

//----- (004E6F98) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarArmed::~CTaskComplexDestroyCarArmed(CTaskComplexDestroyCarArmed *this)
{
  CVehicle *m_pTargetVehicle; // r0
  CEntity **p_m_pTargetVehicle; // r1
  void *v4; // r0

  p_m_pTargetVehicle = &this->m_pTargetVehicle;
  m_pTargetVehicle = this->m_pTargetVehicle;
  this->_vptr$CTask = (int (**)(void))&off_6699DC;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, p_m_pTargetVehicle);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E6FC0: variable 'v4' is possibly undefined
// 6699DC: using guessed type void *off_6699DC;

//----- (004E6FC8) --------------------------------------------------------
bool __fastcall CTaskComplexDestroyCarArmed::MakeAbortable(
        CTaskComplexDestroyCarArmed *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  if ( (unsigned int)(iPriority - 1) <= 1 )
    return (*((int (__fastcall **)(CTask *, CPed *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
             this->m_pSubTask,
             pPed);
  else
    return 0;
}

//----- (004E6FF0) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarArmed::CreateNextSubTask(CTaskComplexDestroyCarArmed *this, CPed *pPed)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d3
  int v6; // r0
  unsigned __int8 *v7; // r6
  bool v8; // zf
  CTaskComplexDestroyCarArmed *v9; // r0
  int v10; // r1
  CMatrix *m_pMat; // r0
  CVehicle *m_pTargetVehicle; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v14; // d16
  CMatrix *v15; // r0
  CSimpleTransform *p_m_transform; // r2
  CMatrix *v17; // r0
  CVehicle *v18; // r1
  CSimpleTransform *v19; // r2
  __int64 v20; // d16
  CMatrix *v21; // r0
  float y; // s2
  RwReal v23; // s2
  float z; // s4
  RwReal v25; // s4
  eWeaponType v26; // r6
  int8 v27; // r0
  float m_fWeaponRange; // s2
  CVehicle *v29; // r4
  int v30; // r1
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  CVehicle *v35; // r1
  CMatrix *v36; // r2
  CMatrix *v37; // r3
  CSimpleTransform *v38; // r6
  CSimpleTransform *v39; // r2
  float m_fTargetRange; // s4
  float32x2_t v41; // d16
  unsigned __int64 v42; // d1

  if ( !this->m_pTargetVehicle )
    return 0;
  v6 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  v7 = 0;
  if ( v6 >= 1020 )
  {
    if ( (unsigned int)(v6 - 1020) <= 1 )
    {
      if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
      {
        m_pMat = pPed->m_pMat;
        m_pTargetVehicle = this->m_pTargetVehicle;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pPed->m_transform;
        v14 = *(_QWORD *)&p_tx->m_translate.x;
        this->m_vecAttackerPos.z = p_tx->m_translate.z;
        *(_QWORD *)&this->m_vecAttackerPos.x = v14;
        v15 = m_pTargetVehicle->m_pMat;
        p_m_transform = (CSimpleTransform *)&v15->tx;
        if ( !v15 )
          p_m_transform = &m_pTargetVehicle->m_transform;
        goto LABEL_22;
      }
      v7 = (unsigned __int8 *)CTask::operator new(0x18u);
      CTaskSimple::CTaskSimple((CTaskSimple *)v7);
      *((_WORD *)v7 + 8) = 0;
      *((_DWORD *)v7 + 5) = 100;
      *((_DWORD *)v7 + 2) = 0;
      *((_DWORD *)v7 + 3) = 0;
      *(_DWORD *)v7 = &off_665750;
    }
    return (CTask *)v7;
  }
  if ( v6 == 202 )
  {
    if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
    {
      m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
      WeaponSkill = CPed::GetWeaponSkill(pPed);
      WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
      v35 = this->m_pTargetVehicle;
      v36 = pPed->m_pMat;
      v37 = v35->m_pMat;
      v38 = (CSimpleTransform *)&v36->tx;
      if ( !v36 )
        v38 = &pPed->m_transform;
      v39 = (CSimpleTransform *)&v37->tx;
      if ( !v37 )
        v39 = &v35->m_transform;
      v10 = 202;
      m_fTargetRange = WeaponInfo->m_fTargetRange;
      v41.n64_u64[0] = vsub_f32(*(float32x2_t *)&v39->m_translate.y, *(float32x2_t *)&v38->m_translate.y).n64_u64[0];
      v9 = this;
      v42 = vmul_f32(v41, v41).n64_u64[0];
      if ( (float)((float)((float)((float)(v39->m_translate.x - v38->m_translate.x)
                                 * (float)(v39->m_translate.x - v38->m_translate.x))
                         + *(float *)&v42)
                 + *((float *)&v42 + 1)) < (float)(m_fTargetRange * m_fTargetRange) )
        v10 = 1020;
      return CTaskComplexDestroyCarArmed::CreateSubTask(v9, v10, pPed);
    }
    v17 = pPed->m_pMat;
    v18 = this->m_pTargetVehicle;
    v19 = (CSimpleTransform *)&v17->tx;
    if ( !v17 )
      v19 = &pPed->m_transform;
    v20 = *(_QWORD *)&v19->m_translate.x;
    this->m_vecAttackerPos.z = v19->m_translate.z;
    *(_QWORD *)&this->m_vecAttackerPos.x = v20;
    v21 = v18->m_pMat;
    p_m_transform = (CSimpleTransform *)&v21->tx;
    if ( !v21 )
      p_m_transform = &v18->m_transform;
LABEL_22:
    v2.n64_u32[0] = LODWORD(this->m_vecAttackerPos.x);
    y = this->m_vecAttackerPos.y;
    *(_QWORD *)&this->m_vecTargetPos.x = *(_QWORD *)&p_m_transform->m_translate.x;
    v2.n64_f32[0] = this->m_vecTargetPos.x - v2.n64_f32[0];
    v23 = this->m_vecTargetPos.y - y;
    z = this->m_vecAttackerPos.z;
    this->m_vecTargetPos.z = p_m_transform->m_translate.z;
    v25 = this->m_vecTargetPos.z - z;
    LODWORD(this->m_vecToTarget.x) = v2.n64_u32[0];
    this->m_vecToTarget.y = v23;
    this->m_vecToTarget.z = v25;
    this->m_fDistanceToTarget = sqrtf(
                                  (float)((float)(v2.n64_f32[0] * v2.n64_f32[0]) + (float)(v23 * v23))
                                + (float)(v25 * v25));
    v26 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    v27 = CPed::GetWeaponSkill(pPed);
    m_fWeaponRange = CWeaponInfo::GetWeaponInfo(v26, v27)->m_fWeaponRange;
    v3.n64_u32[0] = 1061997773;
    v2.n64_f32[0] = (float)(m_fWeaponRange * 0.5) * 0.9;
    LODWORD(this->m_fArriveRange) = vmax_f32(v2, v3).n64_u32[0];
    this->m_fAttackRange = (float)(m_fWeaponRange * 0.5) * 1.1;
    v7 = (unsigned __int8 *)CTask::operator new(0x4Cu);
    v29 = this->m_pTargetVehicle;
    CTaskComplex::CTaskComplex((CTaskComplex *)v7);
    *((_QWORD *)v7 + 3) = 0x400000003F800000LL;
    *((_QWORD *)v7 + 4) = 0x4000000000000000LL;
    *(_DWORD *)v7 = &off_6656D4;
    *((_DWORD *)v7 + 4) = 50000;
    *((_DWORD *)v7 + 5) = 1000;
    *((_WORD *)v7 + 24) = 0;
    *((_WORD *)v7 + 30) = 0;
    *((_DWORD *)v7 + 10) = 0;
    *((_DWORD *)v7 + 11) = 0;
    *((_DWORD *)v7 + 13) = 0;
    *((_DWORD *)v7 + 14) = 0;
    v30 = v7[72];
    *((_DWORD *)v7 + 16) = &off_665710;
    *((_DWORD *)v7 + 17) = 6;
    v7[72] = v30 & 0xF0 | 3;
    *((_DWORD *)v7 + 3) = v29;
    if ( v29 )
      CEntity::RegisterReference(v29, (CEntity **)v7 + 3);
    return (CTask *)v7;
  }
  v8 = v6 == 903;
  if ( v6 != 903 )
    v8 = v6 == 907;
  if ( !v8 )
    return (CTask *)v7;
  v9 = this;
  v10 = 1020;
  return CTaskComplexDestroyCarArmed::CreateSubTask(v9, v10, pPed);
}
// 4E71F0: variable 'v2' is possibly undefined
// 4E71F0: variable 'v3' is possibly undefined
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;

//----- (004E7350) --------------------------------------------------------
void __fastcall CTaskComplexDestroyCarArmed::CalculateSearchPositionAndRanges(
        CTaskComplexDestroyCarArmed *this,
        CPed *pPed)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d3
  CMatrix *m_pMat; // r0
  CVehicle *m_pTargetVehicle; // r2
  CSimpleTransform *p_tx; // r3
  __int64 v8; // d16
  CMatrix *v9; // r0
  CSimpleTransform *p_m_transform; // r3
  float y; // s2
  RwReal v12; // s2
  float z; // s4
  RwReal v14; // s4
  eWeaponType m_eWeaponType; // r5
  int8 WeaponSkill; // r0
  float v17; // s2

  m_pMat = pPed->m_pMat;
  m_pTargetVehicle = this->m_pTargetVehicle;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  v8 = *(_QWORD *)&p_tx->m_translate.x;
  this->m_vecAttackerPos.z = p_tx->m_translate.z;
  *(_QWORD *)&this->m_vecAttackerPos.x = v8;
  v9 = m_pTargetVehicle->m_pMat;
  p_m_transform = (CSimpleTransform *)&v9->tx;
  if ( !v9 )
    p_m_transform = &m_pTargetVehicle->m_transform;
  v2.n64_u32[0] = LODWORD(this->m_vecAttackerPos.x);
  y = this->m_vecAttackerPos.y;
  *(_QWORD *)&this->m_vecTargetPos.x = *(_QWORD *)&p_m_transform->m_translate.x;
  v2.n64_f32[0] = this->m_vecTargetPos.x - v2.n64_f32[0];
  v12 = this->m_vecTargetPos.y - y;
  z = this->m_vecAttackerPos.z;
  this->m_vecTargetPos.z = p_m_transform->m_translate.z;
  v14 = this->m_vecTargetPos.z - z;
  LODWORD(this->m_vecToTarget.x) = v2.n64_u32[0];
  this->m_vecToTarget.y = v12;
  this->m_vecToTarget.z = v14;
  this->m_fDistanceToTarget = sqrtf(
                                (float)((float)(v2.n64_f32[0] * v2.n64_f32[0]) + (float)(v12 * v12))
                              + (float)(v14 * v14));
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  v3.n64_u32[0] = 1061997773;
  v2.n64_f32[0] = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_fWeaponRange * 0.5;
  v17 = v2.n64_f32[0] * 1.1;
  v2.n64_f32[0] = v2.n64_f32[0] * 0.9;
  LODWORD(this->m_fArriveRange) = vmax_f32(v2, v3).n64_u32[0];
  this->m_fAttackRange = v17;
}
// 4E7412: variable 'v2' is possibly undefined
// 4E7412: variable 'v3' is possibly undefined

//----- (004E7430) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarArmed::CreateSubTask(
        CTaskComplexDestroyCarArmed *this,
        int iSubTaskType,
        CPed *pPed)
{
  void *v4; // r4
  eWeaponType m_eWeaponType; // r4
  int8 WeaponSkill; // r0
  CVehicle *v7; // r5
  CVehicle *m_pTargetVehicle; // r5
  char v9; // r3

  v4 = 0;
  if ( iSubTaskType <= 906 )
  {
    if ( iSubTaskType == 202 )
    {
      v4 = CTask::operator new(0x18u);
      CTaskSimple::CTaskSimple((CTaskSimple *)v4);
      *((_WORD *)v4 + 8) = 0;
      *((_DWORD *)v4 + 5) = 100;
      *((_DWORD *)v4 + 2) = 0;
      *((_DWORD *)v4 + 3) = 0;
      *(_DWORD *)v4 = &off_665750;
    }
    else if ( iSubTaskType == 903 )
    {
      v4 = CTask::operator new(0x28u);
      CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(
        (CTaskComplexGoToPointAndStandStill *)v4,
        6,
        &this->m_vecTargetPos,
        0.5,
        2.0,
        0,
        0);
    }
    return (CTask *)v4;
  }
  if ( iSubTaskType == 907 )
  {
    v4 = CTask::operator new(0x4Cu);
    m_pTargetVehicle = this->m_pTargetVehicle;
    CTaskComplex::CTaskComplex((CTaskComplex *)v4);
    *((_QWORD *)v4 + 3) = 0x400000003F800000LL;
    *((_QWORD *)v4 + 4) = 0x4000000000000000LL;
    *((_QWORD *)v4 + 2) = 0x3E80000C350LL;
    *((_WORD *)v4 + 24) = 0;
    *((_WORD *)v4 + 30) = 0;
    *((_DWORD *)v4 + 10) = 0;
    *((_DWORD *)v4 + 11) = 0;
    *((_DWORD *)v4 + 13) = 0;
    *((_DWORD *)v4 + 14) = 0;
    v9 = *((_BYTE *)v4 + 72);
    *(_DWORD *)v4 = &off_6656D4;
    *((_DWORD *)v4 + 16) = &off_665710;
    *((_DWORD *)v4 + 17) = 6;
    *((_BYTE *)v4 + 72) = v9 & 0xF0 | 3;
  }
  else
  {
    if ( iSubTaskType != 1020 )
      return (CTask *)v4;
    m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    WeaponSkill = CPed::GetWeaponSkill(pPed);
    if ( !(BYTE1(CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_nFlags) << 31) )
    {
      v4 = CTask::operator new(0x3Cu);
      v7 = this->m_pTargetVehicle;
      CTaskSimple::CTaskSimple((CTaskSimple *)v4);
      *((_QWORD *)v4 + 2) = 0LL;
      *((_QWORD *)v4 + 3) = 0LL;
      *((_BYTE *)v4 + 8) = 0;
      *((_DWORD *)v4 + 8) = 0;
      *((_DWORD *)v4 + 9) = 0;
      *(_DWORD *)v4 = &off_669698;
      *((_DWORD *)v4 + 3) = v7;
      if ( v7 )
        CEntity::RegisterReference(v7, (CEntity **)v4 + 3);
      *((_WORD *)v4 + 22) = 5;
      *((_BYTE *)v4 + 46) = 3;
      *((_DWORD *)v4 + 12) = 1065353216;
      *((_DWORD *)v4 + 13) = 0;
      *((_DWORD *)v4 + 10) = 5000;
      *((_BYTE *)v4 + 56) = 1;
      *((_BYTE *)v4 + 57) = 0;
      return (CTask *)v4;
    }
    v4 = CTask::operator new(0x1Cu);
    m_pTargetVehicle = this->m_pTargetVehicle;
    CTaskSimple::CTaskSimple((CTaskSimple *)v4);
    *((_DWORD *)v4 + 4) = 0;
    *((_DWORD *)v4 + 5) = 0;
    *((_DWORD *)v4 + 6) = 0;
    *((_WORD *)v4 + 4) = 0;
    *(_DWORD *)v4 = &off_669700;
  }
  *((_DWORD *)v4 + 3) = m_pTargetVehicle;
  if ( m_pTargetVehicle )
    CEntity::RegisterReference(m_pTargetVehicle, (CEntity **)v4 + 3);
  return (CTask *)v4;
}
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 665750: using guessed type void *off_665750;
// 669698: using guessed type void *off_669698;
// 669700: using guessed type void *off_669700;

//----- (004E760C) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarArmed::CreateFirstSubTask(CTaskComplexDestroyCarArmed *this, CPed *pPed)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d3
  eWeaponType m_eWeaponType; // r6
  int8 WeaponSkill; // r0
  CMatrix *m_pMat; // r0
  CVehicle *m_pTargetVehicle; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v11; // d16
  CMatrix *v12; // r0
  CSimpleTransform *p_m_transform; // r2
  RwReal z; // r0
  float y; // s2
  float v16; // s4
  RwReal v17; // s2
  RwReal v18; // s4
  eWeaponType v19; // r6
  int8 v20; // r0
  float v21; // s2
  float m_fDistanceToTarget; // s4
  float v23; // s0
  int v24; // r1
  float RadianAngleBetweenPoints; // r0

  if ( !this->m_pTargetVehicle )
    return 0;
  this->m_bNewTarget = 0;
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  m_pMat = pPed->m_pMat;
  m_pTargetVehicle = this->m_pTargetVehicle;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  v11 = *(_QWORD *)&p_tx->m_translate.x;
  this->m_vecAttackerPos.z = p_tx->m_translate.z;
  *(_QWORD *)&this->m_vecAttackerPos.x = v11;
  v12 = m_pTargetVehicle->m_pMat;
  p_m_transform = (CSimpleTransform *)&v12->tx;
  if ( !v12 )
    p_m_transform = &m_pTargetVehicle->m_transform;
  v2.n64_u32[0] = LODWORD(this->m_vecAttackerPos.x);
  z = p_m_transform->m_translate.z;
  y = this->m_vecAttackerPos.y;
  *(_QWORD *)&this->m_vecTargetPos.x = *(_QWORD *)&p_m_transform->m_translate.x;
  v16 = this->m_vecTargetPos.y;
  this->m_vecTargetPos.z = z;
  v17 = v16 - y;
  v2.n64_f32[0] = this->m_vecTargetPos.x - v2.n64_f32[0];
  v18 = this->m_vecTargetPos.z - this->m_vecAttackerPos.z;
  LODWORD(this->m_vecToTarget.x) = v2.n64_u32[0];
  this->m_vecToTarget.y = v17;
  this->m_vecToTarget.z = v18;
  this->m_fDistanceToTarget = sqrtf(
                                (float)((float)(v2.n64_f32[0] * v2.n64_f32[0]) + (float)(v17 * v17))
                              + (float)(v18 * v18));
  v19 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  v20 = CPed::GetWeaponSkill(pPed);
  v3.n64_u32[0] = 1061997773;
  v2.n64_f32[0] = CWeaponInfo::GetWeaponInfo(v19, v20)->m_fWeaponRange * 0.5;
  v21 = v2.n64_f32[0] * 1.1;
  v2.n64_f32[0] = v2.n64_f32[0] * 0.9;
  m_fDistanceToTarget = this->m_fDistanceToTarget;
  v23 = vmax_f32(v2, v3).n64_f32[0];
  this->m_fArriveRange = v23;
  this->m_fAttackRange = v21;
  if ( m_fDistanceToTarget <= v23 )
  {
    RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(
                                 this->m_vecTargetPos.x,
                                 this->m_vecTargetPos.y,
                                 this->m_vecAttackerPos.x,
                                 this->m_vecAttackerPos.y);
    v24 = 1020;
    pPed->m_fDesiredHeading = RadianAngleBetweenPoints;
  }
  else if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) != 0 )
  {
    v24 = 202;
  }
  else
  {
    v24 = 903;
    if ( !this->m_bUsingAttackPoint )
      v24 = 907;
  }
  return CTaskComplexDestroyCarArmed::CreateSubTask(this, v24, pPed);
}
// 4E76FE: variable 'v2' is possibly undefined
// 4E76FE: variable 'v3' is possibly undefined

//----- (004E7768) --------------------------------------------------------
CTask *__fastcall CTaskComplexDestroyCarArmed::ControlSubTask(CTaskComplexDestroyCarArmed *this, CPed *pPed)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d3
  CVehicle *m_pTargetVehicle; // r0
  CTask *m_pSubTask; // r6
  int v9; // r0
  CMatrix *v10; // r0
  CVehicle *v11; // r1
  CSimpleTransform *v12; // r2
  __int64 v13; // d16
  CMatrix *v14; // r0
  CSimpleTransform *v15; // r2
  float v16; // s2
  RwReal v17; // s2
  float v18; // s4
  RwReal v19; // s4
  eWeaponType v20; // r8
  int8 v21; // r0
  float v22; // s4
  float m_fDistanceToAttackPoint; // s2
  float v24; // s6
  float v25; // s0
  CMatrix *m_pMat; // r0
  CVehicle *v27; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v29; // d16
  CMatrix *v30; // r0
  CSimpleTransform *p_m_transform; // r2
  float y; // s2
  RwReal v33; // s2
  float z; // s4
  RwReal v35; // s4
  eWeaponType m_eWeaponType; // r8
  int8 WeaponSkill; // r0
  float v38; // s2
  float m_fDistanceToTarget; // s4

  m_pTargetVehicle = this->m_pTargetVehicle;
  if ( !m_pTargetVehicle )
    return 0;
  if ( this->m_bNewTarget )
    return (CTask *)(*((int (__fastcall **)(CTaskComplexDestroyCarArmed *, CPed *))this->_vptr$CTask + 11))(this, pPed);
  if ( m_pTargetVehicle->m_nHealth <= 0.0 )
    return 0;
  m_pSubTask = this->m_pSubTask;
  v9 = (*((int (__fastcall **)(CTask *))m_pSubTask->_vptr$CTask + 5))(m_pSubTask);
  if ( v9 == 907 )
  {
    m_pMat = pPed->m_pMat;
    v27 = this->m_pTargetVehicle;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    v29 = *(_QWORD *)&p_tx->m_translate.x;
    this->m_vecAttackerPos.z = p_tx->m_translate.z;
    *(_QWORD *)&this->m_vecAttackerPos.x = v29;
    v30 = v27->m_pMat;
    p_m_transform = (CSimpleTransform *)&v30->tx;
    if ( !v30 )
      p_m_transform = &v27->m_transform;
    v2.n64_u32[0] = LODWORD(this->m_vecAttackerPos.x);
    y = this->m_vecAttackerPos.y;
    *(_QWORD *)&this->m_vecTargetPos.x = *(_QWORD *)&p_m_transform->m_translate.x;
    v2.n64_f32[0] = this->m_vecTargetPos.x - v2.n64_f32[0];
    v33 = this->m_vecTargetPos.y - y;
    z = this->m_vecAttackerPos.z;
    this->m_vecTargetPos.z = p_m_transform->m_translate.z;
    v35 = this->m_vecTargetPos.z - z;
    LODWORD(this->m_vecToTarget.x) = v2.n64_u32[0];
    this->m_vecToTarget.y = v33;
    this->m_vecToTarget.z = v35;
    this->m_fDistanceToTarget = sqrtf(
                                  (float)((float)(v2.n64_f32[0] * v2.n64_f32[0]) + (float)(v33 * v33))
                                + (float)(v35 * v35));
    m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
    WeaponSkill = CPed::GetWeaponSkill(pPed);
    v3.n64_u32[0] = 1061997773;
    v2.n64_f32[0] = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill)->m_fWeaponRange * 0.5;
    v38 = v2.n64_f32[0] * 1.1;
    v2.n64_f32[0] = v2.n64_f32[0] * 0.9;
    m_fDistanceToTarget = this->m_fDistanceToTarget;
    LODWORD(this->m_fArriveRange) = vmax_f32(v2, v3).n64_u32[0];
    this->m_fAttackRange = v38;
    if ( m_fDistanceToTarget < v38 )
      goto LABEL_22;
    goto LABEL_21;
  }
  if ( v9 != 903 )
    return m_pSubTask;
  v10 = pPed->m_pMat;
  v11 = this->m_pTargetVehicle;
  v12 = (CSimpleTransform *)&v10->tx;
  if ( !v10 )
    v12 = &pPed->m_transform;
  v13 = *(_QWORD *)&v12->m_translate.x;
  this->m_vecAttackerPos.z = v12->m_translate.z;
  *(_QWORD *)&this->m_vecAttackerPos.x = v13;
  v14 = v11->m_pMat;
  v15 = (CSimpleTransform *)&v14->tx;
  if ( !v14 )
    v15 = &v11->m_transform;
  v2.n64_u32[0] = LODWORD(this->m_vecAttackerPos.x);
  v16 = this->m_vecAttackerPos.y;
  *(_QWORD *)&this->m_vecTargetPos.x = *(_QWORD *)&v15->m_translate.x;
  v2.n64_f32[0] = this->m_vecTargetPos.x - v2.n64_f32[0];
  v17 = this->m_vecTargetPos.y - v16;
  v18 = this->m_vecAttackerPos.z;
  this->m_vecTargetPos.z = v15->m_translate.z;
  v19 = this->m_vecTargetPos.z - v18;
  LODWORD(this->m_vecToTarget.x) = v2.n64_u32[0];
  this->m_vecToTarget.y = v17;
  this->m_vecToTarget.z = v19;
  this->m_fDistanceToTarget = sqrtf(
                                (float)((float)(v2.n64_f32[0] * v2.n64_f32[0]) + (float)(v17 * v17))
                              + (float)(v19 * v19));
  v20 = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  v21 = CPed::GetWeaponSkill(pPed);
  v3.n64_u32[0] = 1061997773;
  v2.n64_f32[0] = CWeaponInfo::GetWeaponInfo(v20, v21)->m_fWeaponRange * 0.5;
  v22 = v2.n64_f32[0] * 1.1;
  v2.n64_f32[0] = v2.n64_f32[0] * 0.9;
  m_fDistanceToAttackPoint = this->m_fDistanceToAttackPoint;
  LODWORD(v24) = vmax_f32(v2, v3).n64_u32[0];
  v25 = this->m_fDistanceToTarget;
  this->m_fArriveRange = v24;
  this->m_fAttackRange = v22;
  if ( v25 < v22 || v25 < m_fDistanceToAttackPoint )
    goto LABEL_22;
LABEL_21:
  if ( (*((_BYTE *)&pPed->m_nPedFlags + 2) & 0x20) == 0 )
    return m_pSubTask;
LABEL_22:
  CPed::SetMoveState(pPed, PEDMOVE_STILL);
  return CTaskComplexDestroyCarArmed::CreateSubTask(this, 1020, pPed);
}
// 4E7880: variable 'v2' is possibly undefined
// 4E7880: variable 'v3' is possibly undefined

//----- (004E79B4) --------------------------------------------------------
void __fastcall CTaskComplexRoadRage::CTaskComplexRoadRage(CTaskComplexRoadRage *this, CPed *pTargetPed)
{
  CTaskComplex::CTaskComplex(this);
  this->_vptr$CTask = (int (**)(void))&off_669A18;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
}
// 669A18: using guessed type void *;

//----- (004E79E4) --------------------------------------------------------
void __fastcall CTaskComplexRoadRage::~CTaskComplexRoadRage(CTaskComplexRoadRage *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669A18;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  sub_18EDB4(this);
}
// 669A18: using guessed type void *off_669A18;

//----- (004E7A10) --------------------------------------------------------
void __fastcall CTaskComplexRoadRage::~CTaskComplexRoadRage(CTaskComplexRoadRage *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  void *v4; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669A18;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E7A38: variable 'v4' is possibly undefined
// 669A18: using guessed type void *off_669A18;

//----- (004E7A40) --------------------------------------------------------
bool __fastcall CTaskComplexRoadRage::MakeAbortable(
        CTaskComplexRoadRage *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))this->m_pSubTask->CTaskComplex::_vptr$CTask
          + 7))(
           this->m_pSubTask,
           pPed,
           iPriority,
           pEvent);
}

//----- (004E7A4C) --------------------------------------------------------
CTask *__fastcall CTaskComplexRoadRage::CreateFirstSubTask(CTaskComplexRoadRage *this, CPed *pPed)
{
  CPed *m_pTargetPed; // r0
  bool v5; // zf
  bool v6; // zf
  CPed *v8; // r0
  eWeaponType v9; // r1
  eWeaponType v10; // r6
  int v11; // r0
  int v12; // r1

  m_pTargetPed = this->m_pTargetPed;
  v5 = m_pTargetPed == 0;
  if ( m_pTargetPed )
    v5 = pPed->m_pMyVehicle == 0;
  if ( v5 )
    return 0;
  v6 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
    v6 = m_pTargetPed->m_nPedType == 6;
  if ( v6 )
    return 0;
  if ( (unsigned int)(pPed->m_nPedType - 7) <= 9 )
  {
    CPed::GiveDelayedWeapon(pPed, WEAPONTYPE_PISTOL, 0x7D0u);
    v8 = pPed;
    v9 = WEAPONTYPE_PISTOL;
LABEL_17:
    CPed::SetCurrentWeapon(v8, v9);
    goto LABEL_18;
  }
  if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) <= 49 )
  {
    v10 = WEAPONTYPE_SHOVEL;
    v11 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0);
    if ( v11 < 67 )
      v10 = WEAPONTYPE_GOLFCLUB;
    if ( v11 < 34 )
      v10 = WEAPONTYPE_BASEBALLBAT;
    CPed::GiveDelayedWeapon(pPed, v10, 1u);
    v8 = pPed;
    v9 = v10;
    goto LABEL_17;
  }
LABEL_18:
  CInterestingEvents::Add(&g_InterestingEvents, ERoadRage, pPed);
  v12 = 704;
  if ( (*(_DWORD *)&this->m_pTargetPed->m_nPedFlags & 0x100) == 0 )
    v12 = 1000;
  return CTaskComplexRoadRage::CreateSubTask(this, v12, pPed);
}

//----- (004E7B4C) --------------------------------------------------------
CTask *__fastcall CTaskComplexRoadRage::CreateSubTask(const CTaskComplexRoadRage *this, int iSubTaskType, CPed *pPed)
{
  CPed *m_pTargetPed; // r0
  char *v6; // r4
  CPed *v7; // r5
  char v8; // r2
  char v9; // r0
  CVehicle *v10; // r0
  float m_fRadius; // s16
  CVehicle *m_pMyVehicle; // r5
  char v13; // r1
  CEntity **v14; // r1
  CPed *v15; // r5
  char v16; // r2
  CPed *v17; // r5
  char v18; // r2
  uint32 v19; // r1

  m_pTargetPed = this->m_pTargetPed;
  v6 = 0;
  if ( !m_pTargetPed )
    return (CTask *)v6;
  if ( iSubTaskType > 906 )
  {
    if ( iSubTaskType >= 1000 )
    {
      if ( iSubTaskType == 1003 )
      {
        if ( m_pTargetPed->m_pMyVehicle )
        {
          v6 = (char *)CTask::operator new(0x20u);
          m_pMyVehicle = this->m_pTargetPed->m_pMyVehicle;
          CTaskComplex::CTaskComplex((CTaskComplex *)v6);
          *(_DWORD *)v6 = &off_669964;
          *((_DWORD *)v6 + 5) = 0;
          *((_DWORD *)v6 + 6) = 0;
          *((_DWORD *)v6 + 7) = 0;
          *((_DWORD *)v6 + 4) = m_pMyVehicle;
          v14 = (CEntity **)(v6 + 16);
          if ( !m_pMyVehicle )
            return (CTask *)v6;
LABEL_23:
          CEntity::RegisterReference(m_pMyVehicle, v14);
          return (CTask *)v6;
        }
        v6 = (char *)CTask::operator new(0x38u);
        v17 = this->m_pTargetPed;
        CTaskComplex::CTaskComplex((CTaskComplex *)v6);
        *((_DWORD *)v6 + 5) = 0;
        *((_DWORD *)v6 + 6) = 0;
        *((_DWORD *)v6 + 7) = 0;
        v6[32] = 1;
        *((_DWORD *)v6 + 10) = -1;
        *((_WORD *)v6 + 26) = 0;
        *((_DWORD *)v6 + 12) = 0;
        v18 = v6[12];
        *((_DWORD *)v6 + 11) = 0;
        *(_DWORD *)v6 = &off_669840;
        v9 = v18 & 0x8B | 4;
        v6[12] = v9;
        *((_DWORD *)v6 + 4) = v17;
        if ( v17 )
        {
          CEntity::RegisterReference(v17, (CEntity **)v6 + 4);
          v9 = v6[12];
        }
      }
      else
      {
        if ( iSubTaskType != 1000 )
          return (CTask *)v6;
        v6 = (char *)CTask::operator new(0x38u);
        v7 = this->m_pTargetPed;
        CTaskComplex::CTaskComplex((CTaskComplex *)v6);
        *((_DWORD *)v6 + 5) = 0;
        *((_DWORD *)v6 + 6) = 0;
        *((_DWORD *)v6 + 7) = 0;
        v6[32] = 1;
        *((_DWORD *)v6 + 10) = -1;
        *((_WORD *)v6 + 26) = 0;
        *((_DWORD *)v6 + 12) = 0;
        v8 = v6[12];
        *((_DWORD *)v6 + 11) = 0;
        *(_DWORD *)v6 = &off_669840;
        v9 = v8 & 0x8B | 4;
        v6[12] = v9;
        *((_DWORD *)v6 + 4) = v7;
        if ( v7 )
        {
          CEntity::RegisterReference(v7, (CEntity **)v6 + 4);
          v9 = v6[12];
        }
      }
    }
    else
    {
      if ( iSubTaskType != 907 )
      {
        if ( iSubTaskType == 920 )
        {
          v6 = (char *)CTask::operator new(0x28u);
          CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(
            (CTaskComplexTurnToFaceEntityOrCoord *)v6,
            this->m_pTargetPed,
            0.5,
            0.2);
        }
        return (CTask *)v6;
      }
      v10 = m_pTargetPed->m_pMyVehicle;
      if ( v10 )
      {
        m_fRadius = CModelInfo::ms_modelInfoPtrs[v10->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius;
        v6 = (char *)CTask::operator new(0x4Cu);
        m_pMyVehicle = this->m_pTargetPed->m_pMyVehicle;
        CTaskComplex::CTaskComplex((CTaskComplex *)v6);
        *(_DWORD *)v6 = &off_6656D4;
        *((_DWORD *)v6 + 4) = 20000;
        *((_DWORD *)v6 + 5) = 1000;
        *((float *)v6 + 6) = m_fRadius + 1.0;
        *((_DWORD *)v6 + 7) = 0x40000000;
        *((_DWORD *)v6 + 8) = 0;
        *((_DWORD *)v6 + 9) = 0x40000000;
        *((_WORD *)v6 + 24) = 0;
        *((_WORD *)v6 + 30) = 0;
        *((_DWORD *)v6 + 10) = 0;
        *((_DWORD *)v6 + 11) = 0;
        *((_DWORD *)v6 + 13) = 0;
        *((_DWORD *)v6 + 14) = 0;
        v13 = v6[72];
        *((_DWORD *)v6 + 16) = &off_665710;
        *((_DWORD *)v6 + 17) = 6;
        v6[72] = v13 & 0xF0 | 3;
        *((_DWORD *)v6 + 3) = m_pMyVehicle;
        v14 = (CEntity **)(v6 + 12);
        if ( !m_pMyVehicle )
          return (CTask *)v6;
        goto LABEL_23;
      }
      v6 = (char *)CTask::operator new(0x38u);
      v15 = this->m_pTargetPed;
      CTaskComplex::CTaskComplex((CTaskComplex *)v6);
      *((_DWORD *)v6 + 5) = 0;
      *((_DWORD *)v6 + 6) = 0;
      *((_DWORD *)v6 + 7) = 0;
      v6[32] = 1;
      *((_DWORD *)v6 + 10) = -1;
      *((_WORD *)v6 + 26) = 0;
      *((_DWORD *)v6 + 12) = 0;
      v16 = v6[12];
      *((_DWORD *)v6 + 11) = 0;
      *(_DWORD *)v6 = &off_669840;
      v9 = v16 & 0x8B | 4;
      v6[12] = v9;
      *((_DWORD *)v6 + 4) = v15;
      if ( v15 )
      {
        CEntity::RegisterReference(v15, (CEntity **)v6 + 4);
        v9 = v6[12];
      }
    }
    v19 = CTimer::m_snTimeInMilliseconds;
    v6[12] = v9 & 0xF7;
    *((_DWORD *)v6 + 9) = v19;
    return (CTask *)v6;
  }
  switch ( iSubTaskType )
  {
    case 302:
      v6 = (char *)CTask::operator new(0x10u);
      CTaskSimpleShakeFist::CTaskSimpleShakeFist((CTaskSimpleShakeFist *)v6);
      break;
    case 701:
      v6 = (char *)CTask::operator new(0x50u);
      CTaskComplexEnterCarAsDriver::CTaskComplexEnterCarAsDriver((CTaskComplexEnterCarAsDriver *)v6, pPed->m_pMyVehicle);
      break;
    case 704:
      v6 = (char *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar((CTaskComplexLeaveCar *)v6, pPed->m_pMyVehicle, 0, 0, 1, 0);
      break;
  }
  return (CTask *)v6;
}
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;
// 669840: using guessed type void *off_669840;
// 669964: using guessed type void *off_669964;

//----- (004E7E38) --------------------------------------------------------
CTask *__fastcall CTaskComplexRoadRage::CreateNextSubTask(CTaskComplexRoadRage *this, CPed *pPed)
{
  int v4; // r0
  int v5; // r1
  bool v6; // zf
  CPed *m_pTargetPed; // r0
  bool v9; // zf
  CVehicle *m_pMyVehicle; // r0

  if ( !this->m_pTargetPed )
    return 0;
  v4 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  if ( v4 <= 906 )
  {
    if ( v4 == 302 )
    {
      v5 = 907;
      return CTaskComplexRoadRage::CreateSubTask(this, v5, pPed);
    }
    if ( v4 != 701 )
    {
      if ( v4 == 704 )
      {
        v5 = 1302;
        if ( !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
          v5 = 920;
        return CTaskComplexRoadRage::CreateSubTask(this, v5, pPed);
      }
      return 0;
    }
    m_pMyVehicle = pPed->m_pMyVehicle;
    if ( m_pMyVehicle )
    {
      m_pMyVehicle->AutoPilot.Mission = 1;
      pPed->m_pMyVehicle->AutoPilot.CruiseSpeed = 10;
    }
LABEL_25:
    v5 = 1302;
    return CTaskComplexRoadRage::CreateSubTask(this, v5, pPed);
  }
  if ( v4 >= 1000 )
  {
    v6 = v4 == 1003;
    if ( v4 != 1003 )
      v6 = v4 == 1000;
    if ( !v6 )
      return 0;
    goto LABEL_25;
  }
  if ( v4 == 907 )
  {
    m_pTargetPed = this->m_pTargetPed;
    v9 = *((unsigned __int8 *)&m_pTargetPed->m_nPedFlags + 1) << 31 == 0;
    if ( *((unsigned __int8 *)&m_pTargetPed->m_nPedFlags + 1) << 31 )
      v9 = m_pTargetPed->m_pMyVehicle == 0;
    if ( v9 || pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType == WEAPONTYPE_UNARMED )
      v5 = 1000;
    else
      v5 = 1003;
    return CTaskComplexRoadRage::CreateSubTask(this, v5, pPed);
  }
  if ( v4 != 920 )
    return 0;
  v5 = 302;
  return CTaskComplexRoadRage::CreateSubTask(this, v5, pPed);
}

//----- (004E7F08) --------------------------------------------------------
CTask *__fastcall CTaskComplexRoadRage::ControlSubTask(CTaskComplexRoadRage *this, CPed *pPed)
{
  void *m_pSubTask; // r4
  int v5; // r0
  CPed *v6; // r0
  CMatrix *v7; // r1
  CMatrix *v8; // r2
  CSimpleTransform *v9; // r3
  CSimpleTransform *v10; // r1
  float32x2_t v11; // d16
  unsigned __int64 v12; // d1
  CPed *m_pTargetPed; // r0
  CPed *v15; // r6
  char v16; // r1
  char v17; // r0
  uint32 v18; // r1
  CMatrix *m_pMat; // r1
  CMatrix *v20; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v23; // d16
  unsigned __int64 v24; // d1

  m_pSubTask = this->m_pSubTask;
  if ( this->m_pTargetPed )
  {
    v5 = (*(int (__fastcall **)(void *))(*(_DWORD *)m_pSubTask + 20))(m_pSubTask);
    if ( v5 == 1003 )
    {
      m_pTargetPed = this->m_pTargetPed;
      if ( *((unsigned __int8 *)&m_pTargetPed->m_nPedFlags + 1) << 31 )
      {
        if ( pPed->m_pMyVehicle )
        {
          m_pMat = pPed->m_pMat;
          v20 = m_pTargetPed->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &pPed->m_transform;
          p_m_transform = (CSimpleTransform *)&v20->tx;
          if ( !v20 )
            p_m_transform = &m_pTargetPed->m_transform;
          v23.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
          v24 = vmul_f32(v23, v23).n64_u64[0];
          if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                     * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                             + *(float *)&v24)
                     + *((float *)&v24 + 1)) > 400.0 )
          {
LABEL_25:
            m_pSubTask = CTask::operator new(0x50u);
            CTaskComplexEnterCarAsDriver::CTaskComplexEnterCarAsDriver(
              (CTaskComplexEnterCarAsDriver *)m_pSubTask,
              pPed->m_pMyVehicle);
          }
        }
      }
      else
      {
        if ( !m_pTargetPed )
          return 0;
        m_pSubTask = CTask::operator new(0x38u);
        v15 = this->m_pTargetPed;
        CTaskComplex::CTaskComplex((CTaskComplex *)m_pSubTask);
        *((_DWORD *)m_pSubTask + 5) = 0;
        *((_DWORD *)m_pSubTask + 6) = 0;
        *((_DWORD *)m_pSubTask + 7) = 0;
        *((_BYTE *)m_pSubTask + 32) = 1;
        *((_DWORD *)m_pSubTask + 10) = -1;
        *((_WORD *)m_pSubTask + 26) = 0;
        *((_DWORD *)m_pSubTask + 12) = 0;
        v16 = *((_BYTE *)m_pSubTask + 12);
        *((_DWORD *)m_pSubTask + 11) = 0;
        *(_DWORD *)m_pSubTask = &off_669840;
        v17 = v16 & 0x8B | 4;
        *((_BYTE *)m_pSubTask + 12) = v17;
        *((_DWORD *)m_pSubTask + 4) = v15;
        if ( v15 )
        {
          CEntity::RegisterReference(v15, (CEntity **)m_pSubTask + 4);
          v17 = *((_BYTE *)m_pSubTask + 12);
        }
        v18 = CTimer::m_snTimeInMilliseconds;
        *((_BYTE *)m_pSubTask + 12) = v17 & 0xF7;
        *((_DWORD *)m_pSubTask + 9) = v18;
      }
    }
    else if ( v5 == 1000 && pPed->m_pMyVehicle )
    {
      v6 = this->m_pTargetPed;
      v7 = pPed->m_pMat;
      v8 = v6->m_pMat;
      v9 = (CSimpleTransform *)&v7->tx;
      if ( !v7 )
        v9 = &pPed->m_transform;
      v10 = (CSimpleTransform *)&v8->tx;
      if ( !v8 )
        v10 = &v6->m_transform;
      v11.n64_u64[0] = vsub_f32(*(float32x2_t *)&v10->m_translate.y, *(float32x2_t *)&v9->m_translate.y).n64_u64[0];
      v12 = vmul_f32(v11, v11).n64_u64[0];
      if ( (float)((float)((float)((float)(v10->m_translate.x - v9->m_translate.x)
                                 * (float)(v10->m_translate.x - v9->m_translate.x))
                         + *(float *)&v12)
                 + *((float *)&v12 + 1)) > 400.0 )
      {
        if ( !v6 )
          return 0;
        goto LABEL_25;
      }
    }
  }
  else
  {
    (*(void (__fastcall **)(void *, CPed *, _DWORD, _DWORD))(*(_DWORD *)m_pSubTask + 28))(m_pSubTask, pPed, 0, 0);
  }
  return (CTask *)m_pSubTask;
}
// 669840: using guessed type void *off_669840;

//----- (004E808C) --------------------------------------------------------
void __fastcall CTaskComplexKillAllThreats::CTaskComplexKillAllThreats(
        CTaskComplexKillAllThreats *this,
        const uint32 nDuckingConditions,
        const uint32 nTimeToDuck,
        const uint32 nPercentageDuckChance)
{
  _DWORD *v7; // r0

  CTaskComplex::CTaskComplex(this);
  v7[3] = nDuckingConditions;
  v7[4] = nTimeToDuck;
  v7[5] = nPercentageDuckChance;
  *v7 = &off_669A54;
}
// 4E80A0: variable 'v7' is possibly undefined
// 669A54: using guessed type void *;

//----- (004E80BC) --------------------------------------------------------
void __fastcall CTaskComplexKillAllThreats::~CTaskComplexKillAllThreats(CTaskComplexKillAllThreats *this)
{
  void *v1; // r0

  CTaskComplex::~CTaskComplex(this);
  sub_197118(v1);
}
// 4E80C8: variable 'v1' is possibly undefined

//----- (004E80CC) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillAllThreats::CreateNextSubTask(CTaskComplexKillAllThreats *this, CPed *pPed)
{
  CTaskComplex *v4; // r4
  CPedIntelligence *m_pPedIntelligence; // r0
  CPed *v6; // r6
  CTaskComplex *v7; // r0
  __int64 v8; // kr00_8
  uint32 m_nPercentageDuckChance; // r5
  char v10; // r2
  char v11; // r1
  CPedAcquaintanceScanner v13; // [sp+10h] [bp-30h] BYREF
  int iAcquaintancePedScanType; // [sp+20h] [bp-20h] BYREF
  CPed *v15; // [sp+24h] [bp-1Ch] BYREF

  v4 = 0;
  if ( (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) == 1000 )
  {
    m_pPedIntelligence = pPed->m_pPedIntelligence;
    v15 = 0;
    memset(&v13, 0, 10);
    *(_WORD *)&v13.m_bActivatedEverywhere = 1;
    v13.m_bActivatedDuringScriptCommands = 0;
    CPedAcquaintanceScanner::FindClosestAcquaintance(
      &v13,
      pPed,
      4,
      m_pPedIntelligence->m_pedScanner.m_entities,
      16,
      &v15,
      &iAcquaintancePedScanType);
    v6 = v15;
    if ( v15 )
    {
      v7 = (CTaskComplex *)CTask::operator new(0x38u);
      v8 = *(_QWORD *)&this->m_nDuckingConditions;
      v4 = v7;
      m_nPercentageDuckChance = this->m_nPercentageDuckChance;
      CTaskComplex::CTaskComplex(v7);
      *(_QWORD *)&v4[1].m_pSubTask = v8;
      v4[2].m_pParent = (CTask *)m_nPercentageDuckChance;
      LOBYTE(v4[2].m_pSubTask) = 1;
      v4[3].m_pParent = (CTask *)-1;
      LOWORD(v4[4].m_pParent) = 0;
      v4[4]._vptr$CTask = 0;
      v10 = (char)v4[1]._vptr$CTask;
      v4[3].m_pSubTask = 0;
      v4->_vptr$CTask = (int (**)(void))&off_669840;
      LOBYTE(v4[1]._vptr$CTask) = v10 & 0x8B | 4;
      v4[1].m_pParent = (CTask *)v6;
      CEntity::RegisterReference(v6, (CEntity **)&v4[1].m_pParent);
      v11 = (char)v4[1]._vptr$CTask;
      v4[3]._vptr$CTask = (int (**)(void))CTimer::m_snTimeInMilliseconds;
      LOBYTE(v4[1]._vptr$CTask) = v11 & 0xF7;
    }
  }
  return v4;
}
// 669840: using guessed type void *off_669840;

//----- (004E8194) --------------------------------------------------------
CPed *__fastcall CTaskComplexKillAllThreats::GetNextThreatPed(const CTaskComplexKillAllThreats *this, CPed *ped)
{
  CPedIntelligence *m_pPedIntelligence; // r0
  CPedAcquaintanceScanner v4; // [sp+10h] [bp-20h] BYREF
  int v5; // [sp+20h] [bp-10h] BYREF
  CPed *v6; // [sp+24h] [bp-Ch] BYREF

  m_pPedIntelligence = ped->m_pPedIntelligence;
  v6 = 0;
  memset(&v4, 0, 10);
  *(_WORD *)&v4.m_bActivatedEverywhere = 1;
  v4.m_bActivatedDuringScriptCommands = 0;
  CPedAcquaintanceScanner::FindClosestAcquaintance(
    &v4,
    ped,
    4,
    m_pPedIntelligence->m_pedScanner.m_entities,
    16,
    &v6,
    &v5);
  return v6;
}

//----- (004E81D4) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillAllThreats::CreateFirstSubTask(CTaskComplexKillAllThreats *this, CPed *pPed)
{
  CPedIntelligence *m_pPedIntelligence; // r0
  CPed *v4; // r6
  CTaskComplex *v5; // r0
  __int64 v6; // r10
  char *v7; // r4
  uint32 m_nPercentageDuckChance; // r8
  char v9; // r1
  char v10; // r1
  CPedAcquaintanceScanner v12; // [sp+10h] [bp-38h] BYREF
  int iAcquaintancePedScanType; // [sp+24h] [bp-24h] BYREF
  CPed *v14; // [sp+28h] [bp-20h] BYREF

  m_pPedIntelligence = pPed->m_pPedIntelligence;
  v14 = 0;
  memset(&v12, 0, 10);
  *(_WORD *)&v12.m_bActivatedEverywhere = 1;
  v12.m_bActivatedDuringScriptCommands = 0;
  CPedAcquaintanceScanner::FindClosestAcquaintance(
    &v12,
    pPed,
    4,
    m_pPedIntelligence->m_pedScanner.m_entities,
    16,
    &v14,
    &iAcquaintancePedScanType);
  v4 = v14;
  if ( v14 )
  {
    v5 = (CTaskComplex *)CTask::operator new(0x38u);
    v6 = *(_QWORD *)&this->m_nDuckingConditions;
    v7 = (char *)v5;
    m_nPercentageDuckChance = this->m_nPercentageDuckChance;
    CTaskComplex::CTaskComplex(v5);
    *(_QWORD *)(v7 + 20) = v6;
    *((_DWORD *)v7 + 7) = m_nPercentageDuckChance;
    v7[32] = 1;
    *((_DWORD *)v7 + 10) = -1;
    *((_WORD *)v7 + 26) = 0;
    *((_DWORD *)v7 + 12) = 0;
    v9 = v7[12];
    *((_DWORD *)v7 + 11) = 0;
    *(_DWORD *)v7 = &off_669840;
    v7[12] = v9 & 0x8B | 4;
    *((_DWORD *)v7 + 4) = v4;
    CEntity::RegisterReference(v4, (CEntity **)v7 + 4);
    v10 = v7[12];
    *((_DWORD *)v7 + 9) = CTimer::m_snTimeInMilliseconds;
    v7[12] = v10 & 0xF7;
  }
  else
  {
    v7 = (char *)CTask::operator new(0x20u);
    CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v7, 0, 0, 0, 8.0);
  }
  return (CTask *)v7;
}
// 669840: using guessed type void *off_669840;

//----- (004E82A8) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillAllThreats::ControlSubTask(CTaskComplexKillAllThreats *this, CPed *pPed)
{
  return this->m_pSubTask;
}

//----- (004E82AC) --------------------------------------------------------
void __fastcall CTaskComplexKillPedGroupOnFoot::CTaskComplexKillPedGroupOnFoot(
        CTaskComplexKillPedGroupOnFoot *this,
        const int iGroupID,
        CPed *pStartPed)
{
  CTaskComplex::CTaskComplex(this);
  this->m_iGroupID = iGroupID;
  this->_vptr$CTask = (int (**)(void))&off_669A90;
  this->m_pCurrentPed = pStartPed;
  if ( pStartPed )
    CEntity::RegisterReference(pStartPed, &this->m_pCurrentPed);
}
// 669A90: using guessed type void *off_669A90;

//----- (004E82E8) --------------------------------------------------------
void __fastcall CTaskComplexKillPedGroupOnFoot::~CTaskComplexKillPedGroupOnFoot(CTaskComplexKillPedGroupOnFoot *this)
{
  CPed *m_pCurrentPed; // r0
  CEntity **p_m_pCurrentPed; // r1

  p_m_pCurrentPed = &this->m_pCurrentPed;
  m_pCurrentPed = this->m_pCurrentPed;
  this->_vptr$CTask = (int (**)(void))&off_669A90;
  if ( m_pCurrentPed )
    CEntity::CleanUpOldReference(m_pCurrentPed, p_m_pCurrentPed);
  sub_18EDB4(this);
}
// 669A90: using guessed type void *off_669A90;

//----- (004E8314) --------------------------------------------------------
void __fastcall CTaskComplexKillPedGroupOnFoot::~CTaskComplexKillPedGroupOnFoot(CTaskComplexKillPedGroupOnFoot *this)
{
  CPed *m_pCurrentPed; // r0
  CEntity **p_m_pCurrentPed; // r1
  void *v4; // r0

  p_m_pCurrentPed = &this->m_pCurrentPed;
  m_pCurrentPed = this->m_pCurrentPed;
  this->_vptr$CTask = (int (**)(void))&off_669A90;
  if ( m_pCurrentPed )
    CEntity::CleanUpOldReference(m_pCurrentPed, p_m_pCurrentPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E833C: variable 'v4' is possibly undefined
// 669A90: using guessed type void *;

//----- (004E8344) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedGroupOnFoot::CreateNextSubTask(CTaskComplexKillPedGroupOnFoot *this, CPed *pPed)
{
  CPed *m_pCurrentPed; // r0
  CEntity **p_m_pCurrentPed; // r5
  int v6; // r0
  CPed *v7; // r2
  bool v8; // zf
  int v9; // r1
  CPed *v10; // r0

  p_m_pCurrentPed = &this->m_pCurrentPed;
  m_pCurrentPed = this->m_pCurrentPed;
  if ( m_pCurrentPed )
  {
    CEntity::CleanUpOldReference(m_pCurrentPed, p_m_pCurrentPed);
    *p_m_pCurrentPed = 0;
  }
  v6 = (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask);
  v8 = v6 == 200;
  v9 = 1302;
  if ( v6 != 200 )
    v8 = v6 == 422;
  if ( !v8 )
  {
    if ( v6 != 1000 )
      return 0;
    v10 = CTaskComplexKillPedGroupOnFoot::ComputeNearestLivingGroupPed(this, pPed, 0);
    this->m_pCurrentPed = v10;
    if ( v10 )
    {
      CEntity::RegisterReference(v10, p_m_pCurrentPed);
      v9 = 1000;
    }
    else
    {
      v9 = 422;
    }
  }
  return CTaskComplexKillPedGroupOnFoot::CreateSubTask(this, v9, v7);
}
// 4E83B0: variable 'v7' is possibly undefined

//----- (004E83B4) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedGroupOnFoot::CreateSubTask(
        const CTaskComplexKillPedGroupOnFoot *this,
        const int iSubTaskType,
        CPed *pPed)
{
  void *v4; // r4
  CPed *m_pCurrentPed; // r5
  char v6; // r2
  char v7; // r0
  uint32 v8; // r1
  void **v9; // r0
  unsigned __int16 v10; // r0

  if ( iSubTaskType == 200 )
  {
    v4 = CTask::operator new(8u);
    CTaskSimple::CTaskSimple((CTaskSimple *)v4);
    v9 = &`vtable for'CTaskSimpleNone;
LABEL_9:
    *(_DWORD *)v4 = (char *)*v9 + 8;
    return (CTask *)v4;
  }
  if ( iSubTaskType == 422 )
  {
    v4 = CTask::operator new(0x34u);
    v10 = rand();
    CTaskSimpleRunTimedAnim::CTaskSimpleRunTimedAnim(
      (CTaskSimpleRunTimedAnim *)v4,
      ANIM_STD_PED,
      ANIM_STD_IDLE_HBHB,
      4.0,
      -4.0,
      (int)(float)((float)((float)v10 * 0.000015259) * 1000.0) + 3000,
      422,
      "LookAbout",
      0);
    v9 = &`vtable for'CTaskSimpleLookAbout;
    goto LABEL_9;
  }
  if ( iSubTaskType != 1000 )
    return 0;
  v4 = CTask::operator new(0x38u);
  m_pCurrentPed = this->m_pCurrentPed;
  CTaskComplex::CTaskComplex((CTaskComplex *)v4);
  *((_DWORD *)v4 + 5) = 0;
  *((_DWORD *)v4 + 6) = 0;
  *((_DWORD *)v4 + 7) = 0;
  *((_BYTE *)v4 + 32) = 1;
  *((_DWORD *)v4 + 10) = -1;
  *((_WORD *)v4 + 26) = 0;
  *((_DWORD *)v4 + 12) = 0;
  v6 = *((_BYTE *)v4 + 12);
  *((_DWORD *)v4 + 11) = 0;
  *(_DWORD *)v4 = &off_669840;
  v7 = v6 & 0x8B | 4;
  *((_BYTE *)v4 + 12) = v7;
  *((_DWORD *)v4 + 4) = m_pCurrentPed;
  if ( m_pCurrentPed )
  {
    CEntity::RegisterReference(m_pCurrentPed, (CEntity **)v4 + 4);
    v7 = *((_BYTE *)v4 + 12);
  }
  v8 = CTimer::m_snTimeInMilliseconds;
  *((_BYTE *)v4 + 12) = v7 & 0xF7;
  *((_DWORD *)v4 + 9) = v8;
  return (CTask *)v4;
}
// 669840: using guessed type void *off_669840;
// 677568: using guessed type void *`vtable for'CTaskSimpleLookAbout;
// 678150: using guessed type void *`vtable for'CTaskSimpleNone;

//----- (004E84CC) --------------------------------------------------------
CPed *__fastcall CTaskComplexKillPedGroupOnFoot::ComputeNearestLivingGroupPed(
        const CTaskComplexKillPedGroupOnFoot *this,
        const CPed *ped,
        const bool bFlag)
{
  CPed *v5; // r10
  CPed *m_pEntLockOnTarget; // r9
  CPedGroupMembership *p_m_membership; // r5
  CPedGroup *PedsGroup; // r0
  CPed *Leader; // r0
  bool v10; // zf
  float v11; // s16
  int i; // r4
  CPed *Member; // r0
  const CPed *v15; // r6
  bool v16; // zf
  CMatrix *m_pMat; // r0
  CMatrix *v18; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r0
  float32x2_t v21; // d16
  unsigned __int64 v22; // d1
  float v23; // s18

  v5 = 0;
  m_pEntLockOnTarget = 0;
  p_m_membership = &CPedGroups::ms_groups[this->m_iGroupID].m_membership;
  if ( !bFlag )
  {
    PedsGroup = CPedGroups::GetPedsGroup(ped);
    if ( PedsGroup )
    {
      Leader = CPedGroupMembership::GetLeader(&PedsGroup->m_membership);
      v10 = Leader == 0;
      m_pEntLockOnTarget = 0;
      if ( Leader )
        v10 = Leader == ped;
      if ( !v10 )
      {
        m_pEntLockOnTarget = (CPed *)Leader->m_pEntLockOnTarget;
        if ( !m_pEntLockOnTarget || (*(_BYTE *)&m_pEntLockOnTarget->m_info & 7) != 3 )
          m_pEntLockOnTarget = CTaskComplexKillPedGroupOnFoot::ComputeNearestLivingGroupPed(this, Leader, 1);
      }
    }
    else
    {
      m_pEntLockOnTarget = 0;
    }
  }
  v11 = 3.4028e38;
  for ( i = 0; i != 8; ++i )
  {
    Member = CPedGroupMembership::GetMember(p_m_membership, i);
    v15 = Member;
    v16 = Member == 0;
    if ( Member )
      v16 = m_pEntLockOnTarget == Member;
    if ( !v16 && CPed::IsAlive(Member) && v15 != ped && v15->m_nHealth > 0.0 && !CPedGroups::AreInSameGroup(v15, ped) )
    {
      m_pMat = ped->m_pMat;
      v18 = v15->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &ped->m_transform;
      p_m_transform = (CSimpleTransform *)&v18->tx;
      if ( !v18 )
        p_m_transform = &v15->m_transform;
      v21.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
      v22 = vmul_f32(v21, v21).n64_u64[0];
      v23 = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                          * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                  + *(float *)&v22)
          + *((float *)&v22 + 1);
      if ( v23 < v11
        && (!CPed::IsPlayer(v15)
         || !v15->m_pPlayerData->m_Wanted->m_nCopsInPursuit
         || ped->m_nPedType == 6
         || ped->CharCreatedBy != 1) )
      {
        v11 = v23;
        v5 = (CPed *)v15;
      }
    }
  }
  if ( v5 )
    return v5;
  return m_pEntLockOnTarget;
}

//----- (004E862C) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedGroupOnFoot::CreateFirstSubTask(CTaskComplexKillPedGroupOnFoot *this, CPed *pPed)
{
  CPed *m_pCurrentPed; // r2
  CEntity **p_m_pCurrentPed; // r5
  _BOOL4 v5; // r0
  CPed *v6; // r2
  int *v7; // r1
  CPed *v8; // r0

  p_m_pCurrentPed = &this->m_pCurrentPed;
  m_pCurrentPed = this->m_pCurrentPed;
  if ( m_pCurrentPed )
  {
    v5 = CPedGroups::AreInSameGroup(pPed, m_pCurrentPed);
    v7 = elf_hash_bucket + 748;
    if ( v5 )
      v7 = &dword_C8;
  }
  else
  {
    v8 = CTaskComplexKillPedGroupOnFoot::ComputeNearestLivingGroupPed(this, pPed, 0);
    this->m_pCurrentPed = v8;
    if ( v8 )
    {
      CEntity::RegisterReference(v8, p_m_pCurrentPed);
      v7 = elf_hash_bucket + 748;
    }
    else
    {
      v7 = &dword_C8;
    }
  }
  return CTaskComplexKillPedGroupOnFoot::CreateSubTask(this, (const int)v7, v6);
}
// 4E8670: variable 'v6' is possibly undefined
// C8: using guessed type int dword_C8;
// FC: using guessed type int elf_hash_bucket[16411];

//----- (004E8672) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedGroupOnFoot::ControlSubTask(CTaskComplexKillPedGroupOnFoot *this, CPed *pPed)
{
  return this->m_pSubTask;
}

//----- (004E8678) --------------------------------------------------------
void __fastcall CTaskSimpleStealthKill::CTaskSimpleStealthKill(
        CTaskSimpleStealthKill *this,
        bool bAttacker,
        CPed *pPed,
        AssocGroupId nAnimGroup)
{
  CTaskSimple::CTaskSimple(this);
  this->m_bAttacker = bAttacker;
  this->m_nAnimGroup = nAnimGroup;
  *(_WORD *)&this->m_bIsFinished = 0;
  this->m_pAnim = 0;
  this->m_nWaitForAnimCounter = 0;
  this->_vptr$CTask = (int (**)(void))&off_669ACC;
  this->m_pOtherPed = pPed;
  if ( pPed )
    CEntity::RegisterReference(pPed, &this->m_pOtherPed);
}
// 669ACC: using guessed type void *;

//----- (004E86C4) --------------------------------------------------------
void __fastcall CTaskSimpleStealthKill::~CTaskSimpleStealthKill(CTaskSimpleStealthKill *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1
  CAnimBlendAssociation *m_pAnim; // r0

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CTask = (int (**)(void))&off_669ACC;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  sub_1A01F4(this);
}
// 669ACC: using guessed type void *off_669ACC;

//----- (004E8704) --------------------------------------------------------
void __fastcall CTaskSimpleStealthKill::~CTaskSimpleStealthKill(CTaskSimpleStealthKill *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1
  CAnimBlendAssociation *m_pAnim; // r0
  void *v5; // r0

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CTask = (int (**)(void))&off_669ACC;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
  m_pAnim = this->m_pAnim;
  if ( m_pAnim )
    CAnimBlendAssociation::SetDeleteCallback(m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
  CTask::~CTask(this);
  sub_197118(v5);
}
// 4E873C: variable 'v5' is possibly undefined
// 669ACC: using guessed type void *off_669ACC;

//----- (004E8748) --------------------------------------------------------
bool __fastcall CTaskSimpleStealthKill::MakeAbortable(
        CTaskSimpleStealthKill *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  CAnimBlendAssociation *m_pAnim; // r0
  bool v7; // r5
  CAnimBlendAssociation *v9; // r0
  bool v10; // zf
  CAnimBlendAssociation *v11; // r0

  if ( iPriority != 1 )
  {
    if ( iPriority == 2 )
    {
      m_pAnim = this->m_pAnim;
      if ( m_pAnim )
      {
        m_pAnim->m_fBlendDelta = -1000.0;
        CAnimBlendAssociation::SetDeleteCallback(this->m_pAnim, CDefaultAnimCallback::DefaultAnimCB, 0);
        this->m_pAnim = 0;
      }
      v7 = 1;
      this->m_bIsFinished = 1;
      return v7;
    }
    return 0;
  }
  if ( this->m_bAttacker )
    return 0;
  v9 = this->m_pAnim;
  v7 = 0;
  v10 = v9 == 0;
  if ( v9 )
    v10 = pEvent == 0;
  if ( !v10 && v9->m_animId == 350 )
  {
    if ( (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) != 9 )
      return 0;
    v7 = 0;
    if ( (CPed *)pEvent[1].m_iAccumulatedTime == this->m_pOtherPed )
    {
      v11 = this->m_pAnim;
      this->m_bIsFinished = 1;
      CAnimBlendAssociation::SetDeleteCallback(v11, CDefaultAnimCallback::DefaultAnimCB, 0);
      this->m_pAnim = 0;
      return 1;
    }
  }
  return v7;
}

//----- (004E87D8) --------------------------------------------------------
bool __fastcall CTaskSimpleStealthKill::ProcessPed(CTaskSimpleStealthKill *this, CPed *pPed)
{
  float32x2_t v2; // d2
  float32x2_t v3; // d3
  CMatrix *m_pMat; // r1
  CPed *m_pOtherPed; // r2
  CSimpleTransform *p_tx; // r0
  CMatrix *v10; // r3
  float *p_x; // r1
  float v12; // s2
  float v13; // s0
  float v14; // s4
  float v15; // s8
  CAnimBlendAssociation *m_pAnim; // r0
  bool v17; // zf

  if ( this->m_bIsFinished || !this->m_pOtherPed )
    return 1;
  if ( this->m_pAnim )
    goto LABEL_9;
  if ( !this->m_bAttacker )
    CPed::SetPedState(pPed, PED_DIE_BY_STEALTH);
  CTaskSimpleStealthKill::ManageAnim(this, pPed);
  if ( this->m_pAnim || !this->m_bAnimAdded )
  {
LABEL_9:
    m_pMat = pPed->m_pMat;
    pPed->m_ik.m_flags |= 8u;
    m_pOtherPed = this->m_pOtherPed;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    v10 = m_pOtherPed->m_pMat;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    p_x = &v10->tx;
    if ( !v10 )
      p_x = &m_pOtherPed->m_transform.m_translate.x;
    v12 = *p_x - p_tx->m_translate.x;
    v13 = p_x[1] - p_tx->m_translate.y;
    if ( this->m_bAttacker )
    {
      v14 = p_x[2] - p_tx->m_translate.z;
      v2.n64_f32[0] = sqrtf((float)((float)(v12 * v12) + (float)(v13 * v13)) + (float)(v14 * v14)) + -1.0;
      if ( fabsf(v2.n64_f32[0]) > 0.02 )
      {
        v15 = CTimer::ms_fTimeStep;
        pPed->m_extractedVelocity.x = 0.0;
        v3.n64_f32[0] = v15 * 0.05;
        LODWORD(pPed->m_extractedVelocity.y) = vmin_f32(v2, v3).n64_u32[0];
      }
    }
    else
    {
      m_pAnim = this->m_pAnim;
      v17 = m_pAnim == 0;
      if ( m_pAnim )
        v17 = m_pAnim->m_animId == 349;
      if ( !v17 )
        return 0;
      v13 = -v13;
      v12 = -v12;
    }
    pPed->m_fDesiredHeading = atan2f(COERCE_FLOAT(LODWORD(v12) ^ 0x80000000), v13);
  }
  return 0;
}
// 4E88AC: variable 'v2' is possibly undefined
// 4E88AC: variable 'v3' is possibly undefined

//----- (004E88F4) --------------------------------------------------------
void __fastcall CTaskSimpleStealthKill::ManageAnim(CTaskSimpleStealthKill *this, CPed *pPed)
{
  AssocGroupId m_nAnimGroup; // r1
  CAnimBlock *m_pAnimBlock; // r0
  bool v6; // zf
  uint32 v7; // r0
  CAnimBlendAssociation *m_pAnim; // r0
  bool *p_m_bAnimAdded; // r6
  RpClump_0 *m_pRwObject; // r0
  const CEventDamage *v11; // r0
  CEventDamage v12; // [sp+10h] [bp-70h] BYREF
  CPedDamageResponseCalculator v13; // [sp+50h] [bp-30h] BYREF

  m_nAnimGroup = this->m_nAnimGroup;
  m_pAnimBlock = CAnimManager::ms_aAnimAssocGroups[m_nAnimGroup].m_pAnimBlock;
  v6 = m_pAnimBlock == 0;
  if ( m_pAnimBlock )
    v6 = !m_pAnimBlock->m_loaded;
  if ( v6 )
  {
    v7 = this->m_nWaitForAnimCounter + (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    this->m_nWaitForAnimCounter = v7;
    if ( v7 >= 0x2711 )
      this->m_bIsFinished = 1;
  }
  else
  {
    if ( this->m_bAttacker )
    {
      m_pAnim = CAnimManager::BlendAnimation((RpClump_0 *)pPed->m_pRwObject, m_nAnimGroup, ANIM_STEALTH_ATTACK, 8.0);
      this->m_pAnim = m_pAnim;
      p_m_bAnimAdded = &this->m_bAnimAdded;
    }
    else
    {
      m_pRwObject = (RpClump_0 *)pPed->m_pRwObject;
      p_m_bAnimAdded = &this->m_bAnimAdded;
      if ( this->m_bAnimAdded )
      {
        this->m_pAnim = CAnimManager::BlendAnimation(m_pRwObject, m_nAnimGroup, ANIM_STEALTH_HIT_PART2, 8.0);
        CPedDamageResponseCalculator::CPedDamageResponseCalculator(
          &v13,
          this->m_pOtherPed,
          CPedDamageResponseCalculator::ms_fStealthKillDamage,
          (const eWeaponType)this->m_pOtherPed->m_WeaponSlots[this->m_pOtherPed->m_nCurrentWeapon].m_eWeaponType,
          PED_SPHERE_CHEST,
          0);
        CEventDamage::CEventDamage(
          &v12,
          this->m_pOtherPed,
          CTimer::m_snTimeInMilliseconds,
          (const eWeaponType)this->m_pOtherPed->m_WeaponSlots[this->m_pOtherPed->m_nCurrentWeapon].m_eWeaponType,
          PED_SPHERE_CHEST,
          0,
          0,
          *(_DWORD *)&pPed->m_nPedFlags & 0x100);
        if ( CEventDamage::AffectsPed(v11, pPed) )
        {
          CPedDamageResponseCalculator::ComputeDamageResponse(&v13, pPed, &v12.m_pedDamageResponse, 1);
          v12.m_nAnimGroup = this->m_nAnimGroup;
          v12.m_nAnimId = ANIM_STEALTH_HIT_PART2;
          v12.m_fAnimBlendSpeed = 8.0;
          v12.m_fAnimPlaySpeed = 1.0;
          *((_BYTE *)&v12 + 33) |= 4u;
          CEventGroup::Add(&pPed->m_pPedIntelligence->m_eventGroup, (CEvent *)&v12, 0);
        }
        CEventDamage::~CEventDamage(&v12);
        CPedDamageResponseCalculator::~CPedDamageResponseCalculator(&v13);
        m_pAnim = this->m_pAnim;
      }
      else
      {
        m_pAnim = CAnimManager::BlendAnimation(m_pRwObject, m_nAnimGroup, ANIM_STEALTH_HIT_PART1, 8.0);
        this->m_pAnim = m_pAnim;
      }
    }
    CAnimBlendAssociation::SetFinishCallback(m_pAnim, CTaskSimpleStealthKill::FinishAnimStealthKillCB, this);
    *p_m_bAnimAdded = 1;
  }
}
// 4E89F2: variable 'v11' is possibly undefined

//----- (004E8A84) --------------------------------------------------------
void __fastcall CTaskSimpleStealthKill::FinishAnimStealthKillCB(CAnimBlendAssociation *pAnim, void *pData)
{
  if ( (pAnim->m_animId | 2) == 350 )
    *((_BYTE *)pData + 20) = 1;
  *((_DWORD *)pData + 6) = 0;
}

//----- (004E8A9C) --------------------------------------------------------
void __fastcall CTaskComplexKillPedFromBoat::CTaskComplexKillPedFromBoat(
        CTaskComplexKillPedFromBoat *this,
        CPed *pTargetPed)
{
  CTaskComplex::CTaskComplex(this);
  this->_vptr$CTask = (int (**)(void))&off_669B00;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
}
// 669B00: using guessed type void *;

//----- (004E8ACC) --------------------------------------------------------
void __fastcall CTaskComplexKillPedFromBoat::~CTaskComplexKillPedFromBoat(CTaskComplexKillPedFromBoat *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669B00;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  sub_18EDB4(this);
}
// 669B00: using guessed type void *off_669B00;

//----- (004E8AF8) --------------------------------------------------------
void __fastcall CTaskComplexKillPedFromBoat::~CTaskComplexKillPedFromBoat(CTaskComplexKillPedFromBoat *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  void *v4; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669B00;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v4);
}
// 4E8B20: variable 'v4' is possibly undefined
// 669B00: using guessed type void *off_669B00;

//----- (004E8B28) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedFromBoat::CreateNextSubTask(CTaskComplexKillPedFromBoat *this, CPed *pPed)
{
  CTaskSimpleStandStill *v2; // r0
  CTask *result; // r0

  v2 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
  CTaskSimpleStandStill::CTaskSimpleStandStill(v2, 0, 1, 0, 8.0);
  return result;
}

//----- (004E8B48) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedFromBoat::CreateFirstSubTask(CTaskComplexKillPedFromBoat *this, CPed *pPed)
{
  CTaskSimpleStandStill *v2; // r0
  CTask *result; // r0

  *(_DWORD *)&pPed->m_nPedFlags |= 0x200000u;
  v2 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
  CTaskSimpleStandStill::CTaskSimpleStandStill(v2, 0, 1, 0, 8.0);
  return result;
}

//----- (004E8B74) --------------------------------------------------------
CTask *__fastcall CTaskComplexKillPedFromBoat::ControlSubTask(CTaskComplexKillPedFromBoat *this, CPed *pPed)
{
  void *m_pSubTask; // r4
  int v5; // r0
  bool v6; // zf
  CPed *v7; // r0
  CPed *v8; // r5
  char v9; // r1
  char v10; // r0
  uint32 v11; // r1
  CPed *m_pTargetPed; // r0
  CPed *v13; // r0
  bool v14; // zf
  int m_pMyVehicle; // r1
  CPed *v16; // r0

  m_pSubTask = this->m_pSubTask;
  v5 = (*(int (__fastcall **)(void *))(*(_DWORD *)m_pSubTask + 20))(m_pSubTask);
  if ( v5 == 1000 )
  {
    if ( pPed->m_nPedType == 6 )
    {
      m_pTargetPed = this->m_pTargetPed;
      if ( m_pTargetPed && CPed::IsPlayer(m_pTargetPed) )
      {
        v13 = this->m_pTargetPed;
        m_pMyVehicle = *((unsigned __int8 *)&v13->m_nPedFlags + 1) << 31;
        v14 = m_pMyVehicle == 0;
        if ( m_pMyVehicle )
        {
          m_pMyVehicle = (int)v13->m_pMyVehicle;
          v14 = m_pMyVehicle == 0;
        }
        if ( v14 )
        {
          if ( *((unsigned __int8 *)&v13->m_nPhysicalFlags + 1) << 31 )
            CAudioEngine::SayPedless(&AudioEngine, 52, 175, pPed, 0, 1.0, 0, 0, 0);
        }
        else if ( *(_BYTE *)(m_pMyVehicle + 444) == 3 )
        {
          CAudioEngine::SayPedless(&AudioEngine, 52, 173, pPed, 0, 1.0, 0, 0, 0);
        }
      }
      if ( pPed->m_nPedType == 6 )
      {
        v16 = this->m_pTargetPed;
        if ( v16 )
        {
          if ( CPed::IsPlayer(v16)
            && FindPlayerWanted(-1)->m_WantedLevel == WANTED_CLEAN
            && (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
                 this->m_pSubTask,
                 pPed,
                 1,
                 0) == 1 )
          {
            m_pSubTask = CTask::operator new(0x20u);
            CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)m_pSubTask, 0, 1, 0, 8.0);
          }
        }
      }
    }
  }
  else
  {
    v6 = v5 == 203;
    if ( v5 == 203 )
      v6 = pPed->m_nPedType == 6;
    if ( v6 )
    {
      v7 = this->m_pTargetPed;
      if ( v7 )
      {
        if ( CPed::IsPlayer(v7)
          && FindPlayerWanted(-1)->m_WantedLevel
          && (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
               this->m_pSubTask,
               pPed,
               1,
               0) == 1 )
        {
          m_pSubTask = CTask::operator new(0x38u);
          v8 = this->m_pTargetPed;
          CTaskComplex::CTaskComplex((CTaskComplex *)m_pSubTask);
          *((_DWORD *)m_pSubTask + 5) = 0;
          *((_DWORD *)m_pSubTask + 6) = 0;
          *((_DWORD *)m_pSubTask + 7) = 0;
          *((_BYTE *)m_pSubTask + 32) = 1;
          *((_DWORD *)m_pSubTask + 10) = -1;
          *((_WORD *)m_pSubTask + 26) = 0;
          *((_DWORD *)m_pSubTask + 12) = 0;
          v9 = *((_BYTE *)m_pSubTask + 12);
          *((_DWORD *)m_pSubTask + 11) = 0;
          *(_DWORD *)m_pSubTask = &off_669840;
          v10 = v9 & 0x8B | 4;
          *((_BYTE *)m_pSubTask + 12) = v10;
          *((_DWORD *)m_pSubTask + 4) = v8;
          if ( v8 )
          {
            CEntity::RegisterReference(v8, (CEntity **)m_pSubTask + 4);
            v10 = *((_BYTE *)m_pSubTask + 12);
          }
          v11 = CTimer::m_snTimeInMilliseconds;
          *((_BYTE *)m_pSubTask + 12) = v10 & 0xF7;
          *((_DWORD *)m_pSubTask + 9) = v11;
        }
      }
    }
  }
  return (CTask *)m_pSubTask;
}
// 669840: using guessed type void *off_669840;

//----- (004E8D20) --------------------------------------------------------
bool __fastcall CTaskSimpleSetCharIgnoreWeaponRangeFlag::ProcessPed(
        CTaskSimpleSetCharIgnoreWeaponRangeFlag *this,
        CPed *pPed)
{
  int v2; // r3
  int v3; // r12
  unsigned int v4; // r0

  v2 = *((_DWORD *)&pPed->m_nPedFlags + 1);
  v3 = *((_DWORD *)&pPed->m_nPedFlags + 2);
  v4 = *((_DWORD *)&pPed->m_nPedFlags + 3) & 0xFFFFFDFF | ((this->m_bIgnoreRange & 1) << 9);
  *(_DWORD *)&pPed->m_nPedFlags = pPed->m_nPedFlags;
  *((_DWORD *)&pPed->m_nPedFlags + 1) = v2;
  *((_DWORD *)&pPed->m_nPedFlags + 2) = v3;
  *((_DWORD *)&pPed->m_nPedFlags + 3) = v4;
  return 1;
}

//----- (004E8D58) --------------------------------------------------------
void __fastcall CTaskComplexSeekCoverUntilTargetDead::CTaskComplexSeekCoverUntilTargetDead(
        CTaskComplexSeekCoverUntilTargetDead *this,
        const int iGroupId)
{
  _DWORD *v3; // r0

  CTaskComplex::CTaskComplex(this);
  v3[3] = iGroupId;
  v3[4] = 0;
  v3[5] = 0;
  *v3 = &off_669B3C;
}
// 4E8D66: variable 'v3' is possibly undefined
// 669B3C: using guessed type void *off_669B3C;

//----- (004E8D7C) --------------------------------------------------------
void __fastcall CTaskComplexSeekCoverUntilTargetDead::CTaskComplexSeekCoverUntilTargetDead(
        CTaskComplexSeekCoverUntilTargetDead *this,
        CPed *pTargetPed)
{
  CTaskComplex::CTaskComplex(this);
  this->m_iGroupId = -1;
  this->m_pCoverPed = 0;
  this->_vptr$CTask = (int (**)(void))&off_669B3C;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
}
// 669B3C: using guessed type void *off_669B3C;

//----- (004E8DB8) --------------------------------------------------------
void __fastcall CTaskComplexSeekCoverUntilTargetDead::~CTaskComplexSeekCoverUntilTargetDead(
        CTaskComplexSeekCoverUntilTargetDead *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  CPed *m_pCoverPed; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669B3C;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  m_pCoverPed = this->m_pCoverPed;
  if ( m_pCoverPed )
    CEntity::CleanUpOldReference(m_pCoverPed, &this->m_pCoverPed);
  sub_18EDB4(this);
}
// 669B3C: using guessed type void *off_669B3C;

//----- (004E8DF4) --------------------------------------------------------
void __fastcall CTaskComplexSeekCoverUntilTargetDead::~CTaskComplexSeekCoverUntilTargetDead(
        CTaskComplexSeekCoverUntilTargetDead *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  CPed *m_pCoverPed; // r0
  void *v5; // r0

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CTask = (int (**)(void))&off_669B3C;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  m_pCoverPed = this->m_pCoverPed;
  if ( m_pCoverPed )
    CEntity::CleanUpOldReference(m_pCoverPed, &this->m_pCoverPed);
  CTaskComplex::~CTaskComplex(this);
  sub_197118(v5);
}
// 4E8E2A: variable 'v5' is possibly undefined
// 669B3C: using guessed type void *;

//----- (004E8E34) --------------------------------------------------------
CTask *__fastcall CTaskComplexSeekCoverUntilTargetDead::CreateNextSubTask(
        CTaskComplexSeekCoverUntilTargetDead *this,
        CPed *pPed)
{
  if ( (*((int (__fastcall **)(CTask *))this->m_pSubTask->CTaskComplex::_vptr$CTask + 5))(this->m_pSubTask) == 203 )
    return 0;
  else
    return (CTask *)(*((int (__fastcall **)(CTaskComplexSeekCoverUntilTargetDead *, CPed *))this->_vptr$CTask + 11))(
                      this,
                      pPed);
}

//----- (004E8E60) --------------------------------------------------------
CTask *__fastcall CTaskComplexSeekCoverUntilTargetDead::CreateFirstSubTask(
        CTaskComplexSeekCoverUntilTargetDead *this,
        CPed *pPed)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r8
  CPed *m_pCoverPed; // r0
  CEntity **p_m_pCoverPed; // r6
  CPed *TargetPed; // r0
  bool v9; // zf
  CTaskComplexSequence *v10; // r5
  void *v11; // r4
  CEntity *v12; // r6
  char v13; // r2
  CTaskComplexTurnToFaceEntityOrCoord *v14; // r4
  CTaskSimpleStandStill *v15; // r4

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  p_m_pCoverPed = &this->m_pCoverPed;
  m_pCoverPed = this->m_pCoverPed;
  if ( m_pCoverPed )
    CEntity::CleanUpOldReference(m_pCoverPed, &this->m_pCoverPed);
  this->m_pCoverPed = CTaskComplexSeekCoverUntilTargetDead::GetCoverPed(
                        (const CTaskComplexSeekCoverUntilTargetDead *)m_pCoverPed,
                        pPed);
  TargetPed = CTaskComplexSeekCoverUntilTargetDead::GetTargetPed(this);
  this->m_pTargetPed = TargetPed;
  v9 = TargetPed == 0;
  if ( TargetPed )
    v9 = this->m_pCoverPed == 0;
  v10 = 0;
  if ( !v9 )
  {
    CEntity::RegisterReference(TargetPed, p_m_pTargetPed);
    CEntity::RegisterReference(*p_m_pCoverPed, &this->m_pCoverPed);
    v10 = (CTaskComplexSequence *)CTask::operator new(0x40u);
    CTaskComplexSequence::CTaskComplexSequence(v10);
    v11 = CTask::operator new(0x54u);
    v12 = *p_m_pCoverPed;
    CTaskComplex::CTaskComplex((CTaskComplex *)v11);
    *((_QWORD *)v11 + 3) = 0x400000003F800000LL;
    *((_QWORD *)v11 + 4) = 0x4000000000000000LL;
    *(_DWORD *)v11 = &off_6658D0;
    *((_DWORD *)v11 + 4) = 50000;
    *((_DWORD *)v11 + 5) = 1000;
    *((_WORD *)v11 + 24) = 0;
    *((_WORD *)v11 + 30) = 0;
    *((_DWORD *)v11 + 10) = 0;
    *((_DWORD *)v11 + 11) = 0;
    *((_DWORD *)v11 + 13) = 0;
    *((_DWORD *)v11 + 14) = 0;
    v13 = *((_BYTE *)v11 + 80);
    *((_QWORD *)v11 + 8) = (unsigned int)&off_66D3C0;
    *((_DWORD *)v11 + 18) = 0;
    *((_DWORD *)v11 + 19) = 6;
    *((_BYTE *)v11 + 80) = v13 & 0xF0 | 3;
    *((_DWORD *)v11 + 3) = v12;
    if ( v12 )
      CEntity::RegisterReference(v12, (CEntity **)v11 + 3);
    *((_DWORD *)v11 + 17) = 1069547520;
    *((_DWORD *)v11 + 18) = 1078530011;
    CTaskComplexSequence::AddTask(v10, (CTask *)v11);
    v14 = (CTaskComplexTurnToFaceEntityOrCoord *)CTask::operator new(0x28u);
    CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(v14, *p_m_pTargetPed, 0.5, 0.2);
    CTaskComplexSequence::AddTask(v10, v14);
    v15 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
    CTaskSimpleStandStill::CTaskSimpleStandStill(v15, 2000, 0, 0, 8.0);
    CTaskComplexSequence::AddTask(v10, v15);
  }
  return v10;
}
// 4E8E90: variable 'm_pCoverPed' is possibly undefined
// 6658D0: using guessed type void *off_6658D0;
// 66D3C0: using guessed type void *off_66D3C0;

//----- (004E8FD0) --------------------------------------------------------
CPed *__fastcall CTaskComplexSeekCoverUntilTargetDead::GetCoverPed(
        const CTaskComplexSeekCoverUntilTargetDead *this,
        CPed *pPed)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d8
  CPedGroup *PedsGroup; // r0
  const CPedGroupMembership *p_m_membership; // r6
  CPed *v7; // r8
  int i; // r5
  CPed *Member; // r0
  const CPed *v10; // r4
  bool v11; // zf
  CMatrix *m_pMat; // r0
  CMatrix *v13; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r0
  float32x2_t v16; // d16
  unsigned __int64 v17; // d1
  bool v18; // nf

  PedsGroup = CPedGroups::GetPedsGroup(pPed);
  if ( !PedsGroup )
    return 0;
  v3.n64_u32[0] = 2139095039;
  p_m_membership = &PedsGroup->m_membership;
  v7 = 0;
  for ( i = 0; i != 8; ++i )
  {
    Member = CPedGroupMembership::GetMember(p_m_membership, i);
    v10 = Member;
    v11 = Member == 0;
    if ( Member )
      v11 = Member == pPed;
    if ( !v11 && !CWeapon::IsTypeMelee(&Member->m_WeaponSlots[Member->m_nCurrentWeapon]) && CPed::IsAlive(v10) )
    {
      m_pMat = v10->m_pMat;
      v13 = pPed->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v10->m_transform;
      p_m_transform = (CSimpleTransform *)&v13->tx;
      if ( !v13 )
        p_m_transform = &pPed->m_transform;
      v16.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
      v17 = vmul_f32(v16, v16).n64_u64[0];
      v2.n64_f32[0] = (float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                    * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                            + *(float *)&v17)
                    + *((float *)&v17 + 1);
      v18 = v2.n64_f32[0] < v3.n64_f32[0];
      v3.n64_u64[0] = vmin_f32(v2, v3).n64_u64[0];
      if ( v18 )
        v7 = (CPed *)v10;
    }
  }
  return v7;
}
// 4E906C: variable 'v2' is possibly undefined
// 4E906C: variable 'v3' is possibly undefined

//----- (004E909C) --------------------------------------------------------
CPed *__fastcall CTaskComplexSeekCoverUntilTargetDead::GetTargetPed(const CTaskComplexSeekCoverUntilTargetDead *this)
{
  int m_iGroupId; // r0
  CPed *Leader; // r0
  CPed *v4; // r5
  CPed *Member; // r0
  CPed *v6; // r0
  CPed *v7; // r0
  CPed *v8; // r0
  CPed *v9; // r0
  CPed *v10; // r0
  CPed *v11; // r0
  CPed *m_pTargetPed; // r0

  m_iGroupId = this->m_iGroupId;
  if ( m_iGroupId < 0 )
  {
    m_pTargetPed = this->m_pTargetPed;
    if ( m_pTargetPed )
    {
      if ( CPed::IsAlive(m_pTargetPed) )
        return this->m_pTargetPed;
      else
        return 0;
    }
    return 0;
  }
  Leader = CPedGroupMembership::GetLeader(&CPedGroups::ms_groups[m_iGroupId].m_membership);
  v4 = Leader;
  if ( !Leader || !CPed::IsAlive(Leader) )
  {
    Member = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_iGroupId].m_membership, 0);
    v4 = Member;
    if ( !Member || !CPed::IsAlive(Member) )
    {
      v6 = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_iGroupId].m_membership, 1);
      v4 = v6;
      if ( !v6 || !CPed::IsAlive(v6) )
      {
        v7 = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_iGroupId].m_membership, 2);
        v4 = v7;
        if ( !v7 || !CPed::IsAlive(v7) )
        {
          v8 = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_iGroupId].m_membership, 3);
          v4 = v8;
          if ( !v8 || !CPed::IsAlive(v8) )
          {
            v9 = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_iGroupId].m_membership, 4);
            v4 = v9;
            if ( !v9 || !CPed::IsAlive(v9) )
            {
              v10 = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_iGroupId].m_membership, 5);
              v4 = v10;
              if ( !v10 || !CPed::IsAlive(v10) )
              {
                v11 = CPedGroupMembership::GetMember(&CPedGroups::ms_groups[this->m_iGroupId].m_membership, 6);
                v4 = v11;
                if ( v11 )
                {
                  if ( !CPed::IsAlive(v11) )
                    return 0;
                  return v4;
                }
                return 0;
              }
            }
          }
        }
      }
    }
  }
  return v4;
}

//----- (004E9210) --------------------------------------------------------
CTask *__fastcall CTaskComplexSeekCoverUntilTargetDead::ControlSubTask(
        CTaskComplexSeekCoverUntilTargetDead *this,
        CPed *pPed)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r9
  CPed *TargetPed; // r0
  CPed *m_pCoverPed; // r0
  CEntity **p_m_pCoverPed; // r10
  CTask **p_m_pSubTask; // r5
  CPed *v10; // r0
  _BOOL4 v11; // r4
  CTask *m_pSubTask; // t1
  int v13; // r0
  CTaskSimpleStandStill *v14; // r8
  void *v15; // r5
  CEntity *v16; // r6
  char v17; // r2
  CTaskComplexTurnToFaceEntityOrCoord *v18; // r5
  CTaskSimpleStandStill *v19; // r4

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  if ( m_pTargetPed )
  {
    if ( CPed::IsAlive(m_pTargetPed) )
      goto LABEL_8;
    if ( *p_m_pTargetPed )
      CEntity::CleanUpOldReference(*p_m_pTargetPed, p_m_pTargetPed);
  }
  TargetPed = CTaskComplexSeekCoverUntilTargetDead::GetTargetPed(this);
  this->m_pTargetPed = TargetPed;
  if ( !TargetPed || (CEntity::RegisterReference(TargetPed, p_m_pTargetPed), !*p_m_pTargetPed) )
  {
    if ( (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))this->m_pSubTask->CTaskComplex::_vptr$CTask + 7))(
           this->m_pSubTask,
           pPed,
           1,
           0) == 1 )
    {
LABEL_18:
      v14 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
      CTaskSimpleStandStill::CTaskSimpleStandStill(v14, -1, 0, 0, 8.0);
      return v14;
    }
  }
LABEL_8:
  p_m_pCoverPed = &this->m_pCoverPed;
  m_pCoverPed = this->m_pCoverPed;
  if ( m_pCoverPed )
  {
    if ( CPed::IsAlive(m_pCoverPed) )
    {
      p_m_pSubTask = &this->m_pSubTask;
      return *p_m_pSubTask;
    }
    if ( *p_m_pCoverPed )
      CEntity::CleanUpOldReference(*p_m_pCoverPed, &this->m_pCoverPed);
  }
  v10 = CTaskComplexSeekCoverUntilTargetDead::GetTargetPed(this);
  this->m_pCoverPed = v10;
  if ( v10 )
  {
    CEntity::RegisterReference(v10, &this->m_pCoverPed);
    v11 = *p_m_pCoverPed == 0;
  }
  else
  {
    v11 = 1;
  }
  m_pSubTask = this->m_pSubTask;
  p_m_pSubTask = &this->m_pSubTask;
  v13 = (*((int (__fastcall **)(CTask *, CPed *, int, _DWORD))m_pSubTask->_vptr$CTask + 7))(m_pSubTask, pPed, 1, 0);
  if ( v11 )
  {
    if ( v13 != 1 )
      return *p_m_pSubTask;
    goto LABEL_18;
  }
  if ( v13 != 1 )
    return *p_m_pSubTask;
  v14 = (CTaskSimpleStandStill *)CTask::operator new(0x40u);
  CTaskComplexSequence::CTaskComplexSequence((CTaskComplexSequence *)v14);
  v15 = CTask::operator new(0x54u);
  v16 = *p_m_pCoverPed;
  CTaskComplex::CTaskComplex((CTaskComplex *)v15);
  *((_QWORD *)v15 + 3) = 0x400000003F800000LL;
  *((_QWORD *)v15 + 4) = 0x4000000000000000LL;
  *(_DWORD *)v15 = &off_6658D0;
  *((_DWORD *)v15 + 4) = 50000;
  *((_DWORD *)v15 + 5) = 1000;
  *((_WORD *)v15 + 24) = 0;
  *((_WORD *)v15 + 30) = 0;
  *((_DWORD *)v15 + 10) = 0;
  *((_DWORD *)v15 + 11) = 0;
  *((_DWORD *)v15 + 13) = 0;
  *((_DWORD *)v15 + 14) = 0;
  v17 = *((_BYTE *)v15 + 80);
  *((_QWORD *)v15 + 8) = (unsigned int)&off_66D3C0;
  *((_DWORD *)v15 + 18) = 0;
  *((_DWORD *)v15 + 19) = 6;
  *((_BYTE *)v15 + 80) = v17 & 0xF0 | 3;
  *((_DWORD *)v15 + 3) = v16;
  if ( v16 )
    CEntity::RegisterReference(v16, (CEntity **)v15 + 3);
  *((_DWORD *)v15 + 17) = 1069547520;
  *((_DWORD *)v15 + 18) = 1078530011;
  CTaskComplexSequence::AddTask((CTaskComplexSequence *)v14, (CTask *)v15);
  v18 = (CTaskComplexTurnToFaceEntityOrCoord *)CTask::operator new(0x28u);
  CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(v18, *p_m_pTargetPed, 0.5, 0.2);
  CTaskComplexSequence::AddTask((CTaskComplexSequence *)v14, v18);
  v19 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
  CTaskSimpleStandStill::CTaskSimpleStandStill(v19, 2000, 0, 0, 8.0);
  CTaskComplexSequence::AddTask((CTaskComplexSequence *)v14, v19);
  return v14;
}
// 6658D0: using guessed type void *off_6658D0;
// 66D3C0: using guessed type void *off_66D3C0;

//----- (004E9400) --------------------------------------------------------
void __fastcall CTaskSimpleSetCharIgnoreWeaponRangeFlag::~CTaskSimpleSetCharIgnoreWeaponRangeFlag(
        CTaskSimpleSetCharIgnoreWeaponRangeFlag *this)
{
  void *v1; // r0

  CTask::~CTask(this);
  sub_197118(v1);
}
// 4E940C: variable 'v1' is possibly undefined

//----- (004E9410) --------------------------------------------------------
CTask *__fastcall CTaskSimpleSetCharIgnoreWeaponRangeFlag::Clone(const CTaskSimpleSetCharIgnoreWeaponRangeFlag *this)
{
  CTaskSimple *v2; // r0
  CTask *result; // r0

  v2 = (CTaskSimple *)CTask::operator new(0xCu);
  LOBYTE(this) = this->m_bIgnoreRange;
  CTaskSimple::CTaskSimple(v2);
  LOBYTE(result[1]._vptr$CTask) = (_BYTE)this;
  result->_vptr$CTask = (int (**)(void))&off_669B78;
  return result;
}
// 4E9424: variable 'result' is possibly undefined
// 669B78: using guessed type void *off_669B78;

//----- (004E9434) --------------------------------------------------------
int __fastcall CTaskSimpleSetCharIgnoreWeaponRangeFlag::GetTaskType(
        const CTaskSimpleSetCharIgnoreWeaponRangeFlag *this)
{
  return 1033;
}

//----- (004E943A) --------------------------------------------------------
bool __fastcall CTaskSimpleSetCharIgnoreWeaponRangeFlag::MakeAbortable(
        CTaskSimpleSetCharIgnoreWeaponRangeFlag *this,
        CPed *pPed,
        const int iPriority,
        const CEvent *pEvent)
{
  return 0;
}

//----- (004E9440) --------------------------------------------------------
CTask *__fastcall CTaskSimpleFight::Clone(const CTaskSimpleFight *this)
{
  char *v2; // r4
  unsigned int m_nIdlePeriod; // r8
  CEntity *m_pTargetEntity; // r5
  __int16 v5; // r0

  v2 = (char *)CTask::operator new(0x28u);
  m_nIdlePeriod = this->m_nIdlePeriod;
  m_pTargetEntity = this->m_pTargetEntity;
  LOBYTE(this) = this->m_nLastCommand;
  CTaskSimple::CTaskSimple((CTaskSimple *)v2);
  *((_WORD *)v2 + 4) = 256;
  v2[10] = 0;
  *((_DWORD *)v2 + 3) = 33;
  *(_DWORD *)(v2 + 18) = 0;
  *((_DWORD *)v2 + 7) = 0;
  *((_DWORD *)v2 + 8) = 0;
  v2[36] = -1;
  v2[37] = -1;
  v2[38] = (char)this;
  v2[39] = 0;
  *(_DWORD *)v2 = &off_6695FC;
  *((_DWORD *)v2 + 6) = m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::RegisterReference(m_pTargetEntity, (CEntity **)v2 + 6);
  v5 = -5536;
  if ( m_nIdlePeriod < 0xEA60 )
    v5 = m_nIdlePeriod;
  *((_WORD *)v2 + 8) = v5;
  return (CTask *)v2;
}
// 6695FC: using guessed type void *off_6695FC;

//----- (004E94C0) --------------------------------------------------------
int __fastcall CTaskSimpleFight::GetTaskType(const CTaskSimpleFight *this)
{
  return 1016;
}

//----- (004E94C8) --------------------------------------------------------
CTask *__fastcall CTaskSimpleFightingControl::Clone(const CTaskSimpleFightingControl *this)
{
  void *v2; // r4
  CEntity *m_pTargetEntity; // r5
  __int64 v4; // r8
  CTask *result; // r0

  v2 = CTask::operator new(0x24u);
  m_pTargetEntity = this->m_pTargetEntity;
  v4 = *(_QWORD *)&this->m_fAttackAngle;
  CTaskSimple::CTaskSimple((CTaskSimple *)v2);
  *((_BYTE *)v2 + 8) = 0;
  *((_WORD *)v2 + 5) = 0;
  *(_DWORD *)v2 = &off_669630;
  *((_DWORD *)v2 + 3) = m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::RegisterReference(m_pTargetEntity, (CEntity **)v2 + 3);
  *((_QWORD *)v2 + 2) = v4;
  *((_DWORD *)v2 + 6) = 1065353216;
  *((_DWORD *)v2 + 7) = 0;
  result = (CTask *)v2;
  *((_DWORD *)v2 + 8) = 0;
  return result;
}
// 669630: using guessed type void *off_669630;

//----- (004E9524) --------------------------------------------------------
int __fastcall CTaskSimpleFightingControl::GetTaskType(const CTaskSimpleFightingControl *this)
{
  return 1019;
}

//----- (004E952C) --------------------------------------------------------
CTask *__fastcall CTaskSimpleUseGun::Clone(const CTaskSimpleUseGun *this)
{
  char *v2; // r4
  CEntity *m_pTargetEntity; // r5
  __int64 v4; // r10
  RwReal z; // r8
  int8 m_nLastCommand; // r9
  bool8 m_bAimImmediate; // [sp+4h] [bp-24h]
  int16 m_nBurstLength; // [sp+8h] [bp-20h]

  v2 = (char *)CTask::operator new(0x3Cu);
  m_nBurstLength = this->m_nBurstLength;
  m_pTargetEntity = this->m_pTargetEntity;
  v4 = *(_QWORD *)&this->m_vecCoords.x;
  z = this->m_vecCoords.z;
  m_bAimImmediate = this->m_bAimImmediate;
  m_nLastCommand = this->m_nLastCommand;
  CTaskSimple::CTaskSimple((CTaskSimple *)v2);
  *((_WORD *)v2 + 4) = 256;
  v2[14] = 0;
  *((_DWORD *)v2 + 5) = 0;
  *((_DWORD *)v2 + 6) = 0;
  *(_DWORD *)(v2 + 10) = 0;
  v2[15] = m_nLastCommand;
  v2[16] = -1;
  *(_DWORD *)v2 = &off_669664;
  *((_DWORD *)v2 + 7) = m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::RegisterReference(m_pTargetEntity, (CEntity **)v2 + 7);
  *((_QWORD *)v2 + 4) = v4;
  *((RwReal *)v2 + 10) = z;
  *((_DWORD *)v2 + 11) = 0;
  *((_DWORD *)v2 + 12) = 0;
  *((_WORD *)v2 + 26) = m_nBurstLength;
  *(_DWORD *)(v2 + 54) = 16711680;
  v2[58] = 0;
  v2[59] = m_bAimImmediate;
  return (CTask *)v2;
}
// 669664: using guessed type void *off_669664;

//----- (004E95C4) --------------------------------------------------------
int __fastcall CTaskSimpleUseGun::GetTaskType(const CTaskSimpleUseGun *this)
{
  return 1017;
}

//----- (004E95CC) --------------------------------------------------------
void __fastcall CTaskSimpleUseGun::Serialize(CTaskSimpleUseGun *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  CEntity *m_pTargetEntity; // r0
  int v5; // r6
  _DWORD *v6; // r5
  CEntity *v7; // r0
  int v8; // r1
  int v9; // r5
  int v10; // r0
  _DWORD *v11; // r5
  void *v12; // r0
  _DWORD *v13; // r6
  _DWORD *v14; // r5
  __int64 v15; // d16
  float m_nNextCommand; // s16
  _BYTE *v17; // r5
  _WORD *v18; // r5

  v2 = (*((int (__fastcall **)(CTaskSimpleUseGun *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskSimpleUseGun *))this->_vptr$CTask + 5))(this) != 1017 )
  {
    v10 = (*((int (__fastcall **)(CTaskSimpleUseGun *))this->_vptr$CTask + 5))(this);
    sub_1941C4(1017, v10);
    return;
  }
  m_pTargetEntity = this->m_pTargetEntity;
  if ( !m_pTargetEntity )
  {
    if ( UseDataFence )
      AddDataFence();
    v11 = malloc(4u);
    *v11 = 0;
    CGenericGameStorage::_SaveDataToWorkBuffer(v11, 4);
    v12 = v11;
    goto LABEL_20;
  }
  v5 = *(_BYTE *)&m_pTargetEntity->m_info & 7;
  if ( UseDataFence )
    AddDataFence();
  v6 = malloc(4u);
  *v6 = v5;
  CGenericGameStorage::_SaveDataToWorkBuffer(v6, 4);
  free(v6);
  v7 = this->m_pTargetEntity;
  v8 = *(_BYTE *)&v7->m_info & 7;
  switch ( v8 )
  {
    case 2:
      v9 = GettPoolVehicleRef((CVehicle *)v7);
      goto LABEL_17;
    case 4:
      v9 = GettPoolObjRef((CObject *)v7);
      goto LABEL_17;
    case 3:
      v9 = GettPoolPedRef((CPed *)v7);
LABEL_17:
      if ( UseDataFence )
        AddDataFence();
      v13 = malloc(4u);
      *v13 = v9;
      CGenericGameStorage::_SaveDataToWorkBuffer(v13, 4);
      v12 = v13;
LABEL_20:
      free(v12);
      break;
  }
  if ( UseDataFence )
    AddDataFence();
  v14 = malloc(0xCu);
  v15 = *(_QWORD *)&this->m_vecCoords.x;
  v14[2] = LODWORD(this->m_vecCoords.z);
  *(_QWORD *)v14 = v15;
  CGenericGameStorage::_SaveDataToWorkBuffer(v14, 12);
  free(v14);
  m_nNextCommand = (float)this->m_nNextCommand;
  if ( UseDataFence )
    AddDataFence();
  v17 = malloc(1u);
  *v17 = LOBYTE(m_nNextCommand);
  CGenericGameStorage::_SaveDataToWorkBuffer(v17, 1);
  free(v17);
  if ( UseDataFence )
    AddDataFence();
  v18 = malloc(2u);
  *v18 = this->m_nBurstLength;
  CGenericGameStorage::_SaveDataToWorkBuffer(v18, 2);
  free(v18);
  if ( UseDataFence )
    AddDataFence();
  sub_19E9A8(&this->m_bAimImmediate, 1);
}

//----- (004E97D4) --------------------------------------------------------
CTask *__fastcall CTaskSimpleGunControl::Clone(const CTaskSimpleGunControl *this)
{
  char *v2; // r5
  CEntity *m_pTargetEntity; // r6
  __int64 v4; // d16
  __int64 v5; // d16
  int8 m_nFiringTask; // [sp+0h] [bp-28h]
  int16 m_nBurstLength; // [sp+4h] [bp-24h]
  int32 m_nDuration; // [sp+8h] [bp-20h]

  v2 = (char *)CTask::operator new(0x3Cu);
  m_pTargetEntity = this->m_pTargetEntity;
  m_nDuration = this->m_nDuration;
  m_nFiringTask = this->m_nFiringTask;
  m_nBurstLength = this->m_nBurstLength;
  CTaskSimple::CTaskSimple((CTaskSimple *)v2);
  v2[8] = 0;
  *((_DWORD *)v2 + 8) = 0;
  *((_DWORD *)v2 + 9) = 0;
  *(_DWORD *)v2 = &off_669698;
  *((_QWORD *)v2 + 2) = 0LL;
  *((_QWORD *)v2 + 3) = 0LL;
  *((_DWORD *)v2 + 3) = m_pTargetEntity;
  if ( m_pTargetEntity )
    CEntity::RegisterReference(m_pTargetEntity, (CEntity **)v2 + 3);
  v4 = *(_QWORD *)&this->m_vecTargetPos.x;
  *((_DWORD *)v2 + 6) = LODWORD(this->m_vecTargetPos.z);
  *((_QWORD *)v2 + 2) = v4;
  v5 = *(_QWORD *)&this->m_vecMoveTarget.x;
  *((_DWORD *)v2 + 9) = LODWORD(this->m_vecMoveTarget.z);
  *(_QWORD *)(v2 + 28) = v5;
  v2[46] = m_nFiringTask;
  *((_WORD *)v2 + 28) = 1;
  *((_WORD *)v2 + 22) = m_nBurstLength;
  *((_DWORD *)v2 + 12) = 1065353216;
  *((_DWORD *)v2 + 13) = 0;
  *((_DWORD *)v2 + 10) = m_nDuration;
  v2[58] = this->m_bAimImmediate;
  return (CTask *)v2;
}
// 669698: using guessed type void *off_669698;

//----- (004E988C) --------------------------------------------------------
int __fastcall CTaskSimpleGunControl::GetTaskType(const CTaskSimpleGunControl *this)
{
  return 1020;
}

//----- (004E9894) --------------------------------------------------------
void __fastcall CTaskSimpleGunControl::Serialize(CTaskSimpleGunControl *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  CEntity *m_pTargetEntity; // r0
  int v5; // r6
  _DWORD *v6; // r5
  CEntity *v7; // r0
  int v8; // r1
  i