PlayerPed = FindPlayerPed(-1);
      if ( CPedGroupMembership::IsMember(
             &CPedGroups::ms_groups[PlayerPed->m_pPlayerData->m_PlayerGroup].m_membership,
             pPed)
        && (unsigned int)(pPed->m_eMoveState - 5) <= 2
        && !((CTimer::m_FrameCounter + pPed->RandomSeed) << 18) )
      {
        CPed::Say(pPed, 0x5Bu, 0, 1.0, 0, 0, 0);
      }
    }
  }
  return m_pSubTask;
}
// 14: using guessed type int dword_14;

//----- (0035E18C) --------------------------------------------------------
CTask *__fastcall CTaskComplexSeekEntity<CEntitySeekPosCalculatorRadiusAngleOffset>::CreateSubTask(
        const CTaskComplexSeekEntity<CEntitySeekPosCalculatorRadiusAngleOffset> *this,
        const int iSubTaskType,
        CPed *pPed)
{
  CTaskComplexFollowNodeRoute *v5; // r4
  int v6; // r8
  CTaskComplexTurnToFaceEntityOrCoord *v7; // r6
  CTaskSimpleStandStill *v8; // r5
  int m_iMoveState; // r8
  CVector vSeekPos; // [sp+14h] [bp-24h] BYREF

  v5 = 0;
  if ( iSubTaskType > 718 )
  {
    if ( iSubTaskType > 905 )
    {
      if ( iSubTaskType == 906 )
      {
        v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x60u);
        m_iMoveState = this->m_iMoveState;
        CEntitySeekPosCalculatorRadiusAngleOffset::ComputeEntitySeekPos(
          &this->m_entitySeekPosCalculator,
          pPed,
          this->m_pEntity,
          &vSeekPos);
        CTaskComplexFollowNodeRoute::CTaskComplexFollowNodeRoute(
          v5,
          m_iMoveState,
          &vSeekPos,
          this->m_fTargetRadius,
          this->m_fSlowDownDistance,
          this->m_fFollowNodeThresholdHeightChange,
          0,
          -1,
          1);
      }
      else if ( iSubTaskType == 920 )
      {
        v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x28u);
        CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(
          (CTaskComplexTurnToFaceEntityOrCoord *)v5,
          this->m_pEntity,
          0.5,
          0.2);
      }
    }
    else if ( iSubTaskType == 719 )
    {
      v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x70u);
      CTaskSimpleCarDrive::CTaskSimpleCarDrive((CTaskSimpleCarDrive *)v5, pPed->m_pMyVehicle, 0, 0);
      v5[1]._vptr$CTask = (int (**)(void))(elf_hash_bucket + 1748);
      LOWORD(v5[1].m_vTarget.x) = 0;
      v5[1].m_pParent = 0;
      v5[1].m_pSubTask = 0;
      v5->_vptr$CTask = (int (**)(void))&off_66571C;
    }
    else if ( iSubTaskType == 903 )
    {
      v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x28u);
      v6 = this->m_iMoveState;
      CEntitySeekPosCalculatorRadiusAngleOffset::ComputeEntitySeekPos(
        &this->m_entitySeekPosCalculator,
        pPed,
        this->m_pEntity,
        &vSeekPos);
      CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(
        (CTaskComplexGoToPointAndStandStill *)v5,
        v6,
        &vSeekPos,
        this->m_fTargetRadius,
        this->m_fSlowDownDistance,
        0,
        0);
      LOBYTE(v5->m_fFollowNodeThresholdHeightChange) = *((_BYTE *)this + 80) & 8 | LOBYTE(v5->m_fFollowNodeThresholdHeightChange) & 0xF7;
    }
  }
  else if ( iSubTaskType > 243 )
  {
    if ( iSubTaskType == 244 )
    {
      v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x40u);
      CTaskComplexSequence::CTaskComplexSequence((CTaskComplexSequence *)v5);
      if ( (*((_BYTE *)this + 80) & 2) != 0 )
      {
        v7 = (CTaskComplexTurnToFaceEntityOrCoord *)CTask::operator new(0x28u);
        CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(v7, this->m_pEntity, 0.5, 0.2);
        CTaskComplexSequence::AddTask((CTaskComplexSequence *)v5, v7);
      }
      v8 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
      CTaskSimpleStandStill::CTaskSimpleStandStill(v8, 100, 0, 0, 8.0);
      CTaskComplexSequence::AddTask((CTaskComplexSequence *)v5, v8);
    }
    else if ( iSubTaskType == 704 )
    {
      v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar((CTaskComplexLeaveCar *)v5, pPed->m_pMyVehicle, 0, 0, 1, 0);
    }
  }
  else if ( iSubTaskType == 203 )
  {
    v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x20u);
    CTaskSimpleStandStill::CTaskSimpleStandStill((CTaskSimpleStandStill *)v5, 2000, 0, 0, 8.0);
  }
  else if ( iSubTaskType == 219 )
  {
    v5 = (CTaskComplexFollowNodeRoute *)CTask::operator new(0x1Cu);
    CTaskSimpleTired::CTaskSimpleTired((CTaskSimpleTired *)v5, 1000);
  }
  return v5;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 66571C: using guessed type void *off_66571C;

//----- (0035E3A0) --------------------------------------------------------
void CSetPieces::Init()
{
  CSetPieces::bDebug = 0;
  CSetPieces::NumSetPieces = 0;
}

//----- (0035E3BC) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CSetPieces::AddOne(
        UInt8 Type,
        CVector2D ActivationAreaMin,
        CVector2D ActivationAreaMax,
        CVector2D GenerationCoors1,
        CVector2D HelperPoint1,
        CVector2D GenerationCoors2,
        CVector2D HelperPoint2)
{
  float32x2_t v7; // d4
  float32x2_t v8; // d5
  Int32 v9; // r12
  float32x4_t v10; // q1
  float32x4_t v11; // q0
  CSetPiece *v12; // r1

  v9 = CSetPieces::NumSetPieces;
  if ( CSetPieces::NumSetPieces <= 209 )
  {
    v8.n64_u32[0] = LODWORD(ActivationAreaMin.x);
    v7.n64_u32[0] = LODWORD(ActivationAreaMax.x);
    v10.n128_u32[2] = vmax_f32(v8, v7).n64_u32[0];
    v10.n128_u32[0] = vmin_f32(v8, v7).n64_u32[0];
    v8.n64_u32[0] = LODWORD(ActivationAreaMin.y);
    *(CVector2D *)&v11.n128_i8[8] = GenerationCoors2;
    v7.n64_u32[0] = LODWORD(ActivationAreaMax.y);
    v11.n128_u64[0] = (unsigned __int64)GenerationCoors1;
    v12 = &CSetPieces::aSetPieces[CSetPieces::NumSetPieces];
    v10.n128_u32[1] = vmin_f32(v8, v7).n64_u32[0];
    v10.n128_u32[3] = vmax_f32(v8, v7).n64_u32[0];
    *(int16x4_t *)&v12->iActivationAreaMinX = vmovn_s32(vcvtq_n_s32_f32(v10, 2u));
    *(int16x4_t *)&v12->iGenerationCoors1X = vmovn_s32(vcvtq_n_s32_f32(v11, 2u));
    v12->Type = Type;
    v12->iHelperPoint1X = (int)(float)(HelperPoint1.x * 4.0);
    v12->iHelperPoint1Y = (int)(float)(HelperPoint1.y * 4.0);
    v12->iHelperPoint2X = (int)(float)(HelperPoint2.x * 4.0);
    v12->iHelperPoint2Y = (int)(float)(HelperPoint2.y * 4.0);
    CSetPieces::NumSetPieces = v9 + 1;
  }
}
// 35E3BC: fragmented variable at 0:r3.4,4:^28.4 may be wrong
// 35E3BC: variables would overlap: 0:r3.4,4:^28.4 and ^28.4

//----- (0035E4AC) --------------------------------------------------------
void CSetPieces::Update()
{
  UInt32 v0; // r8
  int v1; // r6
  CSetPiece *v2; // r4

  v0 = (CTimer::m_FrameCounter & 7) + 1;
  v1 = (int)((CTimer::m_FrameCounter & 7) * CSetPieces::NumSetPieces) / 8;
  if ( v1 < (int)(CSetPieces::NumSetPieces * v0) / 8 )
  {
    v2 = &CSetPieces::aSetPieces[v1];
    do
    {
      CSetPiece::Update(v2++);
      ++v1;
    }
    while ( v1 < (int)(CSetPieces::NumSetPieces * v0) / 8 );
  }
}

//----- (0035E528) --------------------------------------------------------
void __fastcall CSetPiece::Update(CSetPiece *this)
{
  UInt32 LastActivationTime; // r0
  char *CopCar; // r5
  CAutomobile *v4; // r6
  char v5; // r0
  unsigned int v6; // r8
  unsigned int v7; // r0
  float iHelperPoint1Y; // s0
  float iHelperPoint1X; // s2
  CEntity::CEntityInfo m_info; // r0
  float iHelperPoint2Y; // s0
  float iHelperPoint2X; // s2
  UInt32 v13; // r0
  int iGenerationCoors1X; // r5
  float x; // s18
  float v16; // s20
  float v17; // s22
  CAutomobile *v18; // r0
  int v19; // r5
  float v20; // s18
  float v21; // s20
  float v22; // s22
  CVector2D v23; // r1
  CCopPed *CopPed; // r5
  float GroundZForCoord; // r8
  int v26; // r2
  int v27; // r3
  int v28; // r1
  uint32 v29; // r6
  CTaskComplexGoToPointAndStandStill *v30; // r10
  float v31; // s0
  float v32; // s2
  CPedIntelligence *m_pPedIntelligence; // r8
  char *v34; // r5
  CVector2D v35; // r1
  float v36; // r9
  int v37; // r3
  int v38; // r2
  int v39; // r6
  uint32 v40; // r0
  CTaskComplexGoToPointAndStandStill *v41; // r10
  float v42; // s0
  float v43; // s2
  int v44; // r9
  char *v45; // r6
  CVector2D v46; // r1
  CCopPed *v47; // r6
  float v48; // r9
  int v49; // r2
  int v50; // r3
  int v51; // r1
  uint32 v52; // r5
  CTaskComplexGoToPointAndStandStill *v53; // r5
  float v54; // s0
  float v55; // s2
  CPedIntelligence *v56; // r8
  char *v57; // r6
  int v58; // r5
  float v59; // s18
  float v60; // s20
  float v61; // s22
  CAutomobile *v62; // r0
  CEntity::CEntityInfo v63; // r2
  uint32 v64; // r1
  float *p_xx; // r3
  RwReal v66; // s6
  RwReal v67; // s0
  int iGenerationCoors2X; // r5
  float v69; // s18
  float v70; // s20
  float v71; // s22
  __int16 v72; // r2
  int v73; // r5
  float v74; // s18
  float v75; // s20
  float v76; // s22
  CAutomobile *v77; // r0
  CEntity::CEntityInfo v78; // r2
  uint32 v79; // r1
  float *v80; // r3
  RwReal v81; // s6
  RwReal v82; // s0
  int v83; // r5
  float v84; // s18
  float v85; // s20
  float v86; // s22
  CEntity::CEntityInfo v87; // r2
  uint32 v88; // r1
  float *v89; // r3
  RwReal v90; // s6
  RwReal v91; // s0
  CVector v92; // [sp+Ch] [bp-74h] BYREF
  CVector vTarget; // [sp+18h] [bp-68h] BYREF
  CVector v94; // [sp+24h] [bp-5Ch] BYREF

  LastActivationTime = this->LastActivationTime;
  if ( !LastActivationTime || CTimer::m_snTimeInMilliseconds > LastActivationTime + 40000 )
  {
    FindPlayerCoors(&v94, -1);
    if ( v94.x >= (float)((float)this->iActivationAreaMinX * 0.25)
      && v94.x <= (float)((float)this->iActivationAreaMaxX * 0.25)
      && v94.y >= (float)((float)this->iActivationAreaMinY * 0.25)
      && v94.y <= (float)((float)this->iActivationAreaMaxY * 0.25) )
    {
      switch ( this->Type )
      {
        case 1u:
        case 8u:
          if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL1 && !FindPlayerVehicle(-1, 0) )
          {
            CopCar = (char *)CSetPiece::TryToGenerateCopCar(
                               this->iGenerationCoors1X,
                               (float)this->iGenerationCoors1X * 0.25,
                               (float)this->iGenerationCoors1Y * 0.25,
                               (float)this->iHelperPoint1X * 0.25,
                               (float)this->iHelperPoint1Y * 0.25);
            if ( CopCar )
            {
              v4 = CSetPiece::TryToGenerateCopCar(
                     this->iGenerationCoors2X,
                     (float)this->iGenerationCoors2X * 0.25,
                     (float)this->iGenerationCoors2Y * 0.25,
                     (float)this->iHelperPoint2X * 0.25,
                     (float)this->iHelperPoint2Y * 0.25);
              if ( !v4 )
                goto LABEL_55;
              v5 = CopCar[58];
              v6 = 4;
              CopCar[980] = 4;
              CopCar[58] = v5 & 7 | 0x18;
              v7 = 4;
              if ( this->Type == 8 )
                v7 = 24;
              *(_WORD *)(CopCar + 957) = 6145;
              CopCar[980] = v7;
              *((float *)CopCar + 243) = (float)v7;
              iHelperPoint1Y = (float)this->iHelperPoint1Y;
              iHelperPoint1X = (float)this->iHelperPoint1X;
              *((_DWORD *)CopCar + 254) = 0;
              *((float *)CopCar + 252) = iHelperPoint1X * 0.25;
              *((float *)CopCar + 253) = iHelperPoint1Y * 0.25;
              *((_DWORD *)CopCar + 312) = CTimer::m_snTimeInMilliseconds + 25000;
              CCarAI::AddPoliceCarOccupants((CVehicle *)CopCar, 0);
              m_info = v4->m_info;
              v4->AutoPilot.CruiseSpeed = 4;
              v4->m_info = (CEntity::CEntityInfo)(*(_BYTE *)&m_info & 7 | 0x18);
              if ( this->Type == 8 )
                v6 = 24;
              *(_WORD *)&v4->AutoPilot.DrivingMode = 6145;
              v4->AutoPilot.CruiseSpeed = v6;
              v4->AutoPilot.ActualSpeed = (float)v6;
              iHelperPoint2Y = (float)this->iHelperPoint2Y;
              iHelperPoint2X = (float)this->iHelperPoint2X;
              v4->AutoPilot.TargetCoors.z = 0.0;
              v4->AutoPilot.TargetCoors.x = iHelperPoint2X * 0.25;
              v4->AutoPilot.TargetCoors.y = iHelperPoint2Y * 0.25;
              v4->DontUseSmallerRemovalRange = CTimer::m_snTimeInMilliseconds + 25000;
              CCarAI::AddPoliceCarOccupants(v4, 0);
              v13 = CTimer::m_snTimeInMilliseconds;
              goto LABEL_54;
            }
          }
          break;
        case 2u:
          if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL2 )
          {
            if ( FindPlayerVehicle(-1, 0) )
            {
              FindPlayerCoors(&vTarget, -1);
              iGenerationCoors1X = this->iGenerationCoors1X;
              x = vTarget.x;
              v16 = FindPlayerSpeed(-1)->x;
              FindPlayerCoors(&v92, -1);
              v17 = v92.y - (float)((float)this->iGenerationCoors1Y * 0.25);
              if ( (float)((float)(v16 * (float)(x - (float)((float)iGenerationCoors1X * 0.25)))
                         + (float)(FindPlayerSpeed(-1)->y * v17)) < 0.0 )
              {
                v18 = CSetPiece::TryToGenerateCopCar(
                        this->iGenerationCoors1X,
                        (float)this->iGenerationCoors1X * 0.25,
                        (float)this->iGenerationCoors1Y * 0.25,
                        (float)this->iHelperPoint1X * 0.25,
                        (float)this->iHelperPoint1Y * 0.25);
                if ( v18 )
                  goto LABEL_44;
              }
            }
          }
          break;
        case 3u:
          if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL2 )
          {
            if ( FindPlayerVehicle(-1, 0) )
            {
              FindPlayerCoors(&vTarget, -1);
              v19 = this->iGenerationCoors1X;
              v20 = vTarget.x;
              v21 = FindPlayerSpeed(-1)->x;
              FindPlayerCoors(&v92, -1);
              v22 = v92.y - (float)((float)this->iGenerationCoors1Y * 0.25);
              if ( (float)((float)(v21 * (float)(v20 - (float)((float)v19 * 0.25)))
                         + (float)(FindPlayerSpeed(-1)->y * v22)) < 0.0 )
              {
                v18 = CSetPiece::TryToGenerateCopCar(
                        this->iGenerationCoors1X,
                        (float)this->iGenerationCoors1X * 0.25,
                        (float)this->iGenerationCoors1Y * 0.25,
                        (float)this->iHelperPoint1X * 0.25,
                        (float)this->iHelperPoint1Y * 0.25);
                if ( v18 )
                  goto LABEL_52;
              }
            }
          }
          break;
        case 4u:
          if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL1 && !FindPlayerVehicle(-1, 0) )
          {
            v23.x = (float)this->iGenerationCoors1X * 0.25;
            v23.y = (float)this->iGenerationCoors1Y * 0.25;
            CopPed = CSetPiece::TryToGenerateCopPed((CSetPiece *)this->iGenerationCoors1X, v23);
            if ( CopPed )
            {
              GroundZForCoord = CWorld::FindGroundZForCoord(
                                  (float)this->iHelperPoint1X * 0.25,
                                  (float)this->iHelperPoint1Y * 0.25);
              v26 = *((_DWORD *)&CopPed->m_nPedFlags + 2);
              v27 = *((_DWORD *)&CopPed->m_nPedFlags + 3);
              v28 = *((_DWORD *)&CopPed->m_nPedFlags + 1) | 0x40;
              v29 = CTimer::m_snTimeInMilliseconds;
              *(_DWORD *)&CopPed->m_nPedFlags = CopPed->m_nPedFlags;
              *((_DWORD *)&CopPed->m_nPedFlags + 1) = v28;
              *((_DWORD *)&CopPed->m_nPedFlags + 2) = v26;
              *((_DWORD *)&CopPed->m_nPedFlags + 3) = v27;
              CopPed->DontUseSmallerRemovalRange = v29 + 10000;
              v30 = (CTaskComplexGoToPointAndStandStill *)CTask::operator new(0x28u);
              v31 = (float)this->iHelperPoint1Y;
              v32 = (float)this->iHelperPoint1X;
              vTarget.z = GroundZForCoord;
              vTarget.y = v31 * 0.25;
              vTarget.x = v32 * 0.25;
              CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(v30, 6, &vTarget, 0.5, 2.0, 0, 0);
              m_pPedIntelligence = CopPed->m_pPedIntelligence;
              v34 = (char *)CTask::operator new(0x50u);
              CTaskComplexWander::CTaskComplexWander((CTaskComplexWander *)v34, 4, 0, 1, 0.5);
              *((_QWORD *)v34 + 7) = 0LL;
              *((_QWORD *)v34 + 8) = 0LL;
              *(_DWORD *)(v34 + 70) = 0;
              *((_DWORD *)v34 + 11) = 0;
              *((_DWORD *)v34 + 12) = 0;
              *((_WORD *)v34 + 26) = 0;
              *(_DWORD *)(v34 + 74) = 0;
              *(_DWORD *)v34 = &off_66590C;
              *((_DWORD *)v34 + 10) = v30;
              CTaskManager::SetTask(&m_pPedIntelligence->m_taskManager, (CTask *)v34, 3, 0);
              v13 = CTimer::m_snTimeInMilliseconds;
              goto LABEL_54;
            }
          }
          break;
        case 5u:
          if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL1 && !FindPlayerVehicle(-1, 0) )
          {
            v35.x = (float)this->iGenerationCoors1X * 0.25;
            v35.y = (float)this->iGenerationCoors1Y * 0.25;
            CopCar = (char *)CSetPiece::TryToGenerateCopPed((CSetPiece *)this->iGenerationCoors1X, v35);
            if ( CopCar )
            {
              v36 = CWorld::FindGroundZForCoord((float)this->iHelperPoint1X * 0.25, (float)this->iHelperPoint1Y * 0.25);
              v37 = *((_DWORD *)CopCar + 291);
              v38 = *((_DWORD *)CopCar + 290) | 0x40;
              v39 = *((_DWORD *)CopCar + 292);
              v40 = CTimer::m_snTimeInMilliseconds;
              *((_DWORD *)CopCar + 289) = *((_DWORD *)CopCar + 289);
              *((_DWORD *)CopCar + 290) = v38;
              *((_DWORD *)CopCar + 291) = v37;
              *((_DWORD *)CopCar + 292) = v39;
              *((_DWORD *)CopCar + 340) = v40 + 10000;
              v41 = (CTaskComplexGoToPointAndStandStill *)CTask::operator new(0x28u);
              v42 = (float)this->iHelperPoint1Y;
              v43 = (float)this->iHelperPoint1X;
              vTarget.z = v36;
              vTarget.y = v42 * 0.25;
              vTarget.x = v43 * 0.25;
              CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(v41, 6, &vTarget, 0.5, 2.0, 0, 0);
              v44 = *((_DWORD *)CopCar + 272);
              v45 = (char *)CTask::operator new(0x50u);
              CTaskComplexWander::CTaskComplexWander((CTaskComplexWander *)v45, 4, 0, 1, 0.5);
              *((_QWORD *)v45 + 7) = 0LL;
              *((_QWORD *)v45 + 8) = 0LL;
              *(_DWORD *)(v45 + 70) = 0;
              *((_DWORD *)v45 + 11) = 0;
              *((_DWORD *)v45 + 12) = 0;
              *((_WORD *)v45 + 26) = 0;
              *(_DWORD *)(v45 + 74) = 0;
              *(_DWORD *)v45 = &off_66590C;
              *((_DWORD *)v45 + 10) = v41;
              CTaskManager::SetTask((CTaskManager *)(v44 + 4), (CTask *)v45, 3, 0);
              v46.x = (float)this->iGenerationCoors2X * 0.25;
              v46.y = (float)this->iGenerationCoors2Y * 0.25;
              v47 = CSetPiece::TryToGenerateCopPed((CSetPiece *)this->iGenerationCoors2X, v46);
              if ( v47 )
              {
                v48 = CWorld::FindGroundZForCoord(
                        (float)this->iHelperPoint2X * 0.25,
                        (float)this->iHelperPoint2Y * 0.25);
                v49 = *((_DWORD *)&v47->m_nPedFlags + 2);
                v50 = *((_DWORD *)&v47->m_nPedFlags + 3);
                v51 = *((_DWORD *)&v47->m_nPedFlags + 1) | 0x40;
                v52 = CTimer::m_snTimeInMilliseconds;
                *(_DWORD *)&v47->m_nPedFlags = v47->m_nPedFlags;
                *((_DWORD *)&v47->m_nPedFlags + 1) = v51;
                *((_DWORD *)&v47->m_nPedFlags + 2) = v49;
                *((_DWORD *)&v47->m_nPedFlags + 3) = v50;
                v47->DontUseSmallerRemovalRange = v52 + 10000;
                v53 = (CTaskComplexGoToPointAndStandStill *)CTask::operator new(0x28u);
                v54 = (float)this->iHelperPoint1Y;
                v55 = (float)this->iHelperPoint1X;
                vTarget.z = v48;
                vTarget.y = v54 * 0.25;
                vTarget.x = v55 * 0.25;
                CTaskComplexGoToPointAndStandStill::CTaskComplexGoToPointAndStandStill(v53, 6, &vTarget, 0.5, 2.0, 0, 0);
                v56 = v47->m_pPedIntelligence;
                v57 = (char *)CTask::operator new(0x50u);
                CTaskComplexWander::CTaskComplexWander((CTaskComplexWander *)v57, 4, 0, 1, 0.5);
                *((_QWORD *)v57 + 7) = 0LL;
                *((_QWORD *)v57 + 8) = 0LL;
                *(_DWORD *)(v57 + 70) = 0;
                *((_DWORD *)v57 + 11) = 0;
                *((_DWORD *)v57 + 12) = 0;
                *((_WORD *)v57 + 26) = 0;
                *(_DWORD *)(v57 + 74) = 0;
                *(_DWORD *)v57 = &off_66590C;
                *((_DWORD *)v57 + 10) = v53;
                CTaskManager::SetTask(&v56->m_taskManager, (CTask *)v57, 3, 0);
                v13 = CTimer::m_snTimeInMilliseconds;
                goto LABEL_54;
              }
LABEL_55:
              CWorld::Remove((CEntity *)CopCar);
              (*(void (__fastcall **)(char *))(*(_DWORD *)CopCar + 4))(CopCar);
            }
          }
          break;
        case 6u:
          if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL2 && FindPlayerVehicle(-1, 0) )
          {
            FindPlayerCoors(&vTarget, -1);
            v58 = this->iGenerationCoors1X;
            v59 = vTarget.x;
            v60 = FindPlayerSpeed(-1)->x;
            FindPlayerCoors(&v92, -1);
            v61 = v92.y - (float)((float)this->iGenerationCoors1Y * 0.25);
            if ( (float)((float)(v60 * (float)(v59 - (float)((float)v58 * 0.25))) + (float)(FindPlayerSpeed(-1)->y * v61)) < 0.0 )
            {
              v62 = CSetPiece::TryToGenerateCopCar(
                      this->iGenerationCoors1X,
                      (float)this->iGenerationCoors1X * 0.25,
                      (float)this->iGenerationCoors1Y * 0.25,
                      (float)this->iHelperPoint1X * 0.25,
                      (float)this->iHelperPoint1Y * 0.25);
              if ( v62 )
              {
                v62->AutoPilot.CruiseSpeed = 16;
                *(_WORD *)&v62->AutoPilot.DrivingMode = 6659;
                v63 = v62->m_info;
                v62->AutoPilot.TempAction = 9;
                v62->m_info = (CEntity::CEntityInfo)(*(_BYTE *)&v63 & 7 | 0x18);
                v64 = CTimer::m_snTimeInMilliseconds;
                p_xx = &v62->m_pMat->xx;
                v62->DontUseSmallerRemovalRange = CTimer::m_snTimeInMilliseconds + 10000;
                v62->AutoPilot.TempActionFinish = v64 + 100;
                v66 = p_xx[6] * 0.66667;
                v67 = p_xx[5] * 0.66667;
                v62->m_vecMoveSpeed.x = p_xx[4] * 0.66667;
                v62->m_vecMoveSpeed.y = v67;
                v62->m_vecMoveSpeed.z = v66;
                CCarAI::AddPoliceCarOccupants(v62, 0);
                this->LastActivationTime = CTimer::m_snTimeInMilliseconds;
              }
            }
            FindPlayerCoors(&vTarget, -1);
            iGenerationCoors2X = this->iGenerationCoors2X;
            v69 = vTarget.x;
            v70 = FindPlayerSpeed(-1)->x;
            FindPlayerCoors(&v92, -1);
            v71 = v92.y - (float)((float)this->iGenerationCoors2Y * 0.25);
            if ( (float)((float)(v70 * (float)(v69 - (float)((float)iGenerationCoors2X * 0.25)))
                       + (float)(FindPlayerSpeed(-1)->y * v71)) < 0.0 )
            {
              v18 = CSetPiece::TryToGenerateCopCar(
                      this->iGenerationCoors2X,
                      (float)this->iGenerationCoors2X * 0.25,
                      (float)this->iGenerationCoors2Y * 0.25,
                      (float)this->iHelperPoint2X * 0.25,
                      (float)this->iHelperPoint2Y * 0.25);
              if ( v18 )
              {
LABEL_44:
                v18->AutoPilot.CruiseSpeed = 16;
                v72 = 6659;
                goto LABEL_53;
              }
            }
          }
          break;
        case 7u:
          if ( FindPlayerPed(-1)->m_pPlayerData->m_Wanted->m_WantedLevel >= WANTED_LEVEL2 && FindPlayerVehicle(-1, 0) )
          {
            FindPlayerCoors(&vTarget, -1);
            v73 = this->iGenerationCoors1X;
            v74 = vTarget.x;
            v75 = FindPlayerSpeed(-1)->x;
            FindPlayerCoors(&v92, -1);
            v76 = v92.y - (float)((float)this->iGenerationCoors1Y * 0.25);
            if ( (float)((float)(v75 * (float)(v74 - (float)((float)v73 * 0.25))) + (float)(FindPlayerSpeed(-1)->y * v76)) < 0.0 )
            {
              v77 = CSetPiece::TryToGenerateCopCar(
                      this->iGenerationCoors1X,
                      (float)this->iGenerationCoors1X * 0.25,
                      (float)this->iGenerationCoors1Y * 0.25,
                      (float)this->iHelperPoint1X * 0.25,
                      (float)this->iHelperPoint1Y * 0.25);
              if ( v77 )
              {
                v77->AutoPilot.CruiseSpeed = 16;
                *(_WORD *)&v77->AutoPilot.DrivingMode = 770;
                v78 = v77->m_info;
                v77->AutoPilot.TempAction = 9;
                v77->m_info = (CEntity::CEntityInfo)(*(_BYTE *)&v78 & 7 | 0x18);
                v79 = CTimer::m_snTimeInMilliseconds;
                v80 = &v77->m_pMat->xx;
                v77->DontUseSmallerRemovalRange = CTimer::m_snTimeInMilliseconds + 10000;
                v77->AutoPilot.TempActionFinish = v79 + 100;
                v81 = v80[6] * 0.66667;
                v82 = v80[5] * 0.66667;
                v77->m_vecMoveSpeed.x = v80[4] * 0.66667;
                v77->m_vecMoveSpeed.y = v82;
                v77->m_vecMoveSpeed.z = v81;
                CCarAI::AddPoliceCarOccupants(v77, 0);
                this->LastActivationTime = CTimer::m_snTimeInMilliseconds;
              }
            }
            FindPlayerCoors(&vTarget, -1);
            v83 = this->iGenerationCoors2X;
            v84 = vTarget.x;
            v85 = FindPlayerSpeed(-1)->x;
            FindPlayerCoors(&v92, -1);
            v86 = v92.y - (float)((float)this->iGenerationCoors2Y * 0.25);
            if ( (float)((float)(v85 * (float)(v84 - (float)((float)v83 * 0.25))) + (float)(FindPlayerSpeed(-1)->y * v86)) < 0.0 )
            {
              v18 = CSetPiece::TryToGenerateCopCar(
                      this->iGenerationCoors2X,
                      (float)this->iGenerationCoors2X * 0.25,
                      (float)this->iGenerationCoors2Y * 0.25,
                      (float)this->iHelperPoint2X * 0.25,
                      (float)this->iHelperPoint2Y * 0.25);
              if ( v18 )
              {
LABEL_52:
                v18->AutoPilot.CruiseSpeed = 16;
                v72 = 770;
LABEL_53:
                *(_WORD *)&v18->AutoPilot.DrivingMode = v72;
                v87 = v18->m_info;
                v18->AutoPilot.TempAction = 9;
                v18->m_info = (CEntity::CEntityInfo)(*(_BYTE *)&v87 & 7 | 0x18);
                v88 = CTimer::m_snTimeInMilliseconds;
                v89 = &v18->m_pMat->xx;
                v18->DontUseSmallerRemovalRange = CTimer::m_snTimeInMilliseconds + 10000;
                v18->AutoPilot.TempActionFinish = v88 + 100;
                v90 = v89[6] * 0.66667;
                v91 = v89[5] * 0.66667;
                v18->m_vecMoveSpeed.x = v89[4] * 0.66667;
                v18->m_vecMoveSpeed.y = v91;
                v18->m_vecMoveSpeed.z = v90;
                CCarAI::AddPoliceCarOccupants(v18, 0);
                v13 = CTimer::m_snTimeInMilliseconds;
LABEL_54:
                this->LastActivationTime = v13;
              }
            }
          }
          break;
        default:
          return;
      }
    }
  }
}
// 66590C: using guessed type void *;

//----- (0035F360) --------------------------------------------------------
CAutomobile *__fastcall CSetPiece::TryToGenerateCopCar(int a1, float a2, float a3, float a4, float a5)
{
  int DefaultCopCarModel; // r5
  int v9; // r6
  CAutomobile *v10; // r4
  float z; // s20
  RwReal y; // r1
  Int16 pNum; // [sp+1Eh] [bp-82h] BYREF
  CEntity *refEntityPtr; // [sp+20h] [bp-80h] BYREF
  CColPoint colPoint; // [sp+24h] [bp-7Ch] BYREF
  CVector v17; // [sp+50h] [bp-50h] BYREF
  CVector vecStart; // [sp+5Ch] [bp-44h] BYREF

  DefaultCopCarModel = CStreaming::GetDefaultCopCarModel(1u);
  v9 = 0;
  if ( DefaultCopCarModel >= 0 )
  {
    v10 = (CAutomobile *)CVehicle::operator new(0x99Cu);
    CAutomobile::CAutomobile(v10, DefaultCopCarModel, 1u, 1u);
    vecStart.x = a2;
    vecStart.y = a3;
    vecStart.z = 1000.0;
    if ( CWorld::ProcessVerticalLine(&vecStart, -1000.0, &colPoint, &refEntityPtr, 1, 0, 0, 0, 1, 0, 0) )
    {
      z = colPoint.m_vecPosition.z;
      vecStart.z = z + (*((float (__fastcall **)(CAutomobile *))v10->_vptr$CPlaceable + 54))(v10);
    }
    v17.z = 0.0;
    v17.y = a5 - a3;
    v17.x = a4 - a2;
    CVector::Normalise(&v17);
    v10->m_pMat->xy = v17.x;
    y = v17.y;
    v10->m_pMat->yy = v17.y;
    v10->m_pMat->zy = 0.0;
    v10->m_pMat->xx = y;
    v10->m_pMat->yx = -v17.x;
    v10->m_pMat->zx = 0.0;
    v10->m_pMat->xz = 0.0;
    v10->m_pMat->yz = 0.0;
    v10->m_pMat->zz = 1.0;
    *(CVector *)&v10->m_pMat->tx = vecStart;
    CWorld::FindObjectsKindaColliding(
      &vecStart,
      CModelInfo::ms_modelInfoPtrs[v10->m_nModelIndex]->m_pColModel->m_sphereBound.m_fRadius,
      0,
      &pNum,
      16,
      0,
      0,
      1,
      1,
      0,
      0);
    if ( pNum )
    {
      (*((void (__fastcall **)(CAutomobile *))v10->_vptr$CPlaceable + 1))(v10);
      return 0;
    }
    else
    {
      CVehicle::ChangeLawEnforcerState(v10, 1u);
      CWorld::Add(v10);
      return v10;
    }
  }
  return (CAutomobile *)v9;
}

//----- (0035F4C0) --------------------------------------------------------
CCopPed *__fastcall CSetPiece::TryToGenerateCopPed(CSetPiece *this, CVector2D Coors)
{
  CCopPed *v2; // r4
  Int16 pNum; // [sp+22h] [bp-46h] BYREF
  CEntity *refEntityPtr; // [sp+24h] [bp-44h] BYREF
  CColPoint colPoint; // [sp+28h] [bp-40h] BYREF
  CVector vecStart; // [sp+54h] [bp-14h] BYREF

  vecStart.x = Coors.x;
  vecStart.y = Coors.y;
  vecStart.z = 1000.0;
  v2 = 0;
  if ( CWorld::ProcessVerticalLine(&vecStart, -1000.0, &colPoint, &refEntityPtr, 1, 0, 0, 0, 1, 0, 0) )
    vecStart.z = colPoint.m_vecPosition.z + 0.9;
  CWorld::FindObjectsKindaColliding(&vecStart, 0.6, 0, &pNum, 16, 0, 0, 1, 1, 0, 0);
  if ( !pNum )
  {
    v2 = (CCopPed *)CPed::operator new(0x7CCu);
    CCopPed::CCopPed(v2, COPTYPE_NORMAL);
    *(CVector *)&v2->m_pMat->tx = vecStart;
    CWorld::Add(v2);
  }
  return v2;
}

//----- (0035F568) --------------------------------------------------------
void __fastcall CTaskComplexWanderCop::~CTaskComplexWanderCop(CTaskComplexWanderCop *this)
{
  CTask *m_pTaskToPerform; // r0

  m_pTaskToPerform = this->m_pTaskToPerform;
  this->_vptr$CTask = (int (**)(void))&off_66C5D8;
  if ( m_pTaskToPerform )
    (*((void (__fastcall **)(CTask *))m_pTaskToPerform->_vptr$CTask + 1))(m_pTaskToPerform);
  sub_191BF4(this);
}
// 66C5D8: using guessed type void *;

//----- (0035F594) --------------------------------------------------------
void __fastcall CTaskComplexBeCop::~CTaskComplexBeCop(CTaskComplexBeCop *this)
{
  CTask *m_pTaskToPerform; // r0
  void *v3; // r0

  m_pTaskToPerform = this->m_pTaskToPerform;
  this->_vptr$CTask = (int (**)(void))&off_66C5D8;
  if ( m_pTaskToPerform )
    (*((void (__fastcall **)(CTask *))m_pTaskToPerform->_vptr$CTask + 1))(m_pTaskToPerform);
  CTaskComplexWander::~CTaskComplexWander(this);
  sub_197118(v3);
}
// 35F5BA: variable 'v3' is possibly undefined
// 66C5D8: using guessed type void *off_66C5D8;

//----- (0035F5C4) --------------------------------------------------------
CTask *__fastcall CTaskComplexBeCop::Clone(const CTaskComplexBeCop *this)
{
  CTask *m_pTaskToPerform; // r0
  int (**v3)(void); // r4
  CTaskComplexWander *v4; // r0
  CTask *result; // r0

  m_pTaskToPerform = this->m_pTaskToPerform;
  if ( m_pTaskToPerform )
    v3 = (int (**)(void))(*((int (__fastcall **)(CTask *))m_pTaskToPerform->_vptr$CTask + 2))(m_pTaskToPerform);
  else
    v3 = 0;
  v4 = (CTaskComplexWander *)CTask::operator new(0x50u);
  CTaskComplexWander::CTaskComplexWander(v4, this->m_iMoveState, this->m_iDir, 1, 0.5);
  result[7] = 0LL;
  result[8] = 0LL;
  *(CTask **)((char *)&result[8].m_pParent + 2) = 0;
  result[5].m_pParent = 0;
  result[6]._vptr$CTask = 0;
  LOWORD(result[6].m_pParent) = 0;
  *(int (***)(void))((char *)&result[9]._vptr$CTask + 2) = 0;
  result->_vptr$CTask = (int (**)(void))&off_66590C;
  result[5]._vptr$CTask = v3;
  return result;
}
// 35F606: variable 'result' is possibly undefined
// 66590C: using guessed type void *off_66590C;

//----- (0035F638) --------------------------------------------------------
int __fastcall CTaskComplexBeCop::GetTaskType(const CTaskComplexBeCop *this)
{
  return 1104;
}

//----- (0035F63E) --------------------------------------------------------
bool __fastcall CTaskComplex::MakeAbortable(CTaskComplex *this, CPed *pPed, const int iPriority, const CEvent *pEvent)
{
  return (*((int (__fastcall **)(CTask *, CPed *, const int, const CEvent *))this->m_pSubTask->_vptr$CTask + 7))(
           this->m_pSubTask,
           pPed,
           iPriority,
           pEvent);
}

//----- (0035F64A) --------------------------------------------------------
int __fastcall CTaskComplexWanderCop::GetWanderType(const CTaskComplexWanderCop *this)
{
  return 1;
}

//----- (0035F650) --------------------------------------------------------
int32 __fastcall CShopping::GetPriceSectionFromName(const unsigned __int8 *pSectionName)
{
  int v2; // r0
  int32 v3; // r1

  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[0]) )
    return 0;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[1]) )
    return 1;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[2]) )
    return 2;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[3]) )
    return 3;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[4]) )
    return 4;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[5]) )
    return 5;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[6]) )
    return 6;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[7]) )
    return 7;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[8]) )
    return 8;
  if ( !strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[9]) )
    return 9;
  v2 = strcasecmp((const char *)pSectionName, (const char *)CShopping::ms_sectionNames[10]);
  v3 = -1;
  if ( !v2 )
    return 10;
  return v3;
}

//----- (0035F770) --------------------------------------------------------
void CShopping::Init()
{
  gClothesHaveBeenStored = 0;
  CShopping::ms_numPriceModifiers = 0;
  CShopping::ms_numPrices = 0;
  CShopping::ms_numBuyableItems = 0;
  memset(CShopping::ms_bHasBought, 0, sizeof(CShopping::ms_bHasBought));
  memset(CShopping::ms_keys, 0, sizeof(CShopping::ms_keys));
  CShopping::LoadStats();
}
// 81FFB8: using guessed type char gClothesHaveBeenStored;

//----- (0035F7D8) --------------------------------------------------------
void CShopping::LoadStats()
{
  u_native v0; // r4
  const unsigned __int8 *NextSection; // r0
  int32 PriceSectionFromName; // r5
  char *Line; // r0
  int v4; // r1
  bool v5; // zf
  bool v6; // zf
  char *v7; // r0
  int32 UppercaseKey; // r0
  eWeaponType WeaponType; // r0
  uint32 v10; // r1
  uint32 v11; // r1
  char *v12; // r4
  char *v13; // r5
  char *v14; // r8
  int8 ChangingStatIndex; // r0
  uint32 v16; // r9
  CShopping::StatModifier *v17; // r10
  u_native v18; // [sp+2Ch] [bp-2Ch]
  int32 v19; // [sp+30h] [bp-28h]
  const char *v20; // [sp+34h] [bp-24h]
  int32 pIndex[8]; // [sp+38h] [bp-20h] BYREF

  v0 = CFileMgr::OpenFile("data\\shopping.dat", (const unsigned __int8 *)&dword_35F9A4);
  CShopping::FindSection(v0, "prices");
  CShopping::ms_numBuyableItems = 0;
  NextSection = CShopping::GetNextSection(v0);
  if ( NextSection )
  {
    v18 = v0;
    while ( 1 )
    {
      PriceSectionFromName = CShopping::GetPriceSectionFromName(NextSection);
      Line = (char *)CFileLoader::LoadLine(v0);
      if ( Line )
        break;
LABEL_27:
      NextSection = CShopping::GetNextSection(v0);
      if ( !NextSection )
        goto LABEL_28;
    }
    v19 = PriceSectionFromName;
    while ( 1 )
    {
      v4 = (unsigned __int8)*Line;
      v5 = v4 == 0;
      if ( *Line )
        v5 = v4 == 35;
      if ( v5 )
        goto LABEL_26;
      v6 = v4 == 101;
      if ( v4 == 101 )
        v6 = Line[1] == 110;
      if ( v6 && Line[2] == 100 )
        goto LABEL_27;
      v7 = strtok(Line, (const char *)&dword_35F9B0);
      if ( (unsigned int)(PriceSectionFromName - 4) < 3 )
        break;
      if ( PriceSectionFromName == 9 )
      {
        WeaponType = CWeaponInfo::FindWeaponType((const unsigned __int8 *)v7);
        v10 = CShopping::ms_numBuyableItems;
        CShopping::ms_keys[CShopping::ms_numBuyableItems] = WeaponType;
        CShopping::ms_bHasBought[v10] = 0;
        goto LABEL_23;
      }
      if ( PriceSectionFromName != 2 )
      {
        pIndex[0] = -1;
        CModelInfo::GetModelInfo((const unsigned __int8 *)v7, pIndex);
        UppercaseKey = pIndex[0];
        goto LABEL_22;
      }
      CShopping::ms_bHasBought[CShopping::ms_numBuyableItems] = 0;
LABEL_24:
      strtok(0, (const char *)&dword_35F9B0);
LABEL_25:
      v12 = strtok(0, (const char *)&dword_35F9B0);
      v20 = strtok(0, (const char *)&dword_35F9B0);
      v13 = strtok(0, (const char *)&dword_35F9B0);
      v14 = strtok(0, (const char *)&dword_35F9B0);
      ChangingStatIndex = GetChangingStatIndex((const unsigned __int8 *)v12);
      v16 = CShopping::ms_numBuyableItems;
      v17 = &CShopping::ms_statModifiers[CShopping::ms_numBuyableItems];
      v17->stat1 = ChangingStatIndex;
      v17->stat2 = GetChangingStatIndex((const unsigned __int8 *)v13);
      LOBYTE(v12) = atoi(v20);
      v17->stat2Change = atoi(v14);
      v17->stat1Change = (char)v12;
      CShopping::ms_numBuyableItems = v16 + 1;
      v0 = v18;
      PriceSectionFromName = v19;
LABEL_26:
      Line = (char *)CFileLoader::LoadLine(v0);
      if ( !Line )
        goto LABEL_27;
    }
    UppercaseKey = CKeyGen::GetUppercaseKey((const unsigned __int8 *)v7);
    pIndex[0] = UppercaseKey;
LABEL_22:
    v11 = CShopping::ms_numBuyableItems;
    CShopping::ms_keys[CShopping::ms_numBuyableItems] = UppercaseKey;
    CShopping::ms_bHasBought[v11] = 0;
    strtok(0, (const char *)&dword_35F9B0);
    if ( (unsigned int)(PriceSectionFromName - 4) >= 3 )
    {
      if ( PriceSectionFromName != 9 )
        goto LABEL_25;
      goto LABEL_24;
    }
LABEL_23:
    strtok(0, (const char *)&dword_35F9B0);
    goto LABEL_24;
  }
LABEL_28:
  CFileMgr::CloseFile(v0);
}
// 35F9A4: using guessed type int dword_35F9A4;
// 35F9B0: using guessed type int dword_35F9B0;
// 35F7D8: using guessed type int32 pIndex[8];

//----- (0035F9DC) --------------------------------------------------------
void CShopping::ShutdownForRestart()
{
  int32 AnimationBlockIndex; // r0

  CShopping::ms_shopLoaded[0] = 0;
  AnimationBlockIndex = CAnimManager::GetAnimationBlockIndex(CShopping::ms_sectionNames[CShopping::ms_priceSectionLoaded]);
  if ( AnimationBlockIndex != -1 )
    CStreaming::SetModelIsDeletable(AnimationBlockIndex + 25575);
  CShopping::ms_priceSectionLoaded = 0;
  CShopping::ms_numPriceModifiers = 0;
  memset(CShopping::ms_bHasBought, 0, sizeof(CShopping::ms_bHasBought));
}

//----- (0035FA48) --------------------------------------------------------
void CShopping::RemoveLoadedShop()
{
  int32 AnimationBlockIndex; // r0

  CShopping::ms_shopLoaded[0] = 0;
  AnimationBlockIndex = CAnimManager::GetAnimationBlockIndex(CShopping::ms_sectionNames[CShopping::ms_priceSectionLoaded]);
  if ( AnimationBlockIndex != -1 )
    CStreaming::SetModelIsDeletable(AnimationBlockIndex + 25575);
  CShopping::ms_priceSectionLoaded = 0;
}

//----- (0035FA94) --------------------------------------------------------
int32 __fastcall CShopping::GetItemIndex(uint32 key)
{
  int32 result; // r0

  result = 0;
  while ( CShopping::ms_keys[result] != key )
  {
    if ( result++ >= 559 )
      return -1;
  }
  return result;
}

//----- (0035FAC0) --------------------------------------------------------
uint32 __fastcall CShopping::GetKey(uint32 pTag, int32 section)
{
  int32 pIndex; // [sp+4h] [bp-Ch] BYREF

  if ( (unsigned int)(section - 4) < 3 )
  {
    pTag = CKeyGen::GetUppercaseKey((const unsigned __int8 *)pTag);
LABEL_6:
    pIndex = pTag;
    return pTag;
  }
  if ( section != 2 )
  {
    if ( section == 9 )
    {
      pTag = CWeaponInfo::FindWeaponType((const unsigned __int8 *)pTag);
      goto LABEL_6;
    }
    pIndex = -1;
    CModelInfo::GetModelInfo((const unsigned __int8 *)pTag, &pIndex);
    return pIndex;
  }
  return pTag;
}

//----- (0035FAFC) --------------------------------------------------------
int32 __fastcall GetStatFromChangingStatIndex(int32 index)
{
  return dword_60FF08[index];
}
// 60FF08: using guessed type _DWORD dword_60FF08[6];

//----- (0035FB0C) --------------------------------------------------------
int32 __fastcall GetChangingStatIndex(const unsigned __int8 *pString)
{
  int v2; // r1
  int32 result; // r0

  if ( !strcmp((const char *)&off_35FB80, (const char *)pString) )
    return -1;
  if ( !strcmp((const char *)&dword_35FB84, (const char *)pString) )
    return 0;
  if ( !strcmp("respect", (const char *)pString) )
    return 1;
  if ( !strcmp("sexy", (const char *)pString) )
    return 2;
  if ( !strcmp("health", (const char *)pString) )
    return 3;
  if ( !strcmp("stamina", (const char *)pString) )
    return 4;
  v2 = strcmp("calories", (const char *)pString);
  result = -1;
  if ( !v2 )
    return 5;
  return result;
}
// 35FB80: using guessed type void *off_35FB80;
// 35FB84: using guessed type int dword_35FB84;

//----- (0035FBB4) --------------------------------------------------------
bool __fastcall CShopping::FindSection(u_native fid, const unsigned __int8 *pSectionName)
{
  unsigned __int8 *Line; // r4
  int v5; // r11
  int v6; // r6
  bool v7; // zf
  bool v8; // zf
  char *v9; // r1

  Line = CFileLoader::LoadLine(fid);
  if ( !Line )
    return 0;
  v5 = 0;
  while ( 1 )
  {
    v6 = *Line;
    v7 = v6 == 0;
    if ( *Line )
      v7 = v6 == 35;
    if ( v7 )
      goto LABEL_17;
    if ( strncmp((const char *)Line, "section", 7u) )
    {
      v8 = v6 == 101;
      if ( v6 == 101 )
        v8 = Line[1] == 110;
      if ( v8 && Line[2] == 100 )
      {
        if ( v5 <= 0 )
          return 0;
        --v5;
      }
      goto LABEL_17;
    }
    strtok((char *)Line, (const char *)&off_35FC54);
    v9 = strtok(0, (const char *)&off_35FC54);
    if ( !v5 )
      break;
    ++v5;
LABEL_17:
    Line = CFileLoader::LoadLine(fid);
    if ( !Line )
      return 0;
  }
  v5 = 1;
  if ( strcasecmp((const char *)pSectionName, v9) )
    goto LABEL_17;
  return 1;
}
// 35FC54: using guessed type void *off_35FC54;

//----- (0035FC58) --------------------------------------------------------
const unsigned __int8 *__fastcall CShopping::GetNextSection(u_native fid)
{
  unsigned __int8 *Line; // r5
  int v3; // r6
  bool v4; // zf
  bool v5; // zf

  Line = CFileLoader::LoadLine(fid);
  if ( !Line )
    return 0;
  while ( 1 )
  {
    v3 = *Line;
    v4 = v3 == 0;
    if ( *Line )
      v4 = v3 == 35;
    if ( v4 )
      goto LABEL_11;
    if ( !strncmp((const char *)Line, "section", 7u) )
      break;
    v5 = v3 == 101;
    if ( v3 == 101 )
      v5 = Line[1] == 110;
    if ( v5 && Line[2] == 100 )
      return 0;
LABEL_11:
    Line = CFileLoader::LoadLine(fid);
    if ( !Line )
      return 0;
  }
  strtok((char *)Line, (const char *)&off_35FCC8);
  return (const unsigned __int8 *)sub_19F86C(0, (const char *)&off_35FCC8);
}
// 35FCC8: using guessed type void *off_35FCC8;

//----- (0035FCCC) --------------------------------------------------------
void __fastcall CShopping::LoadPrices(const unsigned __int8 *pSectionName)
{
  int32 PriceSectionFromName; // r4
  int32 AnimationBlockIndex; // r0
  u_native v4; // r9
  char *Line; // r0
  int v6; // r1
  bool v7; // zf
  bool v8; // zf
  char *v9; // r0
  int32 v10; // r1
  int32 WeaponType; // r0
  char *v12; // r0
  char *v13; // r0
  char *v14; // r4
  char *v15; // r6
  uint32 UppercaseKey; // r0
  CShopping::ItemPrice *v17; // r4
  char *v18; // r4
  char *v19; // r6
  int v20; // r0
  char *v21; // r0
  int v22; // r0
  int32 v23; // r1
  int32 v24; // r3
  CShopping::ItemPrice *v25; // r2
  uint32 *p_price; // r2
  int v27; // r0
  uint32 key; // r3
  int v29; // r6
  bool v30; // cc
  int32 v31; // r0
  int32 pIndex[8]; // [sp+48h] [bp-20h] BYREF

  PriceSectionFromName = CShopping::GetPriceSectionFromName(pSectionName);
  if ( PriceSectionFromName != CShopping::ms_priceSectionLoaded )
  {
    if ( CShopping::ms_priceSectionLoaded )
    {
      AnimationBlockIndex = CAnimManager::GetAnimationBlockIndex(CShopping::ms_sectionNames[CShopping::ms_priceSectionLoaded]);
      if ( AnimationBlockIndex != -1 )
        CStreaming::SetModelIsDeletable(AnimationBlockIndex + 25575);
      CShopping::ms_priceSectionLoaded = 0;
    }
    CShopping::ms_numPrices = 0;
    CShopping::ms_priceSectionLoaded = PriceSectionFromName;
    CShopping::ms_numItemsInShop = 0;
    CTimer::Suspend();
    v4 = CFileMgr::OpenFile("data\\shopping.dat", (const unsigned __int8 *)&dword_360014);
    if ( CShopping::FindSection(v4, "prices") )
      CShopping::FindSection(v4, pSectionName);
    Line = (char *)CFileLoader::LoadLine(v4);
    if ( Line )
    {
      while ( 1 )
      {
        v6 = (unsigned __int8)*Line;
        v7 = v6 == 0;
        if ( *Line )
          v7 = v6 == 35;
        if ( v7 )
          goto LABEL_42;
        v8 = v6 == 101;
        if ( v6 == 101 )
          v8 = Line[1] == 110;
        if ( v8 && Line[2] == 100 )
          goto LABEL_43;
        v9 = strtok(Line, (const char *)&dword_36001C);
        v10 = CShopping::ms_priceSectionLoaded - 4;
        if ( (unsigned int)(CShopping::ms_priceSectionLoaded - 4) < 3 )
          break;
        if ( CShopping::ms_priceSectionLoaded != 2 )
        {
          if ( CShopping::ms_priceSectionLoaded != 9 )
          {
            pIndex[0] = -1;
            CModelInfo::GetModelInfo((const unsigned __int8 *)v9, pIndex);
            v10 = pIndex[0];
            goto LABEL_23;
          }
          WeaponType = CWeaponInfo::FindWeaponType((const unsigned __int8 *)v9);
          goto LABEL_22;
        }
LABEL_23:
        CShopping::ms_prices[CShopping::ms_numPrices].key = v10;
        v12 = strtok(0, (const char *)&dword_36001C);
        strncpy((char *)CShopping::ms_prices[CShopping::ms_numPrices].nameTag, v12, 8u);
        if ( (unsigned int)(CShopping::ms_priceSectionLoaded - 4) < 2 )
        {
          v14 = strtok(0, (const char *)&dword_36001C);
          v15 = strtok(0, (const char *)&dword_36001C);
          UppercaseKey = CKeyGen::GetUppercaseKey((const unsigned __int8 *)v14);
          v17 = &CShopping::ms_prices[CShopping::ms_numPrices];
          v17->_anon_0.weapon.ammo = UppercaseKey;
          v17->_anon_0.clothes.type = atoi(v15);
        }
        else if ( CShopping::ms_priceSectionLoaded == 6 )
        {
          v18 = strtok(0, (const char *)&dword_36001C);
          v19 = strtok(0, (const char *)&dword_36001C);
          if ( *v18 == 45 )
            v20 = -1;
          else
            v20 = atoi(v18);
          CShopping::ms_prices[CShopping::ms_numPrices]._anon_0.weapon.ammo = v20;
          CShopping::ms_prices[CShopping::ms_numPrices]._anon_0.clothes.type = CKeyGen::GetUppercaseKey((const unsigned __int8 *)v19);
        }
        else if ( CShopping::ms_priceSectionLoaded == 9 )
        {
          v13 = strtok(0, (const char *)&dword_36001C);
          CShopping::ms_prices[CShopping::ms_numPrices]._anon_0.weapon.ammo = atoi(v13);
        }
        strtok(0, (const char *)&dword_36001C);
        strtok(0, (const char *)&dword_36001C);
        strtok(0, (const char *)&dword_36001C);
        strtok(0, (const char *)&dword_36001C);
        v21 = strtok(0, (const char *)&dword_36001C);
        v22 = atoi(v21);
        v23 = CShopping::ms_numPrices;
        v24 = CShopping::ms_numPrices;
        v25 = &CShopping::ms_prices[CShopping::ms_numPrices];
        v25->price = v22;
        p_price = &v25->price;
        v27 = CShopping::ms_numPriceModifiers;
        if ( CShopping::ms_numPriceModifiers >= 1 )
        {
          key = CShopping::ms_prices[v24].key;
          if ( key == CShopping::ms_priceModifiers[0].key )
            *p_price = CShopping::ms_priceModifiers[0].price;
          if ( v27 >= 2 )
          {
            v29 = 0;
            do
            {
              if ( key == CShopping::ms_priceModifiers[v29 + 1].key )
                *p_price = CShopping::ms_priceModifiers[v29 + 1].price;
              v30 = v29 + 2 < v27;
              ++v29;
            }
            while ( v30 );
          }
        }
        CShopping::ms_numPrices = v23 + 1;
LABEL_42:
        Line = (char *)CFileLoader::LoadLine(v4);
        if ( !Line )
          goto LABEL_43;
      }
      WeaponType = CKeyGen::GetUppercaseKey((const unsigned __int8 *)v9);
LABEL_22:
      v10 = WeaponType;
      pIndex[0] = WeaponType;
      goto LABEL_23;
    }
LABEL_43:
    CFileMgr::CloseFile(v4);
    v31 = CAnimManager::GetAnimationBlockIndex(CShopping::ms_sectionNames[CShopping::ms_priceSectionLoaded]);
    if ( v31 != -1 )
    {
      CStreaming::RequestModel(v31 + 25575, 26);
      CStreaming::LoadAllRequestedModels(1);
    }
    CTimer::Resume();
  }
}
// 360014: using guessed type int dword_360014;
// 36001C: using guessed type int dword_36001C;
// 35FCCC: using guessed type int32 pIndex[8];

//----- (00360074) --------------------------------------------------------
void CShopping::RemoveLoadedPrices()
{
  int32 AnimationBlockIndex; // r0

  AnimationBlockIndex = CAnimManager::GetAnimationBlockIndex(CShopping::ms_sectionNames[CShopping::ms_priceSectionLoaded]);
  if ( AnimationBlockIndex != -1 )
    CStreaming::SetModelIsDeletable(AnimationBlockIndex + 25575);
  CShopping::ms_priceSectionLoaded = 0;
}

//----- (003600B4) --------------------------------------------------------
bool __fastcall CShopping::FindSectionInSection(
        u_native fid,
        const unsigned __int8 *pParentSectionName,
        const unsigned __int8 *pSectionName)
{
  return CShopping::FindSection(fid, pParentSectionName) && CShopping::FindSection(fid, pSectionName);
}

//----- (003600D8) --------------------------------------------------------
void __fastcall CShopping::LoadShop(const unsigned __int8 *pShopName)
{
  u_native v2; // r4
  char *i; // r0
  int v4; // r1
  bool v5; // zf
  bool v6; // zf
  const char *v7; // r6
  char *v8; // r0
  int32 UppercaseKey; // r0
  char *v10; // r0
  CVehicle *PlayerVehicle; // r0
  int32 v12; // r0
  int32 v13; // r8
  int v14; // r1
  int32 v15; // r4
  int v16; // r2
  uint32 key; // r0
  int32 pIndex; // [sp+Ch] [bp-44h] BYREF
  char v20[32]; // [sp+10h] [bp-40h] BYREF

  if ( strcasecmp((const char *)pShopName, (const char *)CShopping::ms_shopLoaded) )
  {
    strcpy((char *)CShopping::ms_shopLoaded, (const char *)pShopName);
    CTimer::Suspend();
    CShopping::ms_numItemsInShop = 0;
    if ( !strcasecmp("bought", (const char *)pShopName) )
    {
      v13 = CShopping::ms_numPrices;
      if ( CShopping::ms_numPrices >= 1 )
      {
        v14 = 0;
        v15 = 0;
        do
        {
          v16 = 0;
          key = CShopping::ms_prices[v15].key;
          while ( CShopping::ms_keys[v16] != key )
          {
            if ( v16++ >= 559 )
            {
              v16 = -1;
              break;
            }
          }
          ++v15;
          if ( CShopping::ms_bHasBought[v16] )
          {
            CShopping::ms_numItemsInShop = v14 + 1;
            CShopping::ms_shopContents[v14++] = key;
          }
        }
        while ( v15 < v13 );
      }
    }
    else
    {
      v2 = CFileMgr::OpenFile("data\\shopping.dat", (const unsigned __int8 *)&dword_3602F4);
      if ( CShopping::FindSection(v2, "shops") )
        CShopping::FindSection(v2, pShopName);
      for ( i = (char *)CFileLoader::LoadLine(v2); i; i = (char *)CFileLoader::LoadLine(v2) )
      {
        v4 = (unsigned __int8)*i;
        v5 = v4 == 0;
        if ( *i )
          v5 = v4 == 35;
        if ( v5 )
          continue;
        v6 = v4 == 101;
        if ( v4 == 101 )
          v6 = i[1] == 110;
        if ( v6 && i[2] == 100 )
          break;
        v7 = strtok(i, " \t");
        if ( !strcmp("type", v7) )
        {
          v10 = strtok(0, " \t");
          strcpy(v20, v10);
          CShopping::LoadPrices((const unsigned __int8 *)v20);
        }
        else if ( !strcmp("item", v7) )
        {
          v8 = strtok(0, " \t");
          if ( (unsigned int)(CShopping::ms_priceSectionLoaded - 4) < 3 )
          {
            UppercaseKey = CKeyGen::GetUppercaseKey((const unsigned __int8 *)v8);
            goto LABEL_23;
          }
          switch ( CShopping::ms_priceSectionLoaded )
          {
            case 9:
              UppercaseKey = CWeaponInfo::FindWeaponType((const unsigned __int8 *)v8);
LABEL_23:
              v7 = (const char *)UppercaseKey;
              pIndex = UppercaseKey;
              break;
            case 2:
LABEL_27:
              v12 = CShopping::ms_numItemsInShop;
              CShopping::ms_shopContents[CShopping::ms_numItemsInShop] = (uint32)v7;
              CShopping::ms_numItemsInShop = v12 + 1;
              continue;
            case 1:
              PlayerVehicle = FindPlayerVehicle(-1, 0);
              if ( !IsValidModForVehicle((uint32)v7, PlayerVehicle) )
                continue;
              break;
            default:
              pIndex = -1;
              CModelInfo::GetModelInfo((const unsigned __int8 *)v8, &pIndex);
              v7 = (const char *)pIndex;
              break;
          }
          goto LABEL_27;
        }
      }
      CFileMgr::CloseFile(v2);
      CTimer::Resume();
    }
  }
}
// 3602F4: using guessed type int dword_3602F4;

//----- (00360340) --------------------------------------------------------
bool __fastcall IsValidModForVehicle(uint32 modelId, CVehicle *pVehicle)
{
  int v3; // r2
  CBaseModelInfo *v4; // r0
  int32 m_pColModel_high; // r5
  int32 v6; // r6
  int m_dynamicIndex; // r1
  bool v9; // zf
  int m_pColModel_low; // r1
  bool v11; // zf
  int m_lodDistance_low; // r1
  bool v13; // zf
  int m_pRwObject_low; // r1
  bool v15; // zf
  int v16; // r1
  bool v17; // zf
  int m_hashKey_low; // r1
  bool v19; // zf
  int v20; // r1
  bool v21; // zf
  int v22; // r1
  bool v23; // zf

  v3 = CModelInfo::ms_modelInfoPtrs[modelId]->m_flags & 0x7D00;
  if ( v3 == 17408 )
    return !pVehicle->m_VehicleAudioEntity.m_VehicleAudioSetting.RadioType
        && (pVehicle->m_VehicleAudioEntity.m_VehicleAudioSetting.BassSetting != 1
         || (*((_BYTE *)&pVehicle->m_nVehicleFlags + 6) & 0x10) != 0);
  v4 = CModelInfo::ms_modelInfoPtrs[pVehicle->m_nModelIndex];
  if ( v3 == 2304 )
  {
    m_pColModel_high = SHIBYTE(v4[1].m_pColModel);
    if ( CVehicleModelInfo::GetNumWheelUpgrades(m_pColModel_high) >= 1 )
    {
      v6 = 0;
      while ( CVehicleModelInfo::GetWheelUpgrade(m_pColModel_high, v6) != modelId )
      {
        if ( ++v6 >= CVehicleModelInfo::GetNumWheelUpgrades(m_pColModel_high) )
          return 0;
      }
      return 1;
    }
    return 0;
  }
  m_dynamicIndex = v4[15].m_dynamicIndex;
  v9 = m_dynamicIndex == modelId;
  if ( m_dynamicIndex != modelId )
    v9 = (__int16)v4[15].m_flags == modelId;
  if ( v9 || *((__int16 *)&v4[15].m_flags + 1) == modelId )
    return 1;
  m_pColModel_low = SLOWORD(v4[15].m_pColModel);
  v11 = m_pColModel_low == modelId;
  if ( m_pColModel_low != modelId )
    v11 = SHIWORD(v4[15].m_pColModel) == modelId;
  if ( v11 )
    return 1;
  m_lodDistance_low = SLOWORD(v4[15].m_lodDistance);
  v13 = m_lodDistance_low == modelId;
  if ( m_lodDistance_low != modelId )
    v13 = SHIWORD(v4[15].m_lodDistance) == modelId;
  if ( v13 )
    return 1;
  m_pRwObject_low = SLOWORD(v4[15].m_pRwObject);
  v15 = m_pRwObject_low == modelId;
  if ( m_pRwObject_low != modelId )
    v15 = SHIWORD(v4[15].m_pRwObject) == modelId;
  if ( v15 )
    return 1;
  v16 = SLOWORD(v4[16]._vptr$CBaseModelInfo);
  v17 = v16 == modelId;
  if ( v16 != modelId )
    v17 = SHIWORD(v4[16]._vptr$CBaseModelInfo) == modelId;
  if ( v17 )
    return 1;
  m_hashKey_low = SLOWORD(v4[16].m_hashKey);
  v19 = m_hashKey_low == modelId;
  if ( m_hashKey_low != modelId )
    v19 = SHIWORD(v4[16].m_hashKey) == modelId;
  if ( v19 )
    return 1;
  v20 = *(__int16 *)v4[16].m_modelName;
  v21 = v20 == modelId;
  if ( v20 != modelId )
    v21 = *(__int16 *)&v4[16].m_modelName[2] == modelId;
  if ( v21 )
    return 1;
  v22 = *(__int16 *)&v4[16].m_modelName[4];
  v23 = v22 == modelId;
  if ( v22 != modelId )
    v23 = *(__int16 *)&v4[16].m_modelName[6] == modelId;
  if ( v23 )
    return 1;
  return *(__int16 *)&v4[16].m_modelName[8] == modelId;
}

//----- (0036045C) --------------------------------------------------------
void __fastcall CShopping::AddPriceModifier(const unsigned __int8 *pName, const unsigned __int8 *pSection, int32 price)
{
  uint32 PriceSectionFromName; // r0
  int v6; // r2
  int32 v7; // r1
  int v8; // r3
  uint32 *i; // r2
  int32 pIndex[3]; // [sp+4h] [bp-Ch] BYREF

  PriceSectionFromName = CShopping::GetPriceSectionFromName(pSection);
  if ( PriceSectionFromName - 4 >= 3 )
  {
    if ( PriceSectionFromName != 2 )
    {
      if ( PriceSectionFromName == 9 )
      {
        PriceSectionFromName = CWeaponInfo::FindWeaponType(pName);
        pIndex[0] = PriceSectionFromName;
      }
      else
      {
        pIndex[0] = -1;
        CModelInfo::GetModelInfo(pName, pIndex);
        PriceSectionFromName = pIndex[0];
      }
    }
  }
  else
  {
    PriceSectionFromName = CKeyGen::GetUppercaseKey(pName);
    pIndex[0] = PriceSectionFromName;
  }
  v6 = 0;
  v7 = CShopping::ms_numPriceModifiers;
  if ( CShopping::ms_numPriceModifiers < 1 )
  {
LABEL_11:
    if ( v6 != CShopping::ms_numPriceModifiers )
      goto LABEL_13;
    goto LABEL_12;
  }
  while ( CShopping::ms_priceModifiers[v6].key != PriceSectionFromName )
  {
    if ( ++v6 >= CShopping::ms_numPriceModifiers )
      goto LABEL_11;
  }
  CShopping::ms_priceModifiers[v6].price = price;
  if ( v6 == v7 )
  {
LABEL_12:
    CShopping::ms_priceModifiers[v7].key = PriceSectionFromName;
    CShopping::ms_priceModifiers[v7].price = price;
    CShopping::ms_numPriceModifiers = v7 + 1;
  }
LABEL_13:
  if ( CShopping::ms_numPrices >= 1 )
  {
    v8 = 0;
    for ( i = &CShopping::ms_prices[0].price; *(i - 1) != PriceSectionFromName; i += 6 )
    {
      if ( ++v8 >= CShopping::ms_numPrices )
        return;
    }
    if ( v8 != -1 )
      *i = price;
  }
}
// 36045C: using guessed type int32 pIndex[3];

//----- (00360544) --------------------------------------------------------
void __fastcall CShopping::AddPriceModifier(uint32 key, int32 price)
{
  int v2; // r3
  int32 v3; // r12
  uint32 *p_price; // lr
  int32 v5; // r2

  v2 = 0;
  v3 = CShopping::ms_numPriceModifiers;
  if ( CShopping::ms_numPriceModifiers < 1 )
  {
LABEL_4:
    if ( v2 != CShopping::ms_numPriceModifiers )
      goto LABEL_6;
    goto LABEL_5;
  }
  while ( CShopping::ms_priceModifiers[v2].key != key )
  {
    if ( ++v2 >= CShopping::ms_numPriceModifiers )
      goto LABEL_4;
  }
  CShopping::ms_priceModifiers[v2].price = price;
  if ( v2 == v3 )
  {
LABEL_5:
    CShopping::ms_priceModifiers[v3].key = key;
    CShopping::ms_priceModifiers[v3].price = price;
    CShopping::ms_numPriceModifiers = v3 + 1;
  }
LABEL_6:
  if ( CShopping::ms_numPrices >= 1 )
  {
    p_price = &CShopping::ms_prices[0].price;
    v5 = 0;
    while ( *(p_price - 1) != key )
    {
      ++v5;
      p_price += 6;
      if ( v5 >= CShopping::ms_numPrices )
        return;
    }
    if ( v5 != -1 )
      *p_price = price;
  }
}

//----- (003605FC) --------------------------------------------------------
int32 __fastcall CShopping::FindItem(uint32 key)
{
  CShopping::ItemPrice *v2; // r3
  int32 result; // r0

  if ( CShopping::ms_numPrices < 1 )
    return -1;
  v2 = CShopping::ms_prices;
  result = 0;
  while ( v2->key != key )
  {
    ++result;
    ++v2;
    if ( result >= CShopping::ms_numPrices )
      return -1;
  }
  return result;
}

//----- (00360630) --------------------------------------------------------
void __fastcall CShopping::RemovePriceModifier(const unsigned __int8 *pName, const unsigned __int8 *pSection)
{
  int32 PriceSectionFromName; // r0
  int v4; // r2
  int32 v5; // r1
  int32 v6; // r0
  uint32 key; // r3
  uint32 price; // r0
  int32 pIndex[3]; // [sp+4h] [bp-Ch] BYREF

  PriceSectionFromName = CShopping::GetPriceSectionFromName(pSection);
  if ( (unsigned int)(PriceSectionFromName - 4) >= 3 )
  {
    if ( PriceSectionFromName != 2 )
    {
      if ( PriceSectionFromName == 9 )
      {
        PriceSectionFromName = CWeaponInfo::FindWeaponType(pName);
        pIndex[0] = PriceSectionFromName;
      }
      else
      {
        pIndex[0] = -1;
        CModelInfo::GetModelInfo(pName, pIndex);
        PriceSectionFromName = pIndex[0];
      }
    }
  }
  else
  {
    PriceSectionFromName = CKeyGen::GetUppercaseKey(pName);
    pIndex[0] = PriceSectionFromName;
  }
  v4 = CShopping::ms_numPriceModifiers;
  v5 = 0;
  if ( CShopping::ms_numPriceModifiers >= 1 )
  {
    do
    {
      if ( CShopping::ms_priceModifiers[v5].key == PriceSectionFromName )
        break;
      ++v5;
    }
    while ( v5 < CShopping::ms_numPriceModifiers );
  }
  if ( v5 != CShopping::ms_numPriceModifiers )
  {
    v6 = --CShopping::ms_numPriceModifiers;
    if ( v4 >= 2 )
    {
      key = CShopping::ms_priceModifiers[v6].key;
      price = CShopping::ms_priceModifiers[v6].price;
      CShopping::ms_priceModifiers[v5].key = key;
      CShopping::ms_priceModifiers[v5].price = price;
    }
  }
}
// 360630: using guessed type int32 pIndex[3];

//----- (003606D8) --------------------------------------------------------
void __fastcall CShopping::RemovePriceModifier(uint32 key)
{
  int v1; // r12
  int32 v2; // r1
  int32 v3; // r0
  uint32 v4; // r3
  uint32 price; // r0

  v1 = CShopping::ms_numPriceModifiers;
  v2 = 0;
  if ( CShopping::ms_numPriceModifiers >= 1 )
  {
    do
    {
      if ( CShopping::ms_priceModifiers[v2].key == key )
        break;
      ++v2;
    }
    while ( v2 < CShopping::ms_numPriceModifiers );
  }
  if ( v2 != CShopping::ms_numPriceModifiers )
  {
    v3 = --CShopping::ms_numPriceModifiers;
    if ( v1 >= 2 )
    {
      v4 = CShopping::ms_priceModifiers[v3].key;
      price = CShopping::ms_priceModifiers[v3].price;
      CShopping::ms_priceModifiers[v2].key = v4;
      CShopping::ms_priceModifiers[v2].price = price;
    }
  }
}

//----- (00360744) --------------------------------------------------------
int32 __fastcall CShopping::GetPrice(uint32 key)
{
  CShopping::ItemPrice *v1; // r3
  int32 v2; // r1

  if ( CShopping::ms_numPrices < 1 )
  {
LABEL_5:
    v2 = -1;
  }
  else
  {
    v1 = CShopping::ms_prices;
    v2 = 0;
    while ( v1->key != key )
    {
      ++v2;
      ++v1;
      if ( v2 >= CShopping::ms_numPrices )
        goto LABEL_5;
    }
  }
  return (int)(float)(gPriceMultipliers[CTheZones::m_CurrLevel] * (float)(int)CShopping::ms_prices[v2].price);
}

//----- (003607BC) --------------------------------------------------------
const unsigned __int8 *__fastcall CShopping::GetNameTag(uint32 key)
{
  CShopping::ItemPrice *v1; // r3
  int32 v2; // r1

  if ( CShopping::ms_numPrices < 1 )
  {
LABEL_5:
    v2 = -1;
  }
  else
  {
    v1 = CShopping::ms_prices;
    v2 = 0;
    while ( v1->key != key )
    {
      ++v2;
      ++v1;
      if ( v2 >= CShopping::ms_numPrices )
        goto LABEL_5;
    }
  }
  return CShopping::ms_prices[v2].nameTag;
}

//----- (00360804) --------------------------------------------------------
int32 __fastcall CShopping::GetExtraInfo(uint32 key, int32 index)
{
  int32 v2; // lr
  CShopping::ItemPrice *v3; // r3

  if ( CShopping::ms_numPrices < 1 )
  {
LABEL_5:
    v2 = -1;
  }
  else
  {
    v2 = 0;
    v3 = CShopping::ms_prices;
    while ( v3->key != key )
    {
      ++v2;
      ++v3;
      if ( v2 >= CShopping::ms_numPrices )
        goto LABEL_5;
    }
  }
  if ( index == 1 )
    return CShopping::ms_prices[v2]._anon_0.general.extra2;
  if ( index )
    return 0;
  return CShopping::ms_prices[v2]._anon_0.general.extra1;
}

//----- (0036087C) --------------------------------------------------------
void __fastcall CShopping::IncrementStat(int32 statIndex, int32 change)
{
  int v2; // r0
  bool v3; // zf

  if ( statIndex != -1 )
  {
    v2 = dword_60FF08[statIndex];
    if ( v2 != -1 )
    {
      v3 = v2 == 80;
      if ( v2 != 80 )
        v3 = v2 == 66;
      if ( v3 )
        change *= 10;
      sub_1983EC(v2, (float)change);
    }
  }
}
// 60FF08: using guessed type _DWORD dword_60FF08[6];

//----- (003608B4) --------------------------------------------------------
void __fastcall CShopping::IncrementStat2(int32 stat, int32 change)
{
  bool v2; // zf

  if ( stat != -1 )
  {
    v2 = stat == 80;
    if ( stat != 80 )
      v2 = stat == 66;
    if ( v2 )
      change *= 10;
    sub_1983EC(stat, (float)change);
  }
}

//----- (003608DC) --------------------------------------------------------
void __fastcall CShopping::UpdateStats(int32 index, bool bIncrement)
{
  int stat1; // r2
  int stat1Change; // r0
  int v5; // r2
  bool v6; // zf
  CShopping::StatModifier *v7; // r1
  int stat2; // r0
  int v9; // r0
  int stat2Change; // r1
  bool v11; // zf
  int v12; // r1
  int v13; // r2
  bool v14; // zf
  int v15; // r0
  CShopping::StatModifier *v16; // r1
  int v17; // r0
  int v18; // r1
  bool v19; // zf

  stat1 = CShopping::ms_statModifiers[index].stat1;
  stat1Change = CShopping::ms_statModifiers[index].stat1Change;
  if ( bIncrement )
  {
    if ( (unsigned __int8)stat1 != 255 )
    {
      v5 = dword_60FF08[stat1];
      if ( v5 != -1 )
      {
        v6 = v5 == 80;
        if ( v5 != 80 )
          v6 = v5 == 66;
        if ( v6 )
          stat1Change *= 10;
        CStats::ModifyStat(v5, (float)stat1Change);
      }
    }
    v7 = &CShopping::ms_statModifiers[index];
    stat2 = v7->stat2;
    if ( stat2 != -1 )
    {
      v9 = dword_60FF08[stat2];
      if ( v9 != -1 )
      {
        stat2Change = v7->stat2Change;
        v11 = v9 == 80;
        if ( v9 != 80 )
          v11 = v9 == 66;
        if ( !v11 )
          goto LABEL_34;
        v12 = 5 * stat2Change;
        goto LABEL_32;
      }
    }
  }
  else
  {
    if ( (unsigned __int8)stat1 != 255 )
    {
      v13 = dword_60FF08[stat1];
      if ( v13 != -1 )
      {
        v14 = v13 == 80;
        if ( v13 != 80 )
          v14 = v13 == 66;
        if ( v14 )
          v15 = -10 * stat1Change;
        else
          v15 = -stat1Change;
        CStats::ModifyStat(v13, (float)v15);
      }
    }
    v16 = &CShopping::ms_statModifiers[index];
    v17 = v16->stat2;
    if ( v17 != -1 )
    {
      v9 = dword_60FF08[v17];
      if ( v9 != -1 )
      {
        v18 = v16->stat2Change;
        v19 = v9 == 80;
        if ( v9 != 80 )
          v19 = v9 == 66;
        if ( !v19 )
        {
          stat2Change = -v18;
LABEL_34:
          sub_1983EC(v9, (float)stat2Change);
          return;
        }
        v12 = -5 * v18;
LABEL_32:
        stat2Change = 2 * v12;
        goto LABEL_34;
      }
    }
  }
}
// 60FF08: using guessed type _DWORD dword_60FF08[6];

//----- (003609FC) --------------------------------------------------------
void __fastcall CShopping::Buy(uint32 key, int32 extraInfo)
{
  CShopping::ItemPrice *v3; // r2
  int32 v4; // r1
  int32 v5; // r8
  int v6; // r4
  uint32 v7; // r1
  bool v8; // cc
  CPedClothesDesc *m_pClothes; // r10
  CPlayerPed *pPed; // r9
  CShopping::ItemPrice *v11; // r6
  int32 v12; // r3
  int v13; // s16
  int stat1; // r0
  int v15; // r0
  bool v16; // zf
  int stat1Change; // r1
  CShopping::StatModifier *v18; // r1
  int stat2; // r0
  int v20; // r0
  int stat2Change; // r1
  bool v22; // zf
  CAutomobile *PlayerVehicle; // r5
  CBaseModelInfo *v24; // r8
  CBaseModelInfo *v25; // r6
  unsigned int m_flags; // r1
  int v27; // r0
  UInt16 v28; // r0
  CShopping::ItemPrice *v29; // r5
  int32 *p_extra2; // r5
  uint32 type; // t1
  uint32 v32; // r0
  int v33; // r6
  int v34; // r0
  int v35; // r0
  bool v36; // zf
  int v37; // r1
  CShopping::ItemPrice *v38; // r5
  int32 *v39; // r5
  uint32 v40; // t1
  uint32 v41; // r0
  int v42; // r6
  int v43; // r0
  int v44; // r0
  bool v45; // zf
  int v46; // r1
  int WeaponSlot; // r1
  int v48; // r1
  CShopping::StatModifier *v49; // r1
  int v50; // r0
  int v51; // r0
  int v52; // r1
  bool v53; // zf
  int v54; // r1
  CShopping::StatModifier *v55; // r1
  int v56; // r0
  int v57; // r0
  int v58; // r1
  bool v59; // zf
  int v60; // r1
  ePlayerClothesModels TextureDependency; // r0
  int v62; // r1
  CWanted *PlayerWanted; // r0
  CAutomobile *v64; // r0
  int32 v65; // r1
  ePanels v66; // r2
  CAutomobile *v67; // r0
  int32 v68; // r1
  eDoors v69; // r2

  if ( CShopping::ms_numPrices < 1 )
  {
LABEL_5:
    v4 = -1;
  }
  else
  {
    v3 = CShopping::ms_prices;
    v4 = 0;
    while ( v3->key != key )
    {
      ++v4;
      ++v3;
      if ( v4 >= CShopping::ms_numPrices )
        goto LABEL_5;
    }
  }
  v5 = v4;
  v6 = 0;
  v7 = CShopping::ms_prices[v4].key;
  while ( CShopping::ms_keys[v6] != v7 )
  {
    v8 = v6++ < 559;
    if ( !v8 )
    {
      v6 = -1;
      break;
    }
  }
  m_pClothes = &gStoredClothesState;
  pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
  if ( !gClothesHaveBeenStored )
    m_pClothes = pPed->m_pPlayerData->m_pClothes;
  if ( CShopping::ms_numPrices < 1 )
  {
LABEL_16:
    v12 = -1;
  }
  else
  {
    v11 = CShopping::ms_prices;
    v12 = 0;
    while ( v11->key != key )
    {
      ++v12;
      ++v11;
      if ( v12 >= CShopping::ms_numPrices )
        goto LABEL_16;
    }
  }
  v13 = (int)(float)(gPriceMultipliers[CTheZones::m_CurrLevel] * (float)(int)CShopping::ms_prices[v12].price);
  CWorld::Players[CWorld::PlayerInFocus].Score -= v13;
  stat1 = CShopping::ms_statModifiers[v6].stat1;
  if ( stat1 != -1 )
  {
    v15 = dword_60FF08[stat1];
    if ( v15 != -1 )
    {
      v16 = v15 == 80;
      stat1Change = CShopping::ms_statModifiers[v6].stat1Change;
      if ( v15 != 80 )
        v16 = v15 == 66;
      if ( v16 )
        stat1Change *= 10;
      CStats::ModifyStat(v15, (float)stat1Change);
    }
  }
  v18 = &CShopping::ms_statModifiers[v6];
  stat2 = v18->stat2;
  if ( stat2 != -1 )
  {
    v20 = dword_60FF08[stat2];
    if ( v20 != -1 )
    {
      stat2Change = v18->stat2Change;
      v22 = v20 == 80;
      if ( v20 != 80 )
        v22 = v20 == 66;
      if ( v22 )
        stat2Change *= 10;
      CStats::ModifyStat(v20, (float)stat2Change);
    }
  }
  CStats::ModifyStat(0x3Eu, (float)v13);
  CShopping::ms_bHasBought[v6] = 1;
  switch ( CShopping::ms_priceSectionLoaded )
  {
    case 1:
      CStats::ModifyStat(0x37u, (float)v13);
      PlayerVehicle = (CAutomobile *)FindPlayerVehicle(-1, 0);
      v24 = CModelInfo::ms_modelInfoPtrs[PlayerVehicle->m_nModelIndex];
      v25 = CModelInfo::ms_modelInfoPtrs[key];
      CVehicle::AddVehicleUpgrade(PlayerVehicle, key);
      if ( !PlayerVehicle->m_baseVehicleType )
      {
        m_flags = v25->m_flags;
        v27 = (m_flags >> 10) & 0x1F;
        if ( (m_flags & 0x100) == 0 )
          v27 = *(_DWORD *)(v24[2].m_hashKey + 32 * v27 + 208);
        switch ( v27 )
        {
          case 2:
            CAutomobile::FixTyre(PlayerVehicle, FRONT_LEFT_WHEEL_0);
            CAutomobile::FixTyre(PlayerVehicle, FRONT_RIGHT_WHEEL_0);
            CAutomobile::FixTyre(PlayerVehicle, REAR_LEFT_WHEEL_0);
            sub_18E4A4(PlayerVehicle, REAR_RIGHT_WHEEL_0);
            return;
          case 12:
            v64 = PlayerVehicle;
            v65 = 12;
            v66 = FRONT_BUMPER;
            goto LABEL_97;
          case 13:
            v64 = PlayerVehicle;
            v65 = 13;
            v66 = REAR_BUMPER;
LABEL_97:
            sub_1A0338(v64, v65, v66);
            return;
          case 16:
            v67 = PlayerVehicle;
            v68 = 16;
            v69 = BONNET_0;
            goto LABEL_100;
          case 17:
            v67 = PlayerVehicle;
            v68 = 17;
            v69 = BOOT_0;
LABEL_100:
            sub_18D3E8(v67, v68, v69);
            break;
          default:
            return;
        }
      }
      return;
    case 2:
      v28 = 55;
      goto LABEL_67;
    case 4:
      CStats::ModifyStat(0xEu, (float)v13);
      v29 = &CShopping::ms_prices[v5];
      type = v29->_anon_0.clothes.type;
      p_extra2 = &v29->_anon_0.general.extra2;
      v32 = m_pClothes->texturesKeyArray[type];
      if ( !v32 )
        goto LABEL_89;
      v33 = 0;
      while ( CShopping::ms_keys[v33] != v32 )
      {
        v8 = v33++ < 559;
        if ( !v8 )
        {
          v33 = -1;
          break;
        }
      }
      v34 = CShopping::ms_statModifiers[v33].stat1;
      if ( v34 != -1 )
      {
        v35 = dword_60FF08[v34];
        if ( v35 != -1 )
        {
          v36 = v35 == 80;
          v37 = CShopping::ms_statModifiers[v33].stat1Change;
          if ( v35 != 80 )
            v36 = v35 == 66;
          if ( v36 )
            v48 = -10 * v37;
          else
            v48 = -v37;
          CStats::ModifyStat(v35, (float)v48);
        }
      }
      v49 = &CShopping::ms_statModifiers[v33];
      v50 = v49->stat2;
      if ( v50 != -1 )
      {
        v51 = dword_60FF08[v50];
        if ( v51 != -1 )
        {
          v52 = v49->stat2Change;
          v53 = v51 == 80;
          if ( v51 != 80 )
            v53 = v51 == 66;
          if ( v53 )
            v60 = -10 * v52;
          else
            v60 = -v52;
          CStats::ModifyStat(v51, (float)v60);
        }
      }
LABEL_89:
      CPedClothesDesc::SetTextureAndModel(
        pPed->m_pPlayerData->m_pClothes,
        key,
        CShopping::ms_prices[v5]._anon_0.weapon.ammo,
        *p_extra2);
      TextureDependency = CClothes::GetTextureDependency(*p_extra2);
      if ( (unsigned int)TextureDependency > CLOTHES_HAT || ((1 << TextureDependency) & 0x18B) == 0 )
        return;
      goto LABEL_94;
    case 5:
      CStats::ModifyStat(0x1Fu, (float)v13);
      v38 = &CShopping::ms_prices[v5];
      v40 = v38->_anon_0.clothes.type;
      v39 = &v38->_anon_0.general.extra2;
      v41 = m_pClothes->texturesKeyArray[v40];
      if ( !v41 )
        goto LABEL_93;
      v42 = 0;
      break;
    case 6:
      CStats::ModifyStat(0x1Eu, (float)v13);
      sub_1A1174(pPed->m_pPlayerData->m_pClothes, key, 0, CShopping::ms_prices[v5]._anon_0.general.extra1);
      return;
    case 7:
      sub_194ECC(pPed, WEAPONTYPE_FLOWERS, 0, 0);
      return;
    case 8:
      CStats::ModifyStat(0xC8u, 1.0);
      v28 = 20;
LABEL_67:
      sub_1983EC(v28, (float)v13);
      return;
    case 9:
      CStats::ModifyStat(0xDu, (float)v13);
      if ( key == 48 )
      {
        pPed->m_nArmour = (float)CWorld::Players[CWorld::PlayerInFocus].MaxArmour;
      }
      else
      {
        CPed::GiveWeapon(pPed, (eWeaponType)key, CShopping::ms_prices[v5]._anon_0.weapon.ammo, 0);
        WeaponSlot = CPed::GetWeaponSlot(pPed, (eWeaponType)key);
        sub_19E974(pPed, WeaponSlot);
      }
      return;
    default:
      return;
  }
  while ( CShopping::ms_keys[v42] != v41 )
  {
    v8 = v42++ < 559;
    if ( !v8 )
    {
      v42 = -1;
      break;
    }
  }
  v43 = CShopping::ms_statModifiers[v42].stat1;
  if ( v43 != -1 )
  {
    v44 = dword_60FF08[v43];
    if ( v44 != -1 )
    {
      v45 = v44 == 80;
      v46 = CShopping::ms_statModifiers[v42].stat1Change;
      if ( v44 != 80 )
        v45 = v44 == 66;
      if ( v45 )
        v54 = -10 * v46;
      else
        v54 = -v46;
      CStats::ModifyStat(v44, (float)v54);
    }
  }
  v55 = &CShopping::ms_statModifiers[v42];
  v56 = v55->stat2;
  if ( v56 != -1 )
  {
    v57 = dword_60FF08[v56];
    if ( v57 != -1 )
    {
      v58 = v55->stat2Change;
      v59 = v57 == 80;
      if ( v57 != 80 )
        v59 = v57 == 66;
      if ( v59 )
        v62 = -10 * v58;
      else
        v62 = -v58;
      CStats::ModifyStat(v57, (float)v62);
    }
  }
LABEL_93:
  CPedClothesDesc::SetTextureAndModel(
    pPed->m_pPlayerData->m_pClothes,
    key,
    CShopping::ms_prices[v5]._anon_0.weapon.ammo,
    *v39);
LABEL_94:
  PlayerWanted = FindPlayerWanted(-1);
  sub_19CA8C(PlayerWanted);
}
// 60FF08: using guessed type _DWORD dword_60FF08[6];
// 81FFB8: using guessed type char gClothesHaveBeenStored;

//----- (00361068) --------------------------------------------------------
void __fastcall CShopping::SetCurrentProperty(CMultiBuilding *pProperty)
{
  gpCurrentProperty = pProperty;
}

//----- (00361074) --------------------------------------------------------
void CShopping::StoreClothesState()
{
  qmemcpy(
    &gStoredClothesState,
    CWorld::Players[CWorld::PlayerInFocus].pPed->m_pPlayerData->m_pClothes,
    sizeof(gStoredClothesState));
  gClothesHaveBeenStored = 1;
}
// 81FFB8: using guessed type char gClothesHaveBeenStored;

//----- (003610BC) --------------------------------------------------------
void CShopping::RestoreClothesState()
{
  qmemcpy(
    CWorld::Players[CWorld::PlayerInFocus].pPed->m_pPlayerData->m_pClothes,
    &gStoredClothesState,
    sizeof(CPedClothesDesc));
  gClothesHaveBeenStored = 0;
}
// 81FFB8: using guessed type char gClothesHaveBeenStored;

//----- (00361104) --------------------------------------------------------
void CShopping::StoreVehicleMods()
{
  CVehicle *PlayerVehicle; // r0
  __int64 v1; // d16
  __int64 v2; // d17
  __int64 v3; // d19
  const CDamageManager *v4; // r4
  int v5; // r6
  int8 WheelStatus; // r0
  const CDamageManager *v7; // r0
  eDoors v8; // r1

  PlayerVehicle = FindPlayerVehicle(-1, 0);
  v1 = *(_QWORD *)PlayerVehicle->m_upgrades;
  v2 = *(_QWORD *)&PlayerVehicle->m_upgrades[4];
  v3 = *(_QWORD *)&PlayerVehicle->m_upgrades[11];
  *(_QWORD *)&gStoredVehicleMods[7] = *(_QWORD *)&PlayerVehicle->m_upgrades[7];
  *(_QWORD *)&gStoredVehicleMods[11] = v3;
  *(_QWORD *)gStoredVehicleMods = v1;
  *(_QWORD *)&gStoredVehicleMods[4] = v2;
  if ( !PlayerVehicle->m_baseVehicleType )
  {
    v4 = (const CDamageManager *)&PlayerVehicle[1];
    v5 = 0;
    while ( 2 )
    {
      switch ( v5 )
      {
        case 2:
          WheelStatus = CDamageManager::GetWheelStatus(v4, 2);
          goto LABEL_3;
        case 4:
          WheelStatus = CDamageManager::GetWheelStatus(v4, 3);
          goto LABEL_3;
        case 5:
          WheelStatus = CDamageManager::GetWheelStatus(v4, 0);
          goto LABEL_3;
        case 7:
          WheelStatus = CDamageManager::GetWheelStatus(v4, 1);
          goto LABEL_3;
        case 12:
          WheelStatus = CDamageManager::GetPanelStatus(v4, 5);
          goto LABEL_3;
        case 13:
          WheelStatus = CDamageManager::GetPanelStatus(v4, 6);
          goto LABEL_3;
        case 16:
          v7 = v4;
          v8 = BONNET_0;
          goto LABEL_15;
        case 17:
          v7 = v4;
          v8 = BOOT_0;
LABEL_15:
          WheelStatus = CDamageManager::GetDoorStatus(v7, v8);
LABEL_3:
          gComponentDamageState[v5++] = WheelStatus;
          continue;
        default:
          gComponentDamageState[v5++] = 0;
          if ( v5 != 25 )
            continue;
          return;
      }
    }
  }
}

//----- (003611DC) --------------------------------------------------------
void CShopping::RestoreVehicleMods()
{
  int v0; // r6
  CVehicle *PlayerVehicle; // r9
  int v2; // r0
  int v3; // r0
  int v4; // r6
  uint32 v5; // r2
  CDamageManager *v6; // r0
  int32 v7; // r1
  CAutomobile *v8; // r0
  ePanels v9; // r1
  CAutomobile *v10; // r0
  eDoors v11; // r1

  v0 = 0;
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  do
  {
    v2 = (unsigned __int16)PlayerVehicle->m_upgrades[v0];
    if ( v2 != 0xFFFF )
      CVehicle::RemoveVehicleUpgrade(PlayerVehicle, (__int16)v2);
    v3 = (unsigned __int16)gStoredVehicleMods[v0];
    PlayerVehicle->m_upgrades[v0] = v3;
    if ( v3 != 0xFFFF )
      CStreaming::RequestVehicleUpgrade((__int16)v3, 10);
    ++v0;
  }
  while ( v0 != 15 );
  CStreaming::LoadAllRequestedModels(0);
  CVehicle::SetupUpgradesAfterLoad(PlayerVehicle);
  if ( (unsigned __int16)gStoredVehicleMods[0] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[0]);
  if ( (unsigned __int16)gStoredVehicleMods[1] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[1]);
  if ( (unsigned __int16)gStoredVehicleMods[2] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[2]);
  if ( (unsigned __int16)gStoredVehicleMods[3] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[3]);
  if ( (unsigned __int16)gStoredVehicleMods[4] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[4]);
  if ( (unsigned __int16)gStoredVehicleMods[5] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[5]);
  if ( (unsigned __int16)gStoredVehicleMods[6] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[6]);
  if ( (unsigned __int16)gStoredVehicleMods[7] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[7]);
  if ( (unsigned __int16)gStoredVehicleMods[8] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[8]);
  if ( (unsigned __int16)gStoredVehicleMods[9] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[9]);
  if ( (unsigned __int16)gStoredVehicleMods[10] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[10]);
  if ( (unsigned __int16)gStoredVehicleMods[11] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[11]);
  if ( (unsigned __int16)gStoredVehicleMods[12] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[12]);
  if ( (unsigned __int16)gStoredVehicleMods[13] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[13]);
  if ( (unsigned __int16)gStoredVehicleMods[14] != 0xFFFF )
    CStreaming::SetModelIsDeletable(gStoredVehicleMods[14]);
  if ( !PlayerVehicle->m_baseVehicleType )
  {
    v4 = 0;
    while ( 1 )
    {
      switch ( v4 )
      {
        case 2:
          v5 = gComponentDamageState[2];
          if ( gComponentDamageState[2] < 1 )
            goto LABEL_39;
          v6 = (CDamageManager *)&PlayerVehicle[1];
          v7 = 2;
          goto LABEL_51;
        case 4:
          v5 = gComponentDamageState[4];
          if ( gComponentDamageState[4] < 1 )
            goto LABEL_39;
          v6 = (CDamageManager *)&PlayerVehicle[1];
          v7 = 3;
          goto LABEL_51;
        case 5:
          v5 = gComponentDamageState[5];
          if ( gComponentDamageState[5] < 1 )
            goto LABEL_39;
          v6 = (CDamageManager *)&PlayerVehicle[1];
          v7 = 0;
          goto LABEL_51;
        case 7:
          v5 = gComponentDamageState[7];
          if ( gComponentDamageState[7] < 1 )
            goto LABEL_39;
          v6 = (CDamageManager *)&PlayerVehicle[1];
          v7 = 1;
LABEL_51:
          CDamageManager::SetWheelStatus(v6, v7, v5);
          ++v4;
          continue;
        case 12:
          if ( gComponentDamageState[12] < 1 )
            goto LABEL_39;
          CDamageManager::SetPanelStatus((CDamageManager *)&PlayerVehicle[1], 5, gComponentDamageState[12]);
          v8 = (CAutomobile *)PlayerVehicle;
          v9 = FRONT_BUMPER;
          goto LABEL_56;
        case 13:
          if ( gComponentDamageState[13] < 1 )
            goto LABEL_39;
          CDamageManager::SetPanelStatus((CDamageManager *)&PlayerVehicle[1], 6, gComponentDamageState[13]);
          v8 = (CAutomobile *)PlayerVehicle;
          v9 = REAR_BUMPER;
LABEL_56:
          CAutomobile::SetPanelDamage(v8, v9, 1);
          ++v4;
          continue;
        case 16:
          if ( gComponentDamageState[16] < 1 )
            goto LABEL_39;
          CDamageManager::SetDoorStatus((CDamageManager *)&PlayerVehicle[1], BONNET_0, gComponentDamageState[16]);
          v10 = (CAutomobile *)PlayerVehicle;
          v11 = BONNET_0;
          goto LABEL_61;
        case 17:
          if ( gComponentDamageState[17] < 1 )
            goto LABEL_39;
          CDamageManager::SetDoorStatus((CDamageManager *)&PlayerVehicle[1], BOOT_0, gComponentDamageState[17]);
          v10 = (CAutomobile *)PlayerVehicle;
          v11 = BOOT_0;
LABEL_61:
          CAutomobile::SetDoorDamage(v10, v11, 1);
LABEL_39:
          ++v4;
          break;
        default:
          if ( ++v4 != 25 )
            continue;
          return;
      }
    }
  }
}
// 10: using guessed type __int16 word_10;

//----- (00361490) --------------------------------------------------------
bool __fastcall CShopping::HasPlayerBought(uint32 key)
{
  int v1; // r1

  v1 = 0;
  while ( CShopping::ms_keys[v1] != key )
  {
    if ( v1++ >= 559 )
    {
      v1 = -1;
      return CShopping::ms_bHasBought[v1];
    }
  }
  return CShopping::ms_bHasBought[v1];
}

//----- (003614C4) --------------------------------------------------------
void __fastcall CShopping::SetPlayerHasBought(uint32 key)
{
  int v1; // r1

  v1 = 0;
  while ( CShopping::ms_keys[v1] != key )
  {
    if ( v1++ >= 559 )
    {
      v1 = -1;
      break;
    }
  }
  CShopping::ms_bHasBought[v1] = 1;
}

//----- (003614F8) --------------------------------------------------------
bool __fastcall CBoundBox::IsPointWithin(CBoundBox *this, const CVector *vecTest)
{
  float y; // s2
  float z; // s4
  bool result; // r0

  result = 0;
  if ( vecTest->x >= this->m_vecMin.x )
  {
    y = vecTest->y;
    if ( y >= this->m_vecMin.y )
    {
      z = vecTest->z;
      if ( z >= this->m_vecMin.z && vecTest->x <= this->m_vecMax.x && y <= this->m_vecMax.y && z <= this->m_vecMax.z )
        return 1;
    }
  }
  return result;
}

//----- (00361560) --------------------------------------------------------
void CStuntJumpManager::Init()
{
  CStuntJumpPool *v0; // r4
  uint8 *v1; // r0
  uint8 v2; // r1
  int i; // r0

  v0 = (CStuntJumpPool *)operator new(0x14u);
  v0->m_aStorage = (CPool<CStuntJump,CStuntJump>::StorageType *)operator new[](0x4400u);
  v1 = (uint8 *)operator new[](0x100u);
  v0->m_bOwnsArrays = 1;
  v0->m_aFlags = v1;
  v0->m_nSize = 256;
  v0->m_nFreeIndex = -1;
  v2 = v1[1];
  *v1 = 0x80;
  v1[1] = v2 | 0x80;
  v0->m_aFlags[1] &= 0x80u;
  for ( i = 2; i != 256; ++i )
  {
    v0->m_aFlags[i] |= 0x80u;
    v0->m_aFlags[i] &= 0x80u;
  }
  CStuntJumpManager::m_bActive = 1;
  CStuntJumpManager::mp_poolStuntJumps = v0;
}

//----- (003615E0) --------------------------------------------------------
void CStuntJumpManager::Shutdown()
{
  CStuntJumpPool *v0; // r4
  uint8 *m_aFlags; // r0
  uint8 **p_m_aFlags; // r5

  v0 = CStuntJumpManager::mp_poolStuntJumps;
  if ( CStuntJumpManager::mp_poolStuntJumps )
  {
    if ( CStuntJumpManager::mp_poolStuntJumps->m_nSize >= 1 )
    {
      if ( CStuntJumpManager::mp_poolStuntJumps->m_bOwnsArrays )
      {
        if ( CStuntJumpManager::mp_poolStuntJumps->m_aStorage )
          operator delete[](CStuntJumpManager::mp_poolStuntJumps->m_aStorage);
        p_m_aFlags = &v0->m_aFlags;
        m_aFlags = v0->m_aFlags;
        if ( m_aFlags )
          operator delete[](m_aFlags);
      }
      else
      {
        p_m_aFlags = &CStuntJumpManager::mp_poolStuntJumps->m_aFlags;
      }
      v0->m_aStorage = 0;
      *p_m_aFlags = 0;
    }
    operator delete(v0);
  }
  CStuntJumpManager::mp_poolStuntJumps = 0;
}

//----- (00361634) --------------------------------------------------------
void CStuntJumpManager::ShutdownForRestart()
{
  CStuntJumpPool *v0; // r0
  int32 v1; // r1

  v0 = CStuntJumpManager::mp_poolStuntJumps;
  if ( CStuntJumpManager::mp_poolStuntJumps->m_nSize >= 1 )
  {
    v1 = 0;
    do
    {
      v0->m_aFlags[v1] |= 0x80u;
      v0->m_aFlags[v1++] &= 0x80u;
    }
    while ( v1 < v0->m_nSize );
  }
  CStuntJumpManager::m_bHitReward = 0;
  CStuntJumpManager::mp_Active = 0;
  CStuntJumpManager::m_iTimer = 0;
  CStuntJumpManager::m_jumpState = JUMP_INACTIVE;
  CStuntJumpManager::m_iNumJumps = 0;
  CStuntJumpManager::m_iNumCompleted = 0;
}

//----- (003616C4) --------------------------------------------------------
void CStuntJumpManager::Update()
{
  CPlayerPed *PlayerPed; // r5
  __int16 v1; // r6
  CVehicle *m_pMyVehicle; // r4
  bool v3; // zf
  int v4; // r11
  int v5; // r8
  CStuntJumpManager::JumpState *v6; // r3
  CMatrix *v7; // r2
  CStuntJump *v8; // r0
  float *p_x; // r1
  float v10; // s2
  float v11; // s4
  int32 m_iScore; // r4
  int v13; // r0
  UInt8 PlayerState; // r2
  bool v15; // r2
  int v16; // r2
  CMatrix *m_pMat; // r6
  float *p_tx; // r3
  float v19; // s2
  float v20; // s4
  CVehicle *PlayerVehicle; // r0
  CPed *v22; // r0
  GxtChar *v23; // r0
  GxtChar *v24; // r1
  GxtChar *v25; // r0
  CStuntJumpManager::JumpState *v26; // [sp+14h] [bp-3Ch]
  CVector UpOffsets; // [sp+28h] [bp-28h] BYREF

  if ( CStuntJumpManager::mp_poolStuntJumps )
  {
    PlayerPed = FindPlayerPed(-1);
    v1 = CWorld::PlayerInFocus;
    if ( CStuntJumpManager::m_jumpState == JUMP_LANDED )
    {
      CStuntJumpManager::m_iTimer += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
      if ( CStuntJumpManager::m_iTimer >= 300 )
      {
        CTimer::ms_fTimeScale = 1.0;
        CCamera::RestoreWithJumpCut(&TheCamera);
        if ( CStuntJumpManager::m_bHitReward && !CStuntJumpManager::mp_Active->m_bPassed )
        {
          CStuntJumpManager::mp_Active->m_bPassed = 1;
          ++CStuntJumpManager::m_iNumCompleted;
          CStats::IncrementStat(0x91u, 1.0);
          if ( CStuntJumpManager::m_iNumCompleted == CStuntJumpManager::m_iNumJumps )
            m_iScore = 10000;
          else
            m_iScore = CStuntJumpManager::mp_Active->m_iScore;
          CWorld::Players[v1].Score += m_iScore;
          CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 43, 0.0, 1.0);
          v23 = CText::Get(&TheText, (const unsigned __int8 *)&dword_361C28);
          if ( v23 )
            CMessages::AddBigMessageQ(v23, 0x1388u, 4u);
          if ( CStuntJumpManager::m_iNumCompleted == CStuntJumpManager::m_iNumJumps )
          {
            v24 = CText::Get(&TheText, "USJ_ALL");
            if ( v24 )
              CHud::SetHelpMessage("USJ_ALL", v24, 0, 0, 0, 0);
          }
          v25 = CText::Get(&TheText, "REWARD");
          if ( v25 )
            CMessages::AddBigMessageWithNumber(v25, 0x1770u, 5u, m_iScore, -1, -1, -1, -1, -1);
        }
        CStuntJumpManager::mp_Active = 0;
        CStuntJumpManager::m_jumpState = JUMP_INACTIVE;
      }
    }
    else
    {
      m_pMyVehicle = PlayerPed->m_pMyVehicle;
      if ( CStuntJumpManager::m_jumpState == JUMP_JUMPING )
      {
        if ( CStuntJumpManager::mp_Active )
        {
          v13 = CStuntJumpManager::m_iTimer;
          if ( m_pMyVehicle->m_nNoOfCollisionRecords && CStuntJumpManager::m_iTimer > 99 )
            goto LABEL_55;
          PlayerState = CWorld::Players[CWorld::PlayerInFocus].PlayerState;
          v15 = PlayerState != 0;
          v16 = (*(_BYTE *)&m_pMyVehicle->m_info & 0xF8) == 40
             || (*((_BYTE *)&m_pMyVehicle->m_nVehicleFlags + 3) & 0x40) != 0
             || *((unsigned __int8 *)&m_pMyVehicle->m_nPhysicalFlags + 1) << 31
             || v15
             || (*((_BYTE *)&PlayerPed->m_nPedFlags + 1) & 1) == 0;
          m_pMat = m_pMyVehicle->m_pMat;
          p_tx = &m_pMat->tx;
          if ( !m_pMat )
            p_tx = &m_pMyVehicle->m_transform.m_translate.x;
          if ( *p_tx >= CStuntJumpManager::mp_Active->m_bbEnd.m_vecMin.x )
          {
            v19 = p_tx[1];
            if ( v19 >= CStuntJumpManager::mp_Active->m_bbEnd.m_vecMin.y )
            {
              v20 = p_tx[2];
              if ( v20 >= CStuntJumpManager::mp_Active->m_bbEnd.m_vecMin.z
                && *p_tx <= CStuntJumpManager::mp_Active->m_bbEnd.m_vecMax.x
                && v19 <= CStuntJumpManager::mp_Active->m_bbEnd.m_vecMax.y
                && v20 <= CStuntJumpManager::mp_Active->m_bbEnd.m_vecMax.z )
              {
                CStuntJumpManager::m_bHitReward = 1;
              }
            }
          }
          if ( v16 )
          {
LABEL_55:
            v13 = 0;
            CStuntJumpManager::m_iTimer = 0;
            CStuntJumpManager::m_jumpState = JUMP_LANDED;
          }
          CStuntJumpManager::m_iTimer = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) + v13;
          if ( v13 <= 1000 && (int)((unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) + v13) > 1000 )
          {
            if ( FindPlayerVehicle(-1, 0) )
            {
              PlayerVehicle = FindPlayerVehicle(-1, 0);
              v22 = CVehicle::PickRandomPassenger(PlayerVehicle);
              if ( v22 )
                CPed::Say(v22, 0x25u, 0, 1.0, 0, 0, 0);
            }
          }
        }
        else
        {
          CStuntJumpManager::m_jumpState = JUMP_INACTIVE;
        }
      }
      else if ( CStuntJumpManager::m_jumpState == JUMP_INACTIVE
             && CStuntJumpManager::m_bActive
             && !CWorld::Players[CWorld::PlayerInFocus].PlayerState )
      {
        v3 = m_pMyVehicle == 0;
        if ( m_pMyVehicle )
          v3 = (*(_DWORD *)&PlayerPed->m_nPedFlags & 0x100) == 0;
        if ( !v3
          && CVehicle::GetVehicleAppearance(PlayerPed->m_pMyVehicle) != APR_BOAT
          && m_pMyVehicle->pDriver == PlayerPed
          && CVehicle::GetVehicleAppearance(m_pMyVehicle) != APR_PLANE
          && CVehicle::GetVehicleAppearance(m_pMyVehicle) != APR_HELI
          && !m_pMyVehicle->m_nNoOfCollisionRecords
          && (float)(sqrtf(
                       (float)((float)(m_pMyVehicle->m_vecMoveSpeed.x * m_pMyVehicle->m_vecMoveSpeed.x)
                             + (float)(m_pMyVehicle->m_vecMoveSpeed.y * m_pMyVehicle->m_vecMoveSpeed.y))
                     + (float)(m_pMyVehicle->m_vecMoveSpeed.z * m_pMyVehicle->m_vecMoveSpeed.z))
                   * 50.0) >= 20.0 )
        {
          v4 = 0;
          v5 = 0;
          v6 = &CStuntJumpManager::m_jumpState;
          do
          {
            if ( (CStuntJumpManager::mp_poolStuntJumps->m_aFlags[v5] & 0x80u) == 0 )
            {
              v7 = m_pMyVehicle->m_pMat;
              v8 = (CStuntJump *)CStuntJumpManager::mp_poolStuntJumps->m_aStorage[v4];
              p_x = &v7->tx;
              if ( !v7 )
                p_x = &m_pMyVehicle->m_transform.m_translate.x;
              if ( *p_x >= v8->m_bbStart.m_vecMin.x )
              {
                v10 = p_x[1];
                if ( v10 >= v8->m_bbStart.m_vecMin.y )
                {
                  v11 = p_x[2];
                  if ( v11 >= v8->m_bbStart.m_vecMin.z
                    && *p_x <= v8->m_bbStart.m_vecMax.x
                    && v10 <= v8->m_bbStart.m_vecMax.y
                    && v11 <= v8->m_bbStart.m_vecMax.z )
                  {
                    CStuntJumpManager::m_iTimer = 0;
                    CStuntJumpManager::mp_Active = v8;
                    v26 = v6;
                    *v6 = JUMP_JUMPING;
                    CStuntJumpManager::m_bHitReward = 0;
                    if ( !v8->m_bFound )
                    {
                      v8->m_bFound = 1;
                      CStats::IncrementStat(0x90u, 1.0);
                      v8 = CStuntJumpManager::mp_Active;
                    }
                    CTimer::ms_fTimeScale = 0.3;
                    memset(&UpOffsets, 0, sizeof(UpOffsets));
                    CCamera::SetCamPositionForFixedMode(&TheCamera, &v8->m_vecCamera, &UpOffsets);
                    CCamera::TakeControl(&TheCamera, m_pMyVehicle, 15, 2, 1);
                    v6 = v26;
                  }
                }
              }
            }
            ++v5;
            ++v4;
          }
          while ( v5 != 256 );
        }
      }
    }
  }
}
// 361C28: using guessed type int dword_361C28;

//----- (00361CA4) --------------------------------------------------------
int32 __fastcall CStuntJumpManager::AddOne(
        const CBoundBox *r_bbStart,
        const CBoundBox *r_bbEnd,
        const CVector *r_vecCamera,
        int32 iScore)
{
  CStuntJumpPool *v4; // r12
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // lr
  int v7; // r8
  uint8 *m_aFlags; // r6
  int v9; // r5
  int v10; // r5
  __int64 v11; // d17
  __int64 v12; // d18
  __int64 v13; // d17
  __int64 v14; // d18
  __int64 v15; // d16

  v4 = CStuntJumpManager::mp_poolStuntJumps;
  if ( !CStuntJumpManager::mp_poolStuntJumps )
    return -1;
  m_nFreeIndex = CStuntJumpManager::mp_poolStuntJumps->m_nFreeIndex;
  m_nSize = CStuntJumpManager::mp_poolStuntJumps->m_nSize;
  v7 = 0;
  do
  {
    v4->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v4->m_nFreeIndex = 0;
      if ( v7 << 31 )
        return -1;
      v7 = 1;
    }
    m_aFlags = v4->m_aFlags;
    v9 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v9 > -1 );
  m_aFlags[m_nFreeIndex] = v9 & 0x7F;
  v4->m_aFlags[v4->m_nFreeIndex] = (v4->m_aFlags[v4->m_nFreeIndex] + 1) & 0x7F | v4->m_aFlags[v4->m_nFreeIndex] & 0x80;
  v10 = (int)v4->m_aStorage[v4->m_nFreeIndex];
  if ( !v10 )
    return -1;
  v11 = *(_QWORD *)&r_bbStart->m_vecMin.z;
  v12 = *(_QWORD *)&r_bbStart->m_vecMax.y;
  *(_QWORD *)v10 = *(_QWORD *)&r_bbStart->m_vecMin.x;
  *(_QWORD *)(v10 + 8) = v11;
  *(_QWORD *)(v10 + 16) = v12;
  v13 = *(_QWORD *)&r_bbEnd->m_vecMin.z;
  v14 = *(_QWORD *)&r_bbEnd->m_vecMax.y;
  *(_QWORD *)(v10 + 24) = *(_QWORD *)&r_bbEnd->m_vecMin.x;
  *(_QWORD *)(v10 + 32) = v13;
  *(_QWORD *)(v10 + 40) = v14;
  v15 = *(_QWORD *)&r_vecCamera->x;
  *(RwReal *)(v10 + 56) = r_vecCamera->z;
  *(_DWORD *)(v10 + 60) = iScore;
  *(_WORD *)(v10 + 64) = 0;
  *(_QWORD *)(v10 + 48) = v15;
  ++CStuntJumpManager::m_iNumJumps;
  return -252645135 * ((signed int)(v10 - (unsigned int)CStuntJumpManager::mp_poolStuntJumps->m_aStorage) >> 2);
}

//----- (00361D98) --------------------------------------------------------
void __fastcall CStuntJumpManager::SetActive(bool bNewState)
{
  CStuntJumpManager::m_bActive = bNewState;
}

//----- (00361DA8) --------------------------------------------------------
void CTagManager::Init()
{
  CTagManager::ms_numTagged = 0;
  CTagManager::ms_numTags = 0;
}

//----- (00361DC4) --------------------------------------------------------
void CTagManager::ShutdownForRestart()
{
  uint32 i; // r0
  CTagManager::TagDesc *v1; // r3

  for ( i = CTagManager::ms_numTags; i; v1[-1].m_alpha = 0 )
    v1 = &CTagManager::ms_tagDesc[i--];
  CTagManager::ms_numTagged = 0;
}

//----- (00361DFC) --------------------------------------------------------
CVector *__fastcall CTagManager::GetTagPos(int32 i)
{
  CEntity *m_pEntity; // r1
  CVector *m_pMat; // r2
  CVector *result; // r0

  m_pEntity = CTagManager::ms_tagDesc[i].m_pEntity;
  m_pMat = (CVector *)m_pEntity->m_pMat;
  result = m_pMat + 4;
  if ( !m_pMat )
    return &m_pEntity->m_transform.m_translate;
  return result;
}

//----- (00361E18) --------------------------------------------------------
void __fastcall CTagManager::AddTag(CEntity *pEntity)
{
  uint32 v1; // r3

  v1 = CTagManager::ms_numTags;
  CTagManager::ms_tagDesc[CTagManager::ms_numTags].m_pEntity = pEntity;
  CTagManager::ms_tagDesc[v1].m_alpha = 0;
  CTagManager::ms_numTags = v1 + 1;
}

//----- (00361E40) --------------------------------------------------------
CTagManager::TagDesc *__fastcall CTagManager::FindTagDesc(CEntity *pEntity)
{
  uint32 v2; // r2
  CTagManager::TagDesc *result; // r0
  CEntity *m_pEntity; // t1

  v2 = CTagManager::ms_numTags;
  result = &CTagManager::ms_tagDesc[CTagManager::ms_numTags];
  while ( v2 )
  {
    m_pEntity = result[-1].m_pEntity;
    --result;
    --v2;
    if ( m_pEntity == pEntity )
      return result;
  }
  return 0;
}

//----- (00361E74) --------------------------------------------------------
bool __fastcall CTagManager::IsTag(const CEntity *pEntity)
{
  CBaseModelInfo *v1; // r5
  bool v2; // r4

  v1 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  if ( (*((int (__fastcall **)(CBaseModelInfo *))v1->_vptr$CBaseModelInfo + 10))(v1) != 1 )
    return 0;
  v2 = 0;
  if ( (v1->m_flags & 0x7800) == 12288
    && *(__int16 *)((*((int (__fastcall **)(CBaseModelInfo *))v1->_vptr$CBaseModelInfo + 2))(v1) + 40) > -1 )
  {
    return 1;
  }
  return v2;
}

//----- (00361EC4) --------------------------------------------------------
void __fastcall CTagManager::SetAlpha(CEntity *pEntity, uint8 alpha)
{
  unsigned int v3; // r6
  RpAtomic_0 *m_pRwObject; // r0
  uint32 v5; // r4
  CTagManager::TagDesc *v6; // r1
  uint32 v7; // r0
  CEntity *m_pEntity; // t1
  unsigned int m_alpha; // r2
  int v10; // r1
  uint32 v11; // r0
  CTagManager::TagDesc *v12; // r6
  char *v13; // r0
  Int16 v14; // r3
  int v15; // r1
  CTagManager::TagDesc *v16; // r0

  v3 = alpha;
  m_pRwObject = (RpAtomic_0 *)pEntity->m_pRwObject;
  if ( m_pRwObject )
    CVisibilityPlugins::SetUserValue(m_pRwObject, alpha);
  v5 = CTagManager::ms_numTags;
  v6 = &CTagManager::ms_tagDesc[CTagManager::ms_numTags];
  v7 = CTagManager::ms_numTags;
  do
  {
    if ( !v7 )
    {
      v6 = 0;
      if ( v3 >= 0xE5 )
        goto LABEL_7;
      goto LABEL_17;
    }
    m_pEntity = v6[-1].m_pEntity;
    --v6;
    --v7;
  }
  while ( m_pEntity != pEntity );
  if ( v3 >= 0xE5 )
  {
LABEL_7:
    m_alpha = v6->m_alpha;
    v6->m_alpha = v3;
    v10 = 0;
    CTagManager::ms_numTagged = 0;
    if ( v5 )
    {
      v10 = 0;
      v11 = v5;
      do
      {
        v12 = &CTagManager::ms_tagDesc[v11--];
        if ( v12[-1].m_alpha >= 0xE5u )
          CTagManager::ms_numTagged = ++v10;
      }
      while ( v11 );
    }
    if ( m_alpha <= 0xE4 && !TheCamera.m_WideScreenOn )
    {
      if ( v10 == v5 )
      {
        v13 = "TAG_ALL";
        LOWORD(v10) = -1;
        v14 = -1;
      }
      else
      {
        v14 = v5;
        v13 = "TAG_ONE";
      }
      sub_19BFB0((unsigned __int8 *)v13, v10, 0x1388u, v14);
    }
    return;
  }
LABEL_17:
  v6->m_alpha = v3;
  CTagManager::ms_numTagged = 0;
  if ( v5 )
  {
    v15 = 0;
    do
    {
      v16 = &CTagManager::ms_tagDesc[v5--];
      if ( v16[-1].m_alpha >= 0xE5u )
        CTagManager::ms_numTagged = ++v15;
    }
    while ( v5 );
  }
}

//----- (00361FF0) --------------------------------------------------------
void CTagManager::UpdateNumTagged()
{
  uint32 v0; // r0
  int v1; // r1
  CTagManager::TagDesc *v2; // r3

  v0 = CTagManager::ms_numTags;
  CTagManager::ms_numTagged = 0;
  if ( CTagManager::ms_numTags )
  {
    v1 = 0;
    do
    {
      v2 = &CTagManager::ms_tagDesc[v0--];
      if ( v2[-1].m_alpha >= 0xE5u )
        CTagManager::ms_numTagged = ++v1;
    }
    while ( v0 );
  }
}

//----- (00362044) --------------------------------------------------------
uint8 __fastcall CTagManager::GetAlpha(CEntity *pEntity)
{
  uint8 *p_m_alpha; // r1
  CEntity *v3; // r2

  if ( pEntity->m_pRwObject )
    return CVisibilityPlugins::GetUserValue((RpAtomic_0 *)pEntity->m_pRwObject);
  p_m_alpha = &CTagManager::ms_tagDesc[CTagManager::ms_numTags].m_alpha;
  do
  {
    v3 = (CEntity *)*((_DWORD *)p_m_alpha - 3);
    p_m_alpha -= 8;
  }
  while ( v3 != pEntity );
  return *p_m_alpha;
}

//----- (00362088) --------------------------------------------------------
uint8 __fastcall CTagManager::GetAlpha(RpAtomic_0 *pAtomic)
{
  return CVisibilityPlugins::GetUserValue(pAtomic);
}

//----- (00362094) --------------------------------------------------------
void __fastcall CTagManager::ResetAlpha(CEntity *pEntity)
{
  RpAtomic_0 *m_pRwObject; // r0
  uint8 *p_m_alpha; // r2
  CEntity *v4; // r3

  m_pRwObject = (RpAtomic_0 *)pEntity->m_pRwObject;
  if ( m_pRwObject )
  {
    p_m_alpha = &CTagManager::ms_tagDesc[CTagManager::ms_numTags].m_alpha;
    do
    {
      v4 = (CEntity *)*((_DWORD *)p_m_alpha - 3);
      p_m_alpha -= 8;
    }
    while ( v4 != pEntity );
    sub_197574(m_pRwObject, *p_m_alpha);
  }
}

//----- (003620CC) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CTagManager::SetAlphaInArea(CRect *area, uint8 alpha)
{
  uint16 v3; // r8
  uint32 v4; // r6
  uint8 *p_m_alpha; // r4
  int v6; // r0
  int v7; // r2
  float *v8; // r1
  float v9; // s0
  RpAtomic_0 *v10; // r0
  uint32 v11; // r0
  int v12; // r1
  CTagManager::TagDesc *v13; // r6

  v3 = alpha;
  v4 = CTagManager::ms_numTags;
  if ( CTagManager::ms_numTags )
  {
    p_m_alpha = &CTagManager::ms_tagDesc[CTagManager::ms_numTags - 1].m_alpha;
    do
    {
      v6 = *((_DWORD *)p_m_alpha - 1);
      --v4;
      v7 = *(_DWORD *)(v6 + 20);
      v8 = (float *)(v7 + 48);
      if ( !v7 )
        v8 = (float *)(v6 + 4);
      if ( *v8 >= area->left && *v8 <= area->right )
      {
        v9 = v8[1];
        if ( v9 >= area->bottom && v9 <= area->top )
        {
          v10 = *(RpAtomic_0 **)(v6 + 24);
          if ( v10 )
            CVisibilityPlugins::SetUserValue(v10, v3);
          *p_m_alpha = v3;
        }
      }
      p_m_alpha -= 8;
    }
    while ( v4 );
    v11 = CTagManager::ms_numTags;
    CTagManager::ms_numTagged = 0;
    if ( CTagManager::ms_numTags )
    {
      v12 = 0;
      do
      {
        v13 = &CTagManager::ms_tagDesc[v11--];
        if ( v13[-1].m_alpha >= 0xE5u )
          CTagManager::ms_numTagged = ++v12;
      }
      while ( v11 );
    }
  }
  else
  {
    CTagManager::ms_numTagged = 0;
  }
}
// 3620CC: variables would overlap: r1.1 and r1.2
// 677FC0: using guessed type int *CTagManager::ms_numTagged;

//----- (003621C4) --------------------------------------------------------
int __fastcall CTagManager::GetPercentageTaggedInArea(CRect *area)
{
  uint32 v1; // r1
  float left; // s0
  int v3; // lr
  float top; // s2
  float right; // s4
  float bottom; // s6
  int v7; // r0
  uint32 v8; // r2
  CEntity *m_pEntity; // r1
  CMatrix *m_pMat; // r5
  float *p_tx; // r4
  float v12; // s8

  v1 = CTagManager::ms_numTags;
  if ( CTagManager::ms_numTags )
  {
    left = area->left;
    v3 = 0;
    top = area->top;
    right = area->right;
    bottom = area->bottom;
    v7 = 0;
    do
    {
      while ( 1 )
      {
        v8 = v1;
        m_pEntity = CTagManager::ms_tagDesc[v1 - 1].m_pEntity;
        m_pMat = m_pEntity->m_pMat;
        p_tx = &m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pEntity->m_transform.m_translate.x;
        v1 = v8 - 1;
        if ( *p_tx >= left && *p_tx <= right )
        {
          v12 = p_tx[1];
          if ( v12 >= bottom && v12 <= top )
            break;
        }
        if ( v8 == 1 )
          return (int)(float)((float)((float)v3 / (float)v7) * 100.0);
      }
      ++v7;
      if ( CTagManager::ms_tagDesc[v8 - 1].m_alpha > 0xE4u )
        ++v3;
    }
    while ( v8 != 1 );
  }
  else
  {
    v7 = 0;
    v3 = 0;
  }
  return (int)(float)((float)((float)v3 / (float)v7) * 100.0);
}

//----- (0036229C) --------------------------------------------------------
int CTagManager::GetPercentageTagged()
{
  return (int)(float)((float)((float)CTagManager::ms_numTagged / (float)CTagManager::ms_numTags) * 100.0);
}

//----- (003622DC) --------------------------------------------------------
CEntity *__fastcall CTagManager::GetNearestTag(const CVector *posn)
{
  float32x2_t v1; // d0
  uint32 v2; // r1
  int v3; // lr
  float32x2_t v4; // d16
  CEntity *m_pEntity; // r3
  CMatrix *m_pMat; // r2
  float32x2_t *p_tx; // r0
  float32x2_t v8; // d17
  float32x2_t v9; // d1
  bool v10; // nf

  if ( CTagManager::ms_numTags )
  {
    v2 = CTagManager::ms_numTags - 1;
    v1.n64_u32[0] = 2139095039;
    v3 = -1;
    v4.n64_u64[0] = *(unsigned __int64 *)&posn->x;
    do
    {
      m_pEntity = CTagManager::ms_tagDesc[v2].m_pEntity;
      m_pMat = m_pEntity->m_pMat;
      p_tx = (float32x2_t *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = (float32x2_t *)&m_pEntity->m_transform;
      v8.n64_u64[0] = vsub_f32(v4, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
      v9.n64_u64[0] = vmul_f32(v8, v8).n64_u64[0];
      v9.n64_f32[0] = v9.n64_f32[0] + v9.n64_f32[1];
      v10 = v9.n64_f32[0] < v1.n64_f32[0];
      v1.n64_u64[0] = vmin_f32(v9, v1).n64_u64[0];
      if ( v10 )
        v3 = v2;
      --v2;
    }
    while ( v2 != -1 );
  }
  else
  {
    v3 = -1;
  }
  return CTagManager::ms_tagDesc[v3].m_pEntity;
}
// 362320: variable 'v1' is possibly undefined

//----- (0036235C) --------------------------------------------------------
void __fastcall CTagManager::SetupAtomic(RpAtomic_0 *pAtomic)
{
  RpGeometry_0 *geometry; // r1

  geometry = pAtomic->geometry;
  *(_DWORD *)(*((_DWORD *)geometry->matList.materials + 1) + 8) = 0;
  geometry->flags |= 0x40u;
  sub_197574(pAtomic, 0);
}

//----- (00362374) --------------------------------------------------------
void __fastcall CTagManager::RenderTagForPC(RpAtomic_0 *pAtomic)
{
  int v2; // r5
  int v3; // r8
  int UserValue; // r6

  v2 = *((_DWORD *)pAtomic->geometry->matList.materials + 1);
  v3 = *(_DWORD *)(v2 + 4);
  UserValue = (unsigned __int8)CVisibilityPlugins::GetUserValue(pAtomic);
  *(_DWORD *)(v2 + 4) = ((2155905153u
                        * (unsigned __int64)((unsigned int)CVisibilityPlugins::GetUserValue(pAtomic) * UserValue)) >> 32 << 17) & 0xFF000000 | v3 & 0xFFFFFF;
  pAtomic->renderCallBack(pAtomic);
}

//----- (003623BC) --------------------------------------------------------
int __fastcall DoesLineSegmentIntersect(
        float A1X,
        float A1Y,
        float A2X,
        float A2Y,
        float B1X,
        float B1Y,
        float B2X,
        float B2Y)
{
  int result; // r0

  result = 0;
  if ( (float)((float)((float)((float)(A2X - A1X) * (float)(B1Y - A1Y))
                     - (float)((float)(A2Y - A1Y) * (float)(B1X - A1X)))
             * (float)((float)((float)(A2X - A1X) * (float)(B2Y - A1Y))
                     - (float)((float)(A2Y - A1Y) * (float)(B2X - A1X)))) <= 0.0
    && (float)((float)((float)((float)(A1Y - B1Y) * (float)(B2X - B1X))
                     - (float)((float)(A1X - B1X) * (float)(B2Y - B1Y)))
             * (float)((float)((float)(A2Y - B1Y) * (float)(B2X - B1X))
                     - (float)((float)(A2X - B1X) * (float)(B2Y - B1Y)))) <= 0.0 )
  {
    return 1;
  }
  return result;
}

//----- (00362460) --------------------------------------------------------
UInt8 __fastcall CTrafficLights::ShouldCarStopForLight(CVehicle *pCar, bool bDontCheckLights)
{
  _BOOL4 v2; // r5
  unsigned int Address; // r0
  int v5; // r10
  CCarPathLink *v6; // r9
  CCarPathLink *v7; // r11
  int Region; // r1
  int v9; // r3
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  float v12; // s0
  _BOOL4 active; // r0
  bool v14; // zf
  _BOOL4 v15; // r1
  UInt8 result; // r0
  bool v17; // zf
  unsigned int v18; // r0
  int v19; // r10
  CCarPathLink *v20; // r9
  CCarPathLink *v21; // r11
  int v22; // r1
  int v23; // r3
  CMatrix *v24; // r1
  CSimpleTransform *p_m_transform; // r2
  float v26; // s0
  _BOOL4 v27; // r0
  bool v28; // zf
  _BOOL4 v29; // r1
  bool v30; // zf
  unsigned int v31; // r0
  int v32; // r9
  CCarPathLink *v33; // r8
  CCarPathLink *v34; // r10
  int v35; // r1
  int v36; // r2
  CMatrix *v37; // r1
  CSimpleTransform *v38; // r2
  float v39; // s0
  _BOOL4 v40; // r0
  bool v41; // zf
  _BOOL4 v42; // r1
  bool v43; // zf

  v2 = bDontCheckLights;
  if ( CVehicle::GetVehicleAppearance(pCar) == APR_HELI || CVehicle::GetVehicleAppearance(pCar) == APR_PLANE )
    return 0;
  Address = pCar->AutoPilot.OldLink.Address;
  if ( Address == 0xFFFF )
    goto LABEL_34;
  if ( !ThePaths.pNodes[Address >> 10] )
    goto LABEL_34;
  v5 = Address & 0x3FF;
  v6 = ThePaths.pLinks[Address >> 10];
  v7 = &v6[Address & 0x3FF];
  if ( (*(_WORD *)((char *)v7 + 11) & 0x300) == 0 )
    goto LABEL_34;
  Region = pCar->AutoPilot.OldNode.Region;
  v9 = v7->Node1.Region;
  if ( (*(_WORD *)((char *)v7 + 11) & 0x40) != 0 )
  {
    if ( v9 != Region || v7->Node1.Index != pCar->AutoPilot.OldNode.Index )
      goto LABEL_34;
  }
  else if ( v9 == Region && v7->Node1.Index == pCar->AutoPilot.OldNode.Index )
  {
    goto LABEL_34;
  }
  if ( v2 )
    goto LABEL_13;
  if ( (*(_WORD *)((char *)v7 + 11) & 0x300) == 256 )
  {
    active = CGameLogic::LaRiotsActiveHere();
    v14 = CCheat::m_aCheatsActive[37] == 0;
    if ( !CCheat::m_aCheatsActive[37] )
      v14 = !active;
    if ( v14 && (CTimer::m_snTimeInMilliseconds & 0x7FF0) > 0x270F )
    {
LABEL_13:
      m_pMat = pCar->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pCar->m_transform;
      v12 = (float)((float)(p_tx->m_translate.x - (float)((float)v6[v5].CoorsX * 0.125))
                  * (float)((float)v7->DirXb * 0.01))
          + (float)((float)(p_tx->m_translate.y - (float)((float)v7->CoorsY * 0.125)) * (float)((float)v7->DirYb * 0.01));
      if ( (unsigned __int8)pCar->AutoPilot.InvertDirOldLink == 255 )
      {
        if ( v12 > 0.0 && v12 < 12.0 )
          return 1;
      }
      else if ( v12 < 0.0 && v12 > -12.0 )
      {
        return 1;
      }
LABEL_34:
      v18 = pCar->AutoPilot.NewLink.Address;
      if ( v18 == 0xFFFF )
        goto LABEL_65;
      if ( !ThePaths.pNodes[v18 >> 10] )
        goto LABEL_65;
      v19 = v18 & 0x3FF;
      v20 = ThePaths.pLinks[v18 >> 10];
      v21 = &v20[v18 & 0x3FF];
      if ( (*(_WORD *)((char *)v21 + 11) & 0x300) == 0 )
        goto LABEL_65;
      v22 = pCar->AutoPilot.NewNode.Region;
      v23 = v21->Node1.Region;
      if ( (*(_WORD *)((char *)v21 + 11) & 0x40) != 0 )
      {
        if ( v23 != v22 || v21->Node1.Index != pCar->AutoPilot.NewNode.Index )
          goto LABEL_65;
      }
      else if ( v23 == v22 && v21->Node1.Index == pCar->AutoPilot.NewNode.Index )
      {
        goto LABEL_65;
      }
      if ( !v2 )
      {
        if ( (*(_WORD *)((char *)v21 + 11) & 0x300) != 256 )
          goto LABEL_56;
        v27 = CGameLogic::LaRiotsActiveHere();
        v28 = CCheat::m_aCheatsActive[37] == 0;
        if ( !CCheat::m_aCheatsActive[37] )
          v28 = !v27;
        if ( !v28 || (CTimer::m_snTimeInMilliseconds & 0x7FF0) <= 0x270F )
        {
LABEL_56:
          if ( (*(_WORD *)((char *)v21 + 11) & 0x300) != 512 )
            return 0;
          v29 = CGameLogic::LaRiotsActiveHere();
          result = 0;
          v30 = CCheat::m_aCheatsActive[37] == 0;
          if ( !CCheat::m_aCheatsActive[37] )
            v30 = !v29;
          if ( !v30 )
            return result;
          if ( ((CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF) - 6000 < 0x1388 )
            return 0;
        }
      }
      v24 = pCar->m_pMat;
      p_m_transform = (CSimpleTransform *)&v24->tx;
      if ( !v24 )
        p_m_transform = &pCar->m_transform;
      v26 = (float)((float)(p_m_transform->m_translate.x - (float)((float)v20[v19].CoorsX * 0.125))
                  * (float)((float)v21->DirXb * 0.01))
          + (float)((float)(p_m_transform->m_translate.y - (float)((float)v21->CoorsY * 0.125))
                  * (float)((float)v21->DirYb * 0.01));
      if ( (unsigned __int8)pCar->AutoPilot.InvertDirNewLink == 255 )
      {
        if ( v26 > 0.0 && v26 < 12.0 )
          return 1;
      }
      else if ( v26 < 0.0 && v26 > -12.0 )
      {
        return 1;
      }
LABEL_65:
      v31 = pCar->AutoPilot.VeryOldLink.Address;
      if ( v31 == 0xFFFF )
        return 0;
      if ( !ThePaths.pNodes[v31 >> 10] )
        return 0;
      if ( (*(_BYTE *)&pCar->m_info & 0xF8) != 24 )
        return 0;
      v32 = v31 & 0x3FF;
      v33 = ThePaths.pLinks[v31 >> 10];
      v34 = &v33[v31 & 0x3FF];
      if ( (*(_WORD *)((char *)v34 + 11) & 0x300) == 0 )
        return 0;
      v35 = pCar->AutoPilot.VeryOldNode.Region;
      v36 = v34->Node1.Region;
      if ( (*(_WORD *)((char *)v34 + 11) & 0x40) != 0 )
      {
        if ( v36 != v35 || v34->Node1.Index != pCar->AutoPilot.VeryOldNode.Index )
          return 0;
      }
      else if ( v36 == v35 && v34->Node1.Index == pCar->AutoPilot.VeryOldNode.Index )
      {
        return 0;
      }
      if ( !v2 )
      {
        if ( (*(_WORD *)((char *)v34 + 11) & 0x300) != 256 )
          goto LABEL_88;
        v40 = CGameLogic::LaRiotsActiveHere();
        v41 = CCheat::m_aCheatsActive[37] == 0;
        if ( !CCheat::m_aCheatsActive[37] )
          v41 = !v40;
        if ( !v41 || (CTimer::m_snTimeInMilliseconds & 0x7FF0) <= 0x270F )
        {
LABEL_88:
          if ( (*(_WORD *)((char *)v34 + 11) & 0x300) != 512 )
            return 0;
          v42 = CGameLogic::LaRiotsActiveHere();
          result = 0;
          v43 = CCheat::m_aCheatsActive[37] == 0;
          if ( !CCheat::m_aCheatsActive[37] )
            v43 = !v42;
          if ( !v43 )
            return result;
          if ( ((CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF) - 6000 < 0x1388 )
            return 0;
        }
      }
      v37 = pCar->m_pMat;
      v38 = (CSimpleTransform *)&v37->tx;
      if ( !v37 )
        v38 = &pCar->m_transform;
      v39 = (float)((float)(v38->m_translate.x - (float)((float)v33[v32].CoorsX * 0.125))
                  * (float)((float)v34->DirXb * 0.01))
          + (float)((float)(v38->m_translate.y - (float)((float)v34->CoorsY * 0.125)) * (float)((float)v34->DirYb * 0.01));
      if ( (unsigned __int8)pCar->AutoPilot.InvertDirVeryOldLink == 255 )
      {
        result = 0;
        if ( v39 > 0.0 && v39 < 6.0 )
          return 1;
        return result;
      }
      result = 0;
      if ( v39 >= 0.0 || v39 <= -6.0 )
        return result;
      return 1;
    }
  }
  if ( (*(_WORD *)((char *)v7 + 11) & 0x300) != 512 )
    return 0;
  v15 = CGameLogic::LaRiotsActiveHere();
  result = 0;
  v17 = CCheat::m_aCheatsActive[37] == 0;
  if ( !CCheat::m_aCheatsActive[37] )
    v17 = !v15;
  if ( v17 )
  {
    if ( ((CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF) - 6000 < 0x1388 )
      return 0;
    goto LABEL_13;
  }
  return result;
}
// 24: using guessed type int dword_24;

//----- (003629F4) --------------------------------------------------------
int CTrafficLights::LightForCars1()
{
  _BOOL4 active; // r0
  unsigned __int8 v1; // r1
  bool v2; // zf
  uint32 v3; // r0

  active = CGameLogic::LaRiotsActiveHere();
  v1 = 0;
  v2 = CCheat::m_aCheatsActive[37] == 0;
  if ( !CCheat::m_aCheatsActive[37] )
    v2 = !active;
  if ( v2 )
  {
    v3 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
    if ( v3 < 0x1388 )
      return 0;
    v1 = 2;
    if ( v3 < 0x1770 )
      return 1;
  }
  return v1;
}
// 24: using guessed type int dword_24;

//----- (00362A44) --------------------------------------------------------
int CTrafficLights::LightForCars2()
{
  _BOOL4 active; // r0
  unsigned __int8 v1; // r1
  bool v2; // zf
  uint32 v3; // r0

  active = CGameLogic::LaRiotsActiveHere();
  v1 = 0;
  v2 = CCheat::m_aCheatsActive[37] == 0;
  if ( !CCheat::m_aCheatsActive[37] )
    v2 = !active;
  if ( v2 )
  {
    v3 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
    if ( v3 < 0x1770 )
      return 2;
    if ( v3 < 0x2AF8 )
      return 0;
    v1 = 2;
    if ( v3 < 0x2EE0 )
      return 1;
  }
  return v1;
}
// 24: using guessed type int dword_24;

//----- (00362AA0) --------------------------------------------------------
int CTrafficLights::LightForCars1_Visual()
{
  unsigned __int8 v0; // r1
  _BOOL4 active; // r0
  unsigned __int8 v3; // r1
  bool v4; // zf
  uint32 v5; // r0

  if ( CGameLogic::LaRiotsActiveHere() )
  {
    v0 = 3;
    if ( (CTimer::m_snTimeInMilliseconds & 0x400) == 0 )
      return 1;
    return v0;
  }
  else
  {
    active = CGameLogic::LaRiotsActiveHere();
    v3 = 0;
    v4 = CCheat::m_aCheatsActive[37] == 0;
    if ( !CCheat::m_aCheatsActive[37] )
      v4 = !active;
    if ( v4 )
    {
      v5 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
      if ( v5 < 0x1388 )
        return 0;
      v3 = 2;
      if ( v5 < 0x1770 )
        return 1;
    }
    return v3;
  }
}
// 24: using guessed type int dword_24;

//----- (00362B10) --------------------------------------------------------
int CTrafficLights::LightForCars2_Visual()
{
  unsigned __int8 v0; // r1
  _BOOL4 active; // r0
  unsigned __int8 v3; // r1
  bool v4; // zf
  uint32 v5; // r0

  if ( CGameLogic::LaRiotsActiveHere() )
  {
    v0 = 3;
    if ( (CTimer::m_snTimeInMilliseconds & 0x400) == 0 )
      return 1;
    return v0;
  }
  else
  {
    active = CGameLogic::LaRiotsActiveHere();
    v3 = 0;
    v4 = CCheat::m_aCheatsActive[37] == 0;
    if ( !CCheat::m_aCheatsActive[37] )
      v4 = !active;
    if ( v4 )
    {
      v5 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
      if ( v5 < 0x1770 )
        return 2;
      if ( v5 < 0x2AF8 )
        return 0;
      v3 = 2;
      if ( v5 < 0x2EE0 )
        return 1;
    }
    return v3;
  }
}
// 24: using guessed type int dword_24;

//----- (00362B8C) --------------------------------------------------------
int CTrafficLights::LightForPeds()
{
  uint32 v0; // r1
  int result; // r0

  v0 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
  result = v0 > 0x3C17;
  if ( v0 < 0x2EE0 )
    return 2;
  return result;
}

//----- (00362BB4) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CTrafficLights::DisplayActualLight(CEntity *pEntity)
{
  CMatrix *m_pMat; // r0
  int m_nModelIndex; // r0
  char v4; // r6
  Int32 TrafficLightType; // r4
  _BOOL4 active; // r0
  _BOOL4 v7; // r0
  bool v8; // zf
  uint32 v9; // r0
  uint32 v10; // r2
  unsigned int v11; // r1
  _BOOL4 v12; // r0
  bool v13; // zf
  CMatrix *v14; // r0
  CBaseModelInfo *v15; // r8
  float xy; // s0
  float yy; // s4
  float zy; // s2
  unsigned int m_num2dEffects; // r5
  unsigned __int8 v20; // r0
  int32 v21; // r6
  float v22; // s18
  C2dEffect *v23; // r4
  CMatrix *v24; // r1
  int v25; // r0
  int v26; // r1
  int v27; // r2
  bool v28; // zf
  RwReal x; // r10
  RwReal y; // r8
  RwReal z; // r4
  unsigned int v32; // r8
  RwReal v33; // r12
  unsigned int v34; // r11
  RwReal v35; // r4
  float v36; // r10
  float v37; // s0
  float v38; // s6
  float v39; // s4
  float v40; // s2
  float v41; // s0
  unsigned int v42; // r4
  unsigned int v43; // r6
  float v44; // s2
  int v45; // s16
  float v46; // s24
  int z_low; // s22
  int v48; // r0
  float v49; // s20
  float v50; // s18
  float v51; // s26
  char v52; // r0
  char v53; // r0
  CVector *v54; // r0
  CVector *v55; // r1
  char v56; // r0
  char v57; // r0
  int v58; // r1
  uint32 v59; // r2
  CMatrix *v60; // r1
  CMatrix *v61; // r1
  float v62; // s20
  float v63; // s18
  CMatrix *v64; // r1
  CMatrix *v65; // r1
  CMatrix *v66; // r1
  float v67; // s26
  float v68; // s24
  CMatrix *v69; // r1
  CMatrix *v70; // r1
  CMatrix *v71; // r1
  _BYTE B[32]; // [sp+0h] [bp-170h] OVERLAPPED BYREF
  RwReal v73; // [sp+54h] [bp-11Ch]
  float v74; // [sp+58h] [bp-118h]
  UInt8 Type[4]; // [sp+5Ch] [bp-114h]
  unsigned int v76; // [sp+74h] [bp-FCh]
  CBaseModelInfo *v77; // [sp+78h] [bp-F8h]
  CSimpleTransform *p_m_transform; // [sp+7Ch] [bp-F4h]
  uint32 v79; // [sp+80h] [bp-F0h]
  CVector v80; // [sp+84h] [bp-ECh] BYREF
  CVector v81; // [sp+90h] [bp-E0h] BYREF
  CVector v82; // [sp+9Ch] [bp-D4h] BYREF
  CVector Coors1; // [sp+A8h] [bp-C8h] BYREF
  CVector v84; // [sp+B4h] [bp-BCh] BYREF
  CVector v85; // [sp+C0h] [bp-B0h] BYREF
  CVector v86; // [sp+CCh] [bp-A4h] BYREF
  CVector v87; // [sp+D8h] [bp-98h] BYREF
  CVector v88; // [sp+E4h] [bp-8Ch] BYREF
  CVector v89; // [sp+F0h] [bp-80h] BYREF
  CVector v90; // [sp+FCh] [bp-74h] BYREF
  CVector v; // [sp+108h] [bp-68h] BYREF
  CVector pCoors; // [sp+114h] [bp-5Ch] BYREF
  CVector v93; // 0:r0.12
  CVector v94; // 0:r1.12
  CVector v95; // 0:r3.4,4:^0.8

  m_pMat = pEntity->m_pMat;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    m_pMat = pEntity->m_pMat;
  }
  if ( m_pMat->zz < 0.96 || (*((_BYTE *)&pEntity->m_nFlags + 1) & 2) != 0 )
    return;
  m_nModelIndex = pEntity->m_nModelIndex;
  if ( m_nModelIndex == MI_TRAFFICLIGHTS_3
    || m_nModelIndex == MI_TRAFFICLIGHTS_4
    || m_nModelIndex == MI_TRAFFICLIGHTS_5
    || m_nModelIndex == MI_TRAFFICLIGHTS_GAY
    || m_nModelIndex == MI_TRAFFICLIGHTS_MIAMI )
  {
    v4 = 13;
  }
  else
  {
    v4 = 1;
  }
  TrafficLightType = CTrafficLights::FindTrafficLightType(pEntity);
  active = CGameLogic::LaRiotsActiveHere();
  if ( TrafficLightType == 1 )
  {
    if ( active )
      goto LABEL_15;
    v7 = CGameLogic::LaRiotsActiveHere();
    v79 = 0;
    v8 = CCheat::m_aCheatsActive[37] == 0;
    if ( !CCheat::m_aCheatsActive[37] )
      v8 = !v7;
    if ( !v8 )
      goto LABEL_34;
    v9 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
    if ( v9 >= 0x1388 )
    {
      v10 = 2;
      v11 = 6000;
LABEL_31:
      if ( v9 < v11 )
        v10 = 1;
      v79 = v10;
      goto LABEL_34;
    }
    goto LABEL_29;
  }
  if ( !active )
  {
    v12 = CGameLogic::LaRiotsActiveHere();
    v79 = 0;
    v13 = CCheat::m_aCheatsActive[37] == 0;
    if ( !CCheat::m_aCheatsActive[37] )
      v13 = !v12;
    if ( !v13 )
      goto LABEL_34;
    v9 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
    if ( v9 < 0x1770 )
    {
      v79 = 2;
      goto LABEL_34;
    }
    if ( v9 >= 0x2AF8 )
    {
      v10 = 2;
      v11 = 12000;
      goto LABEL_31;
    }
LABEL_29:
    v79 = 0;
    goto LABEL_34;
  }
LABEL_15:
  v79 = (CTimer::m_snTimeInMilliseconds >> 9) & 2 | 1;
LABEL_34:
  v14 = pEntity->m_pMat;
  v15 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  if ( !v14 )
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    v14 = pEntity->m_pMat;
  }
  xy = v14->xy;
  yy = v14->yy;
  zy = v14->zy;
  m_num2dEffects = v15->m_num2dEffects;
  memset(&pCoors, 0, sizeof(pCoors));
  if ( m_num2dEffects )
  {
    p_m_transform = &pEntity->m_transform;
    v20 = v79 + v4;
    v21 = 0;
    v22 = (float)((float)(TheCamera.m_cameraMatrix.xy * xy) + (float)(TheCamera.m_cameraMatrix.yy * yy))
        + (float)(TheCamera.m_cameraMatrix.zy * zy);
    *(_DWORD *)Type = v20;
    v77 = v15;
    v76 = m_num2dEffects;
    do
    {
      v23 = CBaseModelInfo::Get2dEffect(v15, v21);
      if ( !v23->m_type && MobileSettings::settings[0].value >= 2 )
      {
        v24 = pEntity->m_pMat;
        if ( !v24 )
        {
          CPlaceable::AllocateMatrix(pEntity);
          CSimpleTransform::UpdateMatrix(p_m_transform, pEntity->m_pMat);
          v24 = pEntity->m_pMat;
        }
        operator*(&v, v24, &v23->m_posn);
        pCoors.x = v.x + pCoors.x;
        pCoors.y = v.y + pCoors.y;
        pCoors.z = v.z + pCoors.z;
        if ( v23->attr.l.m_colour._anon_0._anon_0.red < 0xC9u )
        {
          v25 = 0;
        }
        else
        {
          v25 = 2;
          if ( v23->attr.l.m_colour._anon_0._anon_0.green > 0x64u )
            v25 = 1;
        }
        v26 = 0;
        v27 = 0;
        if ( v22 > 0.0 )
          v26 = 1;
        if ( v23->m_posn.y > 0.0 )
          v27 = 1;
        v28 = v25 == v79;
        if ( v25 == v79 )
          v28 = (v26 ^ v27) == 1;
        if ( v28 )
        {
          CCoronas::RegisterCorona(
            (u_native)pEntity + v21,
            0,
            (unsigned int)(float)((float)((float)(CTimeCycle::m_CurrentColours.m_fSpriteBrightness / 10.0) * 0.7)
                                * (float)aTrafficLightColoursR[v79]),
            (unsigned int)(float)((float)((float)(CTimeCycle::m_CurrentColours.m_fSpriteBrightness / 10.0) * 0.7)
                                * (float)aTrafficLightColoursG[v79]),
            (unsigned int)(float)((float)((float)(CTimeCycle::m_CurrentColours.m_fSpriteBrightness / 10.0) * 0.7)
                                * (float)aTrafficLightColoursB[v79]),
            0xFFu,
            &v,
            (float)(CTimeCycle::m_CurrentColours.m_fSpriteSize / 10.0) * 1.75,
            50.0,
            0,
            0,
            1u,
            0,
            0,
            0.0,
            0,
            1.5,
            0,
            15.0,
            0,
            0);
          x = v.x;
          v93.y = v.y;
          LODWORD(v93.x) = pEntity->m_pMat;
          v93.z = v.z;
          if ( !LODWORD(v93.x) )
          {
            y = v.y;
            z = v.z;
            CPlaceable::AllocateMatrix(pEntity);
            CSimpleTransform::UpdateMatrix(p_m_transform, pEntity->m_pMat);
            LODWORD(v93.x) = pEntity->m_pMat;
            v93.z = z;
            v93.y = y;
          }
          v32 = *(_DWORD *)(LODWORD(v93.x) + 36);
          v33 = *(float *)(LODWORD(v93.x) + 32);
          v34 = *(_DWORD *)(LODWORD(v93.x) + 40);
          if ( !LODWORD(v93.x) )
          {
            v74 = x;
            v73 = v93.y;
            v35 = v93.z;
            v36 = v33;
            CPlaceable::AllocateMatrix(pEntity);
            CSimpleTransform::UpdateMatrix(p_m_transform, pEntity->m_pMat);
            v33 = v36;
            v93.y = v73;
            LODWORD(v93.x) = pEntity->m_pMat;
            v93.z = v35;
            x = v74;
          }
          *(_QWORD *)B = __PAIR64__(v34, v32);
          *(CVector *)&B[8] = *(CVector *)LODWORD(v93.x);
          memset(&B[20], 0, 12);
          v93.x = x;
          v95.x = v33;
          CBrightLights::RegisterOne(v93, v95, *(CVector *)&B[8], *(CVector *)&B[20], *(int *)Type, 0, 0, 0);
          v15 = v77;
          m_num2dEffects = v76;
        }
      }
      ++v21;
    }
    while ( m_num2dEffects != v21 );
    v37 = 1.0 / (float)m_num2dEffects;
    v38 = v37 * pCoors.x;
    v39 = v37 * pCoors.y;
    v40 = v37 * pCoors.z;
    pCoors.x = v37 * pCoors.x;
    pCoors.y = v37 * pCoors.y;
    pCoors.z = v37 * pCoors.z;
    if ( v79 <= 2 )
    {
      v41 = CWeather::TrafficLightsBrightness;
      if ( CWeather::TrafficLightsBrightness > 0.5 )
      {
        v94.z = v40;
        v42 = 50;
        v94.y = v39;
        v94.x = v38;
        v43 = aTrafficLightColoursG[v79];
        if ( v43 <= 0x32 )
          v43 = 50;
        if ( aTrafficLightColoursR[v79] > 0x32u )
          v42 = aTrafficLightColoursR[v79];
        v44 = (float)aTrafficLightColoursB[v79] * 0.0015686;
        if ( aTrafficLightColoursB[v79] < 0x32u )
          v44 = 0.078431;
        memset(B, 0, 12);
        CPointLights::AddLight(
          0,
          v94,
          *(CVector *)B,
          14.0,
          (float)v42 * 0.0015686,
          (float)v43 * 0.0015686,
          v44,
          1u,
          1,
          0);
        v41 = CWeather::TrafficLightsBrightness;
      }
      if ( v41 > 0.05 )
      {
        *(_DWORD *)&B[16] = 128;
        *(_DWORD *)&B[28] = (unsigned int)(float)((float)((float)(CTimeCycle::m_CurrentColours.m_fLightsOnGroundBrightness
                                                                / 10.0)
                                                        * (float)(v41 * (float)aTrafficLightColoursB[v79]))
                                                * 0.125);
        *(_DWORD *)&B[24] = (unsigned int)(float)((float)((float)(CTimeCycle::m_CurrentColours.m_fLightsOnGroundBrightness
                                                                / 10.0)
                                                        * (float)(v41 * (float)aTrafficLightColoursG[v79]))
                                                * 0.125);
        *(_DWORD *)&B[20] = (unsigned int)(float)((float)((float)(v41 * (float)aTrafficLightColoursR[v79])
                                                        * (float)(CTimeCycle::m_CurrentColours.m_fLightsOnGroundBrightness
                                                                / 10.0))
                                                * 0.125);
        CShadows::StoreStaticShadow(
          (u_native)pEntity,
          2u,
          gpShadowExplosionTex,
          &pCoors,
          8.0,
          0.0,
          0.0,
          -8.0,
          *(__int64 *)&B[16],
          *(__int64 *)&B[24],
          12.0,
          1.0,
          40.0,
          0,
          0.0);
      }
    }
  }
  v45 = 1070445101;
  v46 = -0.141;
  z_low = 1072466756;
  v48 = pEntity->m_nModelIndex;
  v49 = -0.157;
  v50 = 0.189;
  if ( v48 == MI_TRAFFICLIGHTS_4 )
  {
    v51 = -0.157;
  }
  else
  {
    v51 = -0.157;
    if ( v48 != MI_TRAFFICLIGHTS_GAY )
    {
      if ( v48 == MI_TRAFFICLIGHTS_5 )
      {
        v52 = `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV1;
        __dmb(0xBu);
        if ( (v52 & 1) == 0
          && _cxa_guard_acquire((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV1) )
        {
          CTrafficLights::DisplayActualLight(CEntity *)::tV1.x = -0.044;
          CTrafficLights::DisplayActualLight(CEntity *)::tV1.y = -0.261;
          CTrafficLights::DisplayActualLight(CEntity *)::tV1.z = 1.561;
          _cxa_guard_release((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV1);
        }
        v53 = `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV2;
        __dmb(0xBu);
        if ( (v53 & 1) == 0
          && _cxa_guard_acquire((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV2) )
        {
          CTrafficLights::DisplayActualLight(CEntity *)::tV2.x = 0.222;
          CTrafficLights::DisplayActualLight(CEntity *)::tV2.y = -0.261;
          CTrafficLights::DisplayActualLight(CEntity *)::tV2.z = 1.867;
          _cxa_guard_release((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV2);
        }
        v54 = &CTrafficLights::DisplayActualLight(CEntity *)::tV2;
        v55 = &CTrafficLights::DisplayActualLight(CEntity *)::tV1;
      }
      else
      {
        if ( v48 != MI_TRAFFICLIGHTS )
          return;
        v56 = `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV1;
        __dmb(0xBu);
        if ( (v56 & 1) == 0
          && _cxa_guard_acquire((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV1) )
        {
          CTrafficLights::DisplayActualLight(CEntity *)::ttV1.x = 2.673;
          CTrafficLights::DisplayActualLight(CEntity *)::ttV1.y = 1.262;
          CTrafficLights::DisplayActualLight(CEntity *)::ttV1.z = -0.539;
          _cxa_guard_release((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV1);
        }
        v57 = `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV2;
        __dmb(0xBu);
        if ( (v57 & 1) == 0
          && _cxa_guard_acquire((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV2) )
        {
          CTrafficLights::DisplayActualLight(CEntity *)::ttV2.x = 2.673;
          CTrafficLights::DisplayActualLight(CEntity *)::ttV2.y = 0.713;
          CTrafficLights::DisplayActualLight(CEntity *)::ttV2.z = -0.127;
          _cxa_guard_release((__guard *)&`guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV2);
        }
        v54 = &CTrafficLights::DisplayActualLight(CEntity *)::ttV2;
        v55 = &CTrafficLights::DisplayActualLight(CEntity *)::ttV1;
      }
      v50 = v54->x;
      v49 = v54->y;
      z_low = LODWORD(v54->z);
      v46 = v55->x;
      v51 = v55->y;
      v45 = LODWORD(v55->z);
    }
  }
  v58 = 0;
  v59 = (CTimer::m_snTimeInMilliseconds >> 1) & 0x3FFF;
  if ( v59 > 0x3C17 )
    v58 = 1;
  if ( v59 < 0x2EE0 )
    v58 = 2;
  if ( v58 )
  {
    if ( v58 == 2 )
    {
      v60 = pEntity->m_pMat;
      if ( !v60 )
      {
        CPlaceable::AllocateMatrix(pEntity);
        CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
        v60 = pEntity->m_pMat;
      }
      v.y = v51;
      v.x = v46;
      LODWORD(v.z) = z_low;
      operator*(&v90, v60, &v);
      v61 = pEntity->m_pMat;
      if ( !v61 )
      {
        CPlaceable::AllocateMatrix(pEntity);
        CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
        v61 = pEntity->m_pMat;
      }
      LODWORD(v88.z) = z_low;
      v62 = (float)(v49 + v51) * 0.5;
      v63 = (float)(v50 + v46) * 0.5;
      v88.y = v62;
      v88.x = v63;
      operator*(&v89, v61, &v88);
      v64 = pEntity->m_pMat;
      if ( !v64 )
      {
        CPlaceable::AllocateMatrix(pEntity);
        CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
        v64 = pEntity->m_pMat;
      }
      v86.y = v51;
      v86.x = v46;
      LODWORD(v86.z) = v45;
      operator*(&v87, v64, &v86);
      v65 = pEntity->m_pMat;
      if ( !v65 )
      {
        CPlaceable::AllocateMatrix(pEntity);
        CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
        v65 = pEntity->m_pMat;
      }
      v84.y = v62;
      v84.x = v63;
      LODWORD(v84.z) = v45;
      operator*(&v85, v65, &v84);
      CShinyTexts::RegisterOne(v90, v89, v87, v85, 0.5, 0.0, 0.0, 0.0, 0.5, 1.0, 0.0, 1.0, 1u, 0xFFu, 0, 0, 60.0);
      return;
    }
    if ( (CTimer::m_snTimeInMilliseconds & 0x100) == 0 )
      return;
  }
  v66 = pEntity->m_pMat;
  if ( !v66 )
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    v66 = pEntity->m_pMat;
  }
  LODWORD(v.z) = z_low;
  v67 = (float)(v49 + v51) * 0.5;
  v68 = (float)(v50 + v46) * 0.5;
  v.y = v67;
  v.x = v68;
  operator*(&Coors1, v66, &v);
  v69 = pEntity->m_pMat;
  if ( !v69 )
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    v69 = pEntity->m_pMat;
  }
  v88.y = v49;
  v88.x = v50;
  LODWORD(v88.z) = z_low;
  operator*(&v82, v69, &v88);
  v70 = pEntity->m_pMat;
  if ( !v70 )
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    v70 = pEntity->m_pMat;
  }
  v86.y = v67;
  v86.x = v68;
  LODWORD(v86.z) = v45;
  operator*(&v81, v70, &v86);
  v71 = pEntity->m_pMat;
  if ( !v71 )
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    v71 = pEntity->m_pMat;
  }
  v84.y = v49;
  v84.x = v50;
  LODWORD(v84.z) = v45;
  operator*(&v80, v71, &v84);
  CShinyTexts::RegisterOne(Coors1, v82, v81, v80, 1.0, 0.0, 0.5, 0.0, 1.0, 1.0, 0.5, 1.0, 1u, 0xFFu, 0xFFu, 0xFFu, 60.0);
}
// 36300A: conditional instruction was optimized away because r5.4 is in (1..FF)
// 362BB4: variables would overlap: ^0.32 and 0:r3.4,4:^0.8
// 24: using guessed type int dword_24;
// 8204EC: using guessed type char `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV1;
// 8204FC: using guessed type char `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::tV2;
// 82050C: using guessed type char `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV1;
// 82051C: using guessed type char `guard variable for'CTrafficLights::DisplayActualLight(CEntity *)::ttV2;

//----- (00363738) --------------------------------------------------------
Int32 __fastcall CTrafficLights::FindTrafficLightType(CEntity *pEntity)
{
  CMatrix *m_pMat; // r1
  float xy; // s16
  float v4; // s0
  Int32 result; // r0

  m_pMat = pEntity->m_pMat;
  if ( m_pMat )
  {
    xy = m_pMat->xy;
  }
  else
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    m_pMat = pEntity->m_pMat;
    xy = m_pMat->xy;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(pEntity);
      CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
      m_pMat = pEntity->m_pMat;
    }
  }
  v4 = CGeneral::GetATanOfXY(xy, m_pMat->yy) * 57.296;
  if ( v4 > 60.0 && v4 < 150.0 )
    return 1;
  result = 2;
  if ( v4 < 330.0 )
    result = 1;
  if ( v4 <= 240.0 )
    return 2;
  return result;
}

//----- (003637F0) --------------------------------------------------------
bool __fastcall CTrafficLights::ShouldCarStopForBridge(CVehicle *pCar)
{
  unsigned int Address; // r0
  CPathNode *v3; // r1
  bool v4; // zf

  if ( CVehicle::GetVehicleAppearance(pCar) == APR_HELI )
    return 0;
  if ( CVehicle::GetVehicleAppearance(pCar) == APR_PLANE )
    return 0;
  Address = pCar->AutoPilot.NewLink.Address;
  if ( Address == 0xFFFF )
    return 0;
  v3 = ThePaths.pNodes[Address >> 10];
  v4 = v3 == 0;
  if ( v3 )
  {
    v3 = (CPathNode *)pCar->AutoPilot.OldLink.Address;
    v4 = v3 == (CPathNode *)((char *)&elf_hash_bucket[16320] + 3);
  }
  return !v4
      && ThePaths.pNodes[(unsigned int)v3 >> 10]
      && (*((_BYTE *)&ThePaths.pLinks[Address >> 10][Address & 0x3FF] + 12) & 4) != 0
      && (*((_BYTE *)&ThePaths.pLinks[(unsigned int)v3 >> 10][(unsigned __int16)v3 & 0x3FF] + 12) & 4) == 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0036389C) --------------------------------------------------------
Int32 __fastcall CTrafficLights::FindTrafficLightTypeFromOrientation(float Orientation)
{
  Int32 result; // r0

  if ( Orientation > 60.0 && Orientation < 150.0 )
    return 1;
  result = 2;
  if ( Orientation < 330.0 )
    result = 1;
  if ( Orientation <= 240.0 )
    return 2;
  return result;
}

//----- (003638F8) --------------------------------------------------------
float __fastcall CTrafficLights::FindOrientationForTrafficLightType(CEntity *pEntity)
{
  CMatrix *m_pMat; // r1
  float xy; // s16

  m_pMat = pEntity->m_pMat;
  if ( m_pMat )
  {
    xy = m_pMat->xy;
  }
  else
  {
    CPlaceable::AllocateMatrix(pEntity);
    CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
    m_pMat = pEntity->m_pMat;
    xy = m_pMat->xy;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(pEntity);
      CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
      m_pMat = pEntity->m_pMat;
    }
  }
  return CGeneral::GetATanOfXY(xy, m_pMat->yy) * 57.296;
}

//----- (0036395C) --------------------------------------------------------
bool __fastcall CTrafficLights::IsMITrafficLight(Int32 MI)
{
  return MI_TRAFFICLIGHTS == MI
      || MI_TRAFFICLIGHTS_VERTICAL == MI
      || MI_TRAFFICLIGHTS_MIAMI == MI
      || MI_TRAFFICLIGHTS_VEGAS == MI
      || MI_TRAFFICLIGHTS_TWOVERTICAL == MI
      || MI_TRAFFICLIGHTS_3 == MI
      || MI_TRAFFICLIGHTS_4 == MI
      || MI_TRAFFICLIGHTS_GAY == MI
      || MI_TRAFFICLIGHTS_5 == MI;
}

//----- (003639F8) --------------------------------------------------------
void __fastcall Fx_c::Fx_c(Fx_c *this)
{
  List_c::List_c(&this->m_entityFxList);
}

//----- (00363A0A) --------------------------------------------------------
void __fastcall Fx_c::~Fx_c(Fx_c *this)
{
  List_c::~List_c(&this->m_entityFxList);
}

//----- (00363A1C) --------------------------------------------------------
bool8 __fastcall Fx_c::Init(Fx_c *this)
{
  FxManager_c::Init(&g_fxMan);
  FxManager_c::LoadFxProject(&g_fxMan, "models\\effects.fxp");
  FxManager_c::SetWindData(&g_fxMan, &CWeather::WindDir, &CWeather::Wind);
  Fx_c::InitStaticSystems(this);
  this->m_randomizer = 0;
  return 1;
}

//----- (00363A78) --------------------------------------------------------
void __fastcall Fx_c::InitStaticSystems(Fx_c *this)
{
  RwV3d_0 offsetPos; // [sp+8h] [bp-20h] BYREF

  memset(&offsetPos, 0, sizeof(offsetPos));
  this->m_fxSysBlood = FxManager_c::CreateFxSystem(&g_fxMan, "prt_blood", &offsetPos, 0, 1);
  this->m_fxSysBoatSplash = FxManager_c::CreateFxSystem(&g_fxMan, "prt_boatsplash", &offsetPos, 0, 1);
  this->m_fxSysBubble = FxManager_c::CreateFxSystem(&g_fxMan, "prt_bubble", &offsetPos, 0, 1);
  this->m_fxSysDebris = FxManager_c::CreateFxSystem(&g_fxMan, "prt_cardebris", &offsetPos, 0, 1);
  this->m_fxSysSmoke = FxManager_c::CreateFxSystem(&g_fxMan, "prt_collisionsmoke", &offsetPos, 0, 1);
  this->m_fxSysGunshell = FxManager_c::CreateFxSystem(&g_fxMan, "prt_gunshell", &offsetPos, 0, 1);
  this->m_fxSysSand = FxManager_c::CreateFxSystem(&g_fxMan, "prt_sand", &offsetPos, 0, 1);
  this->m_fxSysSand2 = FxManager_c::CreateFxSystem(&g_fxMan, "prt_sand2", &offsetPos, 0, 1);
  this->m_fxSysSmokeHuge = FxManager_c::CreateFxSystem(&g_fxMan, "prt_smoke_huge", &offsetPos, 0, 1);
  this->m_fxSysSmoke2 = FxManager_c::CreateFxSystem(&g_fxMan, "prt_smokeII_3_expand", &offsetPos, 0, 1);
  this->m_fxSysSpark = FxManager_c::CreateFxSystem(&g_fxMan, "prt_spark", &offsetPos, 0, 1);
  this->m_fxSysSpark2 = FxManager_c::CreateFxSystem(&g_fxMan, "prt_spark_2", &offsetPos, 0, 1);
  this->m_fxSysSplash = FxManager_c::CreateFxSystem(&g_fxMan, "prt_splash", &offsetPos, 0, 1);
  this->m_fxSysWake = FxManager_c::CreateFxSystem(&g_fxMan, "prt_wake", &offsetPos, 0, 1);
  this->m_fxSysWaterSplash = FxManager_c::CreateFxSystem(&g_fxMan, "prt_watersplash", &offsetPos, 0, 1);
  this->m_fxSysWheelDirt = FxManager_c::CreateFxSystem(&g_fxMan, "prt_wheeldirt", &offsetPos, 0, 1);
  this->m_fxSysGlass = FxManager_c::CreateFxSystem(&g_fxMan, "prt_glass", &offsetPos, 0, 1);
}

//----- (00363CA4) --------------------------------------------------------
void __fastcall Fx_c::Exit(Fx_c *this)
{
  ListItem_c *m_head; // r6
  List_c *p_m_entityFxList; // r9
  ListItem_c *m_next; // r5
  void *v5; // r0

  p_m_entityFxList = &this->m_entityFxList;
  m_head = this->m_entityFxList.m_head;
  if ( m_head )
  {
    do
    {
      m_next = m_head->m_next;
      List_c::RemoveItem(p_m_entityFxList, m_head);
      FxManager_c::DestroyFxSystem(&g_fxMan, (FxSystem_c *)m_head[1].m_prev);
      ListItem_c::~ListItem_c(m_head);
      operator delete(v5);
      m_head = m_next;
    }
    while ( m_next );
  }
  Fx_c::ExitStaticSystems(this);
  sub_19E2A8(&g_fxMan);
}
// 363CD6: variable 'v5' is possibly undefined

//----- (00363D00) --------------------------------------------------------
void __fastcall Fx_c::ExitEntitySystems(Fx_c *this)
{
  ListItem_c *m_head; // r5
  List_c *p_m_entityFxList; // r8
  ListItem_c *m_next; // r4
  void *v4; // r0

  p_m_entityFxList = &this->m_entityFxList;
  m_head = this->m_entityFxList.m_head;
  if ( m_head )
  {
    do
    {
      m_next = m_head->m_next;
      List_c::RemoveItem(p_m_entityFxList, m_head);
      FxManager_c::DestroyFxSystem(&g_fxMan, (FxSystem_c *)m_head[1].m_prev);
      ListItem_c::~ListItem_c(m_head);
      operator delete(v4);
      m_head = m_next;
    }
    while ( m_next );
  }
}
// 363D30: variable 'v4' is possibly undefined

//----- (00363D44) --------------------------------------------------------
void __fastcall Fx_c::ExitStaticSystems(Fx_c *this)
{
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysBlood);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysBoatSplash);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysBubble);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysDebris);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSmoke);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysGunshell);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSand);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSand2);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSmokeHuge);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSmoke2);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSpark);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSpark2);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysSplash);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysWake);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysWaterSplash);
  FxManager_c::DestroyFxSystem(&g_fxMan, this->m_fxSysWheelDirt);
  sub_18E39C(&g_fxMan, this->m_fxSysGlass);
}

//----- (00363DE0) --------------------------------------------------------
void __fastcall Fx_c::Update(Fx_c *this, RwCamera_0 *camPtr, float deltaTime)
{
  sub_18E144(&g_fxMan, camPtr, deltaTime);
}

//----- (00363DF0) --------------------------------------------------------
void __fastcall Fx_c::Render(Fx_c *this, RwCamera_0 *camPtr, bool8 doHeatHaze)
{
  sub_195338(&g_fxMan, camPtr, doHeatHaze);
}

//----- (00363E00) --------------------------------------------------------
void __fastcall Fx_c::Reset(Fx_c *this)
{
  FxManager_c::DestroyAllFxSystems(&g_fxMan);
  Fx_c::InitStaticSystems(this);
}

//----- (00363E1C) --------------------------------------------------------
void __fastcall Fx_c::AddBlood(Fx_c *this, CVector *pos, CVector *dir, int32 num, float lightMult)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v10; // d16
  unsigned __int64 v11; // d1
  RwReal v12; // s0
  RwReal v13; // s4
  int v14; // r0
  int v15; // r0
  float v16; // s0
  float x; // s16
  float y; // s18
  float z; // s20
  float v20; // s22
  float v21; // s24
  float v22; // s26
  int v23; // r0
  int32 v24; // r0
  int v25; // r0
  RwTexture_0 *v26; // r4
  RwTexture_0 *v27; // r4
  int Duration; // [sp+20h] [bp-98h]
  int Durationa; // [sp+20h] [bp-98h]
  CVector pCoors; // [sp+30h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+3Ch] [bp-7Ch] BYREF

  if ( CLocalisation::Blood() )
  {
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    v10.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
    v11 = vmul_f32(v10, v10).n64_u64[0];
    if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                       + *(float *)&v11)
               + *((float *)&v11 + 1)) <= 625.0 )
    {
      FxPrtMult_c::FxPrtMult_c(&fxMults, 0.5, 0.0, 0.0, 1.0, 0.8, 0.0, 0.8);
      if ( num > 0 )
      {
        do
        {
          fxMults.m_size = (float)((float)((float)(rand() % 10000) * 0.0001) * 0.3) + 0.7;
          v12 = dir->x * 1.5;
          v13 = dir->z * 1.5;
          pCoors.y = dir->y * 1.5;
          pCoors.x = v12;
          pCoors.z = v13;
          v14 = rand() % 10000;
          pCoors.x = pCoors.x + (float)((float)((float)((float)v14 * 0.0001) + (float)((float)v14 * 0.0001)) + -1.0);
          v15 = rand() % 10000;
          pCoors.y = pCoors.y + (float)((float)((float)((float)v15 * 0.0001) + (float)((float)v15 * 0.0001)) + -1.0);
          v16 = (float)(rand() % 10000);
          pCoors.z = pCoors.z + (float)((float)((float)(v16 * 0.0001) + (float)(v16 * 0.0001)) + -1.0);
          FxSystem_c::AddParticle(g_fx.m_fxSysBlood, pos, &pCoors, 0.0, &fxMults, -1.0, lightMult, 0.6, 0);
          --num;
        }
        while ( num );
      }
      x = pos->x;
      y = pos->y;
      z = pos->z;
      v20 = dir->x;
      v21 = dir->y;
      v22 = dir->z;
      pCoors.x = (float)((float)(v20 * 0.5) + x)
               + (float)((float)((float)((float)(rand() % 10000) * 0.0001) * 0.2) + -0.1);
      v23 = rand();
      pCoors.z = (float)((float)(v22 * 0.5) + z) + 1.0;
      pCoors.y = (float)((float)(v21 * 0.5) + y) + (float)((float)((float)((float)(v23 % 10000) * 0.0001) * 0.2) + -0.1);
      v24 = this->m_randomizer + 1;
      this->m_randomizer = v24;
      v25 = v24 & 7;
      if ( v25 == 2 )
      {
        v27 = gpBloodPoolTex;
        Durationa = (rand() & 0xFFF) + 8000;
        CShadows::AddPermanentShadow(1u, v27, &pCoors, 0.2, 0.0, 0.0, -0.2, 255, 0xC8u, 0, 0, 4.0, Durationa, 1.0);
      }
      else if ( v25 == 5 )
      {
        v26 = gpBloodPoolTex;
        Duration = (rand() & 0xFFF) + 2000;
        CShadows::AddPermanentShadow(1u, v26, &pCoors, 0.1, 0.0, 0.0, -0.1, 255, 0xC8u, 0, 0, 4.0, Duration, 1.0);
      }
    }
  }
}

//----- (0036418C) --------------------------------------------------------
void __fastcall Fx_c::AddWood(Fx_c *this, CVector *pos, CVector *dir, int32 num, float lightMult)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v9; // d16
  unsigned __int64 v10; // d1
  RwReal v11; // s0
  RwReal v12; // s4
  RwV3d_0 v13; // [sp+18h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+24h] [bp-7Ch] BYREF

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v9.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v10 = vmul_f32(v9, v9).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v10)
             + *((float *)&v10 + 1)) <= 625.0 )
  {
    FxPrtMult_c::FxPrtMult_c(&fxMults, 0.5, 0.25, 0.0, 1.0, 0.3, 0.0, 1.0);
    if ( num >= 1 )
    {
      do
      {
        fxMults.m_red = (float)((float)((float)(rand() % 10000) * 0.0001) * 0.12) + 0.13;
        fxMults.m_green = (float)((float)((float)(rand() % 10000) * 0.0001) * 0.03) + 0.12;
        fxMults.m_blue = (float)((float)((float)(rand() % 10000) * 0.0001) * 0.03) + 0.04;
        fxMults.m_size = (float)((float)((float)(rand() % 10000) * 0.0001) * 0.3) + 0.7;
        v11 = dir->x * 4.0;
        v12 = dir->z * 4.0;
        v13.y = dir->y * 4.0;
        v13.x = v11;
        v13.z = v12;
        v13.x = v11 + (float)((float)((float)((float)(rand() % 10000) * 0.0001) * 4.0) + -2.0);
        v13.y = v13.y + (float)((float)((float)((float)(rand() % 10000) * 0.0001) * 4.0) + -2.0);
        v13.z = v13.z + (float)((float)((float)((float)(rand() % 10000) * 0.0001) * 4.0) + -2.0);
        FxSystem_c::AddParticle(g_fx.m_fxSysBlood, pos, &v13, 0.0, &fxMults, -1.0, lightMult, 0.6, 0);
        --num;
      }
      while ( num );
    }
  }
}

//----- (00364430) --------------------------------------------------------
void __fastcall Fx_c::AddSparks(
        Fx_c *this,
        CVector *pos,
        CVector *dir,
        float speed,
        int32 num,
        CVector vecMoveSpeed,
        int useGravity,
        float sparkSpread,
        float lifeMult)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v13; // d16
  unsigned __int64 v14; // d1
  float v15; // s0
  float v16; // s26
  float v17; // s22
  float v18; // s20
  float v19; // s24
  int i; // r8
  float x; // s21
  float y; // s23
  float z; // s25
  float v24; // s27
  float v25; // s29
  float v26; // s8
  float v27; // s0
  RwReal v28; // s2
  RwReal v29; // s6
  FxSystem_c *m_fxSysSpark; // r0
  RwV3d_0 v31; // [sp+1Ch] [bp-94h] BYREF
  RwV3d_0 v32; // [sp+28h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+34h] [bp-7Ch] BYREF

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v13.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v14 = vmul_f32(v13, v13).n64_u64[0];
  v15 = (float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x)) + *(float *)&v14)
      + *((float *)&v14 + 1);
  if ( v15 <= 22500.0 && (v15 <= 225.0 || !((unsigned __int8)CTimer::m_FrameCounter << 31)) )
  {
    FxPrtMult_c::FxPrtMult_c(&fxMults, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, lifeMult * 0.8);
    if ( num >= 1 )
    {
      v16 = sparkSpread + sparkSpread;
      v17 = CTimer::ms_fTimeStep * vecMoveSpeed.y;
      v18 = CTimer::ms_fTimeStep * vecMoveSpeed.z;
      v19 = CTimer::ms_fTimeStep * vecMoveSpeed.x;
      for ( i = 0; i != num; ++i )
      {
        x = dir->x;
        y = dir->y;
        z = dir->z;
        v24 = (float)rand();
        v25 = (float)rand();
        v26 = z + (float)((float)(v16 * (float)((float)rand() * 4.6566e-10)) - sparkSpread);
        v27 = 1.0 - (float)((float)i / (float)num);
        v32.x = (float)(x + (float)((float)(v16 * (float)(v24 * 4.6566e-10)) - sparkSpread)) * speed;
        v32.y = (float)(y + (float)((float)(v16 * (float)(v25 * 4.6566e-10)) - sparkSpread)) * speed;
        v32.z = v26 * speed;
        v28 = pos->x - (float)(v19 * v27);
        v29 = pos->z - (float)(v18 * v27);
        v31.y = pos->y - (float)(v17 * v27);
        v31.x = v28;
        v31.z = v29;
        if ( useGravity )
          m_fxSysSpark = g_fx.m_fxSysSpark;
        else
          m_fxSysSpark = g_fx.m_fxSysSpark2;
        FxSystem_c::AddParticle(m_fxSysSpark, &v31, &v32, v27 * 0.05, &fxMults, -1.0, 1.2, 0.6, 0);
      }
    }
  }
}

//----- (00364688) --------------------------------------------------------
void __fastcall Fx_c::AddTyreBurst(Fx_c *this, CVector *pos, CVector *dir)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v6; // d16
  unsigned __int64 v7; // d1
  FxPrtMult_c v8; // [sp+18h] [bp-38h] BYREF

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v6.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v7 = vmul_f32(v6, v6).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v7)
             + *((float *)&v7 + 1)) <= 625.0 )
  {
    FxPrtMult_c::FxPrtMult_c(&v8, 1.0, 1.0, 1.0, 0.4, 0.12, 0.0, 0.1);
    FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, pos, dir, 0.0, &v8, -1.0, 1.2, 0.6, 0);
    FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, pos, dir, 0.05, &v8, -1.0, 1.2, 0.6, 0);
    FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, pos, dir, 0.1, &v8, -1.0, 1.2, 0.6, 0);
    FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, pos, dir, 0.15, &v8, -1.0, 1.2, 0.6, 0);
  }
}

//----- (003647BC) --------------------------------------------------------
void __fastcall Fx_c::AddBulletImpact(
        Fx_c *this,
        CVector *pos,
        CVector *dir,
        int32 surfaceId,
        int32 num,
        float lightMult)
{
  int32 BulletFx; // r8
  CSimpleTransform *p_tx; // r0
  float32x2_t v10; // d16
  unsigned __int64 v11; // d1
  bool v12; // zf
  FxPrtMult_c *v13; // r0
  FxPrtMult_c *v14; // r8
  int v15; // r5
  int v16; // r5
  int j; // r11
  float x; // s2
  float z; // s6
  int i; // r8
  CVector zRot; // [sp+4h] [bp-84h] BYREF
  RwV3d_0 vel; // [sp+20h] [bp-68h] BYREF
  FxPrtMult_c v23; // [sp+2Ch] [bp-5Ch] BYREF

  BulletFx = SurfaceInfos_c::GetBulletFx(&g_surfaceInfos, surfaceId);
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  if ( BulletFx )
  {
    v10.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
    v11 = vmul_f32(v10, v10).n64_u64[0];
    if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                       + *(float *)&v11)
               + *((float *)&v11 + 1)) <= 22500.0 )
    {
      switch ( BulletFx )
      {
        case 1:
          memset(&zRot, 0, sizeof(zRot));
          Fx_c::AddSparks((Fx_c *)0x3F800000, pos, dir, 3.0, num, zRot, 1, 0.4, 1.0);
          FxPrtMult_c::FxPrtMult_c(&v23, 1.0, 1.0, 1.0, 0.15, 0.4, 0.0, 0.075);
          if ( num < 8 )
          {
            v16 = 2;
          }
          else
          {
            v16 = 1;
            v23.m_alpha = v23.m_alpha + v23.m_alpha;
          }
          for ( i = 0; i < v16; ++i )
            FxSystem_c::AddParticle(
              g_fx.m_fxSysSmoke2,
              pos,
              dir,
              (float)((float)i * 0.05) + 0.0,
              &v23,
              -1.0,
              lightMult,
              0.6,
              0);
          break;
        case 2:
        case 4:
          FxPrtMult_c::FxPrtMult_c(&v23, 0.81, 0.67, 0.57, 0.15, 0.4, 0.0, 0.3);
          v12 = BulletFx == 4;
          v14 = v13;
          if ( v12 )
          {
            v23.m_blue = 0.6;
            v23.m_red = 0.6;
            v23.m_green = 0.6;
          }
          if ( num < 8 )
          {
            v15 = 4;
          }
          else
          {
            v15 = 2;
            v23.m_alpha = v23.m_alpha + v23.m_alpha;
          }
          for ( j = 0; j < v15; ++j )
          {
            x = dir->x;
            z = dir->z;
            vel.y = dir->y * 0.3;
            vel.x = x * 0.3;
            vel.z = z * 0.3;
            FxSystem_c::AddParticle(
              g_fx.m_fxSysSand,
              pos,
              &vel,
              (float)((float)j * 0.05) + 0.0,
              v14,
              -1.0,
              lightMult,
              0.6,
              0);
          }
          break;
        case 3:
          Fx_c::AddWood((Fx_c *)0x3F800000, pos, dir, (int)(float)((float)num * 0.5), 1.0);
          break;
        default:
          return;
      }
    }
  }
}
// 36488E: variable 'v13' is possibly undefined

//----- (00364A5C) --------------------------------------------------------
void __fastcall Fx_c::AddPunchImpact(Fx_c *this, CVector *pos, CVector *dir, int32 num)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v7; // d16
  unsigned __int64 v8; // d1
  FxPrtMult_c v9; // [sp+18h] [bp-38h] BYREF

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v7.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v8 = vmul_f32(v7, v7).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v8)
             + *((float *)&v8 + 1)) <= 625.0 )
  {
    FxPrtMult_c::FxPrtMult_c(&v9, 1.0, 1.0, 1.0, 0.4, 0.1, 0.0, 0.1);
    FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, pos, dir, 0.0, &v9, -1.0, 1.2, 0.6, 0);
    FxSystem_c::AddParticle(g_fx.m_fxSysSmoke2, pos, dir, 0.05, &v9, -1.0, 1.2, 0.6, 0);
  }
}

//----- (00364B4C) --------------------------------------------------------
void __fastcall Fx_c::AddDebris(Fx_c *this, CVector *pos, RwRGBA_0 *col, float sizeScale, int a5)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v8; // d16
  unsigned __int64 v9; // d1
  int v10; // r5
  float alpha; // s0
  int v13; // r0
  RwV3d_0 v14; // [sp+18h] [bp-78h] BYREF
  FxPrtMult_c v15; // [sp+24h] [bp-6Ch] BYREF

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v8.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v9 = vmul_f32(v8, v8).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v9)
             + *((float *)&v9 + 1)) <= 625.0 )
  {
    v10 = a5;
    FxPrtMult_c::FxPrtMult_c(&v15);
    v15.m_red = (float)col->_anon_0._anon_0.red / 255.0;
    v15.m_green = (float)col->_anon_0._anon_0.green / 255.0;
    v15.m_blue = (float)col->_anon_0._anon_0.blue / 255.0;
    alpha = (float)col->_anon_0._anon_0.alpha;
    v15.m_size = sizeScale;
    v15.m_alpha = alpha / 255.0;
    v13 = rand();
    v15.m_life = 0.2;
    v15.m_rot = (float)((float)((float)(v13 % 10000) * 0.0001) * 0.5) + 0.5;
    if ( a5 >= 1 )
    {
      do
      {
        v14.x = (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + -0.25) * 20.0;
        v14.y = (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + -0.25) * 20.0;
        v14.z = (float)((float)((float)((float)rand() * 4.6566e-10) * 0.15) + 0.1) * 20.0;
        FxSystem_c::EnablePrim(g_fx.m_fxSysDebris, 0, 0);
        FxSystem_c::EnablePrim(g_fx.m_fxSysDebris, 1, 0);
        FxSystem_c::EnablePrim(g_fx.m_fxSysDebris, 2, 0);
        FxSystem_c::EnablePrim(g_fx.m_fxSysDebris, 3, 0);
        FxSystem_c::EnablePrim(g_fx.m_fxSysDebris, Fx_c::AddDebris(CVector &,RwRGBA &,float,int)::debrisId, 1u);
        FxSystem_c::AddParticle(g_fx.m_fxSysDebris, pos, &v14, 0.0, &v15, -1.0, 1.2, 0.6, 0);
        --v10;
        Fx_c::AddDebris(CVector &,RwRGBA &,float,int)::debrisId = ((_BYTE)Fx_c::AddDebris(CVector &,RwRGBA &,float,int)::debrisId
                                                                 + 1) & 3;
      }
      while ( v10 );
    }
  }
}

//----- (00364D7C) --------------------------------------------------------
void __fastcall Fx_c::AddGlass(Fx_c *this, CVector *pos, RwRGBA_0 *col, float sizeScale, int a5)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v8; // d16
  unsigned __int64 v9; // d1
  int v10; // r5
  float alpha; // s0
  int v13; // r0
  RwV3d_0 v14; // [sp+18h] [bp-78h] BYREF
  FxPrtMult_c fxMults; // [sp+24h] [bp-6Ch] BYREF

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v8.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v9 = vmul_f32(v8, v8).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v9)
             + *((float *)&v9 + 1)) <= 625.0 )
  {
    v10 = a5;
    FxPrtMult_c::FxPrtMult_c(&fxMults);
    fxMults.m_red = (float)col->_anon_0._anon_0.red / 255.0;
    fxMults.m_green = (float)col->_anon_0._anon_0.green / 255.0;
    fxMults.m_blue = (float)col->_anon_0._anon_0.blue / 255.0;
    alpha = (float)col->_anon_0._anon_0.alpha;
    fxMults.m_size = sizeScale;
    fxMults.m_alpha = alpha / 255.0;
    v13 = rand();
    fxMults.m_life = 0.2;
    fxMults.m_rot = (float)((float)((float)(v13 % 10000) * 0.0001) * 0.5) + 0.5;
    if ( a5 >= 1 )
    {
      do
      {
        v14.x = (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + -0.25) * 20.0;
        v14.y = (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + -0.25) * 20.0;
        v14.z = (float)((float)((float)((float)rand() * 4.6566e-10) * 0.15) + 0.1) * 20.0;
        FxSystem_c::AddParticle(g_fx.m_fxSysGlass, pos, &v14, 0.0, &fxMults, -1.0, 1.2, 0.6, 0);
        --v10;
      }
      while ( v10 );
    }
  }
}

//----- (00364F68) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall Fx_c::AddWheelSpray(
        Fx_c *this,
        CVehicle *pVeh,
        CVector pos,
        int bWheelsSpinning,
        int bInWater,
        float lightMult)
{
  float y; // r5
  float x; // r6
  CVehicle *PlayerVehicle; // r0
  float v10; // s18
  CSimpleTransform *p_tx; // r3
  float v12; // s0
  float v13; // s22
  float v14; // s0
  float v15; // s0
  int *v16; // r0
  float v17; // s2
  int v18; // r0
  float v19; // s2
  float v20; // s0
  float v21; // s6
  float z; // s4
  int v23; // r6
  int v24; // r10
  float v25; // s8
  float v26; // s28
  float v27; // s30
  float v28; // s17
  float v29; // s21
  RwV3d_0 v30; // [sp+14h] [bp-94h] BYREF
  RwV3d_0 v31; // [sp+20h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+2Ch] [bp-7Ch] BYREF

  y = pos.y;
  x = pos.x;
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  v10 = x;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v12 = (float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
              + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
      + (float)((float)(p_tx->m_translate.z - pos.z) * (float)(p_tx->m_translate.z - pos.z));
  if ( v12 <= 625.0 )
  {
    if ( v12 <= 400.0 )
    {
      if ( (!PlayerVehicle || v12 > 64.0) && (CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 31 )
        return;
    }
    else if ( (CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 30 )
    {
      return;
    }
    if ( bWheelsSpinning
      || fabsf(
           sqrtf(
             (float)((float)(pVeh->m_vecMoveSpeed.x * pVeh->m_vecMoveSpeed.x)
                   + (float)(pVeh->m_vecMoveSpeed.y * pVeh->m_vecMoveSpeed.y))
           + (float)(pVeh->m_vecMoveSpeed.z * pVeh->m_vecMoveSpeed.z))) > 0.01 )
    {
      FxPrtMult_c::FxPrtMult_c(&fxMults, 1.0, 1.0, 1.0, 0.05, 0.0, 1.0, 0.0);
      if ( bWheelsSpinning )
      {
        v13 = 1.0;
      }
      else
      {
        v13 = 1.0;
        v14 = sqrtf(
                (float)((float)(pVeh->m_vecMoveSpeed.x * pVeh->m_vecMoveSpeed.x)
                      + (float)(pVeh->m_vecMoveSpeed.y * pVeh->m_vecMoveSpeed.y))
              + (float)(pVeh->m_vecMoveSpeed.z * pVeh->m_vecMoveSpeed.z));
        v15 = v14 + v14;
        if ( v15 <= 1.0 )
          v13 = v15;
      }
      v16 = dword_3652BC;
      if ( bInWater )
        v16 = &dword_3652BC[1];
      v17 = *(float *)v16;
      fxMults.m_life = 0.08;
      fxMults.m_size = (float)(v13 * 0.2) + 0.2;
      fxMults.m_alpha = v17 + (float)(v17 * v13);
      v18 = rand();
      v19 = pVeh->m_vecMoveSpeed.x;
      v20 = CTimer::ms_fTimeStep;
      v21 = pVeh->m_vecMoveSpeed.y;
      z = pVeh->m_vecMoveSpeed.z;
      v23 = (int)sqrtf(
                   (float)((float)(z * CTimer::ms_fTimeStep) * (float)(z * CTimer::ms_fTimeStep))
                 + (float)((float)((float)(v19 * CTimer::ms_fTimeStep) * (float)(v19 * CTimer::ms_fTimeStep))
                         + (float)((float)(v21 * CTimer::ms_fTimeStep) * (float)(v21 * CTimer::ms_fTimeStep))));
      if ( v23 <= 1 )
        v23 = 1;
      v24 = 0;
      v25 = (float)(30.0 - (float)((float)(v13 * 10.0) + 10.0))
          + (float)((float)((float)((float)((float)(v13 * 10.0) + 10.0) + 30.0)
                          - (float)(30.0 - (float)((float)(v13 * 10.0) + 10.0)))
                  * (float)((float)v18 * 4.6566e-10));
      v26 = z * v25;
      v27 = v21 * v25;
      v28 = v19 * v25;
      v29 = 1.0 / (float)v23;
      while ( 1 )
      {
        v30.y = v27;
        v30.x = v28;
        v30.z = v26;
        v31.y = (float)(y - (float)((float)((float)(v29 * v21) * (float)v24) * v20)) + 0.0;
        v31.x = (float)(v10 - (float)((float)((float)(v29 * v19) * (float)v24) * v20)) + 0.0;
        v31.z = (float)(pos.z - (float)(v20 * (float)((float)(v29 * z) * (float)v24))) + 0.25;
        v30.z = v26 + (float)(v13 * (float)((float)((float)rand() * 4.6566e-10) + 1.0));
        FxSystem_c::AddParticle(g_fx.m_fxSysBoatSplash, &v31, &v30, 0.0, &fxMults, -1.0, lightMult, 0.6, 0);
        if ( ++v24 >= v23 )
          break;
        v19 = pVeh->m_vecMoveSpeed.x;
        v21 = pVeh->m_vecMoveSpeed.y;
        z = pVeh->m_vecMoveSpeed.z;
        v20 = CTimer::ms_fTimeStep;
      }
    }
  }
}
// 365156: conditional instruction was optimized away because r6.4>=1
// 364F68: fragmented variable at 0:r2.8,8:^B0.4 may be wrong
// 364F68: variables would overlap: 0:r2.8,8:^B0.4 and ^B0.4
// 3652BC: using guessed type int dword_3652BC[2];

//----- (003652D8) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall Fx_c::AddWheelGrass(Fx_c *this, CVehicle *pVeh, CVector pos, bool8 bWheelsSpinning, float lightMult)
{
  float y; // r9
  float x; // r5
  CPlayerPed *pDriver; // r4
  CPlayerPed *v9; // r4
  CVehicle *PlayerVehicle; // r0
  CSimpleTransform *p_tx; // r3
  float v12; // s0
  int v13; // r11
  float v14; // s19
  float v15; // s19
  RwV3d_0 v16; // [sp+14h] [bp-94h] BYREF
  RwV3d_0 v17; // [sp+20h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+2Ch] [bp-7Ch] BYREF

  y = pos.y;
  x = pos.x;
  pDriver = (CPlayerPed *)pVeh->pDriver;
  if ( pDriver == FindPlayerPed(0) || (v9 = (CPlayerPed *)pVeh->pDriver, v9 == FindPlayerPed(1)) )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    v12 = (float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
                + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
        + (float)((float)(p_tx->m_translate.z - pos.z) * (float)(p_tx->m_translate.z - pos.z));
    if ( v12 <= 625.0 )
    {
      if ( v12 > 400.0 )
      {
        if ( (CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 30 )
          return;
        goto LABEL_12;
      }
      if ( PlayerVehicle && v12 <= 64.0 || !((CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 31) )
      {
LABEL_12:
        FxPrtMult_c::FxPrtMult_c(&fxMults, 0.03, 0.09, 0.03, 1.0, 0.0, 0.0, 0.05);
        v13 = 3;
        do
        {
          fxMults.m_size = (float)((float)((float)rand() * 4.6566e-10) * 0.03) + 0.03;
          v14 = pVeh->m_vecMoveSpeed.x;
          v17.x = (float)((float)(v14 * -1.5) * (float)((float)rand() * 4.6566e-10)) + 0.0;
          v15 = pVeh->m_vecMoveSpeed.y;
          v17.y = (float)((float)(v15 * -1.5) * (float)((float)rand() * 4.6566e-10)) + 0.0;
          v17.z = (float)((float)((float)rand() * 4.6566e-10) * 1.5) + 2.0;
          v16.x = x;
          v16.y = y;
          v16.z = pos.z;
          v16.x = x + (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2);
          v16.y = v16.y + (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2);
          FxSystem_c::AddParticle(g_fx.m_fxSysWheelDirt, &v16, &v17, 0.0, &fxMults, -1.0, lightMult, 0.6, 0);
          --v13;
        }
        while ( v13 );
      }
    }
  }
}
// 3652D8: fragmented variable at 0:r2.8,8:^B0.4 may be wrong
// 3652D8: variables would overlap: 0:r2.8,8:^B0.4 and ^B0.4

//----- (0036555C) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall Fx_c::AddWheelGravel(Fx_c *this, CVehicle *pVeh, CVector pos, bool8 bWheelsSpinning, float lightMult)
{
  float y; // r9
  float x; // r5
  CPlayerPed *pDriver; // r4
  CPlayerPed *v9; // r4
  CVehicle *PlayerVehicle; // r0
  CSimpleTransform *p_tx; // r3
  float v12; // s0
  int v13; // r11
  float v14; // s19
  float v15; // s19
  RwV3d_0 v16; // [sp+14h] [bp-94h] BYREF
  RwV3d_0 v17; // [sp+20h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+2Ch] [bp-7Ch] BYREF

  y = pos.y;
  x = pos.x;
  pDriver = (CPlayerPed *)pVeh->pDriver;
  if ( pDriver == FindPlayerPed(0) || (v9 = (CPlayerPed *)pVeh->pDriver, v9 == FindPlayerPed(1)) )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    v12 = (float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
                + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
        + (float)((float)(p_tx->m_translate.z - pos.z) * (float)(p_tx->m_translate.z - pos.z));
    if ( v12 <= 625.0 )
    {
      if ( v12 > 400.0 )
      {
        if ( (CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 30 )
          return;
        goto LABEL_12;
      }
      if ( PlayerVehicle && v12 <= 64.0 || !((CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 31) )
      {
LABEL_12:
        FxPrtMult_c::FxPrtMult_c(&fxMults, 0.25, 0.25, 0.25, 1.0, 0.0, 0.0, 0.05);
        v13 = 3;
        do
        {
          fxMults.m_size = (float)((float)((float)rand() * 4.6566e-10) * 0.03) + 0.03;
          v14 = pVeh->m_vecMoveSpeed.x;
          v17.x = (float)((float)(v14 * -1.5) * (float)((float)rand() * 4.6566e-10)) + 0.0;
          v15 = pVeh->m_vecMoveSpeed.y;
          v17.y = (float)((float)(v15 * -1.5) * (float)((float)rand() * 4.6566e-10)) + 0.0;
          v17.z = (float)((float)((float)rand() * 4.6566e-10) * 1.5) + 2.0;
          v16.x = x;
          v16.y = y;
          v16.z = pos.z;
          v16.x = x + (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2);
          v16.y = v16.y + (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2);
          FxSystem_c::AddParticle(g_fx.m_fxSysWheelDirt, &v16, &v17, 0.0, &fxMults, -1.0, lightMult, 0.6, 0);
          --v13;
        }
        while ( v13 );
      }
    }
  }
}
// 36555C: fragmented variable at 0:r2.8,8:^B0.4 may be wrong
// 36555C: variables would overlap: 0:r2.8,8:^B0.4 and ^B0.4

//----- (003657DC) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall Fx_c::AddWheelMud(Fx_c *this, CVehicle *pVeh, CVector pos, bool8 bWheelsSpinning, float lightMult)
{
  float y; // r9
  float x; // r5
  CPlayerPed *pDriver; // r4
  CPlayerPed *v9; // r4
  CVehicle *PlayerVehicle; // r0
  CSimpleTransform *p_tx; // r3
  float v12; // s0
  int v13; // r11
  float v14; // s19
  float v15; // s19
  RwV3d_0 v16; // [sp+14h] [bp-94h] BYREF
  RwV3d_0 v17; // [sp+20h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+2Ch] [bp-7Ch] BYREF

  y = pos.y;
  x = pos.x;
  pDriver = (CPlayerPed *)pVeh->pDriver;
  if ( pDriver == FindPlayerPed(0) || (v9 = (CPlayerPed *)pVeh->pDriver, v9 == FindPlayerPed(1)) )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    v12 = (float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
                + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
        + (float)((float)(p_tx->m_translate.z - pos.z) * (float)(p_tx->m_translate.z - pos.z));
    if ( v12 <= 625.0 )
    {
      if ( v12 > 400.0 )
      {
        if ( (CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 30 )
          return;
        goto LABEL_12;
      }
      if ( PlayerVehicle && v12 <= 64.0 || !((CTimer::m_FrameCounter + (unsigned __int16)pVeh->m_nModelIndex) << 31) )
      {
LABEL_12:
        FxPrtMult_c::FxPrtMult_c(&fxMults, 0.25, 0.12, 0.06, 1.0, 0.0, 0.0, 0.05);
        v13 = 3;
        do
        {
          fxMults.m_size = (float)((float)((float)rand() * 4.6566e-10) * 0.03) + 0.03;
          v14 = pVeh->m_vecMoveSpeed.x;
          v17.x = (float)((float)(v14 * -1.5) * (float)((float)rand() * 4.6566e-10)) + 0.0;
          v15 = pVeh->m_vecMoveSpeed.y;
          v17.y = (float)((float)(v15 * -1.5) * (float)((float)rand() * 4.6566e-10)) + 0.0;
          v17.z = (float)((float)((float)rand() * 4.6566e-10) * 1.5) + 2.0;
          v16.x = x;
          v16.y = y;
          v16.z = pos.z;
          v16.x = x + (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2);
          v16.y = v16.y + (float)((float)((float)((float)rand() * 4.6566e-10) * 0.4) + -0.2);
          FxSystem_c::AddParticle(g_fx.m_fxSysWheelDirt, &v16, &v17, 0.0, &fxMults, -1.0, lightMult, 0.6, 0);
          --v13;
        }
        while ( v13 );
      }
    }
  }
}
// 3657DC: fragmented variable at 0:r2.8,8:^B0.4 may be wrong
// 3657DC: variables would overlap: 0:r2.8,8:^B0.4 and ^B0.4

//----- (00365A64) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall Fx_c::AddWheelSand(Fx_c *this, CVehicle *pVeh, CVector pos, int bWheelsSpinning, float lightMult)
{
  float y; // r6
  float x; // r5
  CVehicle *PlayerVehicle; // r0
  float v10; // s16
  CSimpleTransform *p_tx; // r3
  float v12; // s0
  FxQuality_e m_fxQuality; // r1
  __int16 v14; // r1
  float m_fGasPedal; // s0
  float v16; // s2
  float v17; // s4
  float v18; // s4
  float v19; // s6
  int32 m_vehicleType; // r0
  float v21; // s8
  __int16 v22; // r1
  float v23; // s4
  float v24; // s24
  float v25; // s22
  float v26; // s26
  int v27; // r6
  float v28; // s30
  int v29; // r8
  float v30; // s0
  float v31; // s31
  int v32; // r0
  RwV3d_0 v33; // [sp+14h] [bp-94h] BYREF
  RwV3d_0 v34; // [sp+20h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+2Ch] [bp-7Ch] BYREF

  y = pos.y;
  x = pos.x;
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  v10 = y;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v12 = (float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
              + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
      + (float)((float)(p_tx->m_translate.z - pos.z) * (float)(p_tx->m_translate.z - pos.z));
  if ( v12 <= 625.0 )
  {
    m_fxQuality = this->m_fxQuality;
    if ( m_fxQuality < FX_QUALITY_MEDIUM )
    {
      if ( m_fxQuality == FX_QUALITY_LOW )
      {
        v22 = CTimer::m_FrameCounter + pVeh->m_nModelIndex;
        if ( (v22 & 3) != 0 || (PlayerVehicle == 0 || v12 > 64.0) && (v22 & 7) != 0 )
          return;
      }
    }
    else
    {
      v14 = CTimer::m_FrameCounter + pVeh->m_nModelIndex;
      if ( (v14 & 1) != 0 || (PlayerVehicle == 0 || v12 > 64.0) && (v14 & 3) != 0 )
        return;
    }
    FxPrtMult_c::FxPrtMult_c(&fxMults, 0.81, 0.67, 0.57, 0.5, 1.0, 0.0, 0.0);
    m_fGasPedal = pVeh->m_fGasPedal;
    if ( bWheelsSpinning )
    {
      v16 = 1.0;
    }
    else
    {
      v17 = sqrtf(
              (float)((float)(pVeh->m_vecMoveSpeed.x * pVeh->m_vecMoveSpeed.x)
                    + (float)(pVeh->m_vecMoveSpeed.y * pVeh->m_vecMoveSpeed.y))
            + (float)(pVeh->m_vecMoveSpeed.z * pVeh->m_vecMoveSpeed.z));
      v16 = 1.0;
      v18 = v17 + v17;
      if ( v18 <= 1.0 )
        v16 = v18;
    }
    v19 = 2.0;
    fxMults.m_size = (float)(v16 * 0.9) + 0.1;
    fxMults.m_life = (float)(v16 * 0.1) + 0.1;
    m_vehicleType = pVeh->m_vehicleType;
    if ( m_vehicleType != 2 )
    {
      if ( m_vehicleType == 10 )
      {
        v21 = 0.25;
        goto LABEL_24;
      }
      if ( m_vehicleType != 9 )
      {
        v19 = 1.5;
        v21 = 0.7;
        goto LABEL_24;
      }
    }
    v21 = 0.5;
LABEL_24:
    fxMults.m_size = v21 * (float)((float)(v16 * 0.9) + 0.1);
    v23 = pVeh->m_vecMoveSpeed.x;
    v24 = CTimer::ms_fTimeStep * v23;
    v25 = CTimer::ms_fTimeStep * pVeh->m_vecMoveSpeed.y;
    v26 = CTimer::ms_fTimeStep * pVeh->m_vecMoveSpeed.z;
    v27 = (int)(float)(v19 * sqrtf((float)((float)(v24 * v24) + (float)(v25 * v25)) + (float)(v26 * v26)));
    if ( v27 <= 1 )
      v27 = 1;
    v28 = fabsf(m_fGasPedal);
    v29 = 0;
    while ( 1 )
    {
      v34.x = (float)((float)((float)(v28 * v23) * -40.0) * (float)((float)rand() * 4.6566e-10)) + 0.0;
      v30 = pVeh->m_vecMoveSpeed.y;
      v31 = (float)v29 / (float)v27;
      v34.y = (float)((float)((float)(v28 * v30) * -40.0) * (float)((float)rand() * 4.6566e-10)) + 0.0;
      v32 = rand();
      v33.y = v10 - (float)(v25 * (float)(1.0 - v31));
      v33.x = x - (float)(v24 * (float)(1.0 - v31));
      v33.z = pos.z - (float)(v26 * (float)(1.0 - v31));
      v34.z = (float)((float)((float)(v16 + 0.8) + -0.2) * (float)((float)v32 * 4.6566e-10)) + 0.2;
      FxSystem_c::AddParticle(g_fx.m_fxSysSand, &v33, &v34, 0.0, &fxMults, -1.0, lightMult, 0.7, 0);
      if ( ++v29 >= v27 )
        break;
      v23 = pVeh->m_vecMoveSpeed.x;
    }
  }
}
// 365C80: conditional instruction was optimized away because r6.4>=1
// 365A64: fragmented variable at 0:r2.8,8:^B0.4 may be wrong
// 365A64: variables would overlap: 0:r2.8,8:^B0.4 and ^B0.4

//----- (00365DF0) --------------------------------------------------------
FxQuality_e __fastcall Fx_c::GetFxQuality(Fx_c *this)
{
  return this->m_fxQuality;
}

//----- (00365DF4) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall Fx_c::AddWheelDust(Fx_c *this, CVehicle *pVeh, CVector pos, int bWheelsSpinning, float lightMult)
{
  float y; // r6
  float x; // r5
  CVehicle *PlayerVehicle; // r0
  float v10; // s16
  CSimpleTransform *p_tx; // r3
  float v12; // s0
  FxQuality_e m_fxQuality; // r1
  __int16 v14; // r1
  float m_fGasPedal; // s0
  float v16; // s2
  float v17; // s4
  float v18; // s4
  float v19; // s6
  int32 m_vehicleType; // r0
  float v21; // s8
  __int16 v22; // r1
  float v23; // s4
  float v24; // s24
  float v25; // s22
  float v26; // s26
  int v27; // r6
  float v28; // s30
  int v29; // r8
  float v30; // s0
  float v31; // s31
  int v32; // r0
  RwV3d_0 v33; // [sp+14h] [bp-94h] BYREF
  RwV3d_0 v34; // [sp+20h] [bp-88h] BYREF
  FxPrtMult_c fxMults; // [sp+2Ch] [bp-7Ch] BYREF

  y = pos.y;
  x = pos.x;
  PlayerVehicle = FindPlayerVehicle(-1, 0);
  v10 = y;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v12 = (float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
              + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
      + (float)((float)(p_tx->m_translate.z - pos.z) * (float)(p_tx->m_translate.z - pos.z));
  if ( v12 <= 625.0 )
  {
    m_fxQuality = this->m_fxQuality;
    if ( m_fxQuality < FX_QUALITY_MEDIUM )
    {
      if ( m_fxQuality == FX_QUALITY_LOW )
      {
        v22 = CTimer::m_FrameCounter + pVeh->m_nModelIndex;
        if ( (v22 & 3) != 0 || (PlayerVehicle == 0 || v12 > 64.0) && (v22 & 7) != 0 )
          return;
      }
    }
    else
    {
      v14 = CTimer::m_FrameCounter + pVeh->m_nModelIndex;
      if ( (v14 & 1) != 0 || (PlayerVehicle == 0 || v12 > 64.0) && (v14 & 3) != 0 )
        return;
    }
    FxPrtMult_c::FxPrtMult_c(&fxMults, 0.51, 0.44, 0.31, 0.5, 1.0, 0.0, 0.0);
    m_fGasPedal = pVeh->m_fGasPedal;
    if ( bWheelsSpinning )
    {
      v16 = 1.0;
    }
    else
    {
      v17 = sqrtf(
              (float)((float)(pVeh->m_vecMoveSpeed.x * pVeh->m_vecMoveSpeed.x)
                    + (float)(pVeh->m_vecMoveSpeed.y * pVeh->m_vecMoveSpeed.y))
            + (float)(pVeh->m_vecMoveSpeed.z * pVeh->m_vecMoveSpeed.z));
      v16 = 1.0;
      v18 = v17 + v17;
      if ( v18 <= 1.0 )
        v16 = v18;
    }
    v19 = 2.0;
    fxMults.m_size = (float)(v16 * 0.9) + 0.1;
    fxMults.m_life = (float)(v16 * 0.05) + 0.1;
    m_vehicleType = pVeh->m_vehicleType;
    if ( m_vehicleType != 2 )
    {
      if ( m_vehicleType == 10 )
      {
        v21 = 0.25;
        goto LABEL_24;
      }
      if ( m_vehicleType != 9 )
      {
        v19 = 1.5;
        v21 = 0.7;
        goto LABEL_24;
      }
    }
    v21 = 0.5;
LABEL_24:
    fxMults.m_size = v21 * (float)((float)(v16 * 0.9) + 0.1);
    v23 = pVeh->m_vecMoveSpeed.x;
    v24 = CTimer::ms_fTimeStep * v23;
    v25 = CTimer::ms_fTimeStep * pVeh->m_vecMoveSpeed.y;
    v26 = CTimer::ms_fTimeStep * pVeh->m_vecMoveSpeed.z;
    v27 = (int)(float)(v19 * sqrtf((float)((float)(v24 * v24) + (float)(v25 * v25)) + (float)(v26 * v26)));
    if ( v27 <= 1 )
      v27 = 1;
    v28 = fabsf(m_fGasPedal);
    v29 = 0;
    while ( 1 )
    {
      v34.x = (float)((float)((float)(v28 * v23) * -40.0) * (float)((float)rand() * 4.6566e-10)) + 0.0;
      v30 = pVeh->m_vecMoveSpeed.y;
      v31 = (float)v29 / (float)v27;
      v34.y = (float)((float)((float)(v28 * v30) * -40.0) * (float)((float)rand() * 4.6566e-10)) + 0.0;
      v32 = rand();
      v33.y = v10 - (float)(v25 * (float)(1.0 - v31));
      v33.x = x - (float)(v24 * (float)(1.0 - v31));
      v33.z = pos.z - (float)(v26 * (float)(1.0 - v31));
      v34.z = (float)((float)((float)(v16 + 0.8) + -0.2) * (float)((float)v32 * 4.6566e-10)) + 0.2;
      FxSystem_c::AddParticle(g_fx.m_fxSysSand, &v33, &v34, 0.0, &fxMults, -1.0, lightMult, 0.7, 0);
      if ( ++v29 >= v27 )
        break;
      v23 = pVeh->m_vecMoveSpeed.x;
    }
  }
}
// 366014: conditional instruction was optimized away because r6.4>=1
// 365DF4: fragmented variable at 0:r2.8,8:^B0.4 may be wrong
// 365DF4: variables would overlap: 0:r2.8,8:^B0.4 and ^B0.4

//----- (00366188) --------------------------------------------------------
void __fastcall Fx_c::TriggerWaterHydrant(Fx_c *this, CVector *pos)
{
  CSimpleTransform *p_tx; // r3
  float32x2_t v3; // d16
  unsigned __int64 v4; // d1
  FxSystem_c *FxSystem; // r0

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v3.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v4 = vmul_f32(v3, v3).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v4)
             + *((float *)&v4 + 1)) <= 625.0 )
  {
    FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, "water_hydrant", pos, 0, 0);
    if ( FxSystem )
      sub_1968D4(FxSystem);
  }
}

//----- (00366218) --------------------------------------------------------
void __fastcall Fx_c::TriggerGunshot(Fx_c *this, CEntity *pEntity, CVector *pos, CVector *dir, int bDoFlash)
{
  float x; // s0
  float y; // s4
  float z; // s2
  CSimpleTransform *p_tx; // r2
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_m_transform; // r0
  RwReal v14; // s2
  RwObject_0 *m_pRwObject; // r0
  RwMatrix *v16; // r8
  RwMatrix *v17; // r6
  FxSystem_c *v18; // r0
  FxSystem_c *v19; // r5
  FxSystem_c *v20; // r0
  FxSystem_c *v21; // r5
  CVector v; // [sp+8h] [bp-40h] BYREF
  CVector v23; // [sp+18h] [bp-30h] BYREF
  RwV3d_0 offsetPos; // [sp+28h] [bp-20h] BYREF

  x = pos->x;
  y = pos->y;
  z = pos->z;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - x) * (float)(p_tx->m_translate.x - x))
                     + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
             + (float)((float)(p_tx->m_translate.z - z) * (float)(p_tx->m_translate.z - z))) <= 625.0 )
  {
    if ( !pEntity )
    {
      v16 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
      Fx_c::CreateMatFromVec((Fx_c *)v16, v16, pos, dir);
      v17 = v16;
      memset(&offsetPos, 0, sizeof(offsetPos));
      if ( !v16 )
        return;
      goto LABEL_12;
    }
    m_pMat = pEntity->m_pMat;
    p_m_transform = &pEntity->m_transform;
    if ( m_pMat )
      p_m_transform = (CSimpleTransform *)&m_pMat->tx;
    v14 = z - p_m_transform->m_translate.z;
    *(_QWORD *)&offsetPos.x = __PAIR64__(y - p_m_transform->m_translate.y, x - p_m_transform->m_translate.x);
    offsetPos.z = v14;
    v.z = v14;
    *(_QWORD *)&v.x = *(_QWORD *)&offsetPos.x;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(pEntity);
      CSimpleTransform::UpdateMatrix(&pEntity->m_transform, pEntity->m_pMat);
      m_pMat = pEntity->m_pMat;
    }
    Multiply3x3(&v23, &v, m_pMat);
    offsetPos = v23.RwV3d_0;
    m_pRwObject = pEntity->m_pRwObject;
    if ( m_pRwObject )
    {
      v16 = 0;
      v17 = (RwMatrix *)((char *)m_pRwObject->parent + 16);
LABEL_12:
      if ( bDoFlash == 1 )
      {
        v18 = FxManager_c::CreateFxSystem(&g_fxMan, "gunflash", &offsetPos, v17, 0);
        v19 = v18;
        if ( v18 )
        {
          if ( !pEntity )
            FxSystem_c::CopyParentMatrix(v18);
          FxSystem_c::PlayAndKill(v19);
        }
      }
      v20 = FxManager_c::CreateFxSystem(&g_fxMan, "gunsmoke", &offsetPos, v17, 0);
      v21 = v20;
      if ( v20 )
      {
        if ( !pEntity )
          FxSystem_c::CopyParentMatrix(v20);
        FxSystem_c::PlayAndKill(v21);
      }
      if ( v16 )
        FxManager_c::FxRwMatrixDestroy(&g_fxMan, v16);
    }
  }
}

//----- (003663C4) --------------------------------------------------------
void __fastcall Fx_c::CreateMatFromVec(Fx_c *this, RwMatrix *resMat, CVector *pos, CVector *dir)
{
  float v4; // s18
  float v6; // s20
  RwV3d_0 *p_up; // r5
  __int64 v8; // d16
  float y; // s2
  float z; // s4
  RwReal v11; // s6
  RwReal v12; // s8
  RwReal v13; // s10
  float v14; // s1
  float v15; // s0

  v4 = -1.0;
  if ( dir->x == 0.0 )
  {
    v6 = 0.0;
    if ( dir->y == 0.0 )
    {
      v4 = -1.0;
      v6 = 0.0;
      if ( dir->z == -1.0 )
      {
        v6 = 1.0;
        v4 = 0.0;
      }
    }
  }
  else
  {
    v6 = 0.0;
  }
  *(_QWORD *)&resMat->up.y = 1065353216LL;
  resMat->right.z = 0.0;
  *(_QWORD *)&resMat->right.x = 1065353216LL;
  resMat->at.x = 0.0;
  resMat->at.y = 0.0;
  resMat->at.z = 1.0;
  resMat->pos.x = 0.0;
  resMat->pos.y = 0.0;
  resMat->pos.z = 0.0;
  resMat->flags |= 0x20003u;
  resMat->up.x = 0.0;
  p_up = &resMat->up;
  v8 = *(_QWORD *)&pos->x;
  resMat->pos.z = pos->z;
  *(_QWORD *)&resMat->pos.x = v8;
  resMat->up = dir->RwV3d_0;
  RwV3dNormalize(&resMat->up, &resMat->up);
  y = resMat->up.y;
  z = resMat->up.z;
  v11 = (float)(y * 0.0) - (float)(v6 * p_up->x);
  v12 = (float)(v4 * p_up->x) - (float)(z * 0.0);
  v13 = (float)(v6 * z) - (float)(v4 * y);
  v14 = v11 * p_up->x;
  v15 = v12 * p_up->x;
  resMat->right.x = v13;
  resMat->right.y = v12;
  resMat->right.z = v11;
  resMat->at.x = (float)(v12 * z) - (float)(v11 * y);
  resMat->at.y = v14 - (float)(v13 * z);
  resMat->at.z = (float)(v13 * y) - v15;
  sub_196158(resMat);
}

//----- (003664E8) --------------------------------------------------------
void __fastcall Fx_c::TriggerTankFire(Fx_c *this, CVector *pos, CVector *dir)
{
  CSimpleTransform *p_tx; // r2
  float32x2_t v6; // d16
  unsigned __int64 v7; // d1
  RwMatrix *v8; // r4
  FxSystem_c *v9; // r0
  FxSystem_c *v10; // r5
  RwV3d_0 offsetPos; // [sp+8h] [bp-20h] BYREF

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v6.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v7 = vmul_f32(v6, v6).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v7)
             + *((float *)&v7 + 1)) <= 625.0 )
  {
    v8 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
    Fx_c::CreateMatFromVec((Fx_c *)v8, v8, pos, dir);
    memset(&offsetPos, 0, sizeof(offsetPos));
    v9 = FxManager_c::CreateFxSystem(&g_fxMan, "tank_fire", &offsetPos, v8, 0);
    v10 = v9;
    if ( v9 )
    {
      FxSystem_c::CopyParentMatrix(v9);
      FxSystem_c::PlayAndKill(v10);
    }
    FxManager_c::FxRwMatrixDestroy(&g_fxMan, v8);
  }
}

//----- (003665AC) --------------------------------------------------------
void __fastcall Fx_c::TriggerWaterSplash(Fx_c *this, CVector *pos)
{
  CSimpleTransform *p_tx; // r3
  float32x2_t v3; // d16
  unsigned __int64 v4; // d1
  FxSystem_c *FxSystem; // r0

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v3.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v4 = vmul_f32(v3, v3).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v4)
             + *((float *)&v4 + 1)) <= 625.0 )
  {
    FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, "water_splash_big", pos, 0, 0);
    if ( FxSystem )
      sub_1968D4(FxSystem);
  }
}

//----- (00366640) --------------------------------------------------------
void __fastcall Fx_c::TriggerBulletSplash(Fx_c *this, CVector *pos)
{
  CSimpleTransform *p_tx; // r3
  float32x2_t v3; // d16
  unsigned __int64 v4; // d1
  FxSystem_c *FxSystem; // r0

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v3.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v4 = vmul_f32(v3, v3).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v4)
             + *((float *)&v4 + 1)) <= 625.0 )
  {
    FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, "water_splash", pos, 0, 0);
    if ( FxSystem )
      sub_1968D4(FxSystem);
  }
}

//----- (003666D0) --------------------------------------------------------
void __fastcall Fx_c::TriggerFootSplash(Fx_c *this, CVector *pos)
{
  CSimpleTransform *p_tx; // r3
  float32x2_t v3; // d16
  unsigned __int64 v4; // d1
  FxSystem_c *FxSystem; // r0

  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  v3.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&pos->y).n64_u64[0];
  v4 = vmul_f32(v3, v3).n64_u64[0];
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - pos->x) * (float)(p_tx->m_translate.x - pos->x))
                     + *(float *)&v4)
             + *((float *)&v4 + 1)) <= 625.0 )
  {
    FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, "water_splsh_sml", pos, 0, 0);
    if ( FxSystem )
      sub_1968D4(FxSystem);
  }
}

//----- (00366760) --------------------------------------------------------
void __fastcall Fx_c::SetFxQuality(Fx_c *this, FxQuality_e fxQuality)
{
  this->m_fxQuality = fxQuality;
}

//----- (00366764) --------------------------------------------------------
void __fastcall Fx_c::CreateEntityFx(
        Fx_c *this,
        CEntity *pEntity,
        unsigned __int8 *bpName,
        RwV3d_0 *offsetPos,
        RwMatrix *parentMat)
{
  FxSystem_c *FxSystem; // r6
  int v8; // r4

  FxSystem = FxManager_c::CreateFxSystem(&g_fxMan, bpName, offsetPos, parentMat, 1);
  if ( FxSystem )
  {
    v8 = operator new(0x10u);
    ListItem_c::ListItem_c((ListItem_c *)v8);
    *(_DWORD *)(v8 + 8) = FxSystem;
    *(_DWORD *)(v8 + 12) = pEntity;
    List_c::AddItem(&this->m_entityFxList, (ListItem_c *)v8);
    sub_18C0A4(*(FxSystem_c **)(v8 + 8));
  }
}

//----- (003667C4) --------------------------------------------------------
void __fastcall Fx_c::DestroyEntityFx(Fx_c *this, CEntity *pEntity)
{
  ListItem_c *m_head; // r6
  List_c *p_m_entityFxList; // r8
  ListItem_c *m_next; // r5
  void *v6; // r0

  p_m_entityFxList = &this->m_entityFxList;
  m_head = this->m_entityFxList.m_head;
  if ( m_head )
  {
    do
    {
      m_next = m_head->m_next;
      if ( (CEntity *)m_head[1].m_next == pEntity )
      {
        List_c::RemoveItem(p_m_entityFxList, m_head);
        FxSystem_c::Kill((FxSystem_c *)m_head[1].m_prev);
        ListItem_c::~ListItem_c(m_head);
        operator delete(v6);
      }
      m_head = m_next;
    }
    while ( m_next );
  }
}
// 3667F4: variable 'v6' is possibly undefined

//----- (00366804) --------------------------------------------------------
void __fastcall RenderBegin(RwRaster_0 *pRaster, RwMatrix *pMatrix, UInt32 rwFlags)
{
  RwRaster_0 *v4; // [sp+0h] [bp-20h] BYREF

  g_pMatrix = pMatrix;
  g_numTris = 0;
  g_numVertices = 0;
  g_pRaster = pRaster;
  g_rwFlags = rwFlags;
  g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
  RwRenderStateGet(rwRENDERSTATETEXTURERASTER, &v4);
  if ( v4 != pRaster )
    RwRenderStateSet(rwRENDERSTATETEXTURERASTER, pRaster);
}

//----- (0036689C) --------------------------------------------------------
void __fastcall RenderAddTri(
        float x1,
        float y1,
        float z1,
        float x2,
        float y2,
        float z2,
        float x3,
        float y3,
        float z3,
        float u1,
        float v1,
        float u2,
        float v2,
        float u3,
        float v3,
        Int32 r1,
        Int32 g1,
        Int32 b1,
        Int32 a1,
        Int32 r2,
        Int32 g2,
        Int32 b2,
        Int32 a2,
        Int32 r3,
        Int32 g3,
        Int32 b3,
        Int32 a3)
{
  RwIm3DVertex *v27; // r6
  RwIm3DVertex *v34; // r1
  int v37; // r5
  int v38; // r0
  int v41; // r3
  int v42; // r1
  bool v43; // cc

  v27 = g_pVertex3d;
  g_pVertex3d->position.y = y1;
  v27->position.z = z1;
  v27->position.x = x1;
  _R0 = b1 << 16;
  __asm { UXTB16.W        R0, R0 }
  v34 = g_pVertex3d;
  g_pVertex3d->color = (RwRGBA_0)(_R0 | (unsigned __int8)r1 | ((unsigned __int8)g1 << 8) | (a1 << 24));
  _R0 = b2 << 16;
  __asm { UXTB16.W        R0, R0 }
  v37 = (unsigned __int8)r2 | ((unsigned __int8)g2 << 8) | _R0;
  v38 = g_numVertices;
  v34[1].color = (RwRGBA_0)(v37 | (a2 << 24));
  v34[1].position.x = x2;
  _R2 = b3 << 16;
  __asm { UXTB16.W        R2, R2 }
  v34[1].position.y = y2;
  v34[1].position.z = z2;
  v34[2].color = (RwRGBA_0)(_R2 | (unsigned __int8)r3 | ((unsigned __int8)g3 << 8) | (a3 << 24));
  v34[2].position.x = x3;
  v34[2].position.y = y3;
  v34[2].position.z = z3;
  g_numVertices = v38 + 3;
  g_pVertex3d = v34 + 3;
  if ( g_pRaster )
  {
    v34->texCoords.u = u1;
    v34->texCoords.v = v1;
    v34[1].texCoords.u = u2;
    v34[1].texCoords.v = v2;
    v34[2].texCoords.u = u3;
    v34[2].texCoords.v = v3;
  }
  v41 = g_numTris;
  v42 = ++g_numTris;
  v43 = v41 < 4093;
  if ( v41 <= 4093 )
    v43 = v38 < 2042;
  if ( !v43 )
  {
    if ( RwIm3DTransform(TempVertexBuffer.m_3d, 3 * v42, g_pMatrix, g_rwFlags) )
    {
      RwIm3DRenderPrimitive(rwPRIMTYPETRILIST);
      RwIm3DEnd();
    }
    g_numVertices = 0;
    g_numTris = 0;
    g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
  }
}
// 36689C: using guessed type Int32 arg_2C;

//----- (00366A30) --------------------------------------------------------
void RenderEnd()
{
  if ( g_numTris )
  {
    if ( RwIm3DTransform(TempVertexBuffer.m_3d, 3 * g_numTris, g_pMatrix, g_rwFlags) )
    {
      RwIm3DRenderPrimitive(rwPRIMTYPETRILIST);
      RwIm3DEnd();
    }
    g_numVertices = 0;
    g_numTris = 0;
    g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
  }
}

//----- (00366ABC) --------------------------------------------------------
void __fastcall RotateVecIntoVec(RwV3d_0 *vecRes, RwV3d_0 *vec, RwV3d_0 *vecAlign)
{
  float z; // s6
  float y; // s4
  float v8; // s0
  float v9; // s2
  float x; // s16
  float v11; // s22
  float v12; // s18
  float v13; // s28
  float v14; // s0
  float v15; // s20
  float v16; // s26
  float v17; // s24
  float v18; // s30
  RwMatrix *v19; // r5
  RwV3d_0 in; // [sp+4h] [bp-64h] BYREF

  z = vecAlign->z;
  y = vecAlign->y;
  v8 = vecAlign->x * 0.5657;
  v9 = vecAlign->x * 0.7071;
  in.x = (float)(y * 0.7071) - (float)(z * 0.5657);
  in.z = v8 - (float)(y * 0.4243);
  in.y = (float)(z * 0.4243) - v9;
  RwV3dNormalize(&in, &in);
  x = vecAlign->x;
  v11 = in.z;
  v12 = vecAlign->y;
  v13 = in.z * vecAlign->x;
  v14 = vecAlign->z;
  v15 = in.y;
  v16 = v12 * in.x;
  v17 = v14 * in.y;
  v18 = v14 * in.x;
  v19 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  v19->right = in;
  v19->up = *vecAlign;
  v19->pos.x = 0.0;
  v19->pos.y = 0.0;
  v19->pos.z = 0.0;
  v19->at.x = (float)(v12 * v11) - v17;
  v19->at.y = v18 - v13;
  v19->at.z = (float)(v15 * x) - v16;
  RwMatrixUpdate(v19);
  RwV3dTransformVectors(vecRes, vec, 1, v19);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v19);
}

//----- (00366BCC) --------------------------------------------------------
void __fastcall RotateVecAboutVec(RwV3d_0 *vecRes, RwV3d_0 *vec, RwV3d_0 *axis, float angle)
{
  float v4; // s0
  float x; // s6
  float y; // s8
  float z; // s10
  float *v8; // r3
  float v9; // s4
  float v10; // s1
  float v11; // s12
  float *v12; // r2
  float v13; // s3
  float v14; // s9
  float v15; // s14
  float v16; // s5
  float v17; // s0
  float v18; // s6
  float v19; // s8
  float v20; // s2

  v4 = (float)(angle * 256.0) / 6.2832;
  x = axis->x;
  y = axis->y;
  z = axis->z;
  v8 = &CMaths::ms_SinTable[(unsigned __int8)(unsigned int)(float)(v4 + 64.0)];
  v9 = 1.0 - *v8;
  v10 = (float)(v9 * axis->x) * y;
  v11 = (float)(v9 * axis->x) * z;
  v12 = &CMaths::ms_SinTable[(unsigned __int8)(unsigned int)v4];
  v13 = vec->x * (float)(*v8 + (float)(x * (float)(v9 * x)));
  v14 = v9 * y;
  v15 = *v12 * z;
  v16 = *v12 * y;
  v17 = *v12 * x;
  v18 = (float)(v9 * y) * z;
  v19 = *v8 + (float)(y * (float)(v9 * y));
  v20 = *v8 + (float)(z * (float)(v9 * z));
  vecRes->x = (float)(v13 + (float)(vec->y * (float)(v10 - v15))) + (float)((float)(v16 + v11) * vec->z);
  vecRes->y = (float)((float)((float)(v10 + v15) * vec->x) + (float)(v19 * vec->y))
            + (float)((float)((float)(v14 * z) - v17) * vec->z);
  vecRes->z = (float)((float)((float)(v11 - v16) * vec->x) + (float)((float)(v17 + v18) * vec->y))
            + (float)(v20 * vec->z);
}

//----- (00366CFC) --------------------------------------------------------
void *__fastcall FxEmitterPrt_c::operator new[](size_t nSize)
{
  return sub_18A218(&g_fxMan.m_fxMemPool, nSize, 4);
}

//----- (00366D10) --------------------------------------------------------
void __fastcall FxEmitterBP_c::FxEmitterBP_c(FxEmitterBP_c *this)
{
  int v1; // r0

  FxPrimBP_c::FxPrimBP_c(this);
  *(_BYTE *)(v1 + 4) = 0;
  *(_DWORD *)v1 = &off_665958;
}
// 366D1C: variable 'v1' is possibly undefined
// 665958: using guessed type void *;

//----- (00366D30) --------------------------------------------------------
void __fastcall FxEmitterBP_c::~FxEmitterBP_c(FxEmitterBP_c *this)
{
  void *v1; // r0

  FxPrimBP_c::~FxPrimBP_c(this);
  sub_191374(v1);
}
// 366D3C: variable 'v1' is possibly undefined

//----- (00366D40) --------------------------------------------------------
void *__fastcall FxEmitterBP_c::operator new(size_t nSize)
{
  return sub_18A218(&g_fxMan.m_fxMemPool, nSize, 4);
}

//----- (00366D54) --------------------------------------------------------
FxPrim_c *__fastcall FxEmitterBP_c::CreateInstance(FxEmitterBP_c *this)
{
  FxPrim_c *v1; // r0
  FxPrim_c *result; // r0

  v1 = (FxPrim_c *)operator new(0x14u);
  FxPrim_c::FxPrim_c(v1);
  result->_vptr$FxPrim_c = (int (**)(void))&off_665980;
  return result;
}
// 366D6A: variable 'result' is possibly undefined
// 665980: using guessed type void *;

//----- (00366D74) --------------------------------------------------------
int32 __fastcall FxEmitterBP_c::Update(FxEmitterBP_c *this, float deltaTime)
{
  FxEmitterPrt_c *m_head; // r6
  List_c *p_m_particleList; // r9
  bool v6; // zf
  FxSystem_c *m_fxSysPtr; // r0
  int updated; // r0
  FxEmitterPrt_c *m_next; // r8
  int32 NumItems; // [sp+0h] [bp-20h]

  p_m_particleList = &this->m_particleList;
  NumItems = List_c::GetNumItems(&this->m_particleList);
  v6 = NumItems == 0;
  if ( NumItems )
  {
    m_head = (FxEmitterPrt_c *)p_m_particleList->m_head;
    v6 = p_m_particleList->m_head == 0;
  }
  if ( !v6 )
  {
    do
    {
      while ( 1 )
      {
        m_fxSysPtr = m_head->m_fxSysPtr;
        if ( m_fxSysPtr->m_killStatus == 3 )
        {
          m_fxSysPtr->m_killStatus = 2;
          m_fxSysPtr = m_head->m_fxSysPtr;
        }
        if ( m_fxSysPtr->m_playStatus != 2 )
          break;
        m_head = (FxEmitterPrt_c *)m_head->m_next;
        if ( !m_head )
          return NumItems;
      }
      updated = FxEmitterBP_c::UpdateParticle(this, deltaTime, m_head);
      m_next = (FxEmitterPrt_c *)m_head->m_next;
      if ( updated )
      {
        List_c::RemoveItem(p_m_particleList, m_head);
        FxManager_c::ReturnParticle(&g_fxMan, m_head);
      }
      m_head = m_next;
    }
    while ( m_next );
  }
  return NumItems;
}
// 366DA6: variable 'm_head' is possibly undefined

//----- (00366DFC) --------------------------------------------------------
bool8 __fastcall FxEmitterBP_c::UpdateParticle(FxEmitterBP_c *this, float deltaTime, FxEmitterPrt_c *prtPtr)
{
  FxSystem_c *m_fxSysPtr; // r12
  float v5; // s16
  float m_life; // s0
  float v7; // s2
  RwReal v8; // s4
  RwReal v9; // s6
  __int64 v10; // d16
  __int64 v11; // d16
  __int64 v12; // d16
  __int64 v13; // d16
  bool v14; // zf
  int WaterLevel; // r0
  int m_randR; // r0
  float v18; // s4
  float v19; // s0
  float v20; // s2
  float v21; // s0
  float v22; // s2
  float v23; // s0
  float pWaterZ; // [sp+Ch] [bp-4Ch] BYREF
  MovementInfo_t v25; // [sp+10h] [bp-48h] BYREF

  m_fxSysPtr = prtPtr->m_fxSysPtr;
  v5 = (float)((float)m_fxSysPtr->m_timeMult_ui16 / 1000.0) * deltaTime;
  m_life = prtPtr->m_life;
  v7 = prtPtr->m_currLife + v5;
  prtPtr->m_currLife = v7;
  if ( v7 >= m_life )
    return 1;
  v8 = prtPtr->m_pos.y + (float)(v5 * prtPtr->m_vel.y);
  v9 = prtPtr->m_pos.z + (float)(v5 * prtPtr->m_vel.z);
  prtPtr->m_pos.x = prtPtr->m_pos.x + (float)(v5 * prtPtr->m_vel.x);
  prtPtr->m_pos.y = v8;
  prtPtr->m_pos.z = v9;
  v10 = *(_QWORD *)&prtPtr->m_pos.x;
  v25.pos.z = prtPtr->m_pos.z;
  *(_QWORD *)&v25.pos.x = v10;
  v11 = *(_QWORD *)&prtPtr->m_vel.x;
  v25.vel.z = prtPtr->m_vel.z;
  *(_QWORD *)&v25.vel.x = v11;
  FxInfoManager_c::ProcessMovementInfo(
    &this->m_fxInfoMan,
    m_fxSysPtr->m_currTime,
    v7 / m_life,
    v5,
    m_fxSysPtr->m_bpPtr->m_length,
    0,
    &v25);
  v12 = *(_QWORD *)&v25.pos.x;
  prtPtr->m_pos.z = v25.pos.z;
  *(_QWORD *)&prtPtr->m_pos.x = v12;
  v13 = *(_QWORD *)&v25.vel.x;
  prtPtr->m_vel.z = v25.vel.z;
  *(_QWORD *)&prtPtr->m_vel.x = v13;
  v14 = v25.hasFloatInfo == 0;
  if ( !v25.hasFloatInfo )
    v14 = v25.hasUnderwaterInfo == 0;
  if ( !v14 )
  {
    WaterLevel = CWaterLevel::GetWaterLevel(prtPtr->m_pos.x, prtPtr->m_pos.y, prtPtr->m_pos.z, &pWaterZ, 1, 0);
    if ( WaterLevel == 1 && v25.hasFloatInfo && prtPtr->m_pos.z < pWaterZ )
      prtPtr->m_pos.z = pWaterZ;
    if ( v25.hasUnderwaterInfo && (WaterLevel != 1 || prtPtr->m_pos.z > pWaterZ) )
      return 1;
  }
  if ( v25.rot[0] > 0.0 || v25.rot[1] > 0.0 )
  {
    if ( v25.rot[2] > 0.0 || v25.rot[3] > 0.0 )
    {
      m_randR = (char)prtPtr->m_randR;
      v18 = (float)(unsigned __int8)m_randR;
      if ( m_randR < 0 )
      {
        v19 = (float)(v5
                    * (float)(v25.rot[2]
                            + (float)((float)((float)(v18 + -128.0) * 0.0078125) * (float)(v25.rot[3] - v25.rot[2]))))
            * (float)prtPtr->m_multRot;
        v20 = -255.0;
      }
      else
      {
        v19 = (float)(v5 * (float)(v25.rot[0] + (float)((float)(v18 * 0.0078125) * (float)(v25.rot[1] - v25.rot[0]))))
            * (float)prtPtr->m_multRot;
        v20 = 255.0;
      }
      v21 = v19 / v20;
      goto LABEL_25;
    }
    if ( v25.rot[0] > 0.0 )
    {
      v22 = v25.rot[1];
LABEL_24:
      v21 = (float)((float)(v5
                          * (float)(v25.rot[0]
                                  + (float)((float)((float)prtPtr->m_randR / 255.0) * (float)(v22 - v25.rot[0]))))
                  * (float)prtPtr->m_multRot)
          / 255.0;
LABEL_25:
      v23 = prtPtr->m_currRot + v21;
      goto LABEL_26;
    }
  }
  v22 = v25.rot[1];
  if ( v25.rot[1] > 0.0 )
    goto LABEL_24;
  if ( v25.rot[2] <= 0.0 )
    return 0;
  v23 = prtPtr->m_currRot
      - (float)((float)((float)(v5
                              * (float)(v25.rot[2]
                                      + (float)((float)((float)prtPtr->m_randR / 255.0)
                                              * (float)(v25.rot[3] - v25.rot[2]))))
                      * (float)prtPtr->m_multRot)
              / 255.0);
LABEL_26:
  prtPtr->m_currRot = v23;
  return 0;
}

//----- (003670DC) --------------------------------------------------------
void __fastcall FxEmitterBP_c::Render(
        FxEmitterBP_c *this,
        RwCamera_0 *camPtr,
        uint32 txdHashKey,
        float brightness,
        int doHeatHaze)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d2
  float32x2_t v8; // d3
  float32x2_t v9; // d4
  float32x2_t v10; // d10
  float32x2_t v11; // d11
  int32 m_numFxInfos; // r1
  float v15; // r9
  int v16; // r6
  List_c *p_m_particleList; // r4
  int32 NumItems; // r0
  RwRaster_0 *raster; // r6
  void *v20; // r1
  ListItem_c *m_head; // r8
  float v22; // s26
  float v23; // s25
  float v24; // s29
  __int64 v25; // d18
  __int64 v26; // d19
  __int64 v27; // d16
  __int64 v28; // d17
  __int64 v29; // d20
  __int64 v30; // d21
  __int64 v31; // d23
  float y; // s2
  float z; // s4
  RwMatrix *v34; // r5
  ListItem_c v35; // d16
  float smokeBright; // s16
  int v37; // r5
  float32x2_t v38; // d16
  float32x2_t v39; // d19
  ListItem_c v40; // d16
  RwMatrix *v41; // r5
  __int64 *p_up; // r10
  float v43; // s4
  float v44; // s2
  float v45; // s0
  float v46; // s10
  float v47; // s8
  float v48; // s6
  __int64 v49; // d16
  float m_red; // s0
  float m_green; // s2
  float m_blue; // s4
  __int64 v53; // d18
  __int64 v54; // d19
  __int64 v55; // d16
  __int64 v56; // d17
  __int64 v57; // d20
  __int64 v58; // d21
  __int64 v59; // d23
  float v60; // s8
  float x; // s6
  float v62; // s10
  RwReal v63; // s12
  RwReal v64; // s14
  float v65; // s2
  __int64 v66; // d16
  float *v67; // r0
  float v68; // s6
  float v69; // s6
  float v70; // s18
  float v71; // s24
  unsigned __int8 v72; // r0
  float v73; // s6
  float v74; // s12
  float *v75; // r0
  float v76; // s5
  float v77; // s14
  float v78; // s11
  float v79; // s13
  float v80; // s19
  float v81; // s27
  float v82; // s17
  __int64 v83; // d16
  float v84; // s12
  float v85; // s0
  float v86; // s10
  float v87; // s2
  float32x2_t v88; // d16
  unsigned int m_prev_low; // r0
  float v90; // s6
  float v91; // s0
  RwRaster_0 *v92; // r4
  RwRaster_0 *v93; // r5
  unsigned int m_next_low; // r0
  RwRaster_0 *v95; // r2
  unsigned int v96; // r0
  unsigned int v97; // r0
  unsigned int m_next_high; // r0
  unsigned int v99; // s4
  unsigned int v100; // s6
  float v101; // s10
  RwRaster_0 **p_raster; // r0
  RwRaster_0 *v103; // r4
  float v104; // s2
  float v105; // s0
  float v106; // s25
  float v107; // s24
  float v108; // s18
  float v109; // s26
  float v110; // s29
  float v111; // s22
  float v112; // s31
  float v113; // s16
  float v114; // s27
  float v115; // s19
  float v116; // s17
  float v117; // [sp+A8h] [bp-198h]
  FxEmitterBP_c *v118; // [sp+B0h] [bp-190h]
  RwRaster_0 *v119; // [sp+BCh] [bp-184h]
  RwRaster_0 *v120; // [sp+C0h] [bp-180h]
  RwRaster_0 *v121; // [sp+D4h] [bp-16Ch]
  void *parent; // [sp+D8h] [bp-168h]
  RwV3d_0 vel; // [sp+DCh] [bp-164h] BYREF
  RwV3d_0 pos; // [sp+E8h] [bp-158h] BYREF
  FxPrtMult_c fxMults; // [sp+F8h] [bp-148h] BYREF
  RenderInfo_t value; // [sp+118h] [bp-128h] BYREF
  RwV3d_0 pointsOut; // [sp+1C0h] [bp-80h] BYREF
  RwV3d_0 in; // [sp+1D0h] [bp-70h] BYREF

  m_numFxInfos = this->m_fxInfoMan.m_numFxInfos;
  v15 = brightness;
  if ( m_numFxInfos < 1 )
  {
LABEL_5:
    v16 = 0;
    if ( !doHeatHaze )
      goto LABEL_9;
LABEL_6:
    if ( this->m_hasHeatHazeFxInfo )
      FxEmitterBP_c::RenderHeatHaze(this, camPtr, txdHashKey, brightness);
    return;
  }
  txdHashKey = (uint32)this->m_fxInfoMan.m_fxInfoPtrs;
  brightness = 0.0;
  while ( *(_WORD *)(*(_DWORD *)(txdHashKey + 4 * LODWORD(brightness)) + 4) != 16392 )
  {
    ++LODWORD(brightness);
    if ( SLODWORD(brightness) >= m_numFxInfos )
      goto LABEL_5;
  }
  v16 = 1;
  if ( doHeatHaze )
    goto LABEL_6;
LABEL_9:
  p_m_particleList = &this->m_particleList;
  NumItems = List_c::GetNumItems(&this->m_particleList);
  if ( v16 )
  {
    if ( NumItems >= 1 )
      g_fxMan.m_foundHeatHazeInfo = 1;
    return;
  }
  if ( !NumItems )
    return;
  raster = this->m_texturePtr->raster;
  if ( !List_c::GetNumItems(&this->m_particleList) )
    return;
  v121 = raster;
  RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (void *)this->m_alphaOn);
  if ( this->m_alphaOn )
  {
    RwRenderStateSet(rwRENDERSTATESRCBLEND, (void *)g_blendFunctions[this->m_srcBlendId]);
    v20 = (void *)g_blendFunctions[this->m_dstBlendId];
  }
  else
  {
    RwRenderStateSet(rwRENDERSTATESRCBLEND, (void *)g_blendFunctions[1]);
    v20 = (void *)g_blendFunctions[0];
  }
  RwRenderStateSet(rwRENDERSTATEDESTBLEND, v20);
  v118 = this;
  g_pMatrix = 0;
  g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
  g_pRaster = raster;
  g_rwFlags = 1;
  g_numTris = 0;
  g_numVertices = 0;
  RwRenderStateGet(rwRENDERSTATETEXTURERASTER, &value);
  if ( (RwRaster_0 *)value.colour != raster )
    RwRenderStateSet(rwRENDERSTATETEXTURERASTER, raster);
  m_head = p_m_particleList->m_head;
  if ( p_m_particleList->m_head )
  {
    v11.n64_u32[0] = 1.0;
    v117 = v15;
    v22 = -0.5;
    v23 = 4.0;
    v24 = 0.5;
    parent = camPtr->object.object.parent;
    v10.n64_u32[0] = 1132396544;
    v119 = 0;
    v120 = 0;
    do
    {
      if ( HIBYTE(m_head[6].m_next) )
      {
        v34 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
        FxSystem_c::GetCompositeMatrix((FxSystem_c *)m_head[5].m_prev, v34);
        RwV3dTransformPoints(&pointsOut, (const RwV3d_0 *)&m_head[2], 1, v34);
        FxManager_c::FxRwMatrixDestroy(&g_fxMan, v34);
      }
      else
      {
        v35 = m_head[2];
        LODWORD(pointsOut.z) = m_head[3].m_prev;
        *(ListItem_c *)&pointsOut.x = v35;
      }
      FxInfoManager_c::ProcessRenderInfo(
        &v118->m_fxInfoMan,
        *(float *)&m_head[5].m_prev[11].m_prev,
        *(float *)&m_head[1].m_next / *(float *)&m_head[1].m_prev,
        0.0,
        *(float *)&m_head[5].m_prev[1].m_prev[1].m_next,
        0,
        &value);
      if ( value.smokeType >= 0 )
      {
        smokeBright = value.smokeBright;
        v37 = rand();
        FxPrtMult_c::FxPrtMult_c(&fxMults);
        fxMults.m_rot = 1.0;
        fxMults.m_size = value.smokeSize;
        fxMults.m_life = value.smokeTime;
        fxMults.m_alpha = value.smokeAlpha / 255.0;
        v5.n64_f32[0] = (float)((float)((float)(smokeBright + smokeBright) * (float)((float)v37 * 4.6566e-10))
                              - smokeBright)
                      / 255.0;
        v8.n64_f32[0] = v5.n64_f32[0] + (float)(value.smokeBlue / 255.0);
        v7.n64_f32[0] = v5.n64_f32[0] + (float)(value.smokeGreen / 255.0);
        v5.n64_f32[0] = (float)(value.smokeRed / 255.0) + v5.n64_f32[0];
        v38.n64_u64[0] = vmin_f32(v5, v11).n64_u64[0];
        v5.n64_u32[0] = 0;
        v39.n64_u64[0] = v5.n64_u64[0];
        v6.n64_u64[0] = vmax_f32(v38, v5).n64_u64[0];
        v5.n64_u64[0] = vmax_f32(vmin_f32(v8, v11), v5).n64_u64[0];
        v7.n64_u64[0] = vmax_f32(vmin_f32(v7, v11), v39).n64_u64[0];
        LODWORD(fxMults.m_red) = v6.n64_u32[0];
        LODWORD(fxMults.m_green) = v7.n64_u32[0];
        LODWORD(fxMults.m_blue) = v5.n64_u32[0];
        v40 = m_head[2];
        LODWORD(pos.z) = m_head[3].m_prev;
        *(ListItem_c *)&pos.x = v40;
        memset(&vel, 0, sizeof(vel));
        FxSystem_c::AddParticle(g_fx.m_fxSysSmokeHuge, &pos, &vel, 0.0, &fxMults, -1.0, 1.2, 0.6, 0);
      }
      v41 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
      v41->right.x = 1.0;
      v41->right.y = 0.0;
      v41->right.z = 0.0;
      v41->up.y = 1.0;
      v41->up.z = 0.0;
      v41->at.x = 0.0;
      v41->at.y = 0.0;
      v41->at.z = 1.0;
      v41->pos.z = 0.0;
      v41->pos.x = 0.0;
      v41->up.x = 0.0;
      p_up = (__int64 *)&v41->up;
      v41->pos.y = 0.0;
      v41->flags |= (unsigned int)&elf_hash_chain[16294] + 3;
      if ( value.trailId < 1 )
      {
        if ( !value.hasDir )
        {
          if ( value.isFlat )
          {
            v53 = *(_QWORD *)&value.flatMat.at.x;
            v54 = *(_QWORD *)&value.flatMat.at.z;
            v55 = *(_QWORD *)&value.flatMat.right.x;
            v56 = *(_QWORD *)&value.flatMat.right.z;
            v57 = *(_QWORD *)&value.flatMat.up.x;
            v58 = *(_QWORD *)&value.flatMat.up.z;
            v59 = *(_QWORD *)&value.flatMat.pos.z;
            *(_QWORD *)&v41->pos.x = *(_QWORD *)&value.flatMat.pos.x;
            *(_QWORD *)&v41->pos.z = v59;
            *(_QWORD *)&v41->at.x = v53;
            *(_QWORD *)&v41->at.z = v54;
            *(_QWORD *)&v41->right.x = v55;
            *(_QWORD *)&v41->right.z = v56;
            *(_QWORD *)&v41->up.x = v57;
            *(_QWORD *)&v41->up.z = v58;
            v5.n64_u32[0] = LODWORD(value.flatMat.at.x);
            y = value.flatMat.at.y;
            z = value.flatMat.at.z;
          }
          else
          {
            v25 = *((_QWORD *)parent + 6);
            v26 = *((_QWORD *)parent + 7);
            v27 = *((_QWORD *)parent + 2);
            v28 = *((_QWORD *)parent + 3);
            v29 = *((_QWORD *)parent + 4);
            v30 = *((_QWORD *)parent + 5);
            v31 = *((_QWORD *)parent + 9);
            *(_QWORD *)&v41->pos.x = *((_QWORD *)parent + 8);
            *(_QWORD *)&v41->pos.z = v31;
            *(_QWORD *)&v41->at.x = v25;
            *(_QWORD *)&v41->at.z = v26;
            *(_QWORD *)&v41->right.x = v27;
            *(_QWORD *)&v41->right.z = v28;
            *(_QWORD *)&v41->up.x = v29;
            *(_QWORD *)&v41->up.z = v30;
            v5.n64_u32[0] = *((_DWORD *)parent + 12);
            y = *((float *)parent + 13);
            z = *((float *)parent + 14);
          }
          goto LABEL_47;
        }
        if ( value.useVel )
        {
          v49 = *(_QWORD *)&m_head[3].m_next;
          LODWORD(in.z) = m_head[4].m_next;
          *(_QWORD *)&in.x = v49;
          if ( *(float *)&v49 == 0.0 && in.z == 0.0 )
            in.z = 1.0;
        }
        else
        {
          in = value.dirVec;
        }
        RwV3dNormalize(&in, &in);
        fxMults.m_red = pointsOut.x - *((float *)parent + 16);
        fxMults.m_green = pointsOut.y - *((float *)parent + 17);
        fxMults.m_blue = pointsOut.z - *((float *)parent + 18);
        RwV3dNormalize((RwV3d_0 *)&fxMults, (const RwV3d_0 *)&fxMults);
        m_red = fxMults.m_red;
        m_green = fxMults.m_green;
        m_blue = fxMults.m_blue;
      }
      else
      {
        v43 = *(float *)&m_head[2].m_prev;
        v44 = *(float *)&m_head[2].m_next;
        v45 = *(float *)&m_head[3].m_prev;
        if ( value.trailId == 2 )
        {
          v7.n64_u32[1] = LODWORD(TheCamera.m_cameraMatrixOld.tx);
          v6.n64_u32[1] = LODWORD(TheCamera.m_cameraMatrixOld.tz);
          v46 = value.trailTime
              * (float)((float)(v44 - *((float *)parent + 17))
                      - (float)((float)(v44 - (float)(*(float *)&m_head[4].m_prev * (float)(CTimer::ms_fTimeStep / 50.0)))
                              - TheCamera.m_cameraMatrixOld.ty));
          v47 = value.trailTime
              * (float)((float)(v43 - *((float *)parent + 16))
                      - (float)((float)(v43 - (float)(*(float *)&m_head[3].m_next * (float)(CTimer::ms_fTimeStep / 50.0)))
                              - TheCamera.m_cameraMatrixOld.tx));
          v48 = value.trailTime
              * (float)((float)(v45 - *((float *)parent + 18))
                      - (float)((float)(v45 - (float)(*(float *)&m_head[4].m_next * (float)(CTimer::ms_fTimeStep / 50.0)))
                              - TheCamera.m_cameraMatrixOld.tz));
        }
        else
        {
          v47 = v43 - (float)(v43 - (float)(*(float *)&m_head[3].m_next * value.trailTime));
          v46 = v44 - (float)(v44 - (float)(value.trailTime * *(float *)&m_head[4].m_prev));
          v48 = v45 - (float)(v45 - (float)(value.trailTime * *(float *)&m_head[4].m_next));
        }
        fxMults.m_blue = v48;
        *(_QWORD *)&in.x = __PAIR64__(LODWORD(v46), LODWORD(v47));
        *(_QWORD *)&fxMults.m_red = __PAIR64__(LODWORD(v46), LODWORD(v47));
        in.z = v48;
        if ( v47 == 0.0 && v46 == 0.0 )
        {
          in.z = 1.0;
        }
        else
        {
          RwV3dNormalize(&in, &in);
          v43 = *(float *)&m_head[2].m_prev;
          v44 = *(float *)&m_head[2].m_next;
          v45 = *(float *)&m_head[3].m_prev;
        }
        pos.x = v43 - *((float *)parent + 16);
        pos.y = v44 - *((float *)parent + 17);
        pos.z = v45 - *((float *)parent + 18);
        RwV3dNormalize(&pos, &pos);
        m_red = pos.x;
        m_green = pos.y;
        m_blue = pos.z;
      }
      v60 = in.y;
      x = in.x;
      v62 = in.z;
      v63 = (float)(m_green * in.x) - (float)(in.y * m_red);
      v64 = (float)(in.y * m_blue) - (float)(in.z * m_green);
      v5.n64_f32[1] = (float)(in.z * m_red) - (float)(m_blue * in.x);
      v5.n64_f32[0] = in.x * v63;
      v65 = in.z * v64;
      v41->right.x = v64;
      LODWORD(v41->right.y) = v5.n64_u32[1];
      v41->right.z = v63;
      v66 = *(_QWORD *)&in.x;
      v41->up.z = in.z;
      y = v65 - v5.n64_f32[0];
      *p_up = v66;
      v5.n64_f32[0] = (float)(v60 * v63) - (float)(v62 * v5.n64_f32[1]);
      z = (float)(x * v5.n64_f32[1]) - (float)(v60 * v64);
      LODWORD(v41->at.x) = v5.n64_u32[0];
      v41->at.y = y;
      v41->at.z = z;
LABEL_47:
      if ( BYTE2(m_head[6].m_next) == 255 )
      {
        v68 = *(float *)&m_head[7].m_prev;
        v67 = (float *)&m_head[7];
        if ( v68 < 0.0 )
        {
          do
            v68 = v68 + 360.0;
          while ( v68 < 0.0 );
          *v67 = v68;
        }
      }
      else
      {
        v67 = (float *)&m_head[7];
        v68 = (float)BYTE2(m_head[6].m_next) + (float)BYTE2(m_head[6].m_next);
        *(float *)&m_head[7].m_prev = v68;
      }
      if ( v68 >= 360.0 )
      {
        do
          v68 = v68 + -360.0;
        while ( v68 >= 360.0 );
        *v67 = v68;
      }
      if ( v68 <= 0.0 )
      {
        v81 = v41->right.x;
        v82 = v41->right.y;
        v80 = v41->right.z;
        v83 = *p_up;
        in.z = v41->up.z;
        *(_QWORD *)&in.x = v83;
      }
      else
      {
        v69 = (float)((float)(v68 * 0.017453) * 256.0) / 6.2832;
        v9.n64_f32[0] = CMaths::ms_SinTable[(unsigned __int8)(unsigned int)(float)(v69 + 64.0)];
        v70 = v41->right.y;
        v71 = v41->right.z;
        v72 = (unsigned int)v69;
        v73 = v5.n64_f32[0] * (float)(v11.n64_f32[0] - v9.n64_f32[0]);
        v74 = y * (float)(v11.n64_f32[0] - v9.n64_f32[0]);
        v75 = &CMaths::ms_SinTable[v72];
        v5.n64_f32[1] = v5.n64_f32[0] * *v75;
        v76 = y * *v75;
        v77 = z * *v75;
        v78 = v5.n64_f32[1] + (float)(z * v74);
        v79 = (float)(z * v73) - v76;
        v7.n64_f32[1] = v76 + (float)(z * v73);
        v9.n64_f32[1] = v41->right.x * v79;
        v5.n64_f32[1] = (float)((float)(z * v74) - v5.n64_f32[1]) * v71;
        v6.n64_f32[1] = v7.n64_f32[1] * v71;
        v80 = (float)((float)(v9.n64_f32[0] + (float)(z * (float)(z * (float)(v11.n64_f32[0] - v9.n64_f32[0])))) * v71)
            + (float)(v9.n64_f32[1] + (float)(v70 * v78));
        v81 = (float)(v7.n64_f32[1] * v71)
            + (float)((float)(v41->right.x * (float)(v9.n64_f32[0] + (float)(v5.n64_f32[0] * v73)))
                    + (float)(v70 * (float)((float)(y * v73) - v77)));
        v82 = v5.n64_f32[1]
            + (float)((float)(v41->right.x * (float)(v77 + (float)(y * v73)))
                    + (float)(v70 * (float)(v9.n64_f32[0] + (float)(y * v74))));
        in.y = (float)(z * v81) - (float)(v5.n64_f32[0] * v80);
        in.x = (float)(y * v80) - (float)(z * v82);
        in.z = (float)(v5.n64_f32[0] * v82) - (float)(y * v81);
      }
      FxManager_c::FxRwMatrixDestroy(&g_fxMan, v41);
      v84 = (float)BYTE2(m_head[6].m_prev);
      v85 = value.size.x + (float)(value.sizeBias.x * (float)((float)(v84 / 255.0) + v22));
      value.size.x = v85;
      v86 = (float)HIBYTE(m_head[6].m_prev) / 255.0;
      v87 = value.size.y + (float)(value.sizeBias.y * (float)(v86 + v22));
      value.size.y = v87;
      v88.n64_u64[0] = vsub_f32(*(float32x2_t *)&pointsOut.y, *(float32x2_t *)&v41->pos.y).n64_u64[0];
      m_prev_low = LOBYTE(m_head[6].m_prev);
      v8.n64_u64[0] = vmul_f32(v88, v88).n64_u64[0];
      v7.n64_f32[0] = (float)(v23
                            - (float)((float)(v87 * v85)
                                    / (float)((float)((float)((float)(pointsOut.x - v41->pos.x)
                                                            * (float)(pointsOut.x - v41->pos.x))
                                                    + v8.n64_f32[0])
                                            + v8.n64_f32[1])))
                    * v24;
      v7.n64_u64[0] = vmin_f32(v7, v11).n64_u64[0];
      if ( m_prev_low != 255 )
      {
        v90 = (float)m_prev_low / 255.0;
        value.size.y = v87 * v90;
        value.size.x = v85 * v90;
      }
      v6.n64_f32[0] = (float)value.colour._anon_0._anon_0.blue;
      v91 = v7.n64_f32[0] * (float)value.colour._anon_0._anon_0.alpha;
      v7.n64_f32[0] = (float)value.colour._anon_0._anon_0.green;
      v8.n64_f32[0] = (float)value.colour._anon_0._anon_0.red;
      if ( v91 >= 0.0 )
      {
        if ( value.colId == 2 )
        {
          v93 = v119;
          v92 = v120;
          v9.n64_f32[0] = (float)((float)(v84 * 0.0078125) + -1.0) * (float)value.colour2._anon_0._anon_0.alpha;
          v6.n64_f32[0] = v9.n64_f32[0] + v6.n64_f32[0];
          v7.n64_f32[0] = v9.n64_f32[0] + v7.n64_f32[0];
          v8.n64_f32[0] = v9.n64_f32[0] + v8.n64_f32[0];
          v9.n64_u32[0] = 0;
          v6.n64_u32[0] = vmin_f32(vmax_f32(v6, v9), v10).n64_u32[0];
          v7.n64_u64[0] = vmin_f32(vmax_f32(v7, v9), v10).n64_u64[0];
          v8.n64_u64[0] = vmin_f32(vmax_f32(v8, v9), v10).n64_u64[0];
        }
        else
        {
          v93 = v119;
          v92 = v120;
          if ( value.colId == 1 )
          {
            v9.n64_f32[1] = (float)value.colour2._anon_0._anon_0.blue - v6.n64_f32[0];
            v7.n64_f32[0] = (float)((float)((float)value.colour2._anon_0._anon_0.green - v7.n64_f32[0]) * v86)
                          + v7.n64_f32[0];
            v8.n64_f32[0] = (float)((float)((float)value.colour2._anon_0._anon_0.red - v8.n64_f32[0])
                                  * (float)(v84 / 255.0))
                          + v8.n64_f32[0];
            v6.n64_f32[0] = (float)(v9.n64_f32[1] * (float)((float)LOBYTE(m_head[6].m_next) / 255.0)) + v6.n64_f32[0];
          }
        }
        m_next_low = LOBYTE(m_head[5].m_next);
        v95 = v121;
        if ( m_next_low != 255 )
          v8.n64_f32[0] = v8.n64_f32[0] * (float)((float)m_next_low / 255.0);
        v96 = BYTE1(m_head[5].m_next);
        if ( v96 != 255 )
          v7.n64_f32[0] = v7.n64_f32[0] * (float)((float)v96 / 255.0);
        v97 = BYTE2(m_head[5].m_next);
        if ( v97 != 255 )
          v6.n64_f32[0] = v6.n64_f32[0] * (float)((float)v97 / 255.0);
        m_next_high = HIBYTE(m_head[5].m_next);
        if ( m_next_high != 255 )
          v91 = v91 * (float)((float)m_next_high / 255.0);
        if ( value.isSelfLit )
        {
          v99 = (unsigned int)v7.n64_f32[0];
          v100 = (unsigned int)v8.n64_f32[0];
        }
        else
        {
          v101 = v117;
          if ( BYTE1(m_head[6].m_next) < 0x65u )
            v101 = (float)BYTE1(m_head[6].m_next) * 0.01;
          v117 = v101;
          v6.n64_f32[0] = v6.n64_f32[0] * v101;
          v99 = (unsigned int)(float)(v7.n64_f32[0] * v101);
          v100 = (unsigned int)(float)(v8.n64_f32[0] * v101);
        }
        value.colour._anon_0._anon_0.green = v99;
        value.colour._anon_0._anon_0.red = v100;
        value.colour._anon_0._anon_0.alpha = (unsigned int)v91;
        value.colour._anon_0._anon_0.blue = (unsigned int)v6.n64_f32[0];
        if ( value.hasAnimTextures )
        {
          switch ( value.currTexId )
          {
            case 1:
              goto LABEL_85;
            case 2:
              p_raster = &v118->m_texturePtr2->raster;
              if ( !p_raster )
                goto LABEL_85;
              goto LABEL_86;
            case 3:
              p_raster = &v118->m_texturePtr3->raster;
              if ( !p_raster )
                goto LABEL_85;
              goto LABEL_86;
            case 4:
              p_raster = &v118->m_texturePtr4->raster;
              if ( !p_raster )
                goto LABEL_85;
              goto LABEL_86;
            default:
              break;
          }
        }
        else
        {
LABEL_85:
          p_raster = &v118->m_texturePtr->raster;
LABEL_86:
          v92 = *p_raster;
          v93 = *p_raster;
        }
        if ( v121 != v93 )
        {
          if ( g_numTris )
          {
            if ( RwIm3DTransform(TempVertexBuffer.m_3d, 3 * g_numTris, g_pMatrix, g_rwFlags) )
            {
              RwIm3DRenderPrimitive(rwPRIMTYPETRILIST);
              RwIm3DEnd();
            }
            g_numVertices = 0;
            g_numTris = 0;
            g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
          }
          g_pMatrix = 0;
          g_pRaster = v92;
          g_rwFlags = 1;
          g_numTris = 0;
          g_numVertices = 0;
          g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
          RwRenderStateGet(rwRENDERSTATETEXTURERASTER, &pos);
          if ( (RwRaster_0 *)LODWORD(pos.x) != v92 )
            RwRenderStateSet(rwRENDERSTATETEXTURERASTER, v92);
          v95 = v93;
        }
        v119 = v93;
        v120 = v92;
        v103 = v95;
        if ( value.trailId <= 0 )
        {
          v105 = value.spriteRect.x;
          v104 = value.spriteRect.y;
        }
        else
        {
          v104 = 0.0;
          v105 = RwV3dLength((const RwV3d_0 *)&fxMults);
          value.spriteRect.x = v105;
          value.spriteRect.y = 0.0;
        }
        v121 = v103;
        v6.n64_f32[0] = value.size.y * v104;
        v5.n64_f32[0] = value.size.y * v105;
        v106 = in.x * v6.n64_f32[0];
        v107 = in.x * v5.n64_f32[0];
        v108 = in.y * v5.n64_f32[0];
        v109 = v5.n64_f32[0] * in.z;
        v110 = v81 * (float)(value.size.x * value.spriteRect.w);
        v111 = in.y * v6.n64_f32[0];
        v112 = v82 * (float)(value.size.x * value.spriteRect.z);
        v113 = v80 * (float)(value.size.x * value.spriteRect.z);
        v114 = v81 * (float)(value.size.x * value.spriteRect.z);
        v6.n64_f32[1] = (float)(in.y * v5.n64_f32[0]) + pointsOut.y;
        v11.n64_f32[1] = in.z * v6.n64_f32[0];
        v115 = v80 * (float)(value.size.x * value.spriteRect.w);
        v116 = v82 * (float)(value.size.x * value.spriteRect.w);
        RenderAddTri(
          v114 + (float)((float)(in.x * v5.n64_f32[0]) + pointsOut.x),
          v112 + v6.n64_f32[1],
          v113 + (float)((float)(v5.n64_f32[0] * in.z) + pointsOut.z),
          (float)((float)(in.x * v6.n64_f32[0]) + pointsOut.x) + v110,
          v116 + (float)((float)(in.y * v6.n64_f32[0]) + pointsOut.y),
          v115 + (float)((float)(in.z * v6.n64_f32[0]) + pointsOut.z),
          (float)((float)(in.x * v5.n64_f32[0]) + pointsOut.x) + v110,
          v116 + v6.n64_f32[1],
          v115 + (float)((float)(v5.n64_f32[0] * in.z) + pointsOut.z),
          0.0,
          0.0,
          1.0,
          1.0,
          1.0,
          0.0,
          value.colour._anon_0._anon_0.red,
          value.colour._anon_0._anon_0.green,
          value.colour._anon_0._anon_0.blue,
          value.colour._anon_0._anon_0.alpha,
          value.colour._anon_0._anon_0.red,
          value.colour._anon_0._anon_0.green,
          value.colour._anon_0._anon_0.blue,
          value.colour._anon_0._anon_0.alpha,
          value.colour._anon_0._anon_0.red,
          value.colour._anon_0._anon_0.green,
          value.colour._anon_0._anon_0.blue,
          value.colour._anon_0._anon_0.alpha);
        v5.n64_f32[1] = v115 + (float)(v11.n64_f32[1] + pointsOut.z);
        RenderAddTri(
          v110 + (float)(v106 + pointsOut.x),
          v116 + (float)(v111 + pointsOut.y),
          v5.n64_f32[1],
          v114 + (float)(v107 + pointsOut.x),
          v112 + (float)(v108 + pointsOut.y),
          v113 + (float)(v109 + pointsOut.z),
          v114 + (float)(v106 + pointsOut.x),
          v112 + (float)(v111 + pointsOut.y),
          v113 + (float)(v11.n64_f32[1] + pointsOut.z),
          1.0,
          1.0,
          0.0,
          0.0,
          0.0,
          1.0,
          value.colour._anon_0._anon_0.red,
          value.colour._anon_0._anon_0.green,
          value.colour._anon_0._anon_0.blue,
          value.colour._anon_0._anon_0.alpha,
          value.colour._anon_0._anon_0.red,
          value.colour._anon_0._anon_0.green,
          value.colour._anon_0._anon_0.blue,
          value.colour._anon_0._anon_0.alpha,
          value.colour._anon_0._anon_0.red,
          value.colour._anon_0._anon_0.green,
          value.colour._anon_0._anon_0.blue,
          value.colour._anon_0._anon_0.alpha);
        v11.n64_u32[0] = 1.0;
        v22 = -0.5;
        v23 = 4.0;
        v24 = 0.5;
      }
      m_head = m_head->m_next;
    }
    while ( m_head );
  }
  if ( g_numTris )
  {
    if ( RwIm3DTransform(TempVertexBuffer.m_3d, 3 * g_numTris, g_pMatrix, g_rwFlags) )
    {
      RwIm3DRenderPrimitive(rwPRIMTYPETRILIST);
      RwIm3DEnd();
    }
    g_numVertices = 0;
    g_numTris = 0;
    g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
  }
}
// 3674B2: variable 'v5' is possibly undefined
// 3674B2: variable 'v11' is possibly undefined
// 3674AA: variable 'v8' is possibly undefined
// 3674AE: variable 'v7' is possibly undefined
// 367B98: variable 'v6' is possibly undefined
// 367B98: variable 'v9' is possibly undefined
// 367BA4: variable 'v10' is possibly undefined
// 10168: using guessed type int elf_hash_chain[22025];

//----- (00368034) --------------------------------------------------------
bool8 __fastcall FxEmitterBP_c::IsFxInfoPresent(FxEmitterBP_c *this, int32 type)
{
  int32 m_numFxInfos; // r2
  int32 i; // r3

  m_numFxInfos = this->m_fxInfoMan.m_numFxInfos;
  if ( m_numFxInfos < 1 )
    return 0;
  for ( i = 0; i < m_numFxInfos; ++i )
  {
    if ( this->m_fxInfoMan.m_fxInfoPtrs[i]->m_type == type )
      return 1;
  }
  return 0;
}

//----- (00368060) --------------------------------------------------------
void __fastcall FxEmitterBP_c::RenderHeatHaze(
        FxEmitterBP_c *this,
        RwCamera_0 *camPtr,
        uint32 txdHashKey,
        float brightness)
{
  List_c *p_m_particleList; // r5
  RwRaster_0 *raster; // r10
  RwRaster_0 *v8; // r6
  ListItem_c *m_head; // r10
  RwRaster_0 *v10; // r11
  RwMatrix *v11; // r5
  ListItem_c v12; // d16
  RwMatrix *v13; // r9
  __int64 *p_up; // r5
  __int64 v15; // d16
  __int64 v16; // d18
  __int64 v17; // d19
  __int64 v18; // d16
  __int64 v19; // d17
  __int64 v20; // d20
  __int64 v21; // d21
  __int64 v22; // d23
  float v23; // s0
  float v24; // s2
  float v25; // s4
  float y; // s8
  float x; // s6
  float z; // s10
  RwReal v29; // s12
  RwReal v30; // s14
  RwReal v31; // s1
  float v32; // s0
  float v33; // s2
  __int64 v34; // d16
  float *v35; // r0
  float v36; // s6
  float v37; // s6
  float v38; // s8
  float v39; // s20
  float v40; // s22
  unsigned __int8 v41; // r0
  float v42; // s6
  float v43; // s12
  float *v44; // r0
  float v45; // s1
  float v46; // s5
  float v47; // s14
  float v48; // s19
  float v49; // s23
  float v50; // s21
  __int64 v51; // d16
  RwRaster_0 *v52; // r5
  float v53; // s0
  float v54; // s2
  unsigned int m_prev_low; // r0
  float v56; // s4
  RwTexture_0 *m_texturePtr2; // r0
  __int64 v58; // d18
  __int64 v59; // d19
  __int64 v60; // d16
  __int64 v61; // d17
  __int64 v62; // d20
  __int64 v63; // d21
  __int64 v64; // d23
  Int32 r1; // r4
  Int32 g2; // r12
  Int32 b1; // r6
  float v68; // s4
  float v69; // s2
  float v70; // s6
  float v71; // s0
  float v72; // s22
  float v73; // s20
  float v74; // s25
  float v75; // s29
  float v76; // s18
  float v77; // s24
  float v78; // s27
  float v79; // s31
  float v80; // s23
  float v81; // s26
  float v82; // s19
  float v83; // s21
  __int64 *v84; // [sp+5Ch] [bp-19Ch]
  float *parent; // [sp+A8h] [bp-150h]
  FxInfoManager_c *p_m_fxInfoMan; // [sp+B4h] [bp-144h]
  FxEmitterBP_c *v87; // [sp+B8h] [bp-140h]
  RwRaster_0 *v88; // [sp+BCh] [bp-13Ch]
  RwRaster_0 *v89; // [sp+C0h] [bp-138h]
  RwV3d_0 out; // [sp+C4h] [bp-134h] BYREF
  RenderInfo_t value; // [sp+D0h] [bp-128h] BYREF
  RwV3d_0 pointsOut; // [sp+178h] [bp-80h] BYREF
  RwV3d_0 in; // [sp+188h] [bp-70h] BYREF

  p_m_particleList = &this->m_particleList;
  if ( List_c::GetNumItems(&this->m_particleList) )
  {
    raster = this->m_texturePtr->raster;
    if ( List_c::GetNumItems(p_m_particleList) )
    {
      v87 = this;
      RwRenderStateSet(rwRENDERSTATEVERTEXALPHAENABLE, (char *)&dword_0 + 1);
      RwRenderStateSet(rwRENDERSTATESRCBLEND, &byte_5);
      RwRenderStateSet(rwRENDERSTATEDESTBLEND, (char *)&dword_0 + 2);
      g_pRaster = raster;
      g_pMatrix = 0;
      v8 = raster;
      g_rwFlags = 1;
      g_numTris = 0;
      g_numVertices = 0;
      g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
      RwRenderStateGet(rwRENDERSTATETEXTURERASTER, &value);
      if ( (RwRaster_0 *)value.colour != raster )
        RwRenderStateSet(rwRENDERSTATETEXTURERASTER, raster);
      m_head = p_m_particleList->m_head;
      if ( p_m_particleList->m_head )
      {
        p_m_fxInfoMan = &this->m_fxInfoMan;
        v84 = (__int64 *)((char *)camPtr->object.object.parent + 16);
        parent = (float *)camPtr->object.object.parent;
        v10 = 0;
        v88 = 0;
        do
        {
          v89 = v8;
          if ( HIBYTE(m_head[6].m_next) )
          {
            v11 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
            FxSystem_c::GetCompositeMatrix((FxSystem_c *)m_head[5].m_prev, v11);
            RwV3dTransformPoints(&pointsOut, (const RwV3d_0 *)&m_head[2], 1, v11);
            FxManager_c::FxRwMatrixDestroy(&g_fxMan, v11);
          }
          else
          {
            v12 = m_head[2];
            LODWORD(pointsOut.z) = m_head[3].m_prev;
            *(ListItem_c *)&pointsOut.x = v12;
          }
          FxInfoManager_c::ProcessRenderInfo(
            p_m_fxInfoMan,
            *(float *)&m_head[5].m_prev[11].m_prev,
            *(float *)&m_head[1].m_next / *(float *)&m_head[1].m_prev,
            0.0,
            *(float *)&m_head[5].m_prev[1].m_prev[1].m_next,
            0,
            &value);
          v13 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
          v13->right.y = 0.0;
          v13->right.z = 0.0;
          v13->right.x = 1.0;
          v13->up.y = 1.0;
          v13->up.z = 0.0;
          v13->at.x = 0.0;
          v13->at.y = 0.0;
          v13->at.z = 1.0;
          v13->pos.x = 0.0;
          v13->pos.y = 0.0;
          v13->pos.z = 0.0;
          v13->flags |= (unsigned int)&elf_hash_chain[16294] + 3;
          v13->up.x = 0.0;
          p_up = (__int64 *)&v13->up;
          if ( value.hasDir )
          {
            if ( value.useVel )
            {
              v15 = *(_QWORD *)&m_head[3].m_next;
              LODWORD(in.z) = m_head[4].m_next;
              *(_QWORD *)&in.x = v15;
            }
            else
            {
              in = value.dirVec;
            }
            RwV3dNormalize(&in, &in);
            out.x = pointsOut.x - parent[16];
            out.y = pointsOut.y - parent[17];
            out.z = pointsOut.z - parent[18];
            RwV3dNormalize(&out, &out);
            y = in.y;
            x = in.x;
            z = in.z;
            v29 = (float)(out.y * in.x) - (float)(in.y * out.x);
            v30 = (float)(in.y * out.z) - (float)(in.z * out.y);
            v31 = (float)(in.z * out.x) - (float)(out.z * in.x);
            v32 = in.x * v29;
            v33 = in.z * v30;
            v13->right.x = v30;
            v13->right.y = v31;
            v13->right.z = v29;
            v34 = *(_QWORD *)&in.x;
            v13->up.z = in.z;
            v24 = v33 - v32;
            *p_up = v34;
            v23 = (float)(y * v29) - (float)(z * v31);
            v25 = (float)(x * v31) - (float)(y * v30);
            v13->at.x = v23;
            v13->at.y = v24;
            v13->at.z = v25;
          }
          else if ( value.isFlat )
          {
            v16 = *(_QWORD *)&value.flatMat.at.x;
            v17 = *(_QWORD *)&value.flatMat.at.z;
            v18 = *(_QWORD *)&value.flatMat.right.x;
            v19 = *(_QWORD *)&value.flatMat.right.z;
            v20 = *(_QWORD *)&value.flatMat.up.x;
            v21 = *(_QWORD *)&value.flatMat.up.z;
            v22 = *(_QWORD *)&value.flatMat.pos.z;
            *(_QWORD *)&v13->pos.x = *(_QWORD *)&value.flatMat.pos.x;
            *(_QWORD *)&v13->pos.z = v22;
            *(_QWORD *)&v13->at.x = v16;
            *(_QWORD *)&v13->at.z = v17;
            *(_QWORD *)&v13->right.x = v18;
            *(_QWORD *)&v13->right.z = v19;
            *(_QWORD *)&v13->up.x = v20;
            *(_QWORD *)&v13->up.z = v21;
            v23 = value.flatMat.at.x;
            v24 = value.flatMat.at.y;
            v25 = value.flatMat.at.z;
          }
          else
          {
            v58 = v84[4];
            v59 = v84[5];
            v60 = *v84;
            v61 = v84[1];
            v62 = v84[2];
            v63 = v84[3];
            v64 = v84[7];
            *(_QWORD *)&v13->pos.x = v84[6];
            *(_QWORD *)&v13->pos.z = v64;
            *(_QWORD *)&v13->at.x = v58;
            *(_QWORD *)&v13->at.z = v59;
            *(_QWORD *)&v13->right.x = v60;
            *(_QWORD *)&v13->right.z = v61;
            *(_QWORD *)&v13->up.x = v62;
            *(_QWORD *)&v13->up.z = v63;
            v23 = parent[12];
            v24 = parent[13];
            v25 = parent[14];
          }
          if ( BYTE2(m_head[6].m_next) == 255 )
          {
            v36 = *(float *)&m_head[7].m_prev;
            v35 = (float *)&m_head[7];
            if ( v36 < 0.0 )
            {
              do
                v36 = v36 + 360.0;
              while ( v36 < 0.0 );
              *v35 = v36;
            }
          }
          else
          {
            v35 = (float *)&m_head[7];
            v36 = (float)BYTE2(m_head[6].m_next) + (float)BYTE2(m_head[6].m_next);
            *(float *)&m_head[7].m_prev = v36;
          }
          if ( v36 >= 360.0 )
          {
            do
              v36 = v36 + -360.0;
            while ( v36 >= 360.0 );
            *v35 = v36;
          }
          if ( v36 <= 0.0 )
          {
            v49 = v13->right.x;
            v50 = v13->right.y;
            v48 = v13->right.z;
            v51 = *p_up;
            in.z = v13->up.z;
            *(_QWORD *)&in.x = v51;
          }
          else
          {
            v37 = (float)((float)(v36 * 0.017453) * 256.0) / 6.2832;
            v38 = CMaths::ms_SinTable[(unsigned __int8)(unsigned int)(float)(v37 + 64.0)];
            v39 = v13->right.y;
            v40 = v13->right.z;
            v41 = (unsigned int)v37;
            v42 = v23 * (float)(1.0 - v38);
            v43 = v24 * (float)(1.0 - v38);
            v44 = &CMaths::ms_SinTable[v41];
            v45 = v23 * *v44;
            v46 = v24 * *v44;
            v47 = v25 * *v44;
            v48 = (float)((float)(v38 + (float)(v25 * (float)(v25 * (float)(1.0 - v38)))) * v40)
                + (float)((float)(v13->right.x * (float)((float)(v25 * v42) - v46))
                        + (float)(v39 * (float)(v45 + (float)(v25 * v43))));
            v49 = (float)((float)(v46 + (float)(v25 * v42)) * v40)
                + (float)((float)(v13->right.x * (float)(v38 + (float)(v23 * v42)))
                        + (float)(v39 * (float)((float)(v24 * v42) - v47)));
            v50 = (float)((float)((float)(v25 * v43) - v45) * v40)
                + (float)((float)(v13->right.x * (float)(v47 + (float)(v24 * v42)))
                        + (float)(v39 * (float)(v38 + (float)(v24 * v43))));
            in.y = (float)(v25 * v49) - (float)(v23 * v48);
            in.x = (float)(v24 * v48) - (float)(v25 * v50);
            in.z = (float)(v23 * v50) - (float)(v24 * v49);
          }
          v52 = v10;
          FxManager_c::FxRwMatrixDestroy(&g_fxMan, v13);
          v53 = value.size.x
              + (float)(value.sizeBias.x * (float)((float)((float)BYTE2(m_head[6].m_prev) / 255.0) + -0.5));
          value.size.x = v53;
          v54 = value.size.y
              + (float)(value.sizeBias.y * (float)((float)((float)HIBYTE(m_head[6].m_prev) / 255.0) + -0.5));
          value.size.y = v54;
          m_prev_low = LOBYTE(m_head[6].m_prev);
          if ( m_prev_low != 255 )
          {
            v56 = (float)m_prev_low / 255.0;
            v54 = v54 * v56;
            v53 = v56 * v53;
            value.size.y = v54;
            value.size.x = v53;
          }
          value.colour._anon_0._anon_0.blue = 0;
          *(_WORD *)&value.colour._anon_0._anon_0.red = 0;
          if ( value.hasAnimTextures )
          {
            switch ( value.currTexId )
            {
              case 1:
                break;
              case 2:
                m_texturePtr2 = v87->m_texturePtr2;
                goto LABEL_37;
              case 3:
                m_texturePtr2 = v87->m_texturePtr3;
                goto LABEL_37;
              case 4:
                m_texturePtr2 = v87->m_texturePtr4;
LABEL_37:
                if ( !m_texturePtr2 )
                  m_texturePtr2 = v87->m_texturePtr;
                goto LABEL_39;
              default:
                goto LABEL_40;
            }
          }
          m_texturePtr2 = v87->m_texturePtr;
LABEL_39:
          v52 = m_texturePtr2->raster;
          v88 = m_texturePtr2->raster;
LABEL_40:
          if ( v8 == v52 )
          {
            v10 = v52;
            b1 = 0;
            g2 = 0;
            r1 = 0;
          }
          else
          {
            if ( g_numTris )
            {
              if ( RwIm3DTransform(TempVertexBuffer.m_3d, 3 * g_numTris, g_pMatrix, g_rwFlags) )
              {
                RwIm3DRenderPrimitive(rwPRIMTYPETRILIST);
                RwIm3DEnd();
              }
              g_numVertices = 0;
              g_numTris = 0;
              g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
            }
            g_pMatrix = 0;
            g_pRaster = v88;
            g_rwFlags = 1;
            g_numTris = 0;
            g_numVertices = 0;
            g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
            RwRenderStateGet(rwRENDERSTATETEXTURERASTER, &out);
            if ( (RwRaster_0 *)LODWORD(out.x) != v88 )
              RwRenderStateSet(rwRENDERSTATETEXTURERASTER, v88);
            r1 = value.colour._anon_0._anon_0.red;
            v10 = v52;
            g2 = value.colour._anon_0._anon_0.green;
            b1 = value.colour._anon_0._anon_0.blue;
            v53 = value.size.x;
            v54 = value.size.y;
            v89 = v52;
          }
          v68 = v54 * value.spriteRect.y;
          v69 = v54 * value.spriteRect.x;
          v70 = v53 * value.spriteRect.w;
          v71 = v53 * value.spriteRect.z;
          v72 = in.x * v68;
          v73 = in.x * v69;
          v74 = in.y * v69;
          v75 = v69 * in.z;
          v76 = v49 * v70;
          v77 = in.z * v68;
          v78 = v50 * v71;
          v79 = v48 * v71;
          v80 = v49 * v71;
          v81 = in.y * v68;
          v82 = v48 * v70;
          v83 = v50 * v70;
          RenderAddTri(
            v80 + (float)((float)(in.x * v69) + pointsOut.x),
            v78 + (float)((float)(in.y * v69) + pointsOut.y),
            v79 + (float)((float)(v69 * in.z) + pointsOut.z),
            (float)((float)(in.x * v68) + pointsOut.x) + v76,
            v83 + (float)((float)(in.y * v68) + pointsOut.y),
            v82 + (float)((float)(in.z * v68) + pointsOut.z),
            (float)((float)(in.x * v69) + pointsOut.x) + v76,
            v83 + (float)((float)(in.y * v69) + pointsOut.y),
            v82 + (float)((float)(v69 * in.z) + pointsOut.z),
            0.0,
            0.0,
            1.0,
            1.0,
            1.0,
            0.0,
            r1,
            g2,
            b1,
            value.colour._anon_0._anon_0.alpha,
            r1,
            g2,
            b1,
            value.colour._anon_0._anon_0.alpha,
            r1,
            g2,
            b1,
            value.colour._anon_0._anon_0.alpha);
          RenderAddTri(
            v76 + (float)(v72 + pointsOut.x),
            v83 + (float)(v81 + pointsOut.y),
            v82 + (float)(v77 + pointsOut.z),
            v80 + (float)(v73 + pointsOut.x),
            v78 + (float)(v74 + pointsOut.y),
            v79 + (float)(v75 + pointsOut.z),
            v80 + (float)(v72 + pointsOut.x),
            v78 + (float)(v81 + pointsOut.y),
            v79 + (float)(v77 + pointsOut.z),
            1.0,
            1.0,
            0.0,
            0.0,
            0.0,
            1.0,
            value.colour._anon_0._anon_0.red,
            value.colour._anon_0._anon_0.green,
            value.colour._anon_0._anon_0.blue,
            value.colour._anon_0._anon_0.alpha,
            value.colour._anon_0._anon_0.red,
            value.colour._anon_0._anon_0.green,
            value.colour._anon_0._anon_0.blue,
            value.colour._anon_0._anon_0.alpha,
            value.colour._anon_0._anon_0.red,
            value.colour._anon_0._anon_0.green,
            value.colour._anon_0._anon_0.blue,
            value.colour._anon_0._anon_0.alpha);
          m_head = m_head->m_next;
          v8 = v89;
        }
        while ( m_head );
      }
      if ( g_numTris )
      {
        if ( RwIm3DTransform(TempVertexBuffer.m_3d, 3 * g_numTris, g_pMatrix, g_rwFlags) )
        {
          RwIm3DRenderPrimitive(rwPRIMTYPETRILIST);
          RwIm3DEnd();
        }
        g_numVertices = 0;
        g_numTris = 0;
        g_pVertex3d = (RwIm3DVertex *)&TempVertexBuffer;
      }
    }
  }
}
// 0: using guessed type int dword_0;
// 5: using guessed type char byte_5;
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003689F0) --------------------------------------------------------
bool8 __fastcall FxEmitterBP_c::FreePrtFromPrim(FxEmitterBP_c *this, FxSystem_c *pFxSys)
{
  List_c *p_m_particleList; // r0
  FxEmitterPrt_c **p_m_next; // r2
  FxEmitterPrt_c *v4; // r4

  p_m_particleList = &this->m_particleList;
  p_m_next = (FxEmitterPrt_c **)p_m_particleList;
  while ( 1 )
  {
    v4 = *p_m_next;
    if ( !*p_m_next )
      break;
    p_m_next = (FxEmitterPrt_c **)&v4->m_next;
    if ( v4->m_fxSysPtr == pFxSys )
    {
      List_c::RemoveItem(p_m_particleList, v4);
      FxManager_c::ReturnParticle(&g_fxMan, v4);
      return 1;
    }
  }
  return 0;
}

//----- (00368A24) --------------------------------------------------------
bool8 __fastcall FxEmitter_c::Init(FxEmitter_c *this, FxPrimBP_c *fxPrimBPPtr, FxSystem_c *fxSysPtr)
{
  this->m_bpPtr = fxPrimBPPtr;
  this->m_fxSysPtr = fxSysPtr;
  this->m_particleCount = 0.0;
  return 1;
}

//----- (00368A30) --------------------------------------------------------
void __fastcall FxEmitter_c::Update(FxEmitter_c *this, float currTime, float deltaTime)
{
  if ( this->m_enabled )
  {
    if ( (*((_BYTE *)this->m_fxSysPtr + 102) & 8) == 0 )
      FxEmitter_c::CreateParticles(this, currTime, deltaTime);
  }
}

//----- (00368A48) --------------------------------------------------------
void __fastcall FxEmitter_c::CreateParticles(FxEmitter_c *this, float currTime, float deltaTime)
{
  __int64 v5; // r0
  unsigned int v6; // s4
  float v7; // s0
  unsigned int v8; // r0
  float v9; // s2
  float v10; // s6
  float v11; // s2
  float v12; // s4
  float v13; // s0
  RwMatrix *v14; // r9
  RwMatrix *v15; // r8
  FxSystem_c *m_fxSysPtr; // r0
  const RwMatrix *p_m_offsetMat; // r1
  const RwMatrix *m_parentMat; // r2
  __int64 v19; // d16
  __int64 v20; // d17
  __int64 v21; // d20
  __int64 v22; // d21
  __int64 v23; // d23
  __int64 v24; // d18
  __int64 v25; // d19
  RwMatrix *v26; // r6
  float m_particleCount; // s0
  int v28; // r0
  int v29; // r6
  FxPrtMult_c fxMults; // [sp+14h] [bp-ACh] BYREF
  EmissionInfo_t v31; // [sp+30h] [bp-90h] BYREF

  FxInfoManager_c::ProcessEmissionInfo(
    &this->m_bpPtr->m_fxInfoMan,
    currTime,
    deltaTime,
    this->m_fxSysPtr->m_bpPtr->m_length,
    this->m_fxSysPtr->m_useConstTime,
    (int)&v31);
  v5 = *(_QWORD *)&this->m_bpPtr;
  v6 = *(unsigned __int16 *)(v5 + 56);
  v7 = (float)*(unsigned __int16 *)(HIDWORD(v5) + 98) / 1000.0;
  if ( !MobileSettings::settings[0].value )
    v7 = v7 * 0.5;
  v8 = *(unsigned __int16 *)(v5 + 58);
  v9 = (float)v6 * 0.015625;
  if ( MobileSettings::settings[0].value == 1 )
    v7 = v7 * 0.75;
  v10 = *(float *)(HIDWORD(v5) + 92);
  if ( v10 >= v9 )
  {
    v12 = (float)v8 * 0.015625;
    if ( v10 <= v12 )
      v11 = 1.0 - (float)((float)(v10 - v9) / (float)(v12 - v9));
    else
      v11 = 0.0;
  }
  else
  {
    v11 = 1.0;
  }
  v13 = this->m_particleCount + (float)(v7 * (float)(v11 * v31.count));
  this->m_particleCount = v13;
  if ( CWeather::Wind >= v31.weather[0]
    && CWeather::Wind <= v31.weather[1]
    && CWeather::Rain >= v31.weather[2]
    && v13 >= 1.0
    && CWeather::Rain <= v31.weather[3] )
  {
    v14 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
    v15 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
    TestMatrix(&this->m_fxSysPtr->m_offsetMat);
    RwMatrixUpdate(&this->m_fxSysPtr->m_offsetMat);
    m_fxSysPtr = this->m_fxSysPtr;
    p_m_offsetMat = &m_fxSysPtr->m_offsetMat;
    m_parentMat = m_fxSysPtr->m_parentMat;
    if ( m_parentMat )
    {
      RwMatrixMultiply(v15, p_m_offsetMat, m_parentMat);
    }
    else
    {
      v19 = *(_QWORD *)&p_m_offsetMat->right.x;
      v20 = *(_QWORD *)&m_fxSysPtr->m_offsetMat.right.z;
      v21 = *(_QWORD *)&m_fxSysPtr->m_offsetMat.up.x;
      v22 = *(_QWORD *)&m_fxSysPtr->m_offsetMat.up.z;
      v23 = *(_QWORD *)&m_fxSysPtr->m_offsetMat.pos.z;
      v24 = *(_QWORD *)&m_fxSysPtr->m_offsetMat.at.x;
      v25 = *(_QWORD *)&m_fxSysPtr->m_offsetMat.at.z;
      *(_QWORD *)&v15->pos.x = *(_QWORD *)&m_fxSysPtr->m_offsetMat.pos.x;
      *(_QWORD *)&v15->pos.z = v23;
      *(_QWORD *)&v15->at.x = v24;
      *(_QWORD *)&v15->at.z = v25;
      *(_QWORD *)&v15->right.x = v19;
      *(_QWORD *)&v15->right.z = v20;
      *(_QWORD *)&v15->up.x = v21;
      *(_QWORD *)&v15->up.z = v22;
    }
    v26 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
    FxPrimBP_c::GetRWMatrix(this->m_bpPtr, v26);
    RwMatrixMultiply(v14, v26, v15);
    FxManager_c::FxRwMatrixDestroy(&g_fxMan, v26);
    m_particleCount = this->m_particleCount;
    v28 = (int)m_particleCount;
    if ( (int)m_particleCount >= 1 )
    {
      v29 = 0;
      do
      {
        FxPrtMult_c::FxPrtMult_c(&fxMults);
        FxEmitter_c::CreateParticle(
          this,
          &v31,
          v14,
          0,
          (float)((float)v29 * deltaTime) / this->m_particleCount,
          &fxMults,
          1.2,
          (*((_BYTE *)this->m_fxSysPtr + 102) & 2) != 0);
        m_particleCount = this->m_particleCount;
        ++v29;
        v28 = (int)m_particleCount;
      }
      while ( v29 < (int)m_particleCount );
    }
    this->m_particleCount = m_particleCount - (float)v28;
    FxManager_c::FxRwMatrixDestroy(&g_fxMan, v15);
    FxManager_c::FxRwMatrixDestroy(&g_fxMan, v14);
  }
}

//----- (00368CE8) --------------------------------------------------------
void __fastcall FxEmitter_c::Reset(FxEmitter_c *this)
{
  this->m_particleCount = 0.0;
}

//----- (00368CF0) --------------------------------------------------------
void __fastcall FxEmitter_c::AddParticle(
        FxEmitter_c *this,
        RwV3d_0 *pos,
        RwV3d_0 *vel,
        float timeSince,
        FxPrtMult_c *fxMults,
        float zRot,
        float brightness,
        bool8 createLocal)
{
  RwMatrix *v11; // r9
  RwMatrix *v12; // r11
  RwMatrix *v13; // r4
  RwMatrix *m_parentMat; // r2
  __int64 v15; // d16
  __int64 v16; // d17
  __int64 v17; // d20
  __int64 v18; // d21
  __int64 v19; // d23
  __int64 v20; // d18
  __int64 v21; // d19
  RwMatrix *v22; // r5
  Particle_c *v23; // r0
  EmissionInfo_t emissionInfo; // [sp+18h] [bp-A0h] BYREF

  FxInfoManager_c::ProcessEmissionInfo(
    &this->m_bpPtr->m_fxInfoMan,
    0.0,
    0.0,
    this->m_fxSysPtr->m_bpPtr->m_length,
    this->m_fxSysPtr->m_useConstTime,
    (int)&emissionInfo);
  v11 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  v12 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  v13 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  v13->right.x = 1.0;
  v13->right.y = 0.0;
  v13->up.x = 0.0;
  v13->up.y = 1.0;
  v13->right.z = 0.0;
  v13->up.z = 0.0;
  v13->at.x = 0.0;
  v13->at.y = 0.0;
  v13->at.z = 1.0;
  v13->pos.x = 0.0;
  v13->pos.y = 0.0;
  v13->pos.z = 0.0;
  v13->flags |= 0x20003u;
  v13->pos = *pos;
  RwMatrixUpdate(v13);
  m_parentMat = this->m_fxSysPtr->m_parentMat;
  if ( m_parentMat )
  {
    RwMatrixMultiply(v12, v13, m_parentMat);
  }
  else
  {
    v15 = *(_QWORD *)&v13->right.x;
    v16 = *(_QWORD *)&v13->right.z;
    v17 = *(_QWORD *)&v13->up.x;
    v18 = *(_QWORD *)&v13->up.z;
    v19 = *(_QWORD *)&v13->pos.z;
    v20 = *(_QWORD *)&v13->at.x;
    v21 = *(_QWORD *)&v13->at.z;
    *(_QWORD *)&v12->pos.x = *(_QWORD *)&v13->pos.x;
    *(_QWORD *)&v12->pos.z = v19;
    *(_QWORD *)&v12->at.x = v20;
    *(_QWORD *)&v12->at.z = v21;
    *(_QWORD *)&v12->right.x = v15;
    *(_QWORD *)&v12->right.z = v16;
    *(_QWORD *)&v12->up.x = v17;
    *(_QWORD *)&v12->up.z = v18;
  }
  v22 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  FxPrimBP_c::GetRWMatrix(this->m_bpPtr, v22);
  RwMatrixMultiply(v11, v22, v12);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v22);
  v23 = FxEmitter_c::CreateParticle(this, &emissionInfo, v11, vel, timeSince, fxMults, brightness, createLocal);
  if ( zRot >= 0.0 && v23 )
    BYTE2(v23[6].m_next) = (unsigned int)(float)(zRot * 0.5);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v13);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v12);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v11);
}

//----- (00368E74) --------------------------------------------------------
Particle_c *__fastcall FxEmitter_c::CreateParticle(
        FxEmitter_c *this,
        EmissionInfo_t *emissionInfo,
        RwMatrix *wldMat,
        RwV3d_0 *velOverride,
        float timeSince,
        FxPrtMult_c *fxMults,
        float brightness,
        bool8 createLocal)
{
  Particle_c *Particle; // r5
  float m_life; // s20
  float x; // s22
  int v14; // r0
  float y; // s2
  unsigned int v16; // s0
  int v17; // r0
  float v18; // s24
  float v19; // s0
  int m_next_high; // r0
  float v21; // s2
  float v22; // s24
  int v23; // r8
  float v24; // s26
  float v25; // s28
  float v26; // s30
  int v27; // r9
  float v28; // s17
  float z; // s19
  float v30; // s21
  int v31; // s0
  float v32; // s4
  RwV3d_0 *v33; // r0
  FxEmitter_c *v34; // r8
  float v35; // s6
  float v36; // s4
  float v37; // s2
  float v38; // s0
  float v39; // s24
  float v40; // s26
  float v41; // s28
  float v42; // s30
  float radius; // s0
  float v44; // s4
  float v45; // s4
  float v46; // s2
  float v47; // s0
  __int64 v48; // d16
  float v49; // s0
  float v50; // s4
  float v51; // s2
  float v52; // s2
  float v53; // s0
  float v54; // s8
  float v55; // s20
  float v56; // s0
  RwV3d_0 in; // [sp+10h] [bp-90h] BYREF
  RwV3d_0 vectorsOut; // [sp+1Ch] [bp-84h] BYREF
  RwV3d_0 vecRes; // [sp+28h] [bp-78h] BYREF
  RwV3d_0 vec; // [sp+34h] [bp-6Ch] BYREF

  Particle = FxManager_c::GetParticle(&g_fxMan, 0);
  if ( !Particle && (*((_BYTE *)this->m_fxSysPtr + 102) & 0x20) != 0 )
  {
    FxManager_c::FreeUpParticle(&g_fxMan);
    Particle = FxManager_c::GetParticle(&g_fxMan, 0);
  }
  if ( Particle )
  {
    m_life = fxMults->m_life;
    x = emissionInfo->life.x;
    v14 = rand();
    y = emissionInfo->life.y;
    Particle[1].m_next = 0;
    *(float *)&Particle[1].m_prev = m_life
                                  * (float)(x + (float)(y * (float)((float)((float)(v14 % 10000) * 0.0002) + -1.0)));
    Particle[5].m_prev = this->m_fxSysPtr;
    LOBYTE(Particle[5].m_next) = (unsigned int)(float)(fxMults->m_red * 255.0);
    BYTE1(Particle[5].m_next) = (unsigned int)(float)(fxMults->m_green * 255.0);
    BYTE2(Particle[5].m_next) = (unsigned int)(float)(fxMults->m_blue * 255.0);
    HIBYTE(Particle[5].m_next) = (unsigned int)(float)(fxMults->m_alpha * 255.0);
    LOBYTE(Particle[6].m_prev) = (unsigned int)(float)(fxMults->m_size * 255.0);
    v16 = (unsigned int)(float)(fxMults->m_rot * 255.0);
    HIBYTE(Particle[6].m_next) = createLocal;
    BYTE1(Particle[6].m_prev) = v16;
    BYTE2(Particle[6].m_prev) = (unsigned int)(float)((float)((float)((float)(rand() % 10000) * 0.0001) * 255.0) + 0.0);
    HIBYTE(Particle[6].m_prev) = (unsigned int)(float)((float)((float)((float)(rand() % 10000) * 0.0001) * 255.0) + 0.0);
    v17 = rand();
    BYTE1(Particle[6].m_next) = (unsigned int)(float)(brightness * 100.0);
    LOBYTE(Particle[6].m_next) = (unsigned int)(float)((float)((float)((float)(v17 % 10000) * 0.0001) * 255.0) + 0.0);
    v18 = emissionInfo->rot[0];
    v19 = (float)(rand() % 10000);
    m_next_high = HIBYTE(Particle[6].m_next);
    v21 = emissionInfo->rot[1] - emissionInfo->rot[0];
    BYTE2(Particle[6].m_next) = -1;
    *(float *)&Particle[7].m_prev = v18 + (float)(v21 * (float)((float)(v19 * 0.0001) + 0.0));
    if ( m_next_high )
      FxPrimBP_c::GetRWMatrix(this->m_bpPtr, wldMat);
    if ( fabsf(emissionInfo->radius) >= 0.001 )
    {
      v39 = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
      v40 = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
      v41 = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
      v42 = 1.0 / sqrtf((float)((float)(v39 * v39) + (float)(v40 * v40)) + (float)(v41 * v41));
      radius = emissionInfo->radius;
      if ( radius >= 0.0 )
      {
        v42 = v42 * (float)((float)((float)(rand() % 10000) * 0.0001) + 0.0);
        radius = emissionInfo->radius;
      }
      v44 = v42 * radius;
      v33 = velOverride;
      v34 = this;
      v38 = v41 * (float)(v42 * radius);
      v37 = v40 * v44;
      v36 = v39 * v44;
    }
    else
    {
      v22 = emissionInfo->sizeMin.x;
      v23 = rand();
      v24 = emissionInfo->sizeMin.x;
      v25 = emissionInfo->sizeMin.y;
      v26 = emissionInfo->sizeMax.x;
      v27 = rand();
      v28 = emissionInfo->sizeMin.y;
      z = emissionInfo->sizeMin.z;
      v30 = emissionInfo->sizeMax.y;
      v31 = v23 % 10000;
      v32 = (float)(rand() % 10000);
      v33 = velOverride;
      v34 = this;
      v35 = (float)(emissionInfo->sizeMax.z - emissionInfo->sizeMin.z) * (float)((float)(v32 * 0.0001) + 0.0);
      v36 = v22 + (float)((float)(v26 - v24) * (float)((float)((float)v31 * 0.0001) + 0.0));
      v37 = v25 + (float)((float)(v30 - v28) * (float)((float)((float)(v27 % 10000) * 0.0001) + 0.0));
      v38 = z + v35;
    }
    v45 = v36 + emissionInfo->pos.x;
    v46 = v37 + emissionInfo->pos.y;
    v47 = v38 + emissionInfo->pos.z;
    *(float *)&Particle[2].m_prev = (float)((float)(wldMat->pos.x + (float)(v45 * wldMat->right.x))
                                          + (float)(v46 * wldMat->up.x))
                                  + (float)(v47 * wldMat->at.x);
    *(float *)&Particle[2].m_next = (float)((float)(wldMat->pos.y + (float)(v45 * wldMat->right.y))
                                          + (float)(v46 * wldMat->up.y))
                                  + (float)(v47 * wldMat->at.y);
    *(float *)&Particle[3].m_prev = (float)((float)(wldMat->pos.z + (float)(v45 * wldMat->right.z))
                                          + (float)(v46 * wldMat->up.z))
                                  + (float)(v47 * wldMat->at.z);
    if ( v33 )
    {
      v48 = *(_QWORD *)&v33->x;
      Particle[4].m_next = (ListItem_c *)LODWORD(v33->z);
      v49 = *(float *)&Particle[4].m_next;
      *(_QWORD *)&Particle[3].m_next = v48;
      v50 = *(float *)&Particle[3].m_next;
      v51 = *(float *)&Particle[4].m_prev;
    }
    else
    {
      v52 = (float)((float)((float)((float)((float)(rand() % 10000) * 0.0001) * 6.2832) + 0.0) * 256.0) / 6.2832;
      v53 = (float)((float)((float)(emissionInfo->angle.x * 0.017453)
                          + (float)((float)((float)(rand() % 10000) * 0.0001)
                                  * (float)((float)(emissionInfo->angle.y * 0.017453)
                                          - (float)(emissionInfo->angle.x * 0.017453))))
                  * 256.0)
          / 6.2832;
      v54 = CMaths::ms_SinTable[(unsigned __int8)(unsigned int)v53];
      vec.x = v54 * CMaths::ms_SinTable[(unsigned __int8)(unsigned int)(float)(v52 + 64.0)];
      vec.y = CMaths::ms_SinTable[(unsigned __int8)(unsigned int)(float)(v53 + 64.0)];
      vec.z = v54 * CMaths::ms_SinTable[(unsigned __int8)(unsigned int)v52];
      if ( emissionInfo->dir.x <= 10.0 )
      {
        in = emissionInfo->dir;
        RwV3dNormalize(&in, &in);
      }
      else
      {
        in = *(RwV3d_0 *)&Particle[2].m_prev;
      }
      RwV3dTransformVectors(&vectorsOut, &in, 1, wldMat);
      RotateVecIntoVec(&vecRes, &vec, &vectorsOut);
      v55 = emissionInfo->speed.x;
      v56 = v55 + (float)(emissionInfo->speed.y * (float)((float)((float)(rand() % 10000) * 0.0002) + -1.0));
      v50 = vecRes.x * v56;
      v51 = vecRes.y * v56;
      v49 = vecRes.z * v56;
      *(float *)&Particle[3].m_next = v50;
      *(float *)&Particle[4].m_prev = v51;
      *(float *)&Particle[4].m_next = v49;
    }
    *(float *)&Particle[3].m_next = v34->m_fxSysPtr->m_velAdd.x + v50;
    *(float *)&Particle[4].m_prev = v34->m_fxSysPtr->m_velAdd.y + v51;
    *(float *)&Particle[4].m_next = v34->m_fxSysPtr->m_velAdd.z + v49;
    FxEmitterBP_c::UpdateParticle((FxEmitterBP_c *)v34->m_bpPtr, timeSince, (FxEmitterPrt_c *)Particle);
    List_c::AddItem(&v34->m_bpPtr->m_particleList, Particle);
  }
  return Particle;
}

//----- (0036955C) --------------------------------------------------------
void __fastcall FxEmitter_c::AddParticle(
        FxEmitter_c *this,
        RwMatrix *mat,
        RwV3d_0 *vel,
        float timeSince,
        FxPrtMult_c *fxMults,
        float zRot,
        float brightness,
        bool8 createLocal)
{
  RwMatrix *v11; // r9
  RwMatrix *v12; // r11
  RwMatrix *v13; // r4
  __int64 v14; // d16
  __int64 v15; // d17
  __int64 v16; // d18
  __int64 v17; // d19
  __int64 v18; // d20
  __int64 v19; // d21
  __int64 v20; // d23
  RwMatrix *m_parentMat; // r2
  __int64 v22; // d16
  __int64 v23; // d17
  __int64 v24; // d20
  __int64 v25; // d21
  __int64 v26; // d23
  __int64 v27; // d18
  __int64 v28; // d19
  RwMatrix *v29; // r5
  Particle_c *v30; // r0
  EmissionInfo_t emissionInfo; // [sp+18h] [bp-A0h] BYREF

  FxInfoManager_c::ProcessEmissionInfo(
    &this->m_bpPtr->m_fxInfoMan,
    0.0,
    0.0,
    this->m_fxSysPtr->m_bpPtr->m_length,
    this->m_fxSysPtr->m_useConstTime,
    (int)&emissionInfo);
  v11 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  v12 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  v13 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  v13->right.x = 1.0;
  v13->right.y = 0.0;
  v13->right.z = 0.0;
  v13->at.y = 0.0;
  v13->at.z = 1.0;
  v13->up.y = 1.0;
  v13->up.z = 0.0;
  v13->pos.y = 0.0;
  v13->pos.z = 0.0;
  v13->up.x = 0.0;
  v13->pos.x = 0.0;
  v13->at.x = 0.0;
  v13->flags |= 0x20003u;
  v14 = *(_QWORD *)&mat->right.x;
  v15 = *(_QWORD *)&mat->right.z;
  v16 = *(_QWORD *)&mat->up.x;
  v17 = *(_QWORD *)&mat->up.z;
  v18 = *(_QWORD *)&mat->pos.x;
  v19 = *(_QWORD *)&mat->pos.z;
  v20 = *(_QWORD *)&mat->at.z;
  *(_QWORD *)&v13->at.x = *(_QWORD *)&mat->at.x;
  *(_QWORD *)&v13->at.z = v20;
  *(_QWORD *)&v13->pos.x = v18;
  *(_QWORD *)&v13->pos.z = v19;
  *(_QWORD *)&v13->right.x = v14;
  *(_QWORD *)&v13->right.z = v15;
  *(_QWORD *)&v13->up.x = v16;
  *(_QWORD *)&v13->up.z = v17;
  RwMatrixUpdate(v13);
  m_parentMat = this->m_fxSysPtr->m_parentMat;
  if ( m_parentMat )
  {
    RwMatrixMultiply(v12, v13, m_parentMat);
  }
  else
  {
    v22 = *(_QWORD *)&v13->right.x;
    v23 = *(_QWORD *)&v13->right.z;
    v24 = *(_QWORD *)&v13->up.x;
    v25 = *(_QWORD *)&v13->up.z;
    v26 = *(_QWORD *)&v13->pos.z;
    v27 = *(_QWORD *)&v13->at.x;
    v28 = *(_QWORD *)&v13->at.z;
    *(_QWORD *)&v12->pos.x = *(_QWORD *)&v13->pos.x;
    *(_QWORD *)&v12->pos.z = v26;
    *(_QWORD *)&v12->at.x = v27;
    *(_QWORD *)&v12->at.z = v28;
    *(_QWORD *)&v12->right.x = v22;
    *(_QWORD *)&v12->right.z = v23;
    *(_QWORD *)&v12->up.x = v24;
    *(_QWORD *)&v12->up.z = v25;
  }
  TestMatrix(v12);
  v29 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  FxPrimBP_c::GetRWMatrix(this->m_bpPtr, v29);
  RwMatrixMultiply(v11, v29, v12);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v29);
  TestMatrix(v11);
  v30 = FxEmitter_c::CreateParticle(this, &emissionInfo, v11, vel, timeSince, fxMults, brightness, createLocal);
  if ( zRot >= 0.0 && v30 )
    BYTE2(v30[6].m_next) = (unsigned int)(float)(zRot * 0.5);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v13);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v12);
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v11);
}

//----- (00369714) --------------------------------------------------------
void __fastcall FxEmitter_c::~FxEmitter_c(FxEmitter_c *this)
{
  void *v1; // r0

  FxPrim_c::~FxPrim_c(this);
  sub_191374(v1);
}
// 369720: variable 'v1' is possibly undefined

//----- (00369730) --------------------------------------------------------
void __fastcall FindClosestPtOnLine(RwV3d_0 *res, RwV3d_0 *lineA, RwV3d_0 *lineB, RwV3d_0 *pt)
{
  float32x2_t v4; // d1
  float32x2_t v5; // d3
  float32x2_t v6; // d16
  float v7; // s4
  float32x2_t v8; // d17
  float32x2_t v9; // d16
  float32x2_t v10; // d4
  unsigned __int64 v11; // d5
  float v12; // s2

  v6.n64_u64[0] = *(unsigned __int64 *)&lineA->y;
  v7 = lineB->x - lineA->x;
  v8.n64_u64[0] = vsub_f32(*(float32x2_t *)&pt->y, v6).n64_u64[0];
  v9.n64_u64[0] = vsub_f32(*(float32x2_t *)&lineB->y, v6).n64_u64[0];
  v10.n64_u64[0] = vmul_f32(v9, v8).n64_u64[0];
  v11 = vmul_f32(v9, v9).n64_u64[0];
  v4.n64_f32[0] = (float)((float)(v7 * (float)(pt->x - lineA->x)) + v10.n64_f32[0]) + v10.n64_f32[1];
  v10.n64_u32[0] = 1.0;
  v4.n64_f32[0] = v4.n64_f32[0] / (float)((float)((float)(v7 * v7) + *(float *)&v11) + *((float *)&v11 + 1));
  v5.n64_u32[0] = 0;
  v12 = vmin_f32(vmax_f32(v4, v5), v10).n64_f32[0];
  res->x = lineA->x + (float)(v7 * v12);
  res->y = lineA->y + (float)((float)(lineB->y - lineA->y) * v12);
  res->z = lineA->z + (float)((float)(lineB->z - lineA->z) * v12);
}
// 369784: variable 'v4' is possibly undefined
// 369784: variable 'v5' is possibly undefined

//----- (003697D8) --------------------------------------------------------
FxInfo_c *__fastcall FxInfoManager_c::AddFxInfo(FxInfoManager_c *this, int32 type)
{
  uint8 *Mem; // r4
  __int16 v3; // r0
  __int16 v4; // r0
  int32 v5; // r1
  __int16 v6; // r0
  __int16 v7; // r0
  __int16 v8; // r0
  __int16 v9; // r0

  Mem = 0;
  if ( type < 8320 )
  {
    if ( type >= 4352 )
    {
      switch ( type )
      {
        case 8193:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665A7C;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 1;
          v3 = 8193;
          goto LABEL_57;
        case 8194:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665A94;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 3;
          v6 = 8194;
          goto LABEL_55;
        case 8195:
        case 8197:
        case 8198:
        case 8199:
        case 8201:
        case 8202:
        case 8203:
        case 8204:
        case 8205:
        case 8206:
        case 8207:
        case 8209:
        case 8210:
        case 8211:
        case 8212:
        case 8213:
        case 8214:
        case 8215:
        case 8216:
        case 8217:
        case 8218:
        case 8219:
        case 8220:
        case 8221:
        case 8222:
        case 8223:
        case 8225:
        case 8226:
        case 8227:
        case 8228:
        case 8229:
        case 8230:
        case 8231:
        case 8232:
        case 8233:
        case 8234:
        case 8235:
        case 8236:
        case 8237:
        case 8238:
        case 8239:
        case 8240:
        case 8241:
        case 8242:
        case 8243:
        case 8244:
        case 8245:
        case 8246:
        case 8247:
        case 8248:
        case 8249:
        case 8250:
        case 8251:
        case 8252:
        case 8253:
        case 8254:
        case 8255:
          return (FxInfo_c *)Mem;
        case 8196:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665AAC;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 1;
          v3 = 8196;
          goto LABEL_57;
        case 8200:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665AC4;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 4;
          v4 = 8200;
          goto LABEL_59;
        case 8208:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665ADC;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 7;
          v7 = 8208;
          goto LABEL_53;
        case 8224:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665AF4;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 3;
          v6 = 8224;
          goto LABEL_55;
        case 8256:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665B0C;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 1;
          v3 = 8256;
          goto LABEL_57;
        default:
          if ( type == 4352 )
          {
            Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
            *(_DWORD *)Mem = &off_665A4C;
            FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
            v4 = 4352;
            Mem[14] = 4;
            goto LABEL_59;
          }
          if ( type != 4608 )
            return (FxInfo_c *)Mem;
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665A64;
          FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
          Mem[14] = 2;
          v8 = 4608;
          break;
      }
LABEL_45:
      *((_WORD *)Mem + 2) = v8;
      v5 = 8;
    }
    else
    {
      switch ( type )
      {
        case 4097:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_6659A4;
          FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
          Mem[14] = 1;
          v3 = 4097;
          goto LABEL_57;
        case 4098:
        case 4099:
        case 4101:
        case 4102:
        case 4103:
        case 4105:
        case 4106:
        case 4107:
        case 4108:
        case 4109:
        case 4110:
        case 4111:
        case 4113:
        case 4114:
        case 4115:
        case 4116:
        case 4117:
        case 4118:
        case 4119:
        case 4120:
        case 4121:
        case 4122:
        case 4123:
        case 4124:
        case 4125:
        case 4126:
        case 4127:
          return (FxInfo_c *)Mem;
        case 4100:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_6659BC;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 7;
          v7 = 4100;
          goto LABEL_53;
        case 4104:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_6659D4;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 2;
          v8 = 4104;
          goto LABEL_45;
        case 4112:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_6659EC;
          FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
          Mem[14] = 3;
          v6 = 4112;
          break;
        case 4128:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665A04;
          FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
          Mem[14] = 2;
          v8 = 4128;
          goto LABEL_45;
        default:
          if ( type == 4160 )
          {
            Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
            *(_DWORD *)Mem = &off_665A1C;
            FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
            Mem[14] = 2;
            v8 = 4160;
            goto LABEL_45;
          }
          if ( type != 4224 )
            return (FxInfo_c *)Mem;
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665A34;
          FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
          Mem[14] = 3;
          v6 = 4224;
          break;
      }
LABEL_55:
      *((_WORD *)Mem + 2) = v6;
      v5 = 12;
    }
    goto LABEL_60;
  }
  if ( type >= 16512 )
  {
    if ( type < 16896 )
    {
      if ( type == 16512 )
      {
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665C2C;
        FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
        Mem[14] = 1;
        v3 = 16512;
        goto LABEL_57;
      }
      if ( type != 16640 )
        return (FxInfo_c *)Mem;
      Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
      *(_DWORD *)Mem = &off_665C44;
      FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
      Mem[14] = 7;
      v7 = 16640;
LABEL_53:
      *((_WORD *)Mem + 2) = v7;
      v5 = 28;
    }
    else
    {
      switch ( type )
      {
        case 16896:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665C5C;
          FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
          Mem[14] = 0;
          *((_WORD *)Mem + 2) = 16896;
          return (FxInfo_c *)Mem;
        case 17408:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665C74;
          FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
          v5 = 20;
          Mem[14] = 5;
          v9 = 17408;
LABEL_47:
          *((_WORD *)Mem + 2) = v9;
          break;
        case 32769:
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665C8C;
          FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
          v5 = 32;
          Mem[14] = 8;
          *((_WORD *)Mem + 2) = -32767;
          break;
        default:
          return (FxInfo_c *)Mem;
      }
    }
LABEL_60:
    *((_DWORD *)Mem + 5) = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, v5, 4);
    return (FxInfo_c *)Mem;
  }
  if ( type >= 9216 )
  {
    switch ( type )
    {
      case 16385:
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665B84;
        FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
        Mem[14] = 4;
        v4 = 16385;
        goto LABEL_59;
      case 16386:
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665B9C;
        FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
        Mem[14] = 4;
        v4 = 16386;
        goto LABEL_59;
      case 16387:
      case 16389:
      case 16390:
      case 16391:
      case 16393:
      case 16394:
      case 16395:
      case 16396:
      case 16397:
      case 16398:
      case 16399:
      case 16401:
      case 16402:
      case 16403:
      case 16404:
      case 16405:
      case 16406:
      case 16407:
      case 16408:
      case 16409:
      case 16410:
      case 16411:
      case 16412:
      case 16413:
      case 16414:
      case 16415:
      case 16417:
      case 16418:
      case 16419:
      case 16420:
      case 16421:
      case 16422:
      case 16423:
      case 16424:
      case 16425:
      case 16426:
      case 16427:
      case 16428:
      case 16429:
      case 16430:
      case 16431:
      case 16432:
      case 16433:
      case 16434:
      case 16435:
      case 16436:
      case 16437:
      case 16438:
      case 16439:
      case 16440:
      case 16441:
      case 16442:
      case 16443:
      case 16444:
      case 16445:
      case 16446:
      case 16447:
        return (FxInfo_c *)Mem;
      case 16388:
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665BB4;
        FxInterpInfo255_c::FxInterpInfo255_c((FxInterpInfo255_c *)(Mem + 8));
        Mem[14] = 4;
        v4 = 16388;
        goto LABEL_59;
      case 16392:
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665BCC;
        FxInterpInfo255_c::FxInterpInfo255_c((FxInterpInfo255_c *)(Mem + 8));
        Mem[14] = 0;
        *((_WORD *)Mem + 2) = 16392;
        break;
      case 16400:
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665BE4;
        FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
        Mem[14] = 2;
        v8 = 16400;
        goto LABEL_45;
      case 16416:
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665BFC;
        FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
        v5 = 36;
        Mem[14] = 9;
        v9 = 16416;
        goto LABEL_47;
      case 16448:
        Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
        *(_DWORD *)Mem = &off_665C14;
        FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
        Mem[14] = 3;
        v6 = 16448;
        goto LABEL_55;
      default:
        if ( type == 9216 )
        {
          Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
          *(_DWORD *)Mem = &off_665B6C;
          FxInterpInfoU255_c::FxInterpInfoU255_c((FxInterpInfoU255_c *)(Mem + 8));
          Mem[14] = 0;
          *((_WORD *)Mem + 2) = 9216;
        }
        break;
    }
    return (FxInfo_c *)Mem;
  }
  switch ( type )
  {
    case 8320:
      Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
      *(_DWORD *)Mem = &off_665B24;
      FxInterpInfo32_c::FxInterpInfo32_c((FxInterpInfo32_c *)(Mem + 8));
      Mem[14] = 1;
      v3 = 8320;
LABEL_57:
      *((_WORD *)Mem + 2) = v3;
      v5 = 4;
      goto LABEL_60;
    case 8448:
      Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
      *(_DWORD *)Mem = &off_665B3C;
      FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
      Mem[14] = 4;
      v4 = 8448;
LABEL_59:
      *((_WORD *)Mem + 2) = v4;
      v5 = 16;
      goto LABEL_60;
    case 8704:
      Mem = FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 24, 4);
      *(_DWORD *)Mem = &off_665B54;
      FxInterpInfoFloat_c::FxInterpInfoFloat_c((FxInterpInfoFloat_c *)(Mem + 8));
      Mem[14] = 0;
      *((_WORD *)Mem + 2) = 8704;
      break;
  }
  return (FxInfo_c *)Mem;
}
// 6659A4: using guessed type void *off_6659A4;
// 6659BC: using guessed type void *off_6659BC;
// 6659D4: using guessed type void *off_6659D4;
// 6659EC: using guessed type void *off_6659EC;
// 665A04: using guessed type void *off_665A04;
// 665A1C: using guessed type void *off_665A1C;
// 665A34: using guessed type void *off_665A34;
// 665A4C: using guessed type void *off_665A4C;
// 665A64: using guessed type void *off_665A64;
// 665A7C: using guessed type void *off_665A7C;
// 665A94: using guessed type void *off_665A94;
// 665AAC: using guessed type void *off_665AAC;
// 665AC4: using guessed type void *off_665AC4;
// 665ADC: using guessed type void *off_665ADC;
// 665AF4: using guessed type void *off_665AF4;
// 665B0C: using guessed type void *off_665B0C;
// 665B24: using guessed type void *off_665B24;
// 665B3C: using guessed type void *off_665B3C;
// 665B54: using guessed type void *off_665B54;
// 665B6C: using guessed type void *off_665B6C;
// 665B84: using guessed type void *off_665B84;
// 665B9C: using guessed type void *off_665B9C;
// 665BB4: using guessed type void *off_665BB4;
// 665BCC: using guessed type void *off_665BCC;
// 665BE4: using guessed type void *off_665BE4;
// 665BFC: using guessed type void *off_665BFC;
// 665C14: using guessed type void *off_665C14;
// 665C2C: using guessed type void *off_665C2C;
// 665C44: using guessed type void *off_665C44;
// 665C5C: using guessed type void *off_665C5C;
// 665C74: using guessed type void *off_665C74;
// 665C8C: using guessed type void *off_665C8C;

//----- (0036A190) --------------------------------------------------------
void __fastcall FxInfoManager_c::ProcessEmissionInfo(
        FxInfoManager_c *this,
        float st,
        float dt,
        float len,
        int a5,
        int a6)
{
  int m_movementOffset; // r1
  int v11; // r5
  FxInfo_c *v12; // r0

  *(_DWORD *)(a6 + 92) = 0x40000000;
  *(_DWORD *)(a6 + 96) = 0;
  *(_DWORD *)(a6 + 100) = 0x40000000;
  *(_QWORD *)(a6 + 32) = 0LL;
  *(_QWORD *)(a6 + 40) = 0LL;
  *(_QWORD *)(a6 + 20) = 0LL;
  *(_QWORD *)(a6 + 28) = 0LL;
  *(_QWORD *)(a6 + 4) = 0LL;
  *(_QWORD *)(a6 + 12) = 0LL;
  *(_QWORD *)(a6 + 48) = 1065353216LL;
  *(_QWORD *)(a6 + 56) = 0x3F80000000000000LL;
  *(_QWORD *)(a6 + 64) = 0LL;
  *(_QWORD *)(a6 + 72) = 0LL;
  *(_QWORD *)(a6 + 76) = 0LL;
  *(_QWORD *)(a6 + 84) = 0LL;
  *(float *)a6 = dt * 10.0;
  m_movementOffset = this->m_movementOffset;
  if ( m_movementOffset >= 1 )
  {
    v11 = 0;
    do
    {
      v12 = this->m_fxInfoPtrs[v11];
      if ( (v12->m_type & 0x1000) != 0 )
      {
        (*((void (__fastcall **)(FxInfo_c *, _DWORD, _DWORD, _DWORD, _DWORD, int, int))v12->_vptr$FxInfo_c + 3))(
          v12,
          LODWORD(st),
          0,
          LODWORD(dt),
          LODWORD(len),
          a5,
          a6);
        LOBYTE(m_movementOffset) = this->m_movementOffset;
      }
      ++v11;
    }
    while ( v11 < (char)m_movementOffset );
  }
}

//----- (0036A260) --------------------------------------------------------
void __fastcall FxInfoManager_c::ProcessMovementInfo(
        FxInfoManager_c *this,
        float st,
        float pt,
        float dt,
        float len,
        int useConst,
        MovementInfo_t *movementInfo)
{
  int m_renderOffset; // r1
  int m_movementOffset; // r5
  FxInfo_c *v13; // r0

  *(_WORD *)&movementInfo->hasFloatInfo = 0;
  *(_QWORD *)movementInfo->rot = 0LL;
  *(_QWORD *)&movementInfo->rot[2] = 0LL;
  m_renderOffset = this->m_renderOffset;
  m_movementOffset = this->m_movementOffset;
  if ( m_movementOffset < m_renderOffset )
  {
    do
    {
      v13 = this->m_fxInfoPtrs[m_movementOffset];
      if ( (v13->m_type & 0x2000) != 0 )
      {
        (*((void (__fastcall **)(FxInfo_c *, _DWORD, _DWORD, _DWORD, _DWORD, int, MovementInfo_t *))v13->_vptr$FxInfo_c
         + 3))(
          v13,
          LODWORD(st),
          LODWORD(pt),
          LODWORD(dt),
          LODWORD(len),
          useConst,
          movementInfo);
        LOBYTE(m_renderOffset) = this->m_renderOffset;
      }
      ++m_movementOffset;
    }
    while ( m_movementOffset < (char)m_renderOffset );
  }
}

//----- (0036A2E0) --------------------------------------------------------
void __fastcall FxInfoManager_c::ProcessRenderInfo(
        FxInfoManager_c *this,
        float st,
        float pt,
        float dt,
        float len,
        int useConst,
        RenderInfo_t *renderInfo)
{
  int32 m_numFxInfos; // r1
  int32 m_renderOffset; // r6
  FxInfo_c *v13; // r0

  renderInfo->colId = 0;
  renderInfo->colour = (RwRGBA_0)-1;
  renderInfo->hasHeatHaze = 0;
  renderInfo->isSelfLit = 0;
  renderInfo->isFlat = 0;
  renderInfo->hasAnimTextures = 0;
  renderInfo->trailId = 0;
  renderInfo->hasDir = 0;
  renderInfo->useVel = 0;
  renderInfo->smokeType = -1;
  renderInfo->size = (RwV2d_0)0x3DCCCCCD3DCCCCCDLL;
  renderInfo->sizeBias = 0LL;
  *(_QWORD *)&renderInfo->spriteRect.x = 0xBF0000003F000000LL;
  *(_QWORD *)&renderInfo->spriteRect.z = 0xBF0000003F000000LL;
  m_numFxInfos = this->m_numFxInfos;
  m_renderOffset = this->m_renderOffset;
  if ( this->m_numFxInfos > m_renderOffset )
  {
    do
    {
      v13 = this->m_fxInfoPtrs[m_renderOffset];
      if ( v13->m_type >= 0x4000u )
      {
        (*((void (__fastcall **)(FxInfo_c *, _DWORD, _DWORD, _DWORD, _DWORD, int, RenderInfo_t *))v13->_vptr$FxInfo_c + 3))(
          v13,
          LODWORD(st),
          LODWORD(pt),
          LODWORD(dt),
          LODWORD(len),
          useConst,
          renderInfo);
        m_numFxInfos = this->m_numFxInfos;
      }
      ++m_renderOffset;
    }
    while ( m_renderOffset < m_numFxInfos );
  }
}

//----- (0036A3B0) --------------------------------------------------------
void __fastcall FxInfoEmRate_c::FxInfoEmRate_c(FxInfoEmRate_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659A4;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 1;
  this->m_type = 4097;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 4, 4);
}
// 6659A4: using guessed type void *;

//----- (0036A3F0) --------------------------------------------------------
void __fastcall FxInfoEmRate_c::Load(FxInfoEmRate_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036A3F6) --------------------------------------------------------
void __fastcall FxInfoEmRate_c::GetValue(
        FxInfoEmRate_c *this,
        float st,
        float pt,
        float dt,
        float len,
        int useConst,
        void *settings)
{
  FxInterpInfoFloat_c *p_m_interpInfo; // r5
  float v10[24]; // [sp+0h] [bp-60h] BYREF

  p_m_interpInfo = &this->m_interpInfo;
  FxInterpInfoFloat_c::GetVal(&this->m_interpInfo, v10, st);
  if ( useConst )
  {
    *(float *)settings = v10[0] * dt;
  }
  else if ( (float)(st - dt) >= 0.0 )
  {
    *(float *)settings = FxInterpInfoFloat_c::GetVal(p_m_interpInfo, 0, st, dt);
  }
  else
  {
    *(float *)settings = FxInterpInfoFloat_c::GetVal(p_m_interpInfo, 0, len, -(float)(st - dt));
    *(float *)settings = FxInterpInfoFloat_c::GetVal(p_m_interpInfo, 0, st, (float)(st - dt) + dt) + *(float *)settings;
  }
}
// 36A3F6: using guessed type float var_60[24];

//----- (0036A49C) --------------------------------------------------------
void __fastcall FxInfoEmSize_c::FxInfoEmSize_c(FxInfoEmSize_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659BC;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 7;
  this->m_type = 4100;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 28, 4);
}
// 6659BC: using guessed type void *;

//----- (0036A4DC) --------------------------------------------------------
void __fastcall FxInfoEmSize_c::Load(FxInfoEmSize_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036A4E2) --------------------------------------------------------
void __fastcall FxInfoEmSize_c::GetValue(
        FxInfoEmSize_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  float v7; // r2
  float v8; // r12
  float v9; // r3
  float v10; // lr
  float v11; // r4
  float v12; // r5
  float v13[18]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfo32_c::GetVal(&this->m_interpInfo, v13, st);
  v7 = v13[1];
  v8 = v13[2];
  v9 = v13[3];
  v10 = v13[4];
  v11 = v13[5];
  v12 = v13[6];
  *((float *)settings + 1) = v13[0];
  *((float *)settings + 2) = v7;
  *((float *)settings + 3) = v9;
  *((float *)settings + 4) = v11;
  *((float *)settings + 5) = v8;
  *((float *)settings + 6) = v10;
  *((float *)settings + 7) = v12;
}

//----- (0036A518) --------------------------------------------------------
void __fastcall FxInfoEmSpeed_c::FxInfoEmSpeed_c(FxInfoEmSpeed_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659D4;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 2;
  this->m_type = 4104;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 8, 4);
}
// 6659D4: using guessed type void *;

//----- (0036A558) --------------------------------------------------------
void __fastcall FxInfoEmSpeed_c::Load(FxInfoEmSpeed_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036A55E) --------------------------------------------------------
void __fastcall FxInfoEmSpeed_c::GetValue(
        FxInfoEmSpeed_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  float v7; // r2
  float v8[18]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfo32_c::GetVal(&this->m_interpInfo, v8, st);
  v7 = v8[1];
  *((float *)settings + 8) = v8[0];
  *((float *)settings + 9) = v7;
}
// 36A55E: using guessed type float var_48[18];

//----- (0036A57C) --------------------------------------------------------
void __fastcall FxInfoEmDir_c::FxInfoEmDir_c(FxInfoEmDir_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659EC;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 3;
  this->m_type = 4112;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 12, 4);
}
// 6659EC: using guessed type void *;

//----- (0036A5BC) --------------------------------------------------------
void __fastcall FxInfoEmDir_c::Load(FxInfoEmDir_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036A5C2) --------------------------------------------------------
void __fastcall FxInfoEmDir_c::GetValue(
        FxInfoEmDir_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  float v7; // r2
  float v8; // r3
  float v9[18]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfo32_c::GetVal(&this->m_interpInfo, v9, st);
  v7 = v9[1];
  v8 = v9[2];
  *((float *)settings + 10) = v9[0];
  *((float *)settings + 11) = v7;
  *((float *)settings + 12) = v8;
}

//----- (0036A5E0) --------------------------------------------------------
void __fastcall FxInfoEmAngle_c::FxInfoEmAngle_c(FxInfoEmAngle_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A04;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 2;
  this->m_type = 4128;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 8, 4);
}
// 665A04: using guessed type void *;

//----- (0036A620) --------------------------------------------------------
void __fastcall FxInfoEmAngle_c::Load(FxInfoEmAngle_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036A626) --------------------------------------------------------
void __fastcall FxInfoEmAngle_c::GetValue(
        FxInfoEmAngle_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  float v7; // r2
  float v8[18]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfoFloat_c::GetVal(&this->m_interpInfo, v8, st);
  v7 = v8[1];
  *((float *)settings + 13) = v8[0];
  *((float *)settings + 14) = v7;
}
// 36A626: using guessed type float var_48[18];

//----- (0036A644) --------------------------------------------------------
void __fastcall FxInfoEmLife_c::FxInfoEmLife_c(FxInfoEmLife_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A1C;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 2;
  this->m_type = 4160;
  this->m_interpInfo.m_keys = (uint16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 8, 4);
}
// 665A1C: using guessed type void *;

//----- (0036A684) --------------------------------------------------------
void __fastcall FxInfoEmLife_c::Load(FxInfoEmLife_c *this, u_native fileId, int32 version)
{
  sub_190B20(&this->m_interpInfo, fileId);
}

//----- (0036A68A) --------------------------------------------------------
void __fastcall FxInfoEmLife_c::GetValue(
        FxInfoEmLife_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  float v7; // r2
  float v8[18]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfoU255_c::GetVal(&this->m_interpInfo, v8, st);
  v7 = v8[1];
  *((float *)settings + 15) = v8[0];
  *((float *)settings + 16) = v7;
}
// 36A68A: using guessed type float var_48[18];

//----- (0036A6A8) --------------------------------------------------------
void __fastcall FxInfoEmPos_c::FxInfoEmPos_c(FxInfoEmPos_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A34;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 3;
  this->m_type = 4224;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 12, 4);
}
// 665A34: using guessed type void *;

//----- (0036A6E8) --------------------------------------------------------
void __fastcall FxInfoEmPos_c::Load(FxInfoEmPos_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036A6EE) --------------------------------------------------------
void __fastcall FxInfoEmPos_c::GetValue(
        FxInfoEmPos_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  float v7; // r2
  float v8; // r3
  float v9[18]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfoFloat_c::GetVal(&this->m_interpInfo, v9, st);
  v7 = v9[1];
  v8 = v9[2];
  *((float *)settings + 17) = v9[0];
  *((float *)settings + 18) = v7;
  *((float *)settings + 19) = v8;
}

//----- (0036A70C) --------------------------------------------------------
void __fastcall FxInfoEmWeather_c::FxInfoEmWeather_c(FxInfoEmWeather_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A4C;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 4;
  this->m_type = 4352;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 16, 4);
}
// 665A4C: using guessed type void *;

//----- (0036A74C) --------------------------------------------------------
void __fastcall FxInfoEmWeather_c::Load(FxInfoEmWeather_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036A752) --------------------------------------------------------
void __fastcall FxInfoEmWeather_c::GetValue(
        FxInfoEmWeather_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  __int64 v7; // d17
  _QWORD v8[9]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfoFloat_c::GetVal(&this->m_interpInfo, (float *)v8, st);
  v7 = v8[1];
  *((_QWORD *)settings + 11) = v8[0];
  *((_QWORD *)settings + 12) = v7;
}

//----- (0036A774) --------------------------------------------------------
void __fastcall FxInfoEmRotation_c::FxInfoEmRotation_c(FxInfoEmRotation_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A64;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 2;
  this->m_type = 4608;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 8, 4);
}
// 665A64: using guessed type void *;

//----- (0036A7B4) --------------------------------------------------------
void __fastcall FxInfoEmRotation_c::Load(FxInfoEmRotation_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036A7BA) --------------------------------------------------------
void __fastcall FxInfoEmRotation_c::GetValue(
        FxInfoEmRotation_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  float v7; // r2
  float v8[18]; // [sp+0h] [bp-48h] BYREF

  FxInterpInfoFloat_c::GetVal(&this->m_interpInfo, v8, st);
  v7 = v8[1];
  *((float *)settings + 20) = v8[0];
  *((float *)settings + 21) = v7;
}
// 36A7BA: using guessed type float var_48[18];

//----- (0036A7D8) --------------------------------------------------------
void __fastcall FxInfoNoise_c::FxInfoNoise_c(FxInfoNoise_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A7C;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 1;
  this->m_type = 8193;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 4, 4);
}
// 665A7C: using guessed type void *;

//----- (0036A818) --------------------------------------------------------
void __fastcall FxInfoNoise_c::Load(FxInfoNoise_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036A820) --------------------------------------------------------
void __fastcall FxInfoNoise_c::GetValue(
        FxInfoNoise_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        const RwV3d_0 *lena)
{
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v10; // s0
  float v13; // s16
  RwReal v14; // s2
  RwReal v15; // s4
  RwReal v16; // s2
  RwReal v17; // s4
  RwV3d_0 in; // [sp+4h] [bp-6Ch] BYREF
  float values[24]; // [sp+10h] [bp-60h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, values, pt);
  in.x = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
  in.y = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
  in.z = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
  RwV3dNormalize(&in, &in);
  in.x = in.x * (float)(values[0] * dt);
  in.y = (float)(values[0] * dt) * in.y;
  in.z = in.z * (float)(values[0] * dt);
  v13 = RwV3dLength(lena + 1);
  v14 = lena[1].y + in.y;
  v15 = lena[1].z + in.z;
  lena[1].x = lena[1].x + in.x;
  lena[1].y = v14;
  lena[1].z = v15;
  if ( RwV3dLength(lena + 1) > 0.0 )
    RwV3dNormalize((RwV3d_0 *)&lena[1], lena + 1);
  v16 = v13 * lena[1].y;
  v17 = v13 * lena[1].z;
  lena[1].x = v13 * lena[1].x;
  lena[1].y = v16;
  lena[1].z = v17;
}
// 36A820: using guessed type float values[24];

//----- (0036A9A4) --------------------------------------------------------
void __fastcall FxInfoForce_c::FxInfoForce_c(FxInfoForce_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A94;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 3;
  this->m_type = 8194;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 12, 4);
}
// 665A94: using guessed type void *;

//----- (0036A9E4) --------------------------------------------------------
void __fastcall FxInfoForce_c::Load(FxInfoForce_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036A9EA) --------------------------------------------------------
void __fastcall FxInfoForce_c::GetValue(
        FxInfoForce_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v10; // s0
  float v13; // s8
  float v14; // s4
  float v15; // s6
  float v16[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, v16, pt);
  v13 = *((float *)settings + 5);
  v14 = *((float *)settings + 4) + (float)(v16[1] * dt);
  v15 = v16[2];
  *((float *)settings + 3) = *((float *)settings + 3) + (float)(v16[0] * dt);
  *((float *)settings + 4) = v14;
  *((float *)settings + 5) = v13 + (float)(v15 * dt);
}

//----- (0036AA60) --------------------------------------------------------
void __fastcall FxInfoFriction_c::FxInfoFriction_c(FxInfoFriction_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AAC;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 1;
  this->m_type = 8196;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 4, 4);
}
// 665AAC: using guessed type void *;

//----- (0036AAA0) --------------------------------------------------------
void __fastcall FxInfoFriction_c::Load(FxInfoFriction_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036AAA8) --------------------------------------------------------
void __fastcall FxInfoFriction_c::GetValue(
        FxInfoFriction_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v10; // s0
  float v13; // r0
  float v14; // s2
  float v15; // s4
  float x[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, x, pt);
  v13 = powf(x[0], dt * 50.0);
  v14 = v13 * *((float *)settings + 4);
  v15 = v13 * *((float *)settings + 5);
  *((float *)settings + 3) = v13 * *((float *)settings + 3);
  *((float *)settings + 4) = v14;
  *((float *)settings + 5) = v15;
}
// 36AAA8: using guessed type float x[18];

//----- (0036AB20) --------------------------------------------------------
void __fastcall FxInfoAttractPt_c::FxInfoAttractPt_c(FxInfoAttractPt_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AC4;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 4;
  this->m_type = 8200;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 16, 4);
}
// 665AC4: using guessed type void *;

//----- (0036AB60) --------------------------------------------------------
void __fastcall FxInfoAttractPt_c::Load(FxInfoAttractPt_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036AB68) --------------------------------------------------------
void __fastcall FxInfoAttractPt_c::GetValue(
        FxInfoAttractPt_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        float *lena)
{
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v10; // s0
  float v13; // s8
  float v14; // s10
  float v15; // s16
  float v16; // s4
  float v17; // s0
  RwV3d_0 in; // [sp+4h] [bp-5Ch] BYREF
  float values[20]; // [sp+10h] [bp-50h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, values, pt);
  v13 = lena[1];
  v14 = lena[2];
  in.x = values[0] - *lena;
  in.y = values[1] - v13;
  in.z = values[2] - v14;
  v15 = RwV3dLength(&in);
  if ( v15 > 0.0 )
    RwV3dNormalize(&in, &in);
  if ( v15 > 0.1 )
  {
    in.x = in.x * (float)(values[0] * dt);
    in.y = (float)(values[0] * dt) * in.y;
    in.z = in.z * (float)(values[0] * dt);
    v16 = lena[4] + in.y;
    v17 = lena[5] + in.z;
    lena[3] = lena[3] + in.x;
    lena[4] = v16;
    lena[5] = v17;
  }
}

//----- (0036AC58) --------------------------------------------------------
void __fastcall FxInfoAttractLine_c::FxInfoAttractLine_c(FxInfoAttractLine_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665ADC;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 7;
  this->m_type = 8208;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 28, 4);
}
// 665ADC: using guessed type void *;

//----- (0036AC98) --------------------------------------------------------
void __fastcall FxInfoAttractLine_c::Load(FxInfoAttractLine_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036ACA0) --------------------------------------------------------
void __fastcall FxInfoAttractLine_c::GetValue(
        FxInfoAttractLine_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        float *lena)
{
  float32x2_t v7; // d8
  float32x2_t v8; // d9
  float32x2_t v9; // d10
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v13; // s0
  float v16; // s10
  float v17; // s12
  float v18; // s16
  RwReal v19; // s0
  float v20; // s16
  float v21; // s4
  float v22; // s0
  RwV3d_0 in; // [sp+4h] [bp-6Ch] BYREF
  float values; // [sp+10h] [bp-60h] BYREF
  float v25; // [sp+14h] [bp-5Ch]
  float v26; // [sp+18h] [bp-58h]
  float v27; // [sp+1Ch] [bp-54h]
  float v28; // [sp+20h] [bp-50h]
  float v29; // [sp+24h] [bp-4Ch]
  float v30; // [sp+28h] [bp-48h]

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v13 = st / len;
  if ( !m_timeModeParticle )
    pt = v13;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, &values, pt);
  v9.n64_u32[0] = 1.0;
  v16 = lena[1];
  v17 = lena[2];
  v8.n64_u32[0] = 0;
  v7.n64_f32[0] = (float)((float)((float)((float)(v27 - values) * (float)(*lena - values))
                                + (float)((float)(v28 - v25) * (float)(v16 - v25)))
                        + (float)((float)(v29 - v26) * (float)(v17 - v26)))
                / (float)((float)((float)((float)(v27 - values) * (float)(v27 - values))
                                + (float)((float)(v28 - v25) * (float)(v28 - v25)))
                        + (float)((float)(v29 - v26) * (float)(v29 - v26)));
  v18 = vmin_f32(vmax_f32(v7, v8), v9).n64_f32[0];
  v19 = (float)(values + (float)((float)(v27 - values) * v18)) - *lena;
  in.y = (float)(v25 + (float)((float)(v28 - v25) * v18)) - v16;
  in.x = v19;
  in.z = (float)(v26 + (float)((float)(v29 - v26) * v18)) - v17;
  v20 = RwV3dLength(&in);
  if ( v20 > 0.0 )
    RwV3dNormalize(&in, &in);
  if ( v20 > 0.1 )
  {
    in.x = in.x * (float)(v30 * dt);
    in.y = (float)(v30 * dt) * in.y;
    in.z = in.z * (float)(v30 * dt);
    v21 = lena[4] + in.y;
    v22 = lena[5] + in.z;
    lena[3] = lena[3] + in.x;
    lena[4] = v21;
    lena[5] = v22;
  }
}
// 36AD46: variable 'v7' is possibly undefined
// 36AD46: variable 'v8' is possibly undefined
// 36AD4A: variable 'v9' is possibly undefined

//----- (0036AE0C) --------------------------------------------------------
void __fastcall FxInfoGroundCollide_c::FxInfoGroundCollide_c(FxInfoGroundCollide_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AF4;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 3;
  this->m_type = 8224;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 12, 4);
}
// 665AF4: using guessed type void *;

//----- (0036AE4C) --------------------------------------------------------
void __fastcall FxInfoGroundCollide_c::Load(FxInfoGroundCollide_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036AE54) --------------------------------------------------------
void __fastcall FxInfoGroundCollide_c::GetValue(
        FxInfoGroundCollide_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        int lena)
{
  int m_timeModeParticle; // r3
  RwReal z; // s16
  float x; // s22
  float y; // s24
  float v14; // s26
  float v15; // s0
  float v16; // s2
  float v17; // s4
  float v18; // s18
  float v19; // s6
  float v20; // s6
  float v21; // s0
  float v22; // r5
  float v23; // s8
  float v24; // s6
  float v25; // s0
  RwV3d_0 in; // [sp+1Ch] [bp-D4h] BYREF
  RwV3d_0 v27; // [sp+28h] [bp-C8h] BYREF
  float values[16]; // [sp+34h] [bp-BCh] BYREF
  CEntity *refEntityPtr; // [sp+74h] [bp-7Ch] BYREF
  CColPoint colPoint; // [sp+78h] [bp-78h] BYREF
  CVector vecStart; // [sp+A4h] [bp-4Ch] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  *(_QWORD *)&vecStart.x = *(_QWORD *)lena;
  vecStart.z = *(RwReal *)(lena + 8);
  if ( !m_timeModeParticle )
    pt = st / len;
  if ( CWorld::ProcessVerticalLine(
         &vecStart,
         vecStart.z - *(float *)(lena + 20),
         &colPoint,
         &refEntityPtr,
         1,
         0,
         0,
         0,
         0,
         0,
         0) )
  {
    z = colPoint.m_vecPosition.z;
    if ( colPoint.m_vecPosition.z <= vecStart.z && *(float *)(lena + 8) < colPoint.m_vecPosition.z )
    {
      x = colPoint.m_vecNormal.x;
      y = colPoint.m_vecNormal.y;
      v14 = colPoint.m_vecNormal.z;
      FxInterpInfo32_c::GetVal(&this->m_interpInfo, values, pt);
      v15 = *(float *)(lena + 12);
      v16 = *(float *)(lena + 16);
      v17 = *(float *)(lena + 20);
      v18 = values[1];
      v19 = (float)(v14 * v17) + (float)((float)(y * v16) + (float)(x * v15));
      v20 = values[0] * (float)(v19 + v19);
      v27.x = v15 - (float)(x * v20);
      v27.y = v16 - (float)(y * v20);
      v27.z = v17 - (float)(v14 * v20);
      in.x = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
      in.y = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
      in.z = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
      RwV3dNormalize(&in, &in);
      v21 = (float)(values[2] * dt) * 5.0;
      in.z = in.z * v21;
      in.x = in.x * v21;
      in.y = in.y * v21;
      v22 = RwV3dLength(&v27);
      v27.x = v27.x + in.x;
      v27.y = v27.y + in.y;
      v27.z = v27.z + in.z;
      RwV3dNormalize(&v27, &v27);
      v23 = v18 * (float)(v22 * v27.x);
      v24 = v18 * (float)(v22 * v27.y);
      v25 = v18 * (float)(v22 * v27.z);
      *(RwReal *)(lena + 8) = z;
      *(float *)(lena + 12) = v23;
      *(float *)(lena + 16) = v24;
      *(float *)(lena + 20) = v25;
    }
  }
}

//----- (0036B0AC) --------------------------------------------------------
void __fastcall FxInfoWind_c::FxInfoWind_c(FxInfoWind_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B0C;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 1;
  this->m_type = 8256;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 4, 4);
}
// 665B0C: using guessed type void *;

//----- (0036B0EC) --------------------------------------------------------
void __fastcall FxInfoWind_c::Load(FxInfoWind_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036B0F4) --------------------------------------------------------
void __fastcall FxInfoWind_c::GetValue(
        FxInfoWind_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v10; // s0
  float v13; // s0
  float v14; // s6
  float v15; // s8
  float v16[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, v16, pt);
  v13 = (float)(*g_fxMan.m_windStrength * v16[0]) * dt;
  v14 = *((float *)settings + 4);
  v15 = *((float *)settings + 5);
  *((float *)settings + 3) = *((float *)settings + 3) + (float)(g_fxMan.m_windDir->x * v13);
  *((float *)settings + 4) = v14 + (float)(v13 * g_fxMan.m_windDir->y);
  *((float *)settings + 5) = v15 + (float)(v13 * g_fxMan.m_windDir->z);
}
// 36B0F4: using guessed type float var_48[18];

//----- (0036B18C) --------------------------------------------------------
void __fastcall FxInfoJitter_c::FxInfoJitter_c(FxInfoJitter_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B24;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 1;
  this->m_type = 8320;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 4, 4);
}
// 665B24: using guessed type void *;

//----- (0036B1CC) --------------------------------------------------------
void __fastcall FxInfoJitter_c::Load(FxInfoJitter_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036B1D4) --------------------------------------------------------
void __fastcall FxInfoJitter_c::GetValue(
        FxInfoJitter_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v10; // s0
  float v13; // s4
  float v14; // s0
  RwV3d_0 in; // [sp+4h] [bp-6Ch] BYREF
  float values[24]; // [sp+10h] [bp-60h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, values, pt);
  in.x = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
  in.y = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
  in.z = (float)((float)(rand() % 10000) * 0.0002) + -1.0;
  RwV3dNormalize(&in, &in);
  in.x = in.x * (float)(values[0] * dt);
  in.y = (float)(values[0] * dt) * in.y;
  v13 = *((float *)settings + 1) + in.y;
  v14 = *((float *)settings + 2) + (float)(in.z * (float)(values[0] * dt));
  *(float *)settings = *(float *)settings + in.x;
  *((float *)settings + 1) = v13;
  *((float *)settings + 2) = v14;
}
// 36B1D4: using guessed type float values[24];

//----- (0036B2FC) --------------------------------------------------------
void __fastcall FxInfoRotSpeed_c::FxInfoRotSpeed_c(FxInfoRotSpeed_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B3C;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 4;
  this->m_type = 8448;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 16, 4);
}
// 665B3C: using guessed type void *;

//----- (0036B33C) --------------------------------------------------------
void __fastcall FxInfoRotSpeed_c::Load(FxInfoRotSpeed_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036B342) --------------------------------------------------------
void __fastcall FxInfoRotSpeed_c::GetValue(
        FxInfoRotSpeed_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfoFloat_c *p_m_interpInfo; // r0
  float v10; // s0
  __int64 v12; // d17
  _QWORD v13[9]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoFloat_c::GetVal(p_m_interpInfo, (float *)v13, pt);
  v12 = v13[1];
  *((_QWORD *)settings + 3) = v13[0];
  *((_QWORD *)settings + 4) = v12;
}

//----- (0036B380) --------------------------------------------------------
void __fastcall FxInfoFloat_c::FxInfoFloat_c(FxInfoFloat_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B54;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 0;
  this->m_type = 8704;
}
// 665B54: using guessed type void *;

//----- (0036B3AC) --------------------------------------------------------
void __fastcall FxInfoFloat_c::Load(FxInfoFloat_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036B3B2) --------------------------------------------------------
void __fastcall FxInfoFloat_c::GetValue(
        FxInfoFloat_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  *((_BYTE *)settings + 40) = 1;
}

//----- (0036B3BC) --------------------------------------------------------
void __fastcall FxInfoUnderwater_c::FxInfoUnderwater_c(FxInfoUnderwater_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B6C;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 0;
  this->m_type = 9216;
}
// 665B6C: using guessed type void *;

//----- (0036B3E8) --------------------------------------------------------
void __fastcall FxInfoUnderwater_c::Load(FxInfoUnderwater_c *this, u_native fileId, int32 version)
{
  sub_190B20(&this->m_interpInfo, fileId);
}

//----- (0036B3EE) --------------------------------------------------------
void __fastcall FxInfoUnderwater_c::GetValue(
        FxInfoUnderwater_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  *((_BYTE *)settings + 41) = 1;
}

//----- (0036B3F8) --------------------------------------------------------
void __fastcall FxInfoColour_c::FxInfoColour_c(FxInfoColour_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B84;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 4;
  this->m_type = 16385;
  this->m_interpInfo.m_keys = (uint16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 16, 4);
}
// 665B84: using guessed type void *;

//----- (0036B438) --------------------------------------------------------
void __fastcall FxInfoColour_c::Load(FxInfoColour_c *this, u_native fileId, int32 version)
{
  sub_190B20(&this->m_interpInfo, fileId);
}

//----- (0036B43E) --------------------------------------------------------
void __fastcall FxInfoColour_c::GetValue(
        FxInfoColour_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfoU255_c *p_m_interpInfo; // r0
  float v10; // s0
  float v12[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoU255_c::GetVal(p_m_interpInfo, v12, pt);
  *(_BYTE *)settings = (int)v12[0];
  *((_BYTE *)settings + 1) = (int)v12[1];
  *((_BYTE *)settings + 2) = (int)v12[2];
  *((_BYTE *)settings + 3) = (int)v12[3];
}

//----- (0036B4A8) --------------------------------------------------------
void __fastcall FxInfoSize_c::FxInfoSize_c(FxInfoSize_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B9C;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 4;
  this->m_type = 16386;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 16, 4);
}
// 665B9C: using guessed type void *;

//----- (0036B4E8) --------------------------------------------------------
void __fastcall FxInfoSize_c::Load(FxInfoSize_c *this, u_native fileId, int32 version)
{
  if ( version <= 104 )
    this->m_interpInfo.m_numAttribs = 2;
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036B4F8) --------------------------------------------------------
void __fastcall FxInfoSize_c::GetValue(
        FxInfoSize_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  bool v8; // zf
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v11; // r2
  float v12; // s0
  float v13[18]; // [sp+0h] [bp-48h] BYREF

  v8 = this->m_timeModeParticle == 0;
  p_m_interpInfo = &this->m_interpInfo;
  if ( v8 )
    pt = st / len;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, v13, pt);
  v11 = v13[1];
  *((float *)settings + 3) = v13[0];
  *((float *)settings + 4) = v11;
  if ( this->m_interpInfo.m_numAttribs == 4 )
  {
    *((float *)settings + 5) = v13[2];
    v12 = v13[3];
  }
  else
  {
    v12 = 0.0;
    *((_DWORD *)settings + 5) = 0;
  }
  *((float *)settings + 6) = v12;
}

//----- (0036B558) --------------------------------------------------------
void __fastcall FxInfoSpriteRect_c::FxInfoSpriteRect_c(FxInfoSpriteRect_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BB4;
  FxInterpInfo255_c::FxInterpInfo255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 4;
  this->m_type = 16388;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 16, 4);
}
// 665BB4: using guessed type void *;

//----- (0036B598) --------------------------------------------------------
void __fastcall FxInfoSpriteRect_c::Load(FxInfoSpriteRect_c *this, u_native fileId, int32 version)
{
  sub_18E7E0(&this->m_interpInfo, fileId);
}

//----- (0036B59E) --------------------------------------------------------
void __fastcall FxInfoSpriteRect_c::GetValue(
        FxInfoSpriteRect_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfo255_c *p_m_interpInfo; // r0
  float v10; // s0
  __int64 v12; // d17
  _QWORD v13[9]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo255_c::GetVal(p_m_interpInfo, (float *)v13, pt);
  v12 = v13[1];
  *(_QWORD *)((char *)settings + 28) = v13[0];
  *(_QWORD *)((char *)settings + 36) = v12;
}

//----- (0036B5DC) --------------------------------------------------------
void __fastcall FxInfoHeatHaze_c::FxInfoHeatHaze_c(FxInfoHeatHaze_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BCC;
  FxInterpInfo255_c::FxInterpInfo255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 0;
  this->m_type = 16392;
}
// 665BCC: using guessed type void *;

//----- (0036B608) --------------------------------------------------------
void __fastcall FxInfoHeatHaze_c::Load(FxInfoHeatHaze_c *this, u_native fileId, int32 version)
{
  sub_18E7E0(&this->m_interpInfo, fileId);
}

//----- (0036B60E) --------------------------------------------------------
void __fastcall FxInfoHeatHaze_c::GetValue(
        FxInfoHeatHaze_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  *((_BYTE *)settings + 54) = 1;
}

//----- (0036B618) --------------------------------------------------------
void __fastcall FxInfoTrail_c::FxInfoTrail_c(FxInfoTrail_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BE4;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 2;
  this->m_type = 16400;
  this->m_interpInfo.m_keys = (uint16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 8, 4);
}
// 665BE4: using guessed type void *;

//----- (0036B658) --------------------------------------------------------
void __fastcall FxInfoTrail_c::Load(FxInfoTrail_c *this, u_native fileId, int32 version)
{
  sub_190B20(&this->m_interpInfo, fileId);
}

//----- (0036B660) --------------------------------------------------------
void __fastcall FxInfoTrail_c::GetValue(
        FxInfoTrail_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfoU255_c *p_m_interpInfo; // r0
  float v10; // s0
  int v12; // r1
  int v13[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoU255_c::GetVal(p_m_interpInfo, (float *)v13, pt);
  v12 = v13[0];
  *((_DWORD *)settings + 11) = 1;
  *((_DWORD *)settings + 12) = v12;
  if ( *(float *)&v13[1] > 0.1 )
    *((_DWORD *)settings + 11) = 2;
}

//----- (0036B6B4) --------------------------------------------------------
void __fastcall FxInfoFlat_c::FxInfoFlat_c(FxInfoFlat_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BFC;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 9;
  this->m_type = 16416;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 36, 4);
}
// 665BFC: using guessed type void *;

//----- (0036B6F4) --------------------------------------------------------
void __fastcall FxInfoFlat_c::Load(FxInfoFlat_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036B6FA) --------------------------------------------------------
void __fastcall FxInfoFlat_c::GetValue(
        FxInfoFlat_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfoFloat_c *p_m_interpInfo; // r0
  float v10; // s0
  float v12; // r2
  float v13; // r3
  float v14; // r2
  float v15; // r3
  float v16; // r2
  float v17; // r3
  float v18[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoFloat_c::GetVal(p_m_interpInfo, v18, pt);
  *((_BYTE *)settings + 120) = 1;
  v12 = v18[1];
  v13 = v18[2];
  *((float *)settings + 14) = v18[0];
  *((float *)settings + 15) = v12;
  *((float *)settings + 16) = v13;
  v14 = v18[4];
  v15 = v18[5];
  *((float *)settings + 18) = v18[3];
  *((float *)settings + 19) = v14;
  *((float *)settings + 20) = v15;
  v16 = v18[7];
  v17 = v18[8];
  *((float *)settings + 22) = v18[6];
  *((float *)settings + 23) = v16;
  *((float *)settings + 24) = v17;
  RwMatrixUpdate((RwMatrix *)((char *)settings + 56));
}

//----- (0036B75C) --------------------------------------------------------
void __fastcall FxInfoDir_c::FxInfoDir_c(FxInfoDir_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C14;
  FxInterpInfoFloat_c::FxInterpInfoFloat_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 3;
  this->m_type = 16448;
  this->m_interpInfo.m_keys = (float **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 12, 4);
}
// 665C14: using guessed type void *;

//----- (0036B79C) --------------------------------------------------------
void __fastcall FxInfoDir_c::Load(FxInfoDir_c *this, u_native fileId, int32 version)
{
  sub_194D74(&this->m_interpInfo, fileId);
}

//----- (0036B7A4) --------------------------------------------------------
void __fastcall FxInfoDir_c::GetValue(
        FxInfoDir_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        int lena)
{
  int m_timeModeParticle; // r1
  FxInterpInfoFloat_c *p_m_interpInfo; // r0
  float v10; // s0
  float v12; // r1
  float v13; // r2
  float v14[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoFloat_c::GetVal(p_m_interpInfo, v14, pt);
  *(_BYTE *)(lena + 121) = 1;
  v12 = v14[1];
  v13 = v14[2];
  *(float *)(lena + 124) = v14[0];
  *(float *)(lena + 128) = v12;
  *(float *)(lena + 132) = v13;
  if ( RwV3dLength((const RwV3d_0 *)(lena + 124)) < 0.001 )
    *(_BYTE *)(lena + 122) = 1;
}

//----- (0036B808) --------------------------------------------------------
void __fastcall FxInfoAnimTexture_c::FxInfoAnimTexture_c(FxInfoAnimTexture_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C2C;
  FxInterpInfo32_c::FxInterpInfo32_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 1;
  this->m_type = 16512;
  this->m_interpInfo.m_keys = (int16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 4, 4);
}
// 665C2C: using guessed type void *;

//----- (0036B848) --------------------------------------------------------
void __fastcall FxInfoAnimTexture_c::Load(FxInfoAnimTexture_c *this, u_native fileId, int32 version)
{
  sub_198CC0(&this->m_interpInfo, fileId);
}

//----- (0036B84E) --------------------------------------------------------
void __fastcall FxInfoAnimTexture_c::GetValue(
        FxInfoAnimTexture_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfo32_c *p_m_interpInfo; // r0
  float v10; // s0
  float v12[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfo32_c::GetVal(p_m_interpInfo, v12, pt);
  *((_BYTE *)settings + 52) = 1;
  *((_BYTE *)settings + 53) = (int)v12[0];
}
// 36B84E: using guessed type float var_48[18];

//----- (0036B898) --------------------------------------------------------
void __fastcall FxInfoColourRange_c::FxInfoColourRange_c(FxInfoColourRange_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C44;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 7;
  this->m_type = 16640;
  this->m_interpInfo.m_keys = (uint16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 28, 4);
}
// 665C44: using guessed type void *;

//----- (0036B8D8) --------------------------------------------------------
void __fastcall FxInfoColourRange_c::Load(FxInfoColourRange_c *this, u_native fileId, int32 version)
{
  sub_190B20(&this->m_interpInfo, fileId);
}

//----- (0036B8DE) --------------------------------------------------------
void __fastcall FxInfoColourRange_c::GetValue(
        FxInfoColourRange_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfoU255_c *p_m_interpInfo; // r0
  float v10; // s0
  unsigned int v12; // s0
  float v13[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoU255_c::GetVal(p_m_interpInfo, v13, pt);
  *(_BYTE *)settings = (unsigned int)v13[0];
  *((_BYTE *)settings + 1) = (unsigned int)v13[2];
  *((_BYTE *)settings + 2) = (unsigned int)v13[4];
  *((_BYTE *)settings + 3) = (unsigned int)v13[6];
  *((_BYTE *)settings + 4) = (unsigned int)v13[1];
  *((_BYTE *)settings + 5) = (unsigned int)v13[3];
  v12 = (unsigned int)v13[5];
  *((_DWORD *)settings + 2) = 1;
  *((_BYTE *)settings + 6) = v12;
}

//----- (0036B978) --------------------------------------------------------
void __fastcall FxInfoSelfLit_c::FxInfoSelfLit_c(FxInfoSelfLit_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C5C;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 0;
  this->m_type = 16896;
}
// 665C5C: using guessed type void *;

//----- (0036B9A6) --------------------------------------------------------
void __fastcall FxInfoSelfLit_c::GetValue(
        FxInfoSelfLit_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  *((_BYTE *)settings + 55) = 1;
}

//----- (0036B9B0) --------------------------------------------------------
void __fastcall FxInfoColourBright_c::FxInfoColourBright_c(FxInfoColourBright_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C74;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 5;
  this->m_type = 17408;
  this->m_interpInfo.m_keys = (uint16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 20, 4);
}
// 665C74: using guessed type void *;

//----- (0036B9F0) --------------------------------------------------------
void __fastcall FxInfoColourBright_c::Load(FxInfoColourBright_c *this, u_native fileId, int32 version)
{
  sub_190B20(&this->m_interpInfo, fileId);
}

//----- (0036B9F6) --------------------------------------------------------
void __fastcall FxInfoColourBright_c::GetValue(
        FxInfoColourBright_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfoU255_c *p_m_interpInfo; // r0
  float v10; // s0
  unsigned int v12; // s0
  float v13[18]; // [sp+0h] [bp-48h] BYREF

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoU255_c::GetVal(p_m_interpInfo, v13, pt);
  *(_BYTE *)settings = (unsigned int)v13[0];
  *((_BYTE *)settings + 1) = (unsigned int)v13[1];
  *((_BYTE *)settings + 2) = (unsigned int)v13[2];
  *((_BYTE *)settings + 3) = (unsigned int)v13[3];
  v12 = (unsigned int)v13[4];
  *((_DWORD *)settings + 2) = 2;
  *((_BYTE *)settings + 7) = v12;
}

//----- (0036BA74) --------------------------------------------------------
void __fastcall FxInfoSmoke_c::FxInfoSmoke_c(FxInfoSmoke_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C8C;
  FxInterpInfoU255_c::FxInterpInfoU255_c(&this->m_interpInfo);
  this->m_interpInfo.m_numAttribs = 8;
  this->m_type = -32767;
  this->m_interpInfo.m_keys = (uint16 **)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 32, 4);
}
// 665C8C: using guessed type void *;

//----- (0036BAB4) --------------------------------------------------------
void __fastcall FxInfoSmoke_c::Load(FxInfoSmoke_c *this, u_native fileId, int32 version)
{
  sub_190B20(&this->m_interpInfo, fileId);
}

//----- (0036BABA) --------------------------------------------------------
void __fastcall FxInfoSmoke_c::GetValue(
        FxInfoSmoke_c *this,
        float st,
        float pt,
        float dt,
        float len,
        bool8 useConst,
        void *settings)
{
  int m_timeModeParticle; // r1
  FxInterpInfoU255_c *p_m_interpInfo; // r0
  float v10; // s0
  __int64 v12; // d17
  int v13; // r2
  int v14; // r3
  float v15; // [sp+0h] [bp-48h] BYREF
  __int64 v16; // [sp+4h] [bp-44h]
  __int64 v17; // [sp+Ch] [bp-3Ch]
  int v18; // [sp+14h] [bp-34h]
  int v19; // [sp+18h] [bp-30h]
  int v20; // [sp+1Ch] [bp-2Ch]

  m_timeModeParticle = this->m_timeModeParticle;
  p_m_interpInfo = &this->m_interpInfo;
  v10 = st / len;
  if ( !m_timeModeParticle )
    pt = v10;
  FxInterpInfoU255_c::GetVal(p_m_interpInfo, &v15, pt);
  *((_BYTE *)settings + 123) = (int)v15;
  v12 = v17;
  *((_QWORD *)settings + 17) = v16;
  *((_QWORD *)settings + 18) = v12;
  v13 = v19;
  v14 = v20;
  *((_DWORD *)settings + 38) = v18;
  *((_DWORD *)settings + 39) = v13;
  *((_DWORD *)settings + 40) = v14;
}

//----- (0036BB14) --------------------------------------------------------
void __fastcall FxInfoEmRate_c::~FxInfoEmRate_c(FxInfoEmRate_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659A4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 6659A4: using guessed type void *off_6659A4;

//----- (0036BB38) --------------------------------------------------------
void __fastcall FxInfoEmRate_c::~FxInfoEmRate_c(FxInfoEmRate_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659A4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 6659A4: using guessed type void *off_6659A4;

//----- (0036BB60) --------------------------------------------------------
void __fastcall FxInfoEmSize_c::~FxInfoEmSize_c(FxInfoEmSize_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659BC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 6659BC: using guessed type void *off_6659BC;

//----- (0036BB84) --------------------------------------------------------
void __fastcall FxInfoEmSize_c::~FxInfoEmSize_c(FxInfoEmSize_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659BC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 6659BC: using guessed type void *off_6659BC;

//----- (0036BBAC) --------------------------------------------------------
void __fastcall FxInfoEmSpeed_c::~FxInfoEmSpeed_c(FxInfoEmSpeed_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659D4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 6659D4: using guessed type void *off_6659D4;

//----- (0036BBD0) --------------------------------------------------------
void __fastcall FxInfoEmSpeed_c::~FxInfoEmSpeed_c(FxInfoEmSpeed_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659D4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 6659D4: using guessed type void *off_6659D4;

//----- (0036BBF8) --------------------------------------------------------
void __fastcall FxInfoEmDir_c::~FxInfoEmDir_c(FxInfoEmDir_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659EC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 6659EC: using guessed type void *off_6659EC;

//----- (0036BC1C) --------------------------------------------------------
void __fastcall FxInfoEmDir_c::~FxInfoEmDir_c(FxInfoEmDir_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_6659EC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 6659EC: using guessed type void *off_6659EC;

//----- (0036BC44) --------------------------------------------------------
void __fastcall FxInfoEmAngle_c::~FxInfoEmAngle_c(FxInfoEmAngle_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A04;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665A04: using guessed type void *off_665A04;

//----- (0036BC68) --------------------------------------------------------
void __fastcall FxInfoEmAngle_c::~FxInfoEmAngle_c(FxInfoEmAngle_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A04;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665A04: using guessed type void *off_665A04;

//----- (0036BC90) --------------------------------------------------------
void __fastcall FxInfoEmLife_c::~FxInfoEmLife_c(FxInfoEmLife_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A1C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665A1C: using guessed type void *off_665A1C;

//----- (0036BCB4) --------------------------------------------------------
void __fastcall FxInfoEmLife_c::~FxInfoEmLife_c(FxInfoEmLife_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A1C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665A1C: using guessed type void *off_665A1C;

//----- (0036BCDC) --------------------------------------------------------
void __fastcall FxInfoEmPos_c::~FxInfoEmPos_c(FxInfoEmPos_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A34;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665A34: using guessed type void *off_665A34;

//----- (0036BD00) --------------------------------------------------------
void __fastcall FxInfoEmPos_c::~FxInfoEmPos_c(FxInfoEmPos_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A34;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665A34: using guessed type void *off_665A34;

//----- (0036BD28) --------------------------------------------------------
void __fastcall FxInfoEmWeather_c::~FxInfoEmWeather_c(FxInfoEmWeather_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A4C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665A4C: using guessed type void *off_665A4C;

//----- (0036BD4C) --------------------------------------------------------
void __fastcall FxInfoEmWeather_c::~FxInfoEmWeather_c(FxInfoEmWeather_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A4C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665A4C: using guessed type void *off_665A4C;

//----- (0036BD74) --------------------------------------------------------
void __fastcall FxInfoEmRotation_c::~FxInfoEmRotation_c(FxInfoEmRotation_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A64;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665A64: using guessed type void *off_665A64;

//----- (0036BD98) --------------------------------------------------------
void __fastcall FxInfoEmRotation_c::~FxInfoEmRotation_c(FxInfoEmRotation_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A64;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665A64: using guessed type void *off_665A64;

//----- (0036BDC0) --------------------------------------------------------
void __fastcall FxInfoNoise_c::~FxInfoNoise_c(FxInfoNoise_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A7C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665A7C: using guessed type void *off_665A7C;

//----- (0036BDE4) --------------------------------------------------------
void __fastcall FxInfoNoise_c::~FxInfoNoise_c(FxInfoNoise_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A7C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665A7C: using guessed type void *off_665A7C;

//----- (0036BE0C) --------------------------------------------------------
void __fastcall FxInfoForce_c::~FxInfoForce_c(FxInfoForce_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A94;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665A94: using guessed type void *off_665A94;

//----- (0036BE30) --------------------------------------------------------
void __fastcall FxInfoForce_c::~FxInfoForce_c(FxInfoForce_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665A94;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665A94: using guessed type void *off_665A94;

//----- (0036BE58) --------------------------------------------------------
void __fastcall FxInfoFriction_c::~FxInfoFriction_c(FxInfoFriction_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AAC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665AAC: using guessed type void *off_665AAC;

//----- (0036BE7C) --------------------------------------------------------
void __fastcall FxInfoFriction_c::~FxInfoFriction_c(FxInfoFriction_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AAC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665AAC: using guessed type void *off_665AAC;

//----- (0036BEA4) --------------------------------------------------------
void __fastcall FxInfoAttractPt_c::~FxInfoAttractPt_c(FxInfoAttractPt_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AC4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665AC4: using guessed type void *off_665AC4;

//----- (0036BEC8) --------------------------------------------------------
void __fastcall FxInfoAttractPt_c::~FxInfoAttractPt_c(FxInfoAttractPt_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AC4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665AC4: using guessed type void *off_665AC4;

//----- (0036BEF0) --------------------------------------------------------
void __fastcall FxInfoAttractLine_c::~FxInfoAttractLine_c(FxInfoAttractLine_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665ADC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665ADC: using guessed type void *off_665ADC;

//----- (0036BF14) --------------------------------------------------------
void __fastcall FxInfoAttractLine_c::~FxInfoAttractLine_c(FxInfoAttractLine_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665ADC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665ADC: using guessed type void *off_665ADC;

//----- (0036BF3C) --------------------------------------------------------
void __fastcall FxInfoGroundCollide_c::~FxInfoGroundCollide_c(FxInfoGroundCollide_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AF4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665AF4: using guessed type void *off_665AF4;

//----- (0036BF60) --------------------------------------------------------
void __fastcall FxInfoGroundCollide_c::~FxInfoGroundCollide_c(FxInfoGroundCollide_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665AF4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665AF4: using guessed type void *off_665AF4;

//----- (0036BF88) --------------------------------------------------------
void __fastcall FxInfoWind_c::~FxInfoWind_c(FxInfoWind_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B0C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665B0C: using guessed type void *off_665B0C;

//----- (0036BFAC) --------------------------------------------------------
void __fastcall FxInfoWind_c::~FxInfoWind_c(FxInfoWind_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B0C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665B0C: using guessed type void *off_665B0C;

//----- (0036BFD4) --------------------------------------------------------
void __fastcall FxInfoJitter_c::~FxInfoJitter_c(FxInfoJitter_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B24;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665B24: using guessed type void *off_665B24;

//----- (0036BFF8) --------------------------------------------------------
void __fastcall FxInfoJitter_c::~FxInfoJitter_c(FxInfoJitter_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B24;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665B24: using guessed type void *off_665B24;

//----- (0036C020) --------------------------------------------------------
void __fastcall FxInfoRotSpeed_c::~FxInfoRotSpeed_c(FxInfoRotSpeed_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B3C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665B3C: using guessed type void *off_665B3C;

//----- (0036C044) --------------------------------------------------------
void __fastcall FxInfoRotSpeed_c::~FxInfoRotSpeed_c(FxInfoRotSpeed_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B3C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665B3C: using guessed type void *off_665B3C;

//----- (0036C06C) --------------------------------------------------------
void __fastcall FxInfoFloat_c::~FxInfoFloat_c(FxInfoFloat_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B54;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665B54: using guessed type void *off_665B54;

//----- (0036C090) --------------------------------------------------------
void __fastcall FxInfoFloat_c::~FxInfoFloat_c(FxInfoFloat_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B54;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665B54: using guessed type void *off_665B54;

//----- (0036C0B8) --------------------------------------------------------
void __fastcall FxInfoUnderwater_c::~FxInfoUnderwater_c(FxInfoUnderwater_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B6C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665B6C: using guessed type void *off_665B6C;

//----- (0036C0DC) --------------------------------------------------------
void __fastcall FxInfoUnderwater_c::~FxInfoUnderwater_c(FxInfoUnderwater_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B6C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665B6C: using guessed type void *off_665B6C;

//----- (0036C104) --------------------------------------------------------
void __fastcall FxInfoColour_c::~FxInfoColour_c(FxInfoColour_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B84;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665B84: using guessed type void *off_665B84;

//----- (0036C128) --------------------------------------------------------
void __fastcall FxInfoColour_c::~FxInfoColour_c(FxInfoColour_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B84;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665B84: using guessed type void *off_665B84;

//----- (0036C150) --------------------------------------------------------
void __fastcall FxInfoSize_c::~FxInfoSize_c(FxInfoSize_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B9C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665B9C: using guessed type void *off_665B9C;

//----- (0036C174) --------------------------------------------------------
void __fastcall FxInfoSize_c::~FxInfoSize_c(FxInfoSize_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665B9C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665B9C: using guessed type void *off_665B9C;

//----- (0036C19C) --------------------------------------------------------
void __fastcall FxInfoSpriteRect_c::~FxInfoSpriteRect_c(FxInfoSpriteRect_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BB4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665BB4: using guessed type void *off_665BB4;

//----- (0036C1C0) --------------------------------------------------------
void __fastcall FxInfoSpriteRect_c::~FxInfoSpriteRect_c(FxInfoSpriteRect_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BB4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665BB4: using guessed type void *off_665BB4;

//----- (0036C1E8) --------------------------------------------------------
void __fastcall FxInfoHeatHaze_c::~FxInfoHeatHaze_c(FxInfoHeatHaze_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BCC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665BCC: using guessed type void *off_665BCC;

//----- (0036C20C) --------------------------------------------------------
void __fastcall FxInfoHeatHaze_c::~FxInfoHeatHaze_c(FxInfoHeatHaze_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BCC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665BCC: using guessed type void *off_665BCC;

//----- (0036C234) --------------------------------------------------------
void __fastcall FxInfoTrail_c::~FxInfoTrail_c(FxInfoTrail_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BE4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665BE4: using guessed type void *off_665BE4;

//----- (0036C258) --------------------------------------------------------
void __fastcall FxInfoTrail_c::~FxInfoTrail_c(FxInfoTrail_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BE4;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665BE4: using guessed type void *off_665BE4;

//----- (0036C280) --------------------------------------------------------
void __fastcall FxInfoFlat_c::~FxInfoFlat_c(FxInfoFlat_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BFC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665BFC: using guessed type void *off_665BFC;

//----- (0036C2A4) --------------------------------------------------------
void __fastcall FxInfoFlat_c::~FxInfoFlat_c(FxInfoFlat_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665BFC;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665BFC: using guessed type void *off_665BFC;

//----- (0036C2CC) --------------------------------------------------------
void __fastcall FxInfoDir_c::~FxInfoDir_c(FxInfoDir_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C14;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665C14: using guessed type void *off_665C14;

//----- (0036C2F0) --------------------------------------------------------
void __fastcall FxInfoDir_c::~FxInfoDir_c(FxInfoDir_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C14;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665C14: using guessed type void *off_665C14;

//----- (0036C318) --------------------------------------------------------
void __fastcall FxInfoAnimTexture_c::~FxInfoAnimTexture_c(FxInfoAnimTexture_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C2C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665C2C: using guessed type void *off_665C2C;

//----- (0036C33C) --------------------------------------------------------
void __fastcall FxInfoAnimTexture_c::~FxInfoAnimTexture_c(FxInfoAnimTexture_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C2C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665C2C: using guessed type void *off_665C2C;

//----- (0036C364) --------------------------------------------------------
void __fastcall FxInfoColourRange_c::~FxInfoColourRange_c(FxInfoColourRange_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C44;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665C44: using guessed type void *off_665C44;

//----- (0036C388) --------------------------------------------------------
void __fastcall FxInfoColourRange_c::~FxInfoColourRange_c(FxInfoColourRange_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C44;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665C44: using guessed type void *off_665C44;

//----- (0036C3B0) --------------------------------------------------------
void __fastcall FxInfoSelfLit_c::~FxInfoSelfLit_c(FxInfoSelfLit_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C5C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665C5C: using guessed type void *off_665C5C;

//----- (0036C3D4) --------------------------------------------------------
void __fastcall FxInfoSelfLit_c::~FxInfoSelfLit_c(FxInfoSelfLit_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C5C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665C5C: using guessed type void *off_665C5C;

//----- (0036C3FC) --------------------------------------------------------
void __fastcall FxInfoColourBright_c::~FxInfoColourBright_c(FxInfoColourBright_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C74;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665C74: using guessed type void *off_665C74;

//----- (0036C420) --------------------------------------------------------
void __fastcall FxInfoColourBright_c::~FxInfoColourBright_c(FxInfoColourBright_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C74;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665C74: using guessed type void *off_665C74;

//----- (0036C448) --------------------------------------------------------
void __fastcall FxInfoSmoke_c::~FxInfoSmoke_c(FxInfoSmoke_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C8C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
}
// 665C8C: using guessed type void *off_665C8C;

//----- (0036C46C) --------------------------------------------------------
void __fastcall FxInfoSmoke_c::~FxInfoSmoke_c(FxInfoSmoke_c *this)
{
  this->_vptr$FxInfo_c = (int (**)(void))&off_665C8C;
  FxInterpInfoFloat_c::~FxInterpInfoFloat_c(&this->m_interpInfo);
  sub_191374(this);
}
// 665C8C: using guessed type void *off_665C8C;

//----- (0036C494) --------------------------------------------------------
void __fastcall FxInterpInfo_c::FxInterpInfo_c(FxInterpInfo_c *this)
{
  this->m_looped = 0;
  this->m_times = 0;
  this->_vptr$FxInterpInfo_c = (int (**)(void))&off_665CA4;
}
// 665CA4: using guessed type void *;

//----- (0036C4B0) --------------------------------------------------------
void __fastcall FxInterpInfoFloat_c::FxInterpInfoFloat_c(FxInterpInfoFloat_c *this)
{
  this->m_looped = 0;
  this->m_times = 0;
  this->m_keys = 0;
  this->_vptr$FxInterpInfo_c = (int (**)(void))&off_665CB8;
}
// 665CB8: using guessed type void *;

//----- (0036C4CC) --------------------------------------------------------
void __fastcall FxInterpInfoFloat_c::GetVal(FxInterpInfoFloat_c *this, float *values, float t)
{
  int m_numKeys; // r12
  int v4; // r2
  float v5; // s0
  float v6; // s2
  int v7; // r3
  uint16 *m_times; // lr
  int v9; // r2
  float v10; // s4
  bool v11; // cc
  int v12; // r2
  float v13; // s6
  int v14; // r3
  float v15; // s0
  float *v16; // r4

  m_numKeys = this->m_numKeys;
  if ( m_numKeys == 1 )
  {
    if ( this->m_numAttribs >= 1 )
    {
      v4 = 0;
      do
      {
        values[v4] = *this->m_keys[v4];
        ++v4;
      }
      while ( v4 < this->m_numAttribs );
    }
  }
  else
  {
    v5 = t;
    if ( this->m_looped )
    {
      v6 = (float)this->m_times[m_numKeys - 1] * 0.0039062;
      v5 = t - (float)(v6 * (float)(int)(float)(t / v6));
    }
    if ( m_numKeys < 2 )
    {
LABEL_12:
      if ( this->m_numAttribs >= 1 )
      {
        *values = (*this->m_keys)[m_numKeys - 1];
        if ( this->m_numAttribs >= 2 )
        {
          v12 = 1;
          do
          {
            values[v12] = this->m_keys[v12][this->m_numKeys - 1];
            ++v12;
          }
          while ( v12 < this->m_numAttribs );
        }
      }
    }
    else
    {
      v7 = 0;
      m_times = this->m_times;
      v9 = 1;
      while ( 1 )
      {
        v10 = (float)m_times[v7 + 1] * 0.0039062;
        if ( v5 < v10 )
          break;
        ++v9;
        v11 = v7 + 2 < m_numKeys;
        ++v7;
        if ( !v11 )
          goto LABEL_12;
      }
      v13 = (float)m_times[v7];
      if ( this->m_numAttribs >= 1 )
      {
        v14 = 0;
        v15 = (float)(v5 - (float)(v13 * 0.0039062)) / (float)(v10 - (float)(v13 * 0.0039062));
        do
        {
          v16 = this->m_keys[v14++];
          *values++ = v16[v9 - 1] + (float)(v15 * (float)(v16[v9] - v16[v9 - 1]));
        }
        while ( v14 < this->m_numAttribs );
      }
    }
  }
}

//----- (0036C608) --------------------------------------------------------
float __fastcall FxInterpInfoFloat_c::GetVal(FxInterpInfoFloat_c *this, int32 attribId, float t, float dt)
{
  float v4; // s4
  int m_numKeys; // r12
  float v7; // s0
  float v9; // s0
  uint16 *m_times; // r2
  int v11; // r3
  int v12; // r5
  bool v13; // cc
  int v15; // lr
  uint16 *v16; // r3
  float v17; // s12
  float v18; // s0
  float v19; // s10
  float *v20; // r2
  float v21; // s6
  float *v22; // r2
  float v23; // s10
  float v24; // s2

  m_numKeys = this->m_numKeys;
  if ( m_numKeys == 1 )
  {
    v7 = *this->m_keys[attribId];
    return v7 * dt;
  }
  v9 = t - dt;
  if ( m_numKeys < 1 )
  {
    v12 = 0;
    v13 = m_numKeys > 0;
    if ( !this->m_numKeys )
    {
LABEL_8:
      v7 = this->m_keys[attribId][m_numKeys - 1];
      return v7 * dt;
    }
  }
  else
  {
    m_times = this->m_times;
    v11 = 0;
    v12 = 0;
    while ( 1 )
    {
      v4 = (float)*m_times * 0.0039062;
      if ( v9 < v4 )
        break;
      ++v12;
      ++v11;
      ++m_times;
      if ( v12 >= m_numKeys )
      {
        v13 = v12 < m_numKeys;
        if ( v12 != m_numKeys )
          goto LABEL_11;
        goto LABEL_8;
      }
    }
    if ( v12 < 1 )
    {
      v4 = this->m_keys[attribId][v11];
      v13 = v12 < m_numKeys;
      if ( v12 == m_numKeys )
        goto LABEL_8;
    }
    else
    {
      v19 = (float)*(m_times - 1);
      v20 = &this->m_keys[attribId][v11];
      v4 = *(v20 - 1)
         + (float)((float)((float)(v9 - (float)(v19 * 0.0039062)) / (float)(v4 - (float)(v19 * 0.0039062)))
                 * (float)(*v20 - *(v20 - 1)));
      v13 = v12 < m_numKeys;
      if ( v12 == m_numKeys )
        goto LABEL_8;
    }
  }
LABEL_11:
  if ( v13 )
  {
    v21 = 0.0;
    v15 = v12;
    v16 = &this->m_times[v12];
    while ( 1 )
    {
      v17 = (float)*v16 * 0.0039062;
      if ( v17 == t )
        break;
      if ( v17 >= t )
      {
        if ( v17 > t )
        {
          v22 = &this->m_keys[attribId][v15];
          v23 = (float)*(v16 - 1) * 0.0039062;
          v24 = (float)(t - v9)
              * (float)(v4
                      + (float)((float)((float)(*(v22 - 1)
                                              + (float)((float)((float)(t - v23) / (float)(v17 - v23))
                                                      * (float)(*v22 - *(v22 - 1))))
                                      - v4)
                              * 0.5));
          goto LABEL_30;
        }
      }
      else
      {
        v18 = (float)(v17 - v9) * (float)(v4 + (float)((float)(this->m_keys[attribId][v15] - v4) * 0.5));
        v4 = this->m_keys[attribId][v15];
        v21 = v21 + v18;
        v9 = (float)*v16 * 0.0039062;
      }
      ++v12;
      ++v16;
      ++v15;
      if ( v12 >= m_numKeys )
        goto LABEL_24;
    }
    v24 = (float)(v17 - v9) * (float)(v4 + (float)((float)(this->m_keys[attribId][v15] - v4) * 0.5));
LABEL_30:
    v21 = v21 + v24;
    if ( v12 != m_numKeys )
      return v21;
  }
  else
  {
    v21 = 0.0;
LABEL_24:
    if ( v12 != m_numKeys )
      return v21;
  }
  return v21
       + (float)((float)(v4 + (float)((float)(this->m_keys[attribId][m_numKeys - 1] - v4) * 0.5))
               * (float)((float)((float)this->m_times[m_numKeys - 1] * 0.0039062) - v9));
}
// 36C6D4: variable 'v4' is possibly undefined

//----- (0036C824) --------------------------------------------------------
void __fastcall FxInterpInfoU255_c::FxInterpInfoU255_c(FxInterpInfoU255_c *this)
{
  this->m_looped = 0;
  this->m_times = 0;
  this->m_keys = 0;
  this->_vptr$FxInterpInfo_c = (int (**)(void))&off_665CCC;
}
// 665CCC: using guessed type void *;

//----- (0036C840) --------------------------------------------------------
void __fastcall FxInterpInfoU255_c::GetVal(FxInterpInfoU255_c *this, float *values, float t)
{
  int m_numKeys; // r12
  int v4; // r2
  uint16 *v5; // r3
  float v6; // s2
  float v7; // s0
  uint16 *m_times; // lr
  int v9; // r4
  float v10; // s4
  bool v11; // cc
  float *v12; // r1
  int v13; // r2
  uint16 *v14; // r3
  float v15; // s6
  int v16; // r3
  float v17; // s2
  uint16 *v18; // r2
  float v19; // s4

  m_numKeys = this->m_numKeys;
  if ( m_numKeys == 1 )
  {
    if ( this->m_numAttribs >= 1 )
    {
      v4 = 0;
      do
      {
        v5 = this->m_keys[v4++];
        *values++ = (float)*v5 * 0.0039062;
      }
      while ( v4 < this->m_numAttribs );
    }
  }
  else
  {
    v6 = t;
    if ( this->m_looped )
    {
      v7 = (float)this->m_times[m_numKeys - 1] * 0.0039062;
      v6 = t - (float)(v7 * (float)(int)(float)(t / v7));
    }
    if ( m_numKeys < 2 )
    {
LABEL_12:
      if ( this->m_numAttribs >= 1 )
      {
        *values = (float)(*this->m_keys)[m_numKeys - 1] * 0.0039062;
        if ( this->m_numAttribs >= 2 )
        {
          v12 = values + 1;
          v13 = 1;
          do
          {
            v14 = this->m_keys[v13++];
            *v12++ = (float)v14[this->m_numKeys - 1] * 0.0039062;
          }
          while ( v13 < this->m_numAttribs );
        }
      }
    }
    else
    {
      m_times = this->m_times;
      v9 = 0;
      while ( 1 )
      {
        v10 = (float)m_times[v9 + 1] * 0.0039062;
        if ( v6 < v10 )
          break;
        v11 = v9 + 2 < m_numKeys;
        ++v9;
        if ( !v11 )
          goto LABEL_12;
      }
      if ( this->m_numAttribs >= 1 )
      {
        v15 = (float)m_times[v9] * 0.0039062;
        v16 = 0;
        v17 = (float)(v6 - v15) / (float)(v10 - v15);
        do
        {
          v18 = this->m_keys[v16++];
          v19 = (float)v18[v9] * 0.0039062;
          *values++ = v19 + (float)(v17 * (float)((float)((float)v18[v9 + 1] * 0.0039062) - v19));
        }
        while ( v16 < this->m_numAttribs );
      }
    }
  }
}

//----- (0036C9C0) --------------------------------------------------------
void __fastcall FxInterpInfo32_c::FxInterpInfo32_c(FxInterpInfo32_c *this)
{
  this->m_looped = 0;
  this->m_times = 0;
  this->m_keys = 0;
  this->_vptr$FxInterpInfo_c = (int (**)(void))&off_665CE0;
}
// 665CE0: using guessed type void *;

//----- (0036C9DC) --------------------------------------------------------
void __fastcall FxInterpInfo32_c::GetVal(FxInterpInfo32_c *this, float *values, float t)
{
  int m_numKeys; // lr
  int v4; // r2
  int16 *v5; // r3
  float v6; // s0
  float v7; // s2
  uint16 *m_times; // r12
  int v9; // r4
  float v10; // s4
  bool v11; // cc
  int v12; // r2
  int16 *v13; // r3
  float v14; // s2
  int v15; // r3
  float v16; // s0
  int16 *v17; // r12
  float v18; // s4

  m_numKeys = this->m_numKeys;
  if ( m_numKeys == 1 )
  {
    if ( this->m_numAttribs >= 1 )
    {
      v4 = 0;
      do
      {
        v5 = this->m_keys[v4++];
        *values++ = (float)*v5 / 1000.0;
      }
      while ( v4 < this->m_numAttribs );
    }
  }
  else
  {
    v6 = t;
    if ( this->m_looped )
    {
      v7 = (float)this->m_times[m_numKeys - 1] * 0.0039062;
      v6 = t - (float)(v7 * (float)(int)(float)(t / v7));
    }
    if ( m_numKeys < 2 )
    {
LABEL_12:
      if ( this->m_numAttribs >= 1 )
      {
        v12 = 0;
        while ( 1 )
        {
          v13 = this->m_keys[v12++];
          *values = (float)v13[(char)m_numKeys - 1] / 1000.0;
          if ( v12 >= this->m_numAttribs )
            break;
          LOBYTE(m_numKeys) = this->m_numKeys;
          ++values;
        }
      }
    }
    else
    {
      m_times = this->m_times;
      v9 = 0;
      while ( 1 )
      {
        v10 = (float)m_times[v9 + 1] * 0.0039062;
        if ( v6 < v10 )
          break;
        v11 = v9 + 2 < m_numKeys;
        ++v9;
        if ( !v11 )
          goto LABEL_12;
      }
      if ( this->m_numAttribs >= 1 )
      {
        v14 = (float)m_times[v9] * 0.0039062;
        v15 = 0;
        v16 = (float)(v6 - v14) / (float)(v10 - v14);
        do
        {
          v17 = this->m_keys[v15++];
          v18 = (float)v17[v9] / 1000.0;
          *values++ = v18 + (float)(v16 * (float)((float)((float)v17[v9 + 1] / 1000.0) - v18));
        }
        while ( v15 < this->m_numAttribs );
      }
    }
  }
}

//----- (0036CB4C) --------------------------------------------------------
void __fastcall FxInterpInfo255_c::FxInterpInfo255_c(FxInterpInfo255_c *this)
{
  this->m_looped = 0;
  this->m_times = 0;
  this->m_keys = 0;
  this->_vptr$FxInterpInfo_c = (int (**)(void))&off_665CF4;
}
// 665CF4: using guessed type void *;

//----- (0036CB68) --------------------------------------------------------
void __fastcall FxInterpInfo255_c::GetVal(FxInterpInfo255_c *this, float *values, float t)
{
  int m_numKeys; // r12
  int v4; // r2
  int16 *v5; // r3
  float v6; // s0
  float v7; // s2
  uint16 *m_times; // lr
  int v9; // r4
  float v10; // s4
  bool v11; // cc
  float *v12; // r1
  int v13; // r2
  int16 *v14; // r3
  float v15; // s2
  int v16; // r3
  float v17; // s0
  int16 *v18; // r2
  float v19; // s4

  m_numKeys = this->m_numKeys;
  if ( m_numKeys == 1 )
  {
    if ( this->m_numAttribs >= 1 )
    {
      v4 = 0;
      do
      {
        v5 = this->m_keys[v4++];
        *values++ = (float)*v5 * 0.0078125;
      }
      while ( v4 < this->m_numAttribs );
    }
  }
  else
  {
    v6 = t;
    if ( this->m_looped )
    {
      v7 = (float)this->m_times[m_numKeys - 1] * 0.0039062;
      v6 = t - (float)(v7 * (float)(int)(float)(t / v7));
    }
    if ( m_numKeys < 2 )
    {
LABEL_12:
      if ( this->m_numAttribs >= 1 )
      {
        *values = (float)(*this->m_keys)[m_numKeys - 1] * 0.0078125;
        if ( this->m_numAttribs >= 2 )
        {
          v12 = values + 1;
          v13 = 1;
          do
          {
            v14 = this->m_keys[v13++];
            *v12++ = (float)v14[this->m_numKeys - 1] * 0.0078125;
          }
          while ( v13 < this->m_numAttribs );
        }
      }
    }
    else
    {
      m_times = this->m_times;
      v9 = 0;
      while ( 1 )
      {
        v10 = (float)m_times[v9 + 1] * 0.0039062;
        if ( v6 < v10 )
          break;
        v11 = v9 + 2 < m_numKeys;
        ++v9;
        if ( !v11 )
          goto LABEL_12;
      }
      if ( this->m_numAttribs >= 1 )
      {
        v15 = (float)m_times[v9] * 0.0039062;
        v16 = 0;
        v17 = (float)(v6 - v15) / (float)(v10 - v15);
        do
        {
          v18 = this->m_keys[v16++];
          v19 = (float)v18[v9] * 0.0078125;
          *values++ = v19 + (float)(v17 * (float)((float)((float)v18[v9 + 1] * 0.0078125) - v19));
        }
        while ( v16 < this->m_numAttribs );
      }
    }
  }
}

//----- (0036CCF4) --------------------------------------------------------
void __fastcall ListItem_c::ListItem_c(ListItem_c *this)
{
  this->m_prev = 0;
  this->m_next = 0;
}

//----- (0036CCFE) --------------------------------------------------------
void __fastcall List_c::List_c(List_c *this)
{
  this->m_head = 0;
  this->m_tail = 0;
  this->m_numItems = 0;
}

//----- (0036CD0A) --------------------------------------------------------
int32 __fastcall List_c::AddItem(List_c *this, ListItem_c *item)
{
  ListItem_c *m_head; // r2
  int32 m_numItems; // r1

  m_head = this->m_head;
  this->m_head = item;
  item->m_prev = 0;
  item->m_next = m_head;
  if ( !m_head )
    m_head = (ListItem_c *)&this->m_tail;
  m_head->m_prev = item;
  m_numItems = this->m_numItems;
  this->m_numItems = m_numItems + 1;
  return m_numItems;
}

//----- (0036CD26) --------------------------------------------------------
int32 __fastcall List_c::RemoveItem(List_c *this, ListItem_c *item)
{
  ListItem_c v2; // kr00_8
  ListItem_c *m_next; // r3
  int32 m_numItems; // r1

  v2 = *item;
  m_next = item->m_next;
  if ( !m_next )
    m_next = (ListItem_c *)&this->m_tail;
  m_next->m_prev = v2.m_prev;
  if ( v2.m_prev )
    v2.m_prev->m_next = v2.m_next;
  else
    this->m_head = item->m_next;
  m_numItems = this->m_numItems;
  this->m_numItems = m_numItems - 1;
  return m_numItems;
}

//----- (0036CD4E) --------------------------------------------------------
ListItem_c *__fastcall List_c::RemoveHead(List_c *this)
{
  ListItem_c *result; // r0
  ListItem_c *m_next; // r2

  result = this->m_head;
  if ( !result )
    return 0;
  if ( result == this->m_tail )
  {
    this->m_tail = 0;
    m_next = (ListItem_c *)this;
  }
  else
  {
    m_next = result->m_next;
    this->m_head = m_next;
    if ( !m_next )
      goto LABEL_8;
  }
  m_next->m_prev = 0;
LABEL_8:
  --this->m_numItems;
  return result;
}

//----- (0036CD7A) --------------------------------------------------------
int32 __fastcall List_c::RemoveAll(List_c *this)
{
  this->m_head = 0;
  this->m_tail = 0;
  this->m_numItems = 0;
  return 0;
}

//----- (0036CD86) --------------------------------------------------------
int32 __fastcall List_c::GetNumItems(List_c *this)
{
  return this->m_numItems;
}

//----- (0036CD8A) --------------------------------------------------------
int32 __fastcall List_c::AppendItem(List_c *this, ListItem_c *item)
{
  ListItem_c *m_tail; // r2
  List_c *p_m_next; // r3
  int32 m_numItems; // r1

  m_tail = this->m_tail;
  this->m_tail = item;
  *item = (ListItem_c)(unsigned int)m_tail;
  p_m_next = this;
  if ( m_tail )
    p_m_next = (List_c *)&m_tail->m_next;
  p_m_next->m_head = item;
  m_numItems = this->m_numItems;
  this->m_numItems = m_numItems + 1;
  return m_numItems;
}

//----- (0036CDA8) --------------------------------------------------------
int32 __fastcall List_c::InsertAfterItem(List_c *this, ListItem_c *item, ListItem_c *here)
{
  List_c *p_m_next; // r12
  ListItem_c *m_head; // r3
  bool v5; // zf
  ListItem_c *m_next; // r2
  int32 m_numItems; // r1

  p_m_next = this;
  do
  {
    m_head = p_m_next->m_head;
    v5 = p_m_next->m_head == here;
    if ( p_m_next->m_head != here )
    {
      p_m_next = (List_c *)&m_head->m_next;
      v5 = m_head == 0;
    }
  }
  while ( !v5 );
  if ( m_head )
  {
    m_next = m_head->m_next;
    m_head->m_next = item;
    item->m_prev = m_head;
    item->m_next = m_next;
    if ( !m_next )
      m_next = (ListItem_c *)&this->m_tail;
    m_next->m_prev = item;
  }
  m_numItems = this->m_numItems;
  this->m_numItems = m_numItems + 1;
  return m_numItems;
}

//----- (0036CDD6) --------------------------------------------------------
int32 __fastcall List_c::InsertBeforeItem(List_c *this, ListItem_c *item, ListItem_c *here)
{
  List_c *p_m_next; // r12
  ListItem_c v4; // r2
  bool v5; // zf
  __int64 v6; // r2
  int32 m_numItems; // r1

  p_m_next = this;
  do
  {
    v4.m_next = p_m_next->m_head;
    v5 = p_m_next->m_head == here;
    if ( p_m_next->m_head != here )
    {
      p_m_next = (List_c *)&v4.m_next->m_next;
      v5 = v4.m_next == 0;
    }
  }
  while ( !v5 );
  if ( v4.m_next )
  {
    v4.m_prev = v4.m_next->m_prev;
    v4.m_next->m_prev = item;
    *item = v4;
    v4.m_next = (ListItem_c *)this;
    if ( v4.m_prev )
      HIDWORD(v6) = v6 + 4;
    *(_DWORD *)HIDWORD(v6) = item;
  }
  m_numItems = this->m_numItems;
  this->m_numItems = m_numItems + 1;
  return m_numItems;
}

//----- (0036CE06) --------------------------------------------------------
ListItem_c *__fastcall List_c::RemoveTail(List_c *this)
{
  ListItem_c *result; // r0
  ListItem_c *m_tail; // r2
  ListItem_c *m_prev; // r3

  result = 0;
  m_tail = this->m_tail;
  if ( m_tail )
  {
    m_prev = m_tail->m_prev;
    this->m_tail = m_tail->m_prev;
    m_prev->m_next = 0;
    --this->m_numItems;
    return m_tail;
  }
  return result;
}

//----- (0036CE22) --------------------------------------------------------
ListItem_c *__fastcall List_c::GetTail(List_c *this)
{
  return this->m_tail;
}

//----- (0036CE26) --------------------------------------------------------
ListItem_c *__fastcall List_c::GetPrev(List_c *this, ListItem_c *item)
{
  return item->m_prev;
}

//----- (0036CE2A) --------------------------------------------------------
ListItem_c *__fastcall List_c::GetItemOffset(List_c *this, bool8 head, int32 offset)
{
  ListItem_c *result; // r0
  int v4; // r1
  int v5; // r1

  if ( !head )
  {
    result = this->m_tail;
    if ( offset < 1 )
      return result;
    v5 = 0;
    while ( result )
    {
      result = result->m_prev;
      if ( ++v5 >= offset )
        return result;
    }
    return 0;
  }
  result = this->m_head;
  if ( offset >= 1 )
  {
    v4 = 0;
    while ( result )
    {
      result = result->m_next;
      if ( ++v4 >= offset )
        return result;
    }
    return 0;
  }
  return result;
}

//----- (0036CE60) --------------------------------------------------------
void __fastcall TestMatrix(RwMatrix *pTempMatrix)
{
  float x; // s0
  float y; // s2
  float z; // s8
  float v4; // s10
  float v5; // s12
  float v6; // s14
  float v7; // s1
  float v8; // s3
  float v9; // s5
  float v10; // s7
  float v11; // s7
  float v12; // s7

  if ( pTempMatrix )
  {
    x = pTempMatrix->right.x;
    if ( pTempMatrix->right.x < -70000.0 )
      goto LABEL_36;
    if ( x > 70000.0 )
      goto LABEL_36;
    y = pTempMatrix->right.y;
    if ( y < -70000.0 )
      goto LABEL_36;
    if ( y > 70000.0 )
      goto LABEL_36;
    z = pTempMatrix->right.z;
    if ( z < -70000.0 )
      goto LABEL_36;
    if ( z > 70000.0 )
      goto LABEL_36;
    v4 = pTempMatrix->up.x;
    if ( v4 < -70000.0 )
      goto LABEL_36;
    if ( v4 > 70000.0 )
      goto LABEL_36;
    v5 = pTempMatrix->up.y;
    if ( v5 < -70000.0
      || v5 > 70000.0
      || (v6 = pTempMatrix->up.z, v6 < -70000.0)
      || v6 > 70000.0
      || (v7 = pTempMatrix->at.x, v7 < -70000.0)
      || v7 > 70000.0
      || (v8 = pTempMatrix->at.y, v8 < -70000.0)
      || v8 > 70000.0
      || (v9 = pTempMatrix->at.z, v9 < -70000.0)
      || v9 > 70000.0
      || (v10 = pTempMatrix->pos.x, v10 < -70000.0)
      || v10 > 70000.0
      || (v11 = pTempMatrix->pos.y, v11 < -70000.0)
      || v11 > 70000.0
      || (v12 = pTempMatrix->pos.z, v12 < -70000.0)
      || v12 > 70000.0 )
    {
LABEL_36:
      pTempMatrix->up.y = 1.0;
      pTempMatrix->up.x = 0.0;
      pTempMatrix->right.z = 0.0;
      pTempMatrix->right.x = 1.0;
      pTempMatrix->right.y = 0.0;
      pTempMatrix->up.z = 0.0;
      pTempMatrix->at.x = 0.0;
      pTempMatrix->at.y = 0.0;
      pTempMatrix->at.z = 1.0;
      pTempMatrix->pos.x = 0.0;
      pTempMatrix->pos.y = 0.0;
      pTempMatrix->pos.z = 0.0;
      pTempMatrix->flags |= 0x20003u;
    }
    else
    {
      if ( x == 0.0 && z == 0.0 )
      {
        pTempMatrix->right.x = 1.0;
        pTempMatrix->right.y = 0.0;
        pTempMatrix->right.z = 0.0;
      }
      if ( v4 == 0.0 && v6 == 0.0 )
      {
        pTempMatrix->up.x = 0.0;
        pTempMatrix->up.y = 1.0;
        pTempMatrix->up.z = 0.0;
      }
      if ( v7 == 0.0 && v9 == 0.0 )
      {
        pTempMatrix->at.x = 0.0;
        pTempMatrix->at.y = 0.0;
        pTempMatrix->at.z = 1.0;
      }
    }
  }
}

//----- (0036D05C) --------------------------------------------------------
void __fastcall FxManager_c::FxManager_c(FxManager_c *this)
{
  List_c::List_c(&this->m_fxSystemBPList);
  List_c::List_c(&this->m_fxSystemList);
  List_c::List_c(&this->m_emitterParticleList);
  FxSphere_c::FxSphere_c(&this->m_frustumInfo.m_boundingSphere);
  FxMemoryPool_c::FxMemoryPool_c(&this->m_fxMemPool);
  this->m_emitterParticles = 0;
}

//----- (0036D08E) --------------------------------------------------------
void __fastcall FxManager_c::~FxManager_c(FxManager_c *this)
{
  FxMemoryPool_c::~FxMemoryPool_c(&this->m_fxMemPool);
  List_c::~List_c(&this->m_emitterParticleList);
  List_c::~List_c(&this->m_fxSystemList);
  sub_192C04(&this->m_fxSystemBPList);
}

//----- (0036D0B6) --------------------------------------------------------
bool8 __fastcall FxManager_c::Init(FxManager_c *this)
{
  _DWORD *v2; // r0
  FxEmitterPrt_c *v3; // r6
  int v4; // r5
  ListItem_c *v5; // r0
  int v6; // r0
  int i; // r6

  FxMemoryPool_c::Init(&this->m_fxMemPool);
  this->m_currTempMatrix = 0;
  this->m_pFxMatrices[0] = RwMatrixCreate();
  this->m_pFxMatrices[1] = RwMatrixCreate();
  this->m_pFxMatrices[2] = RwMatrixCreate();
  this->m_pFxMatrices[3] = RwMatrixCreate();
  this->m_pFxMatrices[4] = RwMatrixCreate();
  this->m_pFxMatrices[5] = RwMatrixCreate();
  this->m_pFxMatrices[6] = RwMatrixCreate();
  this->m_pFxMatrices[7] = RwMatrixCreate();
  v2 = FxEmitterPrt_c::operator new[](0xEA68u);
  v3 = (FxEmitterPrt_c *)(v2 + 2);
  v4 = 60000;
  *v2 = 60;
  v2[1] = 1000;
  v5 = (ListItem_c *)(v2 + 2);
  do
  {
    ListItem_c::ListItem_c(v5);
    v4 -= 60;
    v5 = (ListItem_c *)(v6 + 60);
  }
  while ( v4 );
  this->m_emitterParticles = v3;
  List_c::AddItem(&this->m_emitterParticleList, v3);
  for ( i = 0; i != 999; ++i )
    List_c::AddItem(&this->m_emitterParticleList, &this->m_emitterParticles[i + 1]);
  return 1;
}
// 36D130: variable 'v6' is possibly undefined

//----- (0036D16A) --------------------------------------------------------
void __fastcall FxManager_c::Exit(FxManager_c *this)
{
  FxSystem_c *m_head; // r1
  FxSystem_c *m_next; // r5

  m_head = (FxSystem_c *)this->m_fxSystemList.m_head;
  if ( m_head )
  {
    do
    {
      m_next = (FxSystem_c *)m_head->m_next;
      FxManager_c::DestroyFxSystem(this, m_head);
      m_head = m_next;
    }
    while ( m_next );
  }
  List_c::RemoveAll(&this->m_fxSystemBPList);
  this->m_emitterParticles = 0;
  List_c::RemoveAll(&this->m_emitterParticleList);
  CTxdStore::RemoveTxdSlot(this->m_txdIndex);
  RwMatrixDestroy(this->m_pFxMatrices[0]);
  RwMatrixDestroy(this->m_pFxMatrices[1]);
  RwMatrixDestroy(this->m_pFxMatrices[2]);
  RwMatrixDestroy(this->m_pFxMatrices[3]);
  RwMatrixDestroy(this->m_pFxMatrices[4]);
  RwMatrixDestroy(this->m_pFxMatrices[5]);
  RwMatrixDestroy(this->m_pFxMatrices[6]);
  RwMatrixDestroy(this->m_pFxMatrices[7]);
  sub_196204(&this->m_fxMemPool);
}

//----- (0036D1E6) --------------------------------------------------------
void __fastcall FxManager_c::DestroyAllFxSystems(FxManager_c *this)
{
  FxSystem_c *m_head; // r1
  FxSystem_c *m_next; // r5

  m_head = (FxSystem_c *)this->m_fxSystemList.m_head;
  if ( m_head )
  {
    do
    {
      m_next = (FxSystem_c *)m_head->m_next;
      FxManager_c::DestroyFxSystem(this, m_head);
      m_head = m_next;
    }
    while ( m_next );
  }
}

//----- (0036D204) --------------------------------------------------------
FxFrustumInfo_c *__fastcall FxManager_c::GetFrustumInfo(FxManager_c *this)
{
  return &this->m_frustumInfo;
}

//----- (0036D208) --------------------------------------------------------
void __fastcall FxManager_c::CalcFrustumInfo(FxManager_c *this, RwCamera_0 *camPtr)
{
  float *parent; // r6
  float farPlane; // s18
  float v6; // s16
  float v7; // r0
  float v8; // s4
  float v9; // s16
  float v10; // s0
  float v11; // r0
  float v12; // s16
  float v13; // r0
  RwReal v14; // s6
  RwReal v15; // s4
  __int64 v16; // d16
  __int64 v17; // d16
  __int64 v18; // d16
  __int64 v19; // d16

  parent = (float *)camPtr->object.object.parent;
  farPlane = camPtr->farPlane;
  v6 = sqrtf((float)(camPtr->viewWindow.x * camPtr->viewWindow.x) + (float)(camPtr->viewWindow.y * camPtr->viewWindow.y));
  v7 = atan2f(v6, 1.0);
  v8 = (float)(v6 * v6) + 1.0;
  v9 = (float)(v7 * 57.296) * 0.017453;
  v10 = sinf((float)((float)((float)(v7 * 57.296) * -2.0) + 180.0) * 0.017453);
  v11 = v9;
  v12 = (float)(farPlane * sqrtf(v8)) / v10;
  v13 = sinf(v11);
  v14 = (float)(parent[14] * (float)(v13 * v12)) + parent[18];
  v15 = parent[17] + (float)(parent[13] * (float)(v13 * v12));
  this->m_frustumInfo.m_boundingSphere.m_center.x = parent[16] + (float)(parent[12] * (float)(v13 * v12));
  this->m_frustumInfo.m_boundingSphere.m_center.y = v15;
  this->m_frustumInfo.m_boundingSphere.m_center.z = v14;
  this->m_frustumInfo.m_boundingSphere.m_radius = v13 * v12;
  v16 = *(_QWORD *)&camPtr->frustumPlanes[2].plane.normal.x;
  this->m_frustumInfo.m_planes[0].m_normal.z = camPtr->frustumPlanes[2].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[0].m_normal.x = v16;
  this->m_frustumInfo.m_planes[0].m_dist = camPtr->frustumPlanes[2].plane.distance;
  v17 = *(_QWORD *)&camPtr->frustumPlanes[3].plane.normal.x;
  this->m_frustumInfo.m_planes[1].m_normal.z = camPtr->frustumPlanes[3].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[1].m_normal.x = v17;
  this->m_frustumInfo.m_planes[1].m_dist = camPtr->frustumPlanes[3].plane.distance;
  v18 = *(_QWORD *)&camPtr->frustumPlanes[4].plane.normal.x;
  this->m_frustumInfo.m_planes[2].m_normal.z = camPtr->frustumPlanes[4].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[2].m_normal.x = v18;
  this->m_frustumInfo.m_planes[2].m_dist = camPtr->frustumPlanes[4].plane.distance;
  v19 = *(_QWORD *)&camPtr->frustumPlanes[5].plane.normal.x;
  this->m_frustumInfo.m_planes[3].m_normal.z = camPtr->frustumPlanes[5].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[3].m_normal.x = v19;
  this->m_frustumInfo.m_planes[3].m_dist = camPtr->frustumPlanes[5].plane.distance;
}

//----- (0036D348) --------------------------------------------------------
void __fastcall FxManager_c::Update(FxManager_c *this, RwCamera_0 *camPtr, float deltaTime)
{
  float *parent; // r6
  float farPlane; // s18
  float v8; // s16
  float v9; // r0
  float v10; // s4
  float v11; // s16
  float v12; // s0
  float v13; // r0
  float v14; // s16
  float v15; // r0
  RwReal v16; // s6
  RwReal v17; // s4
  __int64 v18; // d16
  __int64 v19; // d16
  __int64 v20; // d16
  __int64 v21; // d16
  FxSystemBP_c *m_head; // r6
  FxSystem_c *v23; // r6
  FxSystem_c *m_next; // r5

  parent = (float *)camPtr->object.object.parent;
  farPlane = camPtr->farPlane;
  v8 = sqrtf((float)(camPtr->viewWindow.x * camPtr->viewWindow.x) + (float)(camPtr->viewWindow.y * camPtr->viewWindow.y));
  v9 = atan2f(v8, 1.0);
  v10 = (float)(v8 * v8) + 1.0;
  v11 = (float)(v9 * 57.296) * 0.017453;
  v12 = sinf((float)((float)((float)(v9 * 57.296) * -2.0) + 180.0) * 0.017453);
  v13 = v11;
  v14 = (float)(farPlane * sqrtf(v10)) / v12;
  v15 = sinf(v13);
  v16 = (float)(parent[14] * (float)(v15 * v14)) + parent[18];
  v17 = parent[17] + (float)(parent[13] * (float)(v15 * v14));
  this->m_frustumInfo.m_boundingSphere.m_center.x = parent[16] + (float)(parent[12] * (float)(v15 * v14));
  this->m_frustumInfo.m_boundingSphere.m_center.y = v17;
  this->m_frustumInfo.m_boundingSphere.m_center.z = v16;
  this->m_frustumInfo.m_boundingSphere.m_radius = v15 * v14;
  v18 = *(_QWORD *)&camPtr->frustumPlanes[2].plane.normal.x;
  this->m_frustumInfo.m_planes[0].m_normal.z = camPtr->frustumPlanes[2].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[0].m_normal.x = v18;
  this->m_frustumInfo.m_planes[0].m_dist = camPtr->frustumPlanes[2].plane.distance;
  v19 = *(_QWORD *)&camPtr->frustumPlanes[3].plane.normal.x;
  this->m_frustumInfo.m_planes[1].m_normal.z = camPtr->frustumPlanes[3].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[1].m_normal.x = v19;
  this->m_frustumInfo.m_planes[1].m_dist = camPtr->frustumPlanes[3].plane.distance;
  v20 = *(_QWORD *)&camPtr->frustumPlanes[4].plane.normal.x;
  this->m_frustumInfo.m_planes[2].m_normal.z = camPtr->frustumPlanes[4].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[2].m_normal.x = v20;
  this->m_frustumInfo.m_planes[2].m_dist = camPtr->frustumPlanes[4].plane.distance;
  v21 = *(_QWORD *)&camPtr->frustumPlanes[5].plane.normal.x;
  this->m_frustumInfo.m_planes[3].m_normal.z = camPtr->frustumPlanes[5].plane.normal.z;
  *(_QWORD *)&this->m_frustumInfo.m_planes[3].m_normal.x = v21;
  this->m_frustumInfo.m_planes[3].m_dist = camPtr->frustumPlanes[5].plane.distance;
  m_head = (FxSystemBP_c *)this->m_fxSystemBPList.m_head;
  if ( this->m_fxSystemBPList.m_head )
  {
    do
    {
      FxSystemBP_c::Update(m_head, deltaTime);
      m_head = (FxSystemBP_c *)m_head->m_next;
    }
    while ( m_head );
  }
  v23 = (FxSystem_c *)this->m_fxSystemList.m_head;
  if ( v23 )
  {
    do
    {
      m_next = (FxSystem_c *)v23->m_next;
      if ( FxSystem_c::Update(v23, camPtr, deltaTime) )
        FxManager_c::DestroyFxSystem(this, v23);
      v23 = m_next;
    }
    while ( m_next );
  }
}

//----- (0036D4D0) --------------------------------------------------------
void __fastcall FxManager_c::DestroyFxSystem(FxManager_c *this, FxSystem_c *fxSysPtr)
{
  FxSystemBP_c *m_bpPtr; // r0
  int v5; // r10
  ListItem_c *m_head; // r5
  ListItem_c *m_next; // r6
  void *v8; // r0

  m_bpPtr = fxSysPtr->m_bpPtr;
  if ( m_bpPtr->m_numFxPrimBPs >= 1 )
  {
    v5 = 0;
    do
    {
      m_head = m_bpPtr->m_fxPrimBPPtrs[v5]->m_particleList.m_head;
      if ( m_head )
      {
        do
        {
          m_next = m_head->m_next;
          if ( m_head[5].m_prev == fxSysPtr )
          {
            List_c::RemoveItem(&fxSysPtr->m_bpPtr->m_fxPrimBPPtrs[v5]->m_particleList, m_head);
            List_c::AddItem(&g_fxMan.m_emitterParticleList, m_head);
          }
          m_head = m_next;
        }
        while ( m_next );
        m_bpPtr = fxSysPtr->m_bpPtr;
      }
      ++v5;
    }
    while ( v5 < m_bpPtr->m_numFxPrimBPs );
  }
  List_c::RemoveItem(&this->m_fxSystemList, fxSysPtr);
  FxSystem_c::Exit(fxSysPtr);
  FxSystem_c::~FxSystem_c(fxSysPtr);
  sub_191374(v8);
}
// 36D550: variable 'v8' is possibly undefined

//----- (0036D558) --------------------------------------------------------
void __fastcall FxManager_c::Render(FxManager_c *this, RwCamera_0 *camPtr, bool8 doHeatHaze)
{
  float v6; // s16
  FxSystemBP_c *m_head; // r6

  v6 = CCustomBuildingDNPipeline::m_fDNBalanceParam;
  this->m_foundHeatHazeInfo = 0;
  RwRenderStateSet(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
  RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, 0);
  RwRenderStateSet(rwRENDERSTATEALPHATESTFUNCTIONREF, 0);
  m_head = (FxSystemBP_c *)this->m_fxSystemBPList.m_head;
  if ( this->m_fxSystemBPList.m_head )
  {
    do
    {
      FxSystemBP_c::Render(m_head, camPtr, (float)((float)(1.0 - v6) * 0.6) + 0.4, doHeatHaze);
      m_head = (FxSystemBP_c *)m_head->m_next;
    }
    while ( m_head );
  }
  RwRenderStateSet(rwRENDERSTATEZWRITEENABLE, (char *)&dword_0 + 1);
  sub_192840(rwRENDERSTATEZTESTENABLE, (char *)&dword_0 + 1);
}
// 0: using guessed type int dword_0;

//----- (0036D5EC) --------------------------------------------------------
void __fastcall FxManager_c::UnloadFxProject(FxManager_c *this)
{
  FxSystem_c *m_head; // r1
  FxSystem_c *m_next; // r5
  _DWORD *v4; // r0
  FxEmitterPrt_c *v5; // r8
  int v6; // r6
  ListItem_c *v7; // r0
  int v8; // r0
  int i; // r6

  m_head = (FxSystem_c *)this->m_fxSystemList.m_head;
  if ( m_head )
  {
    do
    {
      m_next = (FxSystem_c *)m_head->m_next;
      FxManager_c::DestroyFxSystem(this, m_head);
      m_head = m_next;
    }
    while ( m_next );
  }
  List_c::RemoveAll(&this->m_fxSystemBPList);
  FxMemoryPool_c::Reset(&this->m_fxMemPool);
  List_c::RemoveAll(&this->m_emitterParticleList);
  v4 = FxEmitterPrt_c::operator new[](0xEA68u);
  v5 = (FxEmitterPrt_c *)(v4 + 2);
  v6 = 60000;
  *v4 = 60;
  v4[1] = 1000;
  v7 = (ListItem_c *)(v4 + 2);
  do
  {
    ListItem_c::ListItem_c(v7);
    v6 -= 60;
    v7 = (ListItem_c *)(v8 + 60);
  }
  while ( v6 );
  this->m_emitterParticles = v5;
  List_c::AddItem(&this->m_emitterParticleList, v5);
  for ( i = 0; i != 999; ++i )
    List_c::AddItem(&this->m_emitterParticleList, &this->m_emitterParticles[i + 1]);
}
// 36D642: variable 'v8' is possibly undefined

//----- (0036D674) --------------------------------------------------------
FxSystem_c *__fastcall FxManager_c::CreateFxSystem(
        FxManager_c *this,
        unsigned __int8 *bpName,
        RwMatrix *offsetMat,
        RwMatrix *parentMat,
        int a5)
{
  uint32 UppercaseKey; // r0
  FxSystemBP_c *m_head; // r1
  unsigned __int8 s[128]; // [sp+4h] [bp-9Ch] BYREF

  UppercaseKey = CKeyGen::GetUppercaseKey(bpName);
  m_head = (FxSystemBP_c *)this->m_fxSystemBPList.m_head;
  if ( this->m_fxSystemBPList.m_head )
  {
    while ( UppercaseKey != m_head->m_hashName )
    {
      m_head = (FxSystemBP_c *)m_head->m_next;
      if ( !m_head )
        goto LABEL_6;
    }
  }
  else
  {
LABEL_6:
    sprintf(s, "Cannot Find Fx System Blueprint - %s", (const char *)bpName);
    m_head = 0;
  }
  return FxManager_c::CreateFxSystem(this, m_head, offsetMat, parentMat, a5);
}
// 36D674: using guessed type unsigned __int8 s[128];

//----- (0036D6F0) --------------------------------------------------------
FxSystem_c *__fastcall FxManager_c::CreateFxSystem(
        FxManager_c *this,
        FxSystemBP_c *fxSysBPPtr,
        RwMatrix *offsetMat,
        RwMatrix *parentMat,
        int forceCreation)
{
  FxSystem_c *v9; // r8
  FxSystem_c *v10; // r0
  FxSystem_c *v11; // r0
  int v12; // r1

  if ( !fxSysBPPtr || !FxManager_c::ShouldCreate(this, fxSysBPPtr, offsetMat, parentMat, forceCreation) )
    return 0;
  v9 = (FxSystem_c *)operator new(0x108u);
  FxSystem_c::FxSystem_c(v9);
  FxSystem_c::Init(v10, fxSysBPPtr, offsetMat, parentMat);
  List_c::AddItem(&this->m_fxSystemList, v9);
  if ( Fx_c::GetFxQuality(&g_fx) == FX_QUALITY_LOW )
  {
    v11 = v9;
    v12 = 1056964608;
    goto LABEL_10;
  }
  if ( Fx_c::GetFxQuality(&g_fx) == FX_QUALITY_MEDIUM )
  {
    v11 = v9;
    v12 = 1061158912;
LABEL_10:
    FxSystem_c::SetRateMult(v11, *(float *)&v12);
    return v9;
  }
  if ( Fx_c::GetFxQuality(&g_fx) >= FX_QUALITY_HIGH )
  {
    v11 = v9;
    v12 = 1065353216;
    goto LABEL_10;
  }
  return v9;
}
// 36D72A: variable 'v10' is possibly undefined

//----- (0036D798) --------------------------------------------------------
FxSystemBP_c *__fastcall FxManager_c::FindFxSystemBP(FxManager_c *this, unsigned __int8 *name)
{
  uint32 UppercaseKey; // r1
  FxSystemBP_c *result; // r0
  unsigned __int8 s[128]; // [sp+4h] [bp-8Ch] BYREF

  UppercaseKey = CKeyGen::GetUppercaseKey(name);
  result = (FxSystemBP_c *)this->m_fxSystemBPList.m_head;
  if ( this->m_fxSystemBPList.m_head )
  {
    while ( UppercaseKey != result->m_hashName )
    {
      result = (FxSystemBP_c *)result->m_next;
      if ( !result )
        goto LABEL_6;
    }
  }
  else
  {
LABEL_6:
    sprintf(s, "Cannot Find Fx System Blueprint - %s", (const char *)name);
    return 0;
  }
  return result;
}
// 36D798: using guessed type unsigned __int8 s[128];

//----- (0036D7F8) --------------------------------------------------------
FxSystem_c *__fastcall FxManager_c::CreateFxSystem(
        FxManager_c *this,
        unsigned __int8 *bpName,
        RwV3d_0 *offsetPos,
        RwMatrix *parentMat,
        int a5)
{
  uint32 UppercaseKey; // r0
  FxSystemBP_c *m_head; // r1
  unsigned __int8 s[128]; // [sp+4h] [bp-9Ch] BYREF

  UppercaseKey = CKeyGen::GetUppercaseKey(bpName);
  m_head = (FxSystemBP_c *)this->m_fxSystemBPList.m_head;
  if ( this->m_fxSystemBPList.m_head )
  {
    while ( UppercaseKey != m_head->m_hashName )
    {
      m_head = (FxSystemBP_c *)m_head->m_next;
      if ( !m_head )
        goto LABEL_6;
    }
  }
  else
  {
LABEL_6:
    sprintf(s, "Cannot Find Fx System Blueprint - %s", (const char *)bpName);
    m_head = 0;
  }
  return FxManager_c::CreateFxSystem(this, m_head, offsetPos, parentMat, a5);
}
// 36D7F8: using guessed type unsigned __int8 s[128];

//----- (0036D874) --------------------------------------------------------
FxSystem_c *__fastcall FxManager_c::CreateFxSystem(
        FxManager_c *this,
        FxSystemBP_c *fxSysBPPtr,
        RwV3d_0 *offsetPos,
        RwMatrix *parentMat,
        int a5)
{
  FxSystem_c *v8; // r5
  RwMatrix *v9; // r4
  FxSystem_c *v10; // r0
  FxSystem_c *v11; // r0
  int v12; // r1

  v8 = 0;
  if ( fxSysBPPtr )
  {
    v9 = g_fxMan.m_pFxMatrices[g_fxMan.m_currTempMatrix++];
    v9->up.x = 0.0;
    v9->right.y = 0.0;
    v9->right.z = 0.0;
    v9->right.x = 1.0;
    v9->up.y = 1.0;
    v9->up.z = 0.0;
    v9->at.x = 0.0;
    v9->at.y = 0.0;
    v9->at.z = 1.0;
    v9->pos.x = 0.0;
    v9->pos.y = 0.0;
    v9->pos.z = 0.0;
    v9->flags |= 0x20003u;
    v9->pos = *offsetPos;
    RwMatrixUpdate(v9);
    TestMatrix(v9);
    if ( !FxManager_c::ShouldCreate(this, fxSysBPPtr, v9, parentMat, a5) )
    {
      TestMatrix(v9);
      v8 = 0;
LABEL_12:
      --g_fxMan.m_currTempMatrix;
      return v8;
    }
    v8 = (FxSystem_c *)operator new(0x108u);
    FxSystem_c::FxSystem_c(v8);
    FxSystem_c::Init(v10, fxSysBPPtr, v9, parentMat);
    List_c::AddItem(&this->m_fxSystemList, v8);
    if ( Fx_c::GetFxQuality(&g_fx) )
    {
      if ( Fx_c::GetFxQuality(&g_fx) == FX_QUALITY_MEDIUM )
      {
        v11 = v8;
        v12 = 1061158912;
      }
      else
      {
        if ( Fx_c::GetFxQuality(&g_fx) < FX_QUALITY_HIGH )
        {
LABEL_11:
          TestMatrix(v9);
          goto LABEL_12;
        }
        v11 = v8;
        v12 = 1065353216;
      }
    }
    else
    {
      v11 = v8;
      v12 = 1056964608;
    }
    FxSystem_c::SetRateMult(v11, *(float *)&v12);
    goto LABEL_11;
  }
  return v8;
}
// 36D90C: variable 'v10' is possibly undefined

//----- (0036D99C) --------------------------------------------------------
bool __fastcall FxManager_c::ShouldCreate(
        FxManager_c *this,
        FxSystemBP_c *fxSysBPPtr,
        RwMatrix *offsetMat,
        RwMatrix *parentMat,
        int forceCreation)
{
  RwMatrix *v8; // r6
  __int64 v9; // d16
  __int64 v10; // d17
  __int64 v11; // d20
  __int64 v12; // d21
  __int64 v13; // d23
  __int64 v14; // d18
  __int64 v15; // d19
  RwV3d_0 *v16; // r0
  FxSphere_c v17; // [sp+4h] [bp-24h] BYREF

  if ( forceCreation || !fxSysBPPtr->m_boundingSphere )
    return 1;
  v8 = g_fxMan.m_pFxMatrices[g_fxMan.m_currTempMatrix++];
  if ( parentMat )
  {
    RwMatrixMultiply(v8, offsetMat, parentMat);
  }
  else
  {
    v9 = *(_QWORD *)&offsetMat->right.x;
    v10 = *(_QWORD *)&offsetMat->right.z;
    v11 = *(_QWORD *)&offsetMat->up.x;
    v12 = *(_QWORD *)&offsetMat->up.z;
    v13 = *(_QWORD *)&offsetMat->pos.z;
    v14 = *(_QWORD *)&offsetMat->at.x;
    v15 = *(_QWORD *)&offsetMat->at.z;
    *(_QWORD *)&v8->pos.x = *(_QWORD *)&offsetMat->pos.x;
    *(_QWORD *)&v8->pos.z = v13;
    *(_QWORD *)&v8->at.x = v14;
    *(_QWORD *)&v8->at.z = v15;
    *(_QWORD *)&v8->right.x = v9;
    *(_QWORD *)&v8->right.z = v10;
    *(_QWORD *)&v8->up.x = v11;
    *(_QWORD *)&v8->up.z = v12;
  }
  FxSphere_c::FxSphere_c(&v17);
  RwV3dTransformPoints(v16, &fxSysBPPtr->m_boundingSphere->m_center, 1, v8);
  v17.m_radius = fxSysBPPtr->m_boundingSphere->m_radius;
  TestMatrix(v8);
  --g_fxMan.m_currTempMatrix;
  return FxFrustumInfo_c::IsCollision(&this->m_frustumInfo, &v17) != 0;
}
// 36DA2C: variable 'v16' is possibly undefined

//----- (0036DA68) --------------------------------------------------------
RwMatrix *__fastcall FxManager_c::FxRwMatrixCreate(FxManager_c *this)
{
  int32 m_currTempMatrix; // r2
  RwMatrix *v2; // r1

  m_currTempMatrix = this->m_currTempMatrix;
  v2 = this->m_pFxMatrices[m_currTempMatrix];
  this->m_currTempMatrix = m_currTempMatrix + 1;
  return v2;
}

//----- (0036DA7E) --------------------------------------------------------
void __fastcall FxManager_c::FxRwMatrixDestroy(FxManager_c *this, RwMatrix *pTempMatrix)
{
  TestMatrix(pTempMatrix);
  --this->m_currTempMatrix;
}

//----- (0036DA96) --------------------------------------------------------
void __fastcall FxManager_c::ReturnParticle(FxManager_c *this, FxEmitterPrt_c *prtPtr)
{
  sub_1955CC(&this->m_emitterParticleList, prtPtr);
}

//----- (0036DA9C) --------------------------------------------------------
Particle_c *__fastcall FxManager_c::GetParticle(FxManager_c *this, int8 primType)
{
  if ( primType )
    return 0;
  else
    return (Particle_c *)List_c::RemoveHead(&this->m_emitterParticleList);
}

//----- (0036DAB0) --------------------------------------------------------
void __fastcall FxManager_c::SetWindData(FxManager_c *this, RwV3d_0 *dir, float *strength)
{
  this->m_windDir = dir;
  this->m_windStrength = strength;
}

//----- (0036DAB6) --------------------------------------------------------
void __fastcall FxManager_c::FreeUpParticle(FxManager_c *this)
{
  List_c *p_m_fxSystemList; // r4
  int32 NumItems; // r5
  int v3; // r1
  ListItem_c *ItemOffset; // r1

  p_m_fxSystemList = &this->m_fxSystemList;
  do
  {
    do
    {
      NumItems = List_c::GetNumItems(p_m_fxSystemList);
      v3 = rand() % NumItems;
      ItemOffset = List_c::GetItemOffset(p_m_fxSystemList, 1u, v3);
    }
    while ( (BYTE2(ItemOffset[12].m_next) & 0x20) != 0 );
  }
  while ( !FxSystemBP_c::FreePrtFromSystem((FxSystemBP_c *)ItemOffset[1].m_prev, (FxSystem_c *)ItemOffset) );
}

//----- (0036DAF8) --------------------------------------------------------
bool8 __fastcall FxMemoryPool_c::Init(FxMemoryPool_c *this)
{
  bool8 v2; // r4
  uint8 *v3; // r0

  v2 = 0;
  this->m_size = 0x80000;
  this->m_currByte = 0;
  v3 = (uint8 *)CMemoryMgr::Malloc(0x80000u);
  this->m_pMem = v3;
  if ( v3 )
  {
    memset(v3, 0, this->m_size);
    return 1;
  }
  return v2;
}

//----- (0036DB22) --------------------------------------------------------
void __fastcall FxMemoryPool_c::Exit(FxMemoryPool_c *this)
{
  uint8 *m_pMem; // r0

  m_pMem = this->m_pMem;
  if ( m_pMem )
    sub_193D14(m_pMem);
}

//----- (0036DB2E) --------------------------------------------------------
void __fastcall FxMemoryPool_c::Reset(FxMemoryPool_c *this)
{
  this->m_currByte = 0;
}

//----- (0036DB34) --------------------------------------------------------
uint8 *__fastcall FxMemoryPool_c::GetMem(FxMemoryPool_c *this, int32 numBytes, int32 alignment)
{
  unsigned int m_currByte; // r6
  uint8 *m_pMem; // r0

  m_currByte = this->m_currByte;
  if ( (int)(m_currByte % alignment) >= 1 )
  {
    m_currByte = m_currByte + alignment - m_currByte % alignment;
    this->m_currByte = m_currByte;
  }
  m_pMem = this->m_pMem;
  this->m_currByte = m_currByte + numBytes;
  return &m_pMem[m_currByte];
}

//----- (0036DB68) --------------------------------------------------------
void __fastcall FxPrimBP_c::FxPrimBP_c(FxPrimBP_c *this)
{
  RwTexture_0 **p_m_texturePtr; // r5

  this->_vptr$FxPrimBP_c = (int (**)(void))&off_665D08;
  p_m_texturePtr = &this->m_texturePtr;
  List_c::List_c(&this->m_particleList);
  *(_QWORD *)p_m_texturePtr = 0LL;
  *((_QWORD *)p_m_texturePtr + 1) = 0LL;
}
// 665D08: using guessed type void *off_665D08;

//----- (0036DB94) --------------------------------------------------------
void __fastcall FxPrimBP_c::~FxPrimBP_c(FxPrimBP_c *this)
{
  RwTexture_0 *m_texturePtr; // r0
  RwTexture_0 *m_texturePtr2; // r0
  RwTexture_0 *m_texturePtr3; // r0

  m_texturePtr = this->m_texturePtr;
  this->_vptr$FxPrimBP_c = (int (**)(void))&off_665D08;
  if ( m_texturePtr )
  {
    RwTextureDestroy(m_texturePtr);
    this->m_texturePtr = 0;
  }
  m_texturePtr2 = this->m_texturePtr2;
  if ( m_texturePtr2 )
  {
    RwTextureDestroy(m_texturePtr2);
    this->m_texturePtr2 = 0;
  }
  m_texturePtr3 = this->m_texturePtr3;
  if ( m_texturePtr3 )
  {
    RwTextureDestroy(m_texturePtr3);
    this->m_texturePtr3 = 0;
  }
  FxInfoManager_c::~FxInfoManager_c(&this->m_fxInfoMan);
  List_c::~List_c(&this->m_particleList);
}
// 665D08: using guessed type void *;

//----- (0036DBE4) --------------------------------------------------------
void __fastcall FxPrimBP_c::GetRWMatrix(FxPrimBP_c *this, RwMatrix *mat)
{
  int16 *m_matVals_i16; // r2

  m_matVals_i16 = this->m_matVals_i16;
  if ( m_matVals_i16 )
  {
    mat->right.x = (float)*m_matVals_i16 / 32767.0;
    mat->right.y = (float)this->m_matVals_i16[1] / 32767.0;
    mat->right.z = (float)this->m_matVals_i16[2] / 32767.0;
    mat->up.x = (float)this->m_matVals_i16[3] / 32767.0;
    mat->up.y = (float)this->m_matVals_i16[4] / 32767.0;
    mat->up.z = (float)this->m_matVals_i16[5] / 32767.0;
    mat->at.x = (float)this->m_matVals_i16[6] / 32767.0;
    mat->at.y = (float)this->m_matVals_i16[7] / 32767.0;
    mat->at.z = (float)this->m_matVals_i16[8] / 32767.0;
    mat->pos.x = (float)this->m_matVals_i16[9] / 32767.0;
    mat->pos.y = (float)this->m_matVals_i16[10] / 32767.0;
    mat->pos.z = (float)this->m_matVals_i16[11] / 32767.0;
  }
  else
  {
    mat->right.x = 1.0;
    mat->right.y = 0.0;
    mat->right.z = 0.0;
    mat->up.x = 0.0;
    mat->up.y = 1.0;
    mat->up.z = 0.0;
    mat->pos.x = 0.0;
    mat->pos.y = 0.0;
    mat->at.x = 0.0;
    mat->at.y = 0.0;
    mat->at.z = 1.0;
    mat->pos.z = 0.0;
  }
}

//----- (0036DD28) --------------------------------------------------------
void __fastcall FxPrim_c::FxPrim_c(FxPrim_c *this)
{
  this->m_bpPtr = 0;
  this->m_fxSysPtr = 0;
  this->m_enabled = 1;
  this->_vptr$FxPrim_c = (int (**)(void))&off_665D30;
}
// 665D30: using guessed type void *;

//----- (0036DD44) --------------------------------------------------------
void __fastcall FxPrim_c::~FxPrim_c(FxPrim_c *this)
{
  this->_vptr$FxPrim_c = (int (**)(void))&off_665D30;
  this->m_bpPtr = 0;
  this->m_fxSysPtr = 0;
}
// 665D30: using guessed type void *off_665D30;

//----- (0036DD5E) --------------------------------------------------------
void __fastcall FxPrim_c::Enable(FxPrim_c *this, bool8 on)
{
  this->m_enabled = on;
}

//----- (0036DD70) --------------------------------------------------------
void __fastcall FxSphere_c::FxSphere_c(FxSphere_c *this)
{
  this->m_lastPlaneRejected = 0;
}

//----- (0036DD78) --------------------------------------------------------
void *__fastcall FxSphere_c::operator new(size_t nSize, int32 allocMethod)
{
  if ( allocMethod )
    return sub_19CF40(nSize);
  else
    return sub_18A218(&g_fxMan.m_fxMemPool, nSize, 4);
}

//----- (0036DD9C) --------------------------------------------------------
bool8 __fastcall FxSphere_c::IsCollision(FxSphere_c *this, FxSphere_c *sphere)
{
  float v2; // s0
  float32x2_t v3; // d16
  float m_radius; // s4
  bool8 result; // r0
  float v6; // s2
  unsigned __int64 v7; // d2

  v2 = sphere->m_center.x - this->m_center.x;
  v3.n64_u64[0] = vsub_f32(*(float32x2_t *)&sphere->m_center.y, *(float32x2_t *)&this->m_center.y).n64_u64[0];
  m_radius = this->m_radius;
  result = 0;
  v6 = m_radius + sphere->m_radius;
  v7 = vmul_f32(v3, v3).n64_u64[0];
  if ( (float)((float)((float)(v2 * v2) + *(float *)&v7) + *((float *)&v7 + 1)) < (float)(v6 * v6) )
    return 1;
  return result;
}

//----- (0036DDE4) --------------------------------------------------------
float __fastcall FxSphere_c::GetDistToPlane(FxSphere_c *this, FxPlane_c *plane)
{
  return (float)((float)((float)(plane->m_normal.x * this->m_center.x) + (float)(plane->m_normal.y * this->m_center.y))
               + (float)(plane->m_normal.z * this->m_center.z))
       - plane->m_dist;
}

//----- (0036DE1E) --------------------------------------------------------
int32 __fastcall FxFrustumInfo_c::IsCollision(FxFrustumInfo_c *this, FxSphere_c *sphere)
{
  float x; // s2
  float y; // s6
  float z; // s4
  float m_radius; // s0
  int32 m_lastPlaneRejected; // r12
  int v7; // r2

  x = sphere->m_center.x;
  y = sphere->m_center.y;
  z = sphere->m_center.z;
  m_radius = sphere->m_radius;
  if ( (float)((float)((float)((float)(sphere->m_center.x - this->m_boundingSphere.m_center.x)
                             * (float)(sphere->m_center.x - this->m_boundingSphere.m_center.x))
                     + (float)((float)(y - this->m_boundingSphere.m_center.y)
                             * (float)(y - this->m_boundingSphere.m_center.y)))
             + (float)((float)(z - this->m_boundingSphere.m_center.z) * (float)(z - this->m_boundingSphere.m_center.z))) < (float)((float)(this->m_boundingSphere.m_radius + m_radius) * (float)(this->m_boundingSphere.m_radius + m_radius)) )
  {
    m_lastPlaneRejected = sphere->m_lastPlaneRejected;
    v7 = m_lastPlaneRejected & 3;
    if ( (float)((float)((float)((float)(this->m_planes[v7].m_normal.x * x) + (float)(this->m_planes[v7].m_normal.y * y))
                       + (float)(this->m_planes[v7].m_normal.z * z))
               - this->m_planes[v7].m_dist) <= m_radius )
    {
      v7 = ((_BYTE)m_lastPlaneRejected + 1) & 3;
      if ( (float)((float)((float)((float)(this->m_planes[v7].m_normal.x * x)
                                 + (float)(this->m_planes[v7].m_normal.y * y))
                         + (float)(this->m_planes[v7].m_normal.z * z))
                 - this->m_planes[v7].m_dist) <= m_radius )
      {
        v7 = ((_BYTE)m_lastPlaneRejected + 2) & 3;
        if ( (float)((float)((float)((float)(this->m_planes[v7].m_normal.x * x)
                                   + (float)(this->m_planes[v7].m_normal.y * y))
                           + (float)(this->m_planes[v7].m_normal.z * z))
                   - this->m_planes[v7].m_dist) <= m_radius )
        {
          v7 = ((_BYTE)m_lastPlaneRejected + 3) & 3;
          if ( (float)((float)((float)((float)(this->m_planes[v7].m_normal.x * x)
                                     + (float)(this->m_planes[v7].m_normal.y * y))
                             + (float)(this->m_planes[v7].m_normal.z * z))
                     - this->m_planes[v7].m_dist) <= m_radius )
            return 1;
        }
      }
    }
    sphere->m_lastPlaneRejected = v7;
  }
  return 0;
}

//----- (0036DF72) --------------------------------------------------------
void __fastcall FxSystemBP_c::FxSystemBP_c(FxSystemBP_c *this)
{
  int v1; // r0

  ListItem_c::ListItem_c(this);
  *(_DWORD *)(v1 + 32) = 0;
}
// 36DF7C: variable 'v1' is possibly undefined

//----- (0036DF84) --------------------------------------------------------
void *__fastcall FxSystemBP_c::operator new(size_t nSize)
{
  return sub_18A218(&g_fxMan.m_fxMemPool, nSize, 4);
}

//----- (0036DF9A) --------------------------------------------------------
int32 __fastcall FxSystemBP_c::Update(FxSystemBP_c *this, float deltaTime)
{
  int v4; // r6
  FxPrimBP_c *v5; // r0

  if ( this->m_numFxPrimBPs >= 1 )
  {
    v4 = 0;
    do
    {
      v5 = this->m_fxPrimBPPtrs[v4];
      (*((void (__fastcall **)(FxPrimBP_c *, _DWORD))v5->_vptr$FxPrimBP_c + 5))(v5, LODWORD(deltaTime));
      ++v4;
    }
    while ( v4 < this->m_numFxPrimBPs );
  }
  return 0;
}

//----- (0036DFD0) --------------------------------------------------------
void __fastcall FxSystemBP_c::Render(FxSystemBP_c *this, RwCamera_0 *camPtr, float brightness, bool8 doHeatHaze)
{
  int v5; // r8
  int v8; // r5
  FxPrimBP_c *v9; // r0

  v5 = doHeatHaze;
  if ( this->m_numFxPrimBPs >= 1 )
  {
    v8 = 0;
    do
    {
      v9 = this->m_fxPrimBPPtrs[v8];
      (*((void (__fastcall **)(FxPrimBP_c *, RwCamera_0 *, _DWORD, _DWORD, int))v9->_vptr$FxPrimBP_c + 6))(
        v9,
        camPtr,
        0,
        LODWORD(brightness),
        v5);
      ++v8;
    }
    while ( v8 < this->m_numFxPrimBPs );
  }
}

//----- (0036E014) --------------------------------------------------------
bool8 __fastcall FxSystemBP_c::FreePrtFromSystem(FxSystemBP_c *this, FxSystem_c *pFxSys)
{
  int v4; // r6
  FxPrimBP_c *v5; // r0

  if ( this->m_numFxPrimBPs < 1 )
    return 0;
  v4 = 0;
  while ( 1 )
  {
    v5 = this->m_fxPrimBPPtrs[v4];
    if ( (*((int (__fastcall **)(FxPrimBP_c *, FxSystem_c *))v5->_vptr$FxPrimBP_c + 7))(v5, pFxSys) )
      break;
    if ( ++v4 >= this->m_numFxPrimBPs )
      return 0;
  }
  return 1;
}

//----- (0036E054) --------------------------------------------------------
FxSphere_c *__fastcall FxSystemBP_c::GetBoundingSphere(FxSystemBP_c *this)
{
  return this->m_boundingSphere;
}

//----- (0036E058) --------------------------------------------------------
void __fastcall FxSystemBP_c::SetBoundingSphere(FxSystemBP_c *this, RwV3d_0 *center, float radius)
{
  FxSphere_c *Mem; // r0
  __int64 v7; // d16

  if ( radius > 0.0 && !this->m_boundingSphere )
  {
    Mem = (FxSphere_c *)FxMemoryPool_c::GetMem(&g_fxMan.m_fxMemPool, 20, 4);
    Mem->m_lastPlaneRejected = 0;
    this->m_boundingSphere = Mem;
    v7 = *(_QWORD *)&center->x;
    Mem->m_center.z = center->z;
    *(_QWORD *)&Mem->m_center.x = v7;
    this->m_boundingSphere->m_radius = radius;
  }
}

//----- (0036E0A8) --------------------------------------------------------
void __fastcall FxSystem_c::FxSystem_c(FxSystem_c *this)
{
  int v1; // r0
  char v2; // r2

  ListItem_c::ListItem_c(this);
  v2 = *(_BYTE *)(v1 + 102);
  *(_DWORD *)(v1 + 260) = 0;
  *(_DWORD *)(v1 + 144) = 0;
  *(_DWORD *)(v1 + 120) = 0;
  *(_DWORD *)(v1 + 8) = 0;
  *(_BYTE *)(v1 + 102) = v2 & 0xDF;
  *(_DWORD *)(v1 + 128) = &off_6677C8;
}
// 36E0B4: variable 'v1' is possibly undefined
// 6677C8: using guessed type void *;

//----- (0036E0DC) --------------------------------------------------------
void __fastcall FxSystem_c::~FxSystem_c(FxSystem_c *this)
{
  FxSphere_c *m_boundingSphere; // r0

  m_boundingSphere = this->m_boundingSphere;
  this->m_bpPtr = 0;
  if ( m_boundingSphere )
    CMemoryMgr::Free(m_boundingSphere);
  if ( *((unsigned __int8 *)this + 102) << 31 )
    RwMatrixDestroy(this->m_parentMat);
  this->m_FireAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->m_FireAudioEntity.ScratchSound);
  sub_198660(this);
}
// 667798: using guessed type void *;

//----- (0036E120) --------------------------------------------------------
void __fastcall FxSystem_c::Play(FxSystem_c *this)
{
  FxSystemBP_c *m_bpPtr; // r0
  FxSystemBP_c **p_m_bpPtr; // r5
  int v4; // r6
  FxPrim_c *v5; // r0
  float m_loopIntervalMin; // s16
  int v7; // r0
  float v8; // s2

  if ( this->m_playStatus == 2 )
  {
    p_m_bpPtr = &this->m_bpPtr;
    m_bpPtr = this->m_bpPtr;
  }
  else
  {
    p_m_bpPtr = &this->m_bpPtr;
    m_bpPtr = this->m_bpPtr;
    this->m_currTime = 0.0;
    if ( m_bpPtr->m_numFxPrimBPs >= 1 )
    {
      v4 = 0;
      do
      {
        v5 = this->m_fxPrimPtrs[v4];
        (*((void (__fastcall **)(FxPrim_c *))v5->_vptr$FxPrim_c + 4))(v5);
        m_bpPtr = this->m_bpPtr;
        ++v4;
      }
      while ( v4 < m_bpPtr->m_numFxPrimBPs );
    }
  }
  *(_WORD *)&this->m_playStatus = 0;
  m_loopIntervalMin = m_bpPtr->m_loopIntervalMin;
  v7 = rand();
  v8 = (*p_m_bpPtr)->m_loopIntervalMax - (*p_m_bpPtr)->m_loopIntervalMin;
  *((_BYTE *)this + 102) &= 0xE7u;
  this->m_loopInterval = m_loopIntervalMin + (float)((float)((float)((float)(v7 % 10000) * 0.0001) + 0.0) * v8);
}

//----- (0036E1E0) --------------------------------------------------------
void __fastcall FxSystem_c::Pause(FxSystem_c *this)
{
  int m_playStatus; // r1
  int8 v2; // r2

  m_playStatus = (unsigned __int8)this->m_playStatus;
  if ( m_playStatus != 1 )
  {
    v2 = 2;
    if ( m_playStatus == 2 )
      v2 = 0;
    this->m_playStatus = v2;
  }
}

//----- (0036E1F8) --------------------------------------------------------
void __fastcall FxSystem_c::Stop(FxSystem_c *this)
{
  FxSystemBP_c *m_bpPtr; // r1
  int v3; // r5
  FxPrim_c *v4; // r0

  m_bpPtr = this->m_bpPtr;
  this->m_currTime = 0.0;
  this->m_playStatus = 1;
  if ( m_bpPtr->m_numFxPrimBPs >= 1 )
  {
    v3 = 0;
    do
    {
      v4 = this->m_fxPrimPtrs[v3];
      (*((void (__fastcall **)(FxPrim_c *))v4->_vptr$FxPrim_c + 4))(v4);
      ++v3;
    }
    while ( v3 < this->m_bpPtr->m_numFxPrimBPs );
  }
}

//----- (0036E230) --------------------------------------------------------
void __fastcall FxSystem_c::PlayAndKill(FxSystem_c *this)
{
  FxSystemBP_c *m_bpPtr; // r0
  FxSystemBP_c **p_m_bpPtr; // r5
  int v4; // r6
  FxPrim_c *v5; // r0
  float m_loopIntervalMin; // s16
  float v7; // s0
  FxSystemBP_c *v8; // r0
  float m_loopIntervalMax; // s4
  float v10; // s2

  if ( this->m_playStatus == 2 )
  {
    p_m_bpPtr = &this->m_bpPtr;
    m_bpPtr = this->m_bpPtr;
  }
  else
  {
    p_m_bpPtr = &this->m_bpPtr;
    m_bpPtr = this->m_bpPtr;
    this->m_currTime = 0.0;
    if ( m_bpPtr->m_numFxPrimBPs >= 1 )
    {
      v4 = 0;
      do
      {
        v5 = this->m_fxPrimPtrs[v4];
        (*((void (__fastcall **)(FxPrim_c *))v5->_vptr$FxPrim_c + 4))(v5);
        m_bpPtr = this->m_bpPtr;
        ++v4;
      }
      while ( v4 < m_bpPtr->m_numFxPrimBPs );
    }
  }
  *(_WORD *)&this->m_playStatus = 0;
  m_loopIntervalMin = m_bpPtr->m_loopIntervalMin;
  v7 = (float)(rand() % 10000);
  v8 = *p_m_bpPtr;
  m_loopIntervalMax = (*p_m_bpPtr)->m_loopIntervalMax;
  v10 = (*p_m_bpPtr)->m_loopIntervalMin;
  *((_BYTE *)this + 102) &= 0xE7u;
  this->m_loopInterval = m_loopIntervalMin
                       + (float)((float)((float)(v7 * 0.0001) + 0.0) * (float)(m_loopIntervalMax - v10));
  if ( !v8->m_playMode )
    this->m_killStatus = 1;
}

//----- (0036E2FC) --------------------------------------------------------
void __fastcall FxSystem_c::Kill(FxSystem_c *this)
{
  FxSystemBP_c *m_bpPtr; // r1
  int v3; // r5
  FxPrim_c *v4; // r0

  m_bpPtr = this->m_bpPtr;
  this->m_currTime = 0.0;
  this->m_playStatus = 1;
  if ( m_bpPtr->m_numFxPrimBPs >= 1 )
  {
    v3 = 0;
    do
    {
      v4 = this->m_fxPrimPtrs[v3];
      (*((void (__fastcall **)(FxPrim_c *))v4->_vptr$FxPrim_c + 4))(v4);
      ++v3;
    }
    while ( v3 < this->m_bpPtr->m_numFxPrimBPs );
  }
  this->m_killStatus = 2;
}

//----- (0036E338) --------------------------------------------------------
void __fastcall FxSystem_c::AttachToBone(FxSystem_c *this, CEntity *pEntity, int32 boneTag)
{
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r4
  RwInt32 v7; // r5
  RwMatrix *v8; // r0

  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)pEntity->m_pRwObject);
  v7 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, boneTag);
  v8 = &RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump)[v7];
  this->m_parentMat = v8;
  TestMatrix(v8);
  this->m_pEntity = pEntity;
}

//----- (0036E374) --------------------------------------------------------
void __fastcall FxSystem_c::AddParticle(
        FxSystem_c *this,
        RwV3d_0 *pos,
        RwV3d_0 *vel,
        float timeSince,
        FxPrtMult_c *fxMults,
        float zRot,
        float lightMult,
        float lightMultLimit,
        int createLocal)
{
  int v13; // s0
  FxQuality_e FxQuality; // r0
  float v15; // s16
  FxSystemBP_c *m_bpPtr; // r1
  int v17; // r5
  FxPrim_c *v18; // r0

  v13 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0);
  if ( Fx_c::GetFxQuality(&g_fx) || v13 >= 50 )
  {
    FxQuality = Fx_c::GetFxQuality(&g_fx);
    if ( v13 > 24 || FxQuality != FX_QUALITY_MEDIUM )
    {
      v15 = 1.0;
      m_bpPtr = this->m_bpPtr;
      if ( lightMult < lightMultLimit )
        v15 = (float)(1.0 - lightMultLimit) + lightMult;
      if ( m_bpPtr->m_numFxPrimBPs >= 1 )
      {
        v17 = 0;
        do
        {
          v18 = this->m_fxPrimPtrs[v17];
          if ( v18->m_enabled )
          {
            (*((void (__fastcall **)(FxPrim_c *, RwV3d_0 *, RwV3d_0 *, _DWORD, FxPrtMult_c *, _DWORD, float, int))v18->_vptr$FxPrim_c
             + 5))(
              v18,
              pos,
              vel,
              LODWORD(timeSince),
              fxMults,
              LODWORD(zRot),
              COERCE_FLOAT(LODWORD(v15)),
              createLocal);
            m_bpPtr = this->m_bpPtr;
          }
          ++v17;
        }
        while ( v17 < m_bpPtr->m_numFxPrimBPs );
      }
    }
  }
}

//----- (0036E45C) --------------------------------------------------------
void __fastcall FxSystem_c::AddParticle(
        FxSystem_c *this,
        RwMatrix *mat,
        RwV3d_0 *vel,
        float timeSince,
        FxPrtMult_c *fxMults,
        float zRot,
        float lightMult,
        float lightMultLimit,
        int createLocal)
{
  int v13; // s0
  FxQuality_e FxQuality; // r0
  float v15; // s16
  int v16; // r5
  FxPrim_c *v17; // r0

  v13 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0);
  if ( Fx_c::GetFxQuality(&g_fx) || v13 >= 50 )
  {
    FxQuality = Fx_c::GetFxQuality(&g_fx);
    if ( v13 > 24 || FxQuality != FX_QUALITY_MEDIUM )
    {
      v15 = 1.0;
      if ( lightMult < lightMultLimit )
        v15 = (float)(1.0 - lightMultLimit) + lightMult;
      if ( this->m_bpPtr->m_numFxPrimBPs >= 1 )
      {
        v16 = 0;
        do
        {
          v17 = this->m_fxPrimPtrs[v16];
          (*((void (__fastcall **)(FxPrim_c *, RwMatrix *, RwV3d_0 *, _DWORD, FxPrtMult_c *, _DWORD, float, int))v17->_vptr$FxPrim_c
           + 6))(
            v17,
            mat,
            vel,
            LODWORD(timeSince),
            fxMults,
            LODWORD(zRot),
            COERCE_FLOAT(LODWORD(v15)),
            createLocal);
          ++v16;
        }
        while ( v16 < this->m_bpPtr->m_numFxPrimBPs );
      }
    }
  }
}

//----- (0036E540) --------------------------------------------------------
void __fastcall FxSystem_c::EnablePrim(FxSystem_c *this, int32 primId, bool8 on)
{
  sub_18C200(this->m_fxPrimPtrs[primId], on);
}

//----- (0036E54C) --------------------------------------------------------
void __fastcall FxSystem_c::SetMatrix(FxSystem_c *this, RwMatrix *mat)
{
  RwMatrix *m_parentMat; // r1
  __int64 v5; // d16
  __int64 v6; // d17
  __int64 v7; // d20
  __int64 v8; // d21
  __int64 v9; // d23
  __int64 v10; // d18
  __int64 v11; // d19

  TestMatrix(mat);
  if ( *((unsigned __int8 *)this + 102) << 31 )
  {
    m_parentMat = this->m_parentMat;
    v5 = *(_QWORD *)&mat->right.x;
    v6 = *(_QWORD *)&mat->right.z;
    v7 = *(_QWORD *)&mat->up.x;
    v8 = *(_QWORD *)&mat->up.z;
    v9 = *(_QWORD *)&mat->pos.z;
    v10 = *(_QWORD *)&mat->at.x;
    v11 = *(_QWORD *)&mat->at.z;
    *(_QWORD *)&m_parentMat->pos.x = *(_QWORD *)&mat->pos.x;
    *(_QWORD *)&m_parentMat->pos.z = v9;
    *(_QWORD *)&m_parentMat->at.x = v10;
    *(_QWORD *)&m_parentMat->at.z = v11;
    *(_QWORD *)&m_parentMat->right.x = v5;
    *(_QWORD *)&m_parentMat->right.z = v6;
    m_parentMat = (RwMatrix *)((char *)m_parentMat + 16);
    *(_QWORD *)&m_parentMat->right.x = v7;
    *(_QWORD *)&m_parentMat->right.z = v8;
  }
  else
  {
    this->m_parentMat = mat;
  }
}

//----- (0036E59C) --------------------------------------------------------
void __fastcall FxSystem_c::SetOffsetPos(FxSystem_c *this, RwV3d_0 *pos)
{
  this->m_offsetMat.pos = *pos;
  sub_196158(&this->m_offsetMat);
}

//----- (0036E5AE) --------------------------------------------------------
void __fastcall FxSystem_c::AddOffsetPos(FxSystem_c *this, RwV3d_0 *pos)
{
  float y; // s2
  float z; // s4

  y = this->m_offsetMat.pos.y;
  z = this->m_offsetMat.pos.z;
  this->m_offsetMat.pos.x = pos->x + this->m_offsetMat.pos.x;
  this->m_offsetMat.pos.y = pos->y + y;
  this->m_offsetMat.pos.z = pos->z + z;
  sub_196158(&this->m_offsetMat);
}

//----- (0036E5E4) --------------------------------------------------------
void __fastcall FxSystem_c::SetConstTime(FxSystem_c *this, bool8 on, float time)
{
  this->m_useConstTime = on;
  this->m_constTime_ui16 = (unsigned int)(float)(time * 256.0);
}

//----- (0036E608) --------------------------------------------------------
void __fastcall FxSystem_c::SetRateMult(FxSystem_c *this, float rateMult)
{
  this->m_rateMult_ui16 = (int)(float)(rateMult * 1000.0);
}

//----- (0036E628) --------------------------------------------------------
void __fastcall FxSystem_c::SetTimeMult(FxSystem_c *this, float timeMult)
{
  this->m_timeMult_ui16 = (int)(float)(timeMult * 1000.0);
}

//----- (0036E648) --------------------------------------------------------
void __fastcall FxSystem_c::SetVelAdd(FxSystem_c *this, RwV3d_0 *vel)
{
  __int64 v2; // d16

  v2 = *(_QWORD *)&vel->x;
  this->m_velAdd.z = vel->z;
  *(_QWORD *)&this->m_velAdd.x = v2;
}

//----- (0036E656) --------------------------------------------------------
bool8 __fastcall FxSystem_c::Init(FxSystem_c *this, FxSystemBP_c *fxSysBPPtr, RwMatrix *offsetMat, RwMatrix *parentMat)
{
  __int64 v6; // d17
  RwMatrix *p_m_offsetMat; // r8
  __int64 v8; // d18
  __int64 v9; // d19
  __int64 v10; // d22
  __int64 v11; // d23
  RwV3d_0 *p_pos; // r0
  __int64 v13; // d20
  __int64 v14; // d21
  char v15; // r0
  FxSphere_c *v16; // r0
  FxSphere_c *m_boundingSphere; // r1
  __int64 v18; // d16
  __int64 v19; // d17
  int32 m_lastPlaneRejected; // r1
  __int64 v21; // r0
  int v22; // r6
  FxPrimBP_c *v23; // r0
  FxPrim_c *v24; // r0

  this->m_bpPtr = fxSysBPPtr;
  v6 = *(_QWORD *)&offsetMat->right.z;
  p_m_offsetMat = &this->m_offsetMat;
  v8 = *(_QWORD *)&offsetMat->pos.x;
  v9 = *(_QWORD *)&offsetMat->pos.z;
  v10 = *(_QWORD *)&offsetMat->up.x;
  v11 = *(_QWORD *)&offsetMat->up.z;
  p_pos = &this->m_offsetMat.pos;
  v13 = *(_QWORD *)&offsetMat->at.x;
  v14 = *(_QWORD *)&offsetMat->at.z;
  *(_QWORD *)&p_m_offsetMat->right.x = *(_QWORD *)&offsetMat->right.x;
  *(_QWORD *)&this->m_offsetMat.right.z = v6;
  *(_QWORD *)&p_pos->x = v8;
  *(_QWORD *)&p_pos->z = v9;
  *(_QWORD *)&this->m_offsetMat.at.x = v13;
  *(_QWORD *)&this->m_offsetMat.at.z = v14;
  this->m_parentMat = parentMat;
  *(_QWORD *)&this->m_offsetMat.up.x = v10;
  *(_QWORD *)&this->m_offsetMat.up.z = v11;
  TestMatrix(parentMat);
  this->m_currTime = 0.0;
  this->m_pEntity = 0;
  *(_WORD *)&this->m_playStatus = 1;
  this->m_useConstTime = 0;
  this->m_constTime_ui16 = 0;
  v15 = *((_BYTE *)this + 102);
  this->m_rateMult_ui16 = 1000;
  this->m_timeMult_ui16 = 1000;
  this->m_velAdd.x = 0.0;
  this->m_velAdd.y = 0.0;
  this->m_velAdd.z = 0.0;
  this->m_boundingSphere = 0;
  *((_BYTE *)this + 102) = v15 & 0xF8 | 4;
  if ( fxSysBPPtr->m_boundingSphere )
  {
    v16 = (FxSphere_c *)CMemoryMgr::Malloc(0x14u);
    v16->m_lastPlaneRejected = 0;
    this->m_boundingSphere = v16;
    m_boundingSphere = fxSysBPPtr->m_boundingSphere;
    v18 = *(_QWORD *)&m_boundingSphere->m_center.x;
    v19 = *(_QWORD *)&m_boundingSphere->m_center.z;
    m_lastPlaneRejected = m_boundingSphere->m_lastPlaneRejected;
    *(_QWORD *)&v16->m_center.x = v18;
    *(_QWORD *)&v16->m_center.z = v19;
    v16->m_lastPlaneRejected = m_lastPlaneRejected;
  }
  v21 = 4LL * (unsigned int)fxSysBPPtr->m_numFxPrimBPs;
  if ( !is_mul_ok(4u, fxSysBPPtr->m_numFxPrimBPs) )
    HIDWORD(v21) = 1;
  if ( HIDWORD(v21) )
    LODWORD(v21) = -1;
  this->m_fxPrimPtrs = (FxPrim_c **)operator new[](v21);
  if ( fxSysBPPtr->m_numFxPrimBPs >= 1 )
  {
    v22 = 0;
    do
    {
      v23 = fxSysBPPtr->m_fxPrimBPPtrs[v22];
      this->m_fxPrimPtrs[v22] = (FxPrim_c *)(*((int (__fastcall **)(FxPrimBP_c *))v23->_vptr$FxPrimBP_c + 4))(v23);
      v24 = this->m_fxPrimPtrs[v22];
      (*((void (__fastcall **)(FxPrim_c *, FxPrimBP_c *, FxSystem_c *))v24->_vptr$FxPrim_c + 2))(
        v24,
        fxSysBPPtr->m_fxPrimBPPtrs[v22++],
        this);
    }
    while ( v22 < fxSysBPPtr->m_numFxPrimBPs );
  }
  CAEFireAudioEntity::Initialise(&this->m_FireAudioEntity, this);
  TestMatrix(p_m_offsetMat);
  return 1;
}

//----- (0036E76A) --------------------------------------------------------
void __fastcall FxSystem_c::Exit(FxSystem_c *this)
{
  FxSystemBP_c *m_bpPtr; // r2
  FxPrim_c **m_fxPrimPtrs; // r0
  int v4; // r5
  FxPrim_c *v5; // r1

  m_bpPtr = this->m_bpPtr;
  m_fxPrimPtrs = this->m_fxPrimPtrs;
  if ( m_bpPtr->m_numFxPrimBPs >= 1 )
  {
    v4 = 0;
    do
    {
      v5 = m_fxPrimPtrs[v4];
      if ( v5 )
      {
        (*((void (__fastcall **)(FxPrim_c *))v5->_vptr$FxPrim_c + 1))(m_fxPrimPtrs[v4]);
        m_bpPtr = this->m_bpPtr;
        m_fxPrimPtrs = this->m_fxPrimPtrs;
      }
      ++v4;
    }
    while ( v4 < m_bpPtr->m_numFxPrimBPs );
  }
  if ( m_fxPrimPtrs )
    operator delete[](m_fxPrimPtrs);
  sub_18C878(&this->m_FireAudioEntity);
}

//----- (0036E7B0) --------------------------------------------------------
bool8 __fastcall FxSystem_c::IsVisible(FxSystem_c *this)
{
  FxFrustumInfo_c *FrustumInfo; // r0
  bool8 result; // r0
  FxSphere_c bSphere; // [sp+4h] [bp-1Ch] BYREF

  bSphere.m_lastPlaneRejected = 0;
  result = 1;
  if ( FxSystem_c::GetBoundingSphereWld(this, &bSphere) )
  {
    FrustumInfo = FxManager_c::GetFrustumInfo(&g_fxMan);
    if ( !FxFrustumInfo_c::IsCollision(FrustumInfo, &bSphere) )
      return 0;
  }
  return result;
}

//----- (0036E7E4) --------------------------------------------------------
bool8 __fastcall FxSystem_c::GetBoundingSphereWld(FxSystem_c *this, FxSphere_c *bSphere)
{
  RwMatrix *v4; // r6
  RwMatrix *m_parentMat; // r0
  bool8 v6; // r4
  __int64 v7; // d16
  __int64 v8; // d17
  __int64 v9; // d20
  __int64 v10; // d21
  __int64 v11; // d23
  __int64 v12; // d18
  __int64 v13; // d19

  if ( !this->m_boundingSphere )
    return 0;
  v4 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
  TestMatrix(&this->m_offsetMat);
  m_parentMat = this->m_parentMat;
  if ( m_parentMat )
  {
    TestMatrix(m_parentMat);
    RwMatrixMultiply(v4, &this->m_offsetMat, this->m_parentMat);
  }
  else
  {
    v7 = *(_QWORD *)&this->m_offsetMat.right.x;
    v8 = *(_QWORD *)&this->m_offsetMat.right.z;
    v9 = *(_QWORD *)&this->m_offsetMat.up.x;
    v10 = *(_QWORD *)&this->m_offsetMat.up.z;
    v11 = *(_QWORD *)&this->m_offsetMat.pos.z;
    v12 = *(_QWORD *)&this->m_offsetMat.at.x;
    v13 = *(_QWORD *)&this->m_offsetMat.at.z;
    *(_QWORD *)&v4->pos.x = *(_QWORD *)&this->m_offsetMat.pos.x;
    *(_QWORD *)&v4->pos.z = v11;
    *(_QWORD *)&v4->at.x = v12;
    *(_QWORD *)&v4->at.z = v13;
    *(_QWORD *)&v4->right.x = v7;
    *(_QWORD *)&v4->right.z = v8;
    *(_QWORD *)&v4->up.x = v9;
    *(_QWORD *)&v4->up.z = v10;
  }
  TestMatrix(v4);
  v6 = 1;
  RwV3dTransformPoints(&bSphere->m_center, &this->m_boundingSphere->m_center, 1, v4);
  bSphere->m_radius = this->m_boundingSphere->m_radius;
  FxManager_c::FxRwMatrixDestroy(&g_fxMan, v4);
  return v6;
}

//----- (0036E890) --------------------------------------------------------
bool8 __fastcall FxSystem_c::Update(FxSystem_c *this, RwCamera_0 *camPtr, float deltaTime)
{
  int m_killStatus; // r0
  RwMatrix *v8; // r8
  RwMatrix *m_parentMat; // r0
  __int64 v10; // d16
  __int64 v11; // d17
  __int64 v12; // d20
  __int64 v13; // d21
  __int64 v14; // d23
  __int64 v15; // d18
  __int64 v16; // d19
  float m_distToCam; // s16
  float *parent; // r5
  float y; // s2
  float v20; // s8
  float z; // s4
  float v22; // s10
  RwReal v23; // r0
  FxSystemBP_c *m_bpPtr; // r1
  float v25; // s18
  FxFrustumInfo_c *FrustumInfo; // r0
  int8 *p_m_playStatus; // r10
  char v28; // r5
  FxSystemBP_c *v29; // r0
  int v30; // r6
  FxPrim_c *v31; // r0
  float v32; // s16
  int v33; // r0
  float v34; // s2
  float v35; // s16
  float v36; // s0
  FxSystemBP_c *v37; // r0
  float m_length; // s2
  float v39; // s2
  float m_loopIntervalMin; // s18
  float v41; // s0
  float m_loopIntervalMax; // s4
  float v43; // s2
  float v44; // s2
  int v45; // r5
  int v46; // r6
  FxPrim_c *v47; // r0
  int v48; // r5
  FxPrim_c *v49; // r0
  float v50; // s0
  int v51; // r6
  FxPrim_c *v52; // r0
  RwV3d_0 v53; // [sp+0h] [bp-50h] BYREF
  FxSphere_c bSphere; // [sp+Ch] [bp-44h] BYREF

  m_killStatus = (unsigned __int8)this->m_killStatus;
  if ( m_killStatus == 3 )
    return 1;
  if ( m_killStatus != 2 )
  {
    v8 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
    TestMatrix(&this->m_offsetMat);
    m_parentMat = this->m_parentMat;
    if ( m_parentMat )
    {
      TestMatrix(m_parentMat);
      RwMatrixMultiply(v8, &this->m_offsetMat, this->m_parentMat);
    }
    else
    {
      v10 = *(_QWORD *)&this->m_offsetMat.right.x;
      v11 = *(_QWORD *)&this->m_offsetMat.right.z;
      v12 = *(_QWORD *)&this->m_offsetMat.up.x;
      v13 = *(_QWORD *)&this->m_offsetMat.up.z;
      v14 = *(_QWORD *)&this->m_offsetMat.pos.z;
      v15 = *(_QWORD *)&this->m_offsetMat.at.x;
      v16 = *(_QWORD *)&this->m_offsetMat.at.z;
      *(_QWORD *)&v8->pos.x = *(_QWORD *)&this->m_offsetMat.pos.x;
      *(_QWORD *)&v8->pos.z = v14;
      *(_QWORD *)&v8->at.x = v15;
      *(_QWORD *)&v8->at.z = v16;
      *(_QWORD *)&v8->right.x = v10;
      *(_QWORD *)&v8->right.z = v11;
      *(_QWORD *)&v8->up.x = v12;
      *(_QWORD *)&v8->up.z = v13;
    }
    TestMatrix(v8);
    m_distToCam = this->m_distToCam;
    parent = (float *)camPtr->object.object.parent;
    FxManager_c::FxRwMatrixDestroy(&g_fxMan, v8);
    y = v8->pos.y;
    v20 = parent[17];
    z = v8->pos.z;
    v22 = parent[18];
    v53.x = parent[16] - v8->pos.x;
    v53.y = v20 - y;
    v53.z = v22 - z;
    v23 = RwV3dLength(&v53);
    m_bpPtr = this->m_bpPtr;
    this->m_distToCam = v23;
    v25 = (float)m_bpPtr->m_cullDist_ui16 * 0.0039062;
    if ( m_bpPtr->m_playMode
      && (v23 >= v25
       || (bSphere.m_lastPlaneRejected = 0, FxSystem_c::GetBoundingSphereWld(this, &bSphere))
       && (FrustumInfo = FxManager_c::GetFrustumInfo(&g_fxMan), !FxFrustumInfo_c::IsCollision(FrustumInfo, &bSphere))) )
    {
      v28 = 1;
    }
    else
    {
      p_m_playStatus = &this->m_playStatus;
      if ( !this->m_playStatus )
      {
        v35 = (float)((float)this->m_timeMult_ui16 / 1000.0) * deltaTime;
        if ( this->m_useConstTime )
          v36 = (float)this->m_constTime_ui16 * 0.0039062;
        else
          v36 = v35 + this->m_currTime;
        this->m_currTime = v36;
        v37 = this->m_bpPtr;
        if ( v37->m_playMode == 2 && v37->m_loopIntervalMin > 0.0 )
        {
          m_length = v37->m_length;
          if ( v36 > m_length )
          {
            *((_BYTE *)this + 102) |= 8u;
            m_length = v37->m_length;
          }
          v39 = m_length + this->m_loopInterval;
          if ( v36 > v39 )
          {
            this->m_currTime = v36 - v39;
            m_loopIntervalMin = v37->m_loopIntervalMin;
            v41 = (float)(rand() % 10000);
            v37 = this->m_bpPtr;
            m_loopIntervalMax = v37->m_loopIntervalMax;
            v43 = v37->m_loopIntervalMin;
            *((_BYTE *)this + 102) &= ~8u;
            this->m_loopInterval = m_loopIntervalMin
                                 + (float)((float)((float)(v41 * 0.0001) + 0.0) * (float)(m_loopIntervalMax - v43));
          }
        }
        else
        {
          v44 = v37->m_length;
          if ( v36 > v44 )
          {
            switch ( v37->m_playMode )
            {
              case 0:
                this->m_playStatus = 1;
                this->m_currTime = 0.0;
                v45 = (unsigned __int8)this->m_killStatus;
                if ( v37->m_numFxPrimBPs >= 1 )
                {
                  v46 = 0;
                  do
                  {
                    v47 = this->m_fxPrimPtrs[v46];
                    (*((void (__fastcall **)(FxPrim_c *))v47->_vptr$FxPrim_c + 4))(v47);
                    v37 = this->m_bpPtr;
                    ++v46;
                  }
                  while ( v46 < v37->m_numFxPrimBPs );
                }
                if ( v45 == 1 )
                  this->m_killStatus = 2;
                break;
              case 1:
                this->m_currTime = v44;
                break;
              case 2:
                this->m_currTime = v36 - v44;
                break;
              case 3:
                this->m_currTime = 0.0;
                this->m_playStatus = 1;
                if ( v37->m_numFxPrimBPs >= 1 )
                {
                  v48 = 0;
                  do
                  {
                    v49 = this->m_fxPrimPtrs[v48];
                    (*((void (__fastcall **)(FxPrim_c *))v49->_vptr$FxPrim_c + 4))(v49);
                    v37 = this->m_bpPtr;
                    ++v48;
                  }
                  while ( v48 < v37->m_numFxPrimBPs );
                }
                break;
              default:
                break;
            }
          }
        }
        v50 = v35 + 0.25;
        if ( (*((_BYTE *)this + 102) & 0x10) == 0 )
          v50 = v35;
        if ( v37->m_numFxPrimBPs >= 1 )
        {
          v51 = 0;
          do
          {
            v52 = this->m_fxPrimPtrs[v51];
            (*((void (__fastcall **)(FxPrim_c *, _DWORD, float))v52->_vptr$FxPrim_c + 3))(
              v52,
              LODWORD(this->m_currTime),
              COERCE_FLOAT(LODWORD(v50)));
            ++v51;
          }
          while ( v51 < this->m_bpPtr->m_numFxPrimBPs );
        }
        v28 = 0;
        goto LABEL_51;
      }
      v28 = 0;
    }
    p_m_playStatus = &this->m_playStatus;
    if ( this->m_playStatus == 1 && m_distToCam >= v25 && this->m_distToCam < v25 )
    {
      v29 = this->m_bpPtr;
      if ( v29->m_playMode == 3 )
      {
        this->m_currTime = 0.0;
        if ( v29->m_numFxPrimBPs >= 1 )
        {
          v30 = 0;
          do
          {
            v31 = this->m_fxPrimPtrs[v30];
            (*((void (__fastcall **)(FxPrim_c *))v31->_vptr$FxPrim_c + 4))(v31);
            v29 = this->m_bpPtr;
            ++v30;
          }
          while ( v30 < v29->m_numFxPrimBPs );
        }
        *(_WORD *)&this->m_playStatus = 0;
        v32 = v29->m_loopIntervalMin;
        v33 = rand();
        v34 = this->m_bpPtr->m_loopIntervalMax - this->m_bpPtr->m_loopIntervalMin;
        *((_BYTE *)this + 102) &= 0xE7u;
        this->m_loopInterval = v32 + (float)((float)((float)((float)(v33 % 10000) * 0.0001) + 0.0) * v34);
      }
    }
LABEL_51:
    *((_BYTE *)this + 102) = *((_BYTE *)this + 102) & 0xEF | (16 * v28);
    if ( !*p_m_playStatus )
      FxSystem_c::DoFxAudio(this, (CVector)v8->pos);
    return 0;
  }
  this->m_killStatus = 3;
  return 0;
}

//----- (0036EC98) --------------------------------------------------------
void __fastcall FxSystem_c::GetCompositeMatrix(FxSystem_c *this, RwMatrix *compMat)
{
  RwMatrix *p_m_offsetMat; // r5
  RwMatrix *m_parentMat; // r0
  __int64 v6; // d16
  __int64 v7; // d17
  __int64 v8; // d20
  __int64 v9; // d21
  __int64 v10; // d23
  __int64 v11; // d18
  __int64 v12; // d19

  p_m_offsetMat = &this->m_offsetMat;
  TestMatrix(&this->m_offsetMat);
  m_parentMat = this->m_parentMat;
  if ( m_parentMat )
  {
    TestMatrix(m_parentMat);
    RwMatrixMultiply(compMat, p_m_offsetMat, this->m_parentMat);
  }
  else
  {
    v6 = *(_QWORD *)&p_m_offsetMat->right.x;
    v7 = *(_QWORD *)&p_m_offsetMat->right.z;
    v8 = *(_QWORD *)&p_m_offsetMat->up.x;
    v9 = *(_QWORD *)&p_m_offsetMat->up.z;
    v10 = *(_QWORD *)&p_m_offsetMat->pos.z;
    v11 = *(_QWORD *)&p_m_offsetMat->at.x;
    v12 = *(_QWORD *)&p_m_offsetMat->at.z;
    *(_QWORD *)&compMat->pos.x = *(_QWORD *)&p_m_offsetMat->pos.x;
    *(_QWORD *)&compMat->pos.z = v10;
    *(_QWORD *)&compMat->at.x = v11;
    *(_QWORD *)&compMat->at.z = v12;
    *(_QWORD *)&compMat->right.x = v6;
    *(_QWORD *)&compMat->right.z = v7;
    *(_QWORD *)&compMat->up.x = v8;
    *(_QWORD *)&compMat->up.z = v9;
  }
  sub_190FEC(compMat);
}

//----- (0036ED04) --------------------------------------------------------
void __fastcall FxSystem_c::DoFxAudio(FxSystem_c *this, CVector fxPos)
{
  uint32 UppercaseKey; // r8
  uint32 v4; // r6
  uint32 v5; // r5
  uint32 v6; // r11
  uint32 v7; // r10
  uint32 v8; // r9
  uint32 m_hashName; // r0
  uint32 v10; // [sp+4h] [bp-44h]
  uint32 v11; // [sp+8h] [bp-40h]
  uint32 v12; // [sp+Ch] [bp-3Ch]
  uint32 v13; // [sp+10h] [bp-38h]
  uint32 v14; // [sp+14h] [bp-34h]
  uint32 v15; // [sp+18h] [bp-30h]
  uint32 v16; // [sp+1Ch] [bp-2Ch]
  CVector vPosition; // [sp+20h] [bp-28h] BYREF

  vPosition = fxPos;
  UppercaseKey = CKeyGen::GetUppercaseKey("fire");
  v4 = CKeyGen::GetUppercaseKey("fire_med");
  v5 = CKeyGen::GetUppercaseKey("fire_large");
  v6 = CKeyGen::GetUppercaseKey("fire_car");
  v7 = CKeyGen::GetUppercaseKey("fire_bike");
  v8 = CKeyGen::GetUppercaseKey("Flame");
  v10 = CKeyGen::GetUppercaseKey("molotov_flame");
  v11 = CKeyGen::GetUppercaseKey("water_hydrant");
  v12 = CKeyGen::GetUppercaseKey("water_fountain");
  v13 = CKeyGen::GetUppercaseKey("water_fnt_tme");
  v14 = CKeyGen::GetUppercaseKey("smoke_flare");
  v15 = CKeyGen::GetUppercaseKey("teargas");
  v16 = CKeyGen::GetUppercaseKey("heli_dust");
  m_hashName = this->m_bpPtr->m_hashName;
  if ( m_hashName == UppercaseKey )
  {
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 130, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
    if ( m_hashName != v4 )
    {
LABEL_3:
      if ( m_hashName != v5 )
        goto LABEL_4;
      goto LABEL_25;
    }
  }
  else if ( m_hashName != v4 )
  {
    goto LABEL_3;
  }
  CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 131, &vPosition);
  m_hashName = this->m_bpPtr->m_hashName;
  if ( m_hashName != v5 )
  {
LABEL_4:
    if ( m_hashName != v6 )
      goto LABEL_5;
    goto LABEL_26;
  }
LABEL_25:
  CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 132, &vPosition);
  m_hashName = this->m_bpPtr->m_hashName;
  if ( m_hashName != v6 )
  {
LABEL_5:
    if ( m_hashName != v7 )
      goto LABEL_6;
    goto LABEL_27;
  }
LABEL_26:
  CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 133, &vPosition);
  m_hashName = this->m_bpPtr->m_hashName;
  if ( m_hashName != v7 )
  {
LABEL_6:
    if ( m_hashName != v8 )
      goto LABEL_8;
    goto LABEL_7;
  }
LABEL_27:
  CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 134, &vPosition);
  m_hashName = this->m_bpPtr->m_hashName;
  if ( m_hashName == v8 )
  {
LABEL_7:
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 135, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
  }
LABEL_8:
  if ( m_hashName == v10 )
  {
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 136, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
  }
  if ( m_hashName == v11 )
  {
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 137, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
  }
  if ( m_hashName == v12 )
  {
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 137, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
  }
  if ( m_hashName == v13 )
  {
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 137, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
  }
  if ( m_hashName == v14 )
  {
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 138, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
  }
  if ( m_hashName == v15 )
  {
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 139, &vPosition);
    m_hashName = this->m_bpPtr->m_hashName;
  }
  if ( m_hashName == v16 )
    CAEFireAudioEntity::AddAudioEvent(&this->m_FireAudioEntity, 140, &vPosition);
}

//----- (0036EF54) --------------------------------------------------------
void __fastcall FxSystem_c::CopyParentMatrix(FxSystem_c *this)
{
  RwMatrix *m_parentMat; // r5
  RwMatrix *v3; // r0
  __int64 v4; // d16
  __int64 v5; // d17
  __int64 v6; // d19
  __int64 v7; // d22
  __int64 v8; // d23
  __int64 v9; // d20
  __int64 v10; // d21

  m_parentMat = this->m_parentMat;
  v3 = RwMatrixCreate();
  this->m_parentMat = v3;
  v4 = *(_QWORD *)&m_parentMat->right.x;
  v5 = *(_QWORD *)&m_parentMat->right.z;
  v6 = *(_QWORD *)&m_parentMat->pos.z;
  v7 = *(_QWORD *)&m_parentMat->up.x;
  v8 = *(_QWORD *)&m_parentMat->up.z;
  v9 = *(_QWORD *)&m_parentMat->at.x;
  v10 = *(_QWORD *)&m_parentMat->at.z;
  *(_QWORD *)&v3->pos.x = *(_QWORD *)&m_parentMat->pos.x;
  *(_QWORD *)&v3->pos.z = v6;
  *(_QWORD *)&v3->at.x = v9;
  *(_QWORD *)&v3->at.z = v10;
  *(_QWORD *)&v3->right.x = v4;
  *(_QWORD *)&v3->right.z = v5;
  v3 = (RwMatrix *)((char *)v3 + 16);
  *(_QWORD *)&v3->right.x = v7;
  *(_QWORD *)&v3->right.z = v8;
  *((_BYTE *)this + 102) |= 1u;
}

//----- (0036EFA2) --------------------------------------------------------
int32 __fastcall FxSystem_c::GetPlayStatus(FxSystem_c *this)
{
  return this->m_playStatus;
}

//----- (0036EFA8) --------------------------------------------------------
void __fastcall FxSystem_c::SetLocalParticles(FxSystem_c *this, bool8 on)
{
  *((_BYTE *)this + 102) = (2 * on) & 2 | *((_BYTE *)this + 102) & 0xFD;
}

//----- (0036EFBE) --------------------------------------------------------
int32 __fastcall FxSystem_c::ForAllParticles(FxSystem_c *this, particleCB particleCB, void *userPtr)
{
  FxSystemBP_c *m_bpPtr; // r0
  int v6; // r6
  int32 v7; // r10
  FxPrimBP_c *v8; // r1
  ListItem_c *m_head; // r4
  int m_type; // r1
  bool v11; // zf

  m_bpPtr = this->m_bpPtr;
  if ( m_bpPtr->m_numFxPrimBPs < 1 )
    return 0;
  v6 = 0;
  v7 = 0;
  do
  {
    v8 = m_bpPtr->m_fxPrimBPPtrs[v6];
    m_head = v8->m_particleList.m_head;
    if ( m_head )
    {
      while ( 1 )
      {
        m_type = v8->m_type;
        v11 = m_type == 0;
        if ( !m_type )
          v11 = m_head[5].m_prev == this;
        if ( v11 )
        {
          ((void (__fastcall *)(ListItem_c *))particleCB)(m_head);
          ++v7;
        }
        m_head = m_head->m_next;
        m_bpPtr = this->m_bpPtr;
        if ( !m_head )
          break;
        v8 = m_bpPtr->m_fxPrimBPPtrs[v6];
      }
    }
    ++v6;
  }
  while ( v6 < m_bpPtr->m_numFxPrimBPs );
  return v7;
}

//----- (0036F032) --------------------------------------------------------
void __fastcall FxSystem_c::UpdateBoundingBoxCB(Particle_c *prtPtr, int32 type, void **userPtr)
{
  float *v3; // r1
  ListItem_c *m_prev; // s0
  ListItem_c *m_next; // s0
  ListItem_c *v6; // s0

  if ( !type )
  {
    v3 = (float *)*userPtr;
    m_prev = prtPtr[2].m_prev;
    if ( *(float *)&m_prev < *(float *)*userPtr )
    {
      *v3 = *(float *)&m_prev;
      v3 = (float *)*userPtr;
      m_prev = prtPtr[2].m_prev;
    }
    if ( *(float *)&m_prev > v3[1] )
    {
      v3[1] = *(float *)&m_prev;
      v3 = (float *)*userPtr;
    }
    m_next = prtPtr[2].m_next;
    if ( *(float *)&m_next < v3[2] )
    {
      v3[2] = *(float *)&m_next;
      v3 = (float *)*userPtr;
      m_next = prtPtr[2].m_next;
    }
    if ( *(float *)&m_next > v3[3] )
    {
      v3[3] = *(float *)&m_next;
      v3 = (float *)*userPtr;
    }
    v6 = prtPtr[3].m_prev;
    if ( *(float *)&v6 < v3[4] )
    {
      v3[4] = *(float *)&v6;
      v3 = (float *)*userPtr;
      v6 = prtPtr[3].m_prev;
    }
    if ( *(float *)&v6 > v3[5] )
      v3[5] = *(float *)&v6;
  }
}

//----- (0036F0D0) --------------------------------------------------------
void __fastcall FxSystem_c::GetBoundingBox(FxSystem_c *this, FxBox_c *bBox)
{
  FxSystemBP_c *m_bpPtr; // r2
  float v5; // s2
  int v6; // r0
  float v7; // s0
  int v8; // r1
  float v9; // s8
  float v10; // s4
  float v11; // s6
  float v12; // s10
  FxPrimBP_c *v13; // r6
  ListItem_c *m_head; // r3
  int m_type; // r6
  bool v16; // zf
  float v17; // s14
  float v18; // s12
  float v19; // s14
  float v20; // s12
  float v21; // s14
  float v22; // s12
  RwMatrix *v23; // r6
  RwMatrix *m_parentMat; // r0
  __int64 v25; // d16
  __int64 v26; // d17
  __int64 v27; // d20
  __int64 v28; // d21
  __int64 v29; // d23
  __int64 v30; // d18
  __int64 v31; // d19
  float x; // r1
  float y; // r1
  float z; // r1

  bBox->maxZ = -1000000.0;
  *(_QWORD *)&bBox->minX = 0xC97423F0497423F0LL;
  *(_QWORD *)&bBox->minY = 0xC97423F0497423F0LL;
  bBox->minZ = 1000000.0;
  m_bpPtr = this->m_bpPtr;
  if ( m_bpPtr->m_numFxPrimBPs < 1 )
    goto LABEL_26;
  v5 = 1000000.0;
  v6 = 0;
  v7 = -1000000.0;
  v8 = 0;
  v9 = 1000000.0;
  v10 = -1000000.0;
  v11 = -1000000.0;
  v12 = 1000000.0;
  do
  {
    v13 = m_bpPtr->m_fxPrimBPPtrs[v6];
    m_head = v13->m_particleList.m_head;
    if ( m_head )
    {
      while ( 1 )
      {
        m_type = (unsigned __int8)v13->m_type;
        v16 = m_type == 0;
        if ( !m_type )
          v16 = m_head[5].m_prev == this;
        if ( v16 )
        {
          v17 = *(float *)&m_head[2].m_prev;
          if ( v17 < v12 )
          {
            v12 = *(float *)&m_head[2].m_prev;
            bBox->minX = v17;
          }
          v18 = *(float *)&m_head[2].m_prev;
          if ( v18 > v11 )
          {
            bBox->maxX = v18;
            v11 = v18;
          }
          v19 = *(float *)&m_head[2].m_next;
          if ( v19 < v9 )
          {
            v9 = *(float *)&m_head[2].m_next;
            bBox->minY = v19;
          }
          v20 = *(float *)&m_head[2].m_next;
          if ( v20 > v10 )
          {
            bBox->maxY = v20;
            v10 = v20;
          }
          v21 = *(float *)&m_head[3].m_prev;
          if ( v21 < v5 )
          {
            v5 = *(float *)&m_head[3].m_prev;
            bBox->minZ = v21;
          }
          v22 = *(float *)&m_head[3].m_prev;
          ++v8;
          if ( v22 > v7 )
          {
            bBox->maxZ = v22;
            v7 = v22;
          }
          m_bpPtr = this->m_bpPtr;
        }
        m_head = m_head->m_next;
        if ( !m_head )
          break;
        v13 = m_bpPtr->m_fxPrimBPPtrs[v6];
      }
    }
    ++v6;
  }
  while ( v6 < m_bpPtr->m_numFxPrimBPs );
  if ( !v8 )
  {
LABEL_26:
    v23 = FxManager_c::FxRwMatrixCreate(&g_fxMan);
    TestMatrix(&this->m_offsetMat);
    m_parentMat = this->m_parentMat;
    if ( m_parentMat )
    {
      TestMatrix(m_parentMat);
      RwMatrixMultiply(v23, &this->m_offsetMat, this->m_parentMat);
    }
    else
    {
      v25 = *(_QWORD *)&this->m_offsetMat.right.x;
      v26 = *(_QWORD *)&this->m_offsetMat.right.z;
      v27 = *(_QWORD *)&this->m_offsetMat.up.x;
      v28 = *(_QWORD *)&this->m_offsetMat.up.z;
      v29 = *(_QWORD *)&this->m_offsetMat.pos.z;
      v30 = *(_QWORD *)&this->m_offsetMat.at.x;
      v31 = *(_QWORD *)&this->m_offsetMat.at.z;
      *(_QWORD *)&v23->pos.x = *(_QWORD *)&this->m_offsetMat.pos.x;
      *(_QWORD *)&v23->pos.z = v29;
      *(_QWORD *)&v23->at.x = v30;
      *(_QWORD *)&v23->at.z = v31;
      *(_QWORD *)&v23->right.x = v25;
      *(_QWORD *)&v23->right.z = v26;
      *(_QWORD *)&v23->up.x = v27;
      *(_QWORD *)&v23->up.z = v28;
    }
    TestMatrix(v23);
    x = v23->pos.x;
    bBox->minX = x;
    bBox->maxX = x;
    y = v23->pos.y;
    bBox->minY = y;
    bBox->maxY = y;
    z = v23->pos.z;
    bBox->minZ = z;
    bBox->maxZ = z;
    sub_18C814(&g_fxMan, v23);
  }
}

//----- (0036F2B0) --------------------------------------------------------
bool8 __fastcall FxSystem_c::GetBoundingSphereLcl(FxSystem_c *this, FxSphere_c *bSphere)
{
  FxSphere_c *m_boundingSphere; // r0
  __int64 v4; // d17

  m_boundingSphere = this->m_boundingSphere;
  if ( !m_boundingSphere )
    return 0;
  v4 = *(_QWORD *)&m_boundingSphere->m_center.z;
  *(_QWORD *)&bSphere->m_center.x = *(_QWORD *)&m_boundingSphere->m_center.x;
  *(_QWORD *)&bSphere->m_center.z = v4;
  bSphere->m_lastPlaneRejected = m_boundingSphere->m_lastPlaneRejected;
  return 1;
}

//----- (0036F2CA) --------------------------------------------------------
void __fastcall FxSystem_c::SetBoundingSphere(FxSystem_c *this, FxSphere_c *bSphere)
{
  FxSphere_c *m_boundingSphere; // r0
  __int64 v5; // d17
  int32 m_lastPlaneRejected; // r1

  m_boundingSphere = this->m_boundingSphere;
  if ( bSphere )
  {
    if ( !m_boundingSphere )
    {
      m_boundingSphere = (FxSphere_c *)CMemoryMgr::Malloc(0x14u);
      m_boundingSphere->m_lastPlaneRejected = 0;
      this->m_boundingSphere = m_boundingSphere;
    }
    v5 = *(_QWORD *)&bSphere->m_center.z;
    m_lastPlaneRejected = bSphere->m_lastPlaneRejected;
    *(_QWORD *)&m_boundingSphere->m_center.x = *(_QWORD *)&bSphere->m_center.x;
    *(_QWORD *)&m_boundingSphere->m_center.z = v5;
    m_boundingSphere->m_lastPlaneRejected = m_lastPlaneRejected;
  }
  else if ( m_boundingSphere )
  {
    CMemoryMgr::Free(m_boundingSphere);
    this->m_boundingSphere = 0;
  }
}

//----- (0036F302) --------------------------------------------------------
void __fastcall FxSystem_c::ResetBoundingSphere(FxSystem_c *this)
{
  FxSystemBP_c *m_bpPtr; // r1
  FxSphere_c *m_boundingSphere; // r0
  FxSphere_c *v4; // r1
  __int64 v5; // d16
  __int64 v6; // d17
  int32 m_lastPlaneRejected; // r1

  m_bpPtr = this->m_bpPtr;
  m_boundingSphere = this->m_boundingSphere;
  if ( m_bpPtr->m_boundingSphere )
  {
    if ( !m_boundingSphere )
    {
      m_boundingSphere = (FxSphere_c *)CMemoryMgr::Malloc(0x14u);
      m_boundingSphere->m_lastPlaneRejected = 0;
      m_bpPtr = this->m_bpPtr;
      this->m_boundingSphere = m_boundingSphere;
    }
    v4 = m_bpPtr->m_boundingSphere;
    v5 = *(_QWORD *)&v4->m_center.x;
    v6 = *(_QWORD *)&v4->m_center.z;
    m_lastPlaneRejected = v4->m_lastPlaneRejected;
    *(_QWORD *)&m_boundingSphere->m_center.x = v5;
    *(_QWORD *)&m_boundingSphere->m_center.z = v6;
    m_boundingSphere->m_lastPlaneRejected = m_lastPlaneRejected;
  }
  else if ( m_boundingSphere )
  {
    CMemoryMgr::Free(m_boundingSphere);
    this->m_boundingSphere = 0;
  }
}

//----- (0036F340) --------------------------------------------------------
void __fastcall FxSystem_c::SetZTestEnable(FxSystem_c *this, bool8 on)
{
  *((_BYTE *)this + 102) = (4 * on) & 4 | *((_BYTE *)this + 102) & 0xFB;
}

//----- (0036F356) --------------------------------------------------------
void __fastcall FxSystem_c::SetMustCreatePrts(FxSystem_c *this, bool8 on)
{
  *((_BYTE *)this + 102) = (32 * on) & 0x20 | *((_BYTE *)this + 102) & 0xDF;
}

//----- (0036F370) --------------------------------------------------------
bool8 __fastcall ReadLine(u_native id, unsigned __int8 *pLine, int32 maxLen)
{
  return CFileMgr::ReadLine(id, pLine, maxLen);
}

//----- (0036F37E) --------------------------------------------------------
void __fastcall FxPrtMult_c::FxPrtMult_c(FxPrtMult_c *this)
{
  __int64 v1; // d16
  __int64 v2; // d17

  *(float *)&v1 = 1.0;
  *((float *)&v1 + 1) = 1.0;
  *(float *)&v2 = 1.0;
  *((float *)&v2 + 1) = 1.0;
  this->m_rot = 1.0;
  this->m_life = 1.0;
  *(_QWORD *)&this->m_red = v1;
  *(_QWORD *)&this->m_blue = v2;
  this->m_size = 1.0;
}

//----- (0036F394) --------------------------------------------------------
void __fastcall FxPrtMult_c::FxPrtMult_c(
        FxPrtMult_c *this,
        float red,
        float green,
        float blue,
        float alpha,
        float size,
        float rot,
        float life)
{
  this->m_red = red;
  this->m_green = green;
  this->m_blue = blue;
  this->m_alpha = alpha;
  this->m_size = size;
  this->m_rot = rot;
  this->m_life = life;
}

//----- (0036F3BA) --------------------------------------------------------
void __fastcall FxPrtMult_c::SetUp(
        FxPrtMult_c *this,
        float red,
        float green,
        float blue,
        float alpha,
        float size,
        float rot,
        float life)
{
  this->m_red = red;
  this->m_green = green;
  this->m_blue = blue;
  this->m_alpha = alpha;
  this->m_size = size;
  this->m_rot = rot;
  this->m_life = life;
}

//----- (0036F3E0) --------------------------------------------------------
void __fastcall CEventGroup::CEventGroup(CEventGroup *this, CPed *pPed)
{
  *(_QWORD *)&this->m_events[11] = 0LL;
  *(_QWORD *)&this->m_events[13] = 0LL;
  *(_QWORD *)&this->m_events[7] = 0LL;
  *(_QWORD *)&this->m_events[9] = 0LL;
  *(_QWORD *)&this->m_events[3] = 0LL;
  *(_QWORD *)&this->m_events[5] = 0LL;
  *(_QWORD *)&this->m_iNoOfEvents = 0LL;
  *(_QWORD *)&this->m_events[1] = 0LL;
  this->m_pPed = pPed;
  this->m_events[15] = 0;
  this->_vptr$CEventGroup = (int (**)(void))&off_665D54;
}
// 665D54: using guessed type void *;

//----- (0036F41C) --------------------------------------------------------
void __fastcall CEventGlobalGroup::~CEventGlobalGroup(CEventGroup *this)
{
  int m_iNoOfEvents; // r1
  CEvent **m_events; // r5
  int i; // r6
  CEvent *v5; // r0

  m_iNoOfEvents = this->m_iNoOfEvents;
  this->_vptr$CEventGroup = (int (**)(void))&off_665D54;
  if ( m_iNoOfEvents >= 1 )
  {
    m_events = this->m_events;
    for ( i = 0; i < m_iNoOfEvents; ++i )
    {
      v5 = m_events[i];
      if ( v5 )
      {
        (*((void (__fastcall **)(CEvent *))v5->_vptr$CEvent + 1))(v5);
        m_events[i] = 0;
        m_iNoOfEvents = this->m_iNoOfEvents;
      }
    }
  }
  this->m_iNoOfEvents = 0;
}
// 665D54: using guessed type void *off_665D54;

//----- (0036F46C) --------------------------------------------------------
void __fastcall CEventGroup::Flush(CEventGroup *this, const bool bKeepJoinGroupScriptCommands)
{
  CEvent **m_events; // r8
  int i; // r6
  CEvent *v5; // r5
  int m_iAccumulatedTime; // r0
  int m_iNoOfEvents; // r1
  CEvent *v8; // r8
  CEvent **v9; // r6
  int j; // r5
  CEvent *v11; // r0
  int v12; // r0
  int (***v13)(void); // r0

  if ( bKeepJoinGroupScriptCommands )
  {
    if ( this->m_iNoOfEvents < 1 )
    {
      v12 = 0;
      goto LABEL_19;
    }
    m_events = this->m_events;
    for ( i = 0; i < m_iNoOfEvents; ++i )
    {
      v5 = m_events[i];
      if ( (*((int (__fastcall **)(CEvent *))v5->_vptr$CEvent + 2))(v5) == 32 )
      {
        m_iAccumulatedTime = v5[1].m_iAccumulatedTime;
        if ( m_iAccumulatedTime )
        {
          if ( (*(int (__fastcall **)(int))(*(_DWORD *)m_iAccumulatedTime + 20))(m_iAccumulatedTime) == 243 )
          {
            v13 = &this->_vptr$CEventGroup + i;
            v8 = (CEvent *)v13[3];
            v13[3] = 0;
            goto LABEL_11;
          }
        }
      }
      m_iNoOfEvents = this->m_iNoOfEvents;
    }
    v8 = 0;
    if ( m_iNoOfEvents >= 1 )
      goto LABEL_12;
  }
  else
  {
    v8 = 0;
LABEL_11:
    m_iNoOfEvents = this->m_iNoOfEvents;
    if ( m_iNoOfEvents >= 1 )
    {
LABEL_12:
      v9 = this->m_events;
      for ( j = 0; j < m_iNoOfEvents; ++j )
      {
        v11 = v9[j];
        if ( v11 )
        {
          (*((void (__fastcall **)(CEvent *))v11->_vptr$CEvent + 1))(v11);
          v9[j] = 0;
          m_iNoOfEvents = this->m_iNoOfEvents;
        }
      }
    }
  }
  this->m_iNoOfEvents = 0;
  if ( !v8 )
    return;
  v12 = 1;
  this->m_events[0] = v8;
LABEL_19:
  this->m_iNoOfEvents = v12;
}

//----- (0036F50C) --------------------------------------------------------
void __fastcall CEventGroup::~CEventGroup(CEventGroup *this)
{
  int m_iNoOfEvents; // r1
  CEvent **m_events; // r5
  int i; // r6
  CEvent *v5; // r0

  m_iNoOfEvents = this->m_iNoOfEvents;
  this->_vptr$CEventGroup = (int (**)(void))&off_665D54;
  if ( m_iNoOfEvents >= 1 )
  {
    m_events = this->m_events;
    for ( i = 0; i < m_iNoOfEvents; ++i )
    {
      v5 = m_events[i];
      if ( v5 )
      {
        (*((void (__fastcall **)(CEvent *))v5->_vptr$CEvent + 1))(v5);
        m_events[i] = 0;
        m_iNoOfEvents = this->m_iNoOfEvents;
      }
    }
  }
  sub_191374(this);
}
// 665D54: using guessed type void *off_665D54;

//----- (0036F55C) --------------------------------------------------------
CEvent *__fastcall CEventGroup::Add(CEventGroup *this, CEvent *rEvent, const bool bForcePersistence)
{
  _BOOL4 v6; // r10
  _BOOL4 v7; // r8
  _BOOL4 v8; // r5
  int v9; // r0
  int v10; // r11
  CPedIntelligence *m_pPedIntelligence; // r8
  int v12; // r5
  int v13; // r0
  CEvent *v14; // r0
  CEvent *v15; // r5
  _BOOL4 v17; // [sp+0h] [bp-20h]

  if ( this->m_pPed )
  {
    if ( (*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 10))(rEvent) == 1 )
    {
      v6 = CEventEditableResponse::ComputeResponseTaskOfType((const CEventEditableResponse *)rEvent, this->m_pPed, 1200);
      v7 = CEventEditableResponse::ComputeResponseTaskOfType((const CEventEditableResponse *)rEvent, this->m_pPed, 1700);
      v17 = CEventEditableResponse::ComputeResponseTaskOfType((const CEventEditableResponse *)rEvent, this->m_pPed, 300);
      CEventEditableResponse::ComputeResponseTaskType((CEventEditableResponse *)rEvent, this->m_pPed, 0);
      v8 = CEventEditableResponse::WillRespond((const CEventEditableResponse *)rEvent)
        || (*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 2))(rEvent) == 9 && *(&rEvent->m_bIsPersistent + 1);
    }
    else
    {
      v8 = 1;
      v6 = 0;
      v7 = 0;
      v17 = 0;
    }
    v9 = (*((int (__fastcall **)(CEvent *, CPed *))rEvent->_vptr$CEvent + 6))(rEvent, this->m_pPed);
    v10 = v8 & v9;
    if ( v9 == 1 )
    {
      if ( (*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 10))(rEvent) == 1 )
      {
        if ( v6 )
          CEventEditableResponse::InformGroup((const CEventEditableResponse *)rEvent, this->m_pPed);
        if ( v7
          && ((*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 2))(rEvent) != 9
           || (*(&rEvent[2].m_bIsPersistent + 1) & 0x10) == 0) )
        {
          CEventEditableResponse::InformRespectedFriends((const CEventEditableResponse *)rEvent, this->m_pPed);
        }
        if ( v17 )
          CEventEditableResponse::TriggerLookAt((const CEventEditableResponse *)rEvent, this->m_pPed);
        CEventEditableResponse::InformVehicleOccupants((const CEventEditableResponse *)rEvent, this->m_pPed);
      }
      m_pPedIntelligence = this->m_pPed->m_pPedIntelligence;
      v12 = (*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 2))(rEvent);
      v13 = (*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 3))(rEvent);
      CPedIntelligence::RecordEventForScript(m_pPedIntelligence, v12, v13);
    }
    if ( v10 != 1 )
      return 0;
  }
  if ( this->m_iNoOfEvents > 15 )
    return 0;
  v14 = (CEvent *)(*((int (__fastcall **)(CEvent *))rEvent->_vptr$CEvent + 5))(rEvent);
  v15 = v14;
  v14->m_bIsPersistent = bForcePersistence;
  if ( this->m_pPed )
    (*((void (__fastcall **)(CEvent *))v14->_vptr$CEvent + 9))(v14);
  this->m_events[this->m_iNoOfEvents++] = v15;
  return v15;
}

//----- (0036F6A8) --------------------------------------------------------
void __fastcall CEventGroup::Remove(CEventGroup *this, CEvent *pEvent)
{
  int m_iNoOfEvents; // r12
  int v3; // r3

  if ( pEvent )
  {
    m_iNoOfEvents = this->m_iNoOfEvents;
    if ( m_iNoOfEvents >= 1 )
    {
      v3 = 0;
      while ( this->m_events[v3] != pEvent )
      {
        if ( ++v3 >= m_iNoOfEvents )
          return;
      }
      this->m_events[v3] = 0;
      (*((void (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 1))(pEvent);
    }
  }
}

//----- (0036F6E6) --------------------------------------------------------
bool __fastcall CEventGroup::HasEventOfType(const CEventGroup *this, const CEvent *pEvent)
{
  int v4; // r5
  int v5; // r6

  if ( pEvent )
  {
    if ( this->m_iNoOfEvents < 1 )
      return 0;
    v4 = 0;
    while ( 1 )
    {
      v5 = (*((int (__fastcall **)(const CEvent *))pEvent->_vptr$CEvent + 2))(pEvent);
      if ( v5 == (*((int (__fastcall **)(CEvent *))this->m_events[v4]->_vptr$CEvent + 2))(this->m_events[v4]) )
        break;
      if ( ++v4 >= this->m_iNoOfEvents )
        return 0;
    }
  }
  return 1;
}

//----- (0036F734) --------------------------------------------------------
CEvent *__fastcall CEventGroup::GetEventOfType(const CEventGroup *this, const int iEventType)
{
  int v4; // r6

  if ( this->m_iNoOfEvents < 1 )
    return 0;
  v4 = 0;
  while ( (*((int (__fastcall **)(CEvent *))this->m_events[v4]->_vptr$CEvent + 2))(this->m_events[v4]) != iEventType )
  {
    if ( ++v4 >= this->m_iNoOfEvents )
      return 0;
  }
  return this->m_events[v4];
}

//----- (0036F776) --------------------------------------------------------
bool __fastcall CEventGroup::HasEvent(const CEventGroup *this, const CEvent *pEvent)
{
  int m_iNoOfEvents; // r2
  int i; // r3

  m_iNoOfEvents = this->m_iNoOfEvents;
  if ( m_iNoOfEvents < 1 )
    return 0;
  for ( i = 0; i < m_iNoOfEvents; ++i )
  {
    if ( this->m_events[i] == pEvent )
      return 1;
  }
  return 0;
}

//----- (0036F79E) --------------------------------------------------------
void __fastcall CEventGroup::TickEvents(CEventGroup *this)
{
  int v1; // r2
  CEvent *v2; // r3

  if ( this->m_iNoOfEvents >= 1 )
  {
    v1 = 0;
    do
    {
      v2 = this->m_events[v1++];
      ++v2->m_iAccumulatedTime;
    }
    while ( v1 < this->m_iNoOfEvents );
  }
}

//----- (0036F7C0) --------------------------------------------------------
void __fastcall CEventGroup::Reorganise(CEventGroup *this)
{
  int m_iNoOfEvents; // r3
  CEvent **m_events; // r1
  int v3; // r2
  int i; // r4
  CEvent *v5; // r5
  int v6; // r2
  _DWORD v7[18]; // [sp+0h] [bp-48h]

  m_iNoOfEvents = this->m_iNoOfEvents;
  if ( m_iNoOfEvents < 1 )
  {
    this->m_iNoOfEvents = 0;
  }
  else
  {
    m_events = this->m_events;
    v3 = 0;
    for ( i = 0; i < m_iNoOfEvents; ++i )
    {
      v5 = m_events[i];
      if ( v5 )
      {
        v7[v3] = v5;
        m_events[i] = 0;
        m_iNoOfEvents = this->m_iNoOfEvents;
        ++v3;
      }
    }
    this->m_iNoOfEvents = v3;
    if ( v3 >= 1 )
    {
      v6 = 0;
      do
      {
        m_events[v6] = (CEvent *)v7[v6];
        ++v6;
      }
      while ( v6 < this->m_iNoOfEvents );
    }
  }
}

//----- (0036F818) --------------------------------------------------------
void __fastcall CEventGroup::RemoveInvalidEvents(CEventGroup *this, bool bEverythingButScriptEvents)
{
  _BOOL4 v3; // r8
  CEvent **m_events; // r10
  int v5; // r4
  CEvent *v6; // r6

  v3 = bEverythingButScriptEvents;
  if ( this->m_iNoOfEvents >= 1 )
  {
    m_events = this->m_events;
    v5 = 0;
    do
    {
      v6 = m_events[v5];
      if ( v6
        && ((*((int (__fastcall **)(CEvent *, CPed *))v6->_vptr$CEvent + 15))(m_events[v5], this->m_pPed) != 1
         || v3 && (*((int (__fastcall **)(CEvent *))v6->_vptr$CEvent + 2))(v6) != 32) )
      {
        (*((void (__fastcall **)(CEvent *))v6->_vptr$CEvent + 1))(v6);
        m_events[v5] = 0;
      }
      ++v5;
    }
    while ( v5 < this->m_iNoOfEvents );
  }
}

//----- (0036F874) --------------------------------------------------------
CEvent *__fastcall CEventGroup::GetHighestPriorityEvent(const CEventGroup *this)
{
  CEvent **m_events; // r9
  CEvent *v3; // r8
  int v4; // r11
  int v5; // r4
  CEvent *v6; // r6
  int v7; // r5

  if ( this->m_iNoOfEvents >= 1 )
  {
    m_events = this->m_events;
    v3 = 0;
    v4 = -1;
    v5 = 0;
    while ( 1 )
    {
      v6 = m_events[v5];
      v7 = (*((int (__fastcall **)(CEvent *))v6->_vptr$CEvent + 3))(v6);
      if ( (*((int (__fastcall **)(CEvent *))v6->_vptr$CEvent + 2))(v6) == 32 )
      {
        if ( v7 > v4 )
          goto LABEL_7;
      }
      else if ( v7 >= v4 )
      {
LABEL_7:
        if ( (*((int (__fastcall **)(CEvent *, CPed *))m_events[v5]->_vptr$CEvent + 6))(m_events[v5], this->m_pPed) )
        {
          v3 = v6;
          v4 = v7;
        }
      }
      if ( ++v5 >= this->m_iNoOfEvents )
        return v3;
    }
  }
  return 0;
}

//----- (0036F8EA) --------------------------------------------------------
bool __fastcall CEventGroup::HasScriptCommandOfTaskType(const CEventGroup *this, const int iTaskType)
{
  CEvent **m_events; // r6
  int v5; // r4
  CEvent *v6; // r0
  int m_iAccumulatedTime; // r0

  if ( this->m_iNoOfEvents < 1 )
    return 0;
  m_events = this->m_events;
  v5 = 0;
  while ( 1 )
  {
    v6 = m_events[v5];
    if ( v6 )
    {
      if ( (*((int (__fastcall **)(CEvent *))v6->_vptr$CEvent + 2))(v6) == 32 )
      {
        m_iAccumulatedTime = m_events[v5][1].m_iAccumulatedTime;
        if ( m_iAccumulatedTime )
        {
          if ( (*(int (__fastcall **)(int))(*(_DWORD *)m_iAccumulatedTime + 20))(m_iAccumulatedTime) == iTaskType )
            break;
        }
      }
    }
    if ( ++v5 >= this->m_iNoOfEvents )
      return 0;
  }
  return 1;
}

//----- (0036F93C) --------------------------------------------------------
CEventGlobalGroup *GetEventGlobalGroup()
{
  CEventGlobalGroup *result; // r0

  result = GetEventGlobalGroup(void)::pEventGlobalGroup;
  if ( !GetEventGlobalGroup(void)::pEventGlobalGroup )
  {
    result = (CEventGlobalGroup *)operator new(0x4Cu);
    *(_QWORD *)&result->m_events[10] = 0LL;
    *(_QWORD *)&result->m_events[12] = 0LL;
    *(_QWORD *)&result->m_events[6] = 0LL;
    *(_QWORD *)&result->m_events[8] = 0LL;
    *(_QWORD *)&result->m_events[2] = 0LL;
    *(_QWORD *)&result->m_events[4] = 0LL;
    result->m_events[15] = 0;
    *(_QWORD *)&result->m_pPed = 0LL;
    *(_QWORD *)result->m_events = 0LL;
    result->m_events[14] = 0;
    result->_vptr$CEventGroup = (int (**)(void))&off_665D64;
    GetEventGlobalGroup(void)::pEventGlobalGroup = result;
  }
  return result;
}
// 665D64: using guessed type void *;

//----- (0036F9A4) --------------------------------------------------------
void __fastcall CEventGlobalGroup::CEventGlobalGroup(CEventGlobalGroup *this)
{
  *(_QWORD *)&this->m_events[10] = 0LL;
  *(_QWORD *)&this->m_events[12] = 0LL;
  *(_QWORD *)&this->m_events[6] = 0LL;
  *(_QWORD *)&this->m_events[8] = 0LL;
  *(_QWORD *)&this->m_events[2] = 0LL;
  *(_QWORD *)&this->m_events[4] = 0LL;
  this->m_events[15] = 0;
  *(_QWORD *)&this->m_pPed = 0LL;
  *(_QWORD *)this->m_events = 0LL;
  this->m_events[14] = 0;
  this->_vptr$CEventGroup = (int (**)(void))&off_665D64;
}
// 665D64: using guessed type void *off_665D64;

//----- (0036F9DC) --------------------------------------------------------
void __fastcall CEventGlobalGroup::~CEventGlobalGroup(CEventGlobalGroup *this)
{
  int m_iNoOfEvents; // r1
  CEvent **m_events; // r5
  int i; // r6
  CEvent *v5; // r0

  m_iNoOfEvents = this->m_iNoOfEvents;
  this->_vptr$CEventGroup = (int (**)(void))&off_665D54;
  if ( m_iNoOfEvents >= 1 )
  {
    m_events = this->m_events;
    for ( i = 0; i < m_iNoOfEvents; ++i )
    {
      v5 = m_events[i];
      if ( v5 )
      {
        (*((void (__fastcall **)(CEvent *))v5->_vptr$CEvent + 1))(v5);
        m_events[i] = 0;
        m_iNoOfEvents = this->m_iNoOfEvents;
      }
    }
  }
  sub_191374(this);
}
// 665D54: using guessed type void *off_665D54;

//----- (0036FA2C) --------------------------------------------------------
void __fastcall CEventGlobalGroup::AddEventsToPed(CEventGlobalGroup *this, CPed *pPed)
{
  int v3; // r4
  CEventGroup *p_m_eventGroup; // r5
  CEvent *v5; // r6

  if ( this->m_iNoOfEvents >= 1 )
  {
    v3 = 0;
    p_m_eventGroup = &pPed->m_pPedIntelligence->m_eventGroup;
    do
    {
      v5 = (CEvent *)(*((int (__fastcall **)(CEvent *))this->m_events[v3]->_vptr$CEvent + 5))(this->m_events[v3]);
      CEventGroup::Add(p_m_eventGroup, v5, 0);
      (*((void (__fastcall **)(CEvent *))v5->_vptr$CEvent + 1))(v5);
      ++v3;
    }
    while ( v3 < this->m_iNoOfEvents );
  }
}

//----- (0036FA7A) --------------------------------------------------------
void __fastcall CEventGlobalGroup::AddEventsToGroup(CEventGlobalGroup *this, CPedGroup *pPedGroup)
{
  CPedGroupIntelligence *p_m_intelligence; // r9
  int v4; // r5
  CEvent *v5; // r6

  if ( this->m_iNoOfEvents >= 1 )
  {
    p_m_intelligence = &pPedGroup->m_intelligence;
    v4 = 0;
    do
    {
      v5 = (CEvent *)(*((int (__fastcall **)(CEvent *))this->m_events[v4]->_vptr$CEvent + 5))(this->m_events[v4]);
      CPedGroupIntelligence::AddEvent(p_m_intelligence, v5);
      (*((void (__fastcall **)(CEvent *))v5->_vptr$CEvent + 1))(v5);
      ++v4;
    }
    while ( v4 < this->m_iNoOfEvents );
  }
}

//----- (0036FAC4) --------------------------------------------------------
float __fastcall CEventGlobalGroup::GetSoundLevel(CEventGlobalGroup *this, CEntity *pCause, CVector *vecPos)
{
  float v4; // s16
  CEvent **m_events; // r4
  int v8; // r6
  CEntity *v9; // r0
  bool v10; // zf
  float SoundLevel; // r1

  v4 = 0.0;
  if ( this->m_iNoOfEvents >= 1 )
  {
    m_events = this->m_events;
    v8 = 0;
    do
    {
      v9 = (CEntity *)(*((int (__fastcall **)(CEvent *))m_events[v8]->_vptr$CEvent + 11))(m_events[v8]);
      v10 = pCause == 0;
      if ( pCause )
        v10 = v9 == pCause;
      if ( v10 )
      {
        SoundLevel = CEvent::GetSoundLevel(m_events[v8], pCause, vecPos);
        if ( SoundLevel > 0.0 )
          v4 = v4 + CEvent::CalcSoundLevelIncrement(v4, SoundLevel);
      }
      ++v8;
    }
    while ( v8 < this->m_iNoOfEvents );
  }
  return v4;
}

//----- (0036FB44) --------------------------------------------------------
void __fastcall CEvent::CEvent(CEvent *this)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_665D74;
  this->m_iAccumulatedTime = 0;
}
// 665D74: using guessed type void *;

//----- (0036FB60) --------------------------------------------------------
void *__fastcall CEvent::operator new(size_t nSize)
{
  int v1; // lr
  CEventPool *v2; // r1
  void *result; // r0
  void *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (void *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (void *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (char *)result + 1;
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        return result;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)result + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)result + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  return v2->m_aStorage[v2->m_nFreeIndex];
}

//----- (0036FBC4) --------------------------------------------------------
void __fastcall CEvent::operator delete(void *pVoid)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * ((signed int)((int)pVoid - (unsigned int)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (0036FBF4) --------------------------------------------------------
bool __fastcall CEvent::IsValid(const CEvent *this, CPed *pPed)
{
  __int64 v3; // kr00_8

  if ( this->m_bIsPersistent )
    return 1;
  v3 = *(_QWORD *)&this->_vptr$CEvent;
  return SHIDWORD(v3) <= (*((int (__fastcall **)(const CEvent *))this->_vptr$CEvent + 4))(this);
}

//----- (0036FC18) --------------------------------------------------------
float __fastcall CEvent::GetSoundLevel(const CEvent *this, const CEntity *pSourceEnt, const CVector *vecMicPos)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float v8; // s0
  float v9; // s2
  float v10; // s4
  int v11; // r0
  int v12; // r1
  float *v13; // r2
  float v14; // s16
  float v15; // r4

  if ( (!pSourceEnt
     || (const CEntity *)(*((int (__fastcall **)(const CEvent *))this->_vptr$CEvent + 11))(this) == pSourceEnt)
    && (*((float (__fastcall **)(const CEvent *))this->_vptr$CEvent + 13))(this) != 0.0 )
  {
    if ( (*((int (__fastcall **)(const CEvent *))this->_vptr$CEvent + 2))(this) == 62 )
    {
      v8 = vecMicPos->x - *(float *)&this[2].m_iAccumulatedTime;
      v9 = vecMicPos->y - *(float *)&this[2].m_bIsPersistent;
      v10 = vecMicPos->z - *(float *)&this[3]._vptr$CEvent;
    }
    else
    {
      if ( !(*((int (__fastcall **)(const CEvent *))this->_vptr$CEvent + 11))(this) )
      {
        v3.n64_u32[0] = 1148846080;
        goto LABEL_13;
      }
      v11 = (*((int (__fastcall **)(const CEvent *))this->_vptr$CEvent + 11))(this);
      v12 = *(_DWORD *)(v11 + 20);
      v13 = (float *)(v12 + 48);
      if ( !v12 )
        v13 = (float *)(v11 + 4);
      v8 = vecMicPos->x - *v13;
      v9 = vecMicPos->y - v13[1];
      v10 = vecMicPos->z - v13[2];
    }
    v3.n64_f32[0] = sqrtf((float)((float)(v8 * v8) + (float)(v9 * v9)) + (float)(v10 * v10));
LABEL_13:
    v4.n64_u32[0] = 1.0;
    v14 = vmax_f32(v3, v4).n64_f32[0];
    v15 = COERCE_FLOAT((*((int (__fastcall **)(const CEvent *))this->_vptr$CEvent + 13))(this));
    return (float)(v15 + (float)(log10f(v14 * v14) * -10.0)) + (float)(v14 / -100.0);
  }
  return 0.0;
}
// 36FCF0: variable 'v3' is possibly undefined
// 36FCF0: variable 'v4' is possibly undefined

//----- (0036FD40) --------------------------------------------------------
float __fastcall CEvent::CalcSoundLevelIncrement(float fOrig, float fAdd)
{
  float v2; // s16
  float v3; // r5
  float v4; // r0

  v2 = fAdd;
  if ( fAdd == 0.0 )
    return 0.0;
  if ( fOrig != 0.0 )
  {
    v3 = powf(10.0, fOrig * 0.1);
    v4 = powf(10.0, v2 * 0.1);
    return log10f((float)(v3 + v4) / v3) * 10.0;
  }
  return v2;
}

//----- (0036FDC8) --------------------------------------------------------
void __fastcall CInformFriendsEvent::CInformFriendsEvent(CInformFriendsEvent *this)
{
  this->m_pPedToInform = 0;
  this->m_pEvent = 0;
  this->m_informTime = -1;
}

//----- (0036FDD6) --------------------------------------------------------
void __fastcall CInformFriendsEvent::~CInformFriendsEvent(CInformFriendsEvent *this)
{
  CPed *m_pPedToInform; // r0
  CEvent *m_pEvent; // r0

  m_pPedToInform = this->m_pPedToInform;
  if ( m_pPedToInform )
  {
    CEntity::CleanUpOldReference(m_pPedToInform, &this->m_pPedToInform);
    this->m_pPedToInform = 0;
  }
  m_pEvent = this->m_pEvent;
  if ( m_pEvent )
  {
    (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
    this->m_pEvent = 0;
  }
  this->m_informTime = -1;
}

//----- (0036FE02) --------------------------------------------------------
void __fastcall CInformFriendsEvent::Flush(CInformFriendsEvent *this)
{
  CPed *m_pPedToInform; // r0
  CEvent *m_pEvent; // r0

  m_pPedToInform = this->m_pPedToInform;
  if ( m_pPedToInform )
  {
    CEntity::CleanUpOldReference(m_pPedToInform, &this->m_pPedToInform);
    this->m_pPedToInform = 0;
  }
  m_pEvent = this->m_pEvent;
  if ( m_pEvent )
  {
    (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
    this->m_pEvent = 0;
  }
  this->m_informTime = -1;
}

//----- (0036FE2C) --------------------------------------------------------
void __fastcall CInformFriendsEvent::Set(CInformFriendsEvent *this, CPed *pPed, CEvent *pEvent, const int iTime)
{
  int v7; // r0

  this->m_pPedToInform = pPed;
  if ( pPed )
    CEntity::RegisterReference(pPed, &this->m_pPedToInform);
  v7 = CTimer::m_snTimeInMilliseconds + iTime;
  this->m_pEvent = pEvent;
  this->m_informTime = v7;
}

//----- (0036FE60) --------------------------------------------------------
void __fastcall CInformFriendsEvent::Process(CInformFriendsEvent *this)
{
  CPed *m_pPedToInform; // r0
  int *p_m_informTime; // r5
  CEvent *m_pEvent; // r0
  CEvent *v5; // r0

  m_pPedToInform = this->m_pPedToInform;
  if ( m_pPedToInform )
  {
    p_m_informTime = &this->m_informTime;
    if ( this->m_informTime >= CTimer::m_snTimeInMilliseconds )
      return;
    CEventGroup::Add(&m_pPedToInform->m_pPedIntelligence->m_eventGroup, this->m_pEvent, 0);
    if ( this->m_pPedToInform )
    {
      CEntity::CleanUpOldReference(this->m_pPedToInform, &this->m_pPedToInform);
      this->m_pPedToInform = 0;
    }
    m_pEvent = this->m_pEvent;
    if ( m_pEvent )
    {
      (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
      this->m_pEvent = 0;
    }
  }
  else
  {
    v5 = this->m_pEvent;
    if ( v5 )
    {
      (*((void (__fastcall **)(CEvent *))v5->_vptr$CEvent + 1))(v5);
      this->m_pEvent = 0;
    }
    p_m_informTime = &this->m_informTime;
  }
  *p_m_informTime = -1;
}

//----- (0036FED4) --------------------------------------------------------
void CInformFriendsEventQueue::Init()
{
  int i; // r6
  CPed *m_pPedToInform; // r0
  CEvent *m_pEvent; // r0
  CInformFriendsEvent *v3; // r0

  for ( i = 0; i != 8; ++i )
  {
    m_pPedToInform = CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pPedToInform;
    if ( m_pPedToInform )
    {
      CEntity::CleanUpOldReference(m_pPedToInform, &CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pPedToInform);
      CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pPedToInform = 0;
    }
    m_pEvent = CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pEvent;
    if ( m_pEvent )
    {
      (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
      CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pEvent = 0;
    }
    v3 = &CInformFriendsEventQueue::ms_informFriendsEvents[i];
    v3->m_informTime = -1;
  }
}

//----- (0036FF4C) --------------------------------------------------------
void CInformFriendsEventQueue::Flush()
{
  int i; // r6
  CPed *m_pPedToInform; // r0
  CEvent *m_pEvent; // r0
  CInformFriendsEvent *v3; // r0

  for ( i = 0; i != 8; ++i )
  {
    m_pPedToInform = CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pPedToInform;
    if ( m_pPedToInform )
    {
      CEntity::CleanUpOldReference(m_pPedToInform, &CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pPedToInform);
      CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pPedToInform = 0;
    }
    m_pEvent = CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pEvent;
    if ( m_pEvent )
    {
      (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
      CInformFriendsEventQueue::ms_informFriendsEvents[i].m_pEvent = 0;
    }
    v3 = &CInformFriendsEventQueue::ms_informFriendsEvents[i];
    v3->m_informTime = -1;
  }
}

//----- (0036FFC4) --------------------------------------------------------
bool __fastcall CInformFriendsEventQueue::Add(CPed *pPedToInform, CEvent *pEvent)
{
  int v4; // r4
  int v5; // r10
  CEvent **p_m_pEvent; // r5
  int v7; // r6
  unsigned __int16 v8; // r0
  int v9; // s0
  CInformFriendsEvent *v10; // r0
  uint32 v11; // r1

  v4 = -1;
  v5 = -1;
  p_m_pEvent = &CInformFriendsEventQueue::ms_informFriendsEvents[0].m_pEvent;
  do
  {
    ++v4;
    if ( *(p_m_pEvent - 1) == (CEvent *)pPedToInform )
    {
      v7 = (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent);
      if ( v7 == (*((int (__fastcall **)(CEvent *))(*p_m_pEvent)->_vptr$CEvent + 2))(*p_m_pEvent) )
        return 0;
    }
    else if ( v5 == -1 )
    {
      v5 = -1;
      if ( !*p_m_pEvent )
        v5 = v4;
    }
    p_m_pEvent += 3;
  }
  while ( v4 < 7 );
  if ( v5 == -1 )
    return 0;
  v8 = rand();
  CInformFriendsEventQueue::ms_informFriendsEvents[v5].m_pPedToInform = pPedToInform;
  v9 = (int)(float)((float)((float)v8 * 0.000015259) * 500.0);
  if ( pPedToInform )
    CEntity::RegisterReference(pPedToInform, &CInformFriendsEventQueue::ms_informFriendsEvents[v5].m_pPedToInform);
  v10 = &CInformFriendsEventQueue::ms_informFriendsEvents[v5];
  v11 = CTimer::m_snTimeInMilliseconds + v9 + 300;
  v10->m_pEvent = pEvent;
  v10->m_informTime = v11;
  return 1;
}

//----- (003700AC) --------------------------------------------------------
void CInformFriendsEventQueue::Process()
{
  int v0; // r10
  int v1; // r11
  CPed *m_pPedToInform; // r0
  int *p_m_informTime; // r9
  CInformFriendsEvent *v4; // r6
  CPed *v5; // r0
  CEvent *m_pEvent; // r0
  CEvent *v7; // r0

  v0 = 0;
  v1 = 0;
  do
  {
    m_pPedToInform = CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_pPedToInform;
    if ( m_pPedToInform )
    {
      p_m_informTime = &CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_informTime;
      if ( *p_m_informTime >= CTimer::m_snTimeInMilliseconds )
        goto LABEL_12;
      v4 = &CInformFriendsEventQueue::ms_informFriendsEvents[v0];
      CEventGroup::Add(
        &m_pPedToInform->m_pPedIntelligence->m_eventGroup,
        CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_pEvent,
        0);
      v5 = CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_pPedToInform;
      if ( v5 )
      {
        CEntity::CleanUpOldReference(v5, &CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_pPedToInform);
        CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_pPedToInform = 0;
      }
      m_pEvent = v4->m_pEvent;
      if ( m_pEvent )
      {
        (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
        v4->m_pEvent = 0;
      }
    }
    else
    {
      v7 = CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_pEvent;
      if ( v7 )
      {
        (*((void (__fastcall **)(CEvent *))v7->_vptr$CEvent + 1))(v7);
        CInformFriendsEventQueue::ms_informFriendsEvents[v0].m_pEvent = 0;
      }
      p_m_informTime = &CInformFriendsEventQueue::ms_informFriendsEvents[v1].m_informTime;
    }
    *p_m_informTime = -1;
LABEL_12:
    ++v0;
    ++v1;
  }
  while ( v0 != 8 );
}

//----- (003701A4) --------------------------------------------------------
void __fastcall CInformGroupEvent::CInformGroupEvent(CInformGroupEvent *this)
{
  this->m_pPedWhoInformed = 0;
  this->m_pEvent = 0;
  this->m_informTime = -1;
}

//----- (003701B2) --------------------------------------------------------
void __fastcall CInformGroupEvent::~CInformGroupEvent(CInformGroupEvent *this)
{
  CPed *m_pPedWhoInformed; // r0
  CEvent *m_pEvent; // r0

  m_pPedWhoInformed = this->m_pPedWhoInformed;
  if ( m_pPedWhoInformed )
  {
    CEntity::CleanUpOldReference(m_pPedWhoInformed, &this->m_pPedWhoInformed);
    this->m_pPedWhoInformed = 0;
  }
  m_pEvent = this->m_pEvent;
  if ( m_pEvent )
  {
    (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
    this->m_pEvent = 0;
  }
  this->m_informTime = -1;
}

//----- (003701DE) --------------------------------------------------------
void __fastcall CInformGroupEvent::Flush(CInformGroupEvent *this)
{
  CPed *m_pPedWhoInformed; // r0
  CEvent *m_pEvent; // r0

  m_pPedWhoInformed = this->m_pPedWhoInformed;
  if ( m_pPedWhoInformed )
  {
    CEntity::CleanUpOldReference(m_pPedWhoInformed, &this->m_pPedWhoInformed);
    this->m_pPedWhoInformed = 0;
  }
  m_pEvent = this->m_pEvent;
  if ( m_pEvent )
  {
    (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
    this->m_pEvent = 0;
  }
  this->m_informTime = -1;
}

//----- (00370208) --------------------------------------------------------
void __fastcall CInformGroupEvent::Set(CInformGroupEvent *this, CPed *pPed, CPedGroup *pGroup, CEvent *pEvent, int a5)
{
  uint32 v8; // r0

  this->m_pPedWhoInformed = pPed;
  if ( pPed )
    CEntity::RegisterReference(pPed, &this->m_pPedWhoInformed);
  v8 = CTimer::m_snTimeInMilliseconds;
  this->m_pPedWhoInformedGroup = pGroup;
  this->m_pEvent = pEvent;
  this->m_informTime = v8 + a5;
}

//----- (00370244) --------------------------------------------------------
void __fastcall CInformGroupEvent::Process(CInformGroupEvent *this)
{
  CPed *m_pPedWhoInformed; // r0
  int *p_m_informTime; // r6
  CPedGroup *PedsGroup; // r0
  CPedGroup *v5; // r5
  int32 GroupId; // r0
  CPed *v7; // r9
  int v8; // r0
  CEvent *m_pEvent; // r0
  CEvent *v10; // r0
  CEvent rEvent; // [sp+4h] [bp-2Ch] BYREF
  CEntity *v12; // [sp+10h] [bp-20h] BYREF
  int v13; // [sp+14h] [bp-1Ch]

  m_pPedWhoInformed = this->m_pPedWhoInformed;
  if ( m_pPedWhoInformed )
  {
    p_m_informTime = &this->m_informTime;
    if ( this->m_informTime >= CTimer::m_snTimeInMilliseconds )
      return;
    PedsGroup = CPedGroups::GetPedsGroup(m_pPedWhoInformed);
    v5 = PedsGroup;
    if ( PedsGroup )
    {
      GroupId = CPedGroups::GetGroupId(PedsGroup);
      if ( GroupId >= 0 && CPedGroups::ms_activeGroups[GroupId] )
      {
        v7 = this->m_pPedWhoInformed;
        v8 = (*((int (__fastcall **)(CEvent *))this->m_pEvent->_vptr$CEvent + 5))(this->m_pEvent);
        rEvent.m_iAccumulatedTime = 0;
        rEvent.m_bIsPersistent = 0;
        rEvent._vptr$CEvent = (int (**)(void))&off_6660CC;
        v12 = v7;
        v13 = v8;
        if ( v7 )
          CEntity::RegisterReference(v7, &v12);
        CPedGroupIntelligence::AddEvent(&v5->m_intelligence, &rEvent);
        rEvent._vptr$CEvent = (int (**)(void))&off_6660CC;
        if ( v12 )
          CEntity::CleanUpOldReference(v12, &v12);
        if ( v13 )
          (*(void (__fastcall **)(int))(*(_DWORD *)v13 + 4))(v13);
      }
    }
    if ( this->m_pPedWhoInformed )
    {
      CEntity::CleanUpOldReference(this->m_pPedWhoInformed, &this->m_pPedWhoInformed);
      this->m_pPedWhoInformed = 0;
    }
    m_pEvent = this->m_pEvent;
    if ( m_pEvent )
    {
      (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
      this->m_pEvent = 0;
    }
  }
  else
  {
    v10 = this->m_pEvent;
    if ( v10 )
    {
      (*((void (__fastcall **)(CEvent *))v10->_vptr$CEvent + 1))(v10);
      this->m_pEvent = 0;
    }
    p_m_informTime = &this->m_informTime;
  }
  *p_m_informTime = -1;
}
// 6660CC: using guessed type void *off_6660CC;

//----- (0037033C) --------------------------------------------------------
void CInformGroupEventQueue::Init()
{
  int i; // r6
  CPed *m_pPedWhoInformed; // r0
  CEvent *m_pEvent; // r0
  CInformGroupEvent *v3; // r0

  for ( i = 0; i != 8; ++i )
  {
    m_pPedWhoInformed = CInformGroupEventQueue::ms_informGroupEvents[i].m_pPedWhoInformed;
    if ( m_pPedWhoInformed )
    {
      CEntity::CleanUpOldReference(
        m_pPedWhoInformed,
        &CInformGroupEventQueue::ms_informGroupEvents[i].m_pPedWhoInformed);
      CInformGroupEventQueue::ms_informGroupEvents[i].m_pPedWhoInformed = 0;
    }
    m_pEvent = CInformGroupEventQueue::ms_informGroupEvents[i].m_pEvent;
    if ( m_pEvent )
    {
      (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
      CInformGroupEventQueue::ms_informGroupEvents[i].m_pEvent = 0;
    }
    v3 = &CInformGroupEventQueue::ms_informGroupEvents[i];
    v3->m_informTime = -1;
  }
}

//----- (003703B4) --------------------------------------------------------
void CInformGroupEventQueue::Flush()
{
  int i; // r6
  CPed *m_pPedWhoInformed; // r0
  CEvent *m_pEvent; // r0
  CInformGroupEvent *v3; // r0

  for ( i = 0; i != 8; ++i )
  {
    m_pPedWhoInformed = CInformGroupEventQueue::ms_informGroupEvents[i].m_pPedWhoInformed;
    if ( m_pPedWhoInformed )
    {
      CEntity::CleanUpOldReference(
        m_pPedWhoInformed,
        &CInformGroupEventQueue::ms_informGroupEvents[i].m_pPedWhoInformed);
      CInformGroupEventQueue::ms_informGroupEvents[i].m_pPedWhoInformed = 0;
    }
    m_pEvent = CInformGroupEventQueue::ms_informGroupEvents[i].m_pEvent;
    if ( m_pEvent )
    {
      (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
      CInformGroupEventQueue::ms_informGroupEvents[i].m_pEvent = 0;
    }
    v3 = &CInformGroupEventQueue::ms_informGroupEvents[i];
    v3->m_informTime = -1;
  }
}

//----- (0037042C) --------------------------------------------------------
bool __fastcall CInformGroupEventQueue::Add(CPed *pPedWhoInformed, CPedGroup *pPedGroup, CEvent *pEvent)
{
  __int64 v4; // r8
  int v5; // r4
  int v6; // r11
  CEvent **p_m_pEvent; // r6
  int v8; // r5
  CPlayerPed *PlayerPed; // r0
  int v10; // r4
  CInformGroupEvent *v11; // r5
  bool v13; // zf
  uint32 v14; // r0

  HIDWORD(v4) = pEvent;
  LODWORD(v4) = pPedGroup;
  v5 = -1;
  v6 = -1;
  p_m_pEvent = &CInformGroupEventQueue::ms_informGroupEvents[0].m_pEvent;
  do
  {
    ++v5;
    if ( *(p_m_pEvent - 2) == (CEvent *)pPedWhoInformed )
    {
      v8 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)HIDWORD(v4) + 8))(HIDWORD(v4));
      if ( v8 == (*((int (__fastcall **)(CEvent *))(*p_m_pEvent)->_vptr$CEvent + 2))(*p_m_pEvent) )
        return 0;
    }
    else if ( v6 == -1 )
    {
      v6 = -1;
      if ( !*p_m_pEvent )
        v6 = v5;
    }
    p_m_pEvent += 4;
  }
  while ( v5 < 7 );
  if ( v6 == -1 )
    return 0;
  if ( ((*(int (__fastcall **)(_DWORD))(*(_DWORD *)HIDWORD(v4) + 8))(HIDWORD(v4)) == 36
     || (*(int (__fastcall **)(_DWORD))(*(_DWORD *)HIDWORD(v4) + 8))(HIDWORD(v4)) == 37)
    && (CEventEditableResponse::ComputeResponseTaskType((CEventEditableResponse *)HIDWORD(v4), (CPedGroup *)v4),
        PlayerPed = FindPlayerPed(-1),
        !CPedGroupMembership::IsMember(
           &CPedGroups::ms_groups[PlayerPed->m_pPlayerData->m_PlayerGroup].m_membership,
           pPedWhoInformed)) )
  {
    if ( pPedWhoInformed->CharCreatedBy == 2 )
      goto LABEL_21;
    v13 = *(unsigned __int8 *)(*(_DWORD *)(HIDWORD(v4) + 16) + 1157) << 31 == 0;
    if ( *(unsigned __int8 *)(*(_DWORD *)(HIDWORD(v4) + 16) + 1157) << 31 )
      v13 = *(unsigned __int16 *)(HIDWORD(v4) + 10) == 200;
    if ( v13 )
LABEL_21:
      v10 = 0;
    else
      v10 = 5000;
    v11 = &CInformGroupEventQueue::ms_informGroupEvents[v6];
    v11->m_pPedWhoInformed = pPedWhoInformed;
  }
  else
  {
    v10 = 0;
    v11 = &CInformGroupEventQueue::ms_informGroupEvents[v6];
    v11->m_pPedWhoInformed = pPedWhoInformed;
    if ( !pPedWhoInformed )
      goto LABEL_24;
  }
  CEntity::RegisterReference(pPedWhoInformed, &v11->m_pPedWhoInformed);
LABEL_24:
  v14 = CTimer::m_snTimeInMilliseconds;
  *(_QWORD *)&v11->m_pPedWhoInformedGroup = v4;
  v11->m_informTime = v14 + v10;
  return 1;
}

//----- (00370568) --------------------------------------------------------
void __fastcall CEventEditableResponse::ComputeResponseTaskType(CEventEditableResponse *this, CPedGroup *pPedGroup)
{
  int v4; // r8
  CPed *Leader; // r0
  CPed *v6; // r5
  int v7; // r4
  CPed *Member; // r0
  int v9; // r10
  int v10; // r4
  CDecisionMakerTypes *v11; // r0
  CDecisionMakerTypes *v12; // r0
  int16 Decision; // r0
  CPed *v14; // r0
  CPed *v15; // r4
  int v16; // r5
  int v17; // r4
  CDecisionMakerTypes *v18; // r0
  CDecisionMakerTypes *v19; // r0

  if ( this->m_iTaskType != 200 )
    return;
  v4 = (*((int (__fastcall **)(CEventEditableResponse *))this->_vptr$CEvent + 2))(this);
  Leader = CPedGroupMembership::GetLeader(&pPedGroup->m_membership);
  v6 = Leader;
  if ( !Leader || CPed::IsPlayer(Leader) )
  {
    v7 = 0;
    do
    {
      Member = CPedGroupMembership::GetMember(&pPedGroup->m_membership, v7);
      v6 = Member;
      if ( v7 > 5 )
        break;
      ++v7;
    }
    while ( !Member );
    if ( !Member )
    {
      this->m_iTaskType = 200;
LABEL_13:
      if ( CPedGroupMembership::GetLeader(&pPedGroup->m_membership) )
      {
        v14 = CPedGroupMembership::GetLeader(&pPedGroup->m_membership);
        if ( CPed::IsPlayer(v14) )
        {
          v15 = CPedGroupMembership::GetLeader(&pPedGroup->m_membership);
          v16 = CEventSource::ComputeEventSourceType((const CEvent *)this, v15);
          v17 = *(_DWORD *)&v15->m_nPedFlags & 0x100;
          v18 = CDecisionMakerTypes::m_pPedDecisionTypes;
          if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
          {
            v19 = (CDecisionMakerTypes *)operator new(0xF1C0u);
            CDecisionMakerTypes::CDecisionMakerTypes(v19);
            CDecisionMakerTypes::m_pPedDecisionTypes = v18;
          }
          this->m_iTaskType = CDecisionMakerTypes::MakeDecision(v18, pPedGroup, v4, v16, v17 != 0, 1200, 1700, 300, -1);
        }
      }
      return;
    }
  }
  v9 = CEventSource::ComputeEventSourceType((const CEvent *)this, v6);
  v10 = *(_DWORD *)&v6->m_nPedFlags & 0x100;
  v11 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v12 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v12);
    CDecisionMakerTypes::m_pPedDecisionTypes = v11;
  }
  Decision = CDecisionMakerTypes::MakeDecision(v11, pPedGroup, v4, v9, v10 != 0, 1200, 1700, 300, -1);
  this->m_iTaskType = Decision;
  if ( Decision == 200 )
    goto LABEL_13;
}
// 3705EA: variable 'v11' is possibly undefined
// 370674: variable 'v18' is possibly undefined

//----- (003706BC) --------------------------------------------------------
void CInformGroupEventQueue::Process()
{
  CInformGroupEvent::Process(CInformGroupEventQueue::ms_informGroupEvents);
  CInformGroupEvent::Process(&CInformGroupEventQueue::ms_informGroupEvents[1]);
  CInformGroupEvent::Process(&CInformGroupEventQueue::ms_informGroupEvents[2]);
  CInformGroupEvent::Process(&CInformGroupEventQueue::ms_informGroupEvents[3]);
  CInformGroupEvent::Process(&CInformGroupEventQueue::ms_informGroupEvents[4]);
  CInformGroupEvent::Process(&CInformGroupEventQueue::ms_informGroupEvents[5]);
  CInformGroupEvent::Process(&CInformGroupEventQueue::ms_informGroupEvents[6]);
  CInformGroupEvent::Process(&CInformGroupEventQueue::ms_informGroupEvents[7]);
}

//----- (0037070C) --------------------------------------------------------
void __fastcall CEventEditableResponse::CEventEditableResponse(CEventEditableResponse *this)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_665DC0;
}
// 665DC0: using guessed type void *;

//----- (00370734) --------------------------------------------------------
void __fastcall CEventEditableResponse::ComputeResponseTaskType(
        CEventEditableResponse *this,
        CPed *pPed,
        const bool bUseInGroupDecisionMaker)
{
  int v4; // r10
  int16 *iTaskType; // r5
  int v7; // r8
  int v8; // r9
  int v9; // r4
  CDecisionMakerTypes *v10; // r0
  CDecisionMakerTypes *v11; // r0

  v4 = bUseInGroupDecisionMaker;
  iTaskType = &this->m_iTaskType;
  if ( this->m_iTaskType == 200 )
  {
    v7 = (*((int (__fastcall **)(CEventEditableResponse *))this->_vptr$CEvent + 2))(this);
    v8 = CEventSource::ComputeEventSourceType((const CEvent *)this, pPed);
    v9 = *(_DWORD *)&pPed->m_nPedFlags & 0x100;
    v10 = CDecisionMakerTypes::m_pPedDecisionTypes;
    if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
    {
      v11 = (CDecisionMakerTypes *)operator new(0xF1C0u);
      CDecisionMakerTypes::CDecisionMakerTypes(v11);
      CDecisionMakerTypes::m_pPedDecisionTypes = v10;
    }
    CDecisionMakerTypes::MakeDecision(
      v10,
      pPed,
      v7,
      v8,
      v9 != 0,
      1700,
      1200,
      300,
      -1,
      v4,
      iTaskType,
      &this->m_iFacialTaskType);
  }
}
// 370786: variable 'v10' is possibly undefined

//----- (003707CC) --------------------------------------------------------
bool __fastcall CEventEditableResponse::ComputeResponseTaskOfType(
        const CEventEditableResponse *this,
        CPed *pPed,
        const int iTaskTypeToSeek)
{
  int v6; // r8
  int v7; // r9
  int v8; // r4
  CDecisionMakerTypes *v9; // r0
  CDecisionMakerTypes *v10; // r0
  bool v11; // r6
  int16 v13; // [sp+24h] [bp-1Ch] BYREF
  int16 iTaskType[13]; // [sp+26h] [bp-1Ah] BYREF

  v6 = (*((int (__fastcall **)(const CEventEditableResponse *))this->_vptr$CEvent + 2))(this);
  v7 = CEventSource::ComputeEventSourceType((const CEvent *)this, pPed);
  v8 = *(_DWORD *)&pPed->m_nPedFlags & 0x100;
  v9 = CDecisionMakerTypes::m_pPedDecisionTypes;
  if ( !CDecisionMakerTypes::m_pPedDecisionTypes )
  {
    v10 = (CDecisionMakerTypes *)operator new(0xF1C0u);
    CDecisionMakerTypes::CDecisionMakerTypes(v10);
    CDecisionMakerTypes::m_pPedDecisionTypes = v9;
  }
  v11 = 0;
  CDecisionMakerTypes::MakeDecision(v9, pPed, v6, v7, v8 != 0, -1, -1, -1, iTaskTypeToSeek, 0, iTaskType, &v13);
  if ( iTaskType[0] == iTaskTypeToSeek )
    return 1;
  return v11;
}
// 370814: variable 'v9' is possibly undefined
// 3707CC: using guessed type int16 var_1A[13];

//----- (00370860) --------------------------------------------------------
bool __fastcall CEventEditableResponse::WillRespond(const CEventEditableResponse *this)
{
  return this->m_iTaskType != 200;
}

//----- (0037086C) --------------------------------------------------------
bool __fastcall CEventEditableResponse::InformGroup(const CEventEditableResponse *this, CPed *pPed)
{
  CPedGroup *PedsGroup; // r6
  bool v5; // r4
  int v6; // r5
  _BOOL4 v7; // r0

  PedsGroup = CPedGroups::GetPedsGroup(pPed);
  v5 = 0;
  if ( PedsGroup )
  {
    v6 = (*((int (__fastcall **)(const CEventEditableResponse *))this->_vptr$CEvent + 5))(this);
    *(_WORD *)(v6 + 10) = 200;
    *(_BYTE *)(v6 + 9) = 0;
    v7 = CInformGroupEventQueue::Add(pPed, PedsGroup, (CEvent *)v6);
    v5 = 1;
    if ( v6 )
    {
      if ( !v7 )
      {
        (*(void (__fastcall **)(int))(*(_DWORD *)v6 + 4))(v6);
        return 1;
      }
    }
  }
  return v5;
}

//----- (003708B6) --------------------------------------------------------
bool __fastcall CEventEditableResponse::InformRespectedFriends(const CEventEditableResponse *this, CPed *pPed)
{
  CPedIntelligence *m_pPedIntelligence; // r0
  int m_iMaxNumFriendsToInform; // r11
  float m_fMaxInformFriendDistance; // s16
  float v6; // s16
  int v7; // r6
  int v8; // r9
  CEntity **m_entities; // r8
  CPed *v10; // r5
  uint32 v11; // r4
  int32 *p_m_nPedType; // r0
  CMatrix *m_pMat; // r0
  CMatrix *v14; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r0
  float32x2_t v17; // d16
  unsigned __int64 v18; // d1
  CEvent *v19; // r4
  bool v20; // cc
  uint32 Acquaintances; // [sp+4h] [bp-34h]

  if ( !this->m_bWitnessedFirstHand )
    return 0;
  m_pPedIntelligence = pPed->m_pPedIntelligence;
  m_iMaxNumFriendsToInform = m_pPedIntelligence->m_iMaxNumFriendsToInform;
  if ( !m_iMaxNumFriendsToInform )
    return 0;
  m_fMaxInformFriendDistance = m_pPedIntelligence->m_fMaxInformFriendDistance;
  Acquaintances = CAcquaintance::GetAcquaintances(&pPed->m_acquaintances, 0);
  if ( m_iMaxNumFriendsToInform >= 1 )
  {
    v6 = m_fMaxInformFriendDistance * m_fMaxInformFriendDistance;
    v7 = 0;
    v8 = 0;
    m_entities = pPed->m_pPedIntelligence->m_pedScanner.m_entities;
    while ( 1 )
    {
      v10 = (CPed *)m_entities[v8];
      if ( v10 )
      {
        if ( pPed->m_nPedType == 6 )
        {
          if ( v10->m_nPedType == 6 && FindPlayerPed(0)->m_pPlayerData->m_Wanted->m_WantedLevel == WANTED_CLEAN )
            goto LABEL_14;
        }
        else
        {
          if ( CPed::IsPlayer(pPed) )
          {
            v11 = CAcquaintance::GetAcquaintances(&v10->m_acquaintances, 0);
            p_m_nPedType = &pPed->m_nPedType;
          }
          else
          {
            v11 = Acquaintances;
            p_m_nPedType = &v10->m_nPedType;
          }
          if ( (CPedType::GetPedFlag(*p_m_nPedType) & v11) != 0 )
          {
LABEL_14:
            m_pMat = v10->m_pMat;
            v14 = pPed->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &v10->m_transform;
            p_m_transform = (CSimpleTransform *)&v14->tx;
            if ( !v14 )
              p_m_transform = &pPed->m_transform;
            v17.n64_u64[0] = vsub_f32(
                               *(float32x2_t *)&p_m_transform->m_translate.y,
                               *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
            v18 = vmul_f32(v17, v17).n64_u64[0];
            if ( (float)((float)((float)((float)(p_m_transform->m_translate.x - p_tx->m_translate.x)
                                       * (float)(p_m_transform->m_translate.x - p_tx->m_translate.x))
                               + *(float *)&v18)
                       + *((float *)&v18 + 1)) < v6 )
            {
              v19 = (CEvent *)(*((int (__fastcall **)(const CEventEditableResponse *))this->_vptr$CEvent + 5))(this);
              *((_WORD *)&v19->m_bIsPersistent + 1) = 200;
              *(&v19->m_bIsPersistent + 1) = 0;
              if ( CInformFriendsEventQueue::Add(v10, v19) )
              {
                ++v7;
              }
              else if ( v19 )
              {
                (*((void (__fastcall **)(CEvent *))v19->_vptr$CEvent + 1))(v19);
              }
            }
          }
        }
      }
      v20 = v8 < 14;
      if ( v8 <= 14 )
      {
        ++v8;
        v20 = v7 < m_iMaxNumFriendsToInform;
      }
      if ( !v20 )
        return v7 != 0;
    }
  }
  v7 = 0;
  return v7 != 0;
}

//----- (00370A0C) --------------------------------------------------------
bool __fastcall CEventEditableResponse::InformVehicleOccupants(const CEventEditableResponse *this, CPed *pPed)
{
  CVehicle *m_pMyVehicle; // r8
  CPed *pDriver; // r4
  bool v6; // zf
  int v7; // r6
  uint8 m_nMaxPassengers; // r0
  int v9; // r10
  CPed *v10; // r11
  bool v11; // zf
  int v12; // r6

  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31
    && (*((int (__fastcall **)(const CEventEditableResponse *, CPed *))this->_vptr$CEvent + 14))(this, pPed) == 1
    && this->m_bWitnessedFirstHand )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    pDriver = m_pMyVehicle->pDriver;
    v6 = pDriver == 0;
    if ( pDriver )
      v6 = pDriver == pPed;
    if ( !v6 )
    {
      v7 = (*((int (__fastcall **)(const CEventEditableResponse *))this->_vptr$CEvent + 5))(this);
      *(_WORD *)(v7 + 10) = 200;
      *(_BYTE *)(v7 + 9) = 0;
      CEventGroup::Add(&pDriver->m_pPedIntelligence->m_eventGroup, (CEvent *)v7, 0);
      (*(void (__fastcall **)(int))(*(_DWORD *)v7 + 4))(v7);
    }
    m_nMaxPassengers = m_pMyVehicle->m_nMaxPassengers;
    if ( m_nMaxPassengers )
    {
      v9 = 0;
      do
      {
        v10 = m_pMyVehicle->pPassengers[v9];
        v11 = v10 == 0;
        if ( v10 )
          v11 = v10 == pPed;
        if ( !v11 )
        {
          v12 = (*((int (__fastcall **)(const CEventEditableResponse *))this->_vptr$CEvent + 5))(this);
          *(_WORD *)(v12 + 10) = 200;
          *(_BYTE *)(v12 + 9) = 0;
          CEventGroup::Add(&v10->m_pPedIntelligence->m_eventGroup, (CEvent *)v12, 0);
          (*(void (__fastcall **)(int))(*(_DWORD *)v12 + 4))(v12);
          m_nMaxPassengers = m_pMyVehicle->m_nMaxPassengers;
        }
        ++v9;
      }
      while ( v9 < m_nMaxPassengers );
    }
  }
  return 1;
}

//----- (00370ACC) --------------------------------------------------------
bool __fastcall CEventEditableResponse::TriggerLookAt(const CEventEditableResponse *this, CPed *pPed)
{
  int v3; // r0

  v3 = (*((int (__fastcall **)(const CEventEditableResponse *))this->_vptr$CEvent + 11))(this);
  if ( v3 )
  {
    if ( (*(_BYTE *)(v3 + 58) & 7) == 3 )
      IKChainManager_c::LookAt(
        &g_ikChainMan,
        "CEventEditableResponse",
        pPed,
        (CEntity *)v3,
        2000,
        5,
        0,
        1,
        0.25,
        500,
        3,
        0);
    else
      IKChainManager_c::LookAt(
        &g_ikChainMan,
        "CEventEditableResponse",
        pPed,
        (CEntity *)v3,
        2000,
        -1,
        0,
        1,
        0.25,
        500,
        3,
        0);
  }
  return 1;
}

//----- (00370B7C) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CEventGunShot::CEventGunShot(
        CEventGunShot *this,
        CEntity *pFiringEntity,
        CVector ShotOrigin,
        CVector ShotTarget,
        bool bSilent)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_vShotOrigin = ShotOrigin;
  this->m_vShotTarget = ShotTarget;
  this->m_bSilent = bSilent;
  this->_vptr$CEvent = (int (**)(void))&off_665E10;
  this->m_pFiringEntity = pFiringEntity;
  if ( pFiringEntity )
    CEntity::RegisterReference(pFiringEntity, &this->m_pFiringEntity);
}
// 370B7C: fragmented variable at 0:r2.8,8:^20.4 may be wrong
// 370B7C: variables would overlap: 0:r2.8,8:^20.4 and ^20.4
// 665E10: using guessed type void *;

//----- (00370BE4) --------------------------------------------------------
void __fastcall CEventGunShotWhizzedBy::~CEventGunShotWhizzedBy(CEventGunShot *this)
{
  CEntity *m_pFiringEntity; // r0
  CEntity **p_m_pFiringEntity; // r1

  p_m_pFiringEntity = &this->m_pFiringEntity;
  m_pFiringEntity = this->m_pFiringEntity;
  this->_vptr$CEvent = (int (**)(void))&off_665E10;
  if ( m_pFiringEntity )
    CEntity::CleanUpOldReference(m_pFiringEntity, p_m_pFiringEntity);
}
// 665E10: using guessed type void *off_665E10;

//----- (00370C0C) --------------------------------------------------------
void __fastcall CEventGunShot::~CEventGunShot(CEventGunShot *this)
{
  CEntity *m_pFiringEntity; // r0
  CEntity **p_m_pFiringEntity; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pFiringEntity = &this->m_pFiringEntity;
  m_pFiringEntity = this->m_pFiringEntity;
  this->_vptr$CEvent = (int (**)(void))&off_665E10;
  if ( m_pFiringEntity )
    CEntity::CleanUpOldReference(m_pFiringEntity, p_m_pFiringEntity);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665E10: using guessed type void *off_665E10;

//----- (00370C60) --------------------------------------------------------
bool __fastcall CEventGunShot::TakesPriorityOver(const CEventGunShot *this, const CEvent *otherEvent)
{
  int v4; // r6
  CEntity *m_pFiringEntity; // r0
  bool v6; // r5
  int v7; // r5
  int m_iAccumulatedTime; // r0
  _BOOL4 v10; // r0

  v4 = (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent);
  if ( v4 == (*((int (__fastcall **)(const CEventGunShot *))this->_vptr$CEvent + 2))(this) )
  {
    m_pFiringEntity = this->m_pFiringEntity;
    v6 = m_pFiringEntity
      && (*(_BYTE *)&m_pFiringEntity->m_info & 7) == 3
      && CPed::IsPlayer((const CPed *)m_pFiringEntity);
    m_iAccumulatedTime = otherEvent[1].m_iAccumulatedTime;
    if ( m_iAccumulatedTime && (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) == 3 )
      v10 = !CPed::IsPlayer((const CPed *)m_iAccumulatedTime);
    else
      LOBYTE(v10) = 1;
    return v10 && v6;
  }
  else
  {
    v7 = (*((int (__fastcall **)(const CEventGunShot *))this->_vptr$CEvent + 3))(this);
    return v7 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
  }
}

//----- (00370CE4) --------------------------------------------------------
bool __fastcall CEventGunShot::AffectsPed(const CEventGunShot *this, CPed *pPed)
{
  float32x2_t v2; // d4
  float32x2_t v3; // d5
  CEntity *m_pFiringEntity; // r1
  bool v7; // zf
  CVehicle *m_pMyVehicle; // r0
  CWanted *PlayerWanted; // r0
  CWanted *v10; // r0
  CPlayerPed *v11; // r6
  CEntity *v12; // r2
  CMatrix *m_pMat; // r0
  CMatrix *v14; // r3
  CSimpleTransform *p_tx; // r1
  float *p_x; // r6
  float x; // s2
  float y; // s4
  float z; // s0
  int CharCreatedBy; // r2
  float v21; // s8
  CPedIntelligence *m_pPedIntelligence; // r2
  bool v23; // r5

  m_pFiringEntity = this->m_pFiringEntity;
  if ( !m_pFiringEntity
    || (*(_BYTE *)&m_pFiringEntity->m_info & 7) == 3 && CPedGroups::AreInSameGroup(pPed, (const CPed *)m_pFiringEntity) )
  {
    return 0;
  }
  m_pMyVehicle = (CVehicle *)(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31);
  v7 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    v7 = m_pMyVehicle == 0;
  }
  if ( !v7 && CVehicle::IsPassenger(m_pMyVehicle, pPed) && pPed->m_pMyVehicle->pDriver )
    return 0;
  if ( pPed->m_nPedType == 6 && FindPlayerWanted(-1)->m_WantedLevel >= WANTED_LEVEL1 )
  {
    PlayerWanted = FindPlayerWanted(-1);
    if ( CWanted::IsInPursuit(PlayerWanted, (CCopPed *)pPed)
      || (v10 = FindPlayerWanted(-1), CWanted::CanCopJoinPursuit(v10, (CCopPed *)pPed)) )
    {
      v11 = (CPlayerPed *)this->m_pFiringEntity;
      if ( v11 != FindPlayerPed(-1) )
        return 0;
    }
  }
  if ( !CPed::IsAlive(pPed) || this->m_pFiringEntity == pPed || CPed::IsPlayer(pPed) )
    return 0;
  v12 = this->m_pFiringEntity;
  m_pMat = pPed->m_pMat;
  v14 = v12->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  p_x = &v14->tx;
  x = p_tx->m_translate.x;
  y = p_tx->m_translate.y;
  z = p_tx->m_translate.z;
  if ( !v14 )
    p_x = &v12->m_transform.m_translate.x;
  CharCreatedBy = pPed->CharCreatedBy;
  if ( CEventGunShot::ms_fGunShotSenseRangeForRiot2 <= 0.0 )
  {
    if ( CharCreatedBy == 2 )
    {
      m_pPedIntelligence = pPed->m_pPedIntelligence;
      v2.n64_u32[0] = LODWORD(m_pPedIntelligence->m_fHearingRange);
      v3.n64_u32[0] = LODWORD(m_pPedIntelligence->m_fSeeingRange);
      LODWORD(v21) = vmax_f32(v2, v3).n64_u32[0];
    }
    else
    {
      v21 = 45.0;
    }
  }
  else
  {
    v21 = 45.0;
    if ( CharCreatedBy == 2 )
      v21 = CEventGunShot::ms_fGunShotSenseRangeForRiot2;
  }
  if ( (float)((float)((float)((float)(x - *p_x) * (float)(x - *p_x))
                     + (float)((float)(y - p_x[1]) * (float)(y - p_x[1])))
             + (float)((float)(z - p_x[2]) * (float)(z - p_x[2]))) > (float)(v21 * v21) )
    return 0;
  if ( !this->m_bSilent )
    return 1;
  v23 = 0;
  if ( (float)((float)((float)((float)(this->m_vShotOrigin.x - x) * m_pMat->xy)
                     + (float)((float)(this->m_vShotOrigin.y - y) * m_pMat->yy))
             + (float)((float)(this->m_vShotOrigin.z - z) * m_pMat->zy)) > 0.0
    && CWorld::GetIsLineOfSightClear(&this->m_vShotOrigin, &p_tx->m_translate, 1, 1, 1, 1, 1, 0, 0) )
  {
    return 1;
  }
  return v23;
}
// 370E22: variable 'v2' is possibly undefined
// 370E22: variable 'v3' is possibly undefined
// 677340: using guessed type float *CEventGunShot::ms_fGunShotSenseRangeForRiot2;

//----- (00370EBC) --------------------------------------------------------
bool __fastcall CEventGunShot::IsCriminalEvent(const CEventGunShot *this)
{
  CEntity *m_pFiringEntity; // r0

  m_pFiringEntity = this->m_pFiringEntity;
  return m_pFiringEntity
      && (*(_BYTE *)&m_pFiringEntity->m_info & 7) == 3
      && CPed::IsPlayer((const CPed *)m_pFiringEntity);
}

//----- (00370EE8) --------------------------------------------------------
void __fastcall CEventVehicleCollision::CEventVehicleCollision(
        CEventVehicleCollision *this,
        const uint16 nPieceType,
        const float fImpulseMagnitude,
        const CVehicle *pVehicle,
        const CVector *vNormal,
        const CVector *vPos,
        const int iMoveState,
        uint16 nForceReaction)
{
  __int64 v8; // d16
  __int64 v9; // d16

  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_iPieceType = nPieceType;
  this->m_nForceReaction = nForceReaction;
  this->m_fImpulseMagnitude = fImpulseMagnitude;
  this->_vptr$CEvent = (int (**)(void))&off_665E60;
  this->m_pVehicle = (CVehicle *)pVehicle;
  v8 = *(_QWORD *)&vNormal->x;
  this->m_vNormal.z = vNormal->z;
  *(_QWORD *)&this->m_vNormal.x = v8;
  v9 = *(_QWORD *)&vPos->x;
  this->m_vPos.z = vPos->z;
  *(_WORD *)&this->m_iMoveState = (unsigned __int8)iMoveState;
  *(_QWORD *)&this->m_vPos.x = v9;
  if ( pVehicle )
    CEntity::RegisterReference(&pVehicle->CPhysical, &this->m_pVehicle);
}
// 665E60: using guessed type void *off_665E60;

//----- (00370F54) --------------------------------------------------------
void __fastcall CEventVehicleCollision::~CEventVehicleCollision(CEventVehicleCollision *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_665E60;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
}
// 665E60: using guessed type void *off_665E60;

//----- (00370F7C) --------------------------------------------------------
void __fastcall CEventVehicleCollision::~CEventVehicleCollision(CEventVehicleCollision *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_665E60;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665E60: using guessed type void *;

//----- (00370FD0) --------------------------------------------------------
bool __fastcall CEventVehicleCollision::TakesPriorityOver(const CEventVehicleCollision *this, const CEvent *otherEvent)
{
  return 1;
}

//----- (00370FD4) --------------------------------------------------------
bool __fastcall CEventVehicleCollision::AffectsPed(const CEventVehicleCollision *this, CPed *pPed)
{
  bool result; // r0
  CVehicle *m_pVehicle; // r0
  CTask *SimplestActiveTask; // r0
  const CVector *v7; // r6
  float *p_x; // r9
  int v9; // r8
  CVehicle *v10; // r1
  CVehicle *m_pTowingVehicle; // r0
  bool v12; // zf
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r6
  CSimpleTransform *p_tx; // r2
  CMatrix *v16; // r0
  int v17; // r1
  int v18; // r2
  float y; // s4
  float v20; // s12
  float z; // s6
  float v22; // s14
  bool v23; // zf
  CTask *ActiveTask; // r0
  CTask *v25; // r5
  CVehicle *v26; // r1
  CVehicle *m_pParent; // r0
  CVehicle *m_pVehicleBeingTowed; // r2
  CVehicle *v29; // r2
  float v30; // [sp+0h] [bp-90h] BYREF
  float v31; // [sp+4h] [bp-8Ch]
  float v32; // [sp+8h] [bp-88h]
  float v33; // [sp+Ch] [bp-84h]
  CVector out_normals; // [sp+10h] [bp-80h] BYREF
  float v35; // [sp+1Ch] [bp-74h]
  float v36; // [sp+20h] [bp-70h]
  float v37; // [sp+24h] [bp-6Ch]
  float v38; // [sp+28h] [bp-68h]
  float v39; // [sp+2Ch] [bp-64h]
  float v40; // [sp+30h] [bp-60h]
  float v41; // [sp+34h] [bp-5Ch]
  float v42; // [sp+38h] [bp-58h]
  float v43; // [sp+3Ch] [bp-54h]

  if ( !CPed::IsAlive(pPed) )
    return 0;
  if ( this->m_nForceReaction )
    return 1;
  m_pVehicle = this->m_pVehicle;
  if ( !m_pVehicle
    || *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31
    || m_pVehicle->m_baseVehicleType == 5
    || (float)((float)((float)(this->m_vNormal.x * pPed->m_pMat->xy) + (float)(this->m_vNormal.y * pPed->m_pMat->yy))
             + (float)(this->m_vNormal.z * pPed->m_pMat->zy)) > -0.35 )
  {
    return 0;
  }
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  v7 = (const CVector *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    goto LABEL_40;
  if ( !CTask::IsGoToTask(SimplestActiveTask) )
    goto LABEL_40;
  p_x = &v7[1].x;
  v9 = CPedGeometryAnalyser::ComputeEntityHitSide(pPed, this->m_pVehicle);
  if ( v9 != CPedGeometryAnalyser::ComputeEntityHitSide(v7 + 1, this->m_pVehicle) )
    goto LABEL_40;
  v10 = this->m_pVehicle;
  m_pTowingVehicle = v10->m_pTowingVehicle;
  v12 = m_pTowingVehicle == 0;
  if ( !m_pTowingVehicle )
    v12 = v10->m_pVehicleBeingTowed == 0;
  if ( v12 )
    return 0;
  m_pMat = pPed->m_pMat;
  p_m_transform = &pPed->m_transform;
  p_tx = &pPed->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanes(p_tx->m_translate.z, v10, &out_normals, &v30);
  v16 = pPed->m_pMat;
  v17 = 0;
  v18 = 0;
  if ( v16 )
    p_m_transform = (CSimpleTransform *)&v16->tx;
  result = 0;
  y = p_m_transform->m_translate.y;
  v20 = p_x[1];
  z = p_m_transform->m_translate.z;
  v22 = p_x[2];
  if ( (float)(v31 + (float)((float)((float)(v35 * p_m_transform->m_translate.x) + (float)(v36 * y)) + (float)(v37 * z))) < 0.0 )
    v17 = 1;
  if ( (float)(v30
             + (float)((float)((float)(out_normals.x * p_m_transform->m_translate.x) + (float)(out_normals.y * y))
                     + (float)(out_normals.z * z))) < 0.0 )
    ++v17;
  if ( (float)(v32 + (float)((float)((float)(v38 * p_m_transform->m_translate.x) + (float)(v39 * y)) + (float)(v40 * z))) < 0.0 )
    ++v17;
  if ( (float)(v33 + (float)((float)((float)(v41 * p_m_transform->m_translate.x) + (float)(v42 * y)) + (float)(v43 * z))) < 0.0 )
    ++v17;
  if ( (float)(v31 + (float)((float)((float)(*p_x * v35) + (float)(v20 * v36)) + (float)(v22 * v37))) < 0.0 )
    v18 = 1;
  if ( (float)(v30
             + (float)((float)((float)(*p_x * out_normals.x) + (float)(v20 * out_normals.y))
                     + (float)(v22 * out_normals.z))) < 0.0 )
    ++v18;
  if ( (float)(v32 + (float)((float)((float)(*p_x * v38) + (float)(v20 * v39)) + (float)(v22 * v40))) < 0.0 )
    ++v18;
  if ( (float)(v33 + (float)((float)((float)(*p_x * v41) + (float)(v20 * v42)) + (float)(v22 * v43))) < 0.0 )
    ++v18;
  v23 = v17 == 4;
  if ( v17 != 4 )
    v23 = v18 == 4;
  if ( v23 )
  {
LABEL_40:
    ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
    v25 = ActiveTask;
    if ( !ActiveTask )
      return 1;
    if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 508 )
    {
      v26 = this->m_pVehicle;
      m_pParent = (CVehicle *)v25[3].m_pParent;
      if ( m_pParent != v26 )
      {
        m_pVehicleBeingTowed = v26->m_pVehicleBeingTowed;
        if ( m_pVehicleBeingTowed && m_pVehicleBeingTowed == m_pParent
          || (v29 = v26->m_pTowingVehicle) != 0 && v29 == m_pParent )
        {
          CTaskComplexWalkRoundCar::SetNewVehicle(
            (CTaskComplexWalkRoundCar *)v25,
            v26,
            (char)(4 * BYTE1(v25[1].m_pParent)) >> 4);
        }
        return 1;
      }
    }
    else if ( (*((int (__fastcall **)(CTask *))v25->_vptr$CTask + 5))(v25) != 505
           || v25[1].m_pParent != (CTask *)this->m_pVehicle )
    {
      return 1;
    }
    return 0;
  }
  return result;
}

//----- (003712C4) --------------------------------------------------------
void __fastcall CEventPedCollisionWithPed::CEventPedCollisionWithPed(
        CEventPedCollisionWithPed *this,
        const uint16 nPieceType,
        const float fImpulseMagnitude,
        const CPed *pPed,
        const CVector *vNormal,
        const CVector *vPos,
        const int iPedMoveState,
        const int iOtherPedMoveState)
{
  __int64 v8; // d16
  __int64 v9; // d16

  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_iPieceType = nPieceType;
  this->m_fImpulseMagnitude = fImpulseMagnitude;
  this->_vptr$CEvent = (int (**)(void))&off_665EAC;
  this->m_pOtherPed = (CPed *)pPed;
  v8 = *(_QWORD *)&vNormal->x;
  this->m_vNormal.z = vNormal->z;
  *(_QWORD *)&this->m_vNormal.x = v8;
  v9 = *(_QWORD *)&vPos->x;
  this->m_vPos.z = vPos->z;
  this->m_iPedMoveState = iPedMoveState;
  this->m_iOtherPedMoveState = iOtherPedMoveState;
  *(_QWORD *)&this->m_vPos.x = v9;
  if ( pPed )
    CEntity::RegisterReference(&pPed->CPhysical, &this->m_pOtherPed);
}
// 665EAC: using guessed type void *off_665EAC;

//----- (00371324) --------------------------------------------------------
void __fastcall CEventPedCollisionWithPed::~CEventPedCollisionWithPed(CEventPedCollisionWithPed *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CEvent = (int (**)(void))&off_665EAC;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
}
// 665EAC: using guessed type void *off_665EAC;

//----- (0037134C) --------------------------------------------------------
void __fastcall CEventPedCollisionWithPed::~CEventPedCollisionWithPed(CEventPedCollisionWithPed *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CEvent = (int (**)(void))&off_665EAC;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665EAC: using guessed type void *;

//----- (003713A0) --------------------------------------------------------
bool __fastcall CEventPedCollisionWithPed::TakesPriorityOver(
        const CEventPedCollisionWithPed *this,
        const CEvent *otherEvent)
{
  int v5; // r5

  if ( CEventHandler::IsTemporaryEvent(otherEvent) )
    return 1;
  v5 = (*((int (__fastcall **)(const CEventPedCollisionWithPed *))this->_vptr$CEvent + 3))(this);
  return v5 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (003713D4) --------------------------------------------------------
bool __fastcall CEventPedCollisionWithPed::AffectsPed(const CEventPedCollisionWithPed *this, CPed *pPed)
{
  _BOOL4 IsAlive; // r0
  bool v5; // zf
  CPed *m_pOtherPed; // r1
  bool v8; // zf
  CPedGroup *PedsGroup; // r0
  CTask *ActiveTaskByType; // r8
  CTask *v11; // r6
  int v12; // r8
  CTask *ActiveTask; // r0
  CTask *v14; // r0

  IsAlive = CPed::IsAlive(pPed);
  v5 = IsAlive;
  if ( IsAlive )
    v5 = pPed->m_pAttachToEntity == 0;
  if ( !v5 )
    return 0;
  m_pOtherPed = this->m_pOtherPed;
  if ( !m_pOtherPed )
    return 0;
  v8 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  if ( !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
    v8 = *((unsigned __int8 *)&m_pOtherPed->m_nPedFlags + 1) << 31 == 0;
  if ( !v8 )
    return 0;
  if ( m_pOtherPed->m_pPedIntelligence->m_iStaticCounter > 30 )
    return 0;
  if ( CPedIntelligence::IsThreatenedBy(pPed->m_pPedIntelligence, m_pOtherPed) )
    return 0;
  if ( this->m_iPedMoveState <= 3 )
  {
    PedsGroup = CPedGroups::GetPedsGroup(this->m_pOtherPed);
    if ( !PedsGroup || !CPedGroupMembership::IsLeader(&PedsGroup->m_membership, this->m_pOtherPed) )
      return 0;
  }
  if ( (float)((float)((float)(this->m_vNormal.x * pPed->m_pMat->xy) + (float)(this->m_vNormal.y * pPed->m_pMat->yy))
             + (float)(this->m_vNormal.z * pPed->m_pMat->zy)) > -0.5 )
    return 0;
  ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1202);
  if ( ActiveTaskByType
    || (ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1203)) != 0 )
  {
    v11 = CTaskManager::FindActiveTaskByType(&this->m_pOtherPed->m_pPedIntelligence->m_taskManager, 1202);
    if ( v11
      || (v11 = CTaskManager::FindActiveTaskByType(&this->m_pOtherPed->m_pPedIntelligence->m_taskManager, 1203)) != 0 )
    {
      v12 = (*((int (__fastcall **)(CTask *))ActiveTaskByType->_vptr$CTask + 5))(ActiveTaskByType);
      if ( v12 == (*((int (__fastcall **)(CTask *))v11->_vptr$CTask + 5))(v11) )
        return 0;
    }
  }
  if ( CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager) )
  {
    ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
    if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 917
      && CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager)[1].m_pParent == (CTask *)this->m_pOtherPed )
    {
      return 0;
    }
  }
  v14 = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1000);
  return !v14
      || v14[2]._vptr$CTask != (int (**)(void))this->m_pOtherPed
      || !CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1019);
}

//----- (0037156C) --------------------------------------------------------
void __fastcall CEventObjectCollision::CEventObjectCollision(
        CEventObjectCollision *this,
        const uint16 nPieceType,
        const float fImpulseMagnitude,
        const CObject *pObject,
        const CVector *vNormal,
        const CVector *vPos,
        const int iMoveState)
{
  __int64 v7; // d16
  __int64 v8; // d16

  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_iPieceType = nPieceType;
  this->m_iMoveState = iMoveState;
  this->m_fImpulseMagnitude = fImpulseMagnitude;
  this->_vptr$CEvent = (int (**)(void))&off_665EF8;
  this->m_pObject = (CObject *)pObject;
  v7 = *(_QWORD *)&vNormal->x;
  this->m_vNormal.z = vNormal->z;
  *(_QWORD *)&this->m_vNormal.x = v7;
  v8 = *(_QWORD *)&vPos->x;
  this->m_vPos.z = vPos->z;
  *(_QWORD *)&this->m_vPos.x = v8;
  if ( pObject )
    CEntity::RegisterReference(&pObject->CPhysical, &this->m_pObject);
}
// 665EF8: using guessed type void *off_665EF8;

//----- (003715D0) --------------------------------------------------------
void __fastcall CEventObjectCollision::~CEventObjectCollision(CEventObjectCollision *this)
{
  CObject *m_pObject; // r0
  CEntity **p_m_pObject; // r1

  p_m_pObject = &this->m_pObject;
  m_pObject = this->m_pObject;
  this->_vptr$CEvent = (int (**)(void))&off_665EF8;
  if ( m_pObject )
    CEntity::CleanUpOldReference(m_pObject, p_m_pObject);
}
// 665EF8: using guessed type void *off_665EF8;

//----- (003715F8) --------------------------------------------------------
void __fastcall CEventObjectCollision::~CEventObjectCollision(CEventObjectCollision *this)
{
  CObject *m_pObject; // r0
  CEntity **p_m_pObject; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pObject = &this->m_pObject;
  m_pObject = this->m_pObject;
  this->_vptr$CEvent = (int (**)(void))&off_665EF8;
  if ( m_pObject )
    CEntity::CleanUpOldReference(m_pObject, p_m_pObject);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665EF8: using guessed type void *;

//----- (0037164C) --------------------------------------------------------
bool __fastcall CEventObjectCollision::AffectsPed(const CEventObjectCollision *this, CPed *pPed)
{
  CObject *m_pObject; // r0

  return !pPed->m_pAttachToEntity
      && (m_pObject = this->m_pObject) != 0
      && (*(_BYTE *)&m_pObject->m_nPhysicalFlags & 0x20) == 0
      && !CPed::IsPlayer(pPed)
      && sub_196854(pPed);
}

//----- (00371680) --------------------------------------------------------
bool __fastcall CEventObjectCollision::IsHeadOnCollision(const CEventObjectCollision *this, const CPed *ped)
{
  CMatrix *m_pMat; // r5
  bool v3; // r4
  CVector v5; // [sp+0h] [bp-18h] BYREF

  m_pMat = ped->m_pMat;
  v3 = 0;
  *(_QWORD *)&v5.x = *(_QWORD *)&this->m_vNormal.x;
  v5.z = 0.0;
  CVector::Normalise(&v5);
  if ( (float)((float)((float)(m_pMat->xy * v5.x) + (float)(m_pMat->yy * v5.y)) + (float)(m_pMat->zy * v5.z)) < -0.9397 )
    return 1;
  return v3;
}

//----- (003716E0) --------------------------------------------------------
bool __fastcall CEventObjectCollision::TakesPriorityOver(const CEventObjectCollision *this, const CEvent *otherEvent)
{
  return 1;
}

//----- (003716E4) --------------------------------------------------------
void __fastcall CEventBuildingCollision::CEventBuildingCollision(
        CEventBuildingCollision *this,
        const uint16 nPieceType,
        const float fImpulseMagnitude,
        const CBuilding *pBuilding,
        const CVector *vNormal,
        const CVector *vPos,
        const int iMoveState)
{
  __int64 v7; // d16
  __int64 v8; // d16

  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_iPieceType = nPieceType;
  this->m_iMoveState = iMoveState;
  this->m_fImpulseMagnitude = fImpulseMagnitude;
  this->_vptr$CEvent = (int (**)(void))&off_665F44;
  this->m_pBuilding = (CBuilding *)pBuilding;
  v7 = *(_QWORD *)&vNormal->x;
  this->m_vNormal.z = vNormal->z;
  *(_QWORD *)&this->m_vNormal.x = v7;
  v8 = *(_QWORD *)&vPos->x;
  this->m_vPos.z = vPos->z;
  *(_QWORD *)&this->m_vPos.x = v8;
  if ( pBuilding )
    CEntity::RegisterReference(&pBuilding->CEntity, &this->m_pBuilding);
}
// 665F44: using guessed type void *off_665F44;

//----- (00371748) --------------------------------------------------------
void __fastcall CEventBuildingCollision::~CEventBuildingCollision(CEventBuildingCollision *this)
{
  CBuilding *m_pBuilding; // r0
  CBuilding **p_m_pBuilding; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pBuilding = &this->m_pBuilding;
  m_pBuilding = this->m_pBuilding;
  this->_vptr$CEvent = (int (**)(void))&off_665F44;
  if ( m_pBuilding )
    CEntity::CleanUpOldReference(m_pBuilding, p_m_pBuilding);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665F44: using guessed type void *;

//----- (0037179C) --------------------------------------------------------
bool __fastcall CEventBuildingCollision::TakesPriorityOver(
        const CEventBuildingCollision *this,
        const CEvent *otherEvent)
{
  int v3; // r5

  v3 = (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent);
  return v3 != (*((int (__fastcall **)(const CEventBuildingCollision *))this->_vptr$CEvent + 2))(this);
}

//----- (003717C0) --------------------------------------------------------
bool __fastcall CEventBuildingCollision::AffectsPed(const CEventBuildingCollision *this, CPed *pPed)
{
  bool v4; // r6
  float v6; // s16
  CEvent *CurrentEvent; // r0
  CEvent *v8; // r0
  CVector v9; // [sp+0h] [bp-28h] BYREF

  if ( CPed::IsPlayer(pPed)
    || !CPed::IsAlive(pPed)
    || this->m_iMoveState == 1
    || this->m_vNormal.z > 0.707 && (*((_BYTE *)&this->m_pBuilding->m_nFlags + 2) & 0x40) == 0 )
  {
    return 0;
  }
  v4 = 0;
  if ( pPed->m_pAttachToEntity )
    return v4;
  *(_QWORD *)&v9.x = *(_QWORD *)&this->m_vNormal.x;
  v9.z = 0.0;
  CVector::Normalise(&v9);
  v6 = (float)((float)(pPed->m_pMat->xy * v9.x) + (float)(pPed->m_pMat->yy * v9.y)) + (float)(pPed->m_pMat->zy * v9.z);
  if ( v6 > -0.422 )
    return v4;
  if ( CEventHandler::GetCurrentEventType(&pPed->m_pPedIntelligence->m_eventHandler) == 6 )
  {
    CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&pPed->m_pPedIntelligence->m_eventHandler.m_history);
    if ( v6 > -0.5 && *(CBuilding **)&CurrentEvent[1].m_bIsPersistent == this->m_pBuilding )
      return 0;
  }
  if ( CEventHandler::GetCurrentEventType(&pPed->m_pPedIntelligence->m_eventHandler) == 60 )
  {
    v8 = CEventHandlerHistory::GetCurrentEvent(&pPed->m_pPedIntelligence->m_eventHandler.m_history);
    if ( v6 > -0.5 && *(CBuilding **)&v8[1].m_bIsPersistent == this->m_pBuilding )
      return 0;
  }
  v4 = 0;
  if ( !CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 267)
    && CEventHandler::GetCurrentEventType(&pPed->m_pPedIntelligence->m_eventHandler) != 31 )
  {
    return 1;
  }
  return v4;
}

//----- (00371900) --------------------------------------------------------
bool __fastcall CEventBuildingCollision::CanTreatBuildingAsObject(const CBuilding *building)
{
  bool result; // r0
  CColModel *m_pColModel; // r0
  float v3; // s0
  float v4; // s2
  char v5; // r1
  char v6; // r0

  if ( (*((_BYTE *)&building->m_nFlags + 2) & 0x40) != 0 )
    return 1;
  m_pColModel = CModelInfo::ms_modelInfoPtrs[building->m_nModelIndex]->m_pColModel;
  v3 = fabsf(m_pColModel->m_boxBound.m_vecMax.x - m_pColModel->m_boxBound.m_vecMin.x);
  v4 = fabsf(m_pColModel->m_boxBound.m_vecMax.y - m_pColModel->m_boxBound.m_vecMin.y);
  if ( (float)(m_pColModel->m_boxBound.m_vecMax.z - m_pColModel->m_boxBound.m_vecMin.z) >= 2.0
    || (result = 1, v3 >= 6.0) )
  {
    v5 = 0;
    v6 = 0;
    if ( v4 < 6.0 )
      v5 = 1;
    if ( v3 < 6.0 )
      v6 = 1;
    return v6 & v5;
  }
  return result;
}

//----- (00371998) --------------------------------------------------------
bool __fastcall CEventBuildingCollision::IsHeadOnCollision(const CEventBuildingCollision *this, const CPed *ped)
{
  CMatrix *m_pMat; // r5
  bool v3; // r4
  CVector v5; // [sp+0h] [bp-18h] BYREF

  m_pMat = ped->m_pMat;
  v3 = 0;
  *(_QWORD *)&v5.x = *(_QWORD *)&this->m_vNormal.x;
  v5.z = 0.0;
  CVector::Normalise(&v5);
  if ( (float)((float)((float)(m_pMat->xy * v5.x) + (float)(m_pMat->yy * v5.y)) + (float)(m_pMat->zy * v5.z)) < -0.866 )
    return 1;
  return v3;
}

//----- (003719F8) --------------------------------------------------------
void __fastcall CEventDraggedOutCar::CEventDraggedOutCar(
        CEventDraggedOutCar *this,
        const CVehicle *pVehicle,
        const CPed *pDraggingPed,
        const bool bIsDriver)
{
  CPed **p_m_pDraggingPed; // r5

  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_bWasDriver = bIsDriver;
  this->_vptr$CEvent = (int (**)(void))&off_665F90;
  this->m_pVehicle = (CVehicle *)pVehicle;
  this->m_pDraggingPed = (CPed *)pDraggingPed;
  p_m_pDraggingPed = &this->m_pDraggingPed;
  if ( pVehicle )
  {
    CEntity::RegisterReference(&pVehicle->CPhysical, &this->m_pVehicle);
    pDraggingPed = *p_m_pDraggingPed;
  }
  if ( pDraggingPed )
    CEntity::RegisterReference(&pDraggingPed->CPhysical, &this->m_pDraggingPed);
}
// 665F90: using guessed type void *;

//----- (00371A50) --------------------------------------------------------
void __fastcall CEventDraggedOutCar::~CEventDraggedOutCar(CEventDraggedOutCar *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CPed *m_pDraggingPed; // r0

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_665F90;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  m_pDraggingPed = this->m_pDraggingPed;
  if ( m_pDraggingPed )
    CEntity::CleanUpOldReference(m_pDraggingPed, &this->m_pDraggingPed);
}
// 665F90: using guessed type void *off_665F90;

//----- (00371A84) --------------------------------------------------------
void __fastcall CEventDraggedOutCar::~CEventDraggedOutCar(CEventDraggedOutCar *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CPed *m_pDraggingPed; // r0
  CEventPool *v5; // r0
  int v6; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_665F90;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  m_pDraggingPed = this->m_pDraggingPed;
  if ( m_pDraggingPed )
    CEntity::CleanUpOldReference(m_pDraggingPed, &this->m_pDraggingPed);
  v5 = CPools::ms_pEventPool;
  v6 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v6] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v6 < v5->m_nFreeIndex )
    v5->m_nFreeIndex = v6;
}
// 665F90: using guessed type void *off_665F90;

//----- (00371AE4) --------------------------------------------------------
bool __fastcall CEventDraggedOutCar::AffectsPed(const CEventDraggedOutCar *this, CPed *pPed)
{
  return CPed::IsAlive(pPed) && this->m_pDraggingPed != 0;
}

//----- (00371B02) --------------------------------------------------------
bool __fastcall CEventDraggedOutCar::AffectsPedGroup(const CEventDraggedOutCar *this, CPedGroup *pPedGroup)
{
  CPlayerPed *Leader; // r4

  Leader = (CPlayerPed *)CPedGroupMembership::GetLeader(&pPedGroup->m_membership);
  return Leader == FindPlayerPed(-1);
}

//----- (00371B24) --------------------------------------------------------
void __fastcall CPedDamageResponseCalculator::CPedDamageResponseCalculator(
        CPedDamageResponseCalculator *this,
        const CEntity *pInflictor,
        const float fRawDamage,
        const eWeaponType eWeaponUsed,
        const ePedPieceTypes ePieceType,
        const bool bJumpedOutOfMovingCar)
{
  this->m_pInflictor = pInflictor;
  this->m_fRawDamage = fRawDamage;
  this->m_eHitZone = ePieceType;
  this->m_eWeaponUsed = eWeaponUsed;
  this->m_bJumpedOutOfMovingCar = bJumpedOutOfMovingCar;
}

//----- (00371B3C) --------------------------------------------------------
void __fastcall CPedDamageResponseCalculator::ComputeDamageResponse(
        CPedDamageResponseCalculator *this,
        CPed *pVictim,
        CPedDamageResponse *damageResponse,
        const bool bTriggerPainAudio)
{
  _BOOL4 IsPlayer; // r0
  CPedDamageResponse *v9; // r2
  bool v10; // zf
  float *p_m_nArmour; // r9
  float *p_m_fRawDamage; // r0
  float m_fRawDamage; // s0
  CPlayerPed *m_pInflictor; // r5
  CVehicle *v15; // r5
  CPlayerPed *PlayerPed; // r0
  CEntity *v17; // r0
  __int64 v18; // kr00_8
  unsigned int m_nPedFlags; // lr
  eWeaponType m_eWeaponUsed; // r0
  CEntity *v21; // r0
  CPlayerPed *v22; // r0
  CEventDamage v23; // [sp+0h] [bp-58h] BYREF

  if ( !damageResponse->m_bDamageCalculated )
  {
    damageResponse->m_fHealthLost = 0.0;
    damageResponse->m_fArmourLost = 0.0;
    *(_DWORD *)&damageResponse->m_bKilled = 16842752;
    IsPlayer = CPed::IsPlayer(pVictim);
    v10 = !CPlayerPed::bDebugPlayerInvincible;
    if ( CPlayerPed::bDebugPlayerInvincible )
      v10 = !IsPlayer;
    if ( v10 )
    {
      CPedDamageResponseCalculator::AccountForPedDamageStats(this, pVictim, v9);
      p_m_nArmour = &pVictim->m_nArmour;
      if ( pVictim->m_nArmour != 0.0 && (unsigned int)(this->m_eWeaponUsed - 53) >= 2 )
      {
        if ( FindPlayerPed(-1) == pVictim )
          CWorld::Players[CWorld::PlayerInFocus].LastTimeArmourLost = CTimer::m_snTimeInMilliseconds;
        p_m_fRawDamage = &this->m_fRawDamage;
        m_fRawDamage = this->m_fRawDamage;
        if ( m_fRawDamage <= *p_m_nArmour )
        {
          damageResponse->m_fArmourLost = m_fRawDamage;
          *p_m_nArmour = *p_m_nArmour - *p_m_fRawDamage;
        }
        else
        {
          *p_m_fRawDamage = m_fRawDamage - *p_m_nArmour;
          damageResponse->m_fArmourLost = *p_m_nArmour;
          p_m_fRawDamage = &pVictim->m_nArmour;
        }
        *p_m_fRawDamage = 0.0;
      }
      CPedDamageResponseCalculator::ComputeWillKillPed(this, pVictim, damageResponse, bTriggerPainAudio);
      if ( this->m_pInflictor )
      {
        m_pInflictor = (CPlayerPed *)this->m_pInflictor;
        if ( m_pInflictor == FindPlayerPed(-1)
          || (v15 = (CVehicle *)this->m_pInflictor, v15 == FindPlayerVehicle(-1, 0)) )
        {
          if ( this->m_pInflictor != pVictim
            && (float)(damageResponse->m_fHealthLost + damageResponse->m_fArmourLost) > 3.0 )
          {
            ++CWorld::Players[CWorld::PlayerInFocus].HavocCaused;
          }
        }
      }
      if ( FindPlayerPed(-1) == pVictim )
      {
        PlayerPed = FindPlayerPed(-1);
        CPlayerPed::AnnoyPlayerPed(PlayerPed, 0);
      }
      if ( CPed::IsPlayer(pVictim) )
      {
        v17 = (CEntity *)this->m_pInflictor;
        if ( this->m_pInflictor )
        {
          if ( (*(_BYTE *)&v17->m_info & 7) == 3 )
          {
            v18 = *(_QWORD *)&this->m_eHitZone;
            m_nPedFlags = (unsigned int)pVictim->m_nPedFlags;
            v23.m_iFacialTaskType = -1;
            v23.m_iPedHitDir = 0;
            v23.m_iAccumulatedTime = 0;
            *(_DWORD *)&v23.m_bIsPersistent = 13107456;
            v23.m_pInflictor = v17;
            v23.m_nDamageTime = 0;
            v23.m_eWeaponUsed = HIDWORD(v18);
            v23.m_eHitZone = v18;
            v23.m_nAnimGroup = ANIM_STD_PED;
            v23.m_nAnimId = ANIM_STD_NUM;
            v23.m_fAnimBlendSpeed = 8.0;
            v23.m_fAnimPlaySpeed = 1.0;
            memset(&v23.m_pedDamageResponse, 0, sizeof(v23.m_pedDamageResponse));
            *((_BYTE *)&v23 + 33) = (m_nPedFlags >> 5) & 8;
            v23._vptr$CEvent = (int (**)(void))&off_665FE0;
            CEntity::RegisterReference(v17, &v23.m_pInflictor);
            *((_BYTE *)&v23 + 33) |= 8u;
            CPlayerPed::MakeGroupRespondToPlayerTakingDamage((CPlayerPed *)pVictim, &v23);
            v23._vptr$CEvent = (int (**)(void))&off_665FE0;
            if ( v23.m_pInflictor )
              CEntity::CleanUpOldReference(v23.m_pInflictor, &v23.m_pInflictor);
          }
        }
      }
      if ( (float)(damageResponse->m_fHealthLost + damageResponse->m_fArmourLost) > 0.0 )
      {
        if ( !CPed::IsPlayer(pVictim) )
        {
          m_eWeaponUsed = this->m_eWeaponUsed;
          if ( (unsigned int)m_eWeaponUsed <= WEAPONTYPE_CHAINSAW && ((1 << m_eWeaponUsed) & 0x310) != 0 )
            pVictim->BleedingFrames = -56;
        }
        if ( FindPlayerPed(-1) == pVictim )
          CWorld::Players[CWorld::PlayerInFocus].LastTimeEnergyLost = CTimer::m_snTimeInMilliseconds;
        pVictim->LastDamagedWeaponType = this->m_eWeaponUsed;
        v21 = (CEntity *)this->m_pInflictor;
        if ( this->m_pInflictor )
        {
          pVictim->pLastDamageEntity = v21;
          CEntity::RegisterReference(v21, &pVictim->pLastDamageEntity);
          pVictim->LastDamagedTime = CTimer::m_snTimeInMilliseconds;
          if ( (*(_BYTE *)&this->m_pInflictor->m_info & 7) == 3 && CPed::IsPlayer((const CPed *)this->m_pInflictor) )
          {
            v22 = FindPlayerPed(-1);
            CPedGroupMembership::IsMember(
              &CPedGroups::ms_groups[v22->m_pPlayerData->m_PlayerGroup].m_membership,
              pVictim);
          }
        }
      }
    }
  }
}
// 371B80: variable 'v9' is possibly undefined
// 665FE0: using guessed type void *off_665FE0;

//----- (00371E44) --------------------------------------------------------
void __fastcall CPedDamageResponseCalculator::AccountForPedDamageStats(
        CPedDamageResponseCalculator *this,
        CPed *pVictim,
        CPedDamageResponse *damageResponse)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d2
  float m_fRawDamage; // s16
  float v8; // s18
  float m_fDefendMult; // s0
  const CEntity *m_pInflictor; // r0
  eWeaponType m_eWeaponUsed; // r0
  bool v12; // zf
  const CEntity *v13; // r1
  const CEntity *v14; // r1
  int v15; // r0
  bool v16; // zf
  eWeaponType v17; // r0
  bool v18; // zf

  m_fRawDamage = this->m_fRawDamage;
  v8 = CPedDamageResponseCalculator::ms_fStealthKillDamage;
  if ( CPed::IsPlayer(pVictim) )
    m_fDefendMult = 0.33;
  else
    m_fDefendMult = pVictim->m_pPedStats->m_fDefendMult;
  m_pInflictor = this->m_pInflictor;
  v12 = this->m_pInflictor == 0;
  this->m_fRawDamage = m_fDefendMult * this->m_fRawDamage;
  if ( !v12 && (*(_BYTE *)&m_pInflictor->m_info & 7) == 3 && CPed::IsPlayer((const CPed *)m_pInflictor) )
  {
    if ( CPedGroups::AreInSameGroup(pVictim, (const CPed *)this->m_pInflictor) )
    {
      m_eWeaponUsed = this->m_eWeaponUsed;
      v12 = m_eWeaponUsed == WEAPONTYPE_FLAMETHROWER;
      if ( m_eWeaponUsed != WEAPONTYPE_FLAMETHROWER )
        v12 = m_eWeaponUsed == WEAPONTYPE_EXPLOSION;
      if ( !v12 && m_fRawDamage != v8 )
      {
LABEL_27:
        v4.n64_u32[0] = 12.5;
        v3.n64_f32[0] = this->m_fRawDamage * 0.1;
        LODWORD(this->m_fRawDamage) = vmin_f32(v3, v4).n64_u32[0];
      }
    }
  }
  else
  {
    if ( pVictim && CPed::IsPlayer(pVictim) )
    {
      v13 = this->m_pInflictor;
      if ( !this->m_pInflictor )
        return;
      if ( (*(_BYTE *)&v13->m_info & 7) == 3 && CPedIntelligence::AreFriends(pVictim, (const CPed *)v13) )
        goto LABEL_27;
    }
    v14 = this->m_pInflictor;
    if ( this->m_pInflictor )
    {
      v15 = *(_BYTE *)&v14->m_info & 7;
      v16 = v15 == 3;
      if ( v15 == 3 )
        v16 = pVictim->CharCreatedBy == 2;
      if ( v16 && CPedGroups::AreInSameGroup(pVictim, (const CPed *)v14) )
      {
        v17 = this->m_eWeaponUsed;
        v18 = v17 == WEAPONTYPE_FLAMETHROWER;
        if ( v17 != WEAPONTYPE_FLAMETHROWER )
          v18 = v17 == WEAPONTYPE_EXPLOSION;
        if ( !v18 )
          goto LABEL_27;
      }
    }
  }
}
// 371F1E: variable 'v3' is possibly undefined
// 371F1E: variable 'v4' is possibly undefined

//----- (00371F38) --------------------------------------------------------
void __fastcall CPedDamageResponseCalculator::AccountForPedArmour(
        CPedDamageResponseCalculator *this,
        CPed *pVictim,
        CPedDamageResponse *damageResponse)
{
  float *p_m_nArmour; // r4
  float *p_m_fRawDamage; // r0
  float m_fRawDamage; // s0

  p_m_nArmour = &pVictim->m_nArmour;
  if ( pVictim->m_nArmour != 0.0 && (unsigned int)(this->m_eWeaponUsed - 53) >= 2 )
  {
    if ( FindPlayerPed(-1) == pVictim )
      CWorld::Players[CWorld::PlayerInFocus].LastTimeArmourLost = CTimer::m_snTimeInMilliseconds;
    p_m_fRawDamage = &this->m_fRawDamage;
    m_fRawDamage = this->m_fRawDamage;
    if ( m_fRawDamage <= *p_m_nArmour )
    {
      damageResponse->m_fArmourLost = m_fRawDamage;
      *p_m_nArmour = *p_m_nArmour - *p_m_fRawDamage;
    }
    else
    {
      *p_m_fRawDamage = m_fRawDamage - *p_m_nArmour;
      damageResponse->m_fArmourLost = *p_m_nArmour;
      p_m_fRawDamage = p_m_nArmour;
    }
    *p_m_fRawDamage = 0.0;
  }
}

//----- (00371FE0) --------------------------------------------------------
void __fastcall CPedDamageResponseCalculator::ComputeWillKillPed(
        CPedDamageResponseCalculator *this,
        CPed *pVictim,
        CPedDamageResponse *damageResponse,
        const bool bTriggerPainAudio)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d2
  _BOOL4 v8; // r8
  _BOOL4 IsPlayer; // r0
  CPedDamageResponse *v11; // r2
  bool v12; // zf
  float *p_m_nHealth; // r4
  float m_nHealth; // s16
  eWeaponType m_eWeaponUsed; // r0
  float v16; // s0
  UInt16 v17; // r1
  TouchSense *v18; // r0

  v8 = bTriggerPainAudio;
  IsPlayer = CPed::IsPlayer(pVictim);
  v12 = CCheat::m_aCheatsActive[69] == 0;
  if ( CCheat::m_aCheatsActive[69] )
    v12 = !IsPlayer;
  if ( v12 || this->m_eWeaponUsed >= WEAPONTYPE_LAST_WEAPONTYPE )
  {
    p_m_nHealth = &pVictim->m_nHealth;
    m_nHealth = pVictim->m_nHealth;
    damageResponse->m_bInstantKill = CPedDamageResponseCalculator::ComputeWillForceDeath(this, pVictim, v11);
    if ( CCheat::m_aCheatsActive[75] )
    {
      m_eWeaponUsed = this->m_eWeaponUsed;
      if ( (unsigned int)m_eWeaponUsed < WEAPONTYPE_GOLFCLUB || m_eWeaponUsed == WEAPONTYPE_PARACHUTE )
        this->m_fRawDamage = *p_m_nHealth;
    }
    if ( FindPlayerPed(-1) == pVictim
      && CTheScripts::pActiveScripts
      && !strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "intro1") )
    {
      this->m_fRawDamage = this->m_fRawDamage * 0.77;
    }
    if ( damageResponse->m_bInstantKill )
      goto LABEL_14;
    if ( this->m_eWeaponUsed == WEAPONTYPE_FALL && this->m_bJumpedOutOfMovingCar )
    {
      v5.n64_u32[0] = 5.0;
      damageResponse->m_bKilled = 0;
      v4.n64_f32[0] = *p_m_nHealth - this->m_fRawDamage;
      v16 = vmax_f32(v4, v5).n64_f32[0];
      *p_m_nHealth = v16;
      damageResponse->m_fHealthLost = m_nHealth - v16;
      if ( v8 )
LABEL_19:
        CPed::Say(pVictim, 0x159u, 0, 1.0, 0, 0, 0);
    }
    else
    {
      if ( (float)(*p_m_nHealth - this->m_fRawDamage) < 1.0 )
      {
LABEL_14:
        damageResponse->m_bKilled = 1;
        damageResponse->m_fHealthLost = *p_m_nHealth;
        *p_m_nHealth = 0.0;
        return;
      }
      damageResponse->m_bKilled = 0;
      damageResponse->m_fHealthLost = this->m_fRawDamage;
      *p_m_nHealth = *p_m_nHealth - this->m_fRawDamage;
      if ( v8 )
      {
        if ( this->m_eWeaponUsed == WEAPONTYPE_DROWNING )
        {
          v17 = 357;
        }
        else
        {
          if ( FindPlayerPed(-1) == pVictim )
          {
            TouchSense::instance();
            TouchSense::playBuiltinEffect(v18, 2, 101, 115, 20);
          }
          if ( this->m_fRawDamage < 5.0 && *p_m_nHealth > 10.0 )
            goto LABEL_19;
          v17 = 344;
        }
        CPed::Say(pVictim, v17, 0, 1.0, 0, 0, 0);
      }
    }
  }
}
// 372020: variable 'v11' is possibly undefined
// 3720B0: variable 'v4' is possibly undefined
// 3720B0: variable 'v5' is possibly undefined
// 37212C: variable 'v18' is possibly undefined

//----- (00372188) --------------------------------------------------------
bool __fastcall CPedDamageResponseCalculator::IsBleedingWeapon(CPedDamageResponseCalculator *this, CPed *pVictim)
{
  unsigned __int32 v3; // r0
  _BOOL4 v4; // r0

  if ( CPed::IsPlayer(pVictim) || (v3 = this->m_eWeaponUsed - 4, v3 > 5) )
    LOBYTE(v4) = 0;
  else
    return (0x31u >> (v3 & 0x3F)) & 1;
  return v4;
}

//----- (003721B4) --------------------------------------------------------
void __fastcall CPedDamageResponseCalculator::AdjustPedDamage(CPedDamageResponseCalculator *this, CPed *pVictim)
{
  eWeaponType m_eWeaponUsed; // r0

  if ( CCheat::m_aCheatsActive[75]
    && ((m_eWeaponUsed = this->m_eWeaponUsed, (unsigned int)m_eWeaponUsed < WEAPONTYPE_GOLFCLUB)
     || m_eWeaponUsed == WEAPONTYPE_PARACHUTE) )
  {
    this->m_fRawDamage = pVictim->m_nHealth;
  }
  else if ( !pVictim )
  {
    return;
  }
  if ( FindPlayerPed(-1) == pVictim
    && CTheScripts::pActiveScripts
    && !strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "intro1") )
  {
    this->m_fRawDamage = this->m_fRawDamage * 0.77;
  }
}

//----- (00372224) --------------------------------------------------------
bool __fastcall CPedDamageResponseCalculator::ComputeWillForceDeath(
        CPedDamageResponseCalculator *this,
        CPed *pVictim,
        CPedDamageResponse *damageResponse)
{
  bool result; // r0
  int v6; // r8
  bool v7; // zf
  const CEntity *v8; // r0
  RwReal z; // r0
  int v10; // r1
  bool v11; // zf
  _BOOL4 IsPlayer; // r0
  bool v13; // zf
  const CEntity *m_pInflictor; // r0
  const CEntity *v15; // r4

  if ( (*((_BYTE *)&pVictim->m_nPedFlags + 5) & 0x10) == 0 )
  {
    result = 0;
    switch ( this->m_eWeaponUsed )
    {
      case WEAPONTYPE_KATANA:
        m_pInflictor = this->m_pInflictor;
        if ( !this->m_pInflictor )
          return 0;
        if ( (*(_BYTE *)&m_pInflictor->m_info & 7) != 3 )
          return 0;
        if ( !CPed::IsPlayer((const CPed *)m_pInflictor) )
          return 0;
        v15 = this->m_pInflictor;
        if ( !CPedIntelligence::GetTaskFighting((const CPedIntelligence *)LODWORD(v15[18].m_transform.m_translate.y))
          || CPedIntelligence::GetTaskFighting((const CPedIntelligence *)LODWORD(v15[18].m_transform.m_translate.y))->m_nComboSet != 11 )
        {
          return 0;
        }
        return CPedIntelligence::GetTaskFighting((const CPedIntelligence *)LODWORD(v15[18].m_transform.m_translate.y))->m_nCurrentMove == 2
            && (rand() & 1) != 0
            || (rand() & 7) == 0;
      case WEAPONTYPE_GRENADE:
      case WEAPONTYPE_ROCKETLAUNCHER:
      case WEAPONTYPE_ROCKETLAUNCHER_HS:
      case WEAPONTYPE_REMOTE_SATCHEL_CHARGE:
      case WEAPONTYPE_EXPLOSION:
        if ( !CLocalisation::KillPeds() )
          return 0;
        IsPlayer = CPed::IsPlayer(pVictim);
        v13 = !IsPlayer;
        if ( !IsPlayer )
          v13 = *((unsigned __int8 *)&pVictim->m_nPedFlags + 1) << 31 == 0;
        return v13 && (float)(this->m_fRawDamage + 1.0) > pVictim->m_nHealth;
      case WEAPONTYPE_PISTOL:
      case WEAPONTYPE_PISTOL_SILENCED:
      case WEAPONTYPE_DESERT_EAGLE:
      case WEAPONTYPE_SHOTGUN:
      case WEAPONTYPE_SAWNOFF_SHOTGUN:
      case WEAPONTYPE_SPAS12_SHOTGUN:
      case WEAPONTYPE_MICRO_UZI:
      case WEAPONTYPE_MP5:
      case WEAPONTYPE_AK47:
      case WEAPONTYPE_M4:
      case WEAPONTYPE_TEC9:
      case WEAPONTYPE_COUNTRYRIFLE:
      case WEAPONTYPE_SNIPERRIFLE:
      case WEAPONTYPE_MINIGUN:
      case WEAPONTYPE_UZI_DRIVEBY:
        if ( CPed::IsPlayer(pVictim) || (*((_BYTE *)&pVictim->m_nPedFlags + 5) & 0x10) != 0 )
        {
          v6 = 1;
        }
        else if ( (unsigned int)(this->m_eWeaponUsed - 33) >= 2 )
        {
          v6 = rand() & 7;
        }
        else
        {
          v6 = 0;
        }
        v7 = *((unsigned __int8 *)&pVictim->m_nPedFlags + 1) << 31 == 0;
        if ( *((unsigned __int8 *)&pVictim->m_nPedFlags + 1) << 31 )
          v7 = pVictim->m_pMyVehicle == 0;
        if ( !v7 && !CPed::IsPlayer(pVictim) && (*((_BYTE *)&pVictim->m_nPedFlags + 5) & 0x10) == 0 )
          return this->m_eHitZone == PED_SPHERE_HEAD;
        if ( CPed::IsPlayer(pVictim)
          || (v8 = this->m_pInflictor) == 0
          || (*(_BYTE *)&v8->m_info & 7) != 3
          || !CPed::IsPlayer((const CPed *)v8) )
        {
          if ( v6 )
            return 0;
          return this->m_eHitZone == PED_SPHERE_HEAD;
        }
        z = this->m_pInflictor[18].m_transform.m_translate.z;
        v10 = *(_DWORD *)(LODWORD(z) + 112);
        v11 = v10 == 5;
        if ( v10 != 5 )
          v11 = v6 == 0;
        if ( v11 || (*(_WORD *)(LODWORD(z) + 52) & 8) != 0 )
          return this->m_eHitZone == PED_SPHERE_HEAD;
        break;
      default:
        return result;
    }
  }
  return 0;
}

//----- (003723BC) --------------------------------------------------------
void __fastcall CEventDamage::CEventDamage(
        CEventDamage *this,
        CEntity *pInflictor,
        const uint32 nTime,
        const eWeaponType eWeaponUsed,
        const ePedPieceTypes eHitZone,
        const uint8 iPedHitDir,
        char bJumpedOutOfMovingCar,
        const bool bDamagedInVehicle)
{
  char v9; // r6
  char v10; // r0

  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_nDamageTime = nTime;
  this->m_eWeaponUsed = eWeaponUsed;
  this->m_eHitZone = eHitZone;
  this->m_iPedHitDir = iPedHitDir;
  v9 = *((_BYTE *)this + 33);
  this->m_nAnimGroup = ANIM_STD_PED;
  this->m_nAnimId = ANIM_STD_NUM;
  this->m_fAnimBlendSpeed = 8.0;
  this->m_fAnimPlaySpeed = 1.0;
  this->m_pedDamageResponse.m_fHealthLost = 0.0;
  this->m_pedDamageResponse.m_fArmourLost = 0.0;
  *(_DWORD *)&this->m_pedDamageResponse.m_bKilled = 0;
  v10 = bJumpedOutOfMovingCar | (8 * bDamagedInVehicle) | v9 & 0xE0;
  *((_BYTE *)this + 33) = v10;
  this->_vptr$CEvent = (int (**)(void))&off_665FE0;
  this->m_pInflictor = pInflictor;
  if ( pInflictor )
  {
    CEntity::RegisterReference(pInflictor, &this->m_pInflictor);
    v10 = *((_BYTE *)this + 33);
  }
  *((_BYTE *)this + 33) = v10 | 8;
}
// 665FE0: using guessed type void *off_665FE0;

//----- (00372454) --------------------------------------------------------
void __fastcall CEventDamage::~CEventDamage(CEventDamage *this)
{
  CEntity *m_pInflictor; // r0
  CEntity **p_m_pInflictor; // r1

  p_m_pInflictor = &this->m_pInflictor;
  m_pInflictor = this->m_pInflictor;
  this->_vptr$CEvent = (int (**)(void))&off_665FE0;
  if ( m_pInflictor )
    CEntity::CleanUpOldReference(m_pInflictor, p_m_pInflictor);
}
// 665FE0: using guessed type void *off_665FE0;

//----- (0037247C) --------------------------------------------------------
void __fastcall CEventDamage::~CEventDamage(CEventDamage *this)
{
  CEntity *m_pInflictor; // r0
  CEntity **p_m_pInflictor; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pInflictor = &this->m_pInflictor;
  m_pInflictor = this->m_pInflictor;
  this->_vptr$CEvent = (int (**)(void))&off_665FE0;
  if ( m_pInflictor )
    CEntity::CleanUpOldReference(m_pInflictor, p_m_pInflictor);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665FE0: using guessed type void *off_665FE0;

//----- (003724D0) --------------------------------------------------------
void __fastcall CEventDamage::CEventDamage(CEventDamage *this, const CEventDamage *src)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_pedDamageResponse.m_fHealthLost = 0.0;
  this->m_pedDamageResponse.m_fArmourLost = 0.0;
  *(_DWORD *)&this->m_pedDamageResponse.m_bKilled = 0;
  this->_vptr$CEvent = (int (**)(void))&off_665FE0;
  CEventDamage::From(this, src);
}
// 665FE0: using guessed type void *off_665FE0;

//----- (00372508) --------------------------------------------------------
void __fastcall CEventDamage::From(CEventDamage *this, const CEventDamage *src)
{
  CEntity *m_pInflictor; // r0
  int v5; // r0
  unsigned int v6; // r0
  __int64 v7; // d16
  unsigned int v8; // r0
  unsigned int v9; // r0
  unsigned int v10; // r0

  m_pInflictor = src->m_pInflictor;
  this->m_pInflictor = m_pInflictor;
  if ( m_pInflictor )
    CEntity::RegisterReference(m_pInflictor, &this->m_pInflictor);
  this->m_nDamageTime = src->m_nDamageTime;
  this->m_eWeaponUsed = src->m_eWeaponUsed;
  this->m_eHitZone = src->m_eHitZone;
  v5 = *((unsigned __int8 *)this + 33);
  this->m_iPedHitDir = src->m_iPedHitDir;
  v6 = v5 & 0xFFFFFFFE | *((_BYTE *)src + 33) & 1;
  *((_BYTE *)this + 33) = v6;
  v7 = *(_QWORD *)&src->m_pedDamageResponse.m_fHealthLost;
  *(_DWORD *)&this->m_pedDamageResponse.m_bKilled = *(_DWORD *)&src->m_pedDamageResponse.m_bKilled;
  *(_QWORD *)&this->m_pedDamageResponse.m_fHealthLost = v7;
  this->m_nAnimGroup = src->m_nAnimGroup;
  this->m_nAnimId = src->m_nAnimId;
  this->m_fAnimBlendSpeed = src->m_fAnimBlendSpeed;
  this->m_fAnimPlaySpeed = src->m_fAnimPlaySpeed;
  v8 = v6 & 0xFFFFFFFB | (4 * ((*((unsigned __int8 *)src + 33) >> 2) & 1));
  *((_BYTE *)this + 33) = v8;
  v9 = v8 & 0xFFFFFFFD | (2 * ((*((unsigned __int8 *)src + 33) >> 1) & 1));
  *((_BYTE *)this + 33) = v9;
  v10 = v9 & 0xFFFFFFF7 | (8 * ((*((unsigned __int8 *)src + 33) >> 3) & 1));
  *((_BYTE *)this + 33) = v10;
  *((_BYTE *)this + 33) = v10 & 0xEF | *((_BYTE *)src + 33) & 0x10;
}

//----- (003725A0) --------------------------------------------------------
CEvent *__fastcall CEventDamage::CloneEditable(const CEventDamage *this)
{
  int v2; // r2
  CEventPool *v3; // r0
  int32 m_nSize; // r1
  int32 m_nFreeIndex; // r5
  uint8 *m_aFlags; // r3
  int v7; // r4
  char v8; // r1

  v2 = 0;
  v3 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v3->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v3->m_nFreeIndex = 0;
      if ( v2 << 31 )
        goto LABEL_7;
      v2 = 1;
    }
    m_aFlags = v3->m_aFlags;
    v7 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v7 > -1 );
  m_aFlags[m_nFreeIndex] = v7 & 0x7F;
  v3->m_aFlags[v3->m_nFreeIndex] = (v3->m_aFlags[v3->m_nFreeIndex] + 1) & 0x7F | v3->m_aFlags[v3->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v3->m_aStorage[v3->m_nFreeIndex];
LABEL_7:
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 52) = 0;
  *(_DWORD *)(m_nFreeIndex + 56) = 0;
  *(_DWORD *)(m_nFreeIndex + 60) = 0;
  *(_DWORD *)m_nFreeIndex = &off_665FE0;
  CEventDamage::From((CEventDamage *)m_nFreeIndex, this);
  v8 = *(_BYTE *)(m_nFreeIndex + 33);
  *(_DWORD *)(m_nFreeIndex + 40) = this->m_nAnimId;
  *(_BYTE *)(m_nFreeIndex + 33) = *((_BYTE *)this + 33) & 0x10 | v8 & 0xEF;
  return (CEvent *)m_nFreeIndex;
}
// 665FE0: using guessed type void *off_665FE0;

//----- (00372650) --------------------------------------------------------
CEventDamage *__fastcall CEventDamage::operator=(CEventDamage *this, const CEventDamage *src)
{
  CEventDamage::From(this, src);
  return this;
}

//----- (0037265E) --------------------------------------------------------
CEntity *__fastcall CEventDamage::GetSourceEntity(const CEventDamage *this)
{
  CEntity *result; // r0
  CEntity *m_pLastRenderedLink; // r1

  result = this->m_pInflictor;
  if ( !result )
    return 0;
  if ( (*(_BYTE *)&result->m_info & 7) == 2 )
  {
    m_pLastRenderedLink = (CEntity *)result[18].m_pLastRenderedLink;
    if ( !m_pLastRenderedLink )
      return result;
    return m_pLastRenderedLink;
  }
  return result;
}

//----- (00372684) --------------------------------------------------------
bool __fastcall CEventDamage::IsCriminalEvent(const CEventDamage *this)
{
  CEntity *m_pInflictor; // r0
  CEntity::CEntityInfo m_info; // r1
  CPlayerPed *m_pLastRenderedLink; // r4

  m_pInflictor = this->m_pInflictor;
  if ( !m_pInflictor )
    return 0;
  m_info = m_pInflictor->m_info;
  if ( (*(_BYTE *)&m_info & 7) == 3 )
  {
    if ( CPed::IsPlayer((const CPed *)m_pInflictor) )
      return 1;
    m_pInflictor = this->m_pInflictor;
    m_info = m_pInflictor->m_info;
  }
  if ( (*(_BYTE *)&m_info & 7) != 2 )
    return 0;
  m_pLastRenderedLink = (CPlayerPed *)m_pInflictor[18].m_pLastRenderedLink;
  return m_pLastRenderedLink == FindPlayerPed(-1);
}

//----- (003726C6) --------------------------------------------------------
void __fastcall CEventDamage::ReportCriminalEvent(const CEventDamage *this, CPed *pPed)
{
  bool v4; // r8
  eWeaponType m_eWeaponUsed; // r0
  int32 v6; // r5
  CWanted *PlayerWanted; // r0
  CEntity *v8; // r1
  CMatrix *v9; // r3
  const CVector *p_tx; // r2
  eCrimeType v11; // r1
  int32 v12; // r5
  CEntity *v13; // r1
  CMatrix *v14; // r3
  int32 m_nPedType; // r5
  CEntity *m_pInflictor; // r1
  CMatrix *m_pMat; // r3
  bool bPoliceDontReallyCare; // [sp+0h] [bp-18h]

  if ( (*((int (__fastcall **)(const CEventDamage *))this->_vptr$CEvent + 8))(this) == 1 && this->m_pInflictor )
  {
    v4 = CPedType::PoliceDontCareAboutCrimesAgainstPedType(pPed->m_nPedType);
    m_eWeaponUsed = this->m_eWeaponUsed;
    if ( m_eWeaponUsed > WEAPONTYPE_CHAINSAW )
    {
      if ( m_eWeaponUsed > WEAPONTYPE_SPRAYCAN )
      {
        if ( (unsigned int)(m_eWeaponUsed - 49) > 1 )
          return;
        m_nPedType = pPed->m_nPedType;
        PlayerWanted = FindPlayerWanted(-1);
        m_pInflictor = this->m_pInflictor;
        m_pMat = m_pInflictor->m_pMat;
        p_tx = (const CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pInflictor->m_transform.m_translate;
        bPoliceDontReallyCare = v4;
        if ( m_nPedType == 6 )
          v11 = CRIME_RUNOVER_COP;
        else
          v11 = CRIME_RUNOVER_PED;
      }
      else
      {
        v12 = pPed->m_nPedType;
        PlayerWanted = FindPlayerWanted(-1);
        v13 = this->m_pInflictor;
        v14 = v13->m_pMat;
        p_tx = (const CVector *)&v14->tx;
        if ( !v14 )
          p_tx = &v13->m_transform.m_translate;
        bPoliceDontReallyCare = v4;
        if ( v12 == 6 )
          v11 = CRIME_SHOOT_COP;
        else
          v11 = CRIME_SHOOT_PED;
      }
    }
    else
    {
      v6 = pPed->m_nPedType;
      PlayerWanted = FindPlayerWanted(-1);
      v8 = this->m_pInflictor;
      v9 = v8->m_pMat;
      p_tx = (const CVector *)&v9->tx;
      if ( !v9 )
        p_tx = &v8->m_transform.m_translate;
      bPoliceDontReallyCare = v4;
      if ( v6 == 6 )
        v11 = CRIME_HIT_COP;
      else
        v11 = CRIME_HIT_PED;
    }
    CWanted::RegisterCrime(PlayerWanted, v11, p_tx, (u_native)pPed, bPoliceDontReallyCare);
  }
}

//----- (00372784) --------------------------------------------------------
bool __fastcall CEventDamage::DoInformVehicleOccupants(const CEventDamage *this, CPed *pPed)
{
  int v3; // r1
  bool result; // r0

  v3 = (*((int (__fastcall **)(const CEventDamage *))this->_vptr$CEvent + 11))(this);
  result = 0;
  if ( v3 )
  {
    if ( this->m_eWeaponUsed != WEAPONTYPE_DROWNING )
      return 1;
  }
  return result;
}

//----- (003727A8) --------------------------------------------------------
bool __fastcall CEventDamage::AffectsPed(const CEventDamage *this, CPed *pPed)
{
  CPlayerPed *v4; // r6
  eWeaponType v5; // r0
  bool v6; // zf
  CEntity **p_m_pInflictor; // r6
  const CEntity *v8; // r0
  bool result; // r0
  CEntity *m_pInflictor; // r0
  int v11; // r1
  bool v12; // zf
  CTask *ActiveTaskByType; // r0
  eWeaponType m_eWeaponUsed; // r1
  bool v15; // zf
  CEntity *v16; // r0
  CTask *ActiveTask; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v19; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  float y; // s2
  float z; // s4
  int CanPhysicalBeDamaged; // r6
  CVector v25; // [sp+4h] [bp-1Ch] BYREF

  if ( this->m_pedDamageResponse.m_bDamageCalculated && !this->m_pedDamageResponse.m_bAffectsPed )
    return 1;
  if ( !CPed::IsAlive(pPed)
    || FindPlayerPed(-1) == pPed && (*((_BYTE *)FindPlayerPed(-1)->m_pPlayerData + 52) & 0x10) == 0
    || this->m_eWeaponUsed == WEAPONTYPE_DROWNING && (*((_BYTE *)&pPed->m_nPedFlags + 6) & 0x10) == 0 )
  {
    return 0;
  }
  if ( FindPlayerPed(-1) == pPed )
  {
    m_pInflictor = this->m_pInflictor;
    if ( m_pInflictor )
    {
      v11 = *(_BYTE *)&m_pInflictor->m_info & 7;
      v12 = v11 == 3;
      if ( v11 == 3 )
        v12 = *(_DWORD *)&m_pInflictor[23].numLodChildren == 8;
      if ( v12 && this->m_eWeaponUsed >= WEAPONTYPE_GRENADE )
      {
        ActiveTaskByType = CTaskManager::FindActiveTaskByType(
                             (const CTaskManager *)(LODWORD(m_pInflictor[18].m_transform.m_translate.y) + 4),
                             1000);
        if ( !ActiveTaskByType || (CPed *)ActiveTaskByType[2]._vptr$CTask != pPed )
          return 0;
      }
    }
  }
  if ( FindPlayerPed(-1) != pPed || !CWorld::Players[CWorld::PlayerInFocus].FireProof )
    goto LABEL_18;
  m_eWeaponUsed = this->m_eWeaponUsed;
  result = 0;
  v15 = m_eWeaponUsed == WEAPONTYPE_MOLOTOV;
  if ( m_eWeaponUsed != WEAPONTYPE_MOLOTOV )
    v15 = m_eWeaponUsed == WEAPONTYPE_FLAMETHROWER;
  if ( !v15 )
  {
LABEL_18:
    if ( (*((_BYTE *)&pPed->m_nPhysicalFlags + 2) & 0x40) != 0 )
    {
      v4 = (CPlayerPed *)(*((int (__fastcall **)(const CEventDamage *))this->_vptr$CEvent + 11))(this);
      if ( v4 != FindPlayerPed(-1) )
      {
        v5 = this->m_eWeaponUsed;
        v6 = v5 == WEAPONTYPE_EXPLOSION;
        if ( v5 != WEAPONTYPE_EXPLOSION )
          v6 = v5 == WEAPONTYPE_DROWNING;
        if ( !v6 && pPed->m_nHealth > 0.0 )
          return 0;
      }
    }
    if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 12) << 31
      && CWeaponInfo::GetWeaponInfo(this->m_eWeaponUsed, 1)->m_eFireType == FIRETYPE_INSTANT_HIT
      && (unsigned int)(this->m_eHitZone - 3) < 2 )
    {
      return 0;
    }
    if ( this->m_bWitnessedFirstHand )
    {
      p_m_pInflictor = &this->m_pInflictor;
    }
    else
    {
      p_m_pInflictor = &this->m_pInflictor;
      v16 = this->m_pInflictor;
      if ( this->m_eWeaponUsed == WEAPONTYPE_PISTOL_SILENCED )
      {
        if ( !v16
          || (*(_BYTE *)&v16->m_info & 7) != 3
          || (*((_BYTE *)this + 33) & 8) == 0
          || !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
        {
          return 0;
        }
      }
      else if ( !v16 )
      {
LABEL_59:
        CanPhysicalBeDamaged = CPhysical::CanPhysicalBeDamaged(pPed, this->m_eWeaponUsed, 0);
        result = CanPhysicalBeDamaged != 0;
        if ( this->m_eWeaponUsed != WEAPONTYPE_FALL )
          return result;
        if ( (*((_BYTE *)&pPed->m_nPhysicalFlags + 2) & 0x10) != 0 || pPed->m_pAttachToEntity )
          return 0;
        if ( pPed->m_nHealth > 0.0 )
          return (CanPhysicalBeDamaged != 0) & (CPedIntelligence::GetTaskJetPack(pPed->m_pPedIntelligence) == 0);
        return result;
      }
      if ( (*(_BYTE *)&v16->m_info & 7) == 3 )
      {
        if ( CTaskManager::GetActiveTask((const CTaskManager *)(LODWORD(v16[18].m_transform.m_translate.y) + 4)) )
        {
          ActiveTask = CTaskManager::GetActiveTask((const CTaskManager *)(LODWORD((*p_m_pInflictor)[18].m_transform.m_translate.y)
                                                                        + 4));
          if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 1027 )
          {
            m_pMat = pPed->m_pMat;
            v19 = (*p_m_pInflictor)->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &pPed->m_transform;
            p_x = &v19->tx;
            y = p_tx->m_translate.y;
            z = p_tx->m_translate.z;
            if ( !v19 )
              p_x = &(*p_m_pInflictor)->m_transform.m_translate.x;
            v25.x = *p_x - p_tx->m_translate.x;
            v25.y = p_x[1] - y;
            v25.z = p_x[2] - z;
            CVector::Normalise(&v25);
            if ( CPedIntelligence::CanSeeEntityWithLights(pPed->m_pPedIntelligence, *p_m_pInflictor, 0) <= 0.0
              || (float)((float)((float)(pPed->m_pMat->xy * v25.x) + (float)(pPed->m_pMat->yy * v25.y))
                       + (float)(pPed->m_pMat->zy * v25.z)) < CPedAcquaintanceScanner::ms_fThresholdDotProduct )
            {
              return 0;
            }
          }
        }
      }
    }
    v8 = *p_m_pInflictor;
    if ( *p_m_pInflictor
      && (*(_BYTE *)&v8->m_info & 7) == 3
      && !CPed::IsPlayer((const CPed *)v8)
      && CPedGroups::AreInSameGroup(pPed, (const CPed *)*p_m_pInflictor)
      && this->m_eWeaponUsed != WEAPONTYPE_EXPLOSION )
    {
      return 0;
    }
    goto LABEL_59;
  }
  return result;
}

//----- (00372AB8) --------------------------------------------------------
bool __fastcall CEventDamage::AffectsPedGroup(const CEventDamage *this, CPedGroup *pPedGroup)
{
  CEntity *m_pInflictor; // r0
  CTask *ActiveTask; // r0
  CPedGroupMembership *p_m_membership; // r9
  int v8; // r6
  CPed *Member; // r5
  CEntity *v10; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v12; // r2
  float *p_tx; // r3
  float *p_x; // r1
  CVector v15; // [sp+4h] [bp-24h] BYREF

  if ( this->m_eWeaponUsed == WEAPONTYPE_PISTOL_SILENCED )
    return 0;
  m_pInflictor = this->m_pInflictor;
  if ( m_pInflictor )
  {
    if ( (*(_BYTE *)&m_pInflictor->m_info & 7) == 3 )
    {
      if ( CTaskManager::GetActiveTask((const CTaskManager *)(LODWORD(m_pInflictor[18].m_transform.m_translate.y) + 4)) )
      {
        ActiveTask = CTaskManager::GetActiveTask((const CTaskManager *)(LODWORD(this->m_pInflictor[18].m_transform.m_translate.y)
                                                                      + 4));
        if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 1027 )
        {
          p_m_membership = &pPedGroup->m_membership;
          v8 = -1;
          while ( 1 )
          {
            Member = CPedGroupMembership::GetMember(p_m_membership, ++v8);
            if ( Member )
            {
              v10 = this->m_pInflictor;
              m_pMat = Member->m_pMat;
              v12 = v10->m_pMat;
              p_tx = &m_pMat->tx;
              if ( !m_pMat )
                p_tx = &Member->m_transform.m_translate.x;
              p_x = &v12->tx;
              if ( !v12 )
                p_x = &v10->m_transform.m_translate.x;
              v15.x = *p_x - *p_tx;
              v15.y = p_x[1] - p_tx[1];
              v15.z = p_x[2] - p_tx[2];
              CVector::Normalise(&v15);
              if ( CPedIntelligence::CanSeeEntityWithLights(Member->m_pPedIntelligence, this->m_pInflictor, 0) > 0.0
                && (float)((float)((float)(Member->m_pMat->xy * v15.x) + (float)(Member->m_pMat->yy * v15.y))
                         + (float)(Member->m_pMat->zy * v15.z)) > CPedAcquaintanceScanner::ms_fThresholdDotProduct )
              {
                break;
              }
            }
            if ( v8 >= 7 )
              return 0;
          }
        }
      }
    }
  }
  return 1;
}

//----- (00372BEC) --------------------------------------------------------
bool __fastcall CEventDamage::TakesPriorityOver(const CEventDamage *this, const CEvent *otherEvent)
{
  bool v4; // zf
  bool v5; // zf
  bool v6; // zf
  CEntity *m_pInflictor; // r0
  bool v8; // zf
  int v9; // r6
  int v11; // r5

  if ( (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 66 )
  {
    v4 = !this->m_pedDamageResponse.m_bKilled;
    if ( this->m_pedDamageResponse.m_bKilled )
      v4 = !this->m_bWitnessedFirstHand;
    if ( !v4 )
      return 1;
  }
  if ( (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 58 )
  {
    v5 = !this->m_pedDamageResponse.m_bKilled;
    if ( this->m_pedDamageResponse.m_bKilled )
      v5 = !this->m_bWitnessedFirstHand;
    if ( !v5 )
      return 1;
  }
  if ( (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 8 )
  {
    v6 = !this->m_pedDamageResponse.m_bKilled;
    if ( this->m_pedDamageResponse.m_bKilled )
      v6 = !this->m_bWitnessedFirstHand;
    if ( !v6 )
      return 1;
  }
  m_pInflictor = this->m_pInflictor;
  if ( m_pInflictor
    && (*(_BYTE *)&m_pInflictor->m_info & 7) == 3
    && CPed::IsPlayer((const CPed *)m_pInflictor)
    && (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 9 )
  {
    if ( (CEntity *)(*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 11))(otherEvent) != this->m_pInflictor )
      return 1;
    v8 = !this->m_pedDamageResponse.m_bKilled;
    if ( this->m_pedDamageResponse.m_bKilled )
      v8 = !this->m_bWitnessedFirstHand;
    if ( !v8 )
      return 1;
  }
  else if ( (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 9 )
  {
    v9 = (*((int (__fastcall **)(const CEventDamage *))this->_vptr$CEvent + 11))(this);
    if ( v9 != (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 11))(otherEvent) )
      return 1;
  }
  v11 = (*((int (__fastcall **)(const CEventDamage *))this->_vptr$CEvent + 3))(this);
  return v11 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (00372CD4) --------------------------------------------------------
bool __fastcall CEventDamage::IsSameEventForAI(CEventDamage *this, CEventDamage *pEvent)
{
  return this->m_pInflictor == pEvent->m_pInflictor && this->m_eWeaponUsed == pEvent->m_eWeaponUsed;
}

//----- (00372CF0) --------------------------------------------------------
void __fastcall CEventDamage::ProcessDamage(const CEventDamage *this, CPed *pPed)
{
  int32 v4; // r1
  unsigned __int32 v5; // r0
  int32 *v6; // r0

  switch ( this->m_eWeaponUsed )
  {
    case WEAPONTYPE_UNARMED:
    case WEAPONTYPE_BRASSKNUCKLE:
    case WEAPONTYPE_GOLFCLUB:
    case WEAPONTYPE_NIGHTSTICK:
    case WEAPONTYPE_KNIFE:
    case WEAPONTYPE_BASEBALLBAT:
    case WEAPONTYPE_SHOVEL:
    case WEAPONTYPE_POOL_CUE:
    case WEAPONTYPE_KATANA:
    case WEAPONTYPE_CHAINSAW:
    case WEAPONTYPE_DILDO1:
    case WEAPONTYPE_DILDO2:
    case WEAPONTYPE_VIBE1:
    case WEAPONTYPE_VIBE2:
    case WEAPONTYPE_FLOWERS:
    case WEAPONTYPE_CANE:
    case WEAPONTYPE_PARACHUTE:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
        v4 = 2;
        goto LABEL_11;
      }
      break;
    case WEAPONTYPE_GRENADE:
    case WEAPONTYPE_ROCKETLAUNCHER:
    case WEAPONTYPE_ROCKETLAUNCHER_HS:
    case WEAPONTYPE_EXPLOSION:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
        v6 = (int32 *)((char *)&unk_60FFC0
                     + 4 * (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 5.0));
        goto LABEL_10;
      }
      break;
    case WEAPONTYPE_DESERT_EAGLE:
    case WEAPONTYPE_SHOTGUN:
    case WEAPONTYPE_SAWNOFF_SHOTGUN:
    case WEAPONTYPE_SPAS12_SHOTGUN:
    case WEAPONTYPE_AK47:
    case WEAPONTYPE_M4:
    case WEAPONTYPE_COUNTRYRIFLE:
    case WEAPONTYPE_SNIPERRIFLE:
    case WEAPONTYPE_MINIGUN:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
        v5 = this->m_eHitZone - 5;
        if ( v5 < 5 )
        {
          v6 = &dword_372DA0[v5];
LABEL_10:
          v4 = *v6;
LABEL_11:
          sub_190C74(pPed, v4, this->m_iPedHitDir);
        }
      }
      break;
    default:
      return;
  }
}
// 372DA0: using guessed type int dword_372DA0[5];

//----- (00372DBC) --------------------------------------------------------
void __fastcall CEventDamage::ComputeBodyPartToRemove(const CEventDamage *this, int *iBodyPartToRemove)
{
  int v3; // r0

  *iBodyPartToRemove = 0;
  switch ( this->m_eWeaponUsed )
  {
    case WEAPONTYPE_UNARMED:
    case WEAPONTYPE_BRASSKNUCKLE:
    case WEAPONTYPE_GOLFCLUB:
    case WEAPONTYPE_NIGHTSTICK:
    case WEAPONTYPE_KNIFE:
    case WEAPONTYPE_BASEBALLBAT:
    case WEAPONTYPE_SHOVEL:
    case WEAPONTYPE_POOL_CUE:
    case WEAPONTYPE_KATANA:
    case WEAPONTYPE_CHAINSAW:
    case WEAPONTYPE_DILDO1:
    case WEAPONTYPE_DILDO2:
    case WEAPONTYPE_VIBE1:
    case WEAPONTYPE_VIBE2:
    case WEAPONTYPE_FLOWERS:
    case WEAPONTYPE_CANE:
    case WEAPONTYPE_PARACHUTE:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
LABEL_6:
        v3 = 2;
        goto LABEL_13;
      }
      break;
    case WEAPONTYPE_GRENADE:
    case WEAPONTYPE_ROCKETLAUNCHER:
    case WEAPONTYPE_ROCKETLAUNCHER_HS:
    case WEAPONTYPE_EXPLOSION:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
        v3 = dword_60FFC0[(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 5.0)];
LABEL_13:
        *iBodyPartToRemove = v3;
      }
      break;
    case WEAPONTYPE_DESERT_EAGLE:
    case WEAPONTYPE_SHOTGUN:
    case WEAPONTYPE_SAWNOFF_SHOTGUN:
    case WEAPONTYPE_SPAS12_SHOTGUN:
    case WEAPONTYPE_AK47:
    case WEAPONTYPE_M4:
    case WEAPONTYPE_COUNTRYRIFLE:
    case WEAPONTYPE_SNIPERRIFLE:
    case WEAPONTYPE_MINIGUN:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
        switch ( this->m_eHitZone )
        {
          case PED_SPHERE_UPPERARM_L:
            v3 = 3;
            goto LABEL_13;
          case PED_SPHERE_UPPERARM_R:
            v3 = 4;
            goto LABEL_13;
          case PED_SPHERE_LEG_L:
            v3 = 7;
            goto LABEL_13;
          case PED_SPHERE_LEG_R:
            v3 = 8;
            goto LABEL_13;
          case PED_SPHERE_HEAD:
            goto LABEL_6;
          default:
            return;
        }
      }
      break;
    default:
      return;
  }
}
// 60FFC0: using guessed type _DWORD dword_60FFC0[5];

//----- (00372E80) --------------------------------------------------------
void __fastcall CEventDamage::ComputeHeadShot(const CEventDamage *this, bool *bHeadShot)
{
  *bHeadShot = 0;
  switch ( this->m_eWeaponUsed )
  {
    case WEAPONTYPE_UNARMED:
    case WEAPONTYPE_BRASSKNUCKLE:
    case WEAPONTYPE_GOLFCLUB:
    case WEAPONTYPE_NIGHTSTICK:
    case WEAPONTYPE_KNIFE:
    case WEAPONTYPE_BASEBALLBAT:
    case WEAPONTYPE_SHOVEL:
    case WEAPONTYPE_POOL_CUE:
    case WEAPONTYPE_KATANA:
    case WEAPONTYPE_CHAINSAW:
    case WEAPONTYPE_DILDO1:
    case WEAPONTYPE_DILDO2:
    case WEAPONTYPE_VIBE1:
    case WEAPONTYPE_VIBE2:
    case WEAPONTYPE_FLOWERS:
    case WEAPONTYPE_CANE:
    case WEAPONTYPE_PARACHUTE:
      if ( this->m_pedDamageResponse.m_bInstantKill )
        goto LABEL_6;
      break;
    case WEAPONTYPE_PISTOL:
    case WEAPONTYPE_PISTOL_SILENCED:
    case WEAPONTYPE_DESERT_EAGLE:
    case WEAPONTYPE_SHOTGUN:
    case WEAPONTYPE_SAWNOFF_SHOTGUN:
    case WEAPONTYPE_SPAS12_SHOTGUN:
    case WEAPONTYPE_MICRO_UZI:
    case WEAPONTYPE_MP5:
    case WEAPONTYPE_AK47:
    case WEAPONTYPE_M4:
    case WEAPONTYPE_TEC9:
    case WEAPONTYPE_COUNTRYRIFLE:
    case WEAPONTYPE_SNIPERRIFLE:
    case WEAPONTYPE_MINIGUN:
    case WEAPONTYPE_UZI_DRIVEBY:
      if ( this->m_pedDamageResponse.m_bInstantKill && this->m_eHitZone == PED_SPHERE_HEAD )
LABEL_6:
        *bHeadShot = 1;
      break;
    default:
      return;
  }
}

//----- (00372EE0) --------------------------------------------------------
void __fastcall CEventDamage::ComputeDeathAnim(CEventDamage *this, CPed *pPed, bool bAtGenerateEventStage)
{
  CTask *ActiveTask; // r0
  AnimationId v6; // r0
  CPedFlags *p_m_nPedFlags; // r8
  CEntity *m_pInflictor; // r0
  CTaskSimpleFight *TaskFighting; // r10
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r9
  CSimpleTransform *p_tx; // r1
  CTask *SimplestActiveTask; // r0
  CTask *v14; // r0
  CAnimBlendAssociation *FirstAssociation; // r0
  AnimationId v16; // r1
  unsigned int m_iPedHitDir; // r0
  int m_nComboSet; // r3
  int m_nCurrentMove; // r1
  int v20; // r2
  int v21; // r2
  float v22; // s0
  int v23; // r0
  AnimationId v24; // r0
  float v25; // s4
  float v26; // s16
  float v27; // s2
  AnimationId v28; // r1
  CEntity *v29; // r0
  RwReal z; // r0
  eWeaponType m_eWeaponUsed; // r0
  CEntity *v32; // r0
  CMatrix *v33; // r1
  CMatrix *v34; // r2
  float *p_x; // r1
  float v36; // s4
  float v37; // s2
  float v38; // s6
  float v39; // s6
  float v40; // s4
  float v41; // s0
  AnimationId v42; // r0
  ePedPieceTypes m_eHitZone; // r0
  AnimationId v44; // r1
  RwV3d_0 posn; // [sp+4h] [bp-2Ch] BYREF
  CVector v46; // 0:r1.12

  this->m_nAnimGroup = ANIM_STD_PED;
  this->m_nAnimId = ANIM_STD_KO_FRONT;
  this->m_fAnimBlendSpeed = 4.0;
  this->m_fAnimPlaySpeed = 1.0;
  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31
    || bAtGenerateEventStage
    && CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager)
    && (ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager),
        !(*((int (__fastcall **)(CTask *, CPed *, int, CEventDamage *))ActiveTask->_vptr$CTask + 7))(
           ActiveTask,
           pPed,
           1,
           this)) )
  {
    v6 = ANIM_STD_NUM;
    goto LABEL_8;
  }
  if ( this->m_eWeaponUsed == WEAPONTYPE_DROWNING
    || (p_m_nPedFlags = &pPed->m_nPedFlags, *((unsigned __int8 *)&pPed->m_nPhysicalFlags + 1) << 31)
    && !(*(_BYTE *)p_m_nPedFlags << 31) )
  {
    v6 = ANIM_STD_DROWN;
LABEL_8:
    this->m_nAnimId = v6;
    return;
  }
  m_pInflictor = this->m_pInflictor;
  if ( m_pInflictor && (*(_BYTE *)&m_pInflictor->m_info & 7) == 3 )
    TaskFighting = CPedIntelligence::GetTaskFighting((const CPedIntelligence *)LODWORD(m_pInflictor[18].m_transform.m_translate.y));
  else
    TaskFighting = 0;
  memset(&posn, 0, sizeof(posn));
  CPed::GetBonePosition(pPed, &posn, 5u, 0);
  m_pMat = pPed->m_pMat;
  p_m_transform = &pPed->m_transform;
  p_tx = &pPed->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( posn.z < (float)(p_tx->m_translate.z + -0.2) )
  {
    if ( CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager) )
    {
      SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
      if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) == 207
        || (v14 = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager),
            (*((int (__fastcall **)(CTask *))v14->_vptr$CTask + 5))(v14) == 205) )
      {
        *((_BYTE *)this + 33) |= 2u;
        FirstAssociation = RpAnimBlendClumpGetFirstAssociation((RpClump_0 *)pPed->m_pRwObject, 0x800u);
        v16 = ANIM_STD_HIT_FLOOR;
        if ( FirstAssociation )
          v16 = ANIM_STD_HIT_FLOOR_FRONT;
        this->m_nAnimId = v16;
        return;
      }
    }
  }
  m_iPedHitDir = this->m_iPedHitDir;
  if ( TaskFighting && !this->m_iPedHitDir )
  {
    m_nComboSet = TaskFighting->m_nComboSet;
    m_nCurrentMove = TaskFighting->m_nCurrentMove;
    v20 = m_nComboSet - 4;
    if ( m_nComboSet < 4 )
      v20 = 0;
    if ( m_nCurrentMove <= 2 && m_nComboSet >= 4 )
    {
      v21 = v20;
      if ( ((16 << m_nCurrentMove) & CTaskSimpleFight::m_aComboData[v21].nFlags) != 0 )
      {
        v22 = 1.0;
        this->m_nAnimGroup = CTaskSimpleFight::m_aComboData[v21].nAnimGroup;
        v23 = TaskFighting->m_nCurrentMove;
        this->m_fAnimBlendSpeed = 16.0;
        v24 = v23 + 219;
LABEL_54:
        this->m_nAnimId = v24;
        goto LABEL_55;
      }
    }
  }
  v22 = 0.0;
  v25 = 1.0;
  v26 = 0.0;
  v27 = 0.0;
  switch ( this->m_eWeaponUsed )
  {
    case WEAPONTYPE_UNARMED:
    case WEAPONTYPE_BRASSKNUCKLE:
    case WEAPONTYPE_NIGHTSTICK:
    case WEAPONTYPE_CHAINSAW:
    case WEAPONTYPE_PARACHUTE:
      v26 = 0.5;
      goto LABEL_36;
    case WEAPONTYPE_GOLFCLUB:
    case WEAPONTYPE_BASEBALLBAT:
    case WEAPONTYPE_SHOVEL:
    case WEAPONTYPE_POOL_CUE:
    case WEAPONTYPE_KATANA:
    case WEAPONTYPE_DILDO1:
      v26 = 1.5;
      goto LABEL_36;
    case WEAPONTYPE_KNIFE:
    case WEAPONTYPE_DILDO2:
    case WEAPONTYPE_VIBE1:
    case WEAPONTYPE_VIBE2:
    case WEAPONTYPE_FLOWERS:
    case WEAPONTYPE_CANE:
LABEL_36:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
        v28 = ANIM_STD_KO_SHOT_FACE;
        v26 = 0.0;
LABEL_45:
        this->m_nAnimId = v28;
      }
      else
      {
        v28 = ANIM_STD_HIGHIMPACT_LEFT;
        switch ( this->m_iPedHitDir )
        {
          case 0u:
            v28 = ANIM_STD_HIGHIMPACT_FRONT;
            goto LABEL_45;
          case 1u:
            goto LABEL_45;
          case 2u:
            v28 = ANIM_STD_HIGHIMPACT_BACK;
            goto LABEL_45;
          case 3u:
            v28 = ANIM_STD_HIGHIMPACT_RIGHT;
            goto LABEL_45;
          default:
            break;
        }
      }
      v29 = this->m_pInflictor;
      if ( v29 && (*(_BYTE *)&v29->m_info & 7) == 3 && (z = v29[18].m_transform.m_translate.z, z != 0.0) )
      {
        if ( (*(_BYTE *)(LODWORD(z) + 52) & 2) != 0 )
          v22 = v26 * 5.0;
        else
          v22 = v26 * CStats::GetFatAndMuscleModifier(STAT_MODIFIER_FIGHT_DAMAGE);
      }
      else
      {
        v22 = v26;
      }
      goto LABEL_55;
    case WEAPONTYPE_GRENADE:
    case WEAPONTYPE_ROCKETLAUNCHER:
    case WEAPONTYPE_ROCKETLAUNCHER_HS:
    case WEAPONTYPE_REMOTE_SATCHEL_CHARGE:
    case WEAPONTYPE_EXPLOSION:
      if ( m_iPedHitDir > 3 )
        goto LABEL_55;
      v24 = m_iPedHitDir + 24;
      goto LABEL_54;
    case WEAPONTYPE_TEARGAS:
    case WEAPONTYPE_MOLOTOV:
    case WEAPONTYPE_FLAMETHROWER:
    case WEAPONTYPE_SPRAYCAN:
    case WEAPONTYPE_EXTINGUISHER:
      goto LABEL_53;
    case WEAPONTYPE_PISTOL:
    case WEAPONTYPE_PISTOL_SILENCED:
    case WEAPONTYPE_MICRO_UZI:
    case WEAPONTYPE_MP5:
    case WEAPONTYPE_TEC9:
    case WEAPONTYPE_COUNTRYRIFLE:
    case WEAPONTYPE_SNIPERRIFLE:
    case WEAPONTYPE_UZI_DRIVEBY:
      goto LABEL_52;
    case WEAPONTYPE_DESERT_EAGLE:
      goto LABEL_50;
    case WEAPONTYPE_SHOTGUN:
    case WEAPONTYPE_SAWNOFF_SHOTGUN:
    case WEAPONTYPE_SPAS12_SHOTGUN:
    case WEAPONTYPE_MINIGUN:
      v25 = 2.0;
LABEL_50:
      v27 = v25;
      goto LABEL_52;
    case WEAPONTYPE_AK47:
    case WEAPONTYPE_M4:
      v27 = 0.5;
LABEL_52:
      if ( this->m_pedDamageResponse.m_bInstantKill )
      {
LABEL_53:
        v24 = ANIM_STD_KO_FRONT;
        goto LABEL_54;
      }
      if ( v27 <= 0.0 )
      {
        v42 = ANIM_STD_KO_FRONT;
        goto LABEL_73;
      }
      if ( m_iPedHitDir <= 3 )
      {
        v42 = m_iPedHitDir + 24;
LABEL_73:
        this->m_nAnimId = v42;
        v22 = v27;
        goto LABEL_55;
      }
      v22 = v27;
LABEL_55:
      if ( CCheat::m_aCheatsActive[75] )
      {
        m_eWeaponUsed = this->m_eWeaponUsed;
        if ( (unsigned int)m_eWeaponUsed < WEAPONTYPE_GOLFCLUB || m_eWeaponUsed == WEAPONTYPE_PARACHUTE )
          v22 = v22 * 20.0;
      }
      if ( v22 > 0.0 )
      {
        v32 = this->m_pInflictor;
        if ( v32 )
        {
          v33 = pPed->m_pMat;
          v34 = v32->m_pMat;
          if ( v33 )
            p_m_transform = (CSimpleTransform *)&v33->tx;
          p_x = &v34->tx;
          if ( !v34 )
            p_x = &v32->m_transform.m_translate.x;
          v36 = *p_x - p_m_transform->m_translate.x;
          v37 = p_x[1] - p_m_transform->m_translate.y;
          v38 = (float)(v36 * v36) + (float)(v37 * v37);
          if ( v38 <= 0.0 )
          {
            v40 = 1.0;
          }
          else
          {
            v39 = 1.0 / sqrtf(v38);
            v37 = v37 * v39;
            v40 = v36 * v39;
          }
          v46.z = 5.0;
          *(_DWORD *)p_m_nPedFlags &= 0xFFFFFFFC;
          v41 = v22 * -5.0;
          v46.x = v41 * v40;
          v46.y = v41 * v37;
          CPhysical::ApplyMoveForce(pPed, v46);
        }
      }
      return;
    case WEAPONTYPE_RAMMEDBYCAR:
    case WEAPONTYPE_RUNOVERBYCAR:
      switch ( this->m_iPedHitDir )
      {
        case 0u:
          m_eHitZone = this->m_eHitZone;
          if ( m_eHitZone == PED_SPHERE_UPPERARM_L )
            goto LABEL_84;
          v44 = ANIM_STD_HIGHIMPACT_BACK;
          goto LABEL_88;
        case 1u:
          v24 = ANIM_STD_HIGHIMPACT_LEFT;
          goto LABEL_54;
        case 2u:
          m_eHitZone = this->m_eHitZone;
          if ( m_eHitZone == PED_SPHERE_UPPERARM_L )
          {
LABEL_84:
            v24 = ANIM_STD_SPINFORWARD_LEFT;
            goto LABEL_54;
          }
          v44 = ANIM_STD_HIGHIMPACT_FRONT;
LABEL_88:
          if ( m_eHitZone == PED_SPHERE_UPPERARM_R )
            v44 = ANIM_STD_SPINFORWARD_RIGHT;
          this->m_nAnimId = v44;
          break;
        case 3u:
          v24 = ANIM_STD_HIGHIMPACT_RIGHT;
          goto LABEL_54;
        default:
          goto LABEL_55;
      }
      goto LABEL_55;
    case WEAPONTYPE_DROWNING:
      v24 = ANIM_STD_DROWN;
      goto LABEL_54;
    case WEAPONTYPE_FALL:
      v24 = ANIM_STD_KO_BACK;
      goto LABEL_54;
    default:
      goto LABEL_55;
  }
}

//----- (003732CC) --------------------------------------------------------
void __fastcall CEventDamage::ComputeDamageAnim(CEventDamage *this, CPed *pPed, bool bAtGenerateEventStage)
{
  int m_nPedFlags; // r1
  bool v6; // zf
  float v7; // s18
  unsigned int v8; // r6
  unsigned __int32 v9; // r1
  CPedFlags *p_m_nPedFlags; // r11
  int v11; // r4
  CEntity *m_pInflictor; // r1
  CTaskSimpleFight *TaskFighting; // r10
  CTaskSimpleUseGun *TaskUseGun; // r5
  CWeaponInfo *WeaponInfo; // r0
  eWeaponType m_eWeaponUsed; // r1
  RwReal z; // r0
  int v18; // r4
  CTask *SimplestActiveTask; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r1
  _BOOL4 IsPlayer; // r0
  CAnimBlendAssociation *FirstAssociation; // r0
  AnimationId v24; // r1
  float v25; // s16
  int m_iPedHitDir; // r6
  int v27; // r0
  eWeaponType v28; // r0
  CEntity *v29; // r0
  CEntity *m_pAttachToEntity; // r1
  bool v31; // zf
  char v32; // r0
  int v33; // r1
  int v34; // r11
  int m_nComboSet; // r2
  bool v36; // cc
  int v37; // r2
  int m_nCurrentMove; // r1
  int nFlags; // r2
  int v40; // r2
  int v41; // r2
  int v42; // r3
  int v43; // r3
  bool v44; // zf
  int v45; // r3
  AnimationId v46; // r1
  CPlayerPedData *v47; // r0
  int *v48; // r2
  eWeaponType v49; // r0
  CPlayerPedData *m_pPlayerData; // r0
  AnimationId v51; // r0
  CTask *ActiveTask; // r0
  char v53; // r1
  CEntity *v54; // r0
  CMatrix *v55; // r1
  CSimpleTransform *p_tx; // r3
  CMatrix *v57; // r2
  float *p_x; // r1
  float v59; // s2
  float v60; // s0
  float v61; // s4
  float v62; // s4
  float v63; // s2
  CEvent *CurrentEvent; // r0
  CEvent *v65; // r6
  int m_iAccumulatedTime; // r6
  int v67; // r1
  unsigned int v68; // r0
  int *v69; // r0
  int v70; // r0
  AnimationId v71; // r1
  AnimationId v72; // r0
  int v73; // r0
  AnimationId v74; // r1
  AnimationId v75; // r0
  int v76; // r0
  AnimationId v77; // r1
  AnimationId v78; // r0
  int v79; // r0
  AnimationId v80; // r1
  AnimationId v81; // r0
  eMoveState m_eMoveState; // [sp+4h] [bp-54h]
  _BOOL4 v83; // [sp+10h] [bp-48h]
  RwV3d_0 posn; // [sp+14h] [bp-44h] BYREF
  CVector v85; // 0:r1.12

  m_nPedFlags = (int)pPed->m_nPedFlags;
  v6 = (m_nPedFlags & 0x100) == 0;
  if ( (m_nPedFlags & 0x100) != 0 )
    v6 = pPed->m_pMyVehicle == 0;
  if ( !v6 )
  {
    WeaponInfo = CWeaponInfo::GetWeaponInfo(this->m_eWeaponUsed, 1);
    if ( WeaponInfo->m_eFireType == FIRETYPE_MELEE
      && (m_eWeaponUsed = this->m_eWeaponUsed, (unsigned int)m_eWeaponUsed >= WEAPONTYPE_GOLFCLUB)
      && m_eWeaponUsed != WEAPONTYPE_PARACHUTE
      || WeaponInfo->m_nDamage >= 51 )
    {
      *((_BYTE *)this + 33) |= 2u;
    }
    this->m_nAnimId = ANIM_STD_NUM;
    return;
  }
  v7 = 1.0;
  v8 = 0;
  v9 = this->m_eWeaponUsed - 24;
  p_m_nPedFlags = &pPed->m_nPedFlags;
  v11 = 0;
  if ( v9 <= 9 )
    v8 = (0x20Fu >> v9) & 1;
  m_pInflictor = this->m_pInflictor;
  if ( (*((_DWORD *)&pPed->m_nPedFlags + 3) & 4) == 0 )
    v11 = 1;
  TaskFighting = 0;
  v83 = bAtGenerateEventStage;
  m_eMoveState = pPed->m_eMoveState;
  if ( m_pInflictor )
  {
    if ( (*(_BYTE *)&m_pInflictor->m_info & 7) == 3 )
    {
      TaskFighting = CPedIntelligence::GetTaskFighting((const CPedIntelligence *)LODWORD(m_pInflictor[18].m_transform.m_translate.y));
      if ( TaskFighting )
        TaskUseGun = 0;
      else
        TaskUseGun = CPedIntelligence::GetTaskUseGun((const CPedIntelligence *)LODWORD(this->m_pInflictor[18].m_transform.m_translate.y));
      z = this->m_pInflictor[18].m_transform.m_translate.z;
      if ( z != 0.0 )
      {
        if ( (*(_BYTE *)(LODWORD(z) + 52) & 2) != 0 )
          v7 = 2.0;
        else
          v7 = (float)(CStats::GetFatAndMuscleModifier(STAT_MODIFIER_FIGHT_DAMAGE) * 0.5) + 0.5;
      }
    }
    else
    {
      TaskFighting = 0;
      TaskUseGun = 0;
    }
  }
  else
  {
    TaskUseGun = 0;
  }
  memset(&posn, 0, sizeof(posn));
  v18 = v11 & v8;
  CPed::GetBonePosition(pPed, &posn, 5u, 0);
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  m_pMat = pPed->m_pMat;
  p_m_transform = &pPed->m_transform;
  if ( m_pMat )
    p_m_transform = (CSimpleTransform *)&m_pMat->tx;
  if ( posn.z >= p_m_transform->m_translate.z
    || (IsPlayer = CPed::IsPlayer(pPed), !SimplestActiveTask)
    || IsPlayer
    || (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 207
    && (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 205 )
  {
    v25 = 0.0;
    if ( this->m_eHitZone != PED_SPHERE_CHEST )
      goto LABEL_65;
    if ( TaskUseGun && TaskUseGun->m_nLastCommand == 5 )
    {
      m_iPedHitDir = this->m_iPedHitDir;
      if ( this->m_iPedHitDir )
        m_iPedHitDir = 1;
    }
    else
    {
      if ( v18 != 1 )
      {
        v27 = 0;
        goto LABEL_46;
      }
      m_iPedHitDir = 1;
    }
    v27 = !CPed::IsPlayer(pPed) & m_iPedHitDir;
LABEL_46:
    if ( !(*(_DWORD *)p_m_nPedFlags & 0x4000000 | *((_DWORD *)&pPed->m_nPedFlags + 3) & 4) )
    {
      m_pAttachToEntity = pPed->m_pAttachToEntity;
      v31 = m_pAttachToEntity == 0;
      if ( !m_pAttachToEntity )
        v31 = v27 == 1;
      if ( v31 && this->m_pInflictor )
      {
        v25 = 5.0;
        goto LABEL_64;
      }
    }
    v28 = this->m_eWeaponUsed;
    if ( v28 > WEAPONTYPE_KATANA )
    {
      if ( v28 == WEAPONTYPE_FALL )
      {
        v29 = this->m_pInflictor;
        if ( v29 )
        {
          if ( (*(_BYTE *)&v29->m_info & 7) == 4 )
            goto LABEL_64;
        }
      }
    }
    else if ( pPed->m_nHealth < 15.0 )
    {
      v25 = v7 * 5.0;
      goto LABEL_64;
    }
    if ( !TaskFighting || TaskFighting->m_nCurrentMove != 4 || CPed::IsPlayer(pPed) || pPed->m_eMoveState < PEDMOVE_JOG )
      goto LABEL_65;
LABEL_64:
    *((_BYTE *)this + 33) |= 2u;
    goto LABEL_65;
  }
  *((_BYTE *)this + 33) |= 2u;
  FirstAssociation = RpAnimBlendClumpGetFirstAssociation((RpClump_0 *)pPed->m_pRwObject, 0x800u);
  v24 = ANIM_STD_HIT_FLOOR;
  if ( FirstAssociation )
    v24 = ANIM_STD_HIT_FLOOR_FRONT;
  v25 = 0.0;
  this->m_nAnimId = v24;
LABEL_65:
  v32 = *((_BYTE *)this + 33);
  v33 = this->m_iPedHitDir;
  if ( (v32 & 2) != 0 )
  {
    v34 = 0;
    if ( !TaskFighting || this->m_iPedHitDir )
      goto LABEL_111;
    m_nComboSet = TaskFighting->m_nComboSet;
    v36 = m_nComboSet < 4;
    v37 = m_nComboSet - 4;
    m_nCurrentMove = TaskFighting->m_nCurrentMove;
    if ( v36 )
      v37 = 0;
    nFlags = CTaskSimpleFight::m_aComboData[v37].nFlags;
    if ( ((16 << m_nCurrentMove) & nFlags) != 0 )
    {
      p_m_nPedFlags = &pPed->m_nPedFlags;
      v33 = 0;
    }
    else if ( m_nCurrentMove > 2
           || (p_m_nPedFlags = &pPed->m_nPedFlags, v45 = 4096 << m_nCurrentMove, v33 = 0, (v45 & nFlags) == 0) )
    {
      v34 = 0;
      goto LABEL_111;
    }
  }
  *((_BYTE *)this + 33) = v32 & 0xFD;
  if ( TaskFighting )
  {
    if ( !v33 )
    {
      v40 = TaskFighting->m_nComboSet;
      if ( v40 >= 4 && TaskFighting->m_nCurrentMove <= 2 )
      {
        this->m_nAnimGroup = CTaskSimpleFight::m_aComboData[v40 - 4].nAnimGroup;
        v41 = TaskFighting->m_nCurrentMove;
        this->m_fAnimBlendSpeed = 16.0;
        this->m_nAnimId = v41 + 219;
        v42 = TaskFighting->m_nComboSet;
        v36 = v42 < 4;
        v43 = v42 - 4;
        if ( v36 )
          v43 = 0;
        if ( ((16 << TaskFighting->m_nCurrentMove) & CTaskSimpleFight::m_aComboData[v43].nFlags) != 0 )
          *((_BYTE *)this + 33) = v32 | 2;
        goto LABEL_110;
      }
    }
  }
  if ( TaskUseGun )
  {
    v44 = v33 == 0;
    if ( !v33 )
      v44 = TaskUseGun->m_nLastCommand == 5;
    if ( v44 )
    {
      this->m_nAnimGroup = CTaskSimpleFight::m_aComboData[0].nAnimGroup;
      this->m_nAnimId = ANIM_MELEE_HIT_2;
      this->m_fAnimBlendSpeed = 16.0;
      goto LABEL_110;
    }
  }
  if ( (unsigned int)(this->m_eWeaponUsed - 22) > 0xB || v18 == 1 && !CPed::IsPlayer(pPed) )
    goto LABEL_104;
  if ( !CPed::IsPlayer(pPed) )
  {
    if ( m_eMoveState > PEDMOVE_STILL )
      goto LABEL_98;
LABEL_97:
    if ( *(_DWORD *)p_m_nPedFlags & 0x4000000 | *((_DWORD *)p_m_nPedFlags + 3) & 4 )
      goto LABEL_98;
LABEL_104:
    if ( CPed::IsPlayer(pPed) )
    {
      v49 = this->m_eWeaponUsed;
      if ( v49 < WEAPONTYPE_PISTOL )
        goto LABEL_128;
      m_pPlayerData = pPed->m_pPlayerData;
      if ( CTimer::m_snTimeInMilliseconds <= m_pPlayerData->m_nHitAnimDelayTimer || pPed->m_nPedState == PED_DRIVING )
      {
LABEL_108:
        v51 = ANIM_STD_NUM;
LABEL_109:
        this->m_nAnimId = v51;
        goto LABEL_110;
      }
      m_pPlayerData->m_nHitAnimDelayTimer = (unsigned int)(float)((float)CTimer::m_snTimeInMilliseconds + 2500.0);
    }
    v49 = this->m_eWeaponUsed;
LABEL_128:
    if ( (unsigned int)(v49 - 22) <= 0x19 )
    {
      CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&pPed->m_pPedIntelligence->m_eventHandler.m_history);
      v65 = CurrentEvent;
      if ( CurrentEvent )
      {
        if ( (*((int (__fastcall **)(CEvent *))CurrentEvent->_vptr$CEvent + 2))(CurrentEvent) == 9 )
          m_iAccumulatedTime = v65[3].m_iAccumulatedTime;
        else
          m_iAccumulatedTime = -1;
      }
      else
      {
        m_iAccumulatedTime = -1;
      }
      switch ( this->m_eHitZone )
      {
        case PED_SPHERE_CHEST:
        case PED_SPHERE_MIDSECTION:
          v68 = (char)this->m_iPedHitDir;
          if ( v68 < 4 )
          {
            v69 = (&off_373A88)[v68];
            goto LABEL_178;
          }
          if ( this->m_nAnimId != m_iAccumulatedTime )
            goto LABEL_110;
          do
          {
            v69 = (int *)((int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 4.0) + 183);
LABEL_178:
            this->m_nAnimId = (AnimationId)v69;
          }
          while ( v69 == (int *)m_iAccumulatedTime );
          break;
        case PED_SPHERE_UPPERARM_L:
          v70 = this->m_iPedHitDir;
          v71 = ANIM_STD_DAM_ARML_F;
          if ( v70 == 1 )
            v71 = ANIM_STD_DAM_ARML_L;
          if ( v70 == 2 )
            v71 = ANIM_STD_DAM_ARML_B;
          this->m_nAnimId = v71;
          if ( v71 != m_iAccumulatedTime )
            goto LABEL_110;
          v34 = 1;
          do
          {
            v72 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3.0) + 171;
            this->m_nAnimId = v72;
          }
          while ( v72 == m_iAccumulatedTime );
          goto LABEL_111;
        case PED_SPHERE_UPPERARM_R:
          v73 = this->m_iPedHitDir;
          v74 = ANIM_STD_DAM_ARMR_F;
          if ( v73 == 3 )
            v74 = ANIM_STD_DAM_ARMR_R;
          if ( v73 == 2 )
            v74 = ANIM_STD_DAM_ARMR_B;
          this->m_nAnimId = v74;
          if ( v74 != m_iAccumulatedTime )
            goto LABEL_110;
          v34 = 1;
          do
          {
            v75 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3.0) + 174;
            this->m_nAnimId = v75;
          }
          while ( v75 == m_iAccumulatedTime );
          goto LABEL_111;
        case PED_SPHERE_LEG_L:
          v79 = this->m_iPedHitDir;
          v80 = ANIM_STD_DAM_LEGL_F;
          if ( v79 == 1 )
            v80 = ANIM_STD_DAM_LEGL_L;
          if ( v79 == 2 )
            v80 = ANIM_STD_DAM_LEGL_B;
          this->m_nAnimId = v80;
          if ( v80 != m_iAccumulatedTime )
            goto LABEL_110;
          v34 = 1;
          do
          {
            v81 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3.0) + 177;
            this->m_nAnimId = v81;
          }
          while ( v81 == m_iAccumulatedTime );
          goto LABEL_111;
        case PED_SPHERE_LEG_R:
          v76 = this->m_iPedHitDir;
          v77 = ANIM_STD_DAM_LEGR_F;
          if ( v76 == 3 )
            v77 = ANIM_STD_DAM_LEGR_R;
          if ( v76 == 2 )
            v77 = ANIM_STD_DAM_LEGR_B;
          this->m_nAnimId = v77;
          if ( v77 != m_iAccumulatedTime )
            goto LABEL_110;
          v34 = 1;
          do
          {
            v78 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3.0) + 180;
            this->m_nAnimId = v78;
          }
          while ( v78 == m_iAccumulatedTime );
          goto LABEL_111;
        default:
          v51 = this->m_iPedHitDir + 32;
          goto LABEL_109;
      }
      goto LABEL_110;
    }
    v67 = this->m_iPedHitDir;
    this->m_nAnimId = v67 + 32;
    if ( v67 == 2 )
    {
      if ( v49 > WEAPONTYPE_CANE )
        goto LABEL_110;
      v51 = ANIM_STD_HIT_BEHIND;
    }
    else
    {
      if ( v67 || (float)(this->m_pedDamageResponse.m_fHealthLost + this->m_pedDamageResponse.m_fArmourLost) <= 20.0 )
        goto LABEL_110;
      v51 = ANIM_STD_HIT_WALK;
    }
    goto LABEL_109;
  }
  if ( m_eMoveState <= PEDMOVE_STILL && v18 == 1 )
    goto LABEL_97;
LABEL_98:
  v46 = this->m_iPedHitDir + 28;
  this->m_nAnimGroup = ANIM_STD_PED;
  this->m_nAnimId = v46;
  this->m_fAnimBlendSpeed = 8.0;
  if ( CPed::IsPlayer(pPed) )
  {
    v47 = pPed->m_pPlayerData;
    if ( CTimer::m_snTimeInMilliseconds > v47->m_nHitAnimDelayTimer && pPed->m_nPedState != PED_DRIVING )
    {
      v48 = dword_373AA0;
      if ( this->m_eWeaponUsed == WEAPONTYPE_M4 )
        v48 = &dword_373AA0[1];
      v47->m_nHitAnimDelayTimer = (unsigned int)(float)(*(float *)v48 + (float)CTimer::m_snTimeInMilliseconds);
      goto LABEL_110;
    }
    goto LABEL_108;
  }
LABEL_110:
  v34 = 1;
LABEL_111:
  if ( v83 )
  {
    if ( CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager) )
    {
      ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
      if ( !(*((int (__fastcall **)(CTask *, CPed *, int, CEventDamage *))ActiveTask->_vptr$CTask + 7))(
              ActiveTask,
              pPed,
              1,
              this) )
      {
        v53 = *((_BYTE *)this + 33);
        this->m_nAnimGroup = ANIM_STD_PED;
        this->m_nAnimId = ANIM_DOOR_OPENLEFT;
        *((_BYTE *)this + 33) = v53 & 0xFD;
      }
    }
  }
  if ( !(((*((_BYTE *)this + 33) & 2) == 0) | v34) )
  {
    this->m_nAnimId = this->m_iPedHitDir + 24;
    if ( v25 > 0.0 )
    {
      v54 = this->m_pInflictor;
      v55 = pPed->m_pMat;
      p_tx = &pPed->m_transform;
      v57 = v54->m_pMat;
      if ( v55 )
        p_tx = (CSimpleTransform *)&v55->tx;
      p_x = &v57->tx;
      if ( !v57 )
        p_x = &v54->m_transform.m_translate.x;
      v59 = *p_x - p_tx->m_translate.x;
      v60 = p_x[1] - p_tx->m_translate.y;
      v61 = (float)(v59 * v59) + (float)(v60 * v60);
      if ( v61 <= 0.0 )
      {
        v63 = 1.0;
      }
      else
      {
        v62 = 1.0 / sqrtf(v61);
        v60 = v60 * v62;
        v63 = v59 * v62;
      }
      *(_DWORD *)&pPed->m_nPedFlags &= 0xFFFFFFFC;
      v85.z = 5.0;
      v85.x = -(float)(v25 * v63);
      v85.y = -(float)(v25 * v60);
      CPhysical::ApplyMoveForce(pPed, v85);
    }
  }
}
// 373A88: using guessed type int *off_373A88;
// 373AA0: using guessed type int dword_373AA0[2];

//----- (00373AB0) --------------------------------------------------------
void __fastcall CEventDeath::CEventDeath(CEventDeath *this, const bool bHasDrowned)
{
  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_bHasDrowned = bHasDrowned;
  this->_vptr$CEvent = (int (**)(void))&off_666030;
  this->m_iTimeOfDeath = CTimer::m_snTimeInMilliseconds;
}
// 666030: using guessed type void *;

//----- (00373ADC) --------------------------------------------------------
void __fastcall CEventDeath::CEventDeath(CEventDeath *this, const bool bHasDrowned, const int iTimeOfDeath)
{
  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_bHasDrowned = bHasDrowned;
  this->m_iTimeOfDeath = iTimeOfDeath;
  this->_vptr$CEvent = (int (**)(void))&off_666030;
}
// 666030: using guessed type void *off_666030;

//----- (00373AFC) --------------------------------------------------------
bool __fastcall CEventDeath::AffectsPed(const CEventDeath *this, CPed *pPed)
{
  return 1;
}

//----- (00373B00) --------------------------------------------------------
void __fastcall CEventDeath::~CEventDeath(CEventDeath *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00373B30) --------------------------------------------------------
void __fastcall CEventDeadPed::CEventDeadPed(
        CEventDeadPed *this,
        CPed *pDeadPed,
        const bool bHasDrowned,
        const int iTimeOfDeath)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_bHasDrowned = bHasDrowned;
  this->m_iTimeOfDeath = iTimeOfDeath;
  this->_vptr$CEvent = (int (**)(void))&off_66607C;
  this->m_pDeadPed = pDeadPed;
  if ( pDeadPed )
    CEntity::RegisterReference(pDeadPed, &this->m_pDeadPed);
}
// 66607C: using guessed type void *off_66607C;

//----- (00373B78) --------------------------------------------------------
void __fastcall CEventDeadPed::~CEventDeadPed(CEventDeadPed *this)
{
  CPed *m_pDeadPed; // r0
  CEntity **p_m_pDeadPed; // r1

  p_m_pDeadPed = &this->m_pDeadPed;
  m_pDeadPed = this->m_pDeadPed;
  this->_vptr$CEvent = (int (**)(void))&off_66607C;
  if ( m_pDeadPed )
    CEntity::CleanUpOldReference(m_pDeadPed, p_m_pDeadPed);
}
// 66607C: using guessed type void *off_66607C;

//----- (00373BA0) --------------------------------------------------------
void __fastcall CEventDeadPed::~CEventDeadPed(CEventDeadPed *this)
{
  CPed *m_pDeadPed; // r0
  CEntity **p_m_pDeadPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pDeadPed = &this->m_pDeadPed;
  m_pDeadPed = this->m_pDeadPed;
  this->_vptr$CEvent = (int (**)(void))&off_66607C;
  if ( m_pDeadPed )
    CEntity::CleanUpOldReference(m_pDeadPed, p_m_pDeadPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 66607C: using guessed type void *;

//----- (00373BF4) --------------------------------------------------------
bool __fastcall CEventDeadPed::AffectsPed(const CEventDeadPed *this, CPed *pPed)
{
  CPed *m_pDeadPed; // r1
  bool result; // r0
  bool v6; // zf
  CEntity *LookAtEntity; // r0
  CPed *v8; // r1
  CMatrix *m_pMat; // r2
  CMatrix *v10; // r0
  CSimpleTransform *p_tx; // r3
  float *p_x; // r5
  float v13; // s4
  float v14; // s2
  float v15; // s6
  float v16; // s0

  m_pDeadPed = this->m_pDeadPed;
  result = 0;
  v6 = m_pDeadPed == 0;
  if ( m_pDeadPed )
    v6 = m_pDeadPed == pPed;
  if ( !v6 )
  {
    if ( !CPed::IsAlive(pPed) )
      return 0;
    if ( IKChainManager_c::IsLooking(&g_ikChainMan, pPed) )
    {
      LookAtEntity = IKChainManager_c::GetLookAtEntity(&g_ikChainMan, pPed);
      v8 = this->m_pDeadPed;
      if ( LookAtEntity == v8 )
        return 0;
    }
    else
    {
      v8 = this->m_pDeadPed;
    }
    if ( *((unsigned __int8 *)&v8->m_nPhysicalFlags + 1) << 31 )
    {
      return 0;
    }
    else
    {
      m_pMat = pPed->m_pMat;
      v10 = v8->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPed->m_transform;
      p_x = &v10->tx;
      if ( !v10 )
        p_x = &v8->m_transform.m_translate.x;
      v13 = p_x[1] - p_tx->m_translate.y;
      v14 = *p_x - p_tx->m_translate.x;
      v15 = p_x[2] - p_tx->m_translate.z;
      v16 = (float)((float)(v14 * v14) + (float)(v13 * v13)) + (float)(v15 * v15);
      if ( !(*((unsigned __int8 *)&v8->m_nPedFlags + 9) << 31) )
        return v16 < 400.0;
      result = 0;
      if ( v16 <= 64.0
        && (float)((float)((float)(v14 * m_pMat->xy) + (float)(v13 * m_pMat->yy)) + (float)(v15 * m_pMat->zy)) >= 0.0 )
      {
        return v16 < 400.0;
      }
    }
  }
  return result;
}

//----- (00373D00) --------------------------------------------------------
void __fastcall CEventGroupEvent::CEventGroupEvent(CEventGroupEvent *this, CPed *pDistressedPed, CEvent *pEvent)
{
  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_pEvent = pEvent;
  this->_vptr$CEvent = (int (**)(void))&off_6660CC;
  this->m_pDistressedPed = pDistressedPed;
  if ( pDistressedPed )
    CEntity::RegisterReference(pDistressedPed, &this->m_pDistressedPed);
}
// 6660CC: using guessed type void *;

//----- (00373D34) --------------------------------------------------------
void __fastcall CEventGroupEvent::~CEventGroupEvent(CEventGroupEvent *this)
{
  CPed *m_pDistressedPed; // r0
  CEntity **p_m_pDistressedPed; // r1
  CEvent *m_pEvent; // r0

  p_m_pDistressedPed = &this->m_pDistressedPed;
  m_pDistressedPed = this->m_pDistressedPed;
  this->_vptr$CEvent = (int (**)(void))&off_6660CC;
  if ( m_pDistressedPed )
    CEntity::CleanUpOldReference(m_pDistressedPed, p_m_pDistressedPed);
  m_pEvent = this->m_pEvent;
  if ( m_pEvent )
    (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
}
// 6660CC: using guessed type void *off_6660CC;

//----- (00373D68) --------------------------------------------------------
void __fastcall CEventGroupEvent::~CEventGroupEvent(CEventGroupEvent *this)
{
  CPed *m_pDistressedPed; // r0
  CEntity **p_m_pDistressedPed; // r1
  CEvent *m_pEvent; // r0
  CEventPool *v5; // r0
  int v6; // r1

  p_m_pDistressedPed = &this->m_pDistressedPed;
  m_pDistressedPed = this->m_pDistressedPed;
  this->_vptr$CEvent = (int (**)(void))&off_6660CC;
  if ( m_pDistressedPed )
    CEntity::CleanUpOldReference(m_pDistressedPed, p_m_pDistressedPed);
  m_pEvent = this->m_pEvent;
  if ( m_pEvent )
    (*((void (__fastcall **)(CEvent *))m_pEvent->_vptr$CEvent + 1))(m_pEvent);
  v5 = CPools::ms_pEventPool;
  v6 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v6] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v6 < v5->m_nFreeIndex )
    v5->m_nFreeIndex = v6;
}
// 6660CC: using guessed type void *off_6660CC;

//----- (00373DC8) --------------------------------------------------------
bool __fastcall CEventGroupEvent::AffectsPed(const CEventGroupEvent *this, CPed *pPed)
{
  return 0;
}

//----- (00373DCC) --------------------------------------------------------
bool __fastcall CEventGroupEvent::AffectsPedGroup(const CEventGroupEvent *this, CPedGroup *pPedGroup)
{
  return sub_18E070(&pPedGroup->m_membership, this->m_pDistressedPed);
}

//----- (00373DD8) --------------------------------------------------------
bool __fastcall CEventGroupEvent::BaseEventTakesPriorityOverBaseEvent(
        const CEventGroupEvent *this,
        const CEventGroupEvent *other)
{
  int v4; // r0
  _BOOL4 v5; // r6
  int v6; // r0

  v4 = (*((int (__fastcall **)(CEvent *))this->m_pEvent->_vptr$CEvent + 2))(this->m_pEvent);
  v5 = 1;
  if ( ((unsigned int)(v4 - 54) > 0x17 || ((1 << (v4 - 54)) & 0xC2000B) == 0) && v4 != 7 )
    v5 = 0;
  v6 = (*((int (__fastcall **)(CEvent *))other->m_pEvent->_vptr$CEvent + 2))(other->m_pEvent);
  if ( (unsigned int)(v6 - 54) <= 0x17 && ((1 << (v6 - 54)) & 0xC2000B) != 0 || v6 == 7 )
    return v5;
  if ( v5 )
  {
    LOBYTE(v5) = 1;
    return v5;
  }
  return (*((int (__fastcall **)(CEvent *, CEvent *))this->m_pEvent->_vptr$CEvent + 12))(
           this->m_pEvent,
           other->m_pEvent);
}

//----- (00373E50) --------------------------------------------------------
void __fastcall CEventPotentialGetRunOver::CEventPotentialGetRunOver(
        CEventPotentialGetRunOver *this,
        CVehicle *pThreatVehicle)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666118;
  this->m_pThreatVehicle = pThreatVehicle;
  if ( pThreatVehicle )
    CEntity::RegisterReference(pThreatVehicle, &this->m_pThreatVehicle);
}
// 666118: using guessed type void *;

//----- (00373E90) --------------------------------------------------------
void __fastcall CEventPotentialGetRunOver::~CEventPotentialGetRunOver(CEventPotentialGetRunOver *this)
{
  CVehicle *m_pThreatVehicle; // r0
  CEntity **p_m_pThreatVehicle; // r1

  p_m_pThreatVehicle = &this->m_pThreatVehicle;
  m_pThreatVehicle = this->m_pThreatVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666118;
  if ( m_pThreatVehicle )
    CEntity::CleanUpOldReference(m_pThreatVehicle, p_m_pThreatVehicle);
}
// 666118: using guessed type void *off_666118;

//----- (00373EB8) --------------------------------------------------------
void __fastcall CEventPotentialGetRunOver::~CEventPotentialGetRunOver(CEventPotentialGetRunOver *this)
{
  CVehicle *m_pThreatVehicle; // r0
  CEntity **p_m_pThreatVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pThreatVehicle = &this->m_pThreatVehicle;
  m_pThreatVehicle = this->m_pThreatVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666118;
  if ( m_pThreatVehicle )
    CEntity::CleanUpOldReference(m_pThreatVehicle, p_m_pThreatVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666118: using guessed type void *off_666118;

//----- (00373F0C) --------------------------------------------------------
bool __fastcall CEventPotentialGetRunOver::AffectsPed(const CEventPotentialGetRunOver *this, CPed *pPed)
{
  CEntity *m_pAttachToEntity; // r0
  bool v5; // zf
  bool result; // r0
  CVehicle *m_pThreatVehicle; // r1

  if ( !CPed::IsAlive(pPed) )
    return 0;
  m_pAttachToEntity = pPed->m_pAttachToEntity;
  v5 = m_pAttachToEntity == 0;
  if ( !m_pAttachToEntity )
    v5 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  if ( !v5 )
    return 0;
  m_pThreatVehicle = this->m_pThreatVehicle;
  result = 0;
  if ( m_pThreatVehicle )
  {
    if ( m_pThreatVehicle->m_baseVehicleType != 5 )
      return 1;
  }
  return result;
}

//----- (00373F4C) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoVehicle::CEventPotentialWalkIntoVehicle(
        CEventPotentialWalkIntoVehicle *this,
        CVehicle *pThreatVehicle,
        const int iMoveState)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_iMoveState = iMoveState;
  this->_vptr$CEvent = (int (**)(void))&off_666168;
  this->m_pThreatVehicle = pThreatVehicle;
  if ( pThreatVehicle )
    CEntity::RegisterReference(pThreatVehicle, &this->m_pThreatVehicle);
}
// 666168: using guessed type void *off_666168;

//----- (00373F90) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoVehicle::~CEventPotentialWalkIntoVehicle(CEventPotentialWalkIntoVehicle *this)
{
  CVehicle *m_pThreatVehicle; // r0
  CEntity **p_m_pThreatVehicle; // r1

  p_m_pThreatVehicle = &this->m_pThreatVehicle;
  m_pThreatVehicle = this->m_pThreatVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666168;
  if ( m_pThreatVehicle )
    CEntity::CleanUpOldReference(m_pThreatVehicle, p_m_pThreatVehicle);
}
// 666168: using guessed type void *;

//----- (00373FB8) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoVehicle::~CEventPotentialWalkIntoVehicle(CEventPotentialWalkIntoVehicle *this)
{
  CVehicle *m_pThreatVehicle; // r0
  CEntity **p_m_pThreatVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pThreatVehicle = &this->m_pThreatVehicle;
  m_pThreatVehicle = this->m_pThreatVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666168;
  if ( m_pThreatVehicle )
    CEntity::CleanUpOldReference(m_pThreatVehicle, p_m_pThreatVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666168: using guessed type void *off_666168;

//----- (0037400C) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoVehicle::AffectsPed(const CEventPotentialWalkIntoVehicle *this, CPed *pPed)
{
  CTaskComplexEnterCar *ActiveTaskByType; // r6
  CTask *SimplestActiveTask; // r4
  _BOOL4 IsPlayer; // r0
  CTask *v7; // r0
  CTask *v8; // r3
  CVehicle *v9; // r1
  CVehicle *m_pParent; // r2
  CVehicle *m_pVehicleBeingTowed; // r0
  CVehicle *m_pTowingVehicle; // r6
  bool result; // r0
  CVehicle *m_pThreatVehicle; // r0
  unsigned int v15; // r0
  __int64 v16; // d16
  int v17; // r0
  CVehicle *v18; // r0
  CVehicle *m_pTargetVehicle; // r1
  bool v20; // zf
  int v21; // r4
  CVector v22; // [sp+0h] [bp-30h] BYREF
  CVector vPos; // [sp+10h] [bp-20h] BYREF

  ActiveTaskByType = (CTaskComplexEnterCar *)CTaskManager::FindActiveTaskByType(
                                               &pPed->m_pPedIntelligence->m_taskManager,
                                               701);
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  IsPlayer = CPed::IsPlayer(pPed);
  if ( !ActiveTaskByType && IsPlayer && !CTask::IsGoToTask(SimplestActiveTask)
    || !CPed::IsAlive(pPed)
    || *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31
    || this->m_iMoveState == 1 )
  {
    return 0;
  }
  v7 = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 508);
  v8 = v7;
  if ( !v7 )
  {
    if ( pPed->m_pAttachToEntity )
      return 0;
    m_pThreatVehicle = this->m_pThreatVehicle;
    if ( !m_pThreatVehicle )
      return 0;
    v15 = m_pThreatVehicle->m_vehicleType + 1;
    if ( v15 <= 9 && ((1 << v15) & 0x301) != 0 )
      return 0;
    if ( (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) == 900 )
    {
      v16 = *(_QWORD *)&SimplestActiveTask[1].m_pParent;
      LODWORD(vPos.z) = SimplestActiveTask[2].m_pParent;
      v17 = 1;
      *(_QWORD *)&vPos.x = v16;
      if ( ActiveTaskByType )
      {
LABEL_22:
        v18 = this->m_pThreatVehicle;
        m_pTargetVehicle = ActiveTaskByType->m_pTargetVehicle;
        v20 = v18 == m_pTargetVehicle;
        if ( v18 == m_pTargetVehicle )
          v20 = v18->m_vehicleType == 4;
        if ( v20 )
          return 0;
        CTaskComplexEnterCar::GetTargetPos(&v22, ActiveTaskByType);
        vPos = v22;
LABEL_28:
        CPedGeometryAnalyser::ComputeClosestSurfacePoint(pPed, this->m_pThreatVehicle, &v22);
        v21 = CPedGeometryAnalyser::ComputeEntityHitSide(&v22, this->m_pThreatVehicle);
        return v21 != CPedGeometryAnalyser::ComputeEntityHitSide(&vPos, this->m_pThreatVehicle);
      }
    }
    else
    {
      v17 = 0;
      if ( ActiveTaskByType )
        goto LABEL_22;
    }
    if ( v17 != 1 )
      return 1;
    goto LABEL_28;
  }
  v9 = this->m_pThreatVehicle;
  m_pParent = (CVehicle *)v7[3].m_pParent;
  if ( m_pParent == v9 )
    return 0;
  m_pVehicleBeingTowed = v9->m_pVehicleBeingTowed;
  if ( m_pVehicleBeingTowed && m_pVehicleBeingTowed == m_pParent
    || (m_pTowingVehicle = v9->m_pTowingVehicle, result = 0, m_pTowingVehicle) && m_pTowingVehicle == m_pParent )
  {
    CTaskComplexWalkRoundCar::SetNewVehicle((CTaskComplexWalkRoundCar *)v8, v9, (char)(4 * BYTE1(v8[1].m_pParent)) >> 4);
    return 0;
  }
  return result;
}

//----- (00374150) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoVehicle::TakesPriorityOver(
        const CEventPotentialWalkIntoVehicle *this,
        const CEvent *otherEvent)
{
  return 1;
}

//----- (00374154) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoObject::CEventPotentialWalkIntoObject(
        CEventPotentialWalkIntoObject *this,
        CObject *pObject,
        const int iMoveState)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_iMoveState = iMoveState;
  this->_vptr$CEvent = (int (**)(void))&off_6661B8;
  this->m_pObject = pObject;
  if ( pObject )
    CEntity::RegisterReference(pObject, &this->m_pObject);
}
// 6661B8: using guessed type void *off_6661B8;

//----- (00374198) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoObject::~CEventPotentialWalkIntoObject(CEventPotentialWalkIntoObject *this)
{
  CObject *m_pObject; // r0
  CEntity **p_m_pObject; // r1

  p_m_pObject = &this->m_pObject;
  m_pObject = this->m_pObject;
  this->_vptr$CEvent = (int (**)(void))&off_6661B8;
  if ( m_pObject )
    CEntity::CleanUpOldReference(m_pObject, p_m_pObject);
}
// 6661B8: using guessed type void *;

//----- (003741C0) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoObject::~CEventPotentialWalkIntoObject(CEventPotentialWalkIntoObject *this)
{
  CObject *m_pObject; // r0
  CEntity **p_m_pObject; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pObject = &this->m_pObject;
  m_pObject = this->m_pObject;
  this->_vptr$CEvent = (int (**)(void))&off_6661B8;
  if ( m_pObject )
    CEntity::CleanUpOldReference(m_pObject, p_m_pObject);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6661B8: using guessed type void *off_6661B8;

//----- (00374214) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoObject::AffectsPed(const CEventPotentialWalkIntoObject *this, CPed *pPed)
{
  CObject *m_pObject; // r0
  bool v5; // zf
  CColModel *m_pColModel; // r0
  CTask *ActiveTask; // r0
  CObject **v9; // r5

  if ( CPed::IsPlayer(pPed) || !CPed::IsAlive(pPed) )
    return 0;
  m_pObject = this->m_pObject;
  v5 = m_pObject == 0;
  if ( m_pObject )
    v5 = this->m_iMoveState == 1;
  if ( v5 )
    return 0;
  if ( pPed->m_pAttachToEntity )
    return 0;
  if ( m_pObject->m_pAttachToEntity == pPed )
    return 0;
  if ( (*(_BYTE *)&m_pObject->m_nPhysicalFlags & 0x20) != 0 )
    return 0;
  m_pColModel = CModelInfo::ms_modelInfoPtrs[m_pObject->m_nModelIndex]->m_pColModel;
  if ( (float)(m_pColModel->m_boxBound.m_vecMax.x - m_pColModel->m_boxBound.m_vecMin.x) < 0.01
    || (float)(m_pColModel->m_boxBound.m_vecMax.y - m_pColModel->m_boxBound.m_vecMin.y) < 0.01
    || (float)(m_pColModel->m_boxBound.m_vecMax.z - m_pColModel->m_boxBound.m_vecMin.z) < 0.01 )
  {
    return 0;
  }
  ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  v9 = (CObject **)ActiveTask;
  return !ActiveTask
      || ((*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 939 || v9[3] != this->m_pObject)
      && (((int (__fastcall *)(CObject **))(*v9)->m_pMat)(v9) != 510 || v9[7] != this->m_pObject);
}

//----- (003742F4) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoObject::TakesPriorityOver(
        const CEventPotentialWalkIntoObject *this,
        const CEvent *otherEvent)
{
  return 1;
}

//----- (003742F8) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoPed::CEventPotentialWalkIntoPed(
        CEventPotentialWalkIntoPed *this,
        CPed *pOtherPed,
        const CVector *vTarget,
        const int iMoveState)
{
  __int64 v4; // d16

  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666208;
  v4 = *(_QWORD *)&vTarget->x;
  this->m_vTarget.z = vTarget->z;
  this->m_iMoveState = iMoveState;
  *(_QWORD *)&this->m_vTarget.x = v4;
  this->m_pOtherPed = pOtherPed;
  CEntity::RegisterReference(pOtherPed, &this->m_pOtherPed);
}
// 666208: using guessed type void *off_666208;

//----- (00374348) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoPed::~CEventPotentialWalkIntoPed(CEventPotentialWalkIntoPed *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CEvent = (int (**)(void))&off_666208;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
}
// 666208: using guessed type void *;

//----- (00374370) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoPed::~CEventPotentialWalkIntoPed(CEventPotentialWalkIntoPed *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CEvent = (int (**)(void))&off_666208;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666208: using guessed type void *off_666208;

//----- (003743C4) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoPed::AffectsPed(const CEventPotentialWalkIntoPed *this, CPed *pPed)
{
  CPed *m_pOtherPed; // r0
  bool v5; // zf
  CTask *ActiveTaskByType; // r8
  CTask *v7; // r6
  int v8; // r8
  CTask *v9; // r0
  CTask *TaskByType; // r0
  CTask *SimplestActiveTask; // r0

  if ( !CPed::IsAlive(pPed) )
    return 0;
  m_pOtherPed = this->m_pOtherPed;
  v5 = m_pOtherPed == 0;
  if ( m_pOtherPed )
    v5 = this->m_iMoveState == 1;
  if ( v5 )
    return 0;
  ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1202);
  if ( ActiveTaskByType
    || (ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1215)) != 0
    || (ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1203)) != 0 )
  {
    v7 = CTaskManager::FindActiveTaskByType(&this->m_pOtherPed->m_pPedIntelligence->m_taskManager, 1202);
    if ( v7
      || (v7 = CTaskManager::FindActiveTaskByType(&this->m_pOtherPed->m_pPedIntelligence->m_taskManager, 1215)) != 0
      || (v7 = CTaskManager::FindActiveTaskByType(&this->m_pOtherPed->m_pPedIntelligence->m_taskManager, 1203)) != 0 )
    {
      v8 = (*((int (__fastcall **)(CTask *))ActiveTaskByType->_vptr$CTask + 5))(ActiveTaskByType);
      if ( v8 == (*((int (__fastcall **)(CTask *))v7->_vptr$CTask + 5))(v7) )
        return 0;
    }
  }
  v9 = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 936);
  if ( v9 )
  {
    if ( v9[1].m_pParent == (CTask *)this->m_pOtherPed )
      return 0;
  }
  TaskByType = CPedIntelligence::FindTaskByType(pPed->m_pPedIntelligence, 1000);
  if ( TaskByType )
  {
    if ( TaskByType[2]._vptr$CTask == (int (**)(void))this->m_pOtherPed )
      return 0;
  }
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  return SimplestActiveTask && CTask::IsGoToTask(SimplestActiveTask) != 0;
}

//----- (003744CE) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoPed::TakesPriorityOver(
        const CEventPotentialWalkIntoPed *this,
        const CEvent *otherEvent)
{
  int v5; // r5

  if ( CEventHandler::IsTemporaryEvent(otherEvent) )
    return 1;
  v5 = (*((int (__fastcall **)(const CEventPotentialWalkIntoPed *))this->_vptr$CEvent + 3))(this);
  return v5 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (00374504) --------------------------------------------------------
void __fastcall CEventVehicleHitAndRun::CEventVehicleHitAndRun(
        CEventVehicleHitAndRun *this,
        CPed *pKnockedDownPed,
        CVehicle *pInflictor)
{
  CEntity **p_m_pKnockedDownPed; // r5

  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_666258;
  this->m_iAccumulatedTime = 0;
  this->m_pKnockedDownPed = pKnockedDownPed;
  p_m_pKnockedDownPed = &this->m_pKnockedDownPed;
  this->m_pInflictor = pInflictor;
  CEntity::RegisterReference(pInflictor, &this->m_pInflictor);
  CEntity::RegisterReference(*p_m_pKnockedDownPed, p_m_pKnockedDownPed);
}
// 666258: using guessed type void *off_666258;

//----- (0037453C) --------------------------------------------------------
void __fastcall CEventVehicleHitAndRun::~CEventVehicleHitAndRun(CEventVehicleHitAndRun *this)
{
  CVehicle *m_pInflictor; // r0
  CEntity **p_m_pInflictor; // r1
  CPed *m_pKnockedDownPed; // r0

  p_m_pInflictor = &this->m_pInflictor;
  m_pInflictor = this->m_pInflictor;
  this->_vptr$CEvent = (int (**)(void))&off_666258;
  if ( m_pInflictor )
    CEntity::CleanUpOldReference(m_pInflictor, p_m_pInflictor);
  m_pKnockedDownPed = this->m_pKnockedDownPed;
  if ( m_pKnockedDownPed )
    CEntity::CleanUpOldReference(m_pKnockedDownPed, &this->m_pKnockedDownPed);
}
// 666258: using guessed type void *off_666258;

//----- (00374570) --------------------------------------------------------
void __fastcall CEventVehicleHitAndRun::~CEventVehicleHitAndRun(CEventVehicleHitAndRun *this)
{
  CVehicle *m_pInflictor; // r0
  CEntity **p_m_pInflictor; // r1
  CPed *m_pKnockedDownPed; // r0
  CEventPool *v5; // r0
  int v6; // r1

  p_m_pInflictor = &this->m_pInflictor;
  m_pInflictor = this->m_pInflictor;
  this->_vptr$CEvent = (int (**)(void))&off_666258;
  if ( m_pInflictor )
    CEntity::CleanUpOldReference(m_pInflictor, p_m_pInflictor);
  m_pKnockedDownPed = this->m_pKnockedDownPed;
  if ( m_pKnockedDownPed )
    CEntity::CleanUpOldReference(m_pKnockedDownPed, &this->m_pKnockedDownPed);
  v5 = CPools::ms_pEventPool;
  v6 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v6] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v6 < v5->m_nFreeIndex )
    v5->m_nFreeIndex = v6;
}
// 666258: using guessed type void *;

//----- (003745D0) --------------------------------------------------------
void __fastcall CEventPedEnteredMyVehicle::CEventPedEnteredMyVehicle(
        CEventPedEnteredMyVehicle *this,
        const CPed *pPedThatEnteredVehicle,
        const CVehicle *pVehicle,
        const int iTargetDoor)
{
  CEntity **p_m_pVehicle; // r5

  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_iTargetDoor = iTargetDoor;
  this->_vptr$CEvent = (int (**)(void))&off_6662A4;
  this->m_pVehicle = (CVehicle *)pVehicle;
  p_m_pVehicle = &this->m_pVehicle;
  this->m_pPedThatEnteredVehicle = (CPed *)pPedThatEnteredVehicle;
  CEntity::RegisterReference(&pPedThatEnteredVehicle->CPhysical, &this->m_pPedThatEnteredVehicle);
  CEntity::RegisterReference(*p_m_pVehicle, &this->m_pVehicle);
}
// 6662A4: using guessed type void *;

//----- (0037461C) --------------------------------------------------------
void __fastcall CEventPedEnteredMyVehicle::~CEventPedEnteredMyVehicle(CEventPedEnteredMyVehicle *this)
{
  CPed *m_pPedThatEnteredVehicle; // r0
  CEntity **p_m_pPedThatEnteredVehicle; // r1
  CVehicle *m_pVehicle; // r0

  p_m_pPedThatEnteredVehicle = &this->m_pPedThatEnteredVehicle;
  m_pPedThatEnteredVehicle = this->m_pPedThatEnteredVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6662A4;
  if ( m_pPedThatEnteredVehicle )
    CEntity::CleanUpOldReference(m_pPedThatEnteredVehicle, p_m_pPedThatEnteredVehicle);
  m_pVehicle = this->m_pVehicle;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, &this->m_pVehicle);
}
// 6662A4: using guessed type void *off_6662A4;

//----- (00374650) --------------------------------------------------------
void __fastcall CEventPedEnteredMyVehicle::~CEventPedEnteredMyVehicle(CEventPedEnteredMyVehicle *this)
{
  CPed *m_pPedThatEnteredVehicle; // r0
  CEntity **p_m_pPedThatEnteredVehicle; // r1
  CVehicle *m_pVehicle; // r0
  CEventPool *v5; // r0
  int v6; // r1

  p_m_pPedThatEnteredVehicle = &this->m_pPedThatEnteredVehicle;
  m_pPedThatEnteredVehicle = this->m_pPedThatEnteredVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6662A4;
  if ( m_pPedThatEnteredVehicle )
    CEntity::CleanUpOldReference(m_pPedThatEnteredVehicle, p_m_pPedThatEnteredVehicle);
  m_pVehicle = this->m_pVehicle;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, &this->m_pVehicle);
  v5 = CPools::ms_pEventPool;
  v6 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v6] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v6 < v5->m_nFreeIndex )
    v5->m_nFreeIndex = v6;
}
// 6662A4: using guessed type void *off_6662A4;

//----- (003746B0) --------------------------------------------------------
bool __fastcall CEventPedEnteredMyVehicle::AffectsPed(const CEventPedEnteredMyVehicle *this, CPed *pPed)
{
  CVehicle *m_pMyVehicle; // r0
  bool v5; // zf

  if ( !CPed::IsAlive(pPed) )
    return 0;
  m_pMyVehicle = pPed->m_pMyVehicle;
  v5 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
    v5 = *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 == 0;
  return !v5 && m_pMyVehicle == this->m_pVehicle && this->m_pPedThatEnteredVehicle != 0;
}

//----- (003746E8) --------------------------------------------------------
void __fastcall CEventRevived::CEventRevived(CEventRevived *this)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6662F4;
  this->m_iAccumulatedTime = 0;
}
// 6662F4: using guessed type void *;

//----- (00374700) --------------------------------------------------------
void __fastcall CEventRevived::~CEventRevived(CEventRevived *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00374730) --------------------------------------------------------
bool __fastcall CEventRevived::AffectsPed(const CEventRevived *this, CPed *pPed)
{
  return pPed->CharCreatedBy != 2 && !CPed::IsAlive(pPed);
}

//----- (0037474C) --------------------------------------------------------
void __fastcall CEventChatPartner::CEventChatPartner(CEventChatPartner *this, const bool bIsLeader, CPed *pOtherPed)
{
  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_bIsLeader = bIsLeader;
  this->_vptr$CEvent = (int (**)(void))&off_666340;
  this->m_pOtherPed = pOtherPed;
  if ( pOtherPed )
    CEntity::RegisterReference(pOtherPed, &this->m_pOtherPed);
}
// 666340: using guessed type void *off_666340;

//----- (00374780) --------------------------------------------------------
void __fastcall CEventChatPartner::~CEventChatPartner(CEventChatPartner *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CEvent = (int (**)(void))&off_666340;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
}
// 666340: using guessed type void *off_666340;

//----- (003747A8) --------------------------------------------------------
void __fastcall CEventChatPartner::~CEventChatPartner(CEventChatPartner *this)
{
  CPed *m_pOtherPed; // r0
  CEntity **p_m_pOtherPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pOtherPed = &this->m_pOtherPed;
  m_pOtherPed = this->m_pOtherPed;
  this->_vptr$CEvent = (int (**)(void))&off_666340;
  if ( m_pOtherPed )
    CEntity::CleanUpOldReference(m_pOtherPed, p_m_pOtherPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666340: using guessed type void *;

//----- (003747FC) --------------------------------------------------------
bool __fastcall CEventChatPartner::AffectsPed(const CEventChatPartner *this, CPed *pPed)
{
  return CPed::IsAlive(pPed) && this->m_pOtherPed != 0;
}

//----- (0037481C) --------------------------------------------------------
void __fastcall CEventSexyPed::CEventSexyPed(CEventSexyPed *this, CPed *pSexyPed)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_66638C;
  this->m_pSexyPed = pSexyPed;
  if ( pSexyPed )
    CEntity::RegisterReference(pSexyPed, &this->m_pSexyPed);
}
// 66638C: using guessed type void *off_66638C;

//----- (0037485C) --------------------------------------------------------
void __fastcall CEventSexyPed::~CEventSexyPed(CEventSexyPed *this)
{
  CPed *m_pSexyPed; // r0
  CEntity **p_m_pSexyPed; // r1

  p_m_pSexyPed = &this->m_pSexyPed;
  m_pSexyPed = this->m_pSexyPed;
  this->_vptr$CEvent = (int (**)(void))&off_66638C;
  if ( m_pSexyPed )
    CEntity::CleanUpOldReference(m_pSexyPed, p_m_pSexyPed);
}
// 66638C: using guessed type void *;

//----- (00374884) --------------------------------------------------------
void __fastcall CEventSexyPed::~CEventSexyPed(CEventSexyPed *this)
{
  CPed *m_pSexyPed; // r0
  CEntity **p_m_pSexyPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pSexyPed = &this->m_pSexyPed;
  m_pSexyPed = this->m_pSexyPed;
  this->_vptr$CEvent = (int (**)(void))&off_66638C;
  if ( m_pSexyPed )
    CEntity::CleanUpOldReference(m_pSexyPed, p_m_pSexyPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 66638C: using guessed type void *off_66638C;

//----- (003748D8) --------------------------------------------------------
bool __fastcall CEventSexyPed::AffectsPed(const CEventSexyPed *this, CPed *pPed)
{
  CPed *m_pSexyPed; // r0
  CTask *ActiveTaskByType; // r6
  CTask *v6; // r5
  int v7; // r4

  if ( !CPed::IsAlive(pPed) )
    return 0;
  m_pSexyPed = this->m_pSexyPed;
  if ( !m_pSexyPed
    || !CPed::IsAlive(m_pSexyPed)
    || IKChainManager_c::IsLooking(&g_ikChainMan, pPed)
    && IKChainManager_c::GetLookAtEntity(&g_ikChainMan, pPed) == this->m_pSexyPed )
  {
    return 0;
  }
  if ( ((ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1202)) != 0
     || (ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1215)) != 0
     || (ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1203)) != 0)
    && ((v6 = CTaskManager::FindActiveTaskByType(&this->m_pSexyPed->m_pPedIntelligence->m_taskManager, 1202)) != 0
     || (v6 = CTaskManager::FindActiveTaskByType(&this->m_pSexyPed->m_pPedIntelligence->m_taskManager, 1215)) != 0
     || (v6 = CTaskManager::FindActiveTaskByType(&this->m_pSexyPed->m_pPedIntelligence->m_taskManager, 1203)) != 0)
    && (v7 = (*((int (__fastcall **)(CTask *))ActiveTaskByType->_vptr$CTask + 5))(ActiveTaskByType),
        v7 == (*((int (__fastcall **)(CTask *))v6->_vptr$CTask + 5))(v6)) )
  {
    return 0;
  }
  else
  {
    return 1;
  }
}

//----- (003749BC) --------------------------------------------------------
void __fastcall CEventSexyVehicle::CEventSexyVehicle(CEventSexyVehicle *this, CVehicle *pSexyVehicle)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6663DC;
  this->m_iAccumulatedTime = 0;
  this->m_pSexyVehicle = pSexyVehicle;
  if ( pSexyVehicle )
    CEntity::RegisterReference(pSexyVehicle, &this->m_pSexyVehicle);
}
// 6663DC: using guessed type void *off_6663DC;

//----- (003749F0) --------------------------------------------------------
void __fastcall CEventSexyVehicle::~CEventSexyVehicle(CEventSexyVehicle *this)
{
  CVehicle *m_pSexyVehicle; // r0
  CEntity **p_m_pSexyVehicle; // r1

  p_m_pSexyVehicle = &this->m_pSexyVehicle;
  m_pSexyVehicle = this->m_pSexyVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6663DC;
  if ( m_pSexyVehicle )
    CEntity::CleanUpOldReference(m_pSexyVehicle, p_m_pSexyVehicle);
}
// 6663DC: using guessed type void *off_6663DC;

//----- (00374A18) --------------------------------------------------------
void __fastcall CEventSexyVehicle::~CEventSexyVehicle(CEventSexyVehicle *this)
{
  CVehicle *m_pSexyVehicle; // r0
  CEntity **p_m_pSexyVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pSexyVehicle = &this->m_pSexyVehicle;
  m_pSexyVehicle = this->m_pSexyVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6663DC;
  if ( m_pSexyVehicle )
    CEntity::CleanUpOldReference(m_pSexyVehicle, p_m_pSexyVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6663DC: using guessed type void *;

//----- (00374A6C) --------------------------------------------------------
bool __fastcall CEventSexyVehicle::AffectsPed(const CEventSexyVehicle *this, CPed *pPed)
{
  return CPed::IsAlive(pPed) && this->m_pSexyVehicle != 0;
}

//----- (00374A8C) --------------------------------------------------------
void __fastcall CEventPedToChase::CEventPedToChase(CEventPedToChase *this, CPed *pPedToChase)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_666428;
  this->m_iAccumulatedTime = 0;
  this->m_pPedToChase = pPedToChase;
  if ( pPedToChase )
    CEntity::RegisterReference(pPedToChase, &this->m_pPedToChase);
}
// 666428: using guessed type void *off_666428;

//----- (00374AC0) --------------------------------------------------------
void __fastcall CEventPedToChase::~CEventPedToChase(CEventPedToChase *this)
{
  CPed *m_pPedToChase; // r0
  CEntity **p_m_pPedToChase; // r1

  p_m_pPedToChase = &this->m_pPedToChase;
  m_pPedToChase = this->m_pPedToChase;
  this->_vptr$CEvent = (int (**)(void))&off_666428;
  if ( m_pPedToChase )
    CEntity::CleanUpOldReference(m_pPedToChase, p_m_pPedToChase);
}
// 666428: using guessed type void *off_666428;

//----- (00374AE8) --------------------------------------------------------
void __fastcall CEventPedToChase::~CEventPedToChase(CEventPedToChase *this)
{
  CPed *m_pPedToChase; // r0
  CEntity **p_m_pPedToChase; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pPedToChase = &this->m_pPedToChase;
  m_pPedToChase = this->m_pPedToChase;
  this->_vptr$CEvent = (int (**)(void))&off_666428;
  if ( m_pPedToChase )
    CEntity::CleanUpOldReference(m_pPedToChase, p_m_pPedToChase);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666428: using guessed type void *;

//----- (00374B3C) --------------------------------------------------------
bool __fastcall CEventPedToChase::AffectsPed(const CEventPedToChase *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (00374B44) --------------------------------------------------------
void __fastcall CEventPedToFlee::CEventPedToFlee(CEventPedToFlee *this, CPed *pPedToFlee)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_666474;
  this->m_iAccumulatedTime = 0;
  this->m_pPedToFlee = pPedToFlee;
  if ( pPedToFlee )
    CEntity::RegisterReference(pPedToFlee, &this->m_pPedToFlee);
}
// 666474: using guessed type void *off_666474;

//----- (00374B78) --------------------------------------------------------
void __fastcall CEventPedToFlee::~CEventPedToFlee(CEventPedToFlee *this)
{
  CPed *m_pPedToFlee; // r0
  CEntity **p_m_pPedToFlee; // r1

  p_m_pPedToFlee = &this->m_pPedToFlee;
  m_pPedToFlee = this->m_pPedToFlee;
  this->_vptr$CEvent = (int (**)(void))&off_666474;
  if ( m_pPedToFlee )
    CEntity::CleanUpOldReference(m_pPedToFlee, p_m_pPedToFlee);
}
// 666474: using guessed type void *off_666474;

//----- (00374BA0) --------------------------------------------------------
void __fastcall CEventPedToFlee::~CEventPedToFlee(CEventPedToFlee *this)
{
  CPed *m_pPedToFlee; // r0
  CEntity **p_m_pPedToFlee; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pPedToFlee = &this->m_pPedToFlee;
  m_pPedToFlee = this->m_pPedToFlee;
  this->_vptr$CEvent = (int (**)(void))&off_666474;
  if ( m_pPedToFlee )
    CEntity::CleanUpOldReference(m_pPedToFlee, p_m_pPedToFlee);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666474: using guessed type void *;

//----- (00374BF4) --------------------------------------------------------
bool __fastcall CEventPedToFlee::AffectsPed(const CEventPedToFlee *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (00374BFC) --------------------------------------------------------
void __fastcall CEventAttractor::CEventAttractor(
        CEventAttractor *this,
        C2dEffect *pEffect,
        CEntity *pEntity,
        bool8 forceUse)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_pEffect = pEffect;
  this->m_forceUse = forceUse;
  this->_vptr$CEvent = (int (**)(void))&off_6664C0;
  this->m_pEntity = pEntity;
  if ( pEntity )
    CEntity::RegisterReference(pEntity, &this->m_pEntity);
}
// 6664C0: using guessed type void *off_6664C0;

//----- (00374C44) --------------------------------------------------------
void __fastcall CEventAttractor::~CEventAttractor(CEventAttractor *this)
{
  CEntity *m_pEntity; // r0
  CEntity **p_m_pEntity; // r1

  p_m_pEntity = &this->m_pEntity;
  m_pEntity = this->m_pEntity;
  this->_vptr$CEvent = (int (**)(void))&off_6664C0;
  if ( m_pEntity )
    CEntity::CleanUpOldReference(m_pEntity, p_m_pEntity);
}
// 6664C0: using guessed type void *;

//----- (00374C6C) --------------------------------------------------------
void __fastcall CEventAttractor::~CEventAttractor(CEventAttractor *this)
{
  CEntity *m_pEntity; // r0
  CEntity **p_m_pEntity; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pEntity = &this->m_pEntity;
  m_pEntity = this->m_pEntity;
  this->_vptr$CEvent = (int (**)(void))&off_6664C0;
  if ( m_pEntity )
    CEntity::CleanUpOldReference(m_pEntity, p_m_pEntity);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6664C0: using guessed type void *off_6664C0;

//----- (00374CC0) --------------------------------------------------------
bool __fastcall CEventAttractor::IsEffectActive(const CEntity *pEntity, const C2dEffect *pEffect)
{
  char v3; // r4
  CBaseModelInfo *v4; // r5
  int32 v5; // r6
  _BOOL4 v6; // r0

  v3 = 0;
  v4 = CModelInfo::ms_modelInfoPtrs[pEntity->m_nModelIndex];
  if ( v4->m_num2dEffects )
  {
    v5 = 0;
    do
    {
      v6 = ((unsigned int)CBaseModelInfo::Get2dEffect(v4, v5) ^ (unsigned int)pEffect | pEffect->m_type ^ 3) == 0;
      v3 |= v6;
      if ( v6 )
        break;
      ++v5;
    }
    while ( v5 < v4->m_num2dEffects );
  }
  return v3 & 1;
}

//----- (00374D1C) --------------------------------------------------------
bool __fastcall CEventAttractor::AffectsPed(const CEventAttractor *this, CPed *pPed)
{
  int v4; // r0
  bool v5; // zf
  int v6; // r6
  CBaseModelInfo *v7; // r10
  C2dEffect *m_pEffect; // r4
  int32 v9; // r5
  _BOOL4 v10; // r0
  C2dEffect *v12; // r1
  CTask *ActiveTask; // r0
  unsigned __int16 v14; // r0
  CEntity *m_pEntity; // r4
  const CMatrix *m_pMat; // r1
  int32 v17; // r5
  CVector pOffsetPos; // [sp+24h] [bp-34h] BYREF

  if ( !CPed::IsAlive(pPed) )
    goto LABEL_12;
  v4 = (*((int (__fastcall **)(const CEventAttractor *))this->_vptr$CEvent + 2))(this);
  v5 = v4 == 27;
  if ( v4 == 27 )
    v5 = this->m_pEntity == 0;
  if ( v5 )
    goto LABEL_12;
  if ( (*((int (__fastcall **)(const CEventAttractor *))this->_vptr$CEvent + 2))(this) == 27 )
  {
    v6 = 0;
    v7 = CModelInfo::ms_modelInfoPtrs[this->m_pEntity->m_nModelIndex];
    if ( !v7->m_num2dEffects )
      return v6;
    m_pEffect = this->m_pEffect;
    v9 = 0;
    do
    {
      v10 = ((unsigned int)CBaseModelInfo::Get2dEffect(v7, v9) ^ (unsigned int)m_pEffect | m_pEffect->m_type ^ 3) == 0;
      v6 |= v10;
      if ( v10 )
        break;
      ++v9;
    }
    while ( v9 < v7->m_num2dEffects );
    if ( !(v6 << 31) )
      goto LABEL_12;
  }
  if ( CPedIntelligence::FindTaskByType(pPed->m_pPedIntelligence, 1215) )
    goto LABEL_12;
  if ( pPed->m_nPedType == 6 && (*((int (__fastcall **)(const CEventAttractor *))this->_vptr$CEvent + 2))(this) == 27 )
  {
    if ( FindPlayerWanted(-1)->m_WantedLevel )
      goto LABEL_12;
    v12 = this->m_pEffect;
    if ( v12->attr.q.m_type != 5
      || !CPopulation::PedMICanBeCreatedAtThisAttractor(pPed->m_nModelIndex, v12->attr.q.m_scriptName) )
    {
      goto LABEL_12;
    }
  }
  ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  if ( ActiveTask )
  {
    if ( !this->m_forceUse && (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 233 )
      goto LABEL_12;
  }
  if ( this->m_pEffect->attr.q.m_type == 4 && CWeather::Rain < 0.2 )
    goto LABEL_12;
  if ( this->m_forceUse )
  {
LABEL_25:
    LOBYTE(v6) = 1;
    return v6;
  }
  if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) >= this->m_pEffect->attr.q.m_interest )
    goto LABEL_12;
  if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) >= this->m_pEffect->attr.q.m_lookAt )
    goto LABEL_25;
  if ( IKChainManager_c::IsLooking(&g_ikChainMan, pPed) )
  {
LABEL_12:
    LOBYTE(v6) = 0;
    return v6;
  }
  v14 = rand();
  m_pEntity = this->m_pEntity;
  m_pMat = m_pEntity->m_pMat;
  v17 = (int)(float)((float)((float)v14 * 0.000015259) * 2000.0) + 2000;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(this->m_pEntity);
    CSimpleTransform::UpdateMatrix(&m_pEntity->m_transform, m_pEntity->m_pMat);
    m_pMat = m_pEntity->m_pMat;
  }
  operator*(&pOffsetPos, m_pMat, &this->m_pEffect->m_posn);
  LOBYTE(v6) = 0;
  IKChainManager_c::LookAt(&g_ikChainMan, "CEventAttractor", pPed, 0, v17, -1, &pOffsetPos, 0, 0.25, 500, 3, 0);
  return v6;
}

//----- (00374F6C) --------------------------------------------------------
void __fastcall CEventVehicleToSteal::CEventVehicleToSteal(CEventVehicleToSteal *this, CVehicle *pVehicle)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_666510;
  this->m_iAccumulatedTime = 0;
  this->m_pVehicle = pVehicle;
  if ( pVehicle )
    CEntity::RegisterReference(pVehicle, &this->m_pVehicle);
}
// 666510: using guessed type void *off_666510;

//----- (00374FA0) --------------------------------------------------------
void __fastcall CEventVehicleToSteal::~CEventVehicleToSteal(CEventVehicleToSteal *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666510;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
}
// 666510: using guessed type void *off_666510;

//----- (00374FC8) --------------------------------------------------------
void __fastcall CEventVehicleToSteal::~CEventVehicleToSteal(CEventVehicleToSteal *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666510;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666510: using guessed type void *;

//----- (0037501C) --------------------------------------------------------
bool __fastcall CEventVehicleToSteal::AffectsPed(const CEventVehicleToSteal *this, CPed *pPed)
{
  CPlayerPed *PlayerPed; // r0
  CTask *TaskByType; // r0
  bool v6; // zf
  bool v7; // r6
  CVehicle *m_pVehicle; // r6
  int32 m_nPedType; // r0

  if ( !CPed::IsAlive(pPed) || !this->m_pVehicle )
    return 0;
  PlayerPed = FindPlayerPed(-1);
  TaskByType = CTaskManager::FindTaskByType(&PlayerPed->m_pPedIntelligence->m_taskManager, 3, 701);
  v6 = TaskByType == 0;
  if ( TaskByType )
    v6 = TaskByType[1].m_pParent == 0;
  if ( !v6 )
    return 0;
  m_pVehicle = this->m_pVehicle;
  if ( m_pVehicle == FindPlayerPed(-1)->m_pMyVehicle )
  {
    v7 = 0;
    if ( CTheScripts::IsPlayerOnAMission() || (CPad::GetPad(0)->DisablePlayerControls & 0x20) != 0 )
      return v7;
  }
  m_nPedType = pPed->m_nPedType;
  v7 = 0;
  if ( m_nPedType == 6 )
  {
    if ( this->m_pVehicle == pPed->m_pMyVehicle )
      return 1;
    return v7;
  }
  if ( m_nPedType != 20 )
    return v7;
  return pPed->m_pMyVehicle != this->m_pVehicle;
}

//----- (003750C0) --------------------------------------------------------
void __fastcall CEventAcquaintancePed::CEventAcquaintancePed(CEventAcquaintancePed *this, CPed *pAcquaintancePed)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_66655C;
  this->m_pAcquaintancePed = pAcquaintancePed;
  if ( pAcquaintancePed )
    CEntity::RegisterReference(pAcquaintancePed, &this->m_pAcquaintancePed);
}
// 66655C: using guessed type void *;

//----- (00375102) --------------------------------------------------------
bool __fastcall CEventAcquaintancePed::TakesPriorityOver(const CEventAcquaintancePed *this, const CEvent *otherEvent)
{
  int v4; // r6
  CPed *m_pAcquaintancePed; // r0
  bool IsPlayer; // r5
  int v7; // r5
  const CPed *m_iAccumulatedTime; // r0
  _BOOL4 v10; // r0

  v4 = (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent);
  if ( v4 == (*((int (__fastcall **)(const CEventAcquaintancePed *))this->_vptr$CEvent + 2))(this) )
  {
    m_pAcquaintancePed = this->m_pAcquaintancePed;
    if ( m_pAcquaintancePed )
      IsPlayer = CPed::IsPlayer(m_pAcquaintancePed);
    else
      IsPlayer = 0;
    m_iAccumulatedTime = (const CPed *)otherEvent[1].m_iAccumulatedTime;
    if ( m_iAccumulatedTime )
      v10 = !CPed::IsPlayer(m_iAccumulatedTime);
    else
      LOBYTE(v10) = 1;
    return v10 && IsPlayer;
  }
  else
  {
    v7 = (*((int (__fastcall **)(const CEventAcquaintancePed *))this->_vptr$CEvent + 3))(this);
    return v7 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
  }
}

//----- (0037516C) --------------------------------------------------------
bool __fastcall CEventAcquaintancePed::AffectsPedGroup(const CEventAcquaintancePed *this, CPedGroup *pPedGroup)
{
  CPed *m_pAcquaintancePed; // r1
  CPed *Leader; // r0
  CPlayerPed *PlayerPed; // r0
  bool result; // r0

  m_pAcquaintancePed = this->m_pAcquaintancePed;
  result = 0;
  if ( m_pAcquaintancePed
    && !CPedGroupMembership::IsMember(&pPedGroup->m_membership, m_pAcquaintancePed)
    && ((*((int (__fastcall **)(const CEventAcquaintancePed *))this->_vptr$CEvent + 2))(this) != 39
     && (*((int (__fastcall **)(const CEventAcquaintancePed *))this->_vptr$CEvent + 2))(this) != 38
     || this->m_pAcquaintancePed != pPedGroup->m_lastPedRespondedTo) )
  {
    if ( (*((int (__fastcall **)(const CEventAcquaintancePed *))this->_vptr$CEvent + 2))(this) != 39
      && (*((int (__fastcall **)(const CEventAcquaintancePed *))this->_vptr$CEvent + 2))(this) != 38 )
    {
      return 1;
    }
    if ( !CPedGroupMembership::GetLeader(&pPedGroup->m_membership)
      || (Leader = CPedGroupMembership::GetLeader(&pPedGroup->m_membership), !CPed::IsPlayer(Leader)) )
    {
      PlayerPed = FindPlayerPed(-1);
      if ( !CPedGroupMembership::IsMember(
              &CPedGroups::ms_groups[PlayerPed->m_pPlayerData->m_PlayerGroup].m_membership,
              this->m_pAcquaintancePed) )
        return 1;
    }
  }
  return result;
}

//----- (00375210) --------------------------------------------------------
bool __fastcall CEventAcquaintancePed::AffectsPed(const CEventAcquaintancePed *this, CPed *pPed)
{
  return this->m_pAcquaintancePed
      && !pPed->m_pFire
      && CPed::IsAlive(pPed)
      && CPed::IsAlive(this->m_pAcquaintancePed)
      && !CPedGroups::AreInSameGroup(pPed, this->m_pAcquaintancePed);
}

//----- (00375248) --------------------------------------------------------
bool __fastcall CEventAcquaintancePedHateBadlyLit::AffectsPed(
        const CEventAcquaintancePedHateBadlyLit *this,
        CPed *pPed)
{
  bool result; // r0
  CEvent *CurrentEvent; // r0
  CEvent *v6; // r5
  int v7; // r6
  float v8; // s0
  float32x2_t v9; // d16
  unsigned __int64 v10; // d1

  if ( !this->m_pAcquaintancePed
    || pPed->m_pFire
    || !CPed::IsAlive(pPed)
    || !CPed::IsAlive(this->m_pAcquaintancePed)
    || CPedGroups::AreInSameGroup(pPed, this->m_pAcquaintancePed) )
  {
    return 0;
  }
  CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&pPed->m_pPedIntelligence->m_eventHandler.m_history);
  v6 = CurrentEvent;
  if ( !CurrentEvent )
    return 1;
  if ( (*((int (__fastcall **)(CEvent *))CurrentEvent->_vptr$CEvent + 2))(CurrentEvent) != 63 )
    return 1;
  v7 = (*((int (__fastcall **)(CEvent *))v6->_vptr$CEvent + 11))(v6);
  if ( v7 != (*((int (__fastcall **)(const CEventAcquaintancePedHateBadlyLit *))this->_vptr$CEvent + 11))(this) )
    return 1;
  result = 0;
  if ( this->m_iTimeSpotted - *(_DWORD *)&v6[1].m_bIsPersistent >= 2000 )
  {
    v8 = this->m_vTargetPosAtSpotTime.x - *(float *)&v6[2]._vptr$CEvent;
    v9.n64_u64[0] = vsub_f32(*(float32x2_t *)&this->m_vTargetPosAtSpotTime.y, *(float32x2_t *)&v6[2].m_iAccumulatedTime).n64_u64[0];
    v10 = vmul_f32(v9, v9).n64_u64[0];
    if ( (float)((float)((float)(v8 * v8) + *(float *)&v10) + *((float *)&v10 + 1)) >= 1.0 )
      return 1;
  }
  return result;
}

//----- (00375308) --------------------------------------------------------
bool __fastcall CEventSeenCop::AffectsPed(const CEventSeenCop *this, CPed *pPed)
{
  return this->m_pAcquaintancePed
      && !pPed->m_pFire
      && CPed::IsAlive(pPed)
      && CPed::IsAlive(this->m_pAcquaintancePed)
      && !CPedGroups::AreInSameGroup(pPed, this->m_pAcquaintancePed);
}

//----- (00375340) --------------------------------------------------------
void __fastcall CEventVehicleThreat::CEventVehicleThreat(CEventVehicleThreat *this, CVehicle *pThreatVehicle)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_6665AC;
  this->m_pThreatVehicle = pThreatVehicle;
  if ( pThreatVehicle )
    CEntity::RegisterReference(pThreatVehicle, &this->m_pThreatVehicle);
}
// 6665AC: using guessed type void *;

//----- (00375380) --------------------------------------------------------
void __fastcall CEventVehicleThreat::~CEventVehicleThreat(CEventVehicleThreat *this)
{
  CVehicle *m_pThreatVehicle; // r0
  CEntity **p_m_pThreatVehicle; // r1

  p_m_pThreatVehicle = &this->m_pThreatVehicle;
  m_pThreatVehicle = this->m_pThreatVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6665AC;
  if ( m_pThreatVehicle )
    CEntity::CleanUpOldReference(m_pThreatVehicle, p_m_pThreatVehicle);
}
// 6665AC: using guessed type void *off_6665AC;

//----- (003753A8) --------------------------------------------------------
void __fastcall CEventVehicleThreat::~CEventVehicleThreat(CEventVehicleThreat *this)
{
  CVehicle *m_pThreatVehicle; // r0
  CEntity **p_m_pThreatVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pThreatVehicle = &this->m_pThreatVehicle;
  m_pThreatVehicle = this->m_pThreatVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6665AC;
  if ( m_pThreatVehicle )
    CEntity::CleanUpOldReference(m_pThreatVehicle, p_m_pThreatVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6665AC: using guessed type void *off_6665AC;

//----- (003753FC) --------------------------------------------------------
bool __fastcall CEventVehicleThreat::AffectsPed(const CEventVehicleThreat *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (00375404) --------------------------------------------------------
void __fastcall CEventKnockOffBike::CEventKnockOffBike(CEventKnockOffBike *this)
{
  int v1; // r2

  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_nDirn = 0;
  this->m_pVehicle = 0;
  *(_WORD *)&this->m_eWeaponUsed = 0;
  v1 = *((unsigned __int8 *)this + 53);
  *(_QWORD *)&this->m_fCollisionImpulse = 0LL;
  *(_QWORD *)&this->m_nDownTime = 0LL;
  *((_BYTE *)this + 53) = v1 & 0xFE;
  this->_vptr$CEvent = (int (**)(void))&off_6665FC;
}
// 6665FC: using guessed type void *;

//----- (0037543C) --------------------------------------------------------
void __fastcall CEventKnockOffBike::CEventKnockOffBike(
        CEventKnockOffBike *this,
        CVehicle *pVehicle,
        const CVector *vecSpeed,
        const CVector *vecNorm,
        float fImpulse,
        float fPedDamage,
        eWeaponType nWeaponType,
        int8 nDirn,
        const int nDownTime,
        CPed *pDraggingPed,
        const bool bWasDriver,
        const bool bForce)
{
  __int64 v13; // d16
  CPed *m_pDraggingPed; // r0
  __int64 v15; // d16
  RwReal z; // r2
  char v17; // r3

  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6665FC;
  this->m_iAccumulatedTime = 0;
  v13 = *(_QWORD *)&vecSpeed->x;
  this->m_vecColSpeed.z = vecSpeed->z;
  *(_QWORD *)&this->m_vecColSpeed.x = v13;
  m_pDraggingPed = pDraggingPed;
  v15 = *(_QWORD *)&vecNorm->x;
  z = vecNorm->z;
  this->m_pDraggingPed = pDraggingPed;
  this->m_vecColNormal.z = z;
  this->m_nDownTime = nDownTime;
  v17 = *((_BYTE *)this + 53) & 0xFC;
  this->m_fCollisionImpulse = fImpulse;
  this->m_fPedDamage = fPedDamage;
  this->m_nDirn = nDirn;
  *(_WORD *)&this->m_eWeaponUsed = (unsigned __int8)nWeaponType;
  *(_QWORD *)&this->m_vecColNormal.x = v15;
  *((_BYTE *)this + 53) = bWasDriver | (2 * bForce) | v17;
  this->m_pVehicle = pVehicle;
  if ( pVehicle )
  {
    CEntity::RegisterReference(pVehicle, &this->m_pVehicle);
    m_pDraggingPed = this->m_pDraggingPed;
  }
  if ( m_pDraggingPed )
    CEntity::RegisterReference(m_pDraggingPed, &this->m_pDraggingPed);
}
// 6665FC: using guessed type void *off_6665FC;

//----- (003754E4) --------------------------------------------------------
void __fastcall CEventKnockOffBike::CEventKnockOffBike(CEventKnockOffBike *this, const CEventKnockOffBike *src)
{
  CVehicle *m_pVehicle; // r0
  __int64 v4; // d16
  __int64 v5; // d16
  CPed *m_pDraggingPed; // r2

  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6665FC;
  this->m_iAccumulatedTime = 0;
  m_pVehicle = src->m_pVehicle;
  this->m_pVehicle = m_pVehicle;
  v4 = *(_QWORD *)&src->m_vecColSpeed.x;
  this->m_vecColSpeed.z = src->m_vecColSpeed.z;
  *(_QWORD *)&this->m_vecColSpeed.x = v4;
  v5 = *(_QWORD *)&src->m_vecColNormal.x;
  this->m_vecColNormal.z = src->m_vecColNormal.z;
  *(_QWORD *)&this->m_vecColNormal.x = v5;
  this->m_fCollisionImpulse = src->m_fCollisionImpulse;
  this->m_fPedDamage = src->m_fPedDamage;
  this->m_eWeaponUsed = src->m_eWeaponUsed;
  this->m_nDirn = src->m_nDirn;
  this->m_nDownTime = src->m_nDownTime;
  m_pDraggingPed = src->m_pDraggingPed;
  this->m_pDraggingPed = m_pDraggingPed;
  *((_BYTE *)this + 53) = *((_BYTE *)src + 53) & 1 | *((_BYTE *)this + 53) & 0xFE;
  this->m_nExitDoor = src->m_nExitDoor;
  if ( m_pVehicle )
  {
    CEntity::RegisterReference(m_pVehicle, &this->m_pVehicle);
    m_pDraggingPed = this->m_pDraggingPed;
  }
  if ( m_pDraggingPed )
    CEntity::RegisterReference(m_pDraggingPed, &this->m_pDraggingPed);
}
// 6665FC: using guessed type void *off_6665FC;

//----- (0037557C) --------------------------------------------------------
void __fastcall CEventKnockOffBike::From(CEventKnockOffBike *this, const CEventKnockOffBike *src)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r3
  __int64 v5; // d16
  __int64 v6; // d16
  CPed *m_pDraggingPed; // r2
  CEntity **v8; // r4

  m_pVehicle = src->m_pVehicle;
  this->m_pVehicle = m_pVehicle;
  p_m_pVehicle = &this->m_pVehicle;
  v5 = *(_QWORD *)&src->m_vecColSpeed.x;
  *(p_m_pVehicle - 9) = (CEntity *)LODWORD(src->m_vecColSpeed.z);
  *(_QWORD *)(p_m_pVehicle - 11) = v5;
  v6 = *(_QWORD *)&src->m_vecColNormal.x;
  *(p_m_pVehicle - 6) = (CEntity *)LODWORD(src->m_vecColNormal.z);
  *((_QWORD *)p_m_pVehicle - 4) = v6;
  *(p_m_pVehicle - 5) = (CEntity *)LODWORD(src->m_fCollisionImpulse);
  *(p_m_pVehicle - 4) = (CEntity *)LODWORD(src->m_fPedDamage);
  *((_BYTE *)p_m_pVehicle - 2) = src->m_eWeaponUsed;
  *((_BYTE *)p_m_pVehicle - 4) = src->m_nDirn;
  *(p_m_pVehicle - 3) = (CEntity *)src->m_nDownTime;
  m_pDraggingPed = src->m_pDraggingPed;
  *(p_m_pVehicle - 2) = m_pDraggingPed;
  *((_BYTE *)p_m_pVehicle - 3) = *((_BYTE *)src + 53) & 1 | *((_BYTE *)p_m_pVehicle - 3) & 0xFE;
  v8 = p_m_pVehicle - 2;
  *((_BYTE *)p_m_pVehicle - 1) = src->m_nExitDoor;
  if ( m_pVehicle )
  {
    CEntity::RegisterReference(m_pVehicle, p_m_pVehicle);
    m_pDraggingPed = (CPed *)*v8;
  }
  if ( m_pDraggingPed )
    sub_196050(m_pDraggingPed, v8);
}

//----- (0037560E) --------------------------------------------------------
CEventKnockOffBike *__fastcall CEventKnockOffBike::operator=(CEventKnockOffBike *this, const CEventKnockOffBike *src)
{
  CVehicle *m_pVehicle; // r0
  __int64 v4; // d16
  __int64 v5; // d16
  CPed *m_pDraggingPed; // r2

  m_pVehicle = src->m_pVehicle;
  this->m_pVehicle = m_pVehicle;
  v4 = *(_QWORD *)&src->m_vecColSpeed.x;
  this->m_vecColSpeed.z = src->m_vecColSpeed.z;
  *(_QWORD *)&this->m_vecColSpeed.x = v4;
  v5 = *(_QWORD *)&src->m_vecColNormal.x;
  this->m_vecColNormal.z = src->m_vecColNormal.z;
  *(_QWORD *)&this->m_vecColNormal.x = v5;
  this->m_fCollisionImpulse = src->m_fCollisionImpulse;
  this->m_fPedDamage = src->m_fPedDamage;
  this->m_eWeaponUsed = src->m_eWeaponUsed;
  this->m_nDirn = src->m_nDirn;
  this->m_nDownTime = src->m_nDownTime;
  m_pDraggingPed = src->m_pDraggingPed;
  this->m_pDraggingPed = m_pDraggingPed;
  *((_BYTE *)this + 53) = *((_BYTE *)this + 53) & 0xFE | *((_BYTE *)src + 53) & 1;
  this->m_nExitDoor = src->m_nExitDoor;
  if ( m_pVehicle )
  {
    CEntity::RegisterReference(m_pVehicle, &this->m_pVehicle);
    m_pDraggingPed = this->m_pDraggingPed;
  }
  if ( m_pDraggingPed )
    CEntity::RegisterReference(m_pDraggingPed, &this->m_pDraggingPed);
  return this;
}

//----- (003756A8) --------------------------------------------------------
void __fastcall CEventKnockOffBike::~CEventKnockOffBike(CEventKnockOffBike *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CPed *m_pDraggingPed; // r0

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6665FC;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  m_pDraggingPed = this->m_pDraggingPed;
  if ( m_pDraggingPed )
    CEntity::CleanUpOldReference(m_pDraggingPed, &this->m_pDraggingPed);
}
// 6665FC: using guessed type void *off_6665FC;

//----- (003756DC) --------------------------------------------------------
void __fastcall CEventKnockOffBike::~CEventKnockOffBike(CEventKnockOffBike *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CPed *m_pDraggingPed; // r0
  CEventPool *v5; // r0
  int v6; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6665FC;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  m_pDraggingPed = this->m_pDraggingPed;
  if ( m_pDraggingPed )
    CEntity::CleanUpOldReference(m_pDraggingPed, &this->m_pDraggingPed);
  v5 = CPools::ms_pEventPool;
  v6 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v6] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v6 < v5->m_nFreeIndex )
    v5->m_nFreeIndex = v6;
}
// 6665FC: using guessed type void *off_6665FC;

//----- (0037573C) --------------------------------------------------------
bool __fastcall CEventKnockOffBike::AffectsPed(const CEventKnockOffBike *this, CPed *pPed)
{
  CVehicle *m_pVehicle; // r1
  bool result; // r0
  CPed *v6; // r0
  bool v7; // zf

  if ( !CPed::IsAlive(pPed) )
    return 0;
  m_pVehicle = this->m_pVehicle;
  if ( m_pVehicle )
  {
    if ( (*(_BYTE *)&m_pVehicle->m_info & 0xF8) == 96 )
      return 0;
  }
  if ( (*((_DWORD *)&pPed->m_nPedFlags + 2) & 0x18000000) != 0x8000000 )
  {
    if ( !m_pVehicle )
      return 0;
  }
  else
  {
    result = 0;
    if ( (*((_BYTE *)this + 53) & 2) == 0 || !m_pVehicle )
      return result;
  }
  if ( m_pVehicle->pDriver == pPed )
  {
    *((_BYTE *)this + 53) |= 1u;
  }
  else if ( m_pVehicle->pPassengers[0] != pPed )
  {
    v6 = m_pVehicle->pPassengers[1];
    v7 = v6 == pPed;
    if ( v6 != pPed )
      v7 = m_pVehicle->pPassengers[2] == pPed;
    if ( !v7 )
      return 0;
  }
  return 1;
}

//----- (003757BE) --------------------------------------------------------
void __fastcall CEventKnockOffBike::SetPedOutCar(CEventKnockOffBike *this, CPed *pPed)
{
  CVehicle *m_pVehicle; // r1
  int v4; // r2
  CTaskSimpleCarSetPedOut v5; // [sp+0h] [bp-28h] BYREF

  m_pVehicle = this->m_pVehicle;
  v4 = 10;
  this->m_nExitDoor = 10;
  if ( m_pVehicle->pDriver == pPed )
    goto LABEL_10;
  if ( m_pVehicle->m_baseVehicleType == 9 )
    goto LABEL_3;
  if ( m_pVehicle->pPassengers[0] == pPed )
  {
    v4 = 8;
    goto LABEL_10;
  }
  if ( m_pVehicle->pPassengers[1] == pPed )
  {
LABEL_3:
    v4 = 11;
LABEL_10:
    this->m_nExitDoor = v4;
    goto LABEL_11;
  }
  if ( m_pVehicle->pPassengers[2] == pPed )
  {
    v4 = 9;
    goto LABEL_10;
  }
  v4 = 10;
LABEL_11:
  CTaskSimpleCarSetPedOut::CTaskSimpleCarSetPedOut(&v5, m_pVehicle, v4, 1);
  v5.m_bSwitchOffEngine = 0;
  v5.m_bKnockedOffBike = 1;
  CTaskSimpleCarSetPedOut::ProcessPed(&v5, pPed);
  CCarEnterExit::RemoveCarSitAnim(pPed);
  CTaskSimpleCarSetPedOut::~CTaskSimpleCarSetPedOut(&v5);
}

//----- (00375840) --------------------------------------------------------
AnimationId __fastcall CEventKnockOffBike::CalcForcesAndAnims(CEventKnockOffBike *this, CPed *pPed)
{
  CVehicle *m_pVehicle; // r0
  float m_fMass; // s0
  int32 m_baseVehicleType; // r1
  unsigned __int8 *p_SoundPtr; // r1
  int v8; // r6
  float v9; // s16
  __int64 v10; // d16
  float v11; // s0
  int32 m_vehicleType; // r6
  int v13; // r0
  float v14; // s0
  unsigned int m_nDirn; // r0
  AnimationId v16; // r5
  __int64 v17; // d16
  CVehicle *v18; // r0
  int v19; // r1
  float *p_xx; // r0
  float x; // s2
  RwReal v22; // s4
  CVehicle *v23; // r0
  __int64 v24; // d16
  float v25; // s18
  float y; // s20
  float m_fCollisionImpulse; // s22
  int v28; // r0
  float v29; // s2
  unsigned int v30; // r0
  float v31; // s0
  float v32; // s2
  float z; // s4
  CMatrix *v34; // r0
  float v35; // s0
  float v36; // s2
  float v37; // s4
  CMatrix *v38; // r0
  CVector *p_m_vecMoveSpeed; // r0
  __int64 v40; // d16
  CMatrix *m_pMat; // r0
  CVector *v42; // r0
  __int64 v43; // d16
  CMatrix *v44; // r0
  CVector v46; // 0:r1.12
  CVector v47; // 0:r1.12
  CVector v48; // 0:r1.12
  CVector v49; // 0:r1.12
  CVector v50; // 0:r1.12
  CVector v51; // 0:r1.12
  CVector v52; // 0:r1.12

  m_pVehicle = this->m_pVehicle;
  m_fMass = pPed->m_fMass;
  m_baseVehicleType = m_pVehicle->m_baseVehicleType;
  if ( m_baseVehicleType )
  {
    if ( m_baseVehicleType != 9 )
    {
      v8 = 0;
      goto LABEL_7;
    }
    p_SoundPtr = (unsigned __int8 *)&m_pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[8].SoundPtr;
  }
  else
  {
    p_SoundPtr = (unsigned __int8 *)&m_pVehicle[1].AutoPilot.TempActionFinish;
  }
  v8 = *p_SoundPtr;
LABEL_7:
  v9 = m_fMass / m_pVehicle->m_fMass;
  switch ( this->m_eWeaponUsed )
  {
    case '1':
      v10 = *(_QWORD *)&this->m_vecColSpeed.x;
      LODWORD(v46.x) = dword_375D0C;
      v46.z = 0.0;
      pPed->m_vecMoveSpeed.z = this->m_vecColSpeed.z;
      *(_QWORD *)&pPed->m_vecMoveSpeed.x = v10;
      if ( this->m_pVehicle->m_vehicleType == 10 )
        LODWORD(v46.x) = &dword_375D0C[1];
      v11 = this->m_fCollisionImpulse * (float)(v9 * *(float *)LODWORD(v46.x));
      v46.x = this->m_vecColNormal.x * v11;
      v46.y = this->m_vecColNormal.y * v11;
      CPhysical::ApplyMoveForce(pPed, v46);
      m_vehicleType = this->m_pVehicle->m_vehicleType;
      v13 = rand();
      v14 = 2.0;
      if ( m_vehicleType == 10 )
        v14 = 3.0;
      pPed->m_vecMoveSpeed.z = pPed->m_vecMoveSpeed.z
                             + (float)((float)((float)(v14 * (float)((float)v13 * 4.6566e-10)) + 3.0) / 70.0);
      pPed->m_pNOCollisionVehicle = this->m_pVehicle;
      m_nDirn = this->m_nDirn;
      if ( m_nDirn > 3 )
        v16 = ANIM_STD_KO_FRONT;
      else
        v16 = dword_375D18[m_nDirn];
      *((_DWORD *)&pPed->m_nPedFlags + 1) |= 0x80000000;
      CPed::IsPlayer(pPed);
      return v16;
    case '2':
    case '3':
    case '4':
      goto LABEL_18;
    case '5':
      x = m_pVehicle->m_vecMoveSpeed.x;
      v22 = m_pVehicle->m_vecMoveSpeed.y * 0.2;
      pPed->m_vecMoveSpeed.z = 0.0;
      pPed->m_vecMoveSpeed.x = x * 0.2;
      pPed->m_vecMoveSpeed.y = v22;
      v23 = this->m_pVehicle;
      v16 = ANIM_STD_FALL;
      pPed->m_pNOCollisionVehicle = v23;
      return v16;
    case '6':
      v24 = *(_QWORD *)&this->m_vecColSpeed.x;
      pPed->m_vecMoveSpeed.z = this->m_vecColSpeed.z;
      *(_QWORD *)&pPed->m_vecMoveSpeed.x = v24;
      v25 = this->m_vecColNormal.x;
      y = this->m_vecColNormal.y;
      m_fCollisionImpulse = this->m_fCollisionImpulse;
      v28 = rand();
      v29 = (float)(v9 * -0.3) * m_fCollisionImpulse;
      v48.x = v29 * v25;
      v48.y = v29 * y;
      v48.z = (float)((float)((float)v28 * 4.6566e-10) + (float)((float)v28 * 4.6566e-10)) + 3.0;
      CPhysical::ApplyMoveForce(pPed, v48);
      pPed->m_pNOCollisionVehicle = this->m_pVehicle;
      v30 = this->m_nDirn;
      if ( v30 > 3 )
        v16 = ANIM_STD_KO_FRONT;
      else
        v16 = dword_375D2C[v30];
      if ( !v8 )
        *((_DWORD *)&pPed->m_nPedFlags + 1) |= 0x80000000;
      return v16;
    case '7':
      goto LABEL_17;
    default:
      if ( this->m_eWeaponUsed )
      {
LABEL_18:
        v19 = this->m_nDirn;
        if ( (unsigned int)(v19 - 1) < 2 )
        {
          v31 = m_pVehicle->m_vecMoveSpeed.x;
          v32 = m_pVehicle->m_vecMoveSpeed.y;
          z = m_pVehicle->m_vecMoveSpeed.z;
          if ( (float)((float)((float)(v31 * v31) + (float)(v32 * v32)) + (float)(z * z)) <= 0.09 )
          {
            p_m_vecMoveSpeed = &m_pVehicle->m_vecMoveSpeed;
            v40 = *(_QWORD *)&p_m_vecMoveSpeed->x;
            pPed->m_vecMoveSpeed.z = p_m_vecMoveSpeed->z;
            *(_QWORD *)&pPed->m_vecMoveSpeed.x = v40;
            m_pMat = this->m_pVehicle->m_pMat;
            v51.x = (float)(m_pMat->xx * 8.0) + (float)(m_pMat->xz * 4.0);
            v51.y = (float)(m_pMat->yx * 8.0) + (float)(m_pMat->yz * 4.0);
            v51.z = (float)(m_pMat->zx * 8.0) + (float)(m_pMat->zz * 4.0);
            CPhysical::ApplyMoveForce(pPed, v51);
            return 22;
          }
          else
          {
            pPed->m_vecMoveSpeed.x = v31 * 0.3;
            pPed->m_vecMoveSpeed.y = v32 * 0.3;
            pPed->m_vecMoveSpeed.z = z * 0.3;
            v34 = this->m_pVehicle->m_pMat;
            v49.x = (float)(v34->xx * 6.0) + (float)(v34->xz * 5.0);
            v49.y = (float)(v34->yx * 6.0) + (float)(v34->yz * 5.0);
            v49.z = (float)(v34->zx * 6.0) + (float)(v34->zz * 5.0);
            CPhysical::ApplyMoveForce(pPed, v49);
            return 25;
          }
        }
        else if ( v19 == 3 )
        {
          v35 = m_pVehicle->m_vecMoveSpeed.x;
          v36 = m_pVehicle->m_vecMoveSpeed.y;
          v37 = m_pVehicle->m_vecMoveSpeed.z;
          if ( (float)((float)((float)(v35 * v35) + (float)(v36 * v36)) + (float)(v37 * v37)) <= 0.09 )
          {
            v42 = &m_pVehicle->m_vecMoveSpeed;
            v43 = *(_QWORD *)&v42->x;
            pPed->m_vecMoveSpeed.z = v42->z;
            *(_QWORD *)&pPed->m_vecMoveSpeed.x = v43;
            v44 = this->m_pVehicle->m_pMat;
            v52.x = (float)(v44->xz * 4.0) - (float)(v44->xx * 8.0);
            v52.y = (float)(v44->yz * 4.0) - (float)(v44->yx * 8.0);
            v52.z = (float)(v44->zz * 4.0) - (float)(v44->zx * 8.0);
            CPhysical::ApplyMoveForce(pPed, v52);
            return 23;
          }
          else
          {
            pPed->m_vecMoveSpeed.x = v35 * 0.3;
            pPed->m_vecMoveSpeed.y = v36 * 0.3;
            pPed->m_vecMoveSpeed.z = v37 * 0.3;
            v38 = this->m_pVehicle->m_pMat;
            v50.x = (float)(v38->xz * 5.0) - (float)(v38->xx * 6.0);
            v50.y = (float)(v38->yz * 5.0) - (float)(v38->yx * 6.0);
            v50.z = (float)(v38->zz * 5.0) - (float)(v38->zx * 6.0);
            CPhysical::ApplyMoveForce(pPed, v50);
            return 27;
          }
        }
        else if ( this->m_nDirn )
        {
          return 15;
        }
        else
        {
          if ( (float)((float)((float)(m_pVehicle->m_vecMoveSpeed.x * m_pVehicle->m_vecMoveSpeed.x)
                             + (float)(m_pVehicle->m_vecMoveSpeed.y * m_pVehicle->m_vecMoveSpeed.y))
                     + (float)(m_pVehicle->m_vecMoveSpeed.z * m_pVehicle->m_vecMoveSpeed.z)) < 0.09 )
          {
            p_xx = &m_pVehicle->m_pMat->xx;
            v47.x = (float)(p_xx[8] * 5.0) - (float)(p_xx[4] * 6.0);
            v47.y = (float)(p_xx[9] * 5.0) - (float)(p_xx[5] * 6.0);
            v47.z = (float)(p_xx[10] * 5.0) - (float)(p_xx[6] * 6.0);
            CPhysical::ApplyMoveForce(pPed, v47);
            m_pVehicle = this->m_pVehicle;
          }
          pPed->m_pNOCollisionVehicle = m_pVehicle;
          return 106;
        }
      }
      else
      {
LABEL_17:
        v17 = *(_QWORD *)&this->m_vecColSpeed.x;
        pPed->m_vecMoveSpeed.z = this->m_vecColSpeed.z;
        *(_QWORD *)&pPed->m_vecMoveSpeed.x = v17;
        v18 = this->m_pVehicle;
        v16 = ANIM_STD_NUM;
        pPed->m_pNOCollisionVehicle = v18;
      }
      return v16;
  }
}
// 375D0C: using guessed type int dword_375D0C[2];
// 375D18: using guessed type int dword_375D18[4];
// 375D2C: using guessed type int dword_375D2C[4];

//----- (00375D44) --------------------------------------------------------
bool __fastcall CEventKnockOffBike::SetPedSafePosition(CEventKnockOffBike *this, CPed *pPed)
{
  CVehicle *m_pVehicle; // r0
  CMatrix *m_pMat; // r1
  float zz; // s16
  float m_heading; // s0
  CMatrix *v8; // r0
  CVehicle *v9; // r1
  int32 m_baseVehicleType; // r0
  bool v11; // zf
  CMatrix *v12; // r0
  float *p_xx; // r1
  float xy; // s0
  float yy; // s2
  float zy; // s4
  CSimpleTransform *p_tx; // r2
  float v18; // s6
  float v19; // s2
  float v20; // s4
  float v21; // s6
  float v22; // s2
  float v23; // s0
  float v24; // s4
  float *p_tz; // r0
  bool v26; // r6
  CSimpleTransform *p_m_transform; // r9
  int (**v28)(void); // r0
  CMatrix *v29; // r2
  int (*v30)(void); // r3
  CSimpleTransform *v31; // r0
  __int64 v32; // kr00_8
  CVehicle *v33; // r2
  CMatrix *v34; // r0
  CMatrix *v35; // r3
  CSimpleTransform *v36; // r1
  const CVector *p_m_translate; // r0
  CVehicle *v38; // r1
  CMatrix *v39; // r0
  CMatrix *v40; // r2
  const CVector *v41; // r0
  CMatrix *v42; // r0
  float *v43; // r0
  CVehicle *v44; // r2
  CMatrix *v45; // r0
  CMatrix *v46; // r3
  CSimpleTransform *v47; // r1
  const CVector *v48; // r0
  CMatrix *v49; // r0
  float *p_z; // r0
  CVehicle *v51; // r1
  CMatrix *v52; // r0
  CMatrix *v53; // r2
  const CVector *v54; // r0
  CPedFlags *p_m_nPedFlags; // r5
  CPhysical *m_pGroundPhysical; // r0
  int m_nPedFlags; // r1
  unsigned int v58; // r6
  __int64 v59; // r2
  CEntity **p_m_pGroundPhysical; // r4
  bool result; // r0
  RwReal z; // [sp+14h] [bp-2Ch]

  m_pVehicle = this->m_pVehicle;
  if ( m_pVehicle->m_baseVehicleType == 9 )
  {
    m_pVehicle[1].m_vecCOM.x = 0.0;
    LOBYTE(this->m_pVehicle[1].pReferences) = 0;
    CPed::SetPedPositionInCar(pPed);
    m_pVehicle = this->m_pVehicle;
  }
  m_pMat = m_pVehicle->m_pMat;
  zz = m_pMat->zz;
  if ( m_pMat )
    m_heading = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
  else
    m_heading = m_pVehicle->m_transform.m_heading;
  if ( zz < 0.0 )
    m_heading = CGeneral::LimitRadianAngle(m_heading + 3.1416);
  v8 = pPed->m_pMat;
  pPed->m_fCurrentHeading = m_heading;
  pPed->m_fDesiredHeading = m_heading;
  if ( v8 )
    CMatrix::SetRotateZOnly(v8, m_heading);
  else
    pPed->m_transform.m_heading = m_heading;
  v9 = this->m_pVehicle;
  m_baseVehicleType = v9->m_baseVehicleType;
  v11 = m_baseVehicleType == 9;
  if ( m_baseVehicleType == 9 )
    v11 = *((unsigned __int8 *)this + 53) << 31 == 0;
  if ( v11 )
  {
    v12 = pPed->m_pMat;
    p_xx = &v9->m_pMat->xx;
    xy = v12->xy;
    yy = v12->yy;
    zy = v12->zy;
    p_tx = (CSimpleTransform *)&v12->tx;
    if ( !v12 )
      p_tx = &pPed->m_transform;
    v18 = (float)(1.0 - fabsf((float)((float)(p_xx[4] * xy) + (float)(p_xx[5] * yy)) + (float)(p_xx[6] * zy))) * 0.8;
    v19 = yy * v18;
    v20 = zy * v18;
    v21 = xy * v18;
    v22 = p_tx->m_translate.y - v19;
    v23 = p_tx->m_translate.z - v20;
    v24 = p_tx->m_translate.x - v21;
    if ( v12 )
    {
      v12->tx = v24;
      pPed->m_pMat->ty = v22;
      p_tz = &pPed->m_pMat->tz;
    }
    else
    {
      p_tz = &pPed->m_transform.m_translate.z;
      pPed->m_transform.m_translate.x = v24;
      pPed->m_transform.m_translate.y = v22;
    }
    *p_tz = v23;
  }
  v26 = pPed->m_nHealth <= 0.0 || this->m_pDraggingPed;
  p_m_transform = &pPed->m_transform;
  CWorld::pIgnoreEntity = this->m_pVehicle;
  v28 = pPed->_vptr$CPlaceable;
  v29 = pPed->m_pMat;
  pPed->m_pNOCollisionVehicle = CWorld::pIgnoreEntity;
  v30 = v28[14];
  v31 = &pPed->m_transform;
  if ( v29 )
    v31 = (CSimpleTransform *)&v29->tx;
  v32 = *(_QWORD *)&v31->m_translate.x;
  z = v31->m_translate.z;
  if ( ((int (__fastcall *)(CPed *, _DWORD))v30)(pPed, 0) )
    goto LABEL_41;
  v33 = this->m_pVehicle;
  v34 = pPed->m_pMat;
  v35 = v33->m_pMat;
  v36 = &pPed->m_transform;
  if ( v34 )
    v36 = (CSimpleTransform *)&v34->tx;
  p_m_translate = (const CVector *)&v35->tx;
  if ( !v35 )
    p_m_translate = &v33->m_transform.m_translate;
  if ( !CWorld::GetIsLineOfSightClear(p_m_translate, &v36->m_translate, 1, 0, 0, 1, 0, 0, 0) )
  {
LABEL_41:
    pPed->m_pMat->tz = pPed->m_pMat->tz + 0.6;
    if ( (*((int (__fastcall **)(CPed *, _DWORD))pPed->_vptr$CPlaceable + 14))(pPed, 0) )
      goto LABEL_56;
    v44 = this->m_pVehicle;
    v45 = pPed->m_pMat;
    v46 = v44->m_pMat;
    v47 = &pPed->m_transform;
    if ( v45 )
      v47 = (CSimpleTransform *)&v45->tx;
    v48 = (const CVector *)&v46->tx;
    if ( !v46 )
      v48 = &v44->m_transform.m_translate;
    if ( !CWorld::GetIsLineOfSightClear(v48, &v47->m_translate, 1, 0, 0, 1, 0, 0, 0) )
    {
LABEL_56:
      v49 = pPed->m_pMat;
      if ( v49 )
      {
        LODWORD(v49->tx) = v32;
        pPed->m_pMat->ty = *((float *)&v32 + 1);
        p_z = &pPed->m_pMat->tz;
      }
      else
      {
        p_z = &pPed->m_transform.m_translate.z;
        *(_QWORD *)&pPed->m_transform.m_translate.x = v32;
      }
      *p_z = z;
      pPed->m_pMat->tz = pPed->m_pMat->tz + -0.6;
      if ( (*((int (__fastcall **)(CPed *, _DWORD))pPed->_vptr$CPlaceable + 14))(pPed, 0) )
        goto LABEL_68;
      v51 = this->m_pVehicle;
      v52 = pPed->m_pMat;
      v53 = v51->m_pMat;
      if ( v52 )
        p_m_transform = (CSimpleTransform *)&v52->tx;
      v54 = (const CVector *)&v53->tx;
      if ( !v53 )
        v54 = &v51->m_transform.m_translate;
      if ( !CWorld::GetIsLineOfSightClear(v54, &p_m_transform->m_translate, 1, 0, 0, 1, 0, 0, 0) )
      {
LABEL_68:
        if ( !CPed::PositionPedOutOfCollision(pPed, this->m_nExitDoor, this->m_pVehicle, v26) )
        {
          result = 0;
          goto LABEL_62;
        }
      }
    }
    pPed->m_pNOCollisionVehicle = this->m_pVehicle;
  }
  else if ( this->m_eWeaponUsed == 49 )
  {
    pPed->m_pMat->tz = pPed->m_pMat->tz + 0.5;
    if ( (*((int (__fastcall **)(CPed *, _DWORD))pPed->_vptr$CPlaceable + 14))(pPed, 0) )
      goto LABEL_39;
    v38 = this->m_pVehicle;
    v39 = pPed->m_pMat;
    v40 = v38->m_pMat;
    if ( v39 )
      p_m_transform = (CSimpleTransform *)&v39->tx;
    v41 = (const CVector *)&v40->tx;
    if ( !v40 )
      v41 = &v38->m_transform.m_translate;
    if ( !CWorld::GetIsLineOfSightClear(v41, &p_m_transform->m_translate, 1, 0, 0, 1, 0, 0, 0) )
    {
LABEL_39:
      v42 = pPed->m_pMat;
      if ( v42 )
      {
        LODWORD(v42->tx) = v32;
        pPed->m_pMat->ty = *((float *)&v32 + 1);
        v43 = &pPed->m_pMat->tz;
      }
      else
      {
        v43 = &pPed->m_transform.m_translate.z;
        *(_QWORD *)&pPed->m_transform.m_translate.x = v32;
      }
      *v43 = z;
    }
  }
  p_m_nPedFlags = &pPed->m_nPedFlags;
  m_pGroundPhysical = pPed->m_pGroundPhysical;
  m_nPedFlags = (int)pPed->m_nPedFlags;
  v58 = *((_DWORD *)&pPed->m_nPedFlags + 1) | 0x80000000;
  v59 = *((_QWORD *)&pPed->m_nPedFlags + 1);
  *((_DWORD *)&pPed->m_nPedFlags + 1) = v58;
  if ( m_pGroundPhysical )
  {
    p_m_pGroundPhysical = &pPed->m_pGroundPhysical;
    CEntity::CleanUpOldReference(m_pGroundPhysical, p_m_pGroundPhysical);
    *p_m_pGroundPhysical = 0;
    v58 = *((_DWORD *)p_m_nPedFlags + 1);
    m_nPedFlags = *(_DWORD *)p_m_nPedFlags;
    v59 = *((_QWORD *)p_m_nPedFlags + 1);
  }
  *(_DWORD *)p_m_nPedFlags = m_nPedFlags & 0xFFFFFFFC;
  *((_DWORD *)p_m_nPedFlags + 1) = v58;
  result = 1;
  *((_QWORD *)p_m_nPedFlags + 1) = v59;
LABEL_62:
  CWorld::pIgnoreEntity = 0;
  return result;
}

//----- (003760F4) --------------------------------------------------------
bool __fastcall CEventKnockOffBike::IsCriminalEvent(const CEventKnockOffBike *this)
{
  return 1;
}

//----- (003760F8) --------------------------------------------------------
void __fastcall CEventKnockOffBike::ReportCriminalEvent(const CEventKnockOffBike *this, CPed *pPed)
{
  int v4; // r0
  bool v5; // zf
  CPed *m_pDraggingPed; // r0
  CWanted *PlayerWanted; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2

  v4 = (*((int (__fastcall **)(const CEventKnockOffBike *))this->_vptr$CEvent + 8))(this);
  v5 = v4 == 1;
  if ( v4 == 1 )
    v5 = pPed->m_nPedType == 6;
  if ( v5 )
  {
    m_pDraggingPed = this->m_pDraggingPed;
    if ( m_pDraggingPed )
    {
      if ( CPed::IsPlayer(m_pDraggingPed) )
      {
        PlayerWanted = FindPlayerWanted(-1);
        m_pMat = pPed->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pPed->m_transform;
        CWanted::RegisterCrime(PlayerWanted, CRIME_SHOOT_COP, &p_tx->m_translate, (u_native)pPed, 0);
      }
    }
  }
}

//----- (0037614C) --------------------------------------------------------
void __fastcall CEventGunAimedAt::CEventGunAimedAt(CEventGunAimedAt *this, CPed *pAggressorPed)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666648;
  this->m_pAggressorPed = pAggressorPed;
  if ( pAggressorPed )
    CEntity::RegisterReference(pAggressorPed, &this->m_pAggressorPed);
}
// 666648: using guessed type void *off_666648;

//----- (0037618C) --------------------------------------------------------
void __fastcall CEventGunAimedAt::~CEventGunAimedAt(CEventGunAimedAt *this)
{
  CPed *m_pAggressorPed; // r0
  CEntity **p_m_pAggressorPed; // r1

  p_m_pAggressorPed = &this->m_pAggressorPed;
  m_pAggressorPed = this->m_pAggressorPed;
  this->_vptr$CEvent = (int (**)(void))&off_666648;
  if ( m_pAggressorPed )
    CEntity::CleanUpOldReference(m_pAggressorPed, p_m_pAggressorPed);
}
// 666648: using guessed type void *;

//----- (003761B4) --------------------------------------------------------
void __fastcall CEventGunAimedAt::~CEventGunAimedAt(CEventGunAimedAt *this)
{
  CPed *m_pAggressorPed; // r0
  CEntity **p_m_pAggressorPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pAggressorPed = &this->m_pAggressorPed;
  m_pAggressorPed = this->m_pAggressorPed;
  this->_vptr$CEvent = (int (**)(void))&off_666648;
  if ( m_pAggressorPed )
    CEntity::CleanUpOldReference(m_pAggressorPed, p_m_pAggressorPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666648: using guessed type void *off_666648;

//----- (00376208) --------------------------------------------------------
bool __fastcall CEventGunAimedAt::TakesPriorityOver(const CEventGunAimedAt *this, const CEvent *otherEvent)
{
  CPed *m_pAggressorPed; // r0
  int v5; // r0
  char v6; // r1
  bool result; // r0
  int v8; // r5

  m_pAggressorPed = this->m_pAggressorPed;
  if ( !m_pAggressorPed
    || !CPed::IsPlayer(m_pAggressorPed)
    || (CPed *)(*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 11))(otherEvent) == this->m_pAggressorPed
    || (v5 = (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent),
        v6 = v5 - 9,
        (unsigned int)(v5 - 9) > 0x1E)
    || (result = 1, ((1 << v6) & 0x48000001) == 0) )
  {
    v8 = (*((int (__fastcall **)(const CEventGunAimedAt *))this->_vptr$CEvent + 3))(this);
    return v8 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
  }
  return result;
}

//----- (0037626A) --------------------------------------------------------
bool __fastcall CEventGunAimedAt::AffectsPed(const CEventGunAimedAt *this, CPed *pPed)
{
  CTask *ActiveTask; // r0
  CPed *m_pAggressorPed; // r2
  CMatrix *m_pMat; // r3
  const CVector *p_tx; // r1
  bool v9; // zf
  CVehicle *m_pMyVehicle; // r0
  CPlayerPed *PlayerPed; // r0

  if ( CPed::IsPlayer(pPed) )
    return 0;
  if ( CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager) )
  {
    ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
    if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 601 )
      return 0;
  }
  m_pAggressorPed = this->m_pAggressorPed;
  if ( !m_pAggressorPed )
    return 0;
  m_pMat = m_pAggressorPed->m_pMat;
  p_tx = (const CVector *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pAggressorPed->m_transform.m_translate;
  if ( !CPedIntelligence::IsInSeeingRange(pPed->m_pPedIntelligence, p_tx)
    || !CPed::IsAlive(pPed)
    || CPedGroups::AreInSameGroup(pPed, this->m_pAggressorPed) )
  {
    return 0;
  }
  m_pMyVehicle = (CVehicle *)(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31);
  v9 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    v9 = m_pMyVehicle == 0;
  }
  if ( !v9 && CVehicle::IsPassenger(m_pMyVehicle, pPed) && pPed->m_pMyVehicle->pDriver )
    return 0;
  if ( pPed->m_nPedType == 6 )
  {
    PlayerPed = FindPlayerPed(-1);
    CCrime::ReportCrime(CRIME_TARGET_COP, pPed, PlayerPed);
  }
  return 1;
}

//----- (00376318) --------------------------------------------------------
void __fastcall CEventGunAimedAt::AddGunAimedAtEventToVehicleOccupants(const CVehicle *vehicle, CPed *pAggressorPed)
{
  int m_nMaxPassengers; // r0
  CPed **pPassengers; // r4
  int v6; // r9
  CPed *v7; // r1
  CPed *pDriver; // r0
  CEvent v9; // [sp+0h] [bp-30h] BYREF
  __int16 v10; // [sp+Ch] [bp-24h]
  CEntity *v11[8]; // [sp+10h] [bp-20h] BYREF

  m_nMaxPassengers = vehicle->m_nMaxPassengers;
  if ( m_nMaxPassengers )
  {
    pPassengers = vehicle->pPassengers;
    v6 = 0;
    do
    {
      v7 = pPassengers[v6];
      if ( v7 )
      {
        v9.m_iAccumulatedTime = 0;
        *(_DWORD *)&v9.m_bIsPersistent = 13107456;
        v10 = -1;
        v11[0] = pAggressorPed;
        v9._vptr$CEvent = (int (**)(void))&off_666648;
        if ( pAggressorPed )
        {
          CEntity::RegisterReference(pAggressorPed, v11);
          v7 = pPassengers[v6];
        }
        CEventGroup::Add(&v7->m_pPedIntelligence->m_eventGroup, &v9, 0);
        v9._vptr$CEvent = (int (**)(void))&off_666648;
        if ( v11[0] )
          CEntity::CleanUpOldReference(v11[0], v11);
        LOBYTE(m_nMaxPassengers) = vehicle->m_nMaxPassengers;
      }
      ++v6;
    }
    while ( v6 < (unsigned __int8)m_nMaxPassengers );
  }
  pDriver = vehicle->pDriver;
  if ( pDriver )
  {
    v9.m_iAccumulatedTime = 0;
    *(_DWORD *)&v9.m_bIsPersistent = 13107456;
    v10 = -1;
    v11[0] = pAggressorPed;
    v9._vptr$CEvent = (int (**)(void))&off_666648;
    if ( pAggressorPed )
    {
      CEntity::RegisterReference(pAggressorPed, v11);
      pDriver = vehicle->pDriver;
    }
    CEventGroup::Add(&pDriver->m_pPedIntelligence->m_eventGroup, &v9, 0);
    v9._vptr$CEvent = (int (**)(void))&off_666648;
    if ( v11[0] )
      CEntity::CleanUpOldReference(v11[0], v11);
  }
}
// 666648: using guessed type void *off_666648;

//----- (0037642C) --------------------------------------------------------
bool __fastcall CEventGunAimedAt::IsCriminalEvent(const CEventGunAimedAt *this)
{
  CPed *m_pAggressorPed; // r0

  m_pAggressorPed = this->m_pAggressorPed;
  return m_pAggressorPed && CPed::IsPlayer(m_pAggressorPed);
}

//----- (00376448) --------------------------------------------------------
void __fastcall CEventGunAimedAt::ReportCriminalEvent(const CEventGunAimedAt *this, CPed *pPed)
{
  if ( (*((int (__fastcall **)(const CEventGunAimedAt *))this->_vptr$CEvent + 8))(this) == 1 )
    CPedType::PoliceDontCareAboutCrimesAgainstPedType(pPed->m_nPedType);
}

//----- (00376464) --------------------------------------------------------
void __fastcall CEventScriptCommand::CEventScriptCommand(
        CEventScriptCommand *this,
        const int iTaskPriority,
        CTask *pTask,
        const bool bAcceptWhenDead)
{
  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_iTaskPriority = iTaskPriority;
  this->m_pTask = pTask;
  this->m_bAcceptWhenDead = bAcceptWhenDead;
  this->_vptr$CEvent = (int (**)(void))&off_666698;
}
// 666698: using guessed type void *;

//----- (00376490) --------------------------------------------------------
void __fastcall CEventScriptCommand::~CEventScriptCommand(CEventScriptCommand *this)
{
  CTask *m_pTask; // r0

  m_pTask = this->m_pTask;
  this->_vptr$CEvent = (int (**)(void))&off_666698;
  if ( m_pTask )
    (*((void (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 1))(m_pTask);
}
// 666698: using guessed type void *off_666698;

//----- (003764B4) --------------------------------------------------------
void __fastcall CEventScriptCommand::~CEventScriptCommand(CEventScriptCommand *this)
{
  CTask *m_pTask; // r0
  CEventPool *v3; // r0
  int v4; // r1

  m_pTask = this->m_pTask;
  this->_vptr$CEvent = (int (**)(void))&off_666698;
  if ( m_pTask )
    (*((void (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 1))(m_pTask);
  v3 = CPools::ms_pEventPool;
  v4 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v4] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v4 < v3->m_nFreeIndex )
    v3->m_nFreeIndex = v4;
}
// 666698: using guessed type void *off_666698;

//----- (00376504) --------------------------------------------------------
CEvent *__fastcall CEventScriptCommand::Clone(const CEventScriptCommand *this)
{
  int v2; // r0
  int v3; // r4
  CEventPool *v4; // r2
  CEvent *m_nFreeIndex; // r1
  int32 m_nSize; // r3
  uint8 *m_aFlags; // r5
  int v8; // r6
  int m_iTaskPriority; // r5
  bool m_bAcceptWhenDead; // r3

  v2 = (*((int (__fastcall **)(const CEventScriptCommand *))this->_vptr$CEvent + 17))(this);
  v3 = 0;
  v4 = CPools::ms_pEventPool;
  m_nFreeIndex = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    m_nFreeIndex = (CEvent *)((char *)m_nFreeIndex + 1);
    v4->m_nFreeIndex = (int32)m_nFreeIndex;
    if ( m_nFreeIndex == (CEvent *)m_nSize )
    {
      m_nFreeIndex = 0;
      v4->m_nFreeIndex = 0;
      if ( v3 << 31 )
        goto LABEL_7;
      v3 = 1;
    }
    m_aFlags = v4->m_aFlags;
    v8 = *((char *)&m_nFreeIndex->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v8 > -1 );
  *((_BYTE *)&m_nFreeIndex->_vptr$CEvent + (_DWORD)m_aFlags) = v8 & 0x7F;
  v4->m_aFlags[v4->m_nFreeIndex] = (v4->m_aFlags[v4->m_nFreeIndex] + 1) & 0x7F | v4->m_aFlags[v4->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (CEvent *)v4->m_aStorage[v4->m_nFreeIndex];
LABEL_7:
  m_iTaskPriority = this->m_iTaskPriority;
  m_bAcceptWhenDead = this->m_bAcceptWhenDead;
  m_nFreeIndex->m_bIsPersistent = 0;
  m_nFreeIndex->m_iAccumulatedTime = 0;
  m_nFreeIndex[1]._vptr$CEvent = (int (**)(void))m_iTaskPriority;
  m_nFreeIndex[1].m_iAccumulatedTime = v2;
  m_nFreeIndex[1].m_bIsPersistent = m_bAcceptWhenDead;
  m_nFreeIndex->_vptr$CEvent = (int (**)(void))&off_666698;
  return m_nFreeIndex;
}
// 666698: using guessed type void *off_666698;

//----- (00376598) --------------------------------------------------------
CTask *__fastcall CEventScriptCommand::CloneScriptTask(const CEventScriptCommand *this)
{
  CTask *m_pTask; // r0

  m_pTask = this->m_pTask;
  if ( m_pTask )
    return (CTask *)(*((int (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 2))(m_pTask);
  else
    return 0;
}

//----- (003765A8) --------------------------------------------------------
bool __fastcall CEventScriptCommand::IsValid(const CEventScriptCommand *this, CPed *pPed)
{
  __int64 v3; // kr00_8

  if ( pPed )
    return sub_196854(pPed);
  if ( this->m_bIsPersistent )
    return 1;
  v3 = *(_QWORD *)&this->_vptr$CEvent;
  return SHIDWORD(v3) <= (*((int (__fastcall **)(const CEventScriptCommand *))this->_vptr$CEvent + 4))(this);
}

//----- (003765D4) --------------------------------------------------------
bool __fastcall CEventScriptCommand::AffectsPed(const CEventScriptCommand *this, CPed *pPed)
{
  if ( CPed::IsAlive(pPed) )
    return 1;
  return this->m_bAcceptWhenDead;
}

//----- (003765F2) --------------------------------------------------------
int __fastcall CEventScriptCommand::GetEventPriority(const CEventScriptCommand *this)
{
  CTask *m_pTask; // r0
  CTask *v4; // r0

  if ( this->m_bAcceptWhenDead )
    return 75;
  m_pTask = this->m_pTask;
  if ( !m_pTask )
    return 53;
  if ( (*((int (__fastcall **)(CTask *))m_pTask->_vptr$CTask + 5))(m_pTask) == 401 )
  {
    v4 = this->m_pTask;
    if ( ((int)v4[1].m_pParent & 2) != 0 )
      return 71;
  }
  else
  {
    v4 = this->m_pTask;
  }
  if ( (*((int (__fastcall **)(CTask *))v4->_vptr$CTask + 5))(v4) == 212 )
    return 71;
  if ( (*((int (__fastcall **)(CTask *))this->m_pTask->_vptr$CTask + 5))(this->m_pTask) == 1304
    || (*((int (__fastcall **)(CTask *))this->m_pTask->_vptr$CTask + 5))(this->m_pTask) == 1600
    || (*((int (__fastcall **)(CTask *))this->m_pTask->_vptr$CTask + 5))(this->m_pTask) == 217 )
  {
    return 71;
  }
  else
  {
    return 53;
  }
}

//----- (00376662) --------------------------------------------------------
bool __fastcall CEventScriptCommand::TakesPriorityOver(const CEventScriptCommand *this, const CEvent *otherEvent)
{
  int v5; // r5

  if ( this->m_bAcceptWhenDead
    && ((*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 10
     || this->m_bAcceptWhenDead
     && (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 9) )
  {
    return 1;
  }
  v5 = (*((int (__fastcall **)(const CEventScriptCommand *))this->_vptr$CEvent + 3))(this);
  return v5 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (003766AC) --------------------------------------------------------
bool __fastcall CEventInAir::AffectsPed(const CEventInAir *this, CPed *pPed)
{
  CTask *ActiveTask; // r0
  CTask *v4; // r5
  CTask *SimplestActiveTask; // r0

  ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  v4 = ActiveTask;
  return (!ActiveTask
       || (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 108
       && (*((int (__fastcall **)(CTask *))v4->_vptr$CTask + 5))(v4) != 513
       && (*((int (__fastcall **)(CTask *))v4->_vptr$CTask + 5))(v4) != 240)
      && ((SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager)) == 0
       || (*((int (__fastcall **)(CTask *))SimplestActiveTask->_vptr$CTask + 5))(SimplestActiveTask) != 207)
      && !pPed->m_pDamageEntity
      && *(_BYTE *)&pPed->m_nFlags << 31
      && !pPed->m_pAttachToEntity
      && CPedGeometryAnalyser::IsInAir(pPed)
      && sub_196854(pPed);
}

//----- (00376728) --------------------------------------------------------
void __fastcall CEventInAir::CEventInAir(CEventInAir *this)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6666E8;
  this->m_iAccumulatedTime = 0;
}
// 6666E8: using guessed type void *;

//----- (00376740) --------------------------------------------------------
void __fastcall CEventInAir::~CEventInAir(CEventInAir *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00376770) --------------------------------------------------------
void __fastcall CEventVehicleDied::CEventVehicleDied(CEventVehicleDied *this, CVehicle *pDeadVehicle)
{
  this->m_bIsPersistent = 0;
  this->m_bLeavingVehicle = 0;
  this->_vptr$CEvent = (int (**)(void))&off_666734;
  this->m_iAccumulatedTime = 0;
  this->m_pDeadVehicle = pDeadVehicle;
  CEntity::RegisterReference(pDeadVehicle, &this->m_pDeadVehicle);
}
// 666734: using guessed type void *off_666734;

//----- (003767A0) --------------------------------------------------------
void __fastcall CEventVehicleDied::~CEventVehicleDied(CEventVehicleDied *this)
{
  CVehicle *m_pDeadVehicle; // r0
  CEntity **p_m_pDeadVehicle; // r1

  p_m_pDeadVehicle = &this->m_pDeadVehicle;
  m_pDeadVehicle = this->m_pDeadVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666734;
  if ( m_pDeadVehicle )
    CEntity::CleanUpOldReference(m_pDeadVehicle, p_m_pDeadVehicle);
}
// 666734: using guessed type void *off_666734;

//----- (003767C8) --------------------------------------------------------
void __fastcall CEventVehicleDied::~CEventVehicleDied(CEventVehicleDied *this)
{
  CVehicle *m_pDeadVehicle; // r0
  CEntity **p_m_pDeadVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pDeadVehicle = &this->m_pDeadVehicle;
  m_pDeadVehicle = this->m_pDeadVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666734;
  if ( m_pDeadVehicle )
    CEntity::CleanUpOldReference(m_pDeadVehicle, p_m_pDeadVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666734: using guessed type void *;

//----- (0037681C) --------------------------------------------------------
bool __fastcall CEventVehicleDied::AffectsPed(const CEventVehicleDied *this, CPed *pPed)
{
  CTask *ActiveTaskByType; // r0
  CVehicle *m_pDeadVehicle; // r1
  bool result; // r0

  if ( !CPed::IsAlive(pPed) )
    return 0;
  if ( !this->m_bLeavingVehicle )
  {
    ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 704);
    this->m_bLeavingVehicle = ActiveTaskByType != 0;
    if ( !ActiveTaskByType && !(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31) )
      return 0;
  }
  m_pDeadVehicle = this->m_pDeadVehicle;
  result = 0;
  if ( m_pDeadVehicle )
  {
    if ( pPed->m_pMyVehicle == m_pDeadVehicle )
      return 1;
  }
  return result;
}

//----- (0037686E) --------------------------------------------------------
bool __fastcall CEventHealthLow::AffectsPed(const CEventHealthLow *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (00376874) --------------------------------------------------------
bool __fastcall CEventHealthReallyLow::AffectsPed(const CEventHealthReallyLow *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (0037687A) --------------------------------------------------------
bool __fastcall CEventLowAngerAtPlayer::AffectsPed(const CEventLowAngerAtPlayer *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (00376880) --------------------------------------------------------
bool __fastcall CEventHighAngerAtPlayer::AffectsPed(const CEventHighAngerAtPlayer *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (00376886) --------------------------------------------------------
bool __fastcall CEventLeaderEnteredCarAsDriver::TakesPriorityOver(
        const CEventLeaderEnteredCarAsDriver *this,
        const CEvent *otherEvent)
{
  return 1;
}

//----- (0037688A) --------------------------------------------------------
bool __fastcall CEventLeaderEnteredCarAsDriver::AffectsPedGroup(
        const CEventLeaderEnteredCarAsDriver *this,
        CPedGroup *pPedGroup)
{
  CVehicle *m_pVehicle; // r0
  bool v4; // zf
  CPedGroupMembership *p_m_membership; // r5
  int v6; // r6
  CPed *Member; // r0

  m_pVehicle = this->m_pVehicle;
  v4 = m_pVehicle == 0;
  if ( m_pVehicle )
    v4 = pPedGroup->m_followLeader == 0;
  if ( v4 )
    return 0;
  p_m_membership = &pPedGroup->m_membership;
  v6 = -1;
  while ( 1 )
  {
    Member = CPedGroupMembership::GetMember(p_m_membership, ++v6);
    if ( Member )
    {
      if ( !(*((unsigned __int8 *)&Member->m_nPedFlags + 1) << 31)
        || Member->m_pMyVehicle != this->m_pVehicle
        || CTaskManager::FindActiveTaskByType(&Member->m_pPedIntelligence->m_taskManager, 704) )
      {
        break;
      }
    }
    if ( v6 >= 6 )
      return 0;
  }
  return 1;
}

//----- (003768EA) --------------------------------------------------------
bool __fastcall CEventLeaderExitedCarAsDriver::TakesPriorityOver(
        const CEventLeaderExitedCarAsDriver *this,
        const CEvent *otherEvent)
{
  return 1;
}

//----- (003768EE) --------------------------------------------------------
bool __fastcall CEventLeaderExitedCarAsDriver::AffectsPedGroup(
        const CEventLeaderExitedCarAsDriver *this,
        CPedGroup *pPedGroup)
{
  CPedGroupMembership *p_m_membership; // r8
  int v3; // r5
  CPed *Member; // r0
  CPed *v5; // r6
  CVehicle *m_pMyVehicle; // r4
  bool v7; // zf

  p_m_membership = &pPedGroup->m_membership;
  v3 = -1;
  while ( 1 )
  {
    Member = CPedGroupMembership::GetMember(p_m_membership, ++v3);
    v5 = Member;
    if ( Member )
    {
      m_pMyVehicle = Member->m_pMyVehicle;
      v7 = m_pMyVehicle == 0;
      if ( m_pMyVehicle )
        v7 = *((unsigned __int8 *)&Member->m_nPedFlags + 1) << 31 == 0;
      if ( !v7 && m_pMyVehicle == CPedGroupMembership::GetLeader(p_m_membership)->m_pMyVehicle
        || CPedIntelligence::FindTaskByType(v5->m_pPedIntelligence, 700)
        || CPedIntelligence::FindTaskByType(v5->m_pPedIntelligence, 718) )
      {
        break;
      }
    }
    if ( v3 >= 6 )
      return 0;
  }
  return 1;
}

//----- (0037695C) --------------------------------------------------------
bool __fastcall CEventLeaderQuitEnteringCarAsDriver::AffectsPedGroup(
        const CEventLeaderQuitEnteringCarAsDriver *this,
        CPedGroup *pPedGroup)
{
  CEventGroupEvent *m_pCurrentEvent; // r0

  m_pCurrentEvent = pPedGroup->m_intelligence.m_pCurrentEvent;
  return m_pCurrentEvent
      && (*((int (__fastcall **)(CEvent *))m_pCurrentEvent->m_pEvent->_vptr$CEvent + 2))(m_pCurrentEvent->m_pEvent) == 54;
}

//----- (0037697C) --------------------------------------------------------
bool __fastcall CEventLeaderQuitEnteringCarAsDriver::TakesPriorityOver(
        const CEventLeaderQuitEnteringCarAsDriver *this,
        const CEvent *otherEvent)
{
  return 1;
}

//----- (00376980) --------------------------------------------------------
bool __fastcall CEventOnFire::AffectsPed(const CEventOnFire *this, CPed *pPed)
{
  CTask *ActiveTask; // r0
  CTask *TaskSecondary; // r0

  return pPed->m_pFire
      && (*((_BYTE *)&pPed->m_nPhysicalFlags + 2) & 8) == 0
      && ((ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager)) == 0
       || (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 250)
      && ((TaskSecondary = CTaskManager::GetTaskSecondary(&pPed->m_pPedIntelligence->m_taskManager, 4)) == 0
       || (*((int (__fastcall **)(CTask *))TaskSecondary->_vptr$CTask + 5))(TaskSecondary) != 255)
      && sub_196854(pPed);
}

//----- (003769D0) --------------------------------------------------------
void __fastcall CEventVehicleOnFire::CEventVehicleOnFire(CEventVehicleOnFire *this, CVehicle *pVehicleOnFire)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666780;
  this->m_pVehicleOnFire = pVehicleOnFire;
  if ( pVehicleOnFire )
    CEntity::RegisterReference(pVehicleOnFire, &this->m_pVehicleOnFire);
}
// 666780: using guessed type void *off_666780;

//----- (00376A10) --------------------------------------------------------
void __fastcall CEventVehicleOnFire::~CEventVehicleOnFire(CEventVehicleOnFire *this)
{
  CVehicle *m_pVehicleOnFire; // r0
  CEntity **p_m_pVehicleOnFire; // r1

  p_m_pVehicleOnFire = &this->m_pVehicleOnFire;
  m_pVehicleOnFire = this->m_pVehicleOnFire;
  this->_vptr$CEvent = (int (**)(void))&off_666780;
  if ( m_pVehicleOnFire )
    CEntity::CleanUpOldReference(m_pVehicleOnFire, p_m_pVehicleOnFire);
}
// 666780: using guessed type void *off_666780;

//----- (00376A38) --------------------------------------------------------
void __fastcall CEventVehicleOnFire::~CEventVehicleOnFire(CEventVehicleOnFire *this)
{
  CVehicle *m_pVehicleOnFire; // r0
  CEntity **p_m_pVehicleOnFire; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pVehicleOnFire = &this->m_pVehicleOnFire;
  m_pVehicleOnFire = this->m_pVehicleOnFire;
  this->_vptr$CEvent = (int (**)(void))&off_666780;
  if ( m_pVehicleOnFire )
    CEntity::CleanUpOldReference(m_pVehicleOnFire, p_m_pVehicleOnFire);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666780: using guessed type void *;

//----- (00376A8C) --------------------------------------------------------
bool __fastcall CEventVehicleOnFire::AffectsPed(const CEventVehicleOnFire *this, CPed *pPed)
{
  CVehicle *m_pVehicleOnFire; // r0
  CVehicle *m_pMyVehicle; // r1
  bool v6; // zf
  CPedGroup *PedsGroup; // r0
  CVehicle *v8; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v10; // r2
  CSimpleTransform *p_tx; // r3
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v13; // d16
  unsigned __int64 v14; // d1

  m_pVehicleOnFire = this->m_pVehicleOnFire;
  if ( !m_pVehicleOnFire )
    return 0;
  m_pMyVehicle = pPed->m_pMyVehicle;
  v6 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
    v6 = m_pMyVehicle == m_pVehicleOnFire;
  if ( !v6 && (*(_DWORD *)&pPed->m_nPedFlags & 0x100) != 0 )
    return 0;
  if ( CPed::IsPlayer(pPed) )
    return 0;
  if ( !CPed::IsAlive(pPed) )
    return 0;
  PedsGroup = CPedGroups::GetPedsGroup(pPed);
  if ( PedsGroup )
  {
    if ( !CPedGroupMembership::IsLeader(&PedsGroup->m_membership, pPed)
      && *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
    {
      return 0;
    }
  }
  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
    return 1;
  v8 = this->m_pVehicleOnFire;
  m_pMat = pPed->m_pMat;
  v10 = v8->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed->m_transform;
  p_m_transform = (CSimpleTransform *)&v10->tx;
  if ( !v10 )
    p_m_transform = &v8->m_transform;
  v13.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
  v14 = vmul_f32(v13, v13).n64_u64[0];
  return (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                               * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                       + *(float *)&v14)
               + *((float *)&v14 + 1)) <= 100.0;
}

//----- (00376B40) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoBuilding::AffectsPed(const CEventPotentialWalkIntoBuilding *this, CPed *pPed)
{
  _BOOL4 IsAlive; // r0
  bool v5; // zf
  CTask *ActiveTask; // r0

  if ( CPed::IsPlayer(pPed) )
    return 0;
  IsAlive = CPed::IsAlive(pPed);
  v5 = IsAlive;
  if ( IsAlive )
    v5 = pPed->m_pAttachToEntity == 0;
  if ( !v5
    || this->m_iMoveState == 1
    || CEventHandler::GetCurrentEventType(&pPed->m_pPedIntelligence->m_eventHandler) == 6
    && *(CBuilding **)&CEventHandlerHistory::GetCurrentEvent(&pPed->m_pPedIntelligence->m_eventHandler.m_history)[1].m_bIsPersistent == this->m_pBuilding )
  {
    return 0;
  }
  if ( CEventHandler::GetCurrentEventType(&pPed->m_pPedIntelligence->m_eventHandler) == 6
    && *(CBuilding **)&CEventHandlerHistory::GetCurrentEvent(&pPed->m_pPedIntelligence->m_eventHandler.m_history)[1].m_bIsPersistent == this->m_pBuilding )
  {
    return 0;
  }
  ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  return !ActiveTask || (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 601;
}

//----- (00376BCC) --------------------------------------------------------
void __fastcall CEventHitByWaterCannon::CEventHitByWaterCannon(
        CEventHitByWaterCannon *this,
        const CVector *vPos,
        const CVector *vVel)
{
  __int64 v3; // d16
  __int64 v4; // d16

  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6667D0;
  this->m_iAccumulatedTime = 0;
  v3 = *(_QWORD *)&vPos->x;
  this->m_vPos.z = vPos->z;
  *(_QWORD *)&this->m_vPos.x = v3;
  v4 = *(_QWORD *)&vVel->x;
  this->m_vVel.z = vVel->z;
  *(_QWORD *)&this->m_vVel.x = v4;
}
// 6667D0: using guessed type void *;

//----- (00376C08) --------------------------------------------------------
void __fastcall CEventHitByWaterCannon::~CEventHitByWaterCannon(CEventHitByWaterCannon *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00376C38) --------------------------------------------------------
bool __fastcall CEventHitByWaterCannon::AffectsPed(const CEventHitByWaterCannon *this, CPed *pPed)
{
  CTask *ActiveTask; // r0
  bool result; // r0

  result = 0;
  if ( CPed::IsAlive(pPed) )
  {
    ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
    if ( !ActiveTask || (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 208 )
      return 1;
  }
  return result;
}

//----- (00376C68) --------------------------------------------------------
void __fastcall CEventInWater::CEventInWater(CEventInWater *this, float fBuoyancyFraction)
{
  this->m_bIsPersistent = 0;
  this->m_iAccumulatedTime = 0;
  this->m_fBuoyancyFraction = fBuoyancyFraction;
  this->_vptr$CEvent = (int (**)(void))&off_66681C;
}
// 66681C: using guessed type void *;

//----- (00376C84) --------------------------------------------------------
void __fastcall CEventInWater::~CEventInWater(CEventInWater *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00376CB4) --------------------------------------------------------
bool __fastcall CEventInWater::AffectsPed(const CEventInWater *this, CPed *pPed)
{
  CTask *ActiveTask; // r5
  _BOOL4 IsPlayer; // r0

  ActiveTask = CTaskManager::GetActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  IsPlayer = CPed::IsPlayer(pPed);
  return (!ActiveTask || IsPlayer || (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) != 268)
      && sub_196854(pPed);
}

//----- (00376CEC) --------------------------------------------------------
bool __fastcall CEventInWater::TakesPriorityOver(const CEventInWater *this, const CEvent *otherEvent)
{
  int v5; // r5

  if ( (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 8
    || (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 9
    || (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) == 93
    && this->m_fBuoyancyFraction > 1.0 )
  {
    return 1;
  }
  v5 = (*((int (__fastcall **)(const CEventInWater *))this->_vptr$CEvent + 3))(this);
  return v5 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (00376D4C) --------------------------------------------------------
void __fastcall CEventStuckInAir::CEventStuckInAir(CEventStuckInAir *this, CPed *pPed)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_666868;
  this->m_iAccumulatedTime = 0;
  this->m_pPed = pPed;
  if ( pPed )
    CEntity::RegisterReference(pPed, &this->m_pPed);
}
// 666868: using guessed type void *off_666868;

//----- (00376D80) --------------------------------------------------------
void __fastcall CEventStuckInAir::~CEventStuckInAir(CEventStuckInAir *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_666868;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
}
// 666868: using guessed type void *off_666868;

//----- (00376DA8) --------------------------------------------------------
void __fastcall CEventStuckInAir::~CEventStuckInAir(CEventStuckInAir *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_666868;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666868: using guessed type void *;

//----- (00376DFC) --------------------------------------------------------
bool __fastcall CEventStuckInAir::AffectsPed(const CEventStuckInAir *this, CPed *pPed)
{
  uint16 m_nStuck; // r0

  if ( *(_BYTE *)&pPed->m_nPedFlags << 31 )
  {
    LOBYTE(m_nStuck) = 0;
  }
  else
  {
    m_nStuck = pPed->m_pPedIntelligence->m_stuckChecker.m_nStuck;
    if ( m_nStuck )
      LOBYTE(m_nStuck) = 1;
  }
  return m_nStuck;
}

//----- (00376E18) --------------------------------------------------------
bool __fastcall CEventStuckInAir::TakesPriorityOver(const CEventStuckInAir *this, const CEvent *otherEvent)
{
  int v5; // r5

  if ( (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent) <= 73
    && (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent) != 93 )
  {
    return 1;
  }
  v5 = (*((int (__fastcall **)(const CEventStuckInAir *))this->_vptr$CEvent + 3))(this);
  return v5 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (00376E5A) --------------------------------------------------------
int __fastcall CEventStuckInAir::GetEventPriority(const CEventStuckInAir *this)
{
  CPed *m_pPed; // r0

  m_pPed = this->m_pPed;
  if ( !m_pPed
    || CEventHandler::GetCurrentEventType(&m_pPed->m_pPedIntelligence->m_eventHandler) == 93
    || this->m_pPed->m_pPedIntelligence->m_eventGroup.m_iNoOfEvents <= 1 )
  {
    return 63;
  }
  else
  {
    return 75;
  }
}

//----- (00376E86) --------------------------------------------------------
bool __fastcall CEventInteriorUseInfo::IsValid(const CEventInteriorUseInfo *this, CPed *pPed)
{
  __int64 v3; // kr00_8

  if ( pPed )
    return sub_196854(pPed);
  if ( this->m_bIsPersistent )
    return 1;
  v3 = *(_QWORD *)&this->_vptr$CEvent;
  return SHIDWORD(v3) <= (*((int (__fastcall **)(const CEventInteriorUseInfo *))this->_vptr$CEvent + 4))(this);
}

//----- (00376EB2) --------------------------------------------------------
bool __fastcall CEventSignalAtPed::IsValid(const CEventSignalAtPed *this, CPed *pPed)
{
  __int64 v3; // kr00_8

  if ( pPed )
    return sub_196854(pPed);
  if ( this->m_bIsPersistent )
    return 1;
  v3 = *(_QWORD *)&this->_vptr$CEvent;
  return SHIDWORD(v3) <= (*((int (__fastcall **)(const CEventSignalAtPed *))this->_vptr$CEvent + 4))(this);
}

//----- (00376EDE) --------------------------------------------------------
bool __fastcall CEventLeanOnVehicle::IsValid(const CEventLeanOnVehicle *this, CPed *pPed)
{
  __int64 v3; // kr00_8

  if ( pPed )
    return sub_196854(pPed);
  if ( this->m_bIsPersistent )
    return 1;
  v3 = *(_QWORD *)&this->_vptr$CEvent;
  return SHIDWORD(v3) <= (*((int (__fastcall **)(const CEventLeanOnVehicle *))this->_vptr$CEvent + 4))(this);
}

//----- (00376F0A) --------------------------------------------------------
bool __fastcall CEventPassObject::IsValid(const CEventPassObject *this, CPed *pPed)
{
  __int64 v3; // kr00_8

  if ( pPed )
    return sub_196854(pPed);
  if ( this->m_bIsPersistent )
    return 1;
  v3 = *(_QWORD *)&this->_vptr$CEvent;
  return SHIDWORD(v3) <= (*((int (__fastcall **)(const CEventPassObject *))this->_vptr$CEvent + 4))(this);
}

//----- (00376F38) --------------------------------------------------------
void __fastcall CEventCopCarBeingStolen::CEventCopCarBeingStolen(
        CEventCopCarBeingStolen *this,
        CPed *pCriminal,
        CVehicle *pTargetVehicle)
{
  CVehicle **p_m_pTargetVehicle; // r5

  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6668B4;
  this->m_iAccumulatedTime = 0;
  this->m_pTargetVehicle = pTargetVehicle;
  p_m_pTargetVehicle = &this->m_pTargetVehicle;
  this->m_pCriminal = pCriminal;
  if ( pCriminal )
  {
    CEntity::RegisterReference(pCriminal, &this->m_pCriminal);
    pTargetVehicle = *p_m_pTargetVehicle;
  }
  if ( pTargetVehicle )
    CEntity::RegisterReference(pTargetVehicle, &this->m_pTargetVehicle);
}
// 6668B4: using guessed type void *off_6668B4;

//----- (00376F80) --------------------------------------------------------
void __fastcall CEventCopCarBeingStolen::~CEventCopCarBeingStolen(CEventCopCarBeingStolen *this)
{
  CPed *m_pCriminal; // r0
  CEntity **p_m_pCriminal; // r1
  CVehicle *m_pTargetVehicle; // r0

  p_m_pCriminal = &this->m_pCriminal;
  m_pCriminal = this->m_pCriminal;
  this->_vptr$CEvent = (int (**)(void))&off_6668B4;
  if ( m_pCriminal )
    CEntity::CleanUpOldReference(m_pCriminal, p_m_pCriminal);
  m_pTargetVehicle = this->m_pTargetVehicle;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, &this->m_pTargetVehicle);
}
// 6668B4: using guessed type void *;

//----- (00376FB4) --------------------------------------------------------
void __fastcall CEventCopCarBeingStolen::~CEventCopCarBeingStolen(CEventCopCarBeingStolen *this)
{
  CPed *m_pCriminal; // r0
  CEntity **p_m_pCriminal; // r1
  CVehicle *m_pTargetVehicle; // r0
  CEventPool *v5; // r0
  int v6; // r1

  p_m_pCriminal = &this->m_pCriminal;
  m_pCriminal = this->m_pCriminal;
  this->_vptr$CEvent = (int (**)(void))&off_6668B4;
  if ( m_pCriminal )
    CEntity::CleanUpOldReference(m_pCriminal, p_m_pCriminal);
  m_pTargetVehicle = this->m_pTargetVehicle;
  if ( m_pTargetVehicle )
    CEntity::CleanUpOldReference(m_pTargetVehicle, &this->m_pTargetVehicle);
  v5 = CPools::ms_pEventPool;
  v6 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v6] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v6 < v5->m_nFreeIndex )
    v5->m_nFreeIndex = v6;
}
// 6668B4: using guessed type void *off_6668B4;

//----- (00377014) --------------------------------------------------------
bool __fastcall CEventCopCarBeingStolen::AffectsPed(const CEventCopCarBeingStolen *this, CPed *pPed)
{
  CPed *m_pCriminal; // r0
  bool v5; // zf
  _BOOL4 IsAlive; // r0
  bool v7; // zf

  m_pCriminal = this->m_pCriminal;
  v5 = m_pCriminal == 0;
  if ( m_pCriminal )
    v5 = this->m_pTargetVehicle == 0;
  if ( v5 || !CPed::IsAlive(m_pCriminal) )
    return 0;
  IsAlive = CPed::IsAlive(pPed);
  v7 = IsAlive;
  if ( IsAlive )
    v7 = pPed->m_nPedType == 6;
  if ( v7 && this->m_pTargetVehicle == pPed->m_pMyVehicle )
    return *((_BYTE *)&pPed->m_nPedFlags + 1) & 1;
  else
    return 0;
}

//----- (0037705C) --------------------------------------------------------
void __fastcall CEventVehicleDamage::CEventVehicleDamage(
        CEventVehicleDamage *this,
        CVehicle *pVehicle,
        CEntity *pInflictor,
        const eWeaponType weaponUsed)
{
  CEntity **p_m_pInflictor; // r5

  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_eWeaponUsed = weaponUsed;
  this->_vptr$CEvent = (int (**)(void))&off_666900;
  this->m_pInflictor = pInflictor;
  p_m_pInflictor = &this->m_pInflictor;
  this->m_pVehicle = pVehicle;
  if ( pVehicle )
  {
    CEntity::RegisterReference(pVehicle, &this->m_pVehicle);
    pInflictor = *p_m_pInflictor;
  }
  if ( pInflictor )
    CEntity::RegisterReference(pInflictor, &this->m_pInflictor);
}
// 666900: using guessed type void *;

//----- (003770B4) --------------------------------------------------------
void __fastcall CEventVehicleDamage::~CEventVehicleDamage(CEventVehicleDamage *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CEntity *m_pInflictor; // r0

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666900;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  m_pInflictor = this->m_pInflictor;
  if ( m_pInflictor )
    CEntity::CleanUpOldReference(m_pInflictor, &this->m_pInflictor);
}
// 666900: using guessed type void *off_666900;

//----- (003770EA) --------------------------------------------------------
bool __fastcall CEventVehicleDamage::AffectsPed(const CEventVehicleDamage *this, CPed *pPed)
{
  bool v4; // zf
  CVehicle *m_pMyVehicle; // r0
  bool result; // r0
  CVehicle *m_pVehicle; // r1

  if ( !CPed::IsAlive(pPed) || !this->m_pInflictor )
    return 0;
  m_pMyVehicle = (CVehicle *)(*((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31);
  v4 = m_pMyVehicle == 0;
  if ( m_pMyVehicle )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    v4 = m_pMyVehicle == 0;
  }
  if ( !v4 && CVehicle::IsPassenger(m_pMyVehicle, pPed) && pPed->m_pMyVehicle->pDriver )
    return 0;
  m_pVehicle = this->m_pVehicle;
  result = 0;
  if ( m_pVehicle )
  {
    if ( pPed->m_pMyVehicle == m_pVehicle )
      return 1;
  }
  return result;
}

//----- (0037713E) --------------------------------------------------------
CEntity *__fastcall CEventVehicleDamage::GetSourceEntity(const CEventVehicleDamage *this)
{
  CEntity *result; // r0
  CEntity *m_pLastRenderedLink; // r1

  result = this->m_pInflictor;
  if ( !result )
    return 0;
  if ( (*(_BYTE *)&result->m_info & 7) == 2 )
  {
    m_pLastRenderedLink = (CEntity *)result[18].m_pLastRenderedLink;
    if ( !m_pLastRenderedLink )
      return result;
    return m_pLastRenderedLink;
  }
  return result;
}

//----- (00377164) --------------------------------------------------------
bool __fastcall CEventVehicleDamage::IsCriminalEvent(const CEventVehicleDamage *this)
{
  CEntity *m_pInflictor; // r0
  CEntity::CEntityInfo m_info; // r1
  CPlayerPed *m_pLastRenderedLink; // r4

  m_pInflictor = this->m_pInflictor;
  if ( !m_pInflictor )
    return 0;
  m_info = m_pInflictor->m_info;
  if ( (*(_BYTE *)&m_info & 7) == 3 )
  {
    if ( CPed::IsPlayer((const CPed *)m_pInflictor) )
      return 1;
    m_pInflictor = this->m_pInflictor;
    m_info = m_pInflictor->m_info;
  }
  if ( (*(_BYTE *)&m_info & 7) != 2 )
    return 0;
  m_pLastRenderedLink = (CPlayerPed *)m_pInflictor[18].m_pLastRenderedLink;
  return m_pLastRenderedLink == FindPlayerPed(-1);
}

//----- (003771A6) --------------------------------------------------------
void __fastcall CEventVehicleDamage::ReportCriminalEvent(const CEventVehicleDamage *this, CPed *pPed)
{
  bool bPoliceDontReallyCare; // r6
  CWanted *PlayerWanted; // r0
  CEntity *m_pInflictor; // r1
  CMatrix *m_pMat; // r3
  const CVector *p_tx; // r2

  if ( (*((int (__fastcall **)(const CEventVehicleDamage *))this->_vptr$CEvent + 8))(this) == 1 )
  {
    if ( this->m_pInflictor )
    {
      bPoliceDontReallyCare = CPedType::PoliceDontCareAboutCrimesAgainstPedType(pPed->m_nPedType);
      if ( pPed->m_nPedType == 6 )
      {
        PlayerWanted = FindPlayerWanted(-1);
        m_pInflictor = this->m_pInflictor;
        m_pMat = m_pInflictor->m_pMat;
        p_tx = (const CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pInflictor->m_transform.m_translate;
        CWanted::RegisterCrime(PlayerWanted, CRIME_RECKLESS_DRIVING, p_tx, (u_native)pPed, bPoliceDontReallyCare);
      }
    }
  }
}

//----- (00377200) --------------------------------------------------------
void __fastcall CEventSpecial::CEventSpecial(CEventSpecial *this)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666950;
}
// 666950: using guessed type void *;

//----- (00377224) --------------------------------------------------------
void __fastcall CEventSpecial::~CEventSpecial(CEventSpecial *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00377254) --------------------------------------------------------
void __fastcall CEventGotKnockedOverByCar::CEventGotKnockedOverByCar(
        CEventGotKnockedOverByCar *this,
        CVehicle *pVehicle)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_6669A0;
  this->m_pVehicle = pVehicle;
  if ( pVehicle )
    CEntity::RegisterReference(pVehicle, &this->m_pVehicle);
}
// 6669A0: using guessed type void *;

//----- (00377294) --------------------------------------------------------
void __fastcall CEventGotKnockedOverByCar::~CEventGotKnockedOverByCar(CEventGotKnockedOverByCar *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6669A0;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
}
// 6669A0: using guessed type void *off_6669A0;

//----- (003772BC) --------------------------------------------------------
void __fastcall CEventGotKnockedOverByCar::~CEventGotKnockedOverByCar(CEventGotKnockedOverByCar *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6669A0;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6669A0: using guessed type void *off_6669A0;

//----- (00377310) --------------------------------------------------------
bool __fastcall CEventGotKnockedOverByCar::AffectsPed(const CEventGotKnockedOverByCar *this, CPed *pPed)
{
  return this->m_pVehicle && !CPed::IsPlayer(pPed) && sub_196854(pPed);
}

//----- (00377330) --------------------------------------------------------
CEntity *__fastcall CEventGotKnockedOverByCar::GetSourceEntity(const CEventGotKnockedOverByCar *this)
{
  CVehicle *m_pVehicle; // r0

  m_pVehicle = this->m_pVehicle;
  if ( m_pVehicle )
    return m_pVehicle->pDriver;
  else
    return 0;
}

//----- (00377340) --------------------------------------------------------
void __fastcall CEventCarUpsideDown::CEventCarUpsideDown(CEventCarUpsideDown *this, CVehicle *pVehicle)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_6669F0;
  this->m_iAccumulatedTime = 0;
  this->m_pVehicle = pVehicle;
  if ( pVehicle )
    CEntity::RegisterReference(pVehicle, &this->m_pVehicle);
}
// 6669F0: using guessed type void *off_6669F0;

//----- (00377374) --------------------------------------------------------
void __fastcall CEventCarUpsideDown::~CEventCarUpsideDown(CEventCarUpsideDown *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6669F0;
  if ( m_pVehicle )
    CEntity::RegisterReference(m_pVehicle, p_m_pVehicle);
}
// 6669F0: using guessed type void *off_6669F0;

//----- (0037739C) --------------------------------------------------------
void __fastcall CEventCarUpsideDown::~CEventCarUpsideDown(CEventCarUpsideDown *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_6669F0;
  if ( m_pVehicle )
    CEntity::RegisterReference(m_pVehicle, p_m_pVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6669F0: using guessed type void *;

//----- (003773F0) --------------------------------------------------------
bool __fastcall CEventCarUpsideDown::AffectsPed(const CEventCarUpsideDown *this, CPed *pPed)
{
  CVehicle *m_pMyVehicle; // r0
  bool v4; // zf
  bool v5; // zf

  if ( !CPed::IsPlayer(pPed)
    && !(~*(_DWORD *)&pPed->m_nPedFlags & 0x100 | ~*((_DWORD *)&pPed->m_nPedFlags + 3) & 0x20000) )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    if ( pPed->CharCreatedBy == 2 )
    {
      v4 = m_pMyVehicle == 0;
      if ( m_pMyVehicle )
      {
        m_pMyVehicle = (CVehicle *)m_pMyVehicle->m_baseVehicleType;
        v4 = m_pMyVehicle == (CVehicle *)&byte_5;
      }
      if ( v4 )
        return 0;
    }
    else
    {
      m_pMyVehicle = (CVehicle *)m_pMyVehicle->m_baseVehicleType;
    }
    v5 = m_pMyVehicle == (CVehicle *)((char *)&dword_0 + 2);
    if ( m_pMyVehicle != (CVehicle *)((char *)&dword_0 + 2) )
      v5 = m_pMyVehicle == (CVehicle *)byte_9;
    if ( !v5 )
      return sub_196854(pPed);
  }
  return 0;
}
// 0: using guessed type int dword_0;
// 5: using guessed type char byte_5;

//----- (00377450) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoFire::CEventPotentialWalkIntoFire(
        CEventPotentialWalkIntoFire *this,
        const CVector *vFirePos,
        const float fStrength,
        const int iMoveState)
{
  int *v4; // lr
  int v5; // s0
  __int64 v6; // d16

  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  v4 = (int *)sub_3774D0;
  if ( fStrength < 2.0 )
    v4 = (int *)&loc_3774D4;
  v5 = *v4;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666A3C;
  if ( fStrength < 1.0 )
    v5 = 1065772646;
  v6 = *(_QWORD *)&vFirePos->x;
  this->m_vFirePos.z = vFirePos->z;
  this->m_fStrength = fStrength;
  this->m_iMoveState = iMoveState;
  *(_QWORD *)&this->m_vFirePos.x = v6;
  LODWORD(this->m_fFireRadius) = v5;
}
// 3774D0: using guessed type int sub_3774D0();
// 666A3C: using guessed type void *;

//----- (003774D8) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoFire::~CEventPotentialWalkIntoFire(CEventPotentialWalkIntoFire *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00377508) --------------------------------------------------------
bool __fastcall CEventPotentialWalkIntoFire::AffectsPed(const CEventPotentialWalkIntoFire *this, CPed *pPed)
{
  CTask *SimplestActiveTask; // r0
  const CVector *v5; // r6
  int IsGoToTask; // r1
  bool result; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  CVector v2; // [sp+Ch] [bp-3Ch] BYREF
  CVector v1; // [sp+18h] [bp-30h] BYREF
  CColSphere v12; // [sp+24h] [bp-24h] BYREF

  if ( !CPed::IsAlive(pPed) )
    return 0;
  if ( this->m_iMoveState == 1 )
    return 0;
  SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&pPed->m_pPedIntelligence->m_taskManager);
  v5 = (const CVector *)SimplestActiveTask;
  if ( !SimplestActiveTask )
    return 0;
  IsGoToTask = CTask::IsGoToTask(SimplestActiveTask);
  result = 0;
  if ( IsGoToTask )
  {
    CColSphere::Set(&v12, this->m_fFireRadius, &this->m_vFirePos, 0, 0, 0xFFu);
    m_pMat = pPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    return CColSphere::IntersectEdge(&v12, &p_tx->m_translate, v5 + 1, &v1, &v2);
  }
  return result;
}

//----- (00377580) --------------------------------------------------------
void __fastcall CEventFireNearby::CEventFireNearby(CEventFireNearby *this, const CVector *vFirePos)
{
  __int64 v2; // d16

  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666A8C;
  v2 = *(_QWORD *)&vFirePos->x;
  this->m_vFirePos.z = vFirePos->z;
  *(_QWORD *)&this->m_vFirePos.x = v2;
}
// 666A8C: using guessed type void *;

//----- (003775B0) --------------------------------------------------------
void __fastcall CEventFireNearby::~CEventFireNearby(CEventFireNearby *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (003775E0) --------------------------------------------------------
bool __fastcall CEventFireNearby::AffectsPed(const CEventFireNearby *this, CPed *pPed)
{
  return !CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 604) && sub_196854(pPed);
}

//----- (00377606) --------------------------------------------------------
bool __fastcall CEventFireNearby::TakesPriorityOver(const CEventFireNearby *this, const CEvent *otherEvent)
{
  return 1;
}

//----- (0037760C) --------------------------------------------------------
void __fastcall CEventGunShotWhizzedBy::CEventGunShotWhizzedBy(
        CEventGunShotWhizzedBy *this,
        CEntity *pFiringEntity,
        const CVector *vShotOrigin,
        const CVector *vShotTarget,
        const bool bIsSilent)
{
  __int64 v6; // kr00_8
  RwReal z; // r3
  __int64 v8; // kr08_8
  RwReal v9; // r2

  v6 = *(_QWORD *)&vShotTarget->x;
  z = vShotTarget->z;
  v8 = *(_QWORD *)&vShotOrigin->x;
  v9 = vShotOrigin->z;
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  *(_QWORD *)&this->m_vShotOrigin.x = v8;
  this->m_vShotOrigin.z = v9;
  this->m_vShotTarget.z = z;
  *(_QWORD *)&this->m_vShotTarget.x = v6;
  this->m_bSilent = bIsSilent;
  this->_vptr$CEvent = (int (**)(void))&off_665E10;
  this->m_pFiringEntity = pFiringEntity;
  if ( pFiringEntity )
    CEntity::RegisterReference(pFiringEntity, &this->m_pFiringEntity);
  this->_vptr$CEvent = (int (**)(void))&off_666ADC;
}
// 665E10: using guessed type void *off_665E10;
// 666ADC: using guessed type void *;

//----- (00377680) --------------------------------------------------------
void __fastcall CEventGunShotWhizzedBy::~CEventGunShotWhizzedBy(CEventGunShotWhizzedBy *this)
{
  CEntity *m_pFiringEntity; // r0
  CEntity **p_m_pFiringEntity; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pFiringEntity = &this->m_pFiringEntity;
  m_pFiringEntity = this->m_pFiringEntity;
  this->_vptr$CEvent = (int (**)(void))&off_665E10;
  if ( m_pFiringEntity )
    CEntity::CleanUpOldReference(m_pFiringEntity, p_m_pFiringEntity);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665E10: using guessed type void *off_665E10;

//----- (003776D4) --------------------------------------------------------
bool __fastcall CEventGunShotWhizzedBy::AffectsPed(const CEventGunShotWhizzedBy *this, CPed *pPed)
{
  RwReal v4; // s0
  RwReal v5; // s4
  CMatrix *m_pMat; // r0
  float x; // s0
  CSimpleTransform *p_tx; // r1
  bool v9; // zf
  float y; // s4
  bool result; // r0
  float v12; // s2
  float v13; // s12
  float v14; // s0
  CVector v15; // [sp+4h] [bp-14h] BYREF

  if ( CPed::IsPlayer(pPed) || !CPed::IsAlive(pPed) )
    return 0;
  v4 = this->m_vShotTarget.x - this->m_vShotOrigin.x;
  v5 = this->m_vShotTarget.z - this->m_vShotOrigin.z;
  v15.y = this->m_vShotTarget.y - this->m_vShotOrigin.y;
  v15.x = v4;
  v15.z = v5;
  CVector::Normalise(&v15);
  m_pMat = pPed->m_pMat;
  x = this->m_vShotOrigin.x;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  v9 = m_pMat == 0;
  y = this->m_vShotOrigin.y;
  result = 0;
  if ( v9 )
    p_tx = &pPed->m_transform;
  v12 = p_tx->m_translate.x;
  v13 = (float)((float)((float)(p_tx->m_translate.x - x) * v15.x) + (float)((float)(p_tx->m_translate.y - y) * v15.y))
      + (float)((float)(p_tx->m_translate.z - this->m_vShotOrigin.z) * v15.z);
  if ( v13 > 0.0 )
  {
    v15.y = v13 * v15.y;
    v14 = x + (float)(v15.x * v13);
    v15.x = v15.x * v13;
    v15.z = v13 * v15.z;
    if ( (float)((float)((float)((float)(v12 - v14) * (float)(v12 - v14))
                       + (float)((float)(p_tx->m_translate.y - (float)(y + v15.y))
                               * (float)(p_tx->m_translate.y - (float)(y + v15.y))))
               + 0.0) < (float)(CEventGunShotWhizzedBy::ms_fThresholdDist * CEventGunShotWhizzedBy::ms_fThresholdDist) )
      return 1;
  }
  return result;
}

//----- (003777F4) --------------------------------------------------------
bool __fastcall CEventSoundQuiet::AffectsPed(const CEventSoundQuiet *this, CPed *pPed)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r8
  bool v6; // r6
  CSimpleTransform *p_tx; // r2
  float SoundLevel; // s16
  CEvent *CurrentEvent; // r0
  CEvent *v10; // r9
  int v11; // r6
  float v12; // s0
  float32x2_t v13; // d16
  unsigned __int64 v14; // d1
  CMatrix *v16; // r0

  if ( CPed::IsPlayer(pPed)
    || !CPed::IsAlive(pPed)
    || !(*((int (__fastcall **)(const CEventSoundQuiet *))this->_vptr$CEvent + 11))(this) )
  {
    return 0;
  }
  m_pMat = pPed->m_pMat;
  p_m_transform = &pPed->m_transform;
  v6 = 0;
  p_tx = &pPed->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  SoundLevel = CEvent::GetSoundLevel((const CEvent *)this, 0, &p_tx->m_translate);
  if ( SoundLevel >= 30.0 )
  {
    CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&pPed->m_pPedIntelligence->m_eventHandler.m_history);
    v10 = CurrentEvent;
    if ( CurrentEvent
      && (*((int (__fastcall **)(CEvent *))CurrentEvent->_vptr$CEvent + 2))(CurrentEvent) == 62
      && (v11 = (*((int (__fastcall **)(CEvent *))v10->_vptr$CEvent + 11))(v10),
          v11 == (*((int (__fastcall **)(const CEventSoundQuiet *))this->_vptr$CEvent + 11))(this))
      && ((signed int)(this->m_iTimeHeard - (unsigned int)v10[2]._vptr$CEvent) < 2000
       || (v12 = this->m_vTargetPosAtHeardTime.x - *(float *)&v10[2].m_iAccumulatedTime,
           v13.n64_u64[0] = vsub_f32(
                              *(float32x2_t *)&this->m_vTargetPosAtHeardTime.y,
                              *(float32x2_t *)&v10[2].m_bIsPersistent).n64_u64[0],
           v14 = vmul_f32(v13, v13).n64_u64[0],
           (float)((float)((float)(v12 * v12) + *(float *)&v14) + *((float *)&v14 + 1)) < 1.0)) )
    {
      v16 = pPed->m_pMat;
      v6 = 0;
      if ( v16 )
        p_m_transform = (CSimpleTransform *)&v16->tx;
      if ( (float)(SoundLevel - CEvent::GetSoundLevel(v10, 0, &p_m_transform->m_translate)) >= 3.0 )
        return 1;
    }
    else
    {
      return 1;
    }
  }
  return v6;
}

//----- (00377910) --------------------------------------------------------
bool __fastcall CEventSoundLoud::AffectsPed(const CEventSoundLoud *this, CPed *pPed)
{
  bool v4; // r4
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2

  if ( CPed::IsPlayer(pPed) || !CPed::IsAlive(pPed) )
    return 0;
  v4 = 0;
  if ( (*((int (__fastcall **)(const CEventSoundLoud *))this->_vptr$CEvent + 11))(this) )
  {
    m_pMat = pPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPed->m_transform;
    if ( CEvent::GetSoundLevel((const CEvent *)this, 0, &p_tx->m_translate) >= 70.0 )
      return 1;
  }
  return v4;
}

//----- (00377974) --------------------------------------------------------
void __fastcall CEventSeenPanickedPed::CEventSeenPanickedPed(CEventSeenPanickedPed *this, CPed *pPanickedPed)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666B2C;
  this->m_pPanickedPed = pPanickedPed;
  if ( pPanickedPed )
    CEntity::RegisterReference(pPanickedPed, &this->m_pPanickedPed);
}
// 666B2C: using guessed type void *off_666B2C;

//----- (003779B4) --------------------------------------------------------
void __fastcall CEventSeenPanickedPed::~CEventSeenPanickedPed(CEventSeenPanickedPed *this)
{
  CPed *m_pPanickedPed; // r0
  CEntity **p_m_pPanickedPed; // r1

  p_m_pPanickedPed = &this->m_pPanickedPed;
  m_pPanickedPed = this->m_pPanickedPed;
  this->_vptr$CEvent = (int (**)(void))&off_666B2C;
  if ( m_pPanickedPed )
    CEntity::CleanUpOldReference(m_pPanickedPed, p_m_pPanickedPed);
}
// 666B2C: using guessed type void *off_666B2C;

//----- (003779DC) --------------------------------------------------------
void __fastcall CEventSeenPanickedPed::~CEventSeenPanickedPed(CEventSeenPanickedPed *this)
{
  CPed *m_pPanickedPed; // r0
  CEntity **p_m_pPanickedPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pPanickedPed = &this->m_pPanickedPed;
  m_pPanickedPed = this->m_pPanickedPed;
  this->_vptr$CEvent = (int (**)(void))&off_666B2C;
  if ( m_pPanickedPed )
    CEntity::CleanUpOldReference(m_pPanickedPed, p_m_pPanickedPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666B2C: using guessed type void *;

//----- (00377A30) --------------------------------------------------------
bool __fastcall CEventSeenPanickedPed::AffectsPed(const CEventSeenPanickedPed *this, CPed *pPed)
{
  CPed *m_pPanickedPed; // r1
  bool result; // r0
  bool v6; // zf
  CEvent *CurrentEvent; // r0
  int v8; // r1
  CPed *v9; // r1
  CMatrix *m_pMat; // r2
  CMatrix *v11; // r3
  CSimpleTransform *p_tx; // r5
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v14; // d16
  unsigned __int64 v15; // d1

  if ( CPed::IsPlayer(pPed) )
    return 0;
  m_pPanickedPed = this->m_pPanickedPed;
  result = 0;
  v6 = m_pPanickedPed == 0;
  if ( m_pPanickedPed )
    v6 = m_pPanickedPed == pPed;
  if ( !v6 )
  {
    CurrentEvent = CEventHandlerHistory::GetCurrentEvent(&m_pPanickedPed->m_pPedIntelligence->m_eventHandler.m_history);
    if ( CurrentEvent )
    {
      v8 = (*((int (__fastcall **)(CEvent *))CurrentEvent->_vptr$CEvent + 11))(CurrentEvent);
      result = 0;
      if ( v8 )
      {
        v9 = this->m_pPanickedPed;
        m_pMat = pPed->m_pMat;
        v11 = v9->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pPed->m_transform;
        p_m_transform = (CSimpleTransform *)&v11->tx;
        if ( !v11 )
          p_m_transform = &v9->m_transform;
        v14.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
        v15 = vmul_f32(v14, v14).n64_u64[0];
        if ( (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                                   * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                           + *(float *)&v15)
                   + *((float *)&v15 + 1)) < 100.0 )
          return 1;
      }
      return result;
    }
    return 0;
  }
  return result;
}

//----- (00377AC4) --------------------------------------------------------
void __fastcall CEventAreaCodes::CEventAreaCodes(CEventAreaCodes *this, CPed *pTargetPed)
{
  this->m_bIsPersistent = 0;
  this->_vptr$CEvent = (int (**)(void))&off_666B7C;
  this->m_iAccumulatedTime = 0;
  this->m_pTargetPed = pTargetPed;
  if ( pTargetPed )
    CEntity::RegisterReference(pTargetPed, &this->m_pTargetPed);
}
// 666B7C: using guessed type void *;

//----- (00377AF8) --------------------------------------------------------
void __fastcall CEventAreaCodes::~CEventAreaCodes(CEventAreaCodes *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CEvent = (int (**)(void))&off_666B7C;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666B7C: using guessed type void *off_666B7C;

//----- (00377B4C) --------------------------------------------------------
bool __fastcall CEventAreaCodes::AffectsPed(const CEventAreaCodes *this, CPed *pPed)
{
  CTask *ActiveTaskByType; // r0
  CPed *v5; // r6
  CTask *v6; // r0
  CEntity *v8; // r2
  CEntity *m_pEntityStandingOn; // r1
  CPed *m_pTargetPed; // r0
  bool v11; // zf
  CEntity *v12; // r0
  CEntity *v13; // r0

  if ( !this->m_pTargetPed )
    return 0;
  ActiveTaskByType = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1000);
  if ( ActiveTaskByType )
  {
    v5 = (CPed *)ActiveTaskByType[2]._vptr$CTask;
    if ( v5 != this->m_pTargetPed )
    {
      v6 = CTaskManager::FindActiveTaskByType(&pPed->m_pPedIntelligence->m_taskManager, 1101);
      if ( v6 )
        v5 = (CPed *)v6[2]._vptr$CTask;
    }
  }
  else
  {
    v5 = 0;
  }
  if ( v5 != this->m_pTargetPed )
    return 0;
  if ( CPedIntelligence::FindTaskByType(v5->m_pPedIntelligence, 932) )
    return 1;
  m_pEntityStandingOn = pPed->m_pEntityStandingOn;
  m_pTargetPed = this->m_pTargetPed;
  v11 = m_pEntityStandingOn == 0;
  if ( m_pEntityStandingOn )
  {
    v8 = m_pTargetPed->m_pEntityStandingOn;
    v11 = v8 == 0;
  }
  return (v11 || m_pEntityStandingOn->m_areaCode != v8->m_areaCode)
      && CPed::IsAlive(m_pTargetPed)
      && CPed::IsAlive(pPed)
      && ((v12 = pPed->m_pEntityStandingOn) == 0 || v12->m_areaCode != 13)
      && ((v13 = this->m_pTargetPed->m_pEntityStandingOn) == 0 || v13->m_areaCode != 13);
}
// 377BC2: variable 'v8' is possibly undefined

//----- (00377C02) --------------------------------------------------------
bool __fastcall CEventAreaCodes::TakesPriorityOver(const CEventAreaCodes *this, const CEvent *otherEvent)
{
  int v5; // r5

  if ( CEventHandler::IsTemporaryEvent(otherEvent) )
    return 1;
  v5 = (*((int (__fastcall **)(const CEventAreaCodes *))this->_vptr$CEvent + 3))(this);
  return v5 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (00377C36) --------------------------------------------------------
bool __fastcall CEventLeaderEntryExit::TakesPriorityOver(const CEventLeaderEntryExit *this, const CEvent *otherEvent)
{
  return 1;
}

//----- (00377C3A) --------------------------------------------------------
bool __fastcall CEventLeaderEntryExit::AffectsPedGroup(const CEventLeaderEntryExit *this, CPedGroup *pPedGroup)
{
  bool v2; // r4

  v2 = 0;
  if ( this->m_pTargetPed && CPedGroupMembership::GetLeader(&pPedGroup->m_membership) == this->m_pTargetPed )
    return 1;
  return v2;
}

//----- (00377C5C) --------------------------------------------------------
void __fastcall CEventPlayerCommandToGroup::CEventPlayerCommandToGroup(
        CEventPlayerCommandToGroup *this,
        const int iType,
        CPed *pPed)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->m_iType = iType;
  this->_vptr$CEvent = (int (**)(void))&off_666BC8;
  this->m_pPed = pPed;
  if ( pPed )
    CEntity::RegisterReference(pPed, &this->m_pPed);
}
// 666BC8: using guessed type void *off_666BC8;

//----- (00377C9E) --------------------------------------------------------
bool __fastcall CEventPlayerCommandToGroup::AffectsPedGroup(
        const CEventPlayerCommandToGroup *this,
        CPedGroup *pPedGroup)
{
  CPedGroupMembership *p_m_membership; // r5
  CPed *Leader; // r0
  CPed *v4; // r4
  CPed *Member; // r0
  bool v6; // zf
  CPed *v7; // r0
  CPed *v8; // r0
  bool v9; // zf
  CPed *v10; // r0
  bool v11; // zf
  CPed *v12; // r0
  bool v13; // zf
  CPed *v14; // r0
  bool v15; // zf
  CPed *v16; // r0
  bool v17; // zf

  p_m_membership = &pPedGroup->m_membership;
  Leader = CPedGroupMembership::GetLeader(&pPedGroup->m_membership);
  v4 = Leader;
  if ( !Leader || !CPed::IsPlayer(Leader) )
    return 0;
  Member = CPedGroupMembership::GetMember(p_m_membership, 0);
  v6 = Member == 0;
  if ( Member )
    v6 = Member->m_areaCode == v4->m_areaCode;
  if ( !v6 )
    return 0;
  v7 = CPedGroupMembership::GetMember(p_m_membership, 1);
  if ( v7 )
  {
    if ( v7->m_areaCode != v4->m_areaCode )
      return 0;
  }
  v8 = CPedGroupMembership::GetMember(p_m_membership, 2);
  v9 = v8 == 0;
  if ( v8 )
    v9 = v8->m_areaCode == v4->m_areaCode;
  if ( !v9 )
    return 0;
  v10 = CPedGroupMembership::GetMember(p_m_membership, 3);
  v11 = v10 == 0;
  if ( v10 )
    v11 = v10->m_areaCode == v4->m_areaCode;
  if ( !v11 )
    return 0;
  v12 = CPedGroupMembership::GetMember(p_m_membership, 4);
  v13 = v12 == 0;
  if ( v12 )
    v13 = v12->m_areaCode == v4->m_areaCode;
  if ( !v13 )
    return 0;
  v14 = CPedGroupMembership::GetMember(p_m_membership, 5);
  v15 = v14 == 0;
  if ( v14 )
    v15 = v14->m_areaCode == v4->m_areaCode;
  if ( !v15 )
    return 0;
  v16 = CPedGroupMembership::GetMember(p_m_membership, 6);
  v17 = v16 == 0;
  if ( v16 )
    return v16->m_areaCode == v4->m_areaCode;
  return v17;
}

//----- (00377D6A) --------------------------------------------------------
bool __fastcall CEventPlayerCommandToGroup::TakesPriorityOver(
        const CEventPlayerCommandToGroup *this,
        const CEvent *otherEvent)
{
  return 1;
}

//----- (00377D6E) --------------------------------------------------------
bool __fastcall CEventPlayerCommandToGroupAttack::AffectsPedGroup(
        const CEventPlayerCommandToGroupAttack *this,
        CPedGroup *pPedGroup)
{
  CPedGroupMembership *p_m_membership; // r4
  CPed *Member; // r0
  CPed *v5; // r0
  CPed *v6; // r0
  CPed *v7; // r0
  CPed *v8; // r0
  CPed *v9; // r0
  CPed *v10; // r0

  if ( !CEventPlayerCommandToGroup::AffectsPedGroup(this, pPedGroup) )
    return 0;
  p_m_membership = &pPedGroup->m_membership;
  Member = CPedGroupMembership::GetMember(p_m_membership, 0);
  if ( Member )
  {
    if ( (*((_DWORD *)&Member->m_nPedFlags + 2) & 0x20) == 0 )
      return 1;
  }
  v5 = CPedGroupMembership::GetMember(p_m_membership, 1);
  if ( v5 )
  {
    if ( (*((_DWORD *)&v5->m_nPedFlags + 2) & 0x20) == 0 )
      return 1;
  }
  v6 = CPedGroupMembership::GetMember(p_m_membership, 2);
  if ( v6 )
  {
    if ( (*((_DWORD *)&v6->m_nPedFlags + 2) & 0x20) == 0 )
      return 1;
  }
  v7 = CPedGroupMembership::GetMember(p_m_membership, 3);
  if ( v7 )
  {
    if ( (*((_DWORD *)&v7->m_nPedFlags + 2) & 0x20) == 0 )
      return 1;
  }
  v8 = CPedGroupMembership::GetMember(p_m_membership, 4);
  if ( v8 )
  {
    if ( (*((_DWORD *)&v8->m_nPedFlags + 2) & 0x20) == 0 )
      return 1;
  }
  v9 = CPedGroupMembership::GetMember(p_m_membership, 5);
  if ( v9 )
  {
    if ( (*((_DWORD *)&v9->m_nPedFlags + 2) & 0x20) == 0 )
      return 1;
  }
  v10 = CPedGroupMembership::GetMember(p_m_membership, 6);
  return v10 && (*((_DWORD *)&v10->m_nPedFlags + 2) & 0x20) == 0;
}

//----- (00377E08) --------------------------------------------------------
bool __fastcall CEventEscalator::AffectsPed(const CEventEscalator *this, CPed *pPed)
{
  CEntity *m_pEntityStandingOn; // r0
  int m_nModelIndex; // r1

  if ( !CPed::IsAlive(pPed) )
    return 0;
  if ( CPed::IsPlayer(pPed) )
    return 0;
  m_pEntityStandingOn = pPed->m_pEntityStandingOn;
  if ( !m_pEntityStandingOn )
    return 0;
  m_nModelIndex = m_pEntityStandingOn->m_nModelIndex;
  return m_nModelIndex == MI_ESCALATORSTEP || m_nModelIndex == MI_ESCALATORSTEP8;
}

//----- (00377E58) --------------------------------------------------------
bool __fastcall CEventEscalator::TakesPriorityOver(const CEventEscalator *this, const CEvent *otherEvent)
{
  int v3; // r5

  v3 = (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 2))(otherEvent);
  return v3 != (*((int (__fastcall **)(const CEventEscalator *))this->_vptr$CEvent + 2))(this);
}

//----- (00377E7C) --------------------------------------------------------
void __fastcall CEventDanger::CEventDanger(CEventDanger *this, CEntity *pDangerousEntity, float dangerRadius)
{
  this->m_iAccumulatedTime = 0;
  *(_DWORD *)&this->m_bIsPersistent = 13107456;
  this->m_iFacialTaskType = -1;
  this->_vptr$CEvent = (int (**)(void))&off_666C18;
  this->m_pDangerousEntity = pDangerousEntity;
  if ( pDangerousEntity )
    CEntity::RegisterReference(pDangerousEntity, &this->m_pDangerousEntity);
  this->m_dangerRadius = dangerRadius;
}
// 666C18: using guessed type void *off_666C18;

//----- (00377ECC) --------------------------------------------------------
void __fastcall CEventDanger::~CEventDanger(CEventDanger *this)
{
  CEntity *m_pDangerousEntity; // r0
  CEntity **p_m_pDangerousEntity; // r1

  p_m_pDangerousEntity = &this->m_pDangerousEntity;
  m_pDangerousEntity = this->m_pDangerousEntity;
  this->_vptr$CEvent = (int (**)(void))&off_666C18;
  if ( m_pDangerousEntity )
    CEntity::CleanUpOldReference(m_pDangerousEntity, p_m_pDangerousEntity);
}
// 666C18: using guessed type void *;

//----- (00377EF4) --------------------------------------------------------
void __fastcall CEventDanger::~CEventDanger(CEventDanger *this)
{
  CEntity *m_pDangerousEntity; // r0
  CEntity **p_m_pDangerousEntity; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pDangerousEntity = &this->m_pDangerousEntity;
  m_pDangerousEntity = this->m_pDangerousEntity;
  this->_vptr$CEvent = (int (**)(void))&off_666C18;
  if ( m_pDangerousEntity )
    CEntity::CleanUpOldReference(m_pDangerousEntity, p_m_pDangerousEntity);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666C18: using guessed type void *off_666C18;

//----- (00377F48) --------------------------------------------------------
bool __fastcall CEventDanger::AffectsPed(const CEventDanger *this, CPed *pPed)
{
  CVehicle *m_pDangerousEntity; // r2
  bool v3; // zf
  CMatrix *m_pMat; // lr
  CMatrix *v5; // r12
  float32x2_t *p_tx; // r3
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v8; // d16
  unsigned __int64 v9; // d0

  m_pDangerousEntity = (CVehicle *)this->m_pDangerousEntity;
  v3 = m_pDangerousEntity == 0;
  if ( m_pDangerousEntity )
    v3 = m_pDangerousEntity == pPed->m_pMyVehicle;
  if ( v3 )
    return 0;
  m_pMat = m_pDangerousEntity->m_pMat;
  v5 = pPed->m_pMat;
  p_tx = (float32x2_t *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = (float32x2_t *)&m_pDangerousEntity->m_transform;
  p_m_transform = (CSimpleTransform *)&v5->tx;
  if ( !v5 )
    p_m_transform = &pPed->m_transform;
  v8.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.x, (float32x2_t)p_tx->n64_u64[0]).n64_u64[0];
  v9 = vmul_f32(v8, v8).n64_u64[0];
  return (float)((float)(*(float *)&v9 + *((float *)&v9 + 1)) + 0.0) <= (float)(this->m_dangerRadius
                                                                              * this->m_dangerRadius)
      && sub_196854(pPed);
}

//----- (00377FBC) --------------------------------------------------------
bool __fastcall CEventDanger::AffectsPedGroup(const CEventDanger *this, CPedGroup *pPedGroup)
{
  CPed *Leader; // r1
  bool result; // r0
  CEntity *m_pDangerousEntity; // r12
  CMatrix *m_pMat; // r3
  CMatrix *v8; // r5
  float32x2_t *p_tx; // r2
  float32x2_t *p_m_transform; // r1
  float32x2_t v11; // d16
  unsigned __int64 v12; // d0

  if ( !(*((int (__fastcall **)(const CEventDanger *))this->_vptr$CEvent + 11))(this)
    || (*(_BYTE *)((*((int (__fastcall **)(const CEventDanger *))this->_vptr$CEvent + 11))(this) + 58) & 7) != 3 )
  {
    return 0;
  }
  Leader = CPedGroupMembership::GetLeader(&pPedGroup->m_membership);
  result = 0;
  if ( Leader )
  {
    m_pDangerousEntity = this->m_pDangerousEntity;
    m_pMat = Leader->m_pMat;
    v8 = m_pDangerousEntity->m_pMat;
    p_tx = (float32x2_t *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (float32x2_t *)&Leader->m_transform;
    p_m_transform = (float32x2_t *)&v8->tx;
    if ( !v8 )
      p_m_transform = (float32x2_t *)&m_pDangerousEntity->m_transform;
    v11.n64_u64[0] = vsub_f32((float32x2_t)p_tx->n64_u64[0], (float32x2_t)p_m_transform->n64_u64[0]).n64_u64[0];
    v12 = vmul_f32(v11, v11).n64_u64[0];
    if ( (float)((float)(*(float *)&v12 + *((float *)&v12 + 1)) + 0.0) <= (float)(this->m_dangerRadius
                                                                                * this->m_dangerRadius) )
      return 1;
  }
  return result;
}

//----- (00378050) --------------------------------------------------------
CEntity *__fastcall CEventDanger::GetSourceEntity(const CEventDanger *this)
{
  CEntity *m_pDangerousEntity; // r1
  CEntity *result; // r0

  m_pDangerousEntity = this->m_pDangerousEntity;
  if ( !m_pDangerousEntity )
    return 0;
  if ( (*(_BYTE *)&m_pDangerousEntity->m_info & 7) != 2 )
    return this->m_pDangerousEntity;
  result = (CEntity *)m_pDangerousEntity[18].m_pLastRenderedLink;
  if ( !result )
    return m_pDangerousEntity;
  return result;
}

//----- (00378078) --------------------------------------------------------
void __fastcall CEventAcquaintancePed::~CEventAcquaintancePed(CEventAcquaintancePed *this)
{
  CPed *m_pAcquaintancePed; // r0
  CEntity **p_m_pAcquaintancePed; // r1

  p_m_pAcquaintancePed = &this->m_pAcquaintancePed;
  m_pAcquaintancePed = this->m_pAcquaintancePed;
  this->_vptr$CEvent = (int (**)(void))&off_66655C;
  if ( m_pAcquaintancePed )
    CEntity::CleanUpOldReference(m_pAcquaintancePed, p_m_pAcquaintancePed);
}
// 66655C: using guessed type void *off_66655C;

//----- (003780A0) --------------------------------------------------------
void __fastcall CEventBuildingCollision::~CEventBuildingCollision(CEventBuildingCollision *this)
{
  CBuilding *m_pBuilding; // r0
  CBuilding **p_m_pBuilding; // r1

  p_m_pBuilding = &this->m_pBuilding;
  m_pBuilding = this->m_pBuilding;
  this->_vptr$CEvent = (int (**)(void))&off_665F44;
  if ( m_pBuilding )
    CEntity::CleanUpOldReference(m_pBuilding, p_m_pBuilding);
}
// 665F44: using guessed type void *off_665F44;

//----- (003780C8) --------------------------------------------------------
void __fastcall CEventAreaCodes::~CEventAreaCodes(CEventAreaCodes *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CEvent = (int (**)(void))&off_666B7C;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
}
// 666B7C: using guessed type void *off_666B7C;

//----- (003780F0) --------------------------------------------------------
void __fastcall CEventPlayerCommandToGroup::~CEventPlayerCommandToGroup(CEventPlayerCommandToGroup *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_666BC8;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
}
// 666BC8: using guessed type void *;

//----- (0037811A) --------------------------------------------------------
bool __fastcall CEvent::TakesPriorityOver(const CEvent *this, const CEvent *otherEvent)
{
  int v3; // r5

  v3 = (*((int (__fastcall **)(const CEvent *))this->_vptr$CEvent + 3))(this);
  return v3 >= (*((int (__fastcall **)(const CEvent *))otherEvent->_vptr$CEvent + 3))(otherEvent);
}

//----- (0037813C) --------------------------------------------------------
void __fastcall CEventAcquaintancePedHateBadlyLit::~CEventAcquaintancePedHateBadlyLit(
        CEventAcquaintancePedHateBadlyLit *this)
{
  CPed *m_pAcquaintancePed; // r0
  CEntity **p_m_pAcquaintancePed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pAcquaintancePed = &this->m_pAcquaintancePed;
  m_pAcquaintancePed = this->m_pAcquaintancePed;
  this->_vptr$CEvent = (int (**)(void))&off_66655C;
  if ( m_pAcquaintancePed )
    CEntity::CleanUpOldReference(m_pAcquaintancePed, p_m_pAcquaintancePed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 66655C: using guessed type void *off_66655C;

//----- (00378190) --------------------------------------------------------
int __fastcall CEventAcquaintancePedHateBadlyLit::GetEventType(const CEventAcquaintancePedHateBadlyLit *this)
{
  return 63;
}

//----- (00378194) --------------------------------------------------------
int __fastcall CEventAcquaintancePedHateBadlyLit::GetEventPriority(const CEventAcquaintancePedHateBadlyLit *this)
{
  return 25;
}

//----- (00378198) --------------------------------------------------------
bool __fastcall CEventAcquaintancePedHateBadlyLit::CanBeInterruptedBySameEvent(
        const CEventAcquaintancePedHateBadlyLit *this)
{
  return 1;
}

//----- (0037819C) --------------------------------------------------------
CEvent *__fastcall CEventAcquaintancePedHateBadlyLit::CloneEditable(const CEventAcquaintancePedHateBadlyLit *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nSize; // r2
  int32 m_nFreeIndex; // r4
  uint8 *m_aFlags; // r6
  int v6; // r5
  __int64 v7; // kr08_8
  CVector *p_m_vTargetPosAtSpotTime; // r6
  __int64 v9; // d16
  int v10; // r1
  __int64 *v11; // r2
  __int64 v12; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pAcquaintancePed;
  p_m_vTargetPosAtSpotTime = &this->m_vTargetPosAtSpotTime;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_66655C;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  if ( (_DWORD)v7 )
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 16));
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  *(_DWORD *)m_nFreeIndex = &off_666C68;
  v9 = *(_QWORD *)&p_m_vTargetPosAtSpotTime->x;
  *(RwReal *)(m_nFreeIndex + 32) = p_m_vTargetPosAtSpotTime->z;
  *(_QWORD *)(m_nFreeIndex + 24) = v9;
  if ( HIDWORD(v7) == -1 )
  {
    *(_DWORD *)(m_nFreeIndex + 20) = CTimer::m_snTimeInMilliseconds;
    v10 = *(_DWORD *)(v7 + 20);
    v11 = (__int64 *)(v10 + 48);
    if ( !v10 )
      v11 = (__int64 *)(v7 + 4);
    v12 = *v11;
    *(_DWORD *)(m_nFreeIndex + 32) = *((_DWORD *)v11 + 2);
    *(_QWORD *)(m_nFreeIndex + 24) = v12;
  }
  return (CEvent *)m_nFreeIndex;
}
// 66655C: using guessed type void *off_66655C;
// 666C68: using guessed type void *off_666C68;

//----- (0037828C) --------------------------------------------------------
void __fastcall CEventSeenCop::~CEventSeenCop(CEventSeenCop *this)
{
  CPed *m_pAcquaintancePed; // r0
  CEntity **p_m_pAcquaintancePed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pAcquaintancePed = &this->m_pAcquaintancePed;
  m_pAcquaintancePed = this->m_pAcquaintancePed;
  this->_vptr$CEvent = (int (**)(void))&off_66655C;
  if ( m_pAcquaintancePed )
    CEntity::CleanUpOldReference(m_pAcquaintancePed, p_m_pAcquaintancePed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 66655C: using guessed type void *off_66655C;

//----- (003782E0) --------------------------------------------------------
int __fastcall CEventSeenCop::GetEventType(const CEventSeenCop *this)
{
  return 72;
}

//----- (003782E4) --------------------------------------------------------
int __fastcall CEventSeenCop::GetEventPriority(const CEventSeenCop *this)
{
  return 21;
}

//----- (003782E8) --------------------------------------------------------
CEvent *__fastcall CEventSeenCop::CloneEditable(const CEventSeenCop *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pAcquaintancePed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pAcquaintancePed = this->m_pAcquaintancePed;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_66655C;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pAcquaintancePed;
  if ( m_pAcquaintancePed )
    CEntity::RegisterReference(m_pAcquaintancePed, (CEntity **)(m_nFreeIndex + 16));
  *(_DWORD *)m_nFreeIndex = &off_666CB8;
  return (CEvent *)m_nFreeIndex;
}
// 66655C: using guessed type void *off_66655C;
// 666CB8: using guessed type void *;
// 67829C: using guessed type void *`vtable for'CEventSeenCop;

//----- (00378390) --------------------------------------------------------
void __fastcall CEventHealthLow::~CEventHealthLow(CEventHealthLow *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (003783C0) --------------------------------------------------------
int __fastcall CEventHealthLow::GetEventType(const CEventHealthLow *this)
{
  return 53;
}

//----- (003783C4) --------------------------------------------------------
int __fastcall CEventHealthLow::GetEventPriority(const CEventHealthLow *this)
{
  return 68;
}

//----- (003783C8) --------------------------------------------------------
int __fastcall CEventHealthLow::GetLifeTime(const CEventHealthLow *this)
{
  return 0;
}

//----- (003783CC) --------------------------------------------------------
bool __fastcall CEvent::AffectsPedGroup(const CEvent *this, CPedGroup *pPedGroup)
{
  return 1;
}

//----- (003783D0) --------------------------------------------------------
CEntity *__fastcall CEvent::GetSourceEntity(const CEvent *this)
{
  return 0;
}

//----- (003783D4) --------------------------------------------------------
bool __fastcall CEvent::CanBeInterruptedBySameEvent(const CEvent *this)
{
  return 0;
}

//----- (003783D8) --------------------------------------------------------
CEvent *__fastcall CEventHealthLow::CloneEditable(const CEventHealthLow *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_iAccumulatedTime = 0;
  *(_DWORD *)&result->m_bIsPersistent = 13107456;
  LOWORD(result[1]._vptr$CEvent) = -1;
  result->_vptr$CEvent = (int (**)(void))&off_666D08;
  return result;
}
// 666D08: using guessed type void *;

//----- (0037845C) --------------------------------------------------------
void __fastcall CEventHealthReallyLow::~CEventHealthReallyLow(CEventHealthReallyLow *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (0037848C) --------------------------------------------------------
int __fastcall CEventHealthReallyLow::GetEventType(const CEventHealthReallyLow *this)
{
  return 52;
}

//----- (00378490) --------------------------------------------------------
int __fastcall CEventHealthReallyLow::GetEventPriority(const CEventHealthReallyLow *this)
{
  return 69;
}

//----- (00378494) --------------------------------------------------------
int __fastcall CEventHealthReallyLow::GetLifeTime(const CEventHealthReallyLow *this)
{
  return 0;
}

//----- (00378498) --------------------------------------------------------
CEvent *__fastcall CEventHealthReallyLow::CloneEditable(const CEventHealthReallyLow *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_iAccumulatedTime = 0;
  *(_DWORD *)&result->m_bIsPersistent = 13107456;
  LOWORD(result[1]._vptr$CEvent) = -1;
  result->_vptr$CEvent = (int (**)(void))&off_666D58;
  return result;
}
// 666D58: using guessed type void *;

//----- (0037851C) --------------------------------------------------------
void __fastcall CEventLowAngerAtPlayer::~CEventLowAngerAtPlayer(CEventLowAngerAtPlayer *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (0037854C) --------------------------------------------------------
int __fastcall CEventLowAngerAtPlayer::GetEventType(const CEventLowAngerAtPlayer *this)
{
  return 50;
}

//----- (00378550) --------------------------------------------------------
int __fastcall CEventLowAngerAtPlayer::GetEventPriority(const CEventLowAngerAtPlayer *this)
{
  return 33;
}

//----- (00378554) --------------------------------------------------------
int __fastcall CEventLowAngerAtPlayer::GetLifeTime(const CEventLowAngerAtPlayer *this)
{
  return 0;
}

//----- (00378558) --------------------------------------------------------
CEvent *__fastcall CEventLowAngerAtPlayer::CloneEditable(const CEventLowAngerAtPlayer *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_iAccumulatedTime = 0;
  *(_DWORD *)&result->m_bIsPersistent = 13107456;
  LOWORD(result[1]._vptr$CEvent) = -1;
  result->_vptr$CEvent = (int (**)(void))&off_666DA8;
  return result;
}
// 666DA8: using guessed type void *;

//----- (003785DC) --------------------------------------------------------
void __fastcall CEventHighAngerAtPlayer::~CEventHighAngerAtPlayer(CEventHighAngerAtPlayer *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (0037860C) --------------------------------------------------------
int __fastcall CEventHighAngerAtPlayer::GetEventType(const CEventHighAngerAtPlayer *this)
{
  return 51;
}

//----- (00378610) --------------------------------------------------------
int __fastcall CEventHighAngerAtPlayer::GetEventPriority(const CEventHighAngerAtPlayer *this)
{
  return 34;
}

//----- (00378614) --------------------------------------------------------
int __fastcall CEventHighAngerAtPlayer::GetLifeTime(const CEventHighAngerAtPlayer *this)
{
  return 0;
}

//----- (00378618) --------------------------------------------------------
CEvent *__fastcall CEventHighAngerAtPlayer::CloneEditable(const CEventHighAngerAtPlayer *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_iAccumulatedTime = 0;
  *(_DWORD *)&result->m_bIsPersistent = 13107456;
  LOWORD(result[1]._vptr$CEvent) = -1;
  result->_vptr$CEvent = (int (**)(void))&off_666DF8;
  return result;
}
// 666DF8: using guessed type void *;

//----- (0037869C) --------------------------------------------------------
void __fastcall CEventLeaderEnteredCarAsDriver::~CEventLeaderEnteredCarAsDriver(CEventLeaderEnteredCarAsDriver *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666E48;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
}
// 666E48: using guessed type void *off_666E48;

//----- (003786C4) --------------------------------------------------------
void __fastcall CEventLeaderEnteredCarAsDriver::~CEventLeaderEnteredCarAsDriver(CEventLeaderEnteredCarAsDriver *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_666E48;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666E48: using guessed type void *off_666E48;

//----- (00378718) --------------------------------------------------------
int __fastcall CEventLeaderEnteredCarAsDriver::GetEventType(const CEventLeaderEnteredCarAsDriver *this)
{
  return 54;
}

//----- (0037871C) --------------------------------------------------------
int __fastcall CEventLeaderEnteredCarAsDriver::GetEventPriority(const CEventLeaderEnteredCarAsDriver *this)
{
  return 46;
}

//----- (00378720) --------------------------------------------------------
int __fastcall CEventLeaderEnteredCarAsDriver::GetLifeTime(const CEventLeaderEnteredCarAsDriver *this)
{
  return 0;
}

//----- (00378724) --------------------------------------------------------
bool __fastcall CEventLeaderEnteredCarAsDriver::AffectsPed(const CEventLeaderEnteredCarAsDriver *this, CPed *pPed)
{
  return 0;
}

//----- (00378728) --------------------------------------------------------
bool __fastcall CEventLeaderEnteredCarAsDriver::CanBeInterruptedBySameEvent(const CEventLeaderEnteredCarAsDriver *this)
{
  return 1;
}

//----- (0037872C) --------------------------------------------------------
CEvent *__fastcall CEventLeaderEnteredCarAsDriver::CloneEditable(const CEventLeaderEnteredCarAsDriver *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pVehicle = this->m_pVehicle;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666E48;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pVehicle;
  if ( m_pVehicle )
    CEntity::RegisterReference(m_pVehicle, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 666E48: using guessed type void *off_666E48;

//----- (003787C4) --------------------------------------------------------
void __fastcall CEventLeaderExitedCarAsDriver::~CEventLeaderExitedCarAsDriver(CEventLeaderExitedCarAsDriver *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (003787F4) --------------------------------------------------------
int __fastcall CEventLeaderExitedCarAsDriver::GetEventType(const CEventLeaderExitedCarAsDriver *this)
{
  return 55;
}

//----- (003787F8) --------------------------------------------------------
int __fastcall CEventLeaderExitedCarAsDriver::GetEventPriority(const CEventLeaderExitedCarAsDriver *this)
{
  return 47;
}

//----- (003787FC) --------------------------------------------------------
int __fastcall CEventLeaderExitedCarAsDriver::GetLifeTime(const CEventLeaderExitedCarAsDriver *this)
{
  return 0;
}

//----- (00378800) --------------------------------------------------------
bool __fastcall CEventLeaderExitedCarAsDriver::AffectsPed(const CEventLeaderExitedCarAsDriver *this, CPed *pPed)
{
  return 0;
}

//----- (00378804) --------------------------------------------------------
CEvent *__fastcall CEventLeaderExitedCarAsDriver::CloneEditable(const CEventLeaderExitedCarAsDriver *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_iAccumulatedTime = 0;
  *(_DWORD *)&result->m_bIsPersistent = 13107456;
  LOWORD(result[1]._vptr$CEvent) = -1;
  result->_vptr$CEvent = (int (**)(void))&off_666E98;
  return result;
}
// 666E98: using guessed type void *;

//----- (00378888) --------------------------------------------------------
void __fastcall CEventLeaderQuitEnteringCarAsDriver::~CEventLeaderQuitEnteringCarAsDriver(
        CEventLeaderQuitEnteringCarAsDriver *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (003788B8) --------------------------------------------------------
int __fastcall CEventLeaderQuitEnteringCarAsDriver::GetEventType(const CEventLeaderQuitEnteringCarAsDriver *this)
{
  return 57;
}

//----- (003788BC) --------------------------------------------------------
int __fastcall CEventLeaderQuitEnteringCarAsDriver::GetEventPriority(const CEventLeaderQuitEnteringCarAsDriver *this)
{
  return 48;
}

//----- (003788C0) --------------------------------------------------------
int __fastcall CEventLeaderQuitEnteringCarAsDriver::GetLifeTime(const CEventLeaderQuitEnteringCarAsDriver *this)
{
  return 0;
}

//----- (003788C4) --------------------------------------------------------
CEvent *__fastcall CEventLeaderQuitEnteringCarAsDriver::Clone(const CEventLeaderQuitEnteringCarAsDriver *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_bIsPersistent = 0;
  result->_vptr$CEvent = (int (**)(void))&off_666EE8;
  result->m_iAccumulatedTime = 0;
  return result;
}
// 666EE8: using guessed type void *;

//----- (0037893C) --------------------------------------------------------
bool __fastcall CEventLeaderQuitEnteringCarAsDriver::AffectsPed(
        const CEventLeaderQuitEnteringCarAsDriver *this,
        CPed *pPed)
{
  return 0;
}

//----- (00378940) --------------------------------------------------------
bool __fastcall CEvent::HasEditableResponse(const CEvent *this)
{
  return 0;
}

//----- (00378944) --------------------------------------------------------
void __fastcall CEventOnFire::~CEventOnFire(CEventOnFire *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00378974) --------------------------------------------------------
int __fastcall CEventOnFire::GetEventType(const CEventOnFire *this)
{
  return 58;
}

//----- (00378978) --------------------------------------------------------
int __fastcall CEventOnFire::GetEventPriority(const CEventOnFire *this)
{
  return 66;
}

//----- (0037897C) --------------------------------------------------------
int __fastcall CEventOnFire::GetLifeTime(const CEventOnFire *this)
{
  return 0;
}

//----- (00378980) --------------------------------------------------------
CEvent *__fastcall CEventOnFire::Clone(const CEventOnFire *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_bIsPersistent = 0;
  result->_vptr$CEvent = (int (**)(void))&off_666F34;
  result->m_iAccumulatedTime = 0;
  return result;
}
// 666F34: using guessed type void *;

//----- (003789F8) --------------------------------------------------------
float __fastcall CEventOnFire::GetLocalSoundLevel(const CEventOnFire *this)
{
  return 60.0;
}

//----- (00378A00) --------------------------------------------------------
void __fastcall CEventPotentialWalkIntoBuilding::~CEventPotentialWalkIntoBuilding(
        CEventPotentialWalkIntoBuilding *this)
{
  CBuilding *m_pBuilding; // r0
  CBuilding **p_m_pBuilding; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pBuilding = &this->m_pBuilding;
  m_pBuilding = this->m_pBuilding;
  this->_vptr$CEvent = (int (**)(void))&off_665F44;
  if ( m_pBuilding )
    CEntity::CleanUpOldReference(m_pBuilding, p_m_pBuilding);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 665F44: using guessed type void *off_665F44;

//----- (00378A54) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoBuilding::GetEventType(const CEventPotentialWalkIntoBuilding *this)
{
  return 60;
}

//----- (00378A58) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoBuilding::GetEventPriority(const CEventPotentialWalkIntoBuilding *this)
{
  return 30;
}

//----- (00378A5C) --------------------------------------------------------
int __fastcall CEventBuildingCollision::GetLifeTime(const CEventBuildingCollision *this)
{
  return 0;
}

//----- (00378A60) --------------------------------------------------------
CEvent *__fastcall CEventPotentialWalkIntoBuilding::Clone(const CEventPotentialWalkIntoBuilding *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  int16 m_iMoveState; // r3
  CBuilding *m_pBuilding; // r2
  __int64 v9; // d16
  __int64 v10; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_iMoveState = this->m_iMoveState;
  m_pBuilding = this->m_pBuilding;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_WORD *)(m_nFreeIndex + 10) = 0;
  *(_WORD *)(m_nFreeIndex + 12) = m_iMoveState;
  *(_DWORD *)(m_nFreeIndex + 16) = 0;
  *(_DWORD *)m_nFreeIndex = &off_665F44;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 20) = m_pBuilding;
  v9 = *(_QWORD *)&this->m_vNormal.x;
  *(RwReal *)(m_nFreeIndex + 32) = this->m_vNormal.z;
  *(_QWORD *)(m_nFreeIndex + 24) = v9;
  v10 = *(_QWORD *)&this->m_vPos.x;
  *(RwReal *)(m_nFreeIndex + 44) = this->m_vPos.z;
  *(_QWORD *)(m_nFreeIndex + 36) = v10;
  if ( m_pBuilding )
    CEntity::RegisterReference(m_pBuilding, (CEntity **)(m_nFreeIndex + 20));
  *(_DWORD *)m_nFreeIndex = &off_666F80;
  return (CEvent *)m_nFreeIndex;
}
// 665F44: using guessed type void *off_665F44;
// 666F80: using guessed type void *;

//----- (00378B20) --------------------------------------------------------
bool __fastcall CEventBuildingCollision::CanBeInterruptedBySameEvent(const CEventBuildingCollision *this)
{
  return 1;
}

//----- (00378B24) --------------------------------------------------------
void __fastcall CEventInteriorUseInfo::~CEventInteriorUseInfo(CEventInteriorUseInfo *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00378B54) --------------------------------------------------------
int __fastcall CEventInteriorUseInfo::GetEventType(const CEventInteriorUseInfo *this)
{
  return 81;
}

//----- (00378B58) --------------------------------------------------------
int __fastcall CEventInteriorUseInfo::GetEventPriority(const CEventInteriorUseInfo *this)
{
  return 9;
}

//----- (00378B5C) --------------------------------------------------------
int __fastcall CEventInteriorUseInfo::GetLifeTime(const CEventInteriorUseInfo *this)
{
  return 0;
}

//----- (00378B60) --------------------------------------------------------
CEvent *__fastcall CEventInteriorUseInfo::Clone(const CEventInteriorUseInfo *this)
{
  int v1; // lr
  CEventPool *v2; // r2
  int32 m_nFreeIndex; // r1
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r3
  int v6; // r4
  __int64 v7; // kr08_8
  int32 m_duration; // r2
  bool8 m_doInstantly; // r5

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pInteriorInfo;
  m_duration = this->m_duration;
  m_doInstantly = this->m_doInstantly;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_QWORD *)(m_nFreeIndex + 12) = v7;
  *(_DWORD *)(m_nFreeIndex + 20) = m_duration;
  *(_BYTE *)(m_nFreeIndex + 24) = m_doInstantly;
  *(_DWORD *)m_nFreeIndex = &off_666FCC;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  return (CEvent *)m_nFreeIndex;
}
// 666FCC: using guessed type void *;

//----- (00378BF0) --------------------------------------------------------
bool __fastcall CEventInteriorUseInfo::AffectsPed(const CEventInteriorUseInfo *this, CPed *pPed)
{
  return 1;
}

//----- (00378BF4) --------------------------------------------------------
void __fastcall CEventSignalAtPed::~CEventSignalAtPed(CEventSignalAtPed *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_667018;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
}
// 667018: using guessed type void *;

//----- (00378C1C) --------------------------------------------------------
void __fastcall CEventSignalAtPed::~CEventSignalAtPed(CEventSignalAtPed *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_667018;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 667018: using guessed type void *off_667018;

//----- (00378C70) --------------------------------------------------------
int __fastcall CEventSignalAtPed::GetEventType(const CEventSignalAtPed *this)
{
  return 88;
}

//----- (00378C74) --------------------------------------------------------
int __fastcall CEventSignalAtPed::GetEventPriority(const CEventSignalAtPed *this)
{
  return 10;
}

//----- (00378C78) --------------------------------------------------------
int __fastcall CEventSignalAtPed::GetLifeTime(const CEventSignalAtPed *this)
{
  return 0;
}

//----- (00378C7C) --------------------------------------------------------
CEvent *__fastcall CEventSignalAtPed::Clone(const CEventSignalAtPed *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nSize; // r2
  int32 m_nFreeIndex; // r4
  uint8 *m_aFlags; // r6
  int v6; // r5
  __int64 v7; // kr08_8
  bool8 m_playAnimAtEnd; // r6
  CEvent *result; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pPed;
  m_playAnimAtEnd = this->m_playAnimAtEnd;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_667018;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = v7;
  if ( (_DWORD)v7 )
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 12));
  *(_BYTE *)(m_nFreeIndex + 20) = m_playAnimAtEnd;
  result = (CEvent *)m_nFreeIndex;
  *(_DWORD *)(m_nFreeIndex + 16) = HIDWORD(v7);
  return result;
}
// 667018: using guessed type void *off_667018;

//----- (00378D10) --------------------------------------------------------
bool __fastcall CEventSignalAtPed::AffectsPed(const CEventSignalAtPed *this, CPed *pPed)
{
  return 1;
}

//----- (00378D14) --------------------------------------------------------
void __fastcall CEventLeanOnVehicle::~CEventLeanOnVehicle(CEventLeanOnVehicle *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_667064;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
}
// 667064: using guessed type void *;

//----- (00378D3C) --------------------------------------------------------
void __fastcall CEventLeanOnVehicle::~CEventLeanOnVehicle(CEventLeanOnVehicle *this)
{
  CVehicle *m_pVehicle; // r0
  CEntity **p_m_pVehicle; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pVehicle = &this->m_pVehicle;
  m_pVehicle = this->m_pVehicle;
  this->_vptr$CEvent = (int (**)(void))&off_667064;
  if ( m_pVehicle )
    CEntity::CleanUpOldReference(m_pVehicle, p_m_pVehicle);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 667064: using guessed type void *off_667064;

//----- (00378D90) --------------------------------------------------------
int __fastcall CEventLeanOnVehicle::GetEventType(const CEventLeanOnVehicle *this)
{
  return 92;
}

//----- (00378D94) --------------------------------------------------------
int __fastcall CEventLeanOnVehicle::GetEventPriority(const CEventLeanOnVehicle *this)
{
  return 12;
}

//----- (00378D98) --------------------------------------------------------
int __fastcall CEventLeanOnVehicle::GetLifeTime(const CEventLeanOnVehicle *this)
{
  return 0;
}

//----- (00378D9C) --------------------------------------------------------
CEvent *__fastcall CEventLeanOnVehicle::Clone(const CEventLeanOnVehicle *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pVehicle;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)(m_nFreeIndex + 16) = HIDWORD(v7);
  *(_DWORD *)m_nFreeIndex = &off_667064;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = v7;
  if ( (_DWORD)v7 )
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 667064: using guessed type void *off_667064;

//----- (00378E2C) --------------------------------------------------------
bool __fastcall CEventLeanOnVehicle::AffectsPed(const CEventLeanOnVehicle *this, CPed *pPed)
{
  return 1;
}

//----- (00378E30) --------------------------------------------------------
void __fastcall CEventPassObject::~CEventPassObject(CEventPassObject *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_6670B0;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
}
// 6670B0: using guessed type void *;

//----- (00378E58) --------------------------------------------------------
void __fastcall CEventPassObject::~CEventPassObject(CEventPassObject *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_6670B0;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6670B0: using guessed type void *off_6670B0;

//----- (00378EAC) --------------------------------------------------------
int __fastcall CEventPassObject::GetEventType(const CEventPassObject *this)
{
  return 89;
}

//----- (00378EB0) --------------------------------------------------------
int __fastcall CEventPassObject::GetEventPriority(const CEventPassObject *this)
{
  return 11;
}

//----- (00378EB4) --------------------------------------------------------
int __fastcall CEventPassObject::GetLifeTime(const CEventPassObject *this)
{
  return 0;
}

//----- (00378EB8) --------------------------------------------------------
CEvent *__fastcall CEventPassObject::Clone(const CEventPassObject *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  bool8 m_isPasser; // r5
  CPed *m_pPed; // r0
  CEvent *result; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_isPasser = this->m_isPasser;
  m_pPed = this->m_pPed;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_6670B0;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pPed;
  if ( m_pPed )
    CEntity::RegisterReference(m_pPed, (CEntity **)(m_nFreeIndex + 12));
  result = (CEvent *)m_nFreeIndex;
  *(_BYTE *)(m_nFreeIndex + 16) = m_isPasser;
  return result;
}
// 6670B0: using guessed type void *off_6670B0;

//----- (00378F40) --------------------------------------------------------
bool __fastcall CEventPassObject::AffectsPed(const CEventPassObject *this, CPed *pPed)
{
  return 1;
}

//----- (00378F44) --------------------------------------------------------
void __fastcall CEventSoundLoud::~CEventSoundLoud(CEventSoundLoud *this)
{
  CEntity *m_pEntityMakingSound; // r0
  CEntity **p_m_pEntityMakingSound; // r1

  p_m_pEntityMakingSound = &this->m_pEntityMakingSound;
  m_pEntityMakingSound = this->m_pEntityMakingSound;
  this->_vptr$CEvent = (int (**)(void))&off_6670FC;
  if ( m_pEntityMakingSound )
    CEntity::CleanUpOldReference(m_pEntityMakingSound, p_m_pEntityMakingSound);
}
// 6670FC: using guessed type void *;

//----- (00378F6C) --------------------------------------------------------
void __fastcall CEventSoundLoud::~CEventSoundLoud(CEventSoundLoud *this)
{
  CEntity *m_pEntityMakingSound; // r0
  CEntity **p_m_pEntityMakingSound; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pEntityMakingSound = &this->m_pEntityMakingSound;
  m_pEntityMakingSound = this->m_pEntityMakingSound;
  this->_vptr$CEvent = (int (**)(void))&off_6670FC;
  if ( m_pEntityMakingSound )
    CEntity::CleanUpOldReference(m_pEntityMakingSound, p_m_pEntityMakingSound);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 6670FC: using guessed type void *off_6670FC;

//----- (00378FC0) --------------------------------------------------------
int __fastcall CEventSoundLoud::GetEventType(const CEventSoundLoud *this)
{
  return 61;
}

//----- (00378FC4) --------------------------------------------------------
int __fastcall CEventSoundLoud::GetEventPriority(const CEventSoundLoud *this)
{
  return 16;
}

//----- (00378FC8) --------------------------------------------------------
int __fastcall CEventSoundLoud::GetLifeTime(const CEventSoundLoud *this)
{
  return 0;
}

//----- (00378FCC) --------------------------------------------------------
CEntity *__fastcall CEventSoundLoud::GetSourceEntity(const CEventSoundLoud *this)
{
  return this->m_pEntityMakingSound;
}

//----- (00378FD0) --------------------------------------------------------
float __fastcall CEventSoundLoud::GetLocalSoundLevel(const CEventSoundLoud *this)
{
  return this->m_Volume;
}

//----- (00378FD4) --------------------------------------------------------
CEvent *__fastcall CEventSoundLoud::CloneEditable(const CEventSoundLoud *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pEntityMakingSound;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  *(_DWORD *)m_nFreeIndex = &off_6670FC;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 6670FC: using guessed type void *off_6670FC;

//----- (00379070) --------------------------------------------------------
void __fastcall CEventSoundQuiet::~CEventSoundQuiet(CEventSoundQuiet *this)
{
  CEntity *m_pEntityMakingSound; // r0
  CEntity **p_m_pEntityMakingSound; // r1

  p_m_pEntityMakingSound = &this->m_pEntityMakingSound;
  m_pEntityMakingSound = this->m_pEntityMakingSound;
  this->_vptr$CEvent = (int (**)(void))&off_66714C;
  if ( m_pEntityMakingSound )
    CEntity::CleanUpOldReference(m_pEntityMakingSound, p_m_pEntityMakingSound);
}
// 66714C: using guessed type void *off_66714C;

//----- (00379098) --------------------------------------------------------
void __fastcall CEventSoundQuiet::~CEventSoundQuiet(CEventSoundQuiet *this)
{
  CEntity *m_pEntityMakingSound; // r0
  CEntity **p_m_pEntityMakingSound; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pEntityMakingSound = &this->m_pEntityMakingSound;
  m_pEntityMakingSound = this->m_pEntityMakingSound;
  this->_vptr$CEvent = (int (**)(void))&off_66714C;
  if ( m_pEntityMakingSound )
    CEntity::CleanUpOldReference(m_pEntityMakingSound, p_m_pEntityMakingSound);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 66714C: using guessed type void *off_66714C;

//----- (003790EC) --------------------------------------------------------
int __fastcall CEventSoundQuiet::GetEventType(const CEventSoundQuiet *this)
{
  return 62;
}

//----- (003790F0) --------------------------------------------------------
int __fastcall CEventSoundQuiet::GetEventPriority(const CEventSoundQuiet *this)
{
  return 8;
}

//----- (003790F4) --------------------------------------------------------
int __fastcall CEventSoundQuiet::GetLifeTime(const CEventSoundQuiet *this)
{
  return 0;
}

//----- (003790F8) --------------------------------------------------------
CEntity *__fastcall CEventSoundQuiet::GetSourceEntity(const CEventSoundQuiet *this)
{
  return this->m_pEntityMakingSound;
}

//----- (003790FC) --------------------------------------------------------
float __fastcall CEventSoundQuiet::GetLocalSoundLevel(const CEventSoundQuiet *this)
{
  return this->m_Volume;
}

//----- (00379100) --------------------------------------------------------
bool __fastcall CEventSoundQuiet::CanBeInterruptedBySameEvent(const CEventSoundQuiet *this)
{
  return 1;
}

//----- (00379104) --------------------------------------------------------
CEvent *__fastcall CEventSoundQuiet::CloneEditable(const CEventSoundQuiet *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8
  int m_iTimeHeard; // r3
  __int64 v9; // d16
  int v11; // r2
  int v12; // r1
  __int64 *v13; // r3
  __int64 v14; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pEntityMakingSound;
  m_iTimeHeard = this->m_iTimeHeard;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  *(_DWORD *)(m_nFreeIndex + 24) = m_iTimeHeard;
  *(_DWORD *)m_nFreeIndex = &off_66714C;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  v9 = *(_QWORD *)&this->m_vTargetPosAtHeardTime.x;
  *(RwReal *)(m_nFreeIndex + 36) = this->m_vTargetPosAtHeardTime.z;
  *(_QWORD *)(m_nFreeIndex + 28) = v9;
  if ( (_DWORD)v7 )
  {
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 16));
    m_iTimeHeard = *(_DWORD *)(m_nFreeIndex + 24);
  }
  if ( m_iTimeHeard != -1 )
    return (CEvent *)m_nFreeIndex;
  v11 = *(_DWORD *)(m_nFreeIndex + 16);
  *(_DWORD *)(m_nFreeIndex + 24) = CTimer::m_snTimeInMilliseconds;
  v12 = *(_DWORD *)(v11 + 20);
  v13 = (__int64 *)(v12 + 48);
  if ( !v12 )
    v13 = (__int64 *)(v11 + 4);
  v14 = *v13;
  *(_DWORD *)(m_nFreeIndex + 36) = *((_DWORD *)v13 + 2);
  *(_QWORD *)(m_nFreeIndex + 28) = v14;
  return (CEvent *)m_nFreeIndex;
}
// 66714C: using guessed type void *off_66714C;

//----- (003791EC) --------------------------------------------------------
void __fastcall CEventLeaderEntryExit::~CEventLeaderEntryExit(CEventLeaderEntryExit *this)
{
  CPed *m_pTargetPed; // r0
  CEntity **p_m_pTargetPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pTargetPed = &this->m_pTargetPed;
  m_pTargetPed = this->m_pTargetPed;
  this->_vptr$CEvent = (int (**)(void))&off_666B7C;
  if ( m_pTargetPed )
    CEntity::CleanUpOldReference(m_pTargetPed, p_m_pTargetPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666B7C: using guessed type void *off_666B7C;

//----- (00379240) --------------------------------------------------------
int __fastcall CEventLeaderEntryExit::GetEventType(const CEventLeaderEntryExit *this)
{
  return 77;
}

//----- (00379244) --------------------------------------------------------
int __fastcall CEventAreaCodes::GetEventPriority(const CEventAreaCodes *this)
{
  return 55;
}

//----- (00379248) --------------------------------------------------------
int __fastcall CEventLeaderEntryExit::GetLifeTime(const CEventLeaderEntryExit *this)
{
  return 0;
}

//----- (0037924C) --------------------------------------------------------
CEvent *__fastcall CEventLeaderEntryExit::Clone(const CEventLeaderEntryExit *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pTargetPed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pTargetPed = this->m_pTargetPed;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666B7C;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pTargetPed;
  if ( m_pTargetPed )
    CEntity::RegisterReference(m_pTargetPed, (CEntity **)(m_nFreeIndex + 12));
  *(_DWORD *)m_nFreeIndex = &off_66719C;
  return (CEvent *)m_nFreeIndex;
}
// 666B7C: using guessed type void *off_666B7C;
// 66719C: using guessed type void *off_66719C;

//----- (003792E4) --------------------------------------------------------
bool __fastcall CEventLeaderEntryExit::CanBeInterruptedBySameEvent(const CEventLeaderEntryExit *this)
{
  return 1;
}

//----- (003792E8) --------------------------------------------------------
void __fastcall CEventPlayerCommandToGroupAttack::~CEventPlayerCommandToGroupAttack(
        CEventPlayerCommandToGroupAttack *this)
{
  CPed *m_pPed; // r0
  CEntity **p_m_pPed; // r1
  CEventPool *v4; // r0
  int v5; // r1

  p_m_pPed = &this->m_pPed;
  m_pPed = this->m_pPed;
  this->_vptr$CEvent = (int (**)(void))&off_666BC8;
  if ( m_pPed )
    CEntity::CleanUpOldReference(m_pPed, p_m_pPed);
  v4 = CPools::ms_pEventPool;
  v5 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v5] = CPools::ms_pEventPool->m_aFlags[-252645135
                                                                      * (((char *)this
                                                                        - (char *)CPools::ms_pEventPool->m_aStorage) >> 2)] | 0x80;
  if ( v5 < v4->m_nFreeIndex )
    v4->m_nFreeIndex = v5;
}
// 666BC8: using guessed type void *off_666BC8;

//----- (0037933C) --------------------------------------------------------
int __fastcall CEventPlayerCommandToGroupAttack::GetEventType(const CEventPlayerCommandToGroupAttack *this)
{
  return 71;
}

//----- (00379340) --------------------------------------------------------
int __fastcall CEventPlayerCommandToGroupAttack::GetEventPriority(const CEventPlayerCommandToGroupAttack *this)
{
  return 44;
}

//----- (00379344) --------------------------------------------------------
int __fastcall CEventPlayerCommandToGroup::GetLifeTime(const CEventPlayerCommandToGroup *this)
{
  return 0;
}

//----- (00379348) --------------------------------------------------------
bool __fastcall CEventPlayerCommandToGroup::AffectsPed(const CEventPlayerCommandToGroup *this, CPed *pPed)
{
  return 0;
}

//----- (0037934C) --------------------------------------------------------
CEntity *__fastcall CEventPlayerCommandToGroup::GetSourceEntity(const CEventPlayerCommandToGroup *this)
{
  return this->m_pPed;
}

//----- (00379350) --------------------------------------------------------
CEvent *__fastcall CEventPlayerCommandToGroupAttack::CloneEditable(const CEventPlayerCommandToGroupAttack *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pPed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pPed = this->m_pPed;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 16) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666BC8;
  *(_DWORD *)(m_nFreeIndex + 20) = m_pPed;
  if ( m_pPed )
    CEntity::RegisterReference(m_pPed, (CEntity **)(m_nFreeIndex + 20));
  *(_DWORD *)m_nFreeIndex = &off_6671E8;
  return (CEvent *)m_nFreeIndex;
}
// 666BC8: using guessed type void *off_666BC8;
// 6671E8: using guessed type void *off_6671E8;

//----- (003793F8) --------------------------------------------------------
void __fastcall CEventEscalator::~CEventEscalator(CEventEscalator *this)
{
  CEventPool *v1; // r1
  int v2; // r0

  v1 = CPools::ms_pEventPool;
  v2 = -252645135 * (((char *)this - (char *)CPools::ms_pEventPool->m_aStorage) >> 2);
  CPools::ms_pEventPool->m_aFlags[v2] |= 0x80u;
  if ( v2 < v1->m_nFreeIndex )
    v1->m_nFreeIndex = v2;
}

//----- (00379428) --------------------------------------------------------
int __fastcall CEventEscalator::GetEventType(const CEventEscalator *this)
{
  return 74;
}

//----- (0037942C) --------------------------------------------------------
int __fastcall CEventEscalator::GetEventPriority(const CEventEscalator *this)
{
  return 56;
}

//----- (00379430) --------------------------------------------------------
int __fastcall CEventEscalator::GetLifeTime(const CEventEscalator *this)
{
  return 0;
}

//----- (00379434) --------------------------------------------------------
CEvent *__fastcall CEventEscalator::Clone(const CEventEscalator *this)
{
  CEventPool *v1; // r0
  int32 m_nFreeIndex; // r1
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r3
  int v5; // r2
  CPool<CEvent,char [68]>::StorageType *m_aStorage; // r1
  int v7; // r0
  CEvent *result; // r0

  v1 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    ++m_nFreeIndex;
    m_aFlags = v1->m_aFlags;
    if ( m_nFreeIndex == m_nSize )
      m_nFreeIndex = 0;
    v1->m_nFreeIndex = m_nFreeIndex;
    v5 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v5 > -1 );
  m_aFlags[m_nFreeIndex] = v5 & 0x7F;
  v1->m_aFlags[v1->m_nFreeIndex] = (v1->m_aFlags[v1->m_nFreeIndex] + 1) & 0x7F | v1->m_aFlags[v1->m_nFreeIndex] & 0x80;
  m_aStorage = v1->m_aStorage;
  v7 = v1->m_nFreeIndex;
  *(_DWORD *)&m_aStorage[v7][0] = &off_667238;
  result = (CEvent *)m_aStorage[v7];
  result->m_iAccumulatedTime = 0;
  *(_DWORD *)&result->m_bIsPersistent = 0;
  return result;
}
// 667238: using guessed type void *;

//----- (003794A0) --------------------------------------------------------
bool __fastcall CEvent::AffectsPed(const CEvent *this, CPed *pPed)
{
  return 1;
}

//----- (003794A4) --------------------------------------------------------
int __fastcall CEventGunShot::GetEventType(const CEventGunShot *this)
{
  return 15;
}

//----- (003794A8) --------------------------------------------------------
int __fastcall CEventGunShot::GetEventPriority(const CEventGunShot *this)
{
  return 35;
}

//----- (003794AC) --------------------------------------------------------
int __fastcall CEventGunShot::GetLifeTime(const CEventGunShot *this)
{
  return 0;
}

//----- (003794B0) --------------------------------------------------------
CEntity *__fastcall CEventGunShot::GetSourceEntity(const CEventGunShot *this)
{
  return this->m_pFiringEntity;
}

//----- (003794B4) --------------------------------------------------------
float __fastcall CEventGunShot::GetLocalSoundLevel(const CEventGunShot *this)
{
  int *v1; // r1

  v1 = &dword_3794C4;
  if ( this->m_bSilent )
    v1 = &dword_3794C8;
  return *(float *)v1;
}
// 3794C4: using guessed type int dword_3794C4;
// 3794C8: using guessed type int dword_3794C8;

//----- (003794CC) --------------------------------------------------------
bool __fastcall CEventGunShot::CanBeInterruptedBySameEvent(const CEventGunShot *this)
{
  return 1;
}

//----- (003794D0) --------------------------------------------------------
CEvent *__fastcall CEventGunShot::CloneEditable(const CEventGunShot *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CEntity *m_pFiringEntity; // r2
  __int64 v8; // kr08_8
  bool m_bSilent; // r12
  CVector *p_m_vShotOrigin; // r0
  __int64 v11; // d16
  __int64 v12; // d17

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pFiringEntity = this->m_pFiringEntity;
  v8 = *(_QWORD *)&this->m_vShotTarget.y;
  m_bSilent = this->m_bSilent;
  p_m_vShotOrigin = &this->m_vShotOrigin;
  v11 = *(_QWORD *)&p_m_vShotOrigin->x;
  v12 = *(_QWORD *)&p_m_vShotOrigin->z;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_QWORD *)(m_nFreeIndex + 36) = v8;
  *(_QWORD *)(m_nFreeIndex + 20) = v11;
  *(_QWORD *)(m_nFreeIndex + 28) = v12;
  *(_BYTE *)(m_nFreeIndex + 44) = m_bSilent;
  *(_DWORD *)m_nFreeIndex = &off_665E10;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pFiringEntity;
  if ( m_pFiringEntity )
    CEntity::RegisterReference(m_pFiringEntity, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 665E10: using guessed type void *off_665E10;

//----- (0037958C) --------------------------------------------------------
int __fastcall CEventVehicleCollision::GetEventType(const CEventVehicleCollision *this)
{
  return 1;
}

//----- (00379590) --------------------------------------------------------
int __fastcall CEventVehicleCollision::GetEventPriority(const CEventVehicleCollision *this)
{
  return 58;
}

//----- (00379594) --------------------------------------------------------
int __fastcall CEventVehicleCollision::GetLifeTime(const CEventVehicleCollision *this)
{
  return 0;
}

//----- (00379598) --------------------------------------------------------
CEvent *__fastcall CEventVehicleCollision::Clone(const CEventVehicleCollision *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8
  uint16 m_iPieceType; // r1
  int8 m_iMoveState; // r12
  __int64 v10; // d16
  __int64 v11; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_fImpulseMagnitude;
  m_iPieceType = this->m_iPieceType;
  m_iMoveState = this->m_iMoveState;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_WORD *)(m_nFreeIndex + 10) = m_iPieceType;
  *(_WORD *)(m_nFreeIndex + 12) = 0;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  *(_DWORD *)m_nFreeIndex = &off_665E60;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  v10 = *(_QWORD *)&this->m_vNormal.x;
  *(RwReal *)(m_nFreeIndex + 32) = this->m_vNormal.z;
  *(_QWORD *)(m_nFreeIndex + 24) = v10;
  v11 = *(_QWORD *)&this->m_vPos.x;
  *(RwReal *)(m_nFreeIndex + 44) = this->m_vPos.z;
  *(_BYTE *)(m_nFreeIndex + 48) = m_iMoveState;
  *(_BYTE *)(m_nFreeIndex + 49) = 0;
  *(_QWORD *)(m_nFreeIndex + 36) = v11;
  if ( HIDWORD(v7) )
    CEntity::RegisterReference((CEntity *)HIDWORD(v7), (CEntity **)(m_nFreeIndex + 20));
  return (CEvent *)m_nFreeIndex;
}
// 665E60: using guessed type void *off_665E60;

//----- (00379660) --------------------------------------------------------
int __fastcall CEventPedCollisionWithPed::GetEventType(const CEventPedCollisionWithPed *this)
{
  return 2;
}

//----- (00379664) --------------------------------------------------------
int __fastcall CEventPedCollisionWithPed::GetEventPriority(const CEventPedCollisionWithPed *this)
{
  return 60;
}

//----- (00379668) --------------------------------------------------------
int __fastcall CEventPedCollisionWithPed::GetLifeTime(const CEventPedCollisionWithPed *this)
{
  return 0;
}

//----- (0037966C) --------------------------------------------------------
CEvent *__fastcall CEventPedCollisionWithPed::Clone(const CEventPedCollisionWithPed *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8
  uint16 m_iPieceType; // r1
  int v9; // r12
  __int64 v10; // d16
  __int64 v11; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_fImpulseMagnitude;
  m_iPieceType = this->m_iPieceType;
  v9 = *(_DWORD *)&this->m_iPedMoveState;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_WORD *)(m_nFreeIndex + 10) = m_iPieceType;
  *(_DWORD *)(m_nFreeIndex + 12) = v7;
  *(_DWORD *)m_nFreeIndex = &off_665EAC;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 16) = HIDWORD(v7);
  v10 = *(_QWORD *)&this->m_vNormal.x;
  *(RwReal *)(m_nFreeIndex + 28) = this->m_vNormal.z;
  *(_QWORD *)(m_nFreeIndex + 20) = v10;
  v11 = *(_QWORD *)&this->m_vPos.x;
  *(RwReal *)(m_nFreeIndex + 40) = this->m_vPos.z;
  *(_DWORD *)(m_nFreeIndex + 44) = v9;
  *(_QWORD *)(m_nFreeIndex + 32) = v11;
  if ( HIDWORD(v7) )
    CEntity::RegisterReference((CEntity *)HIDWORD(v7), (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 665EAC: using guessed type void *off_665EAC;

//----- (0037972C) --------------------------------------------------------
int __fastcall CEventObjectCollision::GetEventType(const CEventObjectCollision *this)
{
  return 5;
}

//----- (00379730) --------------------------------------------------------
int __fastcall CEventObjectCollision::GetEventPriority(const CEventObjectCollision *this)
{
  return 57;
}

//----- (00379734) --------------------------------------------------------
int __fastcall CEventObjectCollision::GetLifeTime(const CEventObjectCollision *this)
{
  return 0;
}

//----- (00379738) --------------------------------------------------------
CEvent *__fastcall CEventObjectCollision::Clone(const CEventObjectCollision *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  int v7; // r5
  __int64 v8; // kr08_8
  __int64 v9; // d16
  __int64 v10; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_DWORD *)&this->m_iPieceType;
  v8 = *(_QWORD *)&this->m_fImpulseMagnitude;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)(m_nFreeIndex + 16) = v8;
  *(_DWORD *)(m_nFreeIndex + 10) = v7;
  *(_DWORD *)m_nFreeIndex = &off_665EF8;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v8);
  v9 = *(_QWORD *)&this->m_vNormal.x;
  *(RwReal *)(m_nFreeIndex + 32) = this->m_vNormal.z;
  *(_QWORD *)(m_nFreeIndex + 24) = v9;
  v10 = *(_QWORD *)&this->m_vPos.x;
  *(RwReal *)(m_nFreeIndex + 44) = this->m_vPos.z;
  *(_QWORD *)(m_nFreeIndex + 36) = v10;
  if ( HIDWORD(v8) )
    CEntity::RegisterReference((CEntity *)HIDWORD(v8), (CEntity **)(m_nFreeIndex + 20));
  return (CEvent *)m_nFreeIndex;
}
// 665EF8: using guessed type void *off_665EF8;

//----- (003797F0) --------------------------------------------------------
int __fastcall CEventBuildingCollision::GetEventType(const CEventBuildingCollision *this)
{
  return 6;
}

//----- (003797F4) --------------------------------------------------------
int __fastcall CEventBuildingCollision::GetEventPriority(const CEventBuildingCollision *this)
{
  return 59;
}

//----- (003797F8) --------------------------------------------------------
CEvent *__fastcall CEventBuildingCollision::Clone(const CEventBuildingCollision *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  int v7; // r5
  __int64 v8; // kr08_8
  __int64 v9; // d16
  __int64 v10; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_DWORD *)&this->m_iPieceType;
  v8 = *(_QWORD *)&this->m_fImpulseMagnitude;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)(m_nFreeIndex + 16) = v8;
  *(_DWORD *)(m_nFreeIndex + 10) = v7;
  *(_DWORD *)m_nFreeIndex = &off_665F44;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v8);
  v9 = *(_QWORD *)&this->m_vNormal.x;
  *(RwReal *)(m_nFreeIndex + 32) = this->m_vNormal.z;
  *(_QWORD *)(m_nFreeIndex + 24) = v9;
  v10 = *(_QWORD *)&this->m_vPos.x;
  *(RwReal *)(m_nFreeIndex + 44) = this->m_vPos.z;
  *(_QWORD *)(m_nFreeIndex + 36) = v10;
  if ( HIDWORD(v8) )
    CEntity::RegisterReference((CEntity *)HIDWORD(v8), (CEntity **)(m_nFreeIndex + 20));
  return (CEvent *)m_nFreeIndex;
}
// 665F44: using guessed type void *off_665F44;

//----- (003798B0) --------------------------------------------------------
int __fastcall CEventDraggedOutCar::GetEventType(const CEventDraggedOutCar *this)
{
  return 7;
}

//----- (003798B4) --------------------------------------------------------
int __fastcall CEventDraggedOutCar::GetEventPriority(const CEventDraggedOutCar *this)
{
  return 40;
}

//----- (003798B8) --------------------------------------------------------
int __fastcall CEventDraggedOutCar::GetLifeTime(const CEventDraggedOutCar *this)
{
  return 0;
}

//----- (003798BC) --------------------------------------------------------
CEntity *__fastcall CEventDraggedOutCar::GetSourceEntity(const CEventDraggedOutCar *this)
{
  return this->m_pDraggingPed;
}

//----- (003798C0) --------------------------------------------------------
float __fastcall CEventDraggedOutCar::GetLocalSoundLevel(const CEventDraggedOutCar *this)
{
  return 100.0;
}

//----- (003798C8) --------------------------------------------------------
CEvent *__fastcall CEventDraggedOutCar::CloneEditable(const CEventDraggedOutCar *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  CVehicle *m_pVehicle; // r2
  CPed *m_pDraggingPed; // r3
  bool m_bWasDriver; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pVehicle = this->m_pVehicle;
  m_pDraggingPed = this->m_pDraggingPed;
  m_bWasDriver = this->m_bWasDriver;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_BYTE *)(m_nFreeIndex + 24) = m_bWasDriver;
  *(_DWORD *)m_nFreeIndex = &off_665F90;
  *(_QWORD *)(m_nFreeIndex + 16) = __PAIR64__((unsigned int)m_pVehicle, (unsigned int)m_pDraggingPed);
  if ( m_pVehicle )
  {
    CEntity::RegisterReference(m_pVehicle, (CEntity **)(m_nFreeIndex + 20));
    m_pDraggingPed = *(CPed **)(m_nFreeIndex + 16);
  }
  if ( m_pDraggingPed )
    CEntity::RegisterReference(m_pDraggingPed, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 665F90: using guessed type void *off_665F90;

//----- (00379974) --------------------------------------------------------
int __fastcall CEventDamage::GetEventType(const CEventDamage *this)
{
  return 9;
}

//----- (00379978) --------------------------------------------------------
int __fastcall CEventDamage::GetEventPriority(const CEventDamage *this)
{
  return 65;
}

//----- (0037997C) --------------------------------------------------------
int __fastcall CEventDamage::GetLifeTime(const CEventDamage *this)
{
  return 0;
}

//----- (00379980) --------------------------------------------------------
float __fastcall CEventDamage::GetLocalSoundLevel(const CEventDamage *this)
{
  return 55.0;
}

//----- (00379988) --------------------------------------------------------
bool __fastcall CEventDamage::CanBeInterruptedBySameEvent(const CEventDamage *this)
{
  return 1;
}

//----- (0037998C) --------------------------------------------------------
int __fastcall CEventDeath::GetEventType(const CEventDeath *this)
{
  return 10;
}

//----- (00379990) --------------------------------------------------------
int __fastcall CEventDeath::GetEventPriority(const CEventDeath *this)
{
  return 73;
}

//----- (00379994) --------------------------------------------------------
int __fastcall CEventDeath::GetLifeTime(const CEventDeath *this)
{
  return 0;
}

//----- (00379998) --------------------------------------------------------
CEvent *__fastcall CEventDeath::Clone(const CEventDeath *this)
{
  int v1; // lr
  CEventPool *v2; // r2
  int32 m_nFreeIndex; // r1
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r3
  int v6; // r4
  int m_iTimeOfDeath; // r3
  bool m_bHasDrowned; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_iTimeOfDeath = this->m_iTimeOfDeath;
  m_bHasDrowned = this->m_bHasDrowned;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_BYTE *)(m_nFreeIndex + 9) = m_bHasDrowned;
  *(_DWORD *)(m_nFreeIndex + 12) = m_iTimeOfDeath;
  *(_DWORD *)m_nFreeIndex = &off_666030;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  return (CEvent *)m_nFreeIndex;
}
// 666030: using guessed type void *off_666030;

//----- (00379A1C) --------------------------------------------------------
int __fastcall CEventDeadPed::GetEventType(const CEventDeadPed *this)
{
  return 11;
}

//----- (00379A20) --------------------------------------------------------
int __fastcall CEventDeadPed::GetEventPriority(const CEventDeadPed *this)
{
  return 15;
}

//----- (00379A24) --------------------------------------------------------
int __fastcall CEventDeadPed::GetLifeTime(const CEventDeadPed *this)
{
  return 0;
}

//----- (00379A28) --------------------------------------------------------
CEntity *__fastcall CEventDeadPed::GetSourceEntity(const CEventDeadPed *this)
{
  return this->m_pDeadPed;
}

//----- (00379A2C) --------------------------------------------------------
float __fastcall CEventDeadPed::GetLocalSoundLevel(const CEventDeadPed *this)
{
  return 60.0;
}

//----- (00379A34) --------------------------------------------------------
CEvent *__fastcall CEventDeadPed::CloneEditable(const CEventDeadPed *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pDeadPed; // r2
  int m_iTimeOfDeath; // lr
  bool m_bHasDrowned; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pDeadPed = this->m_pDeadPed;
  m_iTimeOfDeath = this->m_iTimeOfDeath;
  m_bHasDrowned = this->m_bHasDrowned;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_BYTE *)(m_nFreeIndex + 20) = m_bHasDrowned;
  *(_DWORD *)(m_nFreeIndex + 24) = m_iTimeOfDeath;
  *(_DWORD *)m_nFreeIndex = &off_66607C;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pDeadPed;
  if ( m_pDeadPed )
    CEntity::RegisterReference(m_pDeadPed, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 66607C: using guessed type void *off_66607C;

//----- (00379AE0) --------------------------------------------------------
int __fastcall CEventGroupEvent::GetEventType(const CEventGroupEvent *this)
{
  return 47;
}

//----- (00379AE4) --------------------------------------------------------
int __fastcall CEventGroupEvent::GetEventPriority(const CEventGroupEvent *this)
{
  return 41;
}

//----- (00379AE8) --------------------------------------------------------
int __fastcall CEventGroupEvent::GetLifeTime(const CEventGroupEvent *this)
{
  return 0;
}

//----- (00379AEC) --------------------------------------------------------
CEvent *__fastcall CEventGroupEvent::Clone(const CEventGroupEvent *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  __int64 v7; // kr08_8
  int v8; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pDistressedPed;
  v8 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)HIDWORD(v7) + 20))(HIDWORD(v7));
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_6660CC;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 16) = v8;
  *(_DWORD *)(m_nFreeIndex + 12) = v7;
  if ( (_DWORD)v7 )
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 6660CC: using guessed type void *off_6660CC;

//----- (00379B7C) --------------------------------------------------------
float __fastcall CEventGroupEvent::GetLocalSoundLevel(const CEventGroupEvent *this)
{
  return 100.0;
}

//----- (00379B84) --------------------------------------------------------
int __fastcall CEventPotentialGetRunOver::GetEventType(const CEventPotentialGetRunOver *this)
{
  return 12;
}

//----- (00379B88) --------------------------------------------------------
int __fastcall CEventPotentialGetRunOver::GetEventPriority(const CEventPotentialGetRunOver *this)
{
  return 51;
}

//----- (00379B8C) --------------------------------------------------------
int __fastcall CEventPotentialGetRunOver::GetLifeTime(const CEventPotentialGetRunOver *this)
{
  return 0;
}

//----- (00379B90) --------------------------------------------------------
CEntity *__fastcall CEventPotentialGetRunOver::GetSourceEntity(const CEventPotentialGetRunOver *this)
{
  CVehicle *m_pThreatVehicle; // r0

  m_pThreatVehicle = this->m_pThreatVehicle;
  if ( m_pThreatVehicle )
    return m_pThreatVehicle->pDriver;
  else
    return 0;
}

//----- (00379B9E) --------------------------------------------------------
float __fastcall CEventPotentialGetRunOver::GetLocalSoundLevel(const CEventPotentialGetRunOver *this)
{
  return 100.0;
}

//----- (00379BA8) --------------------------------------------------------
CEvent *__fastcall CEventPotentialGetRunOver::CloneEditable(const CEventPotentialGetRunOver *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pThreatVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pThreatVehicle = this->m_pThreatVehicle;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666118;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pThreatVehicle;
  if ( m_pThreatVehicle )
    CEntity::RegisterReference(m_pThreatVehicle, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 666118: using guessed type void *off_666118;

//----- (00379C40) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoVehicle::GetEventType(const CEventPotentialWalkIntoVehicle *this)
{
  return 56;
}

//----- (00379C44) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoVehicle::GetEventPriority(const CEventPotentialWalkIntoVehicle *this)
{
  return 29;
}

//----- (00379C48) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoVehicle::GetLifeTime(const CEventPotentialWalkIntoVehicle *this)
{
  return 0;
}

//----- (00379C4C) --------------------------------------------------------
CEvent *__fastcall CEventPotentialWalkIntoVehicle::CloneEditable(const CEventPotentialWalkIntoVehicle *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pThreatVehicle;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  *(_DWORD *)m_nFreeIndex = &off_666168;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  if ( (_DWORD)v7 )
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 666168: using guessed type void *off_666168;

//----- (00379CEC) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoObject::GetEventType(const CEventPotentialWalkIntoObject *this)
{
  return 44;
}

//----- (00379CF0) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoObject::GetEventPriority(const CEventPotentialWalkIntoObject *this)
{
  return 27;
}

//----- (00379CF4) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoObject::GetLifeTime(const CEventPotentialWalkIntoObject *this)
{
  return 0;
}

//----- (00379CF8) --------------------------------------------------------
CEvent *__fastcall CEventPotentialWalkIntoObject::CloneEditable(const CEventPotentialWalkIntoObject *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pObject;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  *(_DWORD *)m_nFreeIndex = &off_6661B8;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  if ( (_DWORD)v7 )
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 6661B8: using guessed type void *off_6661B8;

//----- (00379D98) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoPed::GetEventType(const CEventPotentialWalkIntoPed *this)
{
  return 13;
}

//----- (00379D9C) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoPed::GetEventPriority(const CEventPotentialWalkIntoPed *this)
{
  return 28;
}

//----- (00379DA0) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoPed::GetLifeTime(const CEventPotentialWalkIntoPed *this)
{
  return 0;
}

//----- (00379DA4) --------------------------------------------------------
CEntity *__fastcall CEventPotentialWalkIntoPed::GetSourceEntity(const CEventPotentialWalkIntoPed *this)
{
  return this->m_pOtherPed;
}

//----- (00379DA8) --------------------------------------------------------
CEvent *__fastcall CEventPotentialWalkIntoPed::CloneEditable(const CEventPotentialWalkIntoPed *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8
  __int64 v8; // d16

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pOtherPed;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666208;
  v8 = *(_QWORD *)&this->m_vTarget.x;
  *(RwReal *)(m_nFreeIndex + 24) = this->m_vTarget.z;
  *(_DWORD *)(m_nFreeIndex + 32) = HIDWORD(v7);
  *(_QWORD *)(m_nFreeIndex + 16) = v8;
  *(_DWORD *)(m_nFreeIndex + 28) = v7;
  CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 28));
  return (CEvent *)m_nFreeIndex;
}
// 666208: using guessed type void *off_666208;

//----- (00379E54) --------------------------------------------------------
int __fastcall CEventVehicleHitAndRun::GetEventType(const CEventVehicleHitAndRun *this)
{
  return 14;
}

//----- (00379E58) --------------------------------------------------------
int __fastcall CEventVehicleHitAndRun::GetEventPriority(const CEventVehicleHitAndRun *this)
{
  return 14;
}

//----- (00379E5C) --------------------------------------------------------
int __fastcall CEventVehicleHitAndRun::GetLifeTime(const CEventVehicleHitAndRun *this)
{
  return 0;
}

//----- (00379E60) --------------------------------------------------------
CEvent *__fastcall CEventVehicleHitAndRun::Clone(const CEventVehicleHitAndRun *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  __int64 v7; // kr08_8

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pKnockedDownPed;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666258;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_QWORD *)(m_nFreeIndex + 12) = v7;
  CEntity::RegisterReference((CEntity *)HIDWORD(v7), (CEntity **)(m_nFreeIndex + 16));
  CEntity::RegisterReference(*(CEntity **)(m_nFreeIndex + 12), (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666258: using guessed type void *off_666258;

//----- (00379EEC) --------------------------------------------------------
bool __fastcall CEventVehicleHitAndRun::AffectsPed(const CEventVehicleHitAndRun *this, CPed *pPed)
{
  return sub_196854(pPed);
}

//----- (00379EF2) --------------------------------------------------------
bool __fastcall CEventVehicleHitAndRun::IsCriminalEvent(const CEventVehicleHitAndRun *this)
{
  CPed *pDriver; // r0

  pDriver = this->m_pInflictor->pDriver;
  return pDriver && CPed::IsPlayer(pDriver);
}

//----- (00379F12) --------------------------------------------------------
void __fastcall CEventVehicleHitAndRun::ReportCriminalEvent(const CEventVehicleHitAndRun *this, CPed *pPed)
{
  int32 m_nPedType; // r5
  CWanted *PlayerWanted; // r0
  CVehicle *m_pInflictor; // r1
  CMatrix *m_pMat; // r4
  u_native pDriver; // r3
  const CVector *p_tx; // r2
  eCrimeType v9; // r1

  if ( (*((int (__fastcall **)(const CEventVehicleHitAndRun *))this->_vptr$CEvent + 8))(this) == 1 )
  {
    m_nPedType = this->m_pKnockedDownPed->m_nPedType;
    PlayerWanted = FindPlayerWanted(-1);
    m_pInflictor = this->m_pInflictor;
    m_pMat = m_pInflictor->m_pMat;
    pDriver = (u_native)m_pInflictor->pDriver;
    p_tx = (const CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pInflictor->m_transform.m_translate;
    if ( m_nPedType == 6 )
      v9 = CRIME_RUNOVER_COP;
    else
      v9 = CRIME_RUNOVER_PED;
    CWanted::RegisterCrime(PlayerWanted, v9, p_tx, pDriver, 0);
  }
}

//----- (00379F5E) --------------------------------------------------------
float __fastcall CEventVehicleHitAndRun::GetLocalSoundLevel(const CEventVehicleHitAndRun *this)
{
  return 100.0;
}

//----- (00379F66) --------------------------------------------------------
int __fastcall CEventPedEnteredMyVehicle::GetEventType(const CEventPedEnteredMyVehicle *this)
{
  return 17;
}

//----- (00379F6A) --------------------------------------------------------
int __fastcall CEventPedEnteredMyVehicle::GetEventPriority(const CEventPedEnteredMyVehicle *this)
{
  return 39;
}

//----- (00379F6E) --------------------------------------------------------
int __fastcall CEventPedEnteredMyVehicle::GetLifeTime(const CEventPedEnteredMyVehicle *this)
{
  return 0;
}

//----- (00379F72) --------------------------------------------------------
CEntity *__fastcall CEventPedEnteredMyVehicle::GetSourceEntity(const CEventPedEnteredMyVehicle *this)
{
  return this->m_pPedThatEnteredVehicle;
}

//----- (00379F76) --------------------------------------------------------
float __fastcall CEventPedEnteredMyVehicle::GetLocalSoundLevel(const CEventPedEnteredMyVehicle *this)
{
  return 60.0;
}

//----- (00379F80) --------------------------------------------------------
CEvent *__fastcall CEventPedEnteredMyVehicle::CloneEditable(const CEventPedEnteredMyVehicle *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  __int64 v7; // r2
  int m_iTargetDoor; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pPedThatEnteredVehicle;
  m_iTargetDoor = this->m_iTargetDoor;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 24) = m_iTargetDoor;
  *(_DWORD *)m_nFreeIndex = &off_6662A4;
  *(_QWORD *)(m_nFreeIndex + 16) = v7;
  CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 16));
  CEntity::RegisterReference(*(CEntity **)(m_nFreeIndex + 20), (CEntity **)(m_nFreeIndex + 20));
  return (CEvent *)m_nFreeIndex;
}
// 6662A4: using guessed type void *off_6662A4;

//----- (0037A024) --------------------------------------------------------
int __fastcall CEventRevived::GetEventType(const CEventRevived *this)
{
  return 18;
}

//----- (0037A028) --------------------------------------------------------
int __fastcall CEventRevived::GetEventPriority(const CEventRevived *this)
{
  return 74;
}

//----- (0037A02C) --------------------------------------------------------
int __fastcall CEventRevived::GetLifeTime(const CEventRevived *this)
{
  return 0;
}

//----- (0037A030) --------------------------------------------------------
CEvent *__fastcall CEventRevived::Clone(const CEventRevived *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_bIsPersistent = 0;
  result->_vptr$CEvent = (int (**)(void))&off_6662F4;
  result->m_iAccumulatedTime = 0;
  return result;
}
// 6662F4: using guessed type void *off_6662F4;

//----- (0037A0A8) --------------------------------------------------------
int __fastcall CEventChatPartner::GetEventType(const CEventChatPartner *this)
{
  return 19;
}

//----- (0037A0AC) --------------------------------------------------------
int __fastcall CEventChatPartner::GetEventPriority(const CEventChatPartner *this)
{
  return 5;
}

//----- (0037A0B0) --------------------------------------------------------
int __fastcall CEventChatPartner::GetLifeTime(const CEventChatPartner *this)
{
  return 0;
}

//----- (0037A0B4) --------------------------------------------------------
CEvent *__fastcall CEventChatPartner::Clone(const CEventChatPartner *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pOtherPed; // r2
  bool m_bIsLeader; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pOtherPed = this->m_pOtherPed;
  m_bIsLeader = this->m_bIsLeader;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_BYTE *)(m_nFreeIndex + 9) = m_bIsLeader;
  *(_DWORD *)m_nFreeIndex = &off_666340;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pOtherPed;
  if ( m_pOtherPed )
    CEntity::RegisterReference(m_pOtherPed, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666340: using guessed type void *off_666340;

//----- (0037A144) --------------------------------------------------------
int __fastcall CEventSexyPed::GetEventType(const CEventSexyPed *this)
{
  return 20;
}

//----- (0037A148) --------------------------------------------------------
int __fastcall CEventSexyPed::GetEventPriority(const CEventSexyPed *this)
{
  return 4;
}

//----- (0037A14C) --------------------------------------------------------
int __fastcall CEventSexyPed::GetLifeTime(const CEventSexyPed *this)
{
  return 0;
}

//----- (0037A150) --------------------------------------------------------
CEntity *__fastcall CEventSexyPed::GetSourceEntity(const CEventSexyPed *this)
{
  return this->m_pSexyPed;
}

//----- (0037A154) --------------------------------------------------------
CEvent *__fastcall CEventSexyPed::CloneEditable(const CEventSexyPed *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pSexyPed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pSexyPed = this->m_pSexyPed;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_66638C;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pSexyPed;
  if ( m_pSexyPed )
    CEntity::RegisterReference(m_pSexyPed, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 66638C: using guessed type void *off_66638C;

//----- (0037A1EC) --------------------------------------------------------
int __fastcall CEventSexyVehicle::GetEventType(const CEventSexyVehicle *this)
{
  return 21;
}

//----- (0037A1F0) --------------------------------------------------------
int __fastcall CEventSexyVehicle::GetEventPriority(const CEventSexyVehicle *this)
{
  return 3;
}

//----- (0037A1F4) --------------------------------------------------------
int __fastcall CEventSexyVehicle::GetLifeTime(const CEventSexyVehicle *this)
{
  return 0;
}

//----- (0037A1F8) --------------------------------------------------------
CEvent *__fastcall CEventSexyVehicle::Clone(const CEventSexyVehicle *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pSexyVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pSexyVehicle = this->m_pSexyVehicle;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_6663DC;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pSexyVehicle;
  if ( m_pSexyVehicle )
    CEntity::RegisterReference(m_pSexyVehicle, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 6663DC: using guessed type void *off_6663DC;

//----- (0037A284) --------------------------------------------------------
int __fastcall CEventPedToChase::GetEventType(const CEventPedToChase *this)
{
  return 25;
}

//----- (0037A288) --------------------------------------------------------
int __fastcall CEventPedToChase::GetEventPriority(const CEventPedToChase *this)
{
  return 1;
}

//----- (0037A28C) --------------------------------------------------------
int __fastcall CEventPedToChase::GetLifeTime(const CEventPedToChase *this)
{
  return 0;
}

//----- (0037A290) --------------------------------------------------------
CEvent *__fastcall CEventPedToChase::Clone(const CEventPedToChase *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pPedToChase; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pPedToChase = this->m_pPedToChase;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666428;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pPedToChase;
  if ( m_pPedToChase )
    CEntity::RegisterReference(m_pPedToChase, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666428: using guessed type void *off_666428;

//----- (0037A31C) --------------------------------------------------------
int __fastcall CEventPedToFlee::GetEventType(const CEventPedToFlee *this)
{
  return 26;
}

//----- (0037A320) --------------------------------------------------------
int __fastcall CEventPedToFlee::GetEventPriority(const CEventPedToFlee *this)
{
  return 2;
}

//----- (0037A324) --------------------------------------------------------
int __fastcall CEventPedToFlee::GetLifeTime(const CEventPedToFlee *this)
{
  return 0;
}

//----- (0037A328) --------------------------------------------------------
CEvent *__fastcall CEventPedToFlee::Clone(const CEventPedToFlee *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pPedToFlee; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pPedToFlee = this->m_pPedToFlee;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666474;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pPedToFlee;
  if ( m_pPedToFlee )
    CEntity::RegisterReference(m_pPedToFlee, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666474: using guessed type void *off_666474;

//----- (0037A3B4) --------------------------------------------------------
int __fastcall CEventAttractor::GetEventType(const CEventAttractor *this)
{
  return 27;
}

//----- (0037A3B8) --------------------------------------------------------
int __fastcall CEventAttractor::GetEventPriority(const CEventAttractor *this)
{
  return 0;
}

//----- (0037A3BC) --------------------------------------------------------
int __fastcall CEventAttractor::GetLifeTime(const CEventAttractor *this)
{
  return 0;
}

//----- (0037A3C0) --------------------------------------------------------
CEvent *__fastcall CEventAttractor::CloneEditable(const CEventAttractor *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  __int64 v7; // kr08_8
  bool8 m_forceUse; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pEffect;
  m_forceUse = this->m_forceUse;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  *(_BYTE *)(m_nFreeIndex + 24) = m_forceUse;
  *(_DWORD *)m_nFreeIndex = &off_6664C0;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  if ( HIDWORD(v7) )
    CEntity::RegisterReference((CEntity *)HIDWORD(v7), (CEntity **)(m_nFreeIndex + 20));
  return (CEvent *)m_nFreeIndex;
}
// 6664C0: using guessed type void *off_6664C0;

//----- (0037A468) --------------------------------------------------------
int __fastcall CEventVehicleToSteal::GetEventType(const CEventVehicleToSteal *this)
{
  return 28;
}

//----- (0037A46C) --------------------------------------------------------
int __fastcall CEventVehicleToSteal::GetEventPriority(const CEventVehicleToSteal *this)
{
  return 7;
}

//----- (0037A470) --------------------------------------------------------
int __fastcall CEventVehicleToSteal::GetLifeTime(const CEventVehicleToSteal *this)
{
  return 0;
}

//----- (0037A474) --------------------------------------------------------
CEvent *__fastcall CEventVehicleToSteal::Clone(const CEventVehicleToSteal *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pVehicle = this->m_pVehicle;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666510;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pVehicle;
  if ( m_pVehicle )
    CEntity::RegisterReference(m_pVehicle, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666510: using guessed type void *off_666510;

//----- (0037A500) --------------------------------------------------------
int __fastcall CEventVehicleThreat::GetEventType(const CEventVehicleThreat *this)
{
  return 30;
}

//----- (0037A504) --------------------------------------------------------
int __fastcall CEventVehicleThreat::GetEventPriority(const CEventVehicleThreat *this)
{
  return 19;
}

//----- (0037A508) --------------------------------------------------------
int __fastcall CEventVehicleThreat::GetLifeTime(const CEventVehicleThreat *this)
{
  return 0;
}

//----- (0037A50C) --------------------------------------------------------
CEvent *__fastcall CEventVehicleThreat::CloneEditable(const CEventVehicleThreat *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pThreatVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pThreatVehicle = this->m_pThreatVehicle;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_6665AC;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pThreatVehicle;
  if ( m_pThreatVehicle )
    CEntity::RegisterReference(m_pThreatVehicle, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 6665AC: using guessed type void *off_6665AC;

//----- (0037A5A4) --------------------------------------------------------
int __fastcall CEventKnockOffBike::GetEventType(const CEventKnockOffBike *this)
{
  return 8;
}

//----- (0037A5A8) --------------------------------------------------------
int __fastcall CEventKnockOffBike::GetEventPriority(const CEventKnockOffBike *this)
{
  return 70;
}

//----- (0037A5AC) --------------------------------------------------------
int __fastcall CEventKnockOffBike::GetLifeTime(const CEventKnockOffBike *this)
{
  return 0;
}

//----- (0037A5B0) --------------------------------------------------------
CEvent *__fastcall CEventKnockOffBike::Clone(const CEventKnockOffBike *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  __int64 v7; // kr08_8
  CPed *m_pDraggingPed; // r3
  int m_nDownTime; // r9
  CVehicle *m_pVehicle; // r2
  char v11; // r8
  int8 m_eWeaponUsed; // r10
  int8 m_nDirn; // r6
  __int64 v14; // d16
  RwReal z; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_fCollisionImpulse;
  m_pDraggingPed = this->m_pDraggingPed;
  m_nDownTime = this->m_nDownTime;
  m_pVehicle = this->m_pVehicle;
  v11 = *((_BYTE *)this + 53);
  m_eWeaponUsed = this->m_eWeaponUsed;
  m_nDirn = this->m_nDirn;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_6665FC;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(CVector *)(m_nFreeIndex + 12) = this->m_vecColSpeed;
  v14 = *(_QWORD *)&this->m_vecColNormal.x;
  z = this->m_vecColNormal.z;
  *(_DWORD *)(m_nFreeIndex + 48) = m_pDraggingPed;
  *(_BYTE *)(m_nFreeIndex + 52) = m_nDirn;
  *(RwReal *)(m_nFreeIndex + 32) = z;
  *(_QWORD *)(m_nFreeIndex + 36) = v7;
  *(_DWORD *)(m_nFreeIndex + 44) = m_nDownTime;
  *(_QWORD *)(m_nFreeIndex + 24) = v14;
  LOBYTE(z) = *(_BYTE *)(m_nFreeIndex + 53);
  *(_BYTE *)(m_nFreeIndex + 54) = m_eWeaponUsed;
  *(_BYTE *)(m_nFreeIndex + 55) = 0;
  *(_BYTE *)(m_nFreeIndex + 53) = LOBYTE(z) & 0xFC | v11 & 3;
  *(_DWORD *)(m_nFreeIndex + 56) = m_pVehicle;
  if ( m_pVehicle )
  {
    CEntity::RegisterReference(m_pVehicle, (CEntity **)(m_nFreeIndex + 56));
    m_pDraggingPed = *(CPed **)(m_nFreeIndex + 48);
  }
  if ( m_pDraggingPed )
    CEntity::RegisterReference(m_pDraggingPed, (CEntity **)(m_nFreeIndex + 48));
  return (CEvent *)m_nFreeIndex;
}
// 6665FC: using guessed type void *off_6665FC;

//----- (0037A6A8) --------------------------------------------------------
float __fastcall CEventKnockOffBike::GetLocalSoundLevel(const CEventKnockOffBike *this)
{
  return 60.0;
}

//----- (0037A6B0) --------------------------------------------------------
int __fastcall CEventGunAimedAt::GetEventType(const CEventGunAimedAt *this)
{
  return 31;
}

//----- (0037A6B4) --------------------------------------------------------
int __fastcall CEventGunAimedAt::GetEventPriority(const CEventGunAimedAt *this)
{
  return 50;
}

//----- (0037A6B8) --------------------------------------------------------
int __fastcall CEventGunAimedAt::GetLifeTime(const CEventGunAimedAt *this)
{
  return 0;
}

//----- (0037A6BC) --------------------------------------------------------
CEntity *__fastcall CEventGunAimedAt::GetSourceEntity(const CEventGunAimedAt *this)
{
  return this->m_pAggressorPed;
}

//----- (0037A6C0) --------------------------------------------------------
CEvent *__fastcall CEventGunAimedAt::CloneEditable(const CEventGunAimedAt *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pAggressorPed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pAggressorPed = this->m_pAggressorPed;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666648;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pAggressorPed;
  if ( m_pAggressorPed )
    CEntity::RegisterReference(m_pAggressorPed, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 666648: using guessed type void *off_666648;

//----- (0037A758) --------------------------------------------------------
int __fastcall CEventScriptCommand::GetEventType(const CEventScriptCommand *this)
{
  return 32;
}

//----- (0037A75C) --------------------------------------------------------
int __fastcall CEventScriptCommand::GetLifeTime(const CEventScriptCommand *this)
{
  return 0;
}

//----- (0037A760) --------------------------------------------------------
int __fastcall CEventInAir::GetEventType(const CEventInAir *this)
{
  return 33;
}

//----- (0037A764) --------------------------------------------------------
int __fastcall CEventInAir::GetEventPriority(const CEventInAir *this)
{
  return 61;
}

//----- (0037A768) --------------------------------------------------------
int __fastcall CEventInAir::GetLifeTime(const CEventInAir *this)
{
  return 0;
}

//----- (0037A76C) --------------------------------------------------------
CEvent *__fastcall CEventInAir::Clone(const CEventInAir *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_bIsPersistent = 0;
  result->_vptr$CEvent = (int (**)(void))&off_6666E8;
  result->m_iAccumulatedTime = 0;
  return result;
}
// 6666E8: using guessed type void *off_6666E8;

//----- (0037A7E4) --------------------------------------------------------
int __fastcall CEventVehicleDied::GetEventType(const CEventVehicleDied *this)
{
  return 35;
}

//----- (0037A7E8) --------------------------------------------------------
int __fastcall CEventVehicleDied::GetEventPriority(const CEventVehicleDied *this)
{
  return 72;
}

//----- (0037A7EC) --------------------------------------------------------
int __fastcall CEventVehicleDied::GetLifeTime(const CEventVehicleDied *this)
{
  return 0;
}

//----- (0037A7F0) --------------------------------------------------------
CEvent *__fastcall CEventVehicleDied::Clone(const CEventVehicleDied *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pDeadVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pDeadVehicle = this->m_pDeadVehicle;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_BYTE *)(m_nFreeIndex + 16) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666734;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pDeadVehicle;
  CEntity::RegisterReference(m_pDeadVehicle, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666734: using guessed type void *off_666734;

//----- (0037A878) --------------------------------------------------------
int __fastcall CEventVehicleOnFire::GetEventType(const CEventVehicleOnFire *this)
{
  return 79;
}

//----- (0037A87C) --------------------------------------------------------
int __fastcall CEventVehicleOnFire::GetEventPriority(const CEventVehicleOnFire *this)
{
  return 54;
}

//----- (0037A880) --------------------------------------------------------
int __fastcall CEventVehicleOnFire::GetLifeTime(const CEventVehicleOnFire *this)
{
  return 0;
}

//----- (0037A884) --------------------------------------------------------
float __fastcall CEventVehicleOnFire::GetLocalSoundLevel(const CEventVehicleOnFire *this)
{
  return 60.0;
}

//----- (0037A88C) --------------------------------------------------------
CEvent *__fastcall CEventVehicleOnFire::CloneEditable(const CEventVehicleOnFire *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pVehicleOnFire; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pVehicleOnFire = this->m_pVehicleOnFire;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666780;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pVehicleOnFire;
  if ( m_pVehicleOnFire )
    CEntity::RegisterReference(m_pVehicleOnFire, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 666780: using guessed type void *off_666780;

//----- (0037A924) --------------------------------------------------------
int __fastcall CEventHitByWaterCannon::GetEventType(const CEventHitByWaterCannon *this)
{
  return 64;
}

//----- (0037A928) --------------------------------------------------------
int __fastcall CEventHitByWaterCannon::GetEventPriority(const CEventHitByWaterCannon *this)
{
  return 64;
}

//----- (0037A92C) --------------------------------------------------------
int __fastcall CEventHitByWaterCannon::GetLifeTime(const CEventHitByWaterCannon *this)
{
  return 0;
}

//----- (0037A930) --------------------------------------------------------
CEvent *__fastcall CEventHitByWaterCannon::Clone(const CEventHitByWaterCannon *this)
{
  int v1; // lr
  CEventPool *v2; // r2
  int32 m_nFreeIndex; // r1
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r3
  int v6; // r4
  __int64 v7; // d16
  __int64 v8; // d16
  CEvent *result; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_QWORD *)m_nFreeIndex = (unsigned int)&off_6667D0;
  v7 = *(_QWORD *)&this->m_vPos.x;
  *(RwReal *)(m_nFreeIndex + 20) = this->m_vPos.z;
  *(_QWORD *)(m_nFreeIndex + 12) = v7;
  v8 = *(_QWORD *)&this->m_vVel.x;
  *(RwReal *)(m_nFreeIndex + 32) = this->m_vVel.z;
  result = (CEvent *)m_nFreeIndex;
  *(_QWORD *)(m_nFreeIndex + 24) = v8;
  return result;
}
// 6667D0: using guessed type void *off_6667D0;

//----- (0037A9C0) --------------------------------------------------------
float __fastcall CEventHitByWaterCannon::GetLocalSoundLevel(const CEventHitByWaterCannon *this)
{
  return 55.0;
}

//----- (0037A9C8) --------------------------------------------------------
int __fastcall CEventInWater::GetEventType(const CEventInWater *this)
{
  return 66;
}

//----- (0037A9CC) --------------------------------------------------------
int __fastcall CEventInWater::GetEventPriority(const CEventInWater *this)
{
  return 62;
}

//----- (0037A9D0) --------------------------------------------------------
int __fastcall CEventInWater::GetLifeTime(const CEventInWater *this)
{
  return 0;
}

//----- (0037A9D4) --------------------------------------------------------
CEvent *__fastcall CEventInWater::Clone(const CEventInWater *this)
{
  int v1; // lr
  CEventPool *v2; // r2
  CEvent *m_nFreeIndex; // r1
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r3
  int v6; // r4
  float m_fBuoyancyFraction; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    m_nFreeIndex = (CEvent *)((char *)m_nFreeIndex + 1);
    v2->m_nFreeIndex = (int32)m_nFreeIndex;
    if ( m_nFreeIndex == (CEvent *)m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&m_nFreeIndex->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&m_nFreeIndex->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_fBuoyancyFraction = this->m_fBuoyancyFraction;
  m_nFreeIndex->m_bIsPersistent = 0;
  *(float *)&m_nFreeIndex[1]._vptr$CEvent = m_fBuoyancyFraction;
  m_nFreeIndex->_vptr$CEvent = (int (**)(void))&off_66681C;
  m_nFreeIndex->m_iAccumulatedTime = 0;
  return m_nFreeIndex;
}
// 66681C: using guessed type void *off_66681C;

//----- (0037AA54) --------------------------------------------------------
int __fastcall CEventStuckInAir::GetEventType(const CEventStuckInAir *this)
{
  return 93;
}

//----- (0037AA58) --------------------------------------------------------
int __fastcall CEventStuckInAir::GetLifeTime(const CEventStuckInAir *this)
{
  return 0;
}

//----- (0037AA5C) --------------------------------------------------------
CEvent *__fastcall CEventStuckInAir::Clone(const CEventStuckInAir *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pPed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pPed = this->m_pPed;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666868;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pPed;
  if ( m_pPed )
    CEntity::RegisterReference(m_pPed, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666868: using guessed type void *off_666868;

//----- (0037AAE8) --------------------------------------------------------
bool __fastcall CEventStuckInAir::CanBeInterruptedBySameEvent(const CEventStuckInAir *this)
{
  return 1;
}

//----- (0037AAEC) --------------------------------------------------------
int __fastcall CEventCopCarBeingStolen::GetEventType(const CEventCopCarBeingStolen *this)
{
  return 16;
}

//----- (0037AAF0) --------------------------------------------------------
int __fastcall CEventCopCarBeingStolen::GetEventPriority(const CEventCopCarBeingStolen *this)
{
  return 38;
}

//----- (0037AAF4) --------------------------------------------------------
int __fastcall CEventCopCarBeingStolen::GetLifeTime(const CEventCopCarBeingStolen *this)
{
  return 0;
}

//----- (0037AAF8) --------------------------------------------------------
CEvent *__fastcall CEventCopCarBeingStolen::Clone(const CEventCopCarBeingStolen *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  CVehicle *m_pTargetVehicle; // r0
  __int64 v8; // kr08_8

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v8 = *(_QWORD *)&this->m_pCriminal;
  m_pTargetVehicle = this->m_pTargetVehicle;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_6668B4;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_QWORD *)(m_nFreeIndex + 12) = __PAIR64__((unsigned int)m_pTargetVehicle, v8);
  if ( (_DWORD)v8 )
  {
    CEntity::RegisterReference((CEntity *)v8, (CEntity **)(m_nFreeIndex + 12));
    m_pTargetVehicle = *(CVehicle **)(m_nFreeIndex + 16);
  }
  if ( m_pTargetVehicle )
    CEntity::RegisterReference(m_pTargetVehicle, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 6668B4: using guessed type void *off_6668B4;

//----- (0037AB90) --------------------------------------------------------
int __fastcall CEventVehicleDamage::GetEventPriority(const CEventVehicleDamage *this)
{
  return 49;
}

//----- (0037AB94) --------------------------------------------------------
int __fastcall CEventVehicleDamage::GetLifeTime(const CEventVehicleDamage *this)
{
  return 0;
}

//----- (0037AB98) --------------------------------------------------------
float __fastcall CEventVehicleDamage::GetLocalSoundLevel(const CEventVehicleDamage *this)
{
  return 55.0;
}

//----- (0037ABA0) --------------------------------------------------------
int __fastcall CEventSpecial::GetEventType(const CEventSpecial *this)
{
  return 42;
}

//----- (0037ABA4) --------------------------------------------------------
int __fastcall CEventSpecial::GetEventPriority(const CEventSpecial *this)
{
  return 52;
}

//----- (0037ABA8) --------------------------------------------------------
int __fastcall CEventSpecial::GetLifeTime(const CEventSpecial *this)
{
  return 0;
}

//----- (0037ABAC) --------------------------------------------------------
bool __fastcall CEventSpecial::AffectsPed(const CEventSpecial *this, CPed *pPed)
{
  return 1;
}

//----- (0037ABB0) --------------------------------------------------------
CEvent *__fastcall CEventSpecial::CloneEditable(const CEventSpecial *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  CEvent *result; // r0
  CEvent *m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  result = (CEvent *)CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = (CEvent *)CPools::ms_pEventPool->m_nSize;
  do
  {
    result = (CEvent *)((char *)result + 1);
    v2->m_nFreeIndex = (int32)result;
    if ( result == m_nSize )
    {
      result = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = *((char *)&result->_vptr$CEvent + (_DWORD)m_aFlags);
  }
  while ( v6 > -1 );
  *((_BYTE *)&result->_vptr$CEvent + (_DWORD)m_aFlags) = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  result = (CEvent *)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  result->m_iAccumulatedTime = 0;
  *(_DWORD *)&result->m_bIsPersistent = 13107456;
  LOWORD(result[1]._vptr$CEvent) = -1;
  result->_vptr$CEvent = (int (**)(void))&off_666950;
  return result;
}
// 666950: using guessed type void *off_666950;

//----- (0037AC34) --------------------------------------------------------
int __fastcall CEventGotKnockedOverByCar::GetEventType(const CEventGotKnockedOverByCar *this)
{
  return 43;
}

//----- (0037AC38) --------------------------------------------------------
int __fastcall CEventGotKnockedOverByCar::GetEventPriority(const CEventGotKnockedOverByCar *this)
{
  return 37;
}

//----- (0037AC3C) --------------------------------------------------------
int __fastcall CEventGotKnockedOverByCar::GetLifeTime(const CEventGotKnockedOverByCar *this)
{
  return 0;
}

//----- (0037AC40) --------------------------------------------------------
float __fastcall CEventGotKnockedOverByCar::GetLocalSoundLevel(const CEventGotKnockedOverByCar *this)
{
  return 55.0;
}

//----- (0037AC48) --------------------------------------------------------
CEvent *__fastcall CEventGotKnockedOverByCar::CloneEditable(const CEventGotKnockedOverByCar *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pVehicle = this->m_pVehicle;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_6669A0;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pVehicle;
  if ( m_pVehicle )
    CEntity::RegisterReference(m_pVehicle, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 6669A0: using guessed type void *off_6669A0;

//----- (0037ACE0) --------------------------------------------------------
int __fastcall CEventCarUpsideDown::GetEventType(const CEventCarUpsideDown *this)
{
  return 45;
}

//----- (0037ACE4) --------------------------------------------------------
int __fastcall CEventCarUpsideDown::GetEventPriority(const CEventCarUpsideDown *this)
{
  return 18;
}

//----- (0037ACE8) --------------------------------------------------------
int __fastcall CEventCarUpsideDown::GetLifeTime(const CEventCarUpsideDown *this)
{
  return 0;
}

//----- (0037ACEC) --------------------------------------------------------
CEvent *__fastcall CEventCarUpsideDown::Clone(const CEventCarUpsideDown *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CVehicle *m_pVehicle; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pVehicle = this->m_pVehicle;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_6669F0;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pVehicle;
  if ( m_pVehicle )
    CEntity::RegisterReference(m_pVehicle, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 6669F0: using guessed type void *off_6669F0;

//----- (0037AD78) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoFire::GetEventType(const CEventPotentialWalkIntoFire *this)
{
  return 46;
}

//----- (0037AD7C) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoFire::GetEventPriority(const CEventPotentialWalkIntoFire *this)
{
  return 31;
}

//----- (0037AD80) --------------------------------------------------------
int __fastcall CEventPotentialWalkIntoFire::GetLifeTime(const CEventPotentialWalkIntoFire *this)
{
  return 0;
}

//----- (0037AD84) --------------------------------------------------------
CEvent *__fastcall CEventPotentialWalkIntoFire::CloneEditable(const CEventPotentialWalkIntoFire *this)
{
  int v1; // lr
  CEventPool *v2; // r2
  int32 m_nFreeIndex; // r1
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r3
  int v6; // r4
  float m_fStrength; // s4
  int m_iMoveState; // r3
  int (*v9)(); // r4
  int v10; // s0
  __int64 v11; // d16
  RwReal z; // r2
  CEvent *result; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_fStrength = this->m_fStrength;
  m_iMoveState = this->m_iMoveState;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  v9 = sub_37AE5C;
  if ( m_fStrength < 2.0 )
    v9 = (int (*)())&loc_37AE60;
  v10 = *(_DWORD *)v9;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  if ( m_fStrength < 1.0 )
    v10 = 1065772646;
  *(_DWORD *)m_nFreeIndex = &off_666A3C;
  v11 = *(_QWORD *)&this->m_vFirePos.x;
  z = this->m_vFirePos.z;
  result = (CEvent *)m_nFreeIndex;
  *(RwReal *)(m_nFreeIndex + 24) = z;
  *(_DWORD *)(m_nFreeIndex + 36) = m_iMoveState;
  *(_QWORD *)(m_nFreeIndex + 16) = v11;
  *(float *)(m_nFreeIndex + 28) = m_fStrength;
  *(_DWORD *)(m_nFreeIndex + 32) = v10;
  return result;
}
// 37AE5C: using guessed type int sub_37AE5C();
// 666A3C: using guessed type void *off_666A3C;

//----- (0037AE64) --------------------------------------------------------
int __fastcall CEventFireNearby::GetEventType(const CEventFireNearby *this)
{
  return 59;
}

//----- (0037AE68) --------------------------------------------------------
int __fastcall CEventFireNearby::GetEventPriority(const CEventFireNearby *this)
{
  return 17;
}

//----- (0037AE6C) --------------------------------------------------------
int __fastcall CEventFireNearby::GetLifeTime(const CEventFireNearby *this)
{
  return 0;
}

//----- (0037AE70) --------------------------------------------------------
CEvent *__fastcall CEventFireNearby::CloneEditable(const CEventFireNearby *this)
{
  int v1; // lr
  CEventPool *v2; // r2
  int32 m_nFreeIndex; // r1
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r3
  int v6; // r4
  __int64 v7; // d16
  CEvent *result; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666A8C;
  v7 = *(_QWORD *)&this->m_vFirePos.x;
  *(RwReal *)(m_nFreeIndex + 24) = this->m_vFirePos.z;
  result = (CEvent *)m_nFreeIndex;
  *(_QWORD *)(m_nFreeIndex + 16) = v7;
  return result;
}
// 666A8C: using guessed type void *off_666A8C;

//----- (0037AF04) --------------------------------------------------------
int __fastcall CEventGunShotWhizzedBy::GetEventType(const CEventGunShotWhizzedBy *this)
{
  return 49;
}

//----- (0037AF08) --------------------------------------------------------
int __fastcall CEventGunShotWhizzedBy::GetEventPriority(const CEventGunShotWhizzedBy *this)
{
  return 36;
}

//----- (0037AF0C) --------------------------------------------------------
int __fastcall CEventGunShotWhizzedBy::GetLifeTime(const CEventGunShotWhizzedBy *this)
{
  return 0;
}

//----- (0037AF10) --------------------------------------------------------
bool __fastcall CEventGunShotWhizzedBy::CanBeInterruptedBySameEvent(const CEventGunShotWhizzedBy *this)
{
  return 1;
}

//----- (0037AF14) --------------------------------------------------------
CEvent *__fastcall CEventGunShotWhizzedBy::CloneEditable(const CEventGunShotWhizzedBy *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CEntity *m_pFiringEntity; // r2
  __int64 v8; // kr08_8
  bool m_bSilent; // r12
  CVector *p_m_vShotOrigin; // r0
  __int64 v11; // d16
  __int64 v12; // d17

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pFiringEntity = this->m_pFiringEntity;
  v8 = *(_QWORD *)&this->m_vShotTarget.y;
  m_bSilent = this->m_bSilent;
  p_m_vShotOrigin = &this->m_vShotOrigin;
  v11 = *(_QWORD *)&p_m_vShotOrigin->x;
  v12 = *(_QWORD *)&p_m_vShotOrigin->z;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_QWORD *)(m_nFreeIndex + 36) = v8;
  *(_QWORD *)(m_nFreeIndex + 20) = v11;
  *(_QWORD *)(m_nFreeIndex + 28) = v12;
  *(_BYTE *)(m_nFreeIndex + 44) = m_bSilent;
  *(_DWORD *)m_nFreeIndex = &off_665E10;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pFiringEntity;
  if ( m_pFiringEntity )
    CEntity::RegisterReference(m_pFiringEntity, (CEntity **)(m_nFreeIndex + 16));
  *(_DWORD *)m_nFreeIndex = &off_666ADC;
  return (CEvent *)m_nFreeIndex;
}
// 665E10: using guessed type void *off_665E10;
// 666ADC: using guessed type void *off_666ADC;

//----- (0037AFE0) --------------------------------------------------------
int __fastcall CEventSeenPanickedPed::GetEventType(const CEventSeenPanickedPed *this)
{
  return 65;
}

//----- (0037AFE4) --------------------------------------------------------
int __fastcall CEventSeenPanickedPed::GetEventPriority(const CEventSeenPanickedPed *this)
{
  return 13;
}

//----- (0037AFE8) --------------------------------------------------------
int __fastcall CEventSeenPanickedPed::GetLifeTime(const CEventSeenPanickedPed *this)
{
  return 0;
}

//----- (0037AFEC) --------------------------------------------------------
CEntity *__fastcall CEventSeenPanickedPed::GetSourceEntity(const CEventSeenPanickedPed *this)
{
  return this->m_pPanickedPed;
}

//----- (0037AFF0) --------------------------------------------------------
CEvent *__fastcall CEventSeenPanickedPed::CloneEditable(const CEventSeenPanickedPed *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pPanickedPed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pPanickedPed = this->m_pPanickedPed;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666B2C;
  *(_DWORD *)(m_nFreeIndex + 16) = m_pPanickedPed;
  if ( m_pPanickedPed )
    CEntity::RegisterReference(m_pPanickedPed, (CEntity **)(m_nFreeIndex + 16));
  return (CEvent *)m_nFreeIndex;
}
// 666B2C: using guessed type void *off_666B2C;

//----- (0037B088) --------------------------------------------------------
int __fastcall CEventAreaCodes::GetEventType(const CEventAreaCodes *this)
{
  return 67;
}

//----- (0037B08C) --------------------------------------------------------
int __fastcall CEventAreaCodes::GetLifeTime(const CEventAreaCodes *this)
{
  return 0;
}

//----- (0037B090) --------------------------------------------------------
CEvent *__fastcall CEventAreaCodes::Clone(const CEventAreaCodes *this)
{
  int v1; // lr
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r2
  int v6; // r3
  CPed *m_pTargetPed; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  m_pTargetPed = this->m_pTargetPed;
  *(_BYTE *)(m_nFreeIndex + 8) = 0;
  *(_DWORD *)m_nFreeIndex = &off_666B7C;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 12) = m_pTargetPed;
  if ( m_pTargetPed )
    CEntity::RegisterReference(m_pTargetPed, (CEntity **)(m_nFreeIndex + 12));
  return (CEvent *)m_nFreeIndex;
}
// 666B7C: using guessed type void *off_666B7C;

//----- (0037B11C) --------------------------------------------------------
int __fastcall CEventDanger::GetEventType(const CEventDanger *this)
{
  return 75;
}

//----- (0037B120) --------------------------------------------------------
int __fastcall CEventDanger::GetEventPriority(const CEventDanger *this)
{
  return 20;
}

//----- (0037B124) --------------------------------------------------------
int __fastcall CEventDanger::GetLifeTime(const CEventDanger *this)
{
  return 0;
}

//----- (0037B128) --------------------------------------------------------
CEvent *__fastcall CEventDanger::CloneEditable(const CEventDanger *this)
{
  int v1; // r3
  CEventPool *v2; // r1
  int32 m_nFreeIndex; // r4
  int32 m_nSize; // r12
  uint8 *m_aFlags; // r5
  int v6; // r2
  __int64 v7; // kr08_8
  CEvent *result; // r0

  v1 = 0;
  v2 = CPools::ms_pEventPool;
  m_nFreeIndex = CPools::ms_pEventPool->m_nFreeIndex;
  m_nSize = CPools::ms_pEventPool->m_nSize;
  do
  {
    v2->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v2->m_nFreeIndex = 0;
      if ( v1 << 31 )
        goto LABEL_7;
      v1 = 1;
    }
    m_aFlags = v2->m_aFlags;
    v6 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v6 > -1 );
  m_aFlags[m_nFreeIndex] = v6 & 0x7F;
  v2->m_aFlags[v2->m_nFreeIndex] = (v2->m_aFlags[v2->m_nFreeIndex] + 1) & 0x7F | v2->m_aFlags[v2->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v2->m_aStorage[v2->m_nFreeIndex];
LABEL_7:
  v7 = *(_QWORD *)&this->m_pDangerousEntity;
  *(_DWORD *)(m_nFreeIndex + 4) = 0;
  *(_DWORD *)(m_nFreeIndex + 8) = 13107456;
  *(_WORD *)(m_nFreeIndex + 12) = -1;
  *(_DWORD *)m_nFreeIndex = &off_666C18;
  *(_DWORD *)(m_nFreeIndex + 16) = v7;
  if ( (_DWORD)v7 )
    CEntity::RegisterReference((CEntity *)v7, (CEntity **)(m_nFreeIndex + 16));
  result = (CEvent *)m_nFreeIndex;
  *(_DWORD *)(m_nFreeIndex + 20) = HIDWORD(v7);
  return result;
}
// 666C18: using guessed type void *off_666C18;

//----- (0037B1C0) --------------------------------------------------------
int __fastcall CEventSource::ComputeEventSourceType(const CEvent *event, const CPed *pedActedOnByEvent)
{
  int v3; // r0
  const CPed *v4; // r4
  CPedIntelligence *m_pPedIntelligence; // r5

  v3 = (*((int (__fastcall **)(const CEvent *))event->_vptr$CEvent + 11))(event);
  v4 = (const CPed *)v3;
  if ( !v3 || (*(_BYTE *)(v3 + 58) & 7) != 3 )
    return 0;
  m_pPedIntelligence = pedActedOnByEvent->m_pPedIntelligence;
  if ( CPedIntelligence::IsThreatenedBy(m_pPedIntelligence, (const CPed *)v3) )
    return 3;
  if ( CPedIntelligence::IsFriendlyWith(m_pPedIntelligence, v4) )
    return 2;
  return CPed::IsPlayer(v4);
}

//----- (0037B210) --------------------------------------------------------
void __fastcall CEventHandlerHistory::~CEventHandlerHistory(CEventHandlerHistory *this)
{
  CEvent *m_pCurrentEventPassive; // r0
  CEvent *m_pCurrentEventActive; // r0
  CEvent *m_pStoredEventActive; // r0

  m_pCurrentEventPassive = this->m_pCurrentEventPassive;
  if ( m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
  m_pCurrentEventActive = this->m_pCurrentEventActive;
  this->m_pCurrentEventPassive = 0;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  m_pStoredEventActive = this->m_pStoredEventActive;
  this->m_pCurrentEventActive = 0;
  if ( m_pStoredEventActive )
  {
    (*((void (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 1))(m_pStoredEventActive);
    this->m_pStoredEventActive = 0;
  }
}

//----- (0037B246) --------------------------------------------------------
void __fastcall CEventHandlerHistory::Flush(CEventHandlerHistory *this)
{
  CEvent *m_pCurrentEventPassive; // r0
  CEvent *m_pCurrentEventActive; // r0
  CEvent *m_pStoredEventActive; // r0

  m_pCurrentEventPassive = this->m_pCurrentEventPassive;
  if ( m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
  m_pCurrentEventActive = this->m_pCurrentEventActive;
  this->m_pCurrentEventPassive = 0;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  m_pStoredEventActive = this->m_pStoredEventActive;
  this->m_pCurrentEventActive = 0;
  if ( m_pStoredEventActive )
  {
    (*((void (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 1))(m_pStoredEventActive);
    this->m_pStoredEventActive = 0;
  }
}

//----- (0037B27E) --------------------------------------------------------
void __fastcall CEventHandlerHistory::ClearAllEvents(CEventHandlerHistory *this)
{
  CEvent *m_pCurrentEventPassive; // r0
  CEvent *m_pCurrentEventActive; // r0

  m_pCurrentEventPassive = this->m_pCurrentEventPassive;
  if ( m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
  m_pCurrentEventActive = this->m_pCurrentEventActive;
  this->m_pCurrentEventPassive = 0;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  this->m_pCurrentEventActive = 0;
}

//----- (0037B2A4) --------------------------------------------------------
bool __fastcall CEventHandlerHistory::IsRespondingToEvent(const CEventHandlerHistory *this, const int iEventType)
{
  CEvent *m_pCurrentEventActive; // r0
  bool v5; // r4
  CEvent *m_pStoredEventActive; // r0

  m_pCurrentEventActive = this->m_pCurrentEventActive;
  if ( iEventType == -1 )
  {
    return m_pCurrentEventActive || this->m_pStoredEventActive != 0;
  }
  else
  {
    v5 = 0;
    if ( m_pCurrentEventActive )
    {
      if ( (*((int (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 2))(m_pCurrentEventActive) == iEventType )
        v5 = 1;
    }
    m_pStoredEventActive = this->m_pStoredEventActive;
    if ( m_pStoredEventActive )
      return v5 | ((*((int (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 2))(m_pStoredEventActive) == iEventType);
  }
  return v5;
}

//----- (0037B2F8) --------------------------------------------------------
void __fastcall CEventHandlerHistory::StoreActiveEvent(CEventHandlerHistory *this)
{
  CEvent *m_pStoredEventActive; // r0

  m_pStoredEventActive = this->m_pStoredEventActive;
  if ( m_pStoredEventActive )
    (*((void (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 1))(m_pStoredEventActive);
  this->m_pStoredEventActive = this->m_pCurrentEventActive;
  this->m_storeTimer.m_iStartTime = CTimer::m_snTimeInMilliseconds;
  this->m_storeTimer.m_bIsActive = 1;
  this->m_storeTimer.m_iDuration = 2000;
}

//----- (0037B328) --------------------------------------------------------
void __fastcall CEventHandlerHistory::TickStoredEvent(CEventHandlerHistory *this, CPed *pPed)
{
  CEvent *m_pStoredEventActive; // r1

  m_pStoredEventActive = this->m_pStoredEventActive;
  if ( m_pStoredEventActive )
  {
    if ( !this->m_pCurrentEventPassive )
    {
      this->m_pStoredEventActive = 0;
      this->m_pCurrentEventActive = m_pStoredEventActive;
    }
  }
}

//----- (0037B340) --------------------------------------------------------
void __fastcall CEventHandlerHistory::RecordCurrentEvent(
        CEventHandlerHistory *this,
        CPed *pPed,
        const CEvent *rCurrentEvent)
{
  CEvent *m_pCurrentEventActive; // r1
  CEvent *m_pStoredEventActive; // r0
  __int64 v7; // r0
  CEvent *v8; // r0
  CEvent **p_m_pCurrentEventPassive; // r4
  CEvent *m_pCurrentEventPassive; // t1
  int v11; // r0
  CEvent *v12; // r0
  CEvent *v13; // r1
  CEvent *v14; // r0
  CEvent *v15; // r1
  CEvent *v16; // t1

  if ( (*((int (__fastcall **)(const CEvent *))rCurrentEvent->_vptr$CEvent + 2))(rCurrentEvent) != 32 )
  {
    switch ( (*((int (__fastcall **)(_DWORD))rCurrentEvent->_vptr$CEvent + 2))(rCurrentEvent) )
    {
      case 1:
      case 2:
      case 3:
      case 4:
      case 5:
      case 6:
      case 12:
      case 13:
      case 33:
      case 44:
      case 46:
      case 56:
      case 59:
      case 60:
      case 67:
      case 74:
      case 93:
        m_pCurrentEventActive = this->m_pCurrentEventActive;
        if ( m_pCurrentEventActive )
        {
          m_pStoredEventActive = this->m_pStoredEventActive;
          if ( m_pStoredEventActive )
          {
            (*((void (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 1))(m_pStoredEventActive);
            m_pCurrentEventActive = this->m_pCurrentEventActive;
          }
          this->m_pStoredEventActive = m_pCurrentEventActive;
          v7 = CTimer::m_snTimeInMilliseconds | 0x7D000000000LL;
          this->m_storeTimer.m_bIsActive = 1;
          *(_QWORD *)&this->m_storeTimer.m_iStartTime = v7;
          this->m_pCurrentEventActive = 0;
        }
        m_pCurrentEventPassive = this->m_pCurrentEventPassive;
        p_m_pCurrentEventPassive = &this->m_pCurrentEventPassive;
        v8 = m_pCurrentEventPassive;
        if ( m_pCurrentEventPassive )
          (*((void (__fastcall **)(CEvent *))v8->_vptr$CEvent + 1))(v8);
        v11 = (*((int (__fastcall **)(const CEvent *))rCurrentEvent->_vptr$CEvent + 5))(rCurrentEvent);
        goto LABEL_10;
      default:
        v12 = this->m_pCurrentEventActive;
        if ( v12 )
          (*((void (__fastcall **)(CEvent *))v12->_vptr$CEvent + 1))(v12);
        v13 = (CEvent *)(*((int (__fastcall **)(const CEvent *))rCurrentEvent->_vptr$CEvent + 5))(rCurrentEvent);
        v14 = this->m_pStoredEventActive;
        this->m_pCurrentEventActive = v13;
        if ( v14 )
          (*((void (__fastcall **)(CEvent *))v14->_vptr$CEvent + 1))(v14);
        v16 = this->m_pCurrentEventPassive;
        p_m_pCurrentEventPassive = &this->m_pCurrentEventPassive;
        v15 = v16;
        v11 = 0;
        p_m_pCurrentEventPassive[1] = 0;
        if ( v16 )
        {
          (*((void (__fastcall **)(CEvent *))v15->_vptr$CEvent + 1))(v15);
          *p_m_pCurrentEventPassive = 0;
        }
        else
        {
LABEL_10:
          *p_m_pCurrentEventPassive = (CEvent *)v11;
        }
        break;
    }
  }
}

//----- (0037B450) --------------------------------------------------------
bool __fastcall CEventHandler::IsTemporaryEvent(const CEvent *event)
{
  int v1; // r1
  bool result; // r0

  v1 = (*((int (__fastcall **)(const CEvent *))event->_vptr$CEvent + 2))(event) - 1;
  result = 1;
  switch ( v1 )
  {
    case 0:
    case 1:
    case 2:
    case 3:
    case 4:
    case 5:
    case 11:
    case 12:
    case 32:
    case 43:
    case 45:
    case 55:
    case 58:
    case 59:
    case 66:
    case 73:
    case 92:
      return result;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (0037B4CC) --------------------------------------------------------
void __fastcall CEventHandlerHistory::ClearTempEvent(CEventHandlerHistory *this)
{
  CEvent *m_pCurrentEventPassive; // r0

  m_pCurrentEventPassive = this->m_pCurrentEventPassive;
  if ( m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
  this->m_pCurrentEventPassive = 0;
}

//----- (0037B4E4) --------------------------------------------------------
void __fastcall CEventHandlerHistory::ClearNonTempEvent(CEventHandlerHistory *this)
{
  CEvent *m_pCurrentEventActive; // r0

  m_pCurrentEventActive = this->m_pCurrentEventActive;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  this->m_pCurrentEventActive = 0;
}

//----- (0037B4FC) --------------------------------------------------------
int __fastcall CEventHandlerHistory::GetCurrentEventPriority(const CEventHandlerHistory *this)
{
  CEvent *m_pCurrentEventPassive; // r0
  bool v3; // zf

  m_pCurrentEventPassive = this->m_pCurrentEventPassive;
  v3 = m_pCurrentEventPassive == 0;
  if ( !m_pCurrentEventPassive )
  {
    m_pCurrentEventPassive = this->m_pCurrentEventActive;
    v3 = m_pCurrentEventPassive == 0;
  }
  if ( v3 )
    return -1;
  else
    return (*((int (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 3))(m_pCurrentEventPassive);
}

//----- (0037B516) --------------------------------------------------------
CEvent *__fastcall CEventHandlerHistory::GetCurrentEvent(const CEventHandlerHistory *this)
{
  CEvent *result; // r0

  result = this->m_pCurrentEventPassive;
  if ( !result )
    return this->m_pCurrentEventActive;
  return result;
}

//----- (0037B522) --------------------------------------------------------
CEvent *__fastcall CEventHandlerHistory::GetStoredActiveEvent(const CEventHandlerHistory *this)
{
  return this->m_pStoredEventActive;
}

//----- (0037B528) --------------------------------------------------------
bool __fastcall CEventHandlerHistory::TakesPriorityOverCurrentEvent(CEventHandlerHistory *this, const CEvent *newEvent)
{
  bool result; // r0
  int v5; // r6
  int v6; // r1

  if ( this->m_pCurrentEventActive )
    return (*((int (__fastcall **)(const CEvent *))newEvent->_vptr$CEvent + 12))(newEvent);
  if ( !this->m_pCurrentEventPassive )
    return 1;
  v5 = 1;
  switch ( (*((int (__fastcall **)(_DWORD))newEvent->_vptr$CEvent + 2))(newEvent) )
  {
    case 1:
    case 2:
    case 3:
    case 4:
    case 5:
    case 6:
    case 12:
    case 13:
    case 33:
    case 44:
    case 46:
    case 56:
    case 59:
    case 60:
    case 67:
    case 74:
    case 93:
      break;
    default:
      v5 = 0;
      break;
  }
  v6 = (*((int (__fastcall **)(const CEvent *, CEvent *))newEvent->_vptr$CEvent + 12))(
         newEvent,
         this->m_pCurrentEventPassive);
  result = v5 & v6;
  if ( !v5 && v6 )
  {
    if ( this->m_pStoredEventActive )
      return (*((int (__fastcall **)(const CEvent *))newEvent->_vptr$CEvent + 12))(newEvent);
    return 1;
  }
  return result;
}

//----- (0037B5EC) --------------------------------------------------------
void __fastcall CEventHandler::CEventHandler(CEventHandler *this, CPed *pPed)
{
  this->m_pPed = pPed;
  this->m_pTaskSecondaryPartialAnim = 0;
  *(_QWORD *)((char *)&this->m_history.m_pCurrentEventPassive + 2) = 0LL;
  *(_QWORD *)((char *)&this->m_history.m_storeTimer.m_iStartTime + 2) = 0LL;
  *(_QWORD *)&this->m_pTaskPhysResponse = 0LL;
  *(_QWORD *)&this->m_pTaskSecondaryAim = 0LL;
  *(_QWORD *)&this->m_history.m_pAbortedTask = 0LL;
  *(_QWORD *)&this->m_history.m_pCurrentEventPassive = 0LL;
}

//----- (0037B60E) --------------------------------------------------------
void __fastcall CEventHandler::~CEventHandler(CEventHandler *this)
{
  CEvent *m_pCurrentEventPassive; // r0
  CEvent *m_pCurrentEventActive; // r0
  CEvent *m_pStoredEventActive; // r0

  m_pCurrentEventPassive = this->m_history.m_pCurrentEventPassive;
  if ( m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
  m_pCurrentEventActive = this->m_history.m_pCurrentEventActive;
  this->m_history.m_pCurrentEventPassive = 0;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  m_pStoredEventActive = this->m_history.m_pStoredEventActive;
  this->m_history.m_pCurrentEventActive = 0;
  if ( m_pStoredEventActive )
  {
    (*((void (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 1))(m_pStoredEventActive);
    this->m_history.m_pStoredEventActive = 0;
  }
}

//----- (0037B644) --------------------------------------------------------
int __fastcall CEventHandler::GetCurrentEventType(const CEventHandler *this)
{
  CEvent *m_pCurrentEventPassive; // r0
  bool v3; // zf

  m_pCurrentEventPassive = this->m_history.m_pCurrentEventPassive;
  v3 = m_pCurrentEventPassive == 0;
  if ( !m_pCurrentEventPassive )
  {
    m_pCurrentEventPassive = this->m_history.m_pCurrentEventActive;
    v3 = m_pCurrentEventPassive == 0;
  }
  if ( v3 )
    return -1;
  else
    return (*((int (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 2))(m_pCurrentEventPassive);
}

//----- (0037B660) --------------------------------------------------------
void __fastcall CEventHandler::SetEventResponseTask(const CEventHandler *this, const CEvent *event)
{
  int32 p_m_taskManager; // r5
  CTask *m_pTaskPhysResponse; // r1
  CPedIntelligence *m_pPedIntelligence; // r6
  CTask *TaskSecondary; // r0
  CTaskSimple *m_pTaskSecondarySay; // r1
  CTaskSimple *m_pTaskSecondaryPartialAnim; // r1
  CTask *v10; // r0
  bool v11; // zf
  CTaskComplexFacial *v12; // r0

  m_pTaskPhysResponse = this->m_pTaskPhysResponse;
  m_pPedIntelligence = this->m_pPed->m_pPedIntelligence;
  if ( m_pTaskPhysResponse )
    CPedIntelligence::AddTaskPhysResponse(this->m_pPed->m_pPedIntelligence, m_pTaskPhysResponse, 1);
  if ( this->m_pTaskEventResponse )
  {
    switch ( (*((int (__fastcall **)(_DWORD))event->_vptr$CEvent + 2))(event) )
    {
      case 1:
      case 2:
      case 3:
      case 4:
      case 5:
      case 6:
      case 12:
      case 13:
      case 33:
      case 44:
      case 46:
      case 56:
      case 59:
      case 60:
      case 67:
      case 74:
      case 93:
        CPedIntelligence::AddTaskEventResponseTemp(m_pPedIntelligence, this->m_pTaskEventResponse, 0);
        break;
      default:
        CPedIntelligence::AddTaskEventResponseTemp(m_pPedIntelligence, 0, 0);
        CPedIntelligence::AddTaskEventResponseNonTemp(m_pPedIntelligence, this->m_pTaskEventResponse, 0);
        break;
    }
  }
  if ( this->m_pTaskSecondaryAim )
  {
    p_m_taskManager = (int32)&m_pPedIntelligence->m_taskManager;
    if ( CTaskManager::GetTaskSecondary(&m_pPedIntelligence->m_taskManager, 0) )
    {
      TaskSecondary = CTaskManager::GetTaskSecondary(&m_pPedIntelligence->m_taskManager, 0);
      (*((void (__fastcall **)(CTask *, CPed *, int, _DWORD))TaskSecondary->_vptr$CTask + 7))(
        TaskSecondary,
        this->m_pPed,
        1,
        0);
    }
    CTaskManager::SetTaskSecondary(&m_pPedIntelligence->m_taskManager, this->m_pTaskSecondaryAim, 0);
  }
  m_pTaskSecondarySay = this->m_pTaskSecondarySay;
  if ( m_pTaskSecondarySay )
    CTaskManager::SetTaskSecondary(&m_pPedIntelligence->m_taskManager, m_pTaskSecondarySay, 2);
  m_pTaskSecondaryPartialAnim = this->m_pTaskSecondaryPartialAnim;
  if ( m_pTaskSecondaryPartialAnim )
    CTaskManager::SetTaskSecondary(&m_pPedIntelligence->m_taskManager, m_pTaskSecondaryPartialAnim, 4);
  if ( (*((int (__fastcall **)(const CEvent *))event->_vptr$CEvent + 10))(event) == 1 )
  {
    v10 = CTaskManager::GetTaskSecondary(&this->m_pPed->m_pPedIntelligence->m_taskManager, 3);
    v11 = v10 == 0;
    if ( v10 )
    {
      p_m_taskManager = SLOWORD(event[1]._vptr$CEvent);
      v11 = p_m_taskManager == -1;
    }
    if ( !v11 )
    {
      v12 = (CTaskComplexFacial *)CTaskManager::GetTaskSecondary(&this->m_pPed->m_pPedIntelligence->m_taskManager, 3);
      CTaskComplexFacial::SetRequest(v12, p_m_taskManager, 10000, -1, 0);
    }
  }
}
// 37B7F6: variable 'p_m_taskManager' is possibly undefined

//----- (0037B818) --------------------------------------------------------
void __fastcall CEventHandler::HandleEvents(CEventHandler *this)
{
  CEvent *m_pStoredEventActive; // r2
  __int64 v2; // r8
  CPedIntelligence *m_pPedIntelligence; // r3
  CTask *v4; // r4
  unsigned int v5; // r6
  CTask *v6; // r5
  CEventGroup *p_m_eventGroup; // r10
  CEvent *HighestPriorityEvent; // r11
  CEventGroup *v9; // r0
  CEventHandlerHistory *v10; // r10
  CTask *v11; // r0
  CEvent *v12; // r6
  CEvent *v13; // r0
  bool v14; // zf
  CEvent *v15; // r0
  int v16; // r5
  CEvent *v17; // r0
  CEvent *v18; // r0
  CEvent *m_pCurrentEventPassive; // r0
  CEvent *m_pCurrentEventActive; // r0
  CEvent *v21; // r0
  CEvent *v22; // r0
  int v23; // r5
  int v24; // r0
  CTask *ActiveTask; // r0
  CTask *v26; // r11
  int v27; // r0
  CPed *v28; // r1
  CTask *m_pTaskEventResponse; // r0
  CPedIntelligence *v30; // [sp+0h] [bp-28h]
  CEventGroup *v31; // [sp+4h] [bp-24h]

  m_pStoredEventActive = this->m_history.m_pStoredEventActive;
  if ( m_pStoredEventActive && !this->m_history.m_pCurrentEventPassive )
  {
    this->m_history.m_pStoredEventActive = 0;
    this->m_history.m_pCurrentEventActive = m_pStoredEventActive;
  }
  HIDWORD(v2) = this->m_history.m_pAbortedTask;
  LODWORD(v2) = &this->m_history;
  m_pPedIntelligence = this->m_pPed->m_pPedIntelligence;
  v5 = (unsigned int)m_pPedIntelligence->m_taskManager.m_tasks[1];
  v4 = m_pPedIntelligence->m_taskManager.m_tasks[0];
  v6 = v4;
  if ( !v4 )
  {
    v4 = m_pPedIntelligence->m_taskManager.m_tasks[1];
    if ( !v5 )
      v4 = m_pPedIntelligence->m_taskManager.m_tasks[2];
    v6 = m_pPedIntelligence->m_taskManager.m_tasks[2];
  }
  p_m_eventGroup = &m_pPedIntelligence->m_eventGroup;
  v30 = this->m_pPed->m_pPedIntelligence;
  HighestPriorityEvent = CEventGroup::GetHighestPriorityEvent(&m_pPedIntelligence->m_eventGroup);
  v9 = p_m_eventGroup;
  v31 = p_m_eventGroup;
  v10 = (CEventHandlerHistory *)v2;
  LODWORD(v2) = v4;
  CEventGroup::TickEvents(v9);
  if ( HIDWORD(v2) )
  {
    v11 = (CTask *)HIDWORD(v2);
    if ( (CTask *)HIDWORD(v2) != v4 )
      v11 = 0;
    if ( !v4 )
      v11 = 0;
    v10->m_pAbortedTask = v11;
  }
  if ( !(v5 | (unsigned int)v6) )
    v10->m_pAbortedTask = 0;
  v14 = v5 == 0;
  v12 = HighestPriorityEvent;
  if ( v14 )
  {
    m_pCurrentEventPassive = this->m_history.m_pCurrentEventPassive;
    if ( m_pCurrentEventPassive )
      (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
    this->m_history.m_pCurrentEventPassive = 0;
    if ( v6 )
    {
LABEL_18:
      if ( HighestPriorityEvent )
        goto LABEL_19;
      goto LABEL_43;
    }
  }
  else if ( v6 )
  {
    goto LABEL_18;
  }
  m_pCurrentEventActive = this->m_history.m_pCurrentEventActive;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  this->m_history.m_pCurrentEventActive = 0;
  if ( HighestPriorityEvent )
  {
LABEL_19:
    if ( (*((int (__fastcall **)(CEvent *))HighestPriorityEvent->_vptr$CEvent + 2))(HighestPriorityEvent) == 9 )
      (*((void (__fastcall **)(CPed *, _DWORD))this->m_pPed->_vptr$CPlaceable + 5))(this->m_pPed, 0);
    v13 = this->m_history.m_pCurrentEventPassive;
    v14 = v13 == 0;
    if ( !v13 )
    {
      v13 = this->m_history.m_pCurrentEventActive;
      v14 = v13 == 0;
    }
    if ( !v14 && !(*((int (__fastcall **)(CEvent *))v13->_vptr$CEvent + 16))(v13) )
    {
      v15 = this->m_history.m_pCurrentEventPassive;
      if ( !v15 )
        v15 = this->m_history.m_pCurrentEventActive;
      v16 = (*((int (__fastcall **)(CEvent *))v15->_vptr$CEvent + 2))(v15);
      if ( v16 == (*((int (__fastcall **)(CEvent *))HighestPriorityEvent->_vptr$CEvent + 2))(HighestPriorityEvent) )
      {
        CEventGroup::Remove(v31, HighestPriorityEvent);
        CEventGroup::RemoveInvalidEvents(v31, 0);
        CEventGroup::Reorganise(v31);
        if ( !v4 )
        {
          v17 = this->m_history.m_pCurrentEventPassive;
          this->m_history.m_pAbortedTask = 0;
          if ( v17 )
            (*((void (__fastcall **)(CEvent *))v17->_vptr$CEvent + 1))(v17);
          v18 = this->m_history.m_pCurrentEventActive;
          this->m_history.m_pCurrentEventPassive = 0;
          if ( v18 )
            (*((void (__fastcall **)(CEvent *))v18->_vptr$CEvent + 1))(v18);
          this->m_history.m_pCurrentEventActive = 0;
        }
        return;
      }
    }
    if ( !this->m_history.m_pCurrentEventActive )
    {
      if ( !this->m_history.m_pCurrentEventPassive )
        goto LABEL_57;
      v23 = 1;
      switch ( (*((int (__fastcall **)(_DWORD))HighestPriorityEvent->_vptr$CEvent + 2))(HighestPriorityEvent) )
      {
        case 1:
        case 2:
        case 3:
        case 4:
        case 5:
        case 6:
        case 12:
        case 13:
        case 33:
        case 44:
        case 46:
        case 56:
        case 59:
        case 60:
        case 67:
        case 74:
        case 93:
          break;
        default:
          v23 = 0;
          break;
      }
      v24 = (*((int (__fastcall **)(CEvent *, CEvent *))HighestPriorityEvent->_vptr$CEvent + 12))(
              HighestPriorityEvent,
              this->m_history.m_pCurrentEventPassive);
      if ( v23 || !v24 )
      {
        if ( (v24 & v23) != 1 )
          goto LABEL_72;
LABEL_57:
        ActiveTask = CTaskManager::GetActiveTask(&v30->m_taskManager);
        v26 = ActiveTask;
        if ( ActiveTask
          && (*((int (__fastcall **)(CTask *, CPed *, int, CEvent *))ActiveTask->_vptr$CTask + 7))(
               ActiveTask,
               this->m_pPed,
               1,
               v12) != 1 )
        {
          v27 = 0;
          if ( v2 )
            goto LABEL_60;
        }
        else
        {
          CTaskManager::StopTimers(&v30->m_taskManager, v12);
          v27 = 1;
          if ( v2 )
          {
LABEL_60:
            if ( HIDWORD(v2) && !v4 || v27 == 1 )
            {
              CEventHandler::ComputeEventResponseTask(this, v12, (CTask *)HIDWORD(v2));
              v28 = 0;
              m_pTaskEventResponse = this->m_pTaskEventResponse;
              this->m_history.m_pAbortedTask = 0;
LABEL_67:
              if ( m_pTaskEventResponse )
                CEventHandlerHistory::RecordCurrentEvent(v10, v28, v12);
              CEventHandler::SetEventResponseTask(this, v12);
              CEventGroup::Remove(v31, v12);
              goto LABEL_72;
            }
            --v12->m_iAccumulatedTime;
            (*((void (__fastcall **)(CTask *, CPed *, _DWORD, CEvent *))v26->_vptr$CTask + 7))(
              v26,
              this->m_pPed,
              0,
              v12);
            this->m_history.m_pAbortedTask = v4;
            goto LABEL_72;
          }
        }
        if ( v27 )
        {
          CEventHandler::ComputeEventResponseTask(this, v12, 0);
          m_pTaskEventResponse = this->m_pTaskEventResponse;
          goto LABEL_67;
        }
        --v12->m_iAccumulatedTime;
LABEL_72:
        CEventGroup::RemoveInvalidEvents(v31, 0);
        sub_19F3E0(v31);
        return;
      }
      if ( !this->m_history.m_pStoredEventActive )
        goto LABEL_57;
    }
    if ( !(*((int (__fastcall **)(CEvent *))HighestPriorityEvent->_vptr$CEvent + 12))(HighestPriorityEvent) )
      goto LABEL_72;
    goto LABEL_57;
  }
LABEL_43:
  if ( !v4 )
  {
    v21 = this->m_history.m_pCurrentEventPassive;
    this->m_history.m_pAbortedTask = 0;
    if ( v21 )
      (*((void (__fastcall **)(CEvent *))v21->_vptr$CEvent + 1))(v21);
    v22 = this->m_history.m_pCurrentEventActive;
    this->m_history.m_pCurrentEventPassive = 0;
    if ( v22 )
      (*((void (__fastcall **)(CEvent *))v22->_vptr$CEvent + 1))(v22);
    this->m_history.m_pCurrentEventActive = 0;
  }
}
// 37BB08: variable 'v28' is possibly undefined

//----- (0037BB60) --------------------------------------------------------
void __fastcall CEventHandler::ComputeEventResponseTask(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pAbortedTaskEventResponse)
{
  CTask *SimplestActiveTask; // r6
  CPed *m_pPed; // r0
  CTask *ActiveTask; // r4
  CEvent *v8; // r1
  CTask *v9; // r2
  CTask *v10; // r3
  __int64 v11; // kr00_8
  int v12; // r0
  bool v13; // zf
  int v14; // r0
  const CPedAttractorManager *PedAttractorManager; // r0
  CTaskComplexUseEffect *v16; // r0
  CTask *v17; // r0
  int IsGoToTask; // r0
  bool v19; // zf
  CEntity *v20; // r9
  CTaskComplexWalkRoundObject *v21; // r0
  bool v22; // r4
  int (**v23)(void); // r5
  CTaskSimpleDead *v24; // r0
  const CPed *v25; // r4
  bool v26; // zf
  CTaskComplexLeaveCar *v27; // r0
  CTask *v28; // r0
  CWanted **p_m_Wanted; // r0
  CWanted *v30; // r0
  CPed *m_iAccumulatedTime; // r4
  int v32; // r0
  CTaskGangHasslePed *v33; // r0
  int (**v34)(void); // r4
  CTaskSimpleStandStill *v35; // r0
  CPed *v36; // r2
  CTask *v37; // r0
  int (**v38)(void); // r4
  void *v39; // r5
  char v40; // r2
  int (**v41)(void); // r4
  CTaskComplexSmartFleeEntity *v42; // r0
  int (**v43)(void); // r4
  CTaskComplexStealCar *v44; // r0
  CTaskComplexInAirAndLand *v45; // r0
  CEntity *v46; // r4
  bool v47; // zf
  CTaskComplexWalkRoundObject *v48; // r0
  CPed *v49; // r0
  bool v50; // zf
  CTaskComplexLeaveCar *v51; // r4
  CVehicle *m_pMyVehicle; // r5
  unsigned __int16 v53; // r0
  int v54; // r0
  CTaskComplexEvasiveDiveAndGetUp *v55; // r0
  void **v56; // r1
  int v57; // r0
  CTaskSimplePlayerOnFire *v58; // r0
  CTaskSimple *v59; // r0
  int v60; // r0
  CTaskComplexInvestigateDisturbance *v61; // r4
  CEntity *v62; // r0
  CEntity *v63; // r4
  int v64; // r0
  CTaskComplexInvestigateDisturbance *v65; // r0
  int (**v66)(void); // r4
  CTaskSimpleWaitUntilAreaCodesMatch *v67; // r0
  CTaskComplexPolicePursuit *v68; // r0
  CPed *v69; // r6
  int v70; // r0
  CTaskComplexSmartFleeEntity *v71; // r0
  CTaskComplexGangJoinRespond *v72; // r0
  int (**v73)(void); // r4
  bool8 v74; // r5
  CTaskComplexPartnerChat *v75; // r0
  int v76; // r0
  CTaskComplexExtinguishFires *v77; // r0
  CTaskComplexInWater *v78; // r0
  CTaskSimpleStandStill *v79; // r0
  CTaskInteriorUseInfo *v80; // r0
  CTaskComplexSignalAtPed *v81; // r0
  CTaskComplexPassObject *v82; // r0
  CTaskComplexStuckInAir *v83; // r0
  CTaskComplexOnFire *v84; // r0
  CTaskComplexKillPedOnFoot *v85; // r0
  CTask *bSensibleLeaveCar; // [sp+0h] [bp-48h]
  CVector speed; // [sp+10h] [bp-38h] BYREF
  CVector vDiveDir; // [sp+24h] [bp-24h] BYREF

  SimplestActiveTask = 0;
  this->m_pTaskSecondaryPartialAnim = 0;
  m_pPed = this->m_pPed;
  *(_QWORD *)&this->m_pTaskPhysResponse = 0LL;
  *(_QWORD *)&this->m_pTaskSecondaryAim = 0LL;
  ActiveTask = CTaskManager::GetActiveTask(&m_pPed->m_pPedIntelligence->m_taskManager);
  if ( ActiveTask )
    SimplestActiveTask = CTaskManager::GetSimplestActiveTask(&this->m_pPed->m_pPedIntelligence->m_taskManager);
  (*((void (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent);
  switch ( (*((int (__fastcall **)(_DWORD))pEvent->_vptr$CEvent + 2))(pEvent) )
  {
    case 1:
      CEventHandler::ComputeVehicleCollisionResponse(this, pEvent, v9, SimplestActiveTask);
      return;
    case 2:
      CEventHandler::ComputePedCollisionWithPedResponse(this, pEvent, v9, SimplestActiveTask);
      return;
    case 3:
      CEventHandler::ComputePedCollisionWithPlayerResponse(this, pEvent, ActiveTask, SimplestActiveTask);
      return;
    case 4:
      CEventHandler::ComputePlayerCollisionWithPedResponse(this, pEvent, v9, v10);
      return;
    case 5:
      if ( SimplestActiveTask )
      {
        IsGoToTask = CTask::IsGoToTask(SimplestActiveTask);
        v19 = IsGoToTask == 0;
        if ( IsGoToTask )
        {
          ActiveTask = (CTask *)SLOWORD(pEvent[1]._vptr$CEvent);
          v19 = ActiveTask == (CTask *)((char *)&dword_0 + 1);
        }
        if ( !v19 )
        {
          v20 = *(CEntity **)&pEvent[1].m_bIsPersistent;
          CEventObjectCollision::IsHeadOnCollision((const CEventObjectCollision *)pEvent, this->m_pPed);
          if ( v20 )
          {
            v21 = (CTaskComplexWalkRoundObject *)CTask::operator new(0x54u);
            CTaskComplexWalkRoundObject::CTaskComplexWalkRoundObject(
              v21,
              (const int)ActiveTask,
              (const CVector *)&SimplestActiveTask[1].m_pParent,
              v20);
            goto LABEL_130;
          }
        }
      }
      return;
    case 6:
      CEventHandler::ComputeBuildingCollisionResponse(this, pEvent, ActiveTask, SimplestActiveTask);
      return;
    case 7:
      CEventHandler::ComputeDraggedOutCarResponse(this, pEvent, v9, v10);
      return;
    case 8:
      CEventHandler::ComputeKnockOffBikeResponse(this, pEvent, v9, v10);
      return;
    case 9:
      CEventHandler::ComputeDamageResponse(this, pEvent, ActiveTask, SimplestActiveTask, bSensibleLeaveCar);
      return;
    case 10:
      v22 = *(&pEvent->m_bIsPersistent + 1);
      v23 = pEvent[1]._vptr$CEvent;
      v24 = (CTaskSimpleDead *)CTask::operator new(0x10u);
      CTaskSimpleDead::CTaskSimpleDead(v24, (const int)v23, v22);
      goto LABEL_130;
    case 11:
      CEventHandler::ComputeDeadPedResponse(this, pEvent, v9, v10);
      return;
    case 12:
      CEventHandler::ComputeVehiclePotentialCollisionResponse(this, pEvent, v9, v10);
      return;
    case 13:
      CEventHandler::ComputePotentialPedCollideResponse(this, pEvent, v9, SimplestActiveTask);
      return;
    case 15:
      CEventHandler::ComputeShotFiredResponse(this, pEvent, v9, v10);
      return;
    case 16:
      v25 = (const CPed *)pEvent[1]._vptr$CEvent;
      v26 = v25 == 0;
      if ( v25 )
      {
        pEvent = (CEvent *)pEvent[1].m_iAccumulatedTime;
        v26 = pEvent == 0;
      }
      if ( !v26 && (CEvent *)this->m_pPed->m_pMyVehicle == pEvent )
      {
        if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
        {
          v27 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
          CTaskComplexLeaveCar::CTaskComplexLeaveCar(v27, (CVehicle *)pEvent, 0, 0, 1, 0);
          this->m_pTaskEventResponse = v28;
          if ( CPed::IsPlayer(v25) )
          {
            p_m_Wanted = &v25->m_pPlayerData->m_Wanted;
            if ( p_m_Wanted )
              v30 = *p_m_Wanted;
            else
              v30 = 0;
            sub_18A9C0(v30, 1);
          }
        }
      }
      return;
    case 17:
      CEventHandler::ComputePedEnteredVehicleResponse(this, pEvent, v9, v10);
      return;
    case 18:
      CEventHandler::ComputeReviveResponse(this, v8, v9, v10);
      return;
    case 19:
      v73 = pEvent[1]._vptr$CEvent;
      if ( !v73 )
        goto LABEL_116;
      v74 = *(&pEvent->m_bIsPersistent + 1);
      if ( CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 1204) )
        goto LABEL_116;
      rand();
      v75 = (CTaskComplexPartnerChat *)CTask::operator new(0x78u);
      memset(&speed, 0, sizeof(speed));
      CTaskComplexPartnerChat::CTaskComplexPartnerChat(
        v75,
        "EventChatPartnerResponse",
        (CPed *)v73,
        v74,
        0.5,
        4,
        1,
        0,
        speed);
      goto LABEL_130;
    case 20:
      m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
      if ( !m_iAccumulatedTime )
        return;
      v32 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      if ( v32 == 200 )
        goto LABEL_116;
      if ( v32 != 1212 )
        return;
      v33 = (CTaskGangHasslePed *)CTask::operator new(0x2Cu);
      CTaskGangHasslePed::CTaskGangHasslePed(v33, m_iAccumulatedTime, 0, 10000, 30000);
      goto LABEL_130;
    case 21:
      v34 = pEvent[1]._vptr$CEvent;
      if ( v34 )
      {
        CInterestingEvents::Add(&g_InterestingEvents, ESexyCar, (CEntity *)pEvent[1]._vptr$CEvent);
        v35 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
        CTaskSimpleStandStill::CTaskSimpleStandStill(v35, 5000, 0, 0, 8.0);
        v36 = this->m_pPed;
        this->m_pTaskEventResponse = v37;
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "CompSexyVhclResp",
          v36,
          (CEntity *)v34,
          5000,
          -1,
          0,
          1,
          0.25,
          500,
          3,
          0);
      }
      return;
    case 25:
      v38 = pEvent[1]._vptr$CEvent;
      if ( v38 )
      {
        v39 = CTask::operator new(0x4Cu);
        CTaskComplex::CTaskComplex((CTaskComplex *)v39);
        *((_QWORD *)v39 + 3) = 0x400000003F800000LL;
        *((_QWORD *)v39 + 4) = 0x4000000000000000LL;
        *((_QWORD *)v39 + 2) = 0x3E800007530LL;
        *((_WORD *)v39 + 24) = 0;
        *((_WORD *)v39 + 30) = 0;
        *((_DWORD *)v39 + 10) = 0;
        *((_DWORD *)v39 + 11) = 0;
        *((_DWORD *)v39 + 13) = 0;
        *((_DWORD *)v39 + 14) = 0;
        *((_DWORD *)v39 + 17) = 6;
        v40 = *((_BYTE *)v39 + 72);
        *(_DWORD *)v39 = &off_6656D4;
        *((_DWORD *)v39 + 16) = &off_665710;
        *((_BYTE *)v39 + 72) = v40 & 0xF0 | 3;
        *((_DWORD *)v39 + 3) = v38;
        CEntity::RegisterReference((CEntity *)v38, (CEntity **)v39 + 3);
        this->m_pTaskEventResponse = (CTask *)v39;
      }
      return;
    case 26:
      v41 = pEvent[1]._vptr$CEvent;
      if ( !v41 )
        return;
      CPed::Say(this->m_pPed, 0x45u, 0, 1.0, 0, 0, 0);
      v42 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
      CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
        v42,
        (CEntity *)v41,
        1,
        100.0,
        -1,
        (const int)&elf_hash_bucket[187],
        1.0);
      goto LABEL_130;
    case 27:
    case 48:
      v11 = *(_QWORD *)&pEvent[1].m_iAccumulatedTime;
      v12 = (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent);
      v13 = HIDWORD(v11) == 0;
      if ( !HIDWORD(v11) )
        v13 = v12 == 27;
      if ( v13 )
        return;
      v14 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      if ( v14 == 200 )
        goto LABEL_116;
      if ( v14 != 233 )
        return;
      PedAttractorManager = GetPedAttractorManager();
      if ( CPedAttractorManager::HasEmptySlot(
             PedAttractorManager,
             (const C2dEffect *)v11,
             (const CEntity *)HIDWORD(v11)) )
      {
        v16 = (CTaskComplexUseEffect *)CTask::operator new(0x24u);
        CTaskComplexUseEffect::CTaskComplexUseEffect(v16, (C2dEffect *)v11, (CEntity *)HIDWORD(v11));
      }
      else
      {
LABEL_116:
        v17 = 0;
      }
      goto LABEL_130;
    case 28:
      if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
        return;
      v43 = pEvent[1]._vptr$CEvent;
      if ( !v43 )
        return;
      v44 = (CTaskComplexStealCar *)CTask::operator new(0x20u);
      CTaskComplexStealCar::CTaskComplexStealCar(v44, (CVehicle *)v43);
      goto LABEL_130;
    case 31:
      CEventHandler::ComputeGunAimedAtResponse(this, pEvent, ActiveTask, v10);
      return;
    case 32:
      CEventHandler::ComputeScriptCommandResponse(this, pEvent, v9, v10);
      return;
    case 33:
      if ( *(_BYTE *)&this->m_pPed->m_nPedFlags << 31 )
        return;
      v45 = (CTaskComplexInAirAndLand *)CTask::operator new(0x10u);
      CTaskComplexInAirAndLand::CTaskComplexInAirAndLand(v45, 0, 0);
      goto LABEL_130;
    case 35:
      CEventHandler::ComputeVehicleDiedResponse(this, pEvent, v9, v10);
      return;
    case 36:
    case 37:
      CEventHandler::ComputePedThreatResponse(this, pEvent, v9, v10);
      return;
    case 38:
    case 39:
      CEventHandler::ComputePedFriendResponse(this, pEvent, v9, v10);
      return;
    case 41:
    case 73:
      CEventHandler::ComputeVehicleDamageResponse(this, pEvent, v9, v10);
      return;
    case 42:
      CEventHandler::ComputeSpecialResponse(this, pEvent, v9, v10);
      return;
    case 43:
      CEventHandler::ComputeGotKnockedOverByCarResponse(this, pEvent, v9, v10);
      return;
    case 44:
      v46 = (CEntity *)pEvent[1].m_iAccumulatedTime;
      if ( !v46 || *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
        return;
      v47 = SimplestActiveTask == 0;
      if ( SimplestActiveTask )
      {
        pEvent = *(CEvent **)&pEvent[1].m_bIsPersistent;
        v47 = pEvent == (CEvent *)((char *)&dword_0 + 1);
      }
      if ( v47 || !CTask::IsGoToTask(SimplestActiveTask) )
        return;
      v48 = (CTaskComplexWalkRoundObject *)CTask::operator new(0x54u);
      CTaskComplexWalkRoundObject::CTaskComplexWalkRoundObject(
        v48,
        (const int)pEvent,
        (const CVector *)&SimplestActiveTask[1].m_pParent,
        v46);
      goto LABEL_130;
    case 45:
      v49 = this->m_pPed;
      v50 = *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 == 0;
      if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
      {
        v49 = (CPed *)v49->m_pMyVehicle;
        v50 = v49 == 0;
      }
      if ( !v50 && v49 == (CPed *)pEvent[1]._vptr$CEvent )
      {
        v51 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
        m_pMyVehicle = this->m_pPed->m_pMyVehicle;
        v53 = rand();
        CTaskComplexLeaveCar::CTaskComplexLeaveCar(
          v51,
          m_pMyVehicle,
          0,
          (int)(float)((float)((float)v53 * 0.000015259) * 300.0) + 100,
          1,
          0);
        this->m_pTaskEventResponse = v51;
      }
      return;
    case 46:
      CEventHandler::ComputePotentialWalkIntoFireResponse(this, pEvent, v9, SimplestActiveTask);
      return;
    case 49:
      CEventHandler::ComputeShotFiredWhizzedByResponse(this, pEvent, v9, SimplestActiveTask);
      return;
    case 50:
      CEventHandler::ComputeLowAngerAtPlayerResponse(this, pEvent, v9, v10);
      return;
    case 51:
      CEventHandler::ComputeHighAngerAtPlayerResponse(this, pEvent, v9, v10);
      return;
    case 52:
      v54 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      if ( v54 == 200 )
        goto LABEL_116;
      if ( v54 == 513 )
        goto LABEL_81;
      return;
    case 53:
      v57 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      if ( v57 == 200 )
        goto LABEL_116;
      if ( v57 != 513 )
        return;
LABEL_81:
      v55 = (CTaskComplexEvasiveDiveAndGetUp *)CTask::operator new(0x24u);
      memset(&vDiveDir, 0, sizeof(vDiveDir));
      CTaskComplexEvasiveDiveAndGetUp::CTaskComplexEvasiveDiveAndGetUp(v55, 0, 0, &vDiveDir, 1);
      v56 = &`vtable for'CTaskComplexDiveFromAttachedEntityAndGetUp;
LABEL_121:
      v17->_vptr$CTask = (int (**)(void))((char *)*v56 + 8);
      goto LABEL_130;
    case 56:
      CEventHandler::ComputeVehiclePotentialPassiveCollisionResponse(this, pEvent, v9, SimplestActiveTask);
      return;
    case 58:
      if ( !CPed::IsPlayer(this->m_pPed) )
      {
        v84 = (CTaskComplexOnFire *)CTask::operator new(0xCu);
        CTaskComplexOnFire::CTaskComplexOnFire(v84);
        goto LABEL_130;
      }
      if ( !CTaskManager::GetTaskSecondary(&this->m_pPed->m_pPedIntelligence->m_taskManager, 4) )
      {
        v58 = (CTaskSimplePlayerOnFire *)CTask::operator new(0x18u);
        CTaskSimplePlayerOnFire::CTaskSimplePlayerOnFire(v58);
        this->m_pTaskSecondaryPartialAnim = v59;
      }
      return;
    case 59:
      v76 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      if ( v76 == 200 )
        goto LABEL_116;
      if ( v76 != 604 )
        return;
      v77 = (CTaskComplexExtinguishFires *)CTask::operator new(0x10u);
      CTaskComplexExtinguishFires::CTaskComplexExtinguishFires(v77);
      goto LABEL_130;
    case 62:
      if ( (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent) )
      {
        v60 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
        if ( v60 == 200 )
        {
          this->m_pTaskEventResponse = 0;
        }
        else if ( v60 == 935 )
        {
          v61 = (CTaskComplexInvestigateDisturbance *)CTask::operator new(0x1Cu);
          v62 = (CEntity *)(*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent);
          CTaskComplexInvestigateDisturbance::CTaskComplexInvestigateDisturbance(
            v61,
            (const CVector *)&pEvent[2].m_iAccumulatedTime,
            v62);
          this->m_pTaskEventResponse = v61;
        }
      }
      return;
    case 63:
      v63 = (CEntity *)pEvent[1].m_iAccumulatedTime;
      if ( !v63 )
        return;
      v64 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      if ( v64 == 200 )
        goto LABEL_116;
      if ( v64 != 935 )
        return;
      v65 = (CTaskComplexInvestigateDisturbance *)CTask::operator new(0x1Cu);
      CTaskComplexInvestigateDisturbance::CTaskComplexInvestigateDisturbance(v65, (const CVector *)&pEvent[2], v63);
      goto LABEL_130;
    case 64:
      CEventHandler::ComputeWaterCannonResponse(this, pEvent, v9, v10);
      return;
    case 65:
      CEventHandler::ComputeSeenPanickedPedResponse(this, pEvent, v9, v10);
      return;
    case 66:
      v78 = (CTaskComplexInWater *)CTask::operator new(0xCu);
      CTaskComplexInWater::CTaskComplexInWater(v78);
      goto LABEL_130;
    case 67:
      v66 = pEvent[1]._vptr$CEvent;
      if ( !v66 )
        return;
      v67 = (CTaskSimpleWaitUntilAreaCodesMatch *)CTask::operator new(0x24u);
      CTaskSimpleWaitUntilAreaCodesMatch::CTaskSimpleWaitUntilAreaCodesMatch(v67, (CPed *)v66);
      goto LABEL_130;
    case 69:
      v68 = (CTaskComplexPolicePursuit *)CTask::operator new(0x18u);
      CTaskComplexPolicePursuit::CTaskComplexPolicePursuit(v68);
      goto LABEL_130;
    case 70:
      CEventHandler::ComputeCreatePartnerTaskResponse(this, pEvent, v9, v10);
      return;
    case 72:
      v69 = (CPed *)pEvent[1].m_iAccumulatedTime;
      if ( !v69 )
        return;
      v70 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      switch ( v70 )
      {
        case 200:
          goto LABEL_116;
        case 1000:
          v85 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
          CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v85, v69, -1, 0, 0, 0, 1);
          break;
        case 911:
          v71 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v71,
            v69,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          break;
        default:
          return;
      }
LABEL_130:
      this->m_pTaskEventResponse = v17;
      return;
    case 74:
      v79 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
      CTaskSimpleStandStill::CTaskSimpleStandStill(v79, 0, 1, 0, 8.0);
      v56 = &`vtable for'CTaskSimpleOnEscalator;
      goto LABEL_121;
    case 75:
      CEventHandler::ComputeDangerResponse(this, pEvent, v9, v10);
      return;
    case 79:
      CEventHandler::ComputeVehicleOnFireResponse(this, pEvent, v9, v10);
      return;
    case 81:
      v80 = (CTaskInteriorUseInfo *)CTask::operator new(0x1Cu);
      CTaskInteriorUseInfo::CTaskInteriorUseInfo(
        v80,
        (InteriorInfo_t *)pEvent[1]._vptr$CEvent,
        (Interior_c *)pEvent[1].m_iAccumulatedTime,
        *(_DWORD *)&pEvent[1].m_bIsPersistent,
        (bool8)pEvent[2]._vptr$CEvent);
      goto LABEL_130;
    case 88:
      v81 = (CTaskComplexSignalAtPed *)CTask::operator new(0x18u);
      CTaskComplexSignalAtPed::CTaskComplexSignalAtPed(
        v81,
        (CPed *)pEvent[1]._vptr$CEvent,
        pEvent[1].m_iAccumulatedTime,
        pEvent[1].m_bIsPersistent);
      goto LABEL_130;
    case 89:
      v82 = (CTaskComplexPassObject *)CTask::operator new(0x30u);
      CTaskComplexPassObject::CTaskComplexPassObject(v82, (CPed *)pEvent[1]._vptr$CEvent, pEvent[1].m_iAccumulatedTime);
      goto LABEL_130;
    case 93:
      v83 = (CTaskComplexStuckInAir *)CTask::operator new(0xCu);
      CTaskComplexStuckInAir::CTaskComplexStuckInAir(v83);
      goto LABEL_130;
    case 94:
      v72 = (CTaskComplexGangJoinRespond *)CTask::operator new(0x14u);
      CTaskComplexGangJoinRespond::CTaskComplexGangJoinRespond(v72, 0);
      goto LABEL_130;
    default:
      return;
  }
}
// 37BCD2: variable 'v9' is possibly undefined
// 37BCD2: variable 'v10' is possibly undefined
// 37BDD2: variable 'bSensibleLeaveCar' is possibly undefined
// 37BE74: variable 'v28' is possibly undefined
// 37BEBE: variable 'v8' is possibly undefined
// 37BF40: variable 'v37' is possibly undefined
// 37C26E: variable 'v59' is possibly undefined
// 37C472: variable 'v17' is possibly undefined
// 0: using guessed type int dword_0;
// FC: using guessed type int elf_hash_bucket[16411];
// 6656D4: using guessed type void *;
// 665710: using guessed type void *;
// 675F04: using guessed type void *`vtable for'CTaskComplexDiveFromAttachedEntityAndGetUp;
// 6777B8: using guessed type void *`vtable for'CTaskSimpleOnEscalator;

//----- (0037C55C) --------------------------------------------------------
CTask *__fastcall CEventHandler::ComputeEventResponseTask(const CPed *ped, const CEvent *rEvent)
{
  CTask *v2; // r4
  CTask *m_pTaskEventResponse; // r0
  CEventHandler v5; // [sp+0h] [bp-40h] BYREF

  v2 = 0;
  memset(&v5.m_pTaskPhysResponse, 0, 20);
  memset(&v5.m_history, 0, 26);
  v5.m_pPed = (CPed *)ped;
  CEventHandler::ComputeEventResponseTask(&v5, (CEvent *)rEvent, 0);
  m_pTaskEventResponse = v5.m_pTaskEventResponse;
  if ( v5.m_pTaskEventResponse )
  {
    v5.m_pTaskEventResponse = 0;
    v2 = m_pTaskEventResponse;
  }
  if ( v5.m_pTaskPhysResponse )
  {
    (*((void (__fastcall **)(CTask *))v5.m_pTaskPhysResponse->_vptr$CTask + 1))(v5.m_pTaskPhysResponse);
    v5.m_pTaskPhysResponse = 0;
    if ( v5.m_pTaskEventResponse )
      (*((void (__fastcall **)(CTask *))v5.m_pTaskEventResponse->_vptr$CTask + 1))(v5.m_pTaskEventResponse);
  }
  else
  {
    v5.m_pTaskPhysResponse = 0;
  }
  v5.m_pTaskEventResponse = 0;
  if ( v5.m_pTaskSecondaryAim )
    (*((void (__fastcall **)(CTaskSimple *))v5.m_pTaskSecondaryAim->_vptr$CTask + 1))(v5.m_pTaskSecondaryAim);
  v5.m_pTaskSecondaryAim = 0;
  if ( v5.m_pTaskSecondarySay )
    (*((void (__fastcall **)(CTaskSimple *))v5.m_pTaskSecondarySay->_vptr$CTask + 1))(v5.m_pTaskSecondarySay);
  v5.m_pTaskSecondarySay = 0;
  if ( v5.m_pTaskSecondaryPartialAnim )
    (*((void (__fastcall **)(CTaskSimple *))v5.m_pTaskSecondaryPartialAnim->_vptr$CTask + 1))(v5.m_pTaskSecondaryPartialAnim);
  v5.m_pTaskSecondaryPartialAnim = 0;
  if ( v5.m_history.m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))v5.m_history.m_pCurrentEventPassive->_vptr$CEvent + 1))(v5.m_history.m_pCurrentEventPassive);
  v5.m_history.m_pCurrentEventPassive = 0;
  if ( v5.m_history.m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))v5.m_history.m_pCurrentEventActive->_vptr$CEvent + 1))(v5.m_history.m_pCurrentEventActive);
  v5.m_history.m_pCurrentEventActive = 0;
  if ( v5.m_history.m_pStoredEventActive )
  {
    (*((void (__fastcall **)(CEvent *))v5.m_history.m_pStoredEventActive->_vptr$CEvent + 1))(v5.m_history.m_pStoredEventActive);
    v5.m_history.m_pStoredEventActive = 0;
  }
  if ( v5.m_history.m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))v5.m_history.m_pCurrentEventPassive->_vptr$CEvent + 1))(v5.m_history.m_pCurrentEventPassive);
  v5.m_history.m_pCurrentEventPassive = 0;
  if ( v5.m_history.m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))v5.m_history.m_pCurrentEventActive->_vptr$CEvent + 1))(v5.m_history.m_pCurrentEventActive);
  v5.m_history.m_pCurrentEventActive = 0;
  if ( v5.m_history.m_pStoredEventActive )
  {
    (*((void (__fastcall **)(CEvent *))v5.m_history.m_pStoredEventActive->_vptr$CEvent + 1))(v5.m_history.m_pStoredEventActive);
    v5.m_history.m_pStoredEventActive = 0;
  }
  return v2;
}

//----- (0037C646) --------------------------------------------------------
void __fastcall CEventHandler::Flush(CEventHandler *this)
{
  CTask *m_pTaskPhysResponse; // r0
  CTask *m_pTaskEventResponse; // r0
  CTaskSimple *m_pTaskSecondaryAim; // r0
  CTaskSimple *m_pTaskSecondarySay; // r0
  CTaskSimple *m_pTaskSecondaryPartialAnim; // r0
  CEvent *m_pCurrentEventPassive; // r0
  CEvent *m_pCurrentEventActive; // r0
  CEvent *m_pStoredEventActive; // r0

  m_pTaskPhysResponse = this->m_pTaskPhysResponse;
  if ( m_pTaskPhysResponse )
    (*((void (__fastcall **)(CTask *))m_pTaskPhysResponse->_vptr$CTask + 1))(m_pTaskPhysResponse);
  m_pTaskEventResponse = this->m_pTaskEventResponse;
  this->m_pTaskPhysResponse = 0;
  if ( m_pTaskEventResponse )
    (*((void (__fastcall **)(CTask *))m_pTaskEventResponse->_vptr$CTask + 1))(m_pTaskEventResponse);
  m_pTaskSecondaryAim = this->m_pTaskSecondaryAim;
  this->m_pTaskEventResponse = 0;
  if ( m_pTaskSecondaryAim )
    (*((void (__fastcall **)(CTaskSimple *))m_pTaskSecondaryAim->_vptr$CTask + 1))(m_pTaskSecondaryAim);
  m_pTaskSecondarySay = this->m_pTaskSecondarySay;
  this->m_pTaskSecondaryAim = 0;
  if ( m_pTaskSecondarySay )
    (*((void (__fastcall **)(CTaskSimple *))m_pTaskSecondarySay->_vptr$CTask + 1))(m_pTaskSecondarySay);
  m_pTaskSecondaryPartialAnim = this->m_pTaskSecondaryPartialAnim;
  this->m_pTaskSecondarySay = 0;
  if ( m_pTaskSecondaryPartialAnim )
    (*((void (__fastcall **)(CTaskSimple *))m_pTaskSecondaryPartialAnim->_vptr$CTask + 1))(m_pTaskSecondaryPartialAnim);
  m_pCurrentEventPassive = this->m_history.m_pCurrentEventPassive;
  this->m_pTaskSecondaryPartialAnim = 0;
  if ( m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
  m_pCurrentEventActive = this->m_history.m_pCurrentEventActive;
  this->m_history.m_pCurrentEventPassive = 0;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  m_pStoredEventActive = this->m_history.m_pStoredEventActive;
  this->m_history.m_pCurrentEventActive = 0;
  if ( m_pStoredEventActive )
  {
    (*((void (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 1))(m_pStoredEventActive);
    this->m_history.m_pStoredEventActive = 0;
  }
}

//----- (0037C6C8) --------------------------------------------------------
void __fastcall CEventHandler::FlushImmediately(CEventHandler *this)
{
  CEvent *m_pCurrentEventPassive; // r0
  CEvent *m_pCurrentEventActive; // r0
  CEvent *m_pStoredEventActive; // r0

  m_pCurrentEventPassive = this->m_history.m_pCurrentEventPassive;
  if ( m_pCurrentEventPassive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 1))(m_pCurrentEventPassive);
  m_pCurrentEventActive = this->m_history.m_pCurrentEventActive;
  this->m_history.m_pCurrentEventPassive = 0;
  if ( m_pCurrentEventActive )
    (*((void (__fastcall **)(CEvent *))m_pCurrentEventActive->_vptr$CEvent + 1))(m_pCurrentEventActive);
  m_pStoredEventActive = this->m_history.m_pStoredEventActive;
  this->m_history.m_pCurrentEventActive = 0;
  if ( m_pStoredEventActive )
  {
    (*((void (__fastcall **)(CEvent *))m_pStoredEventActive->_vptr$CEvent + 1))(m_pStoredEventActive);
    this->m_history.m_pStoredEventActive = 0;
  }
}

//----- (0037C700) --------------------------------------------------------
void __fastcall CEventHandler::ComputeVehicleCollisionResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d1
  float32x2_t v6; // d8
  CVehicle *v9; // r10
  CTaskComplexEvasiveStep *v11; // r4
  float v12; // s18
  _BOOL4 IsPlayer; // r1
  CPed *m_pPed; // r0
  CMatrix *m_pMat; // r1
  float y; // s0
  float v17; // s2
  CTaskComplexHitPedWithCar *v18; // r0
  CVehicle *v19; // r1
  int m_iAccumulatedTime; // r2
  _BOOL4 v21; // r0
  CPed *v22; // r0
  int v23; // r9
  CPedGroup *PedsGroup; // r5
  bool bGoingForDoor; // r11
  CTaskComplexWalkRoundCar *v26; // r0
  CTask *v27; // r0
  CPed *v28; // r4
  eWeaponType m_eWeaponType; // r1
  CTaskSimpleShakeFist *v30; // r0
  CTaskSimple *v31; // r0
  CPed *v32; // r1
  CTask *v33; // r0
  CTaskComplexHitPedWithCar *v34; // r0
  CTaskComplexJump *v35; // r0
  CTask *m_pTaskEventResponse; // r0
  const CPed *pDriver; // r0
  CPedIntelligence *m_pPedIntelligence; // r0
  unsigned int v39; // r1
  unsigned int m_iStartTime; // r2
  uint8 m_iAngerAtPlayer; // r1
  CVector v42; // [sp+24h] [bp-3Ch] BYREF

  v9 = *(CVehicle **)&pEvent[1].m_bIsPersistent;
  if ( !v9 )
    return;
  *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) &= ~0x8000000u;
  if ( LOWORD(pEvent[1]._vptr$CEvent) == 1 )
  {
    v11 = (CTaskComplexEvasiveStep *)CTask::operator new(0x1Cu);
    CTaskComplexHitPedWithCar::ComputeEvasiveStepMoveDir(&v42, this->m_pPed, v9);
    CTaskComplexEvasiveStep::CTaskComplexEvasiveStep(v11, v9, &v42);
    this->m_pTaskEventResponse = v11;
    goto LABEL_43;
  }
  v6.n64_u32[0] = pEvent[1].m_iAccumulatedTime;
  v12 = sqrtf(
          (float)((float)(v9->m_vecMoveSpeed.x * v9->m_vecMoveSpeed.x)
                + (float)(v9->m_vecMoveSpeed.y * v9->m_vecMoveSpeed.y))
        + (float)(v9->m_vecMoveSpeed.z * v9->m_vecMoveSpeed.z));
  IsPlayer = CPed::IsPlayer(this->m_pPed);
  m_pPed = this->m_pPed;
  if ( v12 > 0.05 )
  {
    if ( IsPlayer )
    {
      if ( *(_BYTE *)&m_pPed->m_nPedFlags << 31 )
      {
        m_pMat = m_pPed->m_pMat;
        y = m_pPed->m_extractedVelocity.y;
        v17 = y * m_pMat->xy;
        v4.n64_u64[0] = vmul_f32(
                          vmul_n_f32(*(float32x2_t *)&m_pMat->yy, y),
                          *(float32x2_t *)&pEvent[2].m_iAccumulatedTime).n64_u64[0];
        v4.n64_f32[0] = (float)((float)(v17 * *(float *)&pEvent[2]._vptr$CEvent) + v4.n64_f32[0]) + v4.n64_f32[1];
        if ( v4.n64_f32[0] < 0.0 )
        {
          v5.n64_u32[0] = 0;
          v4.n64_f32[0] = v6.n64_f32[0] + (float)(v4.n64_f32[0] * m_pPed->m_fMass);
          v6.n64_u64[0] = vmax_f32(v4, v5).n64_u64[0];
        }
      }
    }
    if ( CPed::IsPlayer(m_pPed) )
    {
      v4.n64_u32[0] = 1101004800;
      v18 = (CTaskComplexHitPedWithCar *)CTask::operator new(0x28u);
      v19 = v9;
      m_iAccumulatedTime = vmin_f32(v6, v4).n64_u32[0];
    }
    else
    {
      v18 = (CTaskComplexHitPedWithCar *)CTask::operator new(0x28u);
      m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
      v19 = v9;
    }
    CTaskComplexHitPedWithCar::CTaskComplexHitPedWithCar(v18, v19, *(const float *)&m_iAccumulatedTime);
    v32 = this->m_pPed;
    this->m_pTaskEventResponse = v33;
    if ( v32->m_pNOCollisionVehicle != v9 )
      *((_DWORD *)&v32->m_nPedFlags + 1) |= 0x8000000u;
    goto LABEL_43;
  }
  if ( IsPlayer && m_pPed->m_pPedIntelligence->m_taskManager.m_tasks[3] )
  {
    if ( !pTaskActiveSimplest )
      goto LABEL_23;
  }
  else
  {
    v21 = CPed::IsPlayer(m_pPed);
    if ( !pTaskActiveSimplest || v21 )
    {
LABEL_23:
      if ( CPed::IsPlayer(this->m_pPed) )
      {
        v28 = this->m_pPed;
        if ( (*((_BYTE *)&this->m_pPed->m_nPedFlags + 1) & 2) == 0 )
        {
          if ( v28->m_pPlayerData->m_moveBlendRatio == 0.0 && v9->pDriver )
          {
            CPlayerPed::AnnoyPlayerPed((CPlayerPed *)this->m_pPed, 0);
            IKChainManager_c::LookAt(
              &g_ikChainMan,
              "CompVehicleCollResp",
              this->m_pPed,
              v9,
              1300,
              -1,
              0,
              1,
              0.25,
              500,
              3,
              0);
            m_eWeaponType = v28->m_WeaponSlots[v28->m_nCurrentWeapon].m_eWeaponType;
            if ( m_eWeaponType == WEAPONTYPE_UNARMED
              || CPed::GetWeaponSlot(v28, m_eWeaponType) == 2
              || CPed::GetWeaponSlot(v28, v28->m_WeaponSlots[v28->m_nCurrentWeapon].m_eWeaponType) == 4
              || CPed::GetWeaponSlot(v28, v28->m_WeaponSlots[v28->m_nCurrentWeapon].m_eWeaponType) == 1 )
            {
              v30 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
              CTaskSimpleShakeFist::CTaskSimpleShakeFist(v30);
              this->m_pTaskSecondaryPartialAnim = v31;
            }
          }
          else
          {
            IKChainManager_c::LookAt(&g_ikChainMan, "CompVehicleCollResp", v28, v9, 800, -1, 0, 1, 0.25, 500, 3, 0);
          }
          goto LABEL_43;
        }
      }
      if ( v12 > 0.001 )
      {
        v34 = (CTaskComplexHitPedWithCar *)CTask::operator new(0x28u);
        CTaskComplexHitPedWithCar::CTaskComplexHitPedWithCar(v34, v9, *(const float *)&pEvent[1].m_iAccumulatedTime);
LABEL_38:
        this->m_pTaskEventResponse = v27;
        goto LABEL_43;
      }
      goto LABEL_43;
    }
  }
  if ( !CTask::IsGoToTask(pTaskActiveSimplest) )
    goto LABEL_23;
  v22 = this->m_pPed;
  if ( v9 != this->m_pPed->m_pGroundPhysical )
  {
    v23 = SLOBYTE(pEvent[4]._vptr$CEvent);
    if ( v23 == 1 )
      return;
    PedsGroup = CPedGroups::GetPedsGroup(v22);
    bGoingForDoor = CPedIntelligence::IsPedGoingForCarDoor(this->m_pPed->m_pPedIntelligence);
    v26 = (CTaskComplexWalkRoundCar *)CTask::operator new(0x58u);
    if ( PedsGroup )
      v23 = 6;
    CTaskComplexWalkRoundCar::CTaskComplexWalkRoundCar(
      v26,
      v23,
      (const CVector *)&pTaskActiveSimplest[1].m_pParent,
      v9,
      bGoingForDoor,
      SBYTE1(pEvent[4]._vptr$CEvent));
    goto LABEL_38;
  }
  if ( fabsf(v22->m_fCurrentHeading - v22->m_fDesiredHeading) < 0.01
    && CPedGeometryAnalyser::CanPedJumpObstacle(v22, v9) )
  {
    v35 = (CTaskComplexJump *)CTask::operator new(0x14u);
    CTaskComplexJump::CTaskComplexJump(v35, 0);
    goto LABEL_38;
  }
LABEL_43:
  m_pTaskEventResponse = this->m_pTaskEventResponse;
  if ( m_pTaskEventResponse )
  {
    if ( (*((int (__fastcall **)(CTask *))m_pTaskEventResponse->_vptr$CTask + 5))(m_pTaskEventResponse) == 505 )
    {
      pDriver = v9->pDriver;
      if ( pDriver )
      {
        if ( CPed::IsPlayer(pDriver) )
        {
          m_pPedIntelligence = this->m_pPed->m_pPedIntelligence;
          if ( m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsActive )
          {
            if ( m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsStopped )
            {
              v39 = CTimer::m_snTimeInMilliseconds;
              m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsStopped = 0;
              m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime = v39;
              m_iStartTime = v39;
            }
            else
            {
              m_iStartTime = m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime;
              v39 = CTimer::m_snTimeInMilliseconds;
            }
            if ( m_iStartTime + m_pPedIntelligence->m_mentalState.m_angerTimer.m_iDuration <= v39 )
            {
              m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime = v39;
              m_pPedIntelligence->m_mentalState.m_angerTimer.m_iDuration = 3000;
              m_iAngerAtPlayer = m_pPedIntelligence->m_mentalState.m_iAngerAtPlayer;
              m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsActive = 1;
              m_pPedIntelligence->m_mentalState.m_iAngerAtPlayer = m_iAngerAtPlayer + 2;
            }
          }
        }
      }
    }
  }
}
// 37C800: variable 'v5' is possibly undefined
// 37C81A: variable 'v6' is possibly undefined
// 37C81A: variable 'v4' is possibly undefined
// 37C96E: variable 'v31' is possibly undefined
// 37C986: variable 'v33' is possibly undefined
// 37C9BC: variable 'v27' is possibly undefined

//----- (0037CAFC) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedCollisionWithPedResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int m_iAccumulatedTime; // r10
  CPed *m_pPed; // r0
  float *v9; // r1
  CMatrix *m_pMat; // r2
  float *v11; // r3
  float *p_tx; // r5
  float v13; // s22
  float v14; // s26
  float v15; // s24
  float v16; // s28
  float v17; // s17
  float v18; // s30
  float v19; // s16
  float v20; // s20
  float v21; // s18
  float xy; // s19
  float yy; // s23
  float zy; // s21
  unsigned int v25; // r11
  unsigned int v26; // r8
  CPedGroup *PedsGroup; // r0
  CPedGroup *v28; // r5
  CPed *Leader; // r4
  CPedGroup *v30; // r0
  CPedGroup *v31; // r6
  CPed *v32; // r9
  int v33; // r5
  float v34; // s2
  CTaskComplexEvasiveStep *v35; // r6
  CEventHandler *v36; // r11
  CTaskComplexFollowPointRoute *v37; // r0
  CTaskComplexEvasiveStep *v38; // r0
  CTaskSimple *v39; // r0
  int v40; // r0
  int v41; // r0
  bool v42; // zf
  float v43; // s0
  CTaskSimple *v44; // r0
  int v45; // r0
  int v46; // r3
  int v47; // r1
  bool v48; // zf
  float m_fDefendMult; // s0
  float v50; // s4
  CTaskSimple *v51; // r0
  int v52; // r0
  CPed *v53; // r2
  int v54; // r4
  CTaskSimple *v55; // r0
  int v56; // r0
  float v57; // s0
  CTaskSimple *v58; // r0
  CTaskSimple *v59; // r0
  bool v60; // cc
  float v61; // s0
  float v62; // s4
  CTaskSimple *v63; // r0
  int v64; // r0
  CPed *v65; // r2
  CTaskSimple *v66; // r0
  int v67; // r0
  bool v68; // cc
  CTaskSimple *v69; // r0
  int v70; // r0
  CPed *v71; // r2
  CTaskSimple *v72; // r0
  int v73; // r0
  CTask *TaskByType; // r4
  CTask *ActiveTaskByType; // r6
  CTask *v76; // r9
  CTask *v77; // r0
  int v78; // r1
  int (**v79)(void); // r1
  bool v80; // zf
  int (*v81)(void); // r3
  CMatrix *v82; // r5
  float *v83; // r2
  float *p_x; // r1
  float v85; // s2
  float v86; // s0
  float v87; // s4
  float v88; // s6
  float v89; // s2
  float v90; // s0
  float v91; // s4
  float v92; // s6
  CMatrix *v93; // r0
  int xy_low; // r1
  CPedIntelligence *m_pPedIntelligence; // r0
  unsigned int v96; // r1
  unsigned int m_iStartTime; // r2
  uint8 m_iAngerAtPlayer; // r1
  CTaskSimple *v99; // r0
  CPed *v100; // r2
  int v101; // r4
  int v102; // r4
  CEventHandler *v103; // [sp+24h] [bp-CCh]
  CPointRoute route; // [sp+28h] [bp-C8h] BYREF

  m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
  if ( !m_iAccumulatedTime )
    return;
  CTaskManager::GetSimplestActiveTask((const CTaskManager *)(*(_DWORD *)(m_iAccumulatedTime + 1088) + 4));
  v103 = this;
  m_pPed = this->m_pPed;
  v9 = *(float **)(m_iAccumulatedTime + 20);
  m_pMat = this->m_pPed->m_pMat;
  v11 = v9 + 12;
  if ( !v9 )
    v11 = (float *)(m_iAccumulatedTime + 4);
  p_tx = &m_pMat->tx;
  v13 = *v11;
  v14 = v11[1];
  v15 = v11[2];
  if ( !m_pMat )
    p_tx = &m_pPed->m_transform.m_translate.x;
  v16 = *p_tx;
  v17 = p_tx[1];
  v18 = p_tx[2];
  v19 = v9[4];
  v20 = v9[5];
  v21 = v9[6];
  xy = m_pMat->xy;
  yy = m_pMat->yy;
  zy = m_pMat->zy;
  v25 = *((unsigned __int16 *)&pEvent[3].m_bIsPersistent + 1);
  v26 = *(unsigned __int16 *)&pEvent[3].m_bIsPersistent;
  PedsGroup = CPedGroups::GetPedsGroup(m_pPed);
  v28 = PedsGroup;
  if ( PedsGroup )
  {
    Leader = CPedGroupMembership::GetLeader(&PedsGroup->m_membership);
    v30 = CPedGroups::GetPedsGroup((const CPed *)m_iAccumulatedTime);
    v31 = v30;
    if ( v30 )
    {
      v32 = CPedGroupMembership::GetLeader(&v30->m_membership);
      if ( v28 != v31 )
      {
LABEL_9:
        v33 = 0;
LABEL_21:
        if ( CPed::IsPlayer((const CPed *)m_iAccumulatedTime) )
        {
          v39 = (CTaskSimple *)CTask::operator new(0x1Cu);
          CTaskSimple::CTaskSimple(v39);
          *(_WORD *)(v40 + 24) = 0;
          *(_DWORD *)(v40 + 16) = 0;
          *(_DWORD *)(v40 + 20) = 0;
          *(_DWORD *)(v40 + 8) = 28;
          *(_DWORD *)(v40 + 12) = -1;
          *(_DWORD *)v40 = &off_665784;
          v36 = v103;
          v103->m_pTaskSecondarySay = (CTaskSimple *)v40;
LABEL_121:
          v36->m_pTaskEventResponse = 0;
          return;
        }
        if ( v25 != 1 )
          v25 = 0;
        if ( v26 != 1 )
          v26 = 0;
        v41 = v26 | v25;
        if ( v31 )
        {
          v36 = v103;
          if ( v41 != 1 )
            goto LABEL_121;
          if ( v33 )
          {
            if ( (CPed *)m_iAccumulatedTime != v32
              && (!Leader || CPedIntelligence::GetMoveStateFromGoToTask(Leader->m_pPedIntelligence) != 1) )
            {
              goto LABEL_121;
            }
          }
          else if ( (float)((float)((float)rand() * 4.6566e-10) + 0.0) < 0.25 )
          {
            v57 = (float)((float)rand() * 4.6566e-10) + 0.0;
            if ( v57 >= 0.33 )
            {
              if ( v57 < 0.66 )
              {
                v72 = (CTaskSimple *)CTask::operator new(0x1Cu);
                CTaskSimple::CTaskSimple(v72);
                *(_WORD *)(v73 + 24) = 0;
                *(_DWORD *)(v73 + 16) = 0;
                *(_DWORD *)(v73 + 20) = 0;
                *(_DWORD *)(v73 + 8) = 28;
                *(_DWORD *)(v73 + 12) = -1;
                *(_DWORD *)v73 = &off_665784;
                v103->m_pTaskSecondarySay = (CTaskSimple *)v73;
              }
            }
            else
            {
              IKChainManager_c::LookAt(
                &g_ikChainMan,
                "CompPedCollPedResp",
                v103->m_pPed,
                (CEntity *)m_iAccumulatedTime,
                2000,
                5,
                0,
                1,
                0.25,
                500,
                3,
                0);
            }
          }
          TaskByType = CPedIntelligence::FindTaskByType(v103->m_pPed->m_pPedIntelligence, 1207);
          ActiveTaskByType = CTaskManager::FindActiveTaskByType(&v103->m_pPed->m_pPedIntelligence->m_taskManager, 917);
          v76 = CPedIntelligence::FindTaskByType(v103->m_pPed->m_pPedIntelligence, 900);
          v77 = CPedIntelligence::FindTaskByType(v103->m_pPed->m_pPedIntelligence, 907);
          v78 = (int)TaskByType;
          if ( TaskByType )
            v78 = 1;
          if ( (v78 & v33) == 1 )
          {
            if ( v77 )
            {
              v79 = TaskByType[2]._vptr$CTask;
              v80 = v79 == 0;
              if ( v79 )
                v80 = ((unsigned int)ActiveTaskByType | (unsigned int)v76) == 0;
              if ( !v80 )
              {
                v81 = v79[5];
                v82 = v103->m_pPed->m_pMat;
                v83 = (float *)((char *)v81 + 48);
                if ( !v81 )
                  v83 = (float *)(v79 + 1);
                p_x = &v82->tx;
                v85 = *v83;
                v86 = v83[1];
                if ( !v82 )
                  p_x = &v103->m_pPed->m_transform.m_translate.x;
                v87 = *p_x;
                v88 = p_x[1];
                if ( ActiveTaskByType )
                  LOBYTE(ActiveTaskByType[11].m_pParent) |= 2u;
                v89 = v87 - v85;
                v90 = v88 - v86;
                v91 = sqrtf((float)((float)(v89 * v89) + (float)(v90 * v90)) + 0.0);
                v92 = v91 + 0.1;
                if ( v76 )
                  *(float *)&v76[3]._vptr$CTask = v92;
                if ( *(float *)&v77[3]._vptr$CTask != v92 )
                {
                  *(float *)&v77[3]._vptr$CTask = v92;
                  v77[5]._vptr$CTask = (int (**)(void))CTimer::m_snTimeInMilliseconds;
                  v77[5].m_pParent = 0;
                  LOBYTE(v77[6]._vptr$CTask) = 1;
                }
                if ( v91 < 8.0 )
                {
                  *(float *)&TaskByType[4]._vptr$CTask = v89;
                  *(float *)&TaskByType[4].m_pParent = v90;
                  TaskByType[5]._vptr$CTask = 0;
                }
              }
            }
            goto LABEL_121;
          }
        }
        else
        {
          v36 = v103;
          if ( v41 != 1 )
            goto LABEL_121;
        }
        v93 = v36->m_pPed->m_pMat;
        xy_low = LODWORD(v93->xy);
        route.m_routePoints[0].x = v93->yy;
        route.m_iRouteSize = xy_low;
        route.m_routePoints[0].y = 0.0;
        route.m_routePoints[0].x = -route.m_routePoints[0].x;
        CVector::Normalise((CVector *)&route);
        v35 = (CTaskComplexEvasiveStep *)CTask::operator new(0x1Cu);
        CTaskComplexEvasiveStep::CTaskComplexEvasiveStep(v35, (CEntity *)m_iAccumulatedTime, (const CVector *)&route);
        goto LABEL_110;
      }
    }
    else
    {
      v32 = 0;
      if ( v28 )
        goto LABEL_9;
    }
    if ( (CPed *)m_iAccumulatedTime == Leader )
      *(_DWORD *)(m_iAccumulatedTime + 1164) |= 0x80000000;
    v33 = 1;
    if ( v103->m_pPed == Leader )
      *((_DWORD *)&Leader->m_nPedFlags + 2) |= 0x80000000;
    goto LABEL_21;
  }
  v34 = (float)((float)((float)(v13 - v16) * xy) + (float)((float)(v14 - v17) * yy)) + (float)((float)(v15 - v18) * zy);
  if ( v26 == 4 && v25 <= 1 )
  {
    if ( v34 < 0.0 )
    {
      v36 = v103;
      v35 = 0;
      IKChainManager_c::LookAt(
        &g_ikChainMan,
        "CompPedCollPedResp",
        v103->m_pPed,
        (CEntity *)m_iAccumulatedTime,
        2000,
        5,
        0,
        1,
        0.25,
        500,
        3,
        0);
      v44 = (CTaskSimple *)CTask::operator new(0x1Cu);
      CTaskSimple::CTaskSimple(v44);
      *(_DWORD *)(v45 + 8) = 28;
      *(_DWORD *)v45 = &off_665784;
      *(_DWORD *)(v45 + 12) = -1;
      *(_WORD *)(v45 + 24) = 0;
      *(_DWORD *)(v45 + 16) = 0;
      *(_DWORD *)(v45 + 20) = 0;
LABEL_66:
      v36->m_pTaskSecondarySay = (CTaskSimple *)v45;
      goto LABEL_110;
    }
    if ( pTaskActiveSimplest )
    {
      v35 = 0;
      if ( CTask::IsGoToTask(pTaskActiveSimplest) )
      {
        v36 = v103;
        route.m_iRouteSize = 0;
        CPedGeometryAnalyser::ComputeRouteRoundEntityBoundingBox(
          v103->m_pPed,
          (CEntity *)m_iAccumulatedTime,
          (const CVector *)&pTaskActiveSimplest[1].m_pParent,
          &route,
          0);
        v37 = (CTaskComplexFollowPointRoute *)CTask::operator new(0x3Cu);
        CTaskComplexFollowPointRoute::CTaskComplexFollowPointRoute(v37, 4, &route, 0, 0.5, 5.0, 0, 1, 1);
        v35 = v38;
LABEL_62:
        v58 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v58);
        *(_DWORD *)(v45 + 8) = 28;
        *(_DWORD *)(v45 + 12) = -1;
        *(_WORD *)(v45 + 24) = 0;
        *(_DWORD *)(v45 + 16) = 0;
        *(_DWORD *)(v45 + 20) = 0;
LABEL_65:
        *(_DWORD *)v45 = &off_665784;
        goto LABEL_66;
      }
    }
    else
    {
      v35 = 0;
    }
    v36 = v103;
    goto LABEL_62;
  }
  v42 = v26 == 4;
  if ( v26 == 4 )
    v42 = v25 == 4;
  v43 = (float)((float)((float)(v13 - v16) * v19) + (float)((float)(v14 - v17) * v20))
      + (float)((float)(v15 - v18) * v21);
  if ( v42 )
  {
    v36 = v103;
    if ( v34 < 0.0 )
    {
      if ( v43 <= 0.0 )
      {
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "CompPedCollPedResp",
          v103->m_pPed,
          (CEntity *)m_iAccumulatedTime,
          2000,
          5,
          0,
          1,
          0.25,
          500,
          3,
          0);
        v55 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v55);
        *(_WORD *)(v56 + 24) = 0;
        *(_DWORD *)(v56 + 8) = 28;
        *(_DWORD *)(v56 + 12) = -1;
        *(_DWORD *)(v56 + 16) = 0;
        *(_DWORD *)(v56 + 20) = 0;
        *(_DWORD *)v56 = &off_665784;
        v103->m_pTaskSecondarySay = (CTaskSimple *)v56;
      }
      goto LABEL_121;
    }
    if ( CTask::IsGoToTask(pTaskActiveSimplest) )
    {
      route.m_iRouteSize = 0;
      CPedGeometryAnalyser::ComputeRouteRoundEntityBoundingBox(
        v103->m_pPed,
        (CEntity *)m_iAccumulatedTime,
        (const CVector *)&pTaskActiveSimplest[1].m_pParent,
        &route,
        0);
      v35 = (CTaskComplexEvasiveStep *)CTask::operator new(0x3Cu);
      CTaskComplexFollowPointRoute::CTaskComplexFollowPointRoute(
        (CTaskComplexFollowPointRoute *)v35,
        4,
        &route,
        0,
        0.5,
        5.0,
        0,
        1,
        1);
    }
    else
    {
      v35 = 0;
    }
    IKChainManager_c::LookAt(
      &g_ikChainMan,
      "CompPedCollPedResp",
      v103->m_pPed,
      (CEntity *)m_iAccumulatedTime,
      2000,
      5,
      0,
      1,
      0.25,
      500,
      3,
      0);
    v59 = (CTaskSimple *)CTask::operator new(0x1Cu);
    CTaskSimple::CTaskSimple(v59);
    *(_WORD *)(v45 + 24) = 0;
    *(_DWORD *)(v45 + 8) = 28;
    *(_DWORD *)(v45 + 12) = -1;
    *(_DWORD *)(v45 + 16) = 0;
    *(_DWORD *)(v45 + 20) = 0;
    goto LABEL_65;
  }
  v46 = (__int16)v26 | 1;
  v47 = (__int16)v25 | 1;
  v48 = v46 == 7;
  if ( v46 == 7 )
    v48 = v47 == 7;
  if ( v48 )
  {
    if ( v34 < 0.0 || v43 > 0.0 )
    {
      if ( v34 < 0.0 )
      {
        v36 = v103;
        if ( v43 > 0.0 )
          goto LABEL_121;
        v99 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v99);
        *(_WORD *)(v67 + 24) = 0;
        *(_DWORD *)(v67 + 16) = 0;
        *(_DWORD *)(v67 + 20) = 0;
        *(_DWORD *)(v67 + 8) = 28;
        *(_DWORD *)(v67 + 12) = -1;
        *(_DWORD *)v67 = &off_665784;
      }
      else
      {
        v66 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v66);
        *(_WORD *)(v67 + 24) = 0;
        *(_DWORD *)(v67 + 16) = 0;
        *(_DWORD *)(v67 + 20) = 0;
        *(_DWORD *)(v67 + 8) = 28;
        *(_DWORD *)(v67 + 12) = -1;
        *(_DWORD *)v67 = &off_665784;
        v36 = v103;
      }
      v100 = v36->m_pPed;
      v36->m_pTaskSecondarySay = (CTaskSimple *)v67;
      IKChainManager_c::LookAt(
        &g_ikChainMan,
        "CompPedCollPedResp",
        v100,
        (CEntity *)m_iAccumulatedTime,
        2000,
        5,
        0,
        1,
        0.25,
        500,
        3,
        0);
      goto LABEL_121;
    }
    v36 = v103;
    m_fDefendMult = v103->m_pPed->m_pPedStats->m_fDefendMult;
    if ( m_fDefendMult > 1.5 )
    {
      v50 = *(float *)(*(_DWORD *)(m_iAccumulatedTime + 1440) + 44);
      if ( v50 <= 1.5 || m_fDefendMult > v50 )
      {
        v101 = CPedGeometryAnalyser::ComputeEntityHitSide((const CPed *)m_iAccumulatedTime, v103->m_pPed);
        v35 = (CTaskComplexEvasiveStep *)CTask::operator new(0x18u);
        CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp((CTaskComplexFallAndGetUp *)v35, v101, 0);
        goto LABEL_110;
      }
    }
    v51 = (CTaskSimple *)CTask::operator new(0x1Cu);
    CTaskSimple::CTaskSimple(v51);
    *(_WORD *)(v52 + 24) = 0;
    *(_DWORD *)(v52 + 16) = 0;
    *(_DWORD *)(v52 + 20) = 0;
    *(_DWORD *)(v52 + 8) = 28;
    *(_DWORD *)(v52 + 12) = -1;
    *(_DWORD *)v52 = &off_665784;
    v53 = v103->m_pPed;
    v103->m_pTaskSecondarySay = (CTaskSimple *)v52;
    IKChainManager_c::LookAt(
      &g_ikChainMan,
      "CompPedCollPedResp",
      v53,
      (CEntity *)m_iAccumulatedTime,
      2000,
      5,
      0,
      1,
      0.25,
      500,
      3,
      0);
LABEL_54:
    v54 = CPedGeometryAnalyser::ComputeEntityHitSide((const CPed *)m_iAccumulatedTime, v36->m_pPed);
    v35 = (CTaskComplexEvasiveStep *)CTask::operator new(0x10u);
    CTaskComplexHitResponse::CTaskComplexHitResponse((CTaskComplexHitResponse *)v35, v54);
    goto LABEL_110;
  }
  v60 = v26 > 1;
  if ( v26 <= 1 )
    v60 = (unsigned int)(__int16)v25 > 7;
  if ( v60 || ((1 << v25) & 0xD0) == 0 || v43 > 0.0 )
  {
    v68 = v25 > 1;
    v36 = v103;
    if ( !v68 )
      v68 = (unsigned int)(__int16)v26 > 7;
    if ( v68 )
      goto LABEL_121;
    if ( ((1 << v26) & 0xD0) == 0 )
      goto LABEL_121;
    if ( v43 > 0.0 )
      goto LABEL_121;
    v69 = (CTaskSimple *)CTask::operator new(0x1Cu);
    CTaskSimple::CTaskSimple(v69);
    *(_WORD *)(v70 + 24) = 0;
    *(_DWORD *)(v70 + 16) = 0;
    *(_DWORD *)(v70 + 20) = 0;
    *(_DWORD *)(v70 + 8) = 28;
    *(_DWORD *)(v70 + 12) = -1;
    *(_DWORD *)v70 = &off_665784;
    v71 = v103->m_pPed;
    v103->m_pTaskSecondarySay = (CTaskSimple *)v70;
    IKChainManager_c::LookAt(
      &g_ikChainMan,
      "CompPedCollPedResp",
      v71,
      (CEntity *)m_iAccumulatedTime,
      2000,
      5,
      0,
      1,
      0.25,
      500,
      3,
      0);
    if ( v26 == 4 )
      goto LABEL_121;
    goto LABEL_54;
  }
  if ( v47 != 7
    || (v61 = v103->m_pPed->m_pPedStats->m_fDefendMult, v61 <= 1.5)
    || (v62 = *(float *)(*(_DWORD *)(m_iAccumulatedTime + 1440) + 44), v62 > 1.5) && v61 <= v62 )
  {
    v63 = (CTaskSimple *)CTask::operator new(0x1Cu);
    CTaskSimple::CTaskSimple(v63);
    *(_WORD *)(v64 + 24) = 0;
    *(_DWORD *)(v64 + 16) = 0;
    *(_DWORD *)(v64 + 20) = 0;
    *(_DWORD *)(v64 + 8) = 28;
    *(_DWORD *)(v64 + 12) = -1;
    *(_DWORD *)v64 = &off_665784;
    v65 = v103->m_pPed;
    v103->m_pTaskSecondarySay = (CTaskSimple *)v64;
    IKChainManager_c::LookAt(
      &g_ikChainMan,
      "CompPedCollPedResp",
      v65,
      (CEntity *)m_iAccumulatedTime,
      2000,
      5,
      0,
      1,
      0.25,
      500,
      3,
      0);
    v42 = v25 == 4;
    v36 = v103;
    if ( v42 )
      goto LABEL_121;
    goto LABEL_54;
  }
  v102 = CPedGeometryAnalyser::ComputeEntityHitSide((const CPed *)m_iAccumulatedTime, v103->m_pPed);
  v35 = (CTaskComplexEvasiveStep *)CTask::operator new(0x18u);
  CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp((CTaskComplexFallAndGetUp *)v35, v102, 0);
  v36 = v103;
LABEL_110:
  v36->m_pTaskEventResponse = v35;
  if ( v35 )
  {
    if ( CPed::IsPlayer((const CPed *)m_iAccumulatedTime) )
    {
      m_pPedIntelligence = v36->m_pPed->m_pPedIntelligence;
      if ( m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsActive )
      {
        if ( m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsStopped )
        {
          v96 = CTimer::m_snTimeInMilliseconds;
          m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsStopped = 0;
          m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime = v96;
          m_iStartTime = v96;
        }
        else
        {
          m_iStartTime = m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime;
          v96 = CTimer::m_snTimeInMilliseconds;
        }
        if ( m_iStartTime + m_pPedIntelligence->m_mentalState.m_angerTimer.m_iDuration <= v96 )
        {
          m_pPedIntelligence->m_mentalState.m_angerTimer.m_iStartTime = v96;
          m_pPedIntelligence->m_mentalState.m_angerTimer.m_iDuration = 3000;
          m_iAngerAtPlayer = m_pPedIntelligence->m_mentalState.m_iAngerAtPlayer;
          m_pPedIntelligence->m_mentalState.m_angerTimer.m_bIsActive = 1;
          m_pPedIntelligence->m_mentalState.m_iAngerAtPlayer = m_iAngerAtPlayer + 1;
        }
      }
    }
  }
}
// 37CC56: variable 'v38' is possibly undefined
// 37CCA4: variable 'v40' is possibly undefined
// 37CDFE: variable 'v45' is possibly undefined
// 37CEAA: variable 'v52' is possibly undefined
// 37CF6A: variable 'v56' is possibly undefined
// 37D12C: variable 'v64' is possibly undefined
// 37D1A6: variable 'v67' is possibly undefined
// 37D200: variable 'v70' is possibly undefined
// 37D27A: variable 'v73' is possibly undefined
// 665784: using guessed type void *;

//----- (0037D5B0) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedCollisionWithPlayerResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int m_iAccumulatedTime; // r4
  float *v7; // r1
  CPed *m_pPed; // r2
  float *v9; // r3
  unsigned int v10; // r6
  CPedIntelligence *m_pPedIntelligence; // r0
  float *p_xx; // r5
  float v13; // s16
  float v14; // s26
  float v15; // s24
  float *p_x; // r1
  float v17; // s28
  float v18; // s17
  float v19; // s30
  float v20; // s18
  float v21; // s22
  float v22; // s20
  float v23; // s19
  float v24; // s23
  float v25; // s21
  CTask *TaskByType; // r4
  int v27; // r5
  int v28; // r11
  CTask *v29; // r6
  CTask *v30; // r0
  float v31; // s17
  float v32; // s28
  float v33; // s30
  float v34; // s16
  CEventHandler *v35; // r10
  CEntity *v36; // r11
  CTaskSimple *v37; // r0
  int v38; // r0
  CTask *v39; // r9
  int v40; // r4
  int v41; // r3
  float v42; // s0
  bool v43; // zf
  int v44; // r1
  int v45; // r1
  CTask *v46; // r0
  unsigned int v47; // r1
  CTaskComplexEvasiveStep *v48; // r6
  int v49; // r8
  bool v50; // zf
  int v51; // r1
  int v52; // r1
  unsigned int v53; // r1
  CTask *ActiveTask; // r0
  float v55; // s0
  CTask *v56; // r5
  CTaskSimple *v57; // r0
  int v58; // r0
  CPed *v59; // r2
  CTaskComplexFollowPointRoute *v60; // r0
  CTaskComplexEvasiveStep *v61; // r0
  int (**v62)(void); // r0
  int (*v63)(void); // r2
  CMatrix *v64; // r3
  float *v65; // r6
  float *v66; // r0
  float v67; // s2
  float v68; // s0
  float v69; // s4
  CTask *v70; // r2
  CTaskSimple *v71; // r0
  int v72; // r0
  CPed *v73; // r2
  CTaskSimple *v74; // r0
  int v75; // r0
  CTaskSimple *v76; // r0
  int v77; // r0
  CPed *v78; // r2
  bool v79; // zf
  int v80; // r0
  CMatrix *v81; // r0
  int v82; // s0
  int (**v83)(void); // r0
  int (*v84)(void); // r2
  CMatrix *m_pMat; // r3
  float *v86; // r5
  float *p_tx; // r0
  float v88; // s2
  float v89; // s0
  float v90; // s4
  int (**v91)(void); // r0
  int (*v92)(void); // r2
  CMatrix *v93; // r3
  float *v94; // r6
  float *v95; // r0
  float v96; // s2
  float v97; // s0
  float v98; // s4
  CTask *v99; // r2
  CTask *v100; // [sp+24h] [bp-E4h]
  unsigned int v102; // [sp+2Ch] [bp-DCh]
  __int64 v103; // [sp+30h] [bp-D8h]
  unsigned int v104; // [sp+38h] [bp-D0h]
  int v105; // [sp+3Ch] [bp-CCh]
  CPed *v106; // [sp+40h] [bp-C8h]
  CPointRoute route; // [sp+44h] [bp-C4h] BYREF

  m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v102 = *(__int16 *)&pEvent[3].m_bIsPersistent;
    v7 = *(float **)(m_iAccumulatedTime + 20);
    m_pPed = this->m_pPed;
    v9 = v7 + 12;
    v10 = *(_DWORD *)(m_iAccumulatedTime + 1104);
    m_pPedIntelligence = this->m_pPed->m_pPedIntelligence;
    v106 = (CPed *)m_iAccumulatedTime;
    if ( !v7 )
      v9 = (float *)(m_iAccumulatedTime + 4);
    p_xx = &m_pPed->m_pMat->xx;
    v13 = v7[4];
    v14 = v7[5];
    v15 = v7[6];
    p_x = p_xx + 12;
    v17 = *v9;
    v18 = v9[1];
    v19 = v9[2];
    v20 = p_xx[4];
    v21 = p_xx[5];
    v22 = p_xx[6];
    if ( !p_xx )
      p_x = &m_pPed->m_transform.m_translate.x;
    v23 = *p_x;
    v24 = p_x[1];
    v25 = p_x[2];
    TaskByType = CPedIntelligence::FindTaskByType(m_pPedIntelligence, 1207);
    v27 = 0;
    v28 = 0;
    if ( (v10 | 2) == 6 )
      v27 = 1;
    v104 = v10;
    if ( v10 == 7 )
      v28 = 1;
    HIDWORD(v103) = CTaskManager::FindActiveTaskByType(&this->m_pPed->m_pPedIntelligence->m_taskManager, 917);
    LODWORD(v103) = CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 900);
    v29 = CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 907);
    v30 = CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 243);
    if ( v30 && !v30[1].m_pParent )
    {
      if ( CPedGroupMembership::CountMembers(&CPedGroups::ms_groups[0].m_membership) < 3 )
        return;
      v105 = 1;
    }
    else
    {
      v105 = 0;
    }
    v31 = v18 - v24;
    v32 = v17 - v23;
    v33 = v19 - v25;
    v34 = (float)((float)(v32 * v13) + (float)(v31 * v14)) + (float)(v33 * v15);
    CPed::Say(this->m_pPed, 0x1Cu, 0, 1.0, 0, 0, 0);
    v35 = this;
    v100 = v29;
    if ( pTaskActive && (*((int (__fastcall **)(CTask *))pTaskActive->_vptr$CTask + 5))(pTaskActive) == 913 )
    {
      v36 = v106;
      if ( CPed::IsPlayer(v106) )
      {
        v37 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v37);
        *(_WORD *)(v38 + 24) = 0;
        *(_DWORD *)(v38 + 16) = 0;
        *(_DWORD *)(v38 + 20) = 0;
        *(_DWORD *)(v38 + 8) = 28;
        *(_DWORD *)(v38 + 12) = -1;
        *(_DWORD *)v38 = &off_665784;
        this->m_pTaskSecondarySay = (CTaskSimple *)v38;
        v39 = TaskByType;
        v40 = v105;
      }
      else
      {
        v39 = TaskByType;
        v40 = v105;
        if ( CTaskManager::GetActiveTask(&v106->m_pPedIntelligence->m_taskManager) )
        {
          ActiveTask = CTaskManager::GetActiveTask(&v106->m_pPedIntelligence->m_taskManager);
          if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 913
            && (float)((float)((float)rand() * 4.6566e-10) + 0.0) < 0.25 )
          {
            v55 = (float)((float)rand() * 4.6566e-10) + 0.0;
            if ( v55 >= 0.33 )
            {
              if ( v55 < 0.66 )
              {
                v74 = (CTaskSimple *)CTask::operator new(0x1Cu);
                CTaskSimple::CTaskSimple(v74);
                *(_WORD *)(v75 + 24) = 0;
                *(_DWORD *)(v75 + 16) = 0;
                *(_DWORD *)(v75 + 20) = 0;
                *(_DWORD *)(v75 + 8) = 28;
                *(_DWORD *)(v75 + 12) = -1;
                *(_DWORD *)v75 = &off_665784;
                v35->m_pTaskSecondarySay = (CTaskSimple *)v75;
              }
            }
            else
            {
              v40 = v105;
              IKChainManager_c::LookAt(
                &g_ikChainMan,
                "CompPedCollPlayerResp",
                v35->m_pPed,
                v106,
                2000,
                5,
                0,
                1,
                0.25,
                500,
                3,
                0);
            }
          }
        }
      }
      if ( v34 <= 0.0 )
      {
        v48 = 0;
        if ( !((v106 == (CPed *)pTaskActive[2]._vptr$CTask) | v40) )
          goto LABEL_103;
LABEL_91:
        v79 = v39 == 0;
        if ( v39 )
          v79 = v100 == 0;
        if ( !v79 )
        {
          v80 = HIDWORD(v103) | v103;
          if ( v103 )
            v80 = 1;
          if ( (v80 & v40) == 1 && (v104 > 7 || ((1 << v104) & 0xD0) == 0) )
          {
            v83 = v39[2]._vptr$CTask;
            v84 = v83[5];
            m_pMat = v35->m_pPed->m_pMat;
            v86 = (float *)((char *)v84 + 48);
            if ( !v84 )
              v86 = (float *)(v83 + 1);
            p_tx = &m_pMat->tx;
            if ( !m_pMat )
              p_tx = &v35->m_pPed->m_transform.m_translate.x;
            v88 = *p_tx - *v86;
            v89 = p_tx[1] - v86[1];
            v90 = sqrtf((float)((float)(v88 * v88) + (float)(v89 * v89)) + 0.0);
            if ( HIDWORD(v103) )
            {
              *(_BYTE *)(HIDWORD(v103) + 92) |= 2u;
            }
            else if ( (_DWORD)v103 )
            {
              *(float *)(v103 + 24) = v90 + 0.1;
            }
            if ( *(float *)&v100[3]._vptr$CTask != (float)(v90 + 0.1) )
            {
              *(float *)&v100[3]._vptr$CTask = v90 + 0.1;
              v100[5] = (CTask)CTimer::m_snTimeInMilliseconds;
              LOBYTE(v100[6]._vptr$CTask) = 1;
            }
            if ( v90 < 8.0 )
            {
              *(float *)&v39[4]._vptr$CTask = v88;
              *(float *)&v39[4].m_pParent = v89;
              v39[5]._vptr$CTask = 0;
            }
            goto LABEL_103;
          }
        }
        if ( ((v39 != 0) & (unsigned __int8)v40) != 1 || v104 <= 7 && ((1 << v104) & 0xD0) != 0 )
          goto LABEL_102;
LABEL_103:
        v35->m_pTaskEventResponse = v48;
        return;
      }
LABEL_86:
      v48 = 0;
      if ( v40 != 1 )
        goto LABEL_103;
      goto LABEL_91;
    }
    v41 = v28 | v27;
    v42 = (float)((float)(v32 * v20) + (float)(v31 * v21)) + (float)(v33 * v22);
    if ( v42 >= 0.0 && v34 <= 0.0 )
    {
      v39 = TaskByType;
      v36 = v106;
      if ( v102 <= 7 && ((1 << v102) & 0xD0) != 0 )
      {
        v40 = v105;
        v43 = v39 == 0;
        if ( v39 )
          v43 = v29 == 0;
        if ( v43 )
          goto LABEL_29;
        v44 = HIDWORD(v103) | v103;
        if ( v103 )
          v44 = 1;
        if ( (v44 & v105) != 1 || v104 <= 7 && ((1 << v104) & 0xD0) != 0 )
        {
LABEL_29:
          v45 = (int)v39;
          if ( v39 )
            v45 = 1;
          if ( (v45 & v105) == 1 )
          {
            v46 = pTaskActiveSimplest;
            v47 = (unsigned int)pTaskActiveSimplest;
            if ( pTaskActiveSimplest )
              v47 = 1;
            if ( (v47 & v41) == 0 )
            {
              v48 = 0;
              v49 = 1;
              goto LABEL_90;
            }
          }
          else
          {
            v46 = pTaskActiveSimplest;
            if ( !pTaskActiveSimplest )
            {
              v48 = 0;
              goto LABEL_69;
            }
          }
          v56 = v46;
          v48 = 0;
          if ( CTask::IsGoToTask(v46) )
            goto LABEL_72;
LABEL_69:
          v49 = v105;
          goto LABEL_90;
        }
        v62 = v39[2]._vptr$CTask;
        v63 = v62[5];
        v64 = v35->m_pPed->m_pMat;
        v65 = (float *)((char *)v63 + 48);
        if ( !v63 )
          v65 = (float *)(v62 + 1);
        v66 = &v64->tx;
        if ( !v64 )
          v66 = &v35->m_pPed->m_transform.m_translate.x;
        v67 = *v66 - *v65;
        v68 = v66[1] - v65[1];
        v69 = sqrtf((float)((float)(v67 * v67) + (float)(v68 * v68)) + 0.0);
        if ( HIDWORD(v103) )
        {
          *(_BYTE *)(HIDWORD(v103) + 92) |= 2u;
          v70 = v100;
        }
        else
        {
          v70 = v100;
          if ( (_DWORD)v103 )
            *(float *)(v103 + 24) = v69 + 0.1;
        }
        if ( *(float *)&v70[3]._vptr$CTask != (float)(v69 + 0.1) )
        {
          *(float *)&v70[3]._vptr$CTask = v69 + 0.1;
          v70[5] = (CTask)CTimer::m_snTimeInMilliseconds;
          LOBYTE(v70[6]._vptr$CTask) = 1;
        }
        v48 = 0;
        if ( v69 >= 8.0 )
        {
          v49 = 1;
        }
        else
        {
          *(float *)&v39[4]._vptr$CTask = v67;
          v49 = 1;
          *(float *)&v39[4].m_pParent = v68;
          v39[5]._vptr$CTask = 0;
        }
LABEL_90:
        v76 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v76);
        *(_WORD *)(v77 + 24) = 0;
        *(_DWORD *)(v77 + 20) = 0;
        *(_DWORD *)(v77 + 16) = 0;
        *(_DWORD *)(v77 + 12) = -1;
        *(_DWORD *)(v77 + 8) = 28;
        *(_DWORD *)v77 = &off_665784;
        v78 = v35->m_pPed;
        v35->m_pTaskSecondarySay = (CTaskSimple *)v77;
        IKChainManager_c::LookAt(&g_ikChainMan, "CompPedCollPlayerResp", v78, v36, 2000, 5, 0, 1, 0.25, 500, 3, 0);
        if ( !v49 )
          goto LABEL_103;
        goto LABEL_91;
      }
      goto LABEL_66;
    }
    v36 = v106;
    v39 = TaskByType;
    if ( v34 <= 0.0 )
    {
LABEL_66:
      v57 = (CTaskSimple *)CTask::operator new(0x1Cu);
      CTaskSimple::CTaskSimple(v57);
      v48 = 0;
      *(_WORD *)(v58 + 24) = 0;
      *(_DWORD *)(v58 + 20) = 0;
      *(_DWORD *)(v58 + 16) = 0;
      *(_DWORD *)(v58 + 12) = -1;
      *(_DWORD *)(v58 + 8) = 28;
      *(_DWORD *)v58 = &off_665784;
      v59 = v35->m_pPed;
      v35->m_pTaskSecondarySay = (CTaskSimple *)v58;
      IKChainManager_c::LookAt(&g_ikChainMan, "CompPedCollPlayerResp", v59, v36, 2000, 5, 0, 1, 0.25, 500, 3, 0);
      v40 = v105;
      if ( v105 )
        goto LABEL_91;
      goto LABEL_102;
    }
    v40 = v105;
    if ( v42 < 0.0 )
      goto LABEL_86;
    if ( v102 > 7 || ((1 << v102) & 0xD0) == 0 )
    {
      v71 = (CTaskSimple *)CTask::operator new(0x1Cu);
      CTaskSimple::CTaskSimple(v71);
      v48 = 0;
      *(_WORD *)(v72 + 24) = 0;
      *(_DWORD *)(v72 + 16) = 0;
      *(_DWORD *)(v72 + 20) = 0;
      *(_DWORD *)(v72 + 8) = 28;
      *(_DWORD *)(v72 + 12) = -1;
      *(_DWORD *)v72 = &off_665784;
      v73 = v35->m_pPed;
      v35->m_pTaskSecondarySay = (CTaskSimple *)v72;
      IKChainManager_c::LookAt(&g_ikChainMan, "CompPedCollPlayerResp", v73, v106, 2000, 5, 0, 1, 0.25, 500, 3, 0);
      if ( v105 )
        goto LABEL_91;
LABEL_102:
      v81 = v36->m_pMat;
      *(float *)&v82 = -v81->yy;
      route.m_routePoints[0].x = v81->xy;
      route.m_routePoints[0].y = 0.0;
      route.m_iRouteSize = v82;
      CVector::Normalise((CVector *)&route);
      v48 = (CTaskComplexEvasiveStep *)CTask::operator new(0x1Cu);
      CTaskComplexEvasiveStep::CTaskComplexEvasiveStep(v48, v36, (const CVector *)&route);
      goto LABEL_103;
    }
    v50 = v39 == 0;
    if ( v39 )
      v50 = v29 == 0;
    if ( !v50 )
    {
      v51 = HIDWORD(v103) | v103;
      if ( v103 )
        v51 = 1;
      if ( (v51 & v105) == 1 && (v104 > 7 || ((1 << v104) & 0xD0) == 0) )
      {
        v91 = v39[2]._vptr$CTask;
        v92 = v91[5];
        v93 = v35->m_pPed->m_pMat;
        v94 = (float *)((char *)v92 + 48);
        if ( !v92 )
          v94 = (float *)(v91 + 1);
        v95 = &v93->tx;
        if ( !v93 )
          v95 = &v35->m_pPed->m_transform.m_translate.x;
        v96 = *v95 - *v94;
        v97 = v95[1] - v94[1];
        v98 = sqrtf((float)((float)(v96 * v96) + (float)(v97 * v97)) + 0.0);
        if ( HIDWORD(v103) )
        {
          *(_BYTE *)(HIDWORD(v103) + 92) |= 2u;
          v99 = v100;
        }
        else
        {
          v99 = v100;
          if ( (_DWORD)v103 )
            *(float *)(v103 + 24) = v98 + 0.1;
        }
        if ( *(float *)&v99[3]._vptr$CTask != (float)(v98 + 0.1) )
        {
          *(float *)&v99[3]._vptr$CTask = v98 + 0.1;
          v99[5] = (CTask)CTimer::m_snTimeInMilliseconds;
          LOBYTE(v99[6]._vptr$CTask) = 1;
        }
        v48 = 0;
        if ( v98 >= 8.0 )
        {
          v49 = 1;
        }
        else
        {
          *(float *)&v39[4]._vptr$CTask = v96;
          v49 = 1;
          *(float *)&v39[4].m_pParent = v97;
          v39[5]._vptr$CTask = 0;
        }
        goto LABEL_90;
      }
    }
    v52 = (int)v39;
    if ( v39 )
      v52 = 1;
    if ( (v52 & v105) == 1 )
    {
      v53 = (unsigned int)pTaskActiveSimplest;
      if ( pTaskActiveSimplest )
        v53 = 1;
      if ( (v53 & v41) == 0 )
      {
        v48 = 0;
        v49 = 1;
        goto LABEL_90;
      }
    }
    else if ( !pTaskActiveSimplest )
    {
      v48 = 0;
LABEL_89:
      v49 = v105;
      goto LABEL_90;
    }
    v56 = pTaskActiveSimplest;
    v48 = 0;
    if ( CTask::IsGoToTask(pTaskActiveSimplest) )
    {
LABEL_72:
      route.m_iRouteSize = 0;
      CPedGeometryAnalyser::ComputeRouteRoundEntityBoundingBox(
        v35->m_pPed,
        v36,
        (const CVector *)&v56[1].m_pParent,
        &route,
        0);
      v60 = (CTaskComplexFollowPointRoute *)CTask::operator new(0x3Cu);
      v40 = v105;
      CTaskComplexFollowPointRoute::CTaskComplexFollowPointRoute(v60, 4, &route, 0, 0.5, 5.0, 0, 1, 1);
      v49 = 0;
      v48 = v61;
      goto LABEL_90;
    }
    goto LABEL_89;
  }
}
// 37D71E: variable 'v38' is possibly undefined
// 37D9E8: variable 'v58' is possibly undefined
// 37DAE6: variable 'v61' is possibly undefined
// 37DB6E: variable 'v72' is possibly undefined
// 37DBDE: variable 'v75' is possibly undefined
// 37DC4E: variable 'v77' is possibly undefined
// 665784: using guessed type void *off_665784;

//----- (0037DFC8) --------------------------------------------------------
void __fastcall CEventHandler::ComputePlayerCollisionWithPedResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_iAccumulatedTime; // r10
  CPed *m_pPed; // r5
  float *p_xx; // r0
  float *v7; // r2
  float *p_x; // r3
  float *v9; // r6
  float v10; // s16
  float v11; // s20
  float v12; // s18
  float v13; // s26
  float v14; // s21
  float v15; // s22
  float v16; // s24
  float v17; // s19
  float v18; // s30
  float v19; // s17
  float v20; // s23
  float v21; // s28
  unsigned int v22; // r4
  unsigned int v23; // r6
  CTask *ActiveTask; // r0
  CTaskSimple *v25; // r0
  int v26; // r0
  CTaskComplexHitResponse *v27; // r11
  CEventHandler *v28; // r5
  float v29; // s0
  float v30; // s2
  bool v31; // zf
  float v32; // s4
  float v33; // s6
  float v34; // s0
  float v35; // s2
  float v36; // s0
  CTaskSimple *v37; // r0
  float m_fDefendMult; // s0
  float v39; // s4
  CTaskSimple *v40; // r0
  int v41; // r0
  CPed *v42; // r2
  int v43; // r5
  CTaskComplexHitResponse *v44; // r0
  int v45; // r1
  CPlayerPed *v46; // r6
  CTaskSimple *v47; // r0
  int v48; // r0
  CPlayerPed *v49; // r0
  bool v50; // cc
  int v51; // r9
  CTaskSimple *v52; // r0
  int v53; // r0
  CPed *v54; // r2
  CTaskSimple *v55; // r0
  CTaskSimple *v56; // r0
  int v57; // r0
  CPed *v58; // r2
  CPlayerPed *v59; // r4
  CTaskSimple *v60; // r0
  int v61; // r0
  CPed *v62; // r2
  int v63; // r5
  CTaskComplexFallAndGetUp *v64; // r0
  int v65; // r1
  CPlayerPed *v66; // [sp+20h] [bp-68h]

  m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    m_pPed = this->m_pPed;
    p_xx = &m_iAccumulatedTime->m_pMat->xx;
    v7 = &m_pPed->m_pMat->xx;
    p_x = p_xx + 12;
    if ( !p_xx )
      p_x = &m_iAccumulatedTime->m_transform.m_translate.x;
    v9 = v7 + 12;
    v10 = *p_x;
    v11 = p_x[1];
    v12 = p_x[2];
    if ( !v7 )
      v9 = &m_pPed->m_transform.m_translate.x;
    v13 = p_xx[4];
    v14 = p_xx[5];
    v15 = p_xx[6];
    v16 = *v9;
    v17 = v9[1];
    v18 = v9[2];
    v19 = v7[4];
    v20 = v7[5];
    v21 = v7[6];
    v22 = *(__int16 *)&pEvent[3].m_bIsPersistent;
    v23 = *((__int16 *)&pEvent[3].m_bIsPersistent + 1);
    if ( CTaskManager::GetActiveTask(&m_iAccumulatedTime->m_pPedIntelligence->m_taskManager) )
    {
      ActiveTask = CTaskManager::GetActiveTask(&m_iAccumulatedTime->m_pPedIntelligence->m_taskManager);
      if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 913 )
      {
        v25 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v25);
        v27 = 0;
        *(_WORD *)(v26 + 24) = 0;
        *(_DWORD *)(v26 + 16) = 0;
        *(_DWORD *)(v26 + 20) = 0;
        *(_DWORD *)(v26 + 8) = 28;
        *(_DWORD *)(v26 + 12) = -1;
        *(_DWORD *)v26 = &off_665784;
        v28 = this;
LABEL_16:
        v28->m_pTaskSecondarySay = (CTaskSimple *)v26;
LABEL_40:
        v28->m_pTaskEventResponse = v27;
        return;
      }
    }
    v29 = v11 - v17;
    v30 = v10 - v16;
    v31 = (unsigned __int16)v22 == 4;
    v32 = v12 - v18;
    if ( (unsigned __int16)v22 == 4 )
      v31 = (unsigned __int16)v23 == 4;
    v33 = (float)(v30 * v13) + (float)(v29 * v14);
    v34 = (float)(v30 * v19) + (float)(v29 * v20);
    v35 = v33 + (float)(v32 * v15);
    v36 = v34 + (float)(v32 * v21);
    if ( v31 )
    {
      if ( v36 < 0.0 )
      {
        v46 = (CPlayerPed *)m_pPed;
        v28 = this;
        v27 = 0;
        if ( v35 > 0.0 )
          goto LABEL_40;
        v28 = this;
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "CompPlayerCollPedResp",
          this->m_pPed,
          m_iAccumulatedTime,
          2000,
          5,
          0,
          1,
          0.25,
          500,
          3,
          0);
        v47 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v47);
        *(_WORD *)(v48 + 24) = 0;
        *(_DWORD *)(v48 + 8) = 28;
        *(_DWORD *)(v48 + 12) = -1;
        *(_DWORD *)(v48 + 16) = 0;
        *(_DWORD *)(v48 + 20) = 0;
        *(_DWORD *)v48 = &off_665784;
        this->m_pTaskSecondarySay = (CTaskSimple *)v48;
        v49 = v46;
LABEL_39:
        CPlayerPed::AnnoyPlayerPed(v49, 0);
        goto LABEL_40;
      }
      v28 = this;
      v27 = 0;
      IKChainManager_c::LookAt(
        &g_ikChainMan,
        "CompPlayerCollPedResp",
        this->m_pPed,
        m_iAccumulatedTime,
        2000,
        5,
        0,
        1,
        0.25,
        500,
        3,
        0);
      v37 = (CTaskSimple *)CTask::operator new(0x1Cu);
      CTaskSimple::CTaskSimple(v37);
    }
    else
    {
      if ( (v22 | 1) == 7 && v23 <= 7 && ((1 << v23) & 0xD0) != 0 )
      {
        if ( v36 < 0.0 || v35 > 0.0 )
        {
          if ( v36 >= 0.0 )
          {
            v56 = (CTaskSimple *)CTask::operator new(0x1Cu);
            CTaskSimple::CTaskSimple(v56);
            v27 = 0;
            *(_WORD *)(v57 + 24) = 0;
            *(_DWORD *)(v57 + 16) = 0;
            *(_DWORD *)(v57 + 20) = 0;
            *(_DWORD *)(v57 + 8) = 28;
            *(_DWORD *)(v57 + 12) = -1;
            *(_DWORD *)v57 = &off_665784;
            v28 = this;
            v58 = this->m_pPed;
            this->m_pTaskSecondarySay = (CTaskSimple *)v57;
            IKChainManager_c::LookAt(
              &g_ikChainMan,
              "CompPlayerCollPedResp",
              v58,
              m_iAccumulatedTime,
              2000,
              5,
              0,
              1,
              0.25,
              500,
              3,
              0);
            goto LABEL_40;
          }
          v59 = (CPlayerPed *)m_pPed;
          v28 = this;
          v27 = 0;
          if ( v35 > 0.0 )
            goto LABEL_40;
          v60 = (CTaskSimple *)CTask::operator new(0x1Cu);
          CTaskSimple::CTaskSimple(v60);
          *(_WORD *)(v61 + 24) = 0;
          *(_DWORD *)(v61 + 16) = 0;
          *(_DWORD *)(v61 + 20) = 0;
          *(_DWORD *)(v61 + 8) = 28;
          *(_DWORD *)(v61 + 12) = -1;
          v28 = this;
          *(_DWORD *)v61 = &off_665784;
          v62 = this->m_pPed;
          this->m_pTaskSecondarySay = (CTaskSimple *)v61;
          IKChainManager_c::LookAt(
            &g_ikChainMan,
            "CompPlayerCollPedResp",
            v62,
            m_iAccumulatedTime,
            2000,
            5,
            0,
            1,
            0.25,
            500,
            3,
            0);
          v49 = v59;
          goto LABEL_39;
        }
        v66 = (CPlayerPed *)m_pPed;
        v28 = this;
        if ( (unsigned __int16)v23 == 4
          || (m_fDefendMult = this->m_pPed->m_pPedStats->m_fDefendMult, m_fDefendMult <= 1.5)
          || (v39 = m_iAccumulatedTime->m_pPedStats->m_fDefendMult, v39 > 1.5) && m_fDefendMult <= v39 )
        {
          v40 = (CTaskSimple *)CTask::operator new(0x1Cu);
          CTaskSimple::CTaskSimple(v40);
          v27 = 0;
          *(_WORD *)(v41 + 24) = 0;
          *(_DWORD *)(v41 + 16) = 0;
          *(_DWORD *)(v41 + 20) = 0;
          *(_DWORD *)(v41 + 8) = 28;
          *(_DWORD *)(v41 + 12) = -1;
          *(_DWORD *)v41 = &off_665784;
          v42 = this->m_pPed;
          this->m_pTaskSecondarySay = (CTaskSimple *)v41;
          IKChainManager_c::LookAt(
            &g_ikChainMan,
            "CompPlayerCollPedResp",
            v42,
            m_iAccumulatedTime,
            2000,
            5,
            0,
            1,
            0.25,
            500,
            3,
            0);
          if ( (unsigned __int16)v22 == 7 )
          {
            v43 = CPedGeometryAnalyser::ComputeEntityHitSide(m_iAccumulatedTime, this->m_pPed);
            v44 = (CTaskComplexHitResponse *)CTask::operator new(0x10u);
            v45 = v43;
            v27 = v44;
            v28 = this;
            CTaskComplexHitResponse::CTaskComplexHitResponse(v44, v45);
          }
        }
        else
        {
          v63 = CPedGeometryAnalyser::ComputeEntityHitSide(m_iAccumulatedTime, this->m_pPed);
          v64 = (CTaskComplexFallAndGetUp *)CTask::operator new(0x18u);
          v65 = v63;
          v27 = (CTaskComplexHitResponse *)v64;
          v28 = this;
          CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp(v64, v65, 0);
        }
        goto LABEL_38;
      }
      v50 = (unsigned __int16)v22 > 1u;
      if ( (unsigned __int16)v22 <= 1u )
        v50 = v23 > 7;
      if ( !v50 && ((1 << v23) & 0xD0) != 0 && v35 <= 0.0 )
      {
        v66 = (CPlayerPed *)m_pPed;
        v28 = this;
        v51 = CPedGeometryAnalyser::ComputeEntityHitSide(m_iAccumulatedTime, this->m_pPed);
        v27 = 0;
        if ( (unsigned __int16)v23 != 4 )
        {
          v27 = (CTaskComplexHitResponse *)CTask::operator new(0x10u);
          CTaskComplexHitResponse::CTaskComplexHitResponse(v27, v51);
        }
        v52 = (CTaskSimple *)CTask::operator new(0x1Cu);
        CTaskSimple::CTaskSimple(v52);
        *(_WORD *)(v53 + 24) = 0;
        *(_DWORD *)(v53 + 16) = 0;
        *(_DWORD *)(v53 + 20) = 0;
        *(_DWORD *)(v53 + 8) = 28;
        *(_DWORD *)(v53 + 12) = -1;
        *(_DWORD *)v53 = &off_665784;
        v54 = this->m_pPed;
        this->m_pTaskSecondarySay = (CTaskSimple *)v53;
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "CompPlayerCollPedResp",
          v54,
          m_iAccumulatedTime,
          2000,
          5,
          0,
          1,
          0.25,
          500,
          3,
          0);
LABEL_38:
        v49 = v66;
        goto LABEL_39;
      }
      v27 = 0;
      if ( v22 > 7 )
      {
        v28 = this;
        goto LABEL_40;
      }
      v28 = this;
      if ( ((1 << v22) & 0xD0) == 0 )
        goto LABEL_40;
      v27 = 0;
      if ( (unsigned __int16)v23 > 1u || v36 < 0.0 || (unsigned __int16)v22 != 7 )
        goto LABEL_40;
      v27 = 0;
      IKChainManager_c::LookAt(
        &g_ikChainMan,
        "CompPlayerCollPedResp",
        this->m_pPed,
        m_iAccumulatedTime,
        1000,
        5,
        0,
        1,
        0.25,
        500,
        3,
        0);
      v55 = (CTaskSimple *)CTask::operator new(0x1Cu);
      CTaskSimple::CTaskSimple(v55);
    }
    *(_WORD *)(v26 + 24) = 0;
    *(_DWORD *)(v26 + 8) = 28;
    *(_DWORD *)(v26 + 12) = -1;
    *(_DWORD *)(v26 + 16) = 0;
    *(_DWORD *)(v26 + 20) = 0;
    *(_DWORD *)v26 = &off_665784;
    goto LABEL_16;
  }
}
// 37E078: variable 'v26' is possibly undefined
// 37E1EA: variable 'v41' is possibly undefined
// 37E2B6: variable 'v48' is possibly undefined
// 37E32C: variable 'v53' is possibly undefined
// 37E42A: variable 'v57' is possibly undefined
// 37E4A0: variable 'v61' is possibly undefined
// 665784: using guessed type void *off_665784;

//----- (0037E564) --------------------------------------------------------
void __fastcall CEventHandler::ComputeObjectCollisionResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v4; // r9
  int IsGoToTask; // r0
  bool v9; // zf
  CEntity *v10; // r8
  CTaskComplexWalkRoundObject *v11; // r0
  CTask *v12; // r0

  if ( pTaskActiveSimplest )
  {
    IsGoToTask = CTask::IsGoToTask(pTaskActiveSimplest);
    v9 = IsGoToTask == 0;
    if ( IsGoToTask )
    {
      v4 = SLOWORD(pEvent[1]._vptr$CEvent);
      v9 = v4 == 1;
    }
    if ( !v9 )
    {
      v10 = *(CEntity **)&pEvent[1].m_bIsPersistent;
      CEventObjectCollision::IsHeadOnCollision((const CEventObjectCollision *)pEvent, this->m_pPed);
      if ( v10 )
      {
        v11 = (CTaskComplexWalkRoundObject *)CTask::operator new(0x54u);
        CTaskComplexWalkRoundObject::CTaskComplexWalkRoundObject(
          v11,
          v4,
          (const CVector *)&pTaskActiveSimplest[1].m_pParent,
          v10);
        this->m_pTaskEventResponse = v12;
      }
    }
  }
}
// 37E5A8: variable 'v4' is possibly undefined
// 37E5AC: variable 'v12' is possibly undefined

//----- (0037E5B4) --------------------------------------------------------
void __fastcall CEventHandler::ComputeBuildingCollisionResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CBuilding *v4; // r6
  bool v7; // zf
  _BOOL4 IsHeadOnCollision; // r0
  int v11; // r5
  _BOOL4 v12; // r9
  CTaskComplexWalkRoundObject *v13; // r0
  CTask *v14; // r0
  float v15; // s0
  CTask *IsGoToTask; // r0
  int v17; // s0
  const float *v18; // r2
  const CVector *v19; // r3
  const CVector *v20; // r10
  int v21; // r11
  CTask *v22; // r5
  int v23; // r8
  bool v24; // zf
  int v25; // r1
  const float *v26; // r0
  __int64 v27; // d16
  int v28; // r0
  const CVector *v29; // r5
  CTaskComplexWalkRoundBuildingAttempt *v30; // r0
  bool v31; // r1
  __int64 v32; // d16
  int (**v33)(void); // r6
  const CVector *v34; // r9
  CTaskComplexWalkRoundBuildingAttempt *v35; // r0
  int v36; // r1
  CTaskComplexMoveBackAndJump *v37; // r0
  CTaskComplexWalkRoundBuildingAttempt *v38; // r0
  _BOOL4 CanPedJumpObstacle; // r1
  CTaskSimpleHitHead *v40; // r0
  CTaskComplexJump *v41; // r0
  int (***v42)(void); // r0
  CTaskComplexWalkRoundBuildingAttempt *v43; // r0
  CEntity *v44; // r8
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  float v47; // s16
  float v48; // s18
  CTaskSimpleClimb *v49; // r0
  int8 v50; // r2
  CVector *vPos; // [sp+0h] [bp-88h]
  const CVector *v52; // [sp+4h] [bp-84h]
  bool bIsHeadOnCollision; // [sp+8h] [bp-80h]
  const CVector *v54; // [sp+24h] [bp-64h]
  __int64 v55; // [sp+28h] [bp-60h]
  CTask *TaskByType; // [sp+30h] [bp-58h]
  uint8 nSurfaceType; // [sp+37h] [bp-51h] BYREF
  float fGrabHeading; // [sp+38h] [bp-50h] BYREF
  CVector offset_vector; // [sp+3Ch] [bp-4Ch] BYREF
  CVector vTarget; // [sp+48h] [bp-40h] BYREF

  v7 = pTaskActive == 0;
  if ( pTaskActive )
  {
    v4 = *(CBuilding **)&pEvent[1].m_bIsPersistent;
    v7 = v4 == 0;
  }
  if ( v7 )
    return;
  IsHeadOnCollision = CEventBuildingCollision::IsHeadOnCollision((const CEventBuildingCollision *)pEvent, this->m_pPed);
  v11 = SLOWORD(pEvent[1]._vptr$CEvent);
  v12 = IsHeadOnCollision;
  if ( v11 == 1 )
    return;
  TaskByType = CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 1000);
  HIDWORD(v55) = CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 907);
  LODWORD(v55) = CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 718);
  (*((void (__fastcall **)(CTask *))pTaskActive->_vptr$CTask + 5))(pTaskActive);
  CTaskCategories::ComputeTaskCategory(pTaskActive);
  if ( CEventBuildingCollision::CanTreatBuildingAsObject(v4) )
  {
    if ( !CTask::IsGoToTask(pTaskActiveSimplest) )
      return;
    v13 = (CTaskComplexWalkRoundObject *)CTask::operator new(0x54u);
    CTaskComplexWalkRoundObject::CTaskComplexWalkRoundObject(
      v13,
      v11,
      (const CVector *)&pTaskActiveSimplest[1].m_pParent,
      v4);
    goto LABEL_50;
  }
  v15 = (float)(unsigned __int16)rand() * 0.000015259;
  IsGoToTask = (CTask *)CTask::IsGoToTask(pTaskActiveSimplest);
  v17 = (int)(float)(v15 * 1024.0);
  if ( IsGoToTask )
    IsGoToTask = pTaskActiveSimplest;
  v18 = (const float *)(*(_BYTE *)&this->m_pPed->m_nPedFlags << 31);
  if ( v18 )
  {
    v18 = &CBuildingPotentialCollisionScanner::ms_fNormalZThreshold;
    if ( *(float *)&pEvent[2].m_bIsPersistent > 0.707 )
      goto LABEL_47;
  }
  v19 = (const CVector *)&pEvent[3];
  v20 = (const CVector *)&pEvent[2];
  v21 = v11;
  if ( !IsGoToTask )
  {
    v22 = TaskByType;
    v24 = TaskByType == 0;
    if ( TaskByType )
    {
      v18 = (const float *)TaskByType[2]._vptr$CTask;
      v24 = v18 == 0;
    }
    if ( v24 )
    {
      if ( v12 )
      {
        CanPedJumpObstacle = CPedGeometryAnalyser::CanPedJumpObstacle(this->m_pPed, v4, v20, v19);
        v14 = 0;
        if ( v21 >= 5 && !CanPedJumpObstacle )
        {
          v40 = (CTaskSimpleHitHead *)CTask::operator new(0x10u);
          CTaskSimpleHitHead::CTaskSimpleHitHead(v40);
        }
        goto LABEL_50;
      }
      goto LABEL_47;
    }
    goto LABEL_19;
  }
  v22 = TaskByType;
  if ( TaskByType )
  {
    v18 = (const float *)TaskByType[2]._vptr$CTask;
    if ( !v18 )
    {
      v23 = 1;
      goto LABEL_29;
    }
LABEL_19:
    v25 = *((_DWORD *)v18 + 5);
    v23 = 1;
    v26 = (const float *)(v25 + 48);
    if ( !v25 )
      v26 = v18 + 1;
    v27 = *(_QWORD *)v26;
    vTarget.z = v26[2];
    *(_QWORD *)&vTarget.x = v27;
    if ( !v12 )
      goto LABEL_30;
    goto LABEL_22;
  }
  v23 = 0;
LABEL_29:
  v32 = *(_QWORD *)&IsGoToTask[1].m_pParent;
  LODWORD(vTarget.z) = IsGoToTask[2].m_pParent;
  *(_QWORD *)&vTarget.x = v32;
  if ( !v12 )
  {
LABEL_30:
    if ( v23 == 1 )
    {
      v33 = v22[2]._vptr$CTask;
      v34 = v19;
      if ( v33 )
      {
LABEL_32:
        memset(&offset_vector, 0, sizeof(offset_vector));
        v35 = (CTaskComplexWalkRoundBuildingAttempt *)CTask::operator new(0x4Cu);
        vPos = (CVector *)v34;
        v52 = v20;
        bIsHeadOnCollision = 0;
        v36 = v21;
LABEL_33:
        CTaskComplexWalkRoundBuildingAttempt::CTaskComplexWalkRoundBuildingAttempt(
          v35,
          v36,
          (CEntity *)v33,
          &offset_vector,
          vPos,
          v52,
          bIsHeadOnCollision);
LABEL_50:
        this->m_pTaskEventResponse = v14;
        return;
      }
LABEL_39:
      v38 = (CTaskComplexWalkRoundBuildingAttempt *)CTask::operator new(0x4Cu);
      CTaskComplexWalkRoundBuildingAttempt::CTaskComplexWalkRoundBuildingAttempt(v38, v21, &vTarget, v34, v20, 0);
      goto LABEL_50;
    }
    if ( HIDWORD(v55) )
    {
      v34 = v19;
      v33 = *(int (***)(void))(HIDWORD(v55) + 12);
      if ( v33 )
        goto LABEL_32;
      goto LABEL_39;
    }
    v29 = v19;
    v30 = (CTaskComplexWalkRoundBuildingAttempt *)CTask::operator new(0x4Cu);
    v31 = 0;
LABEL_49:
    CTaskComplexWalkRoundBuildingAttempt::CTaskComplexWalkRoundBuildingAttempt(v30, v21, &vTarget, v29, v20, v31);
    goto LABEL_50;
  }
LABEL_22:
  v28 = HIDWORD(v55);
  if ( HIDWORD(v55) )
    v28 = 1;
  if ( (v17 & 0xF) != 15 && !(_DWORD)v55 && (v28 | v23) != 1 )
  {
    v29 = v19;
    v30 = (CTaskComplexWalkRoundBuildingAttempt *)CTask::operator new(0x4Cu);
    v31 = 1;
    goto LABEL_49;
  }
  v54 = v19;
  if ( CPedGeometryAnalyser::CanPedJumpObstacle(this->m_pPed, v4, v20, v19) )
  {
    if ( v21 < 5 )
    {
      v41 = (CTaskComplexJump *)CTask::operator new(0x14u);
      CTaskComplexJump::CTaskComplexJump(v41, 0);
    }
    else
    {
      v37 = (CTaskComplexMoveBackAndJump *)CTask::operator new(0xCu);
      CTaskComplexMoveBackAndJump::CTaskComplexMoveBackAndJump(v37);
    }
    goto LABEL_50;
  }
  if ( v23 == 1 )
  {
    v33 = TaskByType[2]._vptr$CTask;
    if ( !v33 || CPedGeometryAnalyser::CanPedTargetPed(this->m_pPed, (CPed *)TaskByType[2]._vptr$CTask, 1) )
    {
LABEL_47:
      v14 = 0;
      goto LABEL_50;
    }
    memset(&offset_vector, 0, sizeof(offset_vector));
    v35 = (CTaskComplexWalkRoundBuildingAttempt *)CTask::operator new(0x4Cu);
    vPos = (CVector *)v54;
    v52 = v20;
    bIsHeadOnCollision = 1;
LABEL_75:
    v36 = v21;
    goto LABEL_33;
  }
  if ( !v55 )
  {
    v43 = (CTaskComplexWalkRoundBuildingAttempt *)CTask::operator new(0x4Cu);
    CTaskComplexWalkRoundBuildingAttempt::CTaskComplexWalkRoundBuildingAttempt(v43, v21, &vTarget, v54, v20, 1);
    goto LABEL_50;
  }
  if ( HIDWORD(v55) )
  {
    v42 = (int (***)(void))(HIDWORD(v55) + 12);
  }
  else
  {
    v33 = *(int (***)(void))(v55 + 12);
    if ( !v33 )
      goto LABEL_61;
    v42 = (int (***)(void))(v33 + 281);
  }
  v33 = *v42;
LABEL_61:
  if ( v33 )
  {
    if ( CTaskComplexGangFollower::ms_nUseClimbing )
    {
      if ( CPedGroups::IsInPlayersGroup(this->m_pPed) )
      {
        v44 = CTaskSimpleClimb::TestForClimb(this->m_pPed, &offset_vector, &fGrabHeading, &nSurfaceType, 1);
        if ( v44 )
        {
          m_pMat = this->m_pPed->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          v47 = CTaskSimpleClimb::ms_fMinForStretchGrab;
          if ( !m_pMat )
            p_tx = &this->m_pPed->m_transform;
          v48 = offset_vector.z - p_tx->m_translate.z;
          v49 = (CTaskSimpleClimb *)CTask::operator new(0x30u);
          v50 = 1;
          if ( v48 < v47 )
            v50 = 2;
          CTaskSimpleClimb::CTaskSimpleClimb(v49, v44, &offset_vector, fGrabHeading, nSurfaceType, v50, 1);
          goto LABEL_50;
        }
      }
    }
    if ( (*((_BYTE *)v33 + 58) & 7) == 3 )
    {
      if ( !IKChainManager_c::IsLooking(&g_ikChainMan, this->m_pPed) )
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "CompBldgCollResp",
          this->m_pPed,
          (CEntity *)v33,
          3000,
          5,
          0,
          1,
          0.25,
          500,
          3,
          0);
      CTaskManager::GetTaskSecondary(&this->m_pPed->m_pPedIntelligence->m_taskManager, 2);
    }
    memset(&offset_vector, 0, sizeof(offset_vector));
    v35 = (CTaskComplexWalkRoundBuildingAttempt *)CTask::operator new(0x4Cu);
    vPos = (CVector *)v54;
    v52 = v20;
    bIsHeadOnCollision = 1;
    goto LABEL_75;
  }
}
// 37E632: variable 'v4' is possibly undefined
// 37E81C: variable 'v14' is possibly undefined

//----- (0037E9C0) --------------------------------------------------------
void __fastcall CEventHandler::ComputeDraggedOutCarResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  __int64 v6; // kr00_8
  int v7; // r9
  _BOOL4 IsPlayer; // r0
  CTaskComplexSmartFleeEntity *v9; // r0
  CTask *v10; // r0
  CPed *v11; // r1
  int v12; // r5
  bool v13; // zf
  CTaskComplexLeaveCar *v14; // r8
  int v15; // r5
  CTaskComplexSequence *v16; // r0
  CTask *v17; // r0
  int v18; // r0
  CMatrix *v19; // r3
  __int64 *v20; // r1
  CSimpleTransform *p_m_transform; // r5
  __int64 v22; // r0
  float v23; // r0
  float v24; // r11
  CTaskSimpleAchieveHeading *v25; // r5
  CTaskSimpleShakeFist *v26; // r5
  CTaskComplexSequence *v27; // r0
  CTaskComplexSequence *v28; // r8
  int v29; // r0
  CMatrix *v30; // r3
  __int64 *v31; // r1
  CSimpleTransform *v32; // r5
  __int64 v33; // r0
  float v34; // r0
  float v35; // r11
  CTaskSimpleAchieveHeading *v36; // r5
  CTaskSimpleShakeFist *v37; // r5
  CTask *v38; // r0
  CTaskComplexSmartFleeEntity *v39; // r0
  CTaskComplexEnterCarAsDriver *v40; // r0
  CTaskComplexDestroyCar *v41; // r0
  unsigned __int16 v42; // r11
  CTaskComplexStealCar *v43; // r5
  CTaskComplexSequence *v44; // r10
  CMatrix *m_pMat; // r3
  CSimpleTransform *p_tx; // r5
  float RadianAngleBetweenPoints; // r0
  float v48; // r11
  CTaskSimpleAchieveHeading *v49; // r5
  CTaskSimpleShakeFist *v50; // r5
  CTaskComplexStealCar *v51; // r0
  CTaskComplexDragPedFromCar *v52; // r5
  CTaskComplexKillCriminal *v53; // r0
  CTaskComplexSequence *v54; // r5
  CTaskComplexSequence *v55; // r0
  unsigned __int16 v56; // r11
  CTaskComplexKillPedOnFoot *v57; // r11
  CTaskComplexEnterCarAsDriver *v58; // r0
  CTaskComplexStealCar *v59; // r5
  unsigned __int16 v60; // r11
  CTaskComplexDragPedFromCar *v61; // r5
  CTaskComplexSequence *v62; // [sp+10h] [bp-20h]
  CTaskComplexSequence *v63; // [sp+10h] [bp-20h]

  v6 = *(_QWORD *)&pEvent[1].m_iAccumulatedTime;
  v7 = LOBYTE(pEvent[2]._vptr$CEvent);
  IsPlayer = CPed::IsPlayer(this->m_pPed);
  if ( HIDWORD(v6) && !IsPlayer )
  {
    if ( *(_BYTE *)(*(_DWORD *)(HIDWORD(v6) + 904) + 222) == 15 )
    {
      v9 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
      CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
        v9,
        (CEntity *)v6,
        0,
        60.0,
        (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
        (const int)&elf_hash_bucket[187],
        1.0);
      this->m_pTaskEventResponse = v10;
      return;
    }
    v11 = *(CPed **)(HIDWORD(v6) + 1124);
    v12 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    v13 = v11 == this->m_pPed;
    if ( v11 != this->m_pPed )
      v13 = *(CPed **)(HIDWORD(v6) + 1128) == this->m_pPed;
    if ( v13 )
    {
      v14 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar(v14, (CVehicle *)HIDWORD(v6), 0, 0, 0, 1);
    }
    else
    {
      v14 = 0;
    }
    this->m_pTaskEventResponse = 0;
    if ( v12 > 910 )
    {
      if ( v12 <= 1002 )
      {
        if ( v12 == 911 )
        {
          if ( !(_DWORD)v6 )
          {
            if ( *(_DWORD *)(HIDWORD(v6) + 1124) )
              goto LABEL_60;
            v51 = (CTaskComplexStealCar *)CTask::operator new(0x20u);
            CTaskComplexStealCar::CTaskComplexStealCar(v51, (CVehicle *)HIDWORD(v6));
            goto LABEL_59;
          }
        }
        else
        {
          if ( v12 != 1000 )
            goto LABEL_60;
          if ( !(_DWORD)v6 )
          {
            v44 = (CTaskComplexSequence *)CTask::operator new(0x40u);
            CTaskComplexSequence::CTaskComplexSequence(v44);
            this->m_pTaskEventResponse = v44;
            if ( (rand() & 0x3FFu) <= 0x200 )
            {
              v50 = (CTaskSimpleShakeFist *)CTask::operator new(0x18u);
              v60 = rand();
              CTaskSimple::CTaskSimple(v50);
              LOWORD(v50[1]._vptr$CTask) = 0;
              *(_DWORD *)&v50->m_bIsFinished = 0;
              v50->m_pAnim = 0;
              v50->_vptr$CTask = (int (**)(void))&off_665750;
              v50[1].m_pParent = (CTask *)((int)(float)((float)((float)v60 * 0.000015259) * 1000.0) + 500);
            }
            else
            {
              m_pMat = this->m_pPed->m_pMat;
              p_tx = (CSimpleTransform *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = &this->m_pPed->m_transform;
              RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(
                                           2.3534e-38,
                                           -1.2117e-26,
                                           p_tx->m_translate.x,
                                           p_tx->m_translate.y);
              v48 = CGeneral::LimitRadianAngle(RadianAngleBetweenPoints);
              v49 = (CTaskSimpleAchieveHeading *)CTask::operator new(0x18u);
              CTaskSimpleAchieveHeading::CTaskSimpleAchieveHeading(v49, v48, 0.5, 0.2);
              CTaskComplexSequence::AddTask(v44, v49);
              v50 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
              CTaskSimpleShakeFist::CTaskSimpleShakeFist(v50);
            }
            CTaskComplexSequence::AddTask(v44, v50);
            if ( v7 )
            {
              v59 = (CTaskComplexStealCar *)CTask::operator new(0x20u);
              CTaskComplexStealCar::CTaskComplexStealCar(v59, (CVehicle *)HIDWORD(v6));
              goto LABEL_73;
            }
            v61 = (CTaskComplexDragPedFromCar *)CTask::operator new(0x54u);
            CTaskComplexDragPedFromCar::CTaskComplexDragPedFromCar(v61, 0, 0);
            CTaskComplexSequence::AddTask(v44, v61);
            v59 = (CTaskComplexStealCar *)CTask::operator new(0x50u);
LABEL_72:
            CTaskComplexEnterCarAsPassenger::CTaskComplexEnterCarAsPassenger(
              (CTaskComplexEnterCarAsPassenger *)v59,
              (CVehicle *)HIDWORD(v6),
              0,
              0);
LABEL_73:
            CTaskComplexSequence::AddTask(v44, v59);
            if ( !v14 )
              return;
LABEL_61:
            v54 = (CTaskComplexSequence *)CTask::operator new(0x40u);
            CTaskComplexSequence::CTaskComplexSequence(v54);
            CTaskComplexSequence::AddTask(v55, v14);
            CTaskComplexSequence::AddTask(v54, this->m_pTaskEventResponse);
            this->m_pTaskEventResponse = v54;
            return;
          }
          if ( this->m_pPed->CharCreatedBy == 2
            || (v15 = *(char *)(v6 + 1820),
                !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
            || CWeapon::IsTypeMelee((const CWeapon *)(v6 + 28 * v15 + 1444)) )
          {
            v16 = (CTaskComplexSequence *)CTask::operator new(0x40u);
            CTaskComplexSequence::CTaskComplexSequence(v16);
            v62 = (CTaskComplexSequence *)v17;
            this->m_pTaskEventResponse = v17;
            if ( (rand() & 0x3FFu) <= 0x200 )
            {
              v26 = (CTaskSimpleShakeFist *)CTask::operator new(0x18u);
              v56 = rand();
              CTaskSimple::CTaskSimple(v26);
              LOWORD(v26[1]._vptr$CTask) = 0;
              *(_DWORD *)&v26->m_bIsFinished = 0;
              v26->m_pAnim = 0;
              v26->_vptr$CTask = (int (**)(void))&off_665750;
              v26[1].m_pParent = (CTask *)((int)(float)((float)((float)v56 * 0.000015259) * 1000.0) + 500);
              v27 = v62;
            }
            else
            {
              v18 = *(_DWORD *)(v6 + 20);
              v19 = this->m_pPed->m_pMat;
              v20 = (__int64 *)(v18 + 48);
              if ( !v18 )
                v20 = (__int64 *)(v6 + 4);
              p_m_transform = (CSimpleTransform *)&v19->tx;
              v22 = *v20;
              if ( !v19 )
                p_m_transform = &this->m_pPed->m_transform;
              v23 = CGeneral::GetRadianAngleBetweenPoints(
                      *(float *)&v22,
                      *((float *)&v22 + 1),
                      p_m_transform->m_translate.x,
                      p_m_transform->m_translate.y);
              v24 = CGeneral::LimitRadianAngle(v23);
              v25 = (CTaskSimpleAchieveHeading *)CTask::operator new(0x18u);
              CTaskSimpleAchieveHeading::CTaskSimpleAchieveHeading(v25, v24, 0.5, 0.2);
              CTaskComplexSequence::AddTask(v62, v25);
              v26 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
              CTaskSimpleShakeFist::CTaskSimpleShakeFist(v26);
              v27 = v62;
            }
            CTaskComplexSequence::AddTask(v27, v26);
            v57 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
            CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v57, (CPed *)v6, -1, 0, 0, 0, 1);
            v44 = v62;
            CTaskComplexSequence::AddTask(v62, v57);
            if ( this->m_pPed )
              CPed::Say(this->m_pPed, 0x78u, 0, 1.0, 0, 0, 0);
            v58 = (CTaskComplexEnterCarAsDriver *)CTask::operator new(0x50u);
            v59 = (CTaskComplexStealCar *)v58;
            if ( v7 )
            {
              CTaskComplexEnterCarAsDriver::CTaskComplexEnterCarAsDriver(v58, (CVehicle *)HIDWORD(v6));
              goto LABEL_73;
            }
            goto LABEL_72;
          }
        }
        v39 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
        CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
          v39,
          (CEntity *)v6,
          0,
          60.0,
          (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
          (const int)&elf_hash_bucket[187],
          1.0);
LABEL_59:
        this->m_pTaskEventResponse = v38;
        goto LABEL_60;
      }
      if ( v12 == 1003 )
      {
        v41 = (CTaskComplexDestroyCar *)CTask::operator new(0x20u);
        CTaskComplexDestroyCar::CTaskComplexDestroyCar(v41, (CVehicle *)HIDWORD(v6), 0, 0, 0);
        goto LABEL_59;
      }
      if ( v12 != 1105 || !(_DWORD)v6 )
      {
LABEL_60:
        if ( !v14 )
          return;
        goto LABEL_61;
      }
      if ( !CPed::IsPlayer((const CPed *)v6) )
      {
        v53 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
        CTaskComplexKillCriminal::CTaskComplexKillCriminal(v53, (CPed *)v6, 0);
        goto LABEL_59;
      }
LABEL_37:
      v38 = 0;
      goto LABEL_59;
    }
    if ( v12 == 200 )
      goto LABEL_37;
    if ( v12 == 700 )
    {
      v40 = (CTaskComplexEnterCarAsDriver *)CTask::operator new(0x50u);
      if ( v7 )
        CTaskComplexEnterCarAsDriver::CTaskComplexEnterCarAsDriver(v40, (CVehicle *)HIDWORD(v6));
      else
        CTaskComplexEnterCarAsPassenger::CTaskComplexEnterCarAsPassenger(
          (CTaskComplexEnterCarAsPassenger *)v40,
          (CVehicle *)HIDWORD(v6),
          0,
          0);
      goto LABEL_59;
    }
    if ( v12 != 702 )
      goto LABEL_60;
    v63 = (CTaskComplexSequence *)v14;
    v28 = (CTaskComplexSequence *)CTask::operator new(0x40u);
    CTaskComplexSequence::CTaskComplexSequence(v28);
    this->m_pTaskEventResponse = v28;
    if ( (rand() & 0x3FFu) <= 0x200 )
    {
      v37 = (CTaskSimpleShakeFist *)CTask::operator new(0x18u);
      v42 = rand();
      CTaskSimple::CTaskSimple(v37);
      LOWORD(v37[1]._vptr$CTask) = 0;
      *(_DWORD *)&v37->m_bIsFinished = 0;
      v37->m_pAnim = 0;
      v37->_vptr$CTask = (int (**)(void))&off_665750;
      v37[1].m_pParent = (CTask *)((int)(float)((float)((float)v42 * 0.000015259) * 1000.0) + 500);
    }
    else
    {
      v29 = *(_DWORD *)(v6 + 20);
      v30 = this->m_pPed->m_pMat;
      v31 = (__int64 *)(v29 + 48);
      if ( !v29 )
        v31 = (__int64 *)(v6 + 4);
      v32 = (CSimpleTransform *)&v30->tx;
      v33 = *v31;
      if ( !v30 )
        v32 = &this->m_pPed->m_transform;
      v34 = CGeneral::GetRadianAngleBetweenPoints(
              *(float *)&v33,
              *((float *)&v33 + 1),
              v32->m_translate.x,
              v32->m_translate.y);
      v35 = CGeneral::LimitRadianAngle(v34);
      v36 = (CTaskSimpleAchieveHeading *)CTask::operator new(0x18u);
      CTaskSimpleAchieveHeading::CTaskSimpleAchieveHeading(v36, v35, 0.5, 0.2);
      CTaskComplexSequence::AddTask(v28, v36);
      v37 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
      CTaskSimpleShakeFist::CTaskSimpleShakeFist(v37);
    }
    CTaskComplexSequence::AddTask(v28, v37);
    if ( this->m_pPed )
      CPed::Say(this->m_pPed, 0x78u, 0, 1.0, 0, 0, 0);
    if ( v7 )
    {
      v43 = (CTaskComplexStealCar *)CTask::operator new(0x20u);
      CTaskComplexStealCar::CTaskComplexStealCar(v43, (CVehicle *)HIDWORD(v6));
    }
    else
    {
      v52 = (CTaskComplexDragPedFromCar *)CTask::operator new(0x54u);
      CTaskComplexDragPedFromCar::CTaskComplexDragPedFromCar(v52, (CPed *)v6, 0);
      CTaskComplexSequence::AddTask(v28, v52);
      v43 = (CTaskComplexStealCar *)CTask::operator new(0x50u);
      CTaskComplexEnterCarAsPassenger::CTaskComplexEnterCarAsPassenger(
        (CTaskComplexEnterCarAsPassenger *)v43,
        (CVehicle *)HIDWORD(v6),
        0,
        0);
    }
    CTaskComplexSequence::AddTask(v28, v43);
    v14 = (CTaskComplexLeaveCar *)v63;
    if ( v63 )
      goto LABEL_61;
  }
}
// 37EA34: variable 'v10' is possibly undefined
// 37EAE6: variable 'v17' is possibly undefined
// 37EE1A: variable 'v38' is possibly undefined
// 37EE30: variable 'v55' is possibly undefined
// 14: using guessed type int dword_14;
// 30: using guessed type __int16 word_30;
// FC: using guessed type int elf_hash_bucket[16411];
// 665750: using guessed type void *;

//----- (0037F01C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeDamageResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest,
        CTask *pAbortedTaskEventResponse)
{
  int m_iAccumulatedTime; // r9
  int (**v10)(void); // r4
  CTask *m_pMyVehicle; // r2
  CTask *v12; // r3
  unsigned int v13; // r4
  CPed *m_pPed; // r1
  bool v15; // zf
  int v16; // r0
  bool v17; // zf
  CVehicle *v18; // r0
  int32 m_baseVehicleType; // r1
  bool v20; // zf
  int v21; // r4
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v24; // d16
  CTask *m_pParent; // r0
  int (**m_pParent_high)(void); // r1
  int m_pParent_low; // r0
  CEvent *v28; // r0
  bool v29; // zf
  CEvent *v30; // r1
  _BOOL4 v31; // r4
  bool v32; // zf
  bool v33; // zf
  int v34; // r1
  int v35; // r4
  _BOOL4 v36; // r0
  bool v37; // zf
  CTask *ActiveTask; // r0
  CTaskSimpleStealthKill *v39; // r5
  CTask *v40; // r0
  CPed *v41; // r0
  CTaskComplexFallAndGetUp *v42; // r0
  int v43; // r3
  CTask *v44; // r0
  int v45; // r0
  CTask *v46; // r0
  int v47; // r0
  int v48; // r1
  CAnimBlendAssociation *FirstAssociation; // r0
  int v50; // r1
  CTaskSimpleBeHit *v51; // r0
  int v52; // r0
  char v53; // r1
  __int64 v54; // r2
  int (**v55)(void); // r1
  int v56; // r4
  int v57; // r6
  unsigned int v58; // r1
  bool v59; // r11
  _BOOL4 IsPlayer; // r0
  bool v61; // zf
  bool bBeingKilledByStealth; // r4
  CTaskComplexDie *v63; // r0
  CPed *v64; // r2
  CTask *v65; // r0
  CTask *v66; // r0
  CTask *v67; // r0
  CTaskSimpleChoking *v68; // r0
  CTask *v69; // r0
  CTaskComplexFallAndGetUp *v70; // r0
  CEvent *m_pCurrentEventPassive; // r0
  bool v72; // zf
  CEvent *m_pCurrentEventActive; // r1
  _BOOL4 IsSameEventForAI; // r6
  CEntity *v75; // r0
  int v76; // r2
  RpClump_0 *m_pRwObject; // r0
  CAnimBlendAssociation *Association; // r0
  eWeaponType eMeansOfDeath; // [sp+18h] [bp-60h]
  CEventGotKnockedOverByCar dir; // [sp+1Ch] [bp-5Ch] BYREF
  CVector pos; // [sp+30h] [bp-48h] BYREF
  int iFallToDeathDir; // [sp+40h] [bp-38h] BYREF
  bool bOverRailing; // [sp+47h] [bp-31h] BYREF

  if ( !CPed::IsAlive(this->m_pPed) )
    return;
  m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
  if ( *(&pEvent->m_bIsPersistent + 1) )
  {
    v10 = pEvent[2]._vptr$CEvent;
    CEventDamage::ProcessDamage((const CEventDamage *)pEvent, this->m_pPed);
    bOverRailing = 0;
    iFallToDeathDir = 0;
    eMeansOfDeath = (eWeaponType)v10;
    v13 = (unsigned int)v10 - 49;
    if ( v13 <= 1 )
      CInterestingEvents::Add(&g_InterestingEvents, EPedRunOver, this->m_pPed);
    m_pPed = this->m_pPed;
    v16 = *(_DWORD *)&this->m_pPed->m_nPedFlags & 0x100;
    v15 = v16 == 0;
    if ( v16 )
    {
      m_pMyVehicle = (CTask *)m_pPed->m_pMyVehicle;
      v15 = m_pMyVehicle == 0;
    }
    if ( v15 )
      goto LABEL_9;
    v12 = (CTask *)m_pMyVehicle[180]._vptr$CTask;
    v32 = v12 == (CTask *)byte_9;
    if ( v12 != (CTask *)byte_9 )
    {
      m_pMyVehicle = m_pMyVehicle[180].m_pParent;
      v32 = m_pMyVehicle == (CTask *)((char *)&dword_0 + 2);
    }
    if ( v32 )
    {
      if ( (*(&pEvent[2].m_bIsPersistent + 1) & 2) != 0 )
        goto LABEL_48;
      v33 = LOBYTE(pEvent[5]._vptr$CEvent) == 0;
      if ( LOBYTE(pEvent[5]._vptr$CEvent) )
        v33 = !*(&pEvent->m_bIsPersistent + 1);
      if ( !v33 )
        goto LABEL_48;
      if ( m_iAccumulatedTime && (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) == 3 )
        CEventHandler::ComputePersonalityResponseToDamage(this, (CEventDamage *)pEvent, (CEntity *)m_iAccumulatedTime);
    }
    else
    {
LABEL_9:
      m_pMyVehicle = (CTask *)LOBYTE(pEvent[5]._vptr$CEvent);
      v17 = m_pMyVehicle == 0;
      if ( LOBYTE(pEvent[5]._vptr$CEvent) )
      {
        m_pMyVehicle = (CTask *)*((unsigned __int8 *)&pEvent->m_bIsPersistent + 1);
        v17 = m_pMyVehicle == 0;
      }
      if ( !v17 || (m_pMyVehicle = (CTask *)&m_pPed->m_nHealth, m_pPed->m_nHealth < 1.0) )
      {
        if ( !v16 )
          goto LABEL_19;
LABEL_15:
        v18 = m_pPed->m_pMyVehicle;
        if ( !v18 )
          goto LABEL_19;
        m_baseVehicleType = v18->m_baseVehicleType;
        v20 = m_baseVehicleType == 9;
        if ( m_baseVehicleType != 9 )
          v20 = v18->m_vehicleType == 2;
        if ( !v20 )
        {
LABEL_19:
          if ( (unsigned int)(pEvent[3].m_iAccumulatedTime - 191) > 1 )
            goto LABEL_120;
          if ( pTaskActiveSimplest )
          {
            if ( (*((int (__fastcall **)(CTask *))pTaskActiveSimplest->_vptr$CTask + 5))(pTaskActiveSimplest) == 207 )
            {
              if ( pEvent[2]._vptr$CEvent == (int (**)(void))((char *)&dword_34 + 2)
                && (float)(*(float *)&pEvent[4].m_iAccumulatedTime + *(float *)&pEvent[4].m_bIsPersistent) > 20.0 )
              {
                dir._vptr$CEvent = 0;
                dir.m_iAccumulatedTime = 0;
                *(_DWORD *)&dir.m_bIsPersistent = 0x40000000;
                v21 = 10;
                do
                {
                  m_pMat = this->m_pPed->m_pMat;
                  p_tx = (CSimpleTransform *)&m_pMat->tx;
                  if ( !m_pMat )
                    p_tx = &this->m_pPed->m_transform;
                  v24 = *(_QWORD *)&p_tx->m_translate.x;
                  pos.z = p_tx->m_translate.z;
                  *(_QWORD *)&pos.x = v24;
                  pos.x = *(float *)&v24 + (float)((float)((float)rand() * 4.6566e-10) + -0.5);
                  pos.y = pos.y + (float)((float)((float)rand() * 4.6566e-10) + -0.5);
                  Fx_c::AddBlood(&g_fx, &pos, (CVector *)&dir, 10, this->m_pPed->m_lightingFromCollision);
                  --v21;
                }
                while ( v21 );
              }
              m_pParent = pTaskActiveSimplest[2].m_pParent;
              if ( m_pParent
                && *(float *)&m_pParent[3]._vptr$CTask > 0.5
                && *(float *)&m_pParent[3].m_pParent >= 0.0
                && *(float *)&m_pParent[4]._vptr$CTask < *(float *)&m_pParent[2].m_pParent[2]._vptr$CTask )
              {
                m_pParent_high = (int (**)(void))SHIWORD(m_pParent[1].m_pParent);
                m_pParent_low = SLOWORD(m_pParent[5].m_pParent);
                pEvent[3]._vptr$CEvent = m_pParent_high;
                pEvent[3].m_iAccumulatedTime = m_pParent_low;
                *(_QWORD *)&pEvent[3].m_bIsPersistent = 0x3F80000040800000LL;
                goto LABEL_104;
              }
              if ( LOBYTE(pTaskActiveSimplest[1]._vptr$CTask) )
                goto LABEL_89;
            }
            else if ( (*((int (__fastcall **)(CTask *))pTaskActiveSimplest->_vptr$CTask + 5))(pTaskActiveSimplest) == 205 )
            {
              v46 = pTaskActiveSimplest[1].m_pParent;
              if ( v46 && (float)(*(float *)&v46[4]._vptr$CTask / *(float *)&v46[2].m_pParent[2]._vptr$CTask) < 0.5 )
              {
                v47 = LOWORD(v46[5].m_pParent);
                pEvent[3]._vptr$CEvent = 0;
                if ( v47 == 115 )
                {
LABEL_90:
                  v48 = 39;
                  goto LABEL_91;
                }
LABEL_87:
                v48 = 36;
LABEL_91:
                pEvent[3].m_iAccumulatedTime = v48;
                *(_DWORD *)&pEvent[3].m_bIsPersistent = 1082130432;
                pEvent[4]._vptr$CEvent = (int (**)(void))1065353216;
                goto LABEL_106;
              }
              if ( !LOBYTE(pTaskActiveSimplest[1]._vptr$CTask) )
              {
LABEL_89:
                FirstAssociation = RpAnimBlendClumpGetFirstAssociation((RpClump_0 *)this->m_pPed->m_pRwObject, 0x800u);
                pEvent[3]._vptr$CEvent = 0;
                if ( FirstAssociation )
                  goto LABEL_90;
                goto LABEL_87;
              }
            }
          }
          m_pParent_low = pEvent[3].m_iAccumulatedTime;
LABEL_104:
          if ( (unsigned int)(m_pParent_low - 191) <= 1 )
            CEventDamage::ComputeDeathAnim((CEventDamage *)pEvent, this->m_pPed, 0);
LABEL_106:
          v55 = pEvent[2]._vptr$CEvent;
          v56 = 0;
          v57 = 0;
          v15 = v55 == (int (**)(void))((char *)&dword_24 + 2);
          v58 = (unsigned int)v55 - 22;
          if ( !v15 )
            v56 = 1;
          v59 = 0;
          if ( v58 > 0xB )
            v57 = 1;
          IsPlayer = CPed::IsPlayer(this->m_pPed);
          if ( !m_iAccumulatedTime )
            goto LABEL_123;
          v61 = !IsPlayer;
          if ( !IsPlayer )
            v61 = (v56 & v57) == 0;
          if ( !v61 )
          {
LABEL_123:
            if ( pTaskActive )
              goto LABEL_124;
LABEL_121:
            bBeingKilledByStealth = 0;
LABEL_127:
            v63 = (CTaskComplexDie *)CTask::operator new(0x28u);
            CTaskComplexDie::CTaskComplexDie(
              v63,
              eMeansOfDeath,
              (const AssocGroupId)pEvent[3]._vptr$CEvent,
              (const AnimationId)pEvent[3].m_iAccumulatedTime,
              *(const float *)&pEvent[3].m_bIsPersistent,
              *(const float *)&pEvent[4]._vptr$CEvent,
              bBeingKilledByStealth,
              v59,
              iFallToDeathDir,
              bOverRailing);
            v64 = this->m_pPed;
            this->m_pTaskEventResponse = v65;
            CInterestingEvents::Add(&g_InterestingEvents, EPedGotKilled, v64);
            v66 = this->m_pPed->m_pPedIntelligence->m_taskManager.m_tasks[0];
            if ( v66
              && ((*((int (__fastcall **)(CTask *))v66->_vptr$CTask + 5))(v66) != 263
               || (unsigned int)(eMeansOfDeath - 17) > 0x19
               || ((1 << (eMeansOfDeath - 17)) & 0x3000001) == 0) )
            {
              CPedIntelligence::AddTaskPhysResponse(this->m_pPed->m_pPedIntelligence, 0, 0);
            }
            LOBYTE(dir._vptr$CEvent) = 0;
            CEventDamage::ComputeHeadShot((const CEventDamage *)pEvent, (bool *)&dir);
            if ( m_iAccumulatedTime )
              CEventHandler::RegisterKill(
                this->m_pPed,
                (const CEntity *)m_iAccumulatedTime,
                eMeansOfDeath,
                (const bool)dir._vptr$CEvent);
            return;
          }
          if ( (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) != 3 )
          {
            v59 = 0;
            goto LABEL_123;
          }
          if ( CPed::IsPlayer((const CPed *)m_iAccumulatedTime) || *(_BYTE *)(m_iAccumulatedTime + 1096) == 2 )
          {
            v59 = CTaskComplexFallToDeath::CalcFall(this->m_pPed, &iFallToDeathDir, &bOverRailing);
            if ( !pTaskActive )
              goto LABEL_121;
            goto LABEL_124;
          }
LABEL_120:
          v59 = 0;
          if ( !pTaskActive )
            goto LABEL_121;
LABEL_124:
          bBeingKilledByStealth = 0;
          if ( (*((int (__fastcall **)(CTask *))pTaskActive->_vptr$CTask + 5))(pTaskActive) == 1027
            && !LOBYTE(pTaskActive[1]._vptr$CTask) )
          {
            bBeingKilledByStealth = 1;
          }
          goto LABEL_127;
        }
LABEL_48:
        CEventHandler::ComputeKnockOffBikeResponse(this, pEvent, m_pMyVehicle, v12);
        return;
      }
      if ( v16 )
      {
        m_pMyVehicle = (CTask *)(*((unsigned __int8 *)&pEvent[2].m_bIsPersistent + 1) << 30);
        if ( (*(&pEvent[2].m_bIsPersistent + 1) & 2) != 0 )
          goto LABEL_15;
      }
      if ( m_iAccumulatedTime && eMeansOfDeath <= WEAPONTYPE_PARACHUTE )
      {
        if ( !v16 )
        {
          if ( (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) != 3 )
            m_iAccumulatedTime = 0;
          if ( m_iAccumulatedTime )
          {
            if ( CTaskManager::GetActiveTask((const CTaskManager *)(*(int *)((char *)&elf_hash_bucket[209]
                                                                           + m_iAccumulatedTime)
                                                                  + 4)) )
            {
              ActiveTask = CTaskManager::GetActiveTask((const CTaskManager *)(*(int *)((char *)&elf_hash_bucket[209]
                                                                                     + m_iAccumulatedTime)
                                                                            + 4));
              if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 1027 )
              {
                v39 = (CTaskSimpleStealthKill *)CTask::operator new(0x20u);
                v40 = CTaskManager::GetActiveTask((const CTaskManager *)(*(int *)((char *)&elf_hash_bucket[209]
                                                                                + m_iAccumulatedTime)
                                                                       + 4));
                CTaskSimpleStealthKill::CTaskSimpleStealthKill(
                  v39,
                  0,
                  (CPed *)m_iAccumulatedTime,
                  (AssocGroupId)v40[2]._vptr$CTask);
                v41 = this->m_pPed;
                this->m_pTaskPhysResponse = v39;
                CPed::SetPedState(v41, PED_DIE_BY_STEALTH);
                return;
              }
            }
          }
          if ( pEvent[3].m_iAccumulatedTime == 191 )
            CEventDamage::ComputeDamageAnim((CEventDamage *)pEvent, this->m_pPed, 0);
          if ( (unsigned int)(eMeansOfDeath - 17) > 0x19
            || ((1 << (eMeansOfDeath - 17)) & 0x3000001) == 0
            || CPedIntelligence::GetTaskUseGun(*(const CPedIntelligence **)((char *)&elf_hash_bucket[209]
                                                                          + m_iAccumulatedTime))
            && CPedIntelligence::GetTaskUseGun(*(const CPedIntelligence **)((char *)&elf_hash_bucket[209]
                                                                          + m_iAccumulatedTime))->m_nLastCommand == 5 )
          {
            if ( (*(&pEvent[2].m_bIsPersistent + 1) & 2) == 0 )
            {
              v50 = pEvent[3].m_iAccumulatedTime;
              if ( (unsigned int)(v50 - 191) >= 2 )
              {
                if ( (CAnimManager::GetAnimAssociation((AssocGroupId)pEvent[3]._vptr$CEvent, (AnimationId)v50)->m_bitsFlag & 0x400) != 0 )
                {
                  if ( (*(&pEvent[2].m_bIsPersistent + 1) & 4) == 0 )
                  {
                    v76 = pEvent[3].m_iAccumulatedTime;
                    m_pRwObject = (RpClump_0 *)this->m_pPed->m_pRwObject;
                    if ( (v76 & 0xFFFFFFFC) == 28 )
                    {
                      Association = RpAnimBlendClumpGetAssociation(m_pRwObject, pEvent[3].m_iAccumulatedTime);
                      if ( !Association )
                        Association = CAnimManager::AddAnimation(
                                        (RpClump_0 *)this->m_pPed->m_pRwObject,
                                        (AssocGroupId)pEvent[3]._vptr$CEvent,
                                        (AnimationId)pEvent[3].m_iAccumulatedTime);
                      Association->m_fBlendAmount = 0.0;
                      Association->m_fBlendDelta = *(float *)&pEvent[3].m_bIsPersistent;
                    }
                    else
                    {
                      Association = CAnimManager::BlendAnimation(
                                      m_pRwObject,
                                      (AssocGroupId)pEvent[3]._vptr$CEvent,
                                      (AnimationId)v76,
                                      *(float *)&pEvent[3].m_bIsPersistent);
                    }
                    LODWORD(Association->m_fSpeed) = pEvent[4]._vptr$CEvent;
                    CAnimBlendAssociation::SetCurrentTime(Association, 0.0);
                    *(&pEvent[2].m_bIsPersistent + 1) |= 4u;
                  }
                }
                else
                {
                  v51 = (CTaskSimpleBeHit *)CTask::operator new(0x28u);
                  CTaskSimpleBeHit::CTaskSimpleBeHit(
                    v51,
                    (CPed *)m_iAccumulatedTime,
                    (const ePedPieceTypes)pEvent[2].m_iAccumulatedTime,
                    pEvent[2].m_bIsPersistent,
                    (int)(float)(*(float *)&pEvent[4].m_iAccumulatedTime + *(float *)&pEvent[4].m_bIsPersistent));
                  this->m_pTaskPhysResponse = (CTask *)v52;
                  v53 = *(&pEvent[2].m_bIsPersistent + 1);
                  v54 = *(_QWORD *)&pEvent[3]._vptr$CEvent;
                  *(_DWORD *)(v52 + 16) = HIDWORD(v54);
                  *(_DWORD *)(v52 + 20) = v54;
                  *(_BYTE *)(v52 + 13) = (v53 & 4) != 0;
                }
              }
              goto LABEL_141;
            }
            v70 = (CTaskComplexFallAndGetUp *)CTask::operator new(0x18u);
            CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp(
              v70,
              (const AnimationId)pEvent[3].m_iAccumulatedTime,
              (const AssocGroupId)pEvent[3]._vptr$CEvent,
              (int)(float)(1000.0 / (float)((float)this->m_pPed->m_nShootRate / 40.0)));
            goto LABEL_140;
          }
          v67 = this->m_pPed->m_pPedIntelligence->m_taskManager.m_tasks[0];
          if ( !v67 || (*((int (__fastcall **)(CTask *))v67->_vptr$CTask + 5))(v67) != 263 )
          {
            v68 = (CTaskSimpleChoking *)CTask::operator new(0x1Cu);
            CTaskSimpleChoking::CTaskSimpleChoking(v68, (CPed *)m_iAccumulatedTime, eMeansOfDeath == WEAPONTYPE_TEARGAS);
LABEL_140:
            this->m_pTaskPhysResponse = v69;
            goto LABEL_141;
          }
          CTaskSimpleChoking::UpdateChoke(
            (CTaskSimpleChoking *)this->m_pPed->m_pPedIntelligence->m_taskManager.m_tasks[0],
            this->m_pPed,
            (CPed *)m_iAccumulatedTime,
            eMeansOfDeath == WEAPONTYPE_TEARGAS);
        }
LABEL_141:
        m_pCurrentEventPassive = this->m_history.m_pCurrentEventPassive;
        v72 = m_pCurrentEventPassive == 0;
        if ( !m_pCurrentEventPassive )
        {
          m_pCurrentEventPassive = this->m_history.m_pCurrentEventActive;
          v72 = m_pCurrentEventPassive == 0;
        }
        if ( v72
          || (*((int (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 2))(m_pCurrentEventPassive) != 9 )
        {
          IsSameEventForAI = 0;
        }
        else
        {
          m_pCurrentEventActive = this->m_history.m_pCurrentEventPassive;
          if ( !m_pCurrentEventActive )
            m_pCurrentEventActive = this->m_history.m_pCurrentEventActive;
          IsSameEventForAI = CEventDamage::IsSameEventForAI(
                               (CEventDamage *)pEvent,
                               (CEventDamage *)m_pCurrentEventActive);
        }
        if ( !CTaskManager::FindActiveTaskByType(&this->m_pPed->m_pPedIntelligence->m_taskManager, 1006)
          && !CPed::IsPlayer(this->m_pPed)
          && !IsSameEventForAI
          && (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent)
          && (*(_BYTE *)((*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent) + 58) & 7) == 3 )
        {
          v75 = (CEntity *)(*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent);
          CEventHandler::ComputePersonalityResponseToDamage(this, (CEventDamage *)pEvent, v75);
        }
        return;
      }
      if ( m_iAccumulatedTime
        && !v16
        && (unsigned int)(pEvent[3].m_iAccumulatedTime - 191) >= 2
        && v13 <= 5
        && ((1 << v13) & 0x23) != 0 )
      {
        v42 = (CTaskComplexFallAndGetUp *)CTask::operator new(0x18u);
        v43 = 1000;
        if ( this->m_pPed->m_pPlayerData )
          v43 = 500;
        CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp(
          v42,
          (const AnimationId)pEvent[3].m_iAccumulatedTime,
          (const AssocGroupId)pEvent[3]._vptr$CEvent,
          v43);
        this->m_pTaskPhysResponse = v44;
        v45 = *(_BYTE *)(m_iAccumulatedTime + 58) & 7;
        if ( v45 == 3 )
        {
          if ( !(*(unsigned __int8 *)(m_iAccumulatedTime + 1157) << 31) )
            return;
          m_iAccumulatedTime = *(_DWORD *)(m_iAccumulatedTime + 1424);
        }
        else if ( v45 != 2 )
        {
          return;
        }
        if ( m_iAccumulatedTime )
        {
          CEventGotKnockedOverByCar::CEventGotKnockedOverByCar(&dir, (CVehicle *)m_iAccumulatedTime);
          CEventGroup::Add(&this->m_pPed->m_pPedIntelligence->m_eventGroup, (CEvent *)&dir, 0);
          CEventGotKnockedOverByCar::~CEventGotKnockedOverByCar(&dir);
        }
      }
    }
  }
  else
  {
    v28 = this->m_history.m_pCurrentEventPassive;
    v29 = v28 == 0;
    if ( !v28 )
    {
      v28 = this->m_history.m_pCurrentEventActive;
      v29 = v28 == 0;
    }
    if ( v29 || (*((int (__fastcall **)(CEvent *))v28->_vptr$CEvent + 2))(v28) != 9 )
    {
      v31 = 1;
    }
    else
    {
      v30 = this->m_history.m_pCurrentEventPassive;
      if ( !v30 )
        v30 = this->m_history.m_pCurrentEventActive;
      v31 = !CEventDamage::IsSameEventForAI((CEventDamage *)pEvent, (CEventDamage *)v30);
    }
    if ( !CTaskManager::FindActiveTaskByType(&this->m_pPed->m_pPedIntelligence->m_taskManager, 1006) )
    {
      v34 = m_iAccumulatedTime;
      if ( m_iAccumulatedTime )
        v34 = 1;
      v35 = v31 & v34;
      v36 = CPed::IsPlayer(this->m_pPed);
      if ( v35 == 1 )
      {
        v37 = !v36;
        if ( !v36 )
          v37 = (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) == 3;
        if ( v37 )
          CEventHandler::ComputePersonalityResponseToDamage(this, (CEventDamage *)pEvent, (CEntity *)m_iAccumulatedTime);
      }
    }
  }
}
// 37F238: variable 'm_pMyVehicle' is possibly undefined
// 37F266: variable 'v12' is possibly undefined
// 37F3A6: variable 'v44' is possibly undefined
// 37F4EA: variable 'v52' is possibly undefined
// 37F5F0: variable 'v65' is possibly undefined
// 37F6F4: variable 'v69' is possibly undefined
// 0: using guessed type int dword_0;
// 24: using guessed type int dword_24;
// 34: using guessed type int dword_34;
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0037F82C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeDeathResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  bool v5; // r5
  int (**v6)(void); // r6
  CTaskSimpleDead *v7; // r0
  CTask *v8; // r0

  v5 = *(&pEvent->m_bIsPersistent + 1);
  v6 = pEvent[1]._vptr$CEvent;
  v7 = (CTaskSimpleDead *)CTask::operator new(0x10u);
  CTaskSimpleDead::CTaskSimpleDead(v7, (const int)v6, v5);
  this->m_pTaskEventResponse = v8;
}
// 37F848: variable 'v8' is possibly undefined

//----- (0037F850) --------------------------------------------------------
void __fastcall CEventHandler::ComputeDeadPedResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_iAccumulatedTime; // r5
  CPed *m_pPed; // r0
  CMatrix *m_pMat; // r1
  CMatrix *v9; // r2
  unsigned __int64 *p_tx; // r3
  unsigned __int64 *p_m_transform; // r1
  float32x2_t v12; // d8
  float32x2_t v13; // d9
  float32x2_t v14; // d16
  unsigned __int64 v15; // d0
  int v16; // r0
  CTaskSimpleDuck *v17; // r0
  CTask *v18; // r0
  CTaskComplexSmartFleeEntity *v19; // r0
  CTaskComplexInvestigateDeadPed *v20; // r0

  m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    m_pPed = this->m_pPed;
    m_pMat = m_iAccumulatedTime->m_pMat;
    v9 = this->m_pPed->m_pMat;
    p_tx = (unsigned __int64 *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = (unsigned __int64 *)&m_iAccumulatedTime->m_transform;
    p_m_transform = (unsigned __int64 *)&v9->tx;
    v12.n64_u64[0] = *p_tx;
    if ( !v9 )
      p_m_transform = (unsigned __int64 *)&m_pPed->m_transform;
    v13.n64_u64[0] = *p_m_transform;
    if ( CPed::IsPlayer(m_pPed) )
    {
      v14.n64_u64[0] = vsub_f32(v13, v12).n64_u64[0];
      v15 = vmul_f32(v14, v14).n64_u64[0];
      if ( (float)((float)(*(float *)&v15 + *((float *)&v15 + 1)) + 0.0) < 0.5625
        && !CPedIntelligence::GetTaskFighting(this->m_pPed->m_pPedIntelligence)
        && !IKChainManager_c::IsLooking(&g_ikChainMan, this->m_pPed) )
      {
        switch ( TheCamera.Cams[TheCamera.ActiveCam].Mode )
        {
          case 7:
          case 8:
          case 0x10:
          case 0x22:
          case 0x2D:
          case 0x2E:
          case 0x33:
            return;
          default:
            if ( !CCam::GetWeaponFirstPersonOn(&TheCamera.Cams[TheCamera.ActiveCam]) )
              IKChainManager_c::LookAt(
                &g_ikChainMan,
                "CompDeadPedResp",
                this->m_pPed,
                m_iAccumulatedTime,
                500,
                5,
                0,
                1,
                0.25,
                500,
                3,
                0);
            break;
        }
      }
    }
    else
    {
      v16 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      if ( v16 >= 600 )
      {
        if ( v16 == 600 )
        {
          v20 = (CTaskComplexInvestigateDeadPed *)CTask::operator new(0x3Cu);
          CTaskComplexInvestigateDeadPed::CTaskComplexInvestigateDeadPed(v20, m_iAccumulatedTime);
        }
        else
        {
          if ( v16 != 911 )
            return;
          v19 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v19,
            m_iAccumulatedTime,
            1,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
        }
      }
      else if ( v16 == 200 )
      {
        v18 = 0;
      }
      else
      {
        if ( v16 != 427 )
          return;
        v17 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
        CTaskSimpleDuck::CTaskSimpleDuck(v17, 0, 0xFFFFu, -1);
      }
      this->m_pTaskEventResponse = v18;
    }
  }
}
// 37F9FE: variable 'v18' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0037FA44) --------------------------------------------------------
void __fastcall CEventHandler::ComputeVehiclePotentialCollisionResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int m_iAccumulatedTime; // r5
  CPed *m_pPed; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  float32x2_t v9; // d9
  int v10; // r4
  float *v11; // r6
  float xy; // s22
  int v13; // r2
  float x; // s26
  float32x2_t v15; // d12
  float v16; // s28
  CMatrix *v17; // r1
  CSimpleTransform *p_m_transform; // r2
  float *v19; // r3
  float *v20; // r0
  float v21; // s6
  float v22; // s8
  float v23; // s10
  float v24; // s17
  float v25; // s4
  float v26; // s27
  float v27; // s23
  CPed *v28; // r0
  float v29; // s0
  CMatrix *v30; // r1
  float *p_x; // r4
  float v32; // s20
  float v33; // s31
  float v34; // s29
  float v35; // s16
  float v36; // s21
  float v37; // s0
  CPlayerPed *v38; // r6
  eWeaponType m_eWeaponType; // r0
  CTaskSimpleShakeFist *v40; // r0
  CTaskSimple *v41; // r0
  float v42; // s2
  float v43; // s0
  float v44; // s6
  float v45; // s4
  float v46; // s8
  float v47; // s2
  CPedIntelligence *m_pPedIntelligence; // r1
  CEvent *m_pCurrentEventPassive; // r0
  int v50; // r0
  float v51; // s16
  CTaskComplexFleeEntity *v52; // r0
  CTask *v53; // r0
  unsigned __int64 v54; // d6
  float v55; // s0
  int v56; // r0
  CMatrix *v57; // r3
  CSimpleTransform *v58; // r5
  float RadianAngleBetweenPoints; // r0
  CTaskSimpleShakeFist *v60; // r0
  CTaskComplexEvasiveStep *v61; // r0
  int v62; // r0
  CMatrix *v63; // r3
  CSimpleTransform *v64; // r5
  float v65; // r0
  float v66; // r1
  CMatrix *v67; // r0
  CTaskComplexEvasiveDiveAndGetUp *v68; // r0
  CTaskComplexSequence *v69; // r8
  int v70; // r0
  CMatrix *v71; // r3
  CSimpleTransform *v72; // r5
  float v73; // r0
  float v74; // r4
  CTaskSimpleAchieveHeading *v75; // r5
  CTaskSimpleShakeFist *v76; // r4
  CTaskSimpleRunTimedAnim *v77; // r0
  int v78; // r0
  CMatrix *v79; // r3
  CSimpleTransform *v80; // r4
  float v81; // r0
  float v82; // r6
  CTaskSimpleAchieveHeading *v83; // r0
  CPed *v84; // r2
  CTask *v85; // r0
  float v86; // [sp+24h] [bp-FCh]
  float32x2_t v87; // [sp+28h] [bp-F8h]
  float v88[3]; // [sp+34h] [bp-ECh] BYREF
  float v89[3]; // [sp+40h] [bp-E0h] BYREF
  CVector vMoveDir; // [sp+4Ch] [bp-D4h] BYREF
  float out_ds[4]; // [sp+58h] [bp-C8h] BYREF
  CVector out_normals; // [sp+68h] [bp-B8h] BYREF
  CVector corners; // [sp+98h] [bp-88h] BYREF
  float v94; // [sp+A4h] [bp-7Ch]
  float v95; // [sp+A8h] [bp-78h]
  float v96; // [sp+ACh] [bp-74h]
  float v97; // [sp+B0h] [bp-70h]
  float v98; // [sp+B4h] [bp-6Ch]
  float v99; // [sp+B8h] [bp-68h]
  float v100; // [sp+BCh] [bp-64h]
  float v101; // [sp+C0h] [bp-60h]
  float v102; // [sp+C4h] [bp-5Ch]

  m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
  if ( !m_iAccumulatedTime )
    return;
  m_pPed = this->m_pPed;
  if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
    return;
  m_pMat = m_pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pPed->m_transform;
  v9.n64_u64[0] = *(unsigned __int64 *)&p_tx->m_translate.y;
  v10 = *(_DWORD *)(m_iAccumulatedTime + 20);
  v11 = (float *)(m_iAccumulatedTime + 4);
  v87.n64_u64[0] = *(unsigned __int64 *)&m_pMat->yy;
  xy = m_pMat->xy;
  v13 = m_iAccumulatedTime + 4;
  if ( v10 )
    v13 = v10 + 48;
  x = p_tx->m_translate.x;
  v15.n64_u64[0] = *(unsigned __int64 *)(v13 + 4);
  v16 = *(float *)v13;
  v86 = CModelInfo::ms_modelInfoPtrs[*(__int16 *)(m_iAccumulatedTime + 38)]->m_pColModel->m_boxBound.m_vecMax.x;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxCorners(p_tx->m_translate.z, (CEntity *)m_iAccumulatedTime, &corners);
  v17 = this->m_pPed->m_pMat;
  p_m_transform = (CSimpleTransform *)&v17->tx;
  if ( !v17 )
    p_m_transform = &this->m_pPed->m_transform;
  CPedGeometryAnalyser::ComputeEntityBoundingBoxPlanes(
    p_m_transform->m_translate.z,
    (CEntity *)m_iAccumulatedTime,
    &out_normals,
    out_ds);
  CPedGeometryAnalyser::ComputeMoveDirToAvoidEntity(this->m_pPed, (CEntity *)m_iAccumulatedTime, &vMoveDir);
  v19 = v88;
  v89[2] = (float)(corners.z + v102) * 0.5;
  v89[1] = (float)(corners.y + v101) * 0.5;
  v89[0] = (float)(corners.x + v100) * 0.5;
  v88[0] = (float)(v94 + v97) * 0.5;
  v88[1] = (float)(v95 + v98) * 0.5;
  v88[2] = (float)(v96 + v99) * 0.5;
  v20 = *(float **)(m_iAccumulatedTime + 20);
  v21 = v20[4];
  v22 = v20[5];
  v23 = v20[6];
  v24 = *v20;
  v25 = v23 * *(float *)(m_iAccumulatedTime + 80);
  v26 = v20[1];
  v27 = v20[2];
  v28 = this->m_pPed;
  v29 = (float)(v21 * *(float *)(m_iAccumulatedTime + 72)) + (float)(v22 * *(float *)(m_iAccumulatedTime + 76));
  v30 = this->m_pPed->m_pMat;
  p_x = &v30->tx;
  if ( !v30 )
    p_x = &v28->m_transform.m_translate.x;
  v32 = v29 + v25;
  if ( (float)(v29 + v25) > 0.0 )
    v19 = v89;
  v33 = *p_x - *v19;
  v34 = p_x[1] - v19[1];
  v35 = p_x[2] - v19[2];
  v36 = (float)((float)(v21 * v33) + (float)(v22 * v34)) + (float)(v23 * v35);
  if ( CPed::IsPlayer(v28) )
  {
    v37 = fabsf(v36);
    if ( v37 < 3.0 && v37 > fabsf(v32 * 50.0) )
    {
      v38 = (CPlayerPed *)this->m_pPed;
      if ( this->m_pPed->m_pPlayerData->m_moveBlendRatio < 1.0
        && !IKChainManager_c::IsLooking(&g_ikChainMan, this->m_pPed) )
      {
        CPlayerPed::AnnoyPlayerPed(v38, 0);
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "CompVhclPotCollResp",
          this->m_pPed,
          (CEntity *)m_iAccumulatedTime,
          1500,
          -1,
          0,
          1,
          0.25,
          500,
          3,
          0);
        m_eWeaponType = this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon].m_eWeaponType;
        if ( (unsigned int)m_eWeaponType <= WEAPONTYPE_MICRO_UZI && ((1 << m_eWeaponType) & 0x10C00021) != 0 )
        {
          v40 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
          CTaskSimpleShakeFist::CTaskSimpleShakeFist(v40);
          this->m_pTaskSecondaryPartialAnim = v41;
        }
      }
    }
    return;
  }
  if ( fabsf(v36) < fabsf((float)(v32 * 50.0) * 2.0) )
  {
    v42 = fabsf(v32);
    v43 = (float)rand();
    if ( v42 <= 0.3 )
    {
      if ( v42 <= 0.05 )
        return;
      v44 = 0.7;
      v45 = 0.02;
      v46 = 0.05;
      v47 = 0.1;
    }
    else
    {
      v44 = 0.175;
      v45 = 0.05;
      v46 = 0.1;
      v47 = 0.2;
    }
    v54 = vmul_f32(vsub_f32(v15, v9), v87).n64_u64[0];
    v55 = (float)(v43 * 4.6566e-10) + 0.0;
    if ( (float)((float)((float)((float)(v16 - x) * xy) + *(float *)&v54) + *((float *)&v54 + 1)) <= 0.0 )
    {
      if ( v55 > v46 && !*(_DWORD *)(m_iAccumulatedTime + 1316) )
      {
        v53 = 0;
        goto LABEL_65;
      }
      if ( v55 > v45 )
        goto LABEL_47;
    }
    else
    {
      if ( fabsf((float)((float)(v33 * v24) + (float)(v34 * v26)) + (float)(v35 * v27)) > (float)(v86 - v44) )
      {
        if ( v55 < (float)(v47 * 0.5) )
        {
          v56 = *(_DWORD *)(m_iAccumulatedTime + 20);
          v57 = this->m_pPed->m_pMat;
          if ( v56 )
            v11 = (float *)(v56 + 48);
          v58 = (CSimpleTransform *)&v57->tx;
          if ( !v57 )
            v58 = &this->m_pPed->m_transform;
          RadianAngleBetweenPoints = CGeneral::GetRadianAngleBetweenPoints(
                                       *v11,
                                       v11[1],
                                       v58->m_translate.x,
                                       v58->m_translate.y);
          this->m_pPed->m_fDesiredHeading = CGeneral::LimitRadianAngle(RadianAngleBetweenPoints);
          v60 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
          CTaskSimpleShakeFist::CTaskSimpleShakeFist(v60);
          goto LABEL_65;
        }
LABEL_47:
        v61 = (CTaskComplexEvasiveStep *)CTask::operator new(0x1Cu);
        CTaskComplexEvasiveStep::CTaskComplexEvasiveStep(v61, (CEntity *)m_iAccumulatedTime, &vMoveDir);
        goto LABEL_65;
      }
      if ( v55 < v47 )
      {
        v62 = *(_DWORD *)(m_iAccumulatedTime + 20);
        v63 = this->m_pPed->m_pMat;
        if ( v62 )
          v11 = (float *)(v62 + 48);
        v64 = (CSimpleTransform *)&v63->tx;
        if ( !v63 )
          v64 = &this->m_pPed->m_transform;
        v65 = CGeneral::GetRadianAngleBetweenPoints(*v11, v11[1], v64->m_translate.x, v64->m_translate.y);
        v66 = CGeneral::LimitRadianAngle(v65);
        this->m_pPed->m_fDesiredHeading = v66;
        this->m_pPed->m_fCurrentHeading = v66;
        v67 = this->m_pPed->m_pMat;
        if ( v67 )
          CMatrix::SetRotateZOnly(v67, v66);
        else
          this->m_pPed->m_transform.m_heading = v66;
        v77 = (CTaskSimpleRunTimedAnim *)CTask::operator new(0x34u);
        CTaskSimpleRunTimedAnim::CTaskSimpleRunTimedAnim(
          v77,
          ANIM_STD_PED,
          ANIM_STD_HANDSUP,
          4.0,
          -4.0,
          3000,
          413,
          "HandsUp",
          0);
        v53->_vptr$CTask = (int (**)(void))&off_6657F0;
        goto LABEL_65;
      }
    }
    v68 = (CTaskComplexEvasiveDiveAndGetUp *)CTask::operator new(0x24u);
    CTaskComplexEvasiveDiveAndGetUp::CTaskComplexEvasiveDiveAndGetUp(
      v68,
      (CVehicle *)m_iAccumulatedTime,
      0,
      &vMoveDir,
      1);
    goto LABEL_65;
  }
  if ( *(unsigned __int8 *)(m_iAccumulatedTime + 58) <= 7u && this->m_pPed->CharCreatedBy == 1 )
  {
    m_pPedIntelligence = this->m_pPed->m_pPedIntelligence;
    m_pCurrentEventPassive = m_pPedIntelligence->m_eventHandler.m_history.m_pCurrentEventPassive;
    if ( !m_pCurrentEventPassive )
      m_pCurrentEventPassive = m_pPedIntelligence->m_eventHandler.m_history.m_pCurrentEventActive;
    if ( *(_DWORD *)(m_iAccumulatedTime + 1316)
      && (!m_pCurrentEventPassive
       || (*((int (__fastcall **)(CEvent *))m_pCurrentEventPassive->_vptr$CEvent + 2))(m_pCurrentEventPassive) != 12) )
    {
      v50 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 1000.0);
      if ( v50 <= 24 )
      {
        if ( this->m_pPed->m_nPedType != 6 )
        {
          v51 = (float)((float)(unsigned __int16)rand() * 0.000015259) * 500.0;
          v52 = (CTaskComplexFleeEntity *)CTask::operator new(0x3Cu);
          CTaskComplexFleeEntity::CTaskComplexFleeEntity(
            v52,
            (CEntity *)m_iAccumulatedTime,
            0,
            60.0,
            (int)v51 + 750,
            (const int)&elf_hash_bucket[187],
            1.0);
LABEL_65:
          this->m_pTaskEventResponse = v53;
          return;
        }
        goto LABEL_58;
      }
      if ( v50 <= 99 )
      {
LABEL_58:
        v69 = (CTaskComplexSequence *)CTask::operator new(0x40u);
        CTaskComplexSequence::CTaskComplexSequence(v69);
        this->m_pTaskEventResponse = v69;
        v70 = *(_DWORD *)(m_iAccumulatedTime + 20);
        v71 = this->m_pPed->m_pMat;
        if ( v70 )
          v11 = (float *)(v70 + 48);
        v72 = (CSimpleTransform *)&v71->tx;
        if ( !v71 )
          v72 = &this->m_pPed->m_transform;
        v73 = CGeneral::GetRadianAngleBetweenPoints(*v11, v11[1], v72->m_translate.x, v72->m_translate.y);
        v74 = CGeneral::LimitRadianAngle(v73);
        v75 = (CTaskSimpleAchieveHeading *)CTask::operator new(0x18u);
        CTaskSimpleAchieveHeading::CTaskSimpleAchieveHeading(v75, v74, 0.5, 0.2);
        CTaskComplexSequence::AddTask(v69, v75);
        v76 = (CTaskSimpleShakeFist *)CTask::operator new(0x10u);
        CTaskSimpleShakeFist::CTaskSimpleShakeFist(v76);
        CTaskComplexSequence::AddTask(v69, v76);
        return;
      }
      if ( v50 > 199 )
      {
        if ( v50 < 400 )
          IKChainManager_c::LookAt(
            &g_ikChainMan,
            "CompVehiclePotCollResp",
            this->m_pPed,
            (CEntity *)m_iAccumulatedTime,
            1300,
            -1,
            0,
            1,
            0.25,
            500,
            3,
            0);
      }
      else
      {
        v78 = *(_DWORD *)(m_iAccumulatedTime + 20);
        v79 = this->m_pPed->m_pMat;
        if ( v78 )
          v11 = (float *)(v78 + 48);
        v80 = (CSimpleTransform *)&v79->tx;
        if ( !v79 )
          v80 = &this->m_pPed->m_transform;
        v81 = CGeneral::GetRadianAngleBetweenPoints(*v11, v11[1], v80->m_translate.x, v80->m_translate.y);
        v82 = CGeneral::LimitRadianAngle(v81);
        v83 = (CTaskSimpleAchieveHeading *)CTask::operator new(0x18u);
        CTaskSimpleAchieveHeading::CTaskSimpleAchieveHeading(v83, v82, 0.5, 0.2);
        v84 = this->m_pPed;
        this->m_pTaskEventResponse = v85;
        IKChainManager_c::LookAt(
          &g_ikChainMan,
          "CompVehiclePotCollResp",
          v84,
          (CEntity *)m_iAccumulatedTime,
          1300,
          -1,
          0,
          1,
          0.25,
          500,
          3,
          0);
      }
    }
  }
}
// 37FCD8: variable 'v41' is possibly undefined
// 38004E: variable 'v53' is possibly undefined
// 3800BC: variable 'v85' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 6657F0: using guessed type void *;
// 37FA44: using guessed type float out_ds[4];

//----- (003801C0) --------------------------------------------------------
void __fastcall CEventHandler::ComputeVehiclePotentialPassiveCollisionResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v4; // r8
  const CVehicle *m_iAccumulatedTime; // r5
  bool v9; // zf
  int IsGoToTask; // r0
  bool v11; // zf
  CPedGroup *PedsGroup; // r10
  bool bGoingForDoor; // r4
  CTaskComplexWalkRoundCar *v14; // r0
  CTask *v15; // r0

  m_iAccumulatedTime = (const CVehicle *)pEvent[1].m_iAccumulatedTime;
  v9 = m_iAccumulatedTime == 0;
  if ( m_iAccumulatedTime )
    v9 = pTaskActiveSimplest == 0;
  if ( !v9 && (*(_DWORD *)&this->m_pPed->m_nPedFlags & 0x100) == 0 )
  {
    IsGoToTask = CTask::IsGoToTask(pTaskActiveSimplest);
    v11 = IsGoToTask == 0;
    if ( IsGoToTask )
    {
      v4 = *(_DWORD *)&pEvent[1].m_bIsPersistent;
      v11 = v4 == 1;
    }
    if ( !v11 )
    {
      PedsGroup = CPedGroups::GetPedsGroup(this->m_pPed);
      bGoingForDoor = CPedIntelligence::IsPedGoingForCarDoor(this->m_pPed->m_pPedIntelligence);
      v14 = (CTaskComplexWalkRoundCar *)CTask::operator new(0x58u);
      if ( PedsGroup )
        v4 = 6;
      CTaskComplexWalkRoundCar::CTaskComplexWalkRoundCar(
        v14,
        v4,
        (const CVector *)&pTaskActiveSimplest[1].m_pParent,
        m_iAccumulatedTime,
        bGoingForDoor,
        0);
      this->m_pTaskEventResponse = v15;
    }
  }
}
// 380232: variable 'v4' is possibly undefined
// 380236: variable 'v15' is possibly undefined

//----- (00380244) --------------------------------------------------------
void __fastcall CEventHandler::ComputeShotFiredResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int m_iAccumulatedTime; // r5
  int v6; // r0
  bool v7; // zf
  int v8; // r6
  CTaskComplexKillCriminal *v9; // r0
  CTask *v10; // r0
  CTaskSimpleDuck *v11; // r0
  uint16 v12; // r2
  CTaskComplexTurnToFaceEntityOrCoord *v13; // r0
  CVehicle *m_pMyVehicle; // r0
  CTaskComplexCarDriveMission *v15; // r0
  CPed *m_pPed; // r0
  int v17; // r6
  const CVehicle *IsTypeMelee; // r0
  CTaskComplexKillPedOnFoot *v19; // r0
  CTaskComplexKillPedOnFootStealth *v20; // r0
  CTaskComplexSmartFleeEntity *v21; // r0
  CTaskComplexSmartFleeEntity *v22; // r0
  CVehicle *v23; // r1
  CPed *v24; // r1
  int m_nPedFlags; // r2
  bool v26; // zf
  CTaskComplexSmartFleeEntity *v27; // r0
  CTask *v28; // r0
  CVehicle *v29; // r0
  bool v30; // zf

  m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
  if ( !m_iAccumulatedTime )
    return;
  v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v6 <= 910 )
  {
    if ( v6 > 426 )
    {
      if ( v6 != 427 )
      {
        if ( v6 != 726 )
          return;
        m_pMyVehicle = this->m_pPed->m_pMyVehicle;
        if ( m_pMyVehicle && CVehicle::IsDriver(m_pMyVehicle, this->m_pPed) )
          goto LABEL_28;
        v22 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
        v23 = this->m_pPed->m_pMyVehicle;
        goto LABEL_40;
      }
      v11 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
      v12 = -1;
    }
    else
    {
      if ( v6 == 200 )
        goto LABEL_52;
      if ( v6 != 415 || CPedIntelligence::GetTaskDuck(this->m_pPed->m_pPedIntelligence, 1) )
        return;
      v11 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
      v12 = 3000;
    }
    CTaskSimpleDuck::CTaskSimpleDuck(v11, 0, v12, -1);
    goto LABEL_53;
  }
  if ( v6 < 1000 )
  {
    if ( v6 == 911 )
    {
      v21 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
      CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
        v21,
        (CEntity *)m_iAccumulatedTime,
        1,
        60.0,
        (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
        (const int)&elf_hash_bucket[187],
        1.0);
    }
    else
    {
      if ( v6 != 920 )
        return;
      v13 = (CTaskComplexTurnToFaceEntityOrCoord *)CTask::operator new(0x28u);
      CTaskComplexTurnToFaceEntityOrCoord::CTaskComplexTurnToFaceEntityOrCoord(
        v13,
        (CEntity *)m_iAccumulatedTime,
        0.5,
        0.2);
    }
    goto LABEL_53;
  }
  if ( v6 == 1000 )
  {
    if ( (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) != 3 )
      return;
    m_pPed = this->m_pPed;
    if ( *(_DWORD *)(m_iAccumulatedTime + 1436) == this->m_pPed->m_nPedType )
      return;
    if ( m_pPed->CharCreatedBy == 2
      || (v17 = *(char *)(m_iAccumulatedTime + 1820),
          !CWeapon::IsTypeMelee(&m_pPed->m_WeaponSlots[m_pPed->m_nCurrentWeapon]))
      || (IsTypeMelee = (const CVehicle *)CWeapon::IsTypeMelee((const CWeapon *)(m_iAccumulatedTime + 28 * v17 + 1444)),
          IsTypeMelee == (const CVehicle *)((char *)&dword_0 + 1)) )
    {
      v19 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
      CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v19, (CPed *)m_iAccumulatedTime, -1, 0, 0, 0, 1);
      goto LABEL_53;
    }
    v24 = this->m_pPed;
    m_nPedFlags = (int)this->m_pPed->m_nPedFlags;
    v26 = (m_nPedFlags & 0x100) == 0;
    if ( (m_nPedFlags & 0x100) != 0 )
    {
      IsTypeMelee = v24->m_pMyVehicle;
      v26 = IsTypeMelee == 0;
    }
    if ( !v26 )
    {
      if ( CVehicle::IsDriver(IsTypeMelee, v24) )
      {
LABEL_28:
        v15 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
        CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v15, this->m_pPed->m_pMyVehicle, 0, 1, 2, 40.0);
        v10->_vptr$CTask = (int (**)(void))&off_667284;
LABEL_53:
        this->m_pTaskEventResponse = v10;
        return;
      }
      v24 = this->m_pPed;
      m_nPedFlags = (int)this->m_pPed->m_nPedFlags;
    }
    if ( (m_nPedFlags & 0x100) != 0 )
    {
      v29 = v24->m_pMyVehicle;
      v30 = v29 == 0;
      if ( v29 )
        v30 = v29->pDriver == 0;
      if ( !v30 )
      {
LABEL_52:
        v10 = 0;
        goto LABEL_53;
      }
    }
    v22 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
    v23 = (CVehicle *)m_iAccumulatedTime;
LABEL_40:
    CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
      v22,
      v23,
      0,
      60.0,
      (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
      (const int)&elf_hash_bucket[187],
      1.0);
    goto LABEL_53;
  }
  if ( v6 == 1028 )
  {
    v20 = (CTaskComplexKillPedOnFootStealth *)CTask::operator new(0x48u);
    CTaskComplexKillPedOnFootStealth::CTaskComplexKillPedOnFootStealth(v20, (CPed *)m_iAccumulatedTime);
    goto LABEL_53;
  }
  v7 = v6 == 1105;
  if ( v6 == 1105 )
    v7 = (*(_BYTE *)(m_iAccumulatedTime + 58) & 7) == 3;
  if ( v7 && *(_DWORD *)(m_iAccumulatedTime + 1436) != this->m_pPed->m_nPedType )
  {
    if ( !CPed::IsPlayer((const CPed *)m_iAccumulatedTime) )
    {
      if ( this->m_pPed->CharCreatedBy != 2 )
      {
        v8 = *(char *)(m_iAccumulatedTime + 1820);
        if ( CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon])
          && !CWeapon::IsTypeMelee((const CWeapon *)(m_iAccumulatedTime + 28 * v8 + 1444)) )
        {
          v27 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v27,
            (CEntity *)m_iAccumulatedTime,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          this->m_pTaskEventResponse = v28;
          v28[6]._vptr$CTask = (int (**)(void))byte_4;
          return;
        }
      }
      v9 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
      CTaskComplexKillCriminal::CTaskComplexKillCriminal(v9, (CPed *)m_iAccumulatedTime, 0);
      goto LABEL_53;
    }
    goto LABEL_52;
  }
}
// 3803BE: variable 'v10' is possibly undefined
// 380556: variable 'v28' is possibly undefined
// 0: using guessed type int dword_0;
// FC: using guessed type int elf_hash_bucket[16411];
// 667284: using guessed type void *;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;

//----- (00380608) --------------------------------------------------------
void __fastcall CEventHandler::ComputeReviveResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_pPed; // r0
  CEntity::CFlags m_nFlags; // kr00_8
  CPed *v7; // r0
  int v8; // r3
  unsigned int v9; // r2
  int v10; // r5
  CPed *v11; // r0
  int v12; // r3
  int v13; // r2
  int v14; // r5
  CPed *v15; // r0
  int v16; // r2
  unsigned int v17; // r3
  int v18; // r5
  CTaskComplexGetUpAndStandStill *v19; // r0
  CTask *v20; // r0
  CTaskSimple *v21; // r5
  CPed *v22; // r0
  CPedIntelligence *m_pPedIntelligence; // r4
  CTask *v24; // r1
  bool v25; // zf
  CTaskComplexWander *WanderTaskByPedType; // r1

  this->m_pPed->m_nHealth = 100.0;
  m_pPed = this->m_pPed;
  m_nFlags = m_pPed->m_nFlags;
  *(_DWORD *)&m_pPed->m_nFlags = *(_DWORD *)&m_nFlags | 1;
  m_pPed->m_nFlags.bdummy = m_nFlags.bdummy;
  v7 = this->m_pPed;
  v8 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
  v9 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) & 0xFFFFFFEF;
  v10 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
  *(_DWORD *)&v7->m_nPedFlags = this->m_pPed->m_nPedFlags;
  *((_DWORD *)&v7->m_nPedFlags + 1) = v9;
  *((_DWORD *)&v7->m_nPedFlags + 2) = v8;
  *((_DWORD *)&v7->m_nPedFlags + 3) = v10;
  v11 = this->m_pPed;
  v12 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
  v13 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1) & 0x7FFFFFFF;
  v14 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
  *(_DWORD *)&v11->m_nPedFlags = this->m_pPed->m_nPedFlags;
  *((_DWORD *)&v11->m_nPedFlags + 1) = v13;
  *((_DWORD *)&v11->m_nPedFlags + 2) = v12;
  *((_DWORD *)&v11->m_nPedFlags + 3) = v14;
  v15 = this->m_pPed;
  v16 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1);
  v17 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2) & 0xFFFFFEFF;
  v18 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
  *(_DWORD *)&v15->m_nPedFlags = this->m_pPed->m_nPedFlags;
  *((_DWORD *)&v15->m_nPedFlags + 1) = v16;
  *((_DWORD *)&v15->m_nPedFlags + 2) = v17;
  *((_DWORD *)&v15->m_nPedFlags + 3) = v18;
  CPed::SetPedState(this->m_pPed, PED_IDLE);
  *(_DWORD *)&this->m_pPed->m_nPhysicalFlags &= ~0x20000000u;
  CPed::RestartNonPartialAnims(this->m_pPed);
  v19 = (CTaskComplexGetUpAndStandStill *)CTask::operator new(0xCu);
  CTaskComplexGetUpAndStandStill::CTaskComplexGetUpAndStandStill(v19);
  this->m_pTaskEventResponse = v20;
  v21 = (CTaskSimple *)CTask::operator new(0x1Cu);
  CTaskSimple::CTaskSimple(v21);
  LOWORD(v21[3]._vptr$CTask) = 0;
  v21[1]._vptr$CTask = (int (**)(void))(&dword_B0 + 3);
  v21[1].m_pParent = (CTask *)-1;
  v21[2]._vptr$CTask = 0;
  v21[2].m_pParent = 0;
  v21->_vptr$CTask = (int (**)(void))&off_665784;
  v22 = this->m_pPed;
  this->m_pTaskSecondarySay = v21;
  m_pPedIntelligence = v22->m_pPedIntelligence;
  v24 = m_pPedIntelligence->m_taskManager.m_tasks[3];
  v25 = v24 == 0;
  if ( !v24 )
    v25 = m_pPedIntelligence->m_taskManager.m_tasks[4] == 0;
  if ( v25 )
  {
    WanderTaskByPedType = CTaskComplexWander::GetWanderTaskByPedType(v22);
    sub_1951C0(&m_pPedIntelligence->m_taskManager, WanderTaskByPedType, 4, 0);
  }
}
// 3806BC: variable 'v20' is possibly undefined
// B0: using guessed type int dword_B0;
// 665784: using guessed type void *off_665784;

//----- (00380714) --------------------------------------------------------
void __fastcall CEventHandler::ComputeChatPartnerResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int (**v5)(void); // r5
  bool8 v6; // r6
  CTask *v7; // r0
  CTaskComplexPartnerChat *v8; // r0
  CVector targetPos; // [sp+10h] [bp-20h] BYREF

  if ( pEvent )
  {
    v5 = pEvent[1]._vptr$CEvent;
    if ( v5
      && (v6 = *(&pEvent->m_bIsPersistent + 1), !CPedIntelligence::FindTaskByType(
                                                   this->m_pPed->m_pPedIntelligence,
                                                   1204)) )
    {
      rand();
      v8 = (CTaskComplexPartnerChat *)CTask::operator new(0x78u);
      memset(&targetPos, 0, sizeof(targetPos));
      CTaskComplexPartnerChat::CTaskComplexPartnerChat(
        v8,
        "EventChatPartnerResponse",
        (CPed *)v5,
        v6,
        0.5,
        4,
        1,
        0,
        targetPos);
    }
    else
    {
      v7 = 0;
    }
    this->m_pTaskEventResponse = v7;
  }
}
// 38076E: variable 'v7' is possibly undefined

//----- (0038077C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeSexyPedResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_iAccumulatedTime; // r5
  int v6; // r0
  CTaskGangHasslePed *v7; // r0
  CTask *v8; // r0

  m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v6 == 200 )
    {
      v8 = 0;
    }
    else
    {
      if ( v6 != 1212 )
        return;
      v7 = (CTaskGangHasslePed *)CTask::operator new(0x2Cu);
      CTaskGangHasslePed::CTaskGangHasslePed(v7, m_iAccumulatedTime, 0, 10000, 30000);
    }
    this->m_pTaskEventResponse = v8;
  }
}
// 3807B4: variable 'v8' is possibly undefined

//----- (003807BC) --------------------------------------------------------
void __fastcall CEventHandler::ComputeSexyVehicleResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int (**v4)(void); // r4
  CTaskSimpleStandStill *v6; // r0
  CPed *m_pPed; // r2
  CTask *v8; // r0

  v4 = pEvent[1]._vptr$CEvent;
  if ( v4 )
  {
    CInterestingEvents::Add(&g_InterestingEvents, ESexyCar, (CEntity *)v4);
    v6 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
    CTaskSimpleStandStill::CTaskSimpleStandStill(v6, 5000, 0, 0, 8.0);
    m_pPed = this->m_pPed;
    this->m_pTaskEventResponse = v8;
    IKChainManager_c::LookAt(&g_ikChainMan, "CompSexyVhclResp", m_pPed, (CEntity *)v4, 5000, -1, 0, 1, 0.25, 500, 3, 0);
  }
}
// 380808: variable 'v8' is possibly undefined

//----- (00380850) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedToChaseResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int (**v4)(void); // r5
  void *v6; // r6
  char v7; // r2

  v4 = pEvent[1]._vptr$CEvent;
  if ( v4 )
  {
    v6 = CTask::operator new(0x4Cu);
    CTaskComplex::CTaskComplex((CTaskComplex *)v6);
    *((_QWORD *)v6 + 3) = 0x400000003F800000LL;
    *((_QWORD *)v6 + 4) = 0x4000000000000000LL;
    *((_QWORD *)v6 + 2) = 0x3E800007530LL;
    *((_WORD *)v6 + 24) = 0;
    *((_WORD *)v6 + 30) = 0;
    *((_DWORD *)v6 + 10) = 0;
    *((_DWORD *)v6 + 11) = 0;
    *((_DWORD *)v6 + 13) = 0;
    *((_DWORD *)v6 + 14) = 0;
    *((_DWORD *)v6 + 17) = 6;
    v7 = *((_BYTE *)v6 + 72);
    *(_DWORD *)v6 = &off_6656D4;
    *((_DWORD *)v6 + 16) = &off_665710;
    *((_BYTE *)v6 + 72) = v7 & 0xF0 | 3;
    *((_DWORD *)v6 + 3) = v4;
    CEntity::RegisterReference((CEntity *)v4, (CEntity **)v6 + 3);
    this->m_pTaskEventResponse = (CTask *)v6;
  }
}
// 6656D4: using guessed type void *off_6656D4;
// 665710: using guessed type void *off_665710;

//----- (003808E8) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedToFleeResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int (**v4)(void); // r5
  CTaskComplexSmartFleeEntity *v6; // r0
  CTask *v7; // r0

  v4 = pEvent[1]._vptr$CEvent;
  if ( v4 )
  {
    CPed::Say(this->m_pPed, 0x45u, 0, 1.0, 0, 0, 0);
    v6 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
    CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
      v6,
      (CEntity *)v4,
      1,
      100.0,
      -1,
      (const int)&elf_hash_bucket[187],
      1.0);
    this->m_pTaskEventResponse = v7;
  }
}
// 38093C: variable 'v7' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0038094C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeAttractorResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  __int64 v6; // kr00_8
  int v7; // r0
  bool v8; // zf
  int v9; // r0
  const CPedAttractorManager *PedAttractorManager; // r0
  CTaskComplexUseEffect *v11; // r0
  CTask *v12; // r0

  v6 = *(_QWORD *)&pEvent[1].m_iAccumulatedTime;
  v7 = (*((int (__fastcall **)(CEvent *, _DWORD, CTask *, CTask *))pEvent->_vptr$CEvent + 2))(
         pEvent,
         *((_DWORD *)pEvent->_vptr$CEvent + 2),
         pTaskActive,
         pTaskActiveSimplest);
  v8 = HIDWORD(v6) == 0;
  if ( !HIDWORD(v6) )
    v8 = v7 == 27;
  if ( !v8 )
  {
    v9 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v9 == 200 )
      goto LABEL_8;
    if ( v9 != 233 )
      return;
    PedAttractorManager = GetPedAttractorManager();
    if ( !CPedAttractorManager::HasEmptySlot(PedAttractorManager, (const C2dEffect *)v6, (const CEntity *)HIDWORD(v6)) )
    {
LABEL_8:
      v12 = 0;
    }
    else
    {
      v11 = (CTaskComplexUseEffect *)CTask::operator new(0x24u);
      CTaskComplexUseEffect::CTaskComplexUseEffect(v11, (C2dEffect *)v6, (CEntity *)HIDWORD(v6));
    }
    this->m_pTaskEventResponse = v12;
  }
}
// 38099A: variable 'v12' is possibly undefined

//----- (003809A4) --------------------------------------------------------
void __fastcall CEventHandler::ComputePotentialPedCollideResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_iAccumulatedTime; // r5
  int v7; // r8
  int v8; // r0
  CTask *v9; // r0
  CTask *ActiveTaskByType; // r0
  CTask *v11; // r9
  int (**v12)(void); // r11
  int v13; // r10
  CTaskComplexPartnerShove *v14; // r0
  CTask *v15; // r0
  float32x2_t *v16; // r2
  CMatrix *m_pMat; // r3
  float32x2_t *v18; // r1
  CSimpleTransform *p_tx; // r2
  float32x2_t v20; // d16
  float v21; // s2
  unsigned __int64 v22; // d0
  CTaskComplexAvoidOtherPedWhileWandering *v23; // r0
  int v24; // r0
  CVector targetPos; // [sp+8h] [bp-28h] BYREF

  m_iAccumulatedTime = (CPed *)pEvent[2].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    if ( CTask::IsGoToTask(pTaskActiveSimplest) )
      v7 = *(_DWORD *)&pEvent[2].m_bIsPersistent;
    else
      v7 = 4;
    v8 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v8 == 1209 )
    {
      v14 = (CTaskComplexPartnerShove *)CTask::operator new(0x74u);
      memset(&targetPos, 0, sizeof(targetPos));
      CTaskComplexPartnerShove::CTaskComplexPartnerShove(
        v14,
        "CompPotPedCollResp",
        m_iAccumulatedTime,
        1u,
        0.5,
        1,
        targetPos);
LABEL_15:
      this->m_pTaskEventResponse = v9;
      return;
    }
    if ( v8 != 917 )
    {
      if ( v8 != 200 )
        return;
      v9 = 0;
      goto LABEL_15;
    }
    ActiveTaskByType = CTaskManager::FindActiveTaskByType(&this->m_pPed->m_pPedIntelligence->m_taskManager, 1207);
    v11 = ActiveTaskByType;
    if ( v7 >= 5 )
    {
      if ( ActiveTaskByType )
      {
        v12 = ActiveTaskByType[2]._vptr$CTask;
        if ( v12 )
        {
          v13 = v12[273] ? (int)v12[276] : CPedIntelligence::GetMoveStateFromGoToTask((const CPedIntelligence *)v12[272]);
          v15 = CTaskManager::FindActiveTaskByType(&this->m_pPed->m_pPedIntelligence->m_taskManager, 907);
          if ( v13 <= 5 )
          {
            if ( v15 )
            {
              v16 = (float32x2_t *)v12[5];
              m_pMat = this->m_pPed->m_pMat;
              v18 = v16 + 6;
              if ( !v16 )
                v18 = (float32x2_t *)(v12 + 1);
              p_tx = (CSimpleTransform *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = &this->m_pPed->m_transform;
              v20.n64_u64[0] = vsub_f32((float32x2_t)v18->n64_u64[0], *(float32x2_t *)&p_tx->m_translate.x).n64_u64[0];
              v21 = *(float *)&v15[3].m_pParent * *(float *)&v15[3].m_pParent;
              v22 = vmul_f32(v20, v20).n64_u64[0];
              if ( (float)((float)((float)(*(float *)&v22 + *((float *)&v22 + 1)) + 0.0) - v21) < v21 )
                v7 = 4;
            }
          }
        }
      }
    }
    v23 = (CTaskComplexAvoidOtherPedWhileWandering *)CTask::operator new(0x60u);
    CTaskComplexAvoidOtherPedWhileWandering::CTaskComplexAvoidOtherPedWhileWandering(
      v23,
      m_iAccumulatedTime,
      (const CVector *)&pEvent[1].m_iAccumulatedTime,
      v7);
    this->m_pTaskEventResponse = (CTask *)v24;
    if ( v11 )
      *(_BYTE *)(v24 + 92) |= 4u;
  }
}
// 380A42: variable 'v9' is possibly undefined
// 380AD4: variable 'v24' is possibly undefined

//----- (00380B08) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedEnteredVehicleResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CEvent *v4; // r4
  CVehicle *v6; // r5
  CPed *m_iAccumulatedTime; // r6
  bool v8; // zf
  CTaskComplexSmartFleeEntity *v9; // r0
  CTask *v10; // r0
  int v11; // r8
  int v12; // s0
  int v13; // r0
  CTaskComplexLeaveCar *v14; // r0
  CTaskComplexKillCriminal *v15; // r0
  CTaskComplexLeaveCarAndWander *v16; // r0
  CTaskComplexScreamInCarThenLeave *v17; // r0
  int m_nCurrentWeapon; // r4
  CTaskComplexKillPedOnFoot *v19; // r0
  CTaskComplexLeaveCarAndFlee *v20; // r0
  CMatrix *m_pMat; // r1
  const CVector *p_tx; // r2
  CTaskComplexDestroyCar *v23; // r0

  v4 = pEvent;
  v6 = *(CVehicle **)&pEvent[1].m_bIsPersistent;
  if ( v6 )
  {
    m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
    v8 = m_iAccumulatedTime == 0;
    if ( m_iAccumulatedTime )
    {
      pEvent = (CEvent *)this->m_pPed;
      v8 = *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 == 0;
    }
    if ( !v8 )
    {
      CVehicle::IsDriver(*(const CVehicle **)&pEvent[118].m_bIsPersistent, (const CPed *)pEvent);
      if ( v6->pHandling->AnimGroup == 15 )
      {
        v9 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
        CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
          v9,
          m_iAccumulatedTime,
          0,
          60.0,
          (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
          (const int)&elf_hash_bucket[187],
          1.0);
LABEL_7:
        this->m_pTaskEventResponse = v10;
        return;
      }
      CInterestingEvents::Add(&g_InterestingEvents, ECarJacking, v6);
      v11 = (int)v4[2]._vptr$CEvent;
      v12 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 300.0);
      v13 = *((__int16 *)&v4->m_bIsPersistent + 1);
      if ( v13 < 1000 )
      {
        switch ( *((_WORD *)&v4->m_bIsPersistent + 1) )
        {
          case 0x2C0:
            v14 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
            CTaskComplexLeaveCar::CTaskComplexLeaveCar(v14, v6, v11, v12 + 300, 0, 1);
            goto LABEL_7;
          case 0x2C1:
            return;
          case 0x2C2:
            goto LABEL_27;
          case 0x2C3:
            v16 = (CTaskComplexLeaveCarAndWander *)CTask::operator new(0x1Cu);
            CTaskComplexLeaveCarAndWander::CTaskComplexLeaveCarAndWander(v16, v6, v11, v12 + 300, 0);
            goto LABEL_7;
          case 0x2C4:
            if ( CPed::IsPlayer(m_iAccumulatedTime) && CTheScripts::IsPlayerOnAMission() )
              goto LABEL_27;
            v17 = (CTaskComplexScreamInCarThenLeave *)CTask::operator new(0x20u);
            CTaskComplexScreamInCarThenLeave::CTaskComplexScreamInCarThenLeave(v17, v6, v11);
            goto LABEL_7;
          default:
            if ( v13 == 200 )
              goto LABEL_18;
            return;
        }
      }
      switch ( v13 )
      {
        case 1000:
          if ( this->m_pPed->CharCreatedBy == 2
            || (m_nCurrentWeapon = m_iAccumulatedTime->m_nCurrentWeapon,
                !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
            || CWeapon::IsTypeMelee(&m_iAccumulatedTime->m_WeaponSlots[m_nCurrentWeapon]) )
          {
            v19 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
            CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v19, m_iAccumulatedTime, -1, 0, 0, 0, 1);
          }
          else
          {
LABEL_27:
            v20 = (CTaskComplexLeaveCarAndFlee *)CTask::operator new(0x28u);
            m_pMat = v6->m_pMat;
            p_tx = (const CVector *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &v6->m_transform.m_translate;
            CTaskComplexLeaveCarAndFlee::CTaskComplexLeaveCarAndFlee(v20, v6, p_tx, v11, v12 + 300, 0);
          }
          goto LABEL_7;
        case 1003:
          v23 = (CTaskComplexDestroyCar *)CTask::operator new(0x20u);
          CTaskComplexDestroyCar::CTaskComplexDestroyCar(v23, v6, 0, 0, 0);
          goto LABEL_7;
        case 1105:
          if ( CPed::IsPlayer(m_iAccumulatedTime) )
          {
LABEL_18:
            v10 = 0;
          }
          else
          {
            v15 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
            CTaskComplexKillCriminal::CTaskComplexKillCriminal(v15, m_iAccumulatedTime, 0);
          }
          goto LABEL_7;
      }
    }
  }
}
// 380B7A: variable 'v10' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00380D10) --------------------------------------------------------
void __fastcall CEventHandler::ComputeVehicleToStealResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int (**v5)(void); // r5
  CTaskComplexStealCar *v6; // r0
  CTask *v7; // r0

  if ( !(*((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31) )
  {
    v5 = pEvent[1]._vptr$CEvent;
    if ( v5 )
    {
      v6 = (CTaskComplexStealCar *)CTask::operator new(0x20u);
      CTaskComplexStealCar::CTaskComplexStealCar(v6, (CVehicle *)v5);
      this->m_pTaskEventResponse = v7;
    }
  }
}
// 380D34: variable 'v7' is possibly undefined

//----- (00380D38) --------------------------------------------------------
void __fastcall CEventHandler::ComputeKnockOffBikeResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  const CEventDamage *v6; // r0
  CPedDamageResponseCalculator *v7; // r0
  CPed *m_pPed; // r2
  CVehicle *m_pMyVehicle; // r1
  float v10; // s2
  ePedPieceTypes v11; // s0
  int m_bIsPersistent; // r0
  float *p_xx; // r2
  float v14; // s0
  float v15; // s2
  float v16; // s4
  CVehicle *v17; // r0
  float v18; // s2
  ePedPieceTypes v19; // s0
  int v20; // r0
  CPed *v21; // r1
  CMatrix *v22; // r2
  float xx; // s0
  float yx; // s2
  float zx; // s4
  CMatrix *m_pMat; // r2
  __int64 v27; // d16
  RwReal zy; // r2
  CMatrix *v29; // r2
  CMatrix *v30; // r2
  __int64 v31; // d16
  RwReal v32; // r2
  CMatrix *v33; // r2
  int v34; // r6
  int v35; // r9
  CPed *v36; // r2
  CPed *v37; // r0
  bool v38; // zf
  _BOOL4 v39; // r0
  CPed *v40; // r1
  AnimationId v41; // r8
  CPed *v42; // r1
  CPed *v43; // r0
  int v44; // r2
  int v45; // r3
  int v46; // r4
  CPed *v47; // r0
  int v48; // r2
  int v49; // r3
  int v50; // r4
  CTaskComplexInAirAndLand *v51; // r0
  CTask *v52; // r0
  CTaskComplexFallAndGetUp *v53; // r0
  CPed *v54; // r1
  CTask *v55; // r0
  CPedGroup *PedsGroup; // r0
  CPedGroup *v57; // r8
  _BOOL4 IsLeader; // r0
  bool v59; // zf
  CEventEditableResponse *v60; // r4
  CTaskComplexDie *v61; // r0
  unsigned int m_iAccumulatedTime_low; // r0
  CTaskComplexDie *v63; // r0
  CPed *v64; // r1
  CTask *v65; // r0
  int v66; // r2
  int v67; // r3
  int v68; // r5
  CPed *Leader; // r0
  bool v70; // zf
  CTaskComplexSequence *v71; // r4
  CTaskComplexSequence *v72; // r0
  CTaskComplexEnterCarAsPassenger *v73; // r8
  CPed *v74; // r0
  int v75; // r2
  int v76; // r3
  int v77; // r4
  int (**v78)(void); // r2
  CVector vecNorm; // [sp+20h] [bp-B8h] BYREF
  CPedDamageResponseCalculator v80; // [sp+30h] [bp-A8h] BYREF
  CEventDamage v81; // [sp+44h] [bp-94h] BYREF
  CEventKnockOffBike v82; // [sp+84h] [bp-54h] BYREF

  CEventKnockOffBike::CEventKnockOffBike(&v82);
  if ( (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) != 8 )
  {
    if ( (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 9 )
    {
      m_pPed = this->m_pPed;
      m_pMyVehicle = this->m_pPed->m_pMyVehicle;
      v10 = m_pMyVehicle->m_vecMoveSpeed.x * 0.75;
      *(float *)&v11 = m_pMyVehicle->m_vecMoveSpeed.z * 0.75;
      v80.m_fRawDamage = m_pMyVehicle->m_vecMoveSpeed.y * 0.75;
      *(float *)&v80.m_pInflictor = v10;
      v80.m_eHitZone = v11;
      m_bIsPersistent = pEvent[2].m_bIsPersistent;
      if ( m_bIsPersistent == 2 )
      {
        m_pMat = m_pPed->m_pMat;
        v27 = *(_QWORD *)&m_pMat->xy;
        zy = m_pMat->zy;
      }
      else
      {
        if ( m_bIsPersistent != 1 )
        {
          p_xx = &m_pPed->m_pMat->xx;
          if ( pEvent[2].m_bIsPersistent )
          {
            v14 = *p_xx;
            v15 = p_xx[1];
            v16 = p_xx[2];
          }
          else
          {
            v14 = p_xx[4];
            v15 = p_xx[5];
            v16 = p_xx[6];
          }
          vecNorm.y = -v15;
          vecNorm.x = -v14;
          vecNorm.z = -v16;
          goto LABEL_21;
        }
        v29 = m_pPed->m_pMat;
        v27 = *(_QWORD *)&v29->xx;
        zy = v29->zx;
      }
      vecNorm.z = zy;
      *(_QWORD *)&vecNorm.x = v27;
LABEL_21:
      CEventKnockOffBike::CEventKnockOffBike(
        (CEventKnockOffBike *)&v81,
        m_pMyVehicle,
        (const CVector *)&v80,
        &vecNorm,
        50.0,
        0.0,
        (eWeaponType)pEvent[2]._vptr$CEvent,
        m_bIsPersistent,
        0,
        0,
        0,
        0);
LABEL_28:
      pEvent = &v82;
      CEventKnockOffBike::operator=(&v82, (const CEventKnockOffBike *)&v81);
      CEventKnockOffBike::~CEventKnockOffBike((CEventKnockOffBike *)&v81);
      goto LABEL_29;
    }
    if ( (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) != 35 )
      (*((void (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent);
    v17 = this->m_pPed->m_pMyVehicle;
    v18 = v17->m_vecMoveSpeed.x * 0.75;
    *(float *)&v19 = v17->m_vecMoveSpeed.z * 0.75;
    v80.m_fRawDamage = v17->m_vecMoveSpeed.y * 0.75;
    *(float *)&v80.m_pInflictor = v18;
    v80.m_eHitZone = v19;
    v20 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 4.0);
    if ( v20 == 2 )
    {
      v21 = this->m_pPed;
      v30 = this->m_pPed->m_pMat;
      v31 = *(_QWORD *)&v30->xy;
      v32 = v30->zy;
    }
    else
    {
      if ( v20 != 1 )
      {
        v21 = this->m_pPed;
        v22 = this->m_pPed->m_pMat;
        if ( v20 )
        {
          xx = v22->xx;
          yx = v22->yx;
          zx = v22->zx;
        }
        else
        {
          xx = v22->xy;
          yx = v22->yy;
          zx = v22->zy;
        }
        vecNorm.y = -yx;
        vecNorm.x = -xx;
        vecNorm.z = -zx;
        goto LABEL_27;
      }
      v21 = this->m_pPed;
      v33 = this->m_pPed->m_pMat;
      v31 = *(_QWORD *)&v33->xx;
      v32 = v33->zx;
    }
    vecNorm.z = v32;
    *(_QWORD *)&vecNorm.x = v31;
LABEL_27:
    CEventKnockOffBike::CEventKnockOffBike(
      (CEventKnockOffBike *)&v81,
      v21->m_pMyVehicle,
      (const CVector *)&v80,
      &vecNorm,
      50.0,
      0.0,
      WEAPONTYPE_EXPLOSION,
      v20,
      0,
      0,
      0,
      0);
    goto LABEL_28;
  }
  CEventDamage::CEventDamage(
    &v81,
    *(CEntity **)&pEvent[4].m_bIsPersistent,
    CTimer::m_snTimeInMilliseconds,
    WEAPONTYPE_FALL,
    PED_SPHERE_CHEST,
    2u,
    1,
    0);
  if ( CEventDamage::AffectsPed(v6, this->m_pPed) )
  {
    CPedDamageResponseCalculator::CPedDamageResponseCalculator(
      &v80,
      *(const CEntity **)&pEvent[4].m_bIsPersistent,
      *(const float *)&pEvent[3].m_iAccumulatedTime,
      WEAPONTYPE_FALL,
      PED_SPHERE_CHEST,
      1);
    CPedDamageResponseCalculator::ComputeDamageResponse(v7, this->m_pPed, &v81.m_pedDamageResponse, 1);
    CPedDamageResponseCalculator::~CPedDamageResponseCalculator(&v80);
  }
  CEventDamage::~CEventDamage(&v81);
LABEL_29:
  v34 = *(_DWORD *)&pEvent[4].m_bIsPersistent;
  if ( v34 )
  {
    v35 = *(_DWORD *)&pEvent[3].m_bIsPersistent;
    v36 = this->m_pPed;
    if ( *(CPed **)(v34 + 1124) == this->m_pPed )
      goto LABEL_35;
    v37 = *(CPed **)(v34 + 1128);
    v38 = v37 == v36;
    if ( v37 != v36 )
      v38 = *(_DWORD *)(v34 + 1132) == (_DWORD)v36;
    if ( v38 || *(CPed **)(v34 + 1136) == v36 )
    {
LABEL_35:
      CInterestingEvents::Add(&g_InterestingEvents, EPedKnockedOffBike, v36);
      v39 = CEventKnockOffBike::SetPedSafePosition((CEventKnockOffBike *)pEvent, this->m_pPed);
      v40 = this->m_pPed;
      if ( v39 )
      {
        CEventKnockOffBike::SetPedOutCar((CEventKnockOffBike *)pEvent, v40);
        v41 = CEventKnockOffBike::CalcForcesAndAnims((CEventKnockOffBike *)pEvent, this->m_pPed);
        v42 = this->m_pPed;
        if ( BYTE2(pEvent[4].m_iAccumulatedTime) == 53 )
        {
          *(_DWORD *)&v42->m_nPedFlags &= ~1u;
          v43 = this->m_pPed;
          v44 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1);
          v45 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
          v46 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
          *(_DWORD *)&v43->m_nPedFlags = *(_DWORD *)&this->m_pPed->m_nPedFlags & 0xFFFFFFFD;
          *((_DWORD *)&v43->m_nPedFlags + 1) = v44;
          *((_DWORD *)&v43->m_nPedFlags + 2) = v45;
          *((_DWORD *)&v43->m_nPedFlags + 3) = v46;
          v47 = this->m_pPed;
          v48 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1);
          v49 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
          v50 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
          *(_DWORD *)&v47->m_nPedFlags = *(_DWORD *)&this->m_pPed->m_nPedFlags | 0x200;
          *((_DWORD *)&v47->m_nPedFlags + 1) = v48;
          *((_DWORD *)&v47->m_nPedFlags + 2) = v49;
          *((_DWORD *)&v47->m_nPedFlags + 3) = v50;
          *(_DWORD *)&this->m_pPed->m_nPhysicalFlags |= 0x100u;
          *(_DWORD *)&this->m_pPed->m_nPhysicalFlags |= 0x8000000u;
          if ( this->m_pPed->m_nHealth <= 0.0 )
          {
            v61 = (CTaskComplexDie *)CTask::operator new(0x28u);
            CTaskComplexDie::CTaskComplexDie(
              v61,
              (const eWeaponType)SBYTE2(pEvent[4].m_iAccumulatedTime),
              ANIM_STD_PED,
              v41,
              4.0,
              0.0,
              0,
              0,
              0,
              0);
          }
          else
          {
            v51 = (CTaskComplexInAirAndLand *)CTask::operator new(0x10u);
            CTaskComplexInAirAndLand::CTaskComplexInAirAndLand(v51, 0, 0);
          }
          this->m_pTaskEventResponse = v52;
        }
        else
        {
          if ( v42->m_nHealth <= 0.0 )
          {
            if ( v41 == ANIM_STD_NUM )
            {
              m_iAccumulatedTime_low = SLOBYTE(pEvent[4].m_iAccumulatedTime);
              if ( m_iAccumulatedTime_low > 3 )
                v41 = ANIM_STD_NUM;
              else
                v41 = dword_3812CC[m_iAccumulatedTime_low];
            }
            v63 = (CTaskComplexDie *)CTask::operator new(0x28u);
            CTaskComplexDie::CTaskComplexDie(
              v63,
              (const eWeaponType)SBYTE2(pEvent[4].m_iAccumulatedTime),
              ANIM_STD_PED,
              v41,
              4.0,
              0.0,
              0,
              0,
              0,
              0);
            v64 = this->m_pPed;
            this->m_pTaskEventResponse = v65;
            v66 = *((_DWORD *)&v64->m_nPedFlags + 1);
            v67 = *((_DWORD *)&v64->m_nPedFlags + 2);
            v68 = *((_DWORD *)&v64->m_nPedFlags + 3);
            *(_DWORD *)&v64->m_nPedFlags &= ~1u;
            *((_DWORD *)&v64->m_nPedFlags + 1) = v66;
            *((_DWORD *)&v64->m_nPedFlags + 2) = v67;
            *((_DWORD *)&v64->m_nPedFlags + 3) = v68;
LABEL_67:
            if ( *(_DWORD *)(v34 + 1440) == 9 )
              *(_BYTE *)(v34 + 1576) &= ~0x10u;
            goto LABEL_69;
          }
          if ( BYTE2(pEvent[4].m_iAccumulatedTime) )
          {
            v53 = (CTaskComplexFallAndGetUp *)CTask::operator new(0x18u);
            CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp(v53, v41, ANIM_STD_PED, v35);
            v54 = this->m_pPed;
            this->m_pTaskEventResponse = v55;
            PedsGroup = CPedGroups::GetPedsGroup(v54);
            v57 = PedsGroup;
            if ( PedsGroup )
            {
              IsLeader = CPedGroupMembership::IsLeader(&PedsGroup->m_membership, this->m_pPed);
              v59 = !IsLeader;
              if ( !IsLeader )
                v59 = BYTE1(pEvent[4].m_iAccumulatedTime) << 31 == 0;
              if ( v59 )
              {
                Leader = CPedGroupMembership::GetLeader(&v57->m_membership);
                v70 = Leader == 0;
                if ( Leader )
                  v70 = *((unsigned __int8 *)&Leader->m_nPedFlags + 1) << 31 == 0;
                if ( !v70 && !CEventGroup::GetEventOfType(&Leader->m_pPedIntelligence->m_eventGroup, 8) )
                {
                  v71 = (CTaskComplexSequence *)CTask::operator new(0x40u);
                  CTaskComplexSequence::CTaskComplexSequence(v71);
                  CTaskComplexSequence::AddTask(v72, this->m_pTaskEventResponse);
                  v73 = (CTaskComplexEnterCarAsPassenger *)CTask::operator new(0x50u);
                  CTaskComplexEnterCarAsPassenger::CTaskComplexEnterCarAsPassenger(v73, (CVehicle *)v34, 0, 1);
                  CTaskComplexSequence::AddTask(v71, v73);
                  this->m_pTaskEventResponse = v71;
                }
              }
              else if ( CPedGroupMembership::IsLeader(&v57->m_membership, this->m_pPed) )
              {
                v60 = (CEventEditableResponse *)CEvent::operator new(0x10u);
                CEventEditableResponse::CEventEditableResponse(v60);
                v60->_vptr$CEvent = (int (**)(void))&off_666E98;
                CEventGroupEvent::CEventGroupEvent((CEventGroupEvent *)&v81, this->m_pPed, (CEvent *)v60);
                CPedGroupIntelligence::AddEvent(&v57->m_intelligence, (CEvent *)&v81);
                CEventGroupEvent::~CEventGroupEvent((CEventGroupEvent *)&v81);
              }
            }
            v74 = this->m_pPed;
            v75 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1);
            v76 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
            v77 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 3);
            *(_DWORD *)&v74->m_nPedFlags = *(_DWORD *)&this->m_pPed->m_nPedFlags & 0xFFFFFFFE;
            *((_DWORD *)&v74->m_nPedFlags + 1) = v75;
            *((_DWORD *)&v74->m_nPedFlags + 2) = v76;
            *((_DWORD *)&v74->m_nPedFlags + 3) = v77;
          }
        }
        v78 = pEvent[4]._vptr$CEvent;
        if ( v78 )
        {
          CEventDraggedOutCar::CEventDraggedOutCar(
            (CEventDraggedOutCar *)&v81,
            (const CVehicle *)v34,
            (const CPed *)v78,
            pEvent[4].m_iAccumulatedTime & 0x100);
          CEventGroup::Add(&this->m_pPed->m_pPedIntelligence->m_eventGroup, (CEvent *)&v81, 1);
          if ( *(_DWORD *)(v34 + 1440) == 9 )
            *(_BYTE *)(v34 + 1576) |= 0x10u;
          CEventDraggedOutCar::~CEventDraggedOutCar((CEventDraggedOutCar *)&v81);
          goto LABEL_69;
        }
        goto LABEL_67;
      }
      if ( *((unsigned __int8 *)&v40->m_nPedFlags + 1) << 31 )
        *(_DWORD *)&v40->m_nFlags &= ~1u;
    }
  }
LABEL_69:
  CEventKnockOffBike::~CEventKnockOffBike(&v82);
}
// 380D84: variable 'v6' is possibly undefined
// 380DA8: variable 'v7' is possibly undefined
// 38108C: variable 'v52' is possibly undefined
// 3810D0: variable 'v55' is possibly undefined
// 3811B2: variable 'v65' is possibly undefined
// 381212: variable 'v72' is possibly undefined
// 3812CC: using guessed type int dword_3812CC[4];
// 666E98: using guessed type void *off_666E98;

//----- (003812E0) --------------------------------------------------------
void __fastcall CEventHandler::ComputeGunAimedAtResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_iAccumulatedTime; // r8
  CTaskComplexFleeEntity *v8; // r0
  CTask *v9; // r0
  CTaskComplexSmartFleeEntity *v10; // r0
  CPed *m_pPed; // r0
  int CharCreatedBy; // r1
  bool v13; // zf
  int v14; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v15; // r0
  int v16; // r2
  void **v17; // r1
  CPed *v18; // r1
  CVehicle *m_pMyVehicle; // r0
  CTaskComplexCarDriveMission *v20; // r0
  void **v21; // r1
  _BOOL4 IsTypeMelee; // r0
  CTaskSimpleRunAnim *v23; // r0
  int v24; // r5
  CTaskComplexKillPedOnFoot *v25; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v26; // r0
  CTaskComplexReactToGunAimedAt *v27; // r0
  CTaskComplexFleeAnyMeans *v28; // r0
  CTaskComplexKillPedOnFootStealth *v29; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v30; // r0
  char *v31; // r1
  CTaskSimpleRunTimedAnim *v32; // r0
  CTaskSimpleDuck *v33; // r0
  uint16 v34; // r2
  int m_nCurrentWeapon; // r5
  CTaskComplexKillCriminal *v36; // r0

  m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
  if ( !CPed::IsPlayer(this->m_pPed) )
  {
    if ( pTaskActive )
    {
      if ( (*((int (__fastcall **)(CTask *))pTaskActive->_vptr$CTask + 5))(pTaskActive) == 909
        || (*((int (__fastcall **)(CTask *))pTaskActive->_vptr$CTask + 5))(pTaskActive) == 908 )
      {
        goto LABEL_5;
      }
      if ( (*((int (__fastcall **)(CTask *))pTaskActive->_vptr$CTask + 5))(pTaskActive) == 911
        || (*((int (__fastcall **)(CTask *))pTaskActive->_vptr$CTask + 5))(pTaskActive) == 910 )
      {
        goto LABEL_8;
      }
    }
    m_pPed = this->m_pPed;
    CharCreatedBy = this->m_pPed->CharCreatedBy;
    v13 = CharCreatedBy == 1;
    if ( CharCreatedBy == 1 )
      v13 = *((unsigned __int8 *)&m_pPed->m_nPedFlags + 1) << 31 == 0;
    if ( v13 )
    {
      IsTypeMelee = CWeapon::IsTypeMelee(&m_pPed->m_WeaponSlots[m_pPed->m_nCurrentWeapon]);
      if ( m_iAccumulatedTime )
      {
        if ( !IsTypeMelee
          && CPed::IsPlayer(m_iAccumulatedTime)
          && !CPedIntelligence::IsFriendlyWith(this->m_pPed->m_pPedIntelligence, m_iAccumulatedTime) )
        {
          *((_WORD *)&pEvent->m_bIsPersistent + 1) = 1000;
        }
      }
    }
    v14 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v14 <= 600 )
    {
      if ( v14 >= 262 )
      {
        switch ( *((_WORD *)&pEvent->m_bIsPersistent + 1) )
        {
          case 0x19C:
            v23 = (CTaskSimpleRunAnim *)CTask::operator new(0x20u);
            CTaskSimpleRunAnim::CTaskSimpleRunAnim(v23, ANIM_STD_PED, ANIM_STD_HANDSCOWER, 4.0, 412, "Cower", 0);
            v21 = &`vtable for'CTaskSimpleCower;
            goto LABEL_58;
          case 0x19D:
            v32 = (CTaskSimpleRunTimedAnim *)CTask::operator new(0x34u);
            CTaskSimpleRunTimedAnim::CTaskSimpleRunTimedAnim(
              v32,
              ANIM_STD_PED,
              ANIM_STD_HANDSUP,
              4.0,
              -4.0,
              5000,
              413,
              "HandsUp",
              0);
            v21 = &`vtable for'CTaskSimpleHandsUp;
            goto LABEL_58;
          case 0x19E:
          case 0x1A0:
          case 0x1A1:
          case 0x1A2:
          case 0x1A3:
          case 0x1A4:
          case 0x1A5:
          case 0x1A6:
          case 0x1A7:
          case 0x1A8:
          case 0x1A9:
          case 0x1AA:
            return;
          case 0x19F:
            if ( CPedIntelligence::GetTaskDuck(this->m_pPed->m_pPedIntelligence, 1) )
              return;
            v33 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
            v34 = 5000;
LABEL_63:
            CTaskSimpleDuck::CTaskSimpleDuck(v33, 0, v34, -1);
            goto LABEL_69;
          case 0x1AB:
            v33 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
            v34 = -1;
            goto LABEL_63;
          default:
            if ( v14 != 262 )
              return;
            v30 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
            CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v30, 0);
            v16 = 7;
            v17 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
            goto LABEL_56;
        }
      }
      if ( v14 != 200 )
      {
        if ( v14 == 258 )
        {
          v26 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
          CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v26, 0);
          goto LABEL_69;
        }
        if ( v14 != 261 )
          return;
        v15 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
        CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v15, 0);
        v16 = 6;
        v17 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;
LABEL_56:
        v31 = (char *)*v17;
        v9[1].m_pParent = (CTask *)v16;
LABEL_59:
        v9->_vptr$CTask = (int (**)(void))(v31 + 8);
        goto LABEL_69;
      }
LABEL_48:
      v9 = 0;
      goto LABEL_69;
    }
    if ( v14 > 926 )
    {
      if ( v14 > 1027 )
      {
        if ( v14 == 1028 )
        {
          v29 = (CTaskComplexKillPedOnFootStealth *)CTask::operator new(0x48u);
          CTaskComplexKillPedOnFootStealth::CTaskComplexKillPedOnFootStealth(v29, m_iAccumulatedTime);
          goto LABEL_69;
        }
        if ( v14 != 1105 )
          return;
        if ( !CPed::IsPlayer(m_iAccumulatedTime) )
        {
          if ( this->m_pPed->CharCreatedBy == 2
            || (m_nCurrentWeapon = m_iAccumulatedTime->m_nCurrentWeapon,
                !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
            || CWeapon::IsTypeMelee(&m_iAccumulatedTime->m_WeaponSlots[m_nCurrentWeapon]) )
          {
            v36 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
            CTaskComplexKillCriminal::CTaskComplexKillCriminal(v36, m_iAccumulatedTime, 0);
            goto LABEL_69;
          }
          goto LABEL_5;
        }
        goto LABEL_48;
      }
      if ( v14 != 927 )
      {
        if ( v14 != 1000 )
          return;
        if ( this->m_pPed->CharCreatedBy == 2
          || (v24 = m_iAccumulatedTime->m_nCurrentWeapon,
              !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
          || CWeapon::IsTypeMelee(&m_iAccumulatedTime->m_WeaponSlots[v24]) )
        {
          v25 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
          CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v25, m_iAccumulatedTime, -1, 0, 0, 0, 1);
          goto LABEL_69;
        }
        goto LABEL_5;
      }
    }
    else if ( v14 > 908 )
    {
      if ( v14 == 909 )
      {
LABEL_5:
        v8 = (CTaskComplexFleeEntity *)CTask::operator new(0x3Cu);
        CTaskComplexFleeEntity::CTaskComplexFleeEntity(
          v8,
          m_iAccumulatedTime,
          0,
          60.0,
          (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
          (const int)&elf_hash_bucket[187],
          1.0);
LABEL_69:
        this->m_pTaskEventResponse = v9;
        return;
      }
      if ( v14 != 911 )
        return;
      if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) == 0 || m_iAccumulatedTime->m_nPedType != 6 )
      {
LABEL_8:
        v10 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
        CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
          v10,
          m_iAccumulatedTime,
          0,
          60.0,
          (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
          (const int)&elf_hash_bucket[187],
          1.0);
        goto LABEL_69;
      }
    }
    else
    {
      if ( v14 == 601 )
      {
        v27 = (CTaskComplexReactToGunAimedAt *)CTask::operator new(0x1Cu);
        CTaskComplexReactToGunAimedAt::CTaskComplexReactToGunAimedAt(v27, m_iAccumulatedTime);
        goto LABEL_69;
      }
      if ( v14 != 726 )
        return;
      v18 = this->m_pPed;
      m_pMyVehicle = this->m_pPed->m_pMyVehicle;
      if ( m_pMyVehicle )
      {
        if ( CVehicle::IsDriver(m_pMyVehicle, v18) )
        {
          v20 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
          CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v20, this->m_pPed->m_pMyVehicle, 0, 1, 2, 40.0);
          v21 = &`vtable for'CTaskComplexCarDriveMissionFleeScene;
LABEL_58:
          v31 = (char *)*v21;
          goto LABEL_59;
        }
        v18 = this->m_pPed;
      }
      if ( (*((_DWORD *)&v18->m_nPedFlags + 3) & 0x800) == 0 || m_iAccumulatedTime->m_nPedType != 6 )
        goto LABEL_8;
    }
    v28 = (CTaskComplexFleeAnyMeans *)CTask::operator new(0x54u);
    CTaskComplexFleeAnyMeans::CTaskComplexFleeAnyMeans(
      v28,
      m_iAccumulatedTime,
      1,
      60.0,
      (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
      (const int)&elf_hash_bucket[937],
      (const int)&elf_hash_bucket[937],
      20.0,
      (const int)&elf_hash_bucket[187],
      1.0);
    goto LABEL_69;
  }
}
// 3816C8: variable 'v9' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 676378: using guessed type void *`vtable for'CTaskSimpleCower;
// 676C0C: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
// 676D34: using guessed type void *`vtable for'CTaskSimpleHandsUp;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;
// 678A48: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;

//----- (00381910) --------------------------------------------------------
void __fastcall CEventHandler::ComputeScriptCommandResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_pPed; // r1
  CPedIntelligence *m_pPedIntelligence; // r0
  CTask *v8; // r6
  CTask *v9; // r6
  CPed *v10; // r0
  CTask *v11; // r1
  int v12; // r2
  CPedScriptedTaskRecordData *RecordAssociatedWithEvent; // r0
  CEventScriptCommand *v14; // r5
  CPedScriptedTaskRecordData *v15; // r0

  m_pPed = this->m_pPed;
  m_pPedIntelligence = this->m_pPed->m_pPedIntelligence;
  if ( pEvent[1]._vptr$CEvent == (int (**)(void))((char *)&dword_0 + 3) )
  {
    v8 = m_pPedIntelligence->m_taskManager.m_tasks[3];
    if ( !v8
      || (*((int (__fastcall **)(CTask *, CPed *, int, CEvent *))v8->_vptr$CTask + 7))(
           m_pPedIntelligence->m_taskManager.m_tasks[3],
           m_pPed,
           1,
           pEvent) )
    {
      v9 = (CTask *)(*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 17))(pEvent);
      CTaskManager::ClearTaskEventResponse(&this->m_pPed->m_pPedIntelligence->m_taskManager);
      v10 = this->m_pPed;
      v11 = v9;
      v12 = 3;
      goto LABEL_8;
    }
  }
  else
  {
    v8 = m_pPedIntelligence->m_taskManager.m_tasks[4];
    if ( !v8
      || (*((int (__fastcall **)(CTask *, CPed *, int, CEvent *))v8->_vptr$CTask + 7))(
           m_pPedIntelligence->m_taskManager.m_tasks[4],
           m_pPed,
           1,
           pEvent) )
    {
      v9 = (CTask *)(*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 17))(pEvent);
      CTaskManager::ClearTaskEventResponse(&this->m_pPed->m_pPedIntelligence->m_taskManager);
      v10 = this->m_pPed;
      v11 = v9;
      v12 = 4;
LABEL_8:
      CTaskManager::SetTask(&v10->m_pPedIntelligence->m_taskManager, v11, v12, 1);
      RecordAssociatedWithEvent = CPedScriptedTaskRecord::GetRecordAssociatedWithEvent((CEventScriptCommand *)pEvent);
      if ( RecordAssociatedWithEvent )
        sub_18F988(RecordAssociatedWithEvent, v9);
      return;
    }
  }
  (*((void (__fastcall **)(CTask *, CPed *, _DWORD, CEvent *))v8->_vptr$CTask + 7))(v8, this->m_pPed, 0, pEvent);
  v14 = (CEventScriptCommand *)CEventGroup::Add(&this->m_pPed->m_pPedIntelligence->m_eventGroup, pEvent, 0);
  v15 = CPedScriptedTaskRecord::GetRecordAssociatedWithEvent((CEventScriptCommand *)pEvent);
  if ( v15 )
    sub_18D7FC(v15, v14);
}
// 0: using guessed type int dword_0;

//----- (003819EA) --------------------------------------------------------
void __fastcall CEventHandler::ComputeVehicleDiedResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_pPed; // r0
  bool v6; // zf
  CTask *m_pPedStats; // r2
  bool v8; // zf
  CTaskComplexDie *v9; // r0
  CTask *v10; // r0

  if ( pEvent[1]._vptr$CEvent )
  {
    *(_DWORD *)&this->m_pPed->m_nPhysicalFlags |= 0x20000000u;
    this->m_pPed->m_nHealth = 0.0;
    m_pPed = this->m_pPed;
    v6 = *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 == 0;
    if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
    {
      m_pPed = (CPed *)m_pPed->m_pMyVehicle;
      v6 = m_pPed == 0;
    }
    if ( v6 )
      goto LABEL_10;
    m_pPedStats = (CTask *)m_pPed->m_pPedStats;
    v8 = m_pPedStats == (CTask *)byte_9;
    if ( m_pPedStats != (CTask *)byte_9 )
      v8 = m_pPed->m_WeaponSlots[0].m_eWeaponType == WEAPONTYPE_GOLFCLUB;
    if ( v8 )
    {
      CEventHandler::ComputeKnockOffBikeResponse(this, pEvent, m_pPedStats, pTaskActiveSimplest);
    }
    else
    {
LABEL_10:
      v9 = (CTaskComplexDie *)CTask::operator new(0x28u);
      CTaskComplexDie::CTaskComplexDie(v9, WEAPONTYPE_EXPLOSION, ANIM_STD_PED, ANIM_STD_KO_FRONT, 4.0, 0.0, 0, 0, 0, 0);
      this->m_pTaskEventResponse = v10;
    }
  }
}
// 381A56: variable 'v10' is possibly undefined

//----- (00381A5C) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedFriendResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v6; // r0
  CTask *TaskByType; // r0
  bool v8; // zf
  CTaskComplexUseClosestFreeScriptedAttractor *v9; // r0
  CTask *v10; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v11; // r0
  CTask *v12; // r0
  int v13; // r2
  void **v14; // r1
  CTaskComplexUseClosestFreeScriptedAttractor *v15; // r0
  char *v16; // r1
  CPed *m_iAccumulatedTime; // r5
  CTaskComplexProstituteSolicit *v18; // r0
  CTask *v19; // r0

  v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v6 > 260 )
  {
    if ( v6 == 261 )
    {
      v11 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
      CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v11, 0);
      v13 = 6;
      v14 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;
    }
    else
    {
      if ( v6 != 262 )
      {
        if ( v6 == 1309 )
        {
          TaskByType = CPedIntelligence::FindTaskByType(this->m_pPed->m_pPedIntelligence, 1309);
          v8 = TaskByType == 0;
          if ( !TaskByType )
            v8 = *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 == 0;
          if ( v8 )
          {
            m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
            v18 = (CTaskComplexProstituteSolicit *)CTask::operator new(0x30u);
            CTaskComplexProstituteSolicit::CTaskComplexProstituteSolicit(v18, m_iAccumulatedTime);
            this->m_pTaskEventResponse = v19;
          }
        }
        return;
      }
      v15 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
      CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v15, 0);
      v13 = 7;
      v14 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
    }
    v16 = (char *)*v14;
    v12[1].m_pParent = (CTask *)v13;
    v12->_vptr$CTask = (int (**)(void))(v16 + 8);
    this->m_pTaskEventResponse = v12;
    return;
  }
  if ( v6 == 200 )
  {
    this->m_pTaskEventResponse = 0;
  }
  else if ( v6 == 258 )
  {
    v9 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
    CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v9, 0);
    this->m_pTaskEventResponse = v10;
  }
}
// 381ABC: variable 'v10' is possibly undefined
// 381AE8: variable 'v12' is possibly undefined
// 381B06: variable 'v19' is possibly undefined
// 676C0C: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
// 678A48: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;

//----- (00381B14) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedThreatResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  float32x2_t v4; // d2
  float32x2_t v5; // d3
  CPed *m_iAccumulatedTime; // r5
  int v9; // r0
  CTaskComplexFleeEntity *v10; // r0
  CTask *v11; // r0
  CTaskSimpleRunAnim *v12; // r0
  void **v13; // r1
  int m_iNextEventResponseSequence; // r5
  CTaskComplexUseSequence *v15; // r0
  CTaskComplexKillCriminal *v16; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v17; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v18; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v19; // r0
  CTaskSimpleRunTimedAnim *v20; // r0
  CTaskSimpleDuck *v21; // r0
  CTaskSimpleDuck *v22; // r0
  CTaskComplexFleeAnyMeans *v23; // r0
  CTaskComplexSeekEntityAiming *v24; // r0
  CTaskComplexSmartFleeEntity *v25; // r0
  CTask *m_pTaskEventResponse; // r0
  int m_nCurrentWeapon; // r6
  CPed *m_pPed; // r1
  CTaskSimpleGunControl *v29; // r0
  CPed *v30; // r0
  CVehicle *v31; // r1
  bool v32; // zf
  CWeaponInfo *WeaponInfo; // r0
  CPed *v34; // r1
  CMatrix *m_pMat; // r2
  CMatrix *v36; // r3
  CSimpleTransform *p_tx; // r6
  CSimpleTransform *p_m_transform; // r2
  float x; // s0
  float32x2_t v40; // d16
  CTask *v41; // r6
  CPedIntelligence *m_pPedIntelligence; // r1
  float32x2_t v43; // d16
  float32x2_t v44; // d1
  float v45; // s4
  float v46; // s0
  float v47; // s16
  CTaskSimpleGangDriveBy *v48; // r0
  CTask *v49; // r0
  int v50; // r6
  CTaskComplexKillPedOnFoot *v51; // r0
  int v52; // r6
  CPed *v53; // r0
  int v54; // r2
  int v55; // r3
  int v56; // r1
  CTaskComplexKillPedOnFootStealth *v57; // r0
  int v58; // r6
  int v59; // r6
  CTaskComplexKillPedOnFoot *v60; // r0
  CTaskComplexSequence *v61; // r8
  CTaskComplexKillPedOnFoot *v62; // r6
  CTaskComplexCarDriveWander *v63; // r5
  CVehicle *v64; // r1
  bool v65; // zf
  CTaskComplexLeaveCar *v66; // r0
  CTaskComplexSmartFleeEntity *v67; // r0
  CTask *v68; // r0
  CPed *v69; // r1
  const CVehicle *m_pMyVehicle; // r0
  CTaskComplexCarDriveMission *v71; // r0
  const CVehicle *v72; // r0
  CTaskComplexSmartFleeEntity *v73; // r0

  m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v9 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v9 < 704 )
    {
      switch ( *((_WORD *)&pEvent->m_bIsPersistent + 1) )
      {
        case 0xF4:
          m_iNextEventResponseSequence = this->m_pPed->m_pPedIntelligence->m_iNextEventResponseSequence;
          if ( m_iNextEventResponseSequence >= 0
            && CTaskSequences::ms_taskSequence[m_iNextEventResponseSequence].m_tasks[0] )
          {
            v15 = (CTaskComplexUseSequence *)CTask::operator new(0x1Cu);
            CTaskComplexUseSequence::CTaskComplexUseSequence(v15, m_iNextEventResponseSequence);
            break;
          }
          return;
        case 0xF5:
        case 0xF6:
        case 0xF7:
        case 0xF8:
        case 0xF9:
        case 0xFA:
        case 0xFB:
        case 0xFC:
        case 0xFD:
        case 0xFE:
        case 0xFF:
        case 0x100:
        case 0x101:
        case 0x103:
        case 0x104:
          return;
        case 0x102:
          v17 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
          CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v17, 0);
          break;
        case 0x105:
          v18 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
          CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v18, 0);
          v11[1].m_pParent = (CTask *)&byte_6;
          v13 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;
          goto LABEL_22;
        case 0x106:
          v19 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
          CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v19, 0);
          v11[1].m_pParent = (CTask *)&byte_7;
          v13 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
LABEL_22:
          v11->_vptr$CTask = (int (**)(void))((char *)*v13 + 8);
          break;
        default:
          switch ( *((_WORD *)&pEvent->m_bIsPersistent + 1) )
          {
            case 0x19C:
              v12 = (CTaskSimpleRunAnim *)CTask::operator new(0x20u);
              CTaskSimpleRunAnim::CTaskSimpleRunAnim(v12, ANIM_STD_PED, ANIM_STD_HANDSCOWER, 4.0, 412, "Cower", 0);
              v13 = &`vtable for'CTaskSimpleCower;
              goto LABEL_22;
            case 0x19D:
              v20 = (CTaskSimpleRunTimedAnim *)CTask::operator new(0x34u);
              CTaskSimpleRunTimedAnim::CTaskSimpleRunTimedAnim(
                v20,
                ANIM_STD_PED,
                ANIM_STD_HANDSUP,
                4.0,
                -4.0,
                5000,
                413,
                "HandsUp",
                0);
              v13 = &`vtable for'CTaskSimpleHandsUp;
              goto LABEL_22;
            case 0x19E:
            case 0x1A0:
            case 0x1A1:
            case 0x1A2:
            case 0x1A3:
            case 0x1A4:
            case 0x1A5:
            case 0x1A6:
            case 0x1A7:
            case 0x1A8:
            case 0x1A9:
            case 0x1AA:
              return;
            case 0x19F:
              if ( CPedIntelligence::GetTaskDuck(this->m_pPed->m_pPedIntelligence, 1) )
                return;
              v21 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
              CTaskSimpleDuck::CTaskSimpleDuck(v21, 0, 0x1388u, -1);
              break;
            case 0x1AB:
              v22 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
              CTaskSimpleDuck::CTaskSimpleDuck(v22, 0, 0xFFFFu, -1);
              goto LABEL_66;
            default:
              if ( v9 != 200 )
                return;
LABEL_17:
              v11 = 0;
              break;
          }
          break;
      }
LABEL_66:
      this->m_pTaskEventResponse = v11;
    }
    else
    {
      switch ( *((_WORD *)&pEvent->m_bIsPersistent + 1) )
      {
        case 0x38D:
          v10 = (CTaskComplexFleeEntity *)CTask::operator new(0x3Cu);
          CTaskComplexFleeEntity::CTaskComplexFleeEntity(
            v10,
            m_iAccumulatedTime,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          goto LABEL_66;
        case 0x38E:
        case 0x390:
        case 0x391:
        case 0x392:
        case 0x393:
        case 0x394:
        case 0x395:
        case 0x396:
        case 0x397:
        case 0x398:
        case 0x399:
        case 0x39A:
        case 0x39B:
        case 0x39C:
        case 0x39D:
        case 0x39E:
        case 0x3A0:
        case 0x3A1:
        case 0x3A2:
        case 0x3A3:
        case 0x3A4:
        case 0x3A6:
        case 0x3A7:
        case 0x3A8:
        case 0x3A9:
        case 0x3AA:
        case 0x3AB:
        case 0x3AD:
        case 0x3AE:
        case 0x3AF:
        case 0x3B0:
        case 0x3B1:
        case 0x3B2:
        case 0x3B3:
        case 0x3B4:
        case 0x3B5:
        case 0x3B6:
        case 0x3B7:
        case 0x3B8:
        case 0x3B9:
        case 0x3BA:
        case 0x3BB:
        case 0x3BC:
        case 0x3BD:
        case 0x3BE:
        case 0x3BF:
        case 0x3C0:
        case 0x3C1:
        case 0x3C2:
        case 0x3C3:
        case 0x3C4:
        case 0x3C5:
        case 0x3C6:
        case 0x3C7:
        case 0x3C8:
        case 0x3C9:
        case 0x3CA:
        case 0x3CB:
        case 0x3CC:
        case 0x3CD:
        case 0x3CE:
        case 0x3CF:
        case 0x3D0:
        case 0x3D1:
        case 0x3D2:
        case 0x3D3:
        case 0x3D4:
        case 0x3D5:
        case 0x3D6:
        case 0x3D7:
        case 0x3D8:
        case 0x3D9:
        case 0x3DA:
        case 0x3DB:
        case 0x3DC:
        case 0x3DD:
        case 0x3DE:
        case 0x3DF:
        case 0x3E0:
        case 0x3E1:
        case 0x3E2:
        case 0x3E3:
        case 0x3E4:
        case 0x3E5:
        case 0x3E6:
        case 0x3E7:
        case 0x3E9:
        case 0x3EA:
        case 0x3EB:
        case 0x3EC:
        case 0x3ED:
        case 0x3EE:
        case 0x3EF:
        case 0x3F0:
        case 0x3F1:
        case 0x3F2:
        case 0x3F3:
        case 0x3F4:
        case 0x3F5:
        case 0x3F6:
        case 0x3F7:
        case 0x3F8:
        case 0x3F9:
        case 0x3FA:
        case 0x3FB:
        case 0x3FD:
        case 0x401:
        case 0x402:
        case 0x403:
          return;
        case 0x38F:
          if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) != 0 && m_iAccumulatedTime->m_nPedType == 6 )
            goto LABEL_28;
          v67 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v67,
            m_iAccumulatedTime,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          this->m_pTaskEventResponse = v68;
          if ( (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 2))(pEvent) == 37 )
          {
            m_pTaskEventResponse = this->m_pTaskEventResponse;
LABEL_76:
            m_pTaskEventResponse[6]._vptr$CTask = (int (**)(void))byte_4;
          }
          return;
        case 0x39F:
          goto LABEL_28;
        case 0x3A5:
          v24 = (CTaskComplexSeekEntityAiming *)CTask::operator new(0x18u);
          CTaskComplexSeekEntityAiming::CTaskComplexSeekEntityAiming(v24, m_iAccumulatedTime, 10.0, 5.0);
          goto LABEL_66;
        case 0x3AC:
          v25 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v25,
            m_iAccumulatedTime,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          this->m_pTaskEventResponse = m_pTaskEventResponse;
          goto LABEL_76;
        case 0x3E8:
          if ( this->m_pPed->CharCreatedBy == 2 )
            goto LABEL_65;
          m_nCurrentWeapon = m_iAccumulatedTime->m_nCurrentWeapon;
          if ( !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon])
            || CWeapon::IsTypeMelee(&m_iAccumulatedTime->m_WeaponSlots[m_nCurrentWeapon]) )
          {
            goto LABEL_65;
          }
          m_pPed = this->m_pPed;
          if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) != 0 && m_iAccumulatedTime->m_nPedType == 6 )
            goto LABEL_28;
          if ( (*(_DWORD *)&this->m_pPed->m_nPedFlags & 0x100) != 0 )
          {
            m_pMyVehicle = m_pPed->m_pMyVehicle;
            if ( m_pMyVehicle )
            {
              if ( CVehicle::IsDriver(m_pMyVehicle, m_pPed) )
                goto LABEL_89;
            }
          }
          goto LABEL_93;
        case 0x3FC:
          v29 = (CTaskSimpleGunControl *)CTask::operator new(0x3Cu);
          CTaskSimpleGunControl::CTaskSimpleGunControl(v29, m_iAccumulatedTime, 0, 0, 0, 1, 10000);
          goto LABEL_66;
        case 0x3FE:
          v30 = this->m_pPed;
          if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
          {
            v31 = v30->m_pMyVehicle;
            v32 = v31 == 0;
            if ( v31 )
              v32 = v30 == v31->pDriver;
            if ( !v32
              && CTaskManager::FindActiveTaskByType(&v30->m_pPedIntelligence->m_taskManager, 709)
              && CWeaponInfo::GetWeaponInfo(
                   this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon].m_eWeaponType,
                   1)->m_eFireType == FIRETYPE_INSTANT_HIT )
            {
              WeaponInfo = CWeaponInfo::GetWeaponInfo(
                             this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon].m_eWeaponType,
                             1);
              v34 = this->m_pPed;
              m_pMat = m_iAccumulatedTime->m_pMat;
              v36 = this->m_pPed->m_pMat;
              p_tx = (CSimpleTransform *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = &m_iAccumulatedTime->m_transform;
              p_m_transform = (CSimpleTransform *)&v36->tx;
              x = p_tx->m_translate.x;
              if ( !v36 )
                p_m_transform = &v34->m_transform;
              v40.n64_u64[0] = *(unsigned __int64 *)&p_tx->m_translate.y;
              v41 = 0;
              m_pPedIntelligence = v34->m_pPedIntelligence;
              v43.n64_u64[0] = vsub_f32(v40, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
              v4.n64_u32[0] = LODWORD(m_pPedIntelligence->m_fHearingRange);
              v5.n64_u32[0] = LODWORD(m_pPedIntelligence->m_fSeeingRange);
              v44.n64_u64[0] = vmul_f32(v43, v43).n64_u64[0];
              v45 = vmax_f32(v4, v5).n64_f32[0];
              v5.n64_u32[0] = LODWORD(WeaponInfo->m_fTargetRange);
              v46 = sqrtf(
                      (float)((float)((float)(x - p_m_transform->m_translate.x)
                                    * (float)(x - p_m_transform->m_translate.x))
                            + v44.n64_f32[0])
                    + v44.n64_f32[1]);
              v44.n64_f32[0] = v45 + 5.0;
              v47 = vmax_f32(v5, v44).n64_f32[0];
              if ( v46 < v47 )
              {
                v48 = (CTaskSimpleGangDriveBy *)CTask::operator new(0x44u);
                CTaskSimpleGangDriveBy::CTaskSimpleGangDriveBy(v48, m_iAccumulatedTime, 0, v47, 90, 8, 0);
                v41 = v49;
              }
              this->m_pTaskEventResponse = v41;
            }
          }
          return;
        case 0x3FF:
          if ( this->m_pPed->CharCreatedBy == 2
            || (v50 = m_iAccumulatedTime->m_nCurrentWeapon,
                !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
            || CWeapon::IsTypeMelee(&m_iAccumulatedTime->m_WeaponSlots[v50]) )
          {
            v51 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
            CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v51, m_iAccumulatedTime, 10000, 0, 0, 0, 1);
            goto LABEL_66;
          }
          v69 = this->m_pPed;
          if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) != 0 && m_iAccumulatedTime->m_nPedType == 6 )
            goto LABEL_28;
          if ( (*(_DWORD *)&this->m_pPed->m_nPedFlags & 0x100) == 0 )
            goto LABEL_93;
          v72 = v69->m_pMyVehicle;
          if ( !v72 || !CVehicle::IsDriver(v72, v69) )
            goto LABEL_93;
LABEL_89:
          v71 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
          CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v71, this->m_pPed->m_pMyVehicle, 0, 1, 2, 40.0);
          v13 = &`vtable for'CTaskComplexCarDriveMissionFleeScene;
          goto LABEL_22;
        case 0x400:
          if ( this->m_pPed->CharCreatedBy == 2
            || (v52 = m_iAccumulatedTime->m_nCurrentWeapon,
                !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
            || CWeapon::IsTypeMelee(&m_iAccumulatedTime->m_WeaponSlots[v52]) )
          {
            v53 = this->m_pPed;
            v54 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1);
            v55 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
            v56 = *(_DWORD *)&this->m_pPed->m_nPedFlags | 0x200000;
            goto LABEL_64;
          }
          if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) != 0 && m_iAccumulatedTime->m_nPedType == 6 )
            goto LABEL_28;
          goto LABEL_93;
        case 0x404:
          v57 = (CTaskComplexKillPedOnFootStealth *)CTask::operator new(0x48u);
          CTaskComplexKillPedOnFootStealth::CTaskComplexKillPedOnFootStealth(v57, m_iAccumulatedTime);
          goto LABEL_66;
        case 0x405:
          if ( this->m_pPed->CharCreatedBy == 2
            || (v58 = m_iAccumulatedTime->m_nCurrentWeapon,
                !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
            || CWeapon::IsTypeMelee(&m_iAccumulatedTime->m_WeaponSlots[v58]) )
          {
            v53 = this->m_pPed;
            v54 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 1);
            v55 = *((_DWORD *)&this->m_pPed->m_nPedFlags + 2);
            v56 = *(_DWORD *)&this->m_pPed->m_nPedFlags | 0x400000;
LABEL_64:
            v59 = *((_DWORD *)&v53->m_nPedFlags + 3);
            *(_DWORD *)&v53->m_nPedFlags = v56;
            *((_DWORD *)&v53->m_nPedFlags + 1) = v54;
            *((_DWORD *)&v53->m_nPedFlags + 2) = v55;
            *((_DWORD *)&v53->m_nPedFlags + 3) = v59;
LABEL_65:
            v60 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
            CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v60, m_iAccumulatedTime, -1, 0, 0, 0, 1);
          }
          else if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) != 0 && m_iAccumulatedTime->m_nPedType == 6 )
          {
LABEL_28:
            v23 = (CTaskComplexFleeAnyMeans *)CTask::operator new(0x54u);
            CTaskComplexFleeAnyMeans::CTaskComplexFleeAnyMeans(
              v23,
              m_iAccumulatedTime,
              1,
              60.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[937],
              (const int)&elf_hash_bucket[937],
              20.0,
              (const int)&elf_hash_bucket[187],
              1.0);
          }
          else
          {
LABEL_93:
            v73 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
            CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
              v73,
              m_iAccumulatedTime,
              0,
              60.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[187],
              1.0);
          }
          goto LABEL_66;
        case 0x406:
          if ( !this->m_pPed->m_pMyVehicle )
            goto LABEL_65;
          v61 = (CTaskComplexSequence *)CTask::operator new(0x40u);
          CTaskComplexSequence::CTaskComplexSequence(v61);
          v62 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
          CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v62, m_iAccumulatedTime, -1, 0, 0, 0, 1);
          CTaskComplexSequence::AddTask(v61, v62);
          v63 = (CTaskComplexCarDriveWander *)CTask::operator new(0x24u);
          CTaskComplexCarDriveWander::CTaskComplexCarDriveWander(v63, this->m_pPed->m_pMyVehicle, 0, 10.0);
          CTaskComplexSequence::AddTask(v61, v63);
          this->m_pTaskEventResponse = v61;
          return;
        default:
          if ( v9 != 704 )
          {
            if ( v9 != 1105 )
              return;
            if ( !CPed::IsPlayer(m_iAccumulatedTime) )
            {
              v16 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
              CTaskComplexKillCriminal::CTaskComplexKillCriminal(v16, m_iAccumulatedTime, 1);
              goto LABEL_66;
            }
            goto LABEL_17;
          }
          v64 = this->m_pPed->m_pMyVehicle;
          v65 = v64 == 0;
          if ( v64 )
            v65 = *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 == 0;
          if ( !v65 )
          {
            v66 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
            CTaskComplexLeaveCar::CTaskComplexLeaveCar(v66, this->m_pPed->m_pMyVehicle, 0, 0, 0, 1);
            goto LABEL_66;
          }
          break;
      }
    }
  }
}
// 381D9C: variable 'v11' is possibly undefined
// 381F56: variable 'm_pTaskEventResponse' is possibly undefined
// 3820D0: variable 'v4' is possibly undefined
// 3820D0: variable 'v5' is possibly undefined
// 382116: variable 'v49' is possibly undefined
// 382344: variable 'v68' is possibly undefined
// 6: using guessed type char byte_6;
// 7: using guessed type char byte_7;
// FC: using guessed type int elf_hash_bucket[16411];
// 676378: using guessed type void *`vtable for'CTaskSimpleCower;
// 676C0C: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
// 676D34: using guessed type void *`vtable for'CTaskSimpleHandsUp;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;
// 678A48: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;

//----- (003826A8) --------------------------------------------------------
void __fastcall CEventHandler::ComputeSeenCopResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_iAccumulatedTime; // r5
  int v6; // r0
  CTaskComplexSmartFleeEntity *v7; // r0
  CTask *v8; // r0
  CTaskComplexKillPedOnFoot *v9; // r0

  m_iAccumulatedTime = (CPed *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    switch ( v6 )
    {
      case 200:
        v8 = 0;
        break;
      case 1000:
        v9 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
        CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v9, m_iAccumulatedTime, -1, 0, 0, 0, 1);
        break;
      case 911:
        v7 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
        CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
          v7,
          m_iAccumulatedTime,
          0,
          60.0,
          (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
          (const int)&elf_hash_bucket[187],
          1.0);
        break;
      default:
        return;
    }
    this->m_pTaskEventResponse = v8;
  }
}
// 38272E: variable 'v8' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00382744) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedThreatBadlyLitResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CEntity *m_iAccumulatedTime; // r5
  int v7; // r0
  CTaskComplexInvestigateDisturbance *v8; // r0
  CTask *v9; // r0

  m_iAccumulatedTime = (CEntity *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v7 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v7 == 200 )
    {
      v9 = 0;
    }
    else
    {
      if ( v7 != 935 )
        return;
      v8 = (CTaskComplexInvestigateDisturbance *)CTask::operator new(0x1Cu);
      CTaskComplexInvestigateDisturbance::CTaskComplexInvestigateDisturbance(
        v8,
        (const CVector *)&pEvent[2],
        m_iAccumulatedTime);
    }
    this->m_pTaskEventResponse = v9;
  }
}
// 382778: variable 'v9' is possibly undefined

//----- (00382780) --------------------------------------------------------
void __fastcall CEventHandler::ComputePedSoundQuietResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v6; // r0
  CTaskComplexInvestigateDisturbance *v7; // r6
  CEntity *v8; // r0

  if ( (*((int (__fastcall **)(CEvent *, _DWORD, CTask *, CTask *))pEvent->_vptr$CEvent + 11))(
         pEvent,
         *((_DWORD *)pEvent->_vptr$CEvent + 11),
         pTaskActive,
         pTaskActiveSimplest) )
  {
    v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v6 == 200 )
    {
      v7 = 0;
    }
    else
    {
      if ( v6 != 935 )
        return;
      v7 = (CTaskComplexInvestigateDisturbance *)CTask::operator new(0x1Cu);
      v8 = (CEntity *)(*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent);
      CTaskComplexInvestigateDisturbance::CTaskComplexInvestigateDisturbance(
        v7,
        (const CVector *)&pEvent[2].m_iAccumulatedTime,
        v8);
    }
    this->m_pTaskEventResponse = v7;
  }
}

//----- (003827D4) --------------------------------------------------------
void __fastcall CEventHandler::ComputeLowHealthResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v5; // r0
  CTaskComplexEvasiveDiveAndGetUp *v6; // r0
  CTask *v7; // r0
  CVector vDiveDir; // [sp+4h] [bp-14h] BYREF

  v5 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v5 == 200 )
  {
    v7 = 0;
  }
  else
  {
    if ( v5 != 513 )
      return;
    v6 = (CTaskComplexEvasiveDiveAndGetUp *)CTask::operator new(0x24u);
    memset(&vDiveDir, 0, sizeof(vDiveDir));
    CTaskComplexEvasiveDiveAndGetUp::CTaskComplexEvasiveDiveAndGetUp(v6, 0, 0, &vDiveDir, 1);
    v7->_vptr$CTask = (int (**)(void))&off_66B950;
  }
  this->m_pTaskEventResponse = v7;
}
// 382810: variable 'v7' is possibly undefined
// 66B950: using guessed type void *off_66B950;
// 675F04: using guessed type void *`vtable for'CTaskComplexDiveFromAttachedEntityAndGetUp;

//----- (00382820) --------------------------------------------------------
void __fastcall CEventHandler::ComputeReallyLowHealthResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v5; // r0
  CTaskComplexEvasiveDiveAndGetUp *v6; // r0
  CTask *v7; // r0
  CVector vDiveDir; // [sp+4h] [bp-14h] BYREF

  v5 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v5 == 200 )
  {
    v7 = 0;
  }
  else
  {
    if ( v5 != 513 )
      return;
    v6 = (CTaskComplexEvasiveDiveAndGetUp *)CTask::operator new(0x24u);
    memset(&vDiveDir, 0, sizeof(vDiveDir));
    CTaskComplexEvasiveDiveAndGetUp::CTaskComplexEvasiveDiveAndGetUp(v6, 0, 0, &vDiveDir, 1);
    v7->_vptr$CTask = (int (**)(void))&off_66B950;
  }
  this->m_pTaskEventResponse = v7;
}
// 38285C: variable 'v7' is possibly undefined
// 66B950: using guessed type void *off_66B950;
// 675F04: using guessed type void *`vtable for'CTaskComplexDiveFromAttachedEntityAndGetUp;

//----- (0038286C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeLowAngerAtPlayerResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v5; // r0
  CTaskComplexKillPedOnFoot *v6; // r5
  CPlayerPed *v7; // r0
  CPlayerPed *PlayerPed; // r0

  v5 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v5 > 910 )
  {
    if ( v5 == 1000 )
    {
      v6 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
      PlayerPed = FindPlayerPed(-1);
      CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v6, PlayerPed, -1, 0, 0, 0, 1);
    }
    else
    {
      if ( v5 != 911 )
        return;
      v6 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x40u);
      v7 = FindPlayerPed(-1);
      CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
        (CTaskComplexSmartFleeEntity *)v6,
        v7,
        0,
        60.0,
        (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
        (const int)&elf_hash_bucket[187],
        1.0);
    }
  }
  else if ( v5 == 200 )
  {
    v6 = 0;
  }
  else
  {
    if ( v5 != 427 )
      return;
    v6 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x28u);
    CTaskSimpleDuck::CTaskSimpleDuck((CTaskSimpleDuck *)v6, 0, 0xFFFFu, -1);
  }
  this->m_pTaskEventResponse = v6;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00382948) --------------------------------------------------------
void __fastcall CEventHandler::ComputeHighAngerAtPlayerResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v5; // r0
  CTaskComplexKillPedOnFoot *v6; // r5
  CPlayerPed *v7; // r0
  CPlayerPed *PlayerPed; // r0

  v5 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v5 > 910 )
  {
    if ( v5 == 1000 )
    {
      v6 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
      PlayerPed = FindPlayerPed(-1);
      CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v6, PlayerPed, -1, 0, 0, 0, 1);
    }
    else
    {
      if ( v5 != 911 )
        return;
      v6 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x40u);
      v7 = FindPlayerPed(-1);
      CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
        (CTaskComplexSmartFleeEntity *)v6,
        v7,
        0,
        60.0,
        (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
        (const int)&elf_hash_bucket[187],
        1.0);
    }
  }
  else if ( v5 == 200 )
  {
    v6 = 0;
  }
  else
  {
    if ( v5 != 427 )
      return;
    v6 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x28u);
    CTaskSimpleDuck::CTaskSimpleDuck((CTaskSimpleDuck *)v6, 0, 0xFFFFu, -1);
  }
  this->m_pTaskEventResponse = v6;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00382A24) --------------------------------------------------------
void __fastcall CEventHandler::ComputeOnFireResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskSimplePlayerOnFire *v5; // r0
  CTaskSimple *v6; // r0
  CTaskComplexOnFire *v7; // r0
  CTask *v8; // r0

  if ( CPed::IsPlayer(this->m_pPed) )
  {
    if ( !CTaskManager::GetTaskSecondary(&this->m_pPed->m_pPedIntelligence->m_taskManager, 4) )
    {
      v5 = (CTaskSimplePlayerOnFire *)CTask::operator new(0x18u);
      CTaskSimplePlayerOnFire::CTaskSimplePlayerOnFire(v5);
      this->m_pTaskSecondaryPartialAnim = v6;
    }
  }
  else
  {
    v7 = (CTaskComplexOnFire *)CTask::operator new(0xCu);
    CTaskComplexOnFire::CTaskComplexOnFire(v7);
    this->m_pTaskEventResponse = v8;
  }
}
// 382A52: variable 'v6' is possibly undefined
// 382A60: variable 'v8' is possibly undefined

//----- (00382A68) --------------------------------------------------------
void __fastcall CEventHandler::ComputeWaterCannonResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v6; // r6
  CTaskComplexFallAndGetUp *v7; // r0
  CTask *v8; // r0
  float x; // s0
  float v10; // s2
  float v11; // s2
  CVector v12; // 0:r1.12

  CPed::Say(this->m_pPed, 0x158u, 0, 1.0, 0, 0, 0);
  v6 = CPedGeometryAnalyser::ComputePedHitSide(this->m_pPed, (const CVector *)&pEvent[2]);
  v7 = (CTaskComplexFallAndGetUp *)CTask::operator new(0x18u);
  CTaskComplexFallAndGetUp::CTaskComplexFallAndGetUp(v7, v6, 0);
  v12.y = 0.0;
  this->m_pTaskEventResponse = v8;
  v12.x = 0.0;
  v12.z = CTimer::ms_fTimeStep + CTimer::ms_fTimeStep;
  CPhysical::ApplyMoveForce(this->m_pPed, v12);
  this->m_pPed->m_vecMoveSpeed.x = (float)(this->m_pPed->m_vecMoveSpeed.x
                                         + (float)(*(float *)&pEvent[2]._vptr$CEvent * 0.6))
                                 * 0.5;
  this->m_pPed->m_vecMoveSpeed.y = (float)(this->m_pPed->m_vecMoveSpeed.y
                                         + (float)(*(float *)&pEvent[2].m_iAccumulatedTime * 0.6))
                                 * 0.5;
  x = this->m_pPed->m_vecMoveSpeed.x;
  v10 = sqrtf((float)(x * x) + (float)(this->m_pPed->m_vecMoveSpeed.y * this->m_pPed->m_vecMoveSpeed.y));
  if ( v10 > 0.2 )
  {
    v11 = 0.2 / v10;
    this->m_pPed->m_vecMoveSpeed.x = v11 * x;
    this->m_pPed->m_vecMoveSpeed.y = v11 * this->m_pPed->m_vecMoveSpeed.y;
  }
}
// 382AAC: variable 'v8' is possibly undefined

//----- (00382B58) --------------------------------------------------------
void __fastcall CEventHandler::ComputeInWaterResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskComplexInWater *v5; // r0
  CTask *v6; // r0

  v5 = (CTaskComplexInWater *)CTask::operator new(0xCu);
  CTaskComplexInWater::CTaskComplexInWater(v5);
  this->m_pTaskEventResponse = v6;
}
// 382B68: variable 'v6' is possibly undefined

//----- (00382B6C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeInteriorUseInfoResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskInteriorUseInfo *v6; // r0
  CTask *v7; // r0

  v6 = (CTaskInteriorUseInfo *)CTask::operator new(0x1Cu);
  CTaskInteriorUseInfo::CTaskInteriorUseInfo(
    v6,
    (InteriorInfo_t *)pEvent[1]._vptr$CEvent,
    (Interior_c *)pEvent[1].m_iAccumulatedTime,
    *(_DWORD *)&pEvent[1].m_bIsPersistent,
    (bool8)pEvent[2]._vptr$CEvent);
  this->m_pTaskEventResponse = v7;
}
// 382B8A: variable 'v7' is possibly undefined

//----- (00382B90) --------------------------------------------------------
void __fastcall CEventHandler::ComputeSignalAtPedResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskComplexSignalAtPed *v6; // r0
  CTask *v7; // r0

  v6 = (CTaskComplexSignalAtPed *)CTask::operator new(0x18u);
  CTaskComplexSignalAtPed::CTaskComplexSignalAtPed(
    v6,
    (CPed *)pEvent[1]._vptr$CEvent,
    pEvent[1].m_iAccumulatedTime,
    pEvent[1].m_bIsPersistent);
  this->m_pTaskEventResponse = v7;
}
// 382BA8: variable 'v7' is possibly undefined

//----- (00382BAC) --------------------------------------------------------
void __fastcall CEventHandler::ComputePassObjectResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskComplexPassObject *v6; // r0
  CTask *v7; // r0

  v6 = (CTaskComplexPassObject *)CTask::operator new(0x30u);
  CTaskComplexPassObject::CTaskComplexPassObject(v6, (CPed *)pEvent[1]._vptr$CEvent, pEvent[1].m_iAccumulatedTime);
  this->m_pTaskEventResponse = v7;
}
// 382BC2: variable 'v7' is possibly undefined

//----- (00382BC8) --------------------------------------------------------
void __fastcall CEventHandler::ComputeCreatePartnerTaskResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int (**v6)(void); // r0
  CTaskComplexPartnerGreet *v7; // r0
  CTask *v8; // r0
  CTaskComplexPartnerDeal *v9; // r0
  CVector subType[2]; // [sp+4h] [bp-1Ch] BYREF

  if ( pEvent[1].m_iAccumulatedTime )
  {
    v6 = pEvent[1]._vptr$CEvent;
    if ( v6 )
    {
      if ( (unsigned int)v6 - 1 > 5 )
        return;
      v7 = (CTaskComplexPartnerGreet *)CTask::operator new(0x78u);
      memset(&subType[0].y, 0, sizeof(CVector));
      CTaskComplexPartnerGreet::CTaskComplexPartnerGreet(
        v7,
        "CompPartnerTaskResp",
        (CPed *)pEvent[1].m_iAccumulatedTime,
        pEvent[1].m_bIsPersistent,
        *(float *)&pEvent[2]._vptr$CEvent,
        (int32)pEvent[1]._vptr$CEvent - 1,
        *(CVector *)&subType[0].y);
    }
    else
    {
      v9 = (CTaskComplexPartnerDeal *)CTask::operator new(0x74u);
      memset(subType, 0, 12);
      CTaskComplexPartnerDeal::CTaskComplexPartnerDeal(
        v9,
        "CompPartnerTaskResp",
        (CPed *)pEvent[1].m_iAccumulatedTime,
        pEvent[1].m_bIsPersistent,
        *(float *)&pEvent[2]._vptr$CEvent,
        subType[0]);
    }
  }
  else
  {
    v8 = 0;
  }
  this->m_pTaskEventResponse = v8;
}
// 382C2C: variable 'v8' is possibly undefined

//----- (00382C48) --------------------------------------------------------
void __fastcall CEventHandler::ComputePlayerWantedLevelResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskComplexPolicePursuit *v5; // r0
  CTask *v6; // r0

  v5 = (CTaskComplexPolicePursuit *)CTask::operator new(0x18u);
  CTaskComplexPolicePursuit::CTaskComplexPolicePursuit(v5);
  this->m_pTaskEventResponse = v6;
}
// 382C58: variable 'v6' is possibly undefined

//----- (00382C5C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeVehicleOnFireResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int m_iAccumulatedTime; // r6
  CTask *v6; // r2
  int v7; // r0
  CTaskComplexSequence *v8; // r5
  void **v9; // r0
  int v10; // r0
  bool v11; // zf
  CTaskComplex *v12; // r4
  CTaskComplexSmartFleeEntity *v13; // r4
  CVehicle *m_pMyVehicle; // r0
  CTaskComplexDie *v15; // r0
  CTask *v16; // r0

  m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    if ( ((*(_BYTE *)(m_iAccumulatedTime + 58) & 0xF8) == 40 || *(float *)(m_iAccumulatedTime + 1228) <= 0.0)
      && (v6 = (CTask *)(*((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31)) != 0
      && this->m_pPed->m_pMyVehicle == (CVehicle *)m_iAccumulatedTime )
    {
      v10 = *(_DWORD *)(m_iAccumulatedTime + 1440);
      v11 = v10 == 9;
      if ( v10 != 9 )
        v11 = *(_DWORD *)(m_iAccumulatedTime + 1444) == 2;
      if ( v11 )
      {
        CEventHandler::ComputeKnockOffBikeResponse(this, pEvent, v6, pTaskActiveSimplest);
      }
      else
      {
        v15 = (CTaskComplexDie *)CTask::operator new(0x28u);
        CTaskComplexDie::CTaskComplexDie(v15, WEAPONTYPE_UNARMED, ANIM_STD_PED, ANIM_STD_KO_FRONT, 4.0, 0.0, 0, 0, 0, 0);
        this->m_pTaskEventResponse = v16;
      }
    }
    else
    {
      v7 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      switch ( *((_WORD *)&pEvent->m_bIsPersistent + 1) )
      {
        case 0x2C0:
          v8 = (CTaskComplexSequence *)CTask::operator new(0x14u);
          CTaskComplex::CTaskComplex(v8);
          v8->m_iProgress = 0;
          v9 = &`vtable for'CTaskComplexLeaveAnyCar;
          LOWORD(v8->m_tasks[0]) = 256;
          goto LABEL_22;
        case 0x2C1:
        case 0x2C4:
        case 0x2C5:
        case 0x2C6:
        case 0x2C7:
        case 0x2C8:
        case 0x2C9:
        case 0x2CA:
        case 0x2CB:
        case 0x2CC:
        case 0x2CD:
        case 0x2CE:
        case 0x2CF:
        case 0x2D0:
        case 0x2D1:
        case 0x2D2:
        case 0x2D3:
        case 0x2D4:
        case 0x2D5:
          return;
        case 0x2C2:
          v8 = (CTaskComplexSequence *)CTask::operator new(0x40u);
          CTaskComplexSequence::CTaskComplexSequence(v8);
          v12 = (CTaskComplex *)CTask::operator new(0x14u);
          CTaskComplex::CTaskComplex(v12);
          v12[1]._vptr$CTask = 0;
          v12->_vptr$CTask = (int (**)(void))&off_66AF80;
          LOWORD(v12[1].m_pParent) = 256;
          CTaskComplexSequence::AddTask(v8, v12);
          v13 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v13,
            (CEntity *)m_iAccumulatedTime,
            0,
            15.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          goto LABEL_18;
        case 0x2C3:
          v8 = (CTaskComplexSequence *)CTask::operator new(0x40u);
          CTaskComplexSequence::CTaskComplexSequence(v8);
          v13 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x14u);
          CTaskComplex::CTaskComplex(v13);
          v13->m_pFleeEntity = 0;
          v13->_vptr$CTask = (int (**)(void))&off_66AF80;
          LOWORD(v13->m_vFleePos.x) = 256;
LABEL_18:
          CTaskComplexSequence::AddTask(v8, v13);
          goto LABEL_25;
        case 0x2D6:
          m_pMyVehicle = this->m_pPed->m_pMyVehicle;
          if ( m_pMyVehicle && CVehicle::IsDriver(m_pMyVehicle, this->m_pPed) )
          {
            v8 = (CTaskComplexSequence *)CTask::operator new(0x2Cu);
            CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(
              (CTaskComplexCarDriveMission *)v8,
              this->m_pPed->m_pMyVehicle,
              0,
              1,
              2,
              40.0);
            v9 = &`vtable for'CTaskComplexCarDriveMissionFleeScene;
LABEL_22:
            v8->_vptr$CTask = (int (**)(void))((char *)*v9 + 8);
          }
          else
          {
            v8 = (CTaskComplexSequence *)CTask::operator new(0x40u);
            CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
              (CTaskComplexSmartFleeEntity *)v8,
              this->m_pPed->m_pMyVehicle,
              0,
              60.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[187],
              1.0);
          }
          goto LABEL_25;
        default:
          if ( v7 == 909 )
          {
            v8 = (CTaskComplexSequence *)CTask::operator new(0x3Cu);
            CTaskComplexFleeEntity::CTaskComplexFleeEntity(
              (CTaskComplexFleeEntity *)v8,
              (CEntity *)m_iAccumulatedTime,
              0,
              15.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[187],
              1.0);
          }
          else
          {
            if ( v7 != 911 )
              return;
            v8 = (CTaskComplexSequence *)CTask::operator new(0x40u);
            CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
              (CTaskComplexSmartFleeEntity *)v8,
              (CEntity *)m_iAccumulatedTime,
              0,
              15.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[187],
              1.0);
          }
LABEL_25:
          this->m_pTaskEventResponse = v8;
          break;
      }
    }
  }
}
// 382F04: variable 'v16' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 66AF80: using guessed type void *;
// 677A98: using guessed type void *`vtable for'CTaskComplexLeaveAnyCar;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;

//----- (00382F50) --------------------------------------------------------
void __fastcall CEventHandler::ComputeCopCarBeingStolenResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CVehicle *m_iAccumulatedTime; // r6
  const CPed *v5; // r4
  bool v7; // zf
  CTaskComplexLeaveCar *v8; // r0
  CTask *v9; // r0
  CWanted **p_m_Wanted; // r0
  CWanted *v11; // r0

  v5 = (const CPed *)pEvent[1]._vptr$CEvent;
  v7 = v5 == 0;
  if ( v5 )
  {
    m_iAccumulatedTime = (CVehicle *)pEvent[1].m_iAccumulatedTime;
    v7 = m_iAccumulatedTime == 0;
  }
  if ( !v7 && this->m_pPed->m_pMyVehicle == m_iAccumulatedTime )
  {
    if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
    {
      v8 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
      CTaskComplexLeaveCar::CTaskComplexLeaveCar(v8, m_iAccumulatedTime, 0, 0, 1, 0);
      this->m_pTaskEventResponse = v9;
      if ( CPed::IsPlayer(v5) )
      {
        p_m_Wanted = &v5->m_pPlayerData->m_Wanted;
        if ( p_m_Wanted )
          v11 = *p_m_Wanted;
        else
          v11 = 0;
        sub_18A9C0(v11, 1);
      }
    }
  }
}
// 382F70: variable 'm_iAccumulatedTime' is possibly undefined
// 382F92: variable 'v9' is possibly undefined

//----- (00382FC4) --------------------------------------------------------
void __fastcall CEventHandler::ComputeVehicleDamageResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_pPed; // r1
  CVehicle *m_pMyVehicle; // r0
  int v8; // r2
  int v9; // r5
  int v10; // r6
  int v11; // r0
  CTaskComplexKillPedOnFoot *v12; // r0
  CTask *v13; // r0
  CTaskComplexCarDriveMission *v14; // r0
  void **v15; // r1
  int v16; // r0
  CTaskComplexKillCriminal *v17; // r0
  CPed *v18; // r1
  CTaskComplexCarDriveMission *v19; // r0
  int m_iNextEventResponseSequence; // r5
  CTaskComplexUseSequence *v21; // r0
  CTaskComplexLeaveCarAndFlee *v22; // r0
  CVehicle *v23; // r1
  CMatrix *m_pMat; // r3
  const CVector *p_tx; // r2
  int v26; // r0
  CTaskComplexRoadRage *v27; // r0
  CPed *v28; // r1
  CTaskComplexSmartFleeEntity *v29; // r0
  const CPed *v30; // r0
  CTaskComplexKillPedOnFoot *v31; // r0
  CPlayerPed *PlayerPed; // r8
  int (**v33)(void); // r6
  CVehicle *v34; // r0

  m_pPed = this->m_pPed;
  m_pMyVehicle = this->m_pPed->m_pMyVehicle;
  if ( !m_pMyVehicle || m_pMyVehicle != (CVehicle *)pEvent[1].m_iAccumulatedTime )
    return;
  v8 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v8 > 728 )
  {
    v9 = *(_DWORD *)&pEvent[1].m_bIsPersistent;
    if ( v8 <= 1030 )
    {
      if ( v8 != 729 )
      {
        if ( v8 == 1000 && v9 )
        {
          if ( (*(_BYTE *)(v9 + 58) & 7) != 3
            || m_pPed->CharCreatedBy == 2
            || (v10 = *(char *)(v9 + 1820), !CWeapon::IsTypeMelee(&m_pPed->m_WeaponSlots[m_pPed->m_nCurrentWeapon]))
            || CWeapon::IsTypeMelee((const CWeapon *)(v9 + 28 * v10 + 1444)) )
          {
            v11 = *(_BYTE *)(v9 + 58) & 7;
            if ( v11 == 2 )
            {
              v31 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
              CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v31, *(CPed **)(v9 + 1124), -1, 0, 0, 0, 1);
            }
            else
            {
              if ( v11 != 3 )
                return;
              v12 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
              CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v12, (CPed *)v9, -1, 0, 0, 0, 1);
            }
            goto LABEL_55;
          }
          v34 = this->m_pPed->m_pMyVehicle;
          if ( !v34 || !CVehicle::IsDriver(v34, this->m_pPed) )
          {
LABEL_42:
            v29 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
            CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
              v29,
              this->m_pPed->m_pMyVehicle,
              0,
              60.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[187],
              1.0);
            goto LABEL_55;
          }
          goto LABEL_19;
        }
        return;
      }
      if ( !v9 || (*(_BYTE *)(v9 + 58) & 6) != 2 )
        return;
      if ( MobileSettings::settings[4].value )
      {
        v19 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
LABEL_31:
        CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v19, this->m_pPed->m_pMyVehicle, 0, 1, 2, 40.0);
        v15 = &`vtable for'CTaskComplexCarDriveMissionFleeScene;
        goto LABEL_54;
      }
      PlayerPed = FindPlayerPed(-1);
      if ( (CPlayerPed *)(*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent) == PlayerPed
        && CTheScripts::IsPlayerOnAMission()
        && this->m_pPed->CharCreatedBy == 1 )
      {
        v33 = pEvent[2]._vptr$CEvent;
        v19 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
        if ( v33 == (int (**)(void))((char *)&word_30 + 1) )
          goto LABEL_31;
      }
      else
      {
        v19 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
      }
      CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(
        v19,
        this->m_pPed->m_pMyVehicle,
        (CEntity *)v9,
        54,
        3,
        40.0);
      v15 = &`vtable for'CTaskComplexCarDriveMissionKillPed;
      goto LABEL_54;
    }
    if ( v8 == 1031 )
    {
      if ( !v9 )
        return;
      v26 = *(_BYTE *)(v9 + 58) & 7;
      if ( v26 == 2 )
      {
        v27 = (CTaskComplexRoadRage *)CTask::operator new(0x10u);
        v28 = *(CPed **)(v9 + 1124);
      }
      else
      {
        if ( v26 != 3 )
          return;
        v27 = (CTaskComplexRoadRage *)CTask::operator new(0x10u);
        v28 = (CPed *)v9;
      }
      CTaskComplexRoadRage::CTaskComplexRoadRage(v27, v28);
      goto LABEL_55;
    }
    if ( v8 != 1105 || !v9 )
      return;
    v16 = *(_BYTE *)(v9 + 58) & 7;
    if ( v16 == 2 )
    {
      v30 = *(const CPed **)(v9 + 1124);
      if ( !v30 || !CPed::IsPlayer(v30) )
      {
        v17 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
        v18 = *(CPed **)(v9 + 1124);
        goto LABEL_50;
      }
    }
    else
    {
      if ( v16 != 3 )
        return;
      if ( !CPed::IsPlayer(*(const CPed **)&pEvent[1].m_bIsPersistent) )
      {
        v17 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
        v18 = (CPed *)v9;
LABEL_50:
        CTaskComplexKillCriminal::CTaskComplexKillCriminal(v17, v18, 0);
        goto LABEL_55;
      }
    }
    v13 = 0;
    goto LABEL_55;
  }
  if ( v8 != 244 )
  {
    if ( v8 == 706 )
    {
      v22 = (CTaskComplexLeaveCarAndFlee *)CTask::operator new(0x28u);
      v23 = this->m_pPed->m_pMyVehicle;
      m_pMat = v23->m_pMat;
      p_tx = (const CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v23->m_transform.m_translate;
      CTaskComplexLeaveCarAndFlee::CTaskComplexLeaveCarAndFlee(v22, v23, p_tx, 0, 0, 0);
      goto LABEL_55;
    }
    if ( v8 != 726 )
      return;
    if ( !CVehicle::IsDriver(m_pMyVehicle, m_pPed) )
      goto LABEL_42;
LABEL_19:
    v14 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
    CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v14, this->m_pPed->m_pMyVehicle, 0, 1, 2, 40.0);
    v15 = &`vtable for'CTaskComplexCarDriveMissionFleeScene;
LABEL_54:
    v13->_vptr$CTask = (int (**)(void))((char *)*v15 + 8);
    goto LABEL_55;
  }
  m_iNextEventResponseSequence = m_pPed->m_pPedIntelligence->m_iNextEventResponseSequence;
  if ( m_iNextEventResponseSequence >= 0 && CTaskSequences::ms_taskSequence[m_iNextEventResponseSequence].m_tasks[0] )
  {
    v21 = (CTaskComplexUseSequence *)CTask::operator new(0x1Cu);
    CTaskComplexUseSequence::CTaskComplexUseSequence(v21, m_iNextEventResponseSequence);
LABEL_55:
    this->m_pTaskEventResponse = v13;
  }
}
// 383298: variable 'v13' is possibly undefined
// 30: using guessed type __int16 word_30;
// FC: using guessed type int elf_hash_bucket[16411];
// 677834: using guessed type void *`vtable for'CTaskComplexCarDriveMissionKillPed;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;

//----- (00383350) --------------------------------------------------------
void __fastcall CEventHandler::ComputeSpecialResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v5; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v6; // r0
  CTask *v7; // r0
  void **v8; // r1
  CTaskComplexLeaveCar *v9; // r0
  CTaskComplexSmartFleeEntity *v10; // r5
  CPlayerPed *v11; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v12; // r0
  CTaskComplexKillPedOnFoot *v13; // r5
  CPlayerPed *v14; // r0
  CTaskComplexArrestPed *v15; // r5
  CPlayerPed *v16; // r0
  CTaskComplexSmartFleePoint *v17; // r5
  CPlayerPed *v18; // r0
  CMatrix *v19; // r2
  const CVector *p_m_translate; // r1
  CTaskComplexUseClosestFreeScriptedAttractor *v21; // r0
  CTaskComplexLeaveCarAndFlee *v22; // r5
  CVehicle *m_pMyVehicle; // r6
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r1
  const CVector *p_tx; // r2
  CTaskComplexLeaveCarAndWander *v27; // r0
  CTaskComplexCarDriveMission *v28; // r0

  v5 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v5 <= 909 )
  {
    if ( v5 >= 262 )
    {
      switch ( *((_WORD *)&pEvent->m_bIsPersistent + 1) )
      {
        case 0x2C0:
          if ( !this->m_pPed->m_pMyVehicle )
            return;
          v9 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
          CTaskComplexLeaveCar::CTaskComplexLeaveCar(v9, this->m_pPed->m_pMyVehicle, 0, 0, 1, 0);
          goto LABEL_34;
        case 0x2C1:
        case 0x2C4:
        case 0x2C5:
        case 0x2C6:
        case 0x2C7:
        case 0x2C8:
        case 0x2C9:
        case 0x2CA:
        case 0x2CB:
        case 0x2CC:
        case 0x2CD:
        case 0x2CE:
        case 0x2CF:
        case 0x2D0:
        case 0x2D1:
        case 0x2D2:
        case 0x2D3:
        case 0x2D4:
        case 0x2D5:
          return;
        case 0x2C2:
          if ( this->m_pPed->m_pMyVehicle )
          {
            v22 = (CTaskComplexLeaveCarAndFlee *)CTask::operator new(0x28u);
            m_pMyVehicle = this->m_pPed->m_pMyVehicle;
            PlayerPed = FindPlayerPed(-1);
            m_pMat = PlayerPed->m_pMat;
            p_tx = (const CVector *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &PlayerPed->m_transform.m_translate;
            CTaskComplexLeaveCarAndFlee::CTaskComplexLeaveCarAndFlee(v22, m_pMyVehicle, p_tx, 0, 0, 0);
            this->m_pTaskEventResponse = v22;
          }
          return;
        case 0x2C3:
          if ( !this->m_pPed->m_pMyVehicle )
            return;
          v27 = (CTaskComplexLeaveCarAndWander *)CTask::operator new(0x1Cu);
          CTaskComplexLeaveCarAndWander::CTaskComplexLeaveCarAndWander(v27, this->m_pPed->m_pMyVehicle, 0, 0, 1);
          goto LABEL_34;
        case 0x2D6:
          v28 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
          CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v28, 0, 0, 1, 2, 40.0);
          v8 = &`vtable for'CTaskComplexCarDriveMissionFleeScene;
          goto LABEL_33;
        default:
          if ( v5 != 262 )
            return;
          v21 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
          CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v21, 0);
          v7[1].m_pParent = (CTask *)&byte_7;
          v8 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
          goto LABEL_33;
      }
    }
    if ( v5 != 200 )
    {
      if ( v5 == 258 )
      {
        v12 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
        CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v12, 0);
      }
      else
      {
        if ( v5 != 261 )
          return;
        v6 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
        CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v6, 0);
        v7[1].m_pParent = (CTask *)&byte_6;
        v8 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;
LABEL_33:
        v7->_vptr$CTask = (int (**)(void))((char *)*v8 + 8);
      }
      goto LABEL_34;
    }
LABEL_11:
    v7 = 0;
LABEL_34:
    this->m_pTaskEventResponse = v7;
    return;
  }
  if ( v5 >= 1000 )
  {
    if ( v5 == 1000 )
    {
      v13 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
      v14 = FindPlayerPed(-1);
      CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v13, v14, -1, 0, 0, 0, 1);
      this->m_pTaskEventResponse = v13;
      return;
    }
    if ( v5 == 1101 )
    {
      v15 = (CTaskComplexArrestPed *)CTask::operator new(0x24u);
      v16 = FindPlayerPed(-1);
      CTaskComplexArrestPed::CTaskComplexArrestPed(v15, v16);
      this->m_pTaskEventResponse = v15;
      return;
    }
    if ( v5 != 1105 )
      return;
    goto LABEL_11;
  }
  if ( v5 == 910 )
  {
    v17 = (CTaskComplexSmartFleePoint *)CTask::operator new(0x44u);
    v18 = FindPlayerPed(-1);
    v19 = v18->m_pMat;
    p_m_translate = (const CVector *)&v19->tx;
    if ( !v19 )
      p_m_translate = &v18->m_transform.m_translate;
    CTaskComplexSmartFleePoint::CTaskComplexSmartFleePoint(
      v17,
      p_m_translate,
      0,
      1000.0,
      (const int)&elf_hash_chain[8526]);
    this->m_pTaskEventResponse = v17;
  }
  else if ( v5 == 911 )
  {
    v10 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
    v11 = FindPlayerPed(-1);
    CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
      v10,
      v11,
      0,
      60.0,
      (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
      (const int)&elf_hash_bucket[187],
      1.0);
    this->m_pTaskEventResponse = v10;
  }
}
// 383394: variable 'v7' is possibly undefined
// 6: using guessed type char byte_6;
// 7: using guessed type char byte_7;
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];
// 676C0C: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;
// 678A48: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;

//----- (003835DC) --------------------------------------------------------
void __fastcall CEventHandler::ComputeGotKnockedOverByCarResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int m_iAccumulatedTime; // r6
  int v6; // r0
  CPed *v7; // r5
  CTaskComplexSmartFleeEntity *v8; // r0
  CTask *v9; // r0
  int m_nCurrentWeapon; // r6
  CTaskComplexKillPedOnFoot *v11; // r0
  CTaskComplexKillCriminal *v12; // r0

  m_iAccumulatedTime = pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    v7 = *(CPed **)(m_iAccumulatedTime + 1124);
    if ( v6 < 1000 )
    {
      if ( v6 != 200 )
      {
        if ( v6 != 911 )
          return;
        v8 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
        if ( !v7 )
        {
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v8,
            (CEntity *)m_iAccumulatedTime,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          goto LABEL_19;
        }
LABEL_6:
        CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
          v8,
          v7,
          0,
          60.0,
          (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
          (const int)&elf_hash_bucket[187],
          1.0);
LABEL_19:
        this->m_pTaskEventResponse = v9;
        return;
      }
LABEL_11:
      v9 = 0;
      goto LABEL_19;
    }
    if ( v6 == 1000 )
    {
      if ( !v7 )
        return;
      if ( this->m_pPed->CharCreatedBy == 2
        || (m_nCurrentWeapon = v7->m_nCurrentWeapon,
            !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
        || CWeapon::IsTypeMelee(&v7->m_WeaponSlots[m_nCurrentWeapon]) )
      {
        v11 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
        CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v11, v7, -1, 0, 0, 0, 1);
        goto LABEL_19;
      }
      v8 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
      goto LABEL_6;
    }
    if ( v6 == 1105 && v7 )
    {
      if ( !CPed::IsPlayer(*(const CPed **)(m_iAccumulatedTime + 1124)) )
      {
        v12 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
        CTaskComplexKillCriminal::CTaskComplexKillCriminal(v12, v7, 0);
        goto LABEL_19;
      }
      goto LABEL_11;
    }
  }
}
// 383704: variable 'v9' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00383758) --------------------------------------------------------
void __fastcall CEventHandler::ComputeObjectCollisionPassiveResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v4; // r8
  CEntity *m_iAccumulatedTime; // r5
  bool v8; // zf
  CTaskComplexWalkRoundObject *v9; // r0
  CTask *v10; // r0

  m_iAccumulatedTime = (CEntity *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime && !(*((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31) )
  {
    v8 = pTaskActiveSimplest == 0;
    if ( pTaskActiveSimplest )
    {
      v4 = *(_DWORD *)&pEvent[1].m_bIsPersistent;
      v8 = v4 == 1;
    }
    if ( !v8 )
    {
      if ( CTask::IsGoToTask(pTaskActiveSimplest) )
      {
        v9 = (CTaskComplexWalkRoundObject *)CTask::operator new(0x54u);
        CTaskComplexWalkRoundObject::CTaskComplexWalkRoundObject(
          v9,
          v4,
          (const CVector *)&pTaskActiveSimplest[1].m_pParent,
          m_iAccumulatedTime);
        this->m_pTaskEventResponse = v10;
      }
    }
  }
}
// 383796: variable 'v4' is possibly undefined
// 38379A: variable 'v10' is possibly undefined

//----- (003837A4) --------------------------------------------------------
void __fastcall CEventHandler::ComputeCarUpsideDownResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CPed *m_pPed; // r0
  bool v6; // zf
  CTaskComplexLeaveCar *v7; // r5
  CVehicle *m_pMyVehicle; // r6
  unsigned __int16 v9; // r0

  m_pPed = this->m_pPed;
  v6 = *((unsigned __int8 *)&m_pPed->m_nPedFlags + 1) << 31 == 0;
  if ( *((unsigned __int8 *)&m_pPed->m_nPedFlags + 1) << 31 )
  {
    m_pPed = (CPed *)m_pPed->m_pMyVehicle;
    v6 = m_pPed == 0;
  }
  if ( !v6 && m_pPed == (CPed *)pEvent[1]._vptr$CEvent )
  {
    v7 = (CTaskComplexLeaveCar *)CTask::operator new(0x34u);
    m_pMyVehicle = this->m_pPed->m_pMyVehicle;
    v9 = rand();
    CTaskComplexLeaveCar::CTaskComplexLeaveCar(
      v7,
      m_pMyVehicle,
      0,
      (int)(float)((float)((float)v9 * 0.000015259) * 300.0) + 100,
      1,
      0);
    this->m_pTaskEventResponse = v7;
  }
}

//----- (00383824) --------------------------------------------------------
void __fastcall CEventHandler::ComputePotentialWalkIntoFireResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  float v7; // s16
  int v8; // r0
  const CVector *p_m_iAccumulatedTime; // r8
  int (**v10)(void); // r5
  CTaskComplexWalkRoundFire *v11; // r0
  CTask *v12; // r0
  CTaskComplexSmartFleePoint *v13; // r0
  CTaskComplexFleePoint *v14; // r0

  if ( pTaskActiveSimplest )
  {
    v7 = *(float *)&pEvent[2].m_bIsPersistent;
    if ( CTask::IsGoToTask(pTaskActiveSimplest) )
    {
      v8 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
      p_m_iAccumulatedTime = (const CVector *)&pEvent[1].m_iAccumulatedTime;
      if ( v8 >= 908 )
      {
        if ( v8 == 908 )
        {
          v14 = (CTaskComplexFleePoint *)CTask::operator new(0x3Cu);
          CTaskComplexFleePoint::CTaskComplexFleePoint(
            v14,
            (const CVector *)&pEvent[1].m_iAccumulatedTime,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly");
        }
        else
        {
          if ( v8 != 910 )
            return;
          v13 = (CTaskComplexSmartFleePoint *)CTask::operator new(0x44u);
          CTaskComplexSmartFleePoint::CTaskComplexSmartFleePoint(
            v13,
            (const CVector *)&pEvent[1].m_iAccumulatedTime,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly");
        }
      }
      else if ( v8 == 200 )
      {
        v12 = 0;
      }
      else
      {
        if ( v8 != 514 )
          return;
        v10 = pEvent[3]._vptr$CEvent;
        v11 = (CTaskComplexWalkRoundFire *)CTask::operator new(0x38u);
        CTaskComplexWalkRoundFire::CTaskComplexWalkRoundFire(
          v11,
          (const int)v10,
          p_m_iAccumulatedTime,
          v7,
          (const CVector *)&pTaskActiveSimplest[1].m_pParent);
      }
      this->m_pTaskEventResponse = v12;
    }
  }
}
// 3838D0: variable 'v12' is possibly undefined

//----- (003838F0) --------------------------------------------------------
void __fastcall CEventHandler::ComputeShotFiredWhizzedByResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v6; // r6
  CPed *m_pPed; // r1
  CTaskSimpleDuck *TaskDuck; // r0
  CTaskSimpleDuck *v9; // r5
  unsigned __int16 v10; // r0

  v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( (*((int (__fastcall **)(CEvent *))pEvent->_vptr$CEvent + 11))(pEvent) )
  {
    if ( v6 == 200 )
    {
      v9 = 0;
    }
    else
    {
      if ( v6 != 311 )
        return;
      if ( pTaskActiveSimplest
        && (*((int (__fastcall **)(CTask *))pTaskActiveSimplest->_vptr$CTask + 5))(pTaskActiveSimplest) == 415
        && SHIWORD(pTaskActiveSimplest[1].m_pParent) > -1 )
      {
        m_pPed = this->m_pPed;
        TaskDuck = (CTaskSimpleDuck *)pTaskActiveSimplest;
      }
      else
      {
        if ( !CPedIntelligence::GetTaskDuck(this->m_pPed->m_pPedIntelligence, 1)
          || CPedIntelligence::GetTaskDuck(this->m_pPed->m_pPedIntelligence, 1)->m_nShotWhizzingCounter <= -1 )
        {
          v9 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
          v10 = rand();
          CTaskSimpleDuck::CTaskSimpleDuck(
            v9,
            1u,
            (int)(float)((float)((float)v10 * 0.000015259) * 2000.0) + 3000,
            1000);
          goto LABEL_14;
        }
        TaskDuck = CPedIntelligence::GetTaskDuck(this->m_pPed->m_pPedIntelligence, 1);
        m_pPed = this->m_pPed;
      }
      CTaskSimpleDuck::RestartTask(TaskDuck, m_pPed);
      v9 = 0;
    }
LABEL_14:
    this->m_pTaskEventResponse = v9;
  }
}

//----- (003839C8) --------------------------------------------------------
void __fastcall CEventHandler::ComputeFireNearbyResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v5; // r0
  CTaskComplexExtinguishFires *v6; // r0
  CTask *v7; // r0

  v5 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
  if ( v5 == 200 )
  {
    this->m_pTaskEventResponse = 0;
  }
  else if ( v5 == 604 )
  {
    v6 = (CTaskComplexExtinguishFires *)CTask::operator new(0x10u);
    CTaskComplexExtinguishFires::CTaskComplexExtinguishFires(v6);
    this->m_pTaskEventResponse = v7;
  }
}
// 3839E8: variable 'v7' is possibly undefined

//----- (003839F4) --------------------------------------------------------
void __fastcall CEventHandler::ComputeSeenPanickedPedResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int v6; // r0
  int v7; // r1
  int v8; // r0
  bool v9; // zf
  CEntity *v10; // r5
  int v11; // r0
  CTaskComplexSmartFleeEntity *v12; // r0
  CTask *v13; // r0
  CTaskSimpleDuck *v14; // r0
  CTaskComplexFleeEntity *v15; // r0

  v6 = (*((int (__fastcall **)(CEvent *, _DWORD, CTask *, CTask *))pEvent->_vptr$CEvent + 11))(
         pEvent,
         *((_DWORD *)pEvent->_vptr$CEvent + 11),
         pTaskActive,
         pTaskActiveSimplest);
  if ( v6 )
  {
    v7 = *(_DWORD *)(v6 + 1088);
    v8 = *(_DWORD *)(v7 + 64);
    v9 = v8 == 0;
    if ( !v8 )
    {
      v8 = *(_DWORD *)(v7 + 60);
      v9 = v8 == 0;
    }
    if ( !v9 )
    {
      v10 = (CEntity *)(*(int (__fastcall **)(int))(*(_DWORD *)v8 + 44))(v8);
      if ( v10 )
      {
        v11 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
        switch ( v11 )
        {
          case 427:
            v14 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
            CTaskSimpleDuck::CTaskSimpleDuck(v14, 0, 0xFFFFu, -1);
            break;
          case 909:
            v15 = (CTaskComplexFleeEntity *)CTask::operator new(0x3Cu);
            CTaskComplexFleeEntity::CTaskComplexFleeEntity(
              v15,
              v10,
              1,
              45.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[187],
              1.0);
            break;
          case 911:
            v12 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
            CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
              v12,
              v10,
              1,
              45.0,
              (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
              (const int)&elf_hash_bucket[187],
              1.0);
            break;
          default:
            return;
        }
        this->m_pTaskEventResponse = v13;
      }
    }
  }
}
// 383ACA: variable 'v13' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00383AEC) --------------------------------------------------------
void __fastcall CEventHandler::ComputeAreaCodesResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  int (**v4)(void); // r5
  CTaskSimpleWaitUntilAreaCodesMatch *v6; // r0
  CTask *v7; // r0

  v4 = pEvent[1]._vptr$CEvent;
  if ( v4 )
  {
    v6 = (CTaskSimpleWaitUntilAreaCodesMatch *)CTask::operator new(0x24u);
    CTaskSimpleWaitUntilAreaCodesMatch::CTaskSimpleWaitUntilAreaCodesMatch(v6, (CPed *)v4);
    this->m_pTaskEventResponse = v7;
  }
}
// 383B06: variable 'v7' is possibly undefined

//----- (00383B0C) --------------------------------------------------------
void __fastcall CEventHandler::ComputeOnEscalatorResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskSimpleStandStill *v5; // r0
  CTask *v6; // r0

  v5 = (CTaskSimpleStandStill *)CTask::operator new(0x20u);
  CTaskSimpleStandStill::CTaskSimpleStandStill(v5, 0, 1, 0, 8.0);
  v6->_vptr$CTask = (int (**)(void))&off_66A73C;
  this->m_pTaskEventResponse = v6;
}
// 383B32: variable 'v6' is possibly undefined
// 66A73C: using guessed type void *;
// 6777B8: using guessed type void *`vtable for'CTaskSimpleOnEscalator;

//----- (00383B40) --------------------------------------------------------
void __fastcall CEventHandler::ComputeDangerResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CEntity *m_iAccumulatedTime; // r5
  int v6; // r0
  CTaskComplexSmartFleeEntity *v7; // r0
  CTask *v8; // r0
  CTaskComplexCarDriveMission *v9; // r0

  m_iAccumulatedTime = (CEntity *)pEvent[1].m_iAccumulatedTime;
  if ( m_iAccumulatedTime )
  {
    v6 = *((__int16 *)&pEvent->m_bIsPersistent + 1);
    if ( v6 == 726 )
    {
      if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
      {
        if ( CVehicle::IsDriver(this->m_pPed->m_pMyVehicle, this->m_pPed) )
        {
          v9 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
          CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v9, this->m_pPed->m_pMyVehicle, 0, 1, 2, 40.0);
          v8->_vptr$CTask = (int (**)(void))&off_667284;
        }
        else
        {
          v8 = 0;
        }
        goto LABEL_7;
      }
    }
    else if ( v6 != 911 )
    {
      return;
    }
    v7 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
    CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
      v7,
      m_iAccumulatedTime,
      1,
      100000.0,
      (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
      (const int)&elf_hash_bucket[187],
      1.0);
LABEL_7:
    this->m_pTaskEventResponse = v8;
  }
}
// 383BB6: variable 'v8' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];
// 667284: using guessed type void *off_667284;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;

//----- (00383C14) --------------------------------------------------------
void __fastcall CEventHandler::ComputeDontJoinGroupResponse(
        CEventHandler *this,
        CEvent *pEvent,
        CTask *pTaskActive,
        CTask *pTaskActiveSimplest)
{
  CTaskComplexGangJoinRespond *v5; // r0
  CTask *v6; // r0

  v5 = (CTaskComplexGangJoinRespond *)CTask::operator new(0x14u);
  CTaskComplexGangJoinRespond::CTaskComplexGangJoinRespond(v5, 0);
  this->m_pTaskEventResponse = v6;
}
// 383C26: variable 'v6' is possibly undefined

//----- (00383C2A) --------------------------------------------------------
bool __fastcall CEventHandler::IsKillTaskAppropriate(CPed *pPed, CPed *pOtherPed, const CEvent *event)
{
  int m_nCurrentWeapon; // r5
  bool result; // r0

  result = 1;
  if ( pPed->CharCreatedBy != 2 )
  {
    m_nCurrentWeapon = pOtherPed->m_nCurrentWeapon;
    if ( CWeapon::IsTypeMelee(&pPed->m_WeaponSlots[pPed->m_nCurrentWeapon])
      && !CWeapon::IsTypeMelee(&pOtherPed->m_WeaponSlots[m_nCurrentWeapon]) )
    {
      return 0;
    }
  }
  return result;
}

//----- (00383C70) --------------------------------------------------------
void __fastcall CEventHandler::ComputePersonalityResponseToDamage(
        CEventHandler *this,
        CEventDamage *pEventDamage,
        CEntity *pInflictor)
{
  int m_iTaskType; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v6; // r0
  CTask *v7; // r0
  bool v8; // zf
  CTaskComplexCarDriveMission *v9; // r0
  void **v10; // r1
  int v11; // r8
  CTaskComplexKillPedOnFoot *v12; // r0
  CTaskComplexEvasiveDiveAndGetUp *v13; // r0
  CTaskComplexFleeAnyMeans *v14; // r0
  CTask *v15; // r0
  int m_pMat_low; // r6
  CTaskComplexKillCriminal *v17; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v18; // r0
  CTaskComplexUseClosestFreeScriptedAttractor *v19; // r0
  CPed *v20; // r1
  CVehicle *v21; // r0
  CTaskComplexCarDriveMission *v22; // r0
  CTaskSimpleDuck *v23; // r5
  unsigned __int16 v24; // r0
  CTaskSimpleDuck *v25; // r0
  CTaskComplexKillPedOnFootStealth *v26; // r0
  CTaskComplexSmartFleeEntity *v27; // r0
  CTaskComplexFleeEntity *v28; // r0
  CPed *v29; // r1
  CTaskComplexFleeAnyMeans *v30; // r0
  CPed *m_pPed; // r1
  const CVehicle *m_pMyVehicle; // r0
  CTaskComplexSmartFleeEntity *v33; // r0
  CVector vDiveDir; // [sp+1Ch] [bp-24h] BYREF

  m_iTaskType = pEventDamage->m_iTaskType;
  if ( m_iTaskType > 725 )
  {
    if ( m_iTaskType > 926 )
    {
      if ( m_iTaskType > 1027 )
      {
        if ( m_iTaskType == 1028 )
        {
          v26 = (CTaskComplexKillPedOnFootStealth *)CTask::operator new(0x48u);
          CTaskComplexKillPedOnFootStealth::CTaskComplexKillPedOnFootStealth(v26, (CPed *)pInflictor);
          goto LABEL_65;
        }
        if ( m_iTaskType != 1105 )
          return;
        if ( CPed::IsPlayer((const CPed *)pInflictor) )
        {
LABEL_37:
          v7 = 0;
          goto LABEL_65;
        }
        if ( this->m_pPed->CharCreatedBy == 2
          || (m_pMat_low = SLOBYTE(pInflictor[30].m_pMat),
              !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
          || CWeapon::IsTypeMelee((const CWeapon *)&pInflictor[24].m_transform + m_pMat_low) )
        {
          v17 = (CTaskComplexKillCriminal *)CTask::operator new(0x20u);
          CTaskComplexKillCriminal::CTaskComplexKillCriminal(v17, (CPed *)pInflictor, 0);
          goto LABEL_65;
        }
        goto LABEL_64;
      }
      if ( m_iTaskType != 927 )
      {
        if ( m_iTaskType != 1000 )
          return;
        if ( this->m_pPed->CharCreatedBy == 2
          || (v11 = SLOBYTE(pInflictor[30].m_pMat),
              !CWeapon::IsTypeMelee(&this->m_pPed->m_WeaponSlots[this->m_pPed->m_nCurrentWeapon]))
          || CWeapon::IsTypeMelee((const CWeapon *)&pInflictor[24].m_transform + v11) )
        {
LABEL_19:
          v12 = (CTaskComplexKillPedOnFoot *)CTask::operator new(0x38u);
          CTaskComplexKillPedOnFoot::CTaskComplexKillPedOnFoot(v12, (CPed *)pInflictor, -1, 0, 0, 0, 1);
LABEL_65:
          this->m_pTaskEventResponse = v7;
          return;
        }
        m_pPed = this->m_pPed;
        if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) != 0
          && *(_DWORD *)&pInflictor[23].numLodChildren == 6 )
        {
          goto LABEL_57;
        }
        if ( (*(_DWORD *)&this->m_pPed->m_nPedFlags & 0x100) != 0 )
        {
          m_pMyVehicle = m_pPed->m_pMyVehicle;
          if ( m_pMyVehicle )
          {
            if ( CVehicle::IsDriver(m_pMyVehicle, m_pPed) )
              goto LABEL_42;
          }
        }
        goto LABEL_64;
      }
    }
    else
    {
      if ( m_iTaskType <= 908 )
      {
        if ( m_iTaskType != 726 )
        {
          if ( m_iTaskType != 729 )
            return;
          v8 = *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 == 0;
          if ( *((unsigned __int8 *)&this->m_pPed->m_nPedFlags + 1) << 31 )
            v8 = this->m_pPed->m_pMyVehicle == 0;
          if ( !v8 )
          {
            v9 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
            CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(
              v9,
              this->m_pPed->m_pMyVehicle,
              pInflictor,
              54,
              3,
              40.0);
            v10 = &`vtable for'CTaskComplexCarDriveMissionKillPed;
LABEL_43:
            v7->_vptr$CTask = (int (**)(void))((char *)*v10 + 8);
            goto LABEL_65;
          }
          goto LABEL_19;
        }
        v20 = this->m_pPed;
        v21 = this->m_pPed->m_pMyVehicle;
        if ( v21 )
        {
          if ( CVehicle::IsDriver(v21, v20) )
          {
LABEL_42:
            v22 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
            CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v22, this->m_pPed->m_pMyVehicle, 0, 1, 2, 40.0);
            v10 = &`vtable for'CTaskComplexCarDriveMissionFleeScene;
            goto LABEL_43;
          }
          v20 = this->m_pPed;
        }
        if ( (*((_DWORD *)&v20->m_nPedFlags + 3) & 0x800) != 0 && *(_DWORD *)&pInflictor[23].numLodChildren == 6 )
        {
LABEL_57:
          v30 = (CTaskComplexFleeAnyMeans *)CTask::operator new(0x54u);
          CTaskComplexFleeAnyMeans::CTaskComplexFleeAnyMeans(
            v30,
            pInflictor,
            1,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[937],
            (const int)&elf_hash_bucket[937],
            20.0,
            (const int)&elf_hash_bucket[187],
            1.0);
          goto LABEL_65;
        }
LABEL_64:
        v33 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
        CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
          v33,
          pInflictor,
          0,
          60.0,
          (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
          (const int)&elf_hash_bucket[187],
          1.0);
        goto LABEL_65;
      }
      if ( m_iTaskType == 909 )
      {
        if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) == 0 )
        {
          v28 = (CTaskComplexFleeEntity *)CTask::operator new(0x3Cu);
          CTaskComplexFleeEntity::CTaskComplexFleeEntity(
            v28,
            pInflictor,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          goto LABEL_53;
        }
      }
      else
      {
        if ( m_iTaskType != 911 )
          return;
        if ( (*((_DWORD *)&this->m_pPed->m_nPedFlags + 3) & 0x800) == 0
          || *(_DWORD *)&pInflictor[23].numLodChildren != 6 )
        {
          v27 = (CTaskComplexSmartFleeEntity *)CTask::operator new(0x40u);
          CTaskComplexSmartFleeEntity::CTaskComplexSmartFleeEntity(
            v27,
            pInflictor,
            0,
            60.0,
            (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
            (const int)&elf_hash_bucket[187],
            1.0);
          goto LABEL_53;
        }
      }
    }
    v14 = (CTaskComplexFleeAnyMeans *)CTask::operator new(0x54u);
    CTaskComplexFleeAnyMeans::CTaskComplexFleeAnyMeans(
      v14,
      pInflictor,
      1,
      60.0,
      (const int)"ist_FillGlobeColPointsER8CPtrListRK8CColLineRP7CEntitybP15CStoredCollPoly",
      (const int)&elf_hash_bucket[937],
      (const int)&elf_hash_bucket[937],
      20.0,
      (const int)&elf_hash_bucket[187],
      1.0);
LABEL_53:
    v29 = this->m_pPed;
    this->m_pTaskEventResponse = v15;
    CPed::Say(v29, 0xB2u, 0, 1.0, 0, 0, 0);
    return;
  }
  if ( m_iTaskType <= 414 )
  {
    switch ( pEventDamage->m_iTaskType )
    {
      case 0xFB:
        goto LABEL_37;
      case 0xFC:
      case 0xFD:
      case 0xFE:
      case 0xFF:
      case 0x100:
      case 0x101:
      case 0x103:
      case 0x104:
        return;
      case 0x102:
        v6 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
        CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v6, 0);
        goto LABEL_65;
      case 0x105:
        v18 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
        CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v18, 0);
        v7[1].m_pParent = (CTask *)&byte_6;
        v10 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;
        goto LABEL_43;
      case 0x106:
        v19 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
        CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v19, 0);
        v7[1].m_pParent = (CTask *)&byte_7;
        v10 = &`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
        goto LABEL_43;
      default:
        if ( m_iTaskType == 200 )
          goto LABEL_37;
        break;
    }
    return;
  }
  if ( m_iTaskType != 415 )
  {
    if ( m_iTaskType == 427 )
    {
      v25 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
      CTaskSimpleDuck::CTaskSimpleDuck(v25, 0, 0xFFFFu, -1);
      goto LABEL_65;
    }
    if ( m_iTaskType != 513 )
      return;
    v13 = (CTaskComplexEvasiveDiveAndGetUp *)CTask::operator new(0x24u);
    memset(&vDiveDir, 0, sizeof(vDiveDir));
    CTaskComplexEvasiveDiveAndGetUp::CTaskComplexEvasiveDiveAndGetUp(v13, 0, 0, &vDiveDir, 1);
    v10 = &`vtable for'CTaskComplexDiveFromAttachedEntityAndGetUp;
    goto LABEL_43;
  }
  if ( !CPedIntelligence::GetTaskDuck(this->m_pPed->m_pPedIntelligence, 1) )
  {
    v23 = (CTaskSimpleDuck *)CTask::operator new(0x28u);
    v24 = rand();
    CTaskSimpleDuck::CTaskSimpleDuck(v23, 0, (int)(float)((float)((float)v24 * 0.000015259) * 3000.0) + 2000, -1);
    this->m_pTaskEventResponse = v23;
  }
}
// 383F00: variable 'v7' is possibly undefined
// 384116: variable 'v15' is possibly undefined
// 6: using guessed type char byte_6;
// 7: using guessed type char byte_7;
// FC: using guessed type int elf_hash_bucket[16411];
// 675F04: using guessed type void *`vtable for'CTaskComplexDiveFromAttachedEntityAndGetUp;
// 676C0C: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;
// 677834: using guessed type void *`vtable for'CTaskComplexCarDriveMissionKillPed;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;
// 678A48: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;

//----- (003843DC) --------------------------------------------------------
void __fastcall CEventHandler::RegisterKill(
        const CPed *pPed,
        const CEntity *pInflictor,
        const eWeaponType eWeaponUsed,
        const bool bHeadShot)
{
  CEntity::CEntityInfo m_info; // r0
  _BOOL4 IsPlayer; // r0
  bool v10; // zf
  CPlayerInfo *v11; // r0
  float v12; // s0

  if ( pPed )
  {
    if ( !pInflictor )
      goto LABEL_11;
    m_info = pInflictor->m_info;
    if ( (*(_BYTE *)&m_info & 7) == 3 )
    {
      IsPlayer = CPed::IsPlayer((const CPed *)pInflictor);
      v10 = pPed == pInflictor;
      if ( pPed != pInflictor )
        v10 = !IsPlayer;
      if ( !v10 )
      {
        v11 = &CWorld::Players[CWorld::PlayerInFocus];
        v12 = v11->CurrentChaseValue + 5.0;
        v11->HavocCaused += 10;
        v11->CurrentChaseValue = v12;
        CDarkel::RegisterKillByPlayer(pPed, eWeaponUsed, bHeadShot, *(_DWORD *)&pInflictor[23].numLodChildren);
        sub_19C444();
        return;
      }
      m_info = pInflictor->m_info;
    }
    if ( (*(_BYTE *)&m_info & 7) == 2 && FindPlayerVehicle(-1, 0) == pInflictor )
      sub_194CA0(0x79u, 1.0);
    else
LABEL_11:
      sub_1A0574(pPed, eWeaponUsed);
  }
}

//----- (003844A4) --------------------------------------------------------
void __fastcall CTaskComplexCarDriveMissionFleeScene::~CTaskComplexCarDriveMissionFleeScene(
        CTaskComplexCarDriveMissionFleeScene *this)
{
  void *v1; // r0

  CTaskComplexCarDriveMission::~CTaskComplexCarDriveMission(this);
  sub_197118(v1);
}
// 3844B0: variable 'v1' is possibly undefined

//----- (003844B4) --------------------------------------------------------
CTask *__fastcall CTaskComplexCarDriveMissionFleeScene::Clone(const CTaskComplexCarDriveMissionFleeScene *this)
{
  CTaskComplexCarDriveMission *v2; // r0
  CTask *result; // r0

  v2 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
  CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v2, this->m_pVehicle, 0, 1, 2, 40.0);
  result->_vptr$CTask = (int (**)(void))&off_667284;
  return result;
}
// 3844E0: variable 'result' is possibly undefined
// 667284: using guessed type void *off_667284;
// 677E30: using guessed type void *`vtable for'CTaskComplexCarDriveMissionFleeScene;

//----- (003844EC) --------------------------------------------------------
int __fastcall CTaskComplexCarDriveMissionFleeScene::GetTaskType(const CTaskComplexCarDriveMissionFleeScene *this)
{
  return 726;
}

//----- (003844F4) --------------------------------------------------------
void __fastcall CTaskComplexCarDriveMissionFleeScene::Serialize(CTaskComplexCarDriveMissionFleeScene *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  CVehicle *m_pVehicle; // r0
  int v5; // r4
  _DWORD *v6; // r5
  void *v7; // r0
  int v8; // r0
  _DWORD *v9; // r4

  v2 = (*((int (__fastcall **)(CTaskComplexCarDriveMissionFleeScene *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskComplexCarDriveMissionFleeScene *))this->_vptr$CTask + 5))(this) == 726 )
  {
    m_pVehicle = this->m_pVehicle;
    if ( m_pVehicle )
    {
      v5 = GettPoolVehicleRef(m_pVehicle);
      if ( UseDataFence )
        AddDataFence();
      v6 = malloc(4u);
      *v6 = v5;
      CGenericGameStorage::_SaveDataToWorkBuffer(v6, 4);
      v7 = v6;
    }
    else
    {
      if ( UseDataFence )
        AddDataFence();
      v9 = malloc(4u);
      *v9 = -1;
      CGenericGameStorage::_SaveDataToWorkBuffer(v9, 4);
      v7 = v9;
    }
    j_free(v7);
  }
  else
  {
    v8 = (*((int (__fastcall **)(CTaskComplexCarDriveMissionFleeScene *))this->_vptr$CTask + 5))(this);
    sub_1941C4(726, v8);
  }
}

//----- (003845C8) --------------------------------------------------------
void __fastcall CTaskComplexUseClosestFreeScriptedAttractorRun::~CTaskComplexUseClosestFreeScriptedAttractorRun(
        CTaskComplexUseClosestFreeScriptedAttractorRun *this)
{
  void *v1; // r0

  CTaskComplexUseClosestFreeScriptedAttractor::~CTaskComplexUseClosestFreeScriptedAttractor(this);
  sub_197118(v1);
}
// 3845D4: variable 'v1' is possibly undefined

//----- (003845D8) --------------------------------------------------------
CTask *__fastcall CTaskComplexUseClosestFreeScriptedAttractorRun::Clone(
        const CTaskComplexUseClosestFreeScriptedAttractorRun *this)
{
  CTaskComplexUseClosestFreeScriptedAttractor *v1; // r0
  CTask *result; // r0

  v1 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
  CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v1, 0);
  result[1].m_pParent = (CTask *)&byte_6;
  result->_vptr$CTask = (int (**)(void))&off_6672CC;
  return result;
}
// 3845EC: variable 'result' is possibly undefined
// 6: using guessed type char byte_6;
// 6672CC: using guessed type void *;
// 678A48: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorRun;

//----- (003845FC) --------------------------------------------------------
int __fastcall CTaskComplexUseClosestFreeScriptedAttractorRun::GetTaskType(
        const CTaskComplexUseClosestFreeScriptedAttractorRun *this)
{
  return 261;
}

//----- (00384604) --------------------------------------------------------
void __fastcall CTaskComplexUseClosestFreeScriptedAttractorRun::Serialize(
        CTaskComplexUseClosestFreeScriptedAttractorRun *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  int v4; // r0

  v2 = (*((int (__fastcall **)(CTaskComplexUseClosestFreeScriptedAttractorRun *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskComplexUseClosestFreeScriptedAttractorRun *))this->_vptr$CTask + 5))(this) != 261 )
  {
    v4 = (*((int (__fastcall **)(CTaskComplexUseClosestFreeScriptedAttractorRun *))this->_vptr$CTask + 5))(this);
    sub_1941C4(261, v4);
  }
}

//----- (00384674) --------------------------------------------------------
void __fastcall CTaskComplexUseClosestFreeScriptedAttractorSprint::~CTaskComplexUseClosestFreeScriptedAttractorSprint(
        CTaskComplexUseClosestFreeScriptedAttractorSprint *this)
{
  void *v1; // r0

  CTaskComplexUseClosestFreeScriptedAttractor::~CTaskComplexUseClosestFreeScriptedAttractor(this);
  sub_197118(v1);
}
// 384680: variable 'v1' is possibly undefined

//----- (00384684) --------------------------------------------------------
CTask *__fastcall CTaskComplexUseClosestFreeScriptedAttractorSprint::Clone(
        const CTaskComplexUseClosestFreeScriptedAttractorSprint *this)
{
  CTaskComplexUseClosestFreeScriptedAttractor *v1; // r0
  CTask *result; // r0

  v1 = (CTaskComplexUseClosestFreeScriptedAttractor *)CTask::operator new(0x10u);
  CTaskComplexUseClosestFreeScriptedAttractor::CTaskComplexUseClosestFreeScriptedAttractor(v1, 0);
  result[1].m_pParent = (CTask *)&byte_7;
  result->_vptr$CTask = (int (**)(void))&off_667308;
  return result;
}
// 384698: variable 'result' is possibly undefined
// 7: using guessed type char byte_7;
// 667308: using guessed type void *;
// 676C0C: using guessed type void *`vtable for'CTaskComplexUseClosestFreeScriptedAttractorSprint;

//----- (003846A8) --------------------------------------------------------
int __fastcall CTaskComplexUseClosestFreeScriptedAttractorSprint::GetTaskType(
        const CTaskComplexUseClosestFreeScriptedAttractorSprint *this)
{
  return 262;
}

//----- (003846B0) --------------------------------------------------------
void __fastcall CTaskComplexUseClosestFreeScriptedAttractorSprint::Serialize(
        CTaskComplexUseClosestFreeScriptedAttractorSprint *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  int v4; // r0

  v2 = (*((int (__fastcall **)(CTaskComplexUseClosestFreeScriptedAttractorSprint *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskComplexUseClosestFreeScriptedAttractorSprint *))this->_vptr$CTask + 5))(this) != 262 )
  {
    v4 = (*((int (__fastcall **)(CTaskComplexUseClosestFreeScriptedAttractorSprint *))this->_vptr$CTask + 5))(this);
    sub_1941C4(262, v4);
  }
}

//----- (0038471C) --------------------------------------------------------
void __fastcall CTaskComplexCarDriveMissionKillPed::~CTaskComplexCarDriveMissionKillPed(
        CTaskComplexCarDriveMissionKillPed *this)
{
  void *v1; // r0

  CTaskComplexCarDriveMission::~CTaskComplexCarDriveMission(this);
  sub_197118(v1);
}
// 384728: variable 'v1' is possibly undefined

//----- (0038472C) --------------------------------------------------------
CTask *__fastcall CTaskComplexCarDriveMissionKillPed::Clone(const CTaskComplexCarDriveMissionKillPed *this)
{
  CTaskComplexCarDriveMission *v2; // r0
  CTask *result; // r0

  v2 = (CTaskComplexCarDriveMission *)CTask::operator new(0x2Cu);
  CTaskComplexCarDriveMission::CTaskComplexCarDriveMission(v2, this->m_pVehicle, this->m_pTargetEntity, 54, 3, 40.0);
  result->_vptr$CTask = (int (**)(void))&off_667344;
  return result;
}
// 384758: variable 'result' is possibly undefined
// 667344: using guessed type void *;
// 677834: using guessed type void *`vtable for'CTaskComplexCarDriveMissionKillPed;

//----- (00384764) --------------------------------------------------------
int __fastcall CTaskComplexCarDriveMissionKillPed::GetTaskType(const CTaskComplexCarDriveMissionKillPed *this)
{
  return 729;
}

//----- (0038476C) --------------------------------------------------------
void __fastcall CTaskComplexCarDriveMissionKillPed::Serialize(CTaskComplexCarDriveMissionKillPed *this)
{
  int v2; // r5
  _DWORD *v3; // r6
  CVehicle *m_pVehicle; // r0
  int v5; // r5
  _DWORD *v6; // r6
  void *v7; // r0
  int v8; // r0
  _DWORD *v9; // r5
  CEntity *m_pTargetEntity; // r0
  int v11; // r6
  _DWORD *v12; // r5
  CEntity *v13; // r0
  int v14; // r1
  int v15; // r4
  _DWORD *v16; // r4
  _DWORD *v17; // r5

  v2 = (*((int (__fastcall **)(CTaskComplexCarDriveMissionKillPed *))this->_vptr$CTask + 5))(this);
  if ( UseDataFence )
    AddDataFence();
  v3 = malloc(4u);
  *v3 = v2;
  CGenericGameStorage::_SaveDataToWorkBuffer(v3, 4);
  free(v3);
  if ( (*((int (__fastcall **)(CTaskComplexCarDriveMissionKillPed *))this->_vptr$CTask + 5))(this) != 729 )
  {
    v8 = (*((int (__fastcall **)(CTaskComplexCarDriveMissionKillPed *))this->_vptr$CTask + 5))(this);
    sub_1941C4(729, v8);
    return;
  }
  m_pVehicle = this->m_pVehicle;
  if ( m_pVehicle )
  {
    v5 = GettPoolVehicleRef(m_pVehicle);
    if ( UseDataFence )
      AddDataFence();
    v6 = malloc(4u);
    *v6 = v5;
    CGenericGameStorage::_SaveDataToWorkBuffer(v6, 4);
    v7 = v6;
  }
  else
  {
    if ( UseDataFence )
      AddDataFence();
    v9 = malloc(4u);
    *v9 = -1;
    CGenericGameStorage::_SaveDataToWorkBuffer(v9, 4);
    v7 = v9;
  }
  free(v7);
  m_pTargetEntity = this->m_pTargetEntity;
  if ( m_pTargetEntity )
  {
    v11 = *(_BYTE *)&m_pTargetEntity->m_info & 7;
    if ( UseDataFence )
      AddDataFence();
    v12 = malloc(4u);
    *v12 = v11;
    CGenericGameStorage::_SaveDataToWorkBuffer(v12, 4);
    free(v12);
    v13 = this->m_pTargetEntity;
    v14 = *(_BYTE *)&v13->m_info & 7;
    switch ( v14 )
    {
      case 2:
        v15 = GettPoolVehicleRef((CVehicle *)v13);
        break;
      case 4:
        v15 = GettPoolObjRef((CObject *)v13);
        break;
      case 3:
        v15 = GettPoolPedRef((CPed *)v13);
        break;
      default:
        return;
    }
    if ( UseDataFence )
      AddDataFence();
    v17 = malloc(4u);
    *v17 = v15;
    CGenericGameStorage::_SaveDataToWorkBuffer(v17, 4);
    j_free(v17);
  }
  else
  {
    if ( UseDataFence )
      AddDataFence();
    v16 = malloc(4u);
    *v16 = 0;
    CGenericGameStorage::_SaveDataToWorkBuffer(v16, 4);
    j_free(v16);
  }
}

//----- (0038490C) --------------------------------------------------------
void __fastcall CAtomicModelInfo::SetAtomic(CAtomicModelInfo *this, RpAtomic_0 *pAtomic)
{
  RwObject_0 *m_pRwObject; // r0
  int v5; // r2
  RwInt32 v6; // r0
  int *v7; // r1
  int v8; // r1
  int *v9; // r0
  int v10; // r0
  int32 v11; // r0
  uint16 m_flags; // r0

  m_pRwObject = this->m_pRwObject;
  if ( m_pRwObject )
  {
    v5 = *(_DWORD *)&m_pRwObject[3].type;
    v6 = g2dEffectPluginOffset;
    v7 = *(int **)(v5 + g2dEffectPluginOffset);
    if ( v7 )
      v8 = *v7;
    else
      LOBYTE(v8) = 0;
    this->m_num2dEffects -= v8;
  }
  else
  {
    v6 = g2dEffectPluginOffset;
  }
  this->m_pRwObject = &pAtomic->object.object;
  v9 = *(int **)(&pAtomic->geometry->object.type + v6);
  if ( v9 )
    v10 = *v9;
  else
    LOBYTE(v10) = 0;
  this->m_num2dEffects += v10;
  CBaseModelInfo::AddTexDictionaryRef(this);
  if ( (*((int (__fastcall **)(CAtomicModelInfo *))this->_vptr$CBaseModelInfo + 15))(this) != -1 )
  {
    v11 = (*((int (__fastcall **)(CAtomicModelInfo *))this->_vptr$CBaseModelInfo + 15))(this);
    CAnimManager::AddAnimBlockRef(v11);
  }
  if ( CCustomBuildingRenderer::IsCBPCPipelineAttached(pAtomic) )
  {
    CCustomBuildingRenderer::AtomicSetup(pAtomic);
  }
  else if ( CCarFXRenderer::IsCCPCPipelineAttached(pAtomic) )
  {
    CCarFXRenderer::SetCustomFXAtomicRenderPipelinesVMICB(pAtomic, 0);
  }
  m_flags = this->m_flags;
  if ( (m_flags & 0xF800) == 12288 )
  {
    CTagManager::SetupAtomic(pAtomic);
    m_flags = this->m_flags;
  }
  this->m_flags = m_flags | 1;
}

//----- (003849C0) --------------------------------------------------------
void __fastcall CAtomicModelInfo::DeleteRwObject(CAtomicModelInfo *this)
{
  RpAtomic_0 *m_pRwObject; // r0
  int *v3; // r1
  int v4; // r1
  RwFrame_0 *parent; // r5
  int32 v6; // r0

  m_pRwObject = (RpAtomic_0 *)this->m_pRwObject;
  if ( m_pRwObject )
  {
    v3 = *(int **)(&m_pRwObject->geometry->object.type + g2dEffectPluginOffset);
    if ( v3 )
      v4 = *v3;
    else
      LOBYTE(v4) = 0;
    this->m_num2dEffects -= v4;
    parent = (RwFrame_0 *)m_pRwObject->object.object.parent;
    RpAtomicDestroy(m_pRwObject);
    RwFrameDestroy(parent);
    this->m_pRwObject = 0;
    CBaseModelInfo::RemoveTexDictionaryRef(this);
    if ( (*((int (__fastcall **)(CAtomicModelInfo *))this->_vptr$CBaseModelInfo + 15))(this) != -1 )
    {
      v6 = (*((int (__fastcall **)(CAtomicModelInfo *))this->_vptr$CBaseModelInfo + 15))(this);
      sub_18AB28(v6);
    }
  }
}

//----- (00384A2C) --------------------------------------------------------
RpAtomic_0 *__fastcall CAtomicModelInfo::GetAtomicFromDistance(CAtomicModelInfo *this, float dist)
{
  if ( (float)(this->m_lodDistance * TheCamera.LODDistMultiplier) <= dist )
    return 0;
  else
    return (RpAtomic_0 *)this->m_pRwObject;
}

//----- (00384A58) --------------------------------------------------------
RwObject_0 *__fastcall CAtomicModelInfo::CreateInstance(CAtomicModelInfo *this, RwMatrix *pMatrix)
{
  RpAtomic_0 *v4; // r5
  RwFrame_0 *v5; // r1
  __int64 v6; // d16
  __int64 v7; // d17
  __int64 v8; // d19
  __int64 v9; // d22
  __int64 v10; // d23
  __int64 v11; // d20
  __int64 v12; // d21

  if ( !this->m_pRwObject )
    return 0;
  CBaseModelInfo::AddRef(this);
  v4 = RpAtomicClone((RpAtomic_0 *)this->m_pRwObject);
  v5 = RwFrameCreate();
  v6 = *(_QWORD *)&pMatrix->right.x;
  v7 = *(_QWORD *)&pMatrix->right.z;
  v8 = *(_QWORD *)&pMatrix->pos.z;
  v9 = *(_QWORD *)&pMatrix->up.x;
  v10 = *(_QWORD *)&pMatrix->up.z;
  v11 = *(_QWORD *)&pMatrix->at.x;
  v12 = *(_QWORD *)&pMatrix->at.z;
  *(_QWORD *)&v5->modelling.pos.x = *(_QWORD *)&pMatrix->pos.x;
  *(_QWORD *)&v5->modelling.pos.z = v8;
  *(_QWORD *)&v5->modelling.at.x = v11;
  *(_QWORD *)&v5->modelling.at.z = v12;
  *(_QWORD *)&v5->modelling.right.x = v6;
  *(_QWORD *)&v5->modelling.right.z = v7;
  *(_QWORD *)&v5->modelling.up.x = v9;
  *(_QWORD *)&v5->modelling.up.z = v10;
  RpAtomicSetFrame(v4, v5);
  CBaseModelInfo::RemoveRef(this);
  return &v4->object.object;
}

//----- (00384ACE) --------------------------------------------------------
RwObject_0 *__fastcall CAtomicModelInfo::CreateInstance(CAtomicModelInfo *this)
{
  RpAtomic_0 *v2; // r5
  RwFrame_0 *v3; // r0

  if ( !this->m_pRwObject )
    return 0;
  CBaseModelInfo::AddRef(this);
  v2 = RpAtomicClone((RpAtomic_0 *)this->m_pRwObject);
  v3 = RwFrameCreate();
  RpAtomicSetFrame(v2, v3);
  CBaseModelInfo::RemoveRef(this);
  return &v2->object.object;
}

//----- (00384B04) --------------------------------------------------------
void __fastcall CAtomicModelInfo::SetupVehicleUpgradeFlags(CAtomicModelInfo *this, const unsigned __int8 *pName)
{
  int m_flags; // r1
  int v5; // r8
  int v6; // r6
  int v7; // r6
  int v8; // r0

  m_flags = (__int16)this->m_flags;
  if ( m_flags >= 0 )
  {
    v5 = (unsigned __int8)m_flags;
    this->m_flags = (unsigned __int8)m_flags;
    if ( !strncmp("bnt_", (const char *)pName, 4u) )
    {
      v6 = 0;
    }
    else if ( !strncmp("bntl_", (const char *)pName, 5u) )
    {
      v6 = 1;
    }
    else if ( !strncmp("bntr_", (const char *)pName, 5u) )
    {
      v6 = 2;
    }
    else if ( !strncmp("spl_", (const char *)pName, 4u) )
    {
      v6 = 3;
    }
    else if ( !strncmp("wg_l_", (const char *)pName, 5u) )
    {
      v6 = 4;
    }
    else
    {
      v6 = 5;
      if ( strncmp("wg_r_", (const char *)pName, 5u) )
      {
        if ( !strncmp("fbb_", (const char *)pName, 4u) )
        {
          v6 = 6;
        }
        else if ( !strncmp("bbb_", (const char *)pName, 4u) )
        {
          v6 = 7;
        }
        else if ( !strncmp("lgt_", (const char *)pName, 4u) )
        {
          v6 = 8;
        }
        else if ( !strncmp("rf_", (const char *)pName, 3u) )
        {
          v6 = 9;
        }
        else if ( !strncmp("nto_", (const char *)pName, 4u) )
        {
          v6 = 10;
        }
        else if ( !strncmp("hydralics", (const char *)pName, 9u) )
        {
          v6 = 11;
        }
        else
        {
          if ( strncmp("stereo", (const char *)pName, 6u) )
          {
            if ( !strncmp("chss_", (const char *)pName, 5u) )
            {
              v7 = 0;
            }
            else if ( !strncmp("wheel_", (const char *)pName, 6u) )
            {
              v7 = 1;
            }
            else if ( !strncmp("exh_", (const char *)pName, 4u) )
            {
              v7 = 2;
            }
            else if ( !strncmp("fbmp_", (const char *)pName, 5u) )
            {
              v7 = 3;
            }
            else if ( !strncmp("rbmp_", (const char *)pName, 5u) )
            {
              v7 = 4;
            }
            else if ( !strncmp("misc_a_", (const char *)pName, 7u) )
            {
              v7 = 5;
            }
            else if ( !strncmp("misc_b_", (const char *)pName, 7u) )
            {
              v7 = 6;
            }
            else
            {
              v7 = 7;
              if ( strncmp("misc_c_", (const char *)pName, 7u) )
                return;
            }
            v8 = v5 | (CAtomicModelInfo::SetupVehicleUpgradeFlags(char const*)::pReplacementPrefixes[v7].id << 10) | 0x8100;
            goto LABEL_37;
          }
          v6 = 12;
        }
      }
    }
    v8 = v5 | (CAtomicModelInfo::SetupVehicleUpgradeFlags(char const*)::pUpgradePrefixes[v6].id << 10) | 0x8000;
LABEL_37:
    this->m_flags = v8;
  }
}

//----- (00384D50) --------------------------------------------------------
CTimeInfo *__fastcall CTimeInfo::FindOtherTimeModel(CTimeInfo *this, const unsigned __int8 *pName)
{
  char *v3; // r0
  int v4; // r1
  uint32 UppercaseKey; // r9
  CTimeInfo *result; // r0
  int v7; // r1
  int v8; // r5
  CBaseModelInfo *v9; // r6
  char v10[24]; // [sp+4h] [bp-34h] BYREF

  strcpy(v10, (const char *)pName);
  v3 = strstr(v10, (const char *)&dword_384E00);
  if ( v3 )
  {
    v4 = 7955551;
  }
  else
  {
    v3 = strstr(v10, (const char *)&dword_384E04);
    if ( !v3 )
      return 0;
    v4 = 7630431;
  }
  *(_DWORD *)v3 = v4;
  UppercaseKey = CKeyGen::GetUppercaseKey((const unsigned __int8 *)v10);
  result = 0;
  v7 = 0;
  do
  {
    v8 = v7;
    v9 = CModelInfo::ms_modelInfoPtrs[v7];
    if ( v9 )
    {
      result = (CTimeInfo *)(*((int (__fastcall **)(CBaseModelInfo *))v9->_vptr$CBaseModelInfo + 6))(v9);
      if ( result )
      {
        if ( v9->m_hashKey == UppercaseKey )
        {
          LOWORD(v7) = v8;
          goto LABEL_14;
        }
      }
      else
      {
        result = 0;
      }
    }
    v7 = v8 + 1;
  }
  while ( v8 < 19999 );
  if ( v8 == 19999 )
    return 0;
LABEL_14:
  this->m_otherModel = v7;
  return result;
}
// 384E00: using guessed type int dword_384E00;
// 384E04: using guessed type int dword_384E04;

//----- (00384E10) --------------------------------------------------------
void __fastcall CDamageAtomicModelInfo::Init(CDamageAtomicModelInfo *this)
{
  CBaseModelInfo::Init(this);
  this->m_pDamageAtomic = 0;
}

//----- (00384E20) --------------------------------------------------------
void __fastcall CDamageAtomicModelInfo::SetDamagedAtomic(CDamageAtomicModelInfo *this, RpAtomic_0 *pAtomic)
{
  this->m_pDamageAtomic = pAtomic;
  if ( CCustomBuildingRenderer::IsCBPCPipelineAttached(pAtomic) )
  {
    sub_19EE0C(pAtomic);
  }
  else if ( CCarFXRenderer::IsCCPCPipelineAttached(pAtomic) )
  {
    sub_18C3A4(pAtomic, 0);
  }
}

//----- (00384E54) --------------------------------------------------------
RwObject_0 *__fastcall CDamageAtomicModelInfo::CreateInstance(CDamageAtomicModelInfo *this, RwMatrix *pMatrix)
{
  RpAtomic_0 *m_pDamageAtomic; // r0
  RpAtomic_0 *v5; // r4
  RwFrame_0 *v6; // r1
  __int64 v7; // d16
  __int64 v8; // d17
  __int64 v9; // d19
  __int64 v10; // d22
  __int64 v11; // d23
  __int64 v12; // d20
  __int64 v13; // d21
  RwFrame_0 *v14; // r1
  __int64 v15; // d16
  __int64 v16; // d17
  __int64 v17; // d19
  __int64 v18; // d22
  __int64 v19; // d23
  __int64 v20; // d20
  __int64 v21; // d21

  if ( !CDamageAtomicModelInfo::m_bCreateDamagedVersion )
  {
    if ( this->m_pRwObject )
    {
      CBaseModelInfo::AddRef(this);
      v5 = RpAtomicClone((RpAtomic_0 *)this->m_pRwObject);
      v14 = RwFrameCreate();
      v15 = *(_QWORD *)&pMatrix->right.x;
      v16 = *(_QWORD *)&pMatrix->right.z;
      v17 = *(_QWORD *)&pMatrix->pos.z;
      v18 = *(_QWORD *)&pMatrix->up.x;
      v19 = *(_QWORD *)&pMatrix->up.z;
      v20 = *(_QWORD *)&pMatrix->at.x;
      v21 = *(_QWORD *)&pMatrix->at.z;
      *(_QWORD *)&v14->modelling.pos.x = *(_QWORD *)&pMatrix->pos.x;
      *(_QWORD *)&v14->modelling.pos.z = v17;
      *(_QWORD *)&v14->modelling.at.x = v20;
      *(_QWORD *)&v14->modelling.at.z = v21;
      *(_QWORD *)&v14->modelling.right.x = v15;
      *(_QWORD *)&v14->modelling.right.z = v16;
      *(_QWORD *)&v14->modelling.up.x = v18;
      *(_QWORD *)&v14->modelling.up.z = v19;
      RpAtomicSetFrame(v5, v14);
      CBaseModelInfo::RemoveRef(this);
      return &v5->object.object;
    }
    return 0;
  }
  m_pDamageAtomic = this->m_pDamageAtomic;
  if ( !m_pDamageAtomic )
    return 0;
  v5 = RpAtomicClone(m_pDamageAtomic);
  v6 = RwFrameCreate();
  v7 = *(_QWORD *)&pMatrix->right.x;
  v8 = *(_QWORD *)&pMatrix->right.z;
  v9 = *(_QWORD *)&pMatrix->pos.z;
  v10 = *(_QWORD *)&pMatrix->up.x;
  v11 = *(_QWORD *)&pMatrix->up.z;
  v12 = *(_QWORD *)&pMatrix->at.x;
  v13 = *(_QWORD *)&pMatrix->at.z;
  *(_QWORD *)&v6->modelling.pos.x = *(_QWORD *)&pMatrix->pos.x;
  *(_QWORD *)&v6->modelling.pos.z = v9;
  *(_QWORD *)&v6->modelling.at.x = v12;
  *(_QWORD *)&v6->modelling.at.z = v13;
  *(_QWORD *)&v6->modelling.right.x = v7;
  *(_QWORD *)&v6->modelling.right.z = v8;
  *(_QWORD *)&v6->modelling.up.x = v10;
  *(_QWORD *)&v6->modelling.up.z = v11;
  RpAtomicSetFrame(v5, v6);
  return &v5->object.object;
}

//----- (00384F2C) --------------------------------------------------------
RwObject_0 *__fastcall CDamageAtomicModelInfo::CreateInstance(CDamageAtomicModelInfo *this)
{
  RpAtomic_0 *m_pDamageAtomic; // r0
  RpAtomic_0 *v3; // r4
  RwFrame_0 *v4; // r0
  RpAtomic_0 *v6; // r4
  RwFrame_0 *v7; // r0

  if ( CDamageAtomicModelInfo::m_bCreateDamagedVersion )
  {
    m_pDamageAtomic = this->m_pDamageAtomic;
    if ( m_pDamageAtomic )
    {
      v3 = RpAtomicClone(m_pDamageAtomic);
      v4 = RwFrameCreate();
      RpAtomicSetFrame(v3, v4);
      return &v3->object.object;
    }
  }
  else if ( this->m_pRwObject )
  {
    CBaseModelInfo::AddRef(this);
    v6 = RpAtomicClone((RpAtomic_0 *)this->m_pRwObject);
    v7 = RwFrameCreate();
    RpAtomicSetFrame(v6, v7);
    CBaseModelInfo::RemoveRef(this);
    return &v6->object.object;
  }
  return 0;
}

//----- (00384F88) --------------------------------------------------------
void __fastcall CDamageAtomicModelInfo::DeleteRwObject(CDamageAtomicModelInfo *this)
{
  RpAtomic_0 *m_pDamageAtomic; // r0
  RwFrame_0 *parent; // r5

  m_pDamageAtomic = this->m_pDamageAtomic;
  if ( m_pDamageAtomic )
  {
    parent = (RwFrame_0 *)m_pDamageAtomic->object.object.parent;
    RpAtomicDestroy(m_pDamageAtomic);
    RwFrameDestroy(parent);
    this->m_pDamageAtomic = 0;
  }
  CAtomicModelInfo::DeleteRwObject(this);
}

//----- (00384FB2) --------------------------------------------------------
CDamageAtomicModelInfo *__fastcall CBaseModelInfo::AsDamageAtomicModelInfoPtr(CBaseModelInfo *this)
{
  return 0;
}

//----- (00384FB6) --------------------------------------------------------
CLodAtomicModelInfo *__fastcall CBaseModelInfo::AsLodAtomicModelInfoPtr(CBaseModelInfo *this)
{
  return 0;
}

//----- (00384FBA) --------------------------------------------------------
uint8 __fastcall CAtomicModelInfo::GetModelType(CAtomicModelInfo *this)
{
  return 1;
}

//----- (00384FBE) --------------------------------------------------------
CTimeInfo *__fastcall CBaseModelInfo::GetTimeInfo(CBaseModelInfo *this)
{
  return 0;
}

//----- (00384FC2) --------------------------------------------------------
int32 __fastcall CAtomicModelInfo::GetRwModelType(CAtomicModelInfo *this)
{
  return 1;
}

//----- (00384FCA) --------------------------------------------------------
u_native __fastcall CBaseModelInfo::GetAnimFileIndex(CBaseModelInfo *this)
{
  return -1;
}

//----- (00384FD8) --------------------------------------------------------
void __fastcall CBaseModelInfo::CBaseModelInfo(CBaseModelInfo *this)
{
  *(_DWORD *)&this->m_numRefs = -65536;
  this->_vptr$CBaseModelInfo = (int (**)(void))&off_6674DC;
}
// 6674DC: using guessed type void *;

//----- (00384FF4) --------------------------------------------------------
void __fastcall CBaseModelInfo::Init(CBaseModelInfo *this)
{
  *(_DWORD *)&this->m_numRefs = -65536;
  this->m_num2dEffects = 0;
  *(_DWORD *)&this->m_n2dEffects = -1;
  this->m_pColModel = 0;
  this->m_lodDistance = 2000.0;
  this->m_pRwObject = 0;
  this->m_flags = 192;
}

//----- (0038501C) --------------------------------------------------------
void __fastcall CBaseModelInfo::Shutdown(CBaseModelInfo *this)
{
  CColModel *m_pColModel; // r0
  void *v3; // r0
  uint16 m_flags; // r1

  (*((void (__fastcall **)(CBaseModelInfo *))this->_vptr$CBaseModelInfo + 9))(this);
  m_pColModel = this->m_pColModel;
  if ( m_pColModel && (this->m_flags & 0x80) != 0 )
  {
    CColModel::~CColModel(m_pColModel);
    CColModel::operator delete(v3);
  }
  this->m_pColModel = 0;
  m_flags = this->m_flags;
  this->m_n2dEffects = -1;
  this->m_num2dEffects = 0;
  this->m_dynamicIndex = -1;
  this->m_txdIndex = -1;
  this->m_flags = m_flags | 0x80;
}
// 38503A: variable 'v3' is possibly undefined

//----- (0038505A) --------------------------------------------------------
void __fastcall CBaseModelInfo::DeleteCollisionModel(CBaseModelInfo *this)
{
  CColModel *m_pColModel; // r0
  void *v3; // r0

  m_pColModel = this->m_pColModel;
  if ( m_pColModel && (this->m_flags & 0x80) != 0 )
  {
    CColModel::~CColModel(m_pColModel);
    CColModel::operator delete(v3);
  }
  this->m_pColModel = 0;
}
// 385070: variable 'v3' is possibly undefined

//----- (0038507A) --------------------------------------------------------
void __fastcall CBaseModelInfo::SetTexDictionary(
        CBaseModelInfo *this,
        const unsigned __int8 *pName,
        const unsigned __int8 *dbName)
{
  unsigned __int16 TxdSlot; // r0

  TxdSlot = CTxdStore::FindTxdSlot(pName);
  this->m_txdIndex = TxdSlot;
  if ( TxdSlot == 0xFFFF )
    this->m_txdIndex = CTxdStore::AddTxdSlot(pName, dbName, 0);
}

//----- (003850AC) --------------------------------------------------------
void __fastcall CBaseModelInfo::ClearTexDictionary(CBaseModelInfo *this)
{
  this->m_txdIndex = -1;
}

//----- (003850B4) --------------------------------------------------------
void __fastcall CBaseModelInfo::AddTexDictionaryRef(CBaseModelInfo *this)
{
  sub_196558(this->m_txdIndex);
}

//----- (003850BC) --------------------------------------------------------
void __fastcall CBaseModelInfo::RemoveTexDictionaryRef(CBaseModelInfo *this)
{
  sub_18C114(this->m_txdIndex);
}

//----- (003850C4) --------------------------------------------------------
void __fastcall CBaseModelInfo::AddRef(CBaseModelInfo *this)
{
  int32 m_txdIndex; // r1

  m_txdIndex = this->m_txdIndex;
  ++this->m_numRefs;
  sub_196558(m_txdIndex);
}

//----- (003850D4) --------------------------------------------------------
void __fastcall CBaseModelInfo::RemoveRef(CBaseModelInfo *this)
{
  int32 m_txdIndex; // r1

  m_txdIndex = this->m_txdIndex;
  --this->m_numRefs;
  sub_18C114(m_txdIndex);
}

//----- (003850E4) --------------------------------------------------------
void __fastcall CBaseModelInfo::SetColModel(CBaseModelInfo *this, CColModel *pColModel, bool bOwnColModel)
{
  uint16 m_flags; // r1
  uint16 v5; // r3
  int v6; // r0
  bool v7; // zf
  CBaseModelInfo *v8; // r0
  uint16 v9; // r1

  m_flags = this->m_flags;
  this->m_pColModel = pColModel;
  v5 = m_flags & 0xFF7F;
  if ( bOwnColModel )
    v5 = m_flags | 0x80;
  this->m_flags = v5;
  if ( bOwnColModel )
  {
    v6 = (*((int (__fastcall **)(CBaseModelInfo *))this->_vptr$CBaseModelInfo + 6))(this);
    v7 = v6 == 0;
    if ( v6 )
    {
      v6 = *(__int16 *)(v6 + 2);
      v7 = v6 == -1;
    }
    if ( !v7 )
    {
      v8 = CModelInfo::ms_modelInfoPtrs[v6];
      v9 = v8->m_flags;
      v8->m_pColModel = pColModel;
      v8->m_flags = v9 & 0xFF7F;
    }
  }
}

//----- (00385130) --------------------------------------------------------
void __fastcall CBaseModelInfo::Init2dEffects(CBaseModelInfo *this)
{
  this->m_num2dEffects = 0;
  this->m_n2dEffects = -1;
}

//----- (00385140) --------------------------------------------------------
C2dEffect *__fastcall CBaseModelInfo::Get2dEffect(CBaseModelInfo *this, int32 i)
{
  int32 m_num2dEffects; // r6
  RwObject_0 *m_pRwObject; // r0
  RpGeometry_0 *geometry; // r0
  RpClump_0 *v7; // r0
  RpAtomic_0 *v8; // r0
  int *v9; // r1
  int v10; // r1
  CStore<C2dEffect,100> *v11; // r0
  int v12; // r1

  m_num2dEffects = this->m_num2dEffects;
  if ( (*((int (__fastcall **)(CBaseModelInfo *))this->_vptr$CBaseModelInfo + 10))(this) == 1 )
  {
    m_pRwObject = this->m_pRwObject;
    if ( m_pRwObject )
    {
      geometry = *(RpGeometry_0 **)&m_pRwObject[3].type;
      goto LABEL_8;
    }
  }
  if ( (*((int (__fastcall **)(CBaseModelInfo *))this->_vptr$CBaseModelInfo + 10))(this) == 2 )
  {
    v7 = (RpClump_0 *)this->m_pRwObject;
    if ( v7 )
    {
      v8 = Get2DEffectAtomic(v7);
      if ( v8 )
      {
        geometry = v8->geometry;
LABEL_8:
        v9 = *(int **)(&geometry->object.type + g2dEffectPluginOffset);
        if ( v9 )
          v10 = *v9;
        else
          v10 = 0;
        m_num2dEffects -= v10;
        if ( m_num2dEffects <= i )
          goto LABEL_14;
        goto LABEL_11;
      }
    }
  }
  geometry = 0;
  if ( m_num2dEffects <= i )
  {
LABEL_14:
    v11 = *(CStore<C2dEffect,100> **)(&geometry->object.type + g2dEffectPluginOffset);
    v12 = i - m_num2dEffects;
    return &v11->m_storeArray[v12];
  }
LABEL_11:
  v11 = CModelInfo::Get2dEffectStore();
  v12 = this->m_n2dEffects + i;
  return &v11->m_storeArray[v12];
}

//----- (003851D0) --------------------------------------------------------
void __fastcall CBaseModelInfo::Add2dEffect(CBaseModelInfo *this, C2dEffect *pEffect)
{
  CStore<C2dEffect,100> *v4; // r0

  if ( this->m_n2dEffects <= -1 )
  {
    v4 = CModelInfo::Get2dEffectStore();
    this->m_num2dEffects = 1;
    this->m_n2dEffects = (unsigned int)((char *)pEffect - (char *)v4->m_storeArray) >> 6;
  }
  else
  {
    ++this->m_num2dEffects;
  }
}

//----- (00385204) --------------------------------------------------------
CAtomicModelInfo *__fastcall CBaseModelInfo::AsAtomicModelInfoPtr(CBaseModelInfo *this)
{
  return 0;
}

//----- (0038520A) --------------------------------------------------------
void __fastcall CClumpModelInfo::Init(CClumpModelInfo *this)
{
  CBaseModelInfo::Init(this);
  this->m_animFileIndex = -1;
}

//----- (00385220) --------------------------------------------------------
void __fastcall CClumpModelInfo::DeleteRwObject(CClumpModelInfo *this)
{
  RpClump_0 *m_pRwObject; // r0
  RpAtomic_0 *v3; // r0
  int *v4; // r0
  int v5; // r0
  int32 v6; // r0

  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  if ( m_pRwObject )
  {
    v3 = Get2DEffectAtomic(m_pRwObject);
    if ( v3 )
    {
      v4 = *(int **)(&v3->geometry->object.type + g2dEffectPluginOffset);
      if ( v4 )
        v5 = *v4;
      else
        LOBYTE(v5) = 0;
      this->m_num2dEffects -= v5;
    }
    RpClumpDestroy((RpClump_0 *)this->m_pRwObject);
    this->m_pRwObject = 0;
    CBaseModelInfo::RemoveTexDictionaryRef(this);
    if ( (*((int (__fastcall **)(CClumpModelInfo *))this->_vptr$CBaseModelInfo + 15))(this) != -1 )
    {
      v6 = (*((int (__fastcall **)(CClumpModelInfo *))this->_vptr$CBaseModelInfo + 15))(this);
      CAnimManager::RemoveAnimBlockRef(v6);
    }
    if ( (this->m_flags & 0x800) != 0 )
      j_CBaseModelInfo::DeleteCollisionModel(this);
  }
}

//----- (00385294) --------------------------------------------------------
void __fastcall CClumpModelInfo::SetClump(CClumpModelInfo *this, RpClump_0 *pClump)
{
  RpClump_0 *m_pRwObject; // r0
  RpAtomic_0 *v5; // r0
  int *v6; // r0
  int v7; // r0
  RpAtomic_0 *v8; // r0
  int *v9; // r0
  int v10; // r0
  int32 v11; // r0
  RpAtomic_0 *FirstAtomic; // r0
  RpAtomic_0 *v13; // r0
  RpHAnimHierarchy_0 *AnimHierarchyFromClump; // r8
  RpAtomic_0 *v15; // r6
  RpSkin_0 *Skin; // r4
  RpGeometry_0 *geometry; // r9
  RwInt32 v18; // r5
  int v19; // r6
  float *v20; // r0
  float v21; // s0
  float v22; // s2
  float v23; // s6
  float v24; // s8
  float v25; // s4

  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  if ( m_pRwObject )
  {
    v5 = Get2DEffectAtomic(m_pRwObject);
    if ( v5 )
    {
      v6 = *(int **)(&v5->geometry->object.type + g2dEffectPluginOffset);
      if ( v6 )
        v7 = *v6;
      else
        LOBYTE(v7) = 0;
      this->m_num2dEffects -= v7;
    }
  }
  this->m_pRwObject = &pClump->object;
  if ( pClump )
  {
    v8 = Get2DEffectAtomic(pClump);
    if ( v8 )
    {
      v9 = *(int **)(&v8->geometry->object.type + g2dEffectPluginOffset);
      if ( v9 )
        v10 = *v9;
      else
        LOBYTE(v10) = 0;
      this->m_num2dEffects += v10;
    }
  }
  CVisibilityPlugins::SetClumpModelInfo((RpClump_0 *)this->m_pRwObject, this);
  CBaseModelInfo::AddTexDictionaryRef(this);
  if ( (*((int (__fastcall **)(CClumpModelInfo *))this->_vptr$CBaseModelInfo + 15))(this) != -1 )
  {
    v11 = (*((int (__fastcall **)(CClumpModelInfo *))this->_vptr$CBaseModelInfo + 15))(this);
    CAnimManager::AddAnimBlockRef(v11);
  }
  RpClumpForAllAtomics(pClump, SetAtomicPipeCB, this);
  FirstAtomic = GetFirstAtomic(pClump);
  if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
  {
    if ( (this->m_flags & 0x200) != 0 )
    {
      sub_18E410(pClump, SetHierarchyForSkinAtomic, 0);
    }
    else
    {
      v13 = GetFirstAtomic(pClump);
      v13->geometry->morphTarget->boundingSphere.radius = v13->geometry->morphTarget->boundingSphere.radius * 1.2;
      AnimHierarchyFromClump = GetAnimHierarchyFromClump(pClump);
      RpClumpForAllAtomics(pClump, SetHierarchyForSkinAtomic, AnimHierarchyFromClump);
      v15 = GetFirstAtomic(pClump);
      Skin = j_RpSkinGeometryGetSkin(v15->geometry);
      geometry = v15->geometry;
      if ( j_RpSkinGetVertexBoneWeights(Skin) && geometry->numVertices >= 1 )
      {
        v18 = 0;
        v19 = 8;
        do
        {
          v20 = (float *)((char *)&j_RpSkinGetVertexBoneWeights(Skin)->w0 + v19);
          v19 += 16;
          ++v18;
          v21 = *(v20 - 2);
          v22 = *(v20 - 1);
          v23 = v20[1];
          v24 = (float)((float)(v21 + v22) + *v20) + v23;
          v25 = *v20 / v24;
          *(v20 - 2) = v21 / v24;
          *(v20 - 1) = v22 / v24;
          *v20 = v25;
          v20[1] = v23 / v24;
        }
        while ( v18 < geometry->numVertices );
      }
      AnimHierarchyFromClump->flags = 12288;
    }
  }
}

//----- (00385420) --------------------------------------------------------
RpAtomic_0 *__fastcall SetAtomicPipeCB(RpAtomic_0 *pAtomic, void *data)
{
  if ( CCustomBuildingRenderer::IsCBPCPipelineAttached(pAtomic) )
  {
    CCustomBuildingRenderer::AtomicSetup(pAtomic);
    return pAtomic;
  }
  else
  {
    if ( CCarFXRenderer::IsCCPCPipelineAttached(pAtomic) )
      CCarFXRenderer::CustomCarPipeAtomicSetup(pAtomic);
    return pAtomic;
  }
}

//----- (0038544A) --------------------------------------------------------
RpAtomic_0 *__fastcall SetHierarchyForSkinAtomic(RpAtomic_0 *pAtomic, void *data)
{
  RpHAnimHierarchy_0 *AnimHierarchyFromFrame; // r0

  if ( data )
  {
    j_RpSkinAtomicSetHAnimHierarchy(pAtomic, (RpHAnimHierarchy_0 *)data);
    return 0;
  }
  else
  {
    AnimHierarchyFromFrame = GetAnimHierarchyFromFrame((RwFrame_0 *)pAtomic->object.object.parent);
    j_RpSkinAtomicSetHAnimHierarchy(pAtomic, AnimHierarchyFromFrame);
    return pAtomic;
  }
}

//----- (00385470) --------------------------------------------------------
RwObject_0 *__fastcall CClumpModelInfo::CreateInstance(CClumpModelInfo *this, RwMatrix *pMatrix)
{
  RwObject_0 *result; // r0
  __int64 v4; // d19
  _QWORD *parent; // r2
  __int64 v6; // d16
  __int64 v7; // d17
  __int64 v8; // d22
  __int64 v9; // d23
  __int64 v10; // d20
  __int64 v11; // d21

  if ( !this->m_pRwObject )
    return 0;
  result = (RwObject_0 *)(*((int (__fastcall **)(CClumpModelInfo *))this->_vptr$CBaseModelInfo + 11))(this);
  v4 = *(_QWORD *)&pMatrix->pos.z;
  parent = result->parent;
  v6 = *(_QWORD *)&pMatrix->right.x;
  v7 = *(_QWORD *)&pMatrix->right.z;
  v8 = *(_QWORD *)&pMatrix->up.x;
  v9 = *(_QWORD *)&pMatrix->up.z;
  v10 = *(_QWORD *)&pMatrix->at.x;
  v11 = *(_QWORD *)&pMatrix->at.z;
  parent[8] = *(_QWORD *)&pMatrix->pos.x;
  parent[9] = v4;
  parent[6] = v10;
  parent[7] = v11;
  parent[4] = v8;
  parent[5] = v9;
  parent[2] = v6;
  parent[3] = v7;
  return result;
}

//----- (003854C4) --------------------------------------------------------
RwObject_0 *__fastcall CClumpModelInfo::CreateInstance(CClumpModelInfo *this)
{
  RpClump_0 *v2; // r5
  RpAtomic_0 *FirstAtomic; // r0
  RpHAnimHierarchy_0 *AnimHierarchyFromClump; // r6
  RtAnimAnimation_0 *AnimationForHierarchy; // r0
  CAnimBlendHierarchy *Animation; // r1

  if ( !this->m_pRwObject )
    return 0;
  CBaseModelInfo::AddRef(this);
  v2 = RpClumpClone((RpClump_0 *)this->m_pRwObject);
  FirstAtomic = GetFirstAtomic(v2);
  if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) && (this->m_flags & 0x200) == 0 )
  {
    AnimHierarchyFromClump = GetAnimHierarchyFromClump(v2);
    RpClumpForAllAtomics(v2, SetHierarchyForSkinAtomic, AnimHierarchyFromClump);
    AnimationForHierarchy = RpAnimBlendCreateAnimationForHierarchy(AnimHierarchyFromClump);
    RtAnimInterpolatorSetCurrentAnim(AnimHierarchyFromClump->currentAnim, AnimationForHierarchy);
    AnimHierarchyFromClump->flags = 12288;
  }
  if ( HIBYTE(this->m_flags) << 31 )
  {
    RpAnimBlendClumpInit(v2);
    Animation = CAnimManager::GetAnimation(this->m_hashKey, &CAnimManager::ms_aAnimBlocks[this->m_animFileIndex]);
    if ( Animation )
      CAnimManager::BlendAnimation(v2, Animation, 2, 1.0);
  }
  CBaseModelInfo::RemoveRef(this);
  return &v2->object;
}

//----- (0038556C) --------------------------------------------------------
void __fastcall CClumpModelInfo::SetAnimFile(CClumpModelInfo *this, const unsigned __int8 *pName)
{
  size_t v4; // r0
  char *v5; // r0

  if ( strcasecmp((const char *)pName, "null") )
  {
    v4 = strlen((const char *)pName);
    v5 = (char *)operator new[](v4 + 1);
    this->m_animFileIndex = (u_native)v5;
    sub_19B9DC(v5, (const char *)pName);
  }
}

//----- (003855A4) --------------------------------------------------------
void __fastcall CClumpModelInfo::ConvertAnimFileIndex(CClumpModelInfo *this)
{
  const unsigned __int8 *m_animFileIndex; // r0
  u_native AnimationBlockIndex; // r5
  void *v4; // r0

  m_animFileIndex = (const unsigned __int8 *)this->m_animFileIndex;
  if ( m_animFileIndex != (const unsigned __int8 *)-1 )
  {
    AnimationBlockIndex = CAnimManager::GetAnimationBlockIndex(m_animFileIndex);
    v4 = (void *)this->m_animFileIndex;
    if ( v4 )
      operator delete[](v4);
    this->m_animFileIndex = AnimationBlockIndex;
  }
}

//----- (003855C6) --------------------------------------------------------
RpAtomic_0 *__fastcall CClumpModelInfo::SetAtomicRendererCB(RpAtomic_0 *pAtomic, void *pData)
{
  CVisibilityPlugins::SetAtomicRenderCallback(pAtomic, (RpAtomicCallBackRender)pData);
  return pAtomic;
}

//----- (003855D4) --------------------------------------------------------
RwFrame_0 *__fastcall CClumpModelInfo::FindFrameFromNameCB(RwFrame_0 *pFrame, void *pData)
{
  RwFrame_0 *v3; // r4
  const char *v4; // r6
  const unsigned __int8 *FrameNodeName; // r0

  v3 = pFrame;
  v4 = *(const char **)pData;
  FrameNodeName = GetFrameNodeName(pFrame);
  if ( !strcasecmp(v4, (const char *)FrameNodeName) )
  {
    *((_DWORD *)pData + 1) = v3;
    return 0;
  }
  else
  {
    RwFrameForAllChildren(v3, CClumpModelInfo::FindFrameFromNameCB, pData);
    if ( *((_DWORD *)pData + 1) )
      return 0;
  }
  return v3;
}

//----- (00385618) --------------------------------------------------------
RwFrame_0 *__fastcall CClumpModelInfo::FindFrameFromNameWithoutIdCB(RwFrame_0 *pFrame, void *pData)
{
  RwFrame_0 *v3; // r4
  const char *v4; // r6
  const unsigned __int8 *FrameNodeName; // r0

  v3 = pFrame;
  if ( !CVisibilityPlugins::GetFrameHierarchyId(pFrame)
    && (v4 = *(const char **)pData, FrameNodeName = GetFrameNodeName(v3), !strcasecmp(v4, (const char *)FrameNodeName)) )
  {
    *((_DWORD *)pData + 1) = v3;
    return 0;
  }
  else
  {
    RwFrameForAllChildren(v3, CClumpModelInfo::FindFrameFromNameWithoutIdCB, pData);
    if ( *((_DWORD *)pData + 1) )
      return 0;
  }
  return v3;
}

//----- (00385664) --------------------------------------------------------
RwFrame_0 *__fastcall CClumpModelInfo::FindFrameFromIdCB(RwFrame_0 *pFrame, void *pData)
{
  RwFrame_0 *v3; // r4
  int v4; // r6

  v3 = pFrame;
  v4 = *(_DWORD *)pData;
  if ( v4 == CVisibilityPlugins::GetFrameHierarchyId(pFrame) )
  {
    *((_DWORD *)pData + 1) = v3;
    return 0;
  }
  else
  {
    RwFrameForAllChildren(v3, CClumpModelInfo::FindFrameFromIdCB, pData);
    if ( *((_DWORD *)pData + 1) )
      return 0;
  }
  return v3;
}

//----- (003856A4) --------------------------------------------------------
RwFrame_0 *__fastcall CClumpModelInfo::FillFrameArrayCB(RwFrame_0 *pFrame, void *pData)
{
  signed int FrameHierarchyId; // r0

  FrameHierarchyId = CVisibilityPlugins::GetFrameHierarchyId(pFrame);
  if ( FrameHierarchyId >= 1 )
    *((_DWORD *)pData + FrameHierarchyId) = pFrame;
  RwFrameForAllChildren(pFrame, CClumpModelInfo::FillFrameArrayCB, pData);
  return pFrame;
}

//----- (003856D0) --------------------------------------------------------
RwFrame_0 *__fastcall CClumpModelInfo::GetFrameFromId(RpClump_0 *pClump, int32 id)
{
  int32 v3; // [sp+0h] [bp-10h] BYREF
  RwFrame_0 *v4; // [sp+4h] [bp-Ch]

  v3 = id;
  v4 = 0;
  RwFrameForAllChildren((RwFrame_0 *)pClump->object.parent, CClumpModelInfo::FindFrameFromIdCB, &v3);
  return v4;
}

//----- (003856F4) --------------------------------------------------------
RwFrame_0 *__fastcall CClumpModelInfo::GetFrameFromName(RpClump_0 *pClump, const unsigned __int8 *pName)
{
  const unsigned __int8 *v3; // [sp+0h] [bp-10h] BYREF
  RwFrame_0 *v4; // [sp+4h] [bp-Ch]

  v3 = pName;
  v4 = 0;
  RwFrameForAllChildren((RwFrame_0 *)pClump->object.parent, CClumpModelInfo::FindFrameFromNameCB, &v3);
  return v4;
}

//----- (00385718) --------------------------------------------------------
void __fastcall CClumpModelInfo::FillFrameArray(RpClump_0 *pClump, RwFrame_0 **ppFrame)
{
  sub_19706C((RwFrame_0 *)pClump->object.parent, CClumpModelInfo::FillFrameArrayCB, ppFrame);
}

//----- (0038572C) --------------------------------------------------------
void __fastcall CClumpModelInfo::SetFrameIds(CClumpModelInfo *this, RwObjectNameIdAssocation *pAssocArray)
{
  uint32 *p_flags; // r6
  uint32 v4; // r0
  int v5; // [sp+0h] [bp-20h] BYREF
  RwFrame_0 *pFrame; // [sp+4h] [bp-1Ch]

  if ( pAssocArray->pName )
  {
    p_flags = &pAssocArray->flags;
    do
    {
      if ( !(*(unsigned __int8 *)p_flags << 31) )
      {
        pFrame = 0;
        v5 = *(p_flags - 2);
        RwFrameForAllChildren(
          (RwFrame_0 *)this->m_pRwObject->parent,
          CClumpModelInfo::FindFrameFromNameWithoutIdCB,
          &v5);
        if ( pFrame )
          CVisibilityPlugins::SetFrameHierarchyId(pFrame, *(p_flags - 1));
      }
      v4 = p_flags[1];
      p_flags += 3;
    }
    while ( v4 );
  }
}

//----- (00385790) --------------------------------------------------------
uint8 __fastcall CClumpModelInfo::GetModelType(CClumpModelInfo *this)
{
  return 5;
}

//----- (00385794) --------------------------------------------------------
int32 __fastcall CClumpModelInfo::GetRwModelType(CClumpModelInfo *this)
{
  return 2;
}

//----- (00385798) --------------------------------------------------------
u_native __fastcall CClumpModelInfo::GetAnimFileIndex(CClumpModelInfo *this)
{
  return this->m_animFileIndex;
}

//----- (0038579C) --------------------------------------------------------
CBoundingBox *__fastcall CClumpModelInfo::GetBoundingBox(CClumpModelInfo *this)
{
  return this->m_pColModel;
}

//----- (003857AA) --------------------------------------------------------
uint8 __fastcall CLodAtomicModelInfo::GetModelType(CLodAtomicModelInfo *this)
{
  return 8;
}

//----- (003857B0) --------------------------------------------------------
void CModelInfo::Initialise()
{
  int32 m_nextItem; // r0
  CAtomicModelInfo *v1; // r6
  int32 v2; // r0
  CAtomicModelInfo *v3; // r6
  int32 v4; // r0
  CAtomicModelInfo *v5; // r6
  int32 v6; // r0
  CAtomicModelInfo *v7; // r6
  int32 v8; // r0
  CAtomicModelInfo *v9; // r6
  int32 v10; // r0
  CAtomicModelInfo *v11; // r6
  int32 v12; // r0
  CAtomicModelInfo *v13; // r5

  memset(CModelInfo::ms_modelInfoPtrs, 0, (size_t)&elf_hash_chain[3526]);
  ms_timeModelStore.m_nextItem = 0;
  ms_lodModelStore.m_nextItem = 0;
  ms_lodTimeModelStore.m_nextItem = 0;
  ms_damageAtomicModelStore.m_nextItem = 0;
  ms_vehicleModelStore.m_nextItem = 0;
  ms_pedModelStore.m_nextItem = 0;
  ms_weaponModelStore.m_nextItem = 0;
  ms_clumpModelStore.m_nextItem = 0;
  ms_2dEffectStore.m_nextItem = 0;
  ms_atomicModelStore.m_nextItem = 1;
  (*((void (__fastcall **)(CAtomicModelInfo *))ms_atomicModelStore.m_storeArray[0]._vptr$CBaseModelInfo + 7))(ms_atomicModelStore.m_storeArray);
  CModelInfo::ms_modelInfoPtrs[374] = ms_atomicModelStore.m_storeArray;
  CBaseModelInfo::SetColModel(ms_atomicModelStore.m_storeArray, &CTempColModels::ms_colModelDoor1, 0);
  CBaseModelInfo::SetTexDictionary(ms_atomicModelStore.m_storeArray, "generic", "txd");
  m_nextItem = ms_atomicModelStore.m_nextItem;
  ms_atomicModelStore.m_storeArray[0].m_lodDistance = 80.0;
  ++ms_atomicModelStore.m_nextItem;
  v1 = &ms_atomicModelStore.m_storeArray[m_nextItem];
  (*((void (__fastcall **)(CAtomicModelInfo *))v1->_vptr$CBaseModelInfo + 7))(v1);
  CModelInfo::ms_modelInfoPtrs[375] = v1;
  CBaseModelInfo::SetColModel(v1, &CTempColModels::ms_colModelBumper1, 0);
  CBaseModelInfo::SetTexDictionary(v1, "generic", "txd");
  v1->m_lodDistance = 80.0;
  v2 = ms_atomicModelStore.m_nextItem++;
  v3 = &ms_atomicModelStore.m_storeArray[v2];
  (*((void (__fastcall **)(CAtomicModelInfo *))v3->_vptr$CBaseModelInfo + 7))(v3);
  CModelInfo::ms_modelInfoPtrs[376] = v3;
  CBaseModelInfo::SetColModel(v3, &CTempColModels::ms_colModelPanel1, 0);
  CBaseModelInfo::SetTexDictionary(v3, "generic", "txd");
  v3->m_lodDistance = 80.0;
  v4 = ms_atomicModelStore.m_nextItem++;
  v5 = &ms_atomicModelStore.m_storeArray[v4];
  (*((void (__fastcall **)(CAtomicModelInfo *))v5->_vptr$CBaseModelInfo + 7))(v5);
  CModelInfo::ms_modelInfoPtrs[377] = v5;
  CBaseModelInfo::SetColModel(v5, &CTempColModels::ms_colModelBonnet1, 0);
  CBaseModelInfo::SetTexDictionary(v5, "generic", "txd");
  v5->m_lodDistance = 80.0;
  v6 = ms_atomicModelStore.m_nextItem++;
  v7 = &ms_atomicModelStore.m_storeArray[v6];
  (*((void (__fastcall **)(CAtomicModelInfo *))v7->_vptr$CBaseModelInfo + 7))(v7);
  CModelInfo::ms_modelInfoPtrs[378] = v7;
  CBaseModelInfo::SetColModel(v7, &CTempColModels::ms_colModelBoot1, 0);
  CBaseModelInfo::SetTexDictionary(v7, "generic", "txd");
  v7->m_lodDistance = 80.0;
  v8 = ms_atomicModelStore.m_nextItem++;
  v9 = &ms_atomicModelStore.m_storeArray[v8];
  (*((void (__fastcall **)(CAtomicModelInfo *))v9->_vptr$CBaseModelInfo + 7))(v9);
  CModelInfo::ms_modelInfoPtrs[379] = v9;
  CBaseModelInfo::SetColModel(v9, &CTempColModels::ms_colModelWheel1, 0);
  CBaseModelInfo::SetTexDictionary(v9, "generic", "txd");
  v9->m_lodDistance = 80.0;
  v10 = ms_atomicModelStore.m_nextItem++;
  v11 = &ms_atomicModelStore.m_storeArray[v10];
  (*((void (__fastcall **)(CAtomicModelInfo *))v11->_vptr$CBaseModelInfo + 7))(v11);
  CModelInfo::ms_modelInfoPtrs[380] = v11;
  CBaseModelInfo::SetColModel(v11, &CTempColModels::ms_colModelBodyPart1, 0);
  CBaseModelInfo::SetTexDictionary(v11, "generic", "txd");
  v11->m_lodDistance = 80.0;
  v12 = ms_atomicModelStore.m_nextItem++;
  v13 = &ms_atomicModelStore.m_storeArray[v12];
  (*((void (__fastcall **)(CAtomicModelInfo *))v13->_vptr$CBaseModelInfo + 7))(v13);
  CModelInfo::ms_modelInfoPtrs[381] = v13;
  CBaseModelInfo::SetColModel(v13, &CTempColModels::ms_colModelBodyPart2, 0);
  CBaseModelInfo::SetTexDictionary(v13, "generic", "txd");
  v13->m_lodDistance = 80.0;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];

//----- (00385A38) --------------------------------------------------------
CAtomicModelInfo *__fastcall CModelInfo::AddAtomicModel(int32 index)
{
  int32 v2; // r1
  CAtomicModelInfo *v3; // r5
  uint32 m_hashKey; // t1

  v2 = ms_atomicModelStore.m_nextItem++;
  v3 = (CAtomicModelInfo *)((char *)&ms_atomicModelStore + 56 * v2);
  m_hashKey = v3->m_hashKey;
  v3 = (CAtomicModelInfo *)((char *)v3 + 4);
  (*(void (__fastcall **)(CAtomicModelInfo *))(m_hashKey + 28))(v3);
  CModelInfo::ms_modelInfoPtrs[index] = v3;
  return v3;
}

//----- (00385A74) --------------------------------------------------------
void CModelInfo::ReInit2dEffects()
{
  int v0; // r5
  CBaseModelInfo **v1; // r4

  v0 = 20000;
  v1 = CModelInfo::ms_modelInfoPtrs;
  ms_2dEffectStore.m_nextItem = 0;
  do
  {
    if ( *v1 )
      CBaseModelInfo::Init2dEffects(*v1);
    --v0;
    ++v1;
  }
  while ( v0 );
}

//----- (00385AA8) --------------------------------------------------------
void CModelInfo::ShutDown()
{
  int32 v0; // r4
  CAtomicModelInfo *m_storeArray; // r6
  int (**v2)(void); // t1
  int32 v3; // r4
  CDamageAtomicModelInfo *v4; // r6
  int (**v5)(void); // t1
  int32 v6; // r4
  CLodAtomicModelInfo *v7; // r6
  int (**v8)(void); // t1
  int32 v9; // r4
  CTimeModelInfo *v10; // r6
  int (**v11)(void); // t1
  int32 v12; // r4
  CLodTimeModelInfo *v13; // r6
  int (**v14)(void); // t1
  int32 v15; // r4
  CWeaponModelInfo *v16; // r6
  int (**v17)(void); // t1
  int32 v18; // r4
  CClumpModelInfo *v19; // r6
  int (**v20)(void); // t1
  int32 v21; // r5
  CVehicleModelInfo *v22; // r4
  int32 v23; // r4
  CPedModelInfo *v24; // r6
  int (**v25)(void); // t1
  int32 v26; // r5
  RwTexture_0 **p_m_pShadowTex; // r6
  RwTexture_0 *v28; // r0
  void *v29; // r0
  RpAtomic_0 *v30; // r4
  RwFrame_0 *parent; // r10

  if ( ms_atomicModelStore.m_nextItem >= 1 )
  {
    v0 = 0;
    m_storeArray = ms_atomicModelStore.m_storeArray;
    do
    {
      v2 = m_storeArray->_vptr$CBaseModelInfo;
      ++m_storeArray;
      v2[8]();
      ++v0;
    }
    while ( v0 < ms_atomicModelStore.m_nextItem );
  }
  if ( ms_damageAtomicModelStore.m_nextItem >= 1 )
  {
    v3 = 0;
    v4 = ms_damageAtomicModelStore.m_storeArray;
    do
    {
      v5 = v4->_vptr$CBaseModelInfo;
      ++v4;
      v5[8]();
      ++v3;
    }
    while ( v3 < ms_damageAtomicModelStore.m_nextItem );
  }
  if ( ms_lodModelStore.m_nextItem >= 1 )
  {
    v6 = 0;
    v7 = ms_lodModelStore.m_storeArray;
    do
    {
      v8 = v7->_vptr$CBaseModelInfo;
      ++v7;
      v8[8]();
      ++v6;
    }
    while ( v6 < ms_lodModelStore.m_nextItem );
  }
  if ( ms_timeModelStore.m_nextItem >= 1 )
  {
    v9 = 0;
    v10 = ms_timeModelStore.m_storeArray;
    do
    {
      v11 = v10->_vptr$CBaseModelInfo;
      ++v10;
      v11[8]();
      ++v9;
    }
    while ( v9 < ms_timeModelStore.m_nextItem );
  }
  if ( ms_lodTimeModelStore.m_nextItem >= 1 )
  {
    v12 = 0;
    v13 = ms_lodTimeModelStore.m_storeArray;
    do
    {
      v14 = v13->_vptr$CBaseModelInfo;
      ++v13;
      v14[8]();
      ++v12;
    }
    while ( v12 < ms_lodTimeModelStore.m_nextItem );
  }
  if ( ms_weaponModelStore.m_nextItem >= 1 )
  {
    v15 = 0;
    v16 = ms_weaponModelStore.m_storeArray;
    do
    {
      v17 = v16->_vptr$CBaseModelInfo;
      ++v16;
      v17[8]();
      ++v15;
    }
    while ( v15 < ms_weaponModelStore.m_nextItem );
  }
  if ( ms_clumpModelStore.m_nextItem >= 1 )
  {
    v18 = 0;
    v19 = ms_clumpModelStore.m_storeArray;
    do
    {
      v20 = v19->_vptr$CBaseModelInfo;
      ++v19;
      v20[8]();
      ++v18;
    }
    while ( v18 < ms_clumpModelStore.m_nextItem );
  }
  if ( ms_vehicleModelStore.m_nextItem >= 1 )
  {
    v21 = 0;
    v22 = ms_vehicleModelStore.m_storeArray;
    do
    {
      (*((void (__fastcall **)(CVehicleModelInfo *))v22->_vptr$CBaseModelInfo + 8))(v22);
      ++v21;
      ++v22;
    }
    while ( v21 < ms_vehicleModelStore.m_nextItem );
  }
  if ( ms_pedModelStore.m_nextItem >= 1 )
  {
    v23 = 0;
    v24 = ms_pedModelStore.m_storeArray;
    do
    {
      v25 = v24->_vptr$CBaseModelInfo;
      ++v24;
      v25[8]();
      ++v23;
    }
    while ( v23 < ms_pedModelStore.m_nextItem );
  }
  if ( ms_2dEffectStore.m_nextItem >= 1 )
  {
    v26 = 0;
    p_m_pShadowTex = &ms_2dEffectStore.m_storeArray[0].attr.l.m_pShadowTex;
    do
    {
      if ( *((_BYTE *)p_m_pShadowTex - 40) == 7 )
      {
        v29 = *(p_m_pShadowTex - 3);
        if ( v29 )
        {
          CMemoryMgr::Free(v29);
          *(p_m_pShadowTex - 3) = 0;
        }
        v30 = (RpAtomic_0 *)*(p_m_pShadowTex - 2);
        if ( v30 )
        {
          parent = (RwFrame_0 *)v30->object.object.parent;
          if ( parent )
          {
            RpAtomicSetFrame((RpAtomic_0 *)*(p_m_pShadowTex - 2), 0);
            RwFrameDestroy(parent);
          }
          RpAtomicDestroy(v30);
          *(p_m_pShadowTex - 2) = 0;
        }
      }
      else if ( !*((_BYTE *)p_m_pShadowTex - 40) )
      {
        v28 = *(p_m_pShadowTex - 1);
        if ( v28 )
        {
          RwTextureDestroy(v28);
          *(p_m_pShadowTex - 1) = 0;
        }
        if ( *p_m_pShadowTex )
        {
          RwTextureDestroy(*p_m_pShadowTex);
          *p_m_pShadowTex = 0;
        }
      }
      ++v26;
      p_m_pShadowTex += 16;
    }
    while ( v26 < ms_2dEffectStore.m_nextItem );
  }
  ms_damageAtomicModelStore.m_nextItem = 0;
  ms_atomicModelStore.m_nextItem = 0;
  ms_lodModelStore.m_nextItem = 0;
  ms_timeModelStore.m_nextItem = 0;
  ms_lodTimeModelStore.m_nextItem = 0;
  ms_weaponModelStore.m_nextItem = 0;
  ms_clumpModelStore.m_nextItem = 0;
  ms_vehicleModelStore.m_nextItem = 0;
  ms_pedModelStore.m_nextItem = 0;
  ms_2dEffectStore.m_nextItem = 0;
}

//----- (00385D98) --------------------------------------------------------
CBaseModelInfo *__fastcall CModelInfo::GetModelInfo(const unsigned __int8 *pName, int32 *pIndex)
{
  uint32 UppercaseKey; // r0
  int32 v4; // r2
  int32 v5; // r3
  CBaseModelInfo *v6; // r1
  bool v7; // cc

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  v4 = CModelInfo::ms_lastPositionSearched;
  if ( CModelInfo::ms_lastPositionSearched > 19999 )
  {
LABEL_7:
    while ( 1 )
    {
      v6 = CModelInfo::ms_modelInfoPtrs[v4];
      if ( v6 )
      {
        if ( v6->m_hashKey == UppercaseKey )
          break;
      }
      v7 = v4-- <= 0;
      if ( v7 )
        return 0;
    }
    if ( pIndex )
      *pIndex = v4;
    CModelInfo::ms_lastPositionSearched = v4;
  }
  else
  {
    v5 = CModelInfo::ms_lastPositionSearched;
    do
    {
      v6 = CModelInfo::ms_modelInfoPtrs[v5];
      if ( v6 && v6->m_hashKey == UppercaseKey )
      {
        if ( pIndex )
          *pIndex = v5;
        CModelInfo::ms_lastPositionSearched = v5;
        return v6;
      }
      v7 = v5++ < 19999;
    }
    while ( v7 );
    if ( CModelInfo::ms_lastPositionSearched >= 0 )
      goto LABEL_7;
    return 0;
  }
  return v6;
}

//----- (00385E38) --------------------------------------------------------
CBaseModelInfo *__fastcall CModelInfo::GetModelInfoFromHashKey(uint32 key, int32 *pIndex)
{
  int32 v2; // r3
  CBaseModelInfo *v3; // r2

  v2 = 0;
  while ( 1 )
  {
    v3 = CModelInfo::ms_modelInfoPtrs[v2];
    if ( v3 )
    {
      if ( v3->m_hashKey == key )
        break;
    }
    if ( v2++ >= 19999 )
      return 0;
  }
  if ( pIndex )
    *pIndex = v2;
  return v3;
}

//----- (00385E78) --------------------------------------------------------
CBaseModelInfo *__fastcall CModelInfo::GetModelInfoUInt16(const unsigned __int8 *pName, UInt16 *pIndex)
{
  uint32 UppercaseKey; // r0
  int32 v4; // r2
  int32 v5; // r3
  CBaseModelInfo *v6; // r1
  bool v7; // cc
  CBaseModelInfo *result; // r0

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  v4 = CModelInfo::ms_lastPositionSearched;
  if ( CModelInfo::ms_lastPositionSearched > 19999 )
  {
LABEL_7:
    while ( 1 )
    {
      v6 = CModelInfo::ms_modelInfoPtrs[v4];
      if ( v6 )
      {
        if ( v6->m_hashKey == UppercaseKey )
          break;
      }
      v7 = v4-- <= 0;
      if ( v7 )
        goto LABEL_11;
    }
    LOWORD(v5) = v4;
    CModelInfo::ms_lastPositionSearched = v4;
  }
  else
  {
    v5 = CModelInfo::ms_lastPositionSearched;
    do
    {
      v6 = CModelInfo::ms_modelInfoPtrs[v5];
      if ( v6 && v6->m_hashKey == UppercaseKey )
      {
        CModelInfo::ms_lastPositionSearched = v5;
        goto LABEL_14;
      }
      v7 = v5++ < 19999;
    }
    while ( v7 );
    if ( CModelInfo::ms_lastPositionSearched >= 0 )
      goto LABEL_7;
LABEL_11:
    LOWORD(v5) = 0;
    v6 = 0;
  }
LABEL_14:
  result = v6;
  if ( pIndex )
    *pIndex = v5;
  return result;
}

//----- (00385F10) --------------------------------------------------------
CBaseModelInfo *__fastcall CModelInfo::GetModelInfo(const unsigned __int8 *pName, int32 start, int32 end)
{
  uint32 UppercaseKey; // r0
  CBaseModelInfo *v6; // r1

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  if ( start > end )
    return 0;
  while ( 1 )
  {
    v6 = CModelInfo::ms_modelInfoPtrs[start];
    if ( v6 )
    {
      if ( v6->m_hashKey == UppercaseKey )
        break;
    }
    if ( start++ >= end )
      return 0;
  }
  return v6;
}

//----- (00385F44) --------------------------------------------------------
CBaseModelInfo *__fastcall CModelInfo::GetModelInfoFast(
        CModelInfoAccelerator *pAccel,
        const unsigned __int8 *pName,
        int32 *pIndex)
{
  int32 NextModelInfoId; // r6
  CBaseModelInfo *v6; // r4
  uint32 m_hashKey; // r9

  NextModelInfoId = CModelInfoAccelerator::GetNextModelInfoId(pAccel);
  if ( NextModelInfoId == 0xFFFF )
    return 0;
  v6 = CModelInfo::ms_modelInfoPtrs[NextModelInfoId];
  if ( !v6 )
    return 0;
  m_hashKey = v6->m_hashKey;
  if ( m_hashKey != CKeyGen::GetUppercaseKey(pName) )
    return 0;
  if ( pIndex )
    *pIndex = NextModelInfoId;
  return v6;
}

//----- (00385F94) --------------------------------------------------------
CDamageAtomicModelInfo *__fastcall CModelInfo::AddDamageAtomicModel(int32 index)
{
  int32 v2; // r1
  CDamageAtomicModelInfo *v3; // r5
  uint32 m_hashKey; // t1

  v2 = ms_damageAtomicModelStore.m_nextItem++;
  v3 = (CDamageAtomicModelInfo *)((char *)&ms_damageAtomicModelStore + 60 * v2);
  m_hashKey = v3->m_hashKey;
  v3 = (CDamageAtomicModelInfo *)((char *)v3 + 4);
  (*(void (__fastcall **)(CDamageAtomicModelInfo *))(m_hashKey + 28))(v3);
  CModelInfo::ms_modelInfoPtrs[index] = v3;
  return v3;
}

//----- (00385FCC) --------------------------------------------------------
CLodAtomicModelInfo *__fastcall CModelInfo::AddLodAtomicModel(int32 index)
{
  int32 v2; // r1
  CLodAtomicModelInfo *v3; // r5
  uint32 m_hashKey; // t1

  v2 = ms_lodModelStore.m_nextItem++;
  v3 = (CLodAtomicModelInfo *)((char *)&ms_lodModelStore + 60 * v2);
  m_hashKey = v3->m_hashKey;
  v3 = (CLodAtomicModelInfo *)((char *)v3 + 4);
  (*(void (__fastcall **)(CLodAtomicModelInfo *))(m_hashKey + 28))(v3);
  CModelInfo::ms_modelInfoPtrs[index] = v3;
  return v3;
}

//----- (00386004) --------------------------------------------------------
CTimeModelInfo *__fastcall CModelInfo::AddTimeModel(int32 index)
{
  int32 v2; // r1
  CTimeModelInfo *v3; // r5
  uint32 m_hashKey; // t1

  v2 = ms_timeModelStore.m_nextItem++;
  v3 = (CTimeModelInfo *)((char *)&ms_timeModelStore + 60 * v2);
  m_hashKey = v3->m_hashKey;
  v3 = (CTimeModelInfo *)((char *)v3 + 4);
  (*(void (__fastcall **)(CTimeModelInfo *))(m_hashKey + 28))(v3);
  CModelInfo::ms_modelInfoPtrs[index] = v3;
  return v3;
}

//----- (0038603C) --------------------------------------------------------
CLodTimeModelInfo *__fastcall CModelInfo::AddLodTimeModel(int32 index)
{
  int32 v2; // r1
  CLodTimeModelInfo *v3; // r5
  uint32 m_hashKey; // t1

  v2 = ms_lodTimeModelStore.m_nextItem++;
  v3 = (CLodTimeModelInfo *)((char *)&ms_lodTimeModelStore + 64 * v2);
  m_hashKey = v3->m_hashKey;
  v3 = (CLodTimeModelInfo *)((char *)v3 + 4);
  (*(void (__fastcall **)(CLodTimeModelInfo *))(m_hashKey + 28))(v3);
  CModelInfo::ms_modelInfoPtrs[index] = v3;
  return v3;
}

//----- (00386070) --------------------------------------------------------
CWeaponModelInfo *__fastcall CModelInfo::AddWeaponModel(int32 index)
{
  int32 v2; // r1
  CWeaponModelInfo *v3; // r5
  uint32 m_hashKey; // t1

  v2 = ms_weaponModelStore.m_nextItem++;
  v3 = (CWeaponModelInfo *)((char *)&ms_weaponModelStore + 64 * v2);
  m_hashKey = v3->m_hashKey;
  v3 = (CWeaponModelInfo *)((char *)v3 + 4);
  (*(void (__fastcall **)(CWeaponModelInfo *))(m_hashKey + 28))(v3);
  CModelInfo::ms_modelInfoPtrs[index] = v3;
  return v3;
}

//----- (003860A4) --------------------------------------------------------
CClumpModelInfo *__fastcall CModelInfo::AddClumpModel(int32 index)
{
  int32 v2; // r1
  CClumpModelInfo *v3; // r5
  uint32 m_hashKey; // t1

  v2 = ms_clumpModelStore.m_nextItem++;
  v3 = (CClumpModelInfo *)((char *)&ms_clumpModelStore + 60 * v2);
  m_hashKey = v3->m_hashKey;
  v3 = (CClumpModelInfo *)((char *)v3 + 4);
  (*(void (__fastcall **)(CClumpModelInfo *))(m_hashKey + 28))(v3);
  CModelInfo::ms_modelInfoPtrs[index] = v3;
  return v3;
}

//----- (003860DC) --------------------------------------------------------
CVehicleModelInfo *__fastcall CModelInfo::AddVehicleModel(int32 index)
{
  CVehicleModelInfo *v2; // r5
  uint32 m_hashKey; // t1

  v2 = (CVehicleModelInfo *)((char *)&ms_vehicleModelStore + 936 * ms_vehicleModelStore.m_nextItem++);
  m_hashKey = v2->m_hashKey;
  v2 = (CVehicleModelInfo *)((char *)v2 + 4);
  (*(void (__fastcall **)(CVehicleModelInfo *))(m_hashKey + 28))(v2);
  CModelInfo::ms_modelInfoPtrs[index] = v2;
  return v2;
}

//----- (00386114) --------------------------------------------------------
CPedModelInfo *__fastcall CModelInfo::AddPedModel(int32 index)
{
  CPedModelInfo *v2; // r5
  uint32 m_hashKey; // t1

  v2 = (CPedModelInfo *)((char *)&ms_pedModelStore + 92 * ms_pedModelStore.m_nextItem++);
  m_hashKey = v2->m_hashKey;
  v2 = (CPedModelInfo *)((char *)v2 + 4);
  (*(void (__fastcall **)(CPedModelInfo *))(m_hashKey + 28))(v2);
  CModelInfo::ms_modelInfoPtrs[index] = v2;
  return v2;
}

//----- (0038614C) --------------------------------------------------------
CStore<C2dEffect,100> *CModelInfo::Get2dEffectStore()
{
  return &ms_2dEffectStore;
}

//----- (00386158) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsBoatModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 5;
}

//----- (00386194) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsCarModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && !*(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20];
}

//----- (003861D0) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsTrainModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 6;
}

//----- (0038620C) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsHeliModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 3;
}

//----- (00386248) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsPlaneModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 4;
}

//----- (00386284) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsBikeModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 9;
}

//----- (003862C0) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsFakePlaneModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 8;
}

//----- (003862FC) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsMonsterTruckModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 1;
}

//----- (00386338) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsQuadBikeModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 2;
}

//----- (00386374) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsBmxModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 10;
}

//----- (003863B0) --------------------------------------------------------
Bool8 __fastcall CModelInfo::IsTrailerModel(int32 index)
{
  CBaseModelInfo *v2; // r0

  v2 = CModelInfo::ms_modelInfoPtrs[index];
  return v2
      && (*((int (__fastcall **)(CBaseModelInfo *))v2->_vptr$CBaseModelInfo + 5))(v2) == 6
      && *(_DWORD *)&CModelInfo::ms_modelInfoPtrs[index][1].m_modelName[20] == 11;
}

//----- (003863EC) --------------------------------------------------------
int32 __fastcall CModelInfo::IsVehicleModelType(int32 index)
{
  int32 *v1; // r4

  if ( index <= 19999
    && (v1 = (int32 *)CModelInfo::ms_modelInfoPtrs[index]) != 0
    && (*(int (__fastcall **)(CBaseModelInfo *))(*v1 + 20))(CModelInfo::ms_modelInfoPtrs[index]) == 6 )
  {
    return v1[21];
  }
  else
  {
    return -1;
  }
}

//----- (00386430) --------------------------------------------------------
void __fastcall CStore<CPedModelInfo,278>::~CStore(CStore<CPedModelInfo,278> *this)
{
  Int16 *p_m_LastVoice; // r5
  int i; // r6
  CColModel *v3; // r0
  void *v4; // r0

  p_m_LastVoice = &this->m_storeArray[277].m_LastVoice;
  for ( i = 0; i != -12788; i -= 46 )
  {
    *(_DWORD *)&p_m_LastVoice[i - 44] = &off_667658;
    v3 = *(CColModel **)&p_m_LastVoice[i - 6];
    if ( v3 )
    {
      CColModel::~CColModel(v3);
      CColModel::operator delete(v4);
    }
  }
}
// 386466: variable 'v4' is possibly undefined
// 667658: using guessed type void *off_667658;

//----- (00386480) --------------------------------------------------------
uint8 __fastcall CTimeModelInfo::GetModelType(CTimeModelInfo *this)
{
  return 3;
}

//----- (00386484) --------------------------------------------------------
CTimeInfo *__fastcall CTimeModelInfo::GetTimeInfo(CTimeModelInfo *this)
{
  return &this->m_time;
}

//----- (0038648C) --------------------------------------------------------
uint8 __fastcall CLodTimeModelInfo::GetModelType(CLodTimeModelInfo *this)
{
  return 3;
}

//----- (00386490) --------------------------------------------------------
CTimeInfo *__fastcall CLodTimeModelInfo::GetTimeInfo(CLodTimeModelInfo *this)
{
  return &this->m_time;
}

//----- (00386494) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::CModelInfoAccelerator(CModelInfoAccelerator *this)
{
  this->m_bFileFound = 0;
  this->m_nModelInfosAdded = 0;
  this->m_pArrayModelInfoIds = 0;
  this->m_bHasRun = 0;
  this->m_FileName[0] = 0;
}

//----- (003864A2) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::Init(CModelInfoAccelerator *this)
{
  this->m_bFileFound = 0;
  this->m_nModelInfosAdded = 0;
  this->m_pArrayModelInfoIds = 0;
  this->m_bHasRun = 0;
  this->m_FileName[0] = 0;
}

//----- (003864B4) --------------------------------------------------------
bool __fastcall CModelInfoAccelerator::GetModelInfoIdFile(CModelInfoAccelerator *this)
{
  void *v2; // r5
  int m_bFileFound; // r6
  uint16 *v4; // r4

  v2 = (void *)CFileMgr::OpenFile(this->m_FileName, (const unsigned __int8 *)&dword_386514);
  m_bFileFound = (int)v2;
  if ( v2 )
    m_bFileFound = 1;
  this->m_bFileFound = m_bFileFound;
  v4 = (uint16 *)operator new[](0xA08Cu);
  this->m_pArrayModelInfoIds = v4;
  memset(v4, 0, 0xA08Cu);
  if ( v2 )
  {
    OS_FileRead(v2, v4, 41100);
    CFileMgr::CloseFile((u_native)v2);
    m_bFileFound = this->m_bFileFound;
  }
  return m_bFileFound != 0;
}
// 386514: using guessed type int dword_386514;

//----- (00386518) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::AllocModelInfoIds(CModelInfoAccelerator *this)
{
  uint16 *v2; // r0

  v2 = (uint16 *)operator new[](0xA08Cu);
  this->m_pArrayModelInfoIds = v2;
  memset(v2, 0, 0xA08Cu);
}

//----- (00386532) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::EndOfLoadPhase(CModelInfoAccelerator *this)
{
  u_native v2; // r0
  u_native v3; // r5

  if ( !this->m_bFileFound )
  {
    v2 = CFileMgr::OpenFileForWriting(this->m_FileName);
    v3 = v2;
    if ( v2 )
    {
      CFileMgr::Write(v2, (unsigned __int8 *)this->m_pArrayModelInfoIds, 41100);
      CFileMgr::CloseFile(v3);
    }
  }
  if ( this->m_pArrayModelInfoIds )
    operator delete[](this->m_pArrayModelInfoIds);
  this->m_pArrayModelInfoIds = 0;
}

//----- (00386568) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::FreeModelInfoIds(CModelInfoAccelerator *this)
{
  uint16 *m_pArrayModelInfoIds; // r0

  m_pArrayModelInfoIds = this->m_pArrayModelInfoIds;
  if ( m_pArrayModelInfoIds )
    operator delete[](m_pArrayModelInfoIds);
  this->m_pArrayModelInfoIds = 0;
}

//----- (0038657E) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::AddModelInfoId(CModelInfoAccelerator *this, uint16 id)
{
  this->m_pArrayModelInfoIds[this->m_nModelInfosAdded++] = id;
}

//----- (0038658E) --------------------------------------------------------
uint16 __fastcall CModelInfoAccelerator::GetNextModelInfoId(CModelInfoAccelerator *this)
{
  int m_nModelInfosAdded; // r2
  uint16 v2; // r1

  m_nModelInfosAdded = this->m_nModelInfosAdded;
  v2 = this->m_pArrayModelInfoIds[m_nModelInfosAdded];
  this->m_nModelInfosAdded = m_nModelInfosAdded + 1;
  return v2;
}

//----- (0038659E) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::GetEntry(
        CModelInfoAccelerator *this,
        CBaseModelInfo **ppModelInfo,
        int32 *pIndex,
        unsigned __int8 *pName)
{
  CBaseModelInfo *ModelInfo; // r0
  int32 v8; // r2

  if ( this->m_bFileFound )
  {
    *ppModelInfo = CModelInfo::GetModelInfoFast(this, pName, pIndex);
  }
  else
  {
    ModelInfo = CModelInfo::GetModelInfo(pName, pIndex);
    *ppModelInfo = ModelInfo;
    if ( ModelInfo )
      v8 = *pIndex;
    else
      LOWORD(v8) = -1;
    this->m_pArrayModelInfoIds[this->m_nModelInfosAdded++] = v8;
  }
}

//----- (003865EC) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::Begin(CModelInfoAccelerator *this, unsigned __int8 *pFileName)
{
  unsigned __int8 *m_FileName; // r4
  void *v4; // r4
  uint16 *v5; // r6

  m_FileName = this->m_FileName;
  strcpy((char *)this->m_FileName, (const char *)pFileName);
  if ( !this->m_bHasRun )
  {
    v4 = (void *)CFileMgr::OpenFile(m_FileName, (const unsigned __int8 *)&dword_38664C);
    this->m_bFileFound = v4 != 0;
    v5 = (uint16 *)operator new[](0xA08Cu);
    this->m_pArrayModelInfoIds = v5;
    memset(v5, 0, 0xA08Cu);
    if ( v4 )
    {
      OS_FileRead(v4, v5, 41100);
      sub_19B258((u_native)v4);
    }
  }
}
// 38664C: using guessed type int dword_38664C;

//----- (00386650) --------------------------------------------------------
void __fastcall CModelInfoAccelerator::End(CModelInfoAccelerator *this, unsigned __int8 *pFileName)
{
  u_native v3; // r0
  u_native v4; // r5

  if ( !this->m_bHasRun )
  {
    if ( !gModelInfoAccelerator.m_bFileFound )
    {
      v3 = CFileMgr::OpenFileForWriting(gModelInfoAccelerator.m_FileName);
      v4 = v3;
      if ( v3 )
      {
        CFileMgr::Write(v3, (unsigned __int8 *)gModelInfoAccelerator.m_pArrayModelInfoIds, 41100);
        CFileMgr::CloseFile(v4);
      }
    }
    if ( gModelInfoAccelerator.m_pArrayModelInfoIds )
      operator delete[](gModelInfoAccelerator.m_pArrayModelInfoIds);
    gModelInfoAccelerator.m_pArrayModelInfoIds = 0;
    this->m_bHasRun = 1;
  }
}

//----- (003866C4) --------------------------------------------------------
void __fastcall CPedModelInfo::SetClump(CPedModelInfo *this, RpClump_0 *pClump)
{
  CClumpModelInfo::SetClump(this, pClump);
  CClumpModelInfo::SetFrameIds(this, CPedModelInfo::m_pPedIds);
  if ( !this->m_pHitColModel )
    CPedModelInfo::CreateHitColModelSkinned(this, pClump);
  RpClumpForAllAtomics(
    (RpClump_0 *)this->m_pRwObject,
    CClumpModelInfo::SetAtomicRendererCB,
    CVisibilityPlugins::RenderPedCB);
  sub_197D50(pClump);
}

//----- (00386710) --------------------------------------------------------
void __fastcall CPedModelInfo::CreateHitColModelSkinned(CPedModelInfo *this, RpClump_0 *pClump)
{
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r11
  CColModel *v4; // r6
  int v5; // r8
  RwMatrix *v6; // r4
  RwMatrix *v7; // r5
  CColSphere *m_pSphereArray; // r9
  colModelNodeInfo *v9; // r10
  float yOffset; // r1
  float zOffset; // r2
  __int64 v12; // d16
  __int64 v13; // d17
  __int64 v14; // d19
  __int64 v15; // d22
  __int64 v16; // d23
  __int64 v17; // d20
  __int64 v18; // d21
  RwMatrix *MatrixArray; // r6
  RwInt32 v20; // r0
  __int64 v21; // d16
  CColModel *v22; // [sp+Ch] [bp-4Ch]
  CVector vecMax; // [sp+18h] [bp-40h] BYREF
  CVector vecCentre; // [sp+24h] [bp-34h] BYREF
  RwV3d_0 pointsIn; // [sp+30h] [bp-28h] BYREF

  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump(pClump);
  v4 = (CColModel *)CColModel::operator new(0x30u);
  CColModel::CColModel(v4);
  v5 = 0;
  v6 = CGame::m_pWorkingMatrix2;
  v7 = CGame::m_pWorkingMatrix1;
  CColModel::AllocateData(v4, 12, 0, 0, 0, 0, 0);
  RwMatrixInvert(v7, (const RwMatrix *)((char *)pClump->object.parent + 16));
  v22 = v4;
  m_pSphereArray = v4->m_pColData->m_pSphereArray;
  do
  {
    v9 = &CPedModelInfo::m_pColNodeInfos[v5];
    yOffset = CPedModelInfo::m_pColNodeInfos[v5].yOffset;
    zOffset = CPedModelInfo::m_pColNodeInfos[v5].zOffset;
    pointsIn.x = CPedModelInfo::m_pColNodeInfos[v5].xOffset;
    pointsIn.y = yOffset;
    pointsIn.z = zOffset;
    v12 = *(_QWORD *)&v7->right.x;
    v13 = *(_QWORD *)&v7->right.z;
    v14 = *(_QWORD *)&v7->pos.z;
    v15 = *(_QWORD *)&v7->up.x;
    v16 = *(_QWORD *)&v7->up.z;
    v17 = *(_QWORD *)&v7->at.x;
    v18 = *(_QWORD *)&v7->at.z;
    *(_QWORD *)&v6->pos.x = *(_QWORD *)&v7->pos.x;
    *(_QWORD *)&v6->pos.z = v14;
    *(_QWORD *)&v6->at.x = v17;
    *(_QWORD *)&v6->at.z = v18;
    *(_QWORD *)&v6->right.x = v12;
    *(_QWORD *)&v6->right.z = v13;
    *(_QWORD *)&v6->up.x = v15;
    *(_QWORD *)&v6->up.z = v16;
    MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
    v20 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, CPedModelInfo::m_pColNodeInfos[v5].boneId);
    RwMatrixTransform(v6, &MatrixArray[v20], rwCOMBINEPRECONCAT);
    RwV3dTransformPoints(&pointsIn, &pointsIn, 1, v6);
    v21 = *(_QWORD *)&pointsIn.x;
    ++v5;
    m_pSphereArray->m_vecCentre.z = pointsIn.z;
    *(_QWORD *)&m_pSphereArray->m_vecCentre.x = v21;
    m_pSphereArray->m_fRadius = v9->fRadius;
    m_pSphereArray->m_data.m_nSurfaceType = 62;
    m_pSphereArray->m_data.m_nPieceType = v9->nPieceType;
    ++m_pSphereArray;
  }
  while ( v5 != 12 );
  memset(&vecCentre, 0, sizeof(vecCentre));
  CSphere::Set(&v22->m_sphereBound, 1.5, &vecCentre);
  vecCentre.x = -0.5;
  vecCentre.y = -0.5;
  vecCentre.z = -1.2;
  vecMax.x = 0.5;
  vecMax.y = 0.5;
  vecMax.z = 1.2;
  CBox::Set(&v22->m_boxBound, &vecCentre, &vecMax);
  v22->m_level = 0;
  this->m_pHitColModel = v22;
}

//----- (0038687C) --------------------------------------------------------
void __fastcall CPedModelInfo::DeleteRwObject(CPedModelInfo *this)
{
  CColModel *m_pHitColModel; // r0
  void *v3; // r0

  CClumpModelInfo::DeleteRwObject(this);
  m_pHitColModel = this->m_pHitColModel;
  if ( m_pHitColModel )
  {
    CColModel::~CColModel(m_pHitColModel);
    CColModel::operator delete(v3);
  }
  this->m_pHitColModel = 0;
}
// 38688E: variable 'v3' is possibly undefined

//----- (00386898) --------------------------------------------------------
RpAtomic_0 *__fastcall GetAtomicListCB(RpAtomic_0 *pAtomic, void *pData)
{
  **(_DWORD **)pData = pAtomic;
  *(_DWORD *)pData += 4;
  return pAtomic;
}

//----- (003868A4) --------------------------------------------------------
RpAtomic_0 *__fastcall AttachAtomicsFromListCB(RpAtomic_0 *pAtomic, void *pData)
{
  RpClump_0 *clump; // r8
  RpAtomic_0 *v5; // r6
  RpClump_0 *v6; // r9

  clump = pAtomic->clump;
  v5 = **(RpAtomic_0 ***)pData;
  v6 = v5->clump;
  RpAtomicSetFrame(v5, (RwFrame_0 *)pAtomic->object.object.parent);
  RpClumpRemoveAtomic(v6, v5);
  RpClumpAddAtomic(clump, v5);
  *(_DWORD *)pData += 4;
  return pAtomic;
}

//----- (003868E2) --------------------------------------------------------
RpAtomic_0 *__fastcall CountAtomicsCB(RpAtomic_0 *pAtomic, void *pData)
{
  ++*(_DWORD *)pData;
  return pAtomic;
}

//----- (003868EC) --------------------------------------------------------
RwFrame_0 *__fastcall FindPedFrameFromNameCB(RwFrame_0 *pFrame, void *pData)
{
  RwFrame_0 *v3; // r4
  int v4; // r6
  const unsigned __int8 *FrameNodeName; // r0

  v3 = pFrame;
  v4 = *(_DWORD *)pData;
  FrameNodeName = GetFrameNodeName(pFrame);
  if ( !strcasecmp((const char *)(v4 + 1), (const char *)FrameNodeName + 1) )
  {
    *((_DWORD *)pData + 1) = v3;
    return 0;
  }
  else
  {
    RwFrameForAllChildren(v3, FindPedFrameFromNameCB, pData);
    if ( *((_DWORD *)pData + 1) )
      return 0;
  }
  return v3;
}

//----- (00386938) --------------------------------------------------------
RwObject_0 *__fastcall FindHeadRadiusCB(RwObject_0 *object, void *data)
{
  if ( ((int)object[9].parent & 2) != 0 )
    _rpAtomicResyncInterpolatedSphere((RpAtomic_0 *)object);
  *(_DWORD *)data = *(_DWORD *)&object[5].type;
  return 0;
}

//----- (00386958) --------------------------------------------------------
CColModel *__fastcall CPedModelInfo::AnimatePedColModelSkinned(CPedModelInfo *this, RpClump_0 *pClump)
{
  CColModel *m_pHitColModel; // r0
  int v5; // r11
  RwV3d_0 *p_xOffset; // r8
  __int64 v7; // d16
  __int64 v8; // d17
  __int64 v9; // d19
  __int64 v10; // d20
  __int64 v11; // d21
  __int64 v12; // d22
  __int64 v13; // d23
  RwMatrix *MatrixArray; // r6
  RwInt32 v15; // r0
  __int64 v16; // d16
  CColSphere *v17; // r0
  __int64 v18; // d19
  __int64 v19; // d20
  __int64 v20; // d21
  __int64 v21; // d16
  __int64 v22; // d17
  __int64 v23; // d22
  __int64 v24; // d23
  RwInt32 v25; // r4
  RwMatrix *v26; // r0
  CColModel *v27; // r0
  CCollisionData *m_pColData; // [sp+10h] [bp-50h]
  RwMatrix *v30; // [sp+14h] [bp-4Ch]
  RpHAnimHierarchy_0 *hierarchy; // [sp+18h] [bp-48h]
  RwMatrix *v32; // [sp+1Ch] [bp-44h]
  CVector vecMax; // [sp+20h] [bp-40h] BYREF
  CVector vecMin; // [sp+2Ch] [bp-34h] BYREF
  RwV3d_0 pointsIn; // [sp+38h] [bp-28h] BYREF

  m_pHitColModel = this->m_pHitColModel;
  if ( m_pHitColModel )
  {
    m_pColData = m_pHitColModel->m_pColData;
    hierarchy = GetAnimHierarchyFromSkinClump(pClump);
    v32 = CGame::m_pWorkingMatrix2;
    v30 = CGame::m_pWorkingMatrix1;
    RwMatrixInvert(CGame::m_pWorkingMatrix1, (const RwMatrix *)((char *)pClump->object.parent + 16));
    v5 = 0;
    p_xOffset = (RwV3d_0 *)&CPedModelInfo::m_pColNodeInfos[0].xOffset;
    do
    {
      pointsIn = *p_xOffset;
      v7 = *(_QWORD *)&v30->right.x;
      v8 = *(_QWORD *)&v30->right.z;
      v9 = *(_QWORD *)&v30->pos.z;
      v10 = *(_QWORD *)&v30->at.x;
      v11 = *(_QWORD *)&v30->at.z;
      v12 = *(_QWORD *)&v30->up.x;
      v13 = *(_QWORD *)&v30->up.z;
      *(_QWORD *)&v32->pos.x = *(_QWORD *)&v30->pos.x;
      *(_QWORD *)&v32->pos.z = v9;
      *(_QWORD *)&v32->at.x = v10;
      *(_QWORD *)&v32->at.z = v11;
      *(_QWORD *)&v32->right.x = v7;
      *(_QWORD *)&v32->right.z = v8;
      *(_QWORD *)&v32->up.x = v12;
      *(_QWORD *)&v32->up.z = v13;
      MatrixArray = RpHAnimHierarchyGetMatrixArray(hierarchy);
      v15 = RpHAnimIDGetIndex(hierarchy, LODWORD(p_xOffset[-1].y));
      RwMatrixTransform(v32, &MatrixArray[v15], rwCOMBINEPRECONCAT);
      RwV3dTransformPoints(&pointsIn, &pointsIn, 1, v32);
      p_xOffset = (RwV3d_0 *)((char *)p_xOffset + 28);
      v16 = *(_QWORD *)&pointsIn.x;
      v17 = &m_pColData->m_pSphereArray[v5++];
      v17->m_vecCentre.z = pointsIn.z;
      *(_QWORD *)&v17->m_vecCentre.x = v16;
    }
    while ( v5 != 12 );
    memset(&pointsIn, 0, sizeof(pointsIn));
    v18 = *(_QWORD *)&v30->pos.z;
    v19 = *(_QWORD *)&v30->at.x;
    v20 = *(_QWORD *)&v30->at.z;
    v21 = *(_QWORD *)&v30->right.x;
    v22 = *(_QWORD *)&v30->right.z;
    v23 = *(_QWORD *)&v30->up.x;
    v24 = *(_QWORD *)&v30->up.z;
    *(_QWORD *)&v32->pos.x = *(_QWORD *)&v30->pos.x;
    *(_QWORD *)&v32->pos.z = v18;
    *(_QWORD *)&v32->at.x = v19;
    *(_QWORD *)&v32->at.z = v20;
    *(_QWORD *)&v32->right.x = v21;
    *(_QWORD *)&v32->right.z = v22;
    *(_QWORD *)&v32->up.x = v23;
    *(_QWORD *)&v32->up.z = v24;
    v25 = RpHAnimIDGetIndex(hierarchy, 3);
    v26 = RpHAnimHierarchyGetMatrixArray(hierarchy);
    RwMatrixTransform(v32, &v26[v25], rwCOMBINEPRECONCAT);
    RwV3dTransformPoints(&pointsIn, &pointsIn, 1, v32);
    CSphere::Set(&this->m_pHitColModel->m_sphereBound, 1.5, (const CVector *)&pointsIn);
    v27 = this->m_pHitColModel;
    vecMin.x = pointsIn.x + -1.2;
    vecMin.y = pointsIn.y + -1.2;
    vecMin.z = pointsIn.z + -1.2;
    vecMax.y = pointsIn.y + 1.2;
    vecMax.x = pointsIn.x + 1.2;
    vecMax.z = pointsIn.z + 1.2;
    CBox::Set(&v27->m_boxBound, &vecMin, &vecMax);
  }
  else
  {
    CPedModelInfo::CreateHitColModelSkinned(this, pClump);
  }
  return this->m_pHitColModel;
}

//----- (00386B24) --------------------------------------------------------
CColModel *__fastcall CPedModelInfo::AnimatePedColModelSkinnedWorld(CPedModelInfo *this, RpClump_0 *pClump)
{
  CColModel *m_pHitColModel; // r0
  CCollisionData *m_pColData; // r9
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r11
  int v7; // r5
  RwV3d_0 *p_xOffset; // r6
  RwMatrix *MatrixArray; // r4
  RwInt32 v10; // r0
  __int64 v11; // d16
  CColSphere *v12; // r0
  RwInt32 v13; // r6
  RwMatrix *v14; // r0
  CColModel *v15; // r0
  CVector v17; // [sp+0h] [bp-40h] BYREF
  CVector vecMin; // [sp+Ch] [bp-34h] BYREF
  RwV3d_0 pointsIn; // [sp+18h] [bp-28h] BYREF

  m_pHitColModel = this->m_pHitColModel;
  if ( !m_pHitColModel )
  {
    CPedModelInfo::CreateHitColModelSkinned(this, pClump);
    m_pHitColModel = this->m_pHitColModel;
  }
  m_pColData = m_pHitColModel->m_pColData;
  AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump(pClump);
  v7 = 0;
  p_xOffset = (RwV3d_0 *)&CPedModelInfo::m_pColNodeInfos[0].xOffset;
  do
  {
    pointsIn = *p_xOffset;
    MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
    v10 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, LODWORD(p_xOffset[-1].y));
    RwV3dTransformPoints(&pointsIn, &pointsIn, 1, &MatrixArray[v10]);
    p_xOffset = (RwV3d_0 *)((char *)p_xOffset + 28);
    v11 = *(_QWORD *)&pointsIn.x;
    v12 = &m_pColData->m_pSphereArray[v7++];
    v12->m_vecCentre.z = pointsIn.z;
    *(_QWORD *)&v12->m_vecCentre.x = v11;
  }
  while ( v7 != 12 );
  memset(&pointsIn, 0, sizeof(pointsIn));
  v13 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 3);
  v14 = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
  RwV3dTransformPoints(&pointsIn, &pointsIn, 1, &v14[v13]);
  CSphere::Set(&this->m_pHitColModel->m_sphereBound, 1.5, (const CVector *)&pointsIn);
  v15 = this->m_pHitColModel;
  vecMin.x = pointsIn.x + -1.2;
  vecMin.y = pointsIn.y + -1.2;
  vecMin.z = pointsIn.z + -1.2;
  v17.y = pointsIn.y + 1.2;
  v17.x = pointsIn.x + 1.2;
  v17.z = pointsIn.z + 1.2;
  CBox::Set(&v15->m_boxBound, &vecMin, &v17);
  return this->m_pHitColModel;
}

//----- (00386C48) --------------------------------------------------------
void __fastcall CPedModelInfo::IncrementVoice(CPedModelInfo *this)
{
  int m_LastVoice; // r3
  int m_FirstVoice; // r1
  Int16 v3; // r2
  bool v4; // nf
  Int16 v5; // r2

  m_FirstVoice = this->m_FirstVoice;
  v3 = -1;
  v4 = m_FirstVoice < 0;
  if ( m_FirstVoice >= 0 )
  {
    m_LastVoice = this->m_LastVoice;
    v4 = m_LastVoice < 0;
  }
  if ( v4 )
    goto LABEL_9;
  v5 = this->m_NextVoice + 1;
  this->m_NextVoice = v5;
  if ( v5 > m_LastVoice )
  {
    v3 = m_FirstVoice;
LABEL_9:
    this->m_NextVoice = v3;
    return;
  }
  if ( v5 < m_FirstVoice )
    this->m_NextVoice = m_FirstVoice;
}
// 386C6A: variable 'm_LastVoice' is possibly undefined

//----- (00386C80) --------------------------------------------------------
void __fastcall CPedModelInfo::~CPedModelInfo(CPedModelInfo *this)
{
  CColModel *m_pHitColModel; // r0
  void *v3; // r0

  m_pHitColModel = this->m_pHitColModel;
  this->_vptr$CBaseModelInfo = (int (**)(void))&off_667658;
  if ( m_pHitColModel )
  {
    CColModel::~CColModel(m_pHitColModel);
    CColModel::operator delete(v3);
  }
}
// 386C98: variable 'v3' is possibly undefined
// 667658: using guessed type void *off_667658;

//----- (00386CA4) --------------------------------------------------------
void __fastcall CPedModelInfo::~CPedModelInfo(CPedModelInfo *this)
{
  CColModel *m_pHitColModel; // r0
  void *v3; // r0

  m_pHitColModel = this->m_pHitColModel;
  this->_vptr$CBaseModelInfo = (int (**)(void))&off_667658;
  if ( m_pHitColModel )
  {
    CColModel::~CColModel(m_pHitColModel);
    CColModel::operator delete(v3);
  }
  sub_191374(this);
}
// 386CBC: variable 'v3' is possibly undefined
// 667658: using guessed type void *off_667658;

//----- (00386CD0) --------------------------------------------------------
uint8 __fastcall CPedModelInfo::GetModelType(CPedModelInfo *this)
{
  return 7;
}

//----- (00386CD4) --------------------------------------------------------
void __fastcall CVehicleModelInfo::CVehicleStructure::CVehicleStructure(CVehicleModelInfo::CVehicleStructure *this)
{
  memset(this, 0, 0xB4u);
  this->m_upgrades[1].parentCompId = -1;
  this->m_upgrades[0].parentCompId = -1;
  this->m_upgrades[2].parentCompId = -1;
  this->m_upgrades[3].parentCompId = -1;
  this->m_upgrades[4].parentCompId = -1;
  this->m_upgrades[5].parentCompId = -1;
  this->m_upgrades[6].parentCompId = -1;
  this->m_upgrades[7].parentCompId = -1;
  this->m_upgrades[8].parentCompId = -1;
  this->m_upgrades[9].parentCompId = -1;
  this->m_upgrades[10].parentCompId = -1;
  this->m_upgrades[11].parentCompId = -1;
  this->m_upgrades[12].parentCompId = -1;
  this->m_upgrades[13].parentCompId = -1;
  this->m_upgrades[14].parentCompId = -1;
  this->m_upgrades[15].parentCompId = -1;
  this->m_upgrades[16].parentCompId = -1;
  this->m_upgrades[17].parentCompId = -1;
  *(_QWORD *)&this->m_pXtraAtomicLOD[2] = 0LL;
  *(_QWORD *)&this->m_pXtraAtomicLOD[4] = 0LL;
  *(_QWORD *)&this->m_pXtraAtomic[4] = 0LL;
  *(_QWORD *)this->m_pXtraAtomicLOD = 0LL;
  *(_QWORD *)this->m_pXtraAtomic = 0LL;
  *(_QWORD *)&this->m_pXtraAtomic[2] = 0LL;
  this->m_numXtraAtomics = 0;
  this->m_nFlagDamageModelsAvailable = 0;
}

//----- (00386D56) --------------------------------------------------------
void __fastcall CVehicleModelInfo::CVehicleStructure::~CVehicleStructure(CVehicleModelInfo::CVehicleStructure *this)
{
  int v2; // r6
  char *v3; // r4
  RpAtomic_0 *v4; // r0
  RwFrame_0 *parent; // r5
  RpAtomic_0 *v6; // r0

  if ( this->m_numXtraAtomics >= 1 )
  {
    v2 = 0;
    do
    {
      v3 = (char *)this + 4 * v2;
      v4 = (RpAtomic_0 *)*((_DWORD *)v3 + 189);
      parent = (RwFrame_0 *)v4->object.object.parent;
      RpAtomicDestroy(v4);
      v6 = (RpAtomic_0 *)*((_DWORD *)v3 + 195);
      if ( v6 )
        RpAtomicDestroy(v6);
      RwFrameDestroy(parent);
      ++v2;
    }
    while ( v2 < this->m_numXtraAtomics );
  }
}

//----- (00386D9C) --------------------------------------------------------
void CVehicleModelInfo::ShutdownLightTexture()
{
  if ( CVehicleModelInfo::ms_pLightsTexture )
  {
    RwTextureDestroy(CVehicleModelInfo::ms_pLightsTexture);
    CVehicleModelInfo::ms_pLightsTexture = 0;
  }
  if ( CVehicleModelInfo::ms_pLightsOnTexture )
  {
    RwTextureDestroy(CVehicleModelInfo::ms_pLightsOnTexture);
    CVehicleModelInfo::ms_pLightsOnTexture = 0;
  }
}

//----- (00386DE8) --------------------------------------------------------
void __fastcall CVehicleModelInfo::CLinkedUpgradeList::AddUpgradeLink(
        CVehicleModelInfo::CLinkedUpgradeList *this,
        int16 m1,
        int16 m2)
{
  this->m_model1[this->m_number] = m1;
  this->m_model2[this->m_number++] = m2;
}

//----- (00386DFE) --------------------------------------------------------
int16 __fastcall CVehicleModelInfo::CLinkedUpgradeList::FindOtherUpgrade(
        const CVehicleModelInfo::CLinkedUpgradeList *this,
        int16 modelId)
{
  int32 m_number; // r2
  int16 *v3; // r0
  int v4; // r2
  unsigned __int16 *v5; // r0
  int v6; // r12
  int v7; // lr

  m_number = this->m_number;
  v3 = &this->m_model1[m_number];
  v4 = -m_number;
  v5 = (unsigned __int16 *)(v3 + 29);
  while ( v4 )
  {
    v6 = *v5;
    v7 = *(v5 - 30);
    if ( v7 == (unsigned __int16)modelId )
      return v6;
    --v5;
    ++v4;
    if ( v6 == (unsigned __int16)modelId )
    {
      LOWORD(v6) = v7;
      return v6;
    }
  }
  return -1;
}

//----- (00386E38) --------------------------------------------------------
RwTexture_0 *__fastcall CVehicleModelInfo::FindTextureCB(const unsigned __int8 *pTexname)
{
  TextureDatabaseRuntime *Database; // r0

  Database = TextureDatabaseRuntime::GetDatabase((const char *)&off_386E54);
  TextureDatabaseRuntime::Register(Database);
  return sub_19CE3C(pTexname);
}
// 386E54: using guessed type void *off_386E54;

//----- (00386E58) --------------------------------------------------------
void CVehicleModelInfo::UseCommonVehicleTexDicationary()
{
  gDefaultFindCB = RwTextureGetFindCallBack();
  sub_1A1650(CVehicleModelInfo::FindTextureCB);
}

//----- (00386E80) --------------------------------------------------------
void CVehicleModelInfo::StopUsingCommonVehicleTexDicationary()
{
  RwTextureSetFindCallBack(gDefaultFindCB);
  gDefaultFindCB = 0;
}

//----- (00386E98) --------------------------------------------------------
void __fastcall CVehicleModelInfo::CVehicleModelInfo(CVehicleModelInfo *this)
{
  CBaseModelInfo::CBaseModelInfo(this);
  this->m_pStructure = 0;
  this->m_numPossibleColours = 0;
  this->m_animFileIndex = -1;
  this->m_flags = 0;
  this->_vptr$CBaseModelInfo = (int (**)(void))&off_6676A8;
  memset(this->m_upgradeModels, 255, sizeof(this->m_upgradeModels));
  *(_QWORD *)this->m_remaps = 0LL;
  *(_QWORD *)&this->m_remaps[2] = 0LL;
}
// 6676A8: using guessed type void *;

//----- (00386EE0) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetAnimFile(CVehicleModelInfo *this, const unsigned __int8 *pName)
{
  size_t v4; // r0
  char *v5; // r0

  if ( !strcasecmp((const char *)pName, "null") )
  {
    this->m_animFileIndex = -1;
  }
  else
  {
    v4 = strlen((const char *)pName);
    v5 = (char *)operator new[](v4 + 1);
    this->m_animFileIndex = (u_native)v5;
    sub_19B9DC(v5, (const char *)pName);
  }
}

//----- (00386F20) --------------------------------------------------------
void __fastcall CVehicleModelInfo::ConvertAnimFileIndex(CVehicleModelInfo *this)
{
  const unsigned __int8 *m_animFileIndex; // r0
  u_native AnimationBlockIndex; // r5
  void *v4; // r0

  m_animFileIndex = (const unsigned __int8 *)this->m_animFileIndex;
  if ( m_animFileIndex != (const unsigned __int8 *)-1 )
  {
    AnimationBlockIndex = CAnimManager::GetAnimationBlockIndex(m_animFileIndex);
    v4 = (void *)this->m_animFileIndex;
    if ( v4 )
      operator delete[](v4);
    this->m_animFileIndex = AnimationBlockIndex;
  }
}

//----- (00386F48) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetClump(CVehicleModelInfo *this, RpClump_0 *pClump)
{
  int v4; // r2
  CPool<CVehicleModelInfo::CVehicleStructure,CVehicleModelInfo::CVehicleStructure> *v5; // r0
  int32 m_nSize; // r1
  int32 m_nFreeIndex; // r6
  uint8 *m_aFlags; // r3
  int v9; // r5
  RpMaterial_0 *v10; // r0
  RwV3d_0 v11; // [sp+0h] [bp-20h] BYREF

  v4 = 0;
  v5 = CVehicleModelInfo::CVehicleStructure::m_pInfoPool;
  m_nFreeIndex = CVehicleModelInfo::CVehicleStructure::m_pInfoPool->m_nFreeIndex;
  m_nSize = CVehicleModelInfo::CVehicleStructure::m_pInfoPool->m_nSize;
  do
  {
    v5->m_nFreeIndex = ++m_nFreeIndex;
    if ( m_nFreeIndex == m_nSize )
    {
      m_nFreeIndex = 0;
      v5->m_nFreeIndex = 0;
      if ( v4 << 31 )
        goto LABEL_7;
      v4 = 1;
    }
    m_aFlags = v5->m_aFlags;
    v9 = (char)m_aFlags[m_nFreeIndex];
  }
  while ( v9 > -1 );
  m_aFlags[m_nFreeIndex] = v9 & 0x7F;
  v5->m_aFlags[v5->m_nFreeIndex] = (v5->m_aFlags[v5->m_nFreeIndex] + 1) & 0x7F | v5->m_aFlags[v5->m_nFreeIndex] & 0x80;
  m_nFreeIndex = (int32)v5->m_aStorage[v5->m_nFreeIndex];
LABEL_7:
  memset((void *)m_nFreeIndex, 0, 0xB4u);
  *(_DWORD *)(m_nFreeIndex + 240) = -1;
  *(_DWORD *)(m_nFreeIndex + 208) = -1;
  *(_DWORD *)(m_nFreeIndex + 272) = -1;
  *(_DWORD *)(m_nFreeIndex + 304) = -1;
  *(_DWORD *)(m_nFreeIndex + 336) = -1;
  *(_DWORD *)(m_nFreeIndex + 368) = -1;
  *(_DWORD *)(m_nFreeIndex + 400) = -1;
  *(_DWORD *)(m_nFreeIndex + 432) = -1;
  *(_DWORD *)(m_nFreeIndex + 464) = -1;
  *(_DWORD *)(m_nFreeIndex + 496) = -1;
  *(_DWORD *)(m_nFreeIndex + 528) = -1;
  *(_DWORD *)(m_nFreeIndex + 560) = -1;
  *(_DWORD *)(m_nFreeIndex + 592) = -1;
  *(_DWORD *)(m_nFreeIndex + 624) = -1;
  *(_DWORD *)(m_nFreeIndex + 656) = -1;
  *(_DWORD *)(m_nFreeIndex + 688) = -1;
  *(_DWORD *)(m_nFreeIndex + 720) = -1;
  *(_DWORD *)(m_nFreeIndex + 752) = -1;
  *(_DWORD *)(m_nFreeIndex + 808) = 0;
  *(_QWORD *)(m_nFreeIndex + 788) = 0LL;
  *(_QWORD *)(m_nFreeIndex + 796) = 0LL;
  *(_QWORD *)(m_nFreeIndex + 772) = 0LL;
  *(_QWORD *)(m_nFreeIndex + 780) = 0LL;
  *(_QWORD *)(m_nFreeIndex + 756) = 0LL;
  *(_QWORD *)(m_nFreeIndex + 764) = 0LL;
  *(_BYTE *)(m_nFreeIndex + 804) = 0;
  this->m_pStructure = (CVehicleModelInfo::CVehicleStructure *)m_nFreeIndex;
  CClumpModelInfo::SetClump(this, pClump);
  CVehicleModelInfo::SetAtomicRenderCallbacks(this);
  CClumpModelInfo::SetFrameIds(this, CVehicleModelInfo::ms_vehicleDescs[this->m_vehicleType].pAssocArray);
  CCarFXRenderer::CustomCarPipeClumpSetup((RpClump_0 *)this->m_pRwObject);
  if ( !pMatFxIdentityFrame )
  {
    v11.z = 0.0;
    *(_QWORD *)&v11.x = unk_6107A8;
    pMatFxIdentityFrame = RwFrameCreate();
    RwMatrixRotate(&pMatFxIdentityFrame->modelling, &v11, 60.0, rwCOMBINEREPLACE);
    RwFrameUpdateObjects(pMatFxIdentityFrame);
    RwFrameGetLTM(pMatFxIdentityFrame);
  }
  CVehicleModelInfo::PreprocessHierarchy(this);
  CVehicleModelInfo::ReduceMaterialsInVehicle(this);
  CVehicleModelInfo::FindEditableMaterialList(this);
  this->tabCustomPlateText[0] = 0;
  this->pCustomPlateMaterial = 0;
  this->nCarplateDesign = -1;
  LOBYTE(v11.z) = 0;
  strcpy((char *)&v11, "DEFAULT");
  CCustomCarPlateMgr::GeneratePlateText((unsigned __int8 *)&v11, 8);
  v10 = CCustomCarPlateMgr::SetupClump((RpClump_0 *)this->m_pRwObject, (unsigned __int8 *)&v11, this->nCarplateDesign);
  if ( v10 )
    this->pCustomPlateMaterial = v10;
}

//----- (00387114) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetAtomicRenderCallbacks(CVehicleModelInfo *this)
{
  VehicleType m_vehicleType; // r1
  void **v2; // r1
  RpClump_0 *m_pRwObject; // r0
  void **v4; // r1
  RpClump_0 *v5; // r2
  RpAtomic_0 *(*v6)(RpAtomic_0 *, void *); // r1

  m_vehicleType = this->m_vehicleType;
  switch ( m_vehicleType )
  {
    case VEHICLE_TYPE_PLANE:
    case VEHICLE_TYPE_FAKE_PLANE:
      v2 = &CVehicleModelInfo::SetAtomicRendererCB_BigVehicle;
      goto LABEL_5;
    case VEHICLE_TYPE_BOAT:
      m_pRwObject = (RpClump_0 *)this->m_pRwObject;
      v4 = &CVehicleModelInfo::SetAtomicRendererCB_Boat;
      goto LABEL_10;
    case VEHICLE_TYPE_TRAIN:
      v2 = &CVehicleModelInfo::SetAtomicRendererCB_Train;
LABEL_5:
      m_pRwObject = (RpClump_0 *)this->m_pRwObject;
      v5 = 0;
      v6 = (RpAtomic_0 *(*)(RpAtomic_0 *, void *))*v2;
      goto LABEL_6;
    default:
      m_pRwObject = (RpClump_0 *)this->m_pRwObject;
      if ( m_vehicleType == VEHICLE_TYPE_HELI )
        v4 = &CVehicleModelInfo::SetAtomicRendererCB_RealHeli;
      else
        v4 = &CVehicleModelInfo::SetAtomicRendererCB;
LABEL_10:
      v6 = (RpAtomic_0 *(*)(RpAtomic_0 *, void *))*v4;
      v5 = m_pRwObject;
LABEL_6:
      sub_18E410(m_pRwObject, v6, v5);
      return;
  }
}
// 676E78: using guessed type void *CVehicleModelInfo::SetAtomicRendererCB_Train;
// 6779E8: using guessed type void *CVehicleModelInfo::SetAtomicRendererCB_RealHeli;
// 678C28: using guessed type void *CVehicleModelInfo::SetAtomicRendererCB_Boat;
// 678DB4: using guessed type void *CVehicleModelInfo::SetAtomicRendererCB_BigVehicle;
// 679868: using guessed type void *CVehicleModelInfo::SetAtomicRendererCB;

//----- (00387170) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetRenderPipelines(CVehicleModelInfo *this)
{
  RwV3d_0 v1; // [sp+0h] [bp-18h] BYREF

  CCarFXRenderer::CustomCarPipeClumpSetup((RpClump_0 *)this->m_pRwObject);
  if ( !pMatFxIdentityFrame )
  {
    v1.z = 0.0;
    *(_QWORD *)&v1.x = unk_6107A8;
    pMatFxIdentityFrame = RwFrameCreate();
    RwMatrixRotate(&pMatFxIdentityFrame->modelling, &v1, 60.0, rwCOMBINEREPLACE);
    RwFrameUpdateObjects(pMatFxIdentityFrame);
    RwFrameGetLTM(pMatFxIdentityFrame);
  }
}

//----- (003871D0) --------------------------------------------------------
void __fastcall CVehicleModelInfo::PreprocessHierarchy(CVehicleModelInfo *this)
{
  RwFrame_0 *hierId; // r6
  VehicleType m_vehicleType; // r11
  RwObjectNameIdAssocation *pAssocArray; // r0
  CVehicleModelInfo *v4; // r4
  int v5; // r10
  uint32 flags; // r1
  RwFrame_0 *v7; // r8
  RwObjectNameIdAssocation *v8; // r1
  uint32 v9; // r0
  RpAtomic_0 *SecondObject; // r5
  __int64 v11; // d16
  CVector *v12; // r1
  char *v13; // r1
  bool v14; // zf
  int v15; // r6
  int v16; // t1
  u_native FrameHierarchyId; // r0
  __int64 v18; // d16
  int32 v19; // r5
  char *v20; // r1
  CVehicleModelInfo::CVehicleStructure *m_pStructure; // r0
  int m_numXtraAtomics; // r1
  uint32 v23; // r5
  RwObject_0 *FirstObject; // r0
  RpAtomic_0 *v25; // r1
  RpAtomic_0 *v26; // r1
  int i; // r10
  RwFrame_0 *v28; // r3
  uint32 v29; // r2
  RwFrame_0 *v30; // r0
  bool v31; // zf
  RwReal v32; // r1
  int v33; // r0
  RpAtomic_0 *v34; // r6
  int v35; // r0
  bool v36; // zf
  RwFrame_0 *v37; // r6
  RpAtomic_0 *v38; // r0
  bool v39; // zf
  RpAtomic_0 *v40; // r6
  char *v41; // r1
  RpAtomic_0 *v42; // [sp+4h] [bp-84h]
  RpAtomicCallBackRender m_handlingId_low; // [sp+1Ch] [bp-6Ch]
  RpAtomic_0 *v44; // [sp+34h] [bp-54h]
  RpAtomic_0 *atomic; // [sp+38h] [bp-50h]
  RwFrame_0 *parent[2]; // [sp+50h] [bp-38h] BYREF
  RwReal z; // [sp+58h] [bp-30h]
  unsigned __int8 *data; // [sp+60h] [bp-28h] BYREF
  RwFrame_0 *frame; // [sp+64h] [bp-24h]

  m_vehicleType = this->m_vehicleType;
  this->m_numDoors = 0;
  pAssocArray = CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray;
  if ( pAssocArray->pName )
  {
    v4 = this;
    v5 = 0;
    m_handlingId_low = (RpAtomicCallBackRender)LOBYTE(this->m_handlingId);
    atomic = 0;
    v44 = 0;
    do
    {
      flags = pAssocArray[v5].flags;
      if ( (flags & (unsigned int)&elf_hash_chain[16424]) != 0 )
      {
        frame = 0;
        data = pAssocArray[v5].pName;
        RwFrameForAllChildren(
          (RwFrame_0 *)v4->m_pRwObject->parent,
          CClumpModelInfo::FindFrameFromNameWithoutIdCB,
          &data);
        v7 = frame;
        if ( frame )
        {
          v8 = &CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray[v5];
          v9 = v8->flags;
          if ( (v9 & 8) != 0 )
          {
            v11 = *(_QWORD *)&frame->modelling.pos.x;
            z = frame->modelling.pos.z;
            *(_QWORD *)parent = v11;
            v12 = &this->m_pStructure->m_positions[v8->hierId];
            v12->z = z;
            *(_QWORD *)&v12->x = v11;
            v13 = (char *)v7->object.parent;
            v14 = v13 == 0;
            if ( v13 )
            {
              hierId = (RwFrame_0 *)(v13 + 4);
              v14 = *((_DWORD *)v13 + 1) == 0;
            }
            if ( !v14 )
            {
              do
              {
                RwV3dTransformPoints(
                  &this->m_pStructure->m_positions[CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray[v5].hierId],
                  &this->m_pStructure->m_positions[CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray[v5].hierId],
                  1,
                  (const RwMatrix *)(v13 + 16));
                v13 = *(char **)&hierId->object.type;
                v15 = *(_DWORD *)&hierId->object.type;
                v16 = *(_DWORD *)(v15 + 4);
                hierId = (RwFrame_0 *)(v15 + 4);
              }
              while ( v16 );
              v7 = frame;
            }
            RwFrameDestroy(v7);
          }
          else if ( (v9 & 0x20000) != 0 )
          {
            hierId = (RwFrame_0 *)v8->hierId;
            FrameHierarchyId = CVisibilityPlugins::GetFrameHierarchyId((RwFrame_0 *)frame->object.parent);
            v18 = *(_QWORD *)&v7->modelling.pos.x;
            v19 = FrameHierarchyId;
            z = v7->modelling.pos.z;
            *(_QWORD *)parent = v18;
            v20 = (char *)this->m_pStructure + 32 * (_DWORD)hierId;
            *((RwReal *)v20 + 47) = z;
            *(_QWORD *)(v20 + 180) = v18;
            CQuaternion::Set(&this->m_pStructure->m_upgrades[(_DWORD)hierId].quat, &v7->modelling);
            this->m_pStructure->m_upgrades[(_DWORD)hierId].parentCompId = v19;
          }
          else
          {
            hierId = (RwFrame_0 *)GetFirstObject(frame);
            SecondObject = (RpAtomic_0 *)GetSecondObject(v7);
            RpClumpRemoveAtomic((RpClump_0 *)this->m_pRwObject, (RpAtomic_0 *)hierId);
            if ( (*(_BYTE *)(LODWORD(hierId->modelling.right.z) + 9) & 4) != 0 )
            {
              RpClumpRemoveAtomic((RpClump_0 *)this->m_pRwObject, SecondObject);
              CVehicleModelInfo::SetVehicleComponentFlags(
                this,
                v7,
                CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray[v5].flags);
              this->m_pStructure->m_pXtraAtomicLOD[this->m_pStructure->m_numXtraAtomics] = (RpAtomic_0 *)hierId;
            }
            else
            {
              CVehicleModelInfo::SetVehicleComponentFlags(
                this,
                v7,
                CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray[v5].flags);
              SecondObject = (RpAtomic_0 *)hierId;
              this->m_pStructure->m_pXtraAtomicLOD[this->m_pStructure->m_numXtraAtomics] = 0;
            }
            m_pStructure = this->m_pStructure;
            m_numXtraAtomics = m_pStructure->m_numXtraAtomics;
            m_pStructure->m_numXtraAtomics = m_numXtraAtomics + 1;
            m_pStructure->m_pXtraAtomic[m_numXtraAtomics] = SecondObject;
            RwFrameRemoveChild(v7);
          }
        }
        v4 = this;
        pAssocArray = CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray;
        flags = pAssocArray[v5].flags;
      }
      if ( (flags & 0x110000) != 0 )
      {
        parent[1] = 0;
        parent[0] = (RwFrame_0 *)pAssocArray[v5].hierId;
        RwFrameForAllChildren((RwFrame_0 *)v4->m_pRwObject->parent, CClumpModelInfo::FindFrameFromIdCB, parent);
        hierId = parent[1];
        if ( parent[1] )
        {
          while ( !GetFirstObject(hierId) )
          {
            hierId = GetFirstChild(hierId);
            if ( !hierId )
              goto LABEL_29;
          }
          v23 = CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray[v5].flags & 0x10000;
          FirstObject = GetFirstObject(hierId);
          v25 = atomic;
          if ( v23 )
            v25 = (RpAtomic_0 *)FirstObject;
          atomic = v25;
          v26 = v44;
          if ( !v23 )
            v26 = (RpAtomic_0 *)FirstObject;
          v44 = v26;
        }
LABEL_29:
        pAssocArray = CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray;
      }
      ++v5;
    }
    while ( pAssocArray[v5].pName );
    if ( pAssocArray->pName )
    {
      for ( i = 8; ; i += 12 )
      {
        if ( (*(int *)((_BYTE *)&pAssocArray->pName + i) & (unsigned int)&elf_hash_chain[16424]) != 0 )
          goto LABEL_59;
        parent[1] = 0;
        parent[0] = *(RwFrame_0 **)((char *)pAssocArray + i - 4);
        RwFrameForAllChildren((RwFrame_0 *)this->m_pRwObject->parent, CClumpModelInfo::FindFrameFromIdCB, parent);
        v28 = parent[1];
        if ( !parent[1] )
          goto LABEL_59;
        v29 = *(uint32 *)((char *)&CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray->pName + i);
        if ( (v29 & 0x10) != 0 )
        {
          ++this->m_numDoors;
          v29 = *(uint32 *)((char *)&CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray->pName + i);
        }
        if ( (v29 & 2) != 0 )
        {
          data = 0;
          frame = 0;
          RwFrameForAllChildren(v28, CVehicleModelInfo::CollapseFramesCB, v28);
          RwFrameUpdateObjects(parent[1]);
          v30 = RwFrameForAllObjects(parent[1], GetOkAndDamagedAtomicCB, &data);
          v31 = data == 0;
          if ( data )
          {
            v30 = frame;
            v31 = frame == 0;
          }
          if ( !v31 )
          {
            v32 = *((float *)data + 18);
            v30->modelling.pos.z = v32;
            if ( v32 == 0.0 )
              LODWORD(v30->modelling.pos.z) = AtomicDefaultRenderCallBack;
            this->m_pStructure->m_nFlagDamageModelsAvailable |= 1 << *(_DWORD *)((char *)CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray
                                                                               + i
                                                                               - 4);
          }
          v28 = parent[1];
          v29 = *(uint32 *)((char *)&CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray->pName + i);
        }
        CVehicleModelInfo::SetVehicleComponentFlags(this, v28, v29);
        v33 = *(int *)((char *)&CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray->pName + i);
        if ( (v33 & 0x10004) == 0 )
          break;
        if ( atomic )
        {
          if ( (v33 & 0x10000) != 0 )
          {
            RwFrameForAllChildren(parent[1], CVehicleModelInfo::CollapseFramesCB, parent[1]);
            RwFrameUpdateObjects(parent[1]);
            v38 = atomic;
          }
          else
          {
            v34 = RpAtomicClone(atomic);
            RpAtomicSetFrame(v34, parent[1]);
            RpClumpAddAtomic((RpClump_0 *)this->m_pRwObject, v34);
            CVisibilityPlugins::SetAtomicRenderCallback(v34, CVisibilityPlugins::RenderWheelAtomicCB);
            v35 = *(_DWORD *)((char *)CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray + i - 4);
            v36 = v35 == 2;
            if ( v35 != 2 )
              v36 = v35 == 5;
            if ( v36 || (mod_HandlingManager.m_aHandlingData[(_DWORD)m_handlingId_low].mFlags & 0x20000000) == 0 )
              goto LABEL_59;
            v42 = RpAtomicClone(atomic);
            v37 = RwFrameCreate();
            RpAtomicSetFrame(v42, v37);
            RwFrameAddChild(parent[1], v37);
            v37->modelling.up.x = 0.0;
            v37->modelling.up.y = 1.0;
            v37->modelling.right.z = 0.0;
            v37->modelling.right.x = 1.0;
            v37->modelling.right.y = 0.0;
            v37->modelling.up.z = 0.0;
            v37->modelling.at.x = 0.0;
            v37->modelling.at.y = 0.0;
            v37->modelling.at.z = 1.0;
            v37->modelling.pos.x = -0.2875;
            v37->modelling.pos.y = 0.0;
            v37->modelling.pos.z = 0.0;
            v37->modelling.flags |= (unsigned int)&elf_hash_chain[16294] + 3;
            RpClumpAddAtomic((RpClump_0 *)this->m_pRwObject, v42);
            v38 = v42;
          }
          goto LABEL_57;
        }
LABEL_59:
        pAssocArray = CVehicleModelInfo::ms_vehicleDescs[m_vehicleType].pAssocArray;
        v41 = (char *)pAssocArray + i;
        if ( !*((_DWORD *)v41 + 1) )
          return;
      }
      v39 = v44 == 0;
      if ( v44 )
        v39 = (v33 & 0x200000) == 0;
      if ( v39 )
        goto LABEL_59;
      v40 = RpAtomicClone(v44);
      RpAtomicSetFrame(v40, parent[1]);
      RpClumpAddAtomic((RpClump_0 *)this->m_pRwObject, v40);
      v38 = v40;
LABEL_57:
      CVisibilityPlugins::SetAtomicRenderCallback(v38, CVisibilityPlugins::RenderWheelAtomicCB);
      goto LABEL_59;
    }
  }
}
// 38735E: variable 'hierId' is possibly undefined
// 10168: using guessed type int elf_hash_chain[22025];

//----- (00387788) --------------------------------------------------------
void __fastcall CVehicleModelInfo::ReduceMaterialsInVehicle(CVehicleModelInfo *this)
{
  RpClump_0 *m_pRwObject; // r8
  CVehicleModelInfo::CVehicleStructure *m_pStructure; // r0
  int v4; // r11
  RpAtomic_0 *v5; // r0
  RpGeometry_0 *geometry; // r5
  RpMeshHeader_0 *mesh; // r4
  RpMaterial_0 **p_totalIndicesInMesh; // r6
  int v9; // r4
  RpMaterial_0 *v10; // t1
  RpAtomic_0 *v11; // r0
  RpGeometry_0 *v12; // r5
  RpMeshHeader_0 *v13; // r4
  RpMaterial_0 **v14; // r6
  int v15; // r4
  RpMaterial_0 *v16; // t1
  RpMaterialList_0 v17[3]; // [sp+0h] [bp-28h] BYREF

  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  CMemoryMgr::LockScratchPad();
  CMemoryMgr::InitScratchPad();
  v17[0].space = 20;
  v17[0].materials = (RpMaterial_0 **)CMemoryMgr::Malloc(0x50u);
  v17[0].numMaterials = 0;
  CTimer::GetCurrentTimeInCycles();
  RpClumpForAllAtomics(m_pRwObject, UseReducedMaterialListCB, v17);
  m_pStructure = this->m_pStructure;
  if ( m_pStructure->m_numXtraAtomics >= 1 )
  {
    v4 = 0;
    do
    {
      v5 = m_pStructure->m_pXtraAtomic[v4];
      geometry = v5->geometry;
      mesh = geometry->mesh;
      if ( (CVisibilityPlugins::GetAtomicId(v5) & 0x2000) == 0 && geometry->mesh->numMeshes )
      {
        p_totalIndicesInMesh = (RpMaterial_0 **)&mesh[1].totalIndicesInMesh;
        v9 = 0;
        do
        {
          v10 = *p_totalIndicesInMesh;
          p_totalIndicesInMesh += 4;
          _rpMaterialListAppendMaterial(v17, v10);
          ++v9;
        }
        while ( v9 < geometry->mesh->numMeshes );
      }
      v11 = this->m_pStructure->m_pXtraAtomicLOD[v4];
      if ( v11 )
      {
        v12 = v11->geometry;
        v13 = v12->mesh;
        if ( (CVisibilityPlugins::GetAtomicId(v11) & 0x2000) == 0 )
        {
          if ( v12->mesh->numMeshes )
          {
            v14 = (RpMaterial_0 **)&v13[1].totalIndicesInMesh;
            v15 = 0;
            do
            {
              v16 = *v14;
              v14 += 4;
              _rpMaterialListAppendMaterial(v17, v16);
              ++v15;
            }
            while ( v15 < v12->mesh->numMeshes );
          }
        }
      }
      m_pStructure = this->m_pStructure;
      ++v4;
    }
    while ( v4 < m_pStructure->m_numXtraAtomics );
  }
  CTimer::GetCurrentTimeInCycles();
  CTimer::GetCyclesPerMillisecond();
  _rpMaterialListDeinitialize(v17);
  CMemoryMgr::ReleaseScratchPad();
  CVisibilityPlugins::ClearClumpForAllAtomicsFlag(m_pRwObject, 0x2000);
}

//----- (0038787C) --------------------------------------------------------
void __fastcall CVehicleModelInfo::FindEditableMaterialList(CVehicleModelInfo *this)
{
  CVehicleModelInfo::CVehicleStructure *m_pStructure; // r0
  int v3; // r6
  RpAtomic_0 *v4; // r1
  int32 v5; // r3
  int32 v6; // r2
  int32 v7; // r1
  int32 v8; // r0
  CVehicleModelInfo *v9; // [sp+0h] [bp-30h] BYREF
  __int64 v10; // [sp+4h] [bp-2Ch]
  __int64 v11; // [sp+Ch] [bp-24h]
  int32 v12; // [sp+14h] [bp-1Ch]

  v10 = 0LL;
  v11 = 0LL;
  v12 = 0;
  v9 = this;
  RpClumpForAllAtomics((RpClump_0 *)this->m_pRwObject, CVehicleModelInfo::GetEditableMaterialListCB, &v9);
  m_pStructure = this->m_pStructure;
  if ( m_pStructure->m_numXtraAtomics >= 1 )
  {
    v3 = 0;
    do
    {
      RpGeometryForAllMaterials(
        m_pStructure->m_pXtraAtomic[v3]->geometry,
        CVehicleModelInfo::GetEditableMaterialListCB,
        &v9);
      m_pStructure = this->m_pStructure;
      v4 = m_pStructure->m_pXtraAtomicLOD[v3];
      if ( v4 )
      {
        RpGeometryForAllMaterials(v4->geometry, CVehicleModelInfo::GetEditableMaterialListCB, &v9);
        m_pStructure = this->m_pStructure;
      }
      ++v3;
    }
    while ( v3 < m_pStructure->m_numXtraAtomics );
  }
  v5 = v10;
  this->m_firstColour[v10] = 0;
  v6 = HIDWORD(v10);
  this->m_secondColour[HIDWORD(v10)] = 0;
  v7 = v11;
  this->m_thirdColour[v11] = 0;
  v8 = HIDWORD(v11);
  this->m_fourthColour[HIDWORD(v11)] = 0;
  if ( v5 > maxNumMat1 )
    maxNumMat1 = v5;
  if ( v6 > maxNumMat2 )
    maxNumMat2 = v6;
  if ( v7 > maxNumMat3 )
    maxNumMat3 = v7;
  if ( v8 > maxNumMat4 )
    maxNumMat4 = v8;
  if ( v12 > maxNumDirt )
    maxNumDirt = v12;
  *(_DWORD *)this->m_lastCol = -1;
}

//----- (003879B8) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetCarCustomPlate(CVehicleModelInfo *this)
{
  RpMaterial_0 *v2; // r0
  double v3; // [sp+0h] [bp-18h] BYREF
  char v4; // [sp+8h] [bp-10h]

  this->tabCustomPlateText[0] = 0;
  this->pCustomPlateMaterial = 0;
  this->nCarplateDesign = -1;
  v4 = 0;
  strcpy((char *)&v3, "DEFAULT");
  CCustomCarPlateMgr::GeneratePlateText((unsigned __int8 *)&v3, 8);
  v2 = CCustomCarPlateMgr::SetupClump((RpClump_0 *)this->m_pRwObject, (unsigned __int8 *)&v3, this->nCarplateDesign);
  if ( v2 )
    this->pCustomPlateMaterial = v2;
}

//----- (00387A28) --------------------------------------------------------
RwObject_0 *__fastcall CVehicleModelInfo::CreateInstance(CVehicleModelInfo *this)
{
  RpClump_0 *Instance; // r4
  VehicleType m_vehicleType; // r0
  RwFrame_0 *FrameFromId; // r8
  int32 v5; // r6
  int32 v6; // r6
  RpAtomic_0 *v7; // r0
  RpAtomic_0 *v8; // r10
  RwFrame_0 *v9; // r9
  RpAtomic_0 *v10; // r0
  RpAtomic_0 *v11; // r10
  RpAtomic_0 *v12; // r0
  RpAtomic_0 *v13; // r10
  RwFrame_0 *v14; // r9
  RpAtomic_0 *v15; // r0
  RpAtomic_0 *v16; // r5

  Instance = (RpClump_0 *)CClumpModelInfo::CreateInstance(this);
  if ( this->m_pStructure->m_numXtraAtomics )
  {
    m_vehicleType = this->m_vehicleType;
    if ( m_vehicleType < VEHICLE_TYPE_BOAT || (unsigned int)(m_vehicleType - 9) <= 1 )
    {
      FrameFromId = CClumpModelInfo::GetFrameFromId(Instance, 1);
      if ( !FrameFromId )
        FrameFromId = (RwFrame_0 *)Instance->object.parent;
    }
    else
    {
      FrameFromId = (RwFrame_0 *)Instance->object.parent;
    }
    v6 = CVehicleModelInfo::ChooseComponent(this);
    if ( v6 != -1 )
    {
      v7 = this->m_pStructure->m_pXtraAtomic[v6];
      if ( v7 )
      {
        v8 = RpAtomicClone(v7);
        v9 = RwFrameCreate();
        RwFrameTransform(
          v9,
          (const RwMatrix *)((char *)this->m_pStructure->m_pXtraAtomic[v6]->object.object.parent + 16),
          rwCOMBINEREPLACE);
        RpAtomicSetFrame(v8, v9);
        RpClumpAddAtomic(Instance, v8);
        v10 = this->m_pStructure->m_pXtraAtomicLOD[v6];
        if ( v10 )
        {
          v11 = RpAtomicClone(v10);
          RpAtomicSetFrame(v11, v9);
          RpClumpAddAtomic(Instance, v11);
        }
        RwFrameAddChild(FrameFromId, v9);
      }
    }
    CVehicleModelInfo::ms_compsUsed[0] = v6;
    v5 = CVehicleModelInfo::ChooseSecondComponent(this);
    if ( v5 != -1 )
    {
      v12 = this->m_pStructure->m_pXtraAtomic[v5];
      if ( v12 )
      {
        v13 = RpAtomicClone(v12);
        v14 = RwFrameCreate();
        RwFrameTransform(
          v14,
          (const RwMatrix *)((char *)this->m_pStructure->m_pXtraAtomic[v5]->object.object.parent + 16),
          rwCOMBINEREPLACE);
        RpAtomicSetFrame(v13, v14);
        RpClumpAddAtomic(Instance, v13);
        v15 = this->m_pStructure->m_pXtraAtomicLOD[v5];
        if ( v15 )
        {
          v16 = RpAtomicClone(v15);
          RpAtomicSetFrame(v16, v14);
          RpClumpAddAtomic(Instance, v16);
        }
        RwFrameAddChild(FrameFromId, v14);
      }
    }
  }
  else
  {
    LOBYTE(v5) = -1;
    CVehicleModelInfo::ms_compsUsed[0] = -1;
  }
  CVehicleModelInfo::ms_compsUsed[1] = v5;
  RpClumpForAllAtomics(Instance, CVehicleModelInfo::SetEnvironmentMapAtomicCB, 0);
  return &Instance->object;
}

//----- (00387B90) --------------------------------------------------------
int32 __fastcall CVehicleModelInfo::ChooseComponent(CVehicleModelInfo *this)
{
  int32 result; // r0
  uint32 m_compRules; // r1
  bool v4; // zf
  bool v5; // zf
  int32 ListOfComponentsNotUsedByRules; // r5
  int32 v7[10]; // [sp+0h] [bp-28h] BYREF

  result = CVehicleModelInfo::ms_compsToUse[0];
  if ( CVehicleModelInfo::ms_compsToUse[0] == -2 )
  {
    m_compRules = this->m_compRules;
    if ( !((unsigned __int16)m_compRules >> 12) )
      goto LABEL_19;
    if ( (unsigned __int16)m_compRules >> 12 != 2 )
      return ChooseComponent((unsigned __int16)this->m_compRules >> 12, this->m_compRules & 0xFFF);
    v4 = CWeather::OldWeatherType == 8;
    if ( CWeather::OldWeatherType != 8 )
      v4 = CWeather::OldWeatherType == 16;
    if ( v4 )
      return ChooseComponent((unsigned __int16)this->m_compRules >> 12, this->m_compRules & 0xFFF);
    v5 = CWeather::NewWeatherType == 16;
    if ( CWeather::NewWeatherType != 16 )
      v5 = CWeather::NewWeatherType == 8;
    if ( v5 )
    {
      return ChooseComponent((unsigned __int16)this->m_compRules >> 12, this->m_compRules & 0xFFF);
    }
    else
    {
LABEL_19:
      if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3.0) <= 1
        && (ListOfComponentsNotUsedByRules = GetListOfComponentsNotUsedByRules(
                                               this->m_compRules,
                                               this->m_pStructure->m_numXtraAtomics,
                                               v7)) != 0 )
      {
        return v7[(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)ListOfComponentsNotUsedByRules)];
      }
      else
      {
        return -1;
      }
    }
  }
  else
  {
    CVehicleModelInfo::ms_compsToUse[0] = -2;
  }
  return result;
}

//----- (00387C7C) --------------------------------------------------------
int32 __fastcall CVehicleModelInfo::ChooseSecondComponent(CVehicleModelInfo *this)
{
  int32 result; // r0
  uint32 m_compRules; // r1
  bool v4; // zf
  bool v5; // zf
  bool v6; // zf
  bool v7; // zf
  int32 ListOfComponentsNotUsedByRules; // r5
  int32 v9[10]; // [sp+0h] [bp-28h] BYREF

  result = CVehicleModelInfo::ms_compsToUse[1];
  if ( CVehicleModelInfo::ms_compsToUse[1] == -2 )
  {
    m_compRules = this->m_compRules;
    if ( !(m_compRules >> 28) )
      goto LABEL_28;
    if ( m_compRules >> 28 != 2 )
      return ChooseComponent(m_compRules >> 28, HIWORD(m_compRules) & 0xFFF);
    v4 = CWeather::OldWeatherType == 8;
    if ( CWeather::OldWeatherType != 8 )
      v4 = CWeather::OldWeatherType == 16;
    if ( v4 )
      return ChooseComponent(m_compRules >> 28, HIWORD(m_compRules) & 0xFFF);
    v5 = CWeather::NewWeatherType == 16;
    if ( CWeather::NewWeatherType != 16 )
      v5 = CWeather::NewWeatherType == 8;
    if ( v5 )
    {
      return ChooseComponent(m_compRules >> 28, HIWORD(m_compRules) & 0xFFF);
    }
    else
    {
      if ( !((unsigned __int16)m_compRules >> 12) )
        return -1;
      if ( (unsigned __int16)m_compRules >> 12 == 2 )
      {
        v6 = CWeather::OldWeatherType == 8;
        if ( CWeather::OldWeatherType != 8 )
          v6 = CWeather::OldWeatherType == 16;
        if ( !v6 )
        {
          v7 = CWeather::NewWeatherType == 16;
          if ( CWeather::NewWeatherType != 16 )
            v7 = CWeather::NewWeatherType == 8;
          if ( !v7 )
            return -1;
        }
      }
LABEL_28:
      if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 3.0) <= 1
        && (ListOfComponentsNotUsedByRules = GetListOfComponentsNotUsedByRules(
                                               this->m_compRules,
                                               this->m_pStructure->m_numXtraAtomics,
                                               v9)) != 0 )
      {
        return v9[(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)ListOfComponentsNotUsedByRules)];
      }
      else
      {
        return -1;
      }
    }
  }
  else
  {
    CVehicleModelInfo::ms_compsToUse[1] = -2;
  }
  return result;
}

//----- (00387D9C) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetEnvironmentMapAtomicCB(RpAtomic_0 *pAtomic, void *pData)
{
  RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::SetEnvironmentMapCB, pData);
  return pAtomic;
}

//----- (00387DB8) --------------------------------------------------------
void __fastcall CVehicleModelInfo::DisableEnvMap(CVehicleModelInfo *this)
{
  RpClump_0 *m_pRwObject; // r0

  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  if ( m_pRwObject )
    sub_18E410(m_pRwObject, CVehicleModelInfo::SetEnvironmentMapAtomicCB, (char *)&elf_hash_bucket[16320] + 3);
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00387DD4) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetEnvMapCoeff(CVehicleModelInfo *this, float coeff)
{
  RpClump_0 *m_pRwObject; // r4
  float v3; // s0

  m_pRwObject = (RpClump_0 *)this->m_pRwObject;
  if ( m_pRwObject )
  {
    v3 = floorf(coeff * 1000.0);
    sub_18E410(m_pRwObject, CVehicleModelInfo::SetEnvMapCoeffAtomicCB, (void *)v3);
  }
}

//----- (00387E18) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetEnvMapCoeffAtomicCB(RpAtomic_0 *pAtomic, void *pData)
{
  RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::SetEnvMapCoeffCB, pData);
  return pAtomic;
}

//----- (00387E34) --------------------------------------------------------
void __fastcall CVehicleModelInfo::DeleteRwObject(CVehicleModelInfo *this)
{
  CVehicleModelInfo::CVehicleStructure *m_pStructure; // r9
  int v3; // r4
  char *v4; // r6
  RpAtomic_0 *v5; // r0
  RwFrame_0 *parent; // r5
  RpAtomic_0 *v7; // r0
  CPool<CVehicleModelInfo::CVehicleStructure,CVehicleModelInfo::CVehicleStructure> *v8; // r0
  int v9; // r1

  m_pStructure = this->m_pStructure;
  if ( m_pStructure )
  {
    if ( m_pStructure->m_numXtraAtomics >= 1 )
    {
      v3 = 0;
      do
      {
        v4 = (char *)m_pStructure + 4 * v3;
        v5 = (RpAtomic_0 *)*((_DWORD *)v4 + 189);
        parent = (RwFrame_0 *)v5->object.object.parent;
        RpAtomicDestroy(v5);
        v7 = (RpAtomic_0 *)*((_DWORD *)v4 + 195);
        if ( v7 )
          RpAtomicDestroy(v7);
        RwFrameDestroy(parent);
        ++v3;
      }
      while ( v3 < m_pStructure->m_numXtraAtomics );
    }
    v8 = CVehicleModelInfo::CVehicleStructure::m_pInfoPool;
    v9 = 2031117539
       * (((char *)m_pStructure - (char *)CVehicleModelInfo::CVehicleStructure::m_pInfoPool->m_aStorage) >> 2);
    CVehicleModelInfo::CVehicleStructure::m_pInfoPool->m_aFlags[v9] |= 0x80u;
    if ( v9 < v8->m_nFreeIndex )
      v8->m_nFreeIndex = v9;
    this->m_pStructure = 0;
  }
  sub_19CB88(this);
}

//----- (00387EC0) --------------------------------------------------------
RwFrame_0 *__fastcall CVehicleModelInfo::CollapseFramesCB(RwFrame_0 *pFrame, void *pData)
{
  RwFrameForAllChildren(pFrame, CVehicleModelInfo::CollapseFramesCB, pData);
  RwFrameForAllObjects(pFrame, CVehicleModelInfo::MoveObjectsCB, pData);
  RwFrameDestroy(pFrame);
  return pFrame;
}

//----- (00387EF8) --------------------------------------------------------
RwObject_0 *__fastcall CVehicleModelInfo::MoveObjectsCB(RwObject_0 *pObj, void *pData)
{
  RpAtomicSetFrame((RpAtomic_0 *)pObj, (RwFrame_0 *)pData);
  return pObj;
}

//----- (00387F08) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::HideDamagedAtomicCB(RpAtomic_0 *pAtomic, void *pData)
{
  RwFrame_0 *parent; // r5
  const unsigned __int8 *FrameNodeName; // r0
  uint16 v5; // r1
  RpAtomic_0 *v6; // r0
  const unsigned __int8 *v7; // r0

  parent = (RwFrame_0 *)pAtomic->object.object.parent;
  FrameNodeName = GetFrameNodeName(parent);
  if ( strstr((const char *)FrameNodeName, "_dam") )
  {
    v5 = 2;
    pAtomic->object.object.flags = 0;
    v6 = pAtomic;
LABEL_5:
    CVisibilityPlugins::SetAtomicFlag(v6, v5);
    return pAtomic;
  }
  v7 = GetFrameNodeName(parent);
  if ( strstr((const char *)v7, (const char *)sub_387F48) )
  {
    v6 = pAtomic;
    v5 = 1;
    goto LABEL_5;
  }
  return pAtomic;
}
// 387F48: using guessed type int sub_387F48();

//----- (00387F4C) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::HideAllComponentsAtomicCB(RpAtomic_0 *pAtomic, void *pData)
{
  int32 AtomicId; // r0
  RwUInt8 v5; // r1
  RpAtomic_0 *result; // r0

  AtomicId = CVisibilityPlugins::GetAtomicId(pAtomic);
  v5 = 4;
  if ( (AtomicId & (unsigned int)pData) != 0 )
    v5 = 0;
  result = pAtomic;
  pAtomic->object.object.flags = v5;
  return result;
}

//----- (00387F68) --------------------------------------------------------
RpMaterial_0 *__fastcall CVehicleModelInfo::HasAlphaMaterialCB(RpMaterial_0 *pMaterial, void *pData)
{
  if ( pMaterial->color._anon_0._anon_0.alpha != 255 )
  {
    *(_BYTE *)pData = 1;
    return 0;
  }
  return pMaterial;
}

//----- (00387F78) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetAtomicRendererCB(RpAtomic_0 *pAtomic, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r5
  void **v4; // r0
  RwFrame_0 *parent; // r5
  const unsigned __int8 *v6; // r0
  uint16 v7; // r1
  RpAtomic_0 *v8; // r0
  const unsigned __int8 *v9; // r0
  char v11[9]; // [sp+7h] [bp-9h] BYREF

  FrameNodeName = GetFrameNodeName((RwFrame_0 *)pAtomic->object.object.parent);
  if ( strstr((const char *)FrameNodeName, "_vlo") )
  {
    v4 = &CVisibilityPlugins::RenderVehicleReallyLowDetailCB;
  }
  else
  {
    v11[0] = 0;
    RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::HasAlphaMaterialCB, v11);
    if ( v11[0] )
    {
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailAlphaCB;
    }
    else if ( !strncmp((const char *)FrameNodeName, "windscreen", 0xAu) )
    {
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailAlphaCB;
    }
    else
    {
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailCB;
    }
  }
  CVisibilityPlugins::SetAtomicRenderCallback(pAtomic, (RpAtomicCallBackRender)*v4);
  parent = (RwFrame_0 *)pAtomic->object.object.parent;
  v6 = GetFrameNodeName(parent);
  if ( strstr((const char *)v6, "_dam") )
  {
    v7 = 2;
    pAtomic->object.object.flags = 0;
    v8 = pAtomic;
LABEL_12:
    CVisibilityPlugins::SetAtomicFlag(v8, v7);
    return pAtomic;
  }
  v9 = GetFrameNodeName(parent);
  if ( strstr((const char *)v9, (const char *)sub_388034) )
  {
    v8 = pAtomic;
    v7 = 1;
    goto LABEL_12;
  }
  return pAtomic;
}
// 388034: using guessed type int sub_388034();
// 678820: using guessed type void *CVisibilityPlugins::RenderVehicleReallyLowDetailCB;
// 67957C: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailAlphaCB;
// 679BB4: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailCB;
// 387F78: using guessed type char var_9[9];

//----- (00388038) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetAtomicRendererCB_RealHeli(RpAtomic_0 *pAtomic, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r5
  void **v4; // r0
  RwFrame_0 *parent; // r5
  const unsigned __int8 *v6; // r0
  uint16 v7; // r1
  RpAtomic_0 *v8; // r0
  const unsigned __int8 *v9; // r0
  char v11[9]; // [sp+7h] [bp-9h] BYREF

  FrameNodeName = GetFrameNodeName((RwFrame_0 *)pAtomic->object.object.parent);
  if ( !strcmp((const char *)FrameNodeName, "moving_rotor") )
  {
    v4 = &CVisibilityPlugins::RenderHeliRotorAlphaCB;
  }
  else if ( !strcmp((const char *)FrameNodeName, "moving_rotor2") )
  {
    v4 = &CVisibilityPlugins::RenderHeliTailRotorAlphaCB;
  }
  else if ( strstr((const char *)FrameNodeName, "_vlo") )
  {
    v4 = &CVisibilityPlugins::RenderVehicleReallyLowDetailCB;
  }
  else
  {
    v11[0] = 0;
    RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::HasAlphaMaterialCB, v11);
    if ( v11[0] )
    {
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailAlphaCB;
    }
    else if ( !strncmp((const char *)FrameNodeName, "windscreen", 0xAu) )
    {
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailAlphaCB;
    }
    else
    {
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailCB;
    }
  }
  CVisibilityPlugins::SetAtomicRenderCallback(pAtomic, (RpAtomicCallBackRender)*v4);
  parent = (RwFrame_0 *)pAtomic->object.object.parent;
  v6 = GetFrameNodeName(parent);
  if ( strstr((const char *)v6, "_dam") )
  {
    v7 = 2;
    pAtomic->object.object.flags = 0;
    v8 = pAtomic;
LABEL_16:
    CVisibilityPlugins::SetAtomicFlag(v8, v7);
    return pAtomic;
  }
  v9 = GetFrameNodeName(parent);
  if ( strstr((const char *)v9, (const char *)sub_388128) )
  {
    v8 = pAtomic;
    v7 = 1;
    goto LABEL_16;
  }
  return pAtomic;
}
// 388128: using guessed type int sub_388128();
// 678820: using guessed type void *CVisibilityPlugins::RenderVehicleReallyLowDetailCB;
// 679440: using guessed type void *CVisibilityPlugins::RenderHeliTailRotorAlphaCB;
// 67957C: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailAlphaCB;
// 679BB4: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailCB;
// 679FE4: using guessed type void *CVisibilityPlugins::RenderHeliRotorAlphaCB;
// 388038: using guessed type char var_9[9];

//----- (0038812C) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetAtomicRendererCB_BigVehicle(RpAtomic_0 *pAtomic, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r0
  void **v4; // r0
  RwFrame_0 *parent; // r5
  const unsigned __int8 *v6; // r0
  uint16 v7; // r1
  RpAtomic_0 *v8; // r0
  const unsigned __int8 *v9; // r0
  char v11[9]; // [sp+7h] [bp-9h] BYREF

  FrameNodeName = GetFrameNodeName((RwFrame_0 *)pAtomic->object.object.parent);
  if ( strstr((const char *)FrameNodeName, "_vlo") )
  {
    v4 = &CVisibilityPlugins::RenderVehicleReallyLowDetailCB_BigVehicle;
  }
  else
  {
    v11[0] = 0;
    RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::HasAlphaMaterialCB, v11);
    if ( v11[0] )
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailAlphaCB_BigVehicle;
    else
      v4 = &CVisibilityPlugins::RenderVehicleHiDetailCB_BigVehicle;
  }
  CVisibilityPlugins::SetAtomicRenderCallback(pAtomic, (RpAtomicCallBackRender)*v4);
  parent = (RwFrame_0 *)pAtomic->object.object.parent;
  v6 = GetFrameNodeName(parent);
  if ( strstr((const char *)v6, "_dam") )
  {
    v7 = 2;
    pAtomic->object.object.flags = 0;
    v8 = pAtomic;
LABEL_10:
    CVisibilityPlugins::SetAtomicFlag(v8, v7);
    return pAtomic;
  }
  v9 = GetFrameNodeName(parent);
  if ( strstr((const char *)v9, (const char *)sub_3881C8) )
  {
    v8 = pAtomic;
    v7 = 1;
    goto LABEL_10;
  }
  return pAtomic;
}
// 3881C8: using guessed type int sub_3881C8();
// 679210: using guessed type void *CVisibilityPlugins::RenderVehicleReallyLowDetailCB_BigVehicle;
// 679660: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailAlphaCB_BigVehicle;
// 679C94: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailCB_BigVehicle;
// 38812C: using guessed type char var_9[9];

//----- (003881CC) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetAtomicRendererCB_Boat(RpAtomic_0 *pAtomic, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r5
  void **v4; // r0
  RwFrame_0 *parent; // r5
  const unsigned __int8 *v6; // r0
  uint16 v7; // r1
  RpAtomic_0 *v8; // r0
  const unsigned __int8 *v9; // r0
  char v11[9]; // [sp+7h] [bp-9h] BYREF

  FrameNodeName = GetFrameNodeName((RwFrame_0 *)pAtomic->object.object.parent);
  v11[0] = 0;
  RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::HasAlphaMaterialCB, v11);
  if ( !strcmp((const char *)FrameNodeName, "boat_hi") )
  {
    v4 = &CVisibilityPlugins::RenderVehicleHiDetailCB_Boat;
  }
  else if ( strstr((const char *)FrameNodeName, "_vlo") )
  {
    v4 = &CVisibilityPlugins::RenderVehicleLoDetailCB_Boat;
  }
  else if ( v11[0] )
  {
    v4 = &CVisibilityPlugins::RenderVehicleHiDetailAlphaCB_Boat;
  }
  else
  {
    v4 = &CVisibilityPlugins::RenderVehicleHiDetailCB_Boat;
  }
  CVisibilityPlugins::SetAtomicRenderCallback(pAtomic, (RpAtomicCallBackRender)*v4);
  parent = (RwFrame_0 *)pAtomic->object.object.parent;
  v6 = GetFrameNodeName(parent);
  if ( strstr((const char *)v6, "_dam") )
  {
    v7 = 2;
    pAtomic->object.object.flags = 0;
    v8 = pAtomic;
LABEL_12:
    CVisibilityPlugins::SetAtomicFlag(v8, v7);
    return pAtomic;
  }
  v9 = GetFrameNodeName(parent);
  if ( strstr((const char *)v9, (const char *)sub_388288) )
  {
    v8 = pAtomic;
    v7 = 1;
    goto LABEL_12;
  }
  return pAtomic;
}
// 388288: using guessed type int sub_388288();
// 676E24: using guessed type void *CVisibilityPlugins::RenderVehicleLoDetailCB_Boat;
// 677A74: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailAlphaCB_Boat;
// 67919C: using guessed type void *CVisibilityPlugins::RenderVehicleHiDetailCB_Boat;
// 3881CC: using guessed type char var_9[9];

//----- (0038828C) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetAtomicRendererCB_Heli(RpAtomic_0 *pAtomic, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r5
  RpAtomic_0 *v4; // r0
  RpAtomic_0 *(*v5)(RpAtomic_0 *); // r1
  void **v6; // r0

  FrameNodeName = GetFrameNodeName((RwFrame_0 *)pAtomic->object.object.parent);
  if ( !strncmp((const char *)FrameNodeName, "toprotor", 8u) )
  {
    v6 = &CVisibilityPlugins::RenderHeliRotorAlphaCB;
LABEL_6:
    v5 = (RpAtomic_0 *(*)(RpAtomic_0 *))*v6;
    v4 = pAtomic;
    goto LABEL_7;
  }
  if ( !strncmp((const char *)FrameNodeName, "rearrotor", 9u) )
  {
    v6 = &CVisibilityPlugins::RenderHeliTailRotorAlphaCB;
    goto LABEL_6;
  }
  v4 = pAtomic;
  v5 = 0;
LABEL_7:
  CVisibilityPlugins::SetAtomicRenderCallback(v4, v5);
  return pAtomic;
}
// 679440: using guessed type void *CVisibilityPlugins::RenderHeliTailRotorAlphaCB;
// 679FE4: using guessed type void *CVisibilityPlugins::RenderHeliRotorAlphaCB;

//----- (003882E8) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetAtomicRendererCB_Train(RpAtomic_0 *pAtomic, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r0
  void **v4; // r0
  RwFrame_0 *parent; // r5
  const unsigned __int8 *v6; // r0
  uint16 v7; // r1
  RpAtomic_0 *v8; // r0
  const unsigned __int8 *v9; // r0
  char v11[9]; // [sp+7h] [bp-9h] BYREF

  FrameNodeName = GetFrameNodeName((RwFrame_0 *)pAtomic->object.object.parent);
  if ( strstr((const char *)FrameNodeName, "_vlo") )
  {
    v4 = &CVisibilityPlugins::RenderVehicleReallyLowDetailCB_BigVehicle;
  }
  else
  {
    v11[0] = 0;
    RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::HasAlphaMaterialCB, v11);
    if ( v11[0] )
      v4 = &CVisibilityPlugins::RenderTrainHiDetailAlphaCB;
    else
      v4 = &CVisibilityPlugins::RenderTrainHiDetailCB;
  }
  CVisibilityPlugins::SetAtomicRenderCallback(pAtomic, (RpAtomicCallBackRender)*v4);
  parent = (RwFrame_0 *)pAtomic->object.object.parent;
  v6 = GetFrameNodeName(parent);
  if ( strstr((const char *)v6, "_dam") )
  {
    v7 = 2;
    pAtomic->object.object.flags = 0;
    v8 = pAtomic;
LABEL_10:
    CVisibilityPlugins::SetAtomicFlag(v8, v7);
    return pAtomic;
  }
  v9 = GetFrameNodeName(parent);
  if ( strstr((const char *)v9, (const char *)sub_388384) )
  {
    v8 = pAtomic;
    v7 = 1;
    goto LABEL_10;
  }
  return pAtomic;
}
// 388384: using guessed type int sub_388384();
// 677718: using guessed type void *CVisibilityPlugins::RenderTrainHiDetailAlphaCB;
// 678AA0: using guessed type void *CVisibilityPlugins::RenderTrainHiDetailCB;
// 679210: using guessed type void *CVisibilityPlugins::RenderVehicleReallyLowDetailCB_BigVehicle;
// 3882E8: using guessed type char var_9[9];

//----- (00388388) --------------------------------------------------------
RwObject_0 *__fastcall CVehicleModelInfo::SetAtomicFlagCB(RwObject_0 *pObj, void *pData)
{
  CVisibilityPlugins::SetAtomicFlag((RpAtomic_0 *)pObj, (uint16)pData);
  return pObj;
}

//----- (00388398) --------------------------------------------------------
RwObject_0 *__fastcall CVehicleModelInfo::ClearAtomicFlagCB(RwObject_0 *pObj, void *pData)
{
  CVisibilityPlugins::ClearAtomicFlag((RpAtomic_0 *)pObj, (uint16)pData);
  return pObj;
}

//----- (003883A8) --------------------------------------------------------
RwObject_0 *__fastcall GetOkAndDamagedAtomicCB(RwObject_0 *pObj, void *pData)
{
  int v4; // r0

  if ( (CVisibilityPlugins::GetAtomicId((RpAtomic_0 *)pObj) & 1) != 0 )
  {
    v4 = 0;
    goto LABEL_5;
  }
  if ( (CVisibilityPlugins::GetAtomicId((RpAtomic_0 *)pObj) & 2) != 0 )
  {
    v4 = 1;
LABEL_5:
    *((_DWORD *)pData + v4) = pObj;
  }
  return pObj;
}

//----- (003883D4) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetVehicleComponentFlags(CVehicleModelInfo *this, RwFrame_0 *pFrame, uint32 flags)
{
  int m_handlingId_low; // r6
  int *v6; // r2
  int *v7; // r2

  m_handlingId_low = LOBYTE(this->m_handlingId);
  if ( (flags & 0x1000) != 0 )
  {
    RwFrameForAllObjects(pFrame, CVehicleModelInfo::SetAtomicFlagCB, &dword_80);
    if ( (flags & 0x400000) == 0 )
    {
LABEL_3:
      if ( (flags & 0x40000) == 0 )
        goto LABEL_4;
LABEL_13:
      RwFrameForAllObjects(pFrame, CVehicleModelInfo::SetAtomicFlagCB, &elf_hash_bucket[1985]);
      if ( (flags & 0x80) == 0 )
        goto LABEL_5;
LABEL_14:
      v6 = (_DWORD *)&word_10;
      goto LABEL_17;
    }
  }
  else if ( (flags & 0x400000) == 0 )
  {
    goto LABEL_3;
  }
  RwFrameForAllObjects(pFrame, CVehicleModelInfo::SetAtomicFlagCB, &elf_hash_bucket[193]);
  if ( (flags & 0x40000) != 0 )
    goto LABEL_13;
LABEL_4:
  if ( (flags & 0x80) != 0 )
    goto LABEL_14;
LABEL_5:
  if ( (flags & 0x100) != 0
    && ((flags & 0x60) == 0 || (mod_HandlingManager.m_aHandlingData[m_handlingId_low].mFlags & 1) != 0) )
  {
    v6 = &dword_20;
    goto LABEL_17;
  }
  if ( (flags & 0x20) != 0 )
  {
    v6 = (_DWORD *)byte_4;
    goto LABEL_17;
  }
  if ( (flags & 0x40) != 0 )
  {
    v6 = (_DWORD *)byte_8;
LABEL_17:
    RwFrameForAllObjects(pFrame, CVehicleModelInfo::SetAtomicFlagCB, v6);
  }
  if ( (flags & 0x8000) != 0
    && ((flags & 0x6000) != 0 || (int)mod_HandlingManager.m_aHandlingData[m_handlingId_low].mFlags <= -1) )
  {
    RwFrameForAllObjects(pFrame, CVehicleModelInfo::SetAtomicFlagCB, &elf_hash_bucket[8129]);
    if ( (flags & 0x2000) == 0 )
      goto LABEL_22;
LABEL_25:
    v7 = &elf_hash_bucket[1];
    goto LABEL_26;
  }
  if ( (flags & 0x2000) != 0 )
    goto LABEL_25;
LABEL_22:
  if ( (flags & 0x4000) == 0 )
    goto LABEL_27;
  v7 = elf_hash_bucket + 260;
LABEL_26:
  RwFrameForAllObjects(pFrame, CVehicleModelInfo::SetAtomicFlagCB, v7);
LABEL_27:
  if ( (flags & 0x400) != 0 )
    sub_197F1C(pFrame, CVehicleModelInfo::SetAtomicFlagCB, &dword_40);
}
// 10: using guessed type __int16 word_10;
// 20: using guessed type int dword_20;
// 40: using guessed type int dword_40;
// 80: using guessed type int dword_80;
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0038852C) --------------------------------------------------------
void __fastcall CVehicleModelInfo::GetWheelPosn(
        CVehicleModelInfo *this,
        int32 num,
        CVector *posn,
        bool bSkipTransforms)
{
  _BOOL4 v6; // r5
  RwFrame_0 *FrameFromId; // r6
  VehicleType m_vehicleType; // r0
  bool v9; // zf
  RwMatrix *v10; // r5
  __int64 v11; // d18
  __int64 v12; // d19
  __int64 v13; // d20
  __int64 v14; // d21
  __int64 v15; // d23
  __int64 v16; // d16
  __int64 v17; // d17
  char *i; // r4
  __int64 v19; // d16

  v6 = bSkipTransforms;
  FrameFromId = CClumpModelInfo::GetFrameFromId((RpClump_0 *)this->m_pRwObject, wheelIds[num]);
  m_vehicleType = this->m_vehicleType;
  v9 = m_vehicleType == VEHICLE_TYPE_PLANE;
  if ( m_vehicleType == VEHICLE_TYPE_PLANE )
    v9 = !v6;
  if ( v9 )
  {
    v10 = RwMatrixCreate();
    v11 = *(_QWORD *)&FrameFromId->modelling.right.x;
    v12 = *(_QWORD *)&FrameFromId->modelling.right.z;
    v13 = *(_QWORD *)&FrameFromId->modelling.up.x;
    v14 = *(_QWORD *)&FrameFromId->modelling.up.z;
    v15 = *(_QWORD *)&FrameFromId->modelling.pos.z;
    v16 = *(_QWORD *)&FrameFromId->modelling.at.x;
    v17 = *(_QWORD *)&FrameFromId->modelling.at.z;
    *(_QWORD *)&v10->pos.x = *(_QWORD *)&FrameFromId->modelling.pos.x;
    *(_QWORD *)&v10->pos.z = v15;
    *(_QWORD *)&v10->at.x = v16;
    *(_QWORD *)&v10->at.z = v17;
    *(_QWORD *)&v10->right.x = v11;
    *(_QWORD *)&v10->right.z = v12;
    *(_QWORD *)&v10->up.x = v13;
    *(_QWORD *)&v10->up.z = v14;
    for ( i = (char *)FrameFromId->object.parent; i; i = (char *)*((_DWORD *)i + 1) )
      RwMatrixTransform(v10, (const RwMatrix *)(i + 16), rwCOMBINEPOSTCONCAT);
    v19 = *(_QWORD *)&v10->pos.x;
    posn->z = v10->pos.z;
    *(_QWORD *)&posn->x = v19;
    sub_18EF34(v10);
  }
  else
  {
    posn->x = FrameFromId->modelling.pos.x;
    posn->y = FrameFromId->modelling.pos.y;
    posn->z = FrameFromId->modelling.pos.z;
  }
}

//----- (003885EC) --------------------------------------------------------
bool __fastcall CVehicleModelInfo::GetOriginalCompPosition(CVehicleModelInfo *this, CVector *posn, int32 nId)
{
  RwFrame_0 *FrameFromId; // r0

  FrameFromId = CClumpModelInfo::GetFrameFromId((RpClump_0 *)this->m_pRwObject, nId);
  if ( !FrameFromId )
    return 0;
  posn->x = FrameFromId->modelling.pos.x;
  posn->y = FrameFromId->modelling.pos.y;
  posn->z = FrameFromId->modelling.pos.z;
  return 1;
}

//----- (00388610) --------------------------------------------------------
bool __fastcall IsValidCompRule(int32 rule)
{
  bool result; // r0
  bool v2; // zf

  if ( rule != 2 )
    return 1;
  result = 1;
  v2 = CWeather::OldWeatherType == 8;
  if ( CWeather::OldWeatherType != 8 )
    v2 = CWeather::OldWeatherType == 16;
  if ( !v2 )
  {
    result = 1;
    if ( CWeather::NewWeatherType != 8 && CWeather::NewWeatherType != 16 )
      return 0;
  }
  return result;
}

//----- (0038864C) --------------------------------------------------------
int32 __fastcall GetListOfComponentsNotUsedByRules(uint32 mask, int32 numComps, int32 *pArray)
{
  _QWORD *v3; // r12
  int v4; // r3
  bool v5; // zf
  bool v6; // zf
  int v7; // lr
  uint32 v8; // lr
  int32 result; // r0
  bool v10; // zf
  bool v11; // zf
  uint32 v12; // lr
  uint32 v13; // lr
  uint32 v14; // r0
  int32 i; // lr

  *v3 = unk_610790;
  v3[1] = unk_610798;
  v3[2] = unk_6107A0;
  v4 = (unsigned __int16)mask >> 12;
  if ( (unsigned __int16)mask >> 12 )
  {
    if ( v4 == 4 )
      return 0;
    if ( v4 != 2 )
      goto LABEL_11;
    v5 = CWeather::OldWeatherType == 8;
    if ( CWeather::OldWeatherType != 8 )
      v5 = CWeather::OldWeatherType == 16;
    if ( v5 )
      goto LABEL_11;
    v6 = CWeather::NewWeatherType == 16;
    if ( CWeather::NewWeatherType != 16 )
      v6 = CWeather::NewWeatherType == 8;
    if ( v6 )
    {
LABEL_11:
      if ( (mask & 0xF) != 15 )
        *((_DWORD *)v3 + (mask & 0xF)) = 15;
      v7 = (unsigned __int8)mask >> 4;
      if ( v7 != 15 )
        *((_DWORD *)v3 + v7) = 15;
      v8 = (mask >> 8) & 0xF;
      if ( v8 != 15 )
        *((_DWORD *)v3 + v8) = 15;
    }
  }
  if ( mask >> 28 == 2 )
  {
    v10 = CWeather::OldWeatherType == 8;
    if ( CWeather::OldWeatherType != 8 )
      v10 = CWeather::OldWeatherType == 16;
    if ( !v10 )
    {
      v11 = CWeather::NewWeatherType == 16;
      if ( CWeather::NewWeatherType != 16 )
        v11 = CWeather::NewWeatherType == 8;
      if ( !v11 )
        goto LABEL_34;
    }
    goto LABEL_28;
  }
  if ( mask >> 28 )
  {
LABEL_28:
    v12 = HIWORD(mask) & 0xF;
    if ( v12 != 15 )
      *((_DWORD *)v3 + v12) = 15;
    v13 = (mask >> 20) & 0xF;
    if ( v13 != 15 )
      *((_DWORD *)v3 + v13) = 15;
    v14 = HIBYTE(mask) & 0xF;
    if ( v14 != 15 )
      *((_DWORD *)v3 + v14) = 15;
  }
LABEL_34:
  result = 0;
  if ( numComps >= 1 )
  {
    for ( i = 0; i != numComps; ++i )
    {
      if ( *((_DWORD *)v3 + i) != 15 )
      {
        *pArray++ = i;
        ++result;
      }
    }
  }
  return result;
}
// 388662: variable 'v3' is possibly undefined

//----- (00388764) --------------------------------------------------------
int32 __fastcall CountCompsInRule(int32 comps)
{
  int32 i; // r1

  for ( i = 0; comps; comps >>= 4 )
  {
    if ( (comps & 0xF) != 15 )
      ++i;
  }
  return i;
}

//----- (00388784) --------------------------------------------------------
int32 __fastcall ChooseComponent(int32 rule, int32 comps)
{
  int v3; // r1
  int32 v4; // r2
  int32 v5; // r2
  float v6; // s16
  int v7; // r1
  int32 v8; // r2
  float v9; // s16
  int32 result; // r0
  char v11; // r0
  int v12; // r0

  switch ( rule )
  {
    case 1:
      if ( !comps )
        goto LABEL_21;
      v3 = 0;
      v4 = comps;
      do
      {
        if ( (v4 & 0xF) != 15 )
          ++v3;
        v4 >>= 4;
      }
      while ( v4 );
      goto LABEL_13;
    case 2:
      if ( comps )
      {
        v3 = 0;
        v5 = comps;
        do
        {
          if ( (v5 & 0xF) != 15 )
            ++v3;
          v5 >>= 4;
        }
        while ( v5 );
LABEL_13:
        v6 = (float)v3;
      }
      else
      {
LABEL_21:
        v6 = 0.0;
      }
      v11 = 4 * (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * v6);
      goto LABEL_26;
    case 3:
      if ( comps )
      {
        v7 = 0;
        v8 = comps;
        do
        {
          if ( (v8 & 0xF) != 15 )
            ++v7;
          v8 >>= 4;
        }
        while ( v8 );
        v9 = (float)(v7 + 1);
      }
      else
      {
        v9 = 1.0;
      }
      v12 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * v9);
      if ( !v12 )
        goto LABEL_27;
      v11 = 4 * v12 - 4;
LABEL_26:
      result = (comps >> v11) & 0xF;
      break;
    case 4:
      return (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 5.0);
    default:
LABEL_27:
      result = -1;
      break;
  }
  return result;
}

//----- (003888B8) --------------------------------------------------------
bool __fastcall CVehicleModelInfo::IsUpgradeAvailable(CVehicleModelInfo *this, VehicleUpgradePosn upgrade)
{
  return this->m_pStructure->m_upgrades[upgrade].parentCompId > -1;
}

//----- (003888D0) --------------------------------------------------------
RpMaterial_0 *__fastcall CVehicleModelInfo::SetEditableMaterialsCB(RpMaterial_0 *pMat, void *pData)
{
  RwTexture_0 *texture; // r6
  RwRGBA_0 color; // r8
  RwRGBA_0 *p_color; // r9
  RwTexture_0 **v7; // r0
  RwTexture_0 **v8; // r0
  RwTexture_0 **v9; // r0
  RwTexture_0 *v10; // r2
  int v11; // r0
  uint8 *v12; // r0
  int v13; // r0
  int v14; // r0
  RwRGBA_0 **v15; // r2
  int v16; // r0
  RwTexture_0 **v17; // r2
  RwRGBA_0 *v18; // r2
  RwRGBA_0 v19; // r3
  RwRGBA_0 *v20; // r0
  RwRGBA_0 **v21; // r1
  RwTexture_0 **v22; // r1
  _DWORD *v23; // r1
  RwRGBA_0 v24; // r2
  RpMaterial_0 **v25; // r0
  RwTexture_0 **v26; // r0
  RwTexture_0 **v27; // r0
  RwTexture_0 *v28; // r2
  RwSurfaceProperties_0 **v29; // r0
  RwTexture_0 **v30; // r0
  RwTexture_0 **v31; // r0
  RwReal ambient; // r3
  __int64 v33; // d16

  texture = pMat->texture;
  p_color = &pMat->color;
  color = pMat->color;
  if ( CVehicleModelInfo::ms_pRemapTexture )
  {
    if ( texture )
    {
      if ( !strncmp((const char *)texture->name, "remap", 5u) )
      {
        v7 = *(RwTexture_0 ***)pData;
        *(_DWORD *)pData += 4;
        *v7 = (RwTexture_0 *)pMat;
        v8 = *(RwTexture_0 ***)pData;
        *(_DWORD *)pData += 4;
        *v8 = (RwTexture_0 *)byte_8;
        v9 = *(RwTexture_0 ***)pData;
        v10 = pMat->texture;
        *(_DWORD *)pData += 4;
        *v9 = v10;
        texture = CVehicleModelInfo::ms_pRemapTexture;
        pMat->texture = CVehicleModelInfo::ms_pRemapTexture;
      }
    }
    else
    {
      texture = 0;
    }
  }
  if ( texture == CVehicleModelInfo::ms_pLightsTexture )
  {
    v13 = *(_DWORD *)&color & 0xFFFFFF;
    if ( (*(unsigned int *)&color & 0xFFFFFF) > 0xFFB8 )
    {
      if ( v13 == 65465 )
      {
        v14 = 2;
        goto LABEL_27;
      }
      if ( v13 == 13172480 )
      {
        v14 = 1;
        goto LABEL_27;
      }
    }
    else
    {
      if ( v13 == 15615 )
      {
        v14 = 3;
        goto LABEL_27;
      }
      if ( v13 == 45055 )
      {
        v14 = 0;
LABEL_27:
        v21 = *(RwRGBA_0 ***)pData;
        *(_DWORD *)pData += 4;
        *v21 = p_color;
        v22 = *(RwTexture_0 ***)pData;
        *(_DWORD *)pData += 4;
        *v22 = (RwTexture_0 *)&byte_4;
        v23 = *(_DWORD **)pData;
        v24 = *p_color;
        *(_DWORD *)pData += 4;
        *v23 = v24;
        *(_DWORD *)p_color |= 0xFFFFFFu;
        if ( v14 != -1 && CVehicleModelInfo::ms_lightsOn[v14] )
        {
          v25 = *(RpMaterial_0 ***)pData;
          *(_DWORD *)pData += 4;
          *v25 = pMat;
          v26 = *(RwTexture_0 ***)pData;
          *(_DWORD *)pData += 4;
          *v26 = (RwTexture_0 *)byte_8;
          v27 = *(RwTexture_0 ***)pData;
          v28 = pMat->texture;
          *(_DWORD *)pData += 4;
          *v27 = v28;
          v29 = *(RwSurfaceProperties_0 ***)pData;
          *(_DWORD *)pData += 4;
          *v29 = &pMat->surfaceProps;
          v30 = *(RwTexture_0 ***)pData;
          *(_DWORD *)pData += 4;
          *v30 = (RwTexture_0 *)byte_8;
          v31 = *(RwTexture_0 ***)pData;
          ambient = pMat->surfaceProps.ambient;
          *(_DWORD *)pData += 4;
          *(RwReal *)v31 = ambient;
          pMat->texture = CVehicleModelInfo::ms_pLightsOnTexture;
          v33 = *(_QWORD *)&gLightSurfProps.ambient;
          pMat->surfaceProps.diffuse = gLightSurfProps.diffuse;
          *(_QWORD *)&pMat->surfaceProps.ambient = v33;
        }
        return pMat;
      }
    }
    v14 = -1;
    goto LABEL_27;
  }
  v11 = *(_DWORD *)&color & 0xFFFFFF;
  if ( (*(unsigned int *)&color & 0xFFFFFF) >= 0xFF00FF )
  {
    if ( (*(_DWORD *)&color & 0xFFFFFF) == 16711935 )
    {
      v12 = &CVehicleModelInfo::ms_currentCol[3];
      goto LABEL_23;
    }
    if ( v11 == 16776960 )
    {
      v12 = &CVehicleModelInfo::ms_currentCol[2];
      goto LABEL_23;
    }
  }
  else
  {
    if ( v11 == 65340 )
    {
      v12 = CVehicleModelInfo::ms_currentCol;
      goto LABEL_23;
    }
    if ( v11 == 11469055 )
    {
      v12 = &CVehicleModelInfo::ms_currentCol[1];
LABEL_23:
      v15 = *(RwRGBA_0 ***)pData;
      v16 = *v12;
      *(_DWORD *)pData += 4;
      *v15 = p_color;
      v17 = *(RwTexture_0 ***)pData;
      *(_DWORD *)pData += 4;
      *v17 = (RwTexture_0 *)&byte_4;
      v18 = *(RwRGBA_0 **)pData;
      v19 = pMat->color;
      *(_DWORD *)pData += 4;
      *v18 = v19;
      LOBYTE(v18) = CVehicleModelInfo::ms_vehicleColourTable[v16]._anon_0._anon_0.red;
      v20 = &CVehicleModelInfo::ms_vehicleColourTable[v16];
      pMat->color._anon_0._anon_0.red = (unsigned __int8)v18;
      pMat->color._anon_0._anon_0.green = v20->_anon_0._anon_0.green;
      pMat->color._anon_0._anon_0.blue = v20->_anon_0._anon_0.blue;
    }
  }
  return pMat;
}
// 4: using guessed type char byte_4;

//----- (00388AD0) --------------------------------------------------------
RpMaterial_0 *__fastcall RemoveWindowAlphaCB(RpMaterial_0 *pMat, void *pData)
{
  RwRGBA_0 *v2; // r3
  RwRGBA_0 *v3; // r2
  RwRGBA_0 *v4; // r2
  RwRGBA_0 color; // lr

  if ( pMat->color._anon_0._anon_0.alpha != 255 )
  {
    v2 = *(RwRGBA_0 **)pData;
    *(_DWORD *)pData += 4;
    *v2 = (RwRGBA_0)&pMat->color;
    v3 = *(RwRGBA_0 **)pData;
    *(_DWORD *)pData += 4;
    *v3 = (RwRGBA_0)4;
    v4 = *(RwRGBA_0 **)pData;
    color = pMat->color;
    *(_DWORD *)pData += 4;
    *v4 = color;
    pMat->color = 0;
  }
  return pMat;
}

//----- (00388B10) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::SetEditableMaterialsCB(RpAtomic_0 *pAtomic, void *pData)
{
  if ( (pAtomic->object.object.flags & 4) != 0 )
  {
    if ( (CVisibilityPlugins::GetAtomicId(pAtomic) & 0x1000) != 0 )
      RpGeometryForAllMaterials(pAtomic->geometry, RemoveWindowAlphaCB, pData);
    RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::SetEditableMaterialsCB, pData);
  }
  return pAtomic;
}

//----- (00388B54) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetEditableMaterials(RpClump_0 *pClump)
{
  u_native *v1; // [sp+4h] [bp-Ch] BYREF

  v1 = gStoredMaterials;
  RpClumpForAllAtomics(pClump, CVehicleModelInfo::SetEditableMaterialsCB, &v1);
  *v1 = 0;
}

//----- (00388B80) --------------------------------------------------------
void __fastcall CVehicleModelInfo::ResetEditableMaterials(RpClump_0 *pClump)
{
  u_native *v1; // r0
  u_native *v2; // r1

  v1 = (u_native *)gStoredMaterials[0];
  if ( gStoredMaterials[0] )
  {
    v2 = &gStoredMaterials[2];
    do
    {
      *v1 = *v2;
      v1 = (u_native *)v2[1];
      v2 += 3;
    }
    while ( v1 );
  }
}

//----- (00388BA8) --------------------------------------------------------
RpMaterial_0 *__fastcall CVehicleModelInfo::GetEditableMaterialListCB(RpMaterial_0 *pMaterial, void *pData)
{
  RwTexture_0 *texture; // r0
  int v6; // r1
  int v7; // r0

  texture = pMaterial->texture;
  if ( !texture
    || (*((int (__fastcall **)(RwChar *, const char *))RwEngineInstance + 68))(texture->name, "vehiclegrunge256") )
  {
    return pMaterial;
  }
  v6 = *((_DWORD *)pData + 5);
  v7 = *(_DWORD *)pData;
  *((_DWORD *)pData + 5) = v6 + 1;
  *(_DWORD *)(v7 + 4 * v6 + 584) = pMaterial;
  return pMaterial;
}

//----- (00388BF8) --------------------------------------------------------
RpAtomic_0 *__fastcall CVehicleModelInfo::GetEditableMaterialListCB(RpAtomic_0 *pAtomic, void *pData)
{
  RpGeometryForAllMaterials(pAtomic->geometry, CVehicleModelInfo::GetEditableMaterialListCB, pData);
  return pAtomic;
}

//----- (00388C14) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetVehicleColour(
        CVehicleModelInfo *this,
        uint8 col1,
        uint8 col2,
        uint8 col3,
        uint8 col4)
{
  CVehicleModelInfo::ms_currentCol[1] = col2;
  CVehicleModelInfo::ms_currentCol[0] = col1;
  CVehicleModelInfo::ms_currentCol[2] = col3;
  CVehicleModelInfo::ms_currentCol[3] = col4;
  this->m_lastCol[2] = col3;
  this->m_lastCol[1] = col2;
  this->m_lastCol[3] = col4;
  this->m_lastCol[0] = col1;
}

//----- (00388C4C) --------------------------------------------------------
void __fastcall CVehicleModelInfo::ChooseVehicleColour(
        CVehicleModelInfo *this,
        uint8 *col1,
        uint8 *col2,
        uint8 *col3,
        uint8 *a5,
        int a6)
{
  uint8 v10; // r0
  int v11; // r1
  uint8 (*m_possibleColours)[8]; // r10
  CVehicle *PlayerVehicle; // r0
  int v14; // r1

  if ( !this->m_numPossibleColours || CCheat::m_aCheatsActive[40] )
  {
    v10 = 0;
    goto LABEL_6;
  }
  if ( CCheat::m_aCheatsActive[39] )
  {
    v10 = 126;
LABEL_6:
    *col1 = v10;
    *col2 = v10;
    *col3 = v10;
LABEL_7:
    *a5 = v10;
    return;
  }
  v11 = (this->m_lastColUsed + a6) % this->m_numPossibleColours;
  m_possibleColours = this->m_possibleColours;
  this->m_lastColUsed = v11;
  *col1 = this->m_possibleColours[0][(unsigned __int8)v11];
  *col2 = this->m_possibleColours[1][this->m_lastColUsed];
  *col3 = this->m_possibleColours[2][this->m_lastColUsed];
  *a5 = this->m_possibleColours[3][this->m_lastColUsed];
  if ( this->m_numPossibleColours >= 2u )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    if ( PlayerVehicle )
    {
      if ( CModelInfo::ms_modelInfoPtrs[PlayerVehicle->m_nModelIndex] == this
        && PlayerVehicle->m_colour1 == *col1
        && PlayerVehicle->m_colour2 == *col2
        && PlayerVehicle->m_colour3 == *col3
        && PlayerVehicle->m_colour4 == *a5 )
      {
        v14 = (this->m_lastColUsed + a6) % this->m_numPossibleColours;
        this->m_lastColUsed = v14;
        *col1 = (*m_possibleColours)[(unsigned __int8)v14];
        *col2 = (*m_possibleColours)[this->m_lastColUsed + 8];
        *col3 = (*m_possibleColours)[this->m_lastColUsed + 16];
        v10 = (*m_possibleColours)[this->m_lastColUsed + 24];
        goto LABEL_7;
      }
    }
  }
}

//----- (00388D74) --------------------------------------------------------
int32 __fastcall CVehicleModelInfo::GetNumRemaps(CVehicleModelInfo *this)
{
  const unsigned __int8 **m_remaps; // r0
  int v2; // r1
  int v3; // r2

  m_remaps = this->m_remaps;
  v2 = 0;
  do
  {
    v3 = v2 + 1;
    if ( v2 > 3 )
      break;
  }
  while ( m_remaps[v2++] != 0 );
  return v3 - 1;
}

//----- (00388D8E) --------------------------------------------------------
void __fastcall CVehicleModelInfo::AddRemap(CVehicleModelInfo *this, const unsigned __int8 *textureName)
{
  int v2; // r3
  int v3; // r2

  v2 = 0;
  do
  {
    v3 = v2 + 1;
    if ( v2 > 3 )
      break;
  }
  while ( this->m_remaps[v2++] != 0 );
  *(_DWORD *)&this->m_upgradeModels[2 * v3 + 17] = textureName;
}

//----- (00388DB0) --------------------------------------------------------
void __fastcall CVehicleModelInfo::AddWheelUpgrade(int32 wheelClass, int32 model)
{
  int v2; // r3

  v2 = CVehicleModelInfo::ms_numWheelUpgrades[wheelClass];
  CVehicleModelInfo::ms_upgradeWheels[wheelClass][v2] = model;
  CVehicleModelInfo::ms_numWheelUpgrades[wheelClass] = v2 + 1;
}

//----- (00388DE4) --------------------------------------------------------
int32 __fastcall CVehicleModelInfo::GetNumWheelUpgrades(int32 wheelClass)
{
  return CVehicleModelInfo::ms_numWheelUpgrades[wheelClass];
}

//----- (00388DF4) --------------------------------------------------------
int32 __fastcall CVehicleModelInfo::GetWheelUpgrade(int32 wheelClass, int32 index)
{
  return CVehicleModelInfo::ms_upgradeWheels[wheelClass][index];
}

//----- (00388E10) --------------------------------------------------------
void CVehicleModelInfo::LoadEnvironmentMaps()
{
  int32 TxdSlot; // r4

  TxdSlot = CTxdStore::FindTxdSlot("particle");
  CTxdStore::PushCurrentTxd();
  CTxdStore::SetCurrentTxd(TxdSlot, 0);
  if ( !gpWhiteTexture )
  {
    gpWhiteTexture = RwTextureRead((const RwChar *)"white", 0);
    LOBYTE(gpWhiteTexture->filterAddressing) = 2;
  }
  sub_1979B0();
}

//----- (00388E74) --------------------------------------------------------
void CVehicleModelInfo::ShutdownEnvironmentMaps()
{
  RwTextureDestroy(gpWhiteTexture);
  gpWhiteTexture = 0;
  if ( pMatFxIdentityFrame )
    RwFrameDestroy(pMatFxIdentityFrame);
  pMatFxIdentityFrame = 0;
}

//----- (00388EAC) --------------------------------------------------------
RpMaterial_0 *__fastcall CVehicleModelInfo::GetMatFXEffectMaterialCB(RpMaterial_0 *pMaterial, void *pData)
{
  RpMaterial_0 *v3; // r4
  RpMatFXMaterialFlags_0 Effects; // r0

  v3 = pMaterial;
  if ( RpMatFXMaterialGetEffects(pMaterial) )
  {
    Effects = RpMatFXMaterialGetEffects(v3);
    v3 = 0;
    *(_DWORD *)pData = Effects;
  }
  return v3;
}

//----- (00388EC8) --------------------------------------------------------
RpMaterial_0 *__fastcall CVehicleModelInfo::SetEnvironmentMapCB(RpMaterial_0 *pMaterial, void *pData)
{
  if ( pData == (char *)&elf_hash_bucket[16320] + 3 )
  {
    RpMatFXMaterialSetEffects(pMaterial, rpMATFXEFFECTNULL);
    return pMaterial;
  }
  else
  {
    if ( RpMatFXMaterialGetEffects(pMaterial) == rpMATFXEFFECTENVMAP )
    {
      RpMatFXMaterialSetEnvMapFrame(pMaterial, pMatFxIdentityFrame);
      if ( !pMaterial->texture )
        RpMaterialSetTexture(pMaterial, gpWhiteTexture);
      RpMatFXMaterialSetEnvMapCoefficient(pMaterial, 0.25);
    }
    return pMaterial;
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (00388F20) --------------------------------------------------------
RpMaterial_0 *__fastcall CVehicleModelInfo::SetEnvMapCoeffCB(RpMaterial_0 *pMaterial, void *pData)
{
  if ( RpMatFXMaterialGetEffects(pMaterial) == rpMATFXEFFECTENVMAP )
    RpMatFXMaterialSetEnvMapCoefficient(pMaterial, (float)(unsigned int)pData / 1000.0);
  return pMaterial;
}

//----- (00388F56) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetCustomCarPlateText(CVehicleModelInfo *this, unsigned __int8 *pText)
{
  unsigned __int8 *tabCustomPlateText; // r0

  tabCustomPlateText = this->tabCustomPlateText;
  if ( pText )
    sub_19F6E8((char *)tabCustomPlateText, (const char *)pText, 8u);
  else
    *tabCustomPlateText = 0;
}

//----- (00388F68) --------------------------------------------------------
unsigned __int8 *__fastcall CVehicleModelInfo::GetCustomCarPlateText(CVehicleModelInfo *this)
{
  unsigned __int8 *result; // r0
  int v2; // t1

  v2 = this->tabCustomPlateText[0];
  result = this->tabCustomPlateText;
  if ( !v2 )
    return 0;
  return result;
}

//----- (00388F74) --------------------------------------------------------
int32 __fastcall CVehicleModelInfo::GetMaximumNumberOfPassengersFromNumberOfDoors(int32 model_index)
{
  CBaseModelInfo *v1; // r2
  int32 v2; // r1
  unsigned int v3; // r3
  bool v4; // zf
  int v5; // lr
  int m_pColModel_low; // r12
  float *m_hashKey; // r0
  float v9; // s0
  int v10; // r1
  float v11; // s2
  int v12; // r0
  bool v13; // zf

  v1 = CModelInfo::ms_modelInfoPtrs[model_index];
  v2 = 0;
  v3 = *(_DWORD *)&v1[1].m_modelName[20];
  v4 = v3 == 5;
  if ( v3 != 5 )
    v4 = v3 == 11;
  if ( v4 )
    return v2;
  v5 = *((unsigned __int8 *)&v1[1].m_flags + 2);
  if ( model_index <= 424 )
  {
    if ( model_index == -1 )
    {
      m_pColModel_low = 3;
      goto LABEL_14;
    }
    if ( model_index != 407 )
      goto LABEL_13;
LABEL_11:
    m_pColModel_low = 2;
    goto LABEL_14;
  }
  if ( model_index == 508 )
    goto LABEL_11;
  if ( model_index == 425 )
  {
    m_pColModel_low = 1;
    goto LABEL_14;
  }
LABEL_13:
  m_pColModel_low = LOBYTE(v1[1].m_pColModel);
  if ( !LOBYTE(v1[1].m_pColModel) )
  {
    if ( v3 <= 0xA && ((1 << v3) & 0x604) != 0 || (mod_HandlingManager.m_aHandlingData[v5].mFlags & 0x200) != 0 )
    {
      m_hashKey = (float *)v1[2].m_hashKey;
      if ( m_hashKey[15] == 0.0 )
      {
        v9 = m_hashKey[16];
        v10 = 0;
        v11 = m_hashKey[17];
        v12 = 0;
        if ( v9 != 0.0 )
          v10 = 1;
        if ( v11 != 0.0 )
          v12 = 1;
        return v12 | v10;
      }
    }
    else
    {
      v13 = model_index == 441;
      v2 = 0;
      if ( model_index != 441 )
        v13 = model_index == 564;
      if ( v13 )
        return v2;
    }
    return 1;
  }
LABEL_14:
  if ( (mod_HandlingManager.m_aHandlingData[v5].mFlags & 0x200) == 0 )
  {
    v2 = 8;
    if ( model_index != 431 && model_index != 437 )
      return m_pColModel_low - 1;
    return v2;
  }
  return (m_pColModel_low - 2) / 2;
}

//----- (00389094) --------------------------------------------------------
RpAtomic_0 *__fastcall UseReducedMaterialListCB(RpAtomic_0 *pAtomic, void *pData)
{
  RpGeometry_0 *geometry; // r6
  RpMeshHeader_0 *mesh; // r4
  RpMaterial_0 **p_totalIndicesInMesh; // r4
  int v7; // r5
  RpMaterial_0 *v8; // t1

  geometry = pAtomic->geometry;
  mesh = geometry->mesh;
  if ( (CVisibilityPlugins::GetAtomicId(pAtomic) & 0x2000) == 0 && geometry->mesh->numMeshes )
  {
    p_totalIndicesInMesh = (RpMaterial_0 **)&mesh[1].totalIndicesInMesh;
    v7 = 0;
    do
    {
      v8 = *p_totalIndicesInMesh;
      p_totalIndicesInMesh += 4;
      _rpMaterialListAppendMaterial((RpMaterialList_0 *)pData, v8);
      ++v7;
    }
    while ( v7 < geometry->mesh->numMeshes );
  }
  return pAtomic;
}

//----- (003890D8) --------------------------------------------------------
void __fastcall CVehicleModelInfo::SetupLightFlags(CVehicle *pVehicle)
{
  char v1; // r0

  v1 = *((_BYTE *)pVehicle + 1428);
  CVehicleModelInfo::ms_lightsOn[0] = (v1 & 2) != 0;
  CVehicleModelInfo::ms_lightsOn[1] = v1 & 1;
  CVehicleModelInfo::ms_lightsOn[3] = (v1 & 4) != 0;
  CVehicleModelInfo::ms_lightsOn[2] = (v1 & 8) != 0;
}

//----- (00389104) --------------------------------------------------------
uint8 __fastcall CVehicleModelInfo::GetModelType(CVehicleModelInfo *this)
{
  return 6;
}

//----- (00389108) --------------------------------------------------------
void __fastcall CVehicleModelInfo::Init(CVehicleModelInfo *this)
{
  CClumpModelInfo::Init(this);
  this->m_wheelId = -1;
  this->m_vehicleType = VEHICLE_TYPE_NONE;
  this->m_steerAngle = 999.99;
}

//----- (0038912C) --------------------------------------------------------
u_native __fastcall CVehicleModelInfo::GetAnimFileIndex(CVehicleModelInfo *this)
{
  return this->m_animFileIndex;
}

//----- (00389134) --------------------------------------------------------
void __fastcall CWeaponModelInfo::Init(CWeaponModelInfo *this)
{
  CClumpModelInfo::Init(this);
  this->m_weaponInfo = 0;
}

//----- (00389144) --------------------------------------------------------
void __fastcall CWeaponModelInfo::SetClump(CWeaponModelInfo *this, RpClump_0 *pClump)
{
  RwFrame_0 *FrameFromName; // r0
  RpAtomic_0 *FirstObject; // r0
  RpAtomic_0 *v5; // r4
  RpGeometry_0 *geometry; // r0

  CClumpModelInfo::SetClump(this, pClump);
  RpClumpForAllAtomics(pClump, CClumpModelInfo::SetAtomicRendererCB, CVisibilityPlugins::RenderWeaponCB);
  FrameFromName = CClumpModelInfo::GetFrameFromName(pClump, "gunflash");
  if ( FrameFromName )
  {
    FirstObject = (RpAtomic_0 *)GetFirstObject(FrameFromName);
    v5 = FirstObject;
    if ( FirstObject )
    {
      CVehicle::SetComponentAtomicAlpha(FirstObject, 0);
      geometry = v5->geometry;
      v5->object.object.flags = 0;
      (*geometry->matList.materials)->surfaceProps.ambient = 16.0;
    }
  }
}

//----- (003891A8) --------------------------------------------------------
uint8 __fastcall CWeaponModelInfo::GetModelType(CWeaponModelInfo *this)
{
  return 4;
}

//----- (003891AC) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::CAnimBlendAssocGroup(CAnimBlendAssocGroup *this)
{
  *(_QWORD *)&this->m_pAnimBlock = 0LL;
  *(_QWORD *)&this->m_numAssociations = 0LL;
  this->m_grpId = -1;
}

//----- (003891BE) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::~CAnimBlendAssocGroup(CAnimBlendAssocGroup *this)
{
  CAnimBlendStaticAssociation *m_aAssociationArray; // r0
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r1
  CAnimBlendSequence ***p_m_pAnimBlendSequences; // r8
  CAnimBlendStaticAssociation *v5; // r6
  int v6; // r5

  m_aAssociationArray = this->m_aAssociationArray;
  if ( m_aAssociationArray )
  {
    m_pAnimBlendHierarchy = m_aAssociationArray[-1].m_pAnimBlendHierarchy;
    p_m_pAnimBlendSequences = &m_aAssociationArray[-1].m_pAnimBlendSequences;
    if ( m_pAnimBlendHierarchy )
    {
      v5 = m_aAssociationArray - 1;
      v6 = (int)m_pAnimBlendHierarchy;
      do
        CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(&v5[v6--]);
      while ( v6 * 20 );
    }
    operator delete[](p_m_pAnimBlendSequences);
    this->m_aAssociationArray = 0;
    this->m_numAssociations = 0;
  }
}

//----- (003891FE) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::DestroyAssociations(CAnimBlendAssocGroup *this)
{
  CAnimBlendStaticAssociation *m_aAssociationArray; // r0
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r1
  CAnimBlendSequence ***p_m_pAnimBlendSequences; // r8
  CAnimBlendStaticAssociation *v5; // r6
  int v6; // r5

  m_aAssociationArray = this->m_aAssociationArray;
  if ( m_aAssociationArray )
  {
    m_pAnimBlendHierarchy = m_aAssociationArray[-1].m_pAnimBlendHierarchy;
    p_m_pAnimBlendSequences = &m_aAssociationArray[-1].m_pAnimBlendSequences;
    if ( m_pAnimBlendHierarchy )
    {
      v5 = m_aAssociationArray - 1;
      v6 = (int)m_pAnimBlendHierarchy;
      do
        CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(&v5[v6--]);
      while ( v6 * 20 );
    }
    operator delete[](p_m_pAnimBlendSequences);
    this->m_aAssociationArray = 0;
    this->m_numAssociations = 0;
  }
}

//----- (0038923C) --------------------------------------------------------
bool __fastcall strcmpIgnoringDigits(const unsigned __int8 *pStr1, const unsigned __int8 *pStr2)
{
  const unsigned __int8 *v2; // r9
  const unsigned __int8 *v3; // r5
  int v4; // r6
  int v5; // r4
  int v6; // r8
  bool v7; // cc
  bool v8; // zf

  v2 = pStr2;
  v3 = pStr1;
  v4 = *pStr2;
  v5 = *pStr1;
  if ( !(v5 | v4) )
    return 1;
  while ( 1 )
  {
    v6 = islower((unsigned __int8)v5);
    if ( islower((unsigned __int8)v4) )
      v4 = (unsigned __int8)v4 + 224;
    if ( v6 )
      v5 = (unsigned __int8)v5 + 224;
    v7 = (unsigned __int8)v5 != 0;
    if ( (_BYTE)v5 )
      v7 = (unsigned int)(unsigned __int8)v5 - 48 > 9;
    if ( !v7 )
      break;
    if ( (unsigned __int8)v5 != (unsigned __int8)v4 )
      return 0;
LABEL_15:
    if ( v4 << 24 )
      ++v2;
    v4 = *v2;
    if ( v5 << 24 )
      ++v3;
    v5 = *v3;
    if ( !(v5 | v4) )
      return 1;
  }
  v8 = (unsigned __int8)v5 == (unsigned __int8)v4;
  if ( (unsigned __int8)v5 != (unsigned __int8)v4 )
    v8 = v4 << 24 == 0;
  if ( v8 || (unsigned int)(unsigned __int8)v4 - 48 < 0xA )
    goto LABEL_15;
  return 0;
}

//----- (003892D4) --------------------------------------------------------
CBaseModelInfo *__fastcall GetModelFromName(const unsigned __int8 *pName)
{
  CModelInfo::ms_lastPositionSearched = 0;
  return sub_191F54(pName, 0);
}

//----- (003892E8) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::CreateAssociations(
        CAnimBlendAssocGroup *this,
        const unsigned __int8 *pAnimBlockName)
{
  CAnimBlendStaticAssociation *m_aAssociationArray; // r0
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r1
  CAnimBlendSequence ***p_m_pAnimBlendSequences; // r8
  CAnimBlendStaticAssociation *v7; // r4
  int v8; // r6
  CAnimBlock *AnimationBlock; // r6
  int v10; // r4
  _QWORD *v11; // r0
  __int64 v12; // r4
  int v13; // r5
  CAnimBlendStaticAssociation *v14; // r0
  CAnimBlendStaticAssociation *v15; // r0
  int32 m_numAnims; // r0
  int v17; // r4
  int32 i; // r5
  int v19; // r6
  CBaseModelInfo *ModelInfoFromHashKey; // r0
  CAnimBlendHierarchy *v21; // r11
  RpClump_0 *v22; // r6
  RpAtomic_0 *FirstAtomic; // r0

  m_aAssociationArray = this->m_aAssociationArray;
  if ( m_aAssociationArray )
  {
    m_pAnimBlendHierarchy = m_aAssociationArray[-1].m_pAnimBlendHierarchy;
    p_m_pAnimBlendSequences = &m_aAssociationArray[-1].m_pAnimBlendSequences;
    if ( m_pAnimBlendHierarchy )
    {
      v7 = m_aAssociationArray - 1;
      v8 = (int)m_pAnimBlendHierarchy;
      do
        CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(&v7[v8--]);
      while ( v8 * 20 );
    }
    operator delete[](p_m_pAnimBlendSequences);
    this->m_aAssociationArray = 0;
    this->m_numAssociations = 0;
  }
  AnimationBlock = CAnimManager::GetAnimationBlock(pAnimBlockName);
  v10 = 20;
  this->m_pAnimBlock = AnimationBlock;
  HIDWORD(v12) = AnimationBlock->m_numAnims;
  v11 = (_QWORD *)operator new[](saturated_mul(0x14u, HIDWORD(v12)));
  *v11 = v12;
  LODWORD(v12) = v11 + 1;
  if ( HIDWORD(v12) )
  {
    v13 = 20 * HIDWORD(v12);
    v14 = (CAnimBlendStaticAssociation *)(v11 + 1);
    do
    {
      CAnimBlendStaticAssociation::CAnimBlendStaticAssociation(v14);
      v13 -= 20;
      v14 = v15 + 1;
    }
    while ( v13 );
    AnimationBlock = this->m_pAnimBlock;
  }
  this->m_aAssociationArray = (CAnimBlendStaticAssociation *)v12;
  this->m_numAssociations = 0;
  m_numAnims = AnimationBlock->m_numAnims;
  if ( m_numAnims >= 1 )
  {
    v17 = 0;
    for ( i = 0; i < m_numAnims; ++i )
    {
      v19 = AnimationBlock->m_animIndex + i;
      ModelInfoFromHashKey = CModelInfo::GetModelInfoFromHashKey(CAnimManager::ms_aAnimations[v19].m_hashKey, 0);
      if ( ModelInfoFromHashKey )
      {
        v21 = &CAnimManager::ms_aAnimations[v19];
        v22 = (RpClump_0 *)(*((int (__fastcall **)(CBaseModelInfo *))ModelInfoFromHashKey->_vptr$CBaseModelInfo + 11))(ModelInfoFromHashKey);
        RpAnimBlendClumpInit(v22);
        CAnimBlendStaticAssociation::Init(&this->m_aAssociationArray[v17], v22, v21);
        FirstAtomic = GetFirstAtomic(v22);
        if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
          RpClumpForAllAtomics(v22, AtomicRemoveAnimFromSkinCB, 0);
        RpClumpDestroy(v22);
        this->m_aAssociationArray[v17].m_animId = this->m_idOffset + i;
        this->m_aAssociationArray[v17].m_animGrp = this->m_grpId;
      }
      ++v17;
      AnimationBlock = this->m_pAnimBlock;
      ++this->m_numAssociations;
      m_numAnims = AnimationBlock->m_numAnims;
    }
  }
  this->m_numAssociations = m_numAnims;
}
// 389370: variable 'v15' is possibly undefined

//----- (00389434) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::CreateAssociations(
        CAnimBlendAssocGroup *this,
        const unsigned __int8 *pAnimBlockName,
        const unsigned __int8 *pAnimNames,
        const unsigned __int8 *pModelNames,
        int a5)
{
  CAnimBlendStaticAssociation *m_aAssociationArray; // r0
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r1
  CAnimBlendSequence ***p_m_pAnimBlendSequences; // r8
  CAnimBlendStaticAssociation *v10; // r5
  int v11; // r4
  CAnimBlock *AnimationBlock; // r4
  unsigned int m_numAnims; // r5
  _DWORD *v14; // r0
  CAnimBlendStaticAssociation *v15; // r8
  int v16; // r4
  CAnimBlendStaticAssociation *v17; // r0
  CAnimBlendStaticAssociation *v18; // r0
  int32 v19; // r0
  int32 i; // r9
  int v21; // r10
  int32 v22; // r8
  const unsigned __int8 *v23; // r5
  CAnimBlendHierarchy *v24; // r4
  uint32 UppercaseKey; // r0
  CBaseModelInfo *ModelInfo; // r0
  RpClump_0 *v27; // r5
  RpAtomic_0 *FirstAtomic; // r0

  if ( pModelNames )
  {
    m_aAssociationArray = this->m_aAssociationArray;
    if ( m_aAssociationArray )
    {
      m_pAnimBlendHierarchy = m_aAssociationArray[-1].m_pAnimBlendHierarchy;
      p_m_pAnimBlendSequences = &m_aAssociationArray[-1].m_pAnimBlendSequences;
      if ( m_pAnimBlendHierarchy )
      {
        v10 = m_aAssociationArray - 1;
        v11 = (int)m_pAnimBlendHierarchy;
        do
          CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(&v10[v11--]);
        while ( v11 * 20 );
      }
      operator delete[](p_m_pAnimBlendSequences);
      this->m_aAssociationArray = 0;
      this->m_numAssociations = 0;
    }
    AnimationBlock = CAnimManager::GetAnimationBlock(pAnimBlockName);
    this->m_pAnimBlock = AnimationBlock;
    m_numAnims = AnimationBlock->m_numAnims;
    v14 = (_DWORD *)operator new[](saturated_mul(0x14u, m_numAnims));
    *v14 = 20;
    v14[1] = m_numAnims;
    v15 = (CAnimBlendStaticAssociation *)(v14 + 2);
    if ( m_numAnims )
    {
      v16 = 20 * m_numAnims;
      v17 = (CAnimBlendStaticAssociation *)(v14 + 2);
      do
      {
        CAnimBlendStaticAssociation::CAnimBlendStaticAssociation(v17);
        v16 -= 20;
        v17 = v18 + 1;
      }
      while ( v16 );
      AnimationBlock = this->m_pAnimBlock;
    }
    this->m_aAssociationArray = v15;
    this->m_numAssociations = 0;
    v19 = AnimationBlock->m_numAnims;
    if ( v19 >= 1 )
    {
      for ( i = 0; i < v19; ++i )
      {
        if ( v19 >= 1 )
        {
          v21 = -1;
          v22 = 0;
          v23 = pAnimNames;
          v24 = &CAnimManager::ms_aAnimations[AnimationBlock->m_animIndex + i];
          do
          {
            UppercaseKey = CKeyGen::GetUppercaseKey(v23);
            v23 += a5;
            if ( UppercaseKey == v24->m_hashKey )
              v21 = v22;
            ++v22;
          }
          while ( v22 < this->m_pAnimBlock->m_numAnims );
          if ( v21 != -1 )
          {
            CModelInfo::ms_lastPositionSearched = 0;
            ModelInfo = CModelInfo::GetModelInfo(&pModelNames[v21 * a5], 0);
            if ( ModelInfo )
            {
              v27 = (RpClump_0 *)(*((int (__fastcall **)(CBaseModelInfo *))ModelInfo->_vptr$CBaseModelInfo + 11))(ModelInfo);
              RpAnimBlendClumpInit(v27);
              CAnimBlendStaticAssociation::Init(&this->m_aAssociationArray[this->m_numAssociations], v27, v24);
              FirstAtomic = GetFirstAtomic(v27);
              if ( FirstAtomic )
              {
                if ( j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
                  RpClumpForAllAtomics(v27, AtomicRemoveAnimFromSkinCB, 0);
              }
              RpClumpDestroy(v27);
              this->m_aAssociationArray[this->m_numAssociations].m_animId = this->m_idOffset + i;
              this->m_aAssociationArray[this->m_numAssociations++].m_animGrp = this->m_grpId;
            }
          }
        }
        AnimationBlock = this->m_pAnimBlock;
        v19 = this->m_pAnimBlock->m_numAnims;
      }
    }
  }
  else
  {
    CAnimBlendAssocGroup::CreateAssociations(this, pAnimBlockName);
  }
}
// 3894CA: variable 'v18' is possibly undefined

//----- (003895E4) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::CreateAssociations(
        CAnimBlendAssocGroup *this,
        const unsigned __int8 *pAnimBlockName,
        RpClump_0 *pClump)
{
  CAnimBlendStaticAssociation *m_aAssociationArray; // r0
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r1
  CAnimBlendSequence ***p_m_pAnimBlendSequences; // r8
  CAnimBlendStaticAssociation *v9; // r4
  int v10; // r5
  CAnimBlock *AnimationBlock; // r6
  unsigned int m_numAnims; // r4
  _DWORD *v13; // r0
  CAnimBlendStaticAssociation *v14; // r8
  int v15; // r4
  CAnimBlendStaticAssociation *v16; // r0
  CAnimBlendStaticAssociation *v17; // r0
  int32 v18; // r0
  int v19; // r5
  int32 v20; // r4
  int16 v21; // r1

  m_aAssociationArray = this->m_aAssociationArray;
  if ( m_aAssociationArray )
  {
    m_pAnimBlendHierarchy = m_aAssociationArray[-1].m_pAnimBlendHierarchy;
    p_m_pAnimBlendSequences = &m_aAssociationArray[-1].m_pAnimBlendSequences;
    if ( m_pAnimBlendHierarchy )
    {
      v9 = m_aAssociationArray - 1;
      v10 = (int)m_pAnimBlendHierarchy;
      do
        CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(&v9[v10--]);
      while ( v10 * 20 );
    }
    operator delete[](p_m_pAnimBlendSequences);
    this->m_aAssociationArray = 0;
    this->m_numAssociations = 0;
  }
  AnimationBlock = CAnimManager::GetAnimationBlock(pAnimBlockName);
  this->m_pAnimBlock = AnimationBlock;
  m_numAnims = AnimationBlock->m_numAnims;
  v13 = (_DWORD *)operator new[](saturated_mul(0x14u, m_numAnims));
  v14 = (CAnimBlendStaticAssociation *)(v13 + 2);
  *v13 = 20;
  v13[1] = m_numAnims;
  if ( m_numAnims )
  {
    v15 = 20 * m_numAnims;
    v16 = (CAnimBlendStaticAssociation *)(v13 + 2);
    do
    {
      CAnimBlendStaticAssociation::CAnimBlendStaticAssociation(v16);
      v15 -= 20;
      v16 = v17 + 1;
    }
    while ( v15 );
    AnimationBlock = this->m_pAnimBlock;
  }
  this->m_aAssociationArray = v14;
  this->m_numAssociations = 0;
  v18 = AnimationBlock->m_numAnims;
  if ( v18 >= 1 )
  {
    v19 = 0;
    v20 = 0;
    while ( 1 )
    {
      CAnimBlendStaticAssociation::Init(
        &v14[v19],
        pClump,
        &CAnimManager::ms_aAnimations[AnimationBlock->m_animIndex + v20]);
      v21 = this->m_idOffset + v20++;
      this->m_aAssociationArray[v19].m_animId = v21;
      this->m_aAssociationArray[v19].m_animGrp = this->m_grpId;
      AnimationBlock = this->m_pAnimBlock;
      ++this->m_numAssociations;
      v18 = AnimationBlock->m_numAnims;
      if ( v20 >= v18 )
        break;
      v14 = this->m_aAssociationArray;
      ++v19;
    }
  }
  this->m_numAssociations = v18;
}
// 389670: variable 'v17' is possibly undefined

//----- (003896F0) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::CreateAssociations(
        CAnimBlendAssocGroup *this,
        const unsigned __int8 *pAnimBlockName,
        RpClump_0 *pClump,
        const unsigned __int8 **ppRequiredAnims,
        signed int a5)
{
  CAnimBlendStaticAssociation *m_aAssociationArray; // r0
  const unsigned __int8 *v9; // r8
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r1
  CAnimBlendStaticAssociation *v11; // r6
  int v12; // r5
  _DWORD *v13; // r0
  CAnimBlendStaticAssociation *v14; // r5
  int v15; // r6
  CAnimBlendStaticAssociation *v16; // r0
  CAnimBlendStaticAssociation *v17; // r0
  int v18; // r6
  int v19; // r5
  const unsigned __int8 *v20; // r0
  CAnimBlendHierarchy *Animation; // r0
  int v22; // r0
  CAnimBlendStaticAssociation *v23; // r0
  int32 *p_m_numAssociations; // r4
  CAnimBlendSequence ***p_m_pAnimBlendSequences; // [sp+0h] [bp-20h]

  m_aAssociationArray = this->m_aAssociationArray;
  if ( m_aAssociationArray )
  {
    v9 = pAnimBlockName;
    m_pAnimBlendHierarchy = m_aAssociationArray[-1].m_pAnimBlendHierarchy;
    p_m_pAnimBlendSequences = &m_aAssociationArray[-1].m_pAnimBlendSequences;
    if ( m_pAnimBlendHierarchy )
    {
      v11 = m_aAssociationArray - 1;
      v12 = (int)m_pAnimBlendHierarchy;
      do
        CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(&v11[v12--]);
      while ( v12 * 20 );
    }
    operator delete[](p_m_pAnimBlendSequences);
    pAnimBlockName = v9;
    this->m_aAssociationArray = 0;
    this->m_numAssociations = 0;
  }
  this->m_pAnimBlock = CAnimManager::GetAnimationBlock(pAnimBlockName);
  v13 = (_DWORD *)operator new[](saturated_mul(0x14u, a5));
  *v13 = 20;
  v13[1] = a5;
  v14 = (CAnimBlendStaticAssociation *)(v13 + 2);
  if ( a5 )
  {
    v15 = 20 * a5;
    v16 = (CAnimBlendStaticAssociation *)(v13 + 2);
    do
    {
      CAnimBlendStaticAssociation::CAnimBlendStaticAssociation(v16);
      v15 -= 20;
      v16 = v17 + 1;
    }
    while ( v15 );
    this->m_numAssociations = 0;
    this->m_aAssociationArray = v14;
    if ( a5 >= 1 )
    {
      v18 = 0;
      v19 = 0;
      do
      {
        v20 = ppRequiredAnims[v19];
        if ( *v20 )
        {
          Animation = CAnimManager::GetAnimation(v20, this->m_pAnimBlock);
          CAnimBlendStaticAssociation::Init(&this->m_aAssociationArray[v18], pClump, Animation);
          v22 = this->m_idOffset + v19;
        }
        else
        {
          LOWORD(v22) = -1;
        }
        ++v19;
        this->m_aAssociationArray[v18].m_animId = v22;
        v23 = &this->m_aAssociationArray[v18++];
        v23->m_animGrp = this->m_grpId;
        ++this->m_numAssociations;
      }
      while ( a5 != v19 );
    }
    p_m_numAssociations = &this->m_numAssociations;
  }
  else
  {
    this->m_numAssociations = 0;
    p_m_numAssociations = &this->m_numAssociations;
    *(p_m_numAssociations - 1) = (int32)v14;
  }
  *p_m_numAssociations = a5;
}
// 389786: variable 'v17' is possibly undefined

//----- (00389800) --------------------------------------------------------
void __fastcall CAnimBlendAssocGroup::InitEmptyAssociations(CAnimBlendAssocGroup *this, RpClump_0 *pClump)
{
  int32 m_numAssociations; // r1
  int v5; // r6
  int32 i; // r4
  CAnimBlendStaticAssociation *v7; // r0

  m_numAssociations = this->m_numAssociations;
  if ( m_numAssociations >= 1 )
  {
    v5 = 0;
    for ( i = 0; i < m_numAssociations; ++i )
    {
      v7 = &this->m_aAssociationArray[v5];
      if ( !v7->m_pAnimBlendSequences )
      {
        CAnimBlendStaticAssociation::Init(v7, pClump, v7->m_pAnimBlendHierarchy);
        m_numAssociations = this->m_numAssociations;
      }
      ++v5;
    }
  }
}

//----- (00389836) --------------------------------------------------------
CAnimBlendStaticAssociation *__fastcall CAnimBlendAssocGroup::GetAnimation(
        CAnimBlendAssocGroup *this,
        const unsigned __int8 *pName)
{
  uint32 UppercaseKey; // r0
  int32 m_numAssociations; // r2
  uint32 v5; // r1
  CAnimBlendStaticAssociation *result; // r0
  int32 v7; // r3

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  m_numAssociations = this->m_numAssociations;
  v5 = UppercaseKey;
  if ( m_numAssociations < 1 )
    return 0;
  result = this->m_aAssociationArray;
  v7 = 0;
  while ( result->m_pAnimBlendHierarchy->m_hashKey != v5 )
  {
    ++v7;
    ++result;
    if ( v7 >= m_numAssociations )
      return 0;
  }
  return result;
}

//----- (00389868) --------------------------------------------------------
CAnimBlendStaticAssociation *__fastcall CAnimBlendAssocGroup::GetAnimation(CAnimBlendAssocGroup *this, uint32 id)
{
  return &this->m_aAssociationArray[id - this->m_idOffset];
}

//----- (00389878) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimBlendAssocGroup::CopyAnimation(
        CAnimBlendAssocGroup *this,
        const unsigned __int8 *pName)
{
  uint32 UppercaseKey; // r0
  int32 m_numAssociations; // r12
  CAnimBlendStaticAssociation *m_aAssociationArray; // r4
  int32 v6; // r3
  CAnimBlendAssociation *result; // r0
  CAnimBlendAssociation *v8; // r0

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  m_numAssociations = this->m_numAssociations;
  if ( m_numAssociations < 1 )
    return 0;
  m_aAssociationArray = this->m_aAssociationArray;
  v6 = 0;
  while ( m_aAssociationArray->m_pAnimBlendHierarchy->m_hashKey != UppercaseKey )
  {
    ++v6;
    ++m_aAssociationArray;
    if ( v6 >= m_numAssociations )
      return 0;
  }
  if ( !m_aAssociationArray )
    return 0;
  CAnimManager::UncompressAnimation(m_aAssociationArray->m_pAnimBlendHierarchy);
  v8 = (CAnimBlendAssociation *)operator new(0x3Cu);
  CAnimBlendAssociation::CAnimBlendAssociation(v8, m_aAssociationArray);
  return result;
}

//----- (003898C4) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimBlendAssocGroup::CopyAnimation(CAnimBlendAssocGroup *this, uint32 id)
{
  CAnimBlendStaticAssociation *v2; // r4
  CAnimBlendAssociation *v3; // r0
  CAnimBlendAssociation *result; // r0

  v2 = &this->m_aAssociationArray[id - this->m_idOffset];
  if ( !v2 )
    return 0;
  CAnimManager::UncompressAnimation(v2->m_pAnimBlendHierarchy);
  v3 = (CAnimBlendAssociation *)operator new(0x3Cu);
  CAnimBlendAssociation::CAnimBlendAssociation(v3, v2);
  return result;
}

//----- (003898F0) --------------------------------------------------------
uint32 __fastcall CAnimBlendAssocGroup::GetAnimationId(CAnimBlendAssocGroup *this, const unsigned __int8 *pName)
{
  uint32 UppercaseKey; // r0
  int32 m_numAssociations; // r1
  int v5; // r3
  CAnimBlendHierarchy **i; // r2

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  m_numAssociations = this->m_numAssociations;
  if ( m_numAssociations < 1 )
    return -1;
  v5 = 0;
  for ( i = &this->m_aAssociationArray->m_pAnimBlendHierarchy; (*i)->m_hashKey != UppercaseKey; i += 5 )
  {
    if ( ++v5 >= m_numAssociations )
      return -1;
  }
  if ( i == (CAnimBlendHierarchy **)&word_10 )
    return -1;
  else
    return *((__int16 *)i - 5);
}
// 10: using guessed type __int16 word_10;

//----- (00389940) --------------------------------------------------------
void __fastcall CAnimBlendStaticAssociation::CAnimBlendStaticAssociation(CAnimBlendStaticAssociation *this)
{
  *(_DWORD *)&this->m_animId = -1;
  this->m_bitsFlag = 0;
  this->m_pAnimBlendSequences = 0;
  this->m_pAnimBlendHierarchy = 0;
  this->_vptr$CAnimBlendStaticAssociation = (int (**)(void))&off_667748;
}
// 667748: using guessed type void *;

//----- (00389960) --------------------------------------------------------
void __fastcall CAnimBlendStaticAssociation::CAnimBlendStaticAssociation(
        CAnimBlendStaticAssociation *this,
        RpClump_0 *pClump,
        CAnimBlendHierarchy *pAnimBlendHierarchy)
{
  *(_DWORD *)&this->m_animId = -1;
  this->m_bitsFlag = 0;
  this->m_pAnimBlendSequences = 0;
  this->_vptr$CAnimBlendStaticAssociation = (int (**)(void))&off_667748;
  CAnimBlendStaticAssociation::Init(this, pClump, pAnimBlendHierarchy);
}
// 667748: using guessed type void *off_667748;

//----- (0038998C) --------------------------------------------------------
void __fastcall CAnimBlendStaticAssociation::Init(
        CAnimBlendStaticAssociation *this,
        RpClump_0 *pClump,
        CAnimBlendHierarchy *pAnimBlendHierarchy)
{
  int v6; // r8
  int v7; // r5
  CAnimBlendSequence **v8; // r0
  int v9; // r0
  int v10; // r5
  int i; // r6
  CAnimBlendSequence *m_pSequences; // r0
  CAnimBlendSequence *v13; // r10
  AnimBlendFrameData *Bone; // r0

  if ( pClump )
  {
    v6 = *(_DWORD *)(&pClump->object.type + ClumpOffset);
    v7 = *(_DWORD *)(v6 + 8);
    this->m_iNumAnimBlendNodes = v7;
    v8 = (CAnimBlendSequence **)CMemoryMgr::Malloc(v7 << 16 >> 14);
    this->m_pAnimBlendSequences = v8;
    if ( v7 << 16 >= 1 )
    {
      *v8 = 0;
      if ( (__int16)v7 != 1 )
      {
        v9 = 1;
        do
          this->m_pAnimBlendSequences[v9++] = 0;
        while ( (__int16)v7 != v9 );
      }
    }
    this->m_pAnimBlendHierarchy = pAnimBlendHierarchy;
    if ( pAnimBlendHierarchy->m_NumSequences >= 1 )
    {
      v10 = 0;
      for ( i = 0; i < pAnimBlendHierarchy->m_NumSequences; ++i )
      {
        m_pSequences = pAnimBlendHierarchy->m_pSequences;
        v13 = &m_pSequences[v10];
        if ( (m_pSequences[v10].m_bitsFlag & 0x10) != 0 )
        {
          Bone = RpAnimBlendClumpFindBone(pClump, m_pSequences[v10]._anon_0.m_boneTag);
          if ( Bone )
          {
LABEL_12:
            if ( v13->m_iNumKeyFrames >= 1 )
              this->m_pAnimBlendSequences[-357913941 * (((int)Bone - *(_DWORD *)(v6 + 16)) >> 3)] = v13;
          }
        }
        else
        {
          Bone = RpAnimBlendClumpFindFrameFromHashKey(pClump, m_pSequences[v10]._anon_0.m_nameHashKey);
          if ( Bone )
            goto LABEL_12;
        }
        ++v10;
      }
    }
  }
  else
  {
    this->m_pAnimBlendHierarchy = pAnimBlendHierarchy;
  }
}

//----- (00389A54) --------------------------------------------------------
void __fastcall CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(CAnimBlendStaticAssociation *this)
{
  CAnimBlendSequence **m_pAnimBlendSequences; // r0

  m_pAnimBlendSequences = this->m_pAnimBlendSequences;
  this->_vptr$CAnimBlendStaticAssociation = (int (**)(void))&off_667748;
  if ( m_pAnimBlendSequences )
    CMemoryMgr::Free(m_pAnimBlendSequences);
}
// 667748: using guessed type void *off_667748;

//----- (00389A78) --------------------------------------------------------
void __fastcall CAnimBlendStaticAssociation::FreeSequenceArray(CAnimBlendStaticAssociation *this)
{
  CAnimBlendSequence **m_pAnimBlendSequences; // r0

  m_pAnimBlendSequences = this->m_pAnimBlendSequences;
  if ( m_pAnimBlendSequences )
    sub_193D14(m_pAnimBlendSequences);
}

//----- (00389A84) --------------------------------------------------------
void __fastcall CAnimBlendStaticAssociation::~CAnimBlendStaticAssociation(CAnimBlendStaticAssociation *this)
{
  CAnimBlendSequence **m_pAnimBlendSequences; // r0

  m_pAnimBlendSequences = this->m_pAnimBlendSequences;
  this->_vptr$CAnimBlendStaticAssociation = (int (**)(void))&off_667748;
  if ( m_pAnimBlendSequences )
    CMemoryMgr::Free(m_pAnimBlendSequences);
  sub_191374(this);
}
// 667748: using guessed type void *off_667748;

//----- (00389AAC) --------------------------------------------------------
void __fastcall CAnimBlendStaticAssociation::AllocateSequenceArray(CAnimBlendStaticAssociation *this, int32 num)
{
  CAnimBlendSequence **v4; // r0
  int v5; // r0

  v4 = (CAnimBlendSequence **)CMemoryMgr::Malloc(4 * num);
  this->m_pAnimBlendSequences = v4;
  if ( num >= 1 )
  {
    *v4 = 0;
    if ( num != 1 )
    {
      v5 = 1;
      do
        this->m_pAnimBlendSequences[v5++] = 0;
      while ( num != v5 );
    }
  }
}

//----- (00389AE0) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::CAnimBlendAssociation(CAnimBlendAssociation *this)
{
  this->m_animGrp = -1;
  this->m_pAnimBlendNodes = 0;
  this->m_pAnimBlendHierarchy = 0;
  this->m_fTimeStep = 0.0;
  this->m_animId = -1;
  this->m_bitsFlag = 0;
  this->m_cbType = ABCB_NONE;
  this->m_list.pNext = 0;
  *(_QWORD *)&this->m_fBlendAmount = 1065353216LL;
  *(_QWORD *)&this->m_fCurrentTime = 0x3F80000000000000LL;
  this->m_list.pPrev = 0;
  this->_vptr$CAnimBlendAssociation = (int (**)(void))&off_667758;
}
// 667758: using guessed type void *;

//----- (00389B40) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::CAnimBlendAssociation(
        CAnimBlendAssociation *this,
        RpClump_0 *pClump,
        CAnimBlendHierarchy *pAnimBlendHierarchy)
{
  this->m_animGrp = -1;
  this->m_pAnimBlendNodes = 0;
  this->m_fTimeStep = 0.0;
  this->m_animId = -1;
  this->m_bitsFlag = 0;
  this->m_cbType = ABCB_NONE;
  this->m_list.pNext = 0;
  *(_QWORD *)&this->m_fBlendAmount = 1065353216LL;
  *(_QWORD *)&this->m_fCurrentTime = 0x3F80000000000000LL;
  this->m_list.pPrev = 0;
  this->_vptr$CAnimBlendAssociation = (int (**)(void))&off_667758;
  CAnimBlendAssociation::Init(this, pClump, pAnimBlendHierarchy);
}
// 667758: using guessed type void *off_667758;

//----- (00389BA4) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::Init(
        CAnimBlendAssociation *this,
        RpClump_0 *pClump,
        CAnimBlendHierarchy *pAnimBlendHierarchy)
{
  int v6; // r8
  int v7; // r5
  CAnimBlendNode *v8; // r0
  int v9; // r4
  int v10; // r5
  int v11; // r0
  int v12; // r1
  int v13; // r5
  int i; // r4
  CAnimBlendSequence *m_pSequences; // r0
  CAnimBlendSequence *v16; // r6
  AnimBlendFrameData *Bone; // r0

  v6 = *(_DWORD *)(&pClump->object.type + ClumpOffset);
  v7 = *(_DWORD *)(v6 + 8);
  this->m_iNumAnimBlendNodes = v7;
  v8 = (CAnimBlendNode *)CMemoryMgr::MallocAlign((24 * (__int16)v7 + 63) & 0xFFFFFFC0, 0x40u);
  this->m_pAnimBlendNodes = v8;
  if ( v7 << 16 >= 1 )
  {
    CAnimBlendNode::Init(v8);
    if ( (__int16)v7 != 1 )
    {
      v9 = (__int16)v7 - 1;
      v10 = 1;
      do
      {
        CAnimBlendNode::Init(&this->m_pAnimBlendNodes[v10]);
        --v9;
        ++v10;
      }
      while ( v9 );
    }
  }
  if ( this->m_iNumAnimBlendNodes >= 1 )
  {
    v11 = 0;
    v12 = 20;
    do
    {
      ++v11;
      *(_DWORD *)((char *)&this->m_pAnimBlendNodes->m_fTheta + v12) = this;
      v12 += 24;
    }
    while ( v11 < this->m_iNumAnimBlendNodes );
  }
  this->m_pAnimBlendHierarchy = pAnimBlendHierarchy;
  if ( pAnimBlendHierarchy->m_NumSequences >= 1 )
  {
    v13 = 0;
    for ( i = 0; i < pAnimBlendHierarchy->m_NumSequences; ++i )
    {
      m_pSequences = pAnimBlendHierarchy->m_pSequences;
      v16 = &m_pSequences[v13];
      if ( (m_pSequences[v13].m_bitsFlag & 0x10) != 0 )
      {
        Bone = RpAnimBlendClumpFindBone(pClump, m_pSequences[v13]._anon_0.m_boneTag);
        if ( Bone )
        {
LABEL_14:
          if ( v16->m_iNumKeyFrames >= 1 )
            *(RwFrame_0 **)((char *)&Bone->_anon_1.pFrame + (unsigned int)this->m_pAnimBlendNodes - *(_DWORD *)(v6 + 16)) = (RwFrame_0 *)v16;
        }
      }
      else
      {
        Bone = RpAnimBlendClumpFindFrameFromHashKey(pClump, m_pSequences[v13]._anon_0.m_nameHashKey);
        if ( Bone )
          goto LABEL_14;
      }
      ++v13;
    }
  }
}

//----- (00389C90) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::CAnimBlendAssociation(CAnimBlendAssociation *this, CAnimBlendAssociation *assoc)
{
  this->m_pAnimBlendNodes = 0;
  this->m_fTimeStep = 0.0;
  this->m_cbType = ABCB_NONE;
  this->m_list.pNext = 0;
  *(_QWORD *)&this->m_fBlendAmount = 1065353216LL;
  *(_QWORD *)&this->m_fCurrentTime = 0x3F80000000000000LL;
  this->m_list.pPrev = 0;
  this->_vptr$CAnimBlendAssociation = (int (**)(void))&off_667758;
  CAnimBlendAssociation::Init(this, assoc);
  if ( (this->m_bitsFlag & 0x4000) == 0 )
  {
    CAnimManager::AddAnimBlockRef(this->m_pAnimBlendHierarchy->m_animBlock);
    this->m_bitsFlag |= 0x4000u;
  }
}
// 667758: using guessed type void *off_667758;

//----- (00389CF4) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::Init(CAnimBlendAssociation *this, CAnimBlendAssociation *assoc)
{
  int m_iNumAnimBlendNodes; // r6
  CAnimBlendNode *v5; // r0
  int v6; // r6
  int v7; // r4
  int v8; // r0
  int v9; // r1
  CAnimBlendNode *v10; // r2
  __int64 v11; // d16
  __int64 v12; // d17
  __int64 v13; // d18
  CAnimBlendNode *v14; // r2
  CAnimBlendNode *v15; // r2

  this->m_pAnimBlendHierarchy = assoc->m_pAnimBlendHierarchy;
  m_iNumAnimBlendNodes = assoc->m_iNumAnimBlendNodes;
  this->m_iNumAnimBlendNodes = m_iNumAnimBlendNodes;
  this->m_bitsFlag = assoc->m_bitsFlag;
  this->m_animId = assoc->m_animId;
  this->m_animGrp = assoc->m_animGrp;
  v5 = (CAnimBlendNode *)CMemoryMgr::MallocAlign((24 * m_iNumAnimBlendNodes + 63) & 0xFFFFFFC0, 0x40u);
  this->m_pAnimBlendNodes = v5;
  if ( m_iNumAnimBlendNodes >= 1 )
  {
    CAnimBlendNode::Init(v5);
    if ( m_iNumAnimBlendNodes != 1 )
    {
      v6 = m_iNumAnimBlendNodes - 1;
      v7 = 1;
      do
      {
        CAnimBlendNode::Init(&this->m_pAnimBlendNodes[v7]);
        --v6;
        ++v7;
      }
      while ( v6 );
    }
  }
  if ( this->m_iNumAnimBlendNodes >= 1 )
  {
    v8 = 0;
    v9 = 0;
    do
    {
      ++v9;
      v10 = &assoc->m_pAnimBlendNodes[v8];
      v11 = *(_QWORD *)&v10->m_fTheta;
      v12 = *(_QWORD *)&v10->m_iCurrentFrame;
      v13 = *(_QWORD *)&v10->m_pSequence;
      v14 = &this->m_pAnimBlendNodes[v8];
      *(_QWORD *)&v14->m_fTheta = v11;
      *(_QWORD *)&v14->m_iCurrentFrame = v12;
      *(_QWORD *)&v14->m_pSequence = v13;
      v15 = &this->m_pAnimBlendNodes[v8++];
      v15->m_pAssociation = this;
    }
    while ( v9 < this->m_iNumAnimBlendNodes );
  }
}

//----- (00389D92) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::ReferenceAnimBlock(CAnimBlendAssociation *this)
{
  if ( (this->m_bitsFlag & 0x4000) == 0 )
  {
    CAnimManager::AddAnimBlockRef(this->m_pAnimBlendHierarchy->m_animBlock);
    this->m_bitsFlag |= 0x4000u;
  }
}

//----- (00389DC0) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::CAnimBlendAssociation(
        CAnimBlendAssociation *this,
        CAnimBlendStaticAssociation *assoc)
{
  this->m_pAnimBlendNodes = 0;
  this->m_fTimeStep = 0.0;
  this->m_cbType = ABCB_NONE;
  this->m_list.pNext = 0;
  *(_QWORD *)&this->m_fBlendAmount = 1065353216LL;
  *(_QWORD *)&this->m_fCurrentTime = 0x3F80000000000000LL;
  this->m_list.pPrev = 0;
  this->_vptr$CAnimBlendAssociation = (int (**)(void))&off_667758;
  CAnimBlendAssociation::Init(this, assoc);
  if ( (this->m_bitsFlag & 0x4000) == 0 )
  {
    CAnimManager::AddAnimBlockRef(this->m_pAnimBlendHierarchy->m_animBlock);
    this->m_bitsFlag |= 0x4000u;
  }
}
// 667758: using guessed type void *off_667758;

//----- (00389E24) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::Init(CAnimBlendAssociation *this, CAnimBlendStaticAssociation *assoc)
{
  int m_iNumAnimBlendNodes; // r6
  CAnimBlendNode *v5; // r0
  int v6; // r6
  int v7; // r4
  int v8; // r0
  int v9; // r1
  CAnimBlendSequence *v10; // r2
  CAnimBlendNode *v11; // r2

  this->m_pAnimBlendHierarchy = assoc->m_pAnimBlendHierarchy;
  m_iNumAnimBlendNodes = assoc->m_iNumAnimBlendNodes;
  this->m_iNumAnimBlendNodes = m_iNumAnimBlendNodes;
  this->m_bitsFlag = assoc->m_bitsFlag;
  this->m_animId = assoc->m_animId;
  this->m_animGrp = assoc->m_animGrp;
  v5 = (CAnimBlendNode *)CMemoryMgr::MallocAlign((24 * m_iNumAnimBlendNodes + 63) & 0xFFFFFFC0, 0x40u);
  this->m_pAnimBlendNodes = v5;
  if ( m_iNumAnimBlendNodes >= 1 )
  {
    CAnimBlendNode::Init(v5);
    if ( m_iNumAnimBlendNodes != 1 )
    {
      v6 = m_iNumAnimBlendNodes - 1;
      v7 = 1;
      do
      {
        CAnimBlendNode::Init(&this->m_pAnimBlendNodes[v7]);
        --v6;
        ++v7;
      }
      while ( v6 );
    }
  }
  if ( this->m_iNumAnimBlendNodes >= 1 )
  {
    v8 = 0;
    v9 = 0;
    do
    {
      v10 = assoc->m_pAnimBlendSequences[v9++];
      this->m_pAnimBlendNodes[v8].m_pSequence = v10;
      v11 = &this->m_pAnimBlendNodes[v8++];
      v11->m_pAssociation = this;
    }
    while ( v9 < this->m_iNumAnimBlendNodes );
  }
}

//----- (00389EB8) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::~CAnimBlendAssociation(CAnimBlendAssociation *this)
{
  CAnimBlendNode *m_pAnimBlendNodes; // r0
  ListLink *pPrev; // r0
  ListLink *pNext; // r0
  char m_bitsFlag_high; // r0

  m_pAnimBlendNodes = this->m_pAnimBlendNodes;
  this->_vptr$CAnimBlendAssociation = (int (**)(void))&off_667758;
  if ( m_pAnimBlendNodes )
    CMemoryMgr::FreeAlign(m_pAnimBlendNodes);
  pPrev = this->m_list.pPrev;
  if ( pPrev )
    pPrev->pNext = this->m_list.pNext;
  pNext = this->m_list.pNext;
  if ( pNext )
    pNext->pPrev = this->m_list.pPrev;
  m_bitsFlag_high = HIBYTE(this->m_bitsFlag);
  this->m_list.pNext = 0;
  this->m_list.pPrev = 0;
  if ( (m_bitsFlag_high & 0x40) != 0 )
    CAnimManager::RemoveAnimBlockRef(this->m_pAnimBlendHierarchy->m_animBlock);
}
// 667758: using guessed type void *off_667758;

//----- (00389F04) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::FreeAnimBlendNodeArray(CAnimBlendAssociation *this)
{
  CAnimBlendNode *m_pAnimBlendNodes; // r0

  m_pAnimBlendNodes = this->m_pAnimBlendNodes;
  if ( m_pAnimBlendNodes )
    sub_19C2D0(m_pAnimBlendNodes);
}

//----- (00389F10) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::~CAnimBlendAssociation(CAnimBlendAssociation *this)
{
  CAnimBlendNode *m_pAnimBlendNodes; // r0
  ListLink *pPrev; // r0
  ListLink *pNext; // r0
  char m_bitsFlag_high; // r0

  m_pAnimBlendNodes = this->m_pAnimBlendNodes;
  this->_vptr$CAnimBlendAssociation = (int (**)(void))&off_667758;
  if ( m_pAnimBlendNodes )
    CMemoryMgr::FreeAlign(m_pAnimBlendNodes);
  pPrev = this->m_list.pPrev;
  if ( pPrev )
    pPrev->pNext = this->m_list.pNext;
  pNext = this->m_list.pNext;
  if ( pNext )
    pNext->pPrev = this->m_list.pPrev;
  m_bitsFlag_high = HIBYTE(this->m_bitsFlag);
  this->m_list.pNext = 0;
  this->m_list.pPrev = 0;
  if ( (m_bitsFlag_high & 0x40) != 0 )
    CAnimManager::RemoveAnimBlockRef(this->m_pAnimBlendHierarchy->m_animBlock);
  sub_191374(this);
}
// 667758: using guessed type void *off_667758;

//----- (00389F64) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::AllocateAnimBlendNodeArray(CAnimBlendAssociation *this, int32 num)
{
  CAnimBlendNode *v4; // r0
  int v5; // r5
  int v6; // r6

  v4 = (CAnimBlendNode *)CMemoryMgr::MallocAlign((24 * num + 63) & 0xFFFFFFC0, 0x40u);
  this->m_pAnimBlendNodes = v4;
  if ( num >= 1 )
  {
    CAnimBlendNode::Init(v4);
    if ( num != 1 )
    {
      v5 = num - 1;
      v6 = 1;
      do
      {
        CAnimBlendNode::Init(&this->m_pAnimBlendNodes[v6++]);
        --v5;
      }
      while ( v5 );
    }
  }
}

//----- (00389FAA) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::SetCurrentTime(CAnimBlendAssociation *this, float fCurrentTime)
{
  float v3; // s0
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r0
  float m_fTotalTime; // s2
  int v6; // r1
  int m_iNumAnimBlendNodes; // r1
  int v8; // r5
  int v9; // r6
  CAnimBlendNode *v10; // r0
  int v11; // r5
  int v12; // r6
  CAnimBlendNode *v13; // r0

  v3 = fCurrentTime;
  m_pAnimBlendHierarchy = this->m_pAnimBlendHierarchy;
  this->m_fCurrentTime = fCurrentTime;
  m_fTotalTime = m_pAnimBlendHierarchy->m_fTotalTime;
  if ( m_fTotalTime <= fCurrentTime )
  {
    v6 = this->m_bitsFlag & 2;
    while ( v6 )
    {
      v3 = v3 - m_fTotalTime;
      this->m_fCurrentTime = v3;
      m_fTotalTime = m_pAnimBlendHierarchy->m_fTotalTime;
      if ( v3 < m_fTotalTime )
        goto LABEL_7;
    }
    this->m_fCurrentTime = m_fTotalTime;
  }
LABEL_7:
  CAnimManager::UncompressAnimation(m_pAnimBlendHierarchy);
  m_iNumAnimBlendNodes = this->m_iNumAnimBlendNodes;
  if ( this->m_pAnimBlendHierarchy->m_bRunCompressed )
  {
    if ( m_iNumAnimBlendNodes >= 1 )
    {
      v8 = 0;
      v9 = 0;
      do
      {
        v10 = &this->m_pAnimBlendNodes[v8];
        if ( v10->m_pSequence )
        {
          CAnimBlendNode::SetupKeyFrameCompressed(v10);
          LOWORD(m_iNumAnimBlendNodes) = this->m_iNumAnimBlendNodes;
        }
        ++v8;
        ++v9;
      }
      while ( v9 < (__int16)m_iNumAnimBlendNodes );
    }
  }
  else if ( m_iNumAnimBlendNodes >= 1 )
  {
    v11 = 0;
    v12 = 0;
    do
    {
      v13 = &this->m_pAnimBlendNodes[v11];
      if ( v13->m_pSequence )
      {
        CAnimBlendNode::FindKeyFrame(v13, this->m_fCurrentTime);
        LOWORD(m_iNumAnimBlendNodes) = this->m_iNumAnimBlendNodes;
      }
      ++v11;
      ++v12;
    }
    while ( v12 < (__int16)m_iNumAnimBlendNodes );
  }
}

//----- (0038A046) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::SyncAnimation(CAnimBlendAssociation *this, CAnimBlendAssociation *pAssociation)
{
  CAnimBlendAssociation::SetCurrentTime(
    this,
    (float)(pAssociation->m_fCurrentTime / pAssociation->m_pAnimBlendHierarchy->m_fTotalTime)
  * this->m_pAnimBlendHierarchy->m_fTotalTime);
}

//----- (0038A064) --------------------------------------------------------
CAnimBlendNode *__fastcall CAnimBlendAssociation::GetNode(CAnimBlendAssociation *this, int32 iNodeNum)
{
  return &this->m_pAnimBlendNodes[iNodeNum];
}

//----- (0038A070) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::Start(CAnimBlendAssociation *this, float fStartTime)
{
  this->m_bitsFlag |= 1u;
  CAnimBlendAssociation::SetCurrentTime(this, fStartTime);
}

//----- (0038A07A) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::SetBlendTo(CAnimBlendAssociation *this, float fBlendToAmount, float fBlendDelta)
{
  this->m_fBlendDelta = (float)(fBlendToAmount - this->m_fBlendAmount) * fBlendDelta;
}

//----- (0038A094) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::SetBlend(CAnimBlendAssociation *this, float fBlendAmount, float fBlendDelta)
{
  this->m_fBlendAmount = fBlendAmount;
  this->m_fBlendDelta = fBlendDelta;
}

//----- (0038A09A) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::SetDeleteCallback(
        CAnimBlendAssociation *this,
        CAnimBlendAssocationCallback cb,
        void *pData)
{
  this->m_cbType = ABCB_DELETE;
  this->m_cb = cb;
  this->m_pCBData = pData;
}

//----- (0038A0A4) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::SetFinishCallback(
        CAnimBlendAssociation *this,
        CAnimBlendAssocationCallback cb,
        void *pData)
{
  this->m_cbType = ABCB_FINISH;
  this->m_cb = cb;
  this->m_pCBData = pData;
}

//----- (0038A0B0) --------------------------------------------------------
void __fastcall CAnimBlendClumpData::CAnimBlendClumpData(CAnimBlendClumpData *this)
{
  this->m_list = 0LL;
  *(_QWORD *)&this->_anon_0.m_numFrames = 0LL;
  this->m_pFrameDataArray = 0;
}

//----- (0038A0C0) --------------------------------------------------------
void __fastcall CAnimBlendClumpData::~CAnimBlendClumpData(CAnimBlendClumpData *this)
{
  ListLink *pPrev; // r0
  AnimBlendFrameData *m_pFrameDataArray; // r0

  pPrev = this->m_list.pPrev;
  if ( pPrev )
    pPrev->pNext = this->m_list.pNext;
  if ( this->m_list.pNext )
    this->m_list.pNext->pPrev = this->m_list.pPrev;
  m_pFrameDataArray = this->m_pFrameDataArray;
  this->m_list.pNext = 0;
  this->m_list.pPrev = 0;
  if ( m_pFrameDataArray )
    CMemoryMgr::FreeAlign(m_pFrameDataArray);
}

//----- (0038A0EE) --------------------------------------------------------
void __fastcall CAnimBlendClumpData::SetNumberOfBones(CAnimBlendClumpData *this, int32 num)
{
  AnimBlendFrameData *m_pFrameDataArray; // r0

  m_pFrameDataArray = this->m_pFrameDataArray;
  if ( m_pFrameDataArray )
    CMemoryMgr::FreeAlign(m_pFrameDataArray);
  this->m_pFrameDataArray = (AnimBlendFrameData *)CMemoryMgr::MallocAlign((24 * num + 63) & 0xFFFFFFC0, 0x40u);
  this->_anon_0.m_numFrames = num;
}

//----- (0038A11A) --------------------------------------------------------
void __fastcall CAnimBlendClumpData::ForAllFrames(CAnimBlendClumpData *this, AnimBlendFrameCallback cb, void *pData)
{
  int v6; // r4
  int32 v7; // r5

  if ( this->_anon_0.m_numFrames >= 1 )
  {
    v6 = 0;
    v7 = 0;
    do
    {
      cb(&this->m_pFrameDataArray[v6], pData);
      ++v7;
      ++v6;
    }
    while ( v7 < this->_anon_0.m_numFrames );
  }
}

//----- (0038A150) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::CAnimBlendHierarchy(CAnimBlendHierarchy *this)
{
  this->m_pSequences = 0;
  *(_DWORD *)&this->m_NumSequences = 0;
  this->m_animBlock = -1;
  this->m_fTotalTime = 0.0;
  this->m_pLink = 0;
}

//----- (0038A162) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::~CAnimBlendHierarchy(CAnimBlendHierarchy *this)
{
  CAnimBlendSequence *m_pSequences; // r0
  uint8 *m_pKeyFrames; // r9
  CAnimBlendSequence *v4; // r0
  uint8 *v5; // r1
  uint16 *p_m_bitsFlag; // r8
  CAnimBlendSequence *v7; // r6
  int v8; // r5

  m_pSequences = this->m_pSequences;
  if ( m_pSequences )
  {
    if ( (m_pSequences->m_bitsFlag & 8) != 0 )
      m_pKeyFrames = m_pSequences->m_pKeyFrames;
    else
      m_pKeyFrames = 0;
  }
  else
  {
    m_pKeyFrames = 0;
  }
  CAnimManager::RemoveFromUncompressedCache(this);
  v4 = this->m_pSequences;
  if ( v4 )
  {
    v5 = v4[-1].m_pKeyFrames;
    p_m_bitsFlag = &v4[-1].m_bitsFlag;
    if ( v5 )
    {
      v7 = v4 - 1;
      v8 = (int)v5;
      do
        CAnimBlendSequence::~CAnimBlendSequence(&v7[v8--]);
      while ( v8 * 12 );
    }
    operator delete[](p_m_bitsFlag);
  }
  this->m_NumSequences = 0;
  this->m_pSequences = 0;
  this->m_fTotalTime = 0.0;
  if ( m_pKeyFrames )
    CMemoryMgr::Free(m_pKeyFrames);
}

//----- (0038A1CE) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::RemoveAnimSequences(CAnimBlendHierarchy *this)
{
  CAnimBlendSequence *m_pSequences; // r0
  uint8 *m_pKeyFrames; // r9
  CAnimBlendSequence *v4; // r0
  uint8 *v5; // r1
  uint16 *p_m_bitsFlag; // r8
  CAnimBlendSequence *v7; // r6
  int v8; // r5

  m_pSequences = this->m_pSequences;
  if ( m_pSequences )
  {
    if ( (m_pSequences->m_bitsFlag & 8) != 0 )
      m_pKeyFrames = m_pSequences->m_pKeyFrames;
    else
      m_pKeyFrames = 0;
  }
  else
  {
    m_pKeyFrames = 0;
  }
  CAnimManager::RemoveFromUncompressedCache(this);
  v4 = this->m_pSequences;
  if ( v4 )
  {
    v5 = v4[-1].m_pKeyFrames;
    p_m_bitsFlag = &v4[-1].m_bitsFlag;
    if ( v5 )
    {
      v7 = v4 - 1;
      v8 = (int)v5;
      do
        CAnimBlendSequence::~CAnimBlendSequence(&v7[v8--]);
      while ( v8 * 12 );
    }
    operator delete[](p_m_bitsFlag);
  }
  this->m_NumSequences = 0;
  this->m_pSequences = 0;
  this->m_fTotalTime = 0.0;
  if ( m_pKeyFrames )
    sub_193D14(m_pKeyFrames);
}

//----- (0038A240) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::Shutdown(CAnimBlendHierarchy *this)
{
  CAnimBlendSequence *m_pSequences; // r0
  uint8 *m_pKeyFrames; // r9
  CAnimBlendSequence *v4; // r0
  uint8 *v5; // r1
  uint16 *p_m_bitsFlag; // r8
  CAnimBlendSequence *v7; // r6
  int v8; // r5

  m_pSequences = this->m_pSequences;
  if ( m_pSequences )
  {
    if ( (m_pSequences->m_bitsFlag & 8) != 0 )
      m_pKeyFrames = m_pSequences->m_pKeyFrames;
    else
      m_pKeyFrames = 0;
  }
  else
  {
    m_pKeyFrames = 0;
  }
  CAnimManager::RemoveFromUncompressedCache(this);
  v4 = this->m_pSequences;
  if ( v4 )
  {
    v5 = v4[-1].m_pKeyFrames;
    p_m_bitsFlag = &v4[-1].m_bitsFlag;
    if ( v5 )
    {
      v7 = v4 - 1;
      v8 = (int)v5;
      do
        CAnimBlendSequence::~CAnimBlendSequence(&v7[v8--]);
      while ( v8 * 12 );
    }
    operator delete[](p_m_bitsFlag);
  }
  this->m_NumSequences = 0;
  this->m_pSequences = 0;
  this->m_fTotalTime = 0.0;
  if ( m_pKeyFrames )
    CMemoryMgr::Free(m_pKeyFrames);
  this->m_bIsCompressed = 0;
}

//----- (0038A2AC) --------------------------------------------------------
CAnimBlendSequence *__fastcall CAnimBlendHierarchy::FindSequence(CAnimBlendHierarchy *this, unsigned __int8 *pName)
{
  uint32 UppercaseKey; // r0
  int m_NumSequences; // r2
  uint32 v5; // r1
  CAnimBlendSequence *result; // r0
  int v7; // r3

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  m_NumSequences = this->m_NumSequences;
  v5 = UppercaseKey;
  if ( m_NumSequences < 1 )
    return 0;
  result = this->m_pSequences;
  v7 = 0;
  while ( result->_anon_0.m_nameHashKey != v5 )
  {
    ++v7;
    ++result;
    if ( v7 >= m_NumSequences )
      return 0;
  }
  return result;
}

//----- (0038A2DE) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::SetName(CAnimBlendHierarchy *this, const unsigned __int8 *pName)
{
  this->m_hashKey = CKeyGen::GetUppercaseKey(pName);
}

//----- (0038A2F0) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::CalcTotalTime(CAnimBlendHierarchy *this)
{
  int m_NumSequences; // r8
  float m_fTotalTime; // s0
  int v3; // r10
  CAnimBlendSequence *v4; // r5
  int16 *p_m_iNumKeyFrames; // r5
  int16 v6; // r9
  int m_iNumKeyFrames; // t1
  int v8; // r6
  int16 *v9; // r12
  int *v10; // lr
  int v11; // r1
  float v12; // s2
  int16 v13; // r5
  int v14; // r2
  int v15; // r1
  int v16; // r5
  int v17; // r6
  int v18; // r4
  int v19; // r3
  int v20; // r1
  float v21; // s0

  m_NumSequences = this->m_NumSequences;
  this->m_fTotalTime = 0.0;
  if ( m_NumSequences >= 1 )
  {
    m_fTotalTime = 0.0;
    v3 = 0;
    while ( 1 )
    {
      v4 = &this->m_pSequences[v3];
      m_iNumKeyFrames = v4->m_iNumKeyFrames;
      p_m_iNumKeyFrames = &v4->m_iNumKeyFrames;
      v6 = m_iNumKeyFrames;
      v8 = m_iNumKeyFrames - 1;
      v9 = p_m_iNumKeyFrames - 1;
      v10 = (int *)(p_m_iNumKeyFrames + 1);
      v11 = 20 * (m_iNumKeyFrames - 1);
      if ( (*(_BYTE *)(p_m_iNumKeyFrames - 1) & 2) != 0 )
        v11 = 32 * v8;
      v12 = *(float *)(v11 + *(_DWORD *)(p_m_iNumKeyFrames + 1) + 16);
      if ( v12 <= m_fTotalTime )
      {
        v13 = v6;
      }
      else
      {
        this->m_fTotalTime = v12;
        v13 = *p_m_iNumKeyFrames;
      }
      if ( v13 >= 2 )
      {
        v14 = 32 * v13 - 64;
        v15 = 5 * v13;
        v16 = v13 + 1;
        v17 = 4 * v15 - 40;
        do
        {
          v18 = v17 + 20;
          v19 = *v10;
          --v16;
          if ( (*v9 & 2) != 0 )
            v18 = v14 + 32;
          v20 = v17 - 20;
          if ( (*v9 & 2) != 0 )
            v17 = v14;
          v14 -= 32;
          v21 = *(float *)(v17 + v19 + 16);
          v17 = v20;
          *(float *)(v19 + v18 + 16) = *(float *)(v19 + v18 + 16) - v21;
        }
        while ( v16 > 2 );
        LOWORD(m_NumSequences) = this->m_NumSequences;
      }
      if ( ++v3 >= (__int16)m_NumSequences )
        break;
      m_fTotalTime = this->m_fTotalTime;
    }
  }
}

//----- (0038A3D0) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::CalcTotalTimeCompressed(CAnimBlendHierarchy *this)
{
  int m_NumSequences; // r8
  float m_fTotalTime; // s2
  int v3; // r10
  CAnimBlendSequence *v4; // r5
  int16 *p_m_iNumKeyFrames; // r5
  int16 v6; // r9
  int m_iNumKeyFrames; // t1
  int v8; // r6
  int16 *v9; // r12
  int *v10; // lr
  int v11; // r1
  float v12; // s4
  int16 v13; // r5
  int v14; // r2
  int v15; // r1
  int v16; // r5
  int v17; // r6
  int v18; // r4
  int v19; // r3
  int v20; // r1
  int v21; // r6
  int v22; // r3
  __int16 v23; // r4

  m_NumSequences = this->m_NumSequences;
  this->m_fTotalTime = 0.0;
  if ( m_NumSequences >= 1 )
  {
    m_fTotalTime = 0.0;
    v3 = 0;
    while ( 1 )
    {
      v4 = &this->m_pSequences[v3];
      m_iNumKeyFrames = v4->m_iNumKeyFrames;
      p_m_iNumKeyFrames = &v4->m_iNumKeyFrames;
      v6 = m_iNumKeyFrames;
      v8 = m_iNumKeyFrames - 1;
      v9 = p_m_iNumKeyFrames - 1;
      v10 = (int *)(p_m_iNumKeyFrames + 1);
      v11 = 10 * (m_iNumKeyFrames - 1);
      if ( (*(_BYTE *)(p_m_iNumKeyFrames - 1) & 2) != 0 )
        v11 = 16 * v8;
      v12 = (float)*(__int16 *)(v11 + *(_DWORD *)(p_m_iNumKeyFrames + 1) + 8) * 0.016667;
      if ( v12 <= m_fTotalTime )
      {
        v13 = v6;
      }
      else
      {
        this->m_fTotalTime = v12;
        v13 = *p_m_iNumKeyFrames;
      }
      if ( v13 >= 2 )
      {
        v14 = 16 * v13 - 32;
        v15 = 5 * v13;
        v16 = v13 + 1;
        v17 = 2 * v15 - 20;
        do
        {
          v18 = v17 + 10;
          v19 = *v10;
          --v16;
          if ( (*v9 & 2) != 0 )
            v18 = v14 + 16;
          v20 = v17 - 10;
          if ( (*v9 & 2) != 0 )
            v17 = v14;
          v14 -= 16;
          v21 = v17 + v19;
          v22 = v19 + v18;
          v23 = *(_WORD *)(v22 + 8) - *(_WORD *)(v21 + 8);
          v17 = v20;
          *(_WORD *)(v22 + 8) = v23;
        }
        while ( v16 > 2 );
        LOWORD(m_NumSequences) = this->m_NumSequences;
      }
      if ( ++v3 >= (__int16)m_NumSequences )
        break;
      m_fTotalTime = this->m_fTotalTime;
    }
  }
}

//----- (0038A4BC) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::RemoveQuaternionFlips(CAnimBlendHierarchy *this)
{
  int v2; // r5
  int v3; // r6

  if ( this->m_NumSequences >= 1 )
  {
    v2 = 0;
    v3 = 0;
    do
    {
      CAnimBlendSequence::RemoveQuaternionFlips(&this->m_pSequences[v2]);
      ++v3;
      ++v2;
    }
    while ( v3 < this->m_NumSequences );
  }
}

//----- (0038A4EC) --------------------------------------------------------
uint8 *__fastcall CAnimBlendHierarchy::AllocSequenceBlock(CAnimBlendHierarchy *this, bool bAsCompressed)
{
  int v4; // r4
  size_t v5; // r6
  int v6; // r5

  if ( this->m_NumSequences < 1 )
  {
    v5 = 0;
  }
  else
  {
    v4 = 0;
    v5 = 0;
    v6 = 0;
    do
    {
      v5 += CAnimBlendSequence::GetDataSize(&this->m_pSequences[v4], bAsCompressed);
      ++v6;
      ++v4;
    }
    while ( v6 < this->m_NumSequences );
  }
  return (uint8 *)sub_19CF40(v5);
}

//----- (0038A532) --------------------------------------------------------
uint8 *__fastcall CAnimBlendHierarchy::GetSequenceBlock(CAnimBlendHierarchy *this)
{
  CAnimBlendSequence *m_pSequences; // r0

  m_pSequences = this->m_pSequences;
  if ( (m_pSequences->m_bitsFlag & 8) != 0 )
    return m_pSequences->m_pKeyFrames;
  else
    return 0;
}

//----- (0038A540) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::Uncompress(CAnimBlendHierarchy *this)
{
  int v2; // r4
  size_t v3; // r5
  int v4; // r6
  uint8 *v5; // r5
  CAnimBlendSequence *m_pSequences; // r0
  uint8 *m_pKeyFrames; // r8
  uint32 DataSize; // r0
  int v9; // r6
  int v10; // r4
  float m_fTotalTime; // s0
  int v12; // r4
  int v13; // r5
  int m_NumSequences; // r3
  float v15; // s0
  int v16; // r10
  CAnimBlendSequence *v17; // r1
  int16 *p_m_iNumKeyFrames; // r1
  int16 v19; // r8
  int m_iNumKeyFrames; // t1
  int v21; // r4
  int16 *v22; // r12
  int v23; // r0
  _DWORD *v24; // r5
  float v25; // s2
  int16 v26; // r1
  int v27; // r3
  int v28; // r4
  int v29; // r1
  int v30; // r6
  int v31; // r0

  if ( this->m_NumSequences < 1 )
  {
    v3 = 0;
  }
  else
  {
    v2 = 0;
    v3 = 0;
    v4 = 0;
    do
    {
      v3 += CAnimBlendSequence::GetDataSize(&this->m_pSequences[v2], 0);
      ++v4;
      ++v2;
    }
    while ( v4 < this->m_NumSequences );
  }
  v5 = (uint8 *)CMemoryMgr::Malloc(v3);
  m_pSequences = this->m_pSequences;
  if ( (m_pSequences->m_bitsFlag & 8) != 0 )
    m_pKeyFrames = m_pSequences->m_pKeyFrames;
  else
    m_pKeyFrames = 0;
  if ( this->m_NumSequences >= 1 )
  {
    CAnimBlendSequence::Uncompress(m_pSequences, v5);
    DataSize = CAnimBlendSequence::GetDataSize(this->m_pSequences, 0);
    if ( this->m_NumSequences >= 2 )
    {
      v9 = 1;
      v10 = 1;
      do
      {
        v5 += DataSize;
        CAnimBlendSequence::Uncompress(&this->m_pSequences[v10], v5);
        DataSize = CAnimBlendSequence::GetDataSize(&this->m_pSequences[v10], 0);
        ++v9;
        ++v10;
      }
      while ( v9 < this->m_NumSequences );
    }
  }
  if ( m_pKeyFrames )
    CMemoryMgr::Free(m_pKeyFrames);
  m_fTotalTime = this->m_fTotalTime;
  this->m_bIsCompressed = 0;
  if ( m_fTotalTime == 0.0 )
  {
    if ( this->m_NumSequences < 1 )
    {
      this->m_fTotalTime = 0.0;
    }
    else
    {
      v12 = 0;
      v13 = 0;
      do
      {
        CAnimBlendSequence::RemoveQuaternionFlips(&this->m_pSequences[v12]);
        m_NumSequences = this->m_NumSequences;
        ++v13;
        ++v12;
      }
      while ( v13 < m_NumSequences );
      this->m_fTotalTime = 0.0;
      if ( m_NumSequences >= 1 )
      {
        v15 = 0.0;
        v16 = 0;
        while ( 1 )
        {
          v17 = &this->m_pSequences[v16];
          m_iNumKeyFrames = v17->m_iNumKeyFrames;
          p_m_iNumKeyFrames = &v17->m_iNumKeyFrames;
          v19 = m_iNumKeyFrames;
          v21 = m_iNumKeyFrames - 1;
          v22 = p_m_iNumKeyFrames - 1;
          v23 = 20 * (m_iNumKeyFrames - 1);
          v24 = p_m_iNumKeyFrames + 1;
          if ( (*(_BYTE *)(p_m_iNumKeyFrames - 1) & 2) != 0 )
            v23 = 32 * v21;
          v25 = *(float *)(v23 + *(_DWORD *)(p_m_iNumKeyFrames + 1) + 16);
          if ( v25 <= v15 )
          {
            v26 = v19;
          }
          else
          {
            this->m_fTotalTime = v25;
            v26 = *p_m_iNumKeyFrames;
          }
          if ( v26 >= 2 )
          {
            v27 = 32 * v26 - 64;
            v28 = v26 + 1;
            v29 = 20 * v26 - 40;
            do
            {
              v30 = v29 + 20;
              --v28;
              if ( (*v22 & 2) != 0 )
                v30 = v27 + 32;
              v31 = v29 - 20;
              if ( (*v22 & 2) != 0 )
                v29 = v27;
              v27 -= 32;
              *(float *)(*v24 + v30 + 16) = *(float *)(*v24 + v30 + 16) - *(float *)(v29 + *v24 + 16);
              v29 = v31;
            }
            while ( v28 > 2 );
            LOWORD(m_NumSequences) = this->m_NumSequences;
          }
          if ( ++v16 >= (__int16)m_NumSequences )
            break;
          v15 = this->m_fTotalTime;
        }
      }
    }
  }
}

//----- (0038A6FC) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::CompressKeyframes(CAnimBlendHierarchy *this)
{
  int v2; // r4
  size_t v3; // r5
  int v4; // r6
  uint8 *v5; // r5
  CAnimBlendSequence *m_pSequences; // r0
  uint8 *m_pKeyFrames; // r8
  uint32 DataSize; // r0
  int v9; // r6
  int v10; // r4

  if ( this->m_NumSequences < 1 )
  {
    v3 = 0;
  }
  else
  {
    v2 = 0;
    v3 = 0;
    v4 = 0;
    do
    {
      v3 += CAnimBlendSequence::GetDataSize(&this->m_pSequences[v2], 1);
      ++v4;
      ++v2;
    }
    while ( v4 < this->m_NumSequences );
  }
  v5 = (uint8 *)CMemoryMgr::Malloc(v3);
  m_pSequences = this->m_pSequences;
  if ( (m_pSequences->m_bitsFlag & 8) != 0 )
    m_pKeyFrames = m_pSequences->m_pKeyFrames;
  else
    m_pKeyFrames = 0;
  if ( this->m_NumSequences >= 1 )
  {
    CAnimBlendSequence::CompressKeyframes(m_pSequences, v5);
    DataSize = CAnimBlendSequence::GetDataSize(this->m_pSequences, 1);
    if ( this->m_NumSequences >= 2 )
    {
      v9 = 1;
      v10 = 1;
      do
      {
        v5 += DataSize;
        CAnimBlendSequence::CompressKeyframes(&this->m_pSequences[v10], v5);
        DataSize = CAnimBlendSequence::GetDataSize(&this->m_pSequences[v10], 1);
        ++v9;
        ++v10;
      }
      while ( v9 < this->m_NumSequences );
    }
  }
  if ( m_pKeyFrames )
    sub_193D14(m_pKeyFrames);
}

//----- (0038A7B0) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::RemoveUncompressedData(CAnimBlendHierarchy *this)
{
  int v2; // r4
  size_t v3; // r5
  int v4; // r6
  uint8 *v5; // r5
  CAnimBlendSequence *m_pSequences; // r0
  uint8 *m_pKeyFrames; // r8
  uint32 DataSize; // r0
  int v9; // r6
  int v10; // r4

  if ( this->m_NumSequences < 1 )
  {
    v3 = 0;
  }
  else
  {
    v2 = 0;
    v3 = 0;
    v4 = 0;
    do
    {
      v3 += CAnimBlendSequence::GetDataSize(&this->m_pSequences[v2], 1);
      ++v4;
      ++v2;
    }
    while ( v4 < this->m_NumSequences );
  }
  v5 = (uint8 *)CMemoryMgr::Malloc(v3);
  m_pSequences = this->m_pSequences;
  if ( (m_pSequences->m_bitsFlag & 8) != 0 )
    m_pKeyFrames = m_pSequences->m_pKeyFrames;
  else
    m_pKeyFrames = 0;
  if ( this->m_NumSequences >= 1 )
  {
    CAnimBlendSequence::RemoveUncompressedData(m_pSequences, v5);
    DataSize = CAnimBlendSequence::GetDataSize(this->m_pSequences, 1);
    if ( this->m_NumSequences >= 2 )
    {
      v9 = 1;
      v10 = 1;
      do
      {
        v5 += DataSize;
        CAnimBlendSequence::RemoveUncompressedData(&this->m_pSequences[v10], v5);
        DataSize = CAnimBlendSequence::GetDataSize(&this->m_pSequences[v10], 1);
        ++v9;
        ++v10;
      }
      while ( v9 < this->m_NumSequences );
    }
  }
  if ( m_pKeyFrames )
    CMemoryMgr::Free(m_pKeyFrames);
  this->m_bIsCompressed = 1;
}

//----- (0038A862) --------------------------------------------------------
bool __fastcall CAnimBlendHierarchy::MoveMemory(CAnimBlendHierarchy *this)
{
  CAnimBlendSequence *m_pSequences; // r0
  char v3; // r5
  int v4; // r6
  int v5; // r4
  uint8 *m_pKeyFrames; // r5
  uint8 *v7; // r0
  int v8; // r0
  int v9; // r1
  int v10; // r2

  m_pSequences = this->m_pSequences;
  if ( !m_pSequences )
    goto LABEL_14;
  if ( (m_pSequences->m_bitsFlag & 8) == 0 )
  {
    if ( this->m_NumSequences >= 1 )
    {
      v3 = CAnimBlendSequence::MoveMemory(m_pSequences);
      if ( this->m_NumSequences >= 2 )
      {
        v4 = 1;
        v5 = 1;
        do
        {
          v3 |= CAnimBlendSequence::MoveMemory(&this->m_pSequences[v5]);
          ++v4;
          ++v5;
        }
        while ( v4 < this->m_NumSequences );
      }
      return v3 & 1;
    }
LABEL_14:
    v3 = 0;
    return v3 & 1;
  }
  m_pKeyFrames = m_pSequences->m_pKeyFrames;
  if ( !m_pKeyFrames )
    goto LABEL_14;
  v7 = (uint8 *)CMemoryMgr::MoveMemory(m_pSequences->m_pKeyFrames);
  if ( m_pKeyFrames == v7 )
    goto LABEL_14;
  if ( this->m_NumSequences >= 1 )
  {
    v8 = v7 - m_pKeyFrames;
    v9 = 0;
    v10 = 8;
    do
    {
      ++v9;
      *(uint32 *)((char *)&this->m_pSequences->_anon_0.m_nameHashKey + v10) += v8;
      v10 += 12;
    }
    while ( v9 < this->m_NumSequences );
  }
  v3 = 1;
  return v3 & 1;
}

//----- (0038A8EE) --------------------------------------------------------
void __fastcall CAnimBlendHierarchy::Print(CAnimBlendHierarchy *this)
{
  int v2; // r5
  int v3; // r6

  CAnimManager::UncompressAnimation(this);
  if ( this->m_NumSequences >= 1 )
  {
    v2 = 0;
    v3 = 0;
    do
    {
      CAnimBlendSequence::Print(&this->m_pSequences[v2]);
      ++v3;
      ++v2;
    }
    while ( v3 < this->m_NumSequences );
  }
}

//----- (0038A924) --------------------------------------------------------
void __fastcall CAnimBlendNode::Init(CAnimBlendNode *this)
{
  *(_DWORD *)&this->m_iCurrentFrame = -1;
  this->m_fTimeRemaining = 0.0;
  this->m_pSequence = 0;
  this->m_pAssociation = 0;
}

//----- (0038A934) --------------------------------------------------------
bool __fastcall CAnimBlendNode::UpdateTime(CAnimBlendNode *this)
{
  CAnimBlendAssociation *m_pAssociation; // r2
  float v2; // s0
  CAnimBlendSequence *m_pSequence; // r3
  int16 m_iNumKeyFrames; // r12
  bool v5; // lr
  int16 m_iCurrentFrame; // r5
  int v8; // r4
  int v9; // r1
  int16 v10; // r1

  m_pAssociation = this->m_pAssociation;
  if ( !(LOBYTE(m_pAssociation->m_bitsFlag) << 31) )
    return 0;
  v2 = this->m_fTimeRemaining - m_pAssociation->m_fTimeStep;
  this->m_fTimeRemaining = v2;
  if ( v2 > 0.0 )
    return 0;
  m_pSequence = this->m_pSequence;
  m_iNumKeyFrames = m_pSequence->m_iNumKeyFrames;
  if ( m_iNumKeyFrames < 2 )
    return 0;
  m_iCurrentFrame = this->m_iCurrentFrame;
  v5 = 0;
  this->m_iPreviousFrame = m_iCurrentFrame;
  do
  {
    this->m_iCurrentFrame = m_iCurrentFrame + 1;
    v8 = (__int16)(m_iCurrentFrame + 1);
    if ( m_iNumKeyFrames <= v8 )
    {
      if ( (m_pAssociation->m_bitsFlag & 2) == 0 )
      {
        v5 = 0;
        this->m_fTimeRemaining = 0.0;
        this->m_iCurrentFrame = m_iCurrentFrame;
        return v5;
      }
      v8 = 0;
      v5 = 1;
      this->m_iCurrentFrame = 0;
    }
    v9 = 20 * v8;
    if ( (m_pSequence->m_bitsFlag & 2) != 0 )
      v9 = 32 * v8;
    m_iCurrentFrame = v8;
    v2 = v2 + *(float *)&m_pSequence->m_pKeyFrames[v9 + 16];
    this->m_fTimeRemaining = v2;
  }
  while ( v2 <= 0.0 );
  v10 = v8 - 1;
  if ( (__int16)(v8 - 1) < 0 )
    v10 = v8 - 1 + m_iNumKeyFrames;
  this->m_iPreviousFrame = v10;
  return v5;
}
// 38A974: masking with 0x1 was optimized away because lr.1 <= 0x1

//----- (0038A9EE) --------------------------------------------------------
bool __fastcall CAnimBlendNode::NextKeyFrameNoCalc(CAnimBlendNode *this)
{
  CAnimBlendSequence *m_pSequence; // r3
  int16 m_iNumKeyFrames; // r12
  bool v3; // lr
  float m_fTimeRemaining; // s0
  int v5; // r2
  int16 v6; // r4
  int v7; // r6
  int16 v8; // r1
  __int16 v9; // r2

  m_pSequence = this->m_pSequence;
  m_iNumKeyFrames = m_pSequence->m_iNumKeyFrames;
  if ( m_iNumKeyFrames < 2 )
    return 0;
  m_fTimeRemaining = this->m_fTimeRemaining;
  v3 = 0;
  LOWORD(v5) = this->m_iCurrentFrame;
  this->m_iPreviousFrame = v5;
  if ( m_fTimeRemaining <= 0.0 )
  {
    v6 = v5;
    do
    {
      this->m_iCurrentFrame = v6 + 1;
      v5 = (__int16)(v6 + 1);
      if ( m_iNumKeyFrames <= v5 )
      {
        if ( (this->m_pAssociation->m_bitsFlag & 2) == 0 )
        {
          v3 = 0;
          this->m_fTimeRemaining = 0.0;
          this->m_iCurrentFrame = v6;
          return v3;
        }
        v5 = 0;
        v3 = 1;
        this->m_iCurrentFrame = 0;
      }
      v7 = 20 * v5;
      if ( (m_pSequence->m_bitsFlag & 2) != 0 )
        v7 = 32 * v5;
      v6 = v5;
      m_fTimeRemaining = *(float *)&m_pSequence->m_pKeyFrames[v7 + 16] + m_fTimeRemaining;
      this->m_fTimeRemaining = m_fTimeRemaining;
    }
    while ( m_fTimeRemaining <= 0.0 );
  }
  v8 = v5 - 1;
  v9 = v5 - 1;
  if ( v9 < 0 )
    v8 = v9 + m_iNumKeyFrames;
  this->m_iPreviousFrame = v8;
  return v3;
}
// 38AA7E: masking with 0x1 was optimized away because lr.1 <= 0x1

//----- (0038AA94) --------------------------------------------------------
bool __fastcall CAnimBlendNode::Update(
        CAnimBlendNode *this,
        CVector *translation,
        CQuaternion *rotation,
        float partialScale)
{
  bool KeyFrame; // r6
  CAnimBlendAssociation *m_pAssociation; // r0
  float v10; // s0
  float m_fBlendAmount; // s16
  CAnimBlendSequence *m_pSequence; // r0
  int m_iPreviousFrame; // r3
  int m_iCurrentFrame; // r1
  int m_bitsFlag; // lr
  uint8 *m_pKeyFrames; // r0
  int v17; // r2
  int v18; // r3
  uint8 *v19; // r1
  uint8 *v20; // r3
  float v21; // s0
  float v22; // s0
  RwReal v23; // s4
  RwReal v24; // s6
  __int64 v25; // d17
  __int64 v26; // d17
  CQuaternion quatEnd; // [sp+10h] [bp-38h] BYREF
  CQuaternion quatStart; // [sp+20h] [bp-28h] BYREF

  KeyFrame = 0;
  translation->x = 0.0;
  translation->y = 0.0;
  translation->z = 0.0;
  *(_QWORD *)&rotation->x = 0LL;
  *(_QWORD *)&rotation->z = 0LL;
  m_pAssociation = this->m_pAssociation;
  if ( LOBYTE(m_pAssociation->m_bitsFlag) << 31 )
  {
    v10 = this->m_fTimeRemaining - m_pAssociation->m_fTimeStep;
    this->m_fTimeRemaining = v10;
    if ( v10 <= 0.0 )
    {
      KeyFrame = CAnimBlendNode::NextKeyFrame(this);
      m_pAssociation = this->m_pAssociation;
    }
    else
    {
      KeyFrame = 0;
    }
  }
  m_fBlendAmount = m_pAssociation->m_fBlendAmount * partialScale;
  if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
    m_fBlendAmount = m_pAssociation->m_fBlendAmount;
  if ( m_fBlendAmount > 0.0 )
  {
    m_pSequence = this->m_pSequence;
    m_iPreviousFrame = this->m_iPreviousFrame;
    m_iCurrentFrame = this->m_iCurrentFrame;
    m_bitsFlag = m_pSequence->m_bitsFlag;
    m_pKeyFrames = m_pSequence->m_pKeyFrames;
    v17 = 20 * m_iPreviousFrame;
    if ( (m_bitsFlag & 2) != 0 )
      v17 = 32 * m_iPreviousFrame;
    v18 = 20 * m_iCurrentFrame;
    if ( (m_bitsFlag & 2) != 0 )
      v18 = 32 * m_iCurrentFrame;
    v19 = &m_pKeyFrames[v17];
    v20 = &m_pKeyFrames[v18];
    v21 = *((float *)v20 + 4);
    if ( v21 == 0.0 )
    {
      v22 = 0.0;
      if ( (m_bitsFlag & 2) == 0 )
      {
LABEL_15:
        if ( m_bitsFlag << 31 )
        {
          v25 = *((_QWORD *)v19 + 1);
          *(_QWORD *)&quatStart.x = *(_QWORD *)v19;
          *(_QWORD *)&quatStart.z = v25;
          v26 = *((_QWORD *)v20 + 1);
          *(_QWORD *)&quatEnd.x = *(_QWORD *)v20;
          *(_QWORD *)&quatEnd.z = v26;
          CQuaternion::Slerp(rotation, &quatStart, &quatEnd, this->m_fTheta, this->m_fOOSinTheta, v22);
          *(float32x4_t *)rotation = vmulq_n_f32(*(float32x4_t *)rotation, m_fBlendAmount);
        }
        return KeyFrame;
      }
    }
    else
    {
      v22 = (float)(v21 - this->m_fTimeRemaining) / v21;
      if ( (m_bitsFlag & 2) == 0 )
        goto LABEL_15;
    }
    v23 = m_fBlendAmount
        * (float)(*((float *)v19 + 6) + (float)(v22 * (float)(*((float *)v20 + 6) - *((float *)v19 + 6))));
    v24 = m_fBlendAmount
        * (float)(*((float *)v19 + 7) + (float)(v22 * (float)(*((float *)v20 + 7) - *((float *)v19 + 7))));
    translation->x = m_fBlendAmount
                   * (float)(*((float *)v19 + 5) + (float)(v22 * (float)(*((float *)v20 + 5) - *((float *)v19 + 5))));
    translation->y = v23;
    translation->z = v24;
    m_bitsFlag = this->m_pSequence->m_bitsFlag;
    goto LABEL_15;
  }
  return KeyFrame;
}

//----- (0038AC1C) --------------------------------------------------------
bool __fastcall CAnimBlendNode::NextKeyFrame(CAnimBlendNode *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d8
  CAnimBlendSequence *m_pSequence; // r0
  int m_iNumKeyFrames; // r12
  bool v6; // r8
  float m_fTimeRemaining; // s0
  int v8; // r1
  int16 v9; // r2
  int v10; // r6
  int v11; // r2
  uint16 m_bitsFlag; // r3
  bool v13; // zf
  int v14; // r3
  uint8 *m_pKeyFrames; // r0
  int v16; // r2
  int v17; // r3
  float v18; // r0
  float v19; // s0

  m_pSequence = this->m_pSequence;
  m_iNumKeyFrames = (unsigned __int16)m_pSequence->m_iNumKeyFrames;
  if ( (__int16)m_iNumKeyFrames < 2 )
    return 0;
  m_fTimeRemaining = this->m_fTimeRemaining;
  v6 = 0;
  LOWORD(v8) = this->m_iCurrentFrame;
  this->m_iPreviousFrame = v8;
  if ( m_fTimeRemaining <= 0.0 )
  {
    v9 = v8;
    do
    {
      this->m_iCurrentFrame = v9 + 1;
      v8 = (__int16)(v9 + 1);
      if ( (__int16)m_iNumKeyFrames <= v8 )
      {
        if ( (this->m_pAssociation->m_bitsFlag & 2) == 0 )
        {
          v6 = 0;
          this->m_fTimeRemaining = 0.0;
          this->m_iCurrentFrame = v9;
          return v6;
        }
        v8 = 0;
        v6 = 1;
        this->m_iCurrentFrame = 0;
      }
      v10 = 20 * v8;
      if ( (m_pSequence->m_bitsFlag & 2) != 0 )
        v10 = 32 * v8;
      v9 = v8;
      m_fTimeRemaining = *(float *)&m_pSequence->m_pKeyFrames[v10 + 16] + m_fTimeRemaining;
      this->m_fTimeRemaining = m_fTimeRemaining;
    }
    while ( m_fTimeRemaining <= 0.0 );
  }
  v11 = (unsigned __int16)v8 + 0xFFFF;
  if ( (__int16)(v8 - 1) < 0 )
    v11 = m_iNumKeyFrames + (unsigned __int16)(v8 - 1);
  this->m_iPreviousFrame = v11;
  m_bitsFlag = m_pSequence->m_bitsFlag;
  if ( (m_bitsFlag & 1) != 0 )
  {
    v13 = (m_bitsFlag & 2) == 0;
    v14 = v11 << 16;
    m_pKeyFrames = m_pSequence->m_pKeyFrames;
    v2.n64_u32[0] = 1.0;
    v16 = 20 * (__int16)v11;
    if ( !v13 )
      v16 = v14 >> 11;
    v17 = 20 * (__int16)v8;
    if ( !v13 )
      v17 = 32 * (__int16)v8;
    v1.n64_f32[0] = (float)((float)((float)(*(float *)&m_pKeyFrames[v16] * *(float *)&m_pKeyFrames[v17])
                                  + (float)(*(float *)&m_pKeyFrames[v16 + 4] * *(float *)&m_pKeyFrames[v17 + 4]))
                          + (float)(*(float *)&m_pKeyFrames[v16 + 8] * *(float *)&m_pKeyFrames[v17 + 8]))
                  + (float)(*(float *)&m_pKeyFrames[v16 + 12] * *(float *)&m_pKeyFrames[v17 + 12]);
    v18 = acosf(vmin_f32(v1, v2).n64_f32[0]);
    this->m_fTheta = v18;
    if ( v18 == 0.0 )
      v19 = 0.0;
    else
      v19 = 1.0 / sinf(v18);
    this->m_fOOSinTheta = v19;
  }
  return v6;
}
// 38AD64: masking with 0x1 was optimized away because r8.1 <= 0x1
// 38AD26: variable 'v1' is possibly undefined
// 38AD26: variable 'v2' is possibly undefined

//----- (0038AD78) --------------------------------------------------------
void __fastcall CAnimBlendNode::CalcDeltas(CAnimBlendNode *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d8
  CAnimBlendSequence *m_pSequence; // r0
  uint16 m_bitsFlag; // r1
  int m_iPreviousFrame; // r3
  bool v7; // zf
  int m_iCurrentFrame; // r2
  uint8 *m_pKeyFrames; // r0
  int v10; // r1
  int v11; // r3
  float v12; // r0
  float v13; // s0

  m_pSequence = this->m_pSequence;
  m_bitsFlag = m_pSequence->m_bitsFlag;
  if ( (m_bitsFlag & 1) != 0 )
  {
    m_iPreviousFrame = this->m_iPreviousFrame;
    v7 = (m_bitsFlag & 2) == 0;
    m_iCurrentFrame = this->m_iCurrentFrame;
    v2.n64_u32[0] = 1.0;
    m_pKeyFrames = m_pSequence->m_pKeyFrames;
    v10 = 20 * m_iPreviousFrame;
    if ( !v7 )
      v10 = 32 * m_iPreviousFrame;
    v11 = 20 * m_iCurrentFrame;
    if ( !v7 )
      v11 = 32 * m_iCurrentFrame;
    v1.n64_f32[0] = (float)((float)((float)(*(float *)&m_pKeyFrames[v10] * *(float *)&m_pKeyFrames[v11])
                                  + (float)(*(float *)&m_pKeyFrames[v10 + 4] * *(float *)&m_pKeyFrames[v11 + 4]))
                          + (float)(*(float *)&m_pKeyFrames[v10 + 8] * *(float *)&m_pKeyFrames[v11 + 8]))
                  + (float)(*(float *)&m_pKeyFrames[v10 + 12] * *(float *)&m_pKeyFrames[v11 + 12]);
    v12 = acosf(vmin_f32(v1, v2).n64_f32[0]);
    this->m_fTheta = v12;
    if ( v12 == 0.0 )
      v13 = 0.0;
    else
      v13 = 1.0 / sinf(v12);
    this->m_fOOSinTheta = v13;
  }
}
// 38ADF6: variable 'v1' is possibly undefined
// 38ADF6: variable 'v2' is possibly undefined

//----- (0038AE34) --------------------------------------------------------
void __fastcall CAnimBlendNode::GetCurrentTranslation(CAnimBlendNode *this, CVector *translation, float partialScale)
{
  CAnimBlendAssociation *m_pAssociation; // r3
  float m_fBlendAmount; // s0
  CAnimBlendSequence *m_pSequence; // r2
  int m_iPreviousFrame; // r4
  int m_iCurrentFrame; // r3
  uint8 *m_pKeyFrames; // r12
  int v9; // lr
  int v10; // r2
  int v11; // r4
  float *v12; // r3
  float v13; // s2
  float v14; // s2
  RwReal v15; // s4
  RwReal v16; // s6
  RwReal v17; // s0

  translation->x = 0.0;
  translation->y = 0.0;
  translation->z = 0.0;
  m_pAssociation = this->m_pAssociation;
  m_fBlendAmount = m_pAssociation->m_fBlendAmount * partialScale;
  if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
    m_fBlendAmount = m_pAssociation->m_fBlendAmount;
  if ( m_fBlendAmount > 0.0 )
  {
    m_pSequence = this->m_pSequence;
    m_iPreviousFrame = this->m_iPreviousFrame;
    m_iCurrentFrame = this->m_iCurrentFrame;
    m_pKeyFrames = m_pSequence->m_pKeyFrames;
    v9 = m_pSequence->m_bitsFlag & 2;
    v10 = 20 * m_iPreviousFrame;
    if ( v9 )
      v10 = 32 * m_iPreviousFrame;
    v11 = 20 * m_iCurrentFrame;
    if ( v9 )
      v11 = 32 * m_iCurrentFrame;
    v12 = (float *)&m_pKeyFrames[v11];
    v13 = *(float *)&m_pKeyFrames[v11 + 16];
    if ( v13 == 0.0 )
      v14 = 0.0;
    else
      v14 = (float)(v13 - this->m_fTimeRemaining) / v13;
    if ( v9 )
    {
      v15 = m_fBlendAmount
          * (float)(*(float *)&m_pKeyFrames[v10 + 20]
                  + (float)(v14 * (float)(v12[5] - *(float *)&m_pKeyFrames[v10 + 20])));
      v16 = m_fBlendAmount
          * (float)(*(float *)&m_pKeyFrames[v10 + 24]
                  + (float)(v14 * (float)(v12[6] - *(float *)&m_pKeyFrames[v10 + 24])));
      v17 = m_fBlendAmount
          * (float)(*(float *)&m_pKeyFrames[v10 + 28]
                  + (float)(v14 * (float)(v12[7] - *(float *)&m_pKeyFrames[v10 + 28])));
      translation->x = v15;
      translation->y = v16;
      translation->z = v17;
    }
  }
}

//----- (0038AF20) --------------------------------------------------------
void __fastcall CAnimBlendNode::GetEndTranslation(CAnimBlendNode *this, CVector *translation, float partialScale)
{
  CAnimBlendAssociation *m_pAssociation; // r3
  float m_fBlendAmount; // s0
  CAnimBlendSequence *m_pSequence; // r0
  int v6; // r0
  RwReal v7; // s2
  RwReal v8; // s4
  RwReal v9; // s0

  translation->x = 0.0;
  translation->y = 0.0;
  translation->z = 0.0;
  m_pAssociation = this->m_pAssociation;
  m_fBlendAmount = m_pAssociation->m_fBlendAmount * partialScale;
  if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
    m_fBlendAmount = m_pAssociation->m_fBlendAmount;
  if ( m_fBlendAmount > 0.0 )
  {
    m_pSequence = this->m_pSequence;
    if ( (m_pSequence->m_bitsFlag & 2) != 0 )
    {
      v6 = (int)&m_pSequence->m_pKeyFrames[32 * m_pSequence->m_iNumKeyFrames];
      v7 = m_fBlendAmount * *(float *)(v6 - 12);
      v8 = m_fBlendAmount * *(float *)(v6 - 8);
      v9 = m_fBlendAmount * *(float *)(v6 - 4);
      translation->x = v7;
      translation->y = v8;
      translation->z = v9;
    }
  }
}

//----- (0038AF88) --------------------------------------------------------
bool __fastcall CAnimBlendNode::FindKeyFrame(CAnimBlendNode *this, float fCurrentTime)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d8
  bool result; // r0
  CAnimBlendSequence *m_pSequence; // r12
  float *m_pKeyFrames; // r0
  float v8; // s4
  float v9; // s2
  int16 v10; // r0
  int v12; // r1
  unsigned int m_bitsFlag; // r4
  uint8 *v14; // r3
  int v15; // lr
  float *v16; // r6
  float v17; // s2
  int16 v18; // r1
  int v19; // r2
  int v20; // r6
  uint16 v21; // r2
  bool v22; // zf
  uint8 *v23; // r3
  int v24; // r2
  int v25; // r1
  float v26; // r0
  float v27; // s0
  int v28; // r0
  int v29; // r1
  float v30; // r0
  float v31; // s0

  result = 0;
  m_pSequence = this->m_pSequence;
  if ( m_pSequence->m_iNumKeyFrames < 1 )
    return result;
  *(_DWORD *)&this->m_iCurrentFrame = 0;
  if ( m_pSequence->m_iNumKeyFrames == 1 )
  {
    this->m_fTimeRemaining = 0.0;
    if ( !(LOBYTE(m_pSequence->m_bitsFlag) << 31) )
      return 1;
    m_pKeyFrames = (float *)m_pSequence->m_pKeyFrames;
    v3.n64_u32[0] = 1.0;
    v8 = m_pKeyFrames[2] * m_pKeyFrames[2];
    v2.n64_f32[0] = (float)(*m_pKeyFrames * *m_pKeyFrames) + (float)(m_pKeyFrames[1] * m_pKeyFrames[1]);
    v9 = m_pKeyFrames[3] * m_pKeyFrames[3];
LABEL_23:
    v2.n64_f32[0] = (float)(v2.n64_f32[0] + v8) + v9;
    v26 = acosf(vmin_f32(v2, v3).n64_f32[0]);
    this->m_fTheta = v26;
    if ( v26 == 0.0 )
      v27 = 0.0;
    else
      v27 = v3.n64_f32[0] / sinf(v26);
    this->m_fOOSinTheta = v27;
    return 1;
  }
  v10 = 1;
  this->m_iCurrentFrame = 1;
  v12 = 20;
  m_bitsFlag = m_pSequence->m_bitsFlag;
  v14 = m_pSequence->m_pKeyFrames;
  if ( (m_bitsFlag & 2) != 0 )
    v12 = 32;
  v15 = (m_bitsFlag >> 1) & 1;
  v16 = (float *)&v14[v12];
  v17 = *(float *)&v14[v12 + 16];
  if ( v17 >= fCurrentTime )
  {
    v18 = 0;
LABEL_17:
    this->m_fTimeRemaining = v17 - fCurrentTime;
    v21 = m_pSequence->m_bitsFlag;
    if ( (v21 & 1) == 0 )
      return 1;
    v22 = (v21 & 2) == 0;
    v23 = m_pSequence->m_pKeyFrames;
    v3.n64_u32[0] = 1.0;
    v24 = 20 * v18;
    if ( !v22 )
      v24 = 32 * v18;
    v25 = 20 * v10;
    if ( !v22 )
      v25 = 32 * v10;
    v8 = *(float *)&v23[v24 + 8] * *(float *)&v23[v25 + 8];
    v2.n64_f32[0] = (float)(*(float *)&v23[v24] * *(float *)&v23[v25])
                  + (float)(*(float *)&v23[v24 + 4] * *(float *)&v23[v25 + 4]);
    v9 = *(float *)&v23[v24 + 12] * *(float *)&v23[v25 + 12];
    goto LABEL_23;
  }
  v10 = 1;
  v18 = 0;
  v19 = 1;
  while ( v19 + 1 < m_pSequence->m_iNumKeyFrames )
  {
LABEL_12:
    v18 = v10++;
    this->m_iCurrentFrame = v10;
    fCurrentTime = fCurrentTime - v17;
    this->m_iPreviousFrame = v18;
    v19 = v10;
    m_bitsFlag = m_pSequence->m_bitsFlag;
    v14 = m_pSequence->m_pKeyFrames;
    v20 = 20 * v10;
    if ( (m_bitsFlag & 2) != 0 )
      v20 = 32 * v10;
    v16 = (float *)&v14[v20];
    v17 = v16[4];
    v15 = (m_bitsFlag >> 1) & 1;
    if ( fCurrentTime <= v17 )
      goto LABEL_17;
  }
  if ( (this->m_pAssociation->m_bitsFlag & 2) != 0 )
  {
    v10 = 0;
    this->m_iCurrentFrame = 0;
    goto LABEL_12;
  }
  if ( m_bitsFlag << 31 )
  {
    v28 = v18;
    v3.n64_u32[0] = 1.0;
    v29 = 20 * v18;
    if ( v15 << 31 )
      v29 = 32 * v28;
    v2.n64_f32[0] = (float)((float)((float)(*(float *)&v14[v29] * *v16) + (float)(*(float *)&v14[v29 + 4] * v16[1]))
                          + (float)(*(float *)&v14[v29 + 8] * v16[2]))
                  + (float)(*(float *)&v14[v29 + 12] * v16[3]);
    v30 = acosf(vmin_f32(v2, v3).n64_f32[0]);
    this->m_fTheta = v30;
    if ( v30 == 0.0 )
      v31 = 0.0;
    else
      v31 = 1.0 / sinf(v30);
    this->m_fOOSinTheta = v31;
  }
  result = 0;
  this->m_fTimeRemaining = 0.0;
  return result;
}
// 38B0FE: variable 'v2' is possibly undefined
// 38B0FE: variable 'v3' is possibly undefined

//----- (0038B1D8) --------------------------------------------------------
bool __fastcall CAnimBlendNode::UpdateCompressed(
        CAnimBlendNode *this,
        CVector *translation,
        CQuaternion *rotation,
        float partialScale)
{
  bool KeyFrameCompressed; // r6
  CAnimBlendAssociation *m_pAssociation; // r0
  float v10; // s0
  float m_fBlendAmount; // s16
  CAnimBlendSequence *m_pSequence; // r0
  int m_iPreviousFrame; // r3
  int m_iCurrentFrame; // r1
  int m_bitsFlag; // r9
  uint8 *m_pKeyFrames; // r0
  int v17; // r2
  int16x4_t *v18; // r12
  int v19; // r3
  int16x4_t *v20; // r3
  float v21; // s0
  float v22; // s2
  float v23; // s6
  float v24; // s10
  RwReal v25; // s2
  RwReal v26; // s4
  RwReal v27; // s6
  float32x4_t v28; // q10
  CQuaternion v29; // q8
  CQuaternion quatEnd; // [sp+20h] [bp-48h] BYREF
  CQuaternion quatStart; // [sp+30h] [bp-38h] BYREF

  KeyFrameCompressed = 0;
  translation->x = 0.0;
  translation->y = 0.0;
  translation->z = 0.0;
  *(_QWORD *)&rotation->x = 0LL;
  *(_QWORD *)&rotation->z = 0LL;
  m_pAssociation = this->m_pAssociation;
  if ( LOBYTE(m_pAssociation->m_bitsFlag) << 31 )
  {
    v10 = this->m_fTimeRemaining - m_pAssociation->m_fTimeStep;
    this->m_fTimeRemaining = v10;
    if ( v10 <= 0.0 )
    {
      KeyFrameCompressed = CAnimBlendNode::NextKeyFrameCompressed(this);
      m_pAssociation = this->m_pAssociation;
    }
    else
    {
      KeyFrameCompressed = 0;
    }
  }
  m_fBlendAmount = m_pAssociation->m_fBlendAmount * partialScale;
  if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
    m_fBlendAmount = m_pAssociation->m_fBlendAmount;
  if ( m_fBlendAmount > 0.0 )
  {
    m_pSequence = this->m_pSequence;
    m_iPreviousFrame = this->m_iPreviousFrame;
    m_iCurrentFrame = this->m_iCurrentFrame;
    m_bitsFlag = m_pSequence->m_bitsFlag;
    m_pKeyFrames = m_pSequence->m_pKeyFrames;
    v17 = 10 * m_iPreviousFrame;
    if ( (m_bitsFlag & 2) != 0 )
      v17 = 16 * m_iPreviousFrame;
    v18 = (int16x4_t *)&m_pKeyFrames[v17];
    v19 = 10 * m_iCurrentFrame;
    if ( (m_bitsFlag & 2) != 0 )
      v19 = 16 * m_iCurrentFrame;
    v20 = (int16x4_t *)&m_pKeyFrames[v19];
    if ( v20[1].n64_u16[0] )
    {
      v21 = (float)((float)((float)v20[1].n64_i16[0] * 0.016667) - this->m_fTimeRemaining)
          / (float)((float)v20[1].n64_i16[0] * 0.016667);
      if ( (m_bitsFlag & 2) == 0 )
        goto LABEL_15;
    }
    else
    {
      v21 = 0.0;
      if ( (m_bitsFlag & 2) == 0 )
      {
LABEL_15:
        if ( m_bitsFlag << 31 )
        {
          v28 = vdupq_n_s32(0x39800000u);
          v29 = (CQuaternion)vmulq_f32(vcvtq_f32_s32(vmovl_s16((int16x4_t)v20->n64_u64[0])), v28);
          quatStart = (CQuaternion)vmulq_f32(vcvtq_f32_s32(vmovl_s16((int16x4_t)v18->n64_u64[0])), v28);
          quatEnd = v29;
          CQuaternion::Slerp(rotation, &quatStart, &quatEnd, this->m_fTheta, this->m_fOOSinTheta, v21);
          *(float32x4_t *)rotation = vmulq_n_f32(*(float32x4_t *)rotation, m_fBlendAmount);
        }
        return KeyFrameCompressed;
      }
    }
    v22 = (float)v18[1].n64_i16[2] * 0.00097656;
    v23 = (float)v18[1].n64_i16[1] * 0.00097656;
    v24 = (float)v18[1].n64_i16[3] * 0.00097656;
    v25 = m_fBlendAmount * (float)(v22 + (float)(v21 * (float)((float)((float)v20[1].n64_i16[2] * 0.00097656) - v22)));
    v26 = m_fBlendAmount * (float)(v23 + (float)(v21 * (float)((float)((float)v20[1].n64_i16[1] * 0.00097656) - v23)));
    v27 = m_fBlendAmount * (float)(v24 + (float)(v21 * (float)((float)((float)v20[1].n64_i16[3] * 0.00097656) - v24)));
    translation->x = v26;
    translation->y = v25;
    translation->z = v27;
    m_bitsFlag = this->m_pSequence->m_bitsFlag;
    goto LABEL_15;
  }
  return KeyFrameCompressed;
}

//----- (0038B3FC) --------------------------------------------------------
bool __fastcall CAnimBlendNode::NextKeyFrameCompressed(CAnimBlendNode *this)
{
  CAnimBlendSequence *m_pSequence; // r2
  int16 m_iNumKeyFrames; // r12
  bool v3; // r8
  float m_fTimeRemaining; // s0
  int v5; // r4
  int16 v6; // r1
  int v7; // r6
  int16 v8; // r1

  m_pSequence = this->m_pSequence;
  m_iNumKeyFrames = m_pSequence->m_iNumKeyFrames;
  if ( m_iNumKeyFrames < 2 )
    return 0;
  m_fTimeRemaining = this->m_fTimeRemaining;
  v3 = 0;
  LOWORD(v5) = this->m_iCurrentFrame;
  this->m_iPreviousFrame = v5;
  if ( m_fTimeRemaining <= 0.0 )
  {
    v6 = v5;
    do
    {
      this->m_iCurrentFrame = v6 + 1;
      v5 = (__int16)(v6 + 1);
      if ( m_iNumKeyFrames <= v5 )
      {
        if ( (this->m_pAssociation->m_bitsFlag & 2) == 0 )
        {
          v3 = 0;
          this->m_fTimeRemaining = 0.0;
          this->m_iCurrentFrame = v6;
          return v3;
        }
        v5 = 0;
        v3 = 1;
        this->m_iCurrentFrame = 0;
      }
      v7 = 10 * v5;
      if ( (m_pSequence->m_bitsFlag & 2) != 0 )
        v7 = 16 * v5;
      v6 = v5;
      m_fTimeRemaining = m_fTimeRemaining + (float)((float)*(__int16 *)&m_pSequence->m_pKeyFrames[v7 + 8] * 0.016667);
      this->m_fTimeRemaining = m_fTimeRemaining;
    }
    while ( m_fTimeRemaining <= 0.0 );
  }
  v8 = v5 - 1;
  if ( (__int16)(v5 - 1) < 0 )
    v8 = v5 - 1 + m_iNumKeyFrames;
  this->m_iPreviousFrame = v8;
  CAnimBlendNode::CalcDeltasCompressed(this);
  return v3;
}
// 38B4A0: masking with 0x1 was optimized away because r8.1 <= 0x1

//----- (0038B4BC) --------------------------------------------------------
void __fastcall CAnimBlendNode::CalcDeltasCompressed(CAnimBlendNode *this)
{
  float32x2_t v1; // d8
  CAnimBlendSequence *m_pSequence; // r0
  uint16 m_bitsFlag; // r1
  int m_iPreviousFrame; // r3
  bool v6; // zf
  int m_iCurrentFrame; // r2
  uint8 *m_pKeyFrames; // r0
  int v9; // r1
  int v10; // r4
  __int16 *v11; // r1
  int v12; // r3
  unsigned __int32 v13; // r2
  uint8 *v14; // r0
  float v15; // s2
  float32x4_t v16; // q1
  float v17; // s8
  float v18; // s10
  float32x2_t v19; // d0
  float v20; // s14
  float v21; // s1
  float v22; // s3
  float v23; // s12
  float v24; // r0
  float v25; // s0
  int16x4_t v26; // [sp+0h] [bp-20h]

  m_pSequence = this->m_pSequence;
  m_bitsFlag = m_pSequence->m_bitsFlag;
  if ( (m_bitsFlag & 1) != 0 )
  {
    m_iPreviousFrame = this->m_iPreviousFrame;
    v6 = (m_bitsFlag & 2) == 0;
    m_iCurrentFrame = this->m_iCurrentFrame;
    m_pKeyFrames = m_pSequence->m_pKeyFrames;
    v9 = 10 * m_iPreviousFrame;
    if ( !v6 )
      v9 = 16 * m_iPreviousFrame;
    v10 = *(__int16 *)&m_pKeyFrames[v9];
    v11 = (__int16 *)&m_pKeyFrames[v9];
    v12 = 10 * m_iCurrentFrame;
    if ( !v6 )
      v12 = 16 * m_iCurrentFrame;
    v13 = *(_DWORD *)&m_pKeyFrames[v12];
    v14 = &m_pKeyFrames[v12];
    v26.n64_u32[0] = v13;
    v26.n64_u32[1] = *((_DWORD *)v14 + 1);
    v19.n64_f32[0] = (float)v10 * 0.00024414;
    v15 = (float)v11[1] * 0.00024414;
    v16 = vmulq_f32(vcvtq_f32_s32(vmovl_s16(v26)), vdupq_n_s32(0x39800000u));
    v17 = (float)v11[2] * 0.00024414;
    v18 = (float)v11[3] * 0.00024414;
    v19.n64_f32[1] = v18 * v16.n128_f32[3];
    if ( (float)((float)((float)((float)(v19.n64_f32[0] * v16.n128_f32[0]) + (float)(v15 * v16.n128_f32[1]))
                       + (float)(v17 * v16.n128_f32[2]))
               + (float)(v18 * v16.n128_f32[3])) < 0.0 )
    {
      v20 = v16.n128_f32[1] * -4096.0;
      v21 = v16.n128_f32[2] * -4096.0;
      v22 = v16.n128_f32[3] * -4096.0;
      v23 = v16.n128_f32[0] * -4096.0;
      v16 = vnegq_f32(v16);
      v19.n64_u32[1] = (int)v21;
      *((_WORD *)v14 + 1) = (int)v20;
      *(_WORD *)v14 = (int)v23;
      *((_WORD *)v14 + 2) = v19.n64_u16[2];
      *((_WORD *)v14 + 3) = (int)v22;
    }
    v1.n64_u32[0] = 1.0;
    v19.n64_f32[0] = (float)((float)((float)(v19.n64_f32[0] * v16.n128_f32[0]) + (float)(v15 * v16.n128_f32[1]))
                           + (float)(v17 * v16.n128_f32[2]))
                   + (float)(v18 * v16.n128_f32[3]);
    v24 = acosf(vmin_f32(v19, v1).n64_f32[0]);
    this->m_fTheta = v24;
    if ( v24 == 0.0 )
      v25 = 0.0;
    else
      v25 = 1.0 / sinf(v24);
    this->m_fOOSinTheta = v25;
  }
}
// 38B5EE: variable 'v1' is possibly undefined

//----- (0038B63C) --------------------------------------------------------
bool __fastcall CAnimBlendNode::SetupKeyFrameCompressed(CAnimBlendNode *this)
{
  CAnimBlendSequence *m_pSequence; // r1
  uint16 m_bitsFlag; // r2
  int v4; // r3
  uint8 *m_pKeyFrames; // r1

  m_pSequence = this->m_pSequence;
  if ( m_pSequence->m_iNumKeyFrames < 1 )
    return 0;
  *(_DWORD *)&this->m_iCurrentFrame = 1;
  if ( m_pSequence->m_iNumKeyFrames == 1 )
  {
    this->m_fTimeRemaining = 0.0;
    this->m_iCurrentFrame = 0;
  }
  else
  {
    m_bitsFlag = m_pSequence->m_bitsFlag;
    v4 = 10;
    m_pKeyFrames = m_pSequence->m_pKeyFrames;
    if ( (m_bitsFlag & 2) != 0 )
      v4 = 16;
    this->m_fTimeRemaining = (float)*(__int16 *)&m_pKeyFrames[v4 + 8] * 0.016667;
  }
  CAnimBlendNode::CalcDeltasCompressed(this);
  return 1;
}

//----- (0038B694) --------------------------------------------------------
void __fastcall CAnimBlendNode::GetCurrentTranslationCompressed(
        CAnimBlendNode *this,
        CVector *translation,
        float partialScale)
{
  CAnimBlendAssociation *m_pAssociation; // r3
  float m_fBlendAmount; // s0
  CAnimBlendSequence *m_pSequence; // r12
  int m_iCurrentFrame; // r2
  int m_iPreviousFrame; // lr
  int v8; // r3
  int v9; // r2
  uint8 *m_pKeyFrames; // r4
  __int16 *v11; // r3
  __int16 *v12; // r12
  float v13; // s2
  float v14; // s8
  float v15; // s12
  RwReal v16; // s4
  RwReal v17; // s6
  RwReal v18; // s0

  translation->x = 0.0;
  translation->y = 0.0;
  translation->z = 0.0;
  m_pAssociation = this->m_pAssociation;
  m_fBlendAmount = m_pAssociation->m_fBlendAmount * partialScale;
  if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
    m_fBlendAmount = m_pAssociation->m_fBlendAmount;
  if ( m_fBlendAmount > 0.0 )
  {
    m_pSequence = this->m_pSequence;
    m_iCurrentFrame = this->m_iCurrentFrame;
    m_iPreviousFrame = this->m_iPreviousFrame;
    v8 = 10 * m_iCurrentFrame;
    if ( (m_pSequence->m_bitsFlag & 2) != 0 )
      v8 = 16 * m_iCurrentFrame;
    v9 = 10 * m_iPreviousFrame;
    if ( (m_pSequence->m_bitsFlag & 2) != 0 )
      v9 = 16 * m_iPreviousFrame;
    if ( (m_pSequence->m_bitsFlag & 2) != 0 )
    {
      m_pKeyFrames = m_pSequence->m_pKeyFrames;
      v11 = (__int16 *)&m_pKeyFrames[v8];
      v12 = (__int16 *)&m_pKeyFrames[v9];
      if ( v11[4] )
        v13 = (float)((float)((float)v11[4] * 0.016667) - this->m_fTimeRemaining) / (float)((float)v11[4] * 0.016667);
      else
        v13 = 0.0;
      v14 = (float)v12[5] * 0.00097656;
      v15 = (float)v12[7] * 0.00097656;
      v16 = m_fBlendAmount
          * (float)((float)((float)v12[6] * 0.00097656)
                  + (float)(v13 * (float)((float)((float)v11[6] * 0.00097656) - (float)((float)v12[6] * 0.00097656))));
      v17 = m_fBlendAmount * (float)(v14 + (float)(v13 * (float)((float)((float)v11[5] * 0.00097656) - v14)));
      v18 = m_fBlendAmount * (float)(v15 + (float)(v13 * (float)((float)((float)v11[7] * 0.00097656) - v15)));
      translation->x = v17;
      translation->y = v16;
      translation->z = v18;
    }
  }
}

//----- (0038B7DC) --------------------------------------------------------
void __fastcall CAnimBlendNode::GetEndTranslationCompressed(
        CAnimBlendNode *this,
        CVector *translation,
        float partialScale)
{
  CAnimBlendAssociation *m_pAssociation; // r3
  float m_fBlendAmount; // s0
  CAnimBlendSequence *m_pSequence; // r0
  int v6; // r0
  RwReal v7; // s2
  RwReal v8; // s6
  float v9; // s8

  translation->x = 0.0;
  translation->y = 0.0;
  translation->z = 0.0;
  m_pAssociation = this->m_pAssociation;
  m_fBlendAmount = m_pAssociation->m_fBlendAmount * partialScale;
  if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
    m_fBlendAmount = m_pAssociation->m_fBlendAmount;
  if ( m_fBlendAmount > 0.0 )
  {
    m_pSequence = this->m_pSequence;
    if ( (m_pSequence->m_bitsFlag & 2) != 0 )
    {
      v6 = (int)&m_pSequence->m_pKeyFrames[16 * m_pSequence->m_iNumKeyFrames];
      v7 = (float)*(__int16 *)(v6 - 6) * 0.00097656;
      translation->x = v7;
      v8 = (float)*(__int16 *)(v6 - 4) * 0.00097656;
      translation->y = v8;
      v9 = (float)*(__int16 *)(v6 - 2);
      translation->x = m_fBlendAmount * v7;
      translation->y = m_fBlendAmount * v8;
      translation->z = m_fBlendAmount * (float)(v9 * 0.00097656);
    }
  }
}

//----- (0038B878) --------------------------------------------------------
void __fastcall CAnimBlendSequence::CAnimBlendSequence(CAnimBlendSequence *this)
{
  *(_DWORD *)&this->m_bitsFlag = 0;
  this->m_pKeyFrames = 0;
  this->_anon_0.m_boneTag = -1;
}

//----- (0038B886) --------------------------------------------------------
void __fastcall CAnimBlendSequence::~CAnimBlendSequence(CAnimBlendSequence *this)
{
  uint8 *m_pKeyFrames; // r0

  if ( (this->m_bitsFlag & 8) == 0 )
  {
    m_pKeyFrames = this->m_pKeyFrames;
    if ( m_pKeyFrames )
      CMemoryMgr::Free(m_pKeyFrames);
  }
}

//----- (0038B8A0) --------------------------------------------------------
void __fastcall CAnimBlendSequence::SetName(CAnimBlendSequence *this, const unsigned __int8 *pName)
{
  this->_anon_0.m_nameHashKey = CKeyGen::GetUppercaseKey(pName);
}

//----- (0038B8B0) --------------------------------------------------------
void __fastcall CAnimBlendSequence::SetBoneTag(CAnimBlendSequence *this, int32 tag)
{
  uint16 m_bitsFlag; // r2

  if ( tag != -1 )
  {
    m_bitsFlag = this->m_bitsFlag;
    this->_anon_0.m_boneTag = tag;
    this->m_bitsFlag = m_bitsFlag | 0x10;
  }
}

//----- (0038B8C0) --------------------------------------------------------
uint32 __fastcall CAnimBlendSequence::GetDataSize(CAnimBlendSequence *this, bool bAsCompressed)
{
  uint16 m_bitsFlag; // r2
  int m_iNumKeyFrames; // r0
  int v4; // r2

  m_bitsFlag = this->m_bitsFlag;
  m_iNumKeyFrames = this->m_iNumKeyFrames;
  v4 = m_bitsFlag & 2;
  if ( bAsCompressed )
  {
    if ( v4 )
      return 16 * m_iNumKeyFrames;
    else
      return 10 * m_iNumKeyFrames;
  }
  else if ( v4 )
  {
    return 32 * m_iNumKeyFrames;
  }
  else
  {
    return 20 * m_iNumKeyFrames;
  }
}

//----- (0038B8EC) --------------------------------------------------------
void __fastcall CAnimBlendSequence::SetNumFrames(
        CAnimBlendSequence *this,
        int32 iNumKeyFrames,
        int bHasTranslation,
        int bCompressed,
        uint8 *pKeyMem)
{
  uint8 *v7; // r0
  uint16 m_bitsFlag; // r1
  int v10; // r0

  v7 = pKeyMem;
  m_bitsFlag = this->m_bitsFlag;
  if ( bHasTranslation == 1 )
  {
    this->m_bitsFlag = m_bitsFlag | 3;
    if ( pKeyMem )
      goto LABEL_10;
    v10 = 32;
    if ( bCompressed )
      v10 = 16;
  }
  else
  {
    this->m_bitsFlag = m_bitsFlag | 1;
    if ( pKeyMem )
      goto LABEL_10;
    v10 = 20;
    if ( bCompressed )
      v10 = 10;
  }
  v7 = (uint8 *)CMemoryMgr::Malloc(v10 * iNumKeyFrames);
LABEL_10:
  this->m_iNumKeyFrames = iNumKeyFrames;
  this->m_pKeyFrames = v7;
  if ( bCompressed == 1 )
    this->m_bitsFlag |= 4u;
}

//----- (0038B944) --------------------------------------------------------
void __fastcall CAnimBlendSequence::RemoveQuaternionFlips(CAnimBlendSequence *this)
{
  int m_iNumKeyFrames; // r12
  float *m_pKeyFrames; // r1
  int v3; // lr
  int v4; // r2
  int v5; // r3
  float v6; // s0
  float v7; // s2
  float v8; // s4
  float v9; // s6
  int v10; // r4
  float *v11; // r1
  float v12; // s12
  float v13; // s14
  float v14; // s10
  float v15; // s8

  m_iNumKeyFrames = this->m_iNumKeyFrames;
  if ( m_iNumKeyFrames >= 2 )
  {
    m_pKeyFrames = (float *)this->m_pKeyFrames;
    v3 = 2;
    v4 = 32;
    v5 = 20;
    v6 = *m_pKeyFrames;
    v7 = m_pKeyFrames[1];
    v8 = m_pKeyFrames[2];
    v9 = m_pKeyFrames[3];
    while ( 1 )
    {
      v10 = v5;
      if ( (this->m_bitsFlag & 2) != 0 )
        v10 = v4;
      v11 = (float *)((char *)m_pKeyFrames + v10);
      v12 = *v11;
      v13 = v11[1];
      v14 = v11[2];
      v15 = v11[3];
      if ( (float)((float)((float)((float)(v6 * *v11) + (float)(v7 * v13)) + (float)(v8 * v14)) + (float)(v9 * v15)) >= 0.0 )
      {
        v6 = *v11;
        v7 = v11[1];
        v8 = v11[2];
        v9 = v11[3];
      }
      else
      {
        v6 = -v12;
        v7 = -v13;
        v8 = -v14;
        v9 = -v15;
        *v11 = -v12;
        v11[1] = -v13;
        v11[2] = -v14;
        v11[3] = -v15;
        LOWORD(m_iNumKeyFrames) = this->m_iNumKeyFrames;
      }
      if ( v3 >= (__int16)m_iNumKeyFrames )
        break;
      v5 += 20;
      v4 += 32;
      m_pKeyFrames = (float *)this->m_pKeyFrames;
      ++v3;
    }
  }
}

//----- (0038BA00) --------------------------------------------------------
void __fastcall CAnimBlendSequence::Uncompress(CAnimBlendSequence *this, uint8 *pDataBlock)
{
  int m_iNumKeyFrames; // r1
  int16 v5; // r0
  uint8 *v6; // r6
  float *v7; // r0
  int v8; // r2
  uint8 *v9; // r1
  int v10; // r3
  float *v11; // r0
  int v12; // r2
  __int16 *v13; // r1
  int v14; // r3
  uint16 m_bitsFlag; // r0
  __int16 v16; // r1

  m_iNumKeyFrames = this->m_iNumKeyFrames;
  v5 = m_iNumKeyFrames;
  if ( (_WORD)m_iNumKeyFrames )
  {
    if ( (this->m_bitsFlag & 2) != 0 )
    {
      v6 = pDataBlock;
      if ( !pDataBlock )
      {
        v6 = (uint8 *)CMemoryMgr::Malloc(32 * m_iNumKeyFrames);
        v5 = this->m_iNumKeyFrames;
      }
      if ( v5 >= 1 )
      {
        v11 = (float *)(v6 + 16);
        v12 = 0;
        v13 = (__int16 *)(this->m_pKeyFrames + 8);
        do
        {
          ++v12;
          *(v11 - 4) = (float)*(v13 - 4) * 0.00024414;
          *(v11 - 3) = (float)*(v13 - 3) * 0.00024414;
          *(v11 - 2) = (float)*(v13 - 2) * 0.00024414;
          *(v11 - 1) = (float)*(v13 - 1) * 0.00024414;
          *v11 = (float)*v13 * 0.016667;
          v11[1] = (float)v13[1] * 0.00097656;
          v11[2] = (float)v13[2] * 0.00097656;
          v14 = v13[3];
          v13 += 8;
          v11[3] = (float)v14 * 0.00097656;
          v11 += 8;
        }
        while ( v12 < this->m_iNumKeyFrames );
      }
    }
    else
    {
      v6 = pDataBlock;
      if ( !pDataBlock )
      {
        v6 = (uint8 *)CMemoryMgr::Malloc(20 * m_iNumKeyFrames);
        v5 = this->m_iNumKeyFrames;
      }
      if ( v5 >= 1 )
      {
        v7 = (float *)(v6 + 8);
        v8 = 0;
        v9 = this->m_pKeyFrames + 8;
        do
        {
          ++v8;
          *(v7 - 2) = (float)*((__int16 *)v9 - 4) * 0.00024414;
          *(v7 - 1) = (float)*((__int16 *)v9 - 3) * 0.00024414;
          *v7 = (float)*((__int16 *)v9 - 2) * 0.00024414;
          v7[1] = (float)*((__int16 *)v9 - 1) * 0.00024414;
          v10 = *(__int16 *)v9;
          v9 += 10;
          v7[2] = (float)v10 * 0.016667;
          v7 += 5;
        }
        while ( v8 < this->m_iNumKeyFrames );
      }
    }
    if ( (this->m_bitsFlag & 8) == 0 )
      CMemoryMgr::Free(this->m_pKeyFrames);
    this->m_pKeyFrames = v6;
    m_bitsFlag = this->m_bitsFlag;
    v16 = m_bitsFlag | 8;
    if ( !pDataBlock )
      v16 = m_bitsFlag & 0xFFF3;
    this->m_bitsFlag = v16 & 0xFFFB;
  }
}

//----- (0038BBD0) --------------------------------------------------------
void __fastcall CAnimBlendSequence::RemoveUncompressedData(CAnimBlendSequence *this, uint8 *pDataBlock)
{
  if ( this->m_iNumKeyFrames )
    CAnimBlendSequence::CompressKeyframes(this, pDataBlock);
}

//----- (0038BBDC) --------------------------------------------------------
void __fastcall CAnimBlendSequence::CompressKeyframes(CAnimBlendSequence *this, uint8 *pDataBlock)
{
  int m_iNumKeyFrames; // r1
  int16 v5; // r0
  uint8 *v6; // r6
  _WORD *v7; // r0
  float *v8; // r1
  int v9; // r2
  float v10; // s6
  _WORD *v11; // r0
  float *v12; // r1
  int v13; // r2
  float v14; // s8
  uint16 m_bitsFlag; // r0
  __int16 v16; // r1

  m_iNumKeyFrames = this->m_iNumKeyFrames;
  v5 = m_iNumKeyFrames;
  if ( (_WORD)m_iNumKeyFrames )
  {
    if ( (this->m_bitsFlag & 2) != 0 )
    {
      v6 = pDataBlock;
      if ( !pDataBlock )
      {
        v6 = (uint8 *)CMemoryMgr::Malloc(16 * m_iNumKeyFrames);
        v5 = this->m_iNumKeyFrames;
      }
      if ( v5 >= 1 )
      {
        v11 = v6 + 8;
        v12 = (float *)(this->m_pKeyFrames + 16);
        v13 = 0;
        do
        {
          ++v13;
          *(v11 - 4) = (int)(float)(*(v12 - 4) * 4096.0);
          *(v11 - 3) = (int)(float)(*(v12 - 3) * 4096.0);
          *(v11 - 2) = (int)(float)(*(v12 - 2) * 4096.0);
          *(v11 - 1) = (int)(float)(*(v12 - 1) * 4096.0);
          *v11 = (int)(float)((float)(*v12 * 60.0) + 0.5);
          v11[1] = (int)(float)(v12[1] * 1024.0);
          v11[2] = (int)(float)(v12[2] * 1024.0);
          v14 = v12[3];
          v12 += 8;
          v11[3] = (int)(float)(v14 * 1024.0);
          v11 += 8;
        }
        while ( v13 < this->m_iNumKeyFrames );
      }
    }
    else
    {
      v6 = pDataBlock;
      if ( !pDataBlock )
      {
        v6 = (uint8 *)CMemoryMgr::Malloc(10 * m_iNumKeyFrames);
        v5 = this->m_iNumKeyFrames;
      }
      if ( v5 >= 1 )
      {
        v7 = v6 + 4;
        v8 = (float *)(this->m_pKeyFrames + 16);
        v9 = 0;
        do
        {
          ++v9;
          *(v7 - 2) = (int)(float)(*(v8 - 4) * 4096.0);
          *(v7 - 1) = (int)(float)(*(v8 - 3) * 4096.0);
          *v7 = (int)(float)(*(v8 - 2) * 4096.0);
          v7[1] = (int)(float)(*(v8 - 1) * 4096.0);
          v10 = *v8;
          v8 += 5;
          v7[2] = (int)(float)((float)(v10 * 60.0) + 0.5);
          v7 += 5;
        }
        while ( v9 < this->m_iNumKeyFrames );
      }
    }
    if ( (this->m_bitsFlag & 8) == 0 )
      CMemoryMgr::Free(this->m_pKeyFrames);
    this->m_pKeyFrames = v6;
    m_bitsFlag = this->m_bitsFlag;
    v16 = m_bitsFlag | 8;
    if ( !pDataBlock )
      v16 = m_bitsFlag & 0xFFF3;
    this->m_bitsFlag = v16 | 4;
  }
}

//----- (0038BDAC) --------------------------------------------------------
bool __fastcall CAnimBlendSequence::MoveMemory(CAnimBlendSequence *this)
{
  uint8 *m_pKeyFrames; // r0
  uint8 *v3; // r0

  if ( (this->m_bitsFlag & 8) != 0 )
    return 0;
  m_pKeyFrames = this->m_pKeyFrames;
  if ( !m_pKeyFrames )
    return 0;
  v3 = (uint8 *)CMemoryMgr::MoveMemory(m_pKeyFrames);
  if ( v3 == this->m_pKeyFrames )
    return 0;
  this->m_pKeyFrames = v3;
  return 1;
}

//----- (0038BDD4) --------------------------------------------------------
void __fastcall CAnimBlendAssociation::UpdateTimeStep(
        CAnimBlendAssociation *this,
        float fTimeStep,
        float oneOverTotalTime)
{
  uint16 m_bitsFlag; // r3
  float m_fSpeed; // s2

  m_bitsFlag = this->m_bitsFlag;
  if ( (m_bitsFlag & 1) != 0 )
  {
    if ( (m_bitsFlag & 0x20) != 0 )
      m_fSpeed = this->m_pAnimBlendHierarchy->m_fTotalTime * oneOverTotalTime;
    else
      m_fSpeed = this->m_fSpeed;
    this->m_fTimeStep = m_fSpeed * fTimeStep;
  }
}

//----- (0038BE04) --------------------------------------------------------
bool __fastcall CAnimBlendAssociation::UpdateTime(CAnimBlendAssociation *this, float fTimeStep, float oneOverTotalTime)
{
  uint16 m_bitsFlag; // r0
  bool result; // r0
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r1
  float m_fCurrentTime; // s0
  float v8; // s0
  float m_fTotalTime; // s2
  __int64 v10; // kr00_8

  m_bitsFlag = this->m_bitsFlag;
  if ( (m_bitsFlag & 1) == 0 )
    return 1;
  m_pAnimBlendHierarchy = this->m_pAnimBlendHierarchy;
  m_fCurrentTime = this->m_fCurrentTime;
  if ( m_fCurrentTime >= m_pAnimBlendHierarchy->m_fTotalTime )
  {
    this->m_bitsFlag = m_bitsFlag & 0xFFFE;
    return 1;
  }
  else
  {
    v8 = m_fCurrentTime + this->m_fTimeStep;
    this->m_fCurrentTime = v8;
    m_fTotalTime = m_pAnimBlendHierarchy->m_fTotalTime;
    if ( v8 < m_fTotalTime )
      return 1;
    if ( (m_bitsFlag & 2) != 0 )
    {
      result = 1;
      this->m_fCurrentTime = v8 - m_fTotalTime;
    }
    else
    {
      this->m_fCurrentTime = m_fTotalTime;
      if ( (m_bitsFlag & 8) != 0 )
      {
        this->m_fBlendDelta = -4.0;
        this->m_bitsFlag = m_bitsFlag | 4;
      }
      if ( this->m_cbType != ABCB_FINISH )
        return 1;
      v10 = *(_QWORD *)&this->m_cb;
      this->m_cbType = ABCB_NONE;
      ((void (__fastcall *)(CAnimBlendAssociation *, _DWORD))v10)(this, HIDWORD(v10));
      CAnimBlendAssociation::SetFinishCallback(this, CDefaultAnimCallback::DefaultAnimCB, 0);
      return 1;
    }
  }
  return result;
}

//----- (0038BE9C) --------------------------------------------------------
bool __fastcall CAnimBlendAssociation::UpdateBlend(CAnimBlendAssociation *this, float fTimeStep)
{
  float m_fBlendDelta; // s0
  float v4; // s2
  bool v5; // nf
  char m_bitsFlag; // r0

  m_fBlendDelta = this->m_fBlendDelta;
  v4 = this->m_fBlendAmount + (float)(m_fBlendDelta * fTimeStep);
  this->m_fBlendAmount = v4;
  v5 = v4 < 0.0;
  if ( v4 <= 0.0 )
    v5 = m_fBlendDelta < 0.0;
  if ( !v5 )
  {
    if ( v4 > 1.0 )
    {
      this->m_fBlendAmount = 1.0;
      if ( m_fBlendDelta > 0.0 )
      {
        this->m_fBlendDelta = 0.0;
        return 1;
      }
    }
    return 1;
  }
  m_bitsFlag = this->m_bitsFlag;
  this->m_fBlendAmount = 0.0;
  this->m_fBlendDelta = 0.0;
  if ( (m_bitsFlag & 4) == 0 )
    return 1;
  if ( (unsigned int)(this->m_cbType - 1) <= 1 )
  {
    this->m_cb(this, this->m_pCBData);
    if ( this->m_cbType == ABCB_DELETE )
      CAnimBlendAssociation::SetDeleteCallback(this, CDefaultAnimCallback::DefaultAnimCB, 0);
    else
      CAnimBlendAssociation::SetFinishCallback(this, CDefaultAnimCallback::DefaultAnimCB, 0);
  }
  (*((void (__fastcall **)(CAnimBlendAssociation *))this->_vptr$CAnimBlendAssociation + 1))(this);
  return 0;
}

//----- (0038BF50) --------------------------------------------------------
void __fastcall RpAnimBlendClumpUpdateAnimations(RpClump_0 *pClump, float fTimeStep, bool bOnScreen)
{
  RpClump_0 *v3; // r11
  CAnimBlendClumpData *v5; // r0
  ListLink *pNext; // r8
  float v7; // s20
  int v9; // r5
  float v10; // s18
  CAnimBlendAssociation *p_pPrev; // r4
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r0
  CAnimBlendNode *Node; // r0
  int *v14; // r1
  float m_fBlendAmount; // s0
  CAnimBlendClumpData *v16; // r6
  ListLink *i; // r0
  __int16 pNext_high; // r2
  float v19; // s2
  AnimBlendFrameData *m_pFrameDataArray; // r4
  bool v21; // zf
  int v22; // r0
  int *v23; // r6
  int m_numFrames; // r11
  int v25; // r10
  int v26; // r5
  int v27; // r8
  CAnimBlendNode *v28; // r0
  int v29; // t1
  RpAtomic_0 *v30; // r0
  void (*v31)(AnimBlendFrameData *, void *); // r1
  RpAtomic_0 *FirstAtomic; // r0
  void (*v33)(AnimBlendFrameData *, void *); // r1
  AnimBlendFrameData *v34; // r0
  RwInt8 v35; // r1
  ListLink *j; // r4
  __int16 v37; // r0
  ListLink *v38; // r1
  float v39; // s0
  float v40; // s0
  float v41; // s2
  ListLink v42; // kr00_8
  _BOOL4 v43; // [sp+4h] [bp-74h]
  RpClump_0 *v44; // [sp+4h] [bp-74h]
  CAnimBlendClumpData *v45; // [sp+8h] [bp-70h]
  int pData; // [sp+Ch] [bp-6Ch] BYREF
  int v47; // [sp+10h] [bp-68h] BYREF

  v3 = pClump;
  v5 = *(CAnimBlendClumpData **)(&pClump->object.type + ClumpOffset);
  gpAnimBlendClump = v5;
  pNext = v5->m_list.pNext;
  if ( v5->m_list.pNext )
  {
    v7 = 0.0;
    v9 = 0;
    v10 = 0.0;
    v43 = bOnScreen;
    v45 = v5;
    pData = 0;
    do
    {
      while ( 1 )
      {
        p_pPrev = (CAnimBlendAssociation *)&pNext[-1].pPrev;
        pNext = pNext->pNext;
        if ( !CAnimBlendAssociation::UpdateBlend(p_pPrev, fTimeStep) )
          goto LABEL_9;
        m_pAnimBlendHierarchy = p_pPrev->m_pAnimBlendHierarchy;
        if ( !m_pAnimBlendHierarchy->m_pSequences )
          goto LABEL_9;
        CAnimManager::UncompressAnimation(m_pAnimBlendHierarchy);
        if ( v9 <= 10 )
        {
          Node = CAnimBlendAssociation::GetNode(p_pPrev, 0);
          v14 = &pData + v9++;
          v14[1] = (int)Node;
        }
        if ( (p_pPrev->m_bitsFlag & 0x20) != 0 )
          break;
        pData = 1;
LABEL_9:
        if ( !pNext )
          goto LABEL_12;
      }
      m_fBlendAmount = p_pPrev->m_fBlendAmount;
      v7 = v7 + m_fBlendAmount;
      v10 = v10 + (float)((float)(p_pPrev->m_pAnimBlendHierarchy->m_fTotalTime / p_pPrev->m_fSpeed) * m_fBlendAmount);
    }
    while ( pNext );
LABEL_12:
    v16 = v45;
    for ( i = v45->m_list.pNext; i; i = i->pNext )
    {
      pNext_high = HIWORD(i[5].pNext);
      if ( v10 == 0.0 )
      {
        if ( (pNext_high & 1) != 0 )
        {
          if ( (pNext_high & 0x20) != 0 )
            v19 = *(float *)&i[2].pNext[2].pNext;
          else
            v19 = *(float *)&i[4].pNext;
LABEL_22:
          *(float *)&i[4].pPrev = v19 * fTimeStep;
        }
      }
      else if ( (pNext_high & 1) != 0 )
      {
        if ( (pNext_high & 0x20) != 0 )
          v19 = (float)(v7 / v10) * *(float *)&i[2].pNext[2].pNext;
        else
          v19 = *(float *)&i[4].pNext;
        goto LABEL_22;
      }
    }
    *(&pData + v9 + 1) = 0;
    v45->m_pFrameDataArray->Flags |= 0x80u;
    m_pFrameDataArray = v45->m_pFrameDataArray;
    if ( (m_pFrameDataArray->Flags & 0x40) != 0 )
    {
      FirstAtomic = GetFirstAtomic(v3);
      if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
        v33 = FrameUpdateCallBackCompressedSkinned;
      else
        v33 = FrameUpdateCallBackCompressedNonSkinned;
      CAnimBlendClumpData::ForAllFrames(v45, v33, &pData);
    }
    else
    {
      if ( v43 )
      {
        v44 = v3;
        v22 = m_pFrameDataArray->Flags & 0x20;
        v21 = v22 == 0;
        if ( (m_pFrameDataArray->Flags & 0x20) != 0 )
        {
          v22 = v47;
          v21 = v47 == 0;
        }
        if ( !v21 )
        {
          v23 = &v47;
          m_numFrames = v45->_anon_0.m_numFrames;
          do
          {
            if ( m_numFrames >= 1 )
            {
              v25 = *(_DWORD *)(v22 + 20);
              v26 = 0;
              v27 = m_numFrames;
              do
              {
                if ( (m_pFrameDataArray[v26].Flags & 8) == 0 || !gpAnimBlendClump->m_pExtractedVelocity )
                {
                  v28 = (CAnimBlendNode *)(*v23 + v26 * 24);
                  if ( v28->m_pSequence )
                    CAnimBlendNode::FindKeyFrame(v28, *(float *)(v25 + 32));
                }
                --v27;
                ++v26;
              }
              while ( v27 );
            }
            v29 = v23[1];
            ++v23;
            v22 = v29;
          }
          while ( v29 );
        }
        v3 = v44;
        v30 = GetFirstAtomic(v44);
        if ( v30 && j_RpSkinGeometryGetSkin(v30->geometry) )
          v31 = FrameUpdateCallBackSkinned;
        else
          v31 = FrameUpdateCallBackNonSkinned;
        v16 = v45;
        CAnimBlendClumpData::ForAllFrames(v45, v31, &pData);
        v34 = v45->m_pFrameDataArray;
        v35 = v34->Flags & 0xDF;
      }
      else
      {
        CAnimBlendClumpData::ForAllFrames(v45, FrameUpdateCallBackOffscreen, &pData);
        v34 = v45->m_pFrameDataArray;
        v35 = v34->Flags | 0x20;
      }
      v34->Flags = v35;
    }
    for ( j = v16->m_list.pNext; j; j = j->pNext )
    {
      v37 = HIWORD(j[5].pNext);
      if ( (v37 & 1) != 0 )
      {
        v38 = j[2].pNext;
        v39 = *(float *)&j[3].pPrev;
        if ( v39 >= *(float *)&v38[2].pNext )
        {
          HIWORD(j[5].pNext) = v37 & 0xFFFE;
        }
        else
        {
          v40 = v39 + *(float *)&j[4].pPrev;
          *(float *)&j[3].pPrev = v40;
          v41 = *(float *)&v38[2].pNext;
          if ( v40 >= v41 )
          {
            if ( (v37 & 2) != 0 )
            {
              *(float *)&j[3].pPrev = v40 - v41;
            }
            else
            {
              *(float *)&j[3].pPrev = v41;
              if ( (v37 & 8) != 0 )
              {
                j[3].pNext = (ListLink *)-1065353216;
                HIWORD(j[5].pNext) = v37 | 4;
              }
              if ( j[5].pPrev == (ListLink *)((char *)&dword_0 + 1) )
              {
                v42 = j[6];
                j[5].pPrev = 0;
                ((void (__fastcall *)(ListLink **, ListLink *))v42.pNext)(&j[-1].pPrev, v42.pPrev);
                CAnimBlendAssociation::SetFinishCallback(
                  (CAnimBlendAssociation *)&j[-1].pPrev,
                  CDefaultAnimCallback::DefaultAnimCB,
                  0);
              }
            }
          }
        }
      }
    }
    RwFrameUpdateObjects((RwFrame_0 *)v3->object.parent);
  }
}
// 0: using guessed type int dword_0;

//----- (0038C22C) --------------------------------------------------------
void __fastcall FrameUpdateCallBackCompressedSkinned(AnimBlendFrameData *pFrameData, void *pData)
{
  float v2; // s16
  float v3; // s0
  char *v4; // r10
  CAnimBlendNode *v5; // r0
  int *v6; // r2
  int v7; // r3
  int v8; // r3
  int v9; // t1
  CAnimBlendNode **v10; // r6
  float v11; // s20
  float v12; // s18
  float v13; // r5
  CAnimBlendSequence *m_pSequence; // r1
  bool v15; // nf
  int v16; // r1
  CAnimBlendNode *v17; // t1
  float v18; // s26
  CAnimBlendNode *v19; // r1
  float v20; // s22
  float v21; // r4
  float v22; // s28
  float v23; // s21
  unsigned __int64 v24; // r8
  float v25; // s23
  float v26; // s25
  float v27; // s30
  float v28; // s17
  float v29; // s19
  float v30; // s27
  float v31; // s29
  float v32; // s31
  float v33; // s24
  _DWORD *v34; // r11
  _BOOL4 updated; // r1
  CAnimBlendNode *v36; // r0
  RwInt8 Flags; // r0
  float v38; // s0
  float v39; // r0
  float v40; // s16
  float *p_type; // r9
  float v42; // s0
  char *v43; // r5
  CAnimBlendNode *v44; // r0
  CAnimBlendNode **v45; // r1
  CAnimBlendNode *v46; // r2
  CAnimBlendAssociation *m_pAssociation; // r2
  CAnimBlendNode *v48; // t1
  float v49; // s28
  float v50; // s30
  float v51; // r1
  float v52; // s17
  float v53; // r2
  float v54; // s20
  float v55; // r3
  float v56; // s22
  float v57; // s26
  float v58; // s24
  _DWORD *v59; // r4
  CAnimBlendNode *v60; // r6
  RwInt8 v61; // r0
  float v62; // s0
  float v63; // r0
  float v64; // s0
  float v65; // s0
  CAnimBlendClumpData *v66; // r0
  float *m_pExtractedVelocity; // r1
  float *v68; // r0
  float v69; // s2
  float v70; // s4
  RwFrame_0 *pFrame; // [sp+0h] [bp-88h]
  int v73; // [sp+8h] [bp-80h]
  CQuaternion rotation; // [sp+Ch] [bp-7Ch] BYREF
  CVector translation; // [sp+1Ch] [bp-6Ch] BYREF

  if ( (pFrameData->Flags & 8) != 0 && gpAnimBlendClump->m_pExtractedVelocity )
  {
    v2 = 0.0;
    v3 = 0.0;
    pFrame = pFrameData->_anon_1.pFrame;
    v4 = (char *)pData + 4;
    v5 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
    if ( *(_DWORD *)pData )
    {
      v3 = 0.0;
      v6 = (int *)((char *)pData + 8);
      v7 = *((_DWORD *)pData + 1);
      do
      {
        if ( *(_DWORD *)(v7 + 16) )
        {
          v8 = *(_DWORD *)(v7 + 20);
          if ( (*(_BYTE *)(v8 + 46) & 0x10) != 0 )
            v3 = v3 + *(float *)(v8 + 24);
        }
        v9 = *v6++;
        v7 = v9;
      }
      while ( v9 );
    }
    v10 = (CAnimBlendNode **)((char *)pData + 8);
    v11 = 0.0;
    v12 = 0.0;
    v13 = 1.0 - v3;
    do
    {
      m_pSequence = v5->m_pSequence;
      if ( m_pSequence )
      {
        v16 = LOBYTE(m_pSequence->m_bitsFlag) << 30;
        v15 = v16 < 0;
        if ( v16 < 0 )
          v15 = (v5->m_pAssociation->m_bitsFlag & 0x40) != 0;
        if ( v15 )
        {
          CAnimBlendNode::GetCurrentTranslationCompressed(v5, &translation, v13);
          v2 = v2 + translation.x;
          v11 = v11 + translation.y;
          v12 = v12 + translation.z;
        }
      }
      v17 = *v10++;
      v5 = v17;
    }
    while ( v17 );
    v18 = 0.0;
    v19 = *(CAnimBlendNode **)v4;
    v20 = 0.0;
    v21 = 0.0;
    v22 = 0.0;
    v23 = 0.0;
    v24 = 0LL;
    v25 = 0.0;
    v73 = 0;
    v26 = 0.0;
    v27 = 0.0;
    v28 = 0.0;
    v29 = 0.0;
    v30 = 0.0;
    v31 = 0.0;
    v32 = 0.0;
    v33 = 0.0;
    do
    {
      v34 = v4;
      if ( v19->m_pSequence )
      {
        updated = CAnimBlendNode::UpdateCompressed(v19, &translation, &rotation, v13);
        v33 = v33 + rotation.x;
        v32 = v32 + rotation.y;
        v36 = *(CAnimBlendNode **)v4;
        v31 = v31 + rotation.z;
        v30 = v30 + rotation.w;
        v24 = __PAIR64__(LODWORD(v32), LODWORD(v33));
        v21 = v31;
        if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v4 + 16) + 4) & 2) != 0 )
        {
          v29 = v29 + translation.x;
          v28 = v28 + translation.y;
          v27 = v27 + translation.z;
          if ( (v36->m_pAssociation->m_bitsFlag & 0x40) != 0 )
          {
            v18 = v18 + translation.z;
            v20 = v20 + translation.y;
            v22 = v22 + translation.x;
            v73 |= updated;
            if ( updated )
            {
              CAnimBlendNode::GetEndTranslationCompressed(v36, &translation, v13);
              v26 = v26 + translation.x;
              v25 = v25 + translation.y;
              v36 = *(CAnimBlendNode **)v4;
              v23 = v23 + translation.z;
            }
          }
        }
      }
      else
      {
        v36 = v19;
      }
      v4 += 4;
      v19 = (CAnimBlendNode *)v34[1];
      *v34 = v36 + 1;
    }
    while ( v19 );
    Flags = pFrameData->Flags;
    if ( (pFrameData->Flags & 2) == 0 )
    {
      v38 = (float)(v30 * v30) + (float)((float)(v31 * v31) + (float)((float)(v32 * v32) + (float)(v33 * v33)));
      if ( v38 == 0.0 )
      {
        v39 = 1.0;
      }
      else
      {
        v65 = 1.0 / sqrtf(v38);
        v39 = v30 * v65;
        v21 = v31 * v65;
        *((float *)&v24 + 1) = v32 * v65;
        *(float *)&v24 = v33 * v65;
      }
      pFrame->object = (RwObject_0)v24;
      *(float *)&pFrame->inDirtyListLink.next = v21;
      *(float *)&pFrame->inDirtyListLink.prev = v39;
      Flags = pFrameData->Flags;
    }
    if ( (Flags & 4) == 0 )
    {
      v66 = gpAnimBlendClump;
      m_pExtractedVelocity = gpAnimBlendClump->m_pExtractedVelocity;
      *m_pExtractedVelocity = v22 - v2;
      m_pExtractedVelocity[1] = v20 - v11;
      m_pExtractedVelocity[2] = v18 - v12;
      if ( v73 << 31 )
      {
        v68 = v66->m_pExtractedVelocity;
        v69 = v25 + v68[1];
        v70 = v23 + v68[2];
        *v68 = v26 + *v68;
        v68[1] = v69;
        v68[2] = v70;
      }
      pFrame->modelling.right.x = v29 - v22;
      pFrame->modelling.right.y = v28 - v20;
      pFrame->modelling.right.z = v27 - v18;
      pFrame->modelling.right.x = (float)(v29 - v22) + pFrameData->_anon_0.posn.x;
      pFrame->modelling.right.y = (float)(v28 - v20) + pFrameData->_anon_0.posn.y;
      pFrame->modelling.right.z = (float)(v27 - v18) + pFrameData->_anon_0.posn.z;
    }
  }
  else
  {
    v40 = 0.0;
    p_type = (float *)&pFrameData->_anon_1.pFrame->object.type;
    v42 = 0.0;
    v43 = (char *)pData + 4;
    v44 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
    if ( *(_DWORD *)pData )
    {
      v42 = 0.0;
      v45 = (CAnimBlendNode **)((char *)pData + 8);
      v46 = v44;
      do
      {
        if ( v46->m_pSequence )
        {
          m_pAssociation = v46->m_pAssociation;
          if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
            v42 = v42 + m_pAssociation->m_fBlendAmount;
        }
        v48 = *v45++;
        v46 = v48;
      }
      while ( v48 );
    }
    v49 = 0.0;
    v50 = 0.0;
    v51 = 0.0;
    v52 = 0.0;
    v53 = 0.0;
    v54 = 0.0;
    v55 = 0.0;
    v56 = 0.0;
    v57 = 0.0;
    v58 = 0.0;
    do
    {
      v59 = v43;
      if ( v44->m_pSequence )
      {
        CAnimBlendNode::UpdateCompressed(v44, &translation, &rotation, 1.0 - v42);
        v60 = *(CAnimBlendNode **)v43;
        if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v43 + 16) + 4) & 2) != 0 )
        {
          v57 = v57 + translation.z;
          v54 = v54 + translation.x;
          v56 = v56 + translation.y;
          v58 = v58 + v60->m_pAssociation->m_fBlendAmount;
        }
        if ( (float)((float)((float)((float)(v52 * rotation.x) + (float)(v50 * rotation.y)) + (float)(v49 * rotation.z))
                   + (float)(v40 * rotation.w)) >= 0.0 )
        {
          v49 = v49 + rotation.z;
          v50 = v50 + rotation.y;
          v52 = v52 + rotation.x;
          v40 = v40 + rotation.w;
        }
        else
        {
          v49 = v49 - rotation.z;
          v50 = v50 - rotation.y;
          v52 = v52 - rotation.x;
          v40 = v40 - rotation.w;
        }
        v51 = v49;
        v53 = v50;
        v55 = v52;
      }
      else
      {
        v60 = v44;
      }
      v43 += 4;
      v44 = (CAnimBlendNode *)v59[1];
      *v59 = v60 + 1;
    }
    while ( v44 );
    v61 = pFrameData->Flags;
    if ( (pFrameData->Flags & 2) == 0 )
    {
      v62 = (float)(v40 * v40) + (float)((float)(v49 * v49) + (float)((float)(v50 * v50) + (float)(v52 * v52)));
      if ( v62 == 0.0 )
      {
        v63 = 1.0;
      }
      else
      {
        v64 = 1.0 / sqrtf(v62);
        v63 = v40 * v64;
        v51 = v49 * v64;
        v53 = v50 * v64;
        v55 = v52 * v64;
      }
      *p_type = v55;
      p_type[1] = v53;
      p_type[2] = v51;
      p_type[3] = v63;
      v61 = pFrameData->Flags;
    }
    if ( (v61 & 4) == 0 )
    {
      p_type[4] = v54 * v58;
      p_type[5] = v56 * v58;
      p_type[6] = v57 * v58;
      p_type[4] = (float)(v54 * v58) + (float)((float)(1.0 - v58) * pFrameData->_anon_0.posn.x);
      p_type[5] = (float)(v56 * v58) + (float)((float)(1.0 - v58) * pFrameData->_anon_0.posn.y);
      p_type[6] = (float)(v57 * v58) + (float)((float)(1.0 - v58) * pFrameData->_anon_0.posn.z);
    }
  }
}

//----- (0038C6F8) --------------------------------------------------------
void __fastcall FrameUpdateCallBackCompressedNonSkinned(AnimBlendFrameData *pFrameData, void *pData)
{
  RwInt8 Flags; // r2
  float v4; // s16
  float v5; // s0
  RwFrame_0 *pFrame; // r3
  RwMatrix *p_modelling; // r5
  char *v8; // r9
  CAnimBlendNode *v9; // r0
  int *v10; // r2
  int v11; // r3
  int v12; // r3
  int v13; // t1
  float v14; // s22
  float v15; // s20
  CAnimBlendNode **v16; // r5
  float v17; // s18
  float v18; // r6
  CAnimBlendSequence *m_pSequence; // r1
  bool v20; // nf
  int v21; // r1
  CAnimBlendNode *v22; // t1
  float v23; // s24
  CAnimBlendNode *v24; // r1
  float v25; // s26
  int v26; // r8
  float v27; // s28
  float v28; // s21
  float v29; // s23
  float v30; // s25
  float v31; // s30
  float v32; // s17
  float v33; // s19
  _DWORD *v34; // r11
  _BOOL4 updated; // r1
  CAnimBlendNode *v36; // r0
  RwInt8 v37; // r0
  RwUInt32 v38; // r0
  float v39; // s8
  float v40; // s8
  CAnimBlendClumpData *v41; // r0
  float *m_pExtractedVelocity; // r1
  float *v43; // r0
  float v44; // s2
  float v45; // s4
  RwMatrix *v46; // r0
  CQuaternion v47; // q0
  RwFrame_0 *v48; // r10
  float v49; // s4
  RwMatrix *v50; // r4
  CAnimBlendNode **v51; // r8
  CAnimBlendNode *v52; // r0
  CAnimBlendNode **v53; // r1
  CAnimBlendNode *v54; // r3
  CAnimBlendAssociation *m_pAssociation; // r3
  CAnimBlendNode *v56; // t1
  float v57; // s16
  float v58; // s18
  float v59; // s20
  float v60; // s22
  CAnimBlendNode *v61; // r1
  RwUInt32 v62; // r0
  float v63; // s8
  float v64; // s0
  float v65; // s8
  RwMatrix *pmat; // [sp+4h] [bp-A4h]
  RwFrame_0 *v67; // [sp+8h] [bp-A0h]
  CQuaternion rotation; // [sp+10h] [bp-98h] BYREF
  CVector translation; // [sp+24h] [bp-84h] BYREF
  CQuaternion v71; // [sp+30h] [bp-78h] BYREF

  Flags = pFrameData->Flags;
  if ( (pFrameData->Flags & 8) != 0 && gpAnimBlendClump->m_pExtractedVelocity )
  {
    v4 = 0.0;
    v5 = 0.0;
    pFrame = pFrameData->_anon_1.pFrame;
    memset(&v71, 0, sizeof(v71));
    p_modelling = &pFrame->modelling;
    v8 = (char *)pData + 4;
    v9 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
    v67 = pFrame;
    if ( *(_DWORD *)pData )
    {
      v5 = 0.0;
      v10 = (int *)((char *)pData + 8);
      v11 = *((_DWORD *)pData + 1);
      do
      {
        if ( *(_DWORD *)(v11 + 16) )
        {
          v12 = *(_DWORD *)(v11 + 20);
          if ( (*(_BYTE *)(v12 + 46) & 0x10) != 0 )
            v5 = v5 + *(float *)(v12 + 24);
        }
        v13 = *v10++;
        v11 = v13;
      }
      while ( v13 );
    }
    v14 = 1.0;
    pmat = p_modelling;
    v15 = 0.0;
    v16 = (CAnimBlendNode **)((char *)pData + 8);
    v17 = 0.0;
    v18 = 1.0 - v5;
    do
    {
      m_pSequence = v9->m_pSequence;
      if ( m_pSequence )
      {
        v21 = LOBYTE(m_pSequence->m_bitsFlag) << 30;
        v20 = v21 < 0;
        if ( v21 < 0 )
          v20 = (v9->m_pAssociation->m_bitsFlag & 0x40) != 0;
        if ( v20 )
        {
          CAnimBlendNode::GetCurrentTranslationCompressed(v9, &translation, v18);
          v4 = v4 + translation.x;
          v15 = v15 + translation.y;
          v17 = v17 + translation.z;
        }
      }
      v22 = *v16++;
      v9 = v22;
    }
    while ( v22 );
    v23 = 0.0;
    v24 = *(CAnimBlendNode **)v8;
    v25 = 0.0;
    v26 = 0;
    v27 = 0.0;
    v28 = 0.0;
    v29 = 0.0;
    v30 = 0.0;
    v31 = 0.0;
    v32 = 0.0;
    v33 = 0.0;
    do
    {
      v34 = v8;
      if ( v24->m_pSequence )
      {
        updated = CAnimBlendNode::UpdateCompressed(v24, &translation, &rotation, v18);
        v71 = (CQuaternion)vaddq_f32((float32x4_t)rotation, (float32x4_t)v71);
        v36 = *(CAnimBlendNode **)v8;
        if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v8 + 16) + 4) & 2) != 0 )
        {
          v33 = v33 + translation.x;
          v32 = v32 + translation.y;
          v31 = v31 + translation.z;
          if ( (v36->m_pAssociation->m_bitsFlag & 0x40) != 0 )
          {
            v23 = v23 + translation.z;
            v26 |= updated;
            v25 = v25 + translation.y;
            v27 = v27 + translation.x;
            if ( updated )
            {
              CAnimBlendNode::GetEndTranslationCompressed(v36, &translation, v18);
              v30 = v30 + translation.x;
              v29 = v29 + translation.y;
              v36 = *(CAnimBlendNode **)v8;
              v28 = v28 + translation.z;
            }
          }
        }
      }
      else
      {
        v36 = v24;
      }
      v8 += 4;
      v24 = (CAnimBlendNode *)v34[1];
      *v34 = v36 + 1;
    }
    while ( v24 );
    v37 = pFrameData->Flags;
    if ( (pFrameData->Flags & 2) == 0 )
    {
      v67->modelling.right.x = 1.0;
      v67->modelling.up.y = 1.0;
      v67->modelling.up.x = 0.0;
      v67->modelling.right.y = 0.0;
      v67->modelling.right.z = 0.0;
      v67->modelling.up.z = 0.0;
      v67->modelling.at.x = 0.0;
      v67->modelling.at.y = 0.0;
      v67->modelling.at.z = 1.0;
      v38 = v67->modelling.flags;
      v67->modelling.pos.x = 0.0;
      v67->modelling.pos.y = 0.0;
      v67->modelling.pos.z = 0.0;
      v67->modelling.flags = v38 | 0x20003;
      v39 = (float)((float)((float)(v71.x * v71.x) + (float)(v71.y * v71.y)) + (float)(v71.z * v71.z))
          + (float)(v71.w * v71.w);
      if ( v39 != 0.0 )
      {
        v40 = 1.0 / sqrtf(v39);
        v14 = v71.w * v40;
        v71.y = v71.y * v40;
        v71.x = v71.x * v40;
        v71.z = v71.z * v40;
      }
      v71.w = v14;
      CQuaternion::Get(&v71, pmat);
      v37 = pFrameData->Flags;
    }
    if ( (v37 & 4) == 0 )
    {
      v41 = gpAnimBlendClump;
      m_pExtractedVelocity = gpAnimBlendClump->m_pExtractedVelocity;
      *m_pExtractedVelocity = v27 - v4;
      m_pExtractedVelocity[1] = v25 - v15;
      m_pExtractedVelocity[2] = v23 - v17;
      if ( v26 << 31 )
      {
        v43 = v41->m_pExtractedVelocity;
        v44 = v29 + v43[1];
        v45 = v28 + v43[2];
        *v43 = v30 + *v43;
        v43[1] = v44;
        v43[2] = v45;
      }
      v67->modelling.pos.x = v33 - v27;
      v67->modelling.pos.y = v32 - v25;
      v67->modelling.pos.z = v31 - v23;
      v67->modelling.pos.x = (float)(v33 - v27) + pFrameData->_anon_0.posn.x;
      v67->modelling.pos.y = (float)(v32 - v25) + pFrameData->_anon_0.posn.y;
      v67->modelling.pos.z = (float)(v31 - v23) + pFrameData->_anon_0.posn.z;
    }
    v46 = pmat;
    goto LABEL_60;
  }
  v47.y = 0.0;
  v48 = pFrameData->_anon_1.pFrame;
  v49 = 0.0;
  memset(&rotation, 0, sizeof(rotation));
  v50 = &v48->modelling;
  v51 = (CAnimBlendNode **)((char *)pData + 4);
  v52 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
  if ( !*(_DWORD *)pData )
  {
LABEL_41:
    v47.x = 0.0;
    v57 = 0.0;
    v58 = 0.0;
    v59 = 0.0;
    v60 = 0.0;
    if ( v52 )
    {
      *(_QWORD *)&v47.x = 0LL;
      v60 = 0.0;
      v59 = 0.0;
      v58 = 0.0;
      v57 = 0.0;
      do
      {
        if ( v52->m_pSequence )
        {
          CAnimBlendNode::UpdateCompressed(v52, &translation, &v71, 1.0 - v49);
          if ( ((*v51)->m_pSequence->m_bitsFlag & 2) != 0 )
          {
            v57 = v57 + translation.z;
            v59 = v59 + translation.x;
            v58 = v58 + translation.y;
            v60 = v60 + (*v51)->m_pAssociation->m_fBlendAmount;
          }
          v47 = (CQuaternion)vaddq_f32((float32x4_t)v71, (float32x4_t)rotation);
          rotation = v47;
          v61 = *v51;
        }
        else
        {
          v61 = v52;
        }
        v52 = v51[1];
        *v51++ = v61 + 1;
      }
      while ( v52 );
      Flags = pFrameData->Flags;
      v50 = &v48->modelling;
    }
    if ( (Flags & 2) != 0 )
      goto LABEL_57;
    goto LABEL_51;
  }
  if ( v52 )
  {
    v49 = 0.0;
    v53 = (CAnimBlendNode **)((char *)pData + 8);
    v54 = v52;
    do
    {
      if ( v54->m_pSequence )
      {
        m_pAssociation = v54->m_pAssociation;
        if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
          v49 = v49 + m_pAssociation->m_fBlendAmount;
      }
      v56 = *v53++;
      v54 = v56;
    }
    while ( v56 );
    goto LABEL_41;
  }
  *(_QWORD *)&v47.x = 0LL;
  v57 = 0.0;
  v58 = 0.0;
  v59 = 0.0;
  v60 = 0.0;
  if ( (Flags & 2) == 0 )
  {
LABEL_51:
    v48->modelling.right.x = 1.0;
    v48->modelling.up.y = 1.0;
    v48->modelling.up.x = 0.0;
    v48->modelling.right.y = 0.0;
    v48->modelling.right.z = 0.0;
    v48->modelling.up.z = 0.0;
    v48->modelling.at.x = 0.0;
    v48->modelling.at.y = 0.0;
    v48->modelling.at.z = 1.0;
    v62 = v48->modelling.flags;
    v48->modelling.pos.x = 0.0;
    v48->modelling.pos.y = 0.0;
    v48->modelling.pos.z = 0.0;
    v48->modelling.flags = v62 | ((unsigned int)&elf_hash_chain[16294] + 3);
    v63 = (float)((float)((float)(v47.x * v47.x) + (float)(v47.y * v47.y)) + (float)(rotation.z * rotation.z))
        + (float)(rotation.w * rotation.w);
    if ( v63 == 0.0 )
    {
      v64 = 1.0;
    }
    else
    {
      v65 = 1.0 / sqrtf(v63);
      v47.z = v47.x * v65;
      v47.x = rotation.w * v65;
      rotation.y = v47.y * v65;
      rotation.x = v47.z;
      rotation.z = rotation.z * v65;
    }
    rotation.w = v64;
    CQuaternion::Get(&rotation, v50);
    Flags = pFrameData->Flags;
  }
LABEL_57:
  if ( (Flags & 4) == 0 )
  {
    v48->modelling.pos.x = v59;
    v48->modelling.pos.y = v58;
    v48->modelling.pos.z = v57;
    v48->modelling.pos.x = v59 + (float)((float)(1.0 - v60) * pFrameData->_anon_0.posn.x);
    v48->modelling.pos.y = v58 + (float)((float)(1.0 - v60) * pFrameData->_anon_0.posn.y);
    v48->modelling.pos.z = v57 + (float)((float)(1.0 - v60) * pFrameData->_anon_0.posn.z);
  }
  v46 = v50;
LABEL_60:
  RwMatrixUpdate(v46);
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (0038CC30) --------------------------------------------------------
void __fastcall FrameUpdateCallBackSkinned(AnimBlendFrameData *pFrameData, void *pData)
{
  RwInt8 Flags; // r0
  float v4; // s16
  char *v5; // r6
  float v6; // s0
  float *v7; // r8
  CAnimBlendNode *v8; // r0
  CAnimBlendNode **v9; // r1
  CAnimBlendNode *v10; // r2
  CAnimBlendAssociation *m_pAssociation; // r2
  CAnimBlendNode *v12; // t1
  float v13; // s28
  float v14; // s30
  float v15; // r1
  float v16; // s17
  float v17; // r2
  float v18; // s20
  float v19; // r3
  float v20; // s22
  float v21; // s26
  float v22; // s24
  _DWORD *v23; // r9
  CAnimBlendNode *v24; // r4
  RwInt8 v25; // r0
  float v26; // s0
  float v27; // r0
  float v28; // s16
  float v29; // s0
  char *v30; // r8
  CAnimBlendNode *v31; // r0
  int *v32; // r2
  int v33; // r3
  int v34; // r3
  int v35; // t1
  CAnimBlendNode **v36; // r6
  float v37; // s20
  float v38; // s18
  float v39; // r5
  CAnimBlendSequence *m_pSequence; // r1
  bool v41; // nf
  int v42; // r1
  CAnimBlendNode *v43; // t1
  float v44; // s26
  float v45; // r4
  CAnimBlendNode *v46; // r1
  float v47; // s22
  float v48; // r10
  float v49; // s28
  float v50; // r11
  float v51; // s21
  float v52; // s23
  float v53; // s25
  float v54; // s30
  float v55; // s17
  float v56; // s19
  float v57; // s27
  float v58; // s29
  float v59; // s31
  float v60; // s24
  _DWORD *v61; // r6
  _BOOL4 v62; // r1
  CAnimBlendNode *v63; // r0
  RwInt8 v64; // r0
  float v65; // s0
  float v66; // r0
  float v67; // s0
  float v68; // s0
  CAnimBlendClumpData *v69; // r0
  float *m_pExtractedVelocity; // r1
  float *v71; // r0
  float v72; // s2
  float v73; // s4
  float *p_type; // [sp+4h] [bp-84h]
  AnimBlendFrameData *v75; // [sp+8h] [bp-80h]
  int v76; // [sp+8h] [bp-80h]
  CQuaternion rotation; // [sp+Ch] [bp-7Ch] BYREF
  CVector translation; // [sp+1Ch] [bp-6Ch] BYREF

  Flags = pFrameData->Flags;
  if ( (Flags & 8) != 0 && gpAnimBlendClump->m_pExtractedVelocity )
  {
    if ( (Flags & 0x10) != 0 )
    {
      v28 = 0.0;
      v29 = 0.0;
      p_type = (float *)&pFrameData->_anon_1.pFrame->object.type;
      v30 = (char *)pData + 4;
      v31 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
      if ( *(_DWORD *)pData )
      {
        v29 = 0.0;
        v32 = (int *)((char *)pData + 8);
        v33 = *((_DWORD *)pData + 1);
        do
        {
          if ( *(_DWORD *)(v33 + 16) )
          {
            v34 = *(_DWORD *)(v33 + 20);
            if ( (*(_WORD *)(v34 + 46) & 0x410) == 16 )
              v29 = v29 + *(float *)(v34 + 24);
          }
          v35 = *v32++;
          v33 = v35;
        }
        while ( v35 );
      }
      v36 = (CAnimBlendNode **)((char *)pData + 8);
      v37 = 0.0;
      v38 = 0.0;
      v39 = 1.0 - v29;
      do
      {
        m_pSequence = v31->m_pSequence;
        if ( m_pSequence )
        {
          v42 = LOBYTE(m_pSequence->m_bitsFlag) << 30;
          v41 = v42 < 0;
          if ( v42 < 0 )
            v41 = (v31->m_pAssociation->m_bitsFlag & 0x40) != 0;
          if ( v41 )
          {
            CAnimBlendNode::GetCurrentTranslation(v31, &translation, v39);
            v28 = v28 + translation.x;
            v37 = v37 + translation.y;
            v38 = v38 + translation.z;
          }
        }
        v43 = *v36++;
        v31 = v43;
      }
      while ( v43 );
      v44 = 0.0;
      v45 = 0.0;
      v46 = *(CAnimBlendNode **)v30;
      v47 = 0.0;
      v48 = 0.0;
      v49 = 0.0;
      v50 = 0.0;
      v51 = 0.0;
      v76 = 0;
      v52 = 0.0;
      v53 = 0.0;
      v54 = 0.0;
      v55 = 0.0;
      v56 = 0.0;
      v57 = 0.0;
      v58 = 0.0;
      v59 = 0.0;
      v60 = 0.0;
      do
      {
        v61 = v30;
        if ( v46->m_pSequence )
        {
          v62 = CAnimBlendNode::Update(v46, &translation, &rotation, v39);
          v60 = v60 + rotation.x;
          v59 = v59 + rotation.y;
          v63 = *(CAnimBlendNode **)v30;
          v58 = v58 + rotation.z;
          v57 = v57 + rotation.w;
          v50 = v60;
          v48 = v59;
          v45 = v58;
          if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v30 + 16) + 4) & 2) != 0 )
          {
            v56 = v56 + translation.x;
            v55 = v55 + translation.y;
            v54 = v54 + translation.z;
            if ( (v63->m_pAssociation->m_bitsFlag & 0x40) != 0 )
            {
              v44 = v44 + translation.z;
              v47 = v47 + translation.y;
              v49 = v49 + translation.x;
              v76 |= v62;
              if ( v62 )
              {
                CAnimBlendNode::GetEndTranslation(v63, &translation, v39);
                v53 = v53 + translation.x;
                v52 = v52 + translation.y;
                v63 = *(CAnimBlendNode **)v30;
                v51 = v51 + translation.z;
              }
            }
          }
        }
        else
        {
          v63 = v46;
        }
        v30 += 4;
        v46 = (CAnimBlendNode *)v61[1];
        *v61 = v63 + 1;
      }
      while ( v46 );
      v64 = pFrameData->Flags;
      if ( (pFrameData->Flags & 2) == 0 )
      {
        v65 = (float)(v57 * v57) + (float)((float)(v58 * v58) + (float)((float)(v59 * v59) + (float)(v60 * v60)));
        if ( v65 == 0.0 )
        {
          v66 = 1.0;
        }
        else
        {
          v68 = 1.0 / sqrtf(v65);
          v66 = v57 * v68;
          v45 = v58 * v68;
          v48 = v59 * v68;
          v50 = v60 * v68;
        }
        *p_type = v50;
        p_type[1] = v48;
        p_type[2] = v45;
        p_type[3] = v66;
        v64 = pFrameData->Flags;
      }
      if ( (v64 & 4) == 0 )
      {
        v69 = gpAnimBlendClump;
        m_pExtractedVelocity = gpAnimBlendClump->m_pExtractedVelocity;
        *m_pExtractedVelocity = v49 - v28;
        m_pExtractedVelocity[1] = v47 - v37;
        m_pExtractedVelocity[2] = v44 - v38;
        if ( v76 << 31 )
        {
          v71 = v69->m_pExtractedVelocity;
          v72 = v52 + v71[1];
          v73 = v51 + v71[2];
          *v71 = v53 + *v71;
          v71[1] = v72;
          v71[2] = v73;
        }
        p_type[4] = v56 - v49;
        p_type[5] = v55 - v47;
        p_type[6] = v54 - v44;
        p_type[4] = (float)(v56 - v49) + pFrameData->_anon_0.posn.x;
        p_type[5] = (float)(v55 - v47) + pFrameData->_anon_0.posn.y;
        p_type[6] = (float)(v54 - v44) + pFrameData->_anon_0.posn.z;
      }
    }
    else
    {
      FrameUpdateCallBackWithVelocityExtractionSkinned(pFrameData, pData);
    }
  }
  else
  {
    v4 = 0.0;
    v5 = (char *)pData + 4;
    v6 = 0.0;
    v7 = (float *)&pFrameData->_anon_1.pFrame->object.type;
    v8 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
    if ( *(_DWORD *)pData )
    {
      v6 = 0.0;
      v9 = (CAnimBlendNode **)((char *)pData + 8);
      v10 = v8;
      do
      {
        if ( v10->m_pSequence )
        {
          m_pAssociation = v10->m_pAssociation;
          if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
            v6 = v6 + m_pAssociation->m_fBlendAmount;
        }
        v12 = *v9++;
        v10 = v12;
      }
      while ( v12 );
    }
    v13 = 0.0;
    v14 = 0.0;
    v15 = 0.0;
    v16 = 0.0;
    v17 = 0.0;
    v18 = 0.0;
    v19 = 0.0;
    v20 = 0.0;
    v75 = pFrameData;
    v21 = 0.0;
    v22 = 0.0;
    do
    {
      v23 = v5;
      if ( v8->m_pSequence )
      {
        CAnimBlendNode::Update(v8, &translation, &rotation, 1.0 - v6);
        v24 = *(CAnimBlendNode **)v5;
        if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v5 + 16) + 4) & 2) != 0 )
        {
          v21 = v21 + translation.z;
          v18 = v18 + translation.x;
          v20 = v20 + translation.y;
          v22 = v22 + v24->m_pAssociation->m_fBlendAmount;
        }
        if ( (float)((float)((float)((float)(v16 * rotation.x) + (float)(v14 * rotation.y)) + (float)(v13 * rotation.z))
                   + (float)(v4 * rotation.w)) >= 0.0 )
        {
          v13 = v13 + rotation.z;
          v14 = v14 + rotation.y;
          v16 = v16 + rotation.x;
          v4 = v4 + rotation.w;
        }
        else
        {
          v13 = v13 - rotation.z;
          v14 = v14 - rotation.y;
          v16 = v16 - rotation.x;
          v4 = v4 - rotation.w;
        }
        v15 = v13;
        v17 = v14;
        v19 = v16;
      }
      else
      {
        v24 = v8;
      }
      v5 += 4;
      v8 = (CAnimBlendNode *)v23[1];
      *v23 = v24 + 1;
    }
    while ( v8 );
    v25 = v75->Flags;
    if ( (v75->Flags & 2) == 0 )
    {
      v26 = (float)(v4 * v4) + (float)((float)(v13 * v13) + (float)((float)(v14 * v14) + (float)(v16 * v16)));
      if ( v26 == 0.0 )
      {
        v27 = 1.0;
      }
      else
      {
        v67 = 1.0 / sqrtf(v26);
        v27 = v4 * v67;
        v15 = v13 * v67;
        v17 = v14 * v67;
        v19 = v16 * v67;
      }
      *v7 = v19;
      v7[1] = v17;
      v7[2] = v15;
      v7[3] = v27;
      v25 = v75->Flags;
    }
    if ( (v25 & 4) == 0 )
    {
      v7[4] = v18 * v22;
      v7[5] = v20 * v22;
      v7[6] = v21 * v22;
      v7[4] = (float)(v18 * v22) + (float)((float)(1.0 - v22) * v75->_anon_0.posn.x);
      v7[5] = (float)(v20 * v22) + (float)((float)(1.0 - v22) * v75->_anon_0.posn.y);
      v7[6] = (float)(v21 * v22) + (float)((float)(1.0 - v22) * v75->_anon_0.posn.z);
    }
  }
}

//----- (0038D11C) --------------------------------------------------------
void __fastcall FrameUpdateCallBackNonSkinned(AnimBlendFrameData *pFrameData, void *pData)
{
  int v3; // r4
  RwInt8 Flags; // r2
  RwFrame_0 *v5; // r6
  RwMatrix *v6; // r10
  float v7; // s16
  float v8; // s0
  char *v9; // r5
  CAnimBlendNode *v10; // r0
  CAnimBlendNode **v11; // r1
  CAnimBlendNode *v12; // r2
  CAnimBlendAssociation *v13; // r2
  CAnimBlendNode *v14; // t1
  _DWORD *v15; // r4
  float v16; // s18
  float v17; // r6
  CAnimBlendSequence *m_pSequence; // r1
  CAnimBlendNode *v19; // t1
  CAnimBlendNode *v20; // r1
  float v21; // s30
  float v22; // s17
  float v23; // s28
  float v24; // s26
  float v25; // s22
  float v26; // s24
  float v27; // s20
  _DWORD *v28; // r4
  _BOOL4 v29; // r1
  CAnimBlendNode *v30; // r0
  uint16 m_bitsFlag; // r2
  int v32; // r5
  CQuaternion v33; // q0
  RwFrame_0 *pFrame; // r9
  float v35; // s4
  CAnimBlendNode **v36; // r10
  CAnimBlendNode *v37; // r0
  CAnimBlendNode **v38; // r1
  CAnimBlendNode *v39; // r3
  CAnimBlendAssociation *m_pAssociation; // r3
  CAnimBlendNode *v41; // t1
  float v42; // s16
  float v43; // s18
  float v44; // s20
  float v45; // s22
  CAnimBlendNode *v46; // r1
  RwUInt32 v47; // r0
  float v48; // s8
  float v49; // s0
  float v50; // s16
  float v51; // s0
  char *v52; // r5
  CAnimBlendNode *v53; // r0
  int *v54; // r2
  int v55; // r3
  int v56; // r3
  int v57; // t1
  float v58; // s22
  CAnimBlendNode **v59; // r4
  float v60; // s20
  float v61; // s18
  float v62; // r6
  CAnimBlendSequence *v63; // r1
  bool v64; // nf
  int v65; // r1
  CAnimBlendNode *v66; // t1
  float v67; // s24
  CAnimBlendNode *v68; // r1
  float v69; // s26
  int v70; // r9
  float v71; // s28
  float v72; // s21
  float v73; // s23
  float v74; // s25
  float v75; // s30
  float v76; // s17
  float v77; // s19
  _DWORD *v78; // r11
  _BOOL4 v79; // r1
  CAnimBlendNode *v80; // r0
  RwInt8 v81; // r0
  RwUInt32 v82; // r0
  float v83; // s8
  float v84; // s8
  CAnimBlendClumpData *v85; // r0
  float *m_pExtractedVelocity; // r1
  float *v87; // r0
  float v88; // s2
  float v89; // s4
  RwMatrix *p_modelling; // r0
  float v91; // s8
  RwInt8 v92; // r0
  RwUInt32 v93; // r0
  float v94; // s8
  float v95; // s0
  float v96; // s8
  CAnimBlendClumpData *v97; // r0
  RwMatrix *v98; // [sp+4h] [bp-A4h]
  RwFrame_0 *v99; // [sp+8h] [bp-A0h]
  RwFrame_0 *v100; // [sp+8h] [bp-A0h]
  int v101; // [sp+Ch] [bp-9Ch]
  AnimBlendFrameData *v102; // [sp+Ch] [bp-9Ch]
  CQuaternion rotation; // [sp+10h] [bp-98h] BYREF
  CVector translation; // [sp+24h] [bp-84h] BYREF
  CQuaternion v105; // [sp+30h] [bp-78h] BYREF

  v3 = (int)&elf_hash_chain[16294] + 3;
  Flags = pFrameData->Flags;
  if ( (pFrameData->Flags & 8) == 0 || !gpAnimBlendClump->m_pExtractedVelocity )
  {
    v33.y = 0.0;
    pFrame = pFrameData->_anon_1.pFrame;
    v35 = 0.0;
    memset(&rotation, 0, sizeof(rotation));
    v36 = (CAnimBlendNode **)((char *)pData + 4);
    v37 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
    if ( *(_DWORD *)pData )
    {
      if ( !v37 )
      {
        *(_QWORD *)&v33.x = 0LL;
        v42 = 0.0;
        v43 = 0.0;
        v44 = 0.0;
        v45 = 0.0;
        if ( (Flags & 2) != 0 )
        {
LABEL_88:
          if ( (Flags & 4) == 0 )
          {
            pFrame->modelling.pos.x = v44;
            pFrame->modelling.pos.y = v43;
            pFrame->modelling.pos.z = v42;
            pFrame->modelling.pos.x = v44 + (float)((float)(1.0 - v45) * pFrameData->_anon_0.posn.x);
            pFrame->modelling.pos.y = v43 + (float)((float)(1.0 - v45) * pFrameData->_anon_0.posn.y);
            pFrame->modelling.pos.z = v42 + (float)((float)(1.0 - v45) * pFrameData->_anon_0.posn.z);
          }
          p_modelling = &pFrame->modelling;
          goto LABEL_91;
        }
LABEL_51:
        pFrame->modelling.right.x = 1.0;
        pFrame->modelling.up.y = 1.0;
        pFrame->modelling.up.x = 0.0;
        pFrame->modelling.right.y = 0.0;
        pFrame->modelling.right.z = 0.0;
        pFrame->modelling.up.z = 0.0;
        pFrame->modelling.at.x = 0.0;
        pFrame->modelling.at.y = 0.0;
        pFrame->modelling.at.z = 1.0;
        v47 = pFrame->modelling.flags;
        pFrame->modelling.pos.x = 0.0;
        pFrame->modelling.pos.y = 0.0;
        pFrame->modelling.pos.z = 0.0;
        pFrame->modelling.flags = v47 | v3;
        v48 = (float)((float)((float)(v33.x * v33.x) + (float)(v33.y * v33.y)) + (float)(rotation.z * rotation.z))
            + (float)(rotation.w * rotation.w);
        if ( v48 == 0.0 )
        {
          v49 = 1.0;
        }
        else
        {
          v91 = 1.0 / sqrtf(v48);
          v33.z = v33.x * v91;
          v33.x = rotation.w * v91;
          rotation.y = v33.y * v91;
          rotation.x = v33.z;
          rotation.z = rotation.z * v91;
        }
        rotation.w = v49;
        CQuaternion::Get(&rotation, &pFrame->modelling);
        Flags = pFrameData->Flags;
        goto LABEL_88;
      }
      v35 = 0.0;
      v38 = (CAnimBlendNode **)((char *)pData + 8);
      v39 = v37;
      do
      {
        if ( v39->m_pSequence )
        {
          m_pAssociation = v39->m_pAssociation;
          if ( (m_pAssociation->m_bitsFlag & 0x10) != 0 )
            v35 = v35 + m_pAssociation->m_fBlendAmount;
        }
        v41 = *v38++;
        v39 = v41;
      }
      while ( v41 );
    }
    v33.x = 0.0;
    v42 = 0.0;
    v43 = 0.0;
    v44 = 0.0;
    v45 = 0.0;
    if ( v37 )
    {
      *(_QWORD *)&v33.x = 0LL;
      v45 = 0.0;
      v44 = 0.0;
      v43 = 0.0;
      v42 = 0.0;
      do
      {
        if ( v37->m_pSequence )
        {
          CAnimBlendNode::Update(v37, &translation, &v105, 1.0 - v35);
          if ( ((*v36)->m_pSequence->m_bitsFlag & 2) != 0 )
          {
            v42 = v42 + translation.z;
            v44 = v44 + translation.x;
            v43 = v43 + translation.y;
            v45 = v45 + (*v36)->m_pAssociation->m_fBlendAmount;
          }
          v33 = (CQuaternion)vaddq_f32((float32x4_t)v105, (float32x4_t)rotation);
          rotation = v33;
          v46 = *v36;
        }
        else
        {
          v46 = v37;
        }
        v37 = v36[1];
        *v36++ = v46 + 1;
      }
      while ( v37 );
      v3 = 131075;
      Flags = pFrameData->Flags;
    }
    if ( (Flags & 2) != 0 )
      goto LABEL_88;
    goto LABEL_51;
  }
  v5 = pFrameData->_anon_1.pFrame;
  v6 = &v5->modelling;
  if ( (pFrameData->Flags & 0x10) == 0 )
  {
    v7 = 0.0;
    v8 = 0.0;
    memset(&v105, 0, sizeof(v105));
    v9 = (char *)pData + 4;
    v10 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
    if ( *(_DWORD *)pData )
    {
      if ( !v10 )
      {
        v7 = 0.0;
        goto LABEL_93;
      }
      v8 = 0.0;
      v11 = (CAnimBlendNode **)((char *)pData + 8);
      v12 = v10;
      do
      {
        if ( v12->m_pSequence )
        {
          v13 = v12->m_pAssociation;
          if ( (v13->m_bitsFlag & 0x10) != 0 )
            v8 = v8 + v13->m_fBlendAmount;
        }
        v14 = *v11++;
        v12 = v14;
      }
      while ( v14 );
    }
    if ( v10 )
    {
      v99 = v5;
      v7 = 0.0;
      v15 = v9;
      v16 = 0.0;
      v17 = 1.0 - v8;
      do
      {
        m_pSequence = v10->m_pSequence;
        if ( m_pSequence )
        {
          if ( (m_pSequence->m_bitsFlag & 2) != 0 && (v10->m_pAssociation->m_bitsFlag & 0x2040) == 64 )
          {
            CAnimBlendNode::GetCurrentTranslation(v10, &translation, v17);
            v7 = v7 + translation.y;
            if ( (*(_BYTE *)(*(_DWORD *)(*v15 + 20) + 46) & 0x80) != 0 )
              v16 = v16 + translation.x;
          }
        }
        v19 = (CAnimBlendNode *)v15[1];
        ++v15;
        v10 = v19;
      }
      while ( v19 );
      v20 = *(CAnimBlendNode **)v9;
      if ( *(_DWORD *)v9 )
      {
        v21 = 0.0;
        v22 = 0.0;
        v23 = 0.0;
        v101 = 0;
        v24 = 0.0;
        v25 = 0.0;
        v26 = 0.0;
        v27 = 0.0;
        do
        {
          v28 = v9;
          if ( v20->m_pSequence )
          {
            v29 = CAnimBlendNode::Update(v20, &translation, &rotation, v17);
            v105 = (CQuaternion)vaddq_f32((float32x4_t)rotation, (float32x4_t)v105);
            v30 = *(CAnimBlendNode **)v9;
            if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v9 + 16) + 4) & 2) != 0 )
            {
              m_bitsFlag = v30->m_pAssociation->m_bitsFlag;
              if ( (m_bitsFlag & 0x2000) == 0 )
              {
                v23 = v23 + translation.x;
                v24 = v24 + translation.y;
                v25 = v25 + translation.z;
                if ( (m_bitsFlag & 0x40) != 0 )
                {
                  v27 = v27 + translation.y;
                  if ( (m_bitsFlag & 0x80) != 0 )
                    v26 = v26 + translation.x;
                  v101 |= v29;
                  if ( v29 )
                  {
                    CAnimBlendNode::GetEndTranslation(v30, &translation, v17);
                    v30 = *(CAnimBlendNode **)v9;
                    v22 = v22 + translation.y;
                    if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v9 + 20) + 46) & 0x80) != 0 )
                      v21 = v21 + translation.x;
                  }
                }
              }
            }
          }
          else
          {
            v30 = v20;
          }
          v9 += 4;
          v20 = (CAnimBlendNode *)v28[1];
          *v28 = v30 + 1;
        }
        while ( v20 );
        v5 = v99;
        v32 = v101;
      }
      else
      {
        v27 = 0.0;
        v32 = 0;
        v26 = 0.0;
        v5 = v99;
        v25 = 0.0;
        v24 = 0.0;
        v23 = 0.0;
        v22 = 0.0;
        v21 = 0.0;
      }
      goto LABEL_95;
    }
LABEL_93:
    v32 = 0;
    v16 = 0.0;
    v27 = 0.0;
    v26 = 0.0;
    v25 = 0.0;
    v24 = 0.0;
    v23 = 0.0;
    v22 = 0.0;
    v21 = 0.0;
LABEL_95:
    v92 = pFrameData->Flags;
    if ( (pFrameData->Flags & 2) == 0 )
    {
      v5->modelling.right.x = 1.0;
      v5->modelling.up.y = 1.0;
      v5->modelling.up.x = 0.0;
      v5->modelling.right.y = 0.0;
      v5->modelling.right.z = 0.0;
      v5->modelling.up.z = 0.0;
      v5->modelling.at.x = 0.0;
      v5->modelling.at.y = 0.0;
      v5->modelling.at.z = 1.0;
      v93 = v5->modelling.flags;
      v5->modelling.pos.x = 0.0;
      v5->modelling.pos.y = 0.0;
      v5->modelling.pos.z = 0.0;
      v5->modelling.flags = v93 | ((unsigned int)&elf_hash_chain[16294] + 3);
      v94 = (float)((float)((float)(v105.x * v105.x) + (float)(v105.y * v105.y)) + (float)(v105.z * v105.z))
          + (float)(v105.w * v105.w);
      if ( v94 == 0.0 )
      {
        v95 = 1.0;
      }
      else
      {
        v96 = 1.0 / sqrtf(v94);
        v95 = v105.w * v96;
        v105.y = v105.y * v96;
        v105.x = v105.x * v96;
        v105.z = v105.z * v96;
      }
      v105.w = v95;
      CQuaternion::Get(&v105, v6);
      v92 = pFrameData->Flags;
    }
    if ( (v92 & 4) == 0 )
    {
      v97 = gpAnimBlendClump;
      *gpAnimBlendClump->m_pExtractedVelocity = v26 - v16;
      v97->m_pExtractedVelocity[1] = v27 - v7;
      if ( v32 << 31 )
      {
        *v97->m_pExtractedVelocity = v21 + *v97->m_pExtractedVelocity;
        v97->m_pExtractedVelocity[1] = v22 + v97->m_pExtractedVelocity[1];
      }
      v5->modelling.pos.x = v23 - v26;
      v5->modelling.pos.y = v24 - v27;
      v5->modelling.pos.z = v25;
    }
    p_modelling = v6;
    goto LABEL_91;
  }
  v50 = 0.0;
  v98 = &v5->modelling;
  v100 = pFrameData->_anon_1.pFrame;
  v51 = 0.0;
  memset(&v105, 0, sizeof(v105));
  v52 = (char *)pData + 4;
  v53 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
  if ( *(_DWORD *)pData )
  {
    v51 = 0.0;
    v54 = (int *)((char *)pData + 8);
    v55 = *((_DWORD *)pData + 1);
    do
    {
      if ( *(_DWORD *)(v55 + 16) )
      {
        v56 = *(_DWORD *)(v55 + 20);
        if ( (*(_BYTE *)(v56 + 46) & 0x10) != 0 )
          v51 = v51 + *(float *)(v56 + 24);
      }
      v57 = *v54++;
      v55 = v57;
    }
    while ( v57 );
  }
  v58 = 1.0;
  v59 = (CAnimBlendNode **)((char *)pData + 8);
  v60 = 0.0;
  v61 = 0.0;
  v102 = pFrameData;
  v62 = 1.0 - v51;
  do
  {
    v63 = v53->m_pSequence;
    if ( v63 )
    {
      v65 = LOBYTE(v63->m_bitsFlag) << 30;
      v64 = v65 < 0;
      if ( v65 < 0 )
        v64 = (v53->m_pAssociation->m_bitsFlag & 0x40) != 0;
      if ( v64 )
      {
        CAnimBlendNode::GetCurrentTranslation(v53, &translation, v62);
        v50 = v50 + translation.x;
        v60 = v60 + translation.y;
        v61 = v61 + translation.z;
      }
    }
    v66 = *v59++;
    v53 = v66;
  }
  while ( v66 );
  v67 = 0.0;
  v68 = *(CAnimBlendNode **)v52;
  v69 = 0.0;
  v70 = 0;
  v71 = 0.0;
  v72 = 0.0;
  v73 = 0.0;
  v74 = 0.0;
  v75 = 0.0;
  v76 = 0.0;
  v77 = 0.0;
  do
  {
    v78 = v52;
    if ( v68->m_pSequence )
    {
      v79 = CAnimBlendNode::Update(v68, &translation, &rotation, v62);
      v105 = (CQuaternion)vaddq_f32((float32x4_t)rotation, (float32x4_t)v105);
      v80 = *(CAnimBlendNode **)v52;
      if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v52 + 16) + 4) & 2) != 0 )
      {
        v77 = v77 + translation.x;
        v76 = v76 + translation.y;
        v75 = v75 + translation.z;
        if ( (v80->m_pAssociation->m_bitsFlag & 0x40) != 0 )
        {
          v67 = v67 + translation.z;
          v70 |= v79;
          v69 = v69 + translation.y;
          v71 = v71 + translation.x;
          if ( v79 )
          {
            CAnimBlendNode::GetEndTranslation(v80, &translation, v62);
            v74 = v74 + translation.x;
            v73 = v73 + translation.y;
            v80 = *(CAnimBlendNode **)v52;
            v72 = v72 + translation.z;
          }
        }
      }
    }
    else
    {
      v80 = v68;
    }
    v52 += 4;
    v68 = (CAnimBlendNode *)v78[1];
    *v78 = v80 + 1;
  }
  while ( v68 );
  v81 = v102->Flags;
  if ( (v102->Flags & 2) == 0 )
  {
    v100->modelling.right.x = 1.0;
    v100->modelling.up.y = 1.0;
    v100->modelling.up.x = 0.0;
    v100->modelling.right.y = 0.0;
    v100->modelling.right.z = 0.0;
    v100->modelling.up.z = 0.0;
    v100->modelling.at.x = 0.0;
    v100->modelling.at.y = 0.0;
    v100->modelling.at.z = 1.0;
    v82 = v100->modelling.flags;
    v100->modelling.pos.x = 0.0;
    v100->modelling.pos.y = 0.0;
    v100->modelling.pos.z = 0.0;
    v100->modelling.flags = v82 | 0x20003;
    v83 = (float)((float)((float)(v105.x * v105.x) + (float)(v105.y * v105.y)) + (float)(v105.z * v105.z))
        + (float)(v105.w * v105.w);
    if ( v83 != 0.0 )
    {
      v84 = 1.0 / sqrtf(v83);
      v58 = v105.w * v84;
      v105.y = v105.y * v84;
      v105.x = v105.x * v84;
      v105.z = v105.z * v84;
    }
    v105.w = v58;
    CQuaternion::Get(&v105, v98);
    v81 = v102->Flags;
  }
  if ( (v81 & 4) == 0 )
  {
    v85 = gpAnimBlendClump;
    m_pExtractedVelocity = gpAnimBlendClump->m_pExtractedVelocity;
    *m_pExtractedVelocity = v71 - v50;
    m_pExtractedVelocity[1] = v69 - v60;
    m_pExtractedVelocity[2] = v67 - v61;
    if ( v70 << 31 )
    {
      v87 = v85->m_pExtractedVelocity;
      v88 = v73 + v87[1];
      v89 = v72 + v87[2];
      *v87 = v74 + *v87;
      v87[1] = v88;
      v87[2] = v89;
    }
    v100->modelling.pos.x = v77 - v71;
    v100->modelling.pos.y = v76 - v69;
    v100->modelling.pos.z = v75 - v67;
    v100->modelling.pos.x = (float)(v77 - v71) + v102->_anon_0.posn.x;
    v100->modelling.pos.y = (float)(v76 - v69) + v102->_anon_0.posn.y;
    v100->modelling.pos.z = (float)(v75 - v67) + v102->_anon_0.posn.z;
  }
  p_modelling = v98;
LABEL_91:
  RwMatrixUpdate(p_modelling);
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (0038D93C) --------------------------------------------------------
void __fastcall FrameUpdateCallBackOffscreen(AnimBlendFrameData *pFrameData, void *pData)
{
  if ( (pFrameData->Flags & 8) != 0 )
  {
    if ( gpAnimBlendClump->m_pExtractedVelocity )
      FrameUpdateCallBackWithVelocityExtractionSkinned(pFrameData, pData);
  }
}

//----- (0038D958) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetFirstAssociation(RpClump_0 *pClump)
{
  _DWORD *v1; // r4

  v1 = *(_DWORD **)(&pClump->object.type + ClumpOffset);
  if ( RpAnimBlendClumpIsInitialized(pClump) && *v1 )
    return (CAnimBlendAssociation *)(*v1 - 4);
  else
    return 0;
}

//----- (0038D980) --------------------------------------------------------
void __fastcall FrameUpdateCallBackWithVelocityExtractionSkinned(AnimBlendFrameData *pFrameData, void *pData)
{
  float v2; // s16
  char *v3; // r10
  float v5; // s0
  RwFrame_0 *pFrame; // r6
  CAnimBlendNode *v7; // r0
  CAnimBlendNode **v8; // r1
  CAnimBlendNode *v9; // r2
  CAnimBlendAssociation *m_pAssociation; // r2
  CAnimBlendNode *v11; // t1
  float v12; // s18
  _DWORD *v13; // r6
  float v14; // r5
  CAnimBlendSequence *m_pSequence; // r1
  CAnimBlendNode *v16; // t1
  float v17; // s24
  CAnimBlendNode *v18; // r1
  float v19; // s26
  float v20; // r4
  float v21; // s28
  float v22; // r8
  float v23; // s19
  float v24; // r9
  float v25; // s20
  float v26; // s30
  float v27; // s17
  float v28; // s21
  float v29; // s23
  float v30; // s25
  float v31; // s27
  _DWORD *v32; // r11
  _BOOL4 v33; // r1
  CAnimBlendNode *v34; // r0
  uint16 m_bitsFlag; // r2
  RwInt8 Flags; // r0
  float v37; // s0
  float v38; // r0
  float v39; // s0
  CAnimBlendClumpData *v40; // r0
  float z; // s4
  AnimBlendFrameData *v42; // [sp+0h] [bp-88h]
  float *p_type; // [sp+4h] [bp-84h]
  int v44; // [sp+8h] [bp-80h]
  CQuaternion rotation; // [sp+Ch] [bp-7Ch] BYREF
  CVector translation; // [sp+1Ch] [bp-6Ch] BYREF

  v2 = 0.0;
  v3 = (char *)pData + 4;
  v5 = 0.0;
  pFrame = pFrameData->_anon_1.pFrame;
  v7 = (CAnimBlendNode *)*((_DWORD *)pData + 1);
  if ( *(_DWORD *)pData )
  {
    v5 = 0.0;
    v8 = (CAnimBlendNode **)((char *)pData + 8);
    v9 = v7;
    do
    {
      if ( v9->m_pSequence )
      {
        m_pAssociation = v9->m_pAssociation;
        if ( (m_pAssociation->m_bitsFlag & 0x410) == 16 )
          v5 = v5 + m_pAssociation->m_fBlendAmount;
      }
      v11 = *v8++;
      v9 = v11;
    }
    while ( v11 );
  }
  v42 = pFrameData;
  p_type = (float *)&pFrame->object.type;
  v12 = 0.0;
  v13 = v3;
  v14 = 1.0 - v5;
  do
  {
    m_pSequence = v7->m_pSequence;
    if ( m_pSequence )
    {
      if ( (m_pSequence->m_bitsFlag & 2) != 0 && (v7->m_pAssociation->m_bitsFlag & 0x2040) == 64 )
      {
        CAnimBlendNode::GetCurrentTranslation(v7, &translation, v14);
        v12 = v12 + translation.y;
        if ( (*(_BYTE *)(*(_DWORD *)(*v13 + 20) + 46) & 0x80) != 0 )
          v2 = v2 + translation.x;
      }
    }
    v16 = (CAnimBlendNode *)v13[1];
    ++v13;
    v7 = v16;
  }
  while ( v16 );
  v17 = 0.0;
  v18 = *(CAnimBlendNode **)v3;
  v19 = 0.0;
  v20 = 0.0;
  v21 = 0.0;
  v22 = 0.0;
  v23 = 0.0;
  v24 = 0.0;
  v25 = 0.0;
  v44 = 0;
  v26 = 0.0;
  v27 = 0.0;
  v28 = 0.0;
  v29 = 0.0;
  v30 = 0.0;
  v31 = 0.0;
  do
  {
    v32 = v3;
    if ( v18->m_pSequence )
    {
      v33 = CAnimBlendNode::Update(v18, &translation, &rotation, v14);
      if ( (float)((float)((float)((float)(v31 * rotation.x) + (float)(v30 * rotation.y)) + (float)(v29 * rotation.z))
                 + (float)(v28 * rotation.w)) >= 0.0 )
      {
        v28 = v28 + rotation.w;
        v29 = v29 + rotation.z;
        v30 = v30 + rotation.y;
        v31 = v31 + rotation.x;
      }
      else
      {
        v28 = v28 - rotation.w;
        v29 = v29 - rotation.z;
        v30 = v30 - rotation.y;
        v31 = v31 - rotation.x;
      }
      v20 = v29;
      v34 = *(CAnimBlendNode **)v3;
      v22 = v30;
      v24 = v31;
      if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v3 + 16) + 4) & 2) != 0 )
      {
        m_bitsFlag = v34->m_pAssociation->m_bitsFlag;
        if ( (m_bitsFlag & 0x2000) == 0 )
        {
          v27 = v27 + translation.x;
          v26 = v26 + translation.y;
          v25 = v25 + translation.z;
          if ( (m_bitsFlag & 0x40) != 0 )
          {
            v17 = v17 + translation.y;
            if ( (m_bitsFlag & 0x80) != 0 )
              v19 = v19 + translation.x;
            v44 |= v33;
            if ( v33 )
            {
              CAnimBlendNode::GetEndTranslation(v34, &translation, v14);
              v34 = *(CAnimBlendNode **)v3;
              v21 = v21 + translation.y;
              if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)v3 + 20) + 46) & 0x80) != 0 )
                v23 = v23 + translation.x;
            }
          }
        }
      }
    }
    else
    {
      v34 = v18;
    }
    v3 += 4;
    v18 = (CAnimBlendNode *)v32[1];
    *v32 = v34 + 1;
  }
  while ( v18 );
  Flags = v42->Flags;
  if ( (v42->Flags & 2) == 0 )
  {
    v37 = (float)(v28 * v28) + (float)((float)(v29 * v29) + (float)((float)(v30 * v30) + (float)(v31 * v31)));
    if ( v37 == 0.0 )
    {
      v38 = 1.0;
    }
    else
    {
      v39 = 1.0 / sqrtf(v37);
      v38 = v28 * v39;
      v20 = v29 * v39;
      v22 = v30 * v39;
      v24 = v31 * v39;
    }
    *p_type = v24;
    p_type[1] = v22;
    p_type[2] = v20;
    p_type[3] = v38;
    Flags = v42->Flags;
  }
  if ( (Flags & 4) == 0 )
  {
    v40 = gpAnimBlendClump;
    *gpAnimBlendClump->m_pExtractedVelocity = v19 - v2;
    v40->m_pExtractedVelocity[1] = v17 - v12;
    if ( v44 << 31 )
    {
      *v40->m_pExtractedVelocity = v23 + *v40->m_pExtractedVelocity;
      v40->m_pExtractedVelocity[1] = v21 + v40->m_pExtractedVelocity[1];
    }
    p_type[4] = v27 - v19;
    p_type[5] = v26 - v17;
    p_type[6] = v25;
    if ( v25 >= -0.8 )
    {
      z = v42->_anon_0.posn.z;
      if ( v25 < -0.4 )
        z = (float)((float)(v25 * 2.5) + 2.0) * z;
      p_type[6] = v25 + z;
    }
    p_type[4] = v42->_anon_0.posn.x + (float)(v27 - v19);
    p_type[5] = v42->_anon_0.posn.y + (float)(v26 - v17);
  }
}

//----- (0038DCA0) --------------------------------------------------------
void CAnimManager::Shutdown()
{
  int i; // r4
  int32 v1; // r5
  CAnimBlendHierarchy *v2; // r4
  int32 m_grpId; // r1
  int32 *p_m_idOffset; // r4
  CAnimBlendAssocGroup *v5; // r5
  int v6; // r6

  for ( i = 0; i != 180; ++i )
    CStreaming::RemoveModel(i + 25575);
  if ( CAnimManager::ms_numAnimations >= 1 )
  {
    v1 = 0;
    v2 = CAnimManager::ms_aAnimations;
    do
    {
      CAnimBlendHierarchy::Shutdown(v2);
      ++v1;
      ++v2;
    }
    while ( v1 < CAnimManager::ms_numAnimations );
  }
  if ( CAnimManager::ms_animCache.m_pStore )
    operator delete[](CAnimManager::ms_animCache.m_pStore);
  CAnimManager::ms_animCache.m_pStore = 0;
  if ( CAnimManager::ms_aAnimAssocGroups )
  {
    m_grpId = CAnimManager::ms_aAnimAssocGroups[-1].m_grpId;
    p_m_idOffset = &CAnimManager::ms_aAnimAssocGroups[-1].m_idOffset;
    if ( m_grpId )
    {
      v5 = CAnimManager::ms_aAnimAssocGroups - 1;
      v6 = m_grpId;
      do
        CAnimBlendAssocGroup::~CAnimBlendAssocGroup(&v5[v6--]);
      while ( v6 * 20 );
    }
    sub_18E8E0(p_m_idOffset);
  }
}

//----- (0038DD54) --------------------------------------------------------
void __fastcall CAnimManager::UncompressAnimation(CAnimBlendHierarchy *pAnim)
{
  CLink<CAnimBlendHierarchy *> *m_pNext; // r0
  __int64 v3; // kr00_8
  CLink<CAnimBlendHierarchy *> *m_pPrev; // r6
  CLink<CAnimBlendHierarchy *> *v5; // r1
  CLink<CAnimBlendHierarchy *> *v6; // r0
  CLink<CAnimBlendHierarchy *> *v7; // r2
  CLink<CAnimBlendHierarchy *> *m_pLink; // r0

  if ( pAnim->m_bRunCompressed )
  {
    if ( pAnim->m_fTotalTime == 0.0 )
      j_CAnimBlendHierarchy::CalcTotalTimeCompressed(pAnim);
  }
  else if ( pAnim->m_bIsCompressed )
  {
    m_pNext = CAnimManager::ms_animCache.m_firstFreeLink.m_pNext;
    if ( CAnimManager::ms_animCache.m_firstFreeLink.m_pNext == &CAnimManager::ms_animCache.m_lastFreeLink )
      goto LABEL_7;
    v3 = *(_QWORD *)&CAnimManager::ms_animCache.m_firstFreeLink.m_pNext->m_pPrev;
    CAnimManager::ms_animCache.m_firstFreeLink.m_pNext->item = pAnim;
    *(_DWORD *)(HIDWORD(v3) + 4) = v3;
    m_pNext->m_pPrev->m_pNext = m_pNext->m_pNext;
    m_pNext->m_pNext = CAnimManager::ms_animCache.m_firstLink.m_pNext;
    CAnimManager::ms_animCache.m_firstLink.m_pNext->m_pPrev = m_pNext;
    m_pNext->m_pPrev = (CLink<CAnimBlendHierarchy *> *)&CAnimManager::ms_animCache;
    CAnimManager::ms_animCache.m_firstLink.m_pNext = m_pNext;
    if ( !m_pNext )
    {
LABEL_7:
      m_pPrev = CAnimManager::ms_animCache.m_lastLink.m_pPrev;
      CAnimBlendHierarchy::RemoveUncompressedData(CAnimManager::ms_animCache.m_lastLink.m_pPrev->item);
      m_pPrev->m_pNext->m_pPrev = m_pPrev->m_pPrev;
      m_pPrev->m_pPrev->m_pNext = m_pPrev->m_pNext;
      m_pPrev->m_pNext = CAnimManager::ms_animCache.m_firstFreeLink.m_pNext;
      CAnimManager::ms_animCache.m_firstFreeLink.m_pNext->m_pPrev = m_pPrev;
      m_pPrev->m_pPrev = &CAnimManager::ms_animCache.m_firstFreeLink;
      m_pNext = 0;
      CAnimManager::ms_animCache.m_firstFreeLink.m_pNext = m_pPrev;
      m_pPrev->item->m_pLink = 0;
      v5 = CAnimManager::ms_animCache.m_firstFreeLink.m_pNext;
      if ( CAnimManager::ms_animCache.m_firstFreeLink.m_pNext != &CAnimManager::ms_animCache.m_lastFreeLink )
      {
        v7 = CAnimManager::ms_animCache.m_firstFreeLink.m_pNext->m_pNext;
        v6 = CAnimManager::ms_animCache.m_firstFreeLink.m_pNext->m_pPrev;
        CAnimManager::ms_animCache.m_firstFreeLink.m_pNext->item = pAnim;
        v7->m_pPrev = v6;
        v5->m_pPrev->m_pNext = v5->m_pNext;
        v5->m_pNext = CAnimManager::ms_animCache.m_firstLink.m_pNext;
        CAnimManager::ms_animCache.m_firstLink.m_pNext->m_pPrev = v5;
        m_pNext = v5;
        v5->m_pPrev = (CLink<CAnimBlendHierarchy *> *)&CAnimManager::ms_animCache;
        CAnimManager::ms_animCache.m_firstLink.m_pNext = v5;
      }
    }
    pAnim->m_pLink = m_pNext;
    sub_19B5C8(pAnim);
  }
  else
  {
    m_pLink = pAnim->m_pLink;
    if ( m_pLink )
    {
      m_pLink->m_pNext->m_pPrev = m_pLink->m_pPrev;
      m_pLink->m_pPrev->m_pNext = m_pLink->m_pNext;
      m_pLink->m_pNext = CAnimManager::ms_animCache.m_firstLink.m_pNext;
      CAnimManager::ms_animCache.m_firstLink.m_pNext->m_pPrev = m_pLink;
      m_pLink->m_pPrev = (CLink<CAnimBlendHierarchy *> *)&CAnimManager::ms_animCache;
      CAnimManager::ms_animCache.m_firstLink.m_pNext = m_pLink;
    }
  }
}

//----- (0038DE60) --------------------------------------------------------
void __fastcall CAnimManager::RemoveFromUncompressedCache(CAnimBlendHierarchy *pAnim)
{
  CLink<CAnimBlendHierarchy *> *m_pLink; // r1

  m_pLink = pAnim->m_pLink;
  if ( m_pLink )
  {
    m_pLink->m_pNext->m_pPrev = m_pLink->m_pPrev;
    m_pLink->m_pPrev->m_pNext = m_pLink->m_pNext;
    m_pLink->m_pNext = CAnimManager::ms_animCache.m_firstFreeLink.m_pNext;
    CAnimManager::ms_animCache.m_firstFreeLink.m_pNext->m_pPrev = m_pLink;
    m_pLink->m_pPrev = &CAnimManager::ms_animCache.m_firstFreeLink;
    CAnimManager::ms_animCache.m_firstFreeLink.m_pNext = m_pLink;
    pAnim->m_pLink = 0;
  }
}

//----- (0038DEA4) --------------------------------------------------------
CAnimBlock *__fastcall CAnimManager::GetAnimationBlock(const unsigned __int8 *pName)
{
  int32 v2; // r6
  int v3; // r5
  CAnimBlock *i; // r4

  v2 = CAnimManager::ms_numAnimBlocks;
  if ( CAnimManager::ms_numAnimBlocks < 1 )
    return 0;
  v3 = 0;
  for ( i = CAnimManager::ms_aAnimBlocks; strcasecmp((const char *)i, (const char *)pName); ++i )
  {
    if ( ++v3 >= v2 )
      return 0;
  }
  return i;
}

//----- (0038DEE8) --------------------------------------------------------
int32 __fastcall CAnimManager::GetAnimationBlockIndex(const unsigned __int8 *pName)
{
  int32 v2; // r6
  int32 v3; // r5
  CAnimBlock *v4; // r4
  int32 result; // r0

  v2 = CAnimManager::ms_numAnimBlocks;
  if ( CAnimManager::ms_numAnimBlocks < 1 )
  {
LABEL_5:
    v4 = 0;
  }
  else
  {
    v3 = 0;
    v4 = CAnimManager::ms_aAnimBlocks;
    while ( strcasecmp((const char *)v4, (const char *)pName) )
    {
      ++v3;
      ++v4;
      if ( v3 >= v2 )
        goto LABEL_5;
    }
  }
  result = v4 - CAnimManager::ms_aAnimBlocks;
  if ( !v4 )
    return -1;
  return result;
}

//----- (0038DF44) --------------------------------------------------------
AssocGroupId __fastcall CAnimManager::GetFirstAssocGroup(const unsigned __int8 *pName)
{
  int v2; // r6
  unsigned __int8 *i; // r5

  v2 = -1;
  for ( i = CAnimManager::ms_aAnimAssocDefinitions[0].pBlockName; strcasecmp((const char *)i, (const char *)pName); i += 48 )
  {
    if ( ++v2 >= 117 )
      return 118;
  }
  return v2 + 1;
}

//----- (0038DF84) --------------------------------------------------------
CAnimBlendHierarchy *__fastcall CAnimManager::GetAnimation(const unsigned __int8 *pName, const CAnimBlock *pAnimBlock)
{
  uint32 UppercaseKey; // r0
  int32 m_numAnims; // r2
  uint32 v5; // r1
  CAnimBlendHierarchy *result; // r0
  int32 v7; // r3

  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  m_numAnims = pAnimBlock->m_numAnims;
  v5 = UppercaseKey;
  if ( m_numAnims < 1 )
    return 0;
  result = &CAnimManager::ms_aAnimations[pAnimBlock->m_animIndex];
  v7 = 0;
  while ( result->m_hashKey != v5 )
  {
    ++v7;
    ++result;
    if ( v7 >= m_numAnims )
      return 0;
  }
  return result;
}

//----- (0038DFC0) --------------------------------------------------------
CAnimBlendHierarchy *__fastcall CAnimManager::GetAnimation(uint32 hashKey, const CAnimBlock *pAnimBlock)
{
  int32 m_numAnims; // r3
  CAnimBlendHierarchy *result; // r0
  int32 v5; // r1

  m_numAnims = pAnimBlock->m_numAnims;
  if ( m_numAnims < 1 )
    return 0;
  result = &CAnimManager::ms_aAnimations[pAnimBlock->m_animIndex];
  v5 = 0;
  while ( result->m_hashKey != hashKey )
  {
    ++v5;
    ++result;
    if ( v5 >= m_numAnims )
      return 0;
  }
  return result;
}

//----- (0038DFF4) --------------------------------------------------------
const unsigned __int8 *__fastcall CAnimManager::GetAnimGroupName(AssocGroupId groupId)
{
  return CAnimManager::ms_aAnimAssocDefinitions[groupId].pName;
}

//----- (0038E008) --------------------------------------------------------
const unsigned __int8 *__fastcall CAnimManager::GetAnimBlockName(AssocGroupId groupId)
{
  return CAnimManager::ms_aAnimAssocDefinitions[groupId].pBlockName;
}

//----- (0038E020) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimManager::CreateAnimAssociation(AssocGroupId groupId, AnimationId animId)
{
  return sub_18E830(&CAnimManager::ms_aAnimAssocGroups[groupId], animId);
}

//----- (0038E038) --------------------------------------------------------
CAnimBlendStaticAssociation *__fastcall CAnimManager::GetAnimAssociation(AssocGroupId groupId, AnimationId animId)
{
  return sub_19F818(&CAnimManager::ms_aAnimAssocGroups[groupId], animId);
}

//----- (0038E050) --------------------------------------------------------
CAnimBlendStaticAssociation *__fastcall CAnimManager::GetAnimAssociation(
        AssocGroupId groupId,
        const unsigned __int8 *pName)
{
  return j_CAnimBlendAssocGroup::GetAnimation(&CAnimManager::ms_aAnimAssocGroups[groupId], pName);
}

//----- (0038E068) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimManager::AddAnimation(
        RpClump_0 *pClump,
        AssocGroupId groupId,
        AnimationId animId)
{
  CAnimBlendAssociation *v4; // r4
  ListLink *v5; // r5
  ListLink *v6; // r0
  ListLink_0 *p_m_list; // r0
  ListLink *pNext; // r1

  v4 = CAnimBlendAssocGroup::CopyAnimation(&CAnimManager::ms_aAnimAssocGroups[groupId], animId);
  v5 = *(ListLink **)(&pClump->object.type + ClumpOffset);
  if ( (v4->m_bitsFlag & 0x20) != 0 )
  {
    v6 = v5;
    while ( 1 )
    {
      v6 = v6->pNext;
      if ( !v6 )
        break;
      if ( (BYTE2(v6[5].pNext) & 0x20) != 0 )
      {
        CAnimBlendAssociation::SyncAnimation(v4, (CAnimBlendAssociation *)&v6[-1].pPrev);
        v4->m_bitsFlag |= 1u;
        goto LABEL_7;
      }
    }
  }
  CAnimBlendAssociation::Start(v4, 0.0);
LABEL_7:
  p_m_list = &v4->m_list;
  if ( v5->pNext )
  {
    v5->pNext->pPrev = p_m_list;
    pNext = v5->pNext;
  }
  else
  {
    pNext = 0;
  }
  v4->m_list.pNext = pNext;
  v4->m_list.pPrev = v5;
  v5->pNext = p_m_list;
  return v4;
}

//----- (0038E0E0) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimManager::AddAnimation(
        RpClump_0 *pClump,
        CAnimBlendHierarchy *pHier,
        int32 flags)
{
  uint16 v4; // r8
  CAnimBlendAssociation *v6; // r4
  CAnimBlendAssociation *v7; // r0
  ListLink *v8; // r5
  ListLink *v9; // r0
  ListLink_0 *p_m_list; // r0
  ListLink *pNext; // r1

  v4 = flags;
  v6 = (CAnimBlendAssociation *)operator new(0x3Cu);
  CAnimBlendAssociation::CAnimBlendAssociation(v6, pClump, pHier);
  v6->m_bitsFlag = v4;
  CAnimBlendAssociation::ReferenceAnimBlock(v7);
  CAnimManager::UncompressAnimation(pHier);
  v8 = *(ListLink **)(&pClump->object.type + ClumpOffset);
  if ( (v6->m_bitsFlag & 0x20) != 0 )
  {
    v9 = v8;
    while ( 1 )
    {
      v9 = v9->pNext;
      if ( !v9 )
        break;
      if ( (BYTE2(v9[5].pNext) & 0x20) != 0 )
      {
        CAnimBlendAssociation::SyncAnimation(v6, (CAnimBlendAssociation *)&v9[-1].pPrev);
        v6->m_bitsFlag |= 1u;
        goto LABEL_7;
      }
    }
  }
  CAnimBlendAssociation::Start(v6, 0.0);
LABEL_7:
  p_m_list = &v6->m_list;
  if ( v8->pNext )
  {
    v8->pNext->pPrev = p_m_list;
    pNext = v8->pNext;
  }
  else
  {
    pNext = 0;
  }
  v6->m_list.pNext = pNext;
  v6->m_list.pPrev = v8;
  v8->pNext = p_m_list;
  return v6;
}
// 38E102: variable 'v7' is possibly undefined

//----- (0038E168) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimManager::AddAnimationAndSync(
        RpClump_0 *pClump,
        CAnimBlendAssociation *pSyncAnim,
        AssocGroupId groupId,
        AnimationId animId)
{
  CAnimBlendAssociation *v6; // r4
  bool v7; // zf
  ListLink *v8; // r6
  ListLink_0 *p_m_list; // r0
  ListLink *pNext; // r1

  v6 = CAnimBlendAssocGroup::CopyAnimation(&CAnimManager::ms_aAnimAssocGroups[groupId], animId);
  v7 = pSyncAnim == 0;
  v8 = *(ListLink **)(&pClump->object.type + ClumpOffset);
  if ( pSyncAnim )
    v7 = (v6->m_bitsFlag & 0x20) == 0;
  if ( v7 )
  {
    CAnimBlendAssociation::Start(v6, 0.0);
  }
  else
  {
    CAnimBlendAssociation::SyncAnimation(v6, pSyncAnim);
    v6->m_bitsFlag |= 1u;
  }
  p_m_list = &v6->m_list;
  if ( v8->pNext )
  {
    v8->pNext->pPrev = p_m_list;
    pNext = v8->pNext;
  }
  else
  {
    pNext = 0;
  }
  v6->m_list.pNext = pNext;
  v6->m_list.pPrev = v8;
  v8->pNext = p_m_list;
  return v6;
}

//----- (0038E1E0) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimManager::BlendAnimation(
        RpClump_0 *pClump,
        CAnimBlendHierarchy *pHier,
        int32 flags,
        float delta)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d1
  uint16 v7; // r9
  int v8; // lr
  CAnimBlendAssociation *p_pPrev; // r8
  int v11; // r11
  unsigned int v12; // r12
  ListLink *v13; // r10
  ListLink *v14; // r2
  CAnimBlendHierarchy *pNext; // r6
  unsigned int pNext_high; // r1
  float v17; // s2
  int32 m_animBlock; // r6
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r0
  float m_fCurrentTime; // s4
  CAnimBlendAssociation *v21; // r0
  ListLink_0 *p_m_list; // r0
  ListLink *v23; // r1

  v7 = flags;
  v8 = flags & 0x10;
  v4.n64_u32[0] = -1119040307;
  p_pPrev = 0;
  v11 = 0;
  v12 = ((unsigned int)flags >> 4) & 1;
  v13 = *(ListLink **)(&pClump->object.type + ClumpOffset);
  v14 = v13;
  while ( 1 )
  {
    v14 = v14->pNext;
    if ( !v14 )
      break;
    pNext = (CAnimBlendHierarchy *)v14[2].pNext;
    if ( pNext && pNext == pHier )
    {
      p_pPrev = (CAnimBlendAssociation *)&v14[-1].pPrev;
    }
    else
    {
      pNext_high = HIWORD(v14[5].pNext);
      if ( v12 == ((pNext_high >> 4) & 1) )
      {
        v17 = *(float *)&v14[2].pPrev;
        if ( v17 <= 0.0 )
        {
          v14[3].pNext = (ListLink *)-1082130432;
        }
        else
        {
          v5.n64_f32[0] = -(float)(v17 * delta);
          if ( !v8
            || *(float *)&v14[3].pNext > v5.n64_f32[0]
            || (m_animBlock = pNext->m_animBlock) != 0 && m_animBlock == pHier->m_animBlock )
          {
            v5.n64_u64[0] = vmin_f32(v5, v4).n64_u64[0];
            v14[3].pNext = (ListLink *)v5.n64_u32[0];
          }
        }
        HIWORD(v14[5].pNext) = pNext_high | 4;
        v11 = 1;
      }
    }
  }
  if ( p_pPrev )
  {
    m_pAnimBlendHierarchy = p_pPrev->m_pAnimBlendHierarchy;
    m_fCurrentTime = p_pPrev->m_fCurrentTime;
    p_pPrev->m_fBlendDelta = (float)(1.0 - p_pPrev->m_fBlendAmount) * delta;
    if ( m_fCurrentTime == m_pAnimBlendHierarchy->m_fTotalTime )
      CAnimBlendAssociation::Start(p_pPrev, 0.0);
  }
  else
  {
    p_pPrev = (CAnimBlendAssociation *)operator new(0x3Cu);
    CAnimBlendAssociation::CAnimBlendAssociation(p_pPrev, pClump, pHier);
    p_pPrev->m_bitsFlag = v7;
    CAnimBlendAssociation::ReferenceAnimBlock(v21);
    CAnimManager::UncompressAnimation(pHier);
    p_m_list = &p_pPrev->m_list;
    if ( v13->pNext )
    {
      v13->pNext->pPrev = p_m_list;
      v23 = v13->pNext;
    }
    else
    {
      v23 = 0;
    }
    p_pPrev->m_list.pNext = v23;
    p_pPrev->m_list.pPrev = v13;
    v13->pNext = p_m_list;
    CAnimBlendAssociation::Start(p_pPrev, 0.0);
    if ( !(v11 | v8) )
    {
      p_pPrev->m_fBlendAmount = 1.0;
      return p_pPrev;
    }
    p_pPrev->m_fBlendDelta = delta;
    p_pPrev->m_fBlendAmount = 0.0;
  }
  CAnimManager::UncompressAnimation(p_pPrev->m_pAnimBlendHierarchy);
  return p_pPrev;
}
// 38E26E: variable 'v5' is possibly undefined
// 38E26E: variable 'v4' is possibly undefined
// 38E2D6: variable 'v21' is possibly undefined

//----- (0038E340) --------------------------------------------------------
CAnimBlendAssociation *__fastcall CAnimManager::BlendAnimation(
        RpClump_0 *pClump,
        AssocGroupId groupId,
        AnimationId animId,
        float delta)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d1
  AssocGroupId v8; // r8
  int **v10; // r10
  float v11; // s16
  int v12; // r11
  CAnimBlendStaticAssociation *Animation; // r0
  int *v14; // r1
  CAnimBlendAssociation *v15; // r10
  int v16; // lr
  int v17; // r0
  int v18; // r2
  CAnimBlendAssociation *v19; // r6
  CAnimBlendAssociation *v20; // r8
  int v21; // r3
  bool v22; // zf
  unsigned int v23; // r12
  int v24; // r4
  float v25; // s2
  CAnimBlendHierarchy *m_pAnimBlendHierarchy; // r0
  float m_fCurrentTime; // s4
  bool v28; // zf
  ListLink *v29; // r5
  ListLink_0 *p_m_list; // r0
  ListLink *pNext; // r1
  bool v32; // zf
  int v34; // [sp+4h] [bp-34h]
  uint16 m_bitsFlag; // [sp+Ch] [bp-2Ch]
  int v37; // [sp+Ch] [bp-2Ch]

  v8 = groupId;
  v10 = *(int ***)(&pClump->object.type + ClumpOffset);
  m_bitsFlag = CAnimBlendAssocGroup::GetAnimation(&CAnimManager::ms_aAnimAssocGroups[groupId], animId)->m_bitsFlag;
  v11 = delta;
  v12 = CAnimBlendAssocGroup::GetAnimation(&CAnimManager::ms_aAnimAssocGroups[v8], animId)->m_bitsFlag & 0x10;
  v34 = v8 * 5;
  Animation = CAnimBlendAssocGroup::GetAnimation(&CAnimManager::ms_aAnimAssocGroups[v8], animId);
  v14 = *v10;
  v15 = 0;
  if ( v14 )
  {
    v16 = 0;
    v17 = (__int16)Animation->m_bitsFlag;
    if ( !v12 )
      v16 = 1;
    v18 = m_bitsFlag & 0x20;
    v4.n64_u32[0] = -1119040307;
    v37 = 0;
    v19 = 0;
LABEL_5:
    v20 = v19;
    do
    {
      while ( 1 )
      {
        v19 = (CAnimBlendAssociation *)(v14 - 1);
        if ( v18 && (*((_BYTE *)v14 + 42) & 0x20) != 0 )
          v15 = (CAnimBlendAssociation *)(v14 - 1);
        v21 = *((__int16 *)v14 + 20);
        v22 = v21 == animId;
        if ( v21 == animId )
          v22 = *((__int16 *)v14 + 5) == groupId;
        if ( v22 )
        {
          v14 = (int *)*v14;
          if ( v14 )
            goto LABEL_5;
          goto LABEL_28;
        }
        v23 = *((unsigned __int16 *)v14 + 21);
        v24 = v12;
        if ( v12 )
          v24 = 1;
        if ( v24 == (unsigned __int8)(v23 & 0x10) >> 4 && v17 > -1 != v23 >> 15 )
          break;
        v14 = (int *)*v14;
        if ( !v14 )
          goto LABEL_27;
      }
      v25 = *((float *)v14 + 5);
      if ( v25 <= 0.0 )
      {
        v14[6] = -1082130432;
      }
      else
      {
        v5.n64_f32[0] = -(float)(v25 * v11);
        if ( (*((float *)v14 + 6) > v5.n64_f32[0]) | v16 )
        {
          v5.n64_u64[0] = vmin_f32(v5, v4).n64_u64[0];
          v14[6] = v5.n64_u32[0];
        }
      }
      *((_WORD *)v14 + 21) = v23 | 4;
      v14 = (int *)*v14;
      v37 = 1;
    }
    while ( v14 );
LABEL_27:
    v19 = v20;
    if ( !v20 )
      goto LABEL_32;
LABEL_28:
    m_pAnimBlendHierarchy = v19->m_pAnimBlendHierarchy;
    m_fCurrentTime = v19->m_fCurrentTime;
    v19->m_fBlendDelta = (float)(1.0 - v19->m_fBlendAmount) * v11;
    if ( m_fCurrentTime == m_pAnimBlendHierarchy->m_fTotalTime )
      CAnimBlendAssociation::Start(v19, 0.0);
    goto LABEL_45;
  }
  v37 = 0;
LABEL_32:
  v19 = CAnimBlendAssocGroup::CopyAnimation(
          (CAnimBlendAssocGroup *)((char *)CAnimManager::ms_aAnimAssocGroups + 4 * v34),
          animId);
  v28 = v15 == 0;
  v29 = *(ListLink **)(&pClump->object.type + ClumpOffset);
  if ( v15 )
    v28 = (v19->m_bitsFlag & 0x20) == 0;
  if ( v28 )
  {
    CAnimBlendAssociation::Start(v19, 0.0);
  }
  else
  {
    CAnimBlendAssociation::SyncAnimation(v19, v15);
    v19->m_bitsFlag |= 1u;
  }
  p_m_list = &v19->m_list;
  if ( v29->pNext )
  {
    v29->pNext->pPrev = p_m_list;
    pNext = v29->pNext;
  }
  else
  {
    pNext = 0;
  }
  v32 = v12 == 0;
  v19->m_list.pNext = pNext;
  v19->m_list.pPrev = v29;
  v29->pNext = p_m_list;
  if ( !v12 )
    v32 = v37 == 0;
  if ( !v32 )
  {
    v19->m_fBlendDelta = v11;
    v19->m_fBlendAmount = 0.0;
LABEL_45:
    CAnimManager::UncompressAnimation(v19->m_pAnimBlendHierarchy);
    return v19;
  }
  v19->m_fBlendAmount = 1.0;
  return v19;
}
// 38E452: variable 'v5' is possibly undefined
// 38E452: variable 'v4' is possibly undefined

//----- (0038E560) --------------------------------------------------------
void CAnimManager::LoadAnimFiles()
{
  RwStream_0 *v0; // r4
  int v1; // r4
  _QWORD *v2; // r0
  __int64 v3; // r4
  int v4; // r5
  CAnimBlendAssocGroup *v5; // r0
  CAnimBlendAssocGroup *v6; // r0
  double v7[32]; // [sp+0h] [bp-110h] BYREF

  strcpy((char *)((unsigned int)v7 | 5), "PED.IFP");
  v7[0] = *(double *)"ANIM\\PED.IFP";
  v0 = RwStreamOpen(rwSTREAMFILENAME, rwSTREAMREAD, v7);
  CAnimManager::LoadAnimFile(v0, 1, 0);
  RwStreamClose(v0, 0);
  v1 = 20;
  HIDWORD(v3) = CAnimManager::ms_numAnimAssocDefinitions;
  v2 = (_QWORD *)operator new[](saturated_mul(0x14u, CAnimManager::ms_numAnimAssocDefinitions));
  *v2 = v3;
  LODWORD(v3) = v2 + 1;
  if ( HIDWORD(v3) )
  {
    v4 = 20 * HIDWORD(v3);
    v5 = (CAnimBlendAssocGroup *)(v2 + 1);
    do
    {
      CAnimBlendAssocGroup::CAnimBlendAssocGroup(v5);
      v4 -= 20;
      v5 = v6 + 1;
    }
    while ( v4 );
  }
  CAnimManager::ms_aAnimAssocGroups = (CAnimBlendAssocGroup *)v3;
  CAnimManager::CreateAnimAssocGroups();
}
// 38E5EC: variable 'v6' is possibly undefined

//----- (0038E628) --------------------------------------------------------
void __fastcall CAnimManager::LoadAnimFile(const unsigned __int8 *pShortName)
{
  RwStream_0 *v1; // r4
  char v2[260]; // [sp+0h] [bp-110h] BYREF

  strcpy(v2, (const char *)pShortName);
  v1 = RwStreamOpen(rwSTREAMFILENAME, rwSTREAMREAD, v2);
  CAnimManager::LoadAnimFile(v1, 1, 0);
  RwStreamClose(v1, 0);
}

//----- (0038E688) --------------------------------------------------------
void CAnimManager::CreateAnimAssocGroups()
{
  int32 v0; // r4
  int32 v1; // r8
  int32 v2; // r9
  CAnimBlock *v3; // r5
  unsigned __int8 *pBlockName; // r6
  bool v5; // zf
  CAnimBlendAssocGroup *v6; // r0
  int32 associatedClumpId; // r1
  RpClump_0 *v8; // r5
  CAnimBlendAssocGroup *v9; // r0
  CAnimManager::AnimAssocDefinition *v10; // r11
  CAnimManager::AnimDescriptor **p_aAnimDesc; // r11
  int32 *aAnimDesc; // t1
  CAnimBlendAssocGroup *v13; // r0
  unsigned int v14; // r6
  CAnimManager::AnimDescriptor *v15; // r5
  CAnimBlendStaticAssociation *Animation; // r0
  CAnimManager::AnimDescriptor *v17; // r2
  RpAtomic_0 *FirstAtomic; // r0
  RpClump_0 *v19; // [sp+20h] [bp-30h]

  if ( CAnimManager::ms_numAnimAssocDefinitions >= 1 )
  {
    v0 = 0;
    do
    {
      v1 = CAnimManager::ms_numAnimBlocks;
      if ( CAnimManager::ms_numAnimBlocks >= 1 )
      {
        v2 = 0;
        v3 = CAnimManager::ms_aAnimBlocks;
        pBlockName = CAnimManager::ms_aAnimAssocDefinitions[v0].pBlockName;
        while ( strcasecmp((const char *)v3, (const char *)pBlockName) )
        {
          ++v2;
          ++v3;
          if ( v2 >= v1 )
            goto LABEL_23;
        }
        v5 = v3 == 0;
        if ( v3 )
          v5 = !v3->m_loaded;
        if ( !v5 )
        {
          v6 = CAnimManager::ms_aAnimAssocGroups;
          if ( !CAnimManager::ms_aAnimAssocGroups[v0].m_aAssociationArray )
          {
            associatedClumpId = CAnimManager::ms_aAnimAssocDefinitions[v0].associatedClumpId;
            if ( associatedClumpId == -1 )
            {
              v8 = 0;
            }
            else
            {
              v8 = (RpClump_0 *)(*((int (__fastcall **)(CBaseModelInfo *))CModelInfo::ms_modelInfoPtrs[associatedClumpId]->_vptr$CBaseModelInfo
                                 + 11))(CModelInfo::ms_modelInfoPtrs[associatedClumpId]);
              RpAnimBlendClumpInit(v8);
              v6 = CAnimManager::ms_aAnimAssocGroups;
            }
            v9 = &v6[v0];
            v9->m_grpId = v0;
            v10 = &CAnimManager::ms_aAnimAssocDefinitions[v0];
            aAnimDesc = (int32 *)v10->aAnimDesc;
            p_aAnimDesc = &v10->aAnimDesc;
            v9->m_idOffset = *aAnimDesc;
            v19 = v8;
            CAnimBlendAssocGroup::CreateAssociations(
              v9,
              pBlockName,
              v8,
              (const unsigned __int8 **)*(p_aAnimDesc - 1),
              (signed int)*(p_aAnimDesc - 2));
            v13 = CAnimManager::ms_aAnimAssocGroups;
            if ( CAnimManager::ms_aAnimAssocGroups[v0].m_numAssociations )
            {
              v14 = 0;
              do
              {
                v15 = *p_aAnimDesc;
                Animation = CAnimBlendAssocGroup::GetAnimation(&v13[v0], (*p_aAnimDesc)[v14].id);
                v17 = &v15[v14++];
                Animation->m_bitsFlag |= v17->defaultFlags;
                v13 = CAnimManager::ms_aAnimAssocGroups;
              }
              while ( v14 < CAnimManager::ms_aAnimAssocGroups[v0].m_numAssociations );
            }
            if ( v19 )
            {
              FirstAtomic = GetFirstAtomic(v19);
              if ( FirstAtomic )
              {
                if ( j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
                  RpClumpForAllAtomics(v19, AtomicRemoveAnimFromSkinCB, 0);
              }
              RpClumpDestroy(v19);
            }
          }
        }
      }
LABEL_23:
      ++v0;
    }
    while ( v0 < CAnimManager::ms_numAnimAssocDefinitions );
  }
}

//----- (0038E84C) --------------------------------------------------------
CAnimManager::AnimAssocDefinition *__fastcall CAnimManager::AddAnimAssocDefinition(
        const unsigned __int8 *pName,
        const unsigned __int8 *pFile,
        uint32 modelId,
        uint32 numAnims,
        CAnimManager::AnimDescriptor *a5)
{
  int32 v8; // r6
  CAnimManager::AnimAssocDefinition *v9; // r5
  int v10; // t1
  CAnimManager::AnimAssocDefinition *v11; // r6
  __int64 v12; // r0
  const unsigned __int8 **v13; // r8
  const unsigned __int8 *v14; // r0
  const unsigned __int8 ***p_aReqAnims; // r1
  const unsigned __int8 *v16; // r0
  int v17; // r3
  const unsigned __int8 *v18; // r6
  int v19; // r0

  v8 = CAnimManager::ms_numAnimAssocDefinitions;
  if ( CAnimManager::ms_aAnimAssocDefinitions[CAnimManager::ms_numAnimAssocDefinitions].pName[0] )
  {
    v9 = &CAnimManager::ms_aAnimAssocDefinitions[CAnimManager::ms_numAnimAssocDefinitions];
    do
    {
      v10 = v9[1].pName[0];
      ++v9;
      ++v8;
    }
    while ( v10 );
    CAnimManager::ms_numAnimAssocDefinitions = v8;
  }
  else
  {
    v9 = &CAnimManager::ms_aAnimAssocDefinitions[CAnimManager::ms_numAnimAssocDefinitions];
  }
  strcpy((char *)v9, (const char *)pName);
  v11 = &CAnimManager::ms_aAnimAssocDefinitions[v8];
  strcpy((char *)v11->pBlockName, (const char *)pFile);
  v11->associatedClumpId = modelId;
  v11->numReqAnims = numAnims;
  v12 = 4LL * numAnims;
  v11->aAnimDesc = a5;
  if ( !is_mul_ok(4u, numAnims) )
    HIDWORD(v12) = 1;
  if ( HIDWORD(v12) )
    LODWORD(v12) = -1;
  v13 = (const unsigned __int8 **)operator new[](v12);
  v11->aReqAnims = v13;
  v14 = (const unsigned __int8 *)operator new[](24 * numAnims);
  if ( numAnims )
  {
    p_aReqAnims = &v11->aReqAnims;
    *v13 = v14;
    **(_BYTE **)v11->aReqAnims = 0;
    if ( numAnims != 1 )
    {
      v16 = v14 + 24;
      v17 = 1;
      do
      {
        (*p_aReqAnims)[v17] = v16;
        v16 += 24;
        v18 = (*p_aReqAnims)[v17++];
        *v18 = 0;
      }
      while ( numAnims != v17 );
    }
  }
  v19 = CAnimManager::ms_numAnimAssocDefinitions + 1;
  if ( CAnimManager::ms_numAnimAssocDefinitions++ < 144 )
    CAnimManager::ms_aAnimAssocDefinitions[v19].pName[0] = 0;
  return v9;
}

//----- (0038E960) --------------------------------------------------------
void __fastcall CAnimManager::AddAnimToAssocDefinition(
        CAnimManager::AnimAssocDefinition *pDef,
        const unsigned __int8 *pName)
{
  const unsigned __int8 **aReqAnims; // r2
  char *v3; // r0
  char *v4; // t1

  aReqAnims = pDef->aReqAnims;
  do
  {
    v4 = (char *)*aReqAnims++;
    v3 = v4;
  }
  while ( *v4 );
  sub_19B9DC(v3, (const char *)pName);
}

//----- (0038E970) --------------------------------------------------------
int32 __fastcall CAnimManager::RegisterAnimBlock(const unsigned __int8 *pName)
{
  int32 v2; // r8
  int32 v3; // r6
  CAnimBlock *v4; // r4
  AssocGroupId v5; // r6
  unsigned __int8 *pBlockName; // r5

  v2 = CAnimManager::ms_numAnimBlocks;
  if ( CAnimManager::ms_numAnimBlocks < 1 )
    goto LABEL_7;
  v3 = 0;
  v4 = CAnimManager::ms_aAnimBlocks;
  while ( strcasecmp((const char *)v4, (const char *)pName) )
  {
    ++v3;
    ++v4;
    if ( v3 >= v2 )
      goto LABEL_7;
  }
  if ( !v4 )
  {
LABEL_7:
    v4 = &CAnimManager::ms_aAnimBlocks[v2];
    CAnimManager::ms_numAnimBlocks = v2 + 1;
    strncpy((char *)v4, (const char *)pName, 0x10u);
    v5 = ANIM_STD_PED;
    v4->m_numAnims = 0;
    pBlockName = CAnimManager::ms_aAnimAssocDefinitions[0].pBlockName;
    while ( strcasecmp((const char *)pBlockName, (const char *)&CAnimManager::ms_aAnimBlocks[v2]) )
    {
      pBlockName += 48;
      if ( v5++ >= ANIM_VEH_NEVADA )
      {
        v5 = ANIM_NUM_ASSOCGROUPS;
        break;
      }
    }
    CAnimManager::ms_aAnimBlocks[v2].m_firstAssocGroup = v5;
  }
  return v4 - CAnimManager::ms_aAnimBlocks;
}

//----- (0038EA3C) --------------------------------------------------------
void __fastcall CAnimManager::LoadAnimFile(
        RwStream_0 *pStream,
        bool bLoadCompressed,
        const unsigned __int8 (*pLoadUncompressed)[32])
{
  RwUInt32 v3; // r2
  int32 v4; // r8
  int32 v5; // r6
  CAnimBlock *v6; // r4
  int32 v7; // r9
  int32 v8; // r4
  CAnimBlock *v9; // r6
  RwInt32 v10; // r8
  AssocGroupId v11; // r4
  unsigned __int8 *pBlockName; // r5
  bool v13; // cc
  RwStream_0 *v14; // r5
  int32 m_animIndex; // r9
  int v16; // r4
  int32 v17; // r11
  uint8 *pKeyMem; // r8
  unsigned int v19; // r6
  _DWORD *v20; // r0
  CAnimBlendSequence *v21; // r10
  int v22; // r6
  CAnimBlendSequence *v23; // r0
  CAnimBlendSequence *v24; // r0
  CAnimBlendHierarchy *v25; // r9
  CAnimBlendSequence **p_m_pSequences; // r9
  CAnimBlendSequence *v27; // r4
  int v28; // r0
  CAnimBlendHierarchy *v29; // r6
  bool *p_m_bIsCompressed; // r6
  RwInt32 v31; // r4
  int v32; // r6
  CAnimBlendSequence *v33; // r10
  int32 v34; // r9
  RwStream_0 *v35; // r5
  CAnimBlock *v36; // r4
  AssocGroupId v37; // r6
  int32 v38; // r2
  unsigned __int8 *v39; // r5
  int v40; // r0
  int32 v41; // r4
  RwUInt32 v42; // r2
  int32 v43; // r10
  CAnimBlendHierarchy *v44; // r9
  int v45; // r0
  bool v46; // r6
  const unsigned __int8 (*v47)[32]; // r5
  uint32 UppercaseKey; // r0
  int v49; // r2
  int v50; // t1
  char v51; // r2
  CAnimBlendHierarchy *v52; // r0
  RwUInt32 v53; // r2
  int v54; // r4
  __int64 v55; // kr10_8
  unsigned int v56; // r0
  _DWORD *v57; // r0
  CAnimBlendSequence *v58; // r5
  int v59; // r6
  CAnimBlendSequence *v60; // r0
  CAnimBlendSequence *v61; // r0
  CAnimBlendHierarchy *v62; // r0
  int v63; // r6
  RwUInt32 v64; // r2
  CAnimBlendSequence *v65; // r4
  int16 *p_m_iNumKeyFrames; // r10
  uint8 **p_m_pKeyFrames; // r0
  uint16 *p_m_bitsFlag; // r4
  int v69; // r5
  int v70; // r6
  int v71; // r8
  int v72; // r11
  int v73; // r9
  uint8 *v74; // r0
  int v75; // r2
  float v76; // s2
  int v77; // r1
  float v78; // s6
  int v79; // s4
  uint8 *v80; // r0
  float v81; // s0
  float v82; // s10
  float v83; // s8
  float v84; // s6
  uint8 *v85; // r0
  int v86; // r2
  float v87; // r1
  bool v88; // zf
  int v89; // r2
  float v90; // s12
  float v91; // s6
  float v92; // s12
  float v93; // s8
  float v94; // s10
  int v95; // s4
  int v96; // s0
  int v97; // r1
  __int16 v98; // r1
  __int16 v99; // r1
  float v100; // s2
  float v101; // s0
  int v102; // r2
  float v103; // s4
  uint8 *v104; // r0
  __int64 v105; // d16
  float v106; // r1
  uint8 *v107; // r0
  int v108; // r2
  int v109; // r1
  float v110; // s6
  int v111; // s4
  int v112; // s2
  int v113; // r2
  __int64 v114; // d16
  float v115; // s2
  float v116; // s0
  int v117; // r2
  float v118; // s4
  char *v119; // [sp+1Ch] [bp-1ECh]
  bool *v120; // [sp+20h] [bp-1E8h]
  int32 v121; // [sp+20h] [bp-1E8h]
  int i; // [sp+24h] [bp-1E4h]
  _BOOL4 v123; // [sp+28h] [bp-1E0h]
  int v125; // [sp+30h] [bp-1D8h]
  CAnimBlendHierarchy *v126; // [sp+34h] [bp-1D4h]
  CAnimBlendSequence **v127; // [sp+38h] [bp-1D0h]
  int v128; // [sp+3Ch] [bp-1CCh]
  int v129; // [sp+40h] [bp-1C8h]
  CAnimBlendHierarchy *v130; // [sp+44h] [bp-1C4h]
  CAnimBlendHierarchy *v131; // [sp+44h] [bp-1C4h]
  int v132; // [sp+48h] [bp-1C0h]
  uint8 **v133; // [sp+48h] [bp-1C0h]
  int32 v134; // [sp+4Ch] [bp-1BCh]
  int v135; // [sp+4Ch] [bp-1BCh]
  int bCompressed; // [sp+50h] [bp-1B8h]
  _BOOL4 bCompresseda; // [sp+50h] [bp-1B8h]
  RwInt32 ints; // [sp+58h] [bp-1B0h] BYREF
  float v140; // [sp+5Ch] [bp-1ACh]
  float v141; // [sp+60h] [bp-1A8h]
  float v142; // [sp+64h] [bp-1A4h]
  __int64 v143; // [sp+68h] [bp-1A0h]
  float v144; // [sp+70h] [bp-198h]
  float v145; // [sp+74h] [bp-194h]
  float v146; // [sp+80h] [bp-188h]
  RwInt32 tag; // [sp+84h] [bp-184h] BYREF
  RwInt32 v148; // [sp+88h] [bp-180h] BYREF
  RwInt32 iNumKeyFrames; // [sp+8Ch] [bp-17Ch] BYREF
  RwInt32 v150; // [sp+90h] [bp-178h] BYREF
  RwInt32 v151; // [sp+94h] [bp-174h] BYREF
  int v152; // [sp+98h] [bp-170h]
  RwInt32 v153; // [sp+9Ch] [bp-16Ch] BYREF
  int v154; // [sp+A0h] [bp-168h]
  char buffer[4]; // [sp+A4h] [bp-164h] BYREF
  int v156; // [sp+A8h] [bp-160h]
  char v157[4]; // [sp+ACh] [bp-15Ch] BYREF
  char v158[24]; // [sp+B0h] [bp-158h] BYREF
  int32 v159; // [sp+C8h] [bp-140h]
  int32 v160; // [sp+D4h] [bp-134h]

  v123 = bLoadCompressed;
  RwStreamRead(pStream, buffer, 8u);
  if ( !strncmp(buffer, "ANP2", 4u) || !strncmp(buffer, "ANP3", 4u) )
  {
    bCompressed = strncmp(buffer, "ANP3", 4u);
    RwStreamRead(pStream, v157, 0x18u);
    RwStreamReadInt32(pStream, &ints, 4u);
    v7 = CAnimManager::ms_numAnimBlocks;
    if ( CAnimManager::ms_numAnimBlocks < 1 )
      goto LABEL_20;
    v8 = 0;
    v9 = CAnimManager::ms_aAnimBlocks;
    while ( strcasecmp((const char *)v9, v157) )
    {
      ++v8;
      ++v9;
      if ( v8 >= v7 )
        goto LABEL_20;
    }
    if ( v9 )
    {
      v10 = ints;
      if ( !v9->m_numAnims )
      {
        v9->m_numAnims = ints;
        v9->m_animIndex = CAnimManager::ms_numAnimations;
      }
    }
    else
    {
LABEL_20:
      v9 = &CAnimManager::ms_aAnimBlocks[v7];
      CAnimManager::ms_numAnimBlocks = v7 + 1;
      strncpy((char *)v9, v157, 0x10u);
      v11 = ANIM_STD_PED;
      v10 = ints;
      pBlockName = CAnimManager::ms_aAnimAssocDefinitions[0].pBlockName;
      v9->m_animIndex = CAnimManager::ms_numAnimations;
      v9->m_numAnims = v10;
      while ( strcasecmp((const char *)pBlockName, (const char *)&CAnimManager::ms_aAnimBlocks[v7]) )
      {
        pBlockName += 48;
        v13 = v11++ < ANIM_VEH_NEVADA;
        if ( !v13 )
        {
          v11 = ANIM_NUM_ASSOCGROUPS;
          break;
        }
      }
      CAnimManager::ms_aAnimBlocks[v7].m_firstAssocGroup = v11;
    }
    v14 = pStream;
    m_animIndex = v9->m_animIndex;
    v9->m_loaded = 1;
    if ( v10 < 1 )
    {
LABEL_68:
      if ( m_animIndex > CAnimManager::ms_numAnimations )
        CAnimManager::ms_numAnimations = m_animIndex;
      return;
    }
    v16 = 0;
    v129 = v9 - CAnimManager::ms_aAnimBlocks;
    while ( 1 )
    {
      RwStreamRead(v14, v157, 0x18u);
      RwStreamReadInt32(v14, &v153, 4u);
      v17 = m_animIndex;
      if ( bCompressed )
      {
        pKeyMem = 0;
      }
      else
      {
        RwStreamReadInt32(v14, &v151, 4u);
        RwStreamReadInt32(v14, &v150, 4u);
        CAnimManager::ms_aAnimations[m_animIndex].m_bIsCompressed = v150 & 1;
        pKeyMem = (uint8 *)CMemoryMgr::Malloc(v151);
      }
      v130 = &CAnimManager::ms_aAnimations[m_animIndex];
      CAnimBlendHierarchy::SetName(v130, (const unsigned __int8 *)v157);
      v19 = v153;
      v130->m_bRunCompressed = 0;
      v130->m_animBlock = v129;
      v130->m_NumSequences = v19;
      v20 = (_DWORD *)operator new[](saturated_mul(0xCu, v19));
      v21 = (CAnimBlendSequence *)(v20 + 2);
      *v20 = 12;
      v20[1] = v19;
      v132 = v16;
      v134 = m_animIndex;
      if ( !v19 )
        break;
      v22 = 12 * v19;
      v23 = (CAnimBlendSequence *)(v20 + 2);
      do
      {
        CAnimBlendSequence::CAnimBlendSequence(v23);
        v22 -= 12;
        v23 = v24 + 1;
      }
      while ( v22 );
      v25 = &CAnimManager::ms_aAnimations[m_animIndex];
      v13 = v153 <= 0;
      v25->m_pSequences = v21;
      p_m_pSequences = &v25->m_pSequences;
      if ( v13 )
        goto LABEL_38;
      RwStreamRead(pStream, v157, 0x18u);
      RwStreamReadInt32(pStream, &v148, 4u);
      RwStreamReadInt32(pStream, &iNumKeyFrames, 4u);
      RwStreamReadInt32(pStream, &tag, 4u);
      v27 = *p_m_pSequences;
      CAnimBlendSequence::SetName(*p_m_pSequences, (const unsigned __int8 *)v157);
      CAnimBlendSequence::SetBoneTag(v27, tag);
      v28 = v148 - 1;
      v29 = &CAnimManager::ms_aAnimations[v17];
      v29->m_bIsCompressed = (unsigned int)(v148 - 1) > 1;
      p_m_bIsCompressed = &v29->m_bIsCompressed;
      switch ( v28 )
      {
        case 0:
          CAnimBlendSequence::SetNumFrames(v27, iNumKeyFrames, 0, 0, pKeyMem);
          v14 = pStream;
          RwStreamRead(pStream, v27->m_pKeyFrames, 20 * iNumKeyFrames);
          if ( !bCompressed )
          {
            pKeyMem += 20 * iNumKeyFrames;
            goto LABEL_47;
          }
          break;
        case 1:
          CAnimBlendSequence::SetNumFrames(v27, iNumKeyFrames, 1, 0, pKeyMem);
          v14 = pStream;
          RwStreamRead(pStream, v27->m_pKeyFrames, 32 * iNumKeyFrames);
          if ( !bCompressed )
          {
            pKeyMem += 32 * iNumKeyFrames;
            goto LABEL_47;
          }
          break;
        case 2:
          CAnimBlendSequence::SetNumFrames(v27, iNumKeyFrames, 0, 1, pKeyMem);
          v14 = pStream;
          RwStreamRead(pStream, v27->m_pKeyFrames, 10 * iNumKeyFrames);
          if ( !bCompressed )
          {
            pKeyMem += 10 * iNumKeyFrames;
            goto LABEL_47;
          }
          break;
        case 3:
          CAnimBlendSequence::SetNumFrames(v27, iNumKeyFrames, 1, 1, pKeyMem);
          v14 = pStream;
          RwStreamRead(pStream, v27->m_pKeyFrames, 16 * iNumKeyFrames);
          if ( !bCompressed )
          {
            pKeyMem += 16 * iNumKeyFrames;
            goto LABEL_47;
          }
          break;
        default:
          v14 = pStream;
          if ( !bCompressed )
LABEL_47:
            v27->m_bitsFlag |= 8u;
          break;
      }
      if ( v153 >= 2 )
      {
        v120 = p_m_bIsCompressed;
        v31 = 1;
        v32 = 0;
        do
        {
          RwStreamRead(v14, v157, 0x18u);
          RwStreamReadInt32(v14, &v148, 4u);
          RwStreamReadInt32(v14, &iNumKeyFrames, 4u);
          RwStreamReadInt32(v14, &tag, 4u);
          v33 = &(*p_m_pSequences)[v32];
          CAnimBlendSequence::SetName(v33 + 1, (const unsigned __int8 *)v157);
          CAnimBlendSequence::SetBoneTag(v33 + 1, tag);
          switch ( v148 )
          {
            case 1:
              CAnimBlendSequence::SetNumFrames(v33 + 1, iNumKeyFrames, 0, 0, pKeyMem);
              v14 = pStream;
              RwStreamRead(pStream, v33[1].m_pKeyFrames, 20 * iNumKeyFrames);
              if ( !bCompressed )
              {
                pKeyMem += 20 * iNumKeyFrames;
                goto LABEL_61;
              }
              break;
            case 2:
              CAnimBlendSequence::SetNumFrames(v33 + 1, iNumKeyFrames, 1, 0, pKeyMem);
              v14 = pStream;
              RwStreamRead(pStream, v33[1].m_pKeyFrames, 32 * iNumKeyFrames);
              if ( !bCompressed )
              {
                pKeyMem += 32 * iNumKeyFrames;
                goto LABEL_61;
              }
              break;
            case 3:
              CAnimBlendSequence::SetNumFrames(v33 + 1, iNumKeyFrames, 0, 1, pKeyMem);
              v14 = pStream;
              RwStreamRead(pStream, v33[1].m_pKeyFrames, 10 * iNumKeyFrames);
              if ( !bCompressed )
              {
                pKeyMem += 10 * iNumKeyFrames;
                goto LABEL_61;
              }
              break;
            case 4:
              CAnimBlendSequence::SetNumFrames(v33 + 1, iNumKeyFrames, 1, 1, pKeyMem);
              v14 = pStream;
              RwStreamRead(pStream, v33[1].m_pKeyFrames, 16 * iNumKeyFrames);
              if ( !bCompressed )
              {
                pKeyMem += 16 * iNumKeyFrames;
                goto LABEL_61;
              }
              break;
            default:
              v14 = pStream;
              if ( !bCompressed )
LABEL_61:
                v33[1].m_bitsFlag |= 8u;
              break;
          }
          ++v31;
          ++v32;
        }
        while ( v31 < v153 );
        v34 = v134;
        p_m_bIsCompressed = v120;
        goto LABEL_65;
      }
LABEL_64:
      v34 = v134;
LABEL_65:
      m_animIndex = v34 + 1;
      if ( !*p_m_bIsCompressed )
      {
        CAnimBlendHierarchy::RemoveQuaternionFlips(v130);
        CAnimBlendHierarchy::CalcTotalTime(v130);
      }
      v16 = v132 + 1;
      if ( v132 + 1 >= ints )
        goto LABEL_68;
    }
    CAnimManager::ms_aAnimations[m_animIndex].m_pSequences = v21;
LABEL_38:
    v14 = pStream;
    p_m_bIsCompressed = &CAnimManager::ms_aAnimations[v17].m_bIsCompressed;
    goto LABEL_64;
  }
  if ( (v156 & 3) != 0 )
    v156 = v156 + 4 - (v156 & 3);
  RwStreamRead(pStream, &v151, 8u);
  v3 = v152;
  if ( (v152 & 3) != 0 )
  {
    v3 = v152 + 4 - (v152 & 3);
    v152 = v3;
  }
  RwStreamRead(pStream, v157, v3);
  v4 = CAnimManager::ms_numAnimBlocks;
  if ( CAnimManager::ms_numAnimBlocks < 1 )
    goto LABEL_73;
  v5 = 0;
  v6 = CAnimManager::ms_aAnimBlocks;
  while ( strcasecmp((const char *)v6, v158) )
  {
    ++v5;
    ++v6;
    if ( v5 >= v4 )
      goto LABEL_73;
  }
  if ( v6 )
  {
    v35 = pStream;
    v119 = (char *)v6;
    if ( !v6->m_numAnims )
    {
      v6->m_numAnims = *(_DWORD *)v157;
      v6->m_animIndex = CAnimManager::ms_numAnimations;
    }
  }
  else
  {
LABEL_73:
    v36 = &CAnimManager::ms_aAnimBlocks[v4];
    CAnimManager::ms_numAnimBlocks = v4 + 1;
    strncpy((char *)v36, v158, 0x10u);
    v37 = ANIM_STD_PED;
    v38 = *(_DWORD *)v157;
    v119 = (char *)v36;
    v39 = CAnimManager::ms_aAnimAssocDefinitions[0].pBlockName;
    v36->m_animIndex = CAnimManager::ms_numAnimations;
    v36->m_numAnims = v38;
    while ( strcasecmp((const char *)v39, (const char *)v36) )
    {
      v39 += 48;
      v13 = v37++ < ANIM_VEH_NEVADA;
      if ( !v13 )
      {
        v37 = ANIM_NUM_ASSOCGROUPS;
        break;
      }
    }
    v35 = pStream;
    CAnimManager::ms_aAnimBlocks[v4].m_firstAssocGroup = v37;
  }
  v40 = *((_DWORD *)v119 + 6);
  v41 = *((_DWORD *)v119 + 5);
  v119[16] = 1;
  if ( v40 >= 1 )
  {
    for ( i = 0; i < *((_DWORD *)v119 + 6); ++i )
    {
      RwStreamRead(v35, &v151, 8u);
      v42 = v152;
      if ( (v152 & 3) != 0 )
      {
        v42 = v152 + 4 - (v152 & 3);
        v152 = v42;
      }
      RwStreamRead(v35, v157, v42);
      v43 = v41;
      v121 = v41;
      v44 = &CAnimManager::ms_aAnimations[v41];
      CAnimBlendHierarchy::SetName(v44, (const unsigned __int8 *)v157);
      v44->m_animBlock = (v119 - (char *)CAnimManager::ms_aAnimBlocks) >> 5;
      v45 = v123;
      if ( pLoadUncompressed )
      {
        v46 = v123;
        if ( (*pLoadUncompressed)[0] )
        {
          v46 = v123;
          v47 = pLoadUncompressed;
          do
          {
            UppercaseKey = CKeyGen::GetUppercaseKey((const unsigned __int8 *)v47);
            v50 = (*v47++)[32];
            v49 = v50;
            if ( UppercaseKey == v44->m_hashKey )
              v46 = 0;
          }
          while ( v49 );
        }
        v35 = pStream;
        v45 = v46;
      }
      v51 = v45;
      bCompresseda = v45;
      v52 = &CAnimManager::ms_aAnimations[v41];
      v52->m_bRunCompressed = 0;
      v52->m_bIsCompressed = v51;
      RwStreamRead(v35, &v153, 8u);
      if ( (v154 & 3) != 0 )
        v154 = v154 + 4 - (v154 & 3);
      RwStreamRead(v35, &v151, 8u);
      v53 = v152;
      if ( (v152 & 3) != 0 )
      {
        v53 = v152 + 4 - (v152 & 3);
        v152 = v53;
      }
      RwStreamRead(v35, v157, v53);
      v54 = *(_DWORD *)v157;
      v55 = 12LL * *(unsigned int *)v157;
      CAnimManager::ms_aAnimations[v43].m_NumSequences = *(_WORD *)v157;
      v56 = v55 + 8;
      if ( (int)v55 + 8 < (unsigned int)v55 )
        v56 = -1;
      if ( HIDWORD(v55) )
        v56 = -1;
      v57 = (_DWORD *)operator new[](v56);
      *v57 = 12;
      v57[1] = v54;
      v58 = (CAnimBlendSequence *)(v57 + 2);
      if ( v54 )
      {
        v59 = 12 * v54;
        v60 = (CAnimBlendSequence *)(v57 + 2);
        do
        {
          CAnimBlendSequence::CAnimBlendSequence(v60);
          v59 -= 12;
          v60 = v61 + 1;
        }
        while ( v59 );
        v62 = &CAnimManager::ms_aAnimations[v43];
        v62->m_pSequences = v58;
        v127 = &v62->m_pSequences;
        if ( v54 >= 1 )
        {
          v63 = 0;
          v125 = v54;
          v126 = v44;
          while ( 1 )
          {
            CheckForPump();
            RwStreamRead(pStream, &v151, 8u);
            if ( (v152 & 3) != 0 )
              v152 = v152 + 4 - (v152 & 3);
            RwStreamRead(pStream, &v151, 8u);
            v64 = v152;
            if ( (v152 & 3) != 0 )
            {
              v64 = v152 + 4 - (v152 & 3);
              v152 = v64;
            }
            RwStreamRead(pStream, v157, v64);
            v128 = v63;
            v65 = &(*v127)[v63];
            CAnimBlendSequence::SetName(v65, (const unsigned __int8 *)v157);
            if ( v152 == 44 )
              CAnimBlendSequence::SetBoneTag(v65, v160);
            if ( v159 )
            {
              RwStreamRead(pStream, &v151, 8u);
              if ( !strncmp((const char *)&v151, "KRTS", 4u) )
              {
                v131 = 0;
                v135 = 1;
                CAnimBlendSequence::SetNumFrames(v65, v159, 1, bCompresseda, 0);
              }
              else if ( !strncmp((const char *)&v151, "KRT0", 4u) )
              {
                v135 = 0;
                v131 = (CAnimBlendHierarchy *)(&dword_0 + 1);
                CAnimBlendSequence::SetNumFrames(v65, v159, 1, bCompresseda, 0);
              }
              else
              {
                v135 = 0;
                v131 = 0;
                if ( !strncmp((const char *)&v151, "KR00", 4u) )
                {
                  CAnimBlendSequence::SetNumFrames(v65, v159, 0, bCompresseda, 0);
                  v131 = 0;
                }
              }
              p_m_iNumKeyFrames = &v65->m_iNumKeyFrames;
              if ( v65->m_iNumKeyFrames >= 1 )
                break;
            }
LABEL_155:
            v44 = v126;
            v63 = v128 + 1;
            if ( v128 + 1 == v125 )
              goto LABEL_158;
          }
          p_m_pKeyFrames = &v65->m_pKeyFrames;
          p_m_bitsFlag = &v65->m_bitsFlag;
          v69 = 0;
          v70 = 0;
          v71 = 0;
          v72 = 0;
          v73 = 0;
          v133 = p_m_pKeyFrames;
          while ( 2 )
          {
            if ( v135 == 1 )
            {
              RwStreamRead(pStream, &ints, 0x2Cu);
              v74 = *v133;
              v75 = *p_m_bitsFlag & 2;
              if ( bCompresseda )
              {
                v76 = v140 * -4096.0;
                v77 = v69;
                v78 = v142 * 4096.0;
                v79 = (int)(float)(v141 * -4096.0);
                if ( v75 )
                  v77 = v70;
                *(_WORD *)&v74[v77] = (int)(float)(*(float *)&ints * -4096.0);
                v80 = &v74[v77];
                *((_WORD *)v80 + 1) = (int)v76;
                *((_WORD *)v80 + 2) = v79;
                *((_WORD *)v80 + 3) = (int)v78;
                *((_WORD *)v80 + 5) = (int)(float)(*(float *)&v143 * 1024.0);
                *((_WORD *)v80 + 6) = (int)(float)(*((float *)&v143 + 1) * 1024.0);
                *((_WORD *)v80 + 7) = (int)(float)(v144 * 1024.0);
                v81 = v146;
                goto LABEL_146;
              }
              v100 = -v140;
              v88 = v75 == 0;
              v101 = -*(float *)&ints;
              v102 = v71;
              v103 = -v141;
              if ( !v88 )
                v102 = v72;
              v104 = &v74[v102];
              *((float *)v104 + 3) = v142;
              *(float *)v104 = v101;
              *((float *)v104 + 1) = v100;
              *((float *)v104 + 2) = v103;
              v105 = v143;
              *((float *)v104 + 7) = v144;
              *(_QWORD *)(v104 + 20) = v105;
              v106 = v146;
LABEL_153:
              *((float *)v104 + 4) = v106;
            }
            else
            {
              if ( v131 == (CAnimBlendHierarchy *)((char *)&dword_0 + 1) )
              {
                RwStreamRead(pStream, &ints, 0x20u);
                v82 = -*(float *)&ints;
                v83 = -v140;
                v84 = -v141;
                v85 = *v133;
                v86 = *p_m_bitsFlag & 2;
                v87 = v142;
                if ( !bCompresseda )
                {
                  v88 = v86 == 0;
                  v113 = v71;
                  if ( !v88 )
                    v113 = v72;
                  v104 = &v85[v113];
                  *(float *)v104 = v82;
                  *((float *)v104 + 1) = v83;
                  *((float *)v104 + 2) = v84;
                  *((float *)v104 + 3) = v87;
                  v114 = v143;
                  *((float *)v104 + 7) = v144;
                  *(_QWORD *)(v104 + 20) = v114;
                  v106 = v145;
                  goto LABEL_153;
                }
                v88 = v86 == 0;
                v89 = v69;
                v90 = fabsf(*(float *)&v143);
                if ( !v88 )
                  v89 = v70;
                v80 = &v85[v89];
                v91 = fabsf(v84);
                if ( v90 > 32.0 )
                  LODWORD(v143) = 0;
                v92 = fabsf(v83);
                v93 = fabsf(v82);
                if ( fabsf(*((float *)&v143 + 1)) > 32.0 )
                  HIDWORD(v143) = 0;
                v94 = v142 * 4096.0;
                if ( fabsf(v144) > 32.0 )
                  v144 = 0.0;
                v95 = (int)(float)(v141 * -4096.0);
                v96 = (int)(float)(*(float *)&ints * -4096.0);
                v97 = (int)(float)(v140 * -4096.0);
                if ( v92 > 8.0 )
                  LOWORD(v97) = 0;
                *((_WORD *)v80 + 1) = v97;
                v98 = v96;
                if ( v93 > 8.0 )
                  v98 = 0;
                *(_WORD *)v80 = v98;
                v99 = v95;
                if ( v91 > 8.0 )
                  v99 = 0;
                *((_WORD *)v80 + 2) = v99;
                *((_WORD *)v80 + 3) = (int)v94;
                *((_WORD *)v80 + 5) = (int)(float)(*(float *)&v143 * 1024.0);
                *((_WORD *)v80 + 6) = (int)(float)(*((float *)&v143 + 1) * 1024.0);
                *((_WORD *)v80 + 7) = (int)(float)(v144 * 1024.0);
                v81 = v145;
              }
              else
              {
                RwStreamRead(pStream, &ints, 0x14u);
                v107 = *v133;
                v108 = *p_m_bitsFlag & 2;
                if ( !bCompresseda )
                {
                  v115 = -v140;
                  v88 = v108 == 0;
                  v116 = -*(float *)&ints;
                  v117 = v71;
                  v118 = -v141;
                  if ( !v88 )
                    v117 = v72;
                  v104 = &v107[v117];
                  *((float *)v104 + 3) = v142;
                  *(float *)v104 = v116;
                  *((float *)v104 + 1) = v115;
                  *((float *)v104 + 2) = v118;
                  v106 = *(float *)&v143;
                  goto LABEL_153;
                }
                v109 = v69;
                v110 = v142 * 4096.0;
                v111 = (int)(float)(v141 * -4096.0);
                if ( v108 )
                  v109 = v70;
                v112 = (int)(float)(v140 * -4096.0);
                *(_WORD *)&v107[v109] = (int)(float)(*(float *)&ints * -4096.0);
                v80 = &v107[v109];
                *((_WORD *)v80 + 1) = v112;
                *((_WORD *)v80 + 2) = v111;
                *((_WORD *)v80 + 3) = (int)v110;
                v81 = *(float *)&v143;
              }
LABEL_146:
              *((_WORD *)v80 + 4) = (int)(float)((float)(v81 * 60.0) + 0.5);
            }
            ++v73;
            v69 += 10;
            v70 += 16;
            v71 += 20;
            v72 += 32;
            if ( v73 >= *p_m_iNumKeyFrames )
              goto LABEL_155;
            continue;
          }
        }
      }
      else
      {
        CAnimManager::ms_aAnimations[v43].m_pSequences = v58;
      }
LABEL_158:
      v35 = pStream;
      v41 = v121 + 1;
      if ( !bCompresseda )
      {
        CAnimBlendHierarchy::RemoveQuaternionFlips(v44);
        CAnimBlendHierarchy::CalcTotalTime(v44);
      }
    }
  }
  if ( v41 > CAnimManager::ms_numAnimations )
    CAnimManager::ms_numAnimations = v41;
}
// 38ECE4: variable 'v24' is possibly undefined
// 38F1EE: variable 'v61' is possibly undefined
// 0: using guessed type int dword_0;
// 38EA3C: using guessed type char buffer[4];

//----- (0038F774) --------------------------------------------------------
void CAnimManager::RemoveLastAnimFile()
{
  int32 v0; // r0
  __int64 v1; // kr00_8
  int32 v2; // r4

  v0 = --CAnimManager::ms_numAnimBlocks;
  v1 = *(_QWORD *)&CAnimManager::ms_aAnimBlocks[CAnimManager::ms_numAnimBlocks].m_animIndex;
  CAnimManager::ms_numAnimations = CAnimManager::ms_aAnimBlocks[CAnimManager::ms_numAnimBlocks].m_animIndex;
  if ( SHIDWORD(v1) >= 1 )
  {
    CAnimBlendHierarchy::Shutdown(&CAnimManager::ms_aAnimations[v1]);
    v0 = CAnimManager::ms_numAnimBlocks;
    if ( CAnimManager::ms_aAnimBlocks[CAnimManager::ms_numAnimBlocks].m_numAnims >= 2 )
    {
      v2 = 1;
      do
      {
        CAnimBlendHierarchy::Shutdown(&CAnimManager::ms_aAnimations[CAnimManager::ms_aAnimBlocks[v0].m_animIndex + v2]);
        v0 = CAnimManager::ms_numAnimBlocks;
        ++v2;
      }
      while ( v2 < CAnimManager::ms_aAnimBlocks[CAnimManager::ms_numAnimBlocks].m_numAnims );
    }
  }
  CAnimManager::ms_aAnimBlocks[v0].m_loaded = 0;
}

//----- (0038F840) --------------------------------------------------------
void __fastcall CAnimManager::RemoveAnimBlock(int32 index)
{
  int32 v2; // r0
  int v3; // r6
  int32 v4; // r5
  CAnimBlock *v5; // r9
  int32 *p_m_numAnims; // r9
  int m_numAnims; // t1
  int32 v8; // r6
  CAnimBlock *v9; // r0

  v2 = CAnimManager::ms_numAnimAssocDefinitions;
  if ( CAnimManager::ms_numAnimAssocDefinitions >= 1 )
  {
    v3 = 0;
    v4 = 0;
    do
    {
      if ( CAnimManager::ms_aAnimAssocGroups[v3].m_pAnimBlock == &CAnimManager::ms_aAnimBlocks[index] )
      {
        CAnimBlendAssocGroup::DestroyAssociations(&CAnimManager::ms_aAnimAssocGroups[v3]);
        v2 = CAnimManager::ms_numAnimAssocDefinitions;
      }
      ++v4;
      ++v3;
    }
    while ( v4 < v2 );
  }
  v5 = &CAnimManager::ms_aAnimBlocks[index];
  m_numAnims = v5->m_numAnims;
  p_m_numAnims = &v5->m_numAnims;
  if ( m_numAnims >= 1 )
  {
    v8 = 0;
    do
      CAnimBlendHierarchy::Shutdown(&CAnimManager::ms_aAnimations[CAnimManager::ms_aAnimBlocks[index].m_animIndex + v8++]);
    while ( v8 < *p_m_numAnims );
  }
  v9 = &CAnimManager::ms_aAnimBlocks[index];
  v9->m_numRefs = 0;
  v9->m_loaded = 0;
}

//----- (0038F904) --------------------------------------------------------
void __fastcall CAnimManager::AddAnimBlockRef(int32 index)
{
  ++CAnimManager::ms_aAnimBlocks[index].m_numRefs;
}

//----- (0038F91C) --------------------------------------------------------
void __fastcall CAnimManager::RemoveAnimBlockRef(int32 index)
{
  --CAnimManager::ms_aAnimBlocks[index].m_numRefs;
}

//----- (0038F934) --------------------------------------------------------
void __fastcall CAnimManager::RemoveAnimBlockRefWithoutDelete(int32 index)
{
  --CAnimManager::ms_aAnimBlocks[index].m_numRefs;
}

//----- (0038F94C) --------------------------------------------------------
int32 __fastcall CAnimManager::GetNumRefsToAnimBlock(int32 index)
{
  return CAnimManager::ms_aAnimBlocks[index].m_numRefs;
}

//----- (0038F960) --------------------------------------------------------
const unsigned __int8 *__fastcall ConvertBoneTag2BoneName(int32 boneTag)
{
  const unsigned __int8 *result; // r0

  result = "Head";
  switch ( boneTag )
  {
    case 0:
      result = "Root";
      break;
    case 1:
      result = "Pelvis";
      break;
    case 2:
      result = "Spine";
      break;
    case 3:
      result = "Spine1";
      break;
    case 4:
      result = "Neck";
      break;
    case 5:
      return result;
    case 6:
      result = "L Brow";
      break;
    case 7:
      result = "R Brow";
      break;
    case 8:
      result = (const unsigned __int8 *)&dword_38FD44;
      break;
    case 21:
      result = "Bip01 R Clavicle";
      break;
    case 22:
      result = "R UpperArm";
      break;
    case 23:
      result = "R Forearm";
      break;
    case 24:
      result = "R Hand";
      break;
    case 25:
      result = "R Fingers";
      break;
    case 26:
      result = "R Finger01";
      break;
    case 31:
      result = "Bip01 L Clavicle";
      break;
    case 32:
      result = "L UpperArm";
      break;
    case 33:
      result = "L Forearm";
      break;
    case 34:
      result = "L Hand";
      break;
    case 35:
      result = "L Fingers";
      break;
    case 36:
      result = "L Finger01";
      break;
    case 41:
      result = "L Thigh";
      break;
    case 42:
      result = "L Calf";
      break;
    case 43:
      result = "L Foot";
      break;
    case 44:
      result = "L Toe";
      break;
    case 51:
      result = "R Thigh";
      break;
    case 52:
      result = "R Calf";
      break;
    case 53:
      result = "R Foot";
      break;
    case 54:
      result = "R Toe";
      break;
    case 201:
      result = "Belly";
      break;
    case 301:
      result = "R Breast";
      break;
    case 302:
      result = "L Breast";
      break;
    default:
      result = 0;
      break;
  }
  return result;
}
// 38FD44: using guessed type int dword_38FD44;

//----- (0038FD64) --------------------------------------------------------
int32 __fastcall ConvertPedNode2BoneTag(int32 nPedNode)
{
  unsigned int v1; // r0

  v1 = nPedNode - 1;
  if ( v1 <= 0x11 )
    return dword_612720[v1];
  else
    return -1;
}
// 612720: using guessed type _DWORD dword_612720[18];

//----- (0038FD80) --------------------------------------------------------
void CCutsceneMgr::Initialise()
{
  CDirectory *v0; // r0
  CDirectory *v1; // r0

  CCutsceneMgr::ms_running = 0;
  CCutsceneMgr::ms_cutsceneLoadStatus = 0;
  CCutsceneMgr::ms_animLoaded = 0;
  CCutsceneMgr::ms_cutsceneProcessing = 0;
  CCutsceneMgr::ms_useLodMultiplier = 0;
  CCutsceneMgr::ms_wasCutsceneSkipped = 0;
  CCutsceneMgr::ms_hasFileInfo = 0;
  v0 = (CDirectory *)operator new(0x10u);
  CDirectory::CDirectory(v0, 512);
  CCutsceneMgr::ms_pCutsceneDir = v1;
}
// 38FDE2: variable 'v1' is possibly undefined

//----- (0038FE0C) --------------------------------------------------------
void CCutsceneMgr::Shutdown()
{
  void *v0; // r0

  if ( CCutsceneMgr::ms_pCutsceneDir )
  {
    CDirectory::~CDirectory(CCutsceneMgr::ms_pCutsceneDir);
    sub_191374(v0);
  }
}
// 38FE26: variable 'v0' is possibly undefined

//----- (0038FE30) --------------------------------------------------------
void __fastcall CCutsceneMgr::LoadAnimationUncompressed(const unsigned __int8 *pAnimName)
{
  strcpy(
    (char *)CCutsceneMgr::ms_aUncompressedCutsceneAnims[CCutsceneMgr::ms_numUncompressedCutsceneAnims],
    (const char *)pAnimName);
  CCutsceneMgr::ms_aUncompressedCutsceneAnims[++CCutsceneMgr::ms_numUncompressedCutsceneAnims][0] = 0;
}

//----- (0038FE64) --------------------------------------------------------
void __fastcall CCutsceneMgr::LoadCutsceneData(const unsigned __int8 *pName)
{
  CPlayerPed *PlayerPed; // r5

  PlayerPed = FindPlayerPed(-1);
  CClothes::RebuildPlayerIfNeeded(PlayerPed);
  CStreaming::RequestModel(1, 28);
  CStreaming::LoadAllRequestedModels(1);
  CClothes::RebuildCutscenePlayer(PlayerPed, 1);
  if ( !CCutsceneMgr::ms_pCutsceneDir->m_number )
    CDirectory::ReadDirFile(CCutsceneMgr::ms_pCutsceneDir, "ANIM\\CUTS.IMG");
  sub_1A0378(pName);
}

//----- (0038FEC0) --------------------------------------------------------
void CCutsceneMgr::BuildCutscenePlayer()
{
  CPlayerPed *PlayerPed; // r4

  PlayerPed = FindPlayerPed(-1);
  CClothes::RebuildPlayerIfNeeded(PlayerPed);
  CStreaming::RequestModel(1, 28);
  CStreaming::LoadAllRequestedModels(1);
  sub_191818(PlayerPed, 1);
}

//----- (0038FEEC) --------------------------------------------------------
void CCutsceneMgr::DeleteCutsceneData()
{
  CCutsceneMgr::DeleteCutsceneData_overlay();
  CStreaming::SetMissionDoesntRequireModel(1);
  if ( bEverythingRemoved == 1 )
    CCutsceneMgr::LoadEverythingBecauseCutsceneDeletedAllOfIt();
}
// 942E54: using guessed type char bEverythingRemoved;

//----- (0038FF10) --------------------------------------------------------
void CCutsceneMgr::RemoveCutscenePlayer()
{
  int32 v0; // r4

  sub_191720(v0);
}
// 38FF12: variable 'v0' is possibly undefined

//----- (0038FF18) --------------------------------------------------------
void CCutsceneMgr::LoadEverythingBecauseCutsceneDeletedAllOfIt()
{
  CPlayerPed *PlayerPed; // r9
  int32 v1; // r6
  int32 m_modelId; // r5
  uint8 m_flags; // r8
  CWeaponInfo *WeaponInfo; // r0

  bEverythingRemoved = 0;
  CStreaming::LoadInitialPeds();
  CStreaming::LoadInitialWeapons();
  PlayerPed = FindPlayerPed(-1);
  if ( gNumPlayerWeapons >= 1 )
  {
    v1 = 0;
    do
    {
      m_modelId = CWeaponInfo::GetWeaponInfo(gPlayerWeapons[v1], 1)->m_modelId;
      m_flags = CStreaming::ms_aInfoForModel[m_modelId].m_flags;
      CStreaming::RequestModel(m_modelId, 2);
      CStreaming::LoadAllRequestedModels(0);
      if ( CWeaponInfo::GetWeaponInfo(gPlayerWeapons[v1], 1)->m_modelId2 != -1 )
      {
        WeaponInfo = CWeaponInfo::GetWeaponInfo(gPlayerWeapons[v1], 1);
        CStreaming::RequestModel(WeaponInfo->m_modelId2, 0);
        CStreaming::LoadAllRequestedModels(0);
      }
      if ( (m_flags & 2) == 0 )
        CStreaming::SetModelIsDeletable(m_modelId);
      CPed::GiveWeapon(PlayerPed, gPlayerWeapons[v1], gPlayerAmmo[v1], 1);
      ++v1;
    }
    while ( v1 < gNumPlayerWeapons );
  }
  gNumPlayerWeapons = 0;
}
// 677DD0: using guessed type CStreamingInfo (*CStreaming::ms_aInfoForModel)[26316];
// 942E54: using guessed type char bEverythingRemoved;

//----- (00390010) --------------------------------------------------------
void CCutsceneMgr::RemoveEverythingBecauseCutsceneDoesntFitInMemory()
{
  CPlayerPed *PlayerPed; // r4
  int v1; // r5
  int32 v2; // r3
  eWeaponType m_eWeaponType; // r1
  CVector v4; // [sp+4h] [bp-1Ch] BYREF

  if ( bEverythingRemoved == 1 )
  {
    sub_19F96C(1);
  }
  else
  {
    FindPlayerCoors(&v4, -1);
    CWorld::ClearExcitingStuffFromArea(&v4, 120.0, 1u);
    CColStore::RemoveAllCollision();
    CWorld::bProcessCutsceneOnly = 1;
    CStreaming::RemoveCurrentZonesModels();
    while ( CStreaming::RemoveLoadedVehicle() )
      ;
    CRadar::RemoveRadarSections();
    CStreaming::SetModelIsDeletable(7);
    CStreaming::SetModelTxdIsDeletable(7);
    CStreaming::SetModelIsDeletable(346);
    CStreaming::SetModelTxdIsDeletable(346);
    CStreaming::SetModelIsDeletable(334);
    CStreaming::SetModelTxdIsDeletable(334);
    CStreaming::SetModelIsDeletable(345);
    CStreaming::SetModelTxdIsDeletable(345);
    PlayerPed = FindPlayerPed(-1);
    v1 = 0;
    CPed::RemoveWeaponAnims(PlayerPed, 0, -1000.0);
    v2 = 0;
    gNumPlayerWeapons = 0;
    do
    {
      m_eWeaponType = PlayerPed->m_WeaponSlots[v1].m_eWeaponType;
      if ( m_eWeaponType )
      {
        gPlayerWeapons[v2] = m_eWeaponType;
        gPlayerAmmo[v2++] = PlayerPed->m_WeaponSlots[v1].m_nAmmoTotal;
        gNumPlayerWeapons = v2;
      }
      ++v1;
    }
    while ( v1 != 13 );
    CPed::ClearWeapons(PlayerPed);
    bEverythingRemoved = 1;
    CGame::DrasticTidyUpMemory(1);
  }
}
// 942E54: using guessed type char bEverythingRemoved;

//----- (00390120) --------------------------------------------------------
void CCutsceneMgr::Update()
{
  if ( CCutsceneMgr::ms_cutsceneLoadStatus )
    sub_1A0D70();
}

//----- (00390138) --------------------------------------------------------
bool CCutsceneMgr::IsCutsceneSkipButtonBeingPressed()
{
  Char *ScriptName; // r4
  CPad *Pad; // r0
  OSKeyboardKey v3; // r0

  if ( CTheScripts::pActiveScripts )
  {
    ScriptName = CTheScripts::pActiveScripts->ScriptName;
    if ( !strcmp((const char *)CTheScripts::pActiveScripts->ScriptName, "cat3")
      || !strcmp((const char *)ScriptName, "cat4")
      || !strcmp((const char *)ScriptName, "zero1")
      || !strcmp((const char *)ScriptName, "la1fin1")
      || !strcmp((const char *)ScriptName, "bcrash1") )
    {
      return 0;
    }
  }
  Pad = CPad::GetPad(0);
  if ( Pad->NewState.ButtonCross && !Pad->OldState.ButtonCross )
    return 1;
  CPad::GetPad(0);
  if ( LIB_KeyboardPressed(KK_ENTER) )
    return 1;
  CPad::GetPad(0);
  v3 = RsKeyToOSWKey((RsKeyCodes_0)32);
  if ( v3 != KK_MAX )
  {
    if ( LIB_KeyboardPressed(v3) )
      return 1;
  }
  if ( !CTouchInterface::m_pWidgets[41]
    && (CPad::GetPad(0), CPad::NewMouseControllerState.m_bLeftButton)
    && !CPad::OldMouseControllerState.m_bLeftButton )
  {
    return 1;
  }
  else
  {
    return sub_18D4C0(WIDGET_SKIP_CUTSCENE, 0, 3);
  }
}

//----- (0039022C) --------------------------------------------------------
void __fastcall CCutsceneMgr::AppendToNextCutscene(const unsigned __int8 *pModelName, const unsigned __int8 *pAnimName)
{
  strcpy((char *)CCutsceneMgr::ms_cAppendObjectName[CCutsceneMgr::ms_numAppendObjectNames], (const char *)pModelName);
  (*((void (__fastcall **)(unsigned __int8 *))RwEngineInstance + 72))(CCutsceneMgr::ms_cAppendObjectName[CCutsceneMgr::ms_numAppendObjectNames]);
  strcpy((char *)CCutsceneMgr::ms_cAppendAnimName[CCutsceneMgr::ms_numAppendObjectNames], (const char *)pAnimName);
  (*((void (__fastcall **)(unsigned __int8 *))RwEngineInstance + 72))(CCutsceneMgr::ms_cAppendAnimName[CCutsceneMgr::ms_numAppendObjectNames]);
  ++CCutsceneMgr::ms_numAppendObjectNames;
}

//----- (003902A4) --------------------------------------------------------
RwFrame_0 *__fastcall RpAnimBlendFrameSetName(RwFrame_0 *pFrame, unsigned __int8 *pName)
{
  SetFrameNodeName(pFrame, pName);
  return pFrame;
}

//----- (003902B4) --------------------------------------------------------
void __fastcall RpAnimBlendAllocateData(RpClump_0 *pClump)
{
  CAnimBlendClumpData *v2; // r0
  int v3; // r0

  v2 = (CAnimBlendClumpData *)operator new(0x14u);
  CAnimBlendClumpData::CAnimBlendClumpData(v2);
  *(_DWORD *)(&pClump->object.type + ClumpOffset) = v3;
}
// 3902CC: variable 'v3' is possibly undefined

//----- (003902D8) --------------------------------------------------------
void __fastcall RtAnimBlendKeyFrameApply(void *result, void *voidIFrame)
{
  float v2; // s0
  double v3; // d18
  float v4; // s2
  float v5; // s4
  float v6; // s6
  float v7; // s5
  float v8; // s12
  float v9; // s14
  float v10; // s1
  float v11; // s3
  float v12; // s0
  float v13; // s6
  float v14; // s10
  float v15; // s2

  v2 = *(float *)voidIFrame;
  v3 = *(float *)voidIFrame;
  if ( v3 < -1.01
    || v3 > 1.01
    || (v4 = *((float *)voidIFrame + 1), v4 < -1.01)
    || v4 > 1.01
    || (v5 = *((float *)voidIFrame + 2), v5 < -1.01)
    || v5 > 1.01
    || (v6 = *((float *)voidIFrame + 3), v6 < -1.01)
    || v6 > 1.01 )
  {
    v6 = 0.0;
    v5 = 0.0;
    v4 = 0.0;
    *(_QWORD *)voidIFrame = 0LL;
    *((_QWORD *)voidIFrame + 1) = 0LL;
    v2 = 0.0;
  }
  *((_DWORD *)result + 12) = 0;
  *((_DWORD *)result + 13) = 0;
  v7 = v2 * v2;
  *((_DWORD *)result + 14) = 0;
  v8 = v5 * v6;
  v9 = v2 * v4;
  *((_DWORD *)result + 3) = 3;
  v10 = v4 * v6;
  v11 = v2 * v5;
  v12 = v2 * v6;
  v13 = (float)(v4 * v4) + (float)(v5 * v5);
  v14 = v7 + (float)(v4 * v4);
  v15 = v4 * v5;
  *(float *)result = (float)(v13 * -2.0) + 1.0;
  *((float *)result + 1) = (float)(v9 + v8) + (float)(v9 + v8);
  *((float *)result + 2) = (float)(v11 - v10) + (float)(v11 - v10);
  *((float *)result + 4) = (float)(v9 - v8) + (float)(v9 - v8);
  *((float *)result + 5) = 1.0 - (float)((float)(v7 + (float)(v5 * v5)) + (float)(v7 + (float)(v5 * v5)));
  *((float *)result + 6) = (float)(v15 + v12) + (float)(v15 + v12);
  *((float *)result + 8) = (float)(v11 + v10) + (float)(v11 + v10);
  *((float *)result + 9) = (float)(v15 - v12) + (float)(v15 - v12);
  *((float *)result + 10) = 1.0 - (float)(v14 + v14);
  *((_DWORD *)result + 12) = *((_DWORD *)voidIFrame + 4);
  *((_DWORD *)result + 13) = *((_DWORD *)voidIFrame + 5);
  *((_DWORD *)result + 14) = *((_DWORD *)voidIFrame + 6);
  sub_190FEC((RwMatrix *)result);
}

//----- (00390440) --------------------------------------------------------
void __fastcall RpAnimBlendKeyFrameInterpolate(
        void *pVoidOut,
        void *pVoidIn1,
        void *pVoidIn2,
        RwReal time,
        void *customData)
{
  *((_DWORD *)pVoidOut + 5) = 0;
  *((_DWORD *)pVoidOut + 6) = 0;
  *(_QWORD *)pVoidOut = 0LL;
  *((_QWORD *)pVoidOut + 1) = 0x3F80000000000000LL;
  *((_DWORD *)pVoidOut + 4) = 0;
}

//----- (00390470) --------------------------------------------------------
RwBool RpAnimBlendPluginAttach()
{
  RwBool result; // r0
  RtAnimInterpolatorInfo_0 interpInfo; // [sp+8h] [bp-48h] BYREF

  ClumpOffset = RpClumpRegisterPlugin(4, 0x253F2FBu, AnimBlendClumpCreate, AnimBlendClumpDestroy, AnimBlendClumpCopy);
  result = 0;
  if ( ClumpOffset >= 0 )
  {
    interpInfo.interpKeyFrameSize = 28;
    interpInfo.typeID = 39056123;
    interpInfo.animKeyFrameSize = 36;
    interpInfo.customDataSize = 0;
    interpInfo.keyFrameApplyCB = RtAnimBlendKeyFrameApply;
    interpInfo.keyFrameBlendCB = RpHAnimKeyFrameBlend;
    interpInfo.keyFrameInterpolateCB = RpAnimBlendKeyFrameInterpolate;
    interpInfo.keyFrameAddCB = RpHAnimKeyFrameAdd;
    interpInfo.keyFrameMulRecipCB = RpHAnimKeyFrameMulRecip;
    interpInfo.keyFrameStreamReadCB = RpHAnimKeyFrameStreamRead;
    interpInfo.keyFrameStreamWriteCB = RpHAnimKeyFrameStreamWrite;
    interpInfo.keyFrameStreamGetSizeCB = RpHAnimKeyFrameStreamGetSize;
    RtAnimRegisterInterpolationScheme(&interpInfo);
    return 1;
  }
  return result;
}

//----- (0039054C) --------------------------------------------------------
void *__fastcall AnimBlendClumpCreate(void *object, RwInt32 offset, RwInt32 size)
{
  *(_DWORD *)((char *)object + offset) = 0;
  return object;
}

//----- (00390554) --------------------------------------------------------
void *__fastcall AnimBlendClumpDestroy(void *object, RwInt32 offset, RwInt32 size)
{
  CAnimBlendClumpData *v4; // r5
  void *v5; // r0

  v4 = *(CAnimBlendClumpData **)((char *)object + ClumpOffset);
  if ( v4 )
  {
    RpAnimBlendClumpRemoveAllAssociations((RpClump_0 *)object);
    CAnimBlendClumpData::~CAnimBlendClumpData(v4);
    operator delete(v5);
    *(_DWORD *)((char *)object + ClumpOffset) = 0;
  }
  return object;
}
// 390572: variable 'v5' is possibly undefined

//----- (00390590) --------------------------------------------------------
void *__fastcall AnimBlendClumpCopy(void *dst, const void *src, RwInt32 offset, RwInt32 size)
{
  return 0;
}

//----- (00390594) --------------------------------------------------------
RpHAnimAnimation *__fastcall RpAnimBlendCreateAnimationForHierarchy(RpHAnimHierarchy_0 *pHierarchy)
{
  RwInt32 numNodes; // r5
  RpHAnimAnimation *v2; // r4
  RtAnimAnimation_0 *v3; // r0

  if ( !pHierarchy )
    return 0;
  numNodes = pHierarchy->numNodes;
  v2 = 0;
  v3 = RtAnimAnimationCreate(39056123, 0, 0, 0.0);
  if ( v3 )
  {
    v3->numFrames = 2 * numNodes;
    return v3;
  }
  return v2;
}

//----- (003905C4) --------------------------------------------------------
AnimBlendFrameData *__fastcall RpAnimBlendClumpFindFrame(RpClump_0 *pClump, const unsigned __int8 *pName)
{
  CAnimBlendClumpData *v3; // r5
  RpAtomic_0 *FirstAtomic; // r0
  void (*v5)(AnimBlendFrameData *, void *); // r1

  v3 = *(CAnimBlendClumpData **)(&pClump->object.type + ClumpOffset);
  pFrameDataFound = 0;
  FirstAtomic = GetFirstAtomic(pClump);
  if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
    v5 = FrameFindByNameCBskin;
  else
    v5 = FrameFindByNameCBnonskin;
  CAnimBlendClumpData::ForAllFrames(v3, v5, (void *)pName);
  return pFrameDataFound;
}

//----- (00390618) --------------------------------------------------------
void __fastcall FrameFindByNameCBskin(AnimBlendFrameData *pFrameData, void *pData)
{
  const unsigned __int8 *v4; // r1

  v4 = ConvertBoneTag2BoneName(pFrameData->boneTag);
  if ( v4 )
  {
    if ( !strcasecmp((const char *)pData, (const char *)v4) )
      pFrameDataFound = pFrameData;
  }
}

//----- (00390644) --------------------------------------------------------
void __fastcall FrameFindByNameCBnonskin(AnimBlendFrameData *pFrameData, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r0

  FrameNodeName = GetFrameNodeName(pFrameData->_anon_1.pFrame);
  if ( !strcasecmp((const char *)pData, (const char *)FrameNodeName) )
    pFrameDataFound = pFrameData;
}

//----- (0039066C) --------------------------------------------------------
AnimBlendFrameData *__fastcall RpAnimBlendClumpFindFrameFromHashKey(RpClump_0 *pClump, uint32 key)
{
  CAnimBlendClumpData *v3; // r5
  RpAtomic_0 *FirstAtomic; // r0
  void (*v5)(AnimBlendFrameData *, void *); // r1

  v3 = *(CAnimBlendClumpData **)(&pClump->object.type + ClumpOffset);
  pFrameDataFound = 0;
  FirstAtomic = GetFirstAtomic(pClump);
  if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
    v5 = FrameFindByHashKeyCBskin;
  else
    v5 = FrameFindByHashKeyCBnonskin;
  CAnimBlendClumpData::ForAllFrames(v3, v5, (void *)key);
  return pFrameDataFound;
}

//----- (003906C0) --------------------------------------------------------
void __fastcall FrameFindByHashKeyCBskin(AnimBlendFrameData *pFrameData, void *pData)
{
  const unsigned __int8 *v4; // r0

  v4 = ConvertBoneTag2BoneName(pFrameData->boneTag);
  if ( v4 )
  {
    if ( (void *)CKeyGen::GetUppercaseKey(v4) == pData )
      pFrameDataFound = pFrameData;
  }
}

//----- (003906E8) --------------------------------------------------------
void __fastcall FrameFindByHashKeyCBnonskin(AnimBlendFrameData *pFrameData, void *pData)
{
  const unsigned __int8 *FrameNodeName; // r0

  FrameNodeName = GetFrameNodeName(pFrameData->_anon_1.pFrame);
  if ( (void *)CKeyGen::GetUppercaseKey(FrameNodeName) == pData )
    pFrameDataFound = pFrameData;
}

//----- (0039070C) --------------------------------------------------------
AnimBlendFrameData *__fastcall RpAnimBlendClumpFindBone(RpClump_0 *pClump, uint32 boneTag)
{
  CAnimBlendClumpData *v2; // r0

  v2 = *(CAnimBlendClumpData **)(&pClump->object.type + ClumpOffset);
  pFrameDataFound = 0;
  CAnimBlendClumpData::ForAllFrames(v2, FrameFindByBoneCB, (void *)boneTag);
  return pFrameDataFound;
}

//----- (0039073C) --------------------------------------------------------
void __fastcall FrameFindByBoneCB(AnimBlendFrameData *pFrameData, void *pData)
{
  if ( (void *)pFrameData->boneTag == pData )
    pFrameDataFound = pFrameData;
}

//----- (00390750) --------------------------------------------------------
void __fastcall RpAnimBlendClumpFillFrameArray(RpClump_0 *pClump, AnimBlendFrameData **ppFrameArray)
{
  CAnimBlendClumpData *v4; // r6
  RpAtomic_0 *FirstAtomic; // r0
  int v6; // r4
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r5
  int32 i; // r6
  RwInt32 v9; // r0

  v4 = *(CAnimBlendClumpData **)(&pClump->object.type + ClumpOffset);
  FirstAtomic = GetFirstAtomic(pClump);
  if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
  {
    v6 = *(_DWORD *)(&pClump->object.type + ClumpOffset);
    AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump(pClump);
    for ( i = 1; i != 19; ++i )
    {
      v9 = ConvertPedNode2BoneTag(i);
      ppFrameArray[i] = (AnimBlendFrameData *)(*(_DWORD *)(v6 + 16)
                                             + 24 * RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, v9));
    }
  }
  else
  {
    sub_198D0C(v4, FillFrameArrayCBnonskin, ppFrameArray);
  }
}

//----- (003907D4) --------------------------------------------------------
void __fastcall FillFrameArrayCBnonskin(AnimBlendFrameData *pFrameData, void *pData)
{
  *((_DWORD *)pData + CVisibilityPlugins::GetFrameHierarchyId(pFrameData->_anon_1.pFrame)) = pFrameData;
}

//----- (003907E8) --------------------------------------------------------
void __fastcall RpAnimBlendClumpInit(RpClump_0 *pClump)
{
  RpAtomic_0 *FirstAtomic; // r0
  CAnimBlendClumpData *v3; // r8
  RpAtomic_0 *v4; // r0
  RpSkin_0 *Skin; // r0
  signed int NumBones; // r10
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r11
  RwV3d_0 *v8; // r1
  int v9; // r2
  int v10; // r3
  AnimBlendFrameData::$6735F534D254D242879DDACAB335DFC9 *p_anon_1; // r0
  RtAnimInterpolator_0 *currentAnim; // r6
  RwInt32 currentInterpKeyFrameSize; // r4
  RwInt32 nodeID; // r5
  char *v15; // r6
  __int64 v16; // d16
  RwReal z; // r6
  AnimBlendFrameData *m_pFrameDataArray; // r0
  RwFrame_0 *parent; // r4
  CAnimBlendClumpData *v20; // r5
  RwV3d_0 num[64]; // [sp+0h] [bp-320h] BYREF
  AnimBlendFrameData *data; // [sp+300h] [bp-20h] BYREF

  FirstAtomic = GetFirstAtomic(pClump);
  if ( FirstAtomic && j_RpSkinGeometryGetSkin(FirstAtomic->geometry) )
  {
    RpAnimBlendAllocateData(pClump);
    v3 = *(CAnimBlendClumpData **)(&pClump->object.type + ClumpOffset);
    v4 = GetFirstAtomic(pClump);
    Skin = j_RpSkinGeometryGetSkin(v4->geometry);
    NumBones = j_RpSkinGetNumBones(Skin);
    CAnimBlendClumpData::SetNumberOfBones(v3, NumBones);
    AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump(pClump);
    memset(num, 0, sizeof(num));
    SkinGetBonePositionsToTable(pClump, num);
    if ( NumBones >= 1 )
    {
      v8 = num;
      v9 = 0;
      v10 = 0;
      p_anon_1 = &v3->m_pFrameDataArray->_anon_1;
      do
      {
        currentAnim = AnimHierarchyFromSkinClump->currentAnim;
        currentInterpKeyFrameSize = currentAnim->currentInterpKeyFrameSize;
        nodeID = AnimHierarchyFromSkinClump->pNodeInfo[v9++].nodeID;
        p_anon_1[1].pFrame = (RwFrame_0 *)nodeID;
        v15 = (char *)currentAnim + currentInterpKeyFrameSize * v10++;
        p_anon_1->pFrame = (RwFrame_0 *)(v15 + 76);
        v16 = *(_QWORD *)&v8->x;
        z = v8->z;
        ++v8;
        *(RwReal *)&p_anon_1[-1].pFrame = z;
        *(_QWORD *)&p_anon_1[-3].pFrame = v16;
        p_anon_1 += 6;
      }
      while ( NumBones != v10 );
    }
    CAnimBlendClumpData::ForAllFrames(v3, FrameInitCBskin, 0);
    m_pFrameDataArray = v3->m_pFrameDataArray;
  }
  else
  {
    num[0].x = 0.0;
    RpAnimBlendAllocateData(pClump);
    parent = (RwFrame_0 *)pClump->object.parent;
    v20 = *(CAnimBlendClumpData **)(&pClump->object.type + ClumpOffset);
    RwFrameForAllChildren(parent, FrameForAllChildrenCountCBnonskin, num);
    CAnimBlendClumpData::SetNumberOfBones(v20, SLODWORD(num[0].x));
    data = v20->m_pFrameDataArray;
    RwFrameForAllChildren(parent, FrameForAllChildrenFillFrameArrayCBnonskin, &data);
    CAnimBlendClumpData::ForAllFrames(v20, FrameInitCBnonskin, 0);
    m_pFrameDataArray = v20->m_pFrameDataArray;
  }
  m_pFrameDataArray->Flags |= 8u;
}

//----- (0039091C) --------------------------------------------------------
bool __fastcall RpAnimBlendClumpIsInitialized(RpClump_0 *pClump)
{
  int v1; // r0

  v1 = *(_DWORD *)(&pClump->object.type + ClumpOffset);
  return v1 && *(_DWORD *)(v1 + 8) != 0;
}

//----- (0039093C) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpAddAssociation(
        RpClump_0 *pClump,
        CAnimBlendAssociation *pAssociation,
        uint32 PlayFlags,
        float fStartTime,
        float fBlendAmount)
{
  __int16 v6; // r5
  ListLink *v7; // r0
  ListLink_0 *p_m_list; // r1
  ListLink *pNext; // r2
  uint16 m_bitsFlag; // r0

  v6 = PlayFlags;
  v7 = *(ListLink **)(&pClump->object.type + ClumpOffset);
  p_m_list = &pAssociation->m_list;
  if ( v7->pNext )
  {
    v7->pNext->pPrev = p_m_list;
    pNext = v7->pNext;
  }
  else
  {
    pNext = 0;
  }
  pAssociation->m_list.pNext = pNext;
  pAssociation->m_list.pPrev = v7;
  v7->pNext = p_m_list;
  CAnimBlendAssociation::Start(pAssociation, fStartTime);
  m_bitsFlag = pAssociation->m_bitsFlag;
  pAssociation->m_fBlendAmount = fBlendAmount;
  pAssociation->m_bitsFlag = m_bitsFlag | v6;
  return pAssociation;
}

//----- (00390988) --------------------------------------------------------
void __fastcall RpAnimBlendClumpSetBlendDeltas(RpClump_0 *pClump, uint32 flag, float delta)
{
  float *v3; // r0
  float *v5; // r2

  v3 = **(float ***)(&pClump->object.type + ClumpOffset);
  if ( v3 )
  {
    do
    {
      v5 = *(float **)v3;
      if ( flag )
      {
        if ( (*((_WORD *)v3 + 21) & (unsigned __int16)flag) != 0 )
          v3[6] = delta;
      }
      else
      {
        v3[6] = delta;
      }
      v3 = v5;
    }
    while ( v5 );
  }
}

//----- (003909C0) --------------------------------------------------------
void __fastcall RpAnimBlendClumpRemoveAllAssociations(RpClump_0 *pClump)
{
  _DWORD *v1; // r4
  _DWORD *v2; // r0

  v1 = **(_DWORD ***)(&pClump->object.type + ClumpOffset);
  while ( v1 )
  {
    v2 = v1;
    v1 = (_DWORD *)*v1;
    (*(void (__fastcall **)(_DWORD *))(*(v2 - 1) + 4))(v2 - 1);
  }
}

//----- (003909EC) --------------------------------------------------------
void __fastcall RpAnimBlendClumpRemoveAssociations(RpClump_0 *pClump, uint32 flag)
{
  _DWORD *v3; // r0
  _WORD *v4; // r0
  _DWORD *v5; // r5
  _DWORD *v6; // t1

  v3 = **(_DWORD ***)(&pClump->object.type + ClumpOffset);
  if ( v3 )
  {
    do
    {
      v6 = (_DWORD *)*v3;
      v4 = v3 - 1;
      v5 = v6;
      if ( !flag || (v4[23] & (unsigned __int16)flag) != 0 )
        (*(void (__fastcall **)(_WORD *))(*(_DWORD *)v4 + 4))(v4);
      v3 = v5;
    }
    while ( v5 );
  }
}

//----- (00390A24) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetAssociation(RpClump_0 *pClump, const unsigned __int8 *pName)
{
  int **v2; // r4
  uint32 UppercaseKey; // r0

  v2 = *(int ***)(&pClump->object.type + ClumpOffset);
  UppercaseKey = CKeyGen::GetUppercaseKey(pName);
  while ( 1 )
  {
    v2 = (int **)*v2;
    if ( !v2 )
      break;
    if ( *v2[4] == UppercaseKey )
      return (CAnimBlendAssociation *)(v2 - 1);
  }
  return 0;
}

//----- (00390A50) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetAssociation(RpClump_0 *pClump, uint32 id)
{
  int **v2; // r0

  v2 = *(int ***)(&pClump->object.type + ClumpOffset);
  do
  {
    v2 = (int **)*v2;
    if ( !v2 )
      return 0;
  }
  while ( *((__int16 *)v2 + 20) != id );
  return (CAnimBlendAssociation *)(v2 - 1);
}

//----- (00390A78) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetAssociation(
        RpClump_0 *pClump,
        bool bStopFunctionConfusion,
        CAnimBlendHierarchy *pHierarchy)
{
  int **v3; // r0

  v3 = *(int ***)(&pClump->object.type + ClumpOffset);
  do
  {
    v3 = (int **)*v3;
    if ( !v3 )
      return 0;
  }
  while ( v3[4] != (int *)pHierarchy );
  return (CAnimBlendAssociation *)(v3 - 1);
}

//----- (00390A9C) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetMainAssociation(
        RpClump_0 *pClump,
        CAnimBlendAssociation **pp2ndAnim,
        float *pBlendVal2nd)
{
  int *v3; // r3
  float v4; // s2
  CAnimBlendAssociation *v5; // lr
  CAnimBlendAssociation *v6; // r4
  float v7; // s0
  float v8; // s4
  CAnimBlendAssociation *v9; // r12
  CAnimBlendAssociation *result; // r0

  v3 = **(int ***)(&pClump->object.type + ClumpOffset);
  if ( !v3 )
  {
    v7 = 0.0;
    result = 0;
    v9 = 0;
    goto LABEL_14;
  }
  v4 = 0.0;
  v5 = 0;
  v6 = 0;
  v7 = 0.0;
  do
  {
    v8 = v7;
    v9 = v6;
    v7 = v4;
    while ( 1 )
    {
      while ( (*((_BYTE *)v3 + 42) & 0x10) != 0 )
      {
LABEL_7:
        v3 = (int *)*v3;
        if ( !v3 )
        {
          result = v9;
          v7 = v8;
          v9 = v5;
          goto LABEL_14;
        }
      }
      v6 = (CAnimBlendAssociation *)(v3 - 1);
      v4 = *((float *)v3 + 5);
      if ( v4 > v7 )
        break;
      if ( v4 <= v8 )
        goto LABEL_7;
      v8 = *((float *)v3 + 5);
      v3 = (int *)*v3;
      v5 = v6;
      if ( !v3 )
      {
        v7 = v4;
        result = v9;
        v9 = v6;
        goto LABEL_14;
      }
    }
    v3 = (int *)*v3;
    v5 = v9;
    result = v6;
  }
  while ( v3 );
LABEL_14:
  if ( pp2ndAnim )
    *pp2ndAnim = v9;
  if ( pBlendVal2nd )
    *pBlendVal2nd = v7;
  return result;
}

//----- (00390B44) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetMainPartialAssociation(RpClump_0 *pClump)
{
  float *v1; // r1
  CAnimBlendAssociation *result; // r0
  float v3; // s0
  CAnimBlendAssociation *v4; // r2
  float v5; // s2

  v1 = **(float ***)(&pClump->object.type + ClumpOffset);
  if ( !v1 )
    return 0;
  v3 = 0.0;
  v4 = 0;
  do
  {
    while ( (*((_BYTE *)v1 + 42) & 0x10) != 0 )
    {
      result = (CAnimBlendAssociation *)(v1 - 1);
      v5 = v1[5];
      if ( v5 <= v3 )
        break;
      v1 = *(float **)v1;
      v3 = v5;
      v4 = result;
      if ( !v1 )
        return result;
    }
    v1 = *(float **)v1;
  }
  while ( v1 );
  return v4;
}

//----- (00390B9C) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetMainAssociation_N(RpClump_0 *pClump, Int32 N)
{
  int *v2; // r0
  int v3; // r2

  v2 = *(int **)(&pClump->object.type + ClumpOffset);
  v3 = 0;
  while ( 1 )
  {
    v2 = (int *)*v2;
    if ( !v2 )
      break;
    if ( (*((_BYTE *)v2 + 42) & 0x10) == 0 && v3++ == N )
      return (CAnimBlendAssociation *)(v2 - 1);
  }
  return 0;
}

//----- (00390BD0) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetMainPartialAssociation_N(RpClump_0 *pClump, Int32 N)
{
  int *v2; // r0
  int v3; // r2

  v2 = *(int **)(&pClump->object.type + ClumpOffset);
  v3 = 0;
  while ( 1 )
  {
    v2 = (int *)*v2;
    if ( !v2 )
      break;
    if ( (*((_BYTE *)v2 + 42) & 0x10) != 0 && v3++ == N )
      return (CAnimBlendAssociation *)(v2 - 1);
  }
  return 0;
}

//----- (00390C04) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpGetFirstAssociation(RpClump_0 *pClump, uint32 flag)
{
  int *v2; // r0

  v2 = **(int ***)(&pClump->object.type + ClumpOffset);
  if ( !v2 )
    return 0;
  while ( (*((_WORD *)v2 + 21) & (unsigned __int16)flag) == 0 )
  {
    v2 = (int *)*v2;
    if ( !v2 )
      return 0;
  }
  return (CAnimBlendAssociation *)(v2 - 1);
}

//----- (00390C34) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendGetNextAssociation(CAnimBlendAssociation *pAssociation)
{
  CAnimBlendAssociation *result; // r0

  result = (CAnimBlendAssociation *)pAssociation->m_list.pNext;
  if ( result )
    return (CAnimBlendAssociation *)((char *)result - 4);
  return result;
}

//----- (00390C3E) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendGetNextAssociation(CAnimBlendAssociation *pAssociation, uint32 flag)
{
  ListLink *pNext; // r0

  pNext = pAssociation->m_list.pNext;
  if ( !pNext )
    return 0;
  while ( (HIWORD(pNext[5].pNext) & (unsigned __int16)flag) == 0 )
  {
    pNext = pNext->pNext;
    if ( !pNext )
      return 0;
  }
  return (CAnimBlendAssociation *)&pNext[-1].pPrev;
}

//----- (00390C60) --------------------------------------------------------
void __fastcall RpAnimBlendClumpPauseAllAnimations(RpClump_0 *pClump)
{
  int *v1; // r0
  int *v2; // r2
  bool v3; // zf

  v1 = **(int ***)(&pClump->object.type + ClumpOffset);
  if ( v1 )
  {
    do
    {
      v2 = (int *)*v1;
      v3 = *v1 == 0;
      *((_WORD *)v1 + 21) &= ~1u;
      v1 = v2;
    }
    while ( !v3 );
  }
}

//----- (00390C88) --------------------------------------------------------
void __fastcall RpAnimBlendClumpUnPauseAllAnimations(RpClump_0 *pClump)
{
  int *v1; // r0
  int *v2; // r2
  bool v3; // zf

  v1 = **(int ***)(&pClump->object.type + ClumpOffset);
  if ( v1 )
  {
    do
    {
      v2 = (int *)*v1;
      v3 = *v1 == 0;
      *((_WORD *)v1 + 21) |= 1u;
      v1 = v2;
    }
    while ( !v3 );
  }
}

//----- (00390CB0) --------------------------------------------------------
int32 __fastcall RpAnimBlendClumpGetNumAssociations(RpClump_0 *pClump)
{
  _DWORD *v1; // r1
  int32 result; // r0

  v1 = *(_DWORD **)(&pClump->object.type + ClumpOffset);
  result = -1;
  do
  {
    v1 = (_DWORD *)*v1;
    ++result;
  }
  while ( v1 );
  return result;
}

//----- (00390CCC) --------------------------------------------------------
int32 __fastcall RpAnimBlendClumpGetNumPartialAssociations(RpClump_0 *pClump)
{
  int **v1; // r1
  int32 result; // r0
  unsigned int v3; // r2

  v1 = **(int ****)(&pClump->object.type + ClumpOffset);
  result = 0;
  while ( v1 )
  {
    v3 = *((unsigned __int16 *)v1 + 21);
    v1 = (int **)*v1;
    result += (v3 >> 4) & 1;
  }
  return result;
}

//----- (00390CF4) --------------------------------------------------------
int32 __fastcall RpAnimBlendClumpGetNumNonPartialAssociations(RpClump_0 *pClump)
{
  int **v1; // r1
  int32 result; // r0
  unsigned int v3; // r3

  v1 = **(int ****)(&pClump->object.type + ClumpOffset);
  for ( result = 0; v1; result += ((v3 >> 4) & 1) == 0 )
  {
    v3 = *((unsigned __int16 *)v1 + 21);
    v1 = (int **)*v1;
  }
  return result;
}

//----- (00390D20) --------------------------------------------------------
CAnimBlendAssociation *__fastcall RpAnimBlendClumpExtractAssociations(RpClump_0 *pClump)
{
  int *v1; // r0
  int v2; // r1
  CAnimBlendAssociation *result; // r0

  v1 = *(int **)(&pClump->object.type + ClumpOffset);
  v2 = *v1;
  *v1 = 0;
  result = (CAnimBlendAssociation *)(v2 - 4);
  *(_DWORD *)(v2 + 4) = 0;
  return result;
}

//----- (00390D3C) --------------------------------------------------------
void __fastcall RpAnimBlendClumpGiveAssociations(RpClump_0 *pClump, CAnimBlendAssociation *pAssociations)
{
  ListLink *v3; // r5
  ListLink *pNext; // r6
  ListLink *v5; // r0

  v3 = *(ListLink **)(&pClump->object.type + ClumpOffset);
  pNext = v3->pNext;
  while ( pNext )
  {
    v5 = pNext;
    pNext = pNext->pNext;
    ((void (__fastcall *)(ListLink **))v5[-1].pPrev->pPrev)(&v5[-1].pPrev);
  }
  v3->pNext = &pAssociations->m_list;
  pAssociations->m_list.pPrev = v3;
}

//----- (00390D74) --------------------------------------------------------
void __fastcall FrameInitCBskin(AnimBlendFrameData *pFrameData, void *pData)
{
  pFrameData->Flags = 0;
}

//----- (00390D7C) --------------------------------------------------------
RwFrame_0 *__fastcall FrameForAllChildrenCountCBnonskin(RwFrame_0 *pFrame, void *pData)
{
  ++*(_DWORD *)pData;
  RwFrameForAllChildren(pFrame, FrameForAllChildrenCountCBnonskin, pData);
  return pFrame;
}

//----- (00390D9C) --------------------------------------------------------
RwFrame_0 *__fastcall FrameForAllChildrenFillFrameArrayCBnonskin(RwFrame_0 *pFrame, void *pData)
{
  *(_DWORD *)(*(_DWORD *)pData + 16) = pFrame;
  *(_DWORD *)pData += 24;
  RwFrameForAllChildren(pFrame, FrameForAllChildrenFillFrameArrayCBnonskin, pData);
  return pFrame;
}

//----- (00390DC0) --------------------------------------------------------
void __fastcall FrameInitCBnonskin(AnimBlendFrameData *pFrameData, void *pData)
{
  RwFrame_0 *pFrame; // r1
  __int64 v3; // d16

  pFrame = pFrameData->_anon_1.pFrame;
  pFrameData->Flags = 0;
  v3 = *(_QWORD *)&pFrame->modelling.pos.x;
  pFrameData->_anon_0.posn.z = pFrame->modelling.pos.z;
  pFrameData->boneTag = -1;
  *(_QWORD *)&pFrameData->_anon_0.posn.x = v3;
}

//----- (00390DDC) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::Service(CAEAmbienceTrackManager *this, int TrackPlayTime)
{
  unsigned int RandomNumberInRange; // r3
  int m_nPreviousAmbiencePlayTimeMs; // r0
  UInt32 m_nPreviousAmbienceStopTimeMs; // r2
  int v7; // r1
  int v8; // r0
  float m_fAmbienceFrequencyScalingFactor; // s0
  UInt32 v10; // r0
  bool v11; // zf

  if ( !((CAudioEngine::IsCutsceneTrackActive(&AudioEngine) | CTimer::m_UserPause) << 24)
    && !((CTimer::m_CodePause | FrontEndMenuManager.m_MainMenu) << 24)
    && !CLoadingScreen::m_bActive )
  {
    CAEAmbienceTrackManager::UpdateAmbienceTrackAndVolume(this);
  }
  switch ( this->m_nAmbienceStatus )
  {
    case 0:
      if ( !IsPostLoading() )
      {
        RandomNumberInRange = 0;
        if ( !this->m_bStartAmbienceAtBeginning )
        {
          m_nPreviousAmbiencePlayTimeMs = this->m_nPreviousAmbiencePlayTimeMs;
          if ( m_nPreviousAmbiencePlayTimeMs < 0 )
          {
            RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, (Int32)"ceShowAdv");
          }
          else
          {
            m_nPreviousAmbienceStopTimeMs = this->m_nPreviousAmbienceStopTimeMs;
            v7 = this->m_nPreviousAmbiencePlayTimeMs;
            if ( m_nPreviousAmbienceStopTimeMs )
              v7 = CTimer::m_snTimeInMilliseconds + m_nPreviousAmbiencePlayTimeMs - m_nPreviousAmbienceStopTimeMs;
            RandomNumberInRange = m_nPreviousAmbiencePlayTimeMs + 7000;
            if ( v7 > m_nPreviousAmbiencePlayTimeMs + 7000 )
              RandomNumberInRange = v7;
          }
        }
        CAEAudioHardware::PlayTrack(
          &AEAudioHardware,
          this->m_RequestedSettings.TrackID,
          -1,
          RandomNumberInRange,
          this->m_RequestedSettings.TrackFlags,
          0,
          0);
        v8 = 1;
        goto LABEL_32;
      }
      return;
    case 1:
      if ( TrackPlayTime == -2 )
      {
        v8 = 2;
        goto LABEL_32;
      }
      return;
    case 2:
      CAEAudioHardware::DisableBassEq(&AEAudioHardware);
      CAEAudioHardware::SetChannelVolume(&AEAudioHardware, this->m_nHardwareClientHandle, 0, this->m_fAmbienceVolume, 0);
      CAEAudioHardware::SetChannelFlags(&AEAudioHardware, this->m_nHardwareClientHandle, 0, 33);
      CAEAudioHardware::StartTrackPlayback(&AEAudioHardware);
      v8 = 3;
      goto LABEL_32;
    case 3:
      m_fAmbienceFrequencyScalingFactor = 0.0;
      if ( !CTimer::m_UserPause && !((CTimer::m_CodePause | FrontEndMenuManager.m_MainMenu) << 24) )
        m_fAmbienceFrequencyScalingFactor = this->m_fAmbienceFrequencyScalingFactor;
      CAEAudioHardware::SetChannelFrequencyScalingFactor(
        &AEAudioHardware,
        this->m_nHardwareClientHandle,
        0,
        m_fAmbienceFrequencyScalingFactor);
      CAEAudioHardware::SetChannelFrequencyScalingFactor(
        &AEAudioHardware,
        this->m_nHardwareClientHandle,
        0,
        m_fAmbienceFrequencyScalingFactor);
      CAEAudioHardware::SetChannelVolume(&AEAudioHardware, this->m_nHardwareClientHandle, 0, this->m_fAmbienceVolume, 0);
      return;
    case 4:
      if ( this->m_RequestedSettings.TrackID == this->m_nSpecialMissionAmbienceTrackID )
      {
        this->m_nPreviousAmbiencePlayTimeMs = -1;
        v10 = 0;
      }
      else
      {
        this->m_nPreviousAmbiencePlayTimeMs = TrackPlayTime;
        v10 = CTimer::m_snTimeInMilliseconds;
      }
      this->m_nPreviousAmbienceStopTimeMs = v10;
      this->m_fAmbienceVolume = -100.0;
      goto LABEL_31;
    case 5:
      CAEAudioHardware::StopSound(&AEAudioHardware, this->m_nHardwareClientHandle, 0);
      v8 = 6;
      goto LABEL_32;
    case 6:
LABEL_31:
      CAEAudioHardware::StopTrack(&AEAudioHardware);
      v8 = 7;
      goto LABEL_32;
    case 7:
      v11 = TrackPlayTime == -7;
      if ( TrackPlayTime != -7 )
        v11 = TrackPlayTime == -2;
      if ( v11 )
      {
        sub_19C68C(&AEAudioHardware);
      }
      else if ( TrackPlayTime == -6 )
      {
        v8 = 8;
LABEL_32:
        this->m_nAmbienceStatus = v8;
      }
      return;
    default:
      return;
  }
}

//----- (0039101C) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::UpdateAmbienceTrackAndVolume(CAEAmbienceTrackManager *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d2
  float32x2_t v3; // d8
  float32x2_t v4; // d9
  int m_nSpecialMissionAmbienceTrackID; // r5
  int m_nAmbienceRadioStation; // r6
  int v8; // r8
  int IsRadioOn; // r0
  CAudioSphere *v10; // r1
  __int64 v11; // d16
  Int16 m_Sound; // r0
  int v13; // r1
  Int8 v14; // r0
  Int8 MostFavoriteRadioStation; // r0
  __int64 v16; // r0
  CSimpleTransform *p_m_transform; // r2
  _BOOL4 active; // r0
  unsigned int m_nAmbienceStatus; // r1
  int v20; // r0
  unsigned int v21; // r0
  float v22; // s0
  CSimpleTransform *p_tx; // r2
  float z; // s2
  float DistanceAttenuation; // r0
  float v26; // s0
  float v27; // r0
  float m_fAmbienceVolume; // s0
  Int8 CurrentRadioStationID; // r0
  CVector pRelativePosition; // [sp+4h] [bp-44h] BYREF
  CVector pOriginalPosition; // [sp+10h] [bp-38h] BYREF

  this->m_bStartAmbienceAtBeginning = 0;
  this->m_bOverrideRadio = 0;
  m_nSpecialMissionAmbienceTrackID = this->m_nSpecialMissionAmbienceTrackID;
  m_nAmbienceRadioStation = this->m_nAmbienceRadioStation;
  this->m_nAmbienceRadioStation = -1;
  if ( m_nSpecialMissionAmbienceTrackID < 0 )
  {
    if ( CWeather::Sandstorm <= 0.0 )
    {
      v8 = 0;
    }
    else
    {
      if ( CGame::currArea == AREA_MAIN_MAP && !CCullZones::PlayerNoRain() && !CCullZones::CamNoRain() )
      {
        m_nSpecialMissionAmbienceTrackID = 167;
        v8 = 1;
        v3.n64_f32[0] = (float)(log10f(CWeather::Sandstorm) * 20.0) + -6.0;
        goto LABEL_25;
      }
      v8 = 1;
    }
    if ( CAudioZones::m_NumActiveSpheres < 1 )
    {
      if ( CAudioZones::m_NumActiveBoxes < 1 )
      {
        v3.n64_u32[0] = -6.0;
        m_nSpecialMissionAmbienceTrackID = -1;
        goto LABEL_25;
      }
      m_Sound = CAudioZones::m_aBoxes[CAudioZones::m_aActiveBoxes[0]].m_Sound;
    }
    else
    {
      v10 = &CAudioZones::m_aSpheres[CAudioZones::m_aActiveSpheres[0]];
      v11 = *(_QWORD *)&v10->m_Coors.x;
      m_Sound = v10->m_Sound;
      pOriginalPosition.z = v10->m_Coors.z;
      *(_QWORD *)&pOriginalPosition.x = v11;
    }
    v3.n64_u32[0] = -6.0;
    if ( m_Sound >= 0 )
    {
      v13 = m_Sound - 4;
      m_nSpecialMissionAmbienceTrackID = -1;
      v14 = 2;
      switch ( v13 )
      {
        case 0:
          p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
          if ( !TheCamera.m_pMat )
            p_tx = &TheCamera.m_transform;
          z = p_tx->m_translate.z;
          m_nSpecialMissionAmbienceTrackID = 143;
          if ( z <= 1372.0 )
            v3.n64_f32[0] = (float)((float)(1372.0 - z) * -9.0) + -6.0;
          goto LABEL_25;
        case 1:
          CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, &pOriginalPosition);
          DistanceAttenuation = CAEAudioEnvironment::GetDistanceAttenuation(
                                  sqrtf(
                                    (float)((float)(pRelativePosition.x * pRelativePosition.x)
                                          + (float)(pRelativePosition.y * pRelativePosition.y))
                                  + (float)(pRelativePosition.z * pRelativePosition.z))
                                / 5.0);
          v26 = -6.0;
          m_nSpecialMissionAmbienceTrackID = 140;
          goto LABEL_75;
        case 4:
          m_nSpecialMissionAmbienceTrackID = 165;
          goto LABEL_25;
        case 6:
          CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, &pOriginalPosition);
          DistanceAttenuation = CAEAudioEnvironment::GetDistanceAttenuation(
                                  sqrtf(
                                    (float)((float)(pRelativePosition.x * pRelativePosition.x)
                                          + (float)(pRelativePosition.y * pRelativePosition.y))
                                  + (float)(pRelativePosition.z * pRelativePosition.z))
                                / 5.0);
          v26 = -6.0;
          m_nSpecialMissionAmbienceTrackID = 139;
LABEL_75:
          v3.n64_f32[0] = DistanceAttenuation + v26;
          goto LABEL_25;
        case 8:
          m_nSpecialMissionAmbienceTrackID = 168;
          goto LABEL_25;
        case 9:
          CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, &pOriginalPosition);
          v27 = CAEAudioEnvironment::GetDistanceAttenuation(
                  sqrtf(
                    (float)((float)(pRelativePosition.x * pRelativePosition.x)
                          + (float)(pRelativePosition.y * pRelativePosition.y))
                  + (float)(pRelativePosition.z * pRelativePosition.z))
                / 5.0);
          m_nSpecialMissionAmbienceTrackID = 157;
          this->m_bOverrideRadio = 1;
          v3.n64_f32[0] = v27 + -6.0;
          goto LABEL_25;
        case 11:
          m_nSpecialMissionAmbienceTrackID = 164;
          goto LABEL_25;
        case 13:
          m_nSpecialMissionAmbienceTrackID = 146;
          goto LABEL_25;
        case 15:
          m_nSpecialMissionAmbienceTrackID = 138;
          goto LABEL_25;
        case 16:
          m_nSpecialMissionAmbienceTrackID = 136;
          goto LABEL_25;
        case 17:
          m_nSpecialMissionAmbienceTrackID = 135;
          goto LABEL_25;
        case 19:
          m_nSpecialMissionAmbienceTrackID = 148;
          goto LABEL_25;
        case 20:
          m_nSpecialMissionAmbienceTrackID = 159;
          goto LABEL_25;
        case 21:
          m_nSpecialMissionAmbienceTrackID = 158;
          goto LABEL_25;
        case 22:
          m_nSpecialMissionAmbienceTrackID = 154;
          goto LABEL_25;
        case 24:
        case 25:
          m_nSpecialMissionAmbienceTrackID = 147;
          goto LABEL_25;
        case 26:
          MostFavoriteRadioStation = CStats::FindMostFavoriteRadioStation();
          v3.n64_u32[0] = -6.0;
          this->m_nAmbienceRadioStation = MostFavoriteRadioStation;
          m_nSpecialMissionAmbienceTrackID = -1;
          goto LABEL_4;
        case 30:
          m_nSpecialMissionAmbienceTrackID = 162;
          goto LABEL_25;
        case 32:
          m_nSpecialMissionAmbienceTrackID = 155;
          goto LABEL_25;
        case 33:
          m_nSpecialMissionAmbienceTrackID = 144;
          goto LABEL_3;
        case 35:
          m_nSpecialMissionAmbienceTrackID = 163;
          goto LABEL_25;
        case 37:
          m_nSpecialMissionAmbienceTrackID = 169;
          this->m_bOverrideRadio = 1;
          goto LABEL_25;
        case 40:
          m_nSpecialMissionAmbienceTrackID = 152;
          goto LABEL_25;
        case 44:
          m_nSpecialMissionAmbienceTrackID = 137;
          goto LABEL_25;
        case 46:
          m_nSpecialMissionAmbienceTrackID = 173;
          goto LABEL_25;
        case 47:
          m_nSpecialMissionAmbienceTrackID = 156;
          goto LABEL_25;
        case 48:
          v14 = 1;
          goto LABEL_107;
        case 49:
          goto LABEL_107;
        case 50:
          v14 = 3;
          goto LABEL_107;
        case 51:
          v14 = 4;
          goto LABEL_107;
        case 52:
          v14 = 5;
          goto LABEL_107;
        case 53:
          v14 = 6;
          goto LABEL_107;
        case 54:
          v14 = 7;
          goto LABEL_107;
        case 55:
          v14 = 8;
          goto LABEL_107;
        case 56:
          v14 = 9;
          goto LABEL_107;
        case 57:
          v14 = 10;
          goto LABEL_107;
        case 58:
          v14 = 11;
LABEL_107:
          this->m_nAmbienceRadioStation = v14;
          break;
        case 60:
          m_nSpecialMissionAmbienceTrackID = 151;
          goto LABEL_25;
        case 62:
          m_nSpecialMissionAmbienceTrackID = 170;
          goto LABEL_25;
        case 63:
          m_nSpecialMissionAmbienceTrackID = 171;
          goto LABEL_25;
        default:
          goto LABEL_25;
      }
LABEL_5:
      if ( CAudioEngine::IsRadioOn(&AudioEngine) )
      {
        if ( CAudioEngine::GetCurrentRadioStationID(&AudioEngine) != this->m_nAmbienceRadioStation )
          goto LABEL_15;
      }
      else
      {
        CAudioEngine::StartRadio(&AudioEngine, this->m_nAmbienceRadioStation, 2);
      }
      return;
    }
    m_nSpecialMissionAmbienceTrackID = -1;
  }
  else
  {
    v3.n64_u32[0] = -6.0;
    this->m_bOverrideRadio = 1;
    v8 = 0;
LABEL_3:
    this->m_bStartAmbienceAtBeginning = 1;
  }
LABEL_25:
  MostFavoriteRadioStation = this->m_nAmbienceRadioStation;
LABEL_4:
  if ( MostFavoriteRadioStation > -1 )
    goto LABEL_5;
  IsRadioOn = CAudioEngine::IsRadioOn(&AudioEngine);
  if ( m_nAmbienceRadioStation < 0 )
  {
    if ( IsRadioOn )
    {
      if ( this->m_bOverrideRadio )
      {
        CAudioEngine::StopRadio(&AudioEngine, 0, 0);
        CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 35, 0.0, 1.0);
        this->m_bLastAmbienceOverrodeRadio = this->m_bOverrideRadio;
      }
      else
      {
        this->m_bLastAmbienceOverrodeRadio = 0;
      }
      return;
    }
    if ( m_nSpecialMissionAmbienceTrackID >= 0 )
    {
      v16 = *(_QWORD *)&this->m_nAmbienceStatus;
      if ( m_nSpecialMissionAmbienceTrackID == HIDWORD(v16) )
      {
        if ( (_DWORD)v16 != 8 )
        {
          if ( this->m_RequestedSettings.TrackID == m_nSpecialMissionAmbienceTrackID )
            return;
LABEL_112:
          if ( (unsigned int)v16 > 3 )
          {
LABEL_114:
            this->m_bStartAmbienceAtBeginning = 0;
            *(_WORD *)&this->m_bOverrideRadio = 0;
            return;
          }
LABEL_113:
          this->m_nAmbienceStatus = 4;
          goto LABEL_114;
        }
        this->m_nAmbienceStatus = 0;
        v20 = -1073741824;
LABEL_56:
        LODWORD(this->m_fAmbienceVolume) = v20;
        this->m_fAmbienceFrequencyScalingFactor = 1.0;
        this->m_RequestedSettings.TrackID = m_nSpecialMissionAmbienceTrackID;
        return;
      }
      if ( (_DWORD)v16 == 8 )
      {
        this->m_nAmbienceStatus = 0;
        v20 = -1039663104;
        goto LABEL_56;
      }
      v1.n64_u32[0] = LODWORD(this->m_fAmbienceVolume);
      if ( this->m_RequestedSettings.TrackID == m_nSpecialMissionAmbienceTrackID )
      {
        v1.n64_f32[0] = v1.n64_f32[0] + 1.0;
        LODWORD(this->m_fAmbienceVolume) = vmin_f32(v1, v3).n64_u32[0];
        return;
      }
      if ( v1.n64_f32[0] <= -40.0 )
        goto LABEL_112;
LABEL_123:
      this->m_fAmbienceVolume = v1.n64_f32[0] + -0.4;
      return;
    }
    if ( CWeather::UnderWaterness >= 0.5 )
    {
      v4.n64_u32[0] = 14.0;
      v3.n64_u32[0] = 1031798784;
    }
    else
    {
      p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        p_m_transform = &TheCamera.m_transform;
      v4.n64_f32[0] = CAEAudioEnvironment::GetDistanceAttenuation(
                        sqrtf(
                          (float)(TheCamera.DistanceToWater * TheCamera.DistanceToWater)
                        + (float)((float)(p_m_transform->m_translate.z - TheCamera.HeightOfNearestWater)
                                * (float)(p_m_transform->m_translate.z - TheCamera.HeightOfNearestWater)))
                      / 1.75)
                    + -12.0;
      if ( v4.n64_f32[0] <= -34.0 )
      {
LABEL_49:
        active = CGameLogic::LaRiotsActiveHere();
        m_nAmbienceStatus = this->m_nAmbienceStatus;
        if ( !active || CGame::currArea )
        {
          if ( m_nAmbienceStatus != 8 )
          {
            if ( this->m_RequestedSettings.TrackID == 174 )
            {
              if ( v4.n64_f32[0] < -40.0 )
              {
                if ( m_nAmbienceStatus <= 3 )
                  this->m_nAmbienceStatus = 4;
                this->m_bStartAmbienceAtBeginning = 0;
                *(_WORD *)&this->m_bOverrideRadio = 0;
              }
              this->m_fAmbienceVolume = -100.0;
            }
            else if ( v8 && (m_fAmbienceVolume = this->m_fAmbienceVolume, m_fAmbienceVolume > -40.0) )
            {
              this->m_fAmbienceVolume = m_fAmbienceVolume + -0.4;
            }
            else
            {
              if ( m_nAmbienceStatus <= 3 )
                this->m_nAmbienceStatus = 4;
              this->m_bStartAmbienceAtBeginning = 0;
              *(_WORD *)&this->m_bOverrideRadio = 0;
              if ( CAudioEngine::IsVehicleRadioActive(&AudioEngine) )
              {
                CurrentRadioStationID = CAudioEngine::GetCurrentRadioStationID(&AudioEngine);
                CAudioEngine::StartRadio(&AudioEngine, CurrentRadioStationID, 0);
              }
            }
            this->m_fAmbienceFrequencyScalingFactor = 1.0;
          }
          return;
        }
        if ( m_nAmbienceStatus == 8 )
        {
          this->m_nAmbienceStatus = 0;
          this->m_fAmbienceVolume = -34.0;
          this->m_fAmbienceFrequencyScalingFactor = 1.0;
          this->m_RequestedSettings.TrackID = 166;
          return;
        }
        v1.n64_u32[0] = LODWORD(this->m_fAmbienceVolume);
        if ( this->m_RequestedSettings.TrackID == 166 )
        {
          v2.n64_u32[0] = -12.0;
          v1.n64_f32[0] = v1.n64_f32[0] + 1.0;
          LODWORD(this->m_fAmbienceVolume) = vmin_f32(v1, v2).n64_u32[0];
          return;
        }
        if ( v1.n64_f32[0] <= -40.0 )
        {
          if ( m_nAmbienceStatus > 3 )
            goto LABEL_114;
          goto LABEL_113;
        }
        goto LABEL_123;
      }
      v3.n64_u32[0] = 1.0;
    }
    if ( IsPostLoading() )
      goto LABEL_49;
    v21 = this->m_nAmbienceStatus;
    if ( v21 == 8 )
    {
      this->m_nAmbienceStatus = 0;
      this->m_RequestedSettings.TrackID = 174;
      this->m_fAmbienceVolume = -34.0;
      v22 = 1.0;
      if ( CWeather::UnderWaterness >= 0.5 )
        v22 = 0.0625;
      this->m_fAmbienceFrequencyScalingFactor = v22;
      goto LABEL_138;
    }
    v1.n64_u32[0] = LODWORD(this->m_fAmbienceVolume);
    if ( this->m_RequestedSettings.TrackID != 174 )
    {
      if ( v1.n64_f32[0] <= -40.0 )
      {
        if ( v21 <= 3 )
          this->m_nAmbienceStatus = 4;
        this->m_bStartAmbienceAtBeginning = 0;
        *(_WORD *)&this->m_bOverrideRadio = 0;
      }
      else
      {
        this->m_fAmbienceVolume = v1.n64_f32[0] + -0.4;
      }
      goto LABEL_138;
    }
    if ( v4.n64_f32[0] <= v1.n64_f32[0] )
    {
      if ( v4.n64_f32[0] >= v1.n64_f32[0] )
        goto LABEL_138;
      v1.n64_f32[0] = v1.n64_f32[0] + -1.0;
      v1.n64_u64[0] = vmax_f32(v1, v4).n64_u64[0];
    }
    else
    {
      v1.n64_f32[0] = v1.n64_f32[0] + 1.0;
      v1.n64_u64[0] = vmin_f32(v1, v4).n64_u64[0];
    }
    LODWORD(this->m_fAmbienceVolume) = v1.n64_u32[0];
LABEL_138:
    v1.n64_u32[0] = LODWORD(this->m_fAmbienceFrequencyScalingFactor);
    if ( v3.n64_f32[0] <= v1.n64_f32[0] )
    {
      if ( v3.n64_f32[0] < v1.n64_f32[0] )
      {
        v1.n64_f32[0] = v1.n64_f32[0] + -0.25;
        LODWORD(this->m_fAmbienceFrequencyScalingFactor) = vmax_f32(v1, v3).n64_u32[0];
      }
    }
    else
    {
      v1.n64_f32[0] = v1.n64_f32[0] + 0.25;
      LODWORD(this->m_fAmbienceFrequencyScalingFactor) = vmin_f32(v1, v3).n64_u32[0];
    }
    return;
  }
  if ( IsRadioOn )
LABEL_15:
    CAudioEngine::StopRadio(&AudioEngine, 0, 0);
}
// 39132A: variable 'v1' is possibly undefined
// 39132A: variable 'v3' is possibly undefined
// 391378: variable 'v2' is possibly undefined
// 3915F6: variable 'v4' is possibly undefined

//----- (00391798) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::StartTrackPlayback(CAEAmbienceTrackManager *this)
{
  CAEAudioHardware::DisableBassEq(&AEAudioHardware);
  CAEAudioHardware::SetChannelVolume(&AEAudioHardware, this->m_nHardwareClientHandle, 0, this->m_fAmbienceVolume, 0);
  CAEAudioHardware::SetChannelFlags(&AEAudioHardware, this->m_nHardwareClientHandle, 0, 33);
  sub_1952A0(&AEAudioHardware);
}

//----- (003917DC) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::CheckForPause(CAEAmbienceTrackManager *this)
{
  float m_fAmbienceFrequencyScalingFactor; // s0

  m_fAmbienceFrequencyScalingFactor = 0.0;
  if ( !CTimer::m_UserPause && !((CTimer::m_CodePause | FrontEndMenuManager.m_MainMenu) << 24) )
    m_fAmbienceFrequencyScalingFactor = this->m_fAmbienceFrequencyScalingFactor;
  CAEAudioHardware::SetChannelFrequencyScalingFactor(
    &AEAudioHardware,
    this->m_nHardwareClientHandle,
    0,
    m_fAmbienceFrequencyScalingFactor);
  sub_19E094(&AEAudioHardware, this->m_nHardwareClientHandle, 0, m_fAmbienceFrequencyScalingFactor);
}

//----- (00391854) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::Reset(CAEAmbienceTrackManager *this)
{
  this->m_nSpecialMissionAmbienceTrackID = -1;
  this->m_nPreviousAmbiencePlayTimeMs = -1;
  this->m_nPreviousAmbienceStopTimeMs = 0;
  *(_DWORD *)&this->m_bOverrideRadio = -16777216;
}

//----- (00391868) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::StopAmbienceTrack(CAEAmbienceTrackManager *this)
{
  if ( this->m_nAmbienceStatus <= 3u )
    this->m_nAmbienceStatus = 4;
  this->m_bStartAmbienceAtBeginning = 0;
  *(_WORD *)&this->m_bOverrideRadio = 0;
}

//----- (0039187A) --------------------------------------------------------
Bool8 __fastcall CAEAmbienceTrackManager::IsAmbienceTrackActive(CAEAmbienceTrackManager *this)
{
  return this->m_nAmbienceStatus != 8;
}

//----- (00391888) --------------------------------------------------------
Int8 __fastcall CAEAmbienceTrackManager::GetAmbienceTrackStatus(CAEAmbienceTrackManager *this)
{
  int m_nAmbienceStatus; // r1
  Int8 result; // r0

  m_nAmbienceStatus = this->m_nAmbienceStatus;
  result = 1;
  switch ( m_nAmbienceStatus )
  {
    case 0:
    case 1:
      return result;
    case 2:
      result = 2;
      break;
    case 3:
      result = 3;
      break;
    case 4:
    case 5:
    case 6:
    case 7:
      result = 4;
      break;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (003918AC) --------------------------------------------------------
Bool8 __fastcall CAEAmbienceTrackManager::IsAmbienceRadioActive(CAEAmbienceTrackManager *this)
{
  return ((unsigned __int8)this->m_nAmbienceRadioStation >> 7) ^ 1;
}

//----- (003918B6) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::PlaySpecialMissionAmbienceTrack(CAEAmbienceTrackManager *this, int TrackID)
{
  this->m_nSpecialMissionAmbienceTrackID = TrackID;
}

//----- (003918BA) --------------------------------------------------------
void __fastcall CAEAmbienceTrackManager::StopSpecialMissionAmbienceTrack(CAEAmbienceTrackManager *this)
{
  if ( this->m_nAmbienceStatus <= 3u )
    this->m_nAmbienceStatus = 4;
  this->m_nSpecialMissionAmbienceTrackID = -1;
  this->m_nPreviousAmbiencePlayTimeMs = -1;
  this->m_nPreviousAmbienceStopTimeMs = 0;
  *(_DWORD *)&this->m_bOverrideRadio = -16777216;
}

//----- (003918D8) --------------------------------------------------------
void __fastcall CAEAudioChannel::CAEAudioChannel(
        CAEAudioChannel *this,
        UInt16 channelID,
        UInt32 nSamplesPerSec,
        UInt16 wBitsPerSample)
{
  this->m_dwFlags = 0;
  this->m_channelID = channelID;
  this->m_frequency = nSamplesPerSec;
  this->m_originalFrequency = nSamplesPerSec;
  this->m_fVol = -100.0;
  this->m_bPaused = 0;
  this->m_bLooping = 0;
  this->m_bShouldStop = 0;
  this->_vptr$CAEAudioChannel = (int (**)(void))&off_667768;
  this->oalSource = 0;
}
// 667768: using guessed type void *off_667768;

//----- (0039190C) --------------------------------------------------------
void __fastcall CAEAudioChannel::~CAEAudioChannel(CAEAudioChannel *this)
{
  OALSource *oalSource; // r5
  int v3; // r0
  unsigned int numEntries; // r6
  unsigned int v5; // r10
  OALBase **dataPtr; // r8
  OALBase **v7; // r9

  oalSource = this->oalSource;
  this->_vptr$CAEAudioChannel = (int (**)(void))&off_667768;
  if ( oalSource )
  {
    --g_numSoundChannelsUsed;
    v3 = oalSource->refCount - 1;
    oalSource->refCount = v3;
    if ( !v3 )
    {
      OS_MutexObtain(trashMutex);
      numEntries = OALBase::trashCan.numEntries;
      if ( OALBase::trashCan.numAlloced >= OALBase::trashCan.numEntries + 1 )
      {
        dataPtr = OALBase::trashCan.dataPtr;
      }
      else
      {
        v5 = 4 * (OALBase::trashCan.numEntries + 1) / 3 + 3;
        dataPtr = (OALBase **)malloc(4 * v5);
        v7 = OALBase::trashCan.dataPtr;
        if ( OALBase::trashCan.dataPtr )
        {
          qmemcpy(dataPtr, OALBase::trashCan.dataPtr, 4 * numEntries);
          free(v7);
          numEntries = OALBase::trashCan.numEntries;
        }
        OALBase::trashCan.dataPtr = dataPtr;
        OALBase::trashCan.numAlloced = v5;
      }
      dataPtr[numEntries] = oalSource;
      ++OALBase::trashCan.numEntries;
      OS_MutexRelease(trashMutex);
    }
  }
  this->oalSource = 0;
}
// 667768: using guessed type void *off_667768;

//----- (00391A0C) --------------------------------------------------------
void __fastcall CAEAudioChannel::SetVolume(CAEAudioChannel *this, float fVolume)
{
  OALSource *oalSource; // r6
  ALint curState; // r0
  ALuint sourceId; // r0
  float m_fVol; // s0
  OALSource *v8; // r1

  oalSource = this->oalSource;
  if ( oalSource && this->m_fVol != fVolume )
  {
    OALSource::ObtainSource(this->oalSource);
    curState = oalSource->curState;
    if ( !curState )
    {
      sourceId = oalSource->sourceId;
      oalSource->curState = 4116;
      j_alGetSourcei(sourceId, 4112, &oalSource->curState);
      curState = oalSource->curState;
    }
    if ( curState == 4114 )
    {
      m_fVol = this->m_fVol;
      if ( fabsf(fVolume - m_fVol) > 60.0 )
      {
        v8 = this->oalSource;
        if ( m_fVol >= fVolume )
        {
          if ( CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, v8, fVolume, -1, 0) )
            goto LABEL_10;
        }
        else if ( CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, v8, fVolume, -2, 0) )
        {
LABEL_10:
          this->m_fVol = fVolume;
          return;
        }
      }
    }
    CAESmoothFadeThread::SetBufferVolume(&AESmoothFadeThread, this->oalSource, fVolume);
    goto LABEL_10;
  }
}

//----- (00391AF8) --------------------------------------------------------
Bool8 __fastcall CAEAudioChannel::IsBufferPlaying(CAEAudioChannel *this)
{
  OALSource *oalSource; // r4
  ALint curState; // r1
  ALuint sourceId; // r0

  oalSource = this->oalSource;
  if ( !oalSource )
    return 0;
  OALSource::ObtainSource(this->oalSource);
  curState = oalSource->curState;
  if ( !curState )
  {
    sourceId = oalSource->sourceId;
    oalSource->curState = 4116;
    j_alGetSourcei(sourceId, 4112, &oalSource->curState);
    curState = oalSource->curState;
  }
  return curState == 4114;
}

//----- (00391B32) --------------------------------------------------------
void __fastcall CAEAudioChannel::SetPosition(CAEAudioChannel *this, CVector *pPosition)
{
  OALSource *oalSource; // r5

  oalSource = this->oalSource;
  if ( oalSource )
  {
    OALSource::ObtainSource(this->oalSource);
    j_alSource3f(oalSource->sourceId, 4100, pPosition->x, pPosition->y, pPosition->z);
  }
}

//----- (00391B5E) --------------------------------------------------------
float __fastcall CAEAudioChannel::GetVolume(CAEAudioChannel *this)
{
  return this->m_fVol;
}

//----- (00391B62) --------------------------------------------------------
UInt32 __fastcall CAEAudioChannel::GetCurrentPlaybackPosition(CAEAudioChannel *this)
{
  OALSource *oalSource; // r4
  ALint value[3]; // [sp+4h] [bp-Ch] BYREF

  oalSource = this->oalSource;
  if ( !oalSource )
    return 0;
  j_alGetSourcei(oalSource->sourceId, 4134, value);
  return oalSource->posOffset + value[0];
}
// 391B62: using guessed type ALint value[3];

//----- (00391B88) --------------------------------------------------------
Int16 __fastcall CAEAudioChannel::ConvertFromBytesToMS(CAEAudioChannel *this, UInt32 dwBytes)
{
  return CAEAudioUtility::ConvertFromBytesToMS(dwBytes, this->m_originalFrequency, 1u);
}

//----- (00391B9C) --------------------------------------------------------
Int32 __fastcall CAEAudioChannel::ConvertFromMsToBytes(CAEAudioChannel *this, UInt32 dwMs)
{
  return sub_1956E0(dwMs, this->m_originalFrequency, 1u);
}

//----- (00391BA8) --------------------------------------------------------
void __fastcall CAEAudioChannel::SetFrequencyScalingFactor(CAEAudioChannel *this, float fScalingFactor)
{
  OALSource *oalSource; // r5
  Bool8 *p_m_bPaused; // r8
  char v5; // r5
  float m_originalFrequency; // s16
  UInt32 v7; // s18
  OALSource *v8; // r5
  OALSource *v9; // r6
  int m_bLooping; // r5
  ALint curState; // r0
  ALuint sourceId; // r0
  OALSource *v13; // r4

  if ( fScalingFactor == 0.0 )
  {
    oalSource = this->oalSource;
    p_m_bPaused = &this->m_bPaused;
    if ( oalSource && !*p_m_bPaused )
    {
      OALSource::ObtainSource(this->oalSource);
      curState = oalSource->curState;
      if ( !curState )
      {
        sourceId = oalSource->sourceId;
        oalSource->curState = 4116;
        j_alGetSourcei(sourceId, 4112, &oalSource->curState);
        curState = oalSource->curState;
      }
      v5 = 1;
      if ( curState == 4114 && !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, -100.0, -1, 1) )
      {
        v13 = this->oalSource;
        if ( v13->type == OST_Preloop )
          OALSource::UnqueueBuffers(v13);
        j_alSourceStop(v13->sourceId);
        v5 = 1;
        v13->curState = 4116;
        v13->posOffset = 0;
        v13->wasStopped = 1;
      }
    }
    else
    {
      v5 = 1;
    }
LABEL_21:
    *p_m_bPaused = v5;
    return;
  }
  m_originalFrequency = (float)this->m_originalFrequency;
  v7 = (unsigned int)(float)(m_originalFrequency * fScalingFactor);
  if ( this->m_frequency != v7 )
  {
    v8 = this->oalSource;
    this->m_frequency = v7;
    if ( v8 )
    {
      OALSource::ObtainSource(v8);
      j_alSourcef(v8->sourceId, 4099, (float)v7 / m_originalFrequency);
    }
  }
  p_m_bPaused = &this->m_bPaused;
  if ( this->m_bPaused )
  {
    v9 = this->oalSource;
    if ( v9 )
    {
      m_bLooping = this->m_bLooping;
      OALSource::ObtainSource(this->oalSource);
      if ( v9->type != OST_Preloop )
        j_alSourcei(v9->sourceId, 4103, m_bLooping != 0);
      OALSource::Play(this->oalSource);
    }
    v5 = 0;
    goto LABEL_21;
  }
}

//----- (00391CCC) --------------------------------------------------------
void __fastcall CAEAudioChannel::SetFrequency(CAEAudioChannel *this, UInt32 frequency)
{
  OALSource *oalSource; // r5
  UInt32 m_originalFrequency; // r6

  if ( this->m_frequency != frequency )
  {
    oalSource = this->oalSource;
    this->m_frequency = frequency;
    if ( oalSource )
    {
      m_originalFrequency = this->m_originalFrequency;
      OALSource::ObtainSource(oalSource);
      sub_198FD4(oalSource->sourceId, 4099, (float)frequency / (float)m_originalFrequency);
    }
  }
}

//----- (00391D1A) --------------------------------------------------------
void __fastcall CAEAudioChannel::SetOriginalFrequency(CAEAudioChannel *this, UInt32 frequency)
{
  if ( this->m_frequency != frequency )
    this->m_frequency = frequency;
  this->m_originalFrequency = frequency;
}

//----- (00391D30) --------------------------------------------------------
float __fastcall CAEAudioEnvironment::GetDopplerRelativeFrequency(
        float fOldDistance,
        float fNewDistance,
        UInt32 TimeOldDistanceUpdated,
        UInt32 TimeNewDistanceUpdated,
        float fDopplerScale)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d2
  int Just_Switched_Status; // r0
  float v12; // s0
  unsigned __int32 v13; // s0

  Just_Switched_Status = CCamera::Get_Just_Switched_Status(&TheCamera);
  v12 = 1.0;
  if ( TimeNewDistanceUpdated > TimeOldDistanceUpdated
    && (float)(fNewDistance - fOldDistance) != 0.0
    && !Just_Switched_Status )
  {
    v6.n64_f32[0] = (float)(fNewDistance - fOldDistance)
                  * 1000.0
                  / (float)(TimeNewDistanceUpdated - TimeOldDistanceUpdated)
                  * fDopplerScale;
    if ( fabsf(v6.n64_f32[0]) < 340.0 )
    {
      if ( v6.n64_f32[0] >= 0.0 )
      {
        v5.n64_u32[0] = 1108082688;
        v13 = vmin_f32(v6, v5).n64_u32[0];
      }
      else
      {
        v5.n64_u32[0] = -1039400960;
        v13 = vmax_f32(v6, v5).n64_u32[0];
      }
      return 340.0 / (float)(*(float *)&v13 + 340.0);
    }
  }
  return v12;
}
// 391DC4: variable 'v6' is possibly undefined
// 391DC4: variable 'v5' is possibly undefined

//----- (00391E00) --------------------------------------------------------
void __fastcall CAEAudioEnvironment::GetPositionRelativeToCamera(
        CVector *pRelativePosition,
        CVector *pOriginalPosition)
{
  unsigned int Mode; // r0
  float xy; // s0
  float yy; // s4
  float zy; // s2
  CSimpleTransform *p_tx; // r1
  float v9; // s10
  float v10; // s8
  float v11; // s6
  CPlayerPed *PlayerPed; // r0
  float v13; // s18
  CMatrix *m_pMat; // r2
  float *p_x; // r3
  CSimpleTransform *p_m_transform; // r0
  float v17; // s6
  float v18; // s2
  float v19; // s12
  float v20; // s10
  CSimpleTransform *v21; // r1
  float v22; // s10
  float v23; // s8
  float v24; // s6
  float v25; // s1
  float v26; // s2
  float v27; // s0
  float v28; // s6
  float v29; // s4
  RwReal v30; // s0
  float v31; // s8
  RwReal v32; // s2
  float v33; // s4
  CMatrix v34; // [sp+0h] [bp-68h] BYREF

  v34.m_pRwMat = 0;
  v34.m_owner = 0;
  if ( pOriginalPosition )
  {
    Mode = TheCamera.Cams[TheCamera.ActiveCam].Mode;
    if ( Mode <= 0x10 && ((1 << Mode) & (unsigned int)&elf_hash_chain[6]) != 0 )
    {
      CMatrix::operator=(&v34, &TheCamera.m_cameraMatrix);
      xy = v34.xy;
      yy = v34.yy;
      zy = v34.zy;
      p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        p_tx = &TheCamera.m_transform;
      v9 = p_tx->m_translate.x - (float)(v34.xy + v34.xy);
      v10 = p_tx->m_translate.y - (float)(v34.yy + v34.yy);
      v11 = p_tx->m_translate.z - (float)(v34.zy + v34.zy);
    }
    else
    {
      PlayerPed = FindPlayerPed(-1);
      v13 = 0.0;
      if ( PlayerPed )
      {
        m_pMat = PlayerPed->m_pMat;
        p_x = &m_pMat->tx;
        if ( !m_pMat )
          p_x = &PlayerPed->m_transform.m_translate.x;
        p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
        if ( !TheCamera.m_pMat )
          p_m_transform = &TheCamera.m_transform;
        v13 = sqrtf(
                (float)((float)((float)(*p_x - p_m_transform->m_translate.x)
                              * (float)(*p_x - p_m_transform->m_translate.x))
                      + (float)((float)(p_x[1] - p_m_transform->m_translate.y)
                              * (float)(p_x[1] - p_m_transform->m_translate.y)))
              + (float)((float)(p_x[2] - p_m_transform->m_translate.z) * (float)(p_x[2] - p_m_transform->m_translate.z)))
            + -0.5;
      }
      CMatrix::operator=(&v34, &TheCamera.m_cameraMatrix);
      v17 = 0.5;
      if ( v13 < 0.5 )
        v17 = v13;
      v18 = v17;
      if ( v13 < 0.0 )
        v18 = 0.0;
      if ( v13 < 0.5 )
        v17 = v18;
      xy = v34.xy;
      yy = v34.yy;
      zy = v34.zy;
      v19 = v34.xy * v17;
      v20 = v17 * v34.yy;
      v21 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        v21 = &TheCamera.m_transform;
      v11 = (float)(v17 * v34.zy) + v21->m_translate.z;
      v10 = v20 + v21->m_translate.y;
      v9 = v19 + v21->m_translate.x;
    }
    v22 = pOriginalPosition->x - v9;
    v23 = pOriginalPosition->y - v10;
    v24 = pOriginalPosition->z - v11;
    v25 = v24 * v34.zx;
    v26 = v24 * zy;
    v27 = (float)(v22 * xy) + (float)(v23 * yy);
    v28 = v24 * v34.zz;
    v29 = (float)((float)(v22 * v34.xx) + (float)(v23 * v34.yx)) + v25;
    v30 = v27 + v26;
    v31 = v23 * v34.yz;
    v32 = -v29;
    v33 = v22 * v34.xz;
    pRelativePosition->x = v32;
    pRelativePosition->y = v30;
    pRelativePosition->z = (float)(v33 + v31) + v28;
  }
  CMatrix::~CMatrix(&v34);
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (00392034) --------------------------------------------------------
void __fastcall CAEAudioEnvironment::GetPositionRelativeToCamera(
        CVector *pRelativePosition,
        CPlaceable *pPlaceableObject)
{
  CMatrix *m_pMat; // r3
  CSimpleTransform *p_tx; // r2

  m_pMat = pPlaceableObject->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPlaceableObject->m_transform;
  CAEAudioEnvironment::GetPositionRelativeToCamera(pRelativePosition, &p_tx->m_translate);
}

//----- (00392044) --------------------------------------------------------
float __fastcall CAEAudioEnvironment::GetDistanceAttenuation(float fDistance)
{
  if ( fDistance < 128.0 )
    return gAudioFreeSpacePathLoss[floorf(fDistance * 10.0)];
  else
    return -100.0;
}

//----- (003920A4) --------------------------------------------------------
float __fastcall CAEAudioEnvironment::GetDirectionalMikeAttenuation(const CVector *RelativePosition)
{
  __int64 v1; // d16
  float v2; // s0
  float v3; // s2
  CVector v5; // [sp+0h] [bp-18h] BYREF

  v1 = *(_QWORD *)&RelativePosition->x;
  v5.z = RelativePosition->z;
  *(_QWORD *)&v5.x = v1;
  CVector::Normalise(&v5);
  v2 = 0.0;
  v3 = (float)((float)(v5.x * 0.0) + v5.y) + (float)(v5.z * 0.0);
  if ( v3 < 0.707 )
  {
    if ( v3 <= -0.707 )
      return -6.0;
    else
      return (float)((float)(0.707 - v3) / 1.414) * -6.0;
  }
  return v2;
}

//----- (0039212C) --------------------------------------------------------
void __fastcall CAEAudioEnvironment::GetReverbEnvironmentAndDepth(Int8 *pEnvironment, Int32 *pDepth)
{
  CAudioSphere *v2; // r2
  int m_Sound; // r2

  if ( CWeather::UnderWaterness >= 0.5 )
  {
    *pEnvironment = 22;
    *pDepth = -12;
    return;
  }
  if ( CAudioZones::m_NumActiveSpheres < 1 )
  {
    if ( CAudioZones::m_NumActiveBoxes < 1 )
      goto LABEL_8;
    v2 = (CAudioSphere *)&CAudioZones::m_aBoxes[CAudioZones::m_aActiveBoxes[0]];
  }
  else
  {
    v2 = &CAudioZones::m_aSpheres[CAudioZones::m_aActiveSpheres[0]];
  }
  m_Sound = (unsigned __int16)v2->m_Sound;
  if ( m_Sound != 0xFFFF )
  {
LABEL_10:
    *pEnvironment = gAudioZoneToReverbEnvironmentMap[(__int16)m_Sound].Environment;
    *pDepth = gAudioZoneToReverbEnvironmentMap[(__int16)m_Sound].Depth;
    return;
  }
LABEL_8:
  if ( CGame::currArea )
  {
    LOWORD(m_Sound) = 14;
    goto LABEL_10;
  }
  *pEnvironment = 23;
  *pDepth = -100;
}

//----- (00392200) --------------------------------------------------------
void __fastcall CAEAudioHardware::CAEAudioHardware(CAEAudioHardware *this)
{
  Int16 *v2; // r10
  float *p_m_fMusicMasterScalingFactor; // r5
  Int16 *m_nRequestedChannelSoundFlagsList; // r0
  int v5; // r2
  int v6; // r6
  int v7; // r12
  float *m_fRequestedChannelVolumeList; // r2
  int v9; // r8
  int v10; // r3
  int v11; // r9
  UInt16 *m_ClientChannelAllocationList; // r1
  bool v13; // lr
  int v14; // r0
  bool v15; // zf
  bool v16; // zf
  __int64 v17; // d16
  __int64 v18; // d17
  int v19; // r2
  char *v20; // r5
  Bool8 *v21; // r1
  int v22; // r0
  Bool8 *v23; // r1
  __int64 v24; // d16
  __int64 v25; // d17
  int v26; // [sp+14h] [bp-24h]

  CAEStreamThread::CAEStreamThread(&this->m_streamThread);
  v2 = &this->m_nRequestedChannelSoundFlagsList[30];
  p_m_fMusicMasterScalingFactor = &this->m_fMusicMasterScalingFactor;
  m_nRequestedChannelSoundFlagsList = this->m_nRequestedChannelSoundFlagsList;
  v5 = 0;
  v6 = 0;
  if ( this->m_fRequestedChannelFrequencyScalingFactors < this->m_fLinearChannelVolumeList )
    v5 = 1;
  v7 = 0;
  v26 = v5;
  m_fRequestedChannelVolumeList = this->m_fRequestedChannelVolumeList;
  v9 = 0;
  if ( this->m_fRequestedChannelVolumeList < p_m_fMusicMasterScalingFactor )
    v6 = 1;
  v10 = 0;
  v11 = 0;
  if ( m_nRequestedChannelSoundFlagsList < (Int16 *)this->m_fLinearChannelVolumeList )
    v10 = 1;
  if ( v2 > (Int16 *)m_fRequestedChannelVolumeList )
    v7 = 1;
  m_ClientChannelAllocationList = this->m_ClientChannelAllocationList;
  if ( this->m_fRequestedChannelFrequencyScalingFactors < m_fRequestedChannelVolumeList )
    v9 = 1;
  if ( m_ClientChannelAllocationList < (UInt16 *)p_m_fMusicMasterScalingFactor )
    v11 = 1;
  v13 = m_nRequestedChannelSoundFlagsList < (Int16 *)m_fRequestedChannelVolumeList;
  v14 = 0;
  if ( v2 <= (Int16 *)m_ClientChannelAllocationList || !v13 )
  {
    v15 = (v11 & v9) == 0;
    if ( (v11 & v9) == 0 )
      v15 = (v10 & v7) == 0;
    if ( v15 )
    {
      v16 = (v6 & v26) == 0;
      if ( (v6 & v26) == 0 )
        v16 = this->m_nRequestedChannelSoundFlagsList >= (Int16 *)&this->m_fMusicMasterScalingFactor
           || &this->m_nRequestedChannelSoundFlagsList[30] <= (Int16 *)this->m_fRequestedChannelFrequencyScalingFactors;
      if ( v16 )
      {
        *(float *)&v17 = 1.0;
        *((float *)&v17 + 1) = 1.0;
        *(float *)&v18 = 1.0;
        *((float *)&v18 + 1) = 1.0;
        *(_QWORD *)this->m_ClientChannelAllocationList = 0LL;
        *(_QWORD *)this->m_fRequestedChannelFrequencyScalingFactors = v17;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[2] = v18;
        *(_QWORD *)this->m_nRequestedChannelSoundFlagsList = 0LL;
        *(_QWORD *)m_fRequestedChannelVolumeList = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[2] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_ClientChannelAllocationList[4] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[4] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[6] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_nRequestedChannelSoundFlagsList[4] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[4] = v17;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[6] = v18;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[8] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[10] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_ClientChannelAllocationList[8] = 0LL;
        *(_QWORD *)&this->m_nRequestedChannelSoundFlagsList[8] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[8] = v17;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[10] = v18;
        *(_QWORD *)&this->m_ClientChannelAllocationList[12] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[12] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[14] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_nRequestedChannelSoundFlagsList[12] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[12] = v17;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[14] = v18;
        *(_QWORD *)&this->m_ClientChannelAllocationList[16] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[16] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[18] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_nRequestedChannelSoundFlagsList[16] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[16] = v17;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[18] = v18;
        *(_QWORD *)&this->m_ClientChannelAllocationList[20] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[20] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[22] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_nRequestedChannelSoundFlagsList[20] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[20] = v17;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[22] = v18;
        *(_QWORD *)&this->m_ClientChannelAllocationList[24] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[24] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_fRequestedChannelVolumeList[26] = 0xC47A0000C47A0000LL;
        *(_QWORD *)&this->m_nRequestedChannelSoundFlagsList[24] = 0LL;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[24] = v17;
        *(_QWORD *)&this->m_fRequestedChannelFrequencyScalingFactors[26] = v18;
        v14 = 28;
      }
    }
  }
  v19 = 4 * v14;
  do
  {
    v20 = (char *)this + 2 * v14;
    v21 = &this->m_bInitialised + v19;
    ++v14;
    v19 += 4;
    *((_WORD *)v20 + 38) = 0;
    *((_DWORD *)v21 + 34) = -998637568;
    *((_WORD *)v20 + 3) = 0;
    *((_DWORD *)v21 + 94) = 1065353216;
  }
  while ( v14 != 30 );
  v22 = 528;
  do
  {
    v23 = &this->m_bInitialised + v22;
    v22 += 16;
    *(_QWORD *)v23 = -1LL;
    *((_QWORD *)v23 + 1) = -1LL;
    v23 += 600;
    *(_QWORD *)v23 = -1LL;
    *((_QWORD *)v23 + 1) = -1LL;
  }
  while ( v22 != 1120 );
  this->m_VirtualChannelSettings.SoundIDs[296] = -1;
  *(float *)&v24 = 1.0;
  *((float *)&v24 + 1) = 1.0;
  *(float *)&v25 = 1.0;
  *((float *)&v25 + 1) = 1.0;
  this->m_VirtualChannelSettings.BankSlotIDs[296] = -1;
  this->m_VirtualChannelSettings.SoundIDs[297] = -1;
  this->m_VirtualChannelSettings.BankSlotIDs[297] = -1;
  this->m_VirtualChannelSettings.SoundIDs[298] = -1;
  this->m_VirtualChannelSettings.BankSlotIDs[298] = -1;
  this->m_VirtualChannelSettings.SoundIDs[299] = -1;
  this->m_VirtualChannelSettings.BankSlotIDs[299] = -1;
  this->m_fStreamFaderScalingFactor = 1.0;
  this->m_fNonStreamFaderScalingFactor = 1.0;
  this->m_nReverbDepth = -10000;
  this->m_nAvailableChannels = 0;
  this->m_nReverbEnvironment = -1;
  *(_WORD *)&this->m_bInitialised = 0;
  *(_QWORD *)&this->m_fMusicMasterScalingFactor = v24;
  *(_QWORD *)&this->m_fMusicFaderScalingFactor = v25;
}

//----- (00392460) --------------------------------------------------------
int __fastcall CAEAudioHardware::GetActualNumberOfHardwareChannels(CAEAudioHardware *this)
{
  return 32;
}

//----- (00392464) --------------------------------------------------------
Bool8 __fastcall CAEAudioHardware::Initialise(CAEAudioHardware *this)
{
  CAEMP3BankLoader *v2; // r0
  CAEMP3BankLoader *v3; // r0
  CAEMP3TrackLoader *v4; // r0
  CAEMP3BankLoader *m_pBankLoader; // r1
  CAEMP3TrackLoader *v6; // r0
  CAEStreamingChannel *v7; // r0
  CAEStreamingChannel *v8; // r0
  Bool8 v9; // r8
  int v10; // r5
  CAEStaticChannel *v11; // r0
  CAEAudioChannel *v12; // r0
  int v13; // r1
  CAEAudioChannel *m_pStreamingChannel; // r0
  UInt16 m_nNumAudioChannels; // r0

  v2 = (CAEMP3BankLoader *)operator new(0x34u);
  CAEMP3BankLoader::CAEMP3BankLoader(v2);
  this->m_pBankLoader = v3;
  v4 = (CAEMP3TrackLoader *)operator new(0x24u);
  CAEMP3TrackLoader::CAEMP3TrackLoader(v4);
  m_pBankLoader = this->m_pBankLoader;
  this->m_pTrackLoader = v6;
  if ( !CAEMP3BankLoader::Initialise(m_pBankLoader) || !CAEMP3TrackLoader::Initialise(this->m_pTrackLoader) )
    return 0;
  CAEAudioHardware::InitOpenALListener(this);
  v7 = (CAEStreamingChannel *)operator new((unsigned int)&elf_hash_chain[20416]);
  CAEStreamingChannel::CAEStreamingChannel(v7, 0);
  this->m_pStreamingChannel = v8;
  CAEStreamingChannel::Initialise(v8);
  this->m_nNumAudioChannels = 25;
  v9 = 1;
  this->m_bHardwareMixing = 1;
  AESmoothFadeThread.m_nSmoothFades = 7;
  if ( this->m_nNumAudioChannels >= 2u )
  {
    v10 = 0;
    do
    {
      v11 = (CAEStaticChannel *)operator new(0x5Cu);
      CAEStaticChannel::CAEStaticChannel(v11, v10 + 1, this->m_bHardwareMixing, 0x10u);
      this->m_pPhysicalAudioChannels[v10 + 1] = v12;
      v13 = v10 + 2;
      ++v10;
    }
    while ( v13 < this->m_nNumAudioChannels );
  }
  m_pStreamingChannel = (CAEAudioChannel *)this->m_pStreamingChannel;
  this->m_pPhysicalAudioChannels[0] = m_pStreamingChannel;
  CAEAudioChannel::SetVolume(m_pStreamingChannel, -100.0);
  this->m_nRequestedChannelSoundFlagsList[0] = 55;
  CAESmoothFadeThread::Initialise(&AESmoothFadeThread);
  CAESmoothFadeThread::Start(&AESmoothFadeThread);
  CAEStreamThread::Initialise(&this->m_streamThread, this->m_pStreamingChannel);
  CAEStreamThread::Start(&this->m_streamThread);
  m_nNumAudioChannels = this->m_nNumAudioChannels;
  this->m_bInitialised = 1;
  this->m_nAvailableChannels = m_nNumAudioChannels;
  return v9;
}
// 392478: variable 'v3' is possibly undefined
// 39248A: variable 'v6' is possibly undefined
// 3924BC: variable 'v8' is possibly undefined
// 3924FE: variable 'v12' is possibly undefined
// 10168: using guessed type int elf_hash_chain[22025];

//----- (0039256C) --------------------------------------------------------
void __fastcall CAEAudioHardware::InitOpenALListener(CAEAudioHardware *this)
{
  ALCdevice *v2; // r0
  ALCcontext *Context; // r0
  _QWORD v4[4]; // [sp+0h] [bp-20h] BYREF

  v2 = j_alcOpenDevice(0);
  this->alDevice = v2;
  Context = j_alcCreateContext(v2, CAEAudioHardware::InitOpenALListener(void)::context_attribs);
  this->alContext = Context;
  j_alcMakeContextCurrent(Context);
  j_alListenerf(4106, 0.5);
  j_alListener3f(4100, 0.0, 0.0, 0.0);
  j_alListener3f(4102, 0.0, 0.0, 0.0);
  v4[0] = unk_613B78;
  v4[1] = unk_613B80;
  v4[2] = unk_613B88;
  j_alListenerfv(4111, (const ALfloat *)v4);
  j_alDistanceModel(0);
  trashMutex = OS_MutexCreate("OALTrash");
}

//----- (00392608) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetHRTF(CAEAudioHardware *this, int value)
{
  ALCdevice *alDevice; // r0

  alDevice = this->alDevice;
  if ( alDevice )
    sub_199814(alDevice, value);
}

//----- (00392616) --------------------------------------------------------
void __fastcall CAEAudioHardware::PauseOpenAL(CAEAudioHardware *this, int value)
{
  ALCdevice *alDevice; // r0

  alDevice = this->alDevice;
  if ( alDevice )
    sub_19C75C(alDevice, value);
}

//----- (00392624) --------------------------------------------------------
void __fastcall CAEAudioHardware::Terminate(CAEAudioHardware *this)
{
  CAEStreamThread *p_m_streamThread; // r5
  CAEAudioChannel **m_pPhysicalAudioChannels; // r5
  int i; // r6
  CAEAudioChannel *v5; // r0
  CAEMP3BankLoader *m_pBankLoader; // r0
  CAEMP3TrackLoader *m_pTrackLoader; // r0
  void *v8; // r0

  p_m_streamThread = &this->m_streamThread;
  this->m_bInitialised = 0;
  CAEStreamThread::Stop(&this->m_streamThread);
  CAESmoothFadeThread::Stop(&AESmoothFadeThread);
  CAEStreamThread::WaitForExit(p_m_streamThread);
  CAESmoothFadeThread::WaitForExit(&AESmoothFadeThread);
  m_pPhysicalAudioChannels = this->m_pPhysicalAudioChannels;
  for ( i = 0; i != 30; ++i )
  {
    v5 = m_pPhysicalAudioChannels[i];
    if ( v5 )
    {
      (*((void (__fastcall **)(CAEAudioChannel *))v5->_vptr$CAEAudioChannel + 1))(v5);
      m_pPhysicalAudioChannels[i] = 0;
    }
  }
  m_pBankLoader = this->m_pBankLoader;
  if ( m_pBankLoader )
  {
    (*((void (__fastcall **)(CAEMP3BankLoader *))m_pBankLoader->_vptr$CAEMP3BankLoader + 1))(m_pBankLoader);
    this->m_pBankLoader = 0;
  }
  m_pTrackLoader = this->m_pTrackLoader;
  if ( m_pTrackLoader )
  {
    CAEMP3TrackLoader::~CAEMP3TrackLoader(m_pTrackLoader);
    operator delete(v8);
    this->m_pTrackLoader = 0;
  }
  j_alcMakeContextCurrent(0);
  j_alcDestroyContext(this->alContext);
  sub_19B3AC(this->alDevice);
}
// 39268E: variable 'v8' is possibly undefined

//----- (003926BC) --------------------------------------------------------
void __fastcall CAEAudioHardware::Service(CAEAudioHardware *this)
{
  CAEAudioChannel **v2; // r5
  int v3; // r6
  unsigned int m_nNumAudioChannels; // r0
  signed int v5; // r1
  int v6; // r6
  int v7; // r0

  OALService();
  CAEAudioHardware::RescaleChannelVolumes(this);
  if ( this->m_nNumAudioChannels >= 2u )
  {
    v2 = &this->m_pPhysicalAudioChannels[1];
    v3 = 0;
    do
    {
      (*((void (__fastcall **)(CAEAudioChannel *))v2[v3]->_vptr$CAEAudioChannel + 7))(v2[v3]);
      m_nNumAudioChannels = this->m_nNumAudioChannels;
      v5 = v3 + 2;
      ++v3;
    }
    while ( v5 < (int)m_nNumAudioChannels );
    if ( m_nNumAudioChannels >= 2 )
    {
      v6 = 0;
      do
      {
        (*((void (__fastcall **)(CAEAudioChannel *))v2[v6]->_vptr$CAEAudioChannel + 2))(v2[v6]);
        v7 = v6 + 2;
        ++v6;
      }
      while ( v7 < this->m_nNumAudioChannels );
    }
  }
  CAEMP3BankLoader::UpdateVirtualChannels(
    this->m_pBankLoader,
    &this->m_VirtualChannelSettings,
    this->m_VirtualChannelSoundLengths,
    this->m_VirtualChannelLoopTimes);
  CAEMP3BankLoader::Service(this->m_pBankLoader);
  j_CAEStreamThread::Check(&this->m_streamThread);
}

//----- (0039273C) --------------------------------------------------------
void __fastcall CAEAudioHardware::RescaleChannelVolumes(CAEAudioHardware *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d8
  float32x2_t v3; // d9
  float32x2_t v4; // d10
  float32x2_t v5; // d13
  float *m_fRequestedChannelVolumeList; // r5
  int v8; // r4
  int v9; // r9
  CAEAudioChannel *v10; // r0
  unsigned int v11; // r0
  int m_nNumAudioChannels; // r0
  float v13; // s0
  Int16 *m_nRequestedChannelSoundFlagsList; // r6
  float v15; // s24
  int v16; // r5
  float v17; // s22
  CAEAudioHardware *v18; // r4
  int v19; // r0
  float v20; // s0
  float v21; // r0
  float v22; // s0
  Int16 v23; // r1
  CAEAudioChannel *v24; // r0
  int v25; // r11
  float v26; // s30
  int v27; // r0
  float v28; // s0
  float v29; // s2
  int v30; // r0
  CAEAudioChannel **m_pPhysicalAudioChannels; // r4
  Int16 *v32; // r5
  unsigned __int32 v33; // s18
  int v34; // r9
  CAEAudioHardware *v35; // r11
  float v36; // s0
  float v37; // s0
  float *p_m_fMusicFaderScalingFactor; // r0
  float v39; // s2
  float *p_m_fMusicMasterScalingFactor; // r0
  float v41; // s0
  float *p_m_fStreamFaderScalingFactor; // r0
  float v43; // s0
  CAEAudioChannel *v44; // r6
  float v45; // r1
  CAEAudioChannel *v46; // r0
  float v47; // s0
  CAEAudioChannel *v48; // r0
  int v49; // [sp+4h] [bp-64h]

  if ( this->m_nNumAudioChannels )
  {
    v2.n64_u32[0] = 0;
    m_fRequestedChannelVolumeList = this->m_fRequestedChannelVolumeList;
    v3.n64_u64[0] = v2.n64_u64[0];
    v8 = 0;
    LOBYTE(v9) = 0;
    LOBYTE(v49) = 0;
    do
    {
      v10 = this->m_pPhysicalAudioChannels[v8];
      if ( v10 && (*((int (__fastcall **)(CAEAudioChannel *))v10->_vptr$CAEAudioChannel + 3))(v10) )
      {
        v1.n64_f32[0] = *m_fRequestedChannelVolumeList;
        v11 = this->m_nRequestedChannelSoundFlagsList[v8];
        if ( *m_fRequestedChannelVolumeList > v3.n64_f32[0] )
        {
          v49 = ((unsigned __int16)v11 >> 7) & 1;
          v3.n64_u64[0] = v1.n64_u64[0];
        }
        if ( v11 << 31 && v1.n64_f32[0] > v2.n64_f32[0] )
        {
          v9 = (v11 >> 7) & 1;
          v2.n64_u64[0] = v1.n64_u64[0];
        }
      }
      else
      {
        *m_fRequestedChannelVolumeList = -100.0;
      }
      m_nNumAudioChannels = this->m_nNumAudioChannels;
      ++v8;
      ++m_fRequestedChannelVolumeList;
    }
    while ( v8 < m_nNumAudioChannels );
  }
  else
  {
    v3.n64_u32[0] = 0;
    m_nNumAudioChannels = 0;
    LOBYTE(v9) = 0;
    LOBYTE(v49) = 0;
    v2.n64_u64[0] = v3.n64_u64[0];
  }
  v1.n64_u32[0] = LODWORD(this->m_fLoudestOverallSoundVolumeLastFrame);
  if ( v3.n64_f32[0] < v1.n64_f32[0] )
  {
    if ( this->m_bLoudestOverallSoundWasSmoothDucking )
    {
      v13 = v1.n64_f32[0] + -0.5;
      if ( v13 > v3.n64_f32[0] )
      {
        LOBYTE(v49) = 1;
        v3.n64_f32[0] = v13;
      }
    }
    else
    {
      v1.n64_f32[0] = v1.n64_f32[0] + -1.2;
      v3.n64_u32[0] = vmax_f32(v1, v3).n64_u32[0];
    }
  }
  v1.n64_u32[0] = LODWORD(this->m_fLoudestFrontendSoundVolumeLastFrame);
  if ( v2.n64_f32[0] < v1.n64_f32[0] )
  {
    if ( this->m_bLoudestFrontendSoundWasSmoothDucking )
    {
      v1.n64_f32[0] = v1.n64_f32[0] + -0.5;
      if ( v1.n64_f32[0] > v2.n64_f32[0] )
      {
        LOBYTE(v9) = 1;
        v2.n64_u64[0] = v1.n64_u64[0];
      }
    }
    else
    {
      v1.n64_f32[0] = v1.n64_f32[0] + -1.2;
      v2.n64_u64[0] = vmax_f32(v1, v2).n64_u64[0];
    }
  }
  v4.n64_u32[0] = 0;
  if ( m_nNumAudioChannels )
  {
    v5.n64_u32[0] = 0;
    m_nRequestedChannelSoundFlagsList = this->m_nRequestedChannelSoundFlagsList;
    v15 = 0.0;
    v16 = 0;
    v17 = 0.0;
    v18 = this;
    while ( 1 )
    {
      v19 = m_nRequestedChannelSoundFlagsList[v16];
      if ( (v19 & 4) != 0 )
      {
        v1.n64_u32[0] = LODWORD(v18->m_fRequestedChannelVolumeList[0]);
        v1.n64_u64[0] = vmin_f32(v1, v5).n64_u64[0];
      }
      else
      {
        v20 = v2.n64_f32[0];
        if ( !(v19 << 31) )
          v20 = v3.n64_f32[0];
        v1.n64_f32[0] = v18->m_fRequestedChannelVolumeList[0] - v20;
      }
      LODWORD(v18->m_fRequestedChannelVolumeList[0]) = v1.n64_u32[0];
      v21 = powf(10.0, v1.n64_f32[0] / 20.0);
      v18->m_fLinearChannelVolumeList[0] = v21;
      v22 = v21;
      v23 = m_nRequestedChannelSoundFlagsList[v16];
      if ( (v23 & 2) != 0 )
      {
        v15 = v15 + v21;
      }
      else
      {
        if ( (v23 & 0x40) != 0 )
        {
          v24 = v18->m_pPhysicalAudioChannels[0];
          if ( v24 )
          {
            if ( (*((int (__fastcall **)(CAEAudioChannel *))v24->_vptr$CAEAudioChannel + 4))(v24) > -1 )
            {
              v25 = (*((__int16 (__fastcall **)(CAEAudioChannel *))v18->m_pPhysicalAudioChannels[0]->_vptr$CAEAudioChannel
                     + 5))(v18->m_pPhysicalAudioChannels[0]);
              v26 = v18->m_fLinearChannelVolumeList[0];
              v27 = (*((int (__fastcall **)(CAEAudioChannel *))v18->m_pPhysicalAudioChannels[0]->_vptr$CAEAudioChannel
                     + 4))(v18->m_pPhysicalAudioChannels[0]);
              v28 = (float)(v26 * (float)(v25 - v27)) / (float)v25;
              v29 = 0.0;
              if ( v28 >= 0.0 )
              {
                v29 = (float)(v26 * (float)(v25 - v27)) / (float)v25;
                if ( v28 > v18->m_fLinearChannelVolumeList[0] )
                  v29 = v18->m_fLinearChannelVolumeList[0];
              }
              v17 = v17 + v29;
              goto LABEL_45;
            }
            v22 = v18->m_fLinearChannelVolumeList[0];
          }
        }
        v17 = v17 + v22;
      }
LABEL_45:
      v30 = this->m_nNumAudioChannels;
      ++v16;
      v18 = (CAEAudioHardware *)((char *)v18 + 4);
      if ( v16 >= v30 )
        goto LABEL_48;
    }
  }
  v30 = 0;
  v17 = 0.0;
  v15 = 0.0;
LABEL_48:
  LODWORD(this->m_fLoudestFrontendSoundVolumeLastFrame) = v2.n64_u32[0];
  LODWORD(this->m_fLoudestOverallSoundVolumeLastFrame) = v3.n64_u32[0];
  this->m_bLoudestFrontendSoundWasSmoothDucking = v9;
  this->m_bLoudestOverallSoundWasSmoothDucking = v49;
  if ( v17 != 0.0 )
  {
    v4.n64_f32[0] = (float)((float)((float)(v15 * -0.8) + 3.0) * 16383.0) / v17;
    if ( !v30 )
      return;
    goto LABEL_52;
  }
  if ( v30 )
  {
LABEL_52:
    v2.n64_u32[0] = 1182792704;
    m_pPhysicalAudioChannels = this->m_pPhysicalAudioChannels;
    v32 = this->m_nRequestedChannelSoundFlagsList;
    v33 = vmin_f32(v4, v2).n64_u32[0];
    v34 = 0;
    v35 = this;
    do
    {
      v36 = 16383.0;
      if ( (v32[v34] & 2) == 0 )
        v36 = *(float *)&v33;
      v37 = v35->m_fLinearChannelVolumeList[0] * v36;
      v35->m_fLinearChannelVolumeList[0] = v37;
      p_m_fMusicFaderScalingFactor = &this->m_fMusicFaderScalingFactor;
      if ( (v32[v34] & 0x10) == 0 )
        p_m_fMusicFaderScalingFactor = &this->m_fEffectsFaderScalingFactor;
      v39 = *p_m_fMusicFaderScalingFactor;
      p_m_fMusicMasterScalingFactor = &this->m_fMusicMasterScalingFactor;
      if ( (v32[v34] & 0x10) == 0 )
        p_m_fMusicMasterScalingFactor = &this->m_fEffectsMasterScalingFactor;
      v41 = v37 * (float)(*p_m_fMusicMasterScalingFactor * v39);
      v35->m_fLinearChannelVolumeList[0] = v41;
      p_m_fStreamFaderScalingFactor = &this->m_fStreamFaderScalingFactor;
      if ( (v32[v34] & 0x20) == 0 )
        p_m_fStreamFaderScalingFactor = &this->m_fNonStreamFaderScalingFactor;
      v43 = v41 * *p_m_fStreamFaderScalingFactor;
      v35->m_fLinearChannelVolumeList[0] = v43;
      v44 = m_pPhysicalAudioChannels[v34];
      if ( v43 == 0.0 )
      {
        if ( v44 )
        {
          v45 = -100.0;
          v46 = m_pPhysicalAudioChannels[v34];
          goto LABEL_66;
        }
      }
      else if ( v44 )
      {
        v47 = CAEAudioUtility::AudioLog10(v43 / 16383.0);
        v46 = v44;
        v45 = v47 * 20.0;
LABEL_66:
        CAEAudioChannel::SetVolume(v46, v45);
        v48 = m_pPhysicalAudioChannels[v34];
        if ( v48 )
          (*((void (__fastcall **)(CAEAudioChannel *, _DWORD))v48->_vptr$CAEAudioChannel + 9))(
            v48,
            LODWORD(v35->m_fRequestedChannelFrequencyScalingFactors[0]));
      }
      ++v34;
      v35 = (CAEAudioHardware *)((char *)v35 + 4);
    }
    while ( v34 < this->m_nNumAudioChannels );
  }
}
// 392764: variable 'v2' is possibly undefined
// 3927A2: variable 'v1' is possibly undefined
// 3927DE: variable 'v3' is possibly undefined
// 3928A8: variable 'v5' is possibly undefined
// 3929C0: variable 'v4' is possibly undefined

//----- (00392AB8) --------------------------------------------------------
void __fastcall CAEAudioHardware::PlaySound(
        CAEAudioHardware *this,
        int ClientHandle,
        unsigned int Channel,
        UInt16 SoundID,
        UInt16 BankSlotID,
        int StartOffsetMs,
        int SoundFlags,
        float FrequencyFac)
{
  OALBuffer *SoundBuffer; // r10
  __int16 LoopOffset; // r0
  unsigned int v14; // r4
  char *v15; // r6
  _DWORD *v16; // r10
  int v17; // r0
  int v18; // r5
  UInt16 frequency[21]; // [sp+Eh] [bp-2Ah] BYREF

  if ( ClientHandle >= 0 && this->m_ClientChannelAllocationList[ClientHandle] > Channel )
  {
    SoundBuffer = CAEMP3BankLoader::GetSoundBuffer(this->m_pBankLoader, SoundID, BankSlotID, frequency);
    if ( SoundBuffer )
    {
      LoopOffset = CAEMP3BankLoader::GetLoopOffset(this->m_pBankLoader, SoundID, BankSlotID);
      v14 = ClientHandle + Channel;
      if ( (unsigned __int16)v14 <= 0x1Eu )
      {
        v15 = (char *)this + 4 * (unsigned __int16)v14;
        if ( CAEStaticChannel::SetAudioBuffer(
               *((CAEStaticChannel **)v15 + 755),
               SoundBuffer,
               SoundID,
               BankSlotID,
               LoopOffset,
               frequency[0]) )
        {
          v16 = v15 + 3020;
          v17 = *((_DWORD *)v15 + 755);
          LOWORD(v15) = StartOffsetMs;
          if ( StartOffsetMs <= 0 )
            LOWORD(v15) = 0;
          v18 = (*(int (__fastcall **)(int))(*(_DWORD *)v17 + 20))(v17);
          if ( StartOffsetMs >= 1 && (SoundFlags & 8) != 0 )
            v15 = (char *)(int)floorf((float)((float)(__int16)v15 / 100.0) * (float)v18);
          if ( v18 < (__int16)v15 )
            LOWORD(v15) = v18;
          (*(void (__fastcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)*v16 + 24))(
            *v16,
            (__int16)v15,
            (char)SoundFlags,
            LODWORD(FrequencyFac));
          this->m_nRequestedChannelSoundFlagsList[v14] = SoundFlags;
          *(_DWORD *)(*v16 + 12) = SoundFlags;
        }
      }
    }
  }
}
// 392AB8: using guessed type _DWORD SoundFlags_0;
// 392AB8: using guessed type UInt16 frequency[21];

//----- (00392BD4) --------------------------------------------------------
UInt16 __fastcall CAEAudioHardware::GetNumAvailableChannels(CAEAudioHardware *this)
{
  return this->m_nAvailableChannels;
}

//----- (00392BDA) --------------------------------------------------------
void __fastcall CAEAudioHardware::GetChannelPlayTimes(CAEAudioHardware *this, Int16 ClientHandle, Int16 *pPlayTimes)
{
  Int16 *v3; // r4
  int v4; // r2
  int v5; // r6
  CAEAudioChannel **v6; // r5
  int v7; // t1

  v3 = pPlayTimes;
  if ( pPlayTimes )
  {
    v4 = this->m_ClientChannelAllocationList[ClientHandle];
    if ( ClientHandle + v4 - 1 > (unsigned int)ClientHandle )
    {
      v5 = v4 - 1;
      v6 = &this->m_pPhysicalAudioChannels[ClientHandle];
      do
      {
        v7 = (int)*v6++;
        *v3++ = (*(int (__fastcall **)(int))(*(_DWORD *)v7 + 16))(v7);
        --v5;
      }
      while ( v5 );
    }
  }
}

//----- (00392C18) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetChannelVolume(
        CAEAudioHardware *this,
        int ClientHandle,
        unsigned int Channel,
        float fVolume,
        Bool8 bInvertPhase)
{
  if ( ClientHandle >= 0 && this->m_ClientChannelAllocationList[ClientHandle] > Channel )
    this->m_fRequestedChannelVolumeList[ClientHandle + Channel] = fVolume;
}

//----- (00392C3A) --------------------------------------------------------
void __fastcall CAEAudioHardware::LoadSoundBank(CAEAudioHardware *this, UInt16 BankID, Int16 BankSlotID)
{
  if ( !this->m_bEffectsLoadingDisabled )
    sub_18F5A8(this->m_pBankLoader, BankID, BankSlotID);
}

//----- (00392C4A) --------------------------------------------------------
Bool8 __fastcall CAEAudioHardware::IsSoundBankLoaded(CAEAudioHardware *this, UInt16 BankID, Int16 BankSlotID)
{
  return sub_18E328(this->m_pBankLoader, BankID, BankSlotID);
}

//----- (00392C52) --------------------------------------------------------
UInt8 __fastcall CAEAudioHardware::GetSoundBankLoadingStatus(CAEAudioHardware *this, UInt16 BankID, Int16 BankSlotID)
{
  return sub_19B608(this->m_pBankLoader, BankID, BankSlotID);
}

//----- (00392C5A) --------------------------------------------------------
void __fastcall CAEAudioHardware::StopSound(CAEAudioHardware *this, Int16 ClientHandle, UInt16 Channel)
{
  int v3; // r0

  if ( ClientHandle >= 0 && (unsigned int)this->m_ClientChannelAllocationList[ClientHandle] > Channel )
  {
    v3 = *((_DWORD *)&this->m_pPhysicalAudioChannels[ClientHandle] + Channel);
    if ( v3 )
      (*(void (__fastcall **)(int))(*(_DWORD *)v3 + 32))(v3);
  }
}

//----- (00392C80) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetChannelPosition(
        CAEAudioHardware *this,
        int ClientHandle,
        unsigned int Channel,
        CVector *pPosition,
        Bool8 bForceFront)
{
  CAEAudioChannel *v5; // r0

  if ( ClientHandle >= 0 && this->m_ClientChannelAllocationList[ClientHandle] > Channel )
  {
    v5 = (CAEAudioChannel *)*((_DWORD *)&this->m_pPhysicalAudioChannels[ClientHandle] + Channel);
    if ( v5 )
      sub_199E4C(v5, pPosition);
  }
}

//----- (00392CA8) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetChannelFrequencyScalingFactor(
        CAEAudioHardware *this,
        Int16 ClientHandle,
        UInt16 Channel,
        float fScalingFactor)
{
  if ( ClientHandle >= 0 && (unsigned int)this->m_ClientChannelAllocationList[ClientHandle] > Channel )
    this->m_fRequestedChannelFrequencyScalingFactors[ClientHandle + Channel] = fScalingFactor;
}

//----- (00392CCC) --------------------------------------------------------
float __fastcall CAEAudioHardware::GetSoundHeadroom(CAEAudioHardware *this, UInt16 SoundID, Int16 BankSlotID)
{
  return sub_18D87C(this->m_pBankLoader, SoundID, BankSlotID);
}

//----- (00392CD4) --------------------------------------------------------
void __fastcall CAEAudioHardware::EnableEffectsLoading(CAEAudioHardware *this)
{
  this->m_bEffectsLoadingDisabled = 0;
}

//----- (00392CDA) --------------------------------------------------------
void __fastcall CAEAudioHardware::DisableEffectsLoading(CAEAudioHardware *this)
{
  this->m_bEffectsLoadingDisabled = 1;
}

//----- (00392CE0) --------------------------------------------------------
void __fastcall CAEAudioHardware::RequestVirtualChannelSoundInfo(
        CAEAudioHardware *this,
        UInt16 VirtualChannel,
        UInt16 SoundID,
        UInt16 BankSlotID)
{
  char *v4; // r0

  if ( (unsigned int)(VirtualChannel >> 2) <= 0x4A )
  {
    v4 = (char *)this + 2 * VirtualChannel;
    *((_WORD *)v4 + 564) = SoundID;
    *((_WORD *)v4 + 264) = BankSlotID;
  }
}

//----- (00392CF8) --------------------------------------------------------
void __fastcall CAEAudioHardware::GetVirtualChannelSoundLengths(CAEAudioHardware *this, Int16 *pSoundLengths)
{
  sub_19EA98(pSoundLengths, this->m_VirtualChannelSoundLengths, 600);
}

//----- (00392D08) --------------------------------------------------------
void __fastcall CAEAudioHardware::GetVirtualChannelSoundLoopStartTimes(
        CAEAudioHardware *this,
        Int16 *pSoundLoopStartTimes)
{
  sub_19EA98(pSoundLoopStartTimes, this->m_VirtualChannelLoopTimes, 600);
}

//----- (00392D18) --------------------------------------------------------
void __fastcall CAEAudioHardware::LoadSound(CAEAudioHardware *this, UInt16 BankID, UInt16 SoundID, Int16 BankSlotID)
{
  if ( !this->m_bEffectsLoadingDisabled )
    sub_195A20(this->m_pBankLoader, BankID, SoundID, BankSlotID);
}

//----- (00392D2C) --------------------------------------------------------
Bool8 __fastcall CAEAudioHardware::IsSoundLoaded(
        CAEAudioHardware *this,
        UInt16 BankID,
        UInt16 SoundID,
        Int16 BankSlotID)
{
  return sub_1923AC(this->m_pBankLoader, BankID, SoundID, BankSlotID);
}

//----- (00392D34) --------------------------------------------------------
UInt8 __fastcall CAEAudioHardware::GetSoundLoadingStatus(
        CAEAudioHardware *this,
        UInt16 BankID,
        UInt16 SoundID,
        Int16 BankSlotID)
{
  return sub_1932A0(this->m_pBankLoader, BankID, SoundID, BankSlotID);
}

//----- (00392D3C) --------------------------------------------------------
void __fastcall CAEAudioHardware::PlayTrack(
        CAEAudioHardware *this,
        unsigned int TrackID,
        int NextTrackID,
        unsigned int StartOffsetMs,
        char TrackFlags,
        bool bUserTrack,
        bool bUserNextTrack)
{
  this->m_cTrackFlags = TrackFlags;
  CAEStreamThread::PlayTrack(
    &this->m_streamThread,
    TrackID,
    NextTrackID,
    StartOffsetMs,
    TrackFlags,
    bUserTrack,
    bUserNextTrack);
}

//----- (00392D62) --------------------------------------------------------
void __fastcall CAEAudioHardware::StartTrackPlayback(CAEAudioHardware *this)
{
  (*((void (__fastcall **)(CAEStreamingChannel *, _DWORD, _DWORD, int))this->m_pStreamingChannel->_vptr$CAEAudioChannel
   + 6))(
    this->m_pStreamingChannel,
    0,
    this->m_cTrackFlags,
    1065353216);
}

//----- (00392D7A) --------------------------------------------------------
void __fastcall CAEAudioHardware::StopTrack(CAEAudioHardware *this)
{
  sub_18AD04(&this->m_streamThread);
}

//----- (00392D82) --------------------------------------------------------
int __fastcall CAEAudioHardware::GetTrackPlayTime(CAEAudioHardware *this)
{
  return sub_1986D4(&this->m_streamThread);
}

//----- (00392D8A) --------------------------------------------------------
int __fastcall CAEAudioHardware::GetTrackLengthMs(CAEAudioHardware *this)
{
  return sub_19EAD8(&this->m_streamThread);
}

//----- (00392D92) --------------------------------------------------------
int __fastcall CAEAudioHardware::GetActiveTrackID(CAEAudioHardware *this)
{
  return j_CAEStreamThread::GetActiveTrackID(&this->m_streamThread);
}

//----- (00392D9A) --------------------------------------------------------
int __fastcall CAEAudioHardware::GetPlayingTrackID(CAEAudioHardware *this)
{
  return sub_198500(&this->m_streamThread);
}

//----- (00392DA4) --------------------------------------------------------
void __fastcall CAEAudioHardware::GetBeatInfo(CAEAudioHardware *this, tBeatInfo *pComplexBeatInfo)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  CAEStreamThread *p_m_streamThread; // r4
  int v7; // r0
  int v8; // r0
  int *v9; // r9
  tBeatInfo *v10; // r0
  tBeatInfo *p_gBeatInfo; // r1
  int TrackPlayTime; // r4
  int BeatNumber; // r10
  int v14; // r6
  int *v15; // r0
  int *v16; // r1
  int *v17; // r0
  int v18; // r1
  int *v19; // r0
  int *v20; // r0
  int v21; // t1
  int *v22; // r0
  int *v23; // r0
  int v24; // t1
  int *v25; // r0
  int *v26; // r0
  int v27; // t1
  int *v28; // r0
  int *v29; // r0
  int v30; // t1
  int *v31; // r0
  int *v32; // r0
  int v33; // t1
  int *v34; // r0
  int *v35; // r0
  int v36; // t1
  int *v37; // r0
  int *v38; // r0
  int v39; // t1
  int *v40; // r0
  int *v41; // r0
  int v42; // t1
  int *v43; // r0
  int *v44; // r0
  int v45; // t1

  p_m_streamThread = &this->m_streamThread;
  if ( CAEStreamThread::GetActiveTrackID(&this->m_streamThread) != -1 )
  {
    v7 = *(int *)((char *)&this->m_pStreamingChannel->_vptr$CAEAudioChannel + (unsigned int)&elf_hash_chain[20404]);
    if ( v7 )
    {
      if ( (*(int (__fastcall **)(int))(*(_DWORD *)v7 + 36))(v7) )
      {
        v8 = *(int *)((char *)&this->m_pStreamingChannel->_vptr$CAEAudioChannel + (unsigned int)&elf_hash_chain[20404]);
        if ( v8 )
          v9 = (int *)(*(int (__fastcall **)(int))(*(_DWORD *)v8 + 36))(v8);
        else
          v9 = 0;
        TrackPlayTime = CAEStreamThread::GetTrackPlayTime(p_m_streamThread);
        if ( TrackPlayTime < 0 )
        {
          if ( TrackPlayTime == -7 )
          {
LABEL_74:
            p_gBeatInfo = &this->gBeatInfo;
            v10 = pComplexBeatInfo;
            goto LABEL_75;
          }
        }
        else if ( *v9 >= 0 )
        {
          BeatNumber = this->gBeatInfo.BeatNumber;
          if ( BeatNumber >= 0 )
          {
            v2.n64_u32[0] = 0;
            v3.n64_f32[0] = (float)(TrackPlayTime - 50);
            TrackPlayTime = (int)vmax_f32(v3, v2).n64_f32[0];
          }
          v14 = 0;
          this->gBeatInfo.bBeatInfoPresent = 1;
          this->gBeatInfo.BeatTypeThisFrame = 0;
          this->gBeatInfo.BeatNumber = -1;
          memset(&this->gBeatInfo, 0, 0xA0u);
          if ( *v9 < TrackPlayTime )
          {
            v14 = 0;
            do
            {
              v15 = &v9[2 * v14];
              if ( v15[1] < 1 )
                break;
              ++v14;
            }
            while ( v15[2] < TrackPlayTime );
          }
          v16 = &v9[2 * v14];
          v17 = v16 + 1;
          if ( v16[1] < 1 )
          {
            if ( v14 >= 1 )
            {
              this->gBeatInfo.BeatWindow[9].Time = *(v16 - 2) - TrackPlayTime;
              this->gBeatInfo.BeatWindow[9].Type = *(v16 - 1);
              if ( v14 != 1 )
              {
                this->gBeatInfo.BeatWindow[8].Time = v9[2 * v14 - 4] - TrackPlayTime;
                this->gBeatInfo.BeatWindow[8].Type = v9[2 * v14 - 3];
                if ( v14 >= 3 )
                {
                  this->gBeatInfo.BeatWindow[7].Time = v9[2 * v14 - 6] - TrackPlayTime;
                  this->gBeatInfo.BeatWindow[7].Type = v9[2 * v14 - 5];
                  if ( v14 != 3 )
                  {
                    this->gBeatInfo.BeatWindow[6].Time = v9[2 * v14 - 8] - TrackPlayTime;
                    this->gBeatInfo.BeatWindow[6].Type = v9[2 * v14 - 7];
                    if ( v14 >= 5 )
                    {
                      this->gBeatInfo.BeatWindow[5].Time = v9[2 * v14 - 10] - TrackPlayTime;
                      this->gBeatInfo.BeatWindow[5].Type = v9[2 * v14 - 9];
                      if ( v14 != 5 )
                      {
                        this->gBeatInfo.BeatWindow[4].Time = v9[2 * v14 - 12] - TrackPlayTime;
                        this->gBeatInfo.BeatWindow[4].Type = v9[2 * v14 - 11];
                        if ( v14 >= 7 )
                        {
                          this->gBeatInfo.BeatWindow[3].Time = v9[2 * v14 - 14] - TrackPlayTime;
                          this->gBeatInfo.BeatWindow[3].Type = v9[2 * v14 - 13];
                          if ( v14 != 7 )
                          {
                            this->gBeatInfo.BeatWindow[2].Time = v9[2 * v14 - 16] - TrackPlayTime;
                            this->gBeatInfo.BeatWindow[2].Type = v9[2 * v14 - 15];
                            if ( v14 >= 9 )
                            {
                              this->gBeatInfo.BeatWindow[1].Time = v9[2 * v14 - 18] - TrackPlayTime;
                              this->gBeatInfo.BeatWindow[1].Type = v9[2 * v14 - 17];
                              if ( v14 != 9 )
                              {
                                this->gBeatInfo.BeatWindow[0].Time = v9[2 * v14 - 20] - TrackPlayTime;
                                this->gBeatInfo.BeatWindow[0].Type = v9[2 * v14 - 19];
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
            goto LABEL_74;
          }
          v18 = v14 - 1;
          if ( v14 == BeatNumber || v14 < 1 )
          {
            if ( v14 < 1 )
              goto LABEL_44;
          }
          else
          {
            this->gBeatInfo.BeatTypeThisFrame = v9[2 * v18 + 1];
          }
          this->gBeatInfo.BeatWindow[9].Time = v9[2 * v18] - TrackPlayTime;
          this->gBeatInfo.BeatWindow[9].Type = v9[2 * v18 + 1];
          if ( v14 > 1 )
          {
            this->gBeatInfo.BeatWindow[8].Time = v9[2 * v14 - 4] - TrackPlayTime;
            this->gBeatInfo.BeatWindow[8].Type = v9[2 * v14 - 3];
            if ( v14 != 2 )
            {
              this->gBeatInfo.BeatWindow[7].Time = v9[2 * v14 - 6] - TrackPlayTime;
              this->gBeatInfo.BeatWindow[7].Type = v9[2 * v14 - 5];
              if ( v14 >= 4 )
              {
                this->gBeatInfo.BeatWindow[6].Time = v9[2 * v14 - 8] - TrackPlayTime;
                this->gBeatInfo.BeatWindow[6].Type = v9[2 * v14 - 7];
                if ( v14 != 4 )
                {
                  this->gBeatInfo.BeatWindow[5].Time = v9[2 * v14 - 10] - TrackPlayTime;
                  this->gBeatInfo.BeatWindow[5].Type = v9[2 * v14 - 9];
                  if ( v14 >= 6 )
                  {
                    this->gBeatInfo.BeatWindow[4].Time = v9[2 * v14 - 12] - TrackPlayTime;
                    this->gBeatInfo.BeatWindow[4].Type = v9[2 * v14 - 11];
                    if ( v14 != 6 )
                    {
                      this->gBeatInfo.BeatWindow[3].Time = v9[2 * v14 - 14] - TrackPlayTime;
                      this->gBeatInfo.BeatWindow[3].Type = v9[2 * v14 - 13];
                      if ( v14 >= 8 )
                      {
                        this->gBeatInfo.BeatWindow[2].Time = v9[2 * v14 - 16] - TrackPlayTime;
                        this->gBeatInfo.BeatWindow[2].Type = v9[2 * v14 - 15];
                        if ( v14 != 8 )
                        {
                          this->gBeatInfo.BeatWindow[1].Time = v9[2 * v14 - 18] - TrackPlayTime;
                          this->gBeatInfo.BeatWindow[1].Type = v9[2 * v14 - 17];
                          if ( v14 >= 10 )
                          {
                            this->gBeatInfo.BeatWindow[0].Time = v9[2 * v14 - 20] - TrackPlayTime;
                            this->gBeatInfo.BeatWindow[0].Type = v9[2 * v14 - 19];
                            if ( v14 >= 1000 )
                            {
LABEL_73:
                              this->gBeatInfo.BeatNumber = v14;
                              goto LABEL_74;
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
LABEL_44:
          if ( *v17 >= 1 )
          {
            this->gBeatInfo.BeatWindow[10].Time = v9[2 * v14] - TrackPlayTime;
            this->gBeatInfo.BeatWindow[10].Type = *v17;
          }
          if ( v14 < 999 )
          {
            v19 = &v9[2 * v14 + 2];
            v21 = v19[1];
            v20 = v19 + 1;
            if ( v21 >= 1 )
            {
              this->gBeatInfo.BeatWindow[11].Time = v9[2 * v14 + 2] - TrackPlayTime;
              this->gBeatInfo.BeatWindow[11].Type = *v20;
            }
            if ( v14 <= 997 )
            {
              v22 = &v9[2 * v14 + 4];
              v24 = v22[1];
              v23 = v22 + 1;
              if ( v24 >= 1 )
              {
                this->gBeatInfo.BeatWindow[12].Time = v9[2 * v14 + 4] - TrackPlayTime;
                this->gBeatInfo.BeatWindow[12].Type = *v23;
              }
              if ( v14 <= 996 )
              {
                v25 = &v9[2 * v14 + 6];
                v27 = v25[1];
                v26 = v25 + 1;
                if ( v27 >= 1 )
                {
                  this->gBeatInfo.BeatWindow[13].Time = v9[2 * v14 + 6] - TrackPlayTime;
                  this->gBeatInfo.BeatWindow[13].Type = *v26;
                }
                if ( v14 < 996 )
                {
                  v28 = &v9[2 * v14 + 8];
                  v30 = v28[1];
                  v29 = v28 + 1;
                  if ( v30 >= 1 )
                  {
                    this->gBeatInfo.BeatWindow[14].Time = v9[2 * v14 + 8] - TrackPlayTime;
                    this->gBeatInfo.BeatWindow[14].Type = *v29;
                  }
                  if ( v14 <= 994 )
                  {
                    v31 = &v9[2 * v14 + 10];
                    v33 = v31[1];
                    v32 = v31 + 1;
                    if ( v33 >= 1 )
                    {
                      this->gBeatInfo.BeatWindow[15].Time = v9[2 * v14 + 10] - TrackPlayTime;
                      this->gBeatInfo.BeatWindow[15].Type = *v32;
                    }
                    if ( v14 <= 993 )
                    {
                      v34 = &v9[2 * v14 + 12];
                      v36 = v34[1];
                      v35 = v34 + 1;
                      if ( v36 >= 1 )
                      {
                        this->gBeatInfo.BeatWindow[16].Time = v9[2 * v14 + 12] - TrackPlayTime;
                        this->gBeatInfo.BeatWindow[16].Type = *v35;
                      }
                      if ( v14 <= 992 )
                      {
                        v37 = &v9[2 * v14 + 14];
                        v39 = v37[1];
                        v38 = v37 + 1;
                        if ( v39 >= 1 )
                        {
                          this->gBeatInfo.BeatWindow[17].Time = v9[2 * v14 + 14] - TrackPlayTime;
                          this->gBeatInfo.BeatWindow[17].Type = *v38;
                        }
                        if ( v14 < 992 )
                        {
                          v40 = &v9[2 * v14 + 16];
                          v42 = v40[1];
                          v41 = v40 + 1;
                          if ( v42 >= 1 )
                          {
                            this->gBeatInfo.BeatWindow[18].Time = v9[2 * v14 + 16] - TrackPlayTime;
                            this->gBeatInfo.BeatWindow[18].Type = *v41;
                          }
                          if ( v14 <= 990 )
                          {
                            v43 = &v9[2 * v14 + 18];
                            v45 = v43[1];
                            v44 = v43 + 1;
                            if ( v45 >= 1 )
                            {
                              this->gBeatInfo.BeatWindow[19].Time = v9[2 * v14 + 18] - TrackPlayTime;
                              this->gBeatInfo.BeatWindow[19].Type = *v44;
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          goto LABEL_73;
        }
        memset(&this->gBeatInfo, 0, 0xA4u);
        goto LABEL_74;
      }
    }
  }
  memset(&this->gBeatInfo, 0, 0xA4u);
  v10 = pComplexBeatInfo;
  p_gBeatInfo = &this->gBeatInfo;
LABEL_75:
  qmemcpy(v10, p_gBeatInfo, sizeof(tBeatInfo));
}
// 392E2C: variable 'v3' is possibly undefined
// 392E2C: variable 'v2' is possibly undefined
// 10168: using guessed type int elf_hash_chain[22025];

//----- (0039328C) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetBassSetting(CAEAudioHardware *this, Int8 bassSetting, float fScalingFactor)
{
  CAEStreamingChannel *m_pStreamingChannel; // r3

  m_pStreamingChannel = this->m_pStreamingChannel;
  this->m_nBassSetting = bassSetting;
  this->m_fBassFactor = fScalingFactor;
  sub_1908F8(m_pStreamingChannel, bassSetting, fScalingFactor);
}

//----- (0039329E) --------------------------------------------------------
void __fastcall CAEAudioHardware::DisableBassEq(CAEAudioHardware *this)
{
  sub_1908F8(this->m_pStreamingChannel, 0, 0.0);
}

//----- (003932AA) --------------------------------------------------------
void __fastcall CAEAudioHardware::EnableBassEq(CAEAudioHardware *this)
{
  sub_1908F8(this->m_pStreamingChannel, this->m_nBassSetting, this->m_fBassFactor);
}

//----- (003932BC) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetChannelFlags(
        CAEAudioHardware *this,
        Int16 ClientHandle,
        UInt16 Channel,
        Int16 flags)
{
  if ( ClientHandle >= 0 && (unsigned int)this->m_ClientChannelAllocationList[ClientHandle] > Channel )
    this->m_nRequestedChannelSoundFlagsList[ClientHandle + Channel] = flags;
}

//----- (003932D8) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetMusicMasterScalingFactor(CAEAudioHardware *this, float fScalingFactor)
{
  this->m_fMusicMasterScalingFactor = fScalingFactor;
}

//----- (003932DE) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetEffectsMasterScalingFactor(CAEAudioHardware *this, float fScalingFactor)
{
  this->m_fEffectsMasterScalingFactor = fScalingFactor;
}

//----- (003932E4) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetMusicFaderScalingFactor(CAEAudioHardware *this, float fScalingFactor)
{
  this->m_fMusicFaderScalingFactor = fScalingFactor;
}

//----- (003932EA) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetEffectsFaderScalingFactor(CAEAudioHardware *this, float fScalingFactor)
{
  this->m_fEffectsFaderScalingFactor = fScalingFactor;
}

//----- (003932F0) --------------------------------------------------------
float __fastcall CAEAudioHardware::GetEffectsMasterScalingFactor(CAEAudioHardware *this)
{
  return this->m_fEffectsMasterScalingFactor;
}

//----- (003932F6) --------------------------------------------------------
float __fastcall CAEAudioHardware::GetMusicMasterScalingFactor(CAEAudioHardware *this)
{
  return this->m_fMusicMasterScalingFactor;
}

//----- (003932FC) --------------------------------------------------------
float __fastcall CAEAudioHardware::GetEffectsFaderScalingFactor(CAEAudioHardware *this)
{
  return this->m_fEffectsFaderScalingFactor;
}

//----- (00393302) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetStreamFaderScalingFactor(CAEAudioHardware *this, float fScalingFactor)
{
  this->m_fStreamFaderScalingFactor = fScalingFactor;
}

//----- (00393308) --------------------------------------------------------
void __fastcall CAEAudioHardware::SetNonStreamFaderScalingFactor(CAEAudioHardware *this, float fScalingFactor)
{
  this->m_fNonStreamFaderScalingFactor = fScalingFactor;
}

//----- (0039330E) --------------------------------------------------------
Bool8 __fastcall CAEAudioHardware::IsStreamingFromDVD(CAEAudioHardware *this)
{
  return 0;
}

//----- (00393312) --------------------------------------------------------
unsigned __int8 __fastcall CAEAudioHardware::GetDVDDriveLetter(CAEAudioHardware *this)
{
  return 0;
}

//----- (00393316) --------------------------------------------------------
Bool8 __fastcall CAEAudioHardware::CheckDVD(CAEAudioHardware *this)
{
  return 0;
}

//----- (0039331A) --------------------------------------------------------
void __fastcall CAEAudioHardware::PauseAllSounds(CAEAudioHardware *this)
{
  int m_bInitialised; // r0
  bool v3; // zf
  int v4; // r6

  m_bInitialised = this->m_bInitialised;
  v3 = m_bInitialised == 0;
  if ( m_bInitialised )
    v3 = this->m_nNumAudioChannels == 0;
  if ( !v3 )
  {
    v4 = 0;
    do
    {
      (*((void (__fastcall **)(CAEAudioChannel *, _DWORD))this->m_pPhysicalAudioChannels[v4]->_vptr$CAEAudioChannel + 9))(
        this->m_pPhysicalAudioChannels[v4],
        0);
      ++v4;
    }
    while ( v4 < this->m_nNumAudioChannels );
  }
}

//----- (00393354) --------------------------------------------------------
void __fastcall CAEAudioHardware::ResumeAllSounds(CAEAudioHardware *this)
{
  if ( this->m_bInitialised )
    CAEAudioHardware::RescaleChannelVolumes(this);
}

//----- (00393360) --------------------------------------------------------
void __fastcall CAEAudioHardware::~CAEAudioHardware(CAEAudioHardware *this)
{
  CAEStreamThread::~CAEStreamThread(&this->m_streamThread);
}

//----- (00393374) --------------------------------------------------------
Int32 __fastcall CAEAudioUtility::GetRandomNumberInRange(Int32 Min, Int32 Max)
{
  return (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)(1 - Min + Max)) + Min;
}

//----- (003933B4) --------------------------------------------------------
float __fastcall CAEAudioUtility::GetRandomNumberInRange(float Min, float Max)
{
  return (float)((float)(Max - Min) * (float)((float)rand() * 4.6566e-10)) + Min;
}

//----- (003933F0) --------------------------------------------------------
Bool8 __fastcall CAEAudioUtility::ResolveProbability(float Probability)
{
  if ( Probability >= 1.0 )
    return 1;
  return (float)((float)((float)rand() * 4.6566e-10) + 0.0) < Probability;
}

//----- (0039344C) --------------------------------------------------------
Bool8 __fastcall CAEAudioUtility::GetBankAndSoundFromScriptSlotAudioEvent(
        tAudioEvent *pScriptSlotAudioEvent,
        int *pBankID,
        int *pSoundID,
        int Slot)
{
  tAudioEvent v6; // r0
  int v8; // r0

  v6 = *pScriptSlotAudioEvent;
  if ( v6 < 1800 )
    return 0;
  if ( v6 >= 2000 )
  {
    if ( v6 == 0xFFFF )
    {
      *pBankID = 291;
      if ( (unsigned int)Slot > 3 )
        v8 = 0;
      else
        v8 = (2 * Slot) & 2;
    }
    else
    {
      *pBankID = (int)floorf((float)(v6 - 2000) / 200.0) + 147;
      v8 = (*pScriptSlotAudioEvent - 2000) % 200;
    }
  }
  else
  {
    *pBankID = gScriptBanksLookup[v6 - 1800];
    v8 = -1;
  }
  *pSoundID = v8;
  return 1;
}

//----- (00393508) --------------------------------------------------------
float __fastcall CAEAudioUtility::GetPiecewiseLinear(float fRatio, Int16 Nodes, float (*Graph)[2])
{
  float *v4; // r0
  float v6; // s2
  int v7; // r12
  float *v8; // r3
  int i; // r0
  float *v10; // r0

  v4 = &(*Graph)[2 * Nodes - 2];
  if ( *v4 < fRatio )
    return v4[1];
  v6 = (*Graph)[0];
  if ( (*Graph)[0] >= fRatio )
    return (*Graph)[1];
  v7 = 0;
  if ( Nodes >= 1 && v6 < fRatio )
  {
    v8 = &(*Graph)[2];
    for ( i = 1; ; ++i )
    {
      v6 = *v8;
      v7 = i;
      if ( i >= Nodes )
        break;
      v8 += 2;
    }
  }
  v10 = &(*Graph)[2 * v7];
  return *(v10 - 1)
       + (float)((float)((float)(fRatio - *(v10 - 2)) / (float)(v6 - *(v10 - 2))) * (float)(v10[1] - *(v10 - 1)));
}

//----- (003935A4) --------------------------------------------------------
CVehicle *CAEAudioUtility::FindVehicleOfPlayer()
{
  CVehicle *PlayerVehicle; // r4
  CPlayerPed *PlayerPed; // r0
  bool v2; // zf

  PlayerVehicle = FindPlayerVehicle(CWorld::PlayerInFocus, 1);
  PlayerPed = FindPlayerPed(-1);
  if ( !PlayerVehicle )
  {
    v2 = PlayerPed == 0;
    if ( PlayerPed )
    {
      PlayerPed = (CPlayerPed *)PlayerPed->m_pAttachToEntity;
      PlayerVehicle = 0;
      v2 = PlayerPed == 0;
    }
    if ( !v2 && (*(_BYTE *)&PlayerPed->m_info & 7) == 2 )
      return (CVehicle *)PlayerPed;
  }
  return PlayerVehicle;
}

//----- (003935E8) --------------------------------------------------------
float __fastcall CAEAudioUtility::AudioLog10(float fRatio)
{
  if ( fRatio < 0.00001 )
    return -5.0;
  else
    return sub_1907EC(fRatio);
}

//----- (0039360C) --------------------------------------------------------
uint64 CAEAudioUtility::GetCurrentTimeInMilliseconds()
{
  return OS_TimeMS();
}

//----- (00393618) --------------------------------------------------------
Int32 __fastcall CAEAudioUtility::ConvertFromBytesToMS(UInt32 NumBytes, UInt32 SamplesPerSecond, UInt16 NumChannels)
{
  return (int)floorf((float)NumBytes / (float)((float)(SamplesPerSecond * NumChannels) * 0.002));
}

//----- (00393654) --------------------------------------------------------
Int32 __fastcall CAEAudioUtility::ConvertFromMSToBytes(
        UInt32 NumMilliseconds,
        UInt32 SamplesPerSecond,
        UInt16 NumChannels)
{
  int v3; // r4
  int v4; // r5

  v3 = NumChannels;
  v4 = (int)floorf((float)((float)(SamplesPerSecond * NumChannels) * 0.002) * (float)NumMilliseconds);
  return v4 % (2 * v3) + v4;
}

//----- (0039369C) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::InitialisePostLoading(CAECollisionAudioEntity *this)
{
  CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x27u, 2);
  sub_18AFEC(&AEAudioHardware, 0x1Bu, 3);
}

//----- (003936C4) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::ReportCollision(
        CAECollisionAudioEntity *this,
        CEntity *pEntityA,
        CEntity *pEntityB,
        int SurfaceA,
        int SurfaceB,
        CVector *vPosition,
        CVector *pvNormal,
        float fImpulseMagnitude,
        float fRelVelSqr,
        int bForceOneShot,
        int bForceLooping)
{
  int v14; // r1
  int v16; // r10
  uint32 v17; // r5
  int v18; // r9
  bool v19; // zf
  CEntity *v20; // r1
  CEntity *v21; // r11
  int v22; // r0
  bool v23; // zf
  int32 FrictionEffect; // r0
  int m_nModelIndex; // r1
  int v26; // r2
  int v27; // lr
  Int8 *p_SoundStatus; // r1
  int v29; // r8
  CEntity *v30; // r2
  bool v31; // zf
  char *v32; // r0
  CAESound *v33; // r1
  char *v34; // r0
  CAESound *v35; // r1
  float v36; // [sp+4h] [bp-64h]
  CVector *v37; // [sp+8h] [bp-60h]
  CAECollisionAudioEntity *v38; // [sp+24h] [bp-44h]
  int v39; // [sp+2Ch] [bp-3Ch]

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2)
    && fRelVelSqr > 0.0
    && this->m_nActiveCollisionSounds != 300 )
  {
    v14 = 0;
    v38 = this;
    do
    {
      v17 = (unsigned __int8)SurfaceB;
      v39 = SurfaceB;
      while ( 1 )
      {
        v18 = v14;
        v19 = v14 == 0;
        v20 = pEntityA;
        v16 = SurfaceA;
        v21 = pEntityB;
        if ( v19 )
          v21 = pEntityA;
        if ( v19 )
          v20 = pEntityB;
        v22 = *(_BYTE *)&v21->m_info & 7;
        if ( v22 != 2 )
          break;
        v23 = v20 == 0;
        if ( v20 )
          v23 = pvNormal == 0;
        if ( v23
          || (*(_BYTE *)&v20->m_info & 7) != 1
          || (float)((float)((float)(pvNormal->x * v21->m_pMat->xz) + (float)(pvNormal->y * v21->m_pMat->yz))
                   + (float)(pvNormal->z * v21->m_pMat->zz)) <= 0.6
          || LODWORD(v21[24].m_transform.m_translate.x) == 10 )
        {
          goto LABEL_54;
        }
        if ( v18 )
        {
          if ( v18 == 1 && SurfaceInfos_c::GetFrictionEffect(&g_surfaceInfos, (unsigned __int8)SurfaceA) != 1 )
          {
            LOBYTE(SurfaceB) = 67;
            goto LABEL_63;
          }
LABEL_54:
          if ( LODWORD(v21[24].m_transform.m_translate.x) == 10 )
          {
            SurfaceB = v39;
            if ( v18 )
              SurfaceB = -68;
            else
              v16 = -68;
          }
          else
          {
            SurfaceB = v39;
            if ( v18 )
              SurfaceB = 63;
            else
              v16 = 63;
          }
          goto LABEL_61;
        }
        FrictionEffect = SurfaceInfos_c::GetFrictionEffect(&g_surfaceInfos, v17);
        v14 = 1;
        SurfaceA = 67;
        if ( FrictionEffect == 1 )
          goto LABEL_54;
      }
      m_nModelIndex = v21->m_nModelIndex;
      switch ( v21->m_nModelIndex )
      {
        case 0x156:
        case 0x157:
        case 0x16C:
          SurfaceB = v39;
          if ( v18 )
            SurfaceB = -65;
          else
            v16 = -65;
          break;
        case 0x158:
          SurfaceB = v39;
          if ( v18 )
            SurfaceB = 45;
          else
            v16 = 45;
          break;
        case 0x16B:
          SurfaceB = v39;
          if ( v18 )
            SurfaceB = -66;
          else
            v16 = -66;
          break;
        default:
          if ( m_nModelIndex == MI_BASKETBALL )
          {
            SurfaceB = v39;
            if ( v18 )
              SurfaceB = -63;
            else
              v16 = -63;
          }
          else if ( m_nModelIndex == MI_PUNCHBAG )
          {
            SurfaceB = v39;
            if ( v18 )
              SurfaceB = -62;
            else
              v16 = -62;
          }
          else if ( m_nModelIndex == MI_GRASSHOUSE )
          {
            SurfaceB = v39;
            if ( v18 )
              SurfaceB = -81;
            else
              v16 = -81;
          }
          else if ( m_nModelIndex == MI_IMY_GRAY_CRATE )
          {
            SurfaceB = v39;
            if ( v18 )
              SurfaceB = 43;
            else
              v16 = 43;
          }
          else
          {
            if ( (unsigned __int8)(v22 - 2) > 2u )
            {
              SurfaceB = v39;
              goto LABEL_62;
            }
            SurfaceB = v39;
            if ( (LOBYTE(v21[1].m_transform.m_translate.y) & 0x80) != 0 )
            {
              if ( v18 )
                SurfaceB = -64;
              else
                v16 = -64;
            }
          }
          break;
      }
LABEL_61:
      SurfaceA = v16;
LABEL_62:
      v14 = v18 + 1;
    }
    while ( v18 != 1 );
LABEL_63:
    if ( bForceOneShot )
    {
LABEL_64:
      CAECollisionAudioEntity::PlayOneShotCollisionSound(
        v38,
        pEntityA,
        pEntityB,
        SurfaceA,
        (unsigned __int8)SurfaceB,
        fImpulseMagnitude,
        vPosition);
      return;
    }
    v26 = 0;
    LOBYTE(v27) = 0;
    p_SoundStatus = &v38->m_CollisionSoundList[0].SoundStatus;
    while ( 1 )
    {
      v29 = v26;
      v30 = (CEntity *)*((_DWORD *)p_SoundStatus - 4);
      if ( v30 == pEntityA && *((CEntity **)p_SoundStatus - 3) == pEntityB )
        goto LABEL_91;
      v31 = v30 == pEntityB;
      if ( v30 == pEntityB )
        v31 = *((_DWORD *)p_SoundStatus - 3) == (_DWORD)pEntityA;
      if ( v31 )
      {
LABEL_91:
        v27 = (unsigned __int8)*p_SoundStatus;
        if ( v27 == 2 )
          break;
      }
      p_SoundStatus += 20;
      v26 = v29 + 1;
      if ( v29 > 298 )
        goto LABEL_77;
    }
    LOBYTE(v27) = 2;
    v26 = v29;
LABEL_77:
    if ( bForceLooping )
    {
      if ( (unsigned __int8)v27 == 2 )
      {
        v32 = (char *)v38 + 20 * v26;
        v33 = (CAESound *)*((_DWORD *)v32 + 132);
        *((_DWORD *)v32 + 133) = CTimer::m_snTimeInMilliseconds + 100;
        if ( v33 )
          CAECollisionAudioEntity::UpdateLoopingCollisionSound(
            (CAECollisionAudioEntity *)(unsigned __int8)v32[538],
            v33,
            *((CEntity **)v32 + 130),
            *((CEntity **)v32 + 131),
            (unsigned __int8)v32[537],
            (unsigned __int8)v32[538],
            *(float *)&v37,
            vPosition,
            bForceLooping);
      }
      else
      {
        CAECollisionAudioEntity::PlayLoopingCollisionSound(
          v38,
          pEntityA,
          pEntityB,
          SurfaceA,
          (unsigned __int8)SurfaceB,
          v36,
          vPosition,
          bForceLooping);
      }
    }
    else
    {
      if ( (unsigned __int8)v27 != 2 )
      {
        if ( (char)v27 == 1 )
        {
          CAECollisionAudioEntity::PlayLoopingCollisionSound(
            v38,
            pEntityA,
            pEntityB,
            SurfaceA,
            (unsigned __int8)SurfaceB,
            v36,
            vPosition,
            0);
          return;
        }
        goto LABEL_64;
      }
      v34 = (char *)v38 + 20 * v26;
      v35 = (CAESound *)*((_DWORD *)v34 + 132);
      *((_DWORD *)v34 + 133) = CTimer::m_snTimeInMilliseconds + 100;
      if ( v35 )
        CAECollisionAudioEntity::UpdateLoopingCollisionSound(
          (CAECollisionAudioEntity *)(unsigned __int8)v34[538],
          v35,
          *((CEntity **)v34 + 130),
          *((CEntity **)v34 + 131),
          (unsigned __int8)v34[537],
          (unsigned __int8)v34[538],
          *(float *)&v37,
          vPosition,
          0);
    }
  }
}
// 3939E4: variable 'v37' is possibly undefined
// 3939FE: variable 'v36' is possibly undefined

//----- (00393A98) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::PlayOneShotCollisionSound(
        CAECollisionAudioEntity *this,
        CEntity *pEntityA,
        CEntity *pEntityB,
        unsigned int SurfaceA,
        unsigned int SurfaceB,
        float fImpulseMagnitude,
        CVector *vPosition)
{
  CEntity *v7; // r5
  unsigned int v8; // r6
  unsigned int v10; // r9
  CEntity *v11; // r11
  int v12; // r0
  int v13; // r8
  unsigned int v14; // r10
  unsigned int v15; // r4
  CEntity *v16; // r0
  CEntity *v17; // r1
  bool v18; // zf
  Int16 v19; // r6
  bool v20; // zf
  UInt16 v21; // r1
  int v22; // r11
  int *v23; // r9
  Int32 v24; // r1
  Int32 *v25; // r9
  Int32 v26; // t1
  char *v27; // r5
  int i; // r0
  __int16 *v29; // r5
  int v30; // t1
  float v31; // s0
  int v32; // r0
  int v33; // r0
  int v34; // r4
  float v35; // s17
  CAESound *v36; // r0
  UInt8 *v37; // r1
  int v38; // r2
  UInt8 *p_SurfaceB; // [sp+2Ch] [bp-114h]
  CEntity *v41; // [sp+50h] [bp-F0h]
  CEntity *v42; // [sp+54h] [bp-ECh]
  CAESound v46; // [sp+6Ch] [bp-D4h] BYREF

  v7 = pEntityA;
  v46.m_pPhysicalEntity = 0;
  p_SurfaceB = &this->m_CollisionSoundList[0].SurfaceB;
  v8 = SurfaceB;
  v10 = SurfaceA;
  v11 = pEntityB;
  v12 = 0;
  while ( 1 )
  {
    v13 = v12;
    v18 = v12 == 0;
    v14 = v8;
    v15 = v10;
    v16 = v7;
    v17 = v11;
    if ( v18 )
    {
      v14 = v10;
      v15 = v8;
      v16 = v11;
      v17 = v7;
    }
    if ( v14 <= 0xC2 )
      break;
LABEL_42:
    v12 = v13 + 1;
    if ( v13 >= 1 )
      goto LABEL_43;
  }
  v18 = v14 == 192;
  v41 = v17;
  v42 = v16;
  if ( v14 == 192 )
    v18 = v15 == 192;
  if ( v18 )
  {
    if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x128u, 29) )
      goto LABEL_43;
    fImpulseMagnitude = fImpulseMagnitude * 5.0;
    v19 = 29;
    goto LABEL_22;
  }
  v20 = v14 == 192;
  if ( v14 != 192 )
    v20 = v15 == 192;
  if ( !v20 )
  {
    if ( v14 == 194 )
    {
      v19 = 29;
      v21 = 226;
LABEL_19:
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, v21, 29) )
        goto LABEL_43;
      goto LABEL_22;
    }
    if ( v14 == 193 )
    {
      v19 = 29;
      v21 = 160;
      goto LABEL_19;
    }
    v19 = 2;
LABEL_22:
    v22 = gCollisionLookup[v14][0];
    v23 = gCollisionLookup[v14];
    v26 = v23[1];
    v25 = v23 + 1;
    v24 = v26;
    if ( v22 != v26 )
    {
      v27 = (char *)this + 2 * v14;
      LOWORD(v22) = CAEAudioUtility::GetRandomNumberInRange(gCollisionLookup[v14][0], v24);
      v30 = *((__int16 *)v27 + 62);
      v29 = (__int16 *)(v27 + 124);
      for ( i = v30; (__int16)v22 == i; i = *v29 )
        LOWORD(v22) = CAEAudioUtility::GetRandomNumberInRange(gCollisionLookup[v14][0], *v25);
    }
    if ( (unsigned __int16)v22 == 0xFFFF )
      goto LABEL_41;
    v31 = (float)(fImpulseMagnitude * (float)gCollisionLookup[v15][3]) / 100.0;
    if ( !(v15 ^ 0x3E | v14 ^ 0xBC) )
      v31 = v31 * 10.0;
    v32 = (int)floorf(v31 * 500.0);
    if ( v32 >= 100 )
      v32 = 100;
    v33 = 100 - v32;
    if ( v33 << 16 > 6488064
      || ((v34 = gCollisionLookup[v14][2],
           v35 = (float)CAEAudioEntity::m_pAudioEventVolumes[116] + -3.0,
           (__int16)v33 <= v34) ? (LOWORD(v34) = v33) : (v35 = v35
                                                             + (float)(log10f(
                                                                         (float)(100 - (__int16)v33)
                                                                       / (float)(100 - v34))
                                                                     * 20.0)),
          v35 <= -100.0
       || (CAESound::Initialise(&v46, v19, v22, this, *vPosition, v35, 2.0, 1.0, 1.0, 0, 0x424u, 0.02, v34),
           v36 = CAESoundManager::RequestNewSound(&AESoundManager, &v46),
           this->m_CollisionSoundIDHistory[v14] = v22,
           !v36)) )
    {
LABEL_41:
      v10 = SurfaceA;
      v7 = pEntityA;
      v11 = pEntityB;
      v8 = SurfaceB;
    }
    else
    {
      v37 = p_SurfaceB;
      v38 = -1;
      v10 = SurfaceA;
      v7 = pEntityA;
      v11 = pEntityB;
      v8 = SurfaceB;
      while ( *(_DWORD *)(v37 - 10) )
      {
        ++v38;
        v37 += 20;
        if ( v38 > 298 )
          goto LABEL_42;
      }
      *v37 = SurfaceB;
      *(v37 - 1) = SurfaceA;
      *(_DWORD *)(v37 - 18) = v41;
      *(_DWORD *)(v37 - 14) = v42;
      *(_DWORD *)(v37 - 10) = v36;
      *(_DWORD *)(v37 - 6) = 0;
      *(v37 - 2) = 1;
      ++this->m_nActiveCollisionSounds;
    }
    goto LABEL_42;
  }
LABEL_43:
  CAESound::~CAESound(&v46);
}

//----- (00393DB4) --------------------------------------------------------
int __fastcall CAECollisionAudioEntity::GetCollisionSoundStatus(
        CAECollisionAudioEntity *this,
        CEntity *pEntityA,
        CEntity *pEntityB,
        UInt8 SurfaceA,
        UInt8 SurfaceB,
        int *a6)
{
  Int8 *p_SoundStatus; // r3
  int v7; // lr
  int v8; // r0
  CEntity *v9; // r4
  bool v10; // zf
  bool v11; // zf
  int v12; // r0

  p_SoundStatus = &this->m_CollisionSoundList[0].SoundStatus;
  LOBYTE(v7) = 0;
  v8 = -1;
  while ( 1 )
  {
    v9 = (CEntity *)*((_DWORD *)p_SoundStatus - 4);
    v10 = v9 == pEntityA;
    if ( v9 == pEntityA )
      v10 = *((_DWORD *)p_SoundStatus - 3) == (_DWORD)pEntityB;
    if ( v10 )
      goto LABEL_16;
    v11 = v9 == pEntityB;
    if ( v9 == pEntityB )
      v11 = *((_DWORD *)p_SoundStatus - 3) == (_DWORD)pEntityA;
    if ( v11 )
    {
LABEL_16:
      v7 = (unsigned __int8)*p_SoundStatus;
      if ( v7 == 2 )
        break;
    }
    ++v8;
    p_SoundStatus += 20;
    if ( v8 > 298 )
    {
      v12 = v8 + 1;
      goto LABEL_13;
    }
  }
  v12 = v8 + 1;
  LOBYTE(v7) = 2;
LABEL_13:
  *a6 = v12;
  return (char)v7;
}

//----- (00393E0C) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::UpdateLoopingCollisionSound(
        CAECollisionAudioEntity *this,
        CAESound *pSound,
        CEntity *pEntityA,
        CEntity *pEntityB,
        unsigned int SurfaceA,
        unsigned int SurfaceB,
        float fImpulseMagnitude,
        CVector *vPosition,
        int bForceLooping)
{
  float32x2_t v9; // d0
  float32x2_t v10; // d1
  float32x2_t v11; // d2
  float32x2_t v12; // d8
  float32x2_t v13; // d9
  float32x2_t v14; // d10
  float z; // s10
  float m_heading; // s8
  CMatrix *m_pMat; // s6
  float *v19; // r2
  float *p_m_pRwObject; // r3
  float v21; // s0
  float v22; // s4
  float v23; // s2
  float v24; // s6
  float32x2_t v25; // d0
  int v26; // r6
  float32x2_t v27; // d0
  unsigned __int32 v28; // s0
  int v29; // [sp+0h] [bp-40h] BYREF
  char v30; // [sp+Ch] [bp-34h] BYREF

  if ( __PAIR64__(SurfaceA, SurfaceB) == 0x3F0000003FLL )
  {
    v11.n64_u32[0] = LODWORD(pEntityB[1].m_transform.m_translate.z);
    z = pEntityA[1].m_transform.m_translate.z;
    v10.n64_u32[0] = LODWORD(pEntityB[1].m_transform.m_heading);
    m_heading = pEntityA[1].m_transform.m_heading;
    v9.n64_u32[1] = (unsigned __int32)pEntityA[1].m_pRwObject;
    v11.n64_u32[1] = (unsigned __int32)pEntityA[1].m_nFlags;
    v9.n64_u32[0] = (unsigned __int32)pEntityB[1].m_pMat;
    m_pMat = pEntityA[1].m_pMat;
    v10.n64_u32[1] = pEntityB[1].m_nFlags.bdummy;
    if ( (float)((float)((float)((float)(z - v11.n64_f32[0]) * (float)(z - v11.n64_f32[0]))
                       + (float)((float)(m_heading - v10.n64_f32[0]) * (float)(m_heading - v10.n64_f32[0])))
               + (float)((float)(*(float *)&m_pMat - v9.n64_f32[0]) * (float)(*(float *)&m_pMat - v9.n64_f32[0]))) <= (float)((float)((float)((float)(v9.n64_f32[1] - *(float *)&pEntityB[1].m_pRwObject) * (float)(v9.n64_f32[1] - *(float *)&pEntityB[1].m_pRwObject)) + (float)((float)(v11.n64_f32[1] - *(float *)&pEntityB[1].m_nFlags) * (float)(v11.n64_f32[1] - *(float *)&pEntityB[1].m_nFlags))) + (float)((float)(*(float *)&pEntityA[1].m_nFlags.bdummy - v10.n64_f32[1]) * (float)(*(float *)&pEntityA[1].m_nFlags.bdummy - v10.n64_f32[1]))) )
    {
      v9.n64_u32[0] = pEntityB[1].m_nFlags.bdummy;
      m_pMat = (CMatrix *)pEntityA[1].m_nFlags.bdummy;
      v10.n64_u32[0] = (unsigned __int32)pEntityB[1].m_nFlags;
      v19 = (float *)&v29;
      m_heading = v11.n64_f32[1];
      v11.n64_u32[0] = (unsigned __int32)pEntityB[1].m_pRwObject;
      z = v9.n64_f32[1];
    }
    else
    {
      v19 = (float *)&v30;
    }
    v22 = z - v11.n64_f32[0];
    v23 = m_heading - v10.n64_f32[0];
    v24 = *(float *)&m_pMat - v9.n64_f32[0];
    *v19 = v22;
    v19[1] = v23;
    v19[2] = v24;
    v21 = (float)((float)(v22 * v22) + (float)(v23 * v23)) + (float)(v24 * v24);
  }
  else
  {
    if ( SurfaceB == 62 || SurfaceA != 63 )
    {
      v9.n64_u32[0] = 0;
      if ( SurfaceA == 62 || SurfaceB != 63 )
        goto LABEL_14;
    }
    p_m_pRwObject = (float *)&pEntityA[1].m_pRwObject;
    if ( (float)((float)((float)(pEntityA[1].m_transform.m_translate.z * pEntityA[1].m_transform.m_translate.z)
                       + (float)(pEntityA[1].m_transform.m_heading * pEntityA[1].m_transform.m_heading))
               + (float)(*(float *)&pEntityA[1].m_pMat * *(float *)&pEntityA[1].m_pMat)) > (float)((float)((float)(*(float *)&pEntityA[1].m_pRwObject * *(float *)&pEntityA[1].m_pRwObject) + (float)(*(float *)&pEntityA[1].m_nFlags * *(float *)&pEntityA[1].m_nFlags))
                                                                                                 + (float)(*(float *)&pEntityA[1].m_nFlags.bdummy * *(float *)&pEntityA[1].m_nFlags.bdummy)) )
      p_m_pRwObject = &pEntityA[1].m_transform.m_translate.z;
    v21 = (float)((float)(*p_m_pRwObject * *p_m_pRwObject) + (float)(p_m_pRwObject[1] * p_m_pRwObject[1]))
        + (float)(p_m_pRwObject[2] * p_m_pRwObject[2]);
  }
  v9.n64_f32[0] = sqrtf(v21);
LABEL_14:
  v12.n64_u32[0] = 1.0;
  v14.n64_u32[0] = 0.75;
  v9.n64_f32[0] = (float)(v9.n64_f32[0]
                        * (float)((float)((float)gCollisionLookup[SurfaceA][3] * (float)gCollisionLookup[SurfaceB][3])
                                / 10000.0))
                * 3.0;
  v25.n64_u64[0] = vmin_f32(v9, v12).n64_u64[0];
  v13.n64_f32[0] = v25.n64_f32[0] / 6.0;
  if ( !bForceLooping )
    v13.n64_u32[0] = v25.n64_u32[0];
  v26 = CAEAudioEntity::m_pAudioEventVolumes[116];
  v25.n64_f32[0] = v13.n64_f32[0] / 0.75;
  v10.n64_f32[0] = (float)(log10f(vmin_f32(v25, v12).n64_f32[0]) * 20.0) + (float)v26;
  v11.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
  v27.n64_u64[0] = vmax_f32(v13, v14).n64_u64[0];
  v27.n64_f32[0] = v27.n64_f32[0] * 0.8;
  if ( v10.n64_f32[0] <= v11.n64_f32[0] )
  {
    if ( v10.n64_f32[0] >= v11.n64_f32[0] )
      goto LABEL_21;
    v11.n64_f32[0] = v11.n64_f32[0] + -1.0;
    v10.n64_u64[0] = vmax_f32(v11, v10).n64_u64[0];
  }
  else
  {
    v11.n64_f32[0] = v11.n64_f32[0] + 1.0;
    v10.n64_u64[0] = vmin_f32(v11, v10).n64_u64[0];
  }
  LODWORD(pSound->m_EmittedVolume) = v10.n64_u32[0];
LABEL_21:
  v10.n64_u32[0] = LODWORD(pSound->m_RelativeFrequency);
  if ( v27.n64_f32[0] > v10.n64_f32[0] )
  {
    v10.n64_f32[0] = v10.n64_f32[0] + 0.1;
    v28 = vmin_f32(v10, v27).n64_u32[0];
LABEL_25:
    LODWORD(pSound->m_RelativeFrequency) = v28;
    goto LABEL_26;
  }
  if ( v27.n64_f32[0] < v10.n64_f32[0] )
  {
    v10.n64_f32[0] = v10.n64_f32[0] + -0.1;
    v28 = vmax_f32(v10, v27).n64_u32[0];
    goto LABEL_25;
  }
LABEL_26:
  j_CAESound::SetPosition(pSound, *vPosition);
}
// 393FDA: variable 'v9' is possibly undefined
// 393FDA: variable 'v12' is possibly undefined
// 39401E: variable 'v13' is possibly undefined
// 39401E: variable 'v14' is possibly undefined
// 394034: variable 'v11' is possibly undefined
// 394034: variable 'v10' is possibly undefined
// 393E0C: using guessed type _DWORD SurfaceB_0;

//----- (003940B0) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::PlayLoopingCollisionSound(
        CAECollisionAudioEntity *this,
        CEntity *pEntityA,
        CEntity *pEntityB,
        uint32 SurfaceA,
        uint32 SurfaceB,
        float fImpulseMagnitude,
        CVector *vPosition,
        int bForceLooping)
{
  float32x2_t v8; // d0
  float32x2_t v9; // d1
  float32x2_t v10; // d3
  float32x2_t v11; // d9
  bool v14; // zf
  float z; // s4
  float v18; // s10
  float m_heading; // s8
  float *v20; // r2
  float v21; // s16
  float *p_m_pRwObject; // r0
  float v23; // s0
  float v24; // s4
  float v25; // s2
  float v26; // s6
  float32x2_t v27; // d0
  int v28; // r4
  float v29; // s2
  Int16 v30; // r6
  CAESound *v31; // r0
  UInt8 *p_SurfaceB; // r1
  int v33; // r2
  char v34; // [sp+2Ch] [bp-BCh] BYREF
  char v35; // [sp+38h] [bp-B0h] BYREF
  CAESound v36; // [sp+44h] [bp-A4h] BYREF

  v14 = SurfaceA == 63;
  v36.m_pPhysicalEntity = 0;
  if ( SurfaceA == 63 )
    v14 = SurfaceB == 63;
  if ( v14 )
  {
    z = pEntityB[1].m_transform.m_translate.z;
    v18 = pEntityA[1].m_transform.m_translate.z;
    v9.n64_u32[0] = LODWORD(pEntityB[1].m_transform.m_heading);
    m_heading = pEntityA[1].m_transform.m_heading;
    v8.n64_u32[1] = (unsigned __int32)pEntityA[1].m_pRwObject;
    v8.n64_u32[0] = (unsigned __int32)pEntityB[1].m_pMat;
    v10.n64_u32[0] = (unsigned __int32)pEntityA[1].m_pMat;
    v9.n64_u32[1] = pEntityB[1].m_nFlags.bdummy;
    v10.n64_u32[1] = pEntityA[1].m_nFlags.bdummy;
    if ( (float)((float)((float)((float)(v18 - z) * (float)(v18 - z))
                       + (float)((float)(m_heading - v9.n64_f32[0]) * (float)(m_heading - v9.n64_f32[0])))
               + (float)((float)(v10.n64_f32[0] - v8.n64_f32[0]) * (float)(v10.n64_f32[0] - v8.n64_f32[0]))) <= (float)((float)((float)((float)(v8.n64_f32[1] - *(float *)&pEntityB[1].m_pRwObject) * (float)(v8.n64_f32[1] - *(float *)&pEntityB[1].m_pRwObject)) + (float)((float)(*(float *)&pEntityA[1].m_nFlags - *(float *)&pEntityB[1].m_nFlags) * (float)(*(float *)&pEntityA[1].m_nFlags - *(float *)&pEntityB[1].m_nFlags))) + (float)((float)(v10.n64_f32[1] - v9.n64_f32[1]) * (float)(v10.n64_f32[1] - v9.n64_f32[1]))) )
    {
      v8.n64_u32[0] = pEntityB[1].m_nFlags.bdummy;
      v20 = (float *)&v34;
      v10.n64_u32[0] = pEntityA[1].m_nFlags.bdummy;
      v9.n64_u32[0] = (unsigned __int32)pEntityB[1].m_nFlags;
      m_heading = *(float *)&pEntityA[1].m_nFlags;
      z = *(float *)&pEntityB[1].m_pRwObject;
      v18 = *(float *)&pEntityA[1].m_pRwObject;
    }
    else
    {
      v20 = (float *)&v35;
    }
    v24 = v18 - z;
    v25 = m_heading - v9.n64_f32[0];
    v26 = v10.n64_f32[0] - v8.n64_f32[0];
    *v20 = v24;
    v20[1] = v25;
    v20[2] = v26;
    v23 = (float)((float)(v24 * v24) + (float)(v25 * v25)) + (float)(v26 * v26);
  }
  else
  {
    if ( SurfaceB == 62 || SurfaceA != 63 )
    {
      v11.n64_u32[0] = 0;
      v21 = -100.0;
      if ( SurfaceA == 62 || SurfaceB != 63 )
        goto LABEL_21;
    }
    p_m_pRwObject = (float *)&pEntityA[1].m_pRwObject;
    if ( (float)((float)((float)(pEntityA[1].m_transform.m_translate.z * pEntityA[1].m_transform.m_translate.z)
                       + (float)(pEntityA[1].m_transform.m_heading * pEntityA[1].m_transform.m_heading))
               + (float)(*(float *)&pEntityA[1].m_pMat * *(float *)&pEntityA[1].m_pMat)) > (float)((float)((float)(*(float *)&pEntityA[1].m_pRwObject * *(float *)&pEntityA[1].m_pRwObject) + (float)(*(float *)&pEntityA[1].m_nFlags * *(float *)&pEntityA[1].m_nFlags))
                                                                                                 + (float)(*(float *)&pEntityA[1].m_nFlags.bdummy * *(float *)&pEntityA[1].m_nFlags.bdummy)) )
      p_m_pRwObject = &pEntityA[1].m_transform.m_translate.z;
    v23 = (float)((float)(*p_m_pRwObject * *p_m_pRwObject) + (float)(p_m_pRwObject[1] * p_m_pRwObject[1]))
        + (float)(p_m_pRwObject[2] * p_m_pRwObject[2]);
  }
  v8.n64_f32[0] = sqrtf(v23);
  if ( v8.n64_f32[0] == 0.0 )
  {
    v11.n64_u32[0] = 0;
    v21 = -100.0;
  }
  else
  {
    v10.n64_u32[0] = 1050253722;
    v8.n64_f32[0] = sqrtf(
                      v8.n64_f32[0]
                    * (float)((float)((float)gCollisionLookup[SurfaceA][3] * (float)gCollisionLookup[SurfaceB][3])
                            / 10000.0))
                  * 3.0;
    v27.n64_u64[0] = vmin_f32(v8, v10).n64_u64[0];
    v11.n64_f32[0] = v27.n64_f32[0] / 6.0;
    if ( !bForceLooping )
      v11.n64_u32[0] = v27.n64_u32[0];
    v28 = CAEAudioEntity::m_pAudioEventVolumes[116];
    v27.n64_f32[0] = v11.n64_f32[0] / 0.75;
    v9.n64_u32[0] = 1.0;
    v21 = (float)(log10f(vmin_f32(v27, v9).n64_f32[0]) * 20.0) + (float)v28;
  }
LABEL_21:
  v9.n64_u32[0] = 0.75;
  LODWORD(v29) = vmax_f32(v11, v9).n64_u32[0];
  v30 = 0;
  if ( !SurfaceInfos_c::IsAudioGrass(&g_surfaceInfos, SurfaceA) )
  {
    if ( SurfaceInfos_c::IsAudioGrass(&g_surfaceInfos, SurfaceB) )
    {
      v30 = 0;
    }
    else if ( SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, SurfaceA)
           || SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, SurfaceB) )
    {
      v30 = 3;
    }
    else
    {
      v30 = 2;
      if ( !SurfaceInfos_c::IsAudioMetal(&g_surfaceInfos, SurfaceA)
        && !SurfaceInfos_c::IsAudioMetal(&g_surfaceInfos, SurfaceB) )
      {
        v30 = 1;
      }
    }
  }
  CAESound::Initialise(&v36, 2, v30, this, *vPosition, v21, 2.0, v29 * 0.8, 1.0, 0, 4u, 0.0, 0);
  v31 = CAESoundManager::RequestNewSound(&AESoundManager, &v36);
  if ( v31 )
  {
    p_SurfaceB = &this->m_CollisionSoundList[0].SurfaceB;
    v33 = -1;
    while ( *(_DWORD *)(p_SurfaceB - 10) )
    {
      ++v33;
      p_SurfaceB += 20;
      if ( v33 > 298 )
        goto LABEL_33;
    }
    *(p_SurfaceB - 1) = SurfaceA;
    *(p_SurfaceB - 2) = 2;
    *p_SurfaceB = SurfaceB;
    *(_DWORD *)(p_SurfaceB - 10) = v31;
    *(_DWORD *)(p_SurfaceB - 14) = pEntityB;
    *(_DWORD *)(p_SurfaceB - 18) = pEntityA;
    *(_DWORD *)(p_SurfaceB - 6) = CTimer::m_snTimeInMilliseconds + 100;
    ++this->m_nActiveCollisionSounds;
  }
LABEL_33:
  CAESound::~CAESound(&v36);
}
// 39429A: variable 'v8' is possibly undefined
// 39429A: variable 'v10' is possibly undefined
// 3942B6: variable 'v9' is possibly undefined
// 3942F6: variable 'v11' is possibly undefined

//----- (0039444C) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::ReportBulletHit(
        CAECollisionAudioEntity *this,
        CEntity *pHitEntity,
        UInt8 HitSurface,
        CVector *vPosition,
        float fAngleOfIncidence)
{
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x1Bu, 3) )
  {
    if ( pHitEntity && (*(_BYTE *)&pHitEntity->m_info & 7) == 2 )
    {
      HitSurface = 63;
      if ( LODWORD(pHitEntity[24].m_transform.m_translate.x) == 10 )
        HitSurface = -68;
    }
    CAECollisionAudioEntity::PlayBulletHitCollisionSound(this, HitSurface, vPosition, fAngleOfIncidence);
  }
}

//----- (003944AC) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::PlayBulletHitCollisionSound(
        CAECollisionAudioEntity *this,
        UInt8 HitSurface,
        CVector *vPosition,
        float fAngleOfIncidence)
{
  uint32 v4; // r6
  float v8; // s16
  float v9; // s18
  Int16 RandomNumberInRange; // r6
  CAESound v11; // [sp+2Ch] [bp-94h] BYREF

  v4 = HitSurface;
  v11.m_pPhysicalEntity = 0;
  if ( HitSurface <= 0xC2u )
  {
    v8 = (float)CAEAudioEntity::m_pAudioEventVolumes[117];
    if ( HitSurface == 62 )
    {
      v9 = 1.5;
      do
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(7, 9);
      while ( RandomNumberInRange == this->m_nLastBulletHitSoundID );
    }
    else if ( SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, HitSurface) )
    {
      do
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(16, 18);
      while ( RandomNumberInRange == this->m_nLastBulletHitSoundID );
      v9 = 2.0;
      v8 = v8 + 6.0;
    }
    else if ( SurfaceInfos_c::IsAudioWood(&g_surfaceInfos, v4) )
    {
      v9 = 1.5;
      do
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(19, 21);
      while ( RandomNumberInRange == this->m_nLastBulletHitSoundID );
    }
    else if ( SurfaceInfos_c::IsAudioMetal(&g_surfaceInfos, v4) )
    {
      v9 = 1.5;
      if ( CAEAudioUtility::ResolveProbability((float)(90.0 - fAngleOfIncidence) / 180.0) )
      {
        do
          RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(10, 12);
        while ( RandomNumberInRange == this->m_nLastBulletHitSoundID );
      }
      else
      {
        do
          RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(4, 6);
        while ( RandomNumberInRange == this->m_nLastBulletHitSoundID );
      }
    }
    else if ( SurfaceInfos_c::IsAudioConcrete(&g_surfaceInfos, v4)
           || SurfaceInfos_c::IsAudioGravel(&g_surfaceInfos, v4)
           || SurfaceInfos_c::IsAudioTile(&g_surfaceInfos, v4) )
    {
      do
      {
        v9 = 1.5;
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(13, 15);
      }
      while ( RandomNumberInRange == this->m_nLastBulletHitSoundID );
    }
    else
    {
      v9 = 1.5;
      do
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(1, 3);
      while ( RandomNumberInRange == this->m_nLastBulletHitSoundID );
    }
    if ( RandomNumberInRange >= 0 )
    {
      CAESound::Initialise(&v11, 3, RandomNumberInRange, this, *vPosition, v8, v9, 1.0, 1.0, 0, 0, 0.02, 0);
      CAESoundManager::RequestNewSound(&AESoundManager, &v11);
      this->m_nLastBulletHitSoundID = RandomNumberInRange;
    }
  }
  CAESound::~CAESound(&v11);
}

//----- (00394698) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::ReportObjectDestruction(CAECollisionAudioEntity *this, CEntity *pEntity)
{
  int m_nModelIndex; // r0
  Int16 v5; // r2
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  CAESound *p_ScratchSound; // r1
  CSimpleTransform *p_m_transform; // r6
  CMatrix *v10; // r1
  CSimpleTransform *v11; // r2
  CMatrix *v12; // r0
  Int16 RandomNumberInRange; // r0
  float v14; // s0
  CCollisionData *m_pColData; // r0
  ColData *p_m_nSurfaceType; // r0
  int m_nSurfaceType; // r0

  if ( pEntity )
  {
    m_nModelIndex = pEntity->m_nModelIndex;
    if ( m_nModelIndex == 344 )
    {
LABEL_3:
      v5 = 11;
LABEL_4:
      m_pMat = pEntity->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pEntity->m_transform;
      CAESound::Initialise(
        &this->ScratchSound,
        2,
        v5,
        this,
        p_tx->m_translate,
        (float)CAEAudioEntity::m_pAudioEventVolumes[116],
        2.0,
        1.0,
        1.0,
        0,
        0,
        0.0588,
        0);
      p_ScratchSound = &this->ScratchSound;
LABEL_13:
      sub_19F790(&AESoundManager, p_ScratchSound);
      return;
    }
    if ( m_nModelIndex == MI_GRASSHOUSE )
    {
      p_m_transform = &pEntity->m_transform;
      v10 = pEntity->m_pMat;
      v11 = &pEntity->m_transform;
      if ( v10 )
        v11 = (CSimpleTransform *)&v10->tx;
      CAESound::Initialise(
        &this->ScratchSound,
        2,
        56,
        this,
        v11->m_translate,
        (float)CAEAudioEntity::m_pAudioEventVolumes[125],
        1.5,
        0.75,
        1.0,
        0,
        0,
        0.0,
        0);
      CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      v12 = pEntity->m_pMat;
      if ( v12 )
        p_m_transform = (CSimpleTransform *)&v12->tx;
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(15, 18);
      CAESound::Initialise(
        &this->ScratchSound,
        2,
        RandomNumberInRange,
        this,
        p_m_transform->m_translate,
        (float)CAEAudioEntity::m_pAudioEventVolumes[128],
        1.5,
        0.56,
        1.0,
        0,
        0,
        0.0,
        0);
      p_ScratchSound = &this->ScratchSound;
      this->ScratchSound.m_RelativeFrequency = 0.0;
      v14 = (float)(CTimer::m_snTimeInMilliseconds + 600);
      this->ScratchSound.m_AudioEvent = 128;
      this->ScratchSound.m_Environment = 4;
      this->ScratchSound.m_ClientVariable = v14;
      goto LABEL_13;
    }
    m_pColData = CModelInfo::ms_modelInfoPtrs[m_nModelIndex]->m_pColModel->m_pColData;
    if ( m_pColData )
    {
      if ( m_pColData->m_nNoOfSpheres < 1 )
      {
        if ( m_pColData->m_nNoOfBoxes < 1 )
        {
          if ( m_pColData->m_nNoOfTriangles < 1 )
            return;
          p_m_nSurfaceType = (ColData *)&m_pColData->m_pTriangleArray->m_nSurfaceType;
        }
        else
        {
          p_m_nSurfaceType = &m_pColData->m_pBoxArray->m_data;
        }
      }
      else
      {
        p_m_nSurfaceType = &m_pColData->m_pSphereArray->m_data;
      }
      m_nSurfaceType = p_m_nSurfaceType->m_nSurfaceType;
      if ( m_nSurfaceType > 171 )
      {
        if ( (unsigned int)(m_nSurfaceType - 172) > 2 )
          return;
      }
      else if ( m_nSurfaceType != 42 )
      {
        if ( m_nSurfaceType == 45 )
          goto LABEL_3;
        if ( m_nSurfaceType != 70 )
          return;
      }
      v5 = CAEAudioUtility::GetRandomNumberInRange(41, 44);
      if ( v5 >= 0 )
        goto LABEL_4;
    }
  }
}

//----- (003948BC) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::ReportGlassCollisionEvent(
        CAECollisionAudioEntity *this,
        tAudioEvent AudioEvent,
        CVector *vPosition,
        UInt32 PlayDelayMs)
{
  float v8; // s16
  Int16 RandomNumberInRange; // r0
  float v10; // s0

  v8 = 1.0;
  RandomNumberInRange = 51;
  switch ( AudioEvent )
  {
    case 123:
      goto LABEL_7;
    case 124:
      RandomNumberInRange = 68;
      goto LABEL_7;
    case 125:
      v8 = 0.75;
      goto LABEL_4;
    case 126:
LABEL_4:
      RandomNumberInRange = 56;
      goto LABEL_7;
    case 127:
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(15, 18);
      goto LABEL_7;
    case 128:
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(15, 18);
      v8 = 0.56;
LABEL_7:
      CAESound::Initialise(
        &this->ScratchSound,
        2,
        RandomNumberInRange,
        this,
        *vPosition,
        (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent],
        1.5,
        v8,
        1.0,
        0,
        0,
        0.0,
        0);
      if ( PlayDelayMs )
      {
        this->ScratchSound.m_RelativeFrequency = 0.0;
        v10 = (float)(CTimer::m_snTimeInMilliseconds + PlayDelayMs);
        this->ScratchSound.m_AudioEvent = AudioEvent;
        this->ScratchSound.m_Environment = 4;
        this->ScratchSound.m_ClientVariable = v10;
      }
      sub_19F790(&AESoundManager, &this->ScratchSound);
      break;
    default:
      return;
  }
}

//----- (003949B4) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::ReportWaterSplash(
        CAECollisionAudioEntity *this,
        CPhysical *pPhysical,
        float fForcedVolumeOffsetdB,
        Bool8 bForceSplash)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d1
  int v7; // r6
  float v10; // s18
  uint32 v11; // r8
  int v12; // r0
  float v13; // s0
  int v14; // s20
  int v15; // r0
  float v16; // r0
  float v17; // s16
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r10
  float RollOffFactor; // r9
  CSimpleTransform *p_tx; // r1
  CMatrix *v22; // r0
  tAudioEvent v23; // [sp+30h] [bp-40h]
  uint32 v24; // [sp+34h] [bp-3Ch]

  v7 = bForceSplash;
  if ( (bForceSplash || pPhysical->m_vecMoveSpeed.z <= -0.1)
    && (bForceSplash
     || !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, 1, this, pPhysical)
     && !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, 2, this, pPhysical)
     && !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, 3, this, pPhysical)) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
    {
      v10 = (float)CAEAudioEntity::m_pAudioEventVolumes[118];
      v11 = CTimer::m_snTimeInMilliseconds;
      v12 = *(_BYTE *)&pPhysical->m_info & 7;
      if ( v12 == 2 )
      {
        v24 = CTimer::m_snTimeInMilliseconds + 248;
        v14 = 1064346583;
        v15 = 3;
      }
      else
      {
        if ( v12 == 3 )
        {
          if ( !v7
            || CPedIntelligence::GetTaskSwim((const CPedIntelligence *)LODWORD(pPhysical[3].m_vecAverageTurnSpeed.z)) )
          {
            return;
          }
          v13 = -6.0;
        }
        else
        {
          v13 = -12.0;
        }
        v10 = v10 + v13;
        v14 = 1067534254;
        v24 = v11 + 166;
        v15 = 2;
      }
      v23 = v15;
      if ( fForcedVolumeOffsetdB <= -100.0 )
      {
        v5.n64_u32[0] = 1058642330;
        v4.n64_f32[0] = sqrtf(
                          (float)((float)(pPhysical->m_vecMoveSpeed.x * pPhysical->m_vecMoveSpeed.x)
                                + (float)(pPhysical->m_vecMoveSpeed.y * pPhysical->m_vecMoveSpeed.y))
                        + (float)(pPhysical->m_vecMoveSpeed.z * pPhysical->m_vecMoveSpeed.z));
        v16 = log10f(vmin_f32(v4, v5).n64_f32[0] / 0.6);
        fForcedVolumeOffsetdB = -18.0;
        if ( (float)(v16 * 20.0) > -18.0 )
          fForcedVolumeOffsetdB = v16 * 20.0;
      }
      v17 = v10 + fForcedVolumeOffsetdB;
      m_pMat = pPhysical->m_pMat;
      p_m_transform = &pPhysical->m_transform;
      LOWORD(RollOffFactor) = 0;
      p_tx = &pPhysical->m_transform;
      if ( m_pMat )
        p_tx = (CSimpleTransform *)&m_pMat->tx;
      HIWORD(RollOffFactor) = 16416;
      CAESound::Initialise(
        &this->ScratchSound,
        2,
        67,
        this,
        p_tx->m_translate,
        v17,
        RollOffFactor,
        *(float *)&v14,
        1.0,
        0,
        0x84u,
        0.0,
        0);
      CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pPhysical);
      this->ScratchSound.m_AudioEvent = 1;
      CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      v22 = pPhysical->m_pMat;
      if ( v22 )
        p_m_transform = (CSimpleTransform *)&v22->tx;
      CAESound::Initialise(
        &this->ScratchSound,
        2,
        66,
        this,
        p_m_transform->m_translate,
        v17,
        RollOffFactor,
        0.0,
        1.0,
        0,
        0x84u,
        0.0,
        0);
      CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pPhysical);
      this->ScratchSound.m_ClientVariable = (float)v24;
      this->ScratchSound.m_AudioEvent = v23;
      sub_19F790(&AESoundManager, &this->ScratchSound);
    }
    else if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
    {
      sub_18AFEC(&AEAudioHardware, 0x27u, 2);
    }
  }
}
// 394B1C: variable 'v4' is possibly undefined
// 394B1C: variable 'v5' is possibly undefined

//----- (00394C64) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::ReportWaterSplash(
        CAECollisionAudioEntity *this,
        CVector vPosition,
        float fForcedVolumeOffsetdB)
{
  RwReal y; // r9
  RwReal x; // r10
  RwReal z; // r8
  float v7; // s16
  CVector Position; // [sp+0h] [bp-58h]
  CVector Positiona; // [sp+0h] [bp-58h]

  y = vPosition.y;
  x = vPosition.x;
  z = vPosition.z;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
  {
    Position.x = x;
    *(_QWORD *)&Position.y = __PAIR64__(LODWORD(z), LODWORD(y));
    v7 = (float)CAEAudioEntity::m_pAudioEventVolumes[118] + fForcedVolumeOffsetdB;
    CAESound::Initialise(&this->ScratchSound, 2, 67, this, Position, v7, 2.5, 1.26, 1.0, 0, 4u, 0.0, 0);
    this->ScratchSound.m_AudioEvent = 1;
    CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
    Positiona.x = x;
    *(_QWORD *)&Positiona.y = __PAIR64__(LODWORD(z), LODWORD(y));
    CAESound::Initialise(&this->ScratchSound, 2, 66, this, Positiona, v7, 2.5, 0.0, 1.0, 0, 4u, 0.0, 0);
    this->ScratchSound.m_AudioEvent = 2;
    this->ScratchSound.m_ClientVariable = (float)(CTimer::m_snTimeInMilliseconds + 166);
    sub_19F790(&AESoundManager, &this->ScratchSound);
  }
  else if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
  {
    sub_18AFEC(&AEAudioHardware, 0x27u, 2);
  }
}

//----- (00394DB8) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::Service(CAECollisionAudioEntity *this)
{
  UInt8 *p_SurfaceB; // r5
  int v3; // r6
  uint32 v4; // r8
  CAESound *v5; // r0

  p_SurfaceB = &this->m_CollisionSoundList[0].SurfaceB;
  v3 = 300;
  v4 = CTimer::m_snTimeInMilliseconds;
  do
  {
    if ( *(p_SurfaceB - 2) == 2 && v4 >= *(_DWORD *)(p_SurfaceB - 6) )
    {
      v5 = *(CAESound **)(p_SurfaceB - 10);
      if ( v5 )
        CAESound::StopSoundAndForget(v5);
      *(_DWORD *)(p_SurfaceB - 18) = 0;
      *(_DWORD *)(p_SurfaceB - 14) = 0;
      *(_DWORD *)(p_SurfaceB - 10) = 0;
      *p_SurfaceB = -61;
      *((_WORD *)p_SurfaceB - 1) = -15616;
      --this->m_nActiveCollisionSounds;
    }
    p_SurfaceB += 20;
    --v3;
  }
  while ( v3 );
}

//----- (00394E30) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::Reset(CAECollisionAudioEntity *this)
{
  tCollisionSound *m_CollisionSoundList; // r5
  int v3; // r6
  CAESound *pSound; // r0

  m_CollisionSoundList = this->m_CollisionSoundList;
  v3 = 300;
  do
  {
    if ( m_CollisionSoundList->SoundStatus == 2 )
    {
      pSound = m_CollisionSoundList->pSound;
      if ( pSound )
        CAESound::StopSoundAndForget(pSound);
      m_CollisionSoundList->SurfaceB = -61;
      m_CollisionSoundList->pEntityA = 0;
      m_CollisionSoundList->pEntityB = 0;
      m_CollisionSoundList->pSound = 0;
      *(_WORD *)&m_CollisionSoundList->SoundStatus = -15616;
      --this->m_nActiveCollisionSounds;
    }
    ++m_CollisionSoundList;
    --v3;
  }
  while ( v3 );
}

//----- (00394E84) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::UpdateParameters(
        CAECollisionAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  tAudioEvent m_AudioEvent; // r3
  tCollisionSound *m_CollisionSoundList; // r12
  int v5; // r3

  m_AudioEvent = pSound->m_AudioEvent;
  if ( m_AudioEvent > 2 )
  {
    if ( m_AudioEvent == 3 )
    {
      if ( PlayTime > -1 && CTimer::m_snTimeInMilliseconds >= (unsigned int)pSound->m_ClientVariable )
        pSound->m_RelativeFrequency = 0.94;
      return;
    }
    if ( m_AudioEvent == 128 )
    {
      if ( PlayTime > -1 && CTimer::m_snTimeInMilliseconds >= (unsigned int)pSound->m_ClientVariable )
        pSound->m_RelativeFrequency = 0.56;
      return;
    }
  }
  else
  {
    if ( m_AudioEvent == 1 )
      return;
    if ( m_AudioEvent == 2 )
    {
      if ( PlayTime > -1 && CTimer::m_snTimeInMilliseconds >= (unsigned int)pSound->m_ClientVariable )
        pSound->m_RelativeFrequency = 1.26;
      return;
    }
  }
  if ( PlayTime == -1 )
  {
    m_CollisionSoundList = this->m_CollisionSoundList;
    v5 = -1;
    while ( m_CollisionSoundList->pSound != pSound )
    {
      ++v5;
      ++m_CollisionSoundList;
      if ( v5 > 298 )
        return;
    }
    m_CollisionSoundList->SurfaceB = -61;
    m_CollisionSoundList->pEntityA = 0;
    m_CollisionSoundList->pEntityB = 0;
    m_CollisionSoundList->pSound = 0;
    *(_WORD *)&m_CollisionSoundList->SoundStatus = -15616;
    --this->m_nActiveCollisionSounds;
  }
}

//----- (00394F70) --------------------------------------------------------
float __fastcall CAECollisionAudioEntity::GetSurfaceHardnessVolumeOffset(UInt8 Surface)
{
  return log10f((float)gCollisionLookup[Surface][3] / 100.0) * 20.0;
}

//----- (00394FB4) --------------------------------------------------------
__int16 __fastcall CAECollisionAudioEntity::ChooseCollisionSoundID(CAECollisionAudioEntity *this, UInt8 Surface)
{
  int *v3; // r4
  Int32 v4; // r0
  Int32 v5; // r3
  char *v6; // r6
  int i; // r1
  __int16 *v8; // r6
  int v9; // t1

  v3 = gCollisionLookup[Surface];
  v4 = *v3;
  v5 = v3[1];
  if ( *v3 != v5 )
  {
    v6 = (char *)this + 2 * Surface;
    LOWORD(v4) = CAEAudioUtility::GetRandomNumberInRange(v4, v5);
    v9 = *((__int16 *)v6 + 62);
    v8 = (__int16 *)(v6 + 124);
    for ( i = v9; (__int16)v4 == i; i = *v8 )
      LOWORD(v4) = CAEAudioUtility::GetRandomNumberInRange(*v3, v3[1]);
  }
  return v4;
}

//----- (00395004) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::AddCollisionSoundIDToHistory(
        CAECollisionAudioEntity *this,
        UInt8 Surface,
        __int16 SoundID)
{
  this->m_CollisionSoundIDHistory[Surface] = SoundID;
}

//----- (00395010) --------------------------------------------------------
void __fastcall CAECollisionAudioEntity::AddCollisionSoundToList(
        CAECollisionAudioEntity *this,
        CEntity *pEntityA,
        CEntity *pEntityB,
        UInt8 SurfaceA,
        UInt8 a5,
        CAESound *a6,
        int a7)
{
  tCollisionSound *m_CollisionSoundList; // lr
  int v8; // r6
  uint32 v9; // r2

  m_CollisionSoundList = this->m_CollisionSoundList;
  v8 = -1;
  while ( m_CollisionSoundList->pSound )
  {
    ++v8;
    ++m_CollisionSoundList;
    if ( v8 > 298 )
      return;
  }
  m_CollisionSoundList->pEntityA = pEntityA;
  m_CollisionSoundList->pEntityB = pEntityB;
  v9 = 0;
  m_CollisionSoundList->SurfaceA = SurfaceA;
  m_CollisionSoundList->SurfaceB = a5;
  m_CollisionSoundList->pSound = a6;
  m_CollisionSoundList->SoundStatus = a7;
  if ( a7 == 2 )
    v9 = CTimer::m_snTimeInMilliseconds + 100;
  m_CollisionSoundList->LoopStopTimeMs = v9;
  ++this->m_nActiveCollisionSounds;
}

//----- (00395084) --------------------------------------------------------
void __fastcall CAECutsceneTrackManager::Service(CAECutsceneTrackManager *this, int TrackPlayTime)
{
  int PlayingTrackID; // r0
  int m_nCutsceneStatus; // r1
  int v5; // r0
  float v6; // s0
  int PlayTime; // r0
  bool v8; // zf

  this->m_ActiveSettings.PlayTime = TrackPlayTime;
  this->m_ActiveSettings.TrackLengthMs = CAEAudioHardware::GetTrackLengthMs(&AEAudioHardware);
  PlayingTrackID = CAEAudioHardware::GetPlayingTrackID(&AEAudioHardware);
  m_nCutsceneStatus = this->m_nCutsceneStatus;
  this->m_ActiveSettings.PlayingTrackID = PlayingTrackID;
  switch ( m_nCutsceneStatus )
  {
    case 0:
      CAEAudioHardware::PlayTrack(
        &AEAudioHardware,
        this->m_RequestedSettings.TrackID,
        -1,
        this->m_RequestedSettings.PlayTime,
        this->m_RequestedSettings.TrackFlags,
        0,
        0);
      v5 = 1;
      goto LABEL_20;
    case 1:
      if ( this->m_ActiveSettings.PlayTime != -2 )
        return;
      v5 = 2;
      goto LABEL_20;
    case 2:
      if ( !this->m_bStartCutscenePlayback )
        return;
      CAEAudioHardware::DisableBassEq(&AEAudioHardware);
      CAEAudioHardware::SetChannelFlags(&AEAudioHardware, this->m_nHardwareClientHandle, 0, 39);
      CAEAudioHardware::SetChannelVolume(&AEAudioHardware, this->m_nHardwareClientHandle, 0, -3.0, 0);
      CAEAudioHardware::StartTrackPlayback(&AEAudioHardware);
      this->m_bStartCutscenePlayback = 0;
      v5 = 3;
      goto LABEL_20;
    case 3:
      v6 = 0.0;
      if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) && !this->m_bManuallyPauseTrack )
        v6 = 1.0;
      CAEAudioHardware::SetChannelFrequencyScalingFactor(&AEAudioHardware, this->m_nHardwareClientHandle, 0, v6);
      PlayTime = this->m_ActiveSettings.PlayTime;
      goto LABEL_18;
    case 4:
    case 6:
      CAEAudioHardware::StopTrack(&AEAudioHardware);
      v5 = 7;
      goto LABEL_20;
    case 5:
      CAEAudioHardware::StopSound(&AEAudioHardware, this->m_nHardwareClientHandle, 0);
      v5 = 6;
      goto LABEL_20;
    case 7:
      PlayTime = this->m_ActiveSettings.PlayTime;
      v8 = PlayTime == -7;
      if ( PlayTime != -7 )
        v8 = PlayTime == -2;
      if ( v8 )
      {
        sub_19C68C(&AEAudioHardware);
      }
      else
      {
LABEL_18:
        if ( PlayTime == -6 )
        {
          v5 = 8;
LABEL_20:
          this->m_nCutsceneStatus = v5;
        }
      }
      return;
    default:
      return;
  }
}

//----- (003951EC) --------------------------------------------------------
void __fastcall CAECutsceneTrackManager::StartTrackPlayback(CAECutsceneTrackManager *this)
{
  CAEAudioHardware::DisableBassEq(&AEAudioHardware);
  CAEAudioHardware::SetChannelFlags(&AEAudioHardware, this->m_nHardwareClientHandle, 0, 39);
  CAEAudioHardware::SetChannelVolume(&AEAudioHardware, this->m_nHardwareClientHandle, 0, -3.0, 0);
  sub_1952A0(&AEAudioHardware);
}

//----- (0039523C) --------------------------------------------------------
void __fastcall CAECutsceneTrackManager::CheckForPause(CAECutsceneTrackManager *this)
{
  float v1; // s0

  v1 = 0.0;
  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) && !this->m_bManuallyPauseTrack )
    v1 = 1.0;
  sub_19E094(&AEAudioHardware, this->m_nHardwareClientHandle, 0, v1);
}

//----- (00395288) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CAECutsceneTrackManager::PreloadCutsceneTrack(
        CAECutsceneTrackManager *this,
        Int16 TrackID,
        Bool8 bWaitForPreload)
{
  __int64 v4; // r0
  int v5; // r5
  bool v6; // zf
  int TrackPlayTime; // r0

  LODWORD(v4) = 0;
  *(_QWORD *)&this->m_nCutsceneStatus = v4;
  v5 = bWaitForPreload;
  this->m_RequestedSettings.PlayTime = 0;
  SetPostLoadingTimer(30000);
  CAEAudioHardware::StopTrack(&AEAudioHardware);
  CAEAudioHardware::Service(&AEAudioHardware);
  v6 = v5 == 0;
  if ( v5 )
    v6 = this->m_nCutsceneStatus == 2;
  if ( !v6 )
  {
    do
    {
      TrackPlayTime = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
      CAECutsceneTrackManager::Service(this, TrackPlayTime);
      CAEAudioHardware::Service(&AEAudioHardware);
      OS_ThreadSleep(1000);
    }
    while ( this->m_nCutsceneStatus != 2 );
  }
  j_SetPostLoadingTimer(30000);
}
// 395288: variables would overlap: r0.4 and r0.8

//----- (00395300) --------------------------------------------------------
void __fastcall CAECutsceneTrackManager::PlayPreloadedCutsceneTrack(CAECutsceneTrackManager *this)
{
  *(_WORD *)&this->m_bStartCutscenePlayback = 1;
}

//----- (00395306) --------------------------------------------------------
void __fastcall CAECutsceneTrackManager::StopCutsceneTrack(CAECutsceneTrackManager *this)
{
  if ( this->m_nCutsceneStatus <= 3u )
    this->m_nCutsceneStatus = 4;
  *(_WORD *)&this->m_bStartCutscenePlayback = 0;
}

//----- (00395316) --------------------------------------------------------
Bool8 __fastcall CAECutsceneTrackManager::IsCutsceneTrackActive(CAECutsceneTrackManager *this)
{
  return this->m_nCutsceneStatus != 8;
}

//----- (00395324) --------------------------------------------------------
Int8 __fastcall CAECutsceneTrackManager::GetCutsceneTrackStatus(CAECutsceneTrackManager *this)
{
  int m_nCutsceneStatus; // r1
  Int8 result; // r0

  m_nCutsceneStatus = this->m_nCutsceneStatus;
  result = 1;
  switch ( m_nCutsceneStatus )
  {
    case 0:
    case 1:
      return result;
    case 2:
      result = 2;
      break;
    case 3:
      result = 3;
      break;
    case 4:
    case 5:
    case 6:
    case 7:
      result = 4;
      break;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (00395348) --------------------------------------------------------
void __fastcall CAECutsceneTrackManager::PreloadBeatTrack(
        CAECutsceneTrackManager *this,
        Int16 TrackID,
        Bool8 bWaitForPreload)
{
  CAECutsceneTrackManager::PreloadCutsceneTrack(this, gBeatTrackLookup[TrackID], bWaitForPreload);
}

//----- (00395358) --------------------------------------------------------
void __fastcall CAECutsceneTrackManager::PauseTrack(CAECutsceneTrackManager *this, Bool8 On)
{
  this->m_bManuallyPauseTrack = On;
}

//----- (0039535C) --------------------------------------------------------
void __fastcall CAEDataStream::CAEDataStream(
        CAEDataStream *this,
        int ID,
        unsigned __int8 *file,
        int start,
        int size,
        bool encrypted)
{
  this->m_pFileName = file;
  this->m_pHeader = 0;
  this->m_bInitialised = 0;
  this->m_cur = 0;
  this->m_start = start;
  this->m_size = size;
  this->m_ID = ID;
  this->m_bEncrypted = encrypted;
  this->m_cRefs = 1;
}

//----- (00395380) --------------------------------------------------------
void __fastcall CAEDataStream::~CAEDataStream(CAEDataStream *this)
{
  OSFile m_File; // r0
  unsigned __int8 *m_pFileName; // r0

  if ( this->m_bInitialised )
  {
    m_File = this->m_File;
    this->m_bInitialised = 0;
    OS_FileClose(m_File);
  }
  m_pFileName = this->m_pFileName;
  if ( m_pFileName )
  {
    operator delete[](m_pFileName);
    this->m_pFileName = 0;
  }
}

//----- (003953A4) --------------------------------------------------------
int __fastcall CAEDataStream::Close(CAEDataStream *this)
{
  OSFile m_File; // r1

  m_File = this->m_File;
  this->m_bInitialised = 0;
  OS_FileClose(m_File);
  return 0;
}

//----- (003953B8) --------------------------------------------------------
size_t __fastcall CAEDataStream::FillBuffer(CAEDataStream *this, void *dest, size_t destSize)
{
  unsigned int m_cur; // r1
  unsigned int m_size; // r3
  OSFile m_File; // r0
  size_t v8; // r5

  m_cur = this->m_cur;
  m_size = this->m_size;
  m_File = this->m_File;
  v8 = m_size - m_cur;
  if ( m_size - m_cur > destSize )
    v8 = destSize;
  OS_FileRead(m_File, dest, v8);
  if ( this->m_bEncrypted )
    CAEStreamTransformer::TransformBuffer(&AEStreamTransformer, dest, v8, this->m_cur);
  this->m_cur += v8;
  return v8;
}

//----- (00395404) --------------------------------------------------------
int __fastcall CAEDataStream::GetCurrentPosition(CAEDataStream *this)
{
  return OS_FileGetPosition(this->m_File) - this->m_start;
}

//----- (00395416) --------------------------------------------------------
int __fastcall CAEDataStream::Seek(CAEDataStream *this, int pos, int whence)
{
  int v3; // r5
  int result; // r0

  v3 = pos;
  switch ( whence )
  {
    case 2:
      v3 = this->m_size - pos + this->m_start;
      break;
    case 1:
      v3 = pos + OS_FileGetPosition(this->m_File);
      break;
    case 0:
      v3 = pos + this->m_start;
      break;
  }
  OS_FileSetPosition(this->m_File, v3);
  result = v3 - this->m_start;
  this->m_cur = result;
  return result;
}

//----- (00395452) --------------------------------------------------------
bool __fastcall CAEDataStream::Initialise(CAEDataStream *this)
{
  bool v2; // r5
  int m_start; // r6
  __int64 v4; // r0

  if ( this->m_bInitialised )
    return 1;
  v2 = 0;
  this->m_File = 0;
  if ( OS_FileOpen(OSFDA_Storage_0, &this->m_File, this->m_pFileName, OSFAT_Read_0) == OSFE_NoError )
  {
    m_start = this->m_start;
    OS_FileSetPosition(this->m_File, m_start);
    v4 = *(_QWORD *)&this->m_start;
    v2 = 1;
    this->m_bInitialised = 1;
    this->m_cur = m_start - v4;
    if ( !HIDWORD(v4) )
    {
      this->m_size = OS_FileSize(this->m_File);
      return 1;
    }
  }
  return v2;
}

//----- (003954A8) --------------------------------------------------------
void __fastcall CAEDoorAudioEntity::Reset(CAEDoorAudioEntity *this)
{
  this->m_nLastGarageDoorEventTimeMs = 0;
  this->m_nLastEntryExitDoorEventTimeMs = 0;
  sub_1946EC(&AESoundManager, this, 1u);
}

//----- (003954C0) --------------------------------------------------------
void __fastcall CAEDoorAudioEntity::AddAudioEvent(
        CAEDoorAudioEntity *this,
        tAudioEvent AudioEvent,
        CVector *vPosition,
        float fVolumeOffsetdB,
        float fFrequencyScaling)
{
  UInt32 v8; // r6

  v8 = CTimer::m_snTimeInMilliseconds;
  switch ( AudioEvent )
  {
    case 159:
      if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 159, this) )
      {
        CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
        if ( v8 > this->m_nLastGarageDoorEventTimeMs + 300 )
          CAEDoorAudioEntity::PlayDoorSound(this, 2, 159, vPosition, fVolumeOffsetdB, 0.79);
        CAEDoorAudioEntity::PlayDoorSound(this, 0, 159, vPosition, fVolumeOffsetdB, fFrequencyScaling);
      }
      goto LABEL_16;
    case 160:
      if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 160, this)
        && CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 159, this) )
      {
        CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
        CAEDoorAudioEntity::PlayDoorSound(this, 2, 160, vPosition, fVolumeOffsetdB, 1.0);
      }
      goto LABEL_16;
    case 161:
      if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 161, this) )
      {
        if ( v8 > this->m_nLastGarageDoorEventTimeMs + 300 )
          CAEDoorAudioEntity::PlayDoorSound(this, 2, 161, vPosition, fVolumeOffsetdB, 1.0);
        CAEDoorAudioEntity::PlayDoorSound(this, 0, 161, vPosition, fVolumeOffsetdB, fFrequencyScaling);
      }
      goto LABEL_16;
    case 162:
      if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 162, this)
        && CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 161, this) )
      {
        CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
        CAEDoorAudioEntity::PlayDoorSound(this, 2, 162, vPosition, fVolumeOffsetdB, 0.79);
      }
LABEL_16:
      this->m_nLastGarageDoorEventTimeMs = v8;
      break;
    default:
      return;
  }
}

//----- (0039564C) --------------------------------------------------------
void __fastcall CAEDoorAudioEntity::PlayDoorSound(
        CAEDoorAudioEntity *this,
        __int16 SoundID,
        tAudioEvent AudioEvent,
        CVector *vPosition,
        float fVolumeOffsetdB,
        float fFrequencyScaling)
{
  float y; // r0
  Bool16 v11; // r5
  RwReal x; // r1
  RwReal z; // r2
  CVector Position; // [sp+0h] [bp-B8h]
  CAESound v15; // [sp+2Ch] [bp-8Ch] BYREF

  v15.m_pPhysicalEntity = 0;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x33u, 31) )
  {
    if ( vPosition->x == -1000.0 && vPosition->y == -1000.0 )
      goto LABEL_6;
    if ( vPosition->x == 0.0 )
    {
      y = vPosition->y;
      if ( y == 0.0 )
      {
LABEL_6:
        v11 = 1;
        y = 1.0;
        x = 0.0;
        z = 0.0;
LABEL_10:
        Position.x = x;
        *(_QWORD *)&Position.y = __PAIR64__(LODWORD(z), LODWORD(y));
        CAESound::Initialise(
          &v15,
          31,
          SoundID,
          this,
          Position,
          (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent] + fVolumeOffsetdB,
          2.0,
          fFrequencyScaling,
          1.0,
          0,
          4u,
          0.0,
          0);
        CAESound::SetIndividualEnvironment(&v15, 1u, v11);
        v15.m_AudioEvent = AudioEvent;
        CAESoundManager::RequestNewSound(&AESoundManager, &v15);
        goto LABEL_11;
      }
    }
    else
    {
      y = vPosition->y;
    }
    x = vPosition->x;
    z = vPosition->z;
    v11 = 0;
    goto LABEL_10;
  }
  CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x33u, 31);
LABEL_11:
  CAESound::~CAESound(&v15);
}

//----- (00395784) --------------------------------------------------------
void __fastcall CAEDoorAudioEntity::AddAudioEvent(
        CAEDoorAudioEntity *this,
        tAudioEvent AudioEvent,
        CPhysical *pPhysical)
{
  UInt32 v5; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r3

  if ( AudioEvent == 163 )
  {
    v5 = CTimer::m_snTimeInMilliseconds;
    if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 163, this)
      && v5 > this->m_nLastEntryExitDoorEventTimeMs + 4000 )
    {
      m_pMat = pPhysical->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPhysical->m_transform;
      CAEDoorAudioEntity::PlayDoorSound(this, 1, 163, &p_tx->m_translate, 0.0, 1.0);
      this->m_nLastEntryExitDoorEventTimeMs = v5;
    }
  }
}

//----- (003957F0) --------------------------------------------------------
void __fastcall CAEDoorAudioEntity::UpdateParameters(CAEDoorAudioEntity *this, CAESound *pSound, Int16 PlayTime)
{
  UInt32 v5; // r6
  tAudioEvent m_AudioEvent; // r0
  Int16 v7; // r1

  if ( PlayTime >= 1 )
  {
    v5 = CTimer::m_snTimeInMilliseconds;
    m_AudioEvent = pSound->m_AudioEvent;
    if ( m_AudioEvent == 161 )
    {
      if ( CTimer::m_snTimeInMilliseconds > this->m_nLastGarageDoorEventTimeMs + 10000 )
      {
        if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 162, this)
          && CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 161, this) )
        {
          CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
          CAEDoorAudioEntity::PlayDoorSound(this, 2, 162, &pSound->m_Position, 0.0, 0.79);
        }
        goto LABEL_12;
      }
      v7 = 162;
    }
    else
    {
      if ( m_AudioEvent != 159 )
        return;
      if ( CTimer::m_snTimeInMilliseconds > this->m_nLastGarageDoorEventTimeMs + 10000 )
      {
        if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 160, this) )
        {
          if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 159, this) )
          {
            CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
            CAEDoorAudioEntity::PlayDoorSound(this, 2, 160, &pSound->m_Position, 0.0, 1.0);
          }
        }
LABEL_12:
        this->m_nLastGarageDoorEventTimeMs = v5;
LABEL_16:
        sub_1953E8(pSound);
        return;
      }
      v7 = 160;
    }
    if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, v7, this) )
      return;
    goto LABEL_16;
  }
}

//----- (00395918) --------------------------------------------------------
void __fastcall CAEExplosionAudioEntity::AddAudioEvent(
        CAEExplosionAudioEntity *this,
        tAudioEvent AudioEvent,
        CVector *vPosition,
        float fVolumeOffsetdB)
{
  int v7; // r0
  float v8; // s2
  float *v9; // r11
  float v10; // s16
  float DistanceAttenuation; // r6
  int v12; // r0
  float v13; // s18
  float v14; // s0
  int v15; // r5
  float v16; // s16
  float v17; // s20
  float v18; // s0
  CVector Position; // [sp+0h] [bp-E8h]
  CVector Positiona; // [sp+0h] [bp-E8h]
  CAESound v21; // [sp+30h] [bp-B8h] BYREF
  CVector pRelativePosition; // [sp+A4h] [bp-44h] BYREF

  v21.m_pPhysicalEntity = 0;
  if ( AudioEvent == 129 )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x34u, 4) )
    {
      v7 = (this->m_nLastExplosionFrequencyIndex + 1) % 3;
      v8 = (float)CAEAudioEntity::m_pAudioEventVolumes[129];
      this->m_nLastExplosionFrequencyIndex = v7;
      v9 = &gfExplosionFrequencyVariations[v7];
      v10 = v8 + fVolumeOffsetdB;
      CAESound::Initialise(&v21, 4, 4, this, *vPosition, v8 + fVolumeOffsetdB, 2.0, *v9, 1.0, 0, 4u, 0.06, 0);
      CAESoundManager::RequestNewSound(&AESoundManager, &v21);
      CAESound::Initialise(&v21, 4, 3, this, *vPosition, v8 + fVolumeOffsetdB, 4.0, *v9, 1.0, 0, 4u, 0.06, 0);
      CAESoundManager::RequestNewSound(&AESoundManager, &v21);
      CAESound::Initialise(&v21, 4, 2, this, *vPosition, v8 + fVolumeOffsetdB, 7.5, *v9, 1.0, 0, 4u, 0.06, 0);
      CAESoundManager::RequestNewSound(&AESoundManager, &v21);
      CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, vPosition);
      DistanceAttenuation = CAEAudioEnvironment::GetDistanceAttenuation(
                              sqrtf(
                                (float)((float)(pRelativePosition.x * pRelativePosition.x)
                                      + (float)(pRelativePosition.y * pRelativePosition.y))
                              + (float)(pRelativePosition.z * pRelativePosition.z))
                            / 12.0);
      v12 = CAEAudioUtility::ResolveProbability(0.5);
      v13 = *v9;
      v14 = v10 + DistanceAttenuation;
      v15 = v12;
      v16 = *v9 * 1.1892;
      Position.x = -1.0;
      v17 = v14 + -3.0;
      v18 = v16;
      if ( !v12 )
        v18 = *v9;
      *(_QWORD *)&Position.y = 0LL;
      CAESound::Initialise(&v21, 4, 1, this, Position, v17, 12.0, v18, 1.0, 0, 0x1405u, 0.0, 0);
      CAESoundManager::RequestNewSound(&AESoundManager, &v21);
      if ( !v15 )
        v13 = v16;
      Positiona.x = 1.0;
      *(_QWORD *)&Positiona.y = 0LL;
      CAESound::Initialise(&v21, 4, 1, this, Positiona, v17, 12.0, v13, 1.0, 0, 0x1405u, 0.0, 0);
      CAESoundManager::RequestNewSound(&AESoundManager, &v21);
    }
    else
    {
      CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x34u, 4);
    }
  }
  CAESound::~CAESound(&v21);
}

//----- (00395B98) --------------------------------------------------------
void __fastcall CAEExplosionAudioEntity::UpdateParameters(
        CAEExplosionAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d2
  bool v5; // cc

  v5 = PlayTime <= 1;
  if ( PlayTime >= 1 )
  {
    v3.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
    v5 = v3.n64_f32[0] <= 0.0;
  }
  if ( !v5 )
  {
    v4.n64_u32[0] = 0;
    v3.n64_f32[0] = v3.n64_f32[0] + -1.0;
    LODWORD(pSound->m_EmittedVolume) = vmax_f32(v3, v4).n64_u32[0];
  }
}
// 395BB4: variable 'v3' is possibly undefined
// 395BB8: variable 'v4' is possibly undefined

//----- (00395BC8) --------------------------------------------------------
void __fastcall CAEFireAudioEntity::Initialise(CAEFireAudioEntity *this, FxSystem_c *pParent)
{
  this->m_pFireSound = 0;
  this->m_pFireSound2 = 0;
  this->m_pParentEffectSystem = pParent;
}

//----- (00395BD4) --------------------------------------------------------
void __fastcall CAEFireAudioEntity::Terminate(CAEFireAudioEntity *this)
{
  CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
  this->m_pParentEffectSystem = 0;
}

//----- (00395BF4) --------------------------------------------------------
void __fastcall CAEFireAudioEntity::AddAudioEvent(CAEFireAudioEntity *this, tAudioEvent AudioEvent, CVector *vPosition)
{
  CAESound *m_pFireSound; // r1
  bool v4; // zf

  if ( (unsigned int)(AudioEvent - 138) >= 3 )
  {
    if ( AudioEvent == 137 )
    {
      if ( this->m_pParentEffectSystem )
      {
        m_pFireSound = this->m_pFireSound;
        v4 = m_pFireSound == 0;
        if ( !m_pFireSound )
          v4 = this->m_pFireSound2 == 0;
        if ( v4 )
          CAEFireAudioEntity::PlayWaterSounds(this, 137, vPosition);
      }
    }
    else if ( this->m_pParentEffectSystem && !this->m_pFireSound )
    {
      CAEFireAudioEntity::PlayFireSounds(this, AudioEvent, vPosition);
    }
  }
}

//----- (00395C2C) --------------------------------------------------------
void __fastcall CAEFireAudioEntity::PlayWaterSounds(
        CAEFireAudioEntity *this,
        tAudioEvent AudioEvent,
        CVector *vPosition)
{
  float v5; // s16
  CAESound v6; // [sp+2Ch] [bp-9Ch] BYREF

  v6.m_pPhysicalEntity = 0;
  v5 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  CAESound::Initialise(&v6, 2, 3, this, *vPosition, v5, 2.0, 0.75, 0.6, 0, 4u, 0.0, 0);
  v6.m_AudioEvent = 3;
  v6.m_FrequencyVariance = 0.06;
  this->m_pFireSound = CAESoundManager::RequestNewSound(&AESoundManager, &v6);
  CAESound::Initialise(&v6, 0, 0, this, *vPosition, v5 + 20.0, 2.0, 1.78, 0.6, 0, 4u, 0.0, 0);
  v6.m_AudioEvent = 4;
  v6.m_FrequencyVariance = 0.06;
  this->m_pFireSound2 = CAESoundManager::RequestNewSound(&AESoundManager, &v6);
  CAESound::~CAESound(&v6);
}

//----- (00395D2C) --------------------------------------------------------
void __fastcall CAEFireAudioEntity::PlayFireSounds(
        CAEFireAudioEntity *this,
        tAudioEvent AudioEvent,
        CVector *vPosition)
{
  int v5; // r2
  float *v6; // r10
  float v7; // s16
  float v8; // s16
  CAESound v9; // [sp+2Ch] [bp-9Ch] BYREF

  v9.m_pPhysicalEntity = 0;
  v5 = (CAEFireAudioEntity::m_snLastFireFrequencyIndex[0] + 1) % 5;
  CAEFireAudioEntity::m_snLastFireFrequencyIndex[0] = (char)(CAEFireAudioEntity::m_snLastFireFrequencyIndex[0] + 1) % 5;
  v6 = &gfFireFrequencyVariations[v5];
  v7 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  CAESound::Initialise(&v9, 4, 0, this, *vPosition, v7, 2.0, *v6, 1.0, 0, 4u, 0.0, 0);
  this->m_pFireSound = CAESoundManager::RequestNewSound(&AESoundManager, &v9);
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    v8 = v7 + 3.0;
    CAESound::Initialise(&v9, 19, 26, this, *vPosition, v8 + -20.0, 2.0, *v6 * 0.6, 1.0, 0, 4u, 0.0, 0);
    v9.m_ClientVariable = v8 + 0.0;
    v9.m_AudioEvent = 1;
    CAESoundManager::RequestNewSound(&AESoundManager, &v9);
  }
  else
  {
    CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x8Au, 19);
  }
  CAESound::~CAESound(&v9);
}

//----- (00395EA4) --------------------------------------------------------
void __fastcall CAEFireAudioEntity::UpdateParameters(CAEFireAudioEntity *this, CAESound *pSound, Int16 PlayTime)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  FxSystem_c *m_pParentEffectSystem; // r0
  float m_EmittedVolume; // s0
  float v9; // s2
  FxSystem_c *v10; // r0
  FxSystem_c *v11; // r0
  RwMatrix v12; // [sp+0h] [bp-48h] BYREF

  if ( PlayTime < 1 )
  {
    if ( PlayTime == -1 )
    {
      if ( this->m_pFireSound == pSound )
      {
        this->m_pFireSound = 0;
      }
      else if ( this->m_pFireSound2 == pSound )
      {
        this->m_pFireSound2 = 0;
      }
    }
  }
  else
  {
    m_pParentEffectSystem = this->m_pParentEffectSystem;
    if ( m_pParentEffectSystem )
    {
      FxSystem_c::GetCompositeMatrix(m_pParentEffectSystem, &v12);
      CAESound::SetPosition(pSound, (CVector)v12.pos);
    }
    switch ( pSound->m_AudioEvent )
    {
      case 1:
        v3.n64_u32[0] = LODWORD(pSound->m_ClientVariable);
        v4.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
        if ( v4.n64_f32[0] >= v3.n64_f32[0] )
        {
          pSound->m_AudioEvent = 2;
        }
        else
        {
          v4.n64_f32[0] = v4.n64_f32[0] + 2.0;
          LODWORD(pSound->m_EmittedVolume) = vmin_f32(v4, v3).n64_u32[0];
        }
        break;
      case 2:
        m_EmittedVolume = pSound->m_EmittedVolume;
        if ( m_EmittedVolume > -30.0 )
        {
          v9 = -0.75;
          goto LABEL_18;
        }
        CAESound::StopSoundAndForget(pSound);
        break;
      case 3:
        v10 = this->m_pParentEffectSystem;
        if ( v10 )
        {
          if ( FxSystem_c::GetPlayStatus(v10) == 1 )
          {
            m_EmittedVolume = pSound->m_EmittedVolume;
            if ( m_EmittedVolume > -100.0 )
            {
              v9 = -1.0;
LABEL_18:
              pSound->m_EmittedVolume = m_EmittedVolume + v9;
            }
          }
        }
        break;
      case 4:
        v11 = this->m_pParentEffectSystem;
        if ( v11 && FxSystem_c::GetPlayStatus(v11) == 1 )
          pSound->m_EmittedVolume = -100.0;
        break;
      default:
        return;
    }
  }
}
// 395EF2: variable 'v4' is possibly undefined
// 395EF2: variable 'v3' is possibly undefined

//----- (00395F9C) --------------------------------------------------------
void __fastcall CAEFrontendAudioEntity::Terminate(CAEFrontendAudioEntity *this)
{
  sub_1946EC(&AESoundManager, this, 0);
}

//----- (00395FB0) --------------------------------------------------------
void __fastcall CAEFrontendAudioEntity::Reset(CAEFrontendAudioEntity *this)
{
  this->m_LastPickupEventFrame = 0;
  this->m_LastPartMissionCompleteEventFrame = 0;
  this->m_LastBulletPassEventFrame = 0;
  *(_DWORD *)&this->m_nLastRetuneSoundID = 0xFFFF;
  sub_1915B8(&AESoundManager, 47, this);
}

//----- (00395FD4) --------------------------------------------------------
Bool8 __fastcall CAEFrontendAudioEntity::IsLoadingTuneActive(CAEFrontendAudioEntity *this)
{
  return CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 50, this);
}

//----- (00395FF0) --------------------------------------------------------
void __fastcall CAEFrontendAudioEntity::AddAudioEvent(
        CAEFrontendAudioEntity *this,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fFrequencyScaling)
{
  float v6; // s16
  UInt16 v7; // r9
  Int16 v8; // r1
  Int16 v9; // r2
  Int16 v10; // r1
  Int16 v11; // r2
  UInt16 v12; // r1
  float v13; // s20
  int v14; // r9
  float v15; // s0
  __int16 v16; // r1
  CAESound *v17; // r0
  CAETwinLoopSoundEntity *p_m_RadioTuneSoundInPause; // r5
  UInt16 v19; // r0
  tAudioEvent v20; // r4
  Int16 v21; // r1
  UInt16 v22; // r1
  Int16 RandomNumberInRange; // r0
  tAudioEvent v24; // r1
  Int16 v25; // r0
  Int16 v26; // r0
  Int16 v27; // r0
  CVector Positionb; // [sp+0h] [bp-D8h]
  CVector Positionc; // [sp+0h] [bp-D8h]
  CVector Positiond; // [sp+0h] [bp-D8h]
  CVector Positione; // [sp+0h] [bp-D8h]
  CVector Positionf; // [sp+0h] [bp-D8h]
  CVector Positiong; // [sp+0h] [bp-D8h]
  CVector Positionh; // [sp+0h] [bp-D8h]
  CVector Positioni; // [sp+0h] [bp-D8h]
  CVector Position; // [sp+0h] [bp-D8h]
  CVector Positionj; // [sp+0h] [bp-D8h]
  CVector Positionk; // [sp+0h] [bp-D8h]
  CVector Positionl; // [sp+0h] [bp-D8h]
  CVector Positionm; // [sp+0h] [bp-D8h]
  CVector Positionn; // [sp+0h] [bp-D8h]
  CVector Positiono; // [sp+0h] [bp-D8h]
  CVector Positiona; // [sp+0h] [bp-D8h]
  CVector Positionp; // [sp+0h] [bp-D8h]
  CVector Positionq; // [sp+0h] [bp-D8h]
  CVector Positionr; // [sp+0h] [bp-D8h]
  CVector Positions; // [sp+0h] [bp-D8h]
  CVector Positiont; // [sp+0h] [bp-D8h]
  CVector Positionu; // [sp+0h] [bp-D8h]
  CVector Positionv; // [sp+0h] [bp-D8h]
  CVector Positionw; // [sp+0h] [bp-D8h]
  CVector Positionx; // [sp+0h] [bp-D8h]
  CVector Positiony; // [sp+0h] [bp-D8h]
  CVector Positionz; // [sp+0h] [bp-D8h]
  CVector Positionba; // [sp+0h] [bp-D8h]
  CVector Positionbb; // [sp+0h] [bp-D8h]
  CVector Positionbc; // [sp+0h] [bp-D8h]
  CVector Positionbd; // [sp+0h] [bp-D8h]
  CVector Positionbe; // [sp+0h] [bp-D8h]
  CVector Positionbf; // [sp+0h] [bp-D8h]
  CVector Positionbg; // [sp+0h] [bp-D8h]
  CVector Positionbh; // [sp+0h] [bp-D8h]
  float v63; // [sp+Ch] [bp-CCh]
  CAESound v64; // [sp+2Ch] [bp-ACh] BYREF
  CVector v65; // 0:r1.12

  v64.m_pPhysicalEntity = 0;
  v6 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent] + fVolumeOffsetdB;
  switch ( AudioEvent )
  {
    case 0:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionh.x = -1.0;
        *(_QWORD *)&Positionh.y = 0LL;
        CAESound::Initialise(&v64, 0, 25, this, Positionh, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v10 = 0;
        v11 = 26;
        goto LABEL_86;
      }
      goto LABEL_111;
    case 1:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Cu, 1) )
      {
        Positioni.x = -1.0;
        *(_QWORD *)&Positioni.y = 0LL;
        CAESound::Initialise(&v64, 1, 6, this, Positioni, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v10 = 1;
        v63 = v6;
        Position.x = 1.0;
        Position.y = 0.0;
        Position.z = 0.0;
        goto LABEL_83;
      }
      goto LABEL_111;
    case 2:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Cu, 1) )
      {
        Positionj.x = -1.0;
        *(_QWORD *)&Positionj.y = 0LL;
        CAESound::Initialise(&v64, 1, 0, this, Positionj, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v8 = 1;
        v9 = 1;
        goto LABEL_26;
      }
      goto LABEL_111;
    case 3:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Cu, 1) )
      {
        Positionk.x = -1.0;
        *(_QWORD *)&Positionk.y = 0LL;
        CAESound::Initialise(&v64, 1, 4, this, Positionk, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 4379;
        v64.m_Environment = 4379;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v8 = 1;
        v9 = 5;
        goto LABEL_26;
      }
      goto LABEL_111;
    case 4:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Cu, 1) )
      {
        Positionl.x = -1.0;
        *(_QWORD *)&Positionl.y = 0LL;
        CAESound::Initialise(&v64, 1, 2, this, Positionl, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v8 = 1;
        v9 = 3;
        goto LABEL_26;
      }
      goto LABEL_111;
    case 5:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Cu, 1) )
      {
        Positionn.x = 0.0;
        *(_QWORD *)&Positionn.y = 1065353216LL;
        CAESound::Initialise(&v64, 1, 8, this, Positionn, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v12 = 283;
        goto LABEL_80;
      }
      goto LABEL_111;
    case 6:
    case 18:
    case 19:
    case 20:
    case 40:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0)
        && CTimer::m_FrameCounter >= this->m_LastPickupEventFrame + 5 )
      {
        this->m_LastPickupEventFrame = CTimer::m_FrameCounter;
        Positionb.x = -1.0;
        *(_QWORD *)&Positionb.y = 0LL;
        CAESound::Initialise(&v64, 0, 27, this, Positionb, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 4379;
        v64.m_Environment = 4379;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v8 = 0;
        v9 = 28;
LABEL_26:
        Positionm.x = 1.0;
        *(_QWORD *)&Positionm.y = 0LL;
        CAESound::Initialise(&v64, v8, v9, this, Positionm, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        goto LABEL_88;
      }
      goto LABEL_111;
    case 7:
    case 8:
    case 9:
    case 10:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0)
        && CTimer::m_FrameCounter >= this->m_LastPickupEventFrame + 5 )
      {
        this->m_LastPickupEventFrame = CTimer::m_FrameCounter;
        Positionc.x = -1.0;
        *(_QWORD *)&Positionc.y = 0LL;
        CAESound::Initialise(&v64, 0, 16, this, Positionc, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 4379;
        v64.m_Environment = 4379;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v10 = 0;
        v11 = 17;
        goto LABEL_86;
      }
      goto LABEL_111;
    case 11:
    case 32:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positiong.x = -1.0;
        *(_QWORD *)&Positiong.y = 0LL;
        CAESound::Initialise(&v64, 0, 14, this, Positiong, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v10 = 0;
        v11 = 15;
        goto LABEL_86;
      }
      goto LABEL_111;
    case 12:
    case 13:
    case 43:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0)
        && CTimer::m_FrameCounter >= this->m_LastPartMissionCompleteEventFrame + 5 )
      {
        this->m_LastPartMissionCompleteEventFrame = CTimer::m_FrameCounter;
        Positiond.x = -1.0;
        *(_QWORD *)&Positiond.y = 0LL;
        CAESound::Initialise(&v64, 0, 18, this, Positiond, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v10 = 0;
        v11 = 19;
        goto LABEL_86;
      }
      goto LABEL_111;
    case 14:
    case 15:
    case 17:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0)
        && CTimer::m_FrameCounter >= this->m_LastPickupEventFrame + 5 )
      {
        this->m_LastPickupEventFrame = CTimer::m_FrameCounter;
        Positione.x = -1.0;
        *(_QWORD *)&Positione.y = 0LL;
        CAESound::Initialise(&v64, 0, 27, this, Positione, v6, 1.0, 0.841, 1.0, 0, 0, 0.0, 0);
        v64.m_Environment = 4379;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        Positionf.x = 1.0;
        *(_QWORD *)&Positionf.y = 0LL;
        CAESound::Initialise(&v64, 0, 28, this, Positionf, v6, 1.0, 0.841, 1.0, 0, 0, 0.0, 0);
        v64.m_Environment = 4379;
        goto LABEL_110;
      }
      goto LABEL_111;
    case 16:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
      {
        v13 = 1.0;
        v14 = CAEAudioUtility::ResolveProbability(0.5);
        v15 = 1.1892;
        if ( !v14 )
          v15 = 1.0;
        Positiono.x = -1.0;
        *(_QWORD *)&Positiono.y = 0LL;
        CAESound::Initialise(&v64, 5, 28, this, Positiono, v6, 1.0, v15, 1.0, 0, 0, 0.0, 0);
        v64.m_AudioEvent = 16;
        v64.m_Environment = 4367;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        *(_QWORD *)&Positiona.y = 0LL;
        if ( !v14 )
          v13 = 1.1892;
        Positiona.x = 1.0;
        CAESound::Initialise(&v64, 5, 28, this, Positiona, v6, 1.0, v13, 1.0, 0, 0, 0.0, 0);
        v64.m_AudioEvent = 16;
        v64.m_Environment = 4367;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        this->m_nResprayStartTimeMs = CTimer::m_snTimeInMilliseconds;
      }
      goto LABEL_111;
    case 27:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_BulletPassBank, 42)
        && CTimer::m_FrameCounter >= this->m_LastBulletPassEventFrame + 5 )
      {
        if ( this->m_BulletPassCount < 11 )
        {
          this->m_LastBulletPassEventFrame = CTimer::m_FrameCounter;
          RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 2);
          Positionbe.x = -0.1;
          *(_QWORD *)&Positionbe.y = 3212836864LL;
          CAESound::Initialise(&v64, 42, RandomNumberInRange, this, Positionbe, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v64.m_Environment = 7;
          v64.m_FrequencyVariance = 0.03125;
          v24 = 27;
          goto LABEL_121;
        }
        if ( !CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 42) )
          goto LABEL_54;
      }
      goto LABEL_111;
    case 28:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_BulletPassBank, 42)
        && CTimer::m_FrameCounter >= this->m_LastBulletPassEventFrame + 5 )
      {
        if ( this->m_BulletPassCount < 11 )
        {
          this->m_LastBulletPassEventFrame = CTimer::m_FrameCounter;
          v25 = CAEAudioUtility::GetRandomNumberInRange(0, 2);
          Positionbf.x = -0.1;
          *(_QWORD *)&Positionbf.y = 1065353216LL;
          CAESound::Initialise(&v64, 42, v25, this, Positionbf, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v64.m_Environment = 7;
          v64.m_FrequencyVariance = 0.03125;
          v24 = 28;
          goto LABEL_121;
        }
        if ( !CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 42) )
          goto LABEL_54;
      }
      goto LABEL_111;
    case 29:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_BulletPassBank, 42)
        && CTimer::m_FrameCounter >= this->m_LastBulletPassEventFrame + 5 )
      {
        if ( this->m_BulletPassCount < 11 )
        {
          this->m_LastBulletPassEventFrame = CTimer::m_FrameCounter;
          v26 = CAEAudioUtility::GetRandomNumberInRange(0, 2);
          Positionbg.x = 0.1;
          *(_QWORD *)&Positionbg.y = 3212836864LL;
          CAESound::Initialise(&v64, 42, v26, this, Positionbg, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v64.m_Environment = 7;
          v64.m_FrequencyVariance = 0.03125;
          v24 = 29;
          goto LABEL_121;
        }
        if ( !CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 42) )
          goto LABEL_54;
      }
      goto LABEL_111;
    case 30:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_BulletPassBank, 42)
        && CTimer::m_FrameCounter >= this->m_LastBulletPassEventFrame + 5 )
      {
        if ( this->m_BulletPassCount < 11 )
        {
          this->m_LastBulletPassEventFrame = CTimer::m_FrameCounter;
          v27 = CAEAudioUtility::GetRandomNumberInRange(0, 2);
          Positionbh.x = 0.1;
          *(_QWORD *)&Positionbh.y = 1065353216LL;
          CAESound::Initialise(&v64, 42, v27, this, Positionbh, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v64.m_Environment = 7;
          v64.m_FrequencyVariance = 0.03125;
          v24 = 30;
LABEL_121:
          v64.m_AudioEvent = v24;
          CAESoundManager::RequestNewSound(&AESoundManager, &v64);
          ++this->m_BulletPassCount;
        }
        else if ( !CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 42) )
        {
LABEL_54:
          v16 = this->m_BulletPassBank + 1;
          if ( v16 > 31 )
            v16 = 28;
          this->m_BulletPassBank = v16;
          CAEAudioHardware::LoadSoundBank(&AEAudioHardware, v16, 42);
          this->m_BulletPassCount = 0;
        }
      }
      goto LABEL_111;
    case 31:
      if ( !this->m_bWakeupAmplifierEventTriggered && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionp.x = 0.0;
        *(_QWORD *)&Positionp.y = 1065353216LL;
        CAESound::Initialise(&v64, 0, 8, this, Positionp, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v64.m_Environment = 287;
        v64.m_RelativeFrequency = fFrequencyScaling;
        v17 = CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        this->m_pWakeupAmplifierSound = v17;
        this->m_bWakeupAmplifierEventTriggered = v17 != 0;
      }
      goto LABEL_111;
    case 33:
      if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 33, this) )
        goto LABEL_63;
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionq.x = -1.0;
        *(_QWORD *)&Positionq.y = 0LL;
        CAESound::Initialise(&v64, 0, 4, this, Positionq, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v64.m_Environment = 4367;
        v64.m_RelativeFrequency = fFrequencyScaling;
        v64.m_AudioEvent = 33;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        Positionr.x = 1.0;
        *(_QWORD *)&Positionr.y = 0LL;
        CAESound::Initialise(&v64, 0, 5, this, Positionr, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v64.m_Environment = 4367;
        v64.m_RelativeFrequency = fFrequencyScaling;
        v64.m_AudioEvent = 33;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
LABEL_63:
        this->m_nLastFrontendTimerCountTimeMs = CTimer::m_snTimeInMilliseconds;
      }
      goto LABEL_111;
    case 34:
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
        goto LABEL_111;
      if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
      {
        if ( this->m_RadioTuneSoundInPause.m_bCurrentlyInUse )
          goto LABEL_111;
        p_m_RadioTuneSoundInPause = &this->m_RadioTuneSoundInPause;
        CAETwinLoopSoundEntity::Initialise(&this->m_RadioTuneSoundInPause, 0, 2, 1, this, 0xC8u, 0x28Au, -1, -1);
        v19 = 347;
      }
      else
      {
        if ( this->m_RadioTuneSound.m_bCurrentlyInUse )
          goto LABEL_111;
        p_m_RadioTuneSoundInPause = &this->m_RadioTuneSound;
        CAETwinLoopSoundEntity::Initialise(&this->m_RadioTuneSound, 0, 2, 1, this, 0xC8u, 0x28Au, -1, -1);
        v19 = 331;
      }
      *(_QWORD *)&v65.y = 1065353216LL;
      v65.x = 0.0;
      CAETwinLoopSoundEntity::PlayTwinLoopSound(p_m_RadioTuneSoundInPause, v65, v6, 1.0, 1.0, 1.0, v19);
LABEL_111:
      CAESound::~CAESound(&v64);
      return;
    case 35:
      if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
        goto LABEL_69;
      if ( this->m_RadioTuneSound.m_bCurrentlyInUse )
        CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_RadioTuneSound);
      goto LABEL_111;
    case 36:
LABEL_69:
      if ( this->m_RadioTuneSoundInPause.m_bCurrentlyInUse )
        CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_RadioTuneSoundInPause);
      goto LABEL_111;
    case 37:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positions.x = 0.0;
        *(_QWORD *)&Positions.y = 1065353216LL;
        CAESound::Initialise(&v64, 0, 23, this, Positions, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        goto LABEL_91;
      }
      goto LABEL_111;
    case 38:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positiont.x = 0.0;
        *(_QWORD *)&Positiont.y = 1065353216LL;
        CAESound::Initialise(&v64, 0, 23, this, Positiont, v6, 1.0, 0.8909, 1.0, 0, 0, 0.0, 0);
        goto LABEL_91;
      }
      goto LABEL_111;
    case 41:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionu.x = 0.0;
        *(_QWORD *)&Positionu.y = 1065353216LL;
        CAESound::Initialise(&v64, 0, 10, this, Positionu, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        goto LABEL_79;
      }
      goto LABEL_111;
    case 42:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionv.x = 0.0;
        *(_QWORD *)&Positionv.y = 1065353216LL;
        CAESound::Initialise(&v64, 0, 11, this, Positionv, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
LABEL_79:
        v12 = 3;
LABEL_80:
        v64.m_Environment = v12;
        v64.m_RelativeFrequency = fFrequencyScaling;
        goto LABEL_110;
      }
      goto LABEL_111;
    case 44:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionw.x = -1.0;
        *(_QWORD *)&Positionw.y = 0LL;
        CAESound::Initialise(&v64, 0, 6, this, Positionw, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v10 = 0;
        v63 = v6;
        Position.x = 1.0;
        Position.y = 0.0;
        Position.z = 0.0;
LABEL_83:
        v11 = 7;
        goto LABEL_87;
      }
      goto LABEL_111;
    case 45:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionx.x = -1.0;
        *(_QWORD *)&Positionx.y = 0LL;
        CAESound::Initialise(&v64, 0, 12, this, Positionx, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v7 = 5403;
        v64.m_Environment = 5403;
        v64.m_RelativeFrequency = fFrequencyScaling;
        CAESoundManager::RequestNewSound(&AESoundManager, &v64);
        v10 = 0;
        v11 = 13;
LABEL_86:
        v63 = v6;
        Position.x = 1.0;
        Position.y = 0.0;
        Position.z = 0.0;
LABEL_87:
        CAESound::Initialise(&v64, v10, v11, this, Position, v63, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
LABEL_88:
        v64.m_Environment = v7;
        v64.m_RelativeFrequency = fFrequencyScaling;
        goto LABEL_110;
      }
      goto LABEL_111;
    case 46:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positiony.x = 0.0;
        *(_QWORD *)&Positiony.y = 1065353216LL;
        CAESound::Initialise(&v64, 0, 9, this, Positiony, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v64.m_FrequencyVariance = 0.0588;
LABEL_91:
        v64.m_Environment = 283;
        goto LABEL_110;
      }
      goto LABEL_111;
    case 47:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        v20 = 47;
        if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 47, this) )
        {
          Positionz.x = 0.0;
          *(_QWORD *)&Positionz.y = 1065353216LL;
          CAESound::Initialise(&v64, 0, 3, this, Positionz, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          goto LABEL_99;
        }
      }
      goto LABEL_111;
    case 48:
      v21 = 47;
      goto LABEL_105;
    case 49:
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
        goto LABEL_111;
      v20 = 49;
      if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 49, this) )
        goto LABEL_111;
      Positionba.x = 0.0;
      *(_QWORD *)&Positionba.y = 1065353216LL;
      CAESound::Initialise(&v64, 0, 24, this, Positionba, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
LABEL_99:
      v22 = 259;
      goto LABEL_109;
    case 50:
      if ( !CAEAudioHardware::IsSoundLoaded(&AEAudioHardware, 0x52u, 2 * this->m_nLoadingTrackIndex, 2)
        || !CAEAudioHardware::IsSoundLoaded(&AEAudioHardware, 0x52u, (2 * this->m_nLoadingTrackIndex) | 1, 5)
        || CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 50, this) )
      {
        goto LABEL_111;
      }
      Positionbb.x = -1.0;
      *(_QWORD *)&Positionbb.y = 0LL;
      CAESound::Initialise(&v64, 2, 2 * this->m_nLoadingTrackIndex, this, Positionbb, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v64.m_Environment = 4379;
      v64.m_RelativeFrequency = fFrequencyScaling;
      v64.m_AudioEvent = 50;
      CAESoundManager::RequestNewSound(&AESoundManager, &v64);
      Positionbc.z = 0.0;
      *(_QWORD *)&Positionbc.x = 1065353216LL;
      CAESound::Initialise(
        &v64,
        5,
        (2 * this->m_nLoadingTrackIndex) | 1,
        this,
        Positionbc,
        v6,
        1.0,
        1.0,
        1.0,
        0,
        0,
        0.0,
        0);
      v64.m_Environment = 4379;
      v64.m_RelativeFrequency = fFrequencyScaling;
      v64.m_AudioEvent = 50;
      goto LABEL_110;
    case 51:
      v21 = 50;
LABEL_105:
      CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, v21, this);
      goto LABEL_111;
    case 101:
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
        goto LABEL_111;
      v20 = 101;
      if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 101, this) )
        goto LABEL_111;
      Positionbd.x = 0.0;
      *(_QWORD *)&Positionbd.y = 1065353216LL;
      CAESound::Initialise(&v64, 0, 13, this, Positionbd, v6, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v22 = 257;
LABEL_109:
      v64.m_Environment = v22;
      v64.m_RelativeFrequency = fFrequencyScaling;
      v64.m_AudioEvent = v20;
LABEL_110:
      CAESoundManager::RequestNewSound(&AESoundManager, &v64);
      goto LABEL_111;
    default:
      goto LABEL_111;
  }
}

//----- (00397320) --------------------------------------------------------
void __fastcall CAEFrontendAudioEntity::UpdateParameters(
        CAEFrontendAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  float v3; // s0
  float v4; // s2
  float v5; // s0
  int v6; // r2
  float v7; // s0
  CVector v9; // 0:r1.12

  if ( pSound )
  {
    switch ( pSound->m_AudioEvent )
    {
      case 0x10:
        if ( PlayTime < 1 )
          goto LABEL_21;
        if ( CTimer::m_snTimeInMilliseconds > this->m_nResprayStartTimeMs + 1900 )
          goto LABEL_5;
        return;
      case 0x1B:
        if ( (unsigned __int16)PlayTime > 0x15Eu )
          goto LABEL_21;
        v3 = (float)PlayTime / 350.0;
        v4 = -1.0;
        goto LABEL_11;
      case 0x1C:
        if ( (unsigned __int16)PlayTime > 0x15Eu )
          goto LABEL_21;
        v3 = (float)PlayTime / -350.0;
        v4 = 1.0;
LABEL_11:
        v5 = v3 + v3;
        v6 = -1110651699;
        goto LABEL_17;
      case 0x1D:
        if ( (unsigned __int16)PlayTime > 0x15Eu )
          goto LABEL_21;
        v7 = (float)PlayTime / 350.0;
        v4 = -1.0;
        goto LABEL_16;
      case 0x1E:
        if ( (unsigned __int16)PlayTime > 0x15Eu )
          goto LABEL_21;
        v7 = (float)PlayTime / -350.0;
        v4 = 1.0;
LABEL_16:
        v5 = v7 + v7;
        v6 = 1036831949;
LABEL_17:
        v9.z = v5 + v4;
        LODWORD(v9.x) = v6;
        v9.y = 0.0;
        j_CAESound::SetPosition(pSound, v9);
        break;
      case 0x21:
        if ( PlayTime < 1 )
          goto LABEL_21;
        if ( CTimer::m_snTimeInMilliseconds > this->m_nLastFrontendTimerCountTimeMs + 100 )
LABEL_5:
          sub_1953E8(pSound);
        break;
      default:
LABEL_21:
        if ( PlayTime == -1 && this->m_pWakeupAmplifierSound == pSound )
        {
          this->m_bWakeupAmplifierEventTriggered = 0;
          this->m_pWakeupAmplifierSound = 0;
        }
        break;
    }
  }
}

//----- (00397450) --------------------------------------------------------
Bool8 __fastcall CAEFrontendAudioEntity::IsRadioTuneSoundActive(CAEFrontendAudioEntity *this)
{
  CAETwinLoopSoundEntity *p_m_RadioTuneSoundInPause; // r1

  p_m_RadioTuneSoundInPause = &this->m_RadioTuneSoundInPause;
  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
    p_m_RadioTuneSoundInPause = &this->m_RadioTuneSound;
  return p_m_RadioTuneSoundInPause->m_bCurrentlyInUse;
}

//----- (0039747C) --------------------------------------------------------
void __fastcall CAEGlobalWeaponAudioEntity::AddAudioEvent(
        CAEGlobalWeaponAudioEntity *this,
        tAudioEvent AudioEvent,
        eWeaponType WeaponType,
        CPhysical *pParentPhysical)
{
  if ( pParentPhysical )
  {
    switch ( AudioEvent )
    {
      case 145:
      case 149:
        sub_18B8D4(this, WeaponType, pParentPhysical, AudioEvent);
        break;
      case 146:
      case 147:
        sub_19B920(this, WeaponType, pParentPhysical, AudioEvent);
        break;
      case 148:
        CAEGlobalWeaponAudioEntity::ProjectileFire(this, WeaponType, pParentPhysical, 148);
        break;
    }
  }
}

//----- (003974C4) --------------------------------------------------------
void __fastcall CAEGlobalWeaponAudioEntity::ProjectileFire(
        CAEGlobalWeaponAudioEntity *this,
        eWeaponType WeaponType,
        CPhysical *pParentPhysical,
        tAudioEvent AudioEvent)
{
  float v6; // s16
  int v7; // r6
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_m_transform; // r4
  CSimpleTransform *p_tx; // r2
  float *v11; // r11
  CMatrix *v12; // r0
  UInt16 v13; // r1
  Int16 v14; // r2

  v6 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  if ( (unsigned int)(WeaponType - 19) > 1 )
    return;
  v7 = (this->m_nLastMissileFrequencyIndex + 1) % 3;
  this->m_nLastMissileFrequencyIndex = v7;
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    if ( CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
      return;
    v13 = 143;
    v14 = 5;
LABEL_13:
    sub_18AFEC(&AEAudioHardware, v13, v14);
    return;
  }
  m_pMat = pParentPhysical->m_pMat;
  p_m_transform = &pParentPhysical->m_transform;
  p_tx = &pParentPhysical->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v11 = &gfRocketFrequencyVariations[v7];
  CAESound::Initialise(
    &this->ScratchSound,
    5,
    68,
    this,
    p_tx->m_translate,
    v6 + -8.0,
    3.0,
    *v11,
    1.0,
    0,
    0x80u,
    0.02,
    0);
  CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
  CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    v13 = 138;
    v14 = 19;
    goto LABEL_13;
  }
  v12 = pParentPhysical->m_pMat;
  if ( v12 )
    p_m_transform = (CSimpleTransform *)&v12->tx;
  CAESound::Initialise(
    &this->ScratchSound,
    19,
    26,
    this,
    p_m_transform->m_translate,
    v6,
    3.0,
    *v11 * 1.25,
    1.0,
    0,
    0x80u,
    0.02,
    0);
  CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
  sub_19F790(&AESoundManager, &this->ScratchSound);
}

//----- (003976A0) --------------------------------------------------------
void __fastcall CAEGlobalWeaponAudioEntity::UpdateParameters(
        CAEGlobalWeaponAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  CAESound **v3; // r0

  if ( PlayTime == -1 )
  {
    if ( pFogHorn == pSound )
    {
      v3 = &pFogHorn;
    }
    else
    {
      v3 = pWaterfall;
      if ( pWaterfall[0] != pSound )
      {
        v3 = &pWaterfall[1];
        if ( pWaterfall[1] != pSound )
        {
          v3 = &pWaterfall[2];
          if ( pWaterfall[2] != pSound )
            return;
        }
      }
    }
    *v3 = 0;
  }
}

//----- (003976FC) --------------------------------------------------------
void __fastcall CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(CAEGlobalWeaponAudioEntity *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  char v4; // r0
  char v5; // r0
  char v6; // r0
  char v7; // r0
  char v8; // r0
  char v9; // r0
  CPhysical *m_pGunFirePhysical; // r1
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_m_transform; // r5
  __int64 v13; // kr00_8
  int v14; // r0
  _DWORD *p_tz; // r1
  CPhysical *v16; // r0
  CMatrix *v17; // r1
  CSimpleTransform *v18; // r2
  float32x2_t v19; // d16
  unsigned __int64 v20; // d1
  Int32 v21; // r0
  CAESound *v22; // r0
  CSimpleTransform *v23; // r0
  float32x2_t v24; // d16
  unsigned __int64 v25; // d1
  CSimpleTransform *p_tx; // r3
  float32x2_t v27; // d16
  unsigned __int64 v28; // d1
  bool v29; // zf
  Int32 v30; // r0
  Int32 *v31; // r1
  CSimpleTransform *v32; // r3
  float32x2_t v33; // d16
  unsigned __int64 v34; // d1
  Int32 v35; // r0
  Int32 v36; // r0
  Int32 v37; // r1
  float v38; // s18
  float v39; // s16
  float v40; // r0
  CPhysical *v41; // r1
  float v42; // s0
  CMatrix *v43; // r0
  float *p_x; // r2
  float v45; // r0
  CPhysical *v46; // r1
  float v47; // s0
  CMatrix *v48; // r0
  CSimpleTransform *v49; // r2
  CPhysical *v50; // r0
  CMatrix *v51; // r1
  CSimpleTransform *v52; // r3
  Int32 RandomNumberInRange; // r0
  Int32 v54; // r0
  Int32 v55; // r1
  CVector v56; // [sp+30h] [bp-B0h] BYREF
  CAESound v57; // [sp+3Ch] [bp-A4h] BYREF

  v4 = `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime;
  __dmb(0xBu);
  if ( (v4 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime) )
  {
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime = CTimer::m_snTimeInMilliseconds;
    _cxa_guard_release((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime);
  }
  v57.m_pPhysicalEntity = 0;
  v5 = `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition;
  __dmb(0xBu);
  if ( (v5 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition) )
  {
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition.x = -2683.0;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition.y = 1445.0;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition.z = 37.0;
    _cxa_guard_release((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition);
  }
  v6 = `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2;
  __dmb(0xBu);
  if ( (v6 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2) )
  {
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2.x = -2683.0;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2.y = 1804.0;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2.z = 69.0;
    _cxa_guard_release((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2);
  }
  v7 = `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1;
  __dmb(0xBu);
  if ( (v7 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1) )
  {
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1.x = 2075.3;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1.y = 1925.9;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1.z = 13.0;
    _cxa_guard_release((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1);
  }
  v8 = `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2;
  __dmb(0xBu);
  if ( (v8 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2) )
  {
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.x = 2085.8;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.y = 1905.5;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.z = 11.3;
    _cxa_guard_release((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2);
  }
  v9 = `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3;
  __dmb(0xBu);
  if ( (v9 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3) )
  {
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3.x = 2091.5;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3.y = 1888.9;
    CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3.z = 11.1;
    _cxa_guard_release((__guard *)&`guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3);
  }
  switch ( CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State )
  {
    case 0:
      if ( CWeather::WeatherRegion == 3 )
      {
        p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
        if ( !TheCamera.m_pMat )
          p_tx = &TheCamera.m_transform;
        v27.n64_u64[0] = vsub_f32(
                           *(float32x2_t *)&p_tx->m_translate.y,
                           *(float32x2_t *)&CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.y).n64_u64[0];
        v28 = vmul_f32(v27, v27).n64_u64[0];
        if ( (float)((float)((float)((float)(p_tx->m_translate.x
                                           - CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.x)
                                   * (float)(p_tx->m_translate.x
                                           - CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.x))
                           + *(float *)&v28)
                   + *((float *)&v28 + 1)) < 10000.0
          && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2)
          && !pWaterfall[0] )
        {
          v29 = pWaterfall[1] == 0;
          if ( !pWaterfall[1] )
            v29 = pWaterfall[2] == 0;
          if ( v29 )
          {
            CAESound::Initialise(
              &v57,
              2,
              3,
              this,
              CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1,
              -3.0,
              1.0,
              1.0,
              1.0,
              0,
              0,
              0.0,
              0);
            v57.m_RollOffFactor = 2.5;
            v57.m_RelativeFrequency = 1.0;
            v57.m_Environment = 4;
            pWaterfall[0] = CAESoundManager::RequestNewSound(&AESoundManager, &v57);
            CAESound::Initialise(
              &v57,
              2,
              3,
              this,
              CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2,
              -3.0,
              1.0,
              1.0,
              1.0,
              0,
              0,
              0.0,
              0);
            v57.m_RollOffFactor = 2.5;
            v57.m_RelativeFrequency = 1.01;
            v57.m_Environment = 4;
            pWaterfall[1] = CAESoundManager::RequestNewSound(&AESoundManager, &v57);
            CAESound::Initialise(
              &v57,
              2,
              3,
              this,
              CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3,
              -3.0,
              1.0,
              1.0,
              1.0,
              0,
              0,
              0.0,
              0);
            v57.m_RollOffFactor = 2.5;
            v57.m_RelativeFrequency = 0.99;
            v57.m_Environment = 4;
            pWaterfall[2] = CAESoundManager::RequestNewSound(&AESoundManager, &v57);
            v30 = 5;
            v31 = &CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State;
            goto LABEL_100;
          }
        }
      }
      else if ( CWeather::WeatherRegion == 1 )
      {
        if ( !((unsigned __int16)CTimer::m_FrameCounter << 22) )
        {
          m_pGunFirePhysical = this->m_pGunFirePhysical;
          m_pMat = m_pGunFirePhysical->m_pMat;
          p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
          if ( !TheCamera.m_pMat )
            p_m_transform = &TheCamera.m_transform;
          v13 = *(_QWORD *)&p_m_transform->m_translate.x;
          v14 = *(_DWORD *)&byte_8[(_DWORD)p_m_transform];
          if ( m_pMat )
          {
            LODWORD(m_pMat->tx) = v13;
            m_pGunFirePhysical->m_pMat->ty = *((float *)&v13 + 1);
            p_tz = (_DWORD *)&m_pGunFirePhysical->m_pMat->tz;
          }
          else
          {
            *(_QWORD *)&m_pGunFirePhysical->m_transform.m_translate.x = v13;
            p_tz = (_DWORD *)&m_pGunFirePhysical->m_transform.m_translate.z;
          }
          *p_tz = v14;
          v38 = (float)((float)((float)rand() * 4.6566e-10) * 6.2832) + 0.0;
          v39 = (float)((float)((float)rand() * 4.6566e-10) * 40.0) + 40.0;
          v40 = cosf(v38);
          v41 = this->m_pGunFirePhysical;
          v42 = v40 * v39;
          v43 = v41->m_pMat;
          p_x = &v43->tx;
          if ( !v43 )
            p_x = &v41->m_transform.m_translate.x;
          *p_x = *p_x + v42;
          v45 = sinf(v38);
          v46 = this->m_pGunFirePhysical;
          v47 = v39 * v45;
          v48 = v46->m_pMat;
          v49 = (CSimpleTransform *)&v48->tx;
          if ( !v48 )
            v49 = &v46->m_transform;
          v49->m_translate.y = v47 + v49->m_translate.y;
          v1.n64_u32[0] = 20.0;
          v50 = this->m_pGunFirePhysical;
          v51 = v50->m_pMat;
          v52 = (CSimpleTransform *)&v51->tx;
          if ( !v51 )
            v52 = &v50->m_transform;
          v2.n64_u32[0] = LODWORD(v52->m_translate.z);
          LODWORD(v52->m_translate.z) = vmin_f32(v2, v1).n64_u32[0];
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State = 1;
          RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 1);
          if ( RandomNumberInRange == 1 )
          {
            CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::GunShots = CAEAudioUtility::GetRandomNumberInRange(
                                                                                  2,
                                                                                  4);
            CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Weapon = WEAPONTYPE_PISTOL;
            v54 = 500;
            v55 = 1200;
            goto LABEL_95;
          }
          if ( !RandomNumberInRange )
          {
            CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::GunShots = CAEAudioUtility::GetRandomNumberInRange(
                                                                                  4,
                                                                                  14);
            CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Weapon = WEAPONTYPE_AK47;
            v54 = 90;
            v55 = 350;
LABEL_95:
            v30 = CAEAudioUtility::GetRandomNumberInRange(v54, v55);
            v31 = &CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Delay;
            goto LABEL_100;
          }
        }
      }
      else if ( CWeather::WeatherRegion != 4
             && CWeather::Foggyness_SF >= 0.5
             && !((unsigned __int16)CTimer::m_FrameCounter << 22) )
      {
        v32 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
        if ( !TheCamera.m_pMat )
          v32 = &TheCamera.m_transform;
        v33.n64_u64[0] = vsub_f32(
                           *(float32x2_t *)&v32->m_translate.y,
                           *(float32x2_t *)&CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition.y).n64_u64[0];
        v34 = vmul_f32(v33, v33).n64_u64[0];
        if ( (float)((float)((float)((float)(v32->m_translate.x
                                           - CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition.x)
                                   * (float)(v32->m_translate.x
                                           - CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition.x))
                           + *(float *)&v34)
                   + *((float *)&v34 + 1)) < 4000000.0
          && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0)
          && !pFogHorn )
        {
          CAESound::Initialise(
            &v57,
            17,
            13,
            this,
            CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition,
            12.0,
            1.0,
            1.0,
            1.0,
            0,
            0,
            0.0,
            0);
          v57.m_RollOffFactor = 60.0;
          v57.m_RelativeFrequency = 1.0;
          v57.m_Environment = 4;
          pFogHorn = CAESoundManager::RequestNewSound(&AESoundManager, &v57);
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State = 2;
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime = CTimer::m_snTimeInMilliseconds;
        }
      }
LABEL_101:
      CAESound::~CAESound(&v57);
      return;
    case 1:
      if ( CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime
         + CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Delay > CTimer::m_snTimeInMilliseconds )
        goto LABEL_101;
      FindPlayerCoors(&v56, -1);
      v16 = this->m_pGunFirePhysical;
      v17 = v16->m_pMat;
      v18 = (CSimpleTransform *)&v17->tx;
      if ( !v17 )
        v18 = &v16->m_transform;
      v19.n64_u64[0] = vsub_f32(*(float32x2_t *)&v56.y, *(float32x2_t *)&v18->m_translate.y).n64_u64[0];
      v20 = vmul_f32(v19, v19).n64_u64[0];
      if ( sqrtf(
             (float)((float)((float)(v56.x - v18->m_translate.x) * (float)(v56.x - v18->m_translate.x)) + *(float *)&v20)
           + *((float *)&v20 + 1)) <= 24.0 )
        goto LABEL_77;
      v16->m_info = (CEntity::CEntityInfo)(*(_BYTE *)&v16->m_info & 0xF8 | 6);
      CAudioEngine::ReportWeaponEvent(
        &AudioEngine,
        145,
        CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Weapon,
        this->m_pGunFirePhysical);
      if ( --CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::GunShots )
      {
        if ( CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Weapon == WEAPONTYPE_PISTOL )
        {
          v21 = CAEAudioUtility::GetRandomNumberInRange(500, 1200);
        }
        else
        {
          if ( CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Weapon != WEAPONTYPE_AK47 )
            goto LABEL_99;
          v21 = CAEAudioUtility::GetRandomNumberInRange(90, 450);
        }
      }
      else
      {
        if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 100.0) > 39 )
        {
LABEL_77:
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State = 0;
          goto LABEL_99;
        }
        v35 = CAEAudioUtility::GetRandomNumberInRange(0, 1);
        if ( v35 == 1 )
        {
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::GunShots = CAEAudioUtility::GetRandomNumberInRange(
                                                                                2,
                                                                                4);
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Weapon = WEAPONTYPE_PISTOL;
          v36 = 500;
          v37 = 1200;
        }
        else
        {
          if ( v35 )
            goto LABEL_99;
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::GunShots = CAEAudioUtility::GetRandomNumberInRange(
                                                                                4,
                                                                                14);
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Weapon = WEAPONTYPE_AK47;
          v36 = 90;
          v37 = 350;
        }
        v21 = CAEAudioUtility::GetRandomNumberInRange(v36, v37);
      }
      CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::Delay = v21;
LABEL_99:
      v31 = &CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime;
      v30 = CTimer::m_snTimeInMilliseconds;
LABEL_100:
      *v31 = v30;
      goto LABEL_101;
    case 2:
      if ( CTimer::m_snTimeInMilliseconds > CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime + 5000 )
      {
        if ( pFogHorn )
          CAESound::StopSound(pFogHorn);
        CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State = 3;
      }
      goto LABEL_101;
    case 3:
      if ( CTimer::m_snTimeInMilliseconds > CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime + 6500
        && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0)
        && !pFogHorn )
      {
        CAESound::Initialise(
          &v57,
          17,
          13,
          this,
          CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2,
          12.0,
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
        v57.m_RollOffFactor = 60.0;
        v57.m_RelativeFrequency = 1.2;
        v57.m_Environment = 4;
        v22 = CAESoundManager::RequestNewSound(&AESoundManager, &v57);
        CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State = 4;
        pFogHorn = v22;
        CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime = CTimer::m_snTimeInMilliseconds;
      }
      goto LABEL_101;
    case 4:
      if ( CTimer::m_snTimeInMilliseconds <= CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime + 5000 )
        goto LABEL_101;
      if ( pFogHorn )
        CAESound::StopSound(pFogHorn);
      goto LABEL_57;
    case 5:
      v23 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        v23 = &TheCamera.m_transform;
      if ( CWeather::WeatherRegion == 3 )
      {
        v24.n64_u64[0] = vsub_f32(
                           *(float32x2_t *)&v23->m_translate.y,
                           *(float32x2_t *)&CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.y).n64_u64[0];
        v25 = vmul_f32(v24, v24).n64_u64[0];
        if ( (float)((float)((float)((float)(v23->m_translate.x
                                           - CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.x)
                                   * (float)(v23->m_translate.x
                                           - CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2.x))
                           + *(float *)&v25)
                   + *((float *)&v25 + 1)) <= 10000.0 )
          goto LABEL_101;
      }
      if ( pWaterfall[0] )
        CAESound::StopSound(pWaterfall[0]);
      if ( pWaterfall[1] )
        CAESound::StopSound(pWaterfall[1]);
      if ( pWaterfall[2] )
        CAESound::StopSound(pWaterfall[2]);
LABEL_57:
      CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::State = 0;
      goto LABEL_101;
    default:
      goto LABEL_101;
  }
}
// 397FF4: variable 'v2' is possibly undefined
// 397FF4: variable 'v1' is possibly undefined
// 9445A4: using guessed type char `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::LastTime;
// 9445B4: using guessed type char `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition;
// 9445C4: using guessed type char `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vFogHornPosition2;
// 9445D4: using guessed type char `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition1;
// 9445E4: using guessed type char `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition2;
// 9445F4: using guessed type char `guard variable for'CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(void)::vWaterfallPosition3;

//----- (00398250) --------------------------------------------------------
void __fastcall CAEGlobalWeaponAudioEntity::PickAmbientGunFire(
        CAEGlobalWeaponAudioEntity *this,
        Int32 *GunShots,
        eWeaponType *Weapon,
        Int32 *Delay)
{
  Int32 RandomNumberInRange; // r0
  Int32 v8; // r0
  Int32 v9; // r1

  RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 1);
  if ( RandomNumberInRange == 1 )
  {
    *GunShots = CAEAudioUtility::GetRandomNumberInRange(2, 4);
    *Weapon = WEAPONTYPE_PISTOL;
    v8 = 500;
    v9 = 1200;
  }
  else
  {
    if ( RandomNumberInRange )
      return;
    *GunShots = CAEAudioUtility::GetRandomNumberInRange(4, 14);
    *Weapon = WEAPONTYPE_AK47;
    v8 = 90;
    v9 = 350;
  }
  *Delay = CAEAudioUtility::GetRandomNumberInRange(v8, v9);
}

//----- (003982B0) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::AddAudioEve