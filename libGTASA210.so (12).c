nt(
        CAEPedAudioEntity *this,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fRelativeFrequency,
        CPhysical *pTargetPhysical,
        uint32 TargetSurfaceType,
        tAudioEvent SecondaryAudioEvent,
        UInt32 PlayDelayMs)
{
  int m_bInitialised; // r0
  bool v10; // zf
  int v13; // r5
  float v14; // s18
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r6
  RwReal y; // r2
  RwReal x; // r3
  RwReal z; // r1
  Int16 RandomNumberInRange; // r0
  CMatrix *v21; // r2
  CSimpleTransform *p_m_transform; // r5
  RwReal v23; // r3
  RwReal v24; // r6
  RwReal v25; // r2
  CVector Position; // [sp+0h] [bp-D0h]
  CVector Positiona; // [sp+0h] [bp-D0h]
  CAESound v28; // [sp+2Ch] [bp-A4h] BYREF

  v28.m_pPhysicalEntity = 0;
  m_bInitialised = this->m_bInitialised;
  v10 = m_bInitialised == 0;
  if ( m_bInitialised )
    v10 = this->m_pParentPed == 0;
  if ( !v10 )
  {
    switch ( AudioEvent )
    {
      case '6':
      case '7':
        CAEPedAudioEntity::HandleFootstepEvent(this, AudioEvent, fVolumeOffsetdB, fRelativeFrequency, TargetSurfaceType);
        break;
      case '8':
      case '9':
        CAEPedAudioEntity::HandleSkateEvent(this, AudioEvent, fVolumeOffsetdB, fRelativeFrequency);
        break;
      case ':':
      case ';':
        CAEPedAudioEntity::HandleLandingEvent(this, AudioEvent);
        break;
      case '<':
        CAEPedAudioEntity::HandlePedSwing(this, 60, SecondaryAudioEvent, PlayDelayMs);
        break;
      case '=':
      case '>':
      case '?':
      case '@':
      case 'A':
      case 'B':
      case 'C':
      case 'D':
        CAEPedAudioEntity::HandlePedHit(
          this,
          AudioEvent,
          pTargetPhysical,
          TargetSurfaceType,
          fVolumeOffsetdB,
          PlayDelayMs);
        break;
      case 'E':
      case 'F':
      case 'G':
      case 'H':
      case 'I':
        CAEPedAudioEntity::HandlePedJacked(this, AudioEvent);
        break;
      case 'J':
      case 'K':
        CAEPedAudioEntity::HandleSwimSplash(this, AudioEvent);
        break;
      case 'L':
        CAEPedAudioEntity::HandleSwimWake(this, 76);
        break;
      case 'w':
        v13 = CAEAudioEntity::m_pAudioEventVolumes[119];
        if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2)
          && !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 119, this) )
        {
          v14 = (float)v13 + fVolumeOffsetdB;
          if ( pTargetPhysical )
          {
            m_pMat = pTargetPhysical->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &pTargetPhysical->m_transform;
            y = p_tx->m_translate.y;
            x = p_tx->m_translate.x;
            z = p_tx->m_translate.z;
          }
          else
          {
            z = 0.0;
            y = 0.0;
            x = 0.0;
          }
          Position.x = x;
          *(_QWORD *)&Position.y = __PAIR64__(LODWORD(z), LODWORD(y));
          CAESound::Initialise(&v28, 2, 29, this, Position, v14, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v28.m_FrequencyVariance = 0.06;
          v28.m_RelativeFrequency = fRelativeFrequency;
          v28.m_RollOffFactor = 1.5;
          v28.m_AudioEvent = 119;
          CAESoundManager::RequestNewSound(&AESoundManager, &v28);
          if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 121, this) )
          {
            RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(47, 49);
            if ( pTargetPhysical )
            {
              v21 = pTargetPhysical->m_pMat;
              p_m_transform = (CSimpleTransform *)&v21->tx;
              if ( !v21 )
                p_m_transform = &pTargetPhysical->m_transform;
              v23 = p_m_transform->m_translate.y;
              v24 = p_m_transform->m_translate.x;
              v25 = p_m_transform->m_translate.z;
            }
            else
            {
              v25 = 0.0;
              v23 = 0.0;
              v24 = 0.0;
            }
            Positiona.x = v24;
            *(_QWORD *)&Positiona.y = __PAIR64__(LODWORD(v25), LODWORD(v23));
            CAESound::Initialise(&v28, 2, RandomNumberInRange, this, Positiona, v14, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
            v28.m_FrequencyVariance = 0.06;
            v28.m_RelativeFrequency = fRelativeFrequency;
            v28.m_RollOffFactor = 1.5;
            v28.m_AudioEvent = 121;
            CAESoundManager::RequestNewSound(&AESoundManager, &v28);
          }
        }
        break;
      default:
        break;
    }
  }
  CAESound::~CAESound(&v28);
}
// 3982B0: using guessed type uint32 TargetSurfaceType_0;

//----- (0039852C) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandleFootstepEvent(
        CAEPedAudioEntity *this,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fRelativeFrequency,
        uint32 a5)
{
  float v7; // s18
  float v8; // s16
  Int16 RandomNumberInRange; // r0
  Int16 v10; // r1
  Int16 v11; // r8
  CPed *m_pParentPed; // r2
  float v13; // s0
  CMatrix *m_pMat; // r3
  CVector *p_tx; // r5
  Int32 v16; // r1

  if ( (*((_BYTE *)&this->m_pParentPed->m_nPedFlags + 1) & 2) != 0 )
    return;
  v7 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  v8 = (float)(v7 + fVolumeOffsetdB) + (float)CAEAudioUtility::GetRandomNumberInRange(-3, 3);
  if ( FindPlayerPed(-1) != this->m_pParentPed )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
    {
      v8 = v8 + -3.0;
      goto LABEL_5;
    }
LABEL_14:
    sub_18AFEC(&AEAudioHardware, 0, 41);
    return;
  }
  if ( !SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, a5)
    && !SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
  {
    if ( SurfaceInfos_c::IsAudioConcrete(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
    {
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
        goto LABEL_5;
      goto LABEL_14;
    }
    if ( SurfaceInfos_c::IsAudioGrass(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn)
      || SurfaceInfos_c::IsAudioLongGrass(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
    {
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 1u, 30) )
      {
        if ( (unsigned int)(CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 30) - 1) <= 1 )
          CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 30, 0);
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 1u, 30);
        if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
          goto LABEL_5;
        goto LABEL_14;
      }
    }
    else
    {
      if ( SurfaceInfos_c::IsAudioSand(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
      {
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 4u, 30) )
        {
          if ( (unsigned int)(CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 30) - 1) <= 1 )
            CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 30, 0);
          CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 4u, 30);
          if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
            goto LABEL_5;
          goto LABEL_14;
        }
        v11 = 0;
        v16 = 3;
LABEL_24:
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, v16);
        v10 = 30;
        goto LABEL_11;
      }
      if ( SurfaceInfos_c::IsAudioGravel(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
      {
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 2u, 30) )
        {
          if ( (unsigned int)(CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 30) - 1) <= 1 )
            CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 30, 0);
          CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 2u, 30);
          if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
            goto LABEL_5;
          goto LABEL_14;
        }
      }
      else if ( SurfaceInfos_c::IsAudioWood(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
      {
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 6u, 30) )
        {
          if ( (unsigned int)(CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 30) - 1) <= 1 )
            CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 30, 0);
          CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 6u, 30);
          if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
            goto LABEL_5;
          goto LABEL_14;
        }
      }
      else if ( SurfaceInfos_c::IsAudioTile(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
      {
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 5u, 30) )
        {
          if ( (unsigned int)(CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 30) - 1) <= 1 )
            CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 30, 0);
          CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 5u, 30);
          if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
            goto LABEL_5;
          goto LABEL_14;
        }
      }
      else
      {
        if ( !SurfaceInfos_c::IsAudioMetal(&g_surfaceInfos, this->m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
        {
          if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
            goto LABEL_5;
          goto LABEL_14;
        }
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 3u, 30) )
        {
          if ( (unsigned int)(CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 30) - 1) <= 1 )
            CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 30, 0);
          CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 3u, 30);
          if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
            goto LABEL_5;
          goto LABEL_14;
        }
      }
    }
    v11 = 0;
    v16 = 4;
    goto LABEL_24;
  }
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x80u, 32) )
  {
    RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 4);
    v10 = 32;
    v11 = 50;
    goto LABEL_11;
  }
  CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x80u, 32);
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
    goto LABEL_14;
LABEL_5:
  RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(1, 5);
  v10 = 41;
  v11 = 0;
LABEL_11:
  m_pParentPed = this->m_pParentPed;
  v13 = fRelativeFrequency;
  m_pMat = m_pParentPed->m_pMat;
  p_tx = (CVector *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pParentPed->m_transform.m_translate;
  CAESound::Initialise(
    &this->ScratchSound,
    v10,
    RandomNumberInRange,
    this,
    *p_tx,
    v8,
    1.0,
    v13,
    1.0,
    0,
    0xA0u,
    0.0588,
    v11);
  CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
  sub_19F790(&AESoundManager, &this->ScratchSound);
}

//----- (00398A98) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandleSkateEvent(
        CAEPedAudioEntity *this,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fRelativeFrequency)
{
  char v8; // r11
  Int32 RandomNumberInRange; // r9
  CPed *m_pParentPed; // r0
  CMatrix *m_pMat; // r1
  RwReal *p_tx; // r2
  Int16 v13; // r2
  CVector v14; // [sp+0h] [bp-48h]

  if ( (*((_BYTE *)&this->m_pParentPed->m_nPedFlags + 1) & 2) == 0 )
  {
    v8 = CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
    RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(-3, 3);
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
    {
      m_pParentPed = this->m_pParentPed;
      m_pMat = m_pParentPed->m_pMat;
      p_tx = &m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pParentPed->m_transform.m_translate.x;
      v14.x = *p_tx;
      v14.y = p_tx[1];
      v14.z = p_tx[2];
      v13 = 8;
      if ( AudioEvent == 56 )
        v13 = 7;
      CAESound::Initialise(
        &this->ScratchSound,
        41,
        v13,
        this,
        v14,
        (float)((float)v8 + fVolumeOffsetdB) + (float)RandomNumberInRange,
        1.0,
        fRelativeFrequency,
        1.0,
        0,
        0x80u,
        0.0588,
        0);
      CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
      sub_19F790(&AESoundManager, &this->ScratchSound);
    }
    else
    {
      sub_18AFEC(&AEAudioHardware, 0, 41);
    }
  }
}

//----- (00398BB0) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandleLandingEvent(CAEPedAudioEntity *this, tAudioEvent AudioEvent)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d8
  CPed *m_pParentPed; // r0
  Int16 RandomNumberInRange; // r0
  Int16 v8; // r1
  Int16 v9; // r8
  CPed *v10; // r2
  CMatrix *m_pMat; // r3
  CVector *p_tx; // r5
  UInt16 v13; // r1
  Int16 v14; // r2

  m_pParentPed = this->m_pParentPed;
  if ( (*((_BYTE *)&m_pParentPed->m_nPedFlags + 1) & 2) != 0 )
    return;
  v3.n64_f32[0] = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  if ( !SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, m_pParentPed->m_LastMaterialToHaveBeenStandingOn) )
  {
    v9 = 0;
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
    {
      RandomNumberInRange = 0;
      if ( AudioEvent == 58 )
        RandomNumberInRange = 6;
      v8 = 41;
      goto LABEL_10;
    }
    v13 = 0;
    v14 = 41;
LABEL_15:
    sub_18AFEC(&AEAudioHardware, v13, v14);
    return;
  }
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x80u, 32) )
  {
    v13 = 128;
    v14 = 32;
    goto LABEL_15;
  }
  v2.n64_u32[0] = 0;
  v3.n64_u32[0] = vmax_f32(v3, v2).n64_u32[0];
  RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 4);
  v8 = 32;
  v9 = 50;
LABEL_10:
  v10 = this->m_pParentPed;
  m_pMat = v10->m_pMat;
  p_tx = (CVector *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &v10->m_transform.m_translate;
  CAESound::Initialise(
    &this->ScratchSound,
    v8,
    RandomNumberInRange,
    this,
    *p_tx,
    v3.n64_f32[0],
    1.0,
    1.0,
    1.0,
    0,
    0xA0u,
    0.0588,
    v9);
  CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
  sub_19F790(&AESoundManager, &this->ScratchSound);
}
// 398C0A: variable 'v3' is possibly undefined
// 398C0A: variable 'v2' is possibly undefined

//----- (00398D00) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandlePedSwing(
        CAEPedAudioEntity *this,
        tAudioEvent AudioEvent,
        tAudioEvent SecondaryAudioEvent,
        UInt32 PlayDelayMs)
{
  CPed *m_pParentPed; // r5
  int m_nCurrentWeapon; // r6
  int v10; // s4
  float v11; // s2
  int v12; // r2
  CPed *v13; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3
  float v16; // s0

  m_pParentPed = this->m_pParentPed;
  m_nCurrentWeapon = m_pParentPed->m_nCurrentWeapon;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    v10 = 1.0;
    v11 = 0.0;
    v12 = -1;
    switch ( m_pParentPed->m_WeaponSlots[m_nCurrentWeapon].m_eWeaponType )
    {
      case WEAPONTYPE_UNARMED:
      case WEAPONTYPE_BRASSKNUCKLE:
      case WEAPONTYPE_CHAINSAW:
      case WEAPONTYPE_FLOWERS:
      case WEAPONTYPE_GRENADE:
      case WEAPONTYPE_TEARGAS:
      case WEAPONTYPE_MOLOTOV:
      case WEAPONTYPE_PISTOL:
      case WEAPONTYPE_PISTOL_SILENCED:
      case WEAPONTYPE_DESERT_EAGLE:
      case WEAPONTYPE_SHOTGUN:
      case WEAPONTYPE_SAWNOFF_SHOTGUN:
      case WEAPONTYPE_SPAS12_SHOTGUN:
      case WEAPONTYPE_MICRO_UZI:
      case WEAPONTYPE_MP5:
      case WEAPONTYPE_AK47:
      case WEAPONTYPE_M4:
      case WEAPONTYPE_TEC9:
      case WEAPONTYPE_COUNTRYRIFLE:
      case WEAPONTYPE_SNIPERRIFLE:
      case WEAPONTYPE_FLAMETHROWER:
      case WEAPONTYPE_MINIGUN:
      case WEAPONTYPE_REMOTE_SATCHEL_CHARGE:
      case WEAPONTYPE_DETONATOR:
      case WEAPONTYPE_SPRAYCAN:
      case WEAPONTYPE_EXTINGUISHER:
      case WEAPONTYPE_CAMERA:
      case WEAPONTYPE_NIGHTVISION:
      case WEAPONTYPE_INFRARED:
        v11 = -6.0;
        v10 = 1062668861;
        v12 = 87;
        break;
      case WEAPONTYPE_GOLFCLUB:
      case WEAPONTYPE_CANE:
        v12 = 47;
        break;
      case WEAPONTYPE_NIGHTSTICK:
      case WEAPONTYPE_POOL_CUE:
        goto LABEL_20;
      case WEAPONTYPE_KNIFE:
      case WEAPONTYPE_KATANA:
        v11 = -3.0;
        v12 = 88;
        break;
      case WEAPONTYPE_BASEBALLBAT:
      case WEAPONTYPE_SHOVEL:
        v10 = 1059816735;
        v12 = 86;
        break;
      case WEAPONTYPE_DILDO1:
      case WEAPONTYPE_DILDO2:
      case WEAPONTYPE_VIBE1:
      case WEAPONTYPE_VIBE2:
        v11 = -6.0;
LABEL_20:
        v10 = 1062668861;
        v12 = 86;
        break;
      default:
        break;
    }
    if ( (unsigned int)(SecondaryAudioEvent - 64) >= 3 )
    {
      if ( (unsigned int)(SecondaryAudioEvent - 67) > 1 )
      {
        if ( v12 <= -1 )
          return;
        goto LABEL_11;
      }
      v11 = -2.0;
    }
    else
    {
      v11 = -6.0;
    }
    LOWORD(v12) = 87;
    v10 = 1062668861;
LABEL_11:
    v13 = this->m_pParentPed;
    m_pMat = v13->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v13->m_transform.m_translate;
    CAESound::Initialise(
      &this->ScratchSound,
      5,
      v12,
      this,
      *p_tx,
      v11 + (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent],
      1.0,
      *(float *)&v10,
      1.0,
      0,
      0x80u,
      0.04,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
    if ( PlayDelayMs )
    {
      this->ScratchSound.m_RelativeFrequency = 0.0;
      this->ScratchSound.m_FrequencyVariance = 0.0;
      v16 = (float)(CTimer::m_snTimeInMilliseconds + PlayDelayMs);
      this->ScratchSound.m_AudioEvent = AudioEvent;
      this->ScratchSound.m_ClientVariable = v16;
      CAESound::SetIndividualEnvironment(&this->ScratchSound, 4u, 1u);
    }
    sub_19F790(&AESoundManager, &this->ScratchSound);
    return;
  }
  if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
    sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
}

//----- (00398ED8) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandlePedHit(
        CAEPedAudioEntity *this,
        tAudioEvent AudioEvent,
        CPhysical *pTargetPhysical,
        int TargetSurfaceType,
        float fVolumeOffsetdB,
        UInt32 PlayDelayMs)
{
  CPed *m_pParentPed; // r6
  int m_nCurrentWeapon; // r4
  int v12; // s18
  eWeaponType m_eWeaponType; // r4
  __int16 RandomNumberInRange; // r0
  int v15; // r2
  float v16; // s16
  float v17; // s20
  UInt32 v18; // r9
  float v19; // s0
  float v20; // s22
  Int16 v21; // r11
  Int16 v22; // r1
  Int32 v23; // r0
  Int32 v24; // r1
  char v25; // r1
  float v26; // r0
  CPed *v27; // r1
  float v28; // r8
  CMatrix *v29; // r3
  CVector *v30; // r6
  float SurfaceHardnessVolumeOffset; // r0
  CPed *v32; // r1
  float v33; // r5
  CMatrix *v34; // r3
  CVector *v35; // r4
  CPed *v36; // r1
  CMatrix *v37; // r3
  CVector *v38; // r6
  Int32 v39; // r0
  Int32 v40; // r1
  int v41; // r5
  CPed *v42; // r0
  float v43; // s0
  CMatrix *v44; // r1
  CVector *p_m_translate; // r3
  float v46; // s0
  CPed *v47; // r0
  CMatrix *m_pMat; // r2
  CVector *p_tx; // r3
  float v50; // s0
  Int32 v51; // r0
  Int32 v52; // r1
  Int32 v53; // r0
  Int32 v54; // r1
  int v55; // r5
  int v56; // r5
  int v57; // [sp+2Ch] [bp-4Ch]
  tAudioEvent v58; // [sp+30h] [bp-48h]

  m_pParentPed = this->m_pParentPed;
  m_nCurrentWeapon = m_pParentPed->m_nCurrentWeapon;
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
      sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
    return;
  }
  v12 = 1030805573;
  m_eWeaponType = m_pParentPed->m_WeaponSlots[m_nCurrentWeapon].m_eWeaponType;
  RandomNumberInRange = -1;
  v15 = 58;
  switch ( m_eWeaponType )
  {
    case WEAPONTYPE_UNARMED:
    case WEAPONTYPE_NIGHTVISION:
    case WEAPONTYPE_INFRARED:
      break;
    case WEAPONTYPE_BRASSKNUCKLE:
    case WEAPONTYPE_GRENADE:
    case WEAPONTYPE_TEARGAS:
    case WEAPONTYPE_MOLOTOV:
    case WEAPONTYPE_PISTOL:
    case WEAPONTYPE_PISTOL_SILENCED:
    case WEAPONTYPE_DESERT_EAGLE:
    case WEAPONTYPE_SHOTGUN:
    case WEAPONTYPE_SAWNOFF_SHOTGUN:
    case WEAPONTYPE_SPAS12_SHOTGUN:
    case WEAPONTYPE_MICRO_UZI:
    case WEAPONTYPE_MP5:
    case WEAPONTYPE_AK47:
    case WEAPONTYPE_M4:
    case WEAPONTYPE_TEC9:
    case WEAPONTYPE_COUNTRYRIFLE:
    case WEAPONTYPE_SNIPERRIFLE:
    case WEAPONTYPE_FLAMETHROWER:
    case WEAPONTYPE_MINIGUN:
    case WEAPONTYPE_REMOTE_SATCHEL_CHARGE:
    case WEAPONTYPE_DETONATOR:
    case WEAPONTYPE_SPRAYCAN:
    case WEAPONTYPE_EXTINGUISHER:
    case WEAPONTYPE_CAMERA:
      v15 = 44;
      break;
    case WEAPONTYPE_GOLFCLUB:
      v15 = 48;
      break;
    case WEAPONTYPE_NIGHTSTICK:
      v15 = 35;
      break;
    case WEAPONTYPE_KNIFE:
      v12 = 1022739087;
      v15 = 57;
      break;
    case WEAPONTYPE_BASEBALLBAT:
      v15 = 34;
      break;
    case WEAPONTYPE_SHOVEL:
      v15 = 75;
      break;
    case WEAPONTYPE_POOL_CUE:
      v15 = 67;
      break;
    case WEAPONTYPE_KATANA:
      v15 = 56;
      break;
    case WEAPONTYPE_DILDO1:
    case WEAPONTYPE_DILDO2:
    case WEAPONTYPE_VIBE1:
    case WEAPONTYPE_VIBE2:
      v15 = 50;
      break;
    case WEAPONTYPE_FLOWERS:
      v12 = 1032805417;
      v15 = 54;
      break;
    case WEAPONTYPE_CANE:
      v15 = 46;
      break;
    default:
      v15 = -1;
      break;
  }
  v16 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent] + fVolumeOffsetdB;
  if ( pTargetPhysical && (*(_BYTE *)&pTargetPhysical->m_info & 7) == 3 )
  {
    v17 = -3.0;
    v18 = PlayDelayMs;
    v19 = 0.0;
    v58 = AudioEvent;
    v20 = -6.0;
    v21 = 82;
    v22 = 5;
    switch ( AudioEvent )
    {
      case '=':
        v20 = -9.0;
        v21 = 81;
        v22 = 5;
        switch ( m_eWeaponType )
        {
          case WEAPONTYPE_BRASSKNUCKLE:
            v39 = 40;
            v40 = 43;
            goto LABEL_31;
          case WEAPONTYPE_KNIFE:
          case WEAPONTYPE_KATANA:
            goto LABEL_58;
          case WEAPONTYPE_BASEBALLBAT:
            v53 = 40;
            v54 = 43;
            goto LABEL_69;
          case WEAPONTYPE_CHAINSAW:
            goto LABEL_71;
          case WEAPONTYPE_FLOWERS:
            goto LABEL_25;
          default:
            v51 = 40;
            v52 = 43;
            goto LABEL_66;
        }
      case '>':
        v20 = -9.0;
        v21 = 81;
        v22 = 5;
        switch ( m_eWeaponType )
        {
          case WEAPONTYPE_BRASSKNUCKLE:
            v39 = 36;
            v40 = 39;
LABEL_31:
            v41 = v15;
            RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(v39, v40);
            LOWORD(v15) = v41;
            v19 = 1.0;
            if ( v41 <= -1 )
              goto LABEL_56;
            goto LABEL_26;
          case WEAPONTYPE_KNIFE:
          case WEAPONTYPE_KATANA:
            goto LABEL_58;
          case WEAPONTYPE_BASEBALLBAT:
            v53 = 36;
            v54 = 39;
LABEL_69:
            v56 = v15;
            RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(v53, v54);
            LOWORD(v15) = v56;
            v19 = -10.0;
            if ( v56 <= -1 )
              goto LABEL_56;
            goto LABEL_26;
          case WEAPONTYPE_CHAINSAW:
            goto LABEL_71;
          case WEAPONTYPE_FLOWERS:
            goto LABEL_25;
          default:
            v51 = 36;
            v52 = 39;
LABEL_66:
            v55 = v15;
            RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(v51, v52);
            LOWORD(v15) = v55;
            v19 = -15.0;
            if ( v55 <= -1 )
              goto LABEL_56;
            goto LABEL_26;
        }
      case '?':
        v20 = -9.0;
        v21 = 81;
        v22 = 5;
        switch ( m_eWeaponType )
        {
          case WEAPONTYPE_KNIFE:
          case WEAPONTYPE_KATANA:
            goto LABEL_58;
          case WEAPONTYPE_BASEBALLBAT:
            v19 = -10.0;
            goto LABEL_55;
          case WEAPONTYPE_CHAINSAW:
LABEL_71:
            if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x1Bu, 3) )
              return;
            v21 = CAEAudioUtility::GetRandomNumberInRange(7, 9);
            v20 = -3.0;
            v22 = 3;
            goto LABEL_57;
          case WEAPONTYPE_FLOWERS:
            goto LABEL_25;
          default:
            v19 = -15.0;
LABEL_55:
            v17 = -6.0;
            RandomNumberInRange = 82;
            if ( v15 <= -1 )
              goto LABEL_56;
            goto LABEL_26;
        }
      case '@':
        goto LABEL_58;
      case 'A':
      case 'C':
        v23 = 40;
        v24 = 43;
        goto LABEL_36;
      case 'B':
        v23 = 36;
        v24 = 39;
LABEL_36:
        v21 = CAEAudioUtility::GetRandomNumberInRange(v23, v24);
        v20 = -3.0;
        v19 = 0.0;
        LOWORD(v15) = 58;
        goto LABEL_37;
      case 'D':
        v21 = CAEAudioUtility::GetRandomNumberInRange(59, 62);
        v20 = -3.0;
        goto LABEL_42;
      default:
        goto LABEL_25;
    }
  }
  v17 = -3.0;
  v25 = AudioEvent - 61;
  if ( (unsigned int)(AudioEvent - 61) > 7 )
  {
    v58 = AudioEvent;
    v19 = 0.0;
LABEL_24:
    v18 = PlayDelayMs;
LABEL_25:
    if ( v15 <= -1 )
    {
LABEL_56:
      v22 = 5;
      v21 = RandomNumberInRange;
      v20 = v17;
LABEL_57:
      if ( v21 > -1 )
      {
LABEL_58:
        v47 = this->m_pParentPed;
        m_pMat = v47->m_pMat;
        p_tx = (CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &v47->m_transform.m_translate;
        CAESound::Initialise(&this->ScratchSound, v22, v21, this, *p_tx, v16 + v20, 1.0, 1.0, 1.0, 0, 0x80u, 0.0588, 0);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
        if ( v18 )
        {
          this->ScratchSound.m_RelativeFrequency = 0.0;
          this->ScratchSound.m_FrequencyVariance = 0.0;
          v50 = (float)(CTimer::m_snTimeInMilliseconds + v18);
          this->ScratchSound.m_AudioEvent = v58;
          this->ScratchSound.m_ClientVariable = v50;
          CAESound::SetIndividualEnvironment(&this->ScratchSound, 4u, 1u);
        }
        sub_19F790(&AESoundManager, &this->ScratchSound);
      }
      return;
    }
LABEL_26:
    v21 = RandomNumberInRange;
    v20 = v17;
LABEL_37:
    v42 = this->m_pParentPed;
    v43 = v16 + v19;
    v44 = v42->m_pMat;
    p_m_translate = (CVector *)&v44->tx;
    if ( !v44 )
      p_m_translate = &v42->m_transform.m_translate;
    CAESound::Initialise(
      &this->ScratchSound,
      5,
      v15,
      this,
      *p_m_translate,
      v43,
      1.0,
      1.0,
      1.0,
      0,
      0x80u,
      *(float *)&v12,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
    if ( v18 )
    {
      this->ScratchSound.m_RelativeFrequency = 0.0;
      this->ScratchSound.m_FrequencyVariance = 0.0;
      v46 = (float)(CTimer::m_snTimeInMilliseconds + v18);
      this->ScratchSound.m_AudioEvent = v58;
      this->ScratchSound.m_ClientVariable = v46;
      CAESound::SetIndividualEnvironment(&this->ScratchSound, 4u, 1u);
    }
    CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
LABEL_42:
    v22 = 5;
    goto LABEL_57;
  }
  if ( 1 << v25 << 29 )
  {
    v58 = AudioEvent;
    v57 = v15;
    SurfaceHardnessVolumeOffset = CAECollisionAudioEntity::GetSurfaceHardnessVolumeOffset(TargetSurfaceType);
    v32 = this->m_pParentPed;
    v33 = SurfaceHardnessVolumeOffset;
    v34 = v32->m_pMat;
    v35 = (CVector *)&v34->tx;
    if ( !v34 )
      v35 = &v32->m_transform.m_translate;
    CAudioEngine::ReportCollision(&AudioEngine, v32, pTargetPhysical, 0x3Eu, TargetSurfaceType, v35, 0, 1.0, 1.0, 1, 0);
    v15 = v57;
    v19 = v33;
    RandomNumberInRange = -1;
    goto LABEL_24;
  }
  if ( ((1 << v25) & 0x70) != 0 )
  {
    v58 = AudioEvent;
    v26 = CAECollisionAudioEntity::GetSurfaceHardnessVolumeOffset(TargetSurfaceType);
    v27 = this->m_pParentPed;
    v28 = v26;
    v29 = v27->m_pMat;
    v30 = (CVector *)&v29->tx;
    if ( !v29 )
      v30 = &v27->m_transform.m_translate;
    CAudioEngine::ReportCollision(&AudioEngine, v27, pTargetPhysical, 0x3Eu, TargetSurfaceType, v30, 0, 1.0, 1.0, 1, 0);
    v20 = -3.0;
    v18 = PlayDelayMs;
    v19 = v28;
    LOWORD(v15) = 58;
    v21 = -1;
    goto LABEL_37;
  }
  v36 = this->m_pParentPed;
  v37 = v36->m_pMat;
  v38 = (CVector *)&v37->tx;
  if ( !v37 )
    v38 = &v36->m_transform.m_translate;
  CAudioEngine::ReportCollision(&AudioEngine, v36, pTargetPhysical, 0x3Eu, TargetSurfaceType, v38, 0, 1.0, 1.0, 1, 0);
}

//----- (00399478) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandlePedJacked(CAEPedAudioEntity *this, tAudioEvent AudioEvent)
{
  int v4; // s0
  float v5; // s16
  unsigned int v6; // r9
  Int16 RandomNumberInRange; // r0
  Int16 v8; // r2
  int v9; // r10
  int v10; // r8
  UInt16 v11; // r1
  Int16 v12; // r2
  Int16 v13; // r0
  unsigned int v14; // r8
  CPed *m_pParentPed; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3
  Int16 v18; // r2
  CPed *v19; // r0
  CMatrix *v20; // r1
  CVector *p_m_translate; // r3
  CPed *v22; // r0
  CMatrix *v23; // r1
  CVector *v24; // r2
  Int16 v25; // [sp+2Ch] [bp-2Ch]

  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    if ( CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
      return;
    v11 = 143;
    v12 = 5;
    goto LABEL_22;
  }
  v4 = CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  v5 = (float)v4;
  v6 = CTimer::m_snTimeInMilliseconds;
  switch ( AudioEvent )
  {
    case 'E':
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(40, 43);
      v8 = 58;
      v9 = 2133;
      v10 = 500;
      v25 = RandomNumberInRange;
      goto LABEL_9;
    case 'F':
      v25 = CAEAudioUtility::GetRandomNumberInRange(36, 39);
      v8 = 50;
      v9 = 2633;
      v10 = 933;
      goto LABEL_9;
    case 'G':
      v13 = CAEAudioUtility::GetRandomNumberInRange(40, 43);
      v14 = v6 + 900;
      v9 = 2800;
      goto LABEL_13;
    case 'H':
      v25 = CAEAudioUtility::GetRandomNumberInRange(40, 43);
      v8 = 58;
      v9 = 366;
      v10 = 33;
LABEL_9:
      m_pParentPed = this->m_pParentPed;
      m_pMat = m_pParentPed->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pParentPed->m_transform.m_translate;
      CAESound::Initialise(&this->ScratchSound, 5, v8, this, *p_tx, (float)v4, 2.0, 0.0, 1.0, 0, 0x84u, 0.0, 0);
      CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
      v14 = v10 + v6;
      this->ScratchSound.m_ClientVariable = (float)v14;
      this->ScratchSound.m_AudioEvent = AudioEvent;
      CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      v13 = v25;
      goto LABEL_13;
    case 'I':
      v13 = CAEAudioUtility::GetRandomNumberInRange(36, 39);
      v14 = v6 + 266;
      v9 = 833;
LABEL_13:
      v6 += v9;
      v18 = v13;
      if ( v13 >= 0 )
      {
        v19 = this->m_pParentPed;
        v20 = v19->m_pMat;
        p_m_translate = (CVector *)&v20->tx;
        if ( !v20 )
          p_m_translate = &v19->m_transform.m_translate;
        CAESound::Initialise(&this->ScratchSound, 5, v18, this, *p_m_translate, v5, 2.0, 0.0, 1.0, 0, 0x84u, 0.0, 0);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
        this->ScratchSound.m_ClientVariable = (float)v14;
        this->ScratchSound.m_AudioEvent = AudioEvent;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      }
      break;
    default:
      break;
  }
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41) )
  {
    v11 = 0;
    v12 = 41;
LABEL_22:
    sub_18AFEC(&AEAudioHardware, v11, v12);
    return;
  }
  v22 = this->m_pParentPed;
  v23 = v22->m_pMat;
  v24 = (CVector *)&v23->tx;
  if ( !v23 )
    v24 = &v22->m_transform.m_translate;
  CAESound::Initialise(&this->ScratchSound, 41, 0, this, *v24, v5, 2.0, 0.0, 1.0, 0, 0x84u, 0.0, 0);
  CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
  this->ScratchSound.m_ClientVariable = (float)v6;
  this->ScratchSound.m_AudioEvent = AudioEvent;
  sub_19F790(&AESoundManager, &this->ScratchSound);
}

//----- (00399710) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandleSwimSplash(CAEPedAudioEntity *this, tAudioEvent AudioEvent)
{
  CPed *m_pParentPed; // r2
  int v5; // r3
  int v6; // r0
  int v7; // s0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x80u, 32) )
  {
    m_pParentPed = this->m_pParentPed;
    v5 = CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
    v6 = (unsigned __int16)this->m_nLastSwimSplashSoundID + 1;
    if ( v6 << 16 > 0x40000 )
      LOWORD(v6) = 0;
    this->m_nLastSwimSplashSoundID = v6;
    v7 = v5;
    m_pMat = m_pParentPed->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pParentPed->m_transform.m_translate;
    CAESound::Initialise(&this->ScratchSound, 32, v6, this, *p_tx, (float)v7, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
    this->ScratchSound.m_FrequencyVariance = 0.0588;
    CAESound::SetIndividualEnvironment(&this->ScratchSound, 0x80u, 1u);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, this->m_pParentPed);
    sub_19F790(&AESoundManager, &this->ScratchSound);
  }
  else
  {
    sub_18AFEC(&AEAudioHardware, 0x80u, 32);
  }
}

//----- (003997EC) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::HandleSwimWake(CAEPedAudioEntity *this, tAudioEvent AudioEvent)
{
  CPed *m_pParentPed; // r1
  CMatrix *m_pMat; // r2
  CVector *p_tx; // r3
  CPed *v7; // r1

  if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntityAndPhysical(
         &AESoundManager,
         AudioEvent,
         this,
         this->m_pParentPed) )
  {
LABEL_6:
    this->m_nLastSwimWakeTriggerTimeMs = CTimer::m_snTimeInMilliseconds;
    return;
  }
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
  {
    m_pParentPed = this->m_pParentPed;
    m_pMat = m_pParentPed->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pParentPed->m_transform.m_translate;
    CAESound::Initialise(
      &this->ScratchSound,
      2,
      3,
      this,
      *p_tx,
      (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent] + -20.0,
      1.0,
      1.0,
      1.0,
      0,
      0,
      0.0,
      0);
    this->ScratchSound.m_Environment = 132;
    v7 = this->m_pParentPed;
    this->ScratchSound.m_RelativeFrequency = 0.75;
    this->ScratchSound.m_AudioEvent = AudioEvent;
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, v7);
    CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
    goto LABEL_6;
  }
  if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
    sub_18AFEC(&AEAudioHardware, 0x27u, 2);
}

//----- (003998F4) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::UpdateParameters(CAEPedAudioEntity *this, CAESound *pSound, Int16 PlayTime)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  tAudioEvent m_AudioEvent; // r0
  CPed *m_pParentPed; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  RwReal x; // r4
  CVector v12; // 0:r1.12

  if ( this->m_pJetPackGasSound == pSound )
  {
    if ( PlayTime == -1 )
    {
      this->m_pJetPackGasSound = 0;
      return;
    }
  }
  else if ( this->m_pJetPackThrustSound == pSound )
  {
    if ( PlayTime == -1 )
    {
      this->m_pJetPackThrustSound = 0;
      return;
    }
  }
  else
  {
    if ( this->m_pJetPackRoarSound != pSound )
    {
      if ( this->m_pWindRushSound == pSound )
      {
        if ( PlayTime == -1 )
          this->m_pWindRushSound = 0;
      }
      else if ( PlayTime > -1 )
      {
        m_AudioEvent = pSound->m_AudioEvent;
        if ( (unsigned int)(m_AudioEvent - 60) >= 9 && (unsigned int)(m_AudioEvent - 69) >= 5 )
        {
          if ( m_AudioEvent == 76 )
          {
            v3.n64_f32[0] = (float)CAEAudioEntity::m_pAudioEventVolumes[76];
            if ( CTimer::m_snTimeInMilliseconds <= this->m_nLastSwimWakeTriggerTimeMs + 100 )
            {
              v4.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
              if ( v4.n64_f32[0] < v3.n64_f32[0] )
              {
                v4.n64_f32[0] = v4.n64_f32[0] + 0.6;
                LODWORD(pSound->m_EmittedVolume) = vmin_f32(v4, v3).n64_u32[0];
              }
            }
            else
            {
              v3.n64_f32[0] = v3.n64_f32[0] + -20.0;
              v4.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
              if ( v4.n64_f32[0] <= v3.n64_f32[0] )
              {
                CAESound::StopSoundAndForget(pSound);
                this->m_nLastSwimWakeTriggerTimeMs = 0;
              }
              else
              {
                v4.n64_f32[0] = v4.n64_f32[0] + -0.6;
                LODWORD(pSound->m_EmittedVolume) = vmax_f32(v4, v3).n64_u32[0];
              }
            }
          }
        }
        else if ( CTimer::m_snTimeInMilliseconds >= (unsigned int)pSound->m_ClientVariable )
        {
          pSound->m_RelativeFrequency = 1.0;
        }
      }
      return;
    }
    if ( PlayTime == -1 )
    {
      this->m_pJetPackRoarSound = 0;
      return;
    }
  }
  m_pParentPed = this->m_pParentPed;
  if ( m_pParentPed )
  {
    m_pMat = m_pParentPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pParentPed->m_transform;
    x = p_tx->m_translate.x;
    *(_QWORD *)&v12.y = *(_QWORD *)&p_tx->m_translate.y;
    v12.x = x;
    j_CAESound::SetPosition(pSound, v12);
  }
}
// 3999FC: variable 'v4' is possibly undefined
// 3999FC: variable 'v3' is possibly undefined

//----- (00399A50) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::Initialise(CAEPedAudioEntity *this, CEntity *pPed)
{
  this->m_nLastSwimSplashSoundID = 0;
  this->m_pParentPed = (CPed *)pPed;
  this->m_bJetPackOn = 0;
  this->m_pJetPackThrustSound = 0;
  this->m_pJetPackGasSound = 0;
  this->m_nLastSwimWakeTriggerTimeMs = 0;
  this->m_fCurrentJetPackThrustVolume = -100.0;
  this->m_fCurrentJetPackGasVolume = -100.0;
  this->m_pWindRushSound = 0;
  this->m_fCurrentWindRushVolume = -100.0;
  this->m_fCurrentShirtFlapVolume = -100.0;
  this->m_bInitialised = 1;
}

//----- (00399A80) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::Terminate(CAEPedAudioEntity *this)
{
  CAESound *m_pJetPackThrustSound; // r0
  CAESound *m_pJetPackGasSound; // r0
  CAESound *m_pJetPackRoarSound; // r0

  m_pJetPackThrustSound = this->m_pJetPackThrustSound;
  this->m_pParentPed = 0;
  this->m_bInitialised = 0;
  if ( m_pJetPackThrustSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackThrustSound);
    this->m_pJetPackThrustSound = 0;
  }
  m_pJetPackGasSound = this->m_pJetPackGasSound;
  if ( m_pJetPackGasSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackGasSound);
    this->m_pJetPackGasSound = 0;
  }
  m_pJetPackRoarSound = this->m_pJetPackRoarSound;
  if ( m_pJetPackRoarSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackRoarSound);
    this->m_pJetPackRoarSound = 0;
  }
  CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
  if ( this->m_ShirtFlapTwinLoopSound.m_bCurrentlyInUse )
    sub_19775C(&this->m_ShirtFlapTwinLoopSound);
}

//----- (00399AE8) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::StopJetPackSound(CAEPedAudioEntity *this)
{
  CAESound *m_pJetPackThrustSound; // r0
  CAESound *m_pJetPackGasSound; // r0
  CAESound *m_pJetPackRoarSound; // r0

  m_pJetPackThrustSound = this->m_pJetPackThrustSound;
  if ( m_pJetPackThrustSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackThrustSound);
    this->m_pJetPackThrustSound = 0;
  }
  m_pJetPackGasSound = this->m_pJetPackGasSound;
  if ( m_pJetPackGasSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackGasSound);
    this->m_pJetPackGasSound = 0;
  }
  m_pJetPackRoarSound = this->m_pJetPackRoarSound;
  if ( m_pJetPackRoarSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackRoarSound);
    this->m_pJetPackRoarSound = 0;
  }
}

//----- (00399B24) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::Service(CAEPedAudioEntity *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d8
  unsigned __int64 v4; // d9
  float32x2_t v5; // d11
  float32x2_t v6; // d12
  CPed *m_pParentPed; // r1
  CEntity *m_pAttachToEntity; // r0
  _BOOL4 v10; // r5
  float v11; // s16
  float v12; // s20
  CVehicle *m_pMyVehicle; // r0
  int32 m_baseVehicleType; // r2
  CVehicle *v15; // r1
  int VehicleAudioType; // r6
  float v17; // r0
  float v18; // s0
  CPedIntelligence *m_pPedIntelligence; // r0
  _BOOL4 UsingParachute; // r0
  CPed *v21; // r1
  CAnimBlendAssociation *Association; // r0
  float32x2_t v23; // d0
  CAnimBlendAssociation *v24; // r0
  float v25; // s20
  float v26; // s22
  float v27; // s16
  float v28; // r0
  unsigned __int32 v29; // s0

  if ( !CPed::IsPlayer(this->m_pParentPed) )
    return;
  m_pParentPed = this->m_pParentPed;
  m_pAttachToEntity = m_pParentPed->m_pAttachToEntity;
  v10 = (!m_pAttachToEntity || (*(_BYTE *)&m_pAttachToEntity->m_info & 7) != 2)
     && !(*((unsigned __int8 *)&m_pParentPed->m_nPedFlags + 1) << 31);
  v11 = 1.0;
  v12 = -100.0;
  if ( m_pParentPed->m_nPedState == PED_DRIVING )
  {
    m_pMyVehicle = m_pParentPed->m_pMyVehicle;
    if ( m_pMyVehicle )
    {
      m_baseVehicleType = m_pMyVehicle->m_baseVehicleType;
      if ( m_baseVehicleType != 9 )
      {
        if ( m_baseVehicleType
          || (*((int (__fastcall **)(CVehicle *))m_pMyVehicle->_vptr$CPlaceable + 40))(m_pMyVehicle) != 1 )
        {
          goto LABEL_18;
        }
        m_pParentPed = this->m_pParentPed;
      }
      v15 = m_pParentPed->m_pMyVehicle;
      v1.n64_f32[0] = sqrtf(
                        (float)((float)(v15->m_vecMoveSpeed.x * v15->m_vecMoveSpeed.x)
                              + (float)(v15->m_vecMoveSpeed.y * v15->m_vecMoveSpeed.y))
                      + (float)(v15->m_vecMoveSpeed.z * v15->m_vecMoveSpeed.z));
      if ( v1.n64_f32[0] > 0.0 )
      {
        v2.n64_u32[0] = 1.0;
        VehicleAudioType = (unsigned __int8)v15->m_VehicleAudioEntity.m_VehicleAudioSetting.VehicleAudioType;
        v3.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
        v17 = CAEAudioUtility::AudioLog10(v3.n64_f32[0]);
        v18 = -10.0;
        if ( VehicleAudioType == 2 )
          v18 = -17.0;
        v11 = (float)(v3.n64_f32[0] * 0.4) + 0.8;
        v12 = v18 + (float)(v17 * 20.0);
      }
    }
  }
LABEL_18:
  m_pPedIntelligence = this->m_pParentPed->m_pPedIntelligence;
  if ( m_pPedIntelligence )
  {
    UsingParachute = CPedIntelligence::GetUsingParachute(m_pPedIntelligence);
    if ( v10 )
    {
LABEL_20:
      v21 = this->m_pParentPed;
      v3.n64_f32[0] = sqrtf(
                        (float)((float)(v21->m_vecMoveSpeed.x * v21->m_vecMoveSpeed.x)
                              + (float)(v21->m_vecMoveSpeed.y * v21->m_vecMoveSpeed.y))
                      + (float)(v21->m_vecMoveSpeed.z * v21->m_vecMoveSpeed.z))
                    / 0.7;
      if ( UsingParachute )
      {
        Association = RpAnimBlendClumpGetAssociation((RpClump_0 *)v21->m_pRwObject, "FALL_SkyDive_accel");
        v6.n64_u32[0] = 1.0;
        v5.n64_u32[0] = 0;
        v23.n64_u64[0] = v5.n64_u64[0];
        if ( Association )
          v23.n64_u32[0] = LODWORD(Association->m_fBlendAmount);
        LODWORD(v4) = vmax_f32(vmin_f32(v23, v6), v5).n64_u32[0];
        v24 = RpAnimBlendClumpGetAssociation((RpClump_0 *)this->m_pParentPed->m_pRwObject, "Para_decel");
        v1.n64_u64[0] = v5.n64_u64[0];
        if ( v24 )
          v1.n64_u32[0] = LODWORD(v24->m_fBlendAmount);
        v25 = -7.0;
        LODWORD(v26) = vmax_f32(vmin_f32(v1, v6), v5).n64_u32[0];
      }
      else
      {
        LODWORD(v4) = 0;
        v25 = -16.0;
        if ( v3.n64_f32[0] >= 0.5 )
        {
          v26 = 0.0;
          v3.n64_f32[0] = (float)(v3.n64_f32[0] + -0.5) + (float)(v3.n64_f32[0] + -0.5);
        }
        else
        {
          v3.n64_u64[0] = v4;
          v26 = 0.0;
        }
      }
      v1.n64_u32[0] = 1.0;
      v2.n64_u32[0] = 0;
      v27 = vmax_f32(vmin_f32(v3, v1), v2).n64_f32[0];
      v28 = CAEAudioUtility::AudioLog10(v27);
      v11 = (float)(v27 * 0.8) + 0.8;
      v12 = v25 + (float)(v28 * 20.0);
      goto LABEL_32;
    }
  }
  else
  {
    UsingParachute = 0;
    if ( v10 )
      goto LABEL_20;
  }
  LODWORD(v4) = 0;
  v26 = 0.0;
LABEL_32:
  v2.n64_f32[0] = (float)(v12 + (float)(*(float *)&v4 * 4.0)) + (float)(v26 * -6.0);
  v1.n64_u32[0] = LODWORD(this->m_fCurrentShirtFlapVolume);
  if ( v2.n64_f32[0] <= v1.n64_f32[0] )
  {
    v1.n64_f32[0] = v1.n64_f32[0] + -2.0;
    v29 = vmax_f32(v1, v2).n64_u32[0];
  }
  else
  {
    v1.n64_f32[0] = v1.n64_f32[0] + 5.0;
    v29 = vmin_f32(v1, v2).n64_u32[0];
  }
  this->m_fCurrentShirtFlapVolume = *(float *)&v29;
  if ( v2.n64_f32[0] < -20.0 && *(float *)&v29 < -20.0 )
  {
    LODWORD(this->m_fCurrentShirtFlapVolume) = v2.n64_u32[0];
    *(float *)&v29 = (float)(v12 + (float)(*(float *)&v4 * 4.0)) + (float)(v26 * -6.0);
  }
  if ( *(float *)&v29 <= -100.0 )
    sub_19775C(&this->m_ShirtFlapTwinLoopSound);
  else
    CAEPedAudioEntity::PlayShirtFlap(this, *(float *)&v29, v11 * (float)((float)(*(float *)&v4 * 0.5) + 1.0));
}
// 399BDA: variable 'v1' is possibly undefined
// 399BDA: variable 'v2' is possibly undefined
// 399C72: variable 'v5' is possibly undefined
// 399C80: variable 'v6' is possibly undefined
// 399CCE: variable 'v4' is possibly undefined
// 399CF0: variable 'v3' is possibly undefined

//----- (00399E04) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::PlayShirtFlap(CAEPedAudioEntity *this, float fVolume, float fFrequency)
{
  CAETwinLoopSoundEntity *p_m_ShirtFlapTwinLoopSound; // r4
  CPed *m_pParentPed; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3
  CPed *v10; // r0
  CMatrix *v11; // r1
  CVector *p_m_translate; // r3
  CAESound v13; // [sp+14h] [bp-94h] BYREF

  v13.m_pPhysicalEntity = 0;
  p_m_ShirtFlapTwinLoopSound = &this->m_ShirtFlapTwinLoopSound;
  if ( this->m_ShirtFlapTwinLoopSound.m_bCurrentlyInUse )
  {
    m_pParentPed = this->m_pParentPed;
    m_pMat = m_pParentPed->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pParentPed->m_transform.m_translate;
    CAETwinLoopSoundEntity::UpdateTwinLoopSound(p_m_ShirtFlapTwinLoopSound, *p_tx, fVolume, fFrequency);
  }
  else
  {
    CAETwinLoopSoundEntity::Initialise(&this->m_ShirtFlapTwinLoopSound, 5, 19, 20, this, 0xC8u, 0x3E8u, -1, -1);
    v10 = this->m_pParentPed;
    v11 = v10->m_pMat;
    p_m_translate = (CVector *)&v11->tx;
    if ( !v11 )
      p_m_translate = &v10->m_transform.m_translate;
    CAETwinLoopSoundEntity::PlayTwinLoopSound(
      p_m_ShirtFlapTwinLoopSound,
      *p_m_translate,
      fVolume,
      fFrequency,
      2.0,
      1.0,
      0);
  }
  CAESound::~CAESound(&v13);
}

//----- (00399EB0) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::TurnOnJetPack(CAEPedAudioEntity *this)
{
  CPed *m_pParentPed; // r0
  bool v3; // zf
  CAESound *m_pJetPackThrustSound; // r1
  bool v5; // zf
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r2
  CPed *v8; // r0
  CMatrix *v9; // r1
  CVector *p_m_translate; // r2
  CPed *v11; // r0
  CMatrix *v12; // r1
  CVector *v13; // r2

  m_pParentPed = this->m_pParentPed;
  if ( m_pParentPed )
  {
    v3 = this->m_bJetPackOn == 0;
    if ( !this->m_bJetPackOn )
      v3 = this->m_pJetPackGasSound == 0;
    if ( v3 )
    {
      m_pJetPackThrustSound = this->m_pJetPackThrustSound;
      v5 = m_pJetPackThrustSound == 0;
      if ( !m_pJetPackThrustSound )
        v5 = this->m_pJetPackRoarSound == 0;
      if ( v5 )
      {
        *(_QWORD *)&this->m_fCurrentJetPackThrustVolume = 0xC2C80000C2C80000LL;
        *(_QWORD *)&this->m_fCurrentJetPackRoarVolume = 0x3ECCCCCD40000000LL;
        this->m_bJetPackOn = 1;
        m_pMat = m_pParentPed->m_pMat;
        p_tx = (CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pParentPed->m_transform.m_translate;
        CAESound::Initialise(&this->ScratchSound, 19, 26, this, *p_tx, -100.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        this->ScratchSound.m_Environment = 4;
        this->ScratchSound.m_RelativeFrequency = 1.0;
        this->m_pJetPackThrustSound = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
        v8 = this->m_pParentPed;
        v9 = v8->m_pMat;
        p_m_translate = (CVector *)&v9->tx;
        if ( !v9 )
          p_m_translate = &v8->m_transform.m_translate;
        CAESound::Initialise(&this->ScratchSound, 5, 10, this, *p_m_translate, -100.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        this->ScratchSound.m_Environment = 4;
        this->ScratchSound.m_RelativeFrequency = 1.0;
        this->m_pJetPackGasSound = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
        v11 = this->m_pParentPed;
        v12 = v11->m_pMat;
        v13 = (CVector *)&v12->tx;
        if ( !v12 )
          v13 = &v11->m_transform.m_translate;
        CAESound::Initialise(&this->ScratchSound, 0, 0, this, *v13, -100.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        this->ScratchSound.m_Environment = 4;
        this->ScratchSound.m_RelativeFrequency = 1.0;
        this->m_pJetPackRoarSound = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      }
    }
  }
}

//----- (0039A004) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::TurnOffJetPack(CAEPedAudioEntity *this)
{
  CAESound *m_pJetPackThrustSound; // r0
  CAESound *m_pJetPackGasSound; // r0
  CAESound *m_pJetPackRoarSound; // r0

  m_pJetPackThrustSound = this->m_pJetPackThrustSound;
  if ( m_pJetPackThrustSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackThrustSound);
    this->m_pJetPackThrustSound = 0;
  }
  m_pJetPackGasSound = this->m_pJetPackGasSound;
  if ( m_pJetPackGasSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackGasSound);
    this->m_pJetPackGasSound = 0;
  }
  m_pJetPackRoarSound = this->m_pJetPackRoarSound;
  if ( m_pJetPackRoarSound )
  {
    CAESound::StopSoundAndForget(m_pJetPackRoarSound);
    this->m_pJetPackRoarSound = 0;
  }
  this->m_bJetPackOn = 0;
}

//----- (0039A044) --------------------------------------------------------
void __fastcall CAEPedAudioEntity::UpdateJetPack(CAEPedAudioEntity *this, float fThrust, float fAngle)
{
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d3
  float32x2_t v6; // d4
  float32x2_t v7; // d5
  float32x2_t v8; // d6
  float32x2_t v9; // d7
  float32x2_t v10; // d10
  int m_bJetPackOn; // r0
  bool v13; // zf
  CAESound *m_pJetPackThrustSound; // r5
  bool v15; // zf
  int v16; // s16
  float v17; // s0
  float *p_m_fCurrentJetPackRoarFrequency; // r6
  float *p_m_fCurrentJetPackRoarVolume; // r8
  float *p_m_fCurrentJetPackGasVolume; // r9
  unsigned __int32 v21; // s18
  float v22; // s0
  float v23; // r0

  m_bJetPackOn = this->m_bJetPackOn;
  v13 = m_bJetPackOn == 0;
  if ( m_bJetPackOn )
    v13 = this->m_pJetPackGasSound == 0;
  if ( !v13 )
  {
    m_pJetPackThrustSound = this->m_pJetPackThrustSound;
    v15 = m_pJetPackThrustSound == 0;
    if ( m_pJetPackThrustSound )
      v15 = this->m_pJetPackRoarSound == 0;
    if ( !v15 )
    {
      v3.n64_u32[0] = LODWORD(this->m_fCurrentJetPackThrustVolume);
      if ( fThrust <= 0.5 )
      {
        v9.n64_u32[0] = 2.0;
        v7.n64_f32[0] = this->m_fCurrentJetPackRoarVolume + -0.3;
        v10.n64_u32[0] = -17.0;
        v16 = 1053609165;
        p_m_fCurrentJetPackRoarFrequency = &this->m_fCurrentJetPackRoarFrequency;
        v22 = this->m_fCurrentJetPackRoarFrequency + -0.031;
        p_m_fCurrentJetPackRoarVolume = &this->m_fCurrentJetPackRoarVolume;
        v3.n64_f32[0] = v3.n64_f32[0] + -5.0;
        v5.n64_u32[0] = -1027080192;
        v4.n64_f32[0] = this->m_fCurrentJetPackGasVolume + 6.0;
        p_m_fCurrentJetPackGasVolume = &this->m_fCurrentJetPackGasVolume;
        v21 = vmax_f32(v3, v5).n64_u32[0];
        this->m_fCurrentJetPackThrustVolume = *(float *)&v21;
        LODWORD(this->m_fCurrentJetPackGasVolume) = vmin_f32(v4, v10).n64_u32[0];
        LODWORD(this->m_fCurrentJetPackRoarVolume) = vmax_f32(v7, v9).n64_u32[0];
        if ( v22 > 0.4 )
          v16 = LODWORD(v22);
      }
      else
      {
        v4.n64_u32[0] = -15.0;
        v16 = 1060487823;
        v9.n64_u32[0] = 11.0;
        v17 = this->m_fCurrentJetPackRoarFrequency + 0.031;
        p_m_fCurrentJetPackRoarFrequency = &this->m_fCurrentJetPackRoarFrequency;
        p_m_fCurrentJetPackRoarVolume = &this->m_fCurrentJetPackRoarVolume;
        v3.n64_u32[1] = 1050253722;
        v6.n64_f32[0] = this->m_fCurrentJetPackGasVolume + -7.1;
        v8.n64_u32[0] = -1027080192;
        p_m_fCurrentJetPackGasVolume = &this->m_fCurrentJetPackGasVolume;
        v7.n64_f32[0] = this->m_fCurrentJetPackRoarVolume + 0.3;
        v3.n64_f32[0] = v3.n64_f32[0] + 15.0;
        v21 = vmin_f32(v3, v4).n64_u32[0];
        this->m_fCurrentJetPackThrustVolume = *(float *)&v21;
        LODWORD(this->m_fCurrentJetPackGasVolume) = vmax_f32(v6, v8).n64_u32[0];
        LODWORD(this->m_fCurrentJetPackRoarVolume) = vmin_f32(v7, v9).n64_u32[0];
        if ( v17 < 0.71 )
          v16 = LODWORD(v17);
      }
      v23 = sinf(fAngle);
      *(_DWORD *)p_m_fCurrentJetPackRoarFrequency = v16;
      m_pJetPackThrustSound->m_EmittedVolume = *(float *)&v21 + 0.0;
      this->m_pJetPackThrustSound->m_RelativeFrequency = (float)(COERCE_FLOAT(LODWORD(v23) & 0x7FFFFFFF) * -0.07) + 1.0;
      this->m_pJetPackGasSound->m_EmittedVolume = *p_m_fCurrentJetPackGasVolume + 0.0;
      this->m_pJetPackGasSound->m_RelativeFrequency = 0.56;
      this->m_pJetPackRoarSound->m_EmittedVolume = *p_m_fCurrentJetPackRoarVolume + 0.0;
      this->m_pJetPackRoarSound->m_RelativeFrequency = (float)((float)(COERCE_FLOAT(LODWORD(v23) & 0x7FFFFFFF) * 0.2)
                                                             + 1.0)
                                                     * *p_m_fCurrentJetPackRoarFrequency;
    }
  }
}
// 39A0E4: variable 'v4' is possibly undefined
// 39A0DC: variable 'v6' is possibly undefined
// 39A0DC: variable 'v8' is possibly undefined
// 39A0E0: variable 'v7' is possibly undefined
// 39A0E0: variable 'v9' is possibly undefined
// 39A148: variable 'v3' is possibly undefined
// 39A148: variable 'v5' is possibly undefined
// 39A14C: variable 'v10' is possibly undefined

//----- (0039A224) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::CAEPedSpeechAudioEntity(CAEPedSpeechAudioEntity *this)
{
  this->m_pGameEntity = 0;
  this->m_pSound = 0;
  this->m_fEventVolume = -100.0;
  this->ScratchSound.m_pPhysicalEntity = 0;
  this->b_Initialised = 0;
  this->m_PedType = 0;
  this->m_bPlayingSpeech = 0;
  this->m_bSpeechDisabled = 0;
  this->m_bSpeechDisabledForScriptSpeech = 0;
  this->m_SoundID = -1;
  this->m_BankID = -1;
  this->m_PedSpeechSlotID = -1;
  this->m_LastUsedGlobalSpeechContext = -1;
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_6677F8;
}
// 6677F8: using guessed type void *;

//----- (0039A270) --------------------------------------------------------
int __fastcall CAEPedSpeechAudioEntity::AddSayEvent(
        CAEPedSpeechAudioEntity *this,
        tAudioEvent AudioEvent,
        int GlobalSpeechContext,
        UInt32 StartTimeDelay,
        float Probability,
        int OverideSilence,
        int bForceAudible,
        int bFrontEnd)
{
  __int16 v12; // r5
  bool v13; // zf
  Int32 v14; // r8
  int m_PedType; // r0
  bool v16; // zf
  bool v17; // zf
  int v19; // r0
  unsigned int v20; // r9
  bool v21; // cf
  bool v22; // zf
  int m_GlobalSpeechContext; // r0
  _BOOL4 IsAlive; // r0
  Bool8 v25; // r12
  int v26; // r1
  int v27; // r0
  bool v28; // zf
  CPlayerPed *v29; // r6
  CEntity *v30; // r6
  CPlayerPed *PlayerPed; // r0
  CEntity *m_pGameEntity; // r1
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r6
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v36; // d16
  unsigned __int64 v37; // d1
  Bool8 v38; // r6
  int CanWePlayGlobalSpeechContext; // r0
  UInt32 *v40; // r1
  int SoundAndBankIDs; // r0
  Bool8 v42; // r1
  Bool8 v43; // r12
  __int16 v44; // r1
  int v45; // r0
  int v46; // r3
  bool v47; // zf
  __int16 v48; // r5
  uint32 v49; // r0
  UInt32 *v50; // r1
  float v51; // s0
  CEntity *v52; // r0
  CLink<CEntity *> *m_pLastRenderedLink; // r6
  bool v54; // zf
  CVehicle *VehicleOfPlayer; // r0
  float m_fEventVolume; // s2
  CAEPedSpeechAudioEntity *v57; // r0
  __int16 v58; // [sp+0h] [bp-28h]
  CAEPedSpeechAudioEntity *v59; // [sp+4h] [bp-24h]
  Int16 pSpecificSpeechContext[15]; // [sp+Ah] [bp-1Eh] BYREF

  v12 = -1;
  if ( this->b_Initialised )
  {
    v13 = CAEPedSpeechAudioEntity::s_bAllSpeechDisabled == 0;
    if ( !CAEPedSpeechAudioEntity::s_bAllSpeechDisabled )
      v13 = this->m_bSpeechDisabledForScriptSpeech == 0;
    if ( v13 )
    {
      v14 = tempTimeOffset;
      if ( !TheCamera.m_WideScreenOn )
        goto LABEL_14;
      m_PedType = (unsigned __int16)this->m_PedType;
      v16 = m_PedType == 2;
      if ( m_PedType != 2 )
        v16 = m_PedType == 4;
      if ( v16 )
        goto LABEL_14;
      v17 = GlobalSpeechContext == 13;
      if ( GlobalSpeechContext != 13 )
        v17 = GlobalSpeechContext == 116;
      if ( v17 || GlobalSpeechContext == 15 )
      {
LABEL_14:
        if ( CGameLogic::GameState != 2 )
        {
          if ( GlobalSpeechContext == 45 )
          {
            if ( CTimer::m_FrameCounter << 26
              || (CAEPedSpeechAudioEntity::s_bPedConversationHappening | CAEPedSpeechAudioEntity::s_bPlayerConversationHappening) << 24 )
            {
              return v12;
            }
          }
          else if ( GlobalSpeechContext == 357 && CWeather::UnderWaterness < 0.5 )
          {
            return v12;
          }
          v19 = CAEAudioUtility::ResolveProbability(Probability);
          if ( AudioEvent == 52 && v19 && (OverideSilence || !this->m_bSpeechDisabled) )
          {
            v20 = (unsigned __int16)(GlobalSpeechContext - 340);
            v21 = v20 >= 0x13;
            if ( v20 >= 0x13 )
              v21 = (unsigned int)(GlobalSpeechContext - 125) >= 3;
            if ( !v21 )
              goto LABEL_101;
            v22 = GlobalSpeechContext == 15;
            if ( GlobalSpeechContext != 15 )
              v22 = GlobalSpeechContext == 13;
            if ( v22 )
            {
LABEL_101:
              if ( this->m_bPlayingSpeech )
              {
                m_GlobalSpeechContext = CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_GlobalSpeechContext;
                if ( (unsigned __int16)(m_GlobalSpeechContext - 340) >= 0x13u )
                {
                  if ( (unsigned int)(m_GlobalSpeechContext - 125) < 3
                    || m_GlobalSpeechContext == 13
                    || m_GlobalSpeechContext == 15 )
                  {
                    return v12;
                  }
                }
                else if ( (unsigned __int16)m_GlobalSpeechContext != 358 )
                {
                  return v12;
                }
                CAEPedSpeechAudioEntity::StopCurrentSpeech(this);
              }
            }
            else if ( this->m_bPlayingSpeech )
            {
              return v12;
            }
            IsAlive = CPed::IsAlive((const CPed *)this->m_pGameEntity);
            if ( v20 < 0x13 || IsAlive )
            {
              v25 = bFrontEnd;
              v26 = 1;
              v27 = (unsigned __int16)this->m_PedType;
              v28 = v27 == 2;
              if ( v27 != 2 )
                v28 = v27 == 4;
              if ( !v28 )
              {
                v26 = 1;
                switch ( GlobalSpeechContext )
                {
                  case 13:
                  case 15:
                  case 48:
                  case 49:
                  case 50:
                  case 51:
                  case 52:
                  case 53:
                  case 54:
                  case 55:
                  case 56:
                  case 57:
                  case 58:
                  case 59:
                  case 60:
                  case 61:
                  case 62:
                  case 63:
                  case 64:
                  case 125:
                  case 126:
                  case 127:
                  case 161:
                  case 162:
                  case 163:
                  case 164:
                  case 165:
                  case 166:
                  case 167:
                  case 168:
                  case 169:
                  case 170:
                  case 171:
                    break;
                  default:
                    v26 = 0;
                    break;
                }
              }
              if ( v26 | bFrontEnd | bForceAudible )
              {
                if ( CStreaming::ms_numModelsRequested >= 16 && CAEVehicleAudioEntity::s_pPlayerAttachedForRadio )
                  return v12;
              }
              else
              {
                if ( CStreaming::IsVeryBusy() )
                  return v12;
                v27 = (unsigned __int16)this->m_PedType;
                v25 = bFrontEnd;
              }
              if ( v27 != 2
                || (!CAEPedSpeechAudioEntity::s_bAPlayerSpeaking
                 || this->m_bPlayingSpeech
                 || (v29 = (CPlayerPed *)this->m_pGameEntity, v29 != FindPlayerPed(0)))
                && (v30 = this->m_pGameEntity, PlayerPed = FindPlayerPed(0), v25 = bFrontEnd, v30 == PlayerPed) )
              {
                m_pGameEntity = this->m_pGameEntity;
                m_pMat = m_pGameEntity->m_pMat;
                p_tx = (CSimpleTransform *)&m_pMat->tx;
                if ( !m_pMat )
                  p_tx = &m_pGameEntity->m_transform;
                p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
                if ( !TheCamera.m_pMat )
                  p_m_transform = &TheCamera.m_transform;
                v36.n64_u64[0] = vsub_f32(
                                   *(float32x2_t *)&p_tx->m_translate.y,
                                   *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
                v37 = vmul_f32(v36, v36).n64_u64[0];
                if ( (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                                           * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                                   + *(float *)&v37)
                           + *((float *)&v37 + 1)) <= 1600.0 )
                {
                  if ( this->m_PedType == 2 )
                  {
                    if ( (unsigned __int16)((unsigned __int16)GlobalSpeechContext >> 3) <= 0x2Cu )
                    {
                      v40 = v20 > 0x12 ? &gGlobalSpeechContextNextPlayTime[GlobalSpeechContext] : (UInt32 *)((char *)this->m_NextTimeCanSayPain + (((GlobalSpeechContext << 16) - 22282240) >> 14));
                      if ( CTimer::m_snTimeInMilliseconds < *v40 )
                        return v12;
                    }
                    v38 = v25;
                    CanWePlayGlobalSpeechContext = 5;
                  }
                  else
                  {
                    v38 = v25;
                    CanWePlayGlobalSpeechContext = CAEPedSpeechAudioEntity::CanWePlayGlobalSpeechContext(
                                                     this,
                                                     GlobalSpeechContext);
                    if ( (unsigned __int16)CanWePlayGlobalSpeechContext > 4u )
                      return v12;
                  }
                  v59 = (CAEPedSpeechAudioEntity *)CanWePlayGlobalSpeechContext;
                  SoundAndBankIDs = CAEPedSpeechAudioEntity::GetSoundAndBankIDs(
                                      this,
                                      GlobalSpeechContext,
                                      pSpecificSpeechContext);
                  if ( SoundAndBankIDs >= 0 )
                  {
                    v42 = bForceAudible;
                    v43 = v38;
                    v58 = SoundAndBankIDs;
                    if ( (unsigned __int16)((unsigned __int16)GlobalSpeechContext >> 3) <= 0x2Cu )
                    {
                      v44 = 0;
                      do
                      {
                        v45 = v44;
                        v46 = (unsigned __int16)gSpeechContextLookup[v44][0];
                        v47 = v46 == 0xFFFF;
                        if ( v46 != 0xFFFF )
                        {
                          ++v44;
                          v47 = v46 == (unsigned __int16)GlobalSpeechContext;
                        }
                      }
                      while ( !v47 );
                      v42 = bForceAudible;
                      if ( v46 != 0xFFFF )
                      {
                        v48 = gSpeechContextLookup[v45][6];
                        v49 = CTimer::m_snTimeInMilliseconds
                            + (__int16)(CAEAudioUtility::GetRandomNumberInRange(1, 1000) + v48);
                        if ( v20 > 0x12 )
                          v50 = &gGlobalSpeechContextNextPlayTime[GlobalSpeechContext];
                        else
                          v50 = (UInt32 *)((char *)this->m_NextTimeCanSayPain
                                         + (((GlobalSpeechContext << 16) - 22282240) >> 14));
                        v43 = bFrontEnd;
                        *v50 = v49;
                        v42 = bForceAudible;
                      }
                    }
                    v51 = (float)CAEAudioEntity::m_pAudioEventVolumes[52];
                    v52 = this->m_pGameEntity;
                    this->m_bFrontEnd = v43;
                    this->m_bForceAudible = v42;
                    this->m_fEventVolume = v51;
                    m_pLastRenderedLink = v52[23].m_pLastRenderedLink;
                    v54 = m_pLastRenderedLink == 0;
                    if ( m_pLastRenderedLink )
                      v54 = BYTE1(v52[19].m_transform.m_heading) << 31 == 0;
                    if ( !v54 )
                    {
                      VehicleOfPlayer = CAEAudioUtility::FindVehicleOfPlayer();
                      if ( GlobalSpeechContext != 337 && m_pLastRenderedLink == (CLink<CEntity *> *)VehicleOfPlayer )
                        this->m_bFrontEnd = 1;
                    }
                    if ( this->m_PedType == 2 )
                    {
                      m_fEventVolume = this->m_fEventVolume;
                      this->m_bPlayingSpeech = 1;
                      this->m_PedSpeechSlotID = (__int16)v59;
                      v57 = (CAEPedSpeechAudioEntity *)&CAEPedSpeechAudioEntity::s_bAPlayerSpeaking;
                      this->m_fEventVolume = m_fEventVolume + 3.0;
                      CAEPedSpeechAudioEntity::s_bAPlayerSpeaking = 1;
                    }
                    else
                    {
                      this->m_bPlayingSpeech = 1;
                      v57 = v59;
                      this->m_PedSpeechSlotID = (__int16)v59;
                    }
                    this->m_LastUsedGlobalSpeechContext = GlobalSpeechContext;
                    this->m_fEventVolume = CAEPedSpeechAudioEntity::GetSpeechContextVolumeOffset(
                                             v57,
                                             GlobalSpeechContext)
                                         + this->m_fEventVolume;
                    CAEPedSpeechAudioEntity::LoadAndPlaySpeech(this, v14 + StartTimeDelay);
                    return v58;
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  return v12;
}
// 39A270: using guessed type Int16 pSpecificSpeechContext[15];

//----- (0039A828) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::IsGlobalContextImportantForWidescreen(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalContext)
{
  Bool8 result; // r0
  int m_PedType; // r2
  bool v5; // zf
  bool v6; // zf

  result = 1;
  m_PedType = (unsigned __int16)this->m_PedType;
  v5 = m_PedType == 2;
  if ( m_PedType != 2 )
    v5 = m_PedType == 4;
  if ( !v5 )
  {
    v6 = GlobalContext == 13;
    result = 1;
    if ( GlobalContext != 13 )
      v6 = GlobalContext == 15;
    if ( !v6 && GlobalContext != 116 )
      return 0;
  }
  return result;
}

//----- (0039A84C) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::IsGlobalContextPain(CAEPedSpeechAudioEntity *this, Int16 GlobalSpeechContext)
{
  return (unsigned __int16)(GlobalSpeechContext - 340) < 0x13u;
}

//----- (0039A85C) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::IsGlobalContextImportantForInterupting(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalContext)
{
  Bool8 result; // r0

  result = 1;
  if ( (unsigned int)(GlobalContext - 125) >= 3 && GlobalContext != 13 && GlobalContext != 15 )
    return 0;
  return result;
}

//----- (0039A874) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::StopCurrentSpeech(CAEPedSpeechAudioEntity *this)
{
  int b_Initialised; // r0
  bool v3; // zf
  RwReal y; // r0
  CTaskComplexFacial *TaskSecondary; // r0
  Int16 m_PedSpeechSlotID; // r1
  CAESound *m_pSound; // r0
  int v8; // r3
  CAEPedSpeechSlot *v9; // r2
  Bool8 *p_m_ReservedForPedConversation; // r1
  CAEPedSpeechSlot *v11; // r3
  CAEPedSpeechSlot *v12; // r0
  int m_ReservedForPlayerConversation; // lr
  int m_PedType; // r0

  b_Initialised = this->b_Initialised;
  v3 = b_Initialised == 0;
  if ( b_Initialised )
    v3 = this->m_bPlayingSpeech == 0;
  if ( !v3 )
  {
    y = this->m_pGameEntity[18].m_transform.m_translate.y;
    if ( y != 0.0 && CTaskManager::GetTaskSecondary((const CTaskManager *)(LODWORD(y) + 4), 3) )
    {
      TaskSecondary = (CTaskComplexFacial *)CTaskManager::GetTaskSecondary(
                                              (const CTaskManager *)(LODWORD(this->m_pGameEntity[18].m_transform.m_translate.y)
                                                                   + 4),
                                              3);
      CTaskComplexFacial::StopAll(TaskSecondary);
    }
    m_PedSpeechSlotID = this->m_PedSpeechSlotID;
    if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID].m_InUse == 5 )
    {
      m_pSound = this->m_pSound;
      if ( m_pSound )
      {
        CAESound::StopSoundAndForget(m_pSound);
        m_PedSpeechSlotID = this->m_PedSpeechSlotID;
      }
      this->m_pSound = 0;
    }
    v8 = m_PedSpeechSlotID;
    v9 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID];
    p_m_ReservedForPedConversation = &v9->m_ReservedForPedConversation;
    if ( v9->m_ReservedForPedConversation )
    {
      v9->m_InUse = 0;
      v11 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8];
      v11->m_pAudioEntity = 0;
      v11->m_pSound = 0;
      v11->m_SoundID = -1;
      v11->m_BankID = -1;
      v11->m_StartPlaybackTime = 0;
      v11->m_GlobalSpeechContext = -1;
      v11->m_PedType = -1;
      *p_m_ReservedForPedConversation = 0;
      v11->m_bForceAudible = 0;
      v11->m_ReservedForPlayerConversation = 0;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_ReservedForPedConversation = 1;
    }
    else
    {
      v12 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8];
      m_ReservedForPlayerConversation = v12->m_ReservedForPlayerConversation;
      v9->m_InUse = 0;
      v12->m_pAudioEntity = 0;
      v12->m_pSound = 0;
      v12->m_SoundID = -1;
      v12->m_BankID = -1;
      v12->m_StartPlaybackTime = 0;
      v12->m_GlobalSpeechContext = -1;
      v12->m_PedType = -1;
      *p_m_ReservedForPedConversation = 0;
      v12->m_bForceAudible = 0;
      v12->m_ReservedForPlayerConversation = 0;
      if ( !m_ReservedForPlayerConversation )
      {
LABEL_16:
        m_PedType = (unsigned __int16)this->m_PedType;
        this->m_bPlayingSpeech = 0;
        if ( m_PedType == 2 )
          CAEPedSpeechAudioEntity::s_bAPlayerSpeaking = 0;
        this->m_PedSpeechSlotID = -1;
        return;
      }
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_ReservedForPlayerConversation = 1;
    }
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_InUse = 4;
    goto LABEL_16;
  }
}

//----- (0039A9D0) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::IsGlobalContextImportantForStreaming(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalContext)
{
  Bool8 result; // r0
  int m_PedType; // r2
  bool v5; // zf

  result = 1;
  m_PedType = (unsigned __int16)this->m_PedType;
  v5 = m_PedType == 2;
  if ( m_PedType != 2 )
    v5 = m_PedType == 4;
  if ( !v5 )
  {
    result = 1;
    switch ( GlobalContext )
    {
      case 13:
      case 15:
      case 48:
      case 49:
      case 50:
      case 51:
      case 52:
      case 53:
      case 54:
      case 55:
      case 56:
      case 57:
      case 58:
      case 59:
      case 60:
      case 61:
      case 62:
      case 63:
      case 64:
      case 125:
      case 126:
      case 127:
      case 161:
      case 162:
      case 163:
      case 164:
      case 165:
      case 166:
      case 167:
      case 168:
      case 169:
      case 170:
      case 171:
        return result;
      default:
        result = 0;
        break;
    }
  }
  return result;
}

//----- (0039AB34) --------------------------------------------------------
UInt32 __fastcall CAEPedSpeechAudioEntity::GetNextPlayTime(CAEPedSpeechAudioEntity *this, Int16 GlobalSpeechContext)
{
  if ( (unsigned __int16)((unsigned __int16)GlobalSpeechContext >> 3) > 0x2Cu )
    return 0;
  if ( (unsigned __int16)(GlobalSpeechContext - 340) > 0x12u )
    return gGlobalSpeechContextNextPlayTime[GlobalSpeechContext];
  return *(UInt32 *)((char *)this->m_NextTimeCanSayPain + (((GlobalSpeechContext << 16) - 22282240) >> 14));
}

//----- (0039AB70) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::CanWePlayGlobalSpeechContext(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalSpeechContext)
{
  __int16 v2; // r12
  bool v3; // zf
  __int16 **v4; // r2
  int v5; // r3
  Int16 v6; // r2
  bool v7; // zf
  int v8; // r3
  uint32 v9; // r0
  UInt32 *v10; // r0

  v2 = -1;
  if ( CAEPedSpeechAudioEntity::s_bPedConversationHappening && (unsigned int)(GlobalSpeechContext - 125) >= 3 )
  {
    v3 = GlobalSpeechContext == 13;
    if ( GlobalSpeechContext != 13 )
      v3 = GlobalSpeechContext == 15;
    if ( !v3 && (unsigned __int16)(GlobalSpeechContext - 340) >= 0x13u )
    {
      if ( &CAEPedSpeechAudioEntity::s_pConversationPed1->m_PedSpeechAudioEntity == this )
      {
        v4 = &CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
      }
      else
      {
        if ( &CAEPedSpeechAudioEntity::s_pConversationPed2->m_PedSpeechAudioEntity != this )
          goto LABEL_12;
        v4 = &CAEPedSpeechAudioEntity::s_pConversationPedSlot2;
      }
      v5 = **v4;
      v6 = v5;
      if ( (unsigned __int16)v5 != 0xFFFF )
      {
LABEL_35:
        if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v5].m_InUse == 4 )
          v2 = v6;
        LOWORD(v8) = v2;
        return v8;
      }
    }
  }
LABEL_12:
  if ( CAEPedSpeechAudioEntity::s_bPlayerConversationHappening && (unsigned int)(GlobalSpeechContext - 125) >= 3 )
  {
    v7 = GlobalSpeechContext == 13;
    if ( GlobalSpeechContext != 13 )
      v7 = GlobalSpeechContext == 15;
    if ( !v7 && (unsigned __int16)(GlobalSpeechContext - 340) > 0x12u )
    {
      v5 = CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
      v6 = CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
      if ( (unsigned __int16)CAEPedSpeechAudioEntity::s_pConversationPedSlot1 != 0xFFFF
        && &CAEPedSpeechAudioEntity::s_pPlayerConversationPed->m_PedSpeechAudioEntity == this )
      {
        goto LABEL_35;
      }
    }
  }
  v8 = CAEPedSpeechAudioEntity::s_NextSpeechSlot % 5;
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
  {
    v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 1) % 5;
    if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
    {
      v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 2) % 5;
      if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
      {
        v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 3) % 5;
        if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
        {
          LOWORD(v8) = -1;
          if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[(CAEPedSpeechAudioEntity::s_NextSpeechSlot + 4) % 5].m_InUse )
            return v8;
          v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 4) % 5;
        }
      }
    }
  }
  CAEPedSpeechAudioEntity::s_NextSpeechSlot = (__int16)(v8 + 1) % 5;
  if ( (unsigned __int16)((unsigned __int16)GlobalSpeechContext >> 3) <= 0x2Cu )
  {
    if ( (unsigned __int16)(GlobalSpeechContext - 340) > 0x12u )
      v10 = &gGlobalSpeechContextNextPlayTime[GlobalSpeechContext];
    else
      v10 = (UInt32 *)((char *)this->m_NextTimeCanSayPain + (((GlobalSpeechContext << 16) - 22282240) >> 14));
    v9 = *v10;
  }
  else
  {
    v9 = 0;
  }
  if ( CTimer::m_snTimeInMilliseconds < v9 )
    LOWORD(v8) = -1;
  return v8;
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
// 676D90: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot2;

//----- (0039ADB4) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetSoundAndBankIDs(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalSpeechContext,
        Int16 *pSpecificSpeechContext)
{
  unsigned int m_PedType; // r12
  unsigned int v5; // r0
  bool v6; // cc
  Int16 v7; // r11
  __int16 v8; // r3
  int v9; // r5
  int v10; // r0
  bool v11; // zf
  int v12; // r5
  int v13; // r1
  int m_VoiceID; // r1
  unsigned __int8 (*v15)[2]; // r2
  int v16; // r0
  __int16 v17; // r1
  __int16 (*v18)[2]; // r2
  int v19; // r4
  int v20; // r5
  Int32 v21; // r1
  int v22; // r6
  __int16 v23; // r0
  int v24; // r5
  __int16 v25; // r9
  int v26; // r1
  int v27; // r0
  __int16 v28; // r2
  int v29; // r1
  int v30; // r0
  bool v31; // zf
  Int16 v32; // r0
  int v33; // r3
  __int16 v34; // r2
  __int16 v35; // r5
  int v36; // r1
  Int16 *v37; // r0
  __int16 v39; // r3
  __int16 (**v40)[46]; // r0
  __int16 (**v41)[3128]; // r2
  __int16 CurrentCJMood; // r8
  Int32 RandomNumberInRange; // r0
  int v44; // r1
  unsigned __int16 *v45; // r3
  int v46; // [sp+4h] [bp-74h]
  int v47; // [sp+8h] [bp-70h]
  _WORD v48[54]; // [sp+Ch] [bp-6Ch] BYREF

  v5 = (unsigned __int16)GlobalSpeechContext >> 3;
  v6 = v5 > 0x2C;
  v7 = -1;
  if ( v5 <= 0x2C )
  {
    m_PedType = this->m_PedType;
    v6 = m_PedType > 5;
  }
  if ( !v6 )
  {
    v8 = 0;
    do
    {
      v9 = v8;
      v10 = (unsigned __int16)gSpeechContextLookup[v8][0];
      v11 = v10 == 0xFFFF;
      if ( v10 != 0xFFFF )
      {
        ++v8;
        v11 = v10 == (unsigned __int16)GlobalSpeechContext;
      }
    }
    while ( !v11 );
    if ( v10 != 0xFFFF )
    {
      v12 = gSpeechContextLookup[v9][m_PedType + 1];
      if ( v12 >= 0 )
      {
        *pSpecificSpeechContext = v12;
        if ( (unsigned __int16)(GlobalSpeechContext - 340) > 0x12u )
        {
          switch ( this->m_PedType )
          {
            case 0:
              if ( v12 <= 103 )
              {
                m_VoiceID = this->m_VoiceID;
                v15 = gGenSpeechLookup[(__int16)v12];
                this->m_BankID = gGenSpeechVoiceToBankLookup[m_VoiceID];
                v16 = v15[m_VoiceID][0];
                if ( v16 != 255 )
                {
                  v17 = v15[m_VoiceID][1];
                  goto LABEL_23;
                }
              }
              break;
            case 1:
              if ( v12 <= 34 )
              {
                v39 = 184;
                v40 = &gEmgSpeechVoiceToBankLookup_ptr;
                v13 = this->m_VoiceID;
                v41 = &gEmgSpeechLookup_ptr;
                goto LABEL_79;
              }
              break;
            case 2:
              if ( v12 <= 111 )
              {
                CurrentCJMood = CAEPedSpeechAudioEntity::GetCurrentCJMood();
                while ( 1 )
                {
                  RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 1);
                  v44 = CurrentCJMood;
                  switch ( CurrentCJMood )
                  {
                    case 0:
                      break;
                    case 1:
                      RandomNumberInRange += 2;
                      break;
                    case 2:
                      RandomNumberInRange += 4;
                      break;
                    case 3:
                      RandomNumberInRange += 6;
                      break;
                    case 4:
                      RandomNumberInRange += 8;
                      break;
                    case 5:
                      RandomNumberInRange += 10;
                      break;
                    case 6:
                      RandomNumberInRange += 12;
                      break;
                    case 7:
                      RandomNumberInRange += 14;
                      break;
                    case 8:
                      RandomNumberInRange += 16;
                      break;
                    case 9:
                      RandomNumberInRange += 18;
                      break;
                    default:
                      RandomNumberInRange = (unsigned __int16)RandomNumberInRange + 10;
                      break;
                  }
                  v45 = (unsigned __int16 *)((char *)gPlySpeechLookup[v12] + (RandomNumberInRange << 16 >> 14));
                  if ( CurrentCJMood == 5 || *v45 != 0xFFFF )
                    break;
                  CurrentCJMood = 1;
                  switch ( v44 )
                  {
                    case 0:
                    case 7:
                      continue;
                    case 1:
                    case 2:
                    case 3:
                    case 4:
                    case 5:
                      CurrentCJMood = 5;
                      break;
                    case 6:
                      CurrentCJMood = 0;
                      break;
                    case 8:
                      CurrentCJMood = 4;
                      break;
                    default:
                      CurrentCJMood = 5;
                      break;
                  }
                }
                v13 = (__int16)RandomNumberInRange;
                this->m_BankID = gPlySpeechVoiceToBankLookup[(__int16)RandomNumberInRange];
                v16 = *v45;
                if ( v16 != 0xFFFF )
                {
                  v18 = gPlySpeechLookup[v12];
                  goto LABEL_22;
                }
              }
              break;
            case 3:
              if ( v12 <= 112 )
              {
                v39 = 208;
                v40 = (__int16 (**)[46])&gGngSpeechVoiceToBankLookup_ptr;
                v13 = this->m_VoiceID;
                v41 = (__int16 (**)[3128])&gGngSpeechLookup_ptr;
LABEL_79:
                v18 = (__int16 (*)[2])((char *)*v41 + (__int16)v12 * v39);
                this->m_BankID = (**v40)[v13];
                goto LABEL_21;
              }
              break;
            case 4:
              if ( v12 <= 120 )
              {
                v13 = this->m_VoiceID;
                this->m_BankID = gGfdSpeechVoiceToBankLookup[v13];
                v18 = gGfdSpeechLookup[v12];
                goto LABEL_21;
              }
              break;
            default:
              return v7;
          }
        }
        else
        {
          if ( this->m_PedType == 2 )
          {
            v13 = 0;
          }
          else
          {
            v13 = 1;
            if ( !this->m_bFemale )
              v13 = 2;
          }
          this->m_BankID = gPainVoiceToBankLookup[v13];
          v18 = gPainLookup[v12];
LABEL_21:
          v16 = (unsigned __int16)v18[v13][0];
          if ( v16 != 0xFFFF )
          {
LABEL_22:
            v17 = v18[v13][1];
LABEL_23:
            v19 = v17 + 1 - (__int16)v16;
            v20 = 20;
            v21 = v17 - (__int16)v16;
            if ( v19 < 20 )
              v20 = (__int16)v19;
            v46 = (__int16)v16;
            v22 = 0;
            v23 = CAEAudioUtility::GetRandomNumberInRange(0, v21);
            v47 = v20;
            if ( v20 < 1 )
            {
              v30 = 0;
            }
            else
            {
              v24 = v23;
              v25 = 0;
              do
              {
                v26 = (v22 + v24) % v19 + v46;
                this->m_SoundID = v26;
                v48[2 * v22] = v26;
                v27 = 0;
                while ( (unsigned __int16)CAEPedSpeechAudioEntity::s_PhraseMemory[v27][0] != (unsigned __int16)v26
                     || this->m_BankID != CAEPedSpeechAudioEntity::s_PhraseMemory[v27][1] )
                {
                  v28 = v27 + 1;
                  v6 = v27++ < 149;
                  if ( !v6 )
                  {
                    LOWORD(v27) = v28;
                    goto LABEL_33;
                  }
                }
                v48[2 * v22 + 1] = v27;
LABEL_33:
                v29 = (unsigned __int16)v27;
                v11 = (unsigned __int16)v27 == 150;
                v30 = 0;
                ++v25;
                if ( v11 )
                  v30 = 1;
                v22 = v25;
              }
              while ( v47 > v25 && v29 != 150 );
            }
            v31 = v47 == v22;
            if ( v47 == v22 )
              v31 = v30 == 0;
            if ( v31 )
            {
              v32 = v48[0];
              if ( v47 >= 1 )
              {
                v33 = 0;
                v34 = 0;
                v35 = 0;
                do
                {
                  ++v34;
                  if ( (__int16)v48[2 * v33 + 1] > v35 )
                  {
                    v32 = v48[2 * v33];
                    v35 = v48[2 * v33 + 1];
                  }
                  v33 = v34;
                }
                while ( v47 > v34 );
              }
              this->m_SoundID = v32;
            }
            v36 = 150;
            v37 = CAEPedSpeechAudioEntity::s_PhraseMemory[148];
            do
            {
              --v36;
              *((_DWORD *)v37 + 1) = *(_DWORD *)v37;
              v37 -= 2;
            }
            while ( v36 > 1 );
            *(_DWORD *)&CAEPedSpeechAudioEntity::s_PhraseMemory[0][0] = *(_DWORD *)&this->m_SoundID;
            return CAEPedSpeechAudioEntity::s_PhraseMemory[0][0] - v46;
          }
        }
      }
    }
  }
  return v7;
}
// 39AE02: variable 'm_PedType' is possibly undefined
// 677CF0: using guessed type __int16 (*gGngSpeechVoiceToBankLookup_ptr)[52];
// 6792A8: using guessed type __int16 (*gEmgSpeechVoiceToBankLookup_ptr)[46];
// 6792CC: using guessed type __int16 (*gEmgSpeechLookup_ptr)[3128];
// 6796B8: using guessed type __int16 (*gGngSpeechLookup_ptr)[11648];
// 39ADB4: using guessed type _WORD var_6C[54];

//----- (0039B140) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::SetNextPlayTime(CAEPedSpeechAudioEntity *this, Int16 GlobalSpeechContext)
{
  int v2; // r4
  __int16 v4; // r1
  int v5; // r0
  int v6; // r5
  bool v7; // zf
  __int16 v8; // r5
  uint32 v9; // r0
  UInt32 *v10; // r1

  v2 = GlobalSpeechContext;
  if ( (unsigned __int16)((unsigned __int16)GlobalSpeechContext >> 3) <= 0x2Cu )
  {
    v4 = 0;
    do
    {
      v5 = v4;
      v6 = (unsigned __int16)gSpeechContextLookup[v4][0];
      v7 = v6 == 0xFFFF;
      if ( v6 != 0xFFFF )
      {
        ++v4;
        v7 = v6 == (unsigned __int16)v2;
      }
    }
    while ( !v7 );
    if ( v6 != 0xFFFF )
    {
      v8 = gSpeechContextLookup[v5][6];
      v9 = CTimer::m_snTimeInMilliseconds + (__int16)(CAEAudioUtility::GetRandomNumberInRange(1, 1000) + v8);
      if ( (unsigned __int16)(v2 - 340) > 0x12u )
        v10 = &gGlobalSpeechContextNextPlayTime[v2];
      else
        v10 = (UInt32 *)((char *)this->m_NextTimeCanSayPain + (((v2 << 16) - 22282240) >> 14));
      *v10 = v9;
    }
  }
}

//----- (0039B1DC) --------------------------------------------------------
float __fastcall CAEPedSpeechAudioEntity::GetSpeechContextVolumeOffset(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalSpeechContext)
{
  float v2; // s0
  float StatValue; // s16
  float v4; // s20
  float v5; // s16
  float v6; // s20
  float v7; // s20
  float v8; // s18
  float v9; // s4
  double v10; // d16
  float v11; // s0
  float v12; // s20
  float v13; // s18
  float v14; // s2

  v2 = -6.0;
  switch ( GlobalSpeechContext )
  {
    case 337:
      return v2;
    case 338:
      v2 = -12.0;
      break;
    case 354:
      StatValue = CStats::GetStatValue(0x15u);
      if ( (float)((float)(StatValue - CStats::GetStatValue(0x17u)) / 1000.0) > 1.0
        || (v4 = CStats::GetStatValue(0x15u), (float)((float)(v4 - CStats::GetStatValue(0x17u)) / 1000.0) >= -1.0) )
      {
        v7 = CStats::GetStatValue(0x15u);
        if ( (float)((float)(v7 - CStats::GetStatValue(0x17u)) / 1000.0) > 1.0 )
          goto LABEL_13;
        v8 = CStats::GetStatValue(0x15u);
        v9 = -18.0;
        v10 = (float)((float)(v8 - CStats::GetStatValue(0x17u)) / 1000.0) * 0.5 + 0.5;
        v11 = 18.0;
        goto LABEL_15;
      }
      v2 = -18.0;
      break;
    case 355:
      v5 = CStats::GetStatValue(0x15u);
      if ( (float)((float)(v5 - CStats::GetStatValue(0x17u)) / 1000.0) > 1.0
        || (v6 = CStats::GetStatValue(0x15u), (float)((float)(v6 - CStats::GetStatValue(0x17u)) / 1000.0) >= -1.0) )
      {
        v12 = CStats::GetStatValue(0x15u);
        if ( (float)((float)(v12 - CStats::GetStatValue(0x17u)) / 1000.0) > 1.0 )
          goto LABEL_13;
        v13 = CStats::GetStatValue(0x15u);
        v9 = -21.0;
        v10 = (float)((float)(v13 - CStats::GetStatValue(0x17u)) / 1000.0) * 0.5 + 0.5;
        v11 = 21.0;
LABEL_15:
        v14 = v10;
        v2 = (float)(v14 * v11) + v9;
      }
      else
      {
        v2 = -21.0;
      }
      break;
    case 357:
      v2 = 3.0;
      break;
    default:
LABEL_13:
      v2 = 0.0;
      break;
  }
  return v2;
}

//----- (0039B3B0) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::LoadAndPlaySpeech(CAEPedSpeechAudioEntity *this, UInt32 StartTimeDelay)
{
  int m_PedSpeechSlotID; // r0
  UInt32 v5; // r2

  m_PedSpeechSlotID = this->m_PedSpeechSlotID;
  if ( ((unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID].m_InUse | 4) == 4 )
  {
    CAEAudioHardware::LoadSound(&AEAudioHardware, this->m_BankID, this->m_SoundID, m_PedSpeechSlotID + 20);
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_InUse = 1;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_BankID = this->m_BankID;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_SoundID = this->m_SoundID;
    v5 = CTimer::m_snTimeInMilliseconds + StartTimeDelay;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_pAudioEntity = this;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_StartPlaybackTime = v5;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_PedType = this->m_PedType;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_GlobalSpeechContext = this->m_LastUsedGlobalSpeechContext;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_bForceAudible = this->m_bForceAudible;
  }
}

//----- (0039B49C) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::AddScriptSayEvent(
        CAEPedSpeechAudioEntity *this,
        tAudioEvent AudioEvent,
        tAudioEvent ScriptID,
        int OverideSilence,
        Bool8 bForceAudible,
        Bool8 bFrontEnd)
{
  int v8; // r6
  Int16 v9; // r0
  float v10; // s0
  CEntity *m_pGameEntity; // r0
  CVehicle *m_pLastRenderedLink; // r5
  bool v13; // zf
  float m_fEventVolume; // s2
  __int64 pSoundID; // [sp+4h] [bp-1Ch] BYREF
  tAudioEvent pScriptSlotAudioEvent[5]; // [sp+Ch] [bp-14h] BYREF

  if ( AudioEvent == 53
    && this->b_Initialised
    && !((CAEPedSpeechAudioEntity::s_bAllSpeechDisabled | TheCamera.m_WideScreenOn) << 24)
    && (OverideSilence || !this->m_bSpeechDisabled)
    && !this->m_bPlayingSpeech
    && !CStreaming::IsVeryBusy() )
  {
    if ( this->m_PedType == 2 )
    {
      if ( CAEPedSpeechAudioEntity::s_bAPlayerSpeaking && !this->m_bPlayingSpeech )
        return;
      LOWORD(v8) = 5;
    }
    else
    {
      v8 = CAEPedSpeechAudioEntity::s_NextSpeechSlot % 5;
      if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
      {
        v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 1) % 5;
        if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
        {
          v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 2) % 5;
          if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
          {
            v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 3) % 5;
            if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
            {
              v8 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 4) % 5;
              if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v8].m_InUse )
                return;
            }
          }
        }
      }
      CAEPedSpeechAudioEntity::s_NextSpeechSlot = (v8 + 1) % 5;
      if ( (unsigned __int16)v8 > 4u )
        return;
    }
    pScriptSlotAudioEvent[0] = ScriptID;
    this->m_SoundID = -1;
    this->m_BankID = -1;
    pSoundID = -1LL;
    CAEAudioUtility::GetBankAndSoundFromScriptSlotAudioEvent(
      pScriptSlotAudioEvent,
      (int *)&pSoundID + 1,
      (int *)&pSoundID,
      -1);
    v9 = WORD2(pSoundID);
    if ( (int)(pSoundID | HIDWORD(pSoundID)) >= 0 )
    {
      this->m_SoundID = pSoundID;
      this->m_BankID = v9;
      v10 = (float)CAEAudioEntity::m_pAudioEventVolumes[53];
      m_pGameEntity = this->m_pGameEntity;
      this->m_bFrontEnd = bFrontEnd;
      this->m_bForceAudible = bForceAudible;
      this->m_fEventVolume = v10;
      m_pLastRenderedLink = (CVehicle *)m_pGameEntity[23].m_pLastRenderedLink;
      v13 = m_pLastRenderedLink == 0;
      if ( m_pLastRenderedLink )
        v13 = BYTE1(m_pGameEntity[19].m_transform.m_heading) << 31 == 0;
      if ( !v13 && m_pLastRenderedLink == CAEAudioUtility::FindVehicleOfPlayer() )
        this->m_bFrontEnd = 1;
      if ( this->m_PedType == 2 )
      {
        m_fEventVolume = this->m_fEventVolume;
        this->m_bPlayingSpeech = 1;
        this->m_PedSpeechSlotID = v8;
        this->m_fEventVolume = m_fEventVolume + 3.0;
        CAEPedSpeechAudioEntity::s_bAPlayerSpeaking = 1;
      }
      else
      {
        this->m_bPlayingSpeech = 1;
        this->m_PedSpeechSlotID = v8;
      }
      this->m_LastUsedGlobalSpeechContext = -1;
      CAEPedSpeechAudioEntity::LoadAndPlaySpeech(this, 0);
    }
  }
}
// 39B49C: using guessed type tAudioEvent pScriptSlotAudioEvent[5];

//----- (0039B6EC) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::CanWePlayScriptedSpeech(CAEPedSpeechAudioEntity *this)
{
  int v1; // r1

  v1 = CAEPedSpeechAudioEntity::s_NextSpeechSlot % 5;
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse )
  {
    v1 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 1) % 5;
    if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse )
    {
      v1 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 2) % 5;
      if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse )
      {
        v1 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 3) % 5;
        if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse )
        {
          v1 = (CAEPedSpeechAudioEntity::s_NextSpeechSlot + 4) % 5;
          if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse )
            return -1;
        }
      }
    }
  }
  CAEPedSpeechAudioEntity::s_NextSpeechSlot = (v1 + 1) % 5;
  return v1;
}

//----- (0039B7FC) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::GetSoundAndBankIDsForScriptedSpeech(
        CAEPedSpeechAudioEntity *this,
        tAudioEvent ScriptID)
{
  __int64 v3; // kr00_8
  __int64 pSoundID; // [sp+4h] [bp-14h] BYREF
  tAudioEvent pScriptSlotAudioEvent[3]; // [sp+Ch] [bp-Ch] BYREF

  pScriptSlotAudioEvent[0] = ScriptID;
  *(_DWORD *)&this->m_SoundID = -1;
  pSoundID = -1LL;
  CAEAudioUtility::GetBankAndSoundFromScriptSlotAudioEvent(
    pScriptSlotAudioEvent,
    (int *)&pSoundID + 1,
    (int *)&pSoundID,
    -1);
  v3 = pSoundID;
  if ( (int)(pSoundID | HIDWORD(pSoundID)) < 0 )
    return 0;
  this->m_SoundID = pSoundID;
  this->m_BankID = WORD2(v3);
  return 1;
}
// 39B7FC: using guessed type tAudioEvent pScriptSlotAudioEvent[3];

//----- (0039B83C) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::UpdateParameters(
        CAEPedSpeechAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  int m_PedType; // r1
  int m_PedSpeechSlotID; // r3
  CAEPedSpeechSlot *v6; // r1
  int v7; // r1
  CEntity *v8; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  RwReal x; // r4
  CEntity *m_pGameEntity; // r0
  RwReal y; // r0
  CTaskComplexFacial *TaskSecondary; // r0
  CMatrix v16; // [sp+0h] [bp-50h] BYREF
  CVector v17; // 0:r1.12

  v16.m_pRwMat = 0;
  v16.m_owner = 0;
  if ( PlayTime == -1 )
  {
    m_PedType = (unsigned __int16)this->m_PedType;
    this->m_bPlayingSpeech = 0;
    if ( m_PedType == 2 )
      CAEPedSpeechAudioEntity::s_bAPlayerSpeaking = 0;
    m_PedSpeechSlotID = this->m_PedSpeechSlotID;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_InUse = 0;
    v6 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID];
    v6->m_pAudioEntity = 0;
    v6->m_pSound = 0;
    v6->m_SoundID = -1;
    v6->m_BankID = -1;
    v6->m_StartPlaybackTime = 0;
    v6->m_GlobalSpeechContext = -1;
    v6->m_PedType = -1;
    v6->m_ReservedForPlayerConversation = 0;
    *(_WORD *)&v6->m_bForceAudible = 0;
    this->m_SoundID = -1;
    this->m_pSound = 0;
    this->m_BankID = -1;
    if ( CAEPedSpeechAudioEntity::s_bPedConversationHappening )
    {
      if ( &CAEPedSpeechAudioEntity::s_pConversationPed1->m_PedSpeechAudioEntity == this
        && (v7 = (unsigned __int16)this->m_PedSpeechSlotID,
            v7 == (unsigned __int16)CAEPedSpeechAudioEntity::s_pConversationPedSlot1)
        || &CAEPedSpeechAudioEntity::s_pConversationPed2->m_PedSpeechAudioEntity == this
        && (v7 = (unsigned __int16)this->m_PedSpeechSlotID,
            v7 == (unsigned __int16)CAEPedSpeechAudioEntity::s_pConversationPedSlot2) )
      {
        CAEPedSpeechAudioEntity::s_PedSpeechSlots[(__int16)v7].m_InUse = 4;
      }
    }
    else if ( CAEPedSpeechAudioEntity::s_bPlayerConversationHappening
           && &CAEPedSpeechAudioEntity::s_pPlayerConversationPed->m_PedSpeechAudioEntity == this
           && CAEPedSpeechAudioEntity::s_pConversationPedSlot1 == this->m_PedSpeechSlotID )
    {
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[CAEPedSpeechAudioEntity::s_pConversationPedSlot1].m_InUse = 4;
    }
    m_pGameEntity = this->m_pGameEntity;
    this->m_bForceAudible = 0;
    this->m_PedSpeechSlotID = -1;
    y = m_pGameEntity[18].m_transform.m_translate.y;
    if ( y != 0.0 && CTaskManager::GetTaskSecondary((const CTaskManager *)(LODWORD(y) + 4), 3) )
    {
      TaskSecondary = (CTaskComplexFacial *)CTaskManager::GetTaskSecondary(
                                              (const CTaskManager *)(LODWORD(this->m_pGameEntity[18].m_transform.m_translate.y)
                                                                   + 4),
                                              3);
      CTaskComplexFacial::StopAll(TaskSecondary);
    }
  }
  else
  {
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_InUse = 5;
    v8 = this->m_pGameEntity;
    if ( (BYTE1(v8[19].m_transform.m_heading) & 0x80) != 0 && LOBYTE(v8[31].m_pRwObject) == 2 )
    {
      CAESound::StopSound(pSound);
    }
    else if ( !this->m_bFrontEnd && v8 )
    {
      m_pMat = v8->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &v8->m_transform;
      v17.y = p_tx->m_translate.y;
      x = p_tx->m_translate.x;
      v17.z = p_tx->m_translate.z;
      v17.x = x;
      CAESound::SetPosition(pSound, v17);
    }
  }
  CMatrix::~CMatrix(&v16);
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
// 676D90: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot2;

//----- (0039BA04) --------------------------------------------------------
void CAEPedSpeechAudioEntity::Service()
{
  Int16 v0; // r6
  int v1; // r9
  char v2; // r10
  int m_InUse; // r0
  CAEPedSpeechSlot *v4; // r11
  CAEPedSpeechAudioEntity *m_pAudioEntity; // r0
  bool v6; // zf
  Bool8 v7; // r1

  v0 = 20;
  v1 = 0;
  v2 = 0;
  do
  {
    m_InUse = (unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse;
    v4 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1];
    if ( m_InUse != 1 )
      goto LABEL_6;
    if ( !CAEAudioHardware::IsSoundLoaded(
            &AEAudioHardware,
            CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_BankID,
            CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_SoundID,
            v0) )
    {
      m_InUse = (unsigned __int16)v4->m_InUse;
LABEL_6:
      if ( m_InUse != 2 )
        goto LABEL_10;
      goto LABEL_7;
    }
    v4->m_InUse = 2;
LABEL_7:
    if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_StartPlaybackTime > CTimer::m_snTimeInMilliseconds )
      goto LABEL_18;
    m_pAudioEntity = CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_pAudioEntity;
    if ( !m_pAudioEntity )
    {
      v4->m_InUse = 0;
      goto LABEL_18;
    }
    (*((void (__fastcall **)(CAEPedSpeechAudioEntity *))m_pAudioEntity->_vptr$CAEAudioEntity + 3))(m_pAudioEntity);
    m_InUse = (unsigned __int16)v4->m_InUse;
LABEL_10:
    v6 = m_InUse == 5;
    if ( m_InUse != 5 )
      v6 = m_InUse == 3;
    if ( v6 && CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_bForceAudible )
      v2 = 1;
LABEL_18:
    ++v1;
    ++v0;
  }
  while ( v1 != 6 );
  v7 = v2;
  if ( v2 )
    v7 = 1;
  CAEPedSpeechAudioEntity::s_bForceAudible = v7;
}

//----- (0039BAFC) --------------------------------------------------------
void CAEPedSpeechAudioEntity::Reset()
{
  int i; // r4
  uint32 v1; // r5

  for ( i = 0; i != 360; ++i )
  {
    v1 = CTimer::m_snTimeInMilliseconds;
    gGlobalSpeechContextNextPlayTime[i] = CAEAudioUtility::GetRandomNumberInRange(3000, 7000) + v1;
  }
  CAEPedSpeechAudioEntity::s_nCJMoodOverrideTime = 0;
}

//----- (0039BB50) --------------------------------------------------------
int CAEPedSpeechAudioEntity::ReservePedConversationSpeechSlots()
{
  Int16 m_InUse; // r0
  unsigned __int16 v1; // r2
  unsigned __int16 v2; // r3
  bool v3; // zf
  int result; // r0
  int v5; // r1

  m_InUse = CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse;
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse )
    m_InUse = -1;
  if ( !CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_InUse )
    m_InUse = 1;
  if ( !((unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse | (unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_InUse) )
  {
    m_InUse = 0;
    v1 = 1;
    goto LABEL_17;
  }
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[2].m_InUse )
  {
    v1 = m_InUse;
    goto LABEL_10;
  }
  v1 = 2;
  if ( (unsigned __int16)m_InUse != 0xFFFF )
  {
LABEL_17:
    v5 = m_InUse;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_InUse].m_ReservedForPedConversation = 1;
    CAEPedSpeechAudioEntity::s_pConversationPedSlot1 = m_InUse;
    result = 1;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_ReservedForPedConversation = 1;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[v5].m_InUse = 4;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse = 4;
    CAEPedSpeechAudioEntity::s_pConversationPedSlot2 = v1;
    return result;
  }
LABEL_10:
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[3].m_InUse )
  {
    v2 = v1;
  }
  else
  {
    v3 = v1 == 0xFFFF;
    m_InUse = v1;
    v2 = 3;
    v1 = 3;
    if ( !v3 )
      goto LABEL_17;
  }
  result = 0;
  if ( !CAEPedSpeechAudioEntity::s_PedSpeechSlots[4].m_InUse && v2 != 0xFFFF )
  {
    v1 = 4;
    m_InUse = v2;
    goto LABEL_17;
  }
  return result;
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
// 676D90: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot2;

//----- (0039BC34) --------------------------------------------------------
int CAEPedSpeechAudioEntity::ReservePlayerConversationSpeechSlot()
{
  int result; // r0
  unsigned __int16 v1; // r1

  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse )
  {
    if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_InUse )
    {
      if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[2].m_InUse )
      {
        if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[3].m_InUse )
        {
          if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[4].m_InUse )
            return 0;
          v1 = 4;
        }
        else
        {
          v1 = 3;
        }
      }
      else
      {
        v1 = 2;
      }
    }
    else
    {
      v1 = 1;
    }
  }
  else
  {
    v1 = 0;
  }
  CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_InUse = 4;
  result = 1;
  CAEPedSpeechAudioEntity::s_PedSpeechSlots[v1].m_ReservedForPlayerConversation = 1;
  CAEPedSpeechAudioEntity::s_pConversationPedSlot1 = v1;
  return result;
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;

//----- (0039BCCC) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::RequestPlayerConversation(CPed *pPed)
{
  Bool8 result; // r0
  unsigned __int16 v3; // r6

  if ( CAEPedSpeechAudioEntity::s_bAllSpeechDisabled
    || *(_WORD *)&pPed->m_PedSpeechAudioEntity.m_bSpeechDisabled
    || !FindPlayerPed(-1)
    || FindPlayerPed(-1)->m_PedSpeechAudioEntity.m_bSpeechDisabled
    || (FindPlayerPed(-1)->m_PedSpeechAudioEntity.m_bSpeechDisabledForScriptSpeech | CAEPedSpeechAudioEntity::s_bPedConversationHappening | CAEPedSpeechAudioEntity::s_bPlayerConversationHappening) << 24
    || CPed::GetPedTalking(pPed) )
  {
    return 0;
  }
  if ( !CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse )
  {
    v3 = 0;
    goto LABEL_18;
  }
  if ( !CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_InUse )
  {
    v3 = 1;
    goto LABEL_18;
  }
  if ( !CAEPedSpeechAudioEntity::s_PedSpeechSlots[2].m_InUse )
  {
    v3 = 2;
    goto LABEL_18;
  }
  if ( !CAEPedSpeechAudioEntity::s_PedSpeechSlots[3].m_InUse )
  {
    v3 = 3;
    goto LABEL_18;
  }
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[4].m_InUse )
    return 0;
  v3 = 4;
LABEL_18:
  CAEPedSpeechAudioEntity::s_PedSpeechSlots[v3].m_InUse = 4;
  result = 1;
  CAEPedSpeechAudioEntity::s_PedSpeechSlots[v3].m_ReservedForPlayerConversation = 1;
  CAEPedSpeechAudioEntity::s_bPlayerConversationHappening = 1;
  CAEPedSpeechAudioEntity::s_pConversationPedSlot1 = v3;
  CAEPedSpeechAudioEntity::s_pPlayerConversationPed = pPed;
  return result;
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;

//----- (0039BE00) --------------------------------------------------------
void CAEPedSpeechAudioEntity::ReleasePlayerConversation()
{
  int v0; // r0
  CAEPedSpeechSlot *v1; // r1
  Bool8 *p_m_ReservedForPlayerConversation; // r1

  if ( CAEPedSpeechAudioEntity::s_bPlayerConversationHappening )
  {
    v0 = CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
    if ( CAEPedSpeechAudioEntity::s_pConversationPedSlot1 <= -1 )
    {
      CAEPedSpeechAudioEntity::s_bPlayerConversationHappening = 0;
    }
    else
    {
      if ( (CAEPedSpeechAudioEntity::s_PedSpeechSlots[CAEPedSpeechAudioEntity::s_pConversationPedSlot1].m_InUse | 4) == 4 )
      {
        CAEPedSpeechAudioEntity::s_PedSpeechSlots[CAEPedSpeechAudioEntity::s_pConversationPedSlot1].m_InUse = 0;
        v1 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v0];
        v1->m_ReservedForPlayerConversation = 0;
        p_m_ReservedForPlayerConversation = &v1->m_ReservedForPlayerConversation;
        *(_DWORD *)(p_m_ReservedForPlayerConversation - 22) = 0;
        *(_DWORD *)(p_m_ReservedForPlayerConversation - 18) = 0;
        *((_WORD *)p_m_ReservedForPlayerConversation - 7) = -1;
        *((_WORD *)p_m_ReservedForPlayerConversation - 6) = -1;
        *(_DWORD *)(p_m_ReservedForPlayerConversation - 10) = 0;
        *((_WORD *)p_m_ReservedForPlayerConversation - 3) = -1;
        *((_DWORD *)p_m_ReservedForPlayerConversation - 1) = 0xFFFF;
      }
      else
      {
        p_m_ReservedForPlayerConversation = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[CAEPedSpeechAudioEntity::s_pConversationPedSlot1].m_ReservedForPlayerConversation;
      }
      *p_m_ReservedForPlayerConversation = 0;
      CAEPedSpeechAudioEntity::s_pConversationPedSlot1 = -1;
      CAEPedSpeechAudioEntity::s_pPlayerConversationPed = 0;
      CAEPedSpeechAudioEntity::s_bPlayerConversationHappening = 0;
    }
  }
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;

//----- (0039BEDC) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::RequestPedConversation(CPed *pPed1, CPed *pPed2)
{
  bool v4; // zf
  Bool8 result; // r0
  bool v6; // zf
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r1
  float x; // s0
  float y; // s4
  float z; // s2
  CMatrix *v13; // r0
  CSimpleTransform *v14; // r1
  Int16 m_InUse; // r0
  unsigned __int16 v16; // r8
  unsigned __int16 v17; // r3

  v4 = CAEPedSpeechAudioEntity::s_bAllSpeechDisabled == 0;
  if ( !CAEPedSpeechAudioEntity::s_bAllSpeechDisabled )
    v4 = pPed1->m_PedSpeechAudioEntity.m_bSpeechDisabledForScriptSpeech == 0;
  if ( !v4 )
    return 0;
  v6 = pPed1->m_PedSpeechAudioEntity.m_bSpeechDisabled == 0;
  if ( !pPed1->m_PedSpeechAudioEntity.m_bSpeechDisabled )
    v6 = pPed2->m_PedSpeechAudioEntity.m_bSpeechDisabledForScriptSpeech == 0;
  if ( !v6
    || (CAEPedSpeechAudioEntity::s_bPedConversationHappening | pPed2->m_PedSpeechAudioEntity.m_bSpeechDisabled | CAEPedSpeechAudioEntity::s_bPlayerConversationHappening) << 24
    || pPed1->m_PedSpeechAudioEntity.m_VoiceID == pPed2->m_PedSpeechAudioEntity.m_VoiceID
    || !CPed::CanPedHoldConversation(pPed1)
    || !CPed::CanPedHoldConversation(pPed2)
    || CPed::GetPedTalking(pPed1)
    || CPed::GetPedTalking(pPed2) )
  {
    return 0;
  }
  m_pMat = pPed1->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pPed1->m_transform;
  p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_m_transform = &TheCamera.m_transform;
  x = p_m_transform->m_translate.x;
  y = p_m_transform->m_translate.y;
  z = p_m_transform->m_translate.z;
  if ( (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                             * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                     + (float)((float)(p_tx->m_translate.y - y) * (float)(p_tx->m_translate.y - y)))
             + (float)((float)(p_tx->m_translate.z - z) * (float)(p_tx->m_translate.z - z))) > 1600.0 )
    return 0;
  v13 = pPed2->m_pMat;
  v14 = (CSimpleTransform *)&v13->tx;
  if ( !v13 )
    v14 = &pPed2->m_transform;
  if ( (float)((float)((float)((float)(v14->m_translate.x - x) * (float)(v14->m_translate.x - x))
                     + (float)((float)(v14->m_translate.y - y) * (float)(v14->m_translate.y - y)))
             + (float)((float)(v14->m_translate.z - z) * (float)(v14->m_translate.z - z))) > 1600.0 )
    return 0;
  m_InUse = CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse;
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse )
    m_InUse = -1;
  if ( !CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_InUse )
    m_InUse = 1;
  if ( !((unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse | (unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_InUse) )
  {
    m_InUse = 0;
    v16 = 1;
    goto LABEL_40;
  }
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[2].m_InUse )
  {
    v16 = m_InUse;
    goto LABEL_33;
  }
  v16 = 2;
  if ( (unsigned __int16)m_InUse != 0xFFFF )
  {
LABEL_40:
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_InUse].m_ReservedForPedConversation = 1;
    CAEPedSpeechAudioEntity::s_pConversationPed2 = pPed2;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[v16].m_ReservedForPedConversation = 1;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_InUse].m_InUse = 4;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[v16].m_InUse = 4;
    CAEPedSpeechAudioEntity::s_pConversationPed1 = pPed1;
    CAEPedSpeechAudioEntity::s_bPedConversationHappening = 1;
    CAEPedSpeechAudioEntity::s_pConversationPedSlot1 = m_InUse;
    CAEPedSpeechAudioEntity::s_pConversationPedSlot2 = v16;
    CAEPedSpeechAudioEntity::SetUpConversation();
    return 1;
  }
LABEL_33:
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[3].m_InUse )
  {
    v17 = v16;
  }
  else
  {
    v4 = v16 == 0xFFFF;
    m_InUse = v16;
    v17 = 3;
    v16 = 3;
    if ( !v4 )
      goto LABEL_40;
  }
  result = 0;
  if ( v17 != 0xFFFF && !CAEPedSpeechAudioEntity::s_PedSpeechSlots[4].m_InUse )
  {
    v16 = 4;
    m_InUse = v17;
    goto LABEL_40;
  }
  return result;
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
// 676D90: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot2;

//----- (0039C144) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetAllocatedVoice(CAEPedSpeechAudioEntity *this)
{
  return this->m_VoiceID;
}

//----- (0039C14C) --------------------------------------------------------
void CAEPedSpeechAudioEntity::SetUpConversation()
{
  Int16 v0; // r4
  Int16 v1; // r3
  int32 m_nPedType; // r0
  int32 v3; // r0
  __int16 RandomNumberInRange; // r0
  int v5; // r0
  __int16 v6; // r0
  Int16 v7; // r3
  Int16 v8; // r3
  int32 v9; // r0
  Int16 v10; // r1
  int32 v11; // r0
  bool v12; // zf
  Int16 v13; // r0
  Int16 v14; // r1
  __int16 v15; // r0
  Int16 v16; // r3
  Int16 v17; // r3
  int32 v18; // r0
  Int16 v19; // r1
  int32 v20; // r0
  __int16 v21; // r0
  Int16 v22; // r2

  v0 = 166;
  *(_DWORD *)&CAEPedSpeechAudioEntity::s_Conversation[2][0] = 0;
  *(_DWORD *)&CAEPedSpeechAudioEntity::s_Conversation[1][0] = 0;
  *(_DWORD *)&CAEPedSpeechAudioEntity::s_Conversation[3][0] = 0;
  v1 = 166;
  m_nPedType = CAEPedSpeechAudioEntity::s_pConversationPed2->m_nPedType;
  if ( m_nPedType == 5 )
    v0 = 165;
  if ( m_nPedType == 22 )
    v0 = 165;
  CAEPedSpeechAudioEntity::s_Conversation[0][0] = v0;
  v3 = CAEPedSpeechAudioEntity::s_pConversationPed1->m_nPedType;
  if ( v3 == 5 )
    v1 = 165;
  if ( v3 == 22 )
    v1 = 165;
  CAEPedSpeechAudioEntity::s_Conversation[0][1] = v1;
  RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(1, 10);
  if ( (unsigned int)RandomNumberInRange <= 0xA )
  {
    if ( ((1 << RandomNumberInRange) & 0x1E) != 0 )
    {
      CAEPedSpeechAudioEntity::s_ConversationLength = 3;
      v12 = (unsigned __int16)CAEAudioUtility::GetRandomNumberInRange(0, 1) == 0;
      v13 = 170;
      v14 = 161;
      if ( !v12 )
        v14 = 162;
      CAEPedSpeechAudioEntity::s_Conversation[1][1] = v14;
      if ( !v12 )
        v13 = 171;
      CAEPedSpeechAudioEntity::s_Conversation[1][0] = v13;
      CAEPedSpeechAudioEntity::s_Conversation[2][0] = 169;
      v15 = CAEAudioUtility::GetRandomNumberInRange(0, 2);
      v16 = 163;
      if ( v15 == 1 )
        v16 = 161;
      if ( !v15 )
        v16 = 162;
      CAEPedSpeechAudioEntity::s_Conversation[2][1] = v16;
      v17 = 168;
      v18 = CAEPedSpeechAudioEntity::s_pConversationPed2->m_nPedType;
      v19 = 168;
      if ( v18 == 5 )
        v17 = 167;
      if ( v18 == 22 )
        v17 = 167;
      CAEPedSpeechAudioEntity::s_Conversation[3][0] = v17;
      v20 = CAEPedSpeechAudioEntity::s_pConversationPed1->m_nPedType;
      if ( v20 == 5 )
        v19 = 167;
      if ( v20 == 22 )
        v19 = 167;
      CAEPedSpeechAudioEntity::s_Conversation[3][1] = v19;
    }
    else
    {
      v5 = 1 << RandomNumberInRange;
      if ( (v5 & 0x1E0) != 0 )
      {
        CAEPedSpeechAudioEntity::s_ConversationLength = 2;
        CAEAudioUtility::GetRandomNumberInRange(0, 1);
        CAEPedSpeechAudioEntity::s_Conversation[1][0] = 169;
        v6 = CAEAudioUtility::GetRandomNumberInRange(0, 2);
        v7 = 163;
        if ( v6 == 1 )
          v7 = 161;
        if ( !v6 )
          v7 = 162;
        CAEPedSpeechAudioEntity::s_Conversation[1][1] = v7;
        v8 = 168;
        v9 = CAEPedSpeechAudioEntity::s_pConversationPed2->m_nPedType;
        v10 = 168;
        if ( v9 == 5 )
          v8 = 167;
        if ( v9 == 22 )
          v8 = 167;
        CAEPedSpeechAudioEntity::s_Conversation[2][0] = v8;
        v11 = CAEPedSpeechAudioEntity::s_pConversationPed1->m_nPedType;
        if ( v11 == 5 )
          v10 = 167;
        if ( v11 == 22 )
          v10 = 167;
        CAEPedSpeechAudioEntity::s_Conversation[2][1] = v10;
      }
      else if ( (v5 & 0x600) != 0 )
      {
        CAEPedSpeechAudioEntity::s_ConversationLength = 1;
        v21 = CAEAudioUtility::GetRandomNumberInRange(0, 1);
        v22 = 170;
        if ( v21 )
          v22 = 171;
        CAEPedSpeechAudioEntity::s_Conversation[1][0] = v22;
        CAEPedSpeechAudioEntity::s_Conversation[1][1] = 164;
      }
    }
  }
}
// 0: using guessed type int dword_0;

//----- (0039C320) --------------------------------------------------------
void CAEPedSpeechAudioEntity::ReleasePedConversation()
{
  Int16 v0; // r0
  Int16 v1; // r1
  unsigned int m_InUse; // r3
  int v3; // r1
  CAEPedSpeechSlot *v4; // r1
  unsigned int v5; // r2
  int v6; // r0
  CAEPedSpeechSlot *v7; // r0

  if ( CAEPedSpeechAudioEntity::s_bPedConversationHappening )
  {
    v0 = CAEPedSpeechAudioEntity::s_pConversationPedSlot2;
    if ( (__int16)(CAEPedSpeechAudioEntity::s_pConversationPedSlot2 | CAEPedSpeechAudioEntity::s_pConversationPedSlot1) <= -1 )
    {
      CAEPedSpeechAudioEntity::s_bPedConversationHappening = 0;
    }
    else
    {
      v1 = CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
      m_InUse = CAEPedSpeechAudioEntity::s_PedSpeechSlots[CAEPedSpeechAudioEntity::s_pConversationPedSlot1].m_InUse;
      if ( m_InUse <= 5 && ((1 << m_InUse) & 0x2E) != 0 )
      {
        CAEPedSpeechAudioEntity::StopCurrentSpeech(CAEPedSpeechAudioEntity::s_PedSpeechSlots[CAEPedSpeechAudioEntity::s_pConversationPedSlot1].m_pAudioEntity);
        v0 = CAEPedSpeechAudioEntity::s_pConversationPedSlot2;
        v1 = CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
      }
      v3 = v1;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[v3].m_InUse = 0;
      v4 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v3];
      v4->m_pAudioEntity = 0;
      v4->m_pSound = 0;
      v4->m_SoundID = -1;
      v4->m_BankID = -1;
      v4->m_StartPlaybackTime = 0;
      v4->m_GlobalSpeechContext = -1;
      v4->m_PedType = -1;
      v4->m_ReservedForPlayerConversation = 0;
      *(_WORD *)&v4->m_bForceAudible = 0;
      v5 = CAEPedSpeechAudioEntity::s_PedSpeechSlots[v0].m_InUse;
      if ( v5 <= 5 && ((1 << v5) & 0x2E) != 0 )
      {
        CAEPedSpeechAudioEntity::StopCurrentSpeech(CAEPedSpeechAudioEntity::s_PedSpeechSlots[v0].m_pAudioEntity);
        v0 = CAEPedSpeechAudioEntity::s_pConversationPedSlot2;
      }
      v6 = v0;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[v6].m_InUse = 0;
      v7 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v6];
      v7->m_pAudioEntity = 0;
      v7->m_pSound = 0;
      v7->m_SoundID = -1;
      v7->m_BankID = -1;
      v7->m_StartPlaybackTime = 0;
      v7->m_GlobalSpeechContext = -1;
      v7->m_PedType = -1;
      v7->m_ReservedForPlayerConversation = 0;
      *(_WORD *)&v7->m_bForceAudible = 0;
      CAEPedSpeechAudioEntity::s_pConversationPed1 = 0;
      CAEPedSpeechAudioEntity::s_bPedConversationHappening = 0;
      CAEPedSpeechAudioEntity::s_pConversationPed2 = 0;
      CAEPedSpeechAudioEntity::s_pConversationPedSlot1 = -1;
      CAEPedSpeechAudioEntity::s_pConversationPedSlot2 = -1;
    }
  }
}
// 676364: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot1;
// 676D90: using guessed type __int16 *CAEPedSpeechAudioEntity::s_pConversationPedSlot2;

//----- (0039C4C0) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetAudioPedType(unsigned __int8 *pString)
{
  int v2; // r0
  Int16 v3; // r1

  if ( !strcmp((const char *)pString, (const char *)aAudioPedTypeNames[0]) )
    return 0;
  if ( !strcmp((const char *)pString, (const char *)aAudioPedTypeNames[1]) )
    return 1;
  if ( !strcmp((const char *)pString, (const char *)aAudioPedTypeNames[2]) )
    return 2;
  if ( !strcmp((const char *)pString, (const char *)aAudioPedTypeNames[3]) )
    return 3;
  if ( !strcmp((const char *)pString, (const char *)aAudioPedTypeNames[4]) )
    return 4;
  v2 = strcmp((const char *)pString, (const char *)aAudioPedTypeNames[5]);
  v3 = -1;
  if ( !v2 )
    return 5;
  return v3;
}

//----- (0039C560) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetVoice(unsigned __int8 *pString, Int16 AudioPedType)
{
  int v3; // r6
  const char *v4; // r5
  bool v5; // cc
  const char *v6; // r5
  const char *v7; // r5

  LOWORD(v3) = -1;
  switch ( AudioPedType )
  {
    case 0:
      v3 = 0;
      v4 = (const char *)gGenSpeechVoiceLookup;
      while ( strcmp((const char *)pString, v4) )
      {
        v4 += 20;
        v5 = v3++ < 208;
        if ( !v5 )
          goto LABEL_35;
      }
      break;
    case 1:
      v3 = 0;
      v6 = (const char *)gEmgSpeechVoiceLookup;
      while ( strcmp((const char *)pString, v6) )
      {
        v6 += 20;
        v5 = v3++ < 45;
        if ( !v5 )
          goto LABEL_35;
      }
      break;
    case 2:
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup) )
        goto LABEL_56;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[1]) )
        goto LABEL_57;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[2]) )
        goto LABEL_58;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[3]) )
        goto LABEL_59;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[4]) )
        goto LABEL_60;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[5]) )
        goto LABEL_61;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[6]) )
        goto LABEL_62;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[7]) )
        goto LABEL_63;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[8]) )
        goto LABEL_64;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[9]) )
        goto LABEL_65;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[10]) )
        goto LABEL_66;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[11]) )
        goto LABEL_67;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[12]) )
        goto LABEL_68;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[13]) )
        goto LABEL_69;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[14]) )
        goto LABEL_70;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[15]) )
        goto LABEL_71;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[16]) )
        goto LABEL_72;
      if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[17]) )
      {
        LOWORD(v3) = 17;
      }
      else if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[18]) )
      {
        LOWORD(v3) = 18;
      }
      else if ( !strcmp((const char *)pString, (const char *)gPlySpeechVoiceLookup[19]) )
      {
        LOWORD(v3) = 19;
      }
      break;
    case 3:
      v3 = 0;
      v7 = (const char *)gGngSpeechVoiceLookup;
      while ( strcmp((const char *)pString, v7) )
      {
        v7 += 20;
        v5 = v3++ < 51;
        if ( !v5 )
          goto LABEL_35;
      }
      break;
    case 4:
      if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup) )
      {
LABEL_56:
        LOWORD(v3) = 0;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[1]) )
      {
LABEL_57:
        LOWORD(v3) = 1;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[2]) )
      {
LABEL_58:
        LOWORD(v3) = 2;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[3]) )
      {
LABEL_59:
        LOWORD(v3) = 3;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[4]) )
      {
LABEL_60:
        LOWORD(v3) = 4;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[5]) )
      {
LABEL_61:
        LOWORD(v3) = 5;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[6]) )
      {
LABEL_62:
        LOWORD(v3) = 6;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[7]) )
      {
LABEL_63:
        LOWORD(v3) = 7;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[8]) )
      {
LABEL_64:
        LOWORD(v3) = 8;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[9]) )
      {
LABEL_65:
        LOWORD(v3) = 9;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[10]) )
      {
LABEL_66:
        LOWORD(v3) = 10;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[11]) )
      {
LABEL_67:
        LOWORD(v3) = 11;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[12]) )
      {
LABEL_68:
        LOWORD(v3) = 12;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[13]) )
      {
LABEL_69:
        LOWORD(v3) = 13;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[14]) )
      {
LABEL_70:
        LOWORD(v3) = 14;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[15]) )
      {
LABEL_71:
        LOWORD(v3) = 15;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[16]) )
      {
LABEL_72:
        LOWORD(v3) = 16;
      }
      else if ( !strcmp((const char *)pString, (const char *)gGfdSpeechVoiceLookup[17]) )
      {
        LOWORD(v3) = 17;
      }
      break;
    default:
LABEL_35:
      LOWORD(v3) = -1;
      break;
  }
  return v3;
}

//----- (0039CA18) --------------------------------------------------------
void CAEPedSpeechAudioEntity::DisableAllPedSpeech()
{
  CAEPedSpeechAudioEntity::s_bAllSpeechDisabled = 1;
}

//----- (0039CA28) --------------------------------------------------------
void CAEPedSpeechAudioEntity::EnableAllPedSpeech()
{
  CAEPedSpeechAudioEntity::s_bAllSpeechDisabled = 0;
}

//----- (0039CA38) --------------------------------------------------------
int CAEPedSpeechAudioEntity::GetCurrentCJMood()
{
  UInt32 v0; // r9
  CPlayerPed *PlayerPed; // r11
  int v2; // r8
  int result; // r0
  CPlayerPed *v4; // r0
  int v5; // r0
  int v6; // r10
  int v7; // r4
  int v8; // r6
  CPedGroupMembership *p_m_membership; // r5
  CPed *Member; // r0
  int m_VoiceID; // r1
  bool v12; // zf
  _BOOL4 IsCJDressedInForGangSpeech; // r5
  float StatValue; // r0
  float v15; // r5
  int v16; // r1
  int m_WantedLevel; // r0
  Int16 v18; // r0
  int v19; // r2

  v0 = CTimer::m_snTimeInMilliseconds;
  PlayerPed = FindPlayerPed(-1);
  if ( !PlayerPed )
    return 5;
  v2 = CStats::GetStatValue(0x42u) >= 650.0 && CStats::GetStatValue(0xEu) >= 10000.0;
  v4 = FindPlayerPed(-1);
  v5 = CPedGroupMembership::CountMembersExcludingLeader(&CPedGroups::ms_groups[v4->m_pPlayerData->m_PlayerGroup].m_membership) << 16;
  v6 = 1;
  v7 = 1;
  if ( v5 <= 0x10000 )
  {
    if ( v5 == 0x10000 )
    {
      v8 = 0;
      v7 = 0;
      p_m_membership = &CPedGroups::ms_groups[FindPlayerPed(-1)->m_pPlayerData->m_PlayerGroup].m_membership;
      do
      {
        Member = CPedGroupMembership::GetMember(p_m_membership, v8);
        if ( Member )
        {
          if ( Member->m_nPedType == 8 )
          {
            v7 = 1;
          }
          else
          {
            m_VoiceID = (unsigned __int16)Member->m_PedSpeechAudioEntity.m_VoiceID;
            v12 = m_VoiceID == 37;
            if ( m_VoiceID != 37 )
              v12 = m_VoiceID == 32;
            if ( (v12 || m_VoiceID == 26) && Member->m_PedSpeechAudioEntity.m_PedType == 3 )
              v7 = 1;
          }
        }
        ++v8;
      }
      while ( v8 != 8 );
    }
    else
    {
      v7 = 0;
    }
  }
  IsCJDressedInForGangSpeech = CAEPedSpeechAudioEntity::IsCJDressedInForGangSpeech();
  StatValue = CStats::GetStatValue(0x15u);
  if ( !IsCJDressedInForGangSpeech )
    v6 = v7;
  v16 = 0;
  if ( StatValue >= 600.0 )
  {
    v15 = CStats::GetStatValue(0x17u);
    if ( v15 < (float)(CStats::GetStatValue(0x15u) + -200.0) )
      v16 = 1;
  }
  m_WantedLevel = PlayerPed->m_pPlayerData->m_Wanted->m_WantedLevel;
  if ( m_WantedLevel <= 3 )
  {
    if ( m_WantedLevel <= 1 )
    {
      if ( CTheScripts::LastMissionPassedTime != -1 )
      {
        if ( v0 >= CTheScripts::LastMissionPassedTime )
        {
          v18 = 5;
          if ( v0 < CTheScripts::LastMissionPassedTime + 180000 )
            v18 = 9;
          goto LABEL_37;
        }
        CTheScripts::LastMissionPassedTime = v0;
      }
      v18 = 5;
    }
    else
    {
      v18 = 1;
    }
  }
  else
  {
    v18 = 7;
  }
LABEL_37:
  if ( CAEPedSpeechAudioEntity::s_nCJMoodOverrideTime > v0 )
  {
    if ( (unsigned __int16)CAEPedSpeechAudioEntity::s_nCJWellDressed != 0xFFFF )
      v2 = (unsigned __int16)CAEPedSpeechAudioEntity::s_nCJWellDressed;
    if ( (unsigned __int16)CAEPedSpeechAudioEntity::s_nCJFat != 0xFFFF )
      v16 = (unsigned __int16)CAEPedSpeechAudioEntity::s_nCJFat;
    if ( (unsigned __int16)CAEPedSpeechAudioEntity::s_nCJGangBanging != 0xFFFF )
      v6 = (unsigned __int16)CAEPedSpeechAudioEntity::s_nCJGangBanging;
    if ( (unsigned __int16)CAEPedSpeechAudioEntity::s_nCJBasicMood != 0xFFFF )
      v18 = CAEPedSpeechAudioEntity::s_nCJBasicMood;
  }
  v19 = v18 - 1;
  result = 5;
  switch ( v19 )
  {
    case 0:
      result = v6 << 24 == 0;
      break;
    case 4:
      if ( v6 << 24 )
      {
        result = 4;
      }
      else if ( v16 << 24 )
      {
        result = 3;
      }
      else
      {
        result = 2;
        if ( !(v2 << 24) )
          result = 5;
      }
      break;
    case 6:
      result = 6;
      if ( !(v6 << 24) )
        result = 7;
      break;
    case 8:
      result = 8;
      if ( !(v6 << 24) )
        result = 9;
      break;
    default:
      return result;
  }
  return result;
}

//----- (0039CCAC) --------------------------------------------------------
bool CAEPedSpeechAudioEntity::IsCJDressedInForGangSpeech()
{
  int v0; // r4
  CPlayerPed *PlayerPed; // r0
  CMatrix *m_pMat; // r2
  CPedClothesDesc *m_pClothes; // r1
  CVector *p_tx; // r3
  uint32 v5; // r5
  uint32 v6; // r6
  __int64 v7; // kr00_8

  v0 = 0;
  PlayerPed = FindPlayerPed(0);
  if ( PlayerPed )
  {
    m_pMat = PlayerPed->m_pMat;
    m_pClothes = PlayerPed->m_pPlayerData->m_pClothes;
    p_tx = (CVector *)&m_pMat->tx;
    v5 = m_pClothes->texturesKeyArray[0];
    v6 = m_pClothes->texturesKeyArray[2];
    v7 = *(_QWORD *)&m_pClothes->texturesKeyArray[15];
    if ( !m_pMat )
      p_tx = &PlayerPed->m_transform.m_translate;
    if ( CGameLogic::FindCityClosestToPoint(*p_tx) == 1 )
      return v5 == CKeyGen::GetUppercaseKey("hoodyagreen")
          || v5 == CKeyGen::GetUppercaseKey("shirtbgang")
          || v6 == CKeyGen::GetUppercaseKey("tracktrgang")
          || v6 == CKeyGen::GetUppercaseKey("denimsgang")
          || HIDWORD(v7) == CKeyGen::GetUppercaseKey("bandgang")
          || HIDWORD(v7) == CKeyGen::GetUppercaseKey("hockey")
          || HIDWORD(v7) == CKeyGen::GetUppercaseKey("capgang")
          || HIDWORD(v7) == CKeyGen::GetUppercaseKey("capgangback")
          || HIDWORD(v7) == CKeyGen::GetUppercaseKey("capgangside")
          || HIDWORD(v7) == CKeyGen::GetUppercaseKey("capgangover")
          || HIDWORD(v7) == CKeyGen::GetUppercaseKey("capgangup")
          || (_DWORD)v7 == CKeyGen::GetUppercaseKey("bandred3")
          || (_DWORD)v7 == CKeyGen::GetUppercaseKey("bandblue3")
          || (_DWORD)v7 == CKeyGen::GetUppercaseKey("bandgang3")
          || (_DWORD)v7 == CKeyGen::GetUppercaseKey("bandblack3");
    else
      return 0;
  }
  return v0;
}

//----- (0039CE3C) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::SetCJMood(
        unsigned int nBasicMood,
        UInt32 nTimeInMilliseconds,
        Int16 nGangBanging,
        Int16 nFat,
        Int16 a5)
{
  Int16 v5; // lr

  CAEPedSpeechAudioEntity::s_nCJMoodOverrideTime = nTimeInMilliseconds + CTimer::m_snTimeInMilliseconds;
  v5 = -1;
  if ( nBasicMood <= 9 && ((1 << nBasicMood) & 0x2A2) != 0 )
    v5 = nBasicMood;
  CAEPedSpeechAudioEntity::s_nCJGangBanging = nGangBanging;
  CAEPedSpeechAudioEntity::s_nCJBasicMood = v5;
  CAEPedSpeechAudioEntity::s_nCJFat = nFat;
  CAEPedSpeechAudioEntity::s_nCJWellDressed = a5;
}

//----- (0039CEB8) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::Initialise(CAEPedSpeechAudioEntity *this, CEntity *pPed)
{
  Int16 *p_m_bFemale; // r6
  UInt32 *v4; // r0
  int m_nModelIndex; // r10
  CPedModelInfo *v6; // r0
  unsigned int m_AudioPedType; // r1
  int v8; // r4
  uint32 m_hashKey; // r11
  const unsigned __int8 *v10; // r5
  int v11; // r0
  int m_NextVoice; // r1
  Int16 (*v14)[3]; // r2
  int v15; // r1
  int v16; // r0
  bool v17; // zf
  Int16 v18; // r1
  CBaseModelInfo *v19; // r0
  unsigned int v20; // r1
  int v21; // r0
  bool v22; // zf
  __int16 v23; // r0

  *(_DWORD *)&this->m_bFemale = 0;
  p_m_bFemale = &this->m_bFemale;
  this->m_bForceAudible = 0;
  *(_WORD *)&this->m_bSpeechDisabledForScriptSpeech = 0;
  this->m_pSound = 0;
  this->m_pGameEntity = pPed;
  this->m_fEventVolume = -100.0;
  v4 = &this->m_NextTimeCanSayPain[15];
  this->m_LastUsedGlobalSpeechContext = -1;
  *(_QWORD *)v4 = 0LL;
  *((_QWORD *)v4 + 1) = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[12] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[14] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[8] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[10] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[4] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[6] = 0LL;
  *(_QWORD *)this->m_NextTimeCanSayPain = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[2] = 0LL;
  m_nModelIndex = pPed->m_nModelIndex;
  if ( m_nModelIndex < 0 )
    return;
  v6 = (CPedModelInfo *)CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
  m_AudioPedType = (unsigned __int16)v6->m_AudioPedType;
  this->m_PedType = m_AudioPedType;
  if ( m_AudioPedType > 5 )
    return;
  if ( m_AudioPedType != 5 )
  {
    m_NextVoice = v6->m_NextVoice;
    this->m_VoiceID = m_NextVoice;
    if ( m_NextVoice < 0 )
      return;
    CPedModelInfo::IncrementVoice(v6);
    goto LABEL_16;
  }
  v8 = 0;
  m_hashKey = v6->m_hashKey;
  v10 = gSpecialPedVoiceNameLookup[0];
  do
  {
    if ( CKeyGen::GetUppercaseKey(v10) == m_hashKey )
    {
      v11 = v8;
      goto LABEL_12;
    }
    v11 = v8 + 1;
    v10 += 20;
  }
  while ( v8++ < 44 );
  if ( (unsigned __int16)v11 == 45 )
    return;
LABEL_12:
  v14 = gSpecialPedVoiceLookup;
  v15 = v11;
  v16 = (unsigned __int16)gSpecialPedVoiceLookup[v11][0];
  v17 = v16 == 0xFFFF;
  if ( v16 != 0xFFFF )
  {
    v14 = (Int16 (*)[3])(unsigned __int16)gSpecialPedVoiceLookup[v15][1];
    v17 = v14 == (Int16 (*)[3])((char *)&elf_hash_bucket[16320] + 3);
  }
  if ( !v17 )
  {
    v18 = LOBYTE(gSpecialPedVoiceLookup[v15][2]);
    this->m_PedType = (__int16)v14;
    this->m_VoiceID = v16;
    this->m_bFemale = v18;
LABEL_16:
    v19 = CModelInfo::ms_modelInfoPtrs[m_nModelIndex];
    v20 = *(unsigned __int16 *)&v19[1].m_modelName[20];
    if ( v20 <= 5 )
    {
      if ( v20 != 5 )
      {
        v21 = *(_DWORD *)v19[1].m_modelName;
        v22 = v21 == 22;
        if ( v21 != 22 )
          v22 = v21 == 5;
        v23 = v22;
        *p_m_bFemale = v23;
      }
      this->b_Initialised = 1;
    }
  }
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0039CFF0) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::GetVoiceAndTypeFromModel(CAEPedSpeechAudioEntity *this, Int32 iModel)
{
  CPedModelInfo *v3; // r0
  unsigned int m_AudioPedType; // r1
  Bool8 result; // r0
  int v6; // r4
  uint32 m_hashKey; // r6
  const unsigned __int8 *v8; // r5
  int v9; // r0
  int m_NextVoice; // r1
  int v12; // r2
  Int16 (*v13)[3]; // r3
  int v14; // r1
  bool v15; // zf
  Int16 v16; // r0

  v3 = (CPedModelInfo *)CModelInfo::ms_modelInfoPtrs[iModel];
  m_AudioPedType = (unsigned __int16)v3->m_AudioPedType;
  this->m_PedType = m_AudioPedType;
  if ( m_AudioPedType > 5 )
    return 0;
  if ( m_AudioPedType != 5 )
  {
    m_NextVoice = v3->m_NextVoice;
    this->m_VoiceID = m_NextVoice;
    if ( m_NextVoice < 0 )
      return 0;
    CPedModelInfo::IncrementVoice(v3);
    return 1;
  }
  v6 = 0;
  m_hashKey = v3->m_hashKey;
  v8 = gSpecialPedVoiceNameLookup[0];
  do
  {
    if ( CKeyGen::GetUppercaseKey(v8) == m_hashKey )
    {
      v9 = v6;
      goto LABEL_12;
    }
    v9 = v6 + 1;
    v8 += 20;
  }
  while ( v6++ < 44 );
  if ( (unsigned __int16)v9 == 45 )
    return 0;
LABEL_12:
  v12 = v9;
  result = 0;
  v13 = gSpecialPedVoiceLookup;
  v14 = (unsigned __int16)gSpecialPedVoiceLookup[v12][0];
  v15 = v14 == 0xFFFF;
  if ( v14 != 0xFFFF )
  {
    v13 = (Int16 (*)[3])(unsigned __int16)gSpecialPedVoiceLookup[v12][1];
    v15 = v13 == (Int16 (*)[3])((char *)&elf_hash_bucket[16320] + 3);
  }
  if ( !v15 )
  {
    v16 = LOBYTE(gSpecialPedVoiceLookup[v12][2]);
    this->m_PedType = (__int16)v13;
    this->m_VoiceID = v14;
    this->m_bFemale = v16;
    return 1;
  }
  return result;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0039D0A8) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::GetSexFromModel(CAEPedSpeechAudioEntity *this, Int32 iModel)
{
  CBaseModelInfo *v2; // r1
  unsigned int v3; // r2
  int v5; // r1
  bool v6; // zf
  Int16 v7; // r1

  v2 = CModelInfo::ms_modelInfoPtrs[iModel];
  v3 = *(unsigned __int16 *)&v2[1].m_modelName[20];
  if ( v3 > 5 )
    return 0;
  if ( v3 != 5 )
  {
    v5 = *(_DWORD *)v2[1].m_modelName;
    v6 = v5 == 22;
    if ( v5 != 22 )
      v6 = v5 == 5;
    v7 = v6;
    this->m_bFemale = v7;
  }
  return 1;
}

//----- (0039D0DC) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::Terminate(CAEPedSpeechAudioEntity *this)
{
  CAEPedSpeechAudioEntity::StopCurrentSpeech(this);
  this->b_Initialised = 0;
  this->m_pGameEntity = 0;
  *(_DWORD *)&this->m_PedType = -1;
  this->m_bPlayingSpeech = 0;
  this->m_bSpeechDisabled = 0;
  this->m_bSpeechDisabledForScriptSpeech = 0;
  *(_QWORD *)&this->m_pSound = 0xFFFFFFFF00000000LL;
  this->m_PedSpeechSlotID = -1;
  this->m_fEventVolume = -100.0;
}

//----- (0039D11A) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::GetPedTalking(CAEPedSpeechAudioEntity *this)
{
  if ( this->b_Initialised )
    return this->m_bPlayingSpeech;
  else
    return 0;
}

//----- (0039D12A) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::DisablePedSpeech(CAEPedSpeechAudioEntity *this, Int16 Curtail)
{
  bool v2; // zf

  v2 = this->b_Initialised == 0;
  if ( this->b_Initialised )
  {
    this->m_bSpeechDisabled = 1;
    v2 = Curtail == 0;
  }
  if ( !v2 )
    CAEPedSpeechAudioEntity::StopCurrentSpeech(this);
}

//----- (0039D140) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::EnablePedSpeech(CAEPedSpeechAudioEntity *this)
{
  if ( this->b_Initialised )
    this->m_bSpeechDisabled = 0;
}

//----- (0039D150) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::DisablePedSpeechForScriptSpeech(CAEPedSpeechAudioEntity *this, Int16 Curtail)
{
  bool v2; // zf

  v2 = this->b_Initialised == 0;
  if ( this->b_Initialised )
  {
    this->m_bSpeechDisabledForScriptSpeech = 1;
    v2 = Curtail == 0;
  }
  if ( !v2 )
    CAEPedSpeechAudioEntity::StopCurrentSpeech(this);
}

//----- (0039D166) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::EnablePedSpeechForScriptSpeech(CAEPedSpeechAudioEntity *this)
{
  if ( this->b_Initialised )
    this->m_bSpeechDisabledForScriptSpeech = 0;
}

//----- (0039D178) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::CanPedHoldConversation(CAEPedSpeechAudioEntity *this)
{
  unsigned int m_PedType; // r12
  __int16 v2; // r2
  int v3; // r1
  int v4; // r4
  int v5; // r2
  Bool8 result; // r0
  int m_VoiceID; // r0
  __int16 (*v8)[2]; // r1
  __int16 v9; // r4
  __int16 (**v10)[3128]; // r1

  if ( this->b_Initialised )
  {
    m_PedType = this->m_PedType;
    if ( m_PedType <= 5 )
    {
      v2 = 0;
      while ( 1 )
      {
        v3 = v2;
        v4 = (unsigned __int16)gSpeechContextLookup[v2][0];
        if ( v4 == 0xFFFF )
          break;
        ++v2;
        if ( v4 == 169 )
        {
          v5 = gSpeechContextLookup[v3][m_PedType + 1];
          if ( v5 < 0 )
            return 0;
          switch ( this->m_PedType )
          {
            case 0:
              if ( gGenSpeechLookup[(__int16)v5][this->m_VoiceID][0] == 255 )
                return 0;
              goto LABEL_9;
            case 1:
              v9 = 184;
              v10 = &gEmgSpeechLookup_ptr;
              goto LABEL_13;
            case 2:
              m_VoiceID = this->m_VoiceID;
              v8 = gPlySpeechLookup[v5];
              goto LABEL_14;
            case 3:
              v9 = 208;
              v10 = (__int16 (**)[3128])&gGngSpeechLookup_ptr;
LABEL_13:
              m_VoiceID = this->m_VoiceID;
              v8 = (__int16 (*)[2])((char *)*v10 + (__int16)v5 * v9);
LABEL_14:
              if ( (unsigned __int16)v8[m_VoiceID][0] == 0xFFFF )
                return 0;
LABEL_9:
              result = 1;
              break;
            default:
              return 0;
          }
          return result;
        }
      }
    }
  }
  return 0;
}
// 6792CC: using guessed type __int16 (*gEmgSpeechLookup_ptr)[3128];
// 6796B8: using guessed type __int16 (*gGngSpeechLookup_ptr)[11648];

//----- (0039D240) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::CanPedSayGlobalContext(CAEPedSpeechAudioEntity *this, Int16 GlobalContext)
{
  int m_PedType; // r12
  __int16 v3; // r3
  int v4; // r2
  int v5; // r5
  bool v6; // zf
  int v7; // r1
  Bool8 result; // r0
  __int16 v9; // r3
  __int16 (**v10)[3128]; // r2
  int m_VoiceID; // r0
  __int16 (*v12)[2]; // r1

  if ( !this->b_Initialised )
    return 0;
  if ( (unsigned __int16)((unsigned __int16)GlobalContext >> 3) > 0x2Cu )
    return 0;
  m_PedType = this->m_PedType;
  if ( (unsigned __int16)m_PedType > 5u )
    return 0;
  v3 = 0;
  do
  {
    v4 = v3;
    v5 = (unsigned __int16)gSpeechContextLookup[v3][0];
    v6 = v5 == 0xFFFF;
    if ( v5 != 0xFFFF )
    {
      ++v3;
      v6 = v5 == (unsigned __int16)GlobalContext;
    }
  }
  while ( !v6 );
  if ( v5 == 0xFFFF )
    return 0;
  v7 = gSpeechContextLookup[v4][m_PedType + 1];
  if ( v7 < 0 )
    return 0;
  switch ( this->m_PedType )
  {
    case 0:
      if ( gGenSpeechLookup[(__int16)v7][this->m_VoiceID][0] == 255 )
        return 0;
      goto LABEL_13;
    case 1:
      v9 = 184;
      v10 = &gEmgSpeechLookup_ptr;
      goto LABEL_17;
    case 2:
      m_VoiceID = this->m_VoiceID;
      v12 = gPlySpeechLookup[v7];
      goto LABEL_18;
    case 3:
      v9 = 208;
      v10 = (__int16 (**)[3128])&gGngSpeechLookup_ptr;
LABEL_17:
      m_VoiceID = this->m_VoiceID;
      v12 = (__int16 (*)[2])((char *)*v10 + (__int16)v7 * v9);
LABEL_18:
      if ( (unsigned __int16)v12[m_VoiceID][0] == 0xFFFF )
        return 0;
LABEL_13:
      result = 1;
      break;
    default:
      return 0;
  }
  return result;
}
// 6792CC: using guessed type __int16 (*gEmgSpeechLookup_ptr)[3128];
// 6796B8: using guessed type __int16 (*gGngSpeechLookup_ptr)[11648];

//----- (0039D320) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetSpecificSpeechContext(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalSpeechContext,
        Int16 m_PedType)
{
  unsigned int v3; // r0
  Int16 v4; // r12
  bool v5; // cc
  __int16 v6; // r3
  int v7; // r0
  int v8; // r1
  int v9; // r4
  bool v10; // zf

  v3 = (unsigned __int16)GlobalSpeechContext >> 3;
  v4 = -1;
  v5 = v3 > 0x2C;
  if ( v3 <= 0x2C )
    v5 = (unsigned __int16)m_PedType > 5u;
  if ( !v5 )
  {
    v6 = 0;
    v7 = (unsigned __int16)GlobalSpeechContext;
    do
    {
      v8 = v6;
      v9 = (unsigned __int16)gSpeechContextLookup[v6][0];
      v10 = v9 == 0xFFFF;
      if ( v9 != 0xFFFF )
      {
        ++v6;
        v10 = v9 == v7;
      }
    }
    while ( !v10 );
    if ( v9 != 0xFFFF )
      return gSpeechContextLookup[v8][m_PedType + 1];
  }
  return v4;
}

//----- (0039D378) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::WillPedChatAboutTopic(CAEPedSpeechAudioEntity *this, Int16 ConversationTopic)
{
  int v2; // r3
  Int16 v3; // r1
  Bool8 result; // r0

  v2 = ConversationTopic;
  v3 = 48;
  switch ( v2 )
  {
    case 0:
      goto LABEL_5;
    case 1:
      v3 = 49;
      goto LABEL_5;
    case 2:
      v3 = 50;
      goto LABEL_5;
    case 3:
      v3 = 51;
      goto LABEL_5;
    case 4:
      v3 = 52;
      goto LABEL_5;
    case 5:
      v3 = 53;
      goto LABEL_5;
    case 6:
      v3 = 54;
      goto LABEL_5;
    case 7:
      v3 = 55;
LABEL_5:
      result = CAEPedSpeechAudioEntity::CanPedSayGlobalContext(this, v3);
      break;
    case 8:
    case 9:
      result = 1;
      break;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (0039D3BA) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetPedType(CAEPedSpeechAudioEntity *this)
{
  if ( this->b_Initialised )
    return this->m_PedType;
  else
    return -1;
}

//----- (0039D3CE) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::IsPedFemaleForAudio(CAEPedSpeechAudioEntity *this)
{
  if ( this->b_Initialised )
    return this->m_bFemale;
  else
    return 0;
}

//----- (0039D3E0) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::GetVoiceAndTypeForSpecialPed(CAEPedSpeechAudioEntity *this, uint32 HashKey)
{
  int v4; // r4
  const unsigned __int8 *v5; // r6
  int v6; // r0
  Bool8 result; // r0
  int v9; // r2
  Int16 (*v10)[3]; // r3
  int v11; // r1
  bool v12; // zf
  Int16 v13; // r0

  v4 = 0;
  v5 = gSpecialPedVoiceNameLookup[0];
  do
  {
    if ( CKeyGen::GetUppercaseKey(v5) == HashKey )
    {
      v6 = v4;
      goto LABEL_7;
    }
    v6 = v4 + 1;
    v5 += 20;
  }
  while ( v4++ < 44 );
  if ( (unsigned __int16)v6 == 45 )
    return 0;
LABEL_7:
  v9 = v6;
  result = 0;
  v10 = gSpecialPedVoiceLookup;
  v11 = (unsigned __int16)gSpecialPedVoiceLookup[v9][0];
  v12 = v11 == 0xFFFF;
  if ( v11 != 0xFFFF )
  {
    v10 = (Int16 (*)[3])(unsigned __int16)gSpecialPedVoiceLookup[v9][1];
    v12 = v10 == (Int16 (*)[3])((char *)&elf_hash_bucket[16320] + 3);
  }
  if ( !v12 )
  {
    v13 = LOBYTE(gSpecialPedVoiceLookup[v9][2]);
    this->m_PedType = (__int16)v10;
    this->m_VoiceID = v11;
    this->m_bFemale = v13;
    return 1;
  }
  return result;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (0039D468) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::GetSexForSpecialPed(CAEPedSpeechAudioEntity *this, uint32 HashKey)
{
  return 1;
}

//----- (0039D46C) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetVoiceForMood(CAEPedSpeechAudioEntity *this, Int16 Mood)
{
  int v2; // r4
  Int16 result; // r0

  v2 = Mood;
  result = CAEAudioUtility::GetRandomNumberInRange(0, 1);
  switch ( v2 )
  {
    case 0:
      return result;
    case 1:
      result += 2;
      break;
    case 2:
      result += 4;
      break;
    case 3:
      result += 6;
      break;
    case 4:
      result += 8;
      break;
    case 5:
      result += 10;
      break;
    case 6:
      result += 12;
      break;
    case 7:
      result += 14;
      break;
    case 8:
      result += 16;
      break;
    case 9:
      result += 18;
      break;
    default:
      result += 10;
      break;
  }
  return result;
}

//----- (0039D4CC) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetNextMoodToUse(CAEPedSpeechAudioEntity *this, Int16 LastMood)
{
  Int16 result; // r0

  result = 1;
  switch ( LastMood )
  {
    case 0:
    case 7:
      return result;
    case 6:
      result = 0;
      break;
    case 8:
      result = 4;
      break;
    default:
      result = 5;
      break;
  }
  return result;
}

//----- (0039D4EC) --------------------------------------------------------
Bool8 __fastcall CAEPedSpeechAudioEntity::IsGlobalContextUberImportant(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalContext)
{
  return 0;
}

//----- (0039D4F0) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetRepeatTime(CAEPedSpeechAudioEntity *this, Int16 GlobalSpeechContext)
{
  __int16 v2; // r0
  int v3; // r3
  int v4; // r1
  int v5; // r2
  bool v6; // zf

  if ( (unsigned __int16)((unsigned __int16)GlobalSpeechContext >> 3) > 0x2Cu )
    return 0;
  v2 = 0;
  v3 = (unsigned __int16)GlobalSpeechContext;
  do
  {
    v4 = v2;
    v5 = (unsigned __int16)gSpeechContextLookup[v2][0];
    v6 = v5 == 0xFFFF;
    if ( v5 != 0xFFFF )
    {
      ++v2;
      v6 = v5 == v3;
    }
  }
  while ( !v6 );
  if ( v5 == 0xFFFF )
    return 0;
  else
    return gSpeechContextLookup[v4][6];
}

//----- (0039D544) --------------------------------------------------------
void __fastcall CAEPedSpeechAudioEntity::PlayLoadedSound(CAEPedSpeechAudioEntity *this)
{
  CEntity *m_pGameEntity; // r1
  CMatrix *m_pMat; // r3
  Int16 m_SoundID; // r12
  CVector *p_tx; // r2
  Int16 v6; // r1
  int v7; // r0
  CAESound *v8; // r0
  int m_PedSpeechSlotID; // r1
  CTaskComplexFacial *TaskSecondary; // r0
  int v11; // r1
  CAEPedSpeechSlot *v12; // r2
  int m_PedType; // r2
  CVector Position; // [sp+0h] [bp-A8h]
  CAESound pRequestedSound; // [sp+2Ch] [bp-7Ch] BYREF

  pRequestedSound.m_pPhysicalEntity = 0;
  m_pGameEntity = this->m_pGameEntity;
  if ( m_pGameEntity )
  {
    m_pMat = m_pGameEntity->m_pMat;
    m_SoundID = this->m_SoundID;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pGameEntity->m_transform.m_translate;
    v6 = this->m_PedSpeechSlotID + 20;
    if ( this->m_bFrontEnd )
    {
      Position.x = 0.0;
      *(_QWORD *)&Position.y = 1065353216LL;
      CAESound::Initialise(&pRequestedSound, v6, m_SoundID, this, Position, 3.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      pRequestedSound.m_Environment = 775;
    }
    else
    {
      CAESound::Initialise(
        &pRequestedSound,
        v6,
        m_SoundID,
        this,
        *p_tx,
        this->m_fEventVolume,
        1.0,
        1.0,
        1.0,
        0,
        0,
        0.0,
        0);
      pRequestedSound.m_Environment = 6;
      if ( CAEVehicleAudioEntity::s_pPlayerAttachedForRadio )
        v7 = 1077936128;
      else
        v7 = 0x40000000;
      LODWORD(pRequestedSound.m_RollOffFactor) = v7;
    }
    if ( this->m_bForceAudible )
      pRequestedSound.m_EmittedVolume = 3.0;
    v8 = CAESoundManager::RequestNewSound(&AESoundManager, &pRequestedSound);
    m_PedSpeechSlotID = this->m_PedSpeechSlotID;
    this->m_pSound = v8;
    if ( v8 )
    {
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID].m_pSound = v8;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_InUse = 5;
      if ( (unsigned __int16)(this->m_LastUsedGlobalSpeechContext - 337) >= 2u )
      {
        TaskSecondary = (CTaskComplexFacial *)CTaskManager::GetTaskSecondary(
                                                (const CTaskManager *)(LODWORD(this->m_pGameEntity[18].m_transform.m_translate.y)
                                                                     + 4),
                                                3);
        CTaskComplexFacial::SetRequest(TaskSecondary, 7, 2800, -1, 0);
      }
    }
    else
    {
      v11 = m_PedSpeechSlotID;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[v11].m_InUse = 0;
      v12 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v11];
      v12->m_pAudioEntity = 0;
      v12->m_pSound = 0;
      v12->m_SoundID = -1;
      v12->m_BankID = -1;
      v12->m_StartPlaybackTime = 0;
      v12->m_GlobalSpeechContext = -1;
      v12->m_PedType = -1;
      v12->m_ReservedForPlayerConversation = 0;
      *(_WORD *)&v12->m_bForceAudible = 0;
      m_PedType = (unsigned __int16)this->m_PedType;
      this->m_bPlayingSpeech = 0;
      if ( m_PedType == 2 )
        CAEPedSpeechAudioEntity::s_bAPlayerSpeaking = 0;
      this->m_PedSpeechSlotID = -1;
    }
  }
  CAESound::~CAESound(&pRequestedSound);
}

//----- (0039D6E0) --------------------------------------------------------
Int16 __fastcall CAEPedSpeechAudioEntity::GetNumSlotsPlayingContext(
        CAEPedSpeechAudioEntity *this,
        Int16 GlobalSpeechContext)
{
  int v2; // r12
  Int16 v3; // r1

  v2 = (unsigned __int16)GlobalSpeechContext;
  v3 = CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_InUse != 0
    && CAEPedSpeechAudioEntity::s_PedSpeechSlots[0].m_GlobalSpeechContext == GlobalSpeechContext;
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_InUse
    && (unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[1].m_GlobalSpeechContext == v2 )
  {
    ++v3;
  }
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[2].m_InUse
    && (unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[2].m_GlobalSpeechContext == v2 )
  {
    ++v3;
  }
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[3].m_InUse
    && (unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[3].m_GlobalSpeechContext == v2 )
  {
    ++v3;
  }
  if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[4].m_InUse
    && (unsigned __int16)CAEPedSpeechAudioEntity::s_PedSpeechSlots[4].m_GlobalSpeechContext == v2 )
  {
    ++v3;
  }
  return v3;
}

//----- (0039D78C) --------------------------------------------------------
void __fastcall CAEPedlessSpeechAudioEntity::CAEPedlessSpeechAudioEntity(CAEPedlessSpeechAudioEntity *this)
{
  this->m_pGameEntity = 0;
  this->m_pSound = 0;
  this->m_fEventVolume = -100.0;
  this->ScratchSound.m_pPhysicalEntity = 0;
  this->m_PedType = 0;
  this->b_Initialised = 0;
  this->m_bPlayingSpeech = 0;
  this->m_bSpeechDisabled = 0;
  this->m_bSpeechDisabledForScriptSpeech = 0;
  this->m_SoundID = -1;
  this->m_BankID = -1;
  this->m_PedSpeechSlotID = -1;
  this->m_LastUsedGlobalSpeechContext = -1;
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_667820;
}
// 667820: using guessed type void *;

//----- (0039D7D8) --------------------------------------------------------
int __fastcall CAEPedlessSpeechAudioEntity::AddSayEvent(
        CAEPedlessSpeechAudioEntity *this,
        tAudioEvent AudioEvent,
        int GlobalSpeechContext,
        CEntity *pEntityAttachedTo,
        UInt32 StartTimeDelay,
        float Probability,
        int OverideSilence,
        Bool8 bForceAudible,
        Bool8 bFrontEnd)
{
  bool v11; // zf
  __int16 v14; // r9
  bool v15; // zf
  int m_PedType; // r0
  bool v17; // zf
  bool v18; // zf
  int v19; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v23; // d16
  unsigned __int64 v24; // d1
  unsigned __int16 CanWePlayGlobalSpeechContext; // r8
  int SoundAndBankIDs; // r10
  CEntity *m_pEntityAttachedTo; // r0
  CEntity **p_m_pEntityAttachedTo; // r5
  __int16 v29; // r1
  int v30; // r0
  int v31; // r3
  bool v32; // zf
  __int16 v33; // r5
  uint32 v34; // r0
  UInt32 *v35; // r1
  float v36; // s0
  Int16 pSpecificSpeechContext[15]; // [sp+2h] [bp-1Eh] BYREF

  v11 = pEntityAttachedTo == 0;
  if ( pEntityAttachedTo )
    v11 = this->b_Initialised == 0;
  v14 = -1;
  if ( !v11 )
  {
    v15 = CAEPedSpeechAudioEntity::s_bAllSpeechDisabled == 0;
    if ( !CAEPedSpeechAudioEntity::s_bAllSpeechDisabled )
      v15 = this->m_bSpeechDisabledForScriptSpeech == 0;
    if ( v15 )
    {
      if ( !TheCamera.m_WideScreenOn )
        goto LABEL_24;
      m_PedType = (unsigned __int16)this->m_PedType;
      v17 = m_PedType == 2;
      if ( m_PedType != 2 )
        v17 = m_PedType == 4;
      if ( v17 )
        goto LABEL_24;
      v18 = GlobalSpeechContext == 13;
      if ( GlobalSpeechContext != 13 )
        v18 = GlobalSpeechContext == 116;
      if ( v18 || GlobalSpeechContext == 15 )
      {
LABEL_24:
        if ( CGameLogic::GameState != 2 )
        {
          v19 = CAEAudioUtility::ResolveProbability(Probability);
          if ( AudioEvent == 52
            && v19
            && (OverideSilence || !this->m_bSpeechDisabled)
            && !this->m_bPlayingSpeech
            && (unsigned int)(GlobalSpeechContext - 173) <= 2 )
          {
            *(_DWORD *)&this->m_PedType = 655364;
            if ( CStreaming::ms_numModelsRequested < 16 || !CAEVehicleAudioEntity::s_pPlayerAttachedForRadio )
            {
              m_pMat = pEntityAttachedTo->m_pMat;
              p_tx = (CSimpleTransform *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = &pEntityAttachedTo->m_transform;
              p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
              if ( !TheCamera.m_pMat )
                p_m_transform = &TheCamera.m_transform;
              v23.n64_u64[0] = vsub_f32(
                                 *(float32x2_t *)&p_tx->m_translate.y,
                                 *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
              v24 = vmul_f32(v23, v23).n64_u64[0];
              if ( (float)((float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                                         * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                                 + *(float *)&v24)
                         + *((float *)&v24 + 1)) <= 3600.0 )
              {
                CanWePlayGlobalSpeechContext = CAEPedSpeechAudioEntity::CanWePlayGlobalSpeechContext(
                                                 this,
                                                 GlobalSpeechContext);
                if ( CanWePlayGlobalSpeechContext <= 4u )
                {
                  SoundAndBankIDs = CAEPedSpeechAudioEntity::GetSoundAndBankIDs(
                                      this,
                                      GlobalSpeechContext,
                                      pSpecificSpeechContext);
                  if ( SoundAndBankIDs >= 0 )
                  {
                    m_pEntityAttachedTo = this->m_pEntityAttachedTo;
                    p_m_pEntityAttachedTo = &this->m_pEntityAttachedTo;
                    if ( m_pEntityAttachedTo )
                    {
                      CEntity::CleanUpOldReference(m_pEntityAttachedTo, &this->m_pEntityAttachedTo);
                      *p_m_pEntityAttachedTo = 0;
                    }
                    *p_m_pEntityAttachedTo = pEntityAttachedTo;
                    CEntity::RegisterReference(pEntityAttachedTo, &this->m_pEntityAttachedTo);
                    if ( (unsigned __int16)((unsigned __int16)GlobalSpeechContext >> 3) <= 0x2Cu )
                    {
                      v29 = 0;
                      do
                      {
                        v30 = v29;
                        v31 = (unsigned __int16)gSpeechContextLookup[v29][0];
                        v32 = v31 == 0xFFFF;
                        if ( v31 != 0xFFFF )
                        {
                          ++v29;
                          v32 = v31 == (unsigned __int16)GlobalSpeechContext;
                        }
                      }
                      while ( !v32 );
                      if ( v31 != 0xFFFF )
                      {
                        v33 = gSpeechContextLookup[v30][6];
                        v34 = CTimer::m_snTimeInMilliseconds
                            + (__int16)(CAEAudioUtility::GetRandomNumberInRange(1, 1000) + v33);
                        if ( (unsigned __int16)(GlobalSpeechContext - 340) > 0x12u )
                          v35 = &gGlobalSpeechContextNextPlayTime[GlobalSpeechContext];
                        else
                          v35 = (UInt32 *)((char *)this->m_NextTimeCanSayPain
                                         + (((GlobalSpeechContext << 16) - 22282240) >> 14));
                        *v35 = v34;
                      }
                    }
                    v36 = (float)CAEAudioEntity::m_pAudioEventVolumes[52];
                    this->m_bFrontEnd = bFrontEnd;
                    this->m_bForceAudible = bForceAudible;
                    this->m_PedSpeechSlotID = CanWePlayGlobalSpeechContext;
                    this->m_bPlayingSpeech = 1;
                    this->m_LastUsedGlobalSpeechContext = GlobalSpeechContext;
                    this->m_fEventVolume = v36;
                    CAEPedSpeechAudioEntity::LoadAndPlaySpeech(this, StartTimeDelay);
                    return (__int16)SoundAndBankIDs;
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  return v14;
}
// 39D7D8: using guessed type Int16 pSpecificSpeechContext[15];

//----- (0039DA38) --------------------------------------------------------
void __fastcall CAEPedlessSpeechAudioEntity::UpdateParameters(
        CAEPedlessSpeechAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  int m_PedSpeechSlotID; // lr
  CAEPedSpeechSlot *v4; // r1
  bool v5; // zf
  CEntity *m_pEntityAttachedTo; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  RwReal x; // r12
  CMatrix v11; // [sp+0h] [bp-50h] BYREF
  CVector v12; // 0:r1.12

  v11.m_pRwMat = 0;
  v11.m_owner = 0;
  if ( PlayTime == -1 )
  {
    m_PedSpeechSlotID = this->m_PedSpeechSlotID;
    this->m_bPlayingSpeech = 0;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID].m_InUse = 0;
    v4 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID];
    v4->m_pAudioEntity = 0;
    v4->m_pSound = 0;
    v4->m_SoundID = -1;
    v4->m_BankID = -1;
    v4->m_StartPlaybackTime = 0;
    v4->m_GlobalSpeechContext = -1;
    v4->m_PedType = -1;
    v4->m_ReservedForPlayerConversation = 0;
    *(_WORD *)&v4->m_bForceAudible = 0;
    this->m_SoundID = -1;
    this->m_pSound = 0;
    this->m_BankID = -1;
    this->m_PedSpeechSlotID = -1;
    this->m_bForceAudible = 0;
  }
  else
  {
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_InUse = 5;
    v5 = this->m_bFrontEnd == 0;
    if ( !this->m_bFrontEnd )
      v5 = pSound->m_AudioEvent == 52;
    if ( v5 )
    {
      m_pEntityAttachedTo = this->m_pEntityAttachedTo;
      if ( m_pEntityAttachedTo )
      {
        m_pMat = m_pEntityAttachedTo->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pEntityAttachedTo->m_transform;
        v12.y = p_tx->m_translate.y;
        x = p_tx->m_translate.x;
        v12.z = p_tx->m_translate.z;
        v12.x = x;
        CAESound::SetPosition(pSound, v12);
      }
    }
  }
  CMatrix::~CMatrix(&v11);
}

//----- (0039DAEC) --------------------------------------------------------
void __fastcall CAEPedlessSpeechAudioEntity::Initialise(CAEPedlessSpeechAudioEntity *this)
{
  UInt32 *v1; // r1
  UInt32 *m_NextTimeCanSayPain; // r0

  this->m_pEntityAttachedTo = 0;
  this->m_pGameEntity = 0;
  this->m_pSound = 0;
  this->m_fEventVolume = -100.0;
  this->m_LastUsedGlobalSpeechContext = -1;
  *(_DWORD *)&this->m_bPlayingSpeech = 0;
  this->m_bForceAudible = 0;
  this->m_bFemale = 0;
  this->m_PedType = 4;
  this->b_Initialised = 1;
  *(_QWORD *)&this->m_NextTimeCanSayPain[15] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[17] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[12] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[14] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[8] = 0LL;
  *(_QWORD *)&this->m_NextTimeCanSayPain[10] = 0LL;
  v1 = &this->m_NextTimeCanSayPain[4];
  m_NextTimeCanSayPain = this->m_NextTimeCanSayPain;
  *(_QWORD *)v1 = 0LL;
  *((_QWORD *)v1 + 1) = 0LL;
  *(_QWORD *)m_NextTimeCanSayPain = 0LL;
  *((_QWORD *)m_NextTimeCanSayPain + 1) = 0LL;
}

//----- (0039DB50) --------------------------------------------------------
void __fastcall CAEPedlessSpeechAudioEntity::Terminate(CAEPedlessSpeechAudioEntity *this)
{
  int b_Initialised; // r0
  bool v3; // zf
  int m_PedSpeechSlotID; // r1
  CAESound *m_pSound; // r0
  int v6; // r1
  CAEPedSpeechSlot *v7; // r0
  CEntity *m_pEntityAttachedTo; // r0
  CEntity **p_m_pEntityAttachedTo; // r4

  b_Initialised = this->b_Initialised;
  v3 = b_Initialised == 0;
  if ( b_Initialised )
    v3 = this->m_bPlayingSpeech == 0;
  if ( !v3 )
  {
    m_PedSpeechSlotID = this->m_PedSpeechSlotID;
    if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID].m_InUse == 5 )
    {
      m_pSound = this->m_pSound;
      if ( m_pSound )
      {
        CAESound::StopSoundAndForget(m_pSound);
        LOWORD(m_PedSpeechSlotID) = this->m_PedSpeechSlotID;
      }
      this->m_pSound = 0;
    }
    v6 = (__int16)m_PedSpeechSlotID;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[v6].m_InUse = 0;
    v7 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v6];
    v7->m_pAudioEntity = 0;
    v7->m_pSound = 0;
    v7->m_SoundID = -1;
    v7->m_BankID = -1;
    v7->m_StartPlaybackTime = 0;
    v7->m_GlobalSpeechContext = -1;
    v7->m_PedType = -1;
    v7->m_ReservedForPlayerConversation = 0;
    *(_WORD *)&v7->m_bForceAudible = 0;
    this->m_PedSpeechSlotID = -1;
    this->m_bPlayingSpeech = 0;
  }
  this->b_Initialised = 0;
  this->m_pGameEntity = 0;
  this->m_PedType = -1;
  this->m_VoiceID = -1;
  this->m_bPlayingSpeech = 0;
  this->m_bSpeechDisabled = 0;
  this->m_bSpeechDisabledForScriptSpeech = 0;
  this->m_pSound = 0;
  this->m_SoundID = -1;
  this->m_BankID = -1;
  this->m_PedSpeechSlotID = -1;
  this->m_fEventVolume = -100.0;
  m_pEntityAttachedTo = this->m_pEntityAttachedTo;
  if ( m_pEntityAttachedTo )
  {
    p_m_pEntityAttachedTo = &this->m_pEntityAttachedTo;
    CEntity::CleanUpOldReference(m_pEntityAttachedTo, p_m_pEntityAttachedTo);
    *p_m_pEntityAttachedTo = 0;
  }
}

//----- (0039DC20) --------------------------------------------------------
void __fastcall CAEPedlessSpeechAudioEntity::StopCurrentSpeech(CAEPedlessSpeechAudioEntity *this)
{
  int b_Initialised; // r0
  bool v3; // zf
  Int16 m_PedSpeechSlotID; // r1
  CAESound *m_pSound; // r0
  int v6; // r1
  CAEPedSpeechSlot *v7; // r0

  b_Initialised = this->b_Initialised;
  v3 = b_Initialised == 0;
  if ( b_Initialised )
    v3 = this->m_bPlayingSpeech == 0;
  if ( !v3 )
  {
    m_PedSpeechSlotID = this->m_PedSpeechSlotID;
    if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID].m_InUse == 5 )
    {
      m_pSound = this->m_pSound;
      if ( m_pSound )
      {
        CAESound::StopSoundAndForget(m_pSound);
        m_PedSpeechSlotID = this->m_PedSpeechSlotID;
      }
      this->m_pSound = 0;
    }
    v6 = m_PedSpeechSlotID;
    CAEPedSpeechAudioEntity::s_PedSpeechSlots[v6].m_InUse = 0;
    v7 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v6];
    v7->m_pAudioEntity = 0;
    v7->m_pSound = 0;
    v7->m_SoundID = -1;
    v7->m_BankID = -1;
    v7->m_StartPlaybackTime = 0;
    v7->m_GlobalSpeechContext = -1;
    v7->m_PedType = -1;
    v7->m_ReservedForPlayerConversation = 0;
    *(_WORD *)&v7->m_bForceAudible = 0;
    this->m_PedSpeechSlotID = -1;
    this->m_bPlayingSpeech = 0;
  }
}

//----- (0039DCA0) --------------------------------------------------------
void __fastcall CAEPedlessSpeechAudioEntity::PlayLoadedSound(CAEPedlessSpeechAudioEntity *this)
{
  CEntity *m_pEntityAttachedTo; // r1
  CMatrix *m_pMat; // r3
  CEntity **p_m_pEntityAttachedTo; // r6
  Int16 m_SoundID; // r12
  CVector *p_tx; // r2
  Int16 v7; // r1
  UInt16 v8; // r0
  bool v9; // zf
  int v10; // r1
  CAESound *m_pSound; // r0
  int v12; // r1
  CAEPedSpeechSlot *v13; // r0
  int m_bForceAudible; // r1
  CAESound *v15; // r0
  int m_PedSpeechSlotID; // r1
  int v17; // r1
  CAEPedSpeechSlot *v18; // r1
  int m_PedType; // r1
  CVector Position; // [sp+0h] [bp-48h]

  m_pEntityAttachedTo = this->m_pEntityAttachedTo;
  if ( m_pEntityAttachedTo )
  {
    m_pMat = m_pEntityAttachedTo->m_pMat;
    p_m_pEntityAttachedTo = &this->m_pEntityAttachedTo;
    m_SoundID = this->m_SoundID;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pEntityAttachedTo->m_transform.m_translate;
    v7 = this->m_PedSpeechSlotID + 20;
    if ( this->m_bFrontEnd )
    {
      Position.x = 0.0;
      *(_QWORD *)&Position.y = 1065353216LL;
      CAESound::Initialise(&this->ScratchSound, v7, m_SoundID, this, Position, 3.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v8 = 903;
    }
    else
    {
      CAESound::Initialise(&this->ScratchSound, v7, m_SoundID, this, *p_tx, 12.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      this->ScratchSound.m_RollOffFactor = 3.5;
      v8 = 134;
    }
    m_bForceAudible = this->m_bForceAudible;
    this->ScratchSound.m_Environment = v8;
    if ( m_bForceAudible )
      this->ScratchSound.m_EmittedVolume = 3.0;
    if ( *p_m_pEntityAttachedTo )
    {
      CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, *p_m_pEntityAttachedTo);
      CEntity::CleanUpOldReference(*p_m_pEntityAttachedTo, &this->m_pEntityAttachedTo);
      *p_m_pEntityAttachedTo = 0;
    }
    v15 = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
    m_PedSpeechSlotID = this->m_PedSpeechSlotID;
    this->m_pSound = v15;
    if ( v15 )
    {
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[m_PedSpeechSlotID].m_pSound = v15;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[this->m_PedSpeechSlotID].m_InUse = 5;
    }
    else
    {
      v17 = m_PedSpeechSlotID;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[v17].m_InUse = 0;
      v18 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v17];
      v18->m_pAudioEntity = 0;
      v18->m_pSound = 0;
      v18->m_SoundID = -1;
      v18->m_BankID = -1;
      v18->m_StartPlaybackTime = 0;
      v18->m_GlobalSpeechContext = -1;
      v18->m_PedType = -1;
      v18->m_ReservedForPlayerConversation = 0;
      *(_WORD *)&v18->m_bForceAudible = 0;
      m_PedType = (unsigned __int16)this->m_PedType;
      this->m_bPlayingSpeech = 0;
      if ( m_PedType == 2 )
        CAEPedSpeechAudioEntity::s_bAPlayerSpeaking = 0;
      this->m_PedSpeechSlotID = -1;
    }
  }
  else
  {
    v9 = this->b_Initialised == 0;
    if ( this->b_Initialised )
      v9 = this->m_bPlayingSpeech == 0;
    if ( !v9 )
    {
      v10 = this->m_PedSpeechSlotID;
      if ( CAEPedSpeechAudioEntity::s_PedSpeechSlots[v10].m_InUse == 5 )
      {
        m_pSound = this->m_pSound;
        if ( m_pSound )
        {
          CAESound::StopSoundAndForget(m_pSound);
          LOWORD(v10) = this->m_PedSpeechSlotID;
        }
        this->m_pSound = 0;
      }
      v12 = (__int16)v10;
      CAEPedSpeechAudioEntity::s_PedSpeechSlots[v12].m_InUse = 0;
      v13 = &CAEPedSpeechAudioEntity::s_PedSpeechSlots[v12];
      v13->m_pAudioEntity = 0;
      v13->m_pSound = 0;
      v13->m_SoundID = -1;
      v13->m_BankID = -1;
      v13->m_StartPlaybackTime = 0;
      v13->m_GlobalSpeechContext = -1;
      v13->m_PedType = -1;
      v13->m_ReservedForPlayerConversation = 0;
      *(_WORD *)&v13->m_bForceAudible = 0;
      this->m_PedSpeechSlotID = -1;
      this->m_bPlayingSpeech = 0;
    }
  }
}

//----- (0039DE9A) --------------------------------------------------------
Int16 __fastcall CAEPedlessSpeechAudioEntity::GetAllocatedVoice(CAEPedlessSpeechAudioEntity *this)
{
  return -1;
}

//----- (0039DEA0) --------------------------------------------------------
Bool8 __fastcall CAEPedlessSpeechAudioEntity::WillPedChatAboutTopic(
        CAEPedlessSpeechAudioEntity *this,
        Int16 ConversationTopic)
{
  return 0;
}

//----- (0039DEA4) --------------------------------------------------------
Int16 __fastcall CAEPedlessSpeechAudioEntity::GetPedType(CAEPedlessSpeechAudioEntity *this)
{
  return -1;
}

//----- (0039DEAA) --------------------------------------------------------
Bool8 __fastcall CAEPedlessSpeechAudioEntity::IsPedFemaleForAudio(CAEPedlessSpeechAudioEntity *this)
{
  return 0;
}

//----- (0039DEB0) --------------------------------------------------------
void __fastcall CAEPedWeaponAudioEntity::AddAudioEvent(CAEPedWeaponAudioEntity *this, tAudioEvent AudioEvent)
{
  CPed *m_pParentPed; // r2
  bool v3; // zf
  eWeaponType *p_m_eWeaponType; // r12

  v3 = this->m_bInitialised == 0;
  if ( this->m_bInitialised )
  {
    m_pParentPed = this->m_pParentPed;
    v3 = m_pParentPed == 0;
  }
  if ( !v3 )
  {
    if ( (unsigned int)(AudioEvent - 145) <= 0xB )
      JUMPOUT(0x39DED0);
    p_m_eWeaponType = &m_pParentPed->m_WeaponSlots[m_pParentPed->m_nCurrentWeapon].m_eWeaponType;
    switch ( AudioEvent )
    {
      case 145:
      case 150:
      case 151:
        sub_18B8D4(this, *p_m_eWeaponType, m_pParentPed, AudioEvent);
        break;
      case 146:
      case 147:
        sub_19B920(this, *p_m_eWeaponType, m_pParentPed, AudioEvent);
        break;
      case 148:
      case 149:
      case 152:
        return;
      case 153:
      case 154:
      case 155:
        sub_19B384(this, m_pParentPed, AudioEvent);
        break;
      case 156:
        sub_1A03DC(this, *p_m_eWeaponType, m_pParentPed, 156);
        break;
    }
  }
}
// 39DECC: control flows out of bounds to 39DED0
// 39DED8: variable 'm_pParentPed' is possibly undefined

//----- (0039DF28) --------------------------------------------------------
void __fastcall CAEPedWeaponAudioEntity::Initialise(CAEPedWeaponAudioEntity *this, CEntity *pPed)
{
  this->m_pParentPed = (CPed *)pPed;
  CAEWeaponAudioEntity::Initialise(this);
  this->m_bInitialised = 1;
}

//----- (0039DF3E) --------------------------------------------------------
void __fastcall CAEPedWeaponAudioEntity::Terminate(CAEPedWeaponAudioEntity *this)
{
  this->m_pParentPed = 0;
  this->m_bInitialised = 0;
  sub_18F600(this);
}

//----- (0039DF4C) --------------------------------------------------------
void __fastcall CAEPedWeaponAudioEntity::Service(CAEPedWeaponAudioEntity *this)
{
  CPed *m_pParentPed; // r0
  CPed *v3; // r1

  m_pParentPed = this->m_pParentPed;
  if ( !m_pParentPed
    || *((unsigned __int8 *)&m_pParentPed->m_nPedFlags + 1) << 31
    || CPedIntelligence::GetTaskSwim(m_pParentPed->m_pPedIntelligence)
    || (v3 = this->m_pParentPed, v3->m_WeaponSlots[v3->m_nCurrentWeapon].m_eWeaponType != WEAPONTYPE_FLAMETHROWER) )
  {
    sub_193134(this);
  }
  else
  {
    sub_19F19C(this, v3);
  }
}

//----- (0039DF98) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::~CAEPoliceScannerAudioEntity(CAEPoliceScannerAudioEntity *this)
{
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_667848;
  if ( CAEPoliceScannerAudioEntity::s_pPSControlling == this && CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
  {
    CAEPoliceScannerAudioEntity::s_bStoppingScanner = 1;
    if ( CAEPoliceScannerAudioEntity::s_pSound )
    {
      CAESound::StopSoundAndForget(CAEPoliceScannerAudioEntity::s_pSound);
      CAEPoliceScannerAudioEntity::s_pSound = 0;
    }
    CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
    CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
    CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
    CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
    CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
    CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
    CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
  }
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->ScratchSound);
}
// 667798: using guessed type void *off_667798;
// 667848: using guessed type void *;

//----- (0039E0FC) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::StopScanner(Bool8 bInstantStop)
{
  if ( CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
  {
    CAEPoliceScannerAudioEntity::s_bStoppingScanner = 1;
    if ( bInstantStop )
    {
      if ( CAEPoliceScannerAudioEntity::s_pSound )
      {
        CAESound::StopSoundAndForget(CAEPoliceScannerAudioEntity::s_pSound);
        CAEPoliceScannerAudioEntity::s_pSound = 0;
      }
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
      CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
      CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
      CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
      CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
    }
  }
}

//----- (0039E214) --------------------------------------------------------
void CAEPoliceScannerAudioEntity::Reset()
{
  if ( CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
  {
    CAEPoliceScannerAudioEntity::s_bStoppingScanner = 1;
    if ( CAEPoliceScannerAudioEntity::s_pSound )
    {
      CAESound::StopSoundAndForget(CAEPoliceScannerAudioEntity::s_pSound);
      CAEPoliceScannerAudioEntity::s_pSound = 0;
    }
    CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
    CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
    CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
    CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
    CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
    CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
    CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
  }
  CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
  CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
  CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
  CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
  CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
}

//----- (0039E3F4) --------------------------------------------------------
void CAEPoliceScannerAudioEntity::FinishedPlayingScannerDialogue()
{
  CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
  CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
  CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
  CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
  CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
  CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
  CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
  CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
}

//----- (0039E4C4) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::AddAudioEvent(
        CAEPoliceScannerAudioEntity *this,
        tAudioEvent AudioEvent,
        eCrimeType CrimeType,
        const CVector *vPosition)
{
  Int32 RandomNumberInRange; // r0
  __int16 v8; // r1
  CZone *SmallestZoneForPosition; // r0
  int v10; // r3
  unsigned __int8 (*i)[8]; // r2
  int v12; // r1
  int y1; // r3
  int x1; // r2
  float v16; // s2
  float v17; // s12
  float v18; // s4
  float v19; // s6
  float v20; // s0
  float y; // s8
  float v22; // s2
  __int16 v23; // r0
  int v24; // r0
  int v25; // r0
  CPlayerPed *PlayerPed; // r5
  int v27; // r0
  CVehicle *m_pMyVehicle; // r5
  int VehicleAudioTypeForName; // r6
  __int16 v30; // r3
  int v31; // r2
  int m_colour1; // r0
  __int16 v33; // r0
  __int64 v34; // [sp+0h] [bp-48h] BYREF
  __int64 v35; // [sp+8h] [bp-40h]
  int v36; // [sp+10h] [bp-38h]
  __int64 pCrimeSlots; // [sp+18h] [bp-30h] BYREF
  __int64 v38; // [sp+20h] [bp-28h]
  int v39; // [sp+28h] [bp-20h]

  pCrimeSlots = unk_613BE8;
  v38 = unk_613BF0;
  v34 = unk_613BE8;
  v35 = unk_613BF0;
  v39 = -1;
  v36 = -1;
  if ( AudioEvent == 164 && (unsigned int)(CrimeType - 2) <= 0x14 )
  {
    LOWORD(pCrimeSlots) = 150;
    RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 2);
    v8 = gnCrimeNumberLookup[CrimeType];
    LOWORD(RandomNumberInRange) = gnCrimeInstructions[RandomNumberInRange];
    WORD2(pCrimeSlots) = 151;
    WORD1(pCrimeSlots) = RandomNumberInRange;
    HIWORD(pCrimeSlots) = v8;
    SmallestZoneForPosition = CTheZones::FindSmallestZoneForPosition(vPosition, 1u);
    if ( SmallestZoneForPosition )
    {
      v10 = 0;
      for ( i = gszCrimeAreaNameLookup; ; ++i )
      {
        if ( *(_QWORD *)i == SmallestZoneForPosition->TextLabel )
        {
          v12 = gnCrimeAreaSoundLookup[v10];
          if ( v12 >= 0 )
            break;
        }
        if ( v10++ >= 193 )
          return;
      }
      if ( !gbCrimeAreaWithDirectionsLookup[v10] )
        goto LABEL_23;
      y1 = SmallestZoneForPosition->y1;
      x1 = SmallestZoneForPosition->x1;
      v16 = (float)(SmallestZoneForPosition->y2 - y1);
      v17 = (float)(SmallestZoneForPosition->x2 - x1);
      v18 = v16 * 0.25;
      v19 = (float)(v16 * 0.5) + (float)y1;
      v20 = v17 * 0.25;
      y = vPosition->y;
      v22 = (float)(v17 * 0.5) + (float)x1;
      if ( y <= (float)(v18 + v19) )
      {
        if ( y >= (float)(v19 - v18) )
        {
          v24 = 0;
          goto LABEL_16;
        }
        v23 = 3;
      }
      else
      {
        v23 = 2;
      }
      WORD1(v38) = v23;
      LOWORD(v38) = 149;
      v24 = 1;
LABEL_16:
      if ( vPosition->x <= (float)(v20 + v22) )
      {
        if ( vPosition->x >= (float)(v22 - v20) )
        {
          if ( v24 )
            goto LABEL_23;
          v25 = 149;
        }
        else
        {
          v25 = 262293;
        }
      }
      else
      {
        v25 = 65685;
      }
      HIDWORD(v38) = v25;
LABEL_23:
      HIWORD(v39) = v12;
      LOWORD(v39) = 147;
      PlayerPed = 0;
      if ( &FindPlayerWanted(0)->m_PoliceScannerAudioEntity == this )
        PlayerPed = FindPlayerPed(0);
      if ( &FindPlayerWanted(1)->m_PoliceScannerAudioEntity == this )
        PlayerPed = FindPlayerPed(1);
      if ( !PlayerPed )
        goto LABEL_54;
      if ( *((unsigned __int8 *)&PlayerPed->m_nPedFlags + 1) << 31 )
      {
        m_pMyVehicle = PlayerPed->m_pMyVehicle;
        if ( m_pMyVehicle )
        {
          VehicleAudioTypeForName = m_pMyVehicle->m_VehicleAudioEntity.m_VehicleAudioSetting.VehicleAudioTypeForName;
          if ( (unsigned __int8)VehicleAudioTypeForName <= 0x2Du && (unsigned __int8)VehicleAudioTypeForName != 5 )
          {
            v30 = 1;
            LODWORD(v34) = (char *)&stru_7008C.st_size + 2;
            WORD2(v34) = 150;
            v31 = gbColouredVehicleTypeLookup[VehicleAudioTypeForName];
            if ( ((unsigned __int8)VehicleAudioTypeForName | 4) == 29 )
              v30 = 3;
            if ( (unsigned __int8)VehicleAudioTypeForName == 30 )
              v30 = 3;
            if ( (unsigned __int8)VehicleAudioTypeForName == 37 )
              v30 = 3;
            if ( (unsigned __int8)VehicleAudioTypeForName == 41 )
              v30 = 3;
            if ( (unsigned __int8)VehicleAudioTypeForName == 34 )
              v30 = 3;
            HIWORD(v34) = v30;
            if ( v31 )
            {
              if ( CVehicle::GetRemapIndex(m_pMyVehicle) == -1 )
              {
                m_colour1 = m_pMyVehicle->m_colour1;
                if ( m_colour1 != 6 && (unsigned __int8)(m_colour1 - 1) <= 0x7Du )
                {
                  v33 = gnPlayerVehicleColourLookup[m_colour1];
                  WORD2(v35) = 148;
                  HIWORD(v35) = v33;
                }
              }
              else
              {
                HIDWORD(v35) = 262292;
              }
            }
            LOWORD(v36) = 152;
            HIWORD(v36) = gnPlayerVehicleTypeLookup[VehicleAudioTypeForName];
          }
        }
        goto LABEL_54;
      }
      if ( CPedIntelligence::GetTaskSwim(PlayerPed->m_pPedIntelligence) )
      {
        LODWORD(v34) = 458902;
        v27 = 131222;
      }
      else
      {
        if ( CPedIntelligence::GetTaskJetPack(PlayerPed->m_pPedIntelligence) )
          goto LABEL_54;
        LODWORD(v34) = 458902;
        v27 = 262294;
      }
      v36 = v27;
LABEL_54:
      CAEPoliceScannerAudioEntity::PlayPoliceScannerDialogue(this, (tScannerSlot *)&pCrimeSlots, (tScannerSlot *)&v34);
    }
  }
}
// 7008C: using guessed type Elf32_Sym stru_7008C;

//----- (0039E7B0) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::PlayPoliceScannerDialogue(
        CAEPoliceScannerAudioEntity *this,
        tScannerSlot *pCrimeSlots,
        tScannerSlot *pLastSeenSlots)
{
  tScannerSlot v3; // r9
  tScannerSlot v4; // r8
  tScannerSlot v5; // lr
  tScannerSlot v6; // r1
  int v7; // r4
  unsigned int v8; // r4
  unsigned int v9; // r4
  unsigned int v10; // r4
  int BankID; // r0
  unsigned int v12; // r1

  if ( !CAEPoliceScannerAudioEntity::s_nScannerPlaybackState
    && !((CAEPoliceScannerAudioEntity::s_bScannerDisabled | TheCamera.m_WideScreenOn) << 24)
    && CTimer::m_snTimeInMilliseconds >= CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime )
  {
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = *pCrimeSlots;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = *pLastSeenSlots;
    v3 = pCrimeSlots[1];
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = v3;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = pLastSeenSlots[1];
    v4 = pCrimeSlots[2];
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = v4;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = pLastSeenSlots[2];
    v5 = pCrimeSlots[3];
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = v5;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = pLastSeenSlots[3];
    v6 = pCrimeSlots[4];
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = v6;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = pLastSeenSlots[4];
    CAEPoliceScannerAudioEntity::s_nSectionPlaying = 0;
    CAEPoliceScannerAudioEntity::s_pPSControlling = this;
    v7 = *(_DWORD *)CAEPoliceScannerAudioEntity::s_ScannerSlotFirst >> 31;
    CAEPoliceScannerAudioEntity::s_pCurrentSlots = CAEPoliceScannerAudioEntity::s_ScannerSlotFirst;
    if ( CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0].BankID < 0 )
      LOWORD(v7) = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[0] = v7;
    v8 = *(unsigned int *)&v3 >> 31;
    if ( v3.BankID < 0 )
      LOWORD(v8) = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[1] = v8;
    v9 = *(unsigned int *)&v4 >> 31;
    if ( v4.BankID < 0 )
      LOWORD(v9) = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[2] = v9;
    v10 = *(unsigned int *)&v5 >> 31;
    if ( v5.BankID < 0 )
      LOWORD(v10) = 1;
    CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 2;
    CAEPoliceScannerAudioEntity::s_nPlaybackStartTime = CTimer::m_snTimeInMilliseconds + 2000;
    CAEPoliceScannerAudioEntity::s_nAbortPlaybackTime = CTimer::m_snTimeInMilliseconds + 5000;
    BankID = v6.BankID;
    v12 = *(unsigned int *)&v6 >> 31;
    CAEPoliceScannerAudioEntity::s_SlotState[3] = v10;
    if ( BankID < 0 )
      LOWORD(v12) = 1;
    CAEPoliceScannerAudioEntity::s_SlotState[4] = v12;
  }
}
// 0: using guessed type int dword_0;

//----- (0039E900) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::UpdateParameters(
        CAEPoliceScannerAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  int m_nLength; // r0

  if ( PlayTime == -1 )
  {
    CAEPoliceScannerAudioEntity::s_pSound = 0;
    if ( !CAEPoliceScannerAudioEntity::s_bStoppingScanner )
    {
LABEL_12:
      CAEPoliceScannerAudioEntity::PlayLoadedDialogue(this);
      return;
    }
    if ( CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
    {
      CAEPoliceScannerAudioEntity::s_bStoppingScanner = 1;
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
      CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
      CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
      CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
      CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
      CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
      CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
      CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
      CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
    }
  }
  else
  {
    if ( CAEPoliceScannerAudioEntity::s_bStoppingScanner )
    {
      pSound->m_EmittedVolume = pSound->m_EmittedVolume + -6.0;
      return;
    }
    m_nLength = pSound->m_nLength;
    if ( m_nLength >= 1 && m_nLength - 40 < PlayTime && pSound->m_BankSlotID != 37 )
    {
      CAESound::SetIndividualEnvironment(pSound, 4u, 0);
      CAEPoliceScannerAudioEntity::s_pSound = 0;
      goto LABEL_12;
    }
  }
}

//----- (0039EA60) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::PlayLoadedDialogue(CAEPoliceScannerAudioEntity *this)
{
  __int16 v1; // r6
  int v2; // r5
  Int16 v3; // r0
  int v4; // r2
  int v5; // r0
  int v6; // r0
  int v7; // r0
  int v8; // r0
  CVector Position; // [sp+0h] [bp-B8h]
  CAESound v10; // [sp+2Ch] [bp-8Ch] BYREF

  v1 = 0;
  v10.m_pPhysicalEntity = 0;
  if ( CAEPoliceScannerAudioEntity::s_SlotState[0] != 5 )
  {
    if ( CAEPoliceScannerAudioEntity::s_SlotState[1] == 5 )
    {
      v1 = 1;
    }
    else if ( CAEPoliceScannerAudioEntity::s_SlotState[2] == 5 )
    {
      v1 = 2;
    }
    else if ( CAEPoliceScannerAudioEntity::s_SlotState[3] == 5 )
    {
      v1 = 3;
    }
    else
    {
      v1 = 0;
      if ( CAEPoliceScannerAudioEntity::s_SlotState[4] == 5 )
        v1 = 4;
    }
  }
  v2 = (unsigned __int16)v1;
  while ( CAEPoliceScannerAudioEntity::s_SlotState[v2] != 3 )
  {
    v2 = ++v1;
    if ( v1 >= 5 )
    {
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 49, CAEPoliceScannerAudioEntity::s_fVolumeOffset + 0.0, 1.0);
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
      if ( CAEPoliceScannerAudioEntity::s_nSectionPlaying )
      {
        CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
        CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
        CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
        CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
        CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
        goto LABEL_29;
      }
      CAEPoliceScannerAudioEntity::s_nPlaybackStartTime = 0;
      CAEPoliceScannerAudioEntity::s_nSectionPlaying = 1;
      CAEPoliceScannerAudioEntity::s_pCurrentSlots = CAEPoliceScannerAudioEntity::s_ScannerSlotSecond;
      v4 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4].SoundID >> 15;
      if ( CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4].BankID < 0 )
        LOWORD(v4) = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[4] = v4;
      v5 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0].SoundID >> 15;
      if ( CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0].BankID < 0 )
        LOWORD(v5) = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[0] = v5;
      v6 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1].SoundID >> 15;
      if ( CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1].BankID < 0 )
        LOWORD(v6) = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[1] = v6;
      v7 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2].SoundID >> 15;
      if ( CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2].BankID < 0 )
        LOWORD(v7) = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[2] = v7;
      v8 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3].SoundID >> 15;
      if ( CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3].BankID < 0 )
        LOWORD(v8) = 1;
      CAEPoliceScannerAudioEntity::s_SlotState[3] = v8;
      CAEPoliceScannerAudioEntity::s_nAbortPlaybackTime = CTimer::m_snTimeInMilliseconds + 5000;
      v3 = 2;
      goto LABEL_28;
    }
  }
  Position.x = 0.0;
  *(_QWORD *)&Position.y = 1065353216LL;
  CAESound::Initialise(
    &v10,
    v2 + 33,
    CAEPoliceScannerAudioEntity::s_pCurrentSlots[v2].SoundID,
    this,
    Position,
    CAEPoliceScannerAudioEntity::s_fVolumeOffset + (float)CAEAudioEntity::m_pAudioEventVolumes[164],
    1.0,
    1.0,
    1.0,
    0,
    0,
    0.0,
    0);
  v10.m_AudioEvent = 164;
  v10.m_Environment = 263;
  v10.m_ClientVariable = (float)v1;
  CAEPoliceScannerAudioEntity::s_pSound = CAESoundManager::RequestNewSound(&AESoundManager, &v10);
  if ( !CAEPoliceScannerAudioEntity::s_pSound )
    goto LABEL_29;
  CAEPoliceScannerAudioEntity::s_SlotState[v2] = 5;
  v3 = 7;
LABEL_28:
  CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = v3;
LABEL_29:
  CAESound::~CAESound(&v10);
}
// 0: using guessed type int dword_0;

//----- (0039EDA0) --------------------------------------------------------
void CAEPoliceScannerAudioEntity::Service()
{
  bool v0; // zf
  float v1; // s0

  v0 = !TheCamera.m_WideScreenOn;
  if ( TheCamera.m_WideScreenOn )
    v0 = CAEPoliceScannerAudioEntity::s_nScannerPlaybackState == 0;
  if ( !v0 )
    CAEPoliceScannerAudioEntity::s_bStoppingScanner = 1;
  switch ( CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
  {
    case 5:
      if ( CAEPoliceScannerAudioEntity::s_bStoppingScanner )
        goto LABEL_15;
      if ( CTimer::m_snTimeInMilliseconds >= CAEPoliceScannerAudioEntity::s_nPlaybackStartTime
        && CAEPoliceScannerAudioEntity::s_pPSControlling )
      {
        CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 7;
        CAEPoliceScannerAudioEntity::PlayLoadedDialogue(CAEPoliceScannerAudioEntity::s_pPSControlling);
      }
      break;
    case 4:
      if ( CAEPoliceScannerAudioEntity::s_bStoppingScanner )
        goto LABEL_15;
      if ( CTimer::m_snTimeInMilliseconds >= CAEPoliceScannerAudioEntity::s_nPlaybackStartTime )
      {
        v1 = -8.0;
        if ( CAEVehicleAudioEntity::s_pPlayerAttachedForRadio )
          v1 = 0.0;
        CAEPoliceScannerAudioEntity::s_fVolumeOffset = v1;
        CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 49, v1 + 0.0, 1.0);
        CAudioEngine::ReportFrontendAudioEvent(
          &AudioEngine,
          47,
          CAEPoliceScannerAudioEntity::s_fVolumeOffset + -6.0,
          1.0);
        CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 5;
        CAEPoliceScannerAudioEntity::s_nPlaybackStartTime = CTimer::m_snTimeInMilliseconds + 300;
      }
      break;
    case 2:
      if ( CTimer::m_snTimeInMilliseconds > CAEPoliceScannerAudioEntity::s_nAbortPlaybackTime )
      {
        CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
        CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
        CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
        CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
LABEL_16:
        CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
        CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
        return;
      }
      if ( CAEPoliceScannerAudioEntity::s_bStoppingScanner )
      {
LABEL_15:
        CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
        CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
        CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
        CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
        CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
        goto LABEL_16;
      }
      CAEPoliceScannerAudioEntity::LoadSlots();
      break;
  }
}
// 0: using guessed type int dword_0;

//----- (0039F210) --------------------------------------------------------
void CAEPoliceScannerAudioEntity::LoadSlots()
{
  int v0; // r5
  int v1; // r9
  int v2; // r10
  Int16 v3; // r0

  if ( CAEPoliceScannerAudioEntity::s_pCurrentSlots )
  {
    v0 = 0;
    v1 = 2;
    v2 = 1;
    while ( 1 )
    {
      if ( CAEPoliceScannerAudioEntity::s_SlotState[v0] == 2 )
      {
        if ( !CAEAudioHardware::IsSoundLoaded(
                &AEAudioHardware,
                *(_WORD *)((char *)CAEPoliceScannerAudioEntity::s_pCurrentSlots + v1 - 2),
                *(__int16 *)((char *)&CAEPoliceScannerAudioEntity::s_pCurrentSlots->BankID + v1),
                v0 + 33) )
        {
LABEL_13:
          v2 = 0;
          goto LABEL_14;
        }
        CAEPoliceScannerAudioEntity::s_SlotState[v0] = 3;
      }
      else if ( !CAEPoliceScannerAudioEntity::s_SlotState[v0] )
      {
        if ( *(__int16 *)((char *)CAEPoliceScannerAudioEntity::s_pCurrentSlots + v1 - 2) < 0
          || *(__int16 *)((char *)&CAEPoliceScannerAudioEntity::s_pCurrentSlots->BankID + v1) <= -1 )
        {
          v3 = 1;
        }
        else
        {
          if ( CStreaming::IsVeryBusy() )
            goto LABEL_13;
          CAEAudioHardware::LoadSound(
            &AEAudioHardware,
            *(_WORD *)((char *)CAEPoliceScannerAudioEntity::s_pCurrentSlots + v1 - 2),
            *(__int16 *)((char *)&CAEPoliceScannerAudioEntity::s_pCurrentSlots->BankID + v1),
            v0 + 33);
          v3 = 2;
          v2 = 0;
        }
        CAEPoliceScannerAudioEntity::s_SlotState[v0] = v3;
      }
LABEL_14:
      v1 += 4;
      ++v0;
      if ( v1 == 22 )
      {
        if ( v2 << 24 )
          CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 4;
        return;
      }
    }
  }
}

//----- (0039F350) --------------------------------------------------------
bool CAEPoliceScannerAudioEntity::CanWePlayNewScannerDialogue()
{
  _BOOL4 result; // r0

  if ( CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
    return 0;
  result = 0;
  if ( CTimer::m_snTimeInMilliseconds >= CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime
    && !TheCamera.m_WideScreenOn )
  {
    return CAEPoliceScannerAudioEntity::s_bScannerDisabled == 0;
  }
  return result;
}

//----- (0039F3AC) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::PopulateScannerDialogueLists(
        tScannerSlot *pScannerSlotFirst,
        tScannerSlot *pScannerSlotSecond)
{
  if ( !CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
  {
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = *pScannerSlotFirst;
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = *pScannerSlotSecond;
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = pScannerSlotFirst[1];
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = pScannerSlotSecond[1];
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = pScannerSlotFirst[2];
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = pScannerSlotSecond[2];
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = pScannerSlotFirst[3];
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = pScannerSlotSecond[3];
    CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = pScannerSlotFirst[4];
    CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = pScannerSlotSecond[4];
  }
}

//----- (0039F40C) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::PrepSlots(CAEPoliceScannerAudioEntity *this)
{
  int v1; // r1
  int v2; // r1
  int v3; // r1
  int v4; // r1
  int v5; // r0

  if ( CAEPoliceScannerAudioEntity::s_pCurrentSlots )
  {
    if ( CAEPoliceScannerAudioEntity::s_pCurrentSlots->BankID < 0 )
      LOWORD(v1) = 1;
    else
      v1 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_pCurrentSlots->SoundID >> 15;
    CAEPoliceScannerAudioEntity::s_SlotState[0] = v1;
    if ( CAEPoliceScannerAudioEntity::s_pCurrentSlots[1].BankID < 0 )
      LOWORD(v2) = 1;
    else
      v2 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_pCurrentSlots[1].SoundID >> 15;
    CAEPoliceScannerAudioEntity::s_SlotState[1] = v2;
    if ( CAEPoliceScannerAudioEntity::s_pCurrentSlots[2].BankID < 0 )
      LOWORD(v3) = 1;
    else
      v3 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_pCurrentSlots[2].SoundID >> 15;
    CAEPoliceScannerAudioEntity::s_SlotState[2] = v3;
    if ( CAEPoliceScannerAudioEntity::s_pCurrentSlots[3].BankID < 0 )
      LOWORD(v4) = 1;
    else
      v4 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_pCurrentSlots[3].SoundID >> 15;
    CAEPoliceScannerAudioEntity::s_SlotState[3] = v4;
    if ( CAEPoliceScannerAudioEntity::s_pCurrentSlots[4].BankID < 0 )
      LOWORD(v5) = 1;
    else
      v5 = (unsigned __int16)CAEPoliceScannerAudioEntity::s_pCurrentSlots[4].SoundID >> 15;
    CAEPoliceScannerAudioEntity::s_SlotState[4] = v5;
  }
}
// 0: using guessed type int dword_0;

//----- (0039F4A4) --------------------------------------------------------
void __fastcall CAEPoliceScannerAudioEntity::DisableScanner(Bool8 bCurtail, Bool8 bInstantCurtail)
{
  CAEPoliceScannerAudioEntity::s_bScannerDisabled = 1;
  if ( bCurtail )
  {
    if ( CAEPoliceScannerAudioEntity::s_nScannerPlaybackState )
    {
      if ( CAEPoliceScannerAudioEntity::s_pPSControlling )
      {
        CAEPoliceScannerAudioEntity::s_bStoppingScanner = 1;
        if ( bInstantCurtail )
        {
          if ( CAEPoliceScannerAudioEntity::s_pSound )
          {
            CAESound::StopSoundAndForget(CAEPoliceScannerAudioEntity::s_pSound);
            CAEPoliceScannerAudioEntity::s_pSound = 0;
          }
          CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 48, 0.0, 1.0);
          CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[4] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[3] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[2] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[1] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_ScannerSlotFirst[0] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_nScannerPlaybackState = 0;
          CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[4] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[3] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[2] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[1] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_pPSControlling = 0;
          CAEPoliceScannerAudioEntity::s_fVolumeOffset = 0.0;
          CAEPoliceScannerAudioEntity::s_ScannerSlotSecond[0] = (tScannerSlot)-1;
          CAEPoliceScannerAudioEntity::s_pCurrentSlots = 0;
          CAEPoliceScannerAudioEntity::s_bStoppingScanner = 0;
          CAEPoliceScannerAudioEntity::s_NextNewScannerDialogueTime = CTimer::m_snTimeInMilliseconds + 10000;
          CAEPoliceScannerAudioEntity::s_SlotState[1] = 1;
          CAEPoliceScannerAudioEntity::s_SlotState[0] = 1;
          CAEPoliceScannerAudioEntity::s_SlotState[2] = 1;
          CAEPoliceScannerAudioEntity::s_SlotState[3] = 1;
          CAEPoliceScannerAudioEntity::s_SlotState[4] = 1;
        }
      }
    }
  }
}

//----- (0039F5E0) --------------------------------------------------------
void CAEPoliceScannerAudioEntity::EnableScanner()
{
  CAEPoliceScannerAudioEntity::s_bScannerDisabled = 0;
}

//----- (0039F5F0) --------------------------------------------------------
bool __fastcall IsRemovedTrack(int index)
{
  char v1; // r3
  char v2; // r1
  char v3; // r2
  bool v4; // cf
  char v5; // r3
  unsigned int v6; // r0
  char v7; // r2

  v1 = 0;
  v2 = 0;
  if ( (unsigned int)(index - 294) < 7 )
    v1 = 1;
  v3 = ((unsigned int)(index - 513) < 7) | v1 | ((unsigned int)(index - 527) < 7) | ((unsigned int)(index - 848) < 7) | ((unsigned int)(index - 883) < 7) | ((unsigned int)(index - 932) < 7) | ((unsigned int)(index - 1118) < 7) | ((unsigned int)(index - 1152) < 6) | ((unsigned int)(index - 1301) < 0xE) | ((unsigned int)(index - 1556) < 0xE) | ((unsigned int)(index - 1706) < 7) | ((unsigned int)(index - 1741) < 7) | ((unsigned int)(index - 1754) < 0xE);
  v4 = (unsigned int)(index - 1782) >= 5;
  v5 = 0;
  v6 = index - 1809;
  if ( !v4 )
    v5 = 1;
  v7 = v3 | v5;
  if ( v6 < 5 )
    v2 = 1;
  return (v2 | v7) & 1;
}

//----- (0039F6E8) --------------------------------------------------------
bool __fastcall ReplaceTrack(int index, int *newTrack)
{
  int v2; // r0

  if ( (unsigned int)(index - 294) <= 6 )
  {
    v2 = index - 62;
LABEL_20:
    *newTrack = v2;
    return 1;
  }
  if ( (unsigned int)(index - 513) <= 6 )
  {
    v2 = index + 57;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 527) <= 6 )
  {
    v2 = index + 50;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 848) <= 6 )
  {
    v2 = index + 29;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 883) <= 6 )
  {
    v2 = index + 35;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 932) <= 6 )
  {
    v2 = index - 98;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1118) <= 6 )
    goto LABEL_14;
  if ( (unsigned int)(index - 1152) <= 5 )
  {
    v2 = index + 43;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1301) <= 6 || (unsigned int)(index - 1308) <= 6 )
  {
    v2 = index + 42;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1556) <= 0xD )
  {
    v2 = index + 49;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1706) <= 6 )
  {
LABEL_14:
    v2 = index + 28;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1741) <= 6 )
  {
    v2 = index + 27;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1754) <= 0xD )
  {
    v2 = index + 33;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1782) <= 4 )
  {
    v2 = index + 32;
    goto LABEL_20;
  }
  if ( (unsigned int)(index - 1809) <= 4 )
  {
    v2 = index - 89;
    goto LABEL_20;
  }
  if ( index == 177 )
  {
    v2 = 178;
    goto LABEL_20;
  }
  if ( index == 669 )
  {
    v2 = 670;
    goto LABEL_20;
  }
  return 0;
}

//----- (0039F7C0) --------------------------------------------------------
void __fastcall CAERadioTrackManager::Service(CAERadioTrackManager *this, int TrackPlayTime)
{
  tRadioSettings *p_m_ActiveSettings; // r6
  int m_nRadioStatus; // r0
  tRadioSettings *p_m_RequestedSettings; // r5
  __int64 v6; // d16
  __int64 v7; // d17
  __int64 v8; // d20
  __int64 v9; // d21
  __int64 v10; // d23
  __int64 v11; // d18
  __int64 v12; // d19
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  unsigned int RadioType; // r0
  __int64 v15; // d16
  __int64 v16; // d17
  __int64 v17; // d20
  __int64 v18; // d21
  __int64 v19; // d23
  __int64 v20; // d18
  __int64 v21; // d19
  tVehicleAudioSettings *v22; // r0
  unsigned int v23; // r0
  float BassFactor; // r2
  Int8 BassSetting; // r1
  Int32 v26; // r0
  Int8 v27; // r1
  Int8 v28; // r2
  CAERadioTrackManager *v29; // r0
  Int8 StationID; // r1
  int PlayTime; // r0
  char *v32; // r2
  Int32 v33; // r1
  Int32 PlayingTrackID; // r0
  __int64 v35; // r0
  int v36; // r2
  Int32 v37; // r0
  Int32 *v38; // r3
  __int64 v39; // d16
  __int64 v40; // d17
  __int64 v41; // kr08_8
  int v42; // r0
  int v43; // r6
  int v44; // r2
  Int32 v45; // r2
  Int32 *v46; // r3
  __int64 v47; // d16
  __int64 v48; // d17
  __int64 v49; // d18
  __int64 v50; // d19
  __int64 v51; // d20
  __int64 v52; // d21
  Int32 v53; // r5
  Int8 *MusicTrackIndices; // r0
  int v55; // r2
  Int32 v56; // r1
  Int32 *v57; // r3
  __int64 v58; // d16
  __int64 v59; // d17
  __int64 v60; // kr10_8
  int v61; // r1
  int v62; // r6
  int v63; // r2
  Int32 v64; // r2
  Int32 *v65; // r3
  __int64 v66; // d16
  __int64 v67; // d17
  __int64 v68; // d18
  __int64 v69; // d19
  __int64 v70; // d20
  __int64 v71; // d21
  Int32 v72; // r5
  Int8 pTrackIndex[17]; // [sp+Fh] [bp-11h] BYREF

  this->m_ActiveSettings.PlayTime = TrackPlayTime;
  this->m_ActiveSettings.TrackLengthMs = CAEAudioHardware::GetTrackLengthMs(&AEAudioHardware);
  p_m_ActiveSettings = &this->m_ActiveSettings;
  this->m_ActiveSettings.PlayingTrackID = CAEAudioHardware::GetPlayingTrackID(&AEAudioHardware);
  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
  {
    CAERadioTrackManager::CheckForStationRetuneDuringPause(this);
  }
  else
  {
    CAERadioTrackManager::CheckForMissionStatsChanges(0);
    CAERadioTrackManager::CheckForStationRetune(this);
  }
  if ( !this->m_bStationChangePending )
  {
LABEL_18:
    m_nRadioStatus = this->m_nRadioStatus;
    goto LABEL_19;
  }
  m_nRadioStatus = this->m_nRadioStatus;
  if ( m_nRadioStatus == 7 )
  {
    p_m_RequestedSettings = &this->m_RequestedSettings;
    if ( this->m_RequestedSettings.StationID == 13 )
    {
      v6 = *(_QWORD *)p_m_RequestedSettings->TrackIDs;
      v7 = *(_QWORD *)&this->m_RequestedSettings.TrackIDs[2];
      v8 = *(_QWORD *)&this->m_RequestedSettings.TrackIDs[4];
      v9 = *(_QWORD *)&this->m_RequestedSettings.PreviousTrackID;
      v10 = *(_QWORD *)&this->m_RequestedSettings.MusicTrackIndices[1];
      v11 = *(_QWORD *)&this->m_RequestedSettings.TrackLengthMs;
      v12 = *(_QWORD *)&this->m_RequestedSettings.BassFactor;
      *(_QWORD *)this->m_ActiveSettings.TrackTypes = *(_QWORD *)this->m_RequestedSettings.TrackTypes;
      *(_QWORD *)&this->m_ActiveSettings.MusicTrackIndices[1] = v10;
      *(_QWORD *)&this->m_ActiveSettings.TrackLengthMs = v11;
      *(_QWORD *)&this->m_ActiveSettings.BassFactor = v12;
      *(_QWORD *)p_m_ActiveSettings->TrackIDs = v6;
      *(_QWORD *)&this->m_ActiveSettings.TrackIDs[2] = v7;
      *(_QWORD *)&this->m_ActiveSettings.TrackIDs[4] = v8;
      *(_QWORD *)&this->m_ActiveSettings.PreviousTrackID = v9;
      PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
      if ( PlayerVehicleAudioSettingsForRadio )
      {
        RadioType = (unsigned __int8)PlayerVehicleAudioSettingsForRadio->RadioType;
        if ( RadioType <= 3 && RadioType != 1 )
          this->m_bDisplayNewStationName = 1;
      }
      this->m_bStationChangePending = 0;
    }
    else if ( !CAudioEngine::IsAmbienceTrackActive(&AudioEngine) )
    {
      v15 = *(_QWORD *)p_m_RequestedSettings->TrackIDs;
      v16 = *(_QWORD *)&this->m_RequestedSettings.TrackIDs[2];
      v17 = *(_QWORD *)&this->m_RequestedSettings.TrackIDs[4];
      v18 = *(_QWORD *)&this->m_RequestedSettings.PreviousTrackID;
      v19 = *(_QWORD *)&this->m_RequestedSettings.MusicTrackIndices[1];
      v20 = *(_QWORD *)&this->m_RequestedSettings.TrackLengthMs;
      v21 = *(_QWORD *)&this->m_RequestedSettings.BassFactor;
      *(_QWORD *)this->m_ActiveSettings.TrackTypes = *(_QWORD *)this->m_RequestedSettings.TrackTypes;
      *(_QWORD *)&this->m_ActiveSettings.MusicTrackIndices[1] = v19;
      *(_QWORD *)&this->m_ActiveSettings.TrackLengthMs = v20;
      *(_QWORD *)&this->m_ActiveSettings.BassFactor = v21;
      *(_QWORD *)p_m_ActiveSettings->TrackIDs = v15;
      *(_QWORD *)&this->m_ActiveSettings.TrackIDs[2] = v16;
      *(_QWORD *)&this->m_ActiveSettings.TrackIDs[4] = v17;
      *(_QWORD *)&this->m_ActiveSettings.PreviousTrackID = v18;
      this->m_nRadioStatus = 0;
      v22 = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
      if ( v22 )
      {
        v23 = (unsigned __int8)v22->RadioType;
        if ( v23 <= 3 && v23 != 1 )
          this->m_bDisplayNewStationName = 1;
      }
      this->m_bStationChangePending = 0;
    }
    goto LABEL_18;
  }
LABEL_19:
  switch ( m_nRadioStatus )
  {
    case 0:
      if ( this->m_ActiveSettings.PlayTime <= -1 )
        this->m_ActiveSettings.PlayTime = 0;
      if ( this->m_bUseBassEnhance )
      {
        BassFactor = this->m_ActiveSettings.BassFactor;
        BassSetting = this->m_ActiveSettings.BassSetting;
      }
      else
      {
        BassSetting = 0;
        BassFactor = this->m_ActiveSettings.BassFactor;
      }
      CAEAudioHardware::SetBassSetting(&AEAudioHardware, BassSetting, BassFactor);
      CAEAudioHardware::PlayTrack(
        &AEAudioHardware,
        this->m_ActiveSettings.TrackIDs[0],
        this->m_ActiveSettings.TrackIDs[1],
        this->m_ActiveSettings.PlayTime,
        this->m_ActiveSettings.TrackFlags,
        this->m_ActiveSettings.TrackTypes[0] == 7,
        this->m_ActiveSettings.TrackTypes[1] == 7);
      this->m_nRadioStatus = 1;
      return;
    case 1:
      PlayTime = this->m_ActiveSettings.PlayTime;
      if ( PlayTime == -8 )
      {
        HIDWORD(v35) = this->m_ActiveSettings.TrackIDs[1];
        LODWORD(v35) = this->m_ActiveSettings.PlayingTrackID;
        if ( (_DWORD)v35 == HIDWORD(v35) || (++HIDWORD(v35), v35 == p_m_ActiveSettings->TrackIDs[0]) )
        {
          this->m_ActiveSettings.TrackIDs[0] = CAERadioTrackManager::ChooseAdvertIndex(
                                                 (CAERadioTrackManager *)v35,
                                                 this->m_ActiveSettings.StationID);
          this->m_ActiveSettings.TrackTypes[0] = 1;
          pTrackIndex[0] = 1;
          CAERadioTrackManager::QueueUpTracksForStation(
            this,
            this->m_ActiveSettings.StationID,
            pTrackIndex,
            4,
            (int)this->m_ActiveSettings.TrackIDs);
          this->m_nRadioStatus = 0;
        }
      }
      else if ( PlayTime == -2 )
      {
        CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 35, 0.0, 1.0);
        CAEAudioHardware::SetChannelFlags(&AEAudioHardware, this->m_nHardwareClientHandle, 0, 55);
        CAEAudioHardware::StartTrackPlayback(&AEAudioHardware);
        CAERadioTrackManager::UpdateRadioVolumes(this);
        v32 = (char *)this + 44 * this->m_ActiveSettings.StationID;
        this->m_nLastPlayStartTimeMs = CTimer::m_snTimeInMilliseconds;
        *((_DWORD *)v32 + 67) = CTimer::m_snTimeInMillisecondsPauseMode;
        this->m_nRadioStatus = 2;
      }
      return;
    case 2:
      if ( this->m_ActiveSettings.PlayTime == -6 )
      {
        if ( CAEAudioHardware::GetActiveTrackID(&AEAudioHardware) != p_m_ActiveSettings->TrackIDs[0]
          || (v26 = this->m_ActiveSettings.TrackIDs[1], v26 == -1) )
        {
          pTrackIndex[0] = 0;
          CAERadioTrackManager::QueueUpTracksForStation(
            this,
            this->m_ActiveSettings.StationID,
            pTrackIndex,
            4,
            (int)this->m_ActiveSettings.TrackIDs);
          StationID = this->m_ActiveSettings.StationID;
          v29 = this;
        }
        else
        {
          v27 = this->m_ActiveSettings.TrackTypes[1];
          v28 = this->m_ActiveSettings.MusicTrackIndices[1];
          this->m_ActiveSettings.TrackIDs[0] = v26;
          this->m_ActiveSettings.TrackTypes[0] = v27;
          this->m_ActiveSettings.MusicTrackIndices[0] = v28;
          pTrackIndex[0] = 1;
          v29 = this;
          StationID = this->m_ActiveSettings.StationID;
        }
        CAERadioTrackManager::QueueUpTracksForStation(
          v29,
          StationID,
          pTrackIndex,
          4,
          (int)this->m_ActiveSettings.TrackIDs);
        this->m_nRadioStatus = 0;
      }
      v33 = this->m_ActiveSettings.TrackIDs[0];
      PlayingTrackID = this->m_ActiveSettings.PlayingTrackID;
      if ( v33 == PlayingTrackID )
      {
        switch ( this->m_ActiveSettings.TrackTypes[0] )
        {
          case 0:
            v36 = this->m_ActiveSettings.StationID;
            v37 = CAERadioTrackManager::m_nIdentIndexHistory[v36][0];
            if ( v37 != v33 )
            {
              v38 = CAERadioTrackManager::m_nIdentIndexHistory[v36];
              v39 = *(_QWORD *)(v38 + 1);
              v40 = *(_QWORD *)(v38 + 3);
              v41 = *(_QWORD *)(v38 + 5);
              v38[1] = v37;
              *((_QWORD *)v38 + 1) = v39;
              *((_QWORD *)v38 + 2) = v40;
              *((_QWORD *)v38 + 3) = v41;
              *v38 = v33;
            }
            break;
          case 1:
            v42 = this->m_ActiveSettings.StationID;
            if ( CAERadioTrackManager::m_nAdvertIndexHistory[v42][0] != v33 )
            {
              v43 = 0;
              do
              {
                CAERadioTrackManager::m_nAdvertIndexHistory[v42][v43 + 39] = CAERadioTrackManager::m_nAdvertIndexHistory[v42][v43 + 38];
                v44 = v43 + 39;
                --v43;
              }
              while ( v44 > 1 );
              CAERadioTrackManager::m_nAdvertIndexHistory[v42][0] = v33;
              goto LABEL_57;
            }
            break;
          case 2:
            v42 = this->m_ActiveSettings.StationID;
            v45 = CAERadioTrackManager::m_nDJBanterIndexHistory[v42][0];
            if ( v45 != v33 )
            {
              v46 = CAERadioTrackManager::m_nDJBanterIndexHistory[v42];
              v47 = *(_QWORD *)(v46 + 1);
              v48 = *(_QWORD *)(v46 + 3);
              v49 = *(_QWORD *)(v46 + 5);
              v50 = *(_QWORD *)(v46 + 7);
              v51 = *(_QWORD *)(v46 + 9);
              v52 = *(_QWORD *)(v46 + 11);
              v53 = v46[13];
              v46[1] = v45;
              *((_QWORD *)v46 + 1) = v47;
              *((_QWORD *)v46 + 2) = v48;
              *((_QWORD *)v46 + 5) = v51;
              *((_QWORD *)v46 + 6) = v52;
              *((_QWORD *)v46 + 3) = v49;
              *((_QWORD *)v46 + 4) = v50;
              v46[14] = v53;
              *v46 = v33;
LABEL_57:
              this->m_nTracksSinceLastAdvertOrDJList[v42] = 0;
            }
            break;
          case 3:
          case 4:
          case 5:
          case 7:
            CAERadioTrackManager::AddMusicTrackIndexToHistory(
              this,
              this->m_ActiveSettings.StationID,
              this->m_ActiveSettings.MusicTrackIndices[0]);
            break;
          default:
            break;
        }
        this->m_ActiveSettings.PlayingTrackType = this->m_ActiveSettings.TrackTypes[0];
        MusicTrackIndices = this->m_ActiveSettings.MusicTrackIndices;
      }
      else
      {
        if ( this->m_ActiveSettings.PreviousTrackID != PlayingTrackID )
          goto LABEL_70;
        switch ( this->m_ActiveSettings.PreviousTrackType )
        {
          case 0:
            v55 = this->m_ActiveSettings.StationID;
            v56 = CAERadioTrackManager::m_nIdentIndexHistory[v55][0];
            if ( v56 != PlayingTrackID )
            {
              v57 = CAERadioTrackManager::m_nIdentIndexHistory[v55];
              v58 = *(_QWORD *)(v57 + 1);
              v59 = *(_QWORD *)(v57 + 3);
              v60 = *(_QWORD *)(v57 + 5);
              v57[1] = v56;
              *((_QWORD *)v57 + 1) = v58;
              *((_QWORD *)v57 + 2) = v59;
              *((_QWORD *)v57 + 3) = v60;
              *v57 = PlayingTrackID;
            }
            break;
          case 1:
            v61 = this->m_ActiveSettings.StationID;
            if ( CAERadioTrackManager::m_nAdvertIndexHistory[v61][0] != PlayingTrackID )
            {
              v62 = 0;
              do
              {
                CAERadioTrackManager::m_nAdvertIndexHistory[v61][v62 + 39] = CAERadioTrackManager::m_nAdvertIndexHistory[v61][v62 + 38];
                v63 = v62 + 39;
                --v62;
              }
              while ( v63 > 1 );
              CAERadioTrackManager::m_nAdvertIndexHistory[v61][0] = PlayingTrackID;
              goto LABEL_67;
            }
            break;
          case 2:
            v61 = this->m_ActiveSettings.StationID;
            v64 = CAERadioTrackManager::m_nDJBanterIndexHistory[v61][0];
            if ( v64 != PlayingTrackID )
            {
              v65 = CAERadioTrackManager::m_nDJBanterIndexHistory[v61];
              v66 = *(_QWORD *)(v65 + 1);
              v67 = *(_QWORD *)(v65 + 3);
              v68 = *(_QWORD *)(v65 + 5);
              v69 = *(_QWORD *)(v65 + 7);
              v70 = *(_QWORD *)(v65 + 9);
              v71 = *(_QWORD *)(v65 + 11);
              v72 = v65[13];
              v65[1] = v64;
              *((_QWORD *)v65 + 1) = v66;
              *((_QWORD *)v65 + 2) = v67;
              *((_QWORD *)v65 + 5) = v70;
              *((_QWORD *)v65 + 6) = v71;
              *((_QWORD *)v65 + 3) = v68;
              *((_QWORD *)v65 + 4) = v69;
              v65[14] = v72;
              *v65 = PlayingTrackID;
LABEL_67:
              this->m_nTracksSinceLastAdvertOrDJList[v61] = 0;
            }
            break;
          case 3:
          case 4:
          case 5:
          case 7:
            CAERadioTrackManager::AddMusicTrackIndexToHistory(
              this,
              this->m_ActiveSettings.StationID,
              this->m_ActiveSettings.PreviousMusicTrackIndex);
            break;
          default:
            break;
        }
        this->m_ActiveSettings.PlayingTrackType = this->m_ActiveSettings.PreviousTrackType;
        MusicTrackIndices = &this->m_ActiveSettings.PreviousMusicTrackIndex;
      }
      this->m_ActiveSettings.PlayingTrackMusicTrackIndex = *MusicTrackIndices;
LABEL_70:
      CAERadioTrackManager::CheckForPause(this);
      CAERadioTrackManager::UpdateRadioVolumes(this);
      CAERadioTrackManager::CheckForTrackConcatenation(this);
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 35, 0.0, 1.0);
      return;
    case 3:
    case 5:
      CAEAudioHardware::StopTrack(&AEAudioHardware);
      this->m_nRadioStatus = 6;
      return;
    case 4:
      this->m_nRadioStatus = 5;
      return;
    case 6:
      switch ( this->m_ActiveSettings.PlayTime )
      {
        case 0xFFFFFFF8:
        case 0xFFFFFFFA:
          this->m_nRadioStatus = 7;
          break;
        case 0xFFFFFFF9:
        case 0xFFFFFFFE:
          CAEAudioHardware::StopTrack(&AEAudioHardware);
          break;
        default:
          return;
      }
      return;
    default:
      return;
  }
}

//----- (0039FDD4) --------------------------------------------------------
void __fastcall CAERadioTrackManager::CheckForStationRetuneDuringPause(CAERadioTrackManager *this)
{
  int StationID; // r0
  int m_nRetuneStationID; // r1
  float BassFactor; // r2
  Int8 BassSetting; // r3
  int *p_m_nRadioStatus; // r0
  unsigned int v7; // r1
  bool v8; // zf
  int v9; // r5
  bool v10; // zf
  Int32 v11; // r2
  int m_nRadioStatus; // r1
  bool v13; // zf
  int m_nRetunesPending; // r1
  bool v15; // zf

  StationID = (unsigned __int8)this->m_ActiveSettings.StationID;
  if ( StationID )
    goto LABEL_2;
  m_nRadioStatus = this->m_nRadioStatus;
  v13 = m_nRadioStatus == 7;
  if ( m_nRadioStatus == 7 )
    v13 = this->m_bStationChangePending == 0;
  if ( v13 )
  {
    m_nRetunesPending = this->m_nRetunesPending;
    v15 = m_nRetunesPending == 0;
    if ( !m_nRetunesPending )
      v15 = this->m_nPreviousRetunesPending == 0;
    if ( v15 )
    {
LABEL_2:
      m_nRetuneStationID = this->m_nRetuneStationID;
      if ( m_nRetuneStationID != 13 )
      {
        if ( m_nRetuneStationID >= 0 )
        {
          if ( StationID == 13 )
          {
            CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 37, 0.0, 1.0);
            this->m_ActiveSettings.StationID = -1;
          }
          else
          {
            CAudioEngine::StopRadio(&AudioEngine, 0, 1u);
          }
          CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 34, 0.0, 1.0);
          if ( CTimer::m_snTimeInMillisecondsPauseMode > this->m_nRetuneTimeMs + 700 )
          {
            CAERadioTrackManager::StartRadio(
              this,
              this->m_nRetuneStationID,
              this->m_ActiveSettings.BassSetting,
              this->m_ActiveSettings.BassFactor,
              0);
            this->m_nRetuneStationID = -1;
          }
        }
        return;
      }
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 38, 0.0, 1.0);
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 35, 0.0, 1.0);
      BassFactor = this->m_ActiveSettings.BassFactor;
      BassSetting = this->m_ActiveSettings.BassSetting;
      if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
      {
        p_m_nRadioStatus = &this->m_nRadioStatus;
        v7 = this->m_nRadioStatus;
        this->m_bPlayRadioDuringPause = 1;
        v8 = v7 == 7;
        if ( v7 == 7 )
          v8 = this->m_bStationChangePending == 0;
        if ( !v8 )
          goto LABEL_11;
        v9 = this->m_nRetunesPending;
        v10 = v9 == 0;
        if ( !v9 )
          v10 = this->m_nPreviousRetunesPending == 0;
        if ( v10 )
        {
          v7 = 7;
        }
        else
        {
LABEL_11:
          if ( this->m_ActiveSettings.StationID == 13 )
          {
            v11 = CTimer::m_snTimeInMillisecondsPauseMode;
LABEL_28:
            this->m_nRetuneStationID = -1;
            this->m_StationTrackingList[13].GameTimeWhenStartedMs = v11;
            return;
          }
        }
      }
      else
      {
        p_m_nRadioStatus = &this->m_nRadioStatus;
        v7 = this->m_nRadioStatus;
      }
      this->m_RequestedSettings.BassSetting = BassSetting;
      this->m_RequestedSettings.StationID = 13;
      this->m_RequestedSettings.BassFactor = BassFactor;
      v11 = -1;
      this->m_RequestedSettings.TrackTypes[0] = 6;
      this->m_RequestedSettings.MusicTrackIndices[0] = -1;
      this->m_RequestedSettings.TrackTypes[1] = 6;
      this->m_RequestedSettings.MusicTrackIndices[1] = -1;
      this->m_RequestedSettings.TrackTypes[2] = 6;
      this->m_RequestedSettings.MusicTrackIndices[2] = -1;
      this->m_RequestedSettings.TrackTypes[3] = 6;
      this->m_RequestedSettings.MusicTrackIndices[3] = -1;
      this->m_RequestedSettings.TrackIDs[4] = -1;
      this->m_RequestedSettings.TrackTypes[4] = 6;
      this->m_RequestedSettings.MusicTrackIndices[4] = -1;
      this->m_bStationChangePending = 1;
      *(_QWORD *)this->m_RequestedSettings.TrackIDs = -1LL;
      *(_QWORD *)&this->m_RequestedSettings.TrackIDs[2] = -1LL;
      if ( v7 <= 2 )
      {
        *p_m_nRadioStatus = 3;
        v11 = -1;
      }
      goto LABEL_28;
    }
  }
}

//----- (0039FF84) --------------------------------------------------------
void __fastcall CAERadioTrackManager::CheckForMissionStatsChanges(CAERadioTrackManager *this)
{
  int v1; // r0
  char v2; // r2
  int StatValue; // r0
  float v4; // r0
  float v5; // r0
  float v6; // r0
  float v7; // r0
  float v8; // r0
  float v9; // r0
  float v10; // r0
  float v11; // r0
  float v12; // r0
  float v13; // r0
  float v14; // r0
  float v15; // r0
  float v16; // r0
  float v17; // r0
  float v18; // r0
  float v19; // r0
  float v20; // r0
  float v21; // r0
  float v22; // r0
  float v23; // r0
  float v24; // r0
  float v25; // r0

  if ( CAERadioTrackManager::m_nSpecialDJBanterPending != 3 )
  {
    v1 = CClock::ms_nGameClockDays - CAERadioTrackManager::m_nStatsLastHitGameClockDays;
    if ( v1 <= -1 )
    {
      v2 = CClock::ms_nGameClockMonths - 1;
      if ( (char)(CClock::ms_nGameClockMonths - 1) < 0 )
        v2 = CClock::ms_nGameClockMonths + 11;
      v1 += CClock::daysInMonth[v2];
    }
    if ( CClock::ms_nGameClockHours + 24 * v1 - CAERadioTrackManager::m_nStatsLastHitGameClockHours >= CAERadioTrackManager::m_nStatsLastHitTimeOutHours )
      CAERadioTrackManager::m_nSpecialDJBanterPending = 3;
  }
  if ( CStats::GetStatValue(0xB5u) > (float)CAERadioTrackManager::m_nStatsCitiesPassed )
  {
    StatValue = (int)CStats::GetStatValue(0xB5u);
    CAERadioTrackManager::m_nStatsCitiesPassed = StatValue;
    if ( (unsigned __int8)(StatValue - 1) <= 1u )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = 24;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 1;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = StatValue - 1;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x147u) > (float)CAERadioTrackManager::m_nStatsPassedCasino3 )
  {
    v4 = CStats::GetStatValue(0x147u);
    CAERadioTrackManager::m_nStatsPassedCasino3 = (int)v4;
    if ( (int)v4 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 0;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x148u) > (float)CAERadioTrackManager::m_nStatsPassedCasino6 )
  {
    v5 = CStats::GetStatValue(0x148u);
    CAERadioTrackManager::m_nStatsPassedCasino6 = (int)v5;
    if ( (int)v5 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 1;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x149u) > (float)CAERadioTrackManager::m_nStatsPassedCasino10 )
  {
    v6 = CStats::GetStatValue(0x149u);
    CAERadioTrackManager::m_nStatsPassedCasino10 = (int)v6;
    if ( (int)v6 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 2;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x13Eu) > (float)CAERadioTrackManager::m_nStatsPassedCat1 )
  {
    v7 = CStats::GetStatValue(0x13Eu);
    CAERadioTrackManager::m_nStatsPassedCat1 = (int)v7;
    if ( (int)v7 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 3;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x140u) > (float)CAERadioTrackManager::m_nStatsPassedDesert1 )
  {
    v8 = CStats::GetStatValue(0x140u);
    CAERadioTrackManager::m_nStatsPassedDesert1 = (int)v8;
    if ( (int)v8 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 4;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x14Au) > (float)CAERadioTrackManager::m_nStatsPassedDesert3 )
  {
    v9 = CStats::GetStatValue(0x14Au);
    CAERadioTrackManager::m_nStatsPassedDesert3 = (int)v9;
    if ( (int)v9 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 5;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x14Bu) > (float)CAERadioTrackManager::m_nStatsPassedDesert5 )
  {
    v10 = CStats::GetStatValue(0x14Bu);
    CAERadioTrackManager::m_nStatsPassedDesert5 = (int)v10;
    if ( (int)v10 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 6;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x14Cu) > (float)CAERadioTrackManager::m_nStatsPassedDesert8 )
  {
    v11 = CStats::GetStatValue(0x14Cu);
    CAERadioTrackManager::m_nStatsPassedDesert8 = (int)v11;
    if ( (int)v11 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 7;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x14Du) > (float)CAERadioTrackManager::m_nStatsPassedDesert10 )
  {
    v12 = CStats::GetStatValue(0x14Du);
    CAERadioTrackManager::m_nStatsPassedDesert10 = (int)v12;
    if ( (int)v12 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 8;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x137u) > (float)CAERadioTrackManager::m_nStatsPassedFarlie3 )
  {
    v13 = CStats::GetStatValue(0x137u);
    CAERadioTrackManager::m_nStatsPassedFarlie3 = (int)v13;
    if ( (int)v13 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 9;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x143u) > (float)CAERadioTrackManager::m_nStatsPassedLAFin2 )
  {
    v14 = CStats::GetStatValue(0x143u);
    CAERadioTrackManager::m_nStatsPassedLAFin2 = (int)v14;
    if ( (int)v14 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 10;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x134u) > (float)CAERadioTrackManager::m_nStatsPassedMansion2 )
  {
    v15 = CStats::GetStatValue(0x134u);
    CAERadioTrackManager::m_nStatsPassedMansion2 = (int)v15;
    if ( (int)v15 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 11;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x136u) > (float)CAERadioTrackManager::m_nStatsPassedRyder2 )
  {
    v16 = CStats::GetStatValue(0x136u);
    CAERadioTrackManager::m_nStatsPassedRyder2 = (int)v16;
    if ( (int)v16 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 12;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x14Fu) > (float)CAERadioTrackManager::m_nStatsPassedRiot1 )
  {
    v17 = CStats::GetStatValue(0x14Fu);
    CAERadioTrackManager::m_nStatsPassedRiot1 = (int)v17;
    if ( (int)v17 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 13;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x150u) > (float)CAERadioTrackManager::m_nStatsPassedSCrash1 )
  {
    v18 = CStats::GetStatValue(0x150u);
    CAERadioTrackManager::m_nStatsPassedSCrash1 = (int)v18;
    if ( (int)v18 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 14;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x151u) > (float)CAERadioTrackManager::m_nStatsPassedStrap4 )
  {
    v19 = CStats::GetStatValue(0x151u);
    CAERadioTrackManager::m_nStatsPassedStrap4 = (int)v19;
    if ( (int)v19 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 15;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x12Eu) > (float)CAERadioTrackManager::m_nStatsPassedSweet2 )
  {
    v20 = CStats::GetStatValue(0x12Eu);
    CAERadioTrackManager::m_nStatsPassedSweet2 = (int)v20;
    if ( (int)v20 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 16;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x152u) > (float)CAERadioTrackManager::m_nStatsPassedTruth2 )
  {
    v21 = CStats::GetStatValue(0x152u);
    CAERadioTrackManager::m_nStatsPassedTruth2 = (int)v21;
    if ( (int)v21 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 17;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x153u) > (float)CAERadioTrackManager::m_nStatsPassedVCrash2 )
  {
    v22 = CStats::GetStatValue(0x153u);
    CAERadioTrackManager::m_nStatsPassedVCrash2 = (int)v22;
    if ( (int)v22 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 18;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x154u) > (float)CAERadioTrackManager::m_nStatsStartedBadlands )
  {
    v23 = CStats::GetStatValue(0x154u);
    CAERadioTrackManager::m_nStatsStartedBadlands = (int)v23;
    if ( (int)v23 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 19;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x155u) > (float)CAERadioTrackManager::m_nStatsStartedCat2 )
  {
    v24 = CStats::GetStatValue(0x155u);
    CAERadioTrackManager::m_nStatsStartedCat2 = (int)v24;
    if ( (int)v24 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 20;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
  if ( CStats::GetStatValue(0x156u) > (float)CAERadioTrackManager::m_nStatsStartedCrash1 )
  {
    v25 = CStats::GetStatValue(0x156u);
    CAERadioTrackManager::m_nStatsStartedCrash1 = (int)v25;
    if ( (int)v25 == 1 )
    {
      CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -88;
      CAERadioTrackManager::m_nSpecialDJBanterPending = 2;
      CAERadioTrackManager::m_nSpecialDJBanterIndex = 21;
      CAERadioTrackManager::m_nStatsLastHitGameClockDays = CClock::ms_nGameClockDays;
      CAERadioTrackManager::m_nStatsLastHitGameClockHours = CClock::ms_nGameClockHours;
    }
  }
}

//----- (003A117C) --------------------------------------------------------
void __fastcall CAERadioTrackManager::CheckForStationRetune(CAERadioTrackManager *this)
{
  int StationID; // r0
  unsigned int m_nRadioStatus; // r1
  int m_nRetunesPending; // r1
  bool v5; // zf
  int v6; // r0
  bool v7; // zf
  int v8; // r5
  float BassFactor; // r3
  CAERadioTrackManager *v10; // r0
  Int8 BassSetting; // r2
  Int8 v12; // r1
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  unsigned int RadioType; // r0
  int m_nScriptRetuneStationID; // r0
  int v16; // r2
  int v17; // r3
  UInt32 v18; // r0
  int v19; // r2
  CPad *Pad; // r0
  int v21; // r1
  int v22; // r1
  CPad *v23; // r0
  int v24; // r1

  StationID = (unsigned __int8)this->m_ActiveSettings.StationID;
  if ( !StationID )
    return;
  m_nRadioStatus = this->m_nRadioStatus;
  this->m_bRetuneStartedThisFrame = 0;
  if ( m_nRadioStatus < 3 || this->m_bStationChangePending )
    goto LABEL_25;
  m_nRetunesPending = this->m_nRetunesPending;
  v5 = m_nRetunesPending == 0;
  if ( !m_nRetunesPending )
    v5 = this->m_nPreviousRetunesPending == 0;
  if ( !v5 || StationID == 13 )
  {
LABEL_25:
    if ( !CAudioEngine::GetCutsceneTrackStatus(&AudioEngine) )
    {
      PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
      if ( PlayerVehicleAudioSettingsForRadio )
      {
        RadioType = (unsigned __int8)PlayerVehicleAudioSettingsForRadio->RadioType;
        if ( RadioType <= 3 && RadioType != 1 )
        {
          if ( CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio()->RadioType )
            return;
          m_nScriptRetuneStationID = this->m_nScriptRetuneStationID;
          if ( m_nScriptRetuneStationID < 0 )
          {
            Pad = CPad::GetPad(0);
            if ( CPad::NextStationJustUp(Pad) )
            {
              CWidgetHelpText::ConditionSatisfied(0x40u);
              v21 = this->m_nRetunesPending;
              this->m_nPreviousRetunesPending = v21;
              v22 = v21 + 1;
            }
            else
            {
              v23 = CPad::GetPad(0);
              if ( !CPad::LastStationJustUp(v23) )
                goto LABEL_8;
              CWidgetHelpText::ConditionSatisfied(0x40u);
              v24 = this->m_nRetunesPending;
              this->m_nPreviousRetunesPending = v24;
              v22 = v24 - 1;
            }
            this->m_nRetunesPending = v22;
            v18 = CTimer::m_snTimeInMilliseconds;
          }
          else
          {
            v16 = this->m_RequestedSettings.StationID;
            v17 = this->m_nRetunesPending;
            this->m_nScriptRetuneStationID = -1;
            this->m_nPreviousRetunesPending = v17;
            this->m_nRetunesPending = m_nScriptRetuneStationID - v16;
            v18 = CTimer::m_snTimeInMilliseconds;
          }
          this->m_bDisplayNewStationName = 1;
          this->m_nLastRetuneTimeMs = v18;
          this->m_bRetuneStartedThisFrame = 1;
        }
      }
    }
  }
LABEL_8:
  v6 = this->m_nRetunesPending;
  v7 = v6 == 0;
  if ( !v6 )
    v7 = this->m_nPreviousRetunesPending == 0;
  if ( !v7 )
  {
    v8 = v6 + (unsigned __int8)this->m_RequestedSettings.StationID;
    if ( v8 << 24 >= 0x1000000 )
    {
      if ( v8 << 24 > 218103808 )
        LOBYTE(v8) = v8 - 13;
    }
    else
    {
      LOBYTE(v8) = v8 + 13;
    }
    if ( (unsigned __int8)v8 == 12 )
    {
      if ( v6 >= 1 )
        LOBYTE(v8) = v8 + 1;
      else
        LOBYTE(v8) = v8 - 1;
    }
    if ( (unsigned __int8)v8 == 13 )
    {
      CAERadioTrackManager::StopRadio(this, 0, 0);
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 38, 0.0, 1.0);
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 35, 0.0, 1.0);
      BassFactor = this->m_ActiveSettings.BassFactor;
      v10 = this;
      BassSetting = this->m_ActiveSettings.BassSetting;
      v12 = 13;
LABEL_35:
      CAERadioTrackManager::StartRadio(v10, v12, BassSetting, BassFactor, 0);
      this->m_nRetunesPending = 0;
      this->m_nPreviousRetunesPending = 0;
      return;
    }
    if ( this->m_ActiveSettings.StationID == 13 )
    {
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 37, 0.0, 1.0);
      this->m_ActiveSettings.StationID = -1;
    }
    else
    {
      CAERadioTrackManager::StopRadio(this, 0, 0);
    }
    CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 34, 0.0, 1.0);
    if ( CTimer::m_snTimeInMilliseconds > this->m_nLastRetuneTimeMs + 1500 )
    {
      v19 = 2000;
      if ( TheCamera.m_CameraAverageSpeed > 0.9 )
        v19 = 4000;
      if ( CTimer::m_snTimeInMilliseconds > this->m_nLastPlayStartTimeMs + v19 )
      {
        BassFactor = this->m_ActiveSettings.BassFactor;
        BassSetting = this->m_ActiveSettings.BassSetting;
        v12 = v8;
        v10 = this;
        goto LABEL_35;
      }
    }
  }
}

//----- (003A1390) --------------------------------------------------------
Bool8 __fastcall CAERadioTrackManager::IsVehicleRadioActive(CAERadioTrackManager *this)
{
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  unsigned int RadioType; // r0

  PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
  if ( PlayerVehicleAudioSettingsForRadio
    && (RadioType = (unsigned __int8)PlayerVehicleAudioSettingsForRadio->RadioType, RadioType <= 3) )
  {
    return 0x1010001u >> (8 * RadioType);
  }
  else
  {
    return 0;
  }
}

//----- (003A13B4) --------------------------------------------------------
void __fastcall CAERadioTrackManager::StartTrackPlayback(CAERadioTrackManager *this)
{
  CAEAudioHardware::SetChannelFlags(&AEAudioHardware, this->m_nHardwareClientHandle, 0, 55);
  CAEAudioHardware::StartTrackPlayback(&AEAudioHardware);
  CAERadioTrackManager::UpdateRadioVolumes(this);
}

//----- (003A13E0) --------------------------------------------------------
char *__fastcall CAERadioTrackManager::QueueUpTracksForStation(
        CAERadioTrackManager *this,
        int Station,
        Int8 *pTrackIndex,
        int TrackType,
        int a5)
{
  Int32 v7; // r0
  bool v8; // zf
  char *result; // r0
  Int32 v10; // r0
  int v11; // r6
  int v12; // r5
  int v13; // r2
  int v14; // r1
  Int8 v15; // r0
  Int8 v16; // r0
  int (*v17)[2]; // r1
  int v18; // r2
  Int8 v19; // r0
  int v20; // r3
  int v21; // r6
  Int8 v22; // r0
  Int8 v23; // r1
  int v24; // r1
  int v25; // r0
  int v26; // r1
  bool v27; // cf
  bool v28; // cf
  bool v29; // cf
  bool v30; // cf
  bool v31; // cf
  bool v32; // cf
  bool v33; // cc

  switch ( TrackType )
  {
    case 0:
      if ( Station == 12 )
        return 0;
      v7 = CAERadioTrackManager::ChooseIdentIndex(this, Station);
      *(_DWORD *)(a5 + 4 * *pTrackIndex) = v7;
      v8 = v7 == -1;
      result = 0;
      if ( !v8 )
        goto LABEL_48;
      return result;
    case 1:
      *(_DWORD *)(a5 + 4 * *pTrackIndex) = CAERadioTrackManager::ChooseAdvertIndex(this, Station);
      result = (char *)&dword_0 + 1;
      goto LABEL_48;
    case 2:
      if ( Station == 12 )
        return 0;
      v10 = CAERadioTrackManager::ChooseDJBanterIndex(this, Station);
      *(_DWORD *)(a5 + 4 * *pTrackIndex) = v10;
      if ( v10 == -1 )
        return 0;
      result = (char *)&dword_0 + 2;
      goto LABEL_48;
    case 3:
      if ( Station == 12 )
        return 0;
      v11 = a5 + 51;
      v12 = Station;
      *(_BYTE *)(a5 + 51 + *pTrackIndex) = CAERadioTrackManager::ChooseMusicTrackIndex(this, Station);
      v13 = *(char *)(a5 + 51 + *pTrackIndex);
      *(_DWORD *)(a5 + 4 * *pTrackIndex) = CAEAudioUtility::GetRandomNumberInRange(
                                             gRadioMusicIntros[v12][v13][0],
                                             gRadioMusicIntros[v12][v13][1]);
      v14 = a5 + 44;
      *(_BYTE *)(v14 + *pTrackIndex) = 3;
      v15 = *pTrackIndex + 1;
      *pTrackIndex = v15;
      *(_BYTE *)(v11 + v15) = *(_BYTE *)(v11 + v15 - 1);
      *(_DWORD *)(a5 + 4 * *pTrackIndex) = gRadioMusicTracks[v12][*(char *)(a5 + 51 + *pTrackIndex)];
      *(_BYTE *)(v14 + *pTrackIndex) = 4;
      v16 = *pTrackIndex + 1;
      *pTrackIndex = v16;
      *(_BYTE *)(v11 + v16) = *(_BYTE *)(v11 + v16 - 1);
      v17 = gRadioMusicOutros[v12];
      v18 = *(char *)(a5 + 51 + *pTrackIndex);
      goto LABEL_46;
    case 4:
      v19 = CAERadioTrackManager::ChooseMusicTrackIndex(this, Station);
      v20 = a5 + 51;
      *(_BYTE *)(v20 + *pTrackIndex) = v19;
      v21 = -1;
      *(_DWORD *)(a5 + 4 * *pTrackIndex) = gRadioMusicTracks[Station][*(char *)(a5 + 51 + *pTrackIndex)];
      *(_BYTE *)(*pTrackIndex + a5 + 44) = 4;
      v22 = *pTrackIndex + 1;
      *pTrackIndex = v22;
      *(_BYTE *)(v20 + v22) = *(_BYTE *)(a5 + 51 + v22 - 1);
      v23 = *pTrackIndex;
      break;
    case 5:
      if ( Station == 12 )
        return 0;
      *(_BYTE *)(a5 + 51 + *pTrackIndex) = CAERadioTrackManager::ChooseMusicTrackIndex(this, Station);
      v18 = *(char *)(a5 + 51 + *pTrackIndex);
      v17 = gRadioMusicOutros[Station];
LABEL_46:
      *(_DWORD *)(a5 + 4 * *pTrackIndex) = CAEAudioUtility::GetRandomNumberInRange(v17[v18][0], v17[v18][1]);
      goto LABEL_47;
    default:
      return (_BYTE *)(&dword_0 + 1);
  }
  while ( 1 )
  {
    v24 = *(char *)(a5 + v23 + 51);
    *(_DWORD *)(a5 + 4 * *pTrackIndex) = CAEAudioUtility::GetRandomNumberInRange(
                                           gRadioMusicOutros[Station][v24][0],
                                           gRadioMusicOutros[Station][v24][1]);
    v25 = *pTrackIndex;
    v26 = *(_DWORD *)(a5 + 4 * v25);
    if ( (unsigned int)(v26 - 1809) >= 5 )
    {
      v27 = (unsigned int)(v26 - 1782) >= 5;
      if ( (unsigned int)(v26 - 1782) >= 5 )
        v27 = (unsigned int)(v26 - 1754) >= 0xE;
      if ( v27 )
      {
        v28 = (unsigned int)(v26 - 1741) >= 7;
        if ( (unsigned int)(v26 - 1741) >= 7 )
          v28 = (unsigned int)(v26 - 1706) >= 7;
        if ( v28 )
        {
          v29 = (unsigned int)(v26 - 1556) >= 0xE;
          if ( (unsigned int)(v26 - 1556) >= 0xE )
            v29 = (unsigned int)(v26 - 1301) >= 0xE;
          if ( v29 )
          {
            v30 = (unsigned int)(v26 - 1152) >= 6;
            if ( (unsigned int)(v26 - 1152) >= 6 )
              v30 = (unsigned int)(v26 - 1118) >= 7;
            if ( v30 )
            {
              v31 = (unsigned int)(v26 - 932) >= 7;
              if ( (unsigned int)(v26 - 932) >= 7 )
                v31 = (unsigned int)(v26 - 883) >= 7;
              if ( v31 )
              {
                v32 = (unsigned int)(v26 - 848) >= 7;
                if ( (unsigned int)(v26 - 848) >= 7 )
                  v32 = (unsigned int)(v26 - 527) >= 7;
                if ( v32 )
                {
                  v33 = (unsigned int)(v26 - 294) > 7;
                  if ( (unsigned int)(v26 - 294) >= 7 )
                    v33 = (unsigned int)(v26 - 513) > 6;
                  if ( v33 )
                    break;
                }
              }
            }
          }
        }
      }
    }
    ++v21;
    v23 = *pTrackIndex;
    if ( v21 >= 11 )
    {
      *(_DWORD *)(a5 + 4 * v25) = -1;
      break;
    }
  }
LABEL_47:
  LOBYTE(result) = 5;
LABEL_48:
  *(_BYTE *)((*pTrackIndex)++ + a5 + 44) = (_BYTE)result;
  return (_BYTE *)(&dword_0 + 1);
}
// 0: using guessed type int dword_0;

//----- (003A1684) --------------------------------------------------------
void __fastcall CAERadioTrackManager::AddMusicTrackIndexToHistory(
        CAERadioTrackManager *this,
        Int8 Station,
        Int8 MusicTrackIndex)
{
  int v3; // r12
  Int8 *v4; // r3
  __int64 v5; // d16
  __int64 v6; // d17
  Int8 v7; // r4
  Int8 v8; // r5

  if ( MusicTrackIndex >= 0 )
  {
    v3 = (unsigned __int8)CAERadioTrackManager::m_nMusicTrackIndexHistory[20 * Station];
    if ( v3 != (unsigned __int8)MusicTrackIndex )
    {
      v4 = &CAERadioTrackManager::m_nMusicTrackIndexHistory[20 * Station];
      v5 = *(_QWORD *)(v4 + 3);
      v6 = *(_QWORD *)(v4 + 11);
      v7 = v4[1];
      v8 = v4[2];
      v4[1] = v3;
      v4[2] = v7;
      *(_QWORD *)(v4 + 4) = v5;
      *(_QWORD *)(v4 + 12) = v6;
      v4[3] = v8;
      *v4 = MusicTrackIndex;
      ++this->m_nTracksSinceLastAdvertOrDJList[Station];
    }
  }
}

//----- (003A16E4) --------------------------------------------------------
void __fastcall CAERadioTrackManager::AddIdentIndexToHistory(
        CAERadioTrackManager *this,
        Int8 Station,
        Int32 IdentIndex)
{
  Int32 v3; // r0
  Int32 *v4; // r12
  __int64 v5; // d16
  __int64 v6; // d17
  __int64 v7; // kr00_8

  v3 = CAERadioTrackManager::m_nIdentIndexHistory[Station][0];
  if ( v3 != IdentIndex )
  {
    v4 = CAERadioTrackManager::m_nIdentIndexHistory[Station];
    v5 = *(_QWORD *)(v4 + 1);
    v6 = *(_QWORD *)(v4 + 3);
    v7 = *(_QWORD *)(v4 + 5);
    v4[1] = v3;
    *((_QWORD *)v4 + 1) = v5;
    *((_QWORD *)v4 + 2) = v6;
    *((_QWORD *)v4 + 3) = v7;
    *v4 = IdentIndex;
  }
}

//----- (003A1730) --------------------------------------------------------
void __fastcall CAERadioTrackManager::AddAdvertIndexToHistory(
        CAERadioTrackManager *this,
        Int8 Station,
        Int32 AdvertIndex)
{
  int v3; // r3
  int v4; // r4

  if ( CAERadioTrackManager::m_nAdvertIndexHistory[Station][0] != AdvertIndex )
  {
    v3 = 0;
    do
    {
      CAERadioTrackManager::m_nAdvertIndexHistory[Station][v3 + 39] = CAERadioTrackManager::m_nAdvertIndexHistory[Station][v3 + 38];
      v4 = v3 + 39;
      --v3;
    }
    while ( v4 > 1 );
    CAERadioTrackManager::m_nAdvertIndexHistory[Station][0] = AdvertIndex;
    this->m_nTracksSinceLastAdvertOrDJList[Station] = 0;
  }
}

//----- (003A1788) --------------------------------------------------------
void __fastcall CAERadioTrackManager::AddDJBanterIndexToHistory(
        CAERadioTrackManager *this,
        Int8 Station,
        Int32 DJBanterIndex)
{
  Int32 v3; // r12
  Int32 *v4; // r3
  __int64 v5; // d16
  __int64 v6; // d17
  __int64 v7; // d18
  __int64 v8; // d19
  __int64 v9; // d20
  __int64 v10; // d21
  Int32 v11; // r5

  v3 = CAERadioTrackManager::m_nDJBanterIndexHistory[Station][0];
  if ( v3 != DJBanterIndex )
  {
    v4 = CAERadioTrackManager::m_nDJBanterIndexHistory[Station];
    v5 = *(_QWORD *)(v4 + 1);
    v6 = *(_QWORD *)(v4 + 3);
    v7 = *(_QWORD *)(v4 + 5);
    v8 = *(_QWORD *)(v4 + 7);
    v9 = *(_QWORD *)(v4 + 9);
    v10 = *(_QWORD *)(v4 + 11);
    v11 = v4[13];
    v4[1] = v3;
    *((_QWORD *)v4 + 1) = v5;
    *((_QWORD *)v4 + 2) = v6;
    *((_QWORD *)v4 + 5) = v9;
    *((_QWORD *)v4 + 6) = v10;
    *((_QWORD *)v4 + 3) = v7;
    *((_QWORD *)v4 + 4) = v8;
    v4[14] = v11;
    *v4 = DJBanterIndex;
    this->m_nTracksSinceLastAdvertOrDJList[Station] = 0;
  }
}

//----- (003A17FC) --------------------------------------------------------
void __fastcall CAERadioTrackManager::CheckForPause(CAERadioTrackManager *this)
{
  float v2; // s0
  Bool8 v3; // r5
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  unsigned int RadioType; // r0

  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
  {
    v2 = 1.0;
    v3 = 1;
    if ( !this->m_bPlayRadioDuringPause )
      v2 = 0.0;
    goto LABEL_11;
  }
  PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
  if ( PlayerVehicleAudioSettingsForRadio )
  {
    RadioType = (unsigned __int8)PlayerVehicleAudioSettingsForRadio->RadioType;
    if ( RadioType <= 3 && RadioType != 1 )
    {
      v2 = 1.0;
      v3 = 0;
LABEL_11:
      this->m_bPausedLastFrame = v3;
      sub_19E094(&AEAudioHardware, this->m_nHardwareClientHandle, 0, v2);
      return;
    }
  }
  v3 = 0;
  if ( CAudioEngine::IsAmbienceRadioActive(&AudioEngine) )
  {
    v2 = 1.0;
    goto LABEL_11;
  }
  CAERadioTrackManager::StopRadio(this, 0, 0);
  CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 35, 0.0, 1.0);
  this->m_bPausedLastFrame = 0;
}

//----- (003A18AC) --------------------------------------------------------
void __fastcall CAERadioTrackManager::UpdateRadioVolumes(CAERadioTrackManager *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d3
  bool v4; // zf
  float v5; // s18
  float v6; // s16
  float EffectsMasterScalingFactor; // s16
  float MusicMasterScalingFactor; // r0
  float v9; // s0
  int BassSetting; // r0
  float v11; // s0
  CVector *MissionAudioPosition; // r1
  CVector *v13; // r1
  float v14; // s0
  CVector pRelativePosition; // [sp+4h] [bp-24h] BYREF

  v4 = (CTimer::m_UserPause || CTimer::m_CodePause) << 24 == 0;
  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
    v4 = this->m_bPlayRadioDuringPause == 0;
  if ( v4 )
  {
    if ( CTimer::GetIsSlowMotionActive() )
    {
      v6 = -100.0;
    }
    else if ( TheCamera.m_WideScreenOn )
    {
      v6 = -16.0;
    }
    else
    {
      v6 = -4.0;
      if ( CAEAudioHardware::GetEffectsMasterScalingFactor(&AEAudioHardware) > 0.0
        && CAEAudioHardware::GetMusicMasterScalingFactor(&AEAudioHardware) > 0.0 )
      {
        if ( !CAEPedSpeechAudioEntity::s_bForceAudible
          && (CAudioEngine::IsMissionAudioSampleFinished(&AudioEngine, 0)
           || CAudioEngine::GetMissionAudioEvent(&AudioEngine, 0) == 0xFFFF
           || (MissionAudioPosition = CAudioEngine::GetMissionAudioPosition(&AudioEngine, 0)) != 0
           && (CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, MissionAudioPosition),
               sqrtf(
                 (float)((float)(pRelativePosition.x * pRelativePosition.x)
                       + (float)(pRelativePosition.y * pRelativePosition.y))
               + (float)(pRelativePosition.z * pRelativePosition.z)) > 15.0))
          && (CAudioEngine::IsMissionAudioSampleFinished(&AudioEngine, 1u)
           || CAudioEngine::GetMissionAudioEvent(&AudioEngine, 1u) == 0xFFFF
           || (v13 = CAudioEngine::GetMissionAudioPosition(&AudioEngine, 1u)) != 0
           && (CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, v13),
               sqrtf(
                 (float)((float)(pRelativePosition.x * pRelativePosition.x)
                       + (float)(pRelativePosition.y * pRelativePosition.y))
               + (float)(pRelativePosition.z * pRelativePosition.z)) > 15.0)) )
        {
          v1.n64_u32[0] = LODWORD(this->m_fDialogueRadioDuckingVolume);
          if ( v1.n64_f32[0] < 0.0 )
          {
            v2.n64_u32[0] = 0;
            v1.n64_f32[0] = v1.n64_f32[0] + this->m_fDialogueRadioDuckingReleaseStep;
            v14 = vmin_f32(v1, v2).n64_f32[0];
            v6 = v14 + -4.0;
            this->m_fDialogueRadioDuckingVolume = v14;
          }
        }
        else
        {
          EffectsMasterScalingFactor = CAEAudioHardware::GetEffectsMasterScalingFactor(&AEAudioHardware);
          MusicMasterScalingFactor = CAEAudioHardware::GetMusicMasterScalingFactor(&AEAudioHardware);
          v2.n64_u32[0] = 0;
          v1.n64_f32[0] = (float)(log10f(EffectsMasterScalingFactor / MusicMasterScalingFactor) * 20.0) + -9.0;
          v9 = vmin_f32(v1, v2).n64_f32[0];
          this->m_fDialogueRadioDuckingVolume = v9;
          v6 = v9 + -4.0;
          this->m_fDialogueRadioDuckingReleaseStep = v9 / -50.0;
        }
      }
    }
    v5 = v6 + -20.0;
    if ( !CAudioEngine::IsAmbienceRadioActive(&AudioEngine) )
      v5 = v6;
  }
  else
  {
    v5 = -4.0;
  }
  if ( this->m_bUseBassEnhance )
  {
    BassSetting = this->m_ActiveSettings.BassSetting;
    if ( BassSetting == 2 )
    {
      v11 = 1.5;
      goto LABEL_20;
    }
    if ( BassSetting == 1 )
    {
      v11 = -2.0;
LABEL_20:
      v5 = v5 + v11;
    }
  }
  CAEAudioHardware::SetChannelVolume(&AEAudioHardware, this->m_nHardwareClientHandle, 0, v5, 0);
}
// 3A197E: variable 'v1' is possibly undefined
// 3A197E: variable 'v2' is possibly undefined

//----- (003A1B40) --------------------------------------------------------
void __fastcall CAERadioTrackManager::CheckForTrackConcatenation(CAERadioTrackManager *this)
{
  int ActiveTrackID; // r0
  int v3; // r1
  Int8 v4; // r6
  Int32 v5; // r5
  Int32 v6; // r2
  Int32 v7; // r8
  Int32 v8; // lr
  Int8 v9; // r12
  Int8 v10; // r1
  Int8 v11; // r0
  Int8 v12; // r1
  Int8 v13; // r3
  Int8 v14; // r0
  Int8 v15; // r1
  int StationID; // r0
  tRadioSettings *p_m_ActiveSettings; // r6
  CAERadioTrackManager *v18; // r0
  Int32 v19; // r0
  CAERadioTrackManager *v20; // r0
  bool v21; // zf
  Int32 v22; // r0
  Int8 v23; // r1
  CAERadioTrackManager *v24; // r0
  CAERadioTrackManager *v25; // r0
  int v26; // r5
  Int32 v27; // r0
  Int32 v28; // r0
  int v29; // r0
  Int32 v30; // r0
  Int8 pTrackIndex[17]; // [sp+Fh] [bp-11h] BYREF

  pTrackIndex[0] = 1;
  ActiveTrackID = CAEAudioHardware::GetActiveTrackID(&AEAudioHardware);
  v3 = this->m_ActiveSettings.TrackIDs[1];
  if ( ActiveTrackID == v3 && v3 >= 0 )
  {
    v4 = this->m_ActiveSettings.TrackTypes[0];
    v5 = this->m_ActiveSettings.TrackIDs[0];
    v6 = this->m_ActiveSettings.TrackIDs[2];
    v7 = this->m_ActiveSettings.TrackIDs[3];
    v8 = this->m_ActiveSettings.TrackIDs[4];
    v9 = this->m_ActiveSettings.TrackTypes[1];
    v10 = this->m_ActiveSettings.MusicTrackIndices[1];
    this->m_ActiveSettings.PreviousMusicTrackIndex = this->m_ActiveSettings.MusicTrackIndices[0];
    this->m_ActiveSettings.PreviousTrackType = v4;
    this->m_ActiveSettings.PreviousTrackID = v5;
    this->m_ActiveSettings.TrackIDs[0] = ActiveTrackID;
    this->m_ActiveSettings.TrackTypes[0] = v9;
    this->m_ActiveSettings.MusicTrackIndices[0] = v10;
    v11 = this->m_ActiveSettings.TrackTypes[2];
    v12 = this->m_ActiveSettings.MusicTrackIndices[2];
    this->m_ActiveSettings.TrackIDs[1] = v6;
    v13 = this->m_ActiveSettings.TrackTypes[3];
    this->m_ActiveSettings.TrackTypes[1] = v11;
    v14 = this->m_ActiveSettings.MusicTrackIndices[3];
    this->m_ActiveSettings.MusicTrackIndices[1] = v12;
    v15 = this->m_ActiveSettings.TrackTypes[4];
    this->m_ActiveSettings.TrackIDs[2] = v7;
    LOBYTE(v5) = this->m_ActiveSettings.MusicTrackIndices[4];
    this->m_ActiveSettings.TrackTypes[2] = v13;
    this->m_ActiveSettings.MusicTrackIndices[2] = v14;
    this->m_ActiveSettings.TrackIDs[3] = v8;
    this->m_ActiveSettings.TrackTypes[3] = v15;
    this->m_ActiveSettings.MusicTrackIndices[3] = v5;
    this->m_ActiveSettings.TrackIDs[4] = -1;
    this->m_ActiveSettings.TrackTypes[4] = 6;
    this->m_ActiveSettings.MusicTrackIndices[4] = -1;
    if ( v6 != -1 )
    {
LABEL_21:
      CAEAudioHardware::PlayTrack(
        &AEAudioHardware,
        this->m_ActiveSettings.TrackIDs[0],
        this->m_ActiveSettings.TrackIDs[1],
        0,
        this->m_ActiveSettings.TrackFlags,
        this->m_ActiveSettings.TrackTypes[0] == 7,
        this->m_ActiveSettings.TrackTypes[1] == 7);
      return;
    }
    StationID = this->m_ActiveSettings.StationID;
    p_m_ActiveSettings = &this->m_ActiveSettings;
    if ( (unsigned __int8)StationID == 12 )
    {
      if ( !FrontEndMenuManager.m_PrefsPlayMode )
      {
        v18 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.17);
        if ( v18 )
        {
          v19 = CAERadioTrackManager::ChooseAdvertIndex(v18, 12);
          this->m_ActiveSettings.TrackTypes[1] = 1;
          this->m_ActiveSettings.TrackIDs[1] = v19;
          pTrackIndex[0] = 2;
        }
      }
      CAERadioTrackManager::QueueUpTracksForStation(this, 12, pTrackIndex, 4, (int)this->m_ActiveSettings.TrackIDs);
      CAERadioTrackManager::QueueUpTracksForStation(this, 12, pTrackIndex, 4, (int)this->m_ActiveSettings.TrackIDs);
      goto LABEL_21;
    }
    if ( (unsigned __int8)(v9 - 3) > 2u )
    {
      v23 = this->m_ActiveSettings.StationID;
LABEL_20:
      CAERadioTrackManager::QueueUpTracksForStation(this, v23, pTrackIndex, 3, (int)this->m_ActiveSettings.TrackIDs);
      goto LABEL_21;
    }
    if ( !(_BYTE)StationID )
    {
      v27 = CAERadioTrackManager::ChooseDJBanterIndex(this, 0);
      this->m_ActiveSettings.TrackIDs[1] = v27;
      if ( v27 != -1 )
      {
        this->m_ActiveSettings.TrackTypes[1] = 2;
        pTrackIndex[0] = 2;
      }
      goto LABEL_21;
    }
    if ( this->m_nTracksSinceLastAdvertOrDJList[StationID] <= 1 && CAEAudioUtility::ResolveProbability(0.5) )
    {
      v20 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.5);
      v21 = v20 == 0;
      if ( v20 )
      {
        v20 = (CAERadioTrackManager *)(unsigned __int8)this->m_ActiveSettings.StationID;
        v21 = v20 == (CAERadioTrackManager *)&byte_9[3];
      }
      if ( !v21 )
      {
        v22 = CAERadioTrackManager::ChooseIdentIndex(v20, (Int8)v20);
        this->m_ActiveSettings.TrackIDs[1] = v22;
        if ( v22 != -1 )
        {
          this->m_ActiveSettings.TrackTypes[1] = 0;
          pTrackIndex[0] = 2;
        }
      }
      v23 = this->m_ActiveSettings.StationID;
      goto LABEL_20;
    }
    if ( !CAEAudioUtility::ResolveProbability(0.5) )
      goto LABEL_31;
    v24 = (CAERadioTrackManager *)(unsigned __int8)this->m_ActiveSettings.StationID;
    if ( v24 == (CAERadioTrackManager *)&byte_9[3] )
    {
      v25 = (CAERadioTrackManager *)(byte_9 + 3);
      v26 = 1;
      goto LABEL_37;
    }
    v28 = CAERadioTrackManager::ChooseIdentIndex(v24, (Int8)v24);
    this->m_ActiveSettings.TrackIDs[1] = v28;
    if ( v28 == -1 )
    {
LABEL_31:
      v26 = 1;
    }
    else
    {
      v26 = 2;
      this->m_ActiveSettings.TrackTypes[1] = 0;
      pTrackIndex[0] = 2;
    }
    v29 = (unsigned __int8)this->m_ActiveSettings.StationID;
    if ( v29 == 12 )
    {
      v25 = (CAERadioTrackManager *)(byte_9 + 3);
    }
    else
    {
      v30 = CAERadioTrackManager::ChooseDJBanterIndex(this, v29);
      this->m_ActiveSettings.TrackIDs[(unsigned __int8)v26] = v30;
      if ( v30 != -1 )
      {
        this->m_ActiveSettings.TrackTypes[(unsigned __int8)v26] = 2;
LABEL_38:
        pTrackIndex[0] = v26 + 1;
        goto LABEL_21;
      }
      v25 = (CAERadioTrackManager *)(unsigned __int8)this->m_ActiveSettings.StationID;
    }
LABEL_37:
    p_m_ActiveSettings->TrackIDs[v26] = CAERadioTrackManager::ChooseAdvertIndex(v25, (Int8)v25);
    p_m_ActiveSettings->TrackTypes[v26] = 1;
    goto LABEL_38;
  }
}

//----- (003A1DA0) --------------------------------------------------------
void __fastcall CAERadioTrackManager::Reset(CAERadioTrackManager *this)
{
  Int32 (*v2)[15]; // r10
  Int32 (*v3)[40]; // r11
  Int32 (*v4)[8]; // r4
  Int8 *v5; // r5
  Int32 *FullFavoriteRadioStationList; // r1
  __int64 v7; // d20
  __int64 *v8; // r0
  __int64 v9; // d16
  __int64 v10; // d17
  __int64 v11; // d22
  __int64 v12; // d23
  int v13; // r9
  __int64 v14; // d18
  __int64 v15; // d19
  Int32 *v16; // r0
  int v17; // r6
  Bool8 *v18; // r0
  __int64 v19; // d18
  __int64 v20; // d19
  __int64 v21; // d20
  __int64 v22; // d21
  __int64 v23; // d16
  __int64 v24; // d17
  __int64 v25; // d18
  __int64 v26; // d19
  Bool8 value; // r1
  CAERadioTrackManager *v28; // [sp+4h] [bp-44h]

  *(_WORD *)&this->m_bStationChangePending = 0;
  v2 = CAERadioTrackManager::m_nDJBanterIndexHistory;
  v3 = CAERadioTrackManager::m_nAdvertIndexHistory;
  v4 = CAERadioTrackManager::m_nIdentIndexHistory;
  v5 = CAERadioTrackManager::m_nMusicTrackIndexHistory;
  FullFavoriteRadioStationList = CStats::GetFullFavoriteRadioStationList();
  v7 = *((_QWORD *)FullFavoriteRadioStationList + 6);
  v8 = (__int64 *)(FullFavoriteRadioStationList + 8);
  v9 = *(_QWORD *)FullFavoriteRadioStationList;
  v10 = *((_QWORD *)FullFavoriteRadioStationList + 1);
  FullFavoriteRadioStationList += 4;
  v11 = *v8;
  v12 = v8[1];
  v13 = 0;
  v14 = *(_QWORD *)FullFavoriteRadioStationList;
  v15 = *((_QWORD *)FullFavoriteRadioStationList + 1);
  *(_QWORD *)this->m_nStationListenTimes = v9;
  *(_QWORD *)&this->m_nStationListenTimes[2] = v10;
  *(_QWORD *)&this->m_nStationListenTimes[12] = v7;
  *(_QWORD *)&this->m_nStationListenTimes[8] = v11;
  *(_QWORD *)&this->m_nStationListenTimes[10] = v12;
  v16 = &this->m_nStationListenTimes[4];
  v28 = this;
  v17 = 8;
  *(_QWORD *)v16 = v14;
  *((_QWORD *)v16 + 1) = v15;
  do
  {
    *((_DWORD *)v5 + 4) = -1;
    *((_DWORD *)v5 + 3) = -1;
    *((_DWORD *)v5 + 2) = -1;
    *((_DWORD *)v5 + 1) = -1;
    *(_DWORD *)v5 = -1;
    (*v4)[0] = -1;
    (*v4)[1] = -1;
    (*v4)[2] = -1;
    (*v4)[3] = -1;
    (*v4)[4] = -1;
    (*v4)[5] = -1;
    (*v4)[6] = -1;
    (*v4)[7] = -1;
    memset(v3, 255, sizeof(Int32[40]));
    memset(v2, 255, sizeof(Int32[15]));
    v5 += 20;
    ++v4;
    ++v3;
    v18 = &v28->m_bStationChangePending + v13;
    v13 += 44;
    ++v2;
    *((_QWORD *)v18 + 34) = -1LL;
    *((_QWORD *)v18 + 35) = -1LL;
    *((_QWORD *)v18 + 32) = 0LL;
    *((_QWORD *)v18 + 33) = 0xFFFFFFFF00000000LL;
    v18[296] = -1;
    *((_DWORD *)v18 + 72) = -1;
    *((_DWORD *)v18 + 73) = -16382458;
    *(&v28->m_bStationChangePending + v17++) = 0;
  }
  while ( v13 != 616 );
  v28->m_RequestedSettings.StationID = CAEAudioUtility::GetRandomNumberInRange(1, 13);
  v28->m_RequestedSettings.BassSetting = 0;
  v28->m_RequestedSettings.TrackFlags = 2;
  v28->m_RequestedSettings.MusicTrackIndices[0] = -1;
  v28->m_RequestedSettings.MusicTrackIndices[1] = -1;
  v28->m_RequestedSettings.TrackTypes[1] = 6;
  v28->m_RequestedSettings.MusicTrackIndices[2] = -1;
  v28->m_RequestedSettings.TrackTypes[2] = 6;
  v28->m_RequestedSettings.MusicTrackIndices[3] = -1;
  v28->m_RequestedSettings.TrackTypes[3] = 6;
  v28->m_RequestedSettings.MusicTrackIndices[4] = -1;
  v28->m_RequestedSettings.TrackTypes[4] = 6;
  *(_QWORD *)v28->m_RequestedSettings.TrackIDs = -1LL;
  *(_QWORD *)&v28->m_RequestedSettings.TrackIDs[2] = -1LL;
  v28->m_RequestedSettings.TrackTypes[0] = 6;
  v28->m_RequestedSettings.TrackLengthMs = 0;
  v19 = *(_QWORD *)&v28->m_RequestedSettings.TrackLengthMs;
  v20 = *(_QWORD *)&v28->m_RequestedSettings.BassFactor;
  *(_WORD *)&v28->m_RequestedSettings.PlayingTrackType = 1542;
  *(_WORD *)&v28->m_RequestedSettings.PlayingTrackMusicTrackIndex = -1;
  v21 = *(_QWORD *)v28->m_RequestedSettings.TrackTypes;
  v22 = *(_QWORD *)&v28->m_RequestedSettings.MusicTrackIndices[1];
  *(_QWORD *)&v28->m_RequestedSettings.TrackIDs[4] = -1LL;
  *(_QWORD *)&v28->m_RequestedSettings.PreviousTrackID = 0xFFFFFFFFLL;
  v23 = *(_QWORD *)&v28->m_RequestedSettings.TrackIDs[4];
  v24 = *(_QWORD *)&v28->m_RequestedSettings.PreviousTrackID;
  *(_QWORD *)&v28->m_ActiveSettings.TrackLengthMs = v19;
  *(_QWORD *)&v28->m_ActiveSettings.BassFactor = v20;
  v25 = *(_QWORD *)v28->m_RequestedSettings.TrackIDs;
  v26 = *(_QWORD *)&v28->m_RequestedSettings.TrackIDs[2];
  *(_QWORD *)v28->m_ActiveSettings.TrackTypes = v21;
  *(_QWORD *)&v28->m_ActiveSettings.MusicTrackIndices[1] = v22;
  *(_QWORD *)&v28->m_ActiveSettings.TrackIDs[4] = v23;
  *(_QWORD *)&v28->m_ActiveSettings.PreviousTrackID = v24;
  *(_QWORD *)v28->m_ActiveSettings.TrackIDs = v25;
  *(_QWORD *)&v28->m_ActiveSettings.TrackIDs[2] = v26;
  *(_WORD *)&v28->m_nLastVehicleExitGameClockDays = -1;
  v28->m_nLastVehicleStationID = -1;
  v28->m_nRetuneStationID = -1;
  v28->m_nScriptRetuneStationID = -1;
  v28->m_nRetunesPending = 0;
  v28->m_nPreviousRetunesPending = 0;
  v28->m_nLastRetuneTimeMs = 0;
  v28->m_nStationNameDisplayEndTimeMs = 0;
  v28->m_nLastVehicleExitTimeMs = 0;
  v28->m_nRetuneTimeMs = 0;
  v28->m_nLastPlayStartTimeMs = 0;
  *(_WORD *)&v28->m_bReadyToRetune = 0;
  value = MobileSettings::settings[13].value;
  v28->m_bUseBassEnhance = 1;
  v28->m_bUseRadioAutoRetune = value;
  CAERadioTrackManager::m_nSpecialDJBanterIndex = -1;
  CAERadioTrackManager::m_nSpecialDJBanterPending = 3;
  v28->m_fDialogueRadioDuckingVolume = 0.0;
  v28->m_fDialogueRadioDuckingReleaseStep = 0.0;
  *(_WORD *)&v28->m_bPausedLastFrame = 0;
  CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -1;
  CAERadioTrackManager::m_nStatsPassedVCrash2 = 0;
  CAERadioTrackManager::m_nStatsStartedBadlands = 0;
  CAERadioTrackManager::m_nStatsPassedCasino3 = 0;
  CAERadioTrackManager::m_nStatsPassedTruth2 = 0;
  CAERadioTrackManager::m_nStatsStartedCat2 = 0;
  CAERadioTrackManager::m_nStatsLastHitGameClockHours = -1;
  CAERadioTrackManager::m_nStatsPassedCasino6 = 0;
  CAERadioTrackManager::m_nStatsStartedCrash1 = 0;
  CAERadioTrackManager::m_nStatsLastHitGameClockDays = -1;
  CAERadioTrackManager::m_nStatsPassedCasino10 = 0;
  CAERadioTrackManager::m_nStatsCitiesPassed = 0;
  CAERadioTrackManager::m_nStatsPassedCat1 = 0;
  CAERadioTrackManager::m_nStatsPassedStrap4 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert1 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert3 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert5 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert8 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert10 = 0;
  CAERadioTrackManager::m_nStatsPassedFarlie3 = 0;
  CAERadioTrackManager::m_nStatsPassedLAFin2 = 0;
  CAERadioTrackManager::m_nStatsPassedMansion2 = 0;
  CAERadioTrackManager::m_nStatsPassedRyder2 = 0;
  CAERadioTrackManager::m_nStatsPassedRiot1 = 0;
  CAERadioTrackManager::m_nStatsPassedSCrash1 = 0;
  CAERadioTrackManager::m_nStatsPassedSweet2 = 0;
}

//----- (003A2134) --------------------------------------------------------
void __fastcall CAERadioTrackManager::ResetStatistics(CAERadioTrackManager *this)
{
  CAERadioTrackManager::m_nStatsLastHitGameClockDays = -1;
  CAERadioTrackManager::m_nStatsCitiesPassed = 0;
  CAERadioTrackManager::m_nStatsPassedTruth2 = 0;
  CAERadioTrackManager::m_nStatsPassedVCrash2 = 0;
  CAERadioTrackManager::m_nStatsLastHitTimeOutHours = -1;
  CAERadioTrackManager::m_nStatsStartedBadlands = 0;
  CAERadioTrackManager::m_nStatsLastHitGameClockHours = -1;
  CAERadioTrackManager::m_nStatsStartedCat2 = 0;
  CAERadioTrackManager::m_nStatsStartedCrash1 = 0;
  CAERadioTrackManager::m_nStatsPassedCasino3 = 0;
  CAERadioTrackManager::m_nStatsPassedStrap4 = 0;
  CAERadioTrackManager::m_nStatsPassedCasino6 = 0;
  CAERadioTrackManager::m_nStatsPassedCasino10 = 0;
  CAERadioTrackManager::m_nStatsPassedCat1 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert1 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert3 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert5 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert8 = 0;
  CAERadioTrackManager::m_nStatsPassedDesert10 = 0;
  CAERadioTrackManager::m_nStatsPassedFarlie3 = 0;
  CAERadioTrackManager::m_nStatsPassedLAFin2 = 0;
  CAERadioTrackManager::m_nStatsPassedMansion2 = 0;
  CAERadioTrackManager::m_nStatsPassedRyder2 = 0;
  CAERadioTrackManager::m_nStatsPassedRiot1 = 0;
  CAERadioTrackManager::m_nStatsPassedSCrash1 = 0;
  CAERadioTrackManager::m_nStatsPassedSweet2 = 0;
}

//----- (003A2288) --------------------------------------------------------
void __fastcall CAERadioTrackManager::StartRadio(
        CAERadioTrackManager *this,
        int Station,
        Int8 BassSetting,
        float BassFactor,
        Bool8 a5)
{
  Int8 v7; // r5
  int m_nRadioStatus; // r0
  bool v9; // zf
  Int8 *p_StationID; // r4
  unsigned int v12; // r0

  v7 = Station;
  if ( Station >= 13 )
    v7 = 13;
  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
  {
    m_nRadioStatus = this->m_nRadioStatus;
    this->m_bPlayRadioDuringPause = 1;
    if ( m_nRadioStatus != 7 )
      goto LABEL_8;
    v9 = this->m_bStationChangePending == 0;
    if ( !this->m_bStationChangePending )
      v9 = this->m_nRetunesPending == 0;
    if ( !v9 || this->m_nPreviousRetunesPending )
    {
LABEL_8:
      if ( v7 == this->m_ActiveSettings.StationID )
      {
        this->m_StationTrackingList[v7].GameTimeWhenStartedMs = CTimer::m_snTimeInMillisecondsPauseMode;
        return;
      }
    }
  }
  if ( Station <= 12 )
  {
    if ( CAudioEngine::IsAmbienceTrackActive(&AudioEngine) )
    {
      if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24)
        && CAudioEngine::DoesAmbienceTrackOverrideRadio(&AudioEngine) )
      {
        sub_18FDC4(&AudioEngine, 35, 0.0, 1.0);
        return;
      }
      CAudioEngine::StopAmbienceTrack(&AudioEngine, 0);
    }
    this->m_RequestedSettings.BassSetting = BassSetting;
    this->m_RequestedSettings.BassFactor = BassFactor;
    this->m_RequestedSettings.StationID = v7;
    p_StationID = &this->m_RequestedSettings.StationID;
    if ( this->m_StationTrackingList[v7].GameTimeWhenStoppedMs >= 0 )
    {
      if ( CAERadioTrackManager::TrackRadioStation(this, v7, a5) )
        goto LABEL_20;
      v7 = *p_StationID;
    }
    CAERadioTrackManager::ChooseTracksForStation(this, v7);
    this->m_RequestedSettings.PlayTime = CAEAudioUtility::GetRandomNumberInRange(0, (Int32)&stru_493DC.st_value);
    goto LABEL_20;
  }
  this->m_RequestedSettings.StationID = v7;
  p_StationID = &this->m_RequestedSettings.StationID;
  this->m_RequestedSettings.BassSetting = BassSetting;
  this->m_RequestedSettings.MusicTrackIndices[0] = -1;
  *(_WORD *)this->m_RequestedSettings.TrackTypes = 1542;
  this->m_RequestedSettings.MusicTrackIndices[1] = -1;
  this->m_RequestedSettings.TrackTypes[2] = 6;
  this->m_RequestedSettings.MusicTrackIndices[2] = -1;
  this->m_RequestedSettings.TrackTypes[3] = 6;
  this->m_RequestedSettings.MusicTrackIndices[3] = -1;
  this->m_RequestedSettings.TrackIDs[4] = -1;
  this->m_RequestedSettings.TrackTypes[4] = 6;
  this->m_RequestedSettings.MusicTrackIndices[4] = -1;
  *(_QWORD *)this->m_RequestedSettings.TrackIDs = -1LL;
  *(_QWORD *)&this->m_RequestedSettings.TrackIDs[2] = -1LL;
  this->m_RequestedSettings.BassFactor = BassFactor;
LABEL_20:
  v12 = this->m_nRadioStatus;
  this->m_bStationChangePending = 1;
  if ( v12 <= 2 )
    this->m_nRadioStatus = 3;
  this->m_StationTrackingList[*p_StationID].GameTimeWhenStartedMs = -1;
}
// 493DC: using guessed type Elf32_Sym stru_493DC;

//----- (003A242C) --------------------------------------------------------
Bool8 __fastcall CAERadioTrackManager::IsRadioOn(CAERadioTrackManager *this)
{
  int m_nRadioStatus; // r1
  bool v2; // zf
  int m_nRetunesPending; // r1
  bool v4; // zf

  m_nRadioStatus = this->m_nRadioStatus;
  v2 = m_nRadioStatus == 7;
  if ( m_nRadioStatus == 7 )
    v2 = this->m_bStationChangePending == 0;
  if ( !v2 )
    return 1;
  m_nRetunesPending = this->m_nRetunesPending;
  v4 = m_nRetunesPending == 0;
  if ( !m_nRetunesPending )
    v4 = this->m_nPreviousRetunesPending == 0;
  return !v4;
}

//----- (003A244C) --------------------------------------------------------
Bool8 __fastcall CAERadioTrackManager::TrackRadioStation(CAERadioTrackManager *this, Int8 Station, Bool8 bSkipTrack)
{
  int v3; // r3
  float32x2_t v4; // d0
  float32x2_t v5; // d1
  int v6; // r11
  char *v8; // r0
  int v9; // r1
  bool v10; // nf
  int v11; // r3
  char v12; // r5
  Bool8 v13; // r6
  char *v14; // r0
  float32x2_t v15; // d0
  int v16; // r6
  int v17; // r1
  int *v18; // r0
  tRadioSettings *p_m_RequestedSettings; // r9
  int v20; // r1
  Bool8 *v21; // r0
  int v22; // r2
  int v23; // r10
  CAERadioTrackManager *v24; // r0
  Int32 v25; // r0
  int v26; // r1
  Int8 v27; // r0
  int v28; // r1
  int v29; // r0
  char *v30; // r1
  int v31; // r2
  Int8 *v32; // r1
  Int8 v33; // r1
  Int8 v34; // r3
  char *v35; // r2
  char *v36; // r3
  int v37; // r1
  int v38; // r0
  char *v39; // r2
  Int32 v40; // r6
  int v41; // r0
  CAERadioTrackManager *v42; // r0
  int v43; // r8
  char *v44; // r2
  Int32 v45; // r6
  int v46; // r0
  Int32 v47; // r1
  Int32 v48; // r0
  int v49; // r0
  int v50; // r0
  Int32 v51; // r0
  Int32 v52; // r0
  int v53; // r0
  Int32 RandomNumberInRange; // r0
  int v55; // r8
  CAERadioTrackManager *v56; // r0
  Int32 v57; // r0
  Int32 v58; // r0
  Int32 v59; // r0
  unsigned __int8 v60; // r8
  Int32 v61; // r0
  char *v62; // r5
  Int32 *v63; // r5
  Bool8 *v64; // r0
  char v65; // r1
  Int8 pTrackIndex[29]; // [sp+Bh] [bp-1Dh] BYREF

  v6 = Station;
  v8 = (char *)this + 44 * Station;
  pTrackIndex[0] = 0;
  v9 = v8[296];
  v10 = v9 < 0;
  if ( v9 >= 0 )
  {
    v3 = v8[295];
    v10 = v3 < 0;
  }
  if ( !v10 )
  {
    v11 = CClock::ms_nGameClockDays - v3;
    if ( v11 <= -1 )
    {
      v12 = CClock::ms_nGameClockMonths - 1;
      if ( (char)(CClock::ms_nGameClockMonths - 1) < 0 )
        v12 = CClock::ms_nGameClockMonths + 11;
      v11 += CClock::daysInMonth[v12];
    }
    if ( CClock::ms_nGameClockHours + 24 * v11 - v9 > 5 )
      return 0;
  }
  v4.n64_u32[0] = 1171963904;
  v5.n64_u32[0] = CTimer::m_snTimeInMilliseconds - *((_DWORD *)v8 + 68);
  v14 = (char *)this + 44 * (__int16)v6;
  v5.n64_f32[0] = (float)v5.n64_i32[0];
  v15.n64_u64[0] = vmax_f32(v5, v4).n64_u64[0];
  v15.n64_u32[0] = (int)v15.n64_f32[0];
  v16 = v15.n64_u32[0];
  if ( bSkipTrack )
  {
    v17 = *((_DWORD *)v14 + 64);
    v15.n64_f32[0] = (float)v15.n64_i32[0];
    v18 = (int *)(v14 + 256);
    v5.n64_f32[0] = (float)(v17 + 1);
    v15.n64_u64[0] = vmax_f32(v15, v5).n64_u64[0];
    v16 = (int)v15.n64_f32[0];
  }
  else
  {
    v18 = (int *)(v14 + 256);
  }
  p_m_RequestedSettings = &this->m_RequestedSettings;
  this->m_RequestedSettings.TrackTypes[4] = 6;
  this->m_RequestedSettings.MusicTrackIndices[0] = -1;
  *(_WORD *)this->m_RequestedSettings.TrackTypes = 1542;
  this->m_RequestedSettings.MusicTrackIndices[1] = -1;
  this->m_RequestedSettings.TrackTypes[2] = 6;
  this->m_RequestedSettings.MusicTrackIndices[2] = -1;
  this->m_RequestedSettings.TrackTypes[3] = 6;
  this->m_RequestedSettings.MusicTrackIndices[3] = -1;
  this->m_RequestedSettings.TrackIDs[4] = -1;
  *(_QWORD *)this->m_RequestedSettings.TrackIDs = -1LL;
  *(_QWORD *)&this->m_RequestedSettings.TrackIDs[2] = -1LL;
  this->m_RequestedSettings.MusicTrackIndices[4] = -1;
  v20 = *v18;
  v21 = &this->m_bStationChangePending + 44 * (__int16)v6;
  if ( v16 <= v20 )
  {
    v28 = *((_DWORD *)v21 + 69) + v16;
    v29 = 0;
LABEL_27:
    this->m_RequestedSettings.PlayTime = v28;
    v13 = 0;
    v30 = (char *)this + 44 * (__int16)v6 + v29;
    v31 = v30[292];
    v32 = v30 + 292;
    switch ( v31 )
    {
      case 0:
      case 1:
      case 2:
        this->m_RequestedSettings.TrackIDs[0] = this->m_StationTrackingList[(__int16)v6].OldTrackIDs[v29];
        this->m_RequestedSettings.TrackTypes[0] = *v32;
        pTrackIndex[0] = 1;
        if ( v6 == 12 )
        {
          v33 = 12;
          v34 = 4;
        }
        else
        {
          v33 = v6;
          v34 = 3;
        }
        CAERadioTrackManager::QueueUpTracksForStation(
          this,
          v33,
          pTrackIndex,
          v34,
          (int)this->m_RequestedSettings.TrackIDs);
        return 1;
      case 3:
        v35 = (char *)this + 44 * (__int16)v6;
        v36 = v35 + 280;
        v35 += 292;
        this->m_RequestedSettings.TrackIDs[0] = *(_DWORD *)&v36[4 * v29];
        this->m_RequestedSettings.TrackTypes[0] = *v32;
        v37 = v29 + 1;
        v38 = v29 + 2;
        this->m_RequestedSettings.TrackIDs[1] = *(_DWORD *)&v36[4 * v37];
        this->m_RequestedSettings.TrackTypes[1] = v35[v37];
        this->m_RequestedSettings.TrackIDs[2] = *(_DWORD *)&v36[4 * v38];
        this->m_RequestedSettings.TrackTypes[2] = v35[v38];
        return 1;
      case 4:
        v39 = (char *)this + 44 * (__int16)v6;
        v40 = *(_DWORD *)&v39[4 * v29 + 280];
        v41 = v29 + 1;
        this->m_RequestedSettings.TrackIDs[0] = v40;
        this->m_RequestedSettings.TrackTypes[0] = *v32;
        this->m_RequestedSettings.TrackIDs[1] = *(_DWORD *)&v39[4 * v41 + 280];
        this->m_RequestedSettings.TrackTypes[1] = v39[v41 + 292];
        return 1;
      case 5:
        this->m_RequestedSettings.TrackIDs[0] = this->m_StationTrackingList[(__int16)v6].OldTrackIDs[v29];
        this->m_RequestedSettings.TrackTypes[0] = *v32;
        pTrackIndex[0] = 1;
        if ( !v6 )
        {
          v48 = CAERadioTrackManager::ChooseDJBanterIndex(this, 0);
          this->m_RequestedSettings.TrackIDs[1] = v48;
          if ( v48 != -1 )
          {
            this->m_RequestedSettings.TrackTypes[1] = 2;
            pTrackIndex[0] = 2;
          }
          return 1;
        }
        v42 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.5);
        if ( !v42 )
          goto LABEL_50;
        if ( v6 == 12 )
        {
          v43 = (int)&dword_0 + 1;
LABEL_53:
          p_m_RequestedSettings->TrackIDs[v43] = CAERadioTrackManager::ChooseAdvertIndex(v42, v6);
          v13 = 1;
          p_m_RequestedSettings->TrackTypes[v43] = 1;
          pTrackIndex[0] = v43 + 1;
          return v13;
        }
        v51 = CAERadioTrackManager::ChooseIdentIndex(v42, v6);
        this->m_RequestedSettings.TrackIDs[1] = v51;
        v42 = (CAERadioTrackManager *)(v51 + 1);
        if ( v42 )
        {
          v43 = 2;
          this->m_RequestedSettings.TrackTypes[1] = 0;
          pTrackIndex[0] = 2;
        }
        else
        {
LABEL_50:
          v43 = 1;
          if ( v6 == 12 )
            goto LABEL_53;
        }
        v52 = CAERadioTrackManager::ChooseDJBanterIndex(this, v6);
        this->m_RequestedSettings.TrackIDs[(unsigned __int8)v43] = v52;
        v42 = (CAERadioTrackManager *)(v52 + 1);
        if ( v42 )
        {
          this->m_RequestedSettings.TrackTypes[(unsigned __int8)v43] = 2;
          pTrackIndex[0] = v43 + 1;
          return 1;
        }
        goto LABEL_53;
      case 7:
        v44 = (char *)this + 44 * (__int16)v6;
        v45 = *(_DWORD *)&v44[4 * v29 + 280];
        v46 = v29 + 1;
        this->m_RequestedSettings.TrackIDs[0] = v45;
        v13 = 1;
        this->m_RequestedSettings.TrackTypes[0] = *v32;
        v47 = *(_DWORD *)&v44[4 * v46 + 280];
        this->m_RequestedSettings.TrackIDs[1] = v47;
        this->m_RequestedSettings.TrackTypes[1] = v44[v46 + 292];
        if ( v47 == -1 )
        {
          pTrackIndex[0] = 1;
          CAERadioTrackManager::QueueUpTracksForStation(
            this,
            12,
            pTrackIndex,
            4,
            (int)this->m_RequestedSettings.TrackIDs);
        }
        return v13;
      default:
        return v13;
    }
  }
  v22 = *((_DWORD *)v21 + 65) + v20;
  if ( v16 <= v22 )
  {
    v29 = 1;
LABEL_26:
    v28 = v16 - v20;
    goto LABEL_27;
  }
  v23 = *((_DWORD *)v21 + 66) + v22;
  if ( v16 <= v23 )
  {
    v29 = 2;
    v20 = v22;
    goto LABEL_26;
  }
  if ( v16 <= v23 + 7000 )
  {
    if ( v6 == 12 )
    {
      CAERadioTrackManager::QueueUpTracksForStation(this, 12, pTrackIndex, 4, (int)this->m_RequestedSettings.TrackIDs);
      CAERadioTrackManager::QueueUpTracksForStation(this, 12, pTrackIndex, 4, (int)this->m_RequestedSettings.TrackIDs);
    }
    else
    {
      CAERadioTrackManager::QueueUpTracksForStation(this, v6, pTrackIndex, 3, (int)this->m_RequestedSettings.TrackIDs);
    }
    v15.n64_u32[0] = 1167867904;
    v5.n64_f32[0] = (float)(v16 - v23);
    v50 = (int)vmin_f32(v5, v15).n64_f32[0];
    goto LABEL_73;
  }
  if ( v16 <= v23 + 155000 )
  {
    CAERadioTrackManager::QueueUpTracksForStation(this, v6, pTrackIndex, 4, (int)this->m_RequestedSettings.TrackIDs);
    v49 = v16 - 5000;
LABEL_72:
    v50 = v49 - v23;
LABEL_73:
    this->m_RequestedSettings.PlayTime = v50;
    return 1;
  }
  if ( v16 <= v23 + 160000 )
  {
    if ( v6 == 12 )
    {
      CAERadioTrackManager::QueueUpTracksForStation(this, 12, pTrackIndex, 4, (int)this->m_RequestedSettings.TrackIDs);
      if ( FrontEndMenuManager.m_PrefsPlayMode )
        goto LABEL_71;
      v24 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.17);
      if ( !v24 )
        goto LABEL_71;
      v25 = CAERadioTrackManager::ChooseAdvertIndex(v24, 12);
      v26 = pTrackIndex[0];
      p_m_RequestedSettings->TrackIDs[pTrackIndex[0]] = v25;
      p_m_RequestedSettings->TrackTypes[v26] = 1;
      v27 = v26 + 1;
    }
    else
    {
      v53 = CAERadioTrackManager::ChooseMusicTrackIndex(this, v6);
      this->m_RequestedSettings.MusicTrackIndices[0] = v53;
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(
                              gRadioMusicOutros[v6][v53][0],
                              gRadioMusicOutros[v6][v53][1]);
      this->m_RequestedSettings.TrackTypes[0] = 5;
      this->m_RequestedSettings.TrackIDs[0] = RandomNumberInRange;
      pTrackIndex[0] = 1;
      CAERadioTrackManager::AddMusicTrackIndexToHistory(this, v6, this->m_RequestedSettings.MusicTrackIndices[0]);
      if ( v6 )
      {
        v55 = CAEAudioUtility::ResolveProbability(0.5);
        v56 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.5);
        if ( v55 )
        {
          if ( v56 )
          {
            v57 = CAERadioTrackManager::ChooseIdentIndex(v56, v6);
            this->m_RequestedSettings.TrackIDs[1] = v57;
            if ( v57 != -1 )
            {
              this->m_RequestedSettings.TrackTypes[1] = 0;
              pTrackIndex[0] = 2;
            }
          }
          CAERadioTrackManager::QueueUpTracksForStation(
            this,
            v6,
            pTrackIndex,
            3,
            (int)this->m_RequestedSettings.TrackIDs);
          goto LABEL_71;
        }
        if ( !v56
          || (v59 = CAERadioTrackManager::ChooseIdentIndex(v56, v6),
              this->m_RequestedSettings.TrackIDs[1] = v59,
              v59 == -1) )
        {
          v60 = 1;
        }
        else
        {
          v60 = 2;
          this->m_RequestedSettings.TrackTypes[1] = 0;
          pTrackIndex[0] = 2;
        }
        v61 = CAERadioTrackManager::ChooseDJBanterIndex(this, v6);
        v62 = (char *)this + 4 * v60;
        *((_DWORD *)v62 + 34) = v61;
        v63 = (Int32 *)(v62 + 136);
        if ( v61 == -1 )
        {
          *v63 = CAERadioTrackManager::ChooseAdvertIndex(0, v6);
          v64 = &this->m_bStationChangePending + v60;
          v65 = 1;
        }
        else
        {
          v64 = &this->m_bStationChangePending + v60;
          v65 = 2;
        }
        v64[180] = v65;
        v27 = v60 + 1;
      }
      else
      {
        v58 = CAERadioTrackManager::ChooseDJBanterIndex(this, 0);
        this->m_RequestedSettings.TrackIDs[1] = v58;
        if ( v58 == -1 )
        {
LABEL_71:
          v49 = v16 - 155000;
          goto LABEL_72;
        }
        v27 = 2;
        this->m_RequestedSettings.TrackTypes[1] = 2;
      }
    }
    pTrackIndex[0] = v27;
    goto LABEL_71;
  }
  return 0;
}
// 3A2846: conditional instruction was optimized away because r11.4 is in (1..B|>=Du)
// 3A2480: variable 'v3' is possibly undefined
// 3A24FE: variable 'v5' is possibly undefined
// 3A24FE: variable 'v4' is possibly undefined
// 0: using guessed type int dword_0;

//----- (003A29E8) --------------------------------------------------------
void __fastcall CAERadioTrackManager::ChooseTracksForStation(CAERadioTrackManager *this, Int8 Station)
{
  int v3; // r9
  tRadioSettings *p_m_RequestedSettings; // r6
  CAERadioTrackManager *v5; // r0
  Int32 v6; // r0
  int v7; // r1
  Int8 v8; // r0
  CAERadioTrackManager *v9; // r0
  int v10; // r5
  CAERadioTrackManager *v11; // r0
  Int8 v12; // r1
  Int32 v13; // r0
  Int8 v14; // r0
  CAERadioTrackManager *v15; // r0
  Int32 v16; // r0
  Int8 v17; // r0
  Int32 v18; // r0
  Int32 v19; // r0
  char v20; // r0
  Int8 v21; // r3
  int v22; // r0
  Int32 RandomNumberInRange; // r0
  int v24; // r8
  CAERadioTrackManager *v25; // r0
  Int32 v26; // r0
  Int32 v27; // r0
  Int32 v28; // r0
  unsigned __int8 v29; // r8
  Int32 v30; // r0
  char *v31; // r5
  Int32 *v32; // r5
  Bool8 *v33; // r0
  char v34; // r1
  int v35; // [sp+0h] [bp-20h]
  Int8 pTrackIndex[25]; // [sp+7h] [bp-19h] BYREF

  v3 = Station;
  pTrackIndex[0] = 0;
  this->m_RequestedSettings.MusicTrackIndices[0] = -1;
  *(_WORD *)this->m_RequestedSettings.TrackTypes = 1542;
  this->m_RequestedSettings.MusicTrackIndices[1] = -1;
  p_m_RequestedSettings = &this->m_RequestedSettings;
  this->m_RequestedSettings.TrackTypes[2] = 6;
  this->m_RequestedSettings.MusicTrackIndices[2] = -1;
  this->m_RequestedSettings.TrackTypes[3] = 6;
  this->m_RequestedSettings.MusicTrackIndices[3] = -1;
  this->m_RequestedSettings.TrackTypes[4] = 6;
  this->m_RequestedSettings.TrackIDs[4] = -1;
  this->m_RequestedSettings.MusicTrackIndices[4] = -1;
  *(_QWORD *)this->m_RequestedSettings.TrackIDs = -1LL;
  *(_QWORD *)&this->m_RequestedSettings.TrackIDs[2] = -1LL;
  if ( !CAEAudioUtility::ResolveProbability(0.95) )
  {
    if ( !v3 )
    {
      v13 = CAERadioTrackManager::ChooseDJBanterIndex(this, 0);
      this->m_RequestedSettings.TrackIDs[0] = v13;
      if ( v13 != -1 )
      {
        v14 = 2;
LABEL_19:
        this->m_RequestedSettings.TrackTypes[0] = v14;
        v17 = 1;
LABEL_20:
        pTrackIndex[0] = v17;
      }
LABEL_36:
      v11 = this;
      v12 = v3;
      v21 = 3;
      v35 = (int)p_m_RequestedSettings;
      goto LABEL_37;
    }
    v9 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.5);
    if ( v9 )
    {
      if ( v3 == 12 )
      {
        v10 = 0;
        goto LABEL_27;
      }
      v18 = CAERadioTrackManager::ChooseIdentIndex(v9, v3);
      p_m_RequestedSettings->TrackIDs[0] = v18;
      v10 = 0;
      if ( v18 != -1 )
      {
        this->m_RequestedSettings.TrackTypes[0] = 0;
        v10 = 1;
        pTrackIndex[0] = 1;
      }
    }
    else
    {
      v10 = 0;
      if ( v3 == 12 )
        goto LABEL_27;
    }
    v19 = CAERadioTrackManager::ChooseDJBanterIndex(this, v3);
    this->m_RequestedSettings.TrackIDs[v10] = v19;
    v9 = (CAERadioTrackManager *)(v19 + 1);
    if ( v9 )
    {
      v20 = 2;
      goto LABEL_28;
    }
LABEL_27:
    this->m_RequestedSettings.TrackIDs[v10] = CAERadioTrackManager::ChooseAdvertIndex(v9, v3);
    v20 = 1;
LABEL_28:
    p_m_RequestedSettings->TrackTypes[v10] = v20;
    pTrackIndex[0] = v10 + 1;
    if ( v3 == 12 )
    {
      v35 = (int)p_m_RequestedSettings;
      v11 = this;
      v12 = 12;
      goto LABEL_30;
    }
    goto LABEL_36;
  }
  if ( v3 == 12 )
  {
    CAERadioTrackManager::QueueUpTracksForStation(this, 12, pTrackIndex, 4, (int)p_m_RequestedSettings);
    CAERadioTrackManager::QueueUpTracksForStation(this, 12, pTrackIndex, 4, (int)p_m_RequestedSettings);
    if ( !FrontEndMenuManager.m_PrefsPlayMode )
    {
      v5 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.17);
      if ( v5 )
      {
        v6 = CAERadioTrackManager::ChooseAdvertIndex(v5, 12);
        v7 = pTrackIndex[0];
        p_m_RequestedSettings->TrackIDs[pTrackIndex[0]] = v6;
        p_m_RequestedSettings->TrackTypes[v7] = 1;
        v8 = v7 + 1;
LABEL_6:
        pTrackIndex[0] = v8;
        return;
      }
    }
    return;
  }
  if ( CAEAudioUtility::ResolveProbability(0.9) )
  {
    v11 = this;
    v12 = v3;
    v35 = (int)p_m_RequestedSettings;
LABEL_30:
    v21 = 4;
LABEL_37:
    CAERadioTrackManager::QueueUpTracksForStation(v11, v12, pTrackIndex, v21, v35);
    return;
  }
  if ( CAEAudioUtility::ResolveProbability(0.5) )
  {
    v15 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.5);
    if ( !v15 )
      goto LABEL_36;
    v16 = CAERadioTrackManager::ChooseIdentIndex(v15, v3);
    p_m_RequestedSettings->TrackIDs[0] = v16;
    if ( v16 == -1 )
      goto LABEL_36;
    v14 = 0;
    goto LABEL_19;
  }
  v22 = CAERadioTrackManager::ChooseMusicTrackIndex(this, v3);
  this->m_RequestedSettings.MusicTrackIndices[0] = v22;
  RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(
                          gRadioMusicOutros[v3][v22][0],
                          gRadioMusicOutros[v3][v22][1]);
  this->m_RequestedSettings.TrackTypes[0] = 5;
  this->m_RequestedSettings.TrackIDs[0] = RandomNumberInRange;
  pTrackIndex[0] = 1;
  CAERadioTrackManager::AddMusicTrackIndexToHistory(this, v3, this->m_RequestedSettings.MusicTrackIndices[0]);
  if ( v3 )
  {
    v24 = CAEAudioUtility::ResolveProbability(0.5);
    v25 = (CAERadioTrackManager *)CAEAudioUtility::ResolveProbability(0.5);
    if ( !v24 )
    {
      if ( !v25
        || (v28 = CAERadioTrackManager::ChooseIdentIndex(v25, v3), this->m_RequestedSettings.TrackIDs[1] = v28,
                                                                   v28 == -1) )
      {
        v29 = 1;
      }
      else
      {
        v29 = 2;
        this->m_RequestedSettings.TrackTypes[1] = 0;
        pTrackIndex[0] = 2;
      }
      v30 = CAERadioTrackManager::ChooseDJBanterIndex(this, v3);
      v31 = (char *)this + 4 * v29;
      *((_DWORD *)v31 + 34) = v30;
      v32 = (Int32 *)(v31 + 136);
      if ( v30 == -1 )
      {
        *v32 = CAERadioTrackManager::ChooseAdvertIndex(0, v3);
        v33 = &this->m_bStationChangePending + v29;
        v34 = 1;
      }
      else
      {
        v33 = &this->m_bStationChangePending + v29;
        v34 = 2;
      }
      v33[180] = v34;
      v8 = v29 + 1;
      goto LABEL_6;
    }
    if ( !v25 )
      goto LABEL_36;
    v26 = CAERadioTrackManager::ChooseIdentIndex(v25, v3);
    this->m_RequestedSettings.TrackIDs[1] = v26;
    if ( v26 == -1 )
      goto LABEL_36;
    this->m_RequestedSettings.TrackTypes[1] = 0;
    v17 = 2;
    goto LABEL_20;
  }
  v27 = CAERadioTrackManager::ChooseDJBanterIndex(this, 0);
  this->m_RequestedSettings.TrackIDs[1] = v27;
  if ( v27 != -1 )
  {
    v8 = 2;
    this->m_RequestedSettings.TrackTypes[1] = 2;
    goto LABEL_6;
  }
}
// 3A2B5A: conditional instruction was optimized away because r9.4 is in (1..B|>=Du)

//----- (003A2CB4) --------------------------------------------------------
void __fastcall CAERadioTrackManager::StartRadio(CAERadioTrackManager *this, tVehicleAudioSettings *pSettings)
{
  float BassFactor; // r3
  Int8 BassSetting; // r2
  Int8 RadioStation; // r1
  int m_nLastVehicleStationID; // r0
  bool v8; // zf
  signed int m_nLastVehicleExitGameClockDays; // r1
  int m_nLastVehicleExitGameClockHours; // r0
  bool v11; // nf
  int v12; // r1
  char v13; // r3

  if ( pSettings->RadioType )
  {
    if ( pSettings->RadioType != 3 )
      return;
    BassFactor = pSettings->BassFactor;
    BassSetting = pSettings->BassSetting;
    RadioStation = 0;
  }
  else
  {
    if ( this->m_bUseRadioAutoRetune )
    {
      m_nLastVehicleStationID = this->m_nLastVehicleStationID;
      if ( m_nLastVehicleStationID >= 0 && m_nLastVehicleStationID != pSettings->RadioStation )
      {
        v8 = m_nLastVehicleStationID == 0;
        if ( m_nLastVehicleStationID )
          v8 = m_nLastVehicleStationID == 13;
        if ( !v8 )
        {
          m_nLastVehicleExitGameClockDays = this->m_nLastVehicleExitTimeMs + 60000;
          if ( CTimer::m_snTimeInMilliseconds <= m_nLastVehicleExitGameClockDays )
          {
            m_nLastVehicleExitGameClockHours = this->m_nLastVehicleExitGameClockHours;
            v11 = m_nLastVehicleExitGameClockHours < 0;
            if ( m_nLastVehicleExitGameClockHours >= 0 )
            {
              m_nLastVehicleExitGameClockDays = this->m_nLastVehicleExitGameClockDays;
              v11 = m_nLastVehicleExitGameClockDays < 0;
            }
            if ( !v11 )
            {
              v12 = CClock::ms_nGameClockDays - m_nLastVehicleExitGameClockDays;
              if ( v12 <= -1 )
              {
                v13 = CClock::ms_nGameClockMonths - 1;
                if ( (char)(CClock::ms_nGameClockMonths - 1) < 0 )
                  v13 = CClock::ms_nGameClockMonths + 11;
                v12 += CClock::daysInMonth[v13];
              }
              if ( CClock::ms_nGameClockHours + 24 * v12 - m_nLastVehicleExitGameClockHours <= 5 )
              {
                CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 34, 0.0, 1.0);
                CAERadioTrackManager::StartRadio(
                  this,
                  this->m_nLastVehicleStationID,
                  pSettings->BassSetting,
                  pSettings->BassFactor,
                  0);
                return;
              }
            }
          }
        }
      }
    }
    BassFactor = pSettings->BassFactor;
    BassSetting = pSettings->BassSetting;
    RadioStation = pSettings->RadioStation;
  }
  CAERadioTrackManager::StartRadio(this, RadioStation, BassSetting, BassFactor, 0);
}

//----- (003A2DC0) --------------------------------------------------------
void __fastcall CAERadioTrackManager::StopRadio(
        CAERadioTrackManager *this,
        tVehicleAudioSettings *pSettings,
        Bool8 bForceStop)
{
  tRadioStationTracking *m_StationTrackingList; // r0
  tRadioStationTracking *v6; // r3
  tRadioStationTracking *v7; // r3
  int StationID; // r3
  tRadioStationTracking *v9; // r1
  int GameTimeWhenStartedMs; // r12
  int v11; // r1
  bool v12; // zf
  unsigned int PlayingTrackType; // r1
  Int32 v14; // r3
  Int32 PlayingTrackID; // r1
  Int32 *OldTrackIDs; // r5
  tRadioStationTracking *v17; // r1
  tRadioStationTracking *v18; // r0
  Int8 v19; // r1
  int *v20; // r5
  tRadioStationTracking *v21; // r1
  Int32 v22; // r3
  Int32 v23; // r1
  Int32 *v24; // r5
  tRadioStationTracking *v25; // r1
  tRadioStationTracking *v26; // r0
  Int8 v27; // r1
  tRadioStationTracking *v28; // r1
  int v29; // r0
  int m_nRadioStatus; // r0
  bool v31; // zf
  int m_nRetunesPending; // r0
  bool v33; // zf
  int v34; // r0

  if ( this->m_nRadioStatus > 2u )
    goto LABEL_30;
  if ( !CTimer::m_UserPause )
  {
    if ( !bForceStop && CTimer::m_CodePause )
      goto LABEL_7;
    goto LABEL_4;
  }
  if ( bForceStop )
LABEL_4:
    this->m_nRadioStatus = 3;
LABEL_7:
  m_StationTrackingList = this->m_StationTrackingList;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].TrackingPeriodsMs[0] = 0;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].OldPlayTimeMs = -1;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs[0] = -1;
  v6 = &this->m_StationTrackingList[this->m_ActiveSettings.StationID];
  v6->TrackingPeriodsMs[1] = 0;
  v6->OldTrackTypes[0] = 6;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].OldPlayTimeMs = -1;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs[1] = -1;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackTypes[1] = 6;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].TrackingPeriodsMs[2] = 0;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].OldPlayTimeMs = -1;
  this->m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs[2] = -1;
  v7 = &this->m_StationTrackingList[this->m_ActiveSettings.StationID];
  v7->OldTrackTypes[2] = 6;
  v7->GameTimeWhenStoppedMs = CTimer::m_snTimeInMilliseconds;
  StationID = this->m_ActiveSettings.StationID;
  v9 = &this->m_StationTrackingList[StationID];
  GameTimeWhenStartedMs = v9->GameTimeWhenStartedMs;
  v9->GameClockDaysWhenStopped = CClock::ms_nGameClockDays;
  v9->GameClockHoursWhenStopped = CClock::ms_nGameClockHours;
  v11 = (unsigned __int8)StationID;
  if ( GameTimeWhenStartedMs >= 0 )
  {
    v12 = (unsigned __int8)StationID == 0;
    if ( (_BYTE)StationID )
      v12 = (unsigned __int8)StationID == 13;
    if ( !v12 )
    {
      this->m_nStationListenTimes[StationID] += CTimer::m_snTimeInMillisecondsPauseMode - GameTimeWhenStartedMs;
      v11 = (unsigned __int8)this->m_ActiveSettings.StationID;
    }
  }
  if ( v11 == 13 )
  {
    this->m_StationTrackingList[13].TrackingPeriodsMs[0] = 0;
  }
  else
  {
    this->m_StationTrackingList[(char)v11].TrackingPeriodsMs[0] = this->m_ActiveSettings.TrackLengthMs
                                                                - 100
                                                                - this->m_ActiveSettings.PlayTime;
    PlayingTrackType = this->m_ActiveSettings.PlayingTrackType;
    if ( PlayingTrackType <= 7 )
    {
      if ( ((1 << PlayingTrackType) & 0x27) != 0 )
      {
        m_StationTrackingList[this->m_ActiveSettings.StationID].OldPlayTimeMs = this->m_ActiveSettings.PlayTime;
        m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs[0] = this->m_ActiveSettings.PlayingTrackID;
        m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackTypes[0] = this->m_ActiveSettings.PlayingTrackType;
      }
      else if ( ((1 << PlayingTrackType) & 0x90) != 0 )
      {
        m_StationTrackingList[this->m_ActiveSettings.StationID].TrackingPeriodsMs[1] = 5000;
        m_StationTrackingList[this->m_ActiveSettings.StationID].OldPlayTimeMs = this->m_ActiveSettings.PlayTime;
        v14 = this->m_ActiveSettings.TrackIDs[0];
        PlayingTrackID = this->m_ActiveSettings.PlayingTrackID;
        OldTrackIDs = m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs;
        if ( v14 == PlayingTrackID )
        {
          *OldTrackIDs = v14;
          v17 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v17->OldTrackTypes[0] = this->m_ActiveSettings.TrackTypes[0];
          v17->OldTrackIDs[1] = this->m_ActiveSettings.TrackIDs[1];
          v18 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v19 = this->m_ActiveSettings.TrackTypes[1];
        }
        else
        {
          *OldTrackIDs = PlayingTrackID;
          v21 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v21->OldTrackTypes[0] = this->m_ActiveSettings.PlayingTrackType;
          v21->OldTrackIDs[1] = this->m_ActiveSettings.TrackIDs[0];
          v18 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v19 = this->m_ActiveSettings.TrackTypes[0];
        }
        v18->OldTrackTypes[1] = v19;
      }
      else if ( PlayingTrackType == 3 )
      {
        if ( this->m_ActiveSettings.StationID == 11 )
          v20 = (int *)gnTalkRadioShowLengthsMs[this->m_ActiveSettings.MusicTrackIndices[0]];
        else
          v20 = &elf_hash_chain[21026];
        m_StationTrackingList[this->m_ActiveSettings.StationID].TrackingPeriodsMs[1] = (Int32)v20;
        m_StationTrackingList[this->m_ActiveSettings.StationID].TrackingPeriodsMs[2] = 5000;
        m_StationTrackingList[this->m_ActiveSettings.StationID].OldPlayTimeMs = this->m_ActiveSettings.PlayTime;
        v22 = this->m_ActiveSettings.TrackIDs[0];
        v23 = this->m_ActiveSettings.PlayingTrackID;
        v24 = m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs;
        if ( v22 == v23 )
        {
          *v24 = v22;
          v25 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v25->OldTrackTypes[0] = this->m_ActiveSettings.TrackTypes[0];
          v25->OldTrackIDs[1] = this->m_ActiveSettings.TrackIDs[1];
          m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackTypes[1] = this->m_ActiveSettings.TrackTypes[1];
          m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs[2] = this->m_ActiveSettings.TrackIDs[2];
          v26 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v27 = this->m_ActiveSettings.TrackTypes[2];
        }
        else
        {
          *v24 = v23;
          v28 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v28->OldTrackTypes[0] = this->m_ActiveSettings.PlayingTrackType;
          v28->OldTrackIDs[1] = this->m_ActiveSettings.TrackIDs[0];
          m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackTypes[1] = this->m_ActiveSettings.TrackTypes[0];
          m_StationTrackingList[this->m_ActiveSettings.StationID].OldTrackIDs[2] = this->m_ActiveSettings.TrackIDs[1];
          v26 = &m_StationTrackingList[this->m_ActiveSettings.StationID];
          v27 = this->m_ActiveSettings.TrackTypes[1];
        }
        v26->OldTrackTypes[2] = v27;
      }
    }
  }
LABEL_30:
  this->m_bPlayRadioDuringPause = 0;
  this->m_bStationChangePending = 0;
  if ( CTimer::m_UserPause )
  {
    if ( bForceStop )
      goto LABEL_36;
    goto LABEL_35;
  }
  if ( !bForceStop && CTimer::m_CodePause )
  {
LABEL_35:
    this->m_nRetuneTimeMs = 0;
    this->m_nRetuneStationID = -1;
  }
LABEL_36:
  if ( pSettings )
  {
    this->m_nRetunesPending = 0;
    this->m_nPreviousRetunesPending = 0;
    this->m_nScriptRetuneStationID = -1;
    this->m_bDisplayNewStationName = 0;
    this->m_bRetuneStartedThisFrame = 0;
    CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 35, 0.0, 1.0);
    v29 = (unsigned __int8)this->m_ActiveSettings.StationID;
    if ( v29 == 255 )
    {
      LOBYTE(v29) = 13;
      this->m_ActiveSettings.StationID = 13;
    }
    pSettings->RadioStation = v29;
    pSettings->BassSetting = this->m_ActiveSettings.BassSetting;
    m_nRadioStatus = this->m_nRadioStatus;
    v31 = m_nRadioStatus == 7;
    if ( m_nRadioStatus == 7 )
      v31 = this->m_bStationChangePending == 0;
    if ( !v31 )
      goto LABEL_46;
    m_nRetunesPending = this->m_nRetunesPending;
    v33 = m_nRetunesPending == 0;
    if ( !m_nRetunesPending )
      v33 = this->m_nPreviousRetunesPending == 0;
    if ( !v33 )
    {
LABEL_46:
      v34 = (unsigned __int8)this->m_ActiveSettings.StationID;
      this->m_nLastVehicleExitTimeMs = CTimer::m_snTimeInMilliseconds;
      this->m_nLastVehicleExitGameClockDays = CClock::ms_nGameClockDays;
      this->m_nLastVehicleExitGameClockHours = CClock::ms_nGameClockHours;
      this->m_nLastVehicleStationID = (char)v34;
      if ( v34 )
        return;
LABEL_52:
      this->m_ActiveSettings.StationID = CAEAudioUtility::GetRandomNumberInRange(1, 13);
      return;
    }
    if ( !this->m_ActiveSettings.StationID )
      goto LABEL_52;
  }
  else if ( bForceStop )
  {
    this->m_nRetunesPending = 0;
    this->m_nPreviousRetunesPending = 0;
    this->m_bRetuneStartedThisFrame = 0;
  }
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A31D8) --------------------------------------------------------
void __fastcall CAERadioTrackManager::RetuneRadio(CAERadioTrackManager *this, Int8 Station)
{
  if ( Station == 12 )
    *(_DWORD *)&Station = 13;
  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
  {
    this->m_nRetuneStationID = Station;
    this->m_nRetuneTimeMs = CTimer::m_snTimeInMillisecondsPauseMode;
  }
  else
  {
    this->m_nScriptRetuneStationID = Station;
  }
}

//----- (003A3214) --------------------------------------------------------
void __fastcall CAERadioTrackManager::SetRadioAutoRetuneOnOff(CAERadioTrackManager *this, Bool8 On)
{
  this->m_bUseRadioAutoRetune = On;
}

//----- (003A3218) --------------------------------------------------------
void __fastcall CAERadioTrackManager::SetBassEnhanceOnOff(CAERadioTrackManager *this, Bool8 On)
{
  int m_nRadioStatus; // r2
  Int8 BassSetting; // r3
  float BassFactor; // r2
  Int8 v5; // r1

  m_nRadioStatus = this->m_nRadioStatus;
  this->m_bUseBassEnhance = On;
  if ( m_nRadioStatus == 2 )
  {
    BassSetting = this->m_ActiveSettings.BassSetting;
    BassFactor = this->m_ActiveSettings.BassFactor;
    this->m_RequestedSettings.BassSetting = BassSetting;
    this->m_RequestedSettings.BassFactor = BassFactor;
    if ( On )
      v5 = BassSetting;
    else
      v5 = 0;
    sub_18E420(&AEAudioHardware, v5, BassFactor);
  }
}

//----- (003A325C) --------------------------------------------------------
void __fastcall CAERadioTrackManager::SetBassSetting(CAERadioTrackManager *this, Int8 Setting, float BassFactor)
{
  int m_bUseBassEnhance; // r3

  this->m_ActiveSettings.BassSetting = Setting;
  this->m_RequestedSettings.BassSetting = Setting;
  m_bUseBassEnhance = this->m_bUseBassEnhance;
  this->m_RequestedSettings.BassFactor = BassFactor;
  this->m_ActiveSettings.BassFactor = BassFactor;
  if ( !m_bUseBassEnhance )
    Setting = 0;
  sub_18E420(&AEAudioHardware, Setting, BassFactor);
}

//----- (003A3290) --------------------------------------------------------
void __fastcall CAERadioTrackManager::InitialiseRadioStationID(CAERadioTrackManager *this, Int8 Station)
{
  this->m_ActiveSettings.StationID = Station;
  this->m_RequestedSettings.StationID = Station;
}

//----- (003A329A) --------------------------------------------------------
Bool8 __fastcall CAERadioTrackManager::HasRadioRetuneJustStarted(CAERadioTrackManager *this)
{
  return this->m_bRetuneStartedThisFrame;
}

//----- (003A32A0) --------------------------------------------------------
GxtChar *__fastcall CAERadioTrackManager::GetRadioStationName(CAERadioTrackManager *this, Int8 Station)
{
  int v3; // [sp+0h] [bp-10h] BYREF
  void *v4; // [sp+4h] [bp-Ch]

  if ( Station < 1 )
    return 0;
  if ( Station == 12 )
  {
    v3 = 1598113094;
    v4 = (char *)&off_33504C + 1;
  }
  else if ( Station == 13 )
  {
    v3 = 1598113094;
    v4 = &loc_4E4F4E;
  }
  else
  {
    sprintf((unsigned __int8 *)&v3, "FEA_R%d", Station - 1);
  }
  return CText::Get(&TheText, (const unsigned __int8 *)&v3);
}
// 33504C: using guessed type char **off_33504C;

//----- (003A3304) --------------------------------------------------------
void __fastcall CAERadioTrackManager::GetRadioStationNameKey(
        CAERadioTrackManager *this,
        Int8 Station,
        unsigned __int8 *KeyName)
{
  if ( Station == 12 )
  {
    *(_DWORD *)KeyName = 1598113094;
    *((_DWORD *)KeyName + 1) = (char *)&off_33504C + 1;
  }
  else if ( Station == 13 )
  {
    *(_DWORD *)KeyName = 1598113094;
    *((_DWORD *)KeyName + 1) = &loc_4E4F4E;
  }
  else
  {
    sprintf(KeyName, "FEA_R%d", Station - 1);
  }
}
// 33504C: using guessed type char **off_33504C;

//----- (003A3348) --------------------------------------------------------
Int32 *__fastcall CAERadioTrackManager::GetRadioStationListenTimes(CAERadioTrackManager *this)
{
  return this->m_nStationListenTimes;
}

//----- (003A334C) --------------------------------------------------------
void __fastcall CAERadioTrackManager::DisplayRadioStationName(CAERadioTrackManager *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  unsigned int RadioType; // r0
  uint32 v6; // r0
  int m_nRetunesPending; // r1
  int v8; // r0
  char v9; // r1
  GxtChar *v10; // r5
  CRGBA v11; // r0
  int v12; // r0
  bool v13; // zf
  CRGBA *v14; // r4
  uint8 v15; // r2
  int Width; // r4
  void *Height; // r0
  float screenHeight; // s16
  float v19; // s22
  int *v20; // r0
  float v21; // r1
  char v22; // [sp+4h] [bp-44h] BYREF
  char v23; // [sp+8h] [bp-40h] BYREF
  CRGBA v24; // [sp+Ch] [bp-3Ch] BYREF
  unsigned __int8 s[4]; // [sp+10h] [bp-38h] BYREF
  void *v26; // [sp+14h] [bp-34h]

  if ( !((CTimer::m_UserPause || CTimer::m_CodePause || TheCamera.m_WideScreenOn) << 24)
    && FindPlayerVehicle(-1, 0)
    && FindPlayerVehicle(-1, 0)->m_vehicleType != 10
    && FindPlayerVehicle(-1, 0)->m_vehicleType != 6 )
  {
    if ( this->m_bDisplayNewStationName )
    {
      PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
      if ( PlayerVehicleAudioSettingsForRadio )
      {
        RadioType = (unsigned __int8)PlayerVehicleAudioSettingsForRadio->RadioType;
        if ( RadioType <= 3 && RadioType != 1 )
        {
          v6 = CTimer::m_snTimeInMilliseconds;
          this->m_bDisplayNewStationName = 0;
          this->m_nStationNameDisplayEndTimeMs = v6 + 2500;
        }
      }
    }
    if ( CTimer::m_snTimeInMilliseconds < this->m_nStationNameDisplayEndTimeMs )
    {
      m_nRetunesPending = this->m_nRetunesPending;
      v8 = this->m_RequestedSettings.StationID + m_nRetunesPending;
      if ( v8 == 12 )
        v8 = m_nRetunesPending + 12;
      if ( v8 )
      {
        if ( v8 <= 0 )
        {
          v9 = v8 + 13;
        }
        else
        {
          v9 = v8 - 13;
          if ( v8 <= 13 )
            v9 = v8;
        }
        if ( v9 < 1 )
        {
          v10 = 0;
        }
        else
        {
          if ( v9 == 12 )
          {
            *(_DWORD *)s = 1598113094;
            v26 = (char *)&off_33504C + 1;
          }
          else if ( v9 == 13 )
          {
            *(_DWORD *)s = 1598113094;
            v26 = &loc_4E4F4E;
          }
          else
          {
            sprintf(s, "FEA_R%d", v9 - 1);
          }
          v10 = CText::Get(&TheText, s);
        }
        CFont::SetFontStyle(2u);
        CFont::SetJustify(0);
        CFont::SetBackground(0, 0);
        CFont::SetWrapx((float)RsGlobal.screenWidth);
        CFont::SetScale((float)((float)RsGlobal.screenHeight / 448.0) * 0.9);
        CFont::SetProportional(1u);
        CFont::SetOrientation(1u);
        CFont::SetRightJustifyWrap(0.0);
        CFont::SetEdge(1);
        CRGBA::CRGBA(&v24, 0, 0, 0, 0xFFu);
        CFont::SetDropColor(v11);
        v12 = this->m_nRetunesPending;
        v13 = v12 == 0;
        if ( !v12 )
          v13 = this->m_nPreviousRetunesPending == 0;
        if ( v13 )
        {
          v14 = (CRGBA *)&v22;
          v15 = 7;
        }
        else
        {
          v14 = (CRGBA *)&v23;
          v15 = 9;
        }
        CHudColours::GetRGBA(v14, &HudColour, v15);
        CFont::SetColor((CRGBA)v14);
        Width = OS_ScreenGetWidth();
        Height = OS_ScreenGetHeight();
        screenHeight = (float)RsGlobal.screenHeight;
        v19 = (float)(unsigned int)Width / (float)(unsigned int)Height;
        v1.n64_u32[0] = CFont::GetHeight(0);
        v20 = &dword_3A35D0;
        v2.n64_f32[0] = screenHeight + (float)((float)(screenHeight / -448.0) * 20.0);
        v1.n64_f32[0] = (float)(screenHeight - (float)(screenHeight * 0.0)) - v1.n64_f32[0];
        LODWORD(v21) = vmin_f32(v2, v1).n64_u32[0];
        if ( v19 > 1.9 )
          v20 = &dword_3A35D4;
        CFont::PrintString(*(float *)v20, v21, v10);
        CFont::RenderFontBuffer();
      }
    }
  }
}
// 3A34DC: variable 'v11' is possibly undefined
// 3A3560: variable 'v2' is possibly undefined
// 3A3560: variable 'v1' is possibly undefined
// 33504C: using guessed type char **off_33504C;
// 3A35D0: using guessed type int dword_3A35D0;
// 3A35D4: using guessed type int dword_3A35D4;

//----- (003A35D8) --------------------------------------------------------
Int8 __fastcall CAERadioTrackManager::GetCurrentRadioStationID(CAERadioTrackManager *this)
{
  int StationID; // r0

  StationID = (unsigned __int8)this->m_ActiveSettings.StationID;
  if ( StationID == 255 )
    LOBYTE(StationID) = 13;
  return StationID;
}

//----- (003A35E8) --------------------------------------------------------
Int8 __fastcall CAERadioTrackManager::ChooseMusicTrackIndex(CAERadioTrackManager *this, Int8 Station)
{
  int v2; // r4
  Int8 result; // r0
  int v4; // r5
  int v5; // r11
  int v6; // r2
  int v7; // r3
  int v8; // r12
  int v9; // r2
  int v10; // r5
  int v11; // r3

  v2 = Station;
  if ( Station == 11 )
    return CAERadioTrackManager::ChooseTalkRadioShow(this);
  v4 = 0;
  v5 = gRadioNumMusicTracksPerStation[Station];
  while ( 1 )
  {
    result = CAEAudioUtility::GetRandomNumberInRange(0, v5 - 1);
    v5 = gRadioNumMusicTracksPerStation[v2];
    v8 = v4 + 1;
    v6 = 1;
    if ( v4 < v5 && v5 >= 3 )
    {
      v9 = v5 - 2;
      if ( v5 > 22 )
        v9 = 20;
      v10 = 0;
      v11 = 0;
      do
      {
        if ( result == CAERadioTrackManager::m_nMusicTrackIndexHistory[20 * v2 + v10] )
        {
          v6 = 0;
          goto LABEL_5;
        }
        v10 = (char)++v11;
      }
      while ( v9 > (char)v11 );
      v6 = 1;
    }
LABEL_5:
    v4 = v8;
    v7 = gRadioMusicTracks[v2][result];
    if ( v6 == 1 )
    {
      v4 = v8;
      if ( (unsigned int)(v7 - 1809) >= 5 )
      {
        v4 = v8;
        if ( (unsigned int)(v7 - 1782) >= 5 )
        {
          v4 = v8;
          if ( (unsigned int)(v7 - 1754) >= 0xE )
          {
            v4 = v8;
            if ( (unsigned int)(v7 - 1741) >= 7 )
            {
              v4 = v8;
              if ( (unsigned int)(v7 - 1706) >= 7 )
              {
                v4 = v8;
                if ( (unsigned int)(v7 - 1556) >= 0xE )
                {
                  v4 = v8;
                  if ( (unsigned int)(v7 - 1301) >= 0xE )
                  {
                    v4 = v8;
                    if ( (unsigned int)(v7 - 1152) >= 6 )
                    {
                      v4 = v8;
                      if ( (unsigned int)(v7 - 1118) >= 7 )
                      {
                        v4 = v8;
                        if ( (unsigned int)(v7 - 932) >= 7 )
                        {
                          v4 = v8;
                          if ( (unsigned int)(v7 - 883) >= 7 )
                          {
                            v4 = v8;
                            if ( (unsigned int)(v7 - 848) >= 7 )
                            {
                              v4 = v8;
                              if ( (unsigned int)(v7 - 527) >= 7 )
                              {
                                v4 = v8;
                                if ( (unsigned int)(v7 - 294) >= 7 )
                                {
                                  v4 = v8;
                                  if ( (unsigned int)(v7 - 513) >= 7 )
                                    return result;
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}

//----- (003A3750) --------------------------------------------------------
Int32 __fastcall CAERadioTrackManager::ChooseIdentIndex(CAERadioTrackManager *this, Int8 Station)
{
  int v2; // r4
  int v3; // r12
  Int32 result; // r0
  int v5; // r11
  Int32 *v6; // r6
  Int32 v7; // r1
  Int32 v8; // r0
  bool v9; // zf
  int v10; // lr
  int v11; // r3
  int v12; // r2
  int v13; // r3
  int v14; // r2

  v2 = Station;
  v3 = gRadioIdents[Station][0];
  if ( v3 == 1922 )
    return -1;
  v5 = 0;
  v6 = &gRadioIdents[Station][1];
  while ( 1 )
  {
    v7 = *v6;
    v8 = v3;
    while ( 1 )
    {
      result = CAEAudioUtility::GetRandomNumberInRange(v8, v7);
      v9 = v2 == 6;
      if ( v2 == 6 )
        v9 = result == 1100;
      if ( !v9 )
        break;
      if ( CStats::GetStatValue(0x152u) != 0.0 )
      {
        result = 1100;
        break;
      }
      v8 = gRadioIdents[v2][0];
      v7 = *v6;
    }
    v3 = gRadioIdents[v2][0];
    v10 = v5 + 1;
    v11 = 1;
    v12 = *v6 - v3;
    if ( v5 < v12 && v12 >= 2 )
    {
      v13 = v12 - 1;
      if ( v12 > 9 )
        v13 = 8;
      v14 = 0;
      while ( result != CAERadioTrackManager::m_nIdentIndexHistory[v2][v14] )
      {
        if ( ++v14 >= v13 )
        {
          v11 = 1;
          goto LABEL_21;
        }
      }
      v11 = 0;
    }
LABEL_21:
    ++v5;
    if ( v11 == 1 )
    {
      v5 = v10;
      if ( (unsigned int)(result - 1809) >= 5 )
      {
        v5 = v10;
        if ( (unsigned int)(result - 1782) >= 5 )
        {
          v5 = v10;
          if ( (unsigned int)(result - 1754) >= 0xE )
          {
            v5 = v10;
            if ( (unsigned int)(result - 1741) >= 7 )
            {
              v5 = v10;
              if ( (unsigned int)(result - 1706) >= 7 )
              {
                v5 = v10;
                if ( (unsigned int)(result - 1556) >= 0xE )
                {
                  v5 = v10;
                  if ( (unsigned int)(result - 1301) >= 0xE )
                  {
                    v5 = v10;
                    if ( (unsigned int)(result - 1152) >= 6 )
                    {
                      v5 = v10;
                      if ( (unsigned int)(result - 1118) >= 7 )
                      {
                        v5 = v10;
                        if ( (unsigned int)(result - 932) >= 7 )
                        {
                          v5 = v10;
                          if ( (unsigned int)(result - 883) >= 7 )
                          {
                            v5 = v10;
                            if ( (unsigned int)(result - 848) >= 7 )
                            {
                              v5 = v10;
                              if ( (unsigned int)(result - 527) >= 7 )
                              {
                                v5 = v10;
                                if ( (unsigned int)(result - 294) >= 7 )
                                {
                                  v5 = v10;
                                  if ( (unsigned int)(result - 513) >= 7 )
                                    return result;
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}

//----- (003A38CC) --------------------------------------------------------
Int32 __fastcall CAERadioTrackManager::ChooseAdvertIndex(CAERadioTrackManager *this, Int8 Station)
{
  Int32 *v2; // r4
  int v3; // r3
  bool v4; // cc
  int v5; // r1
  Int32 result; // r0
  unsigned int v7; // r1
  bool v8; // cf
  bool v9; // cf
  bool v10; // cf
  bool v11; // cf
  bool v12; // cf
  bool v13; // cf
  bool v14; // cf
  int v15; // [sp+0h] [bp-68h]
  Int32 *v16; // [sp+10h] [bp-58h]

  v2 = gnRadioStationRestrictedAdverts[Station];
  v16 = CAERadioTrackManager::m_nAdvertIndexHistory[Station];
  v15 = 0;
  while ( 1 )
  {
    result = CAEAudioUtility::GetRandomNumberInRange(gRadioAdverts[0], gRadioAdverts[1]);
    if ( result == *v2
      || result == v2[1]
      || result == v2[2]
      || result == v2[3]
      || result == v2[4]
      || result == v2[5]
      || result == v2[6]
      || result == v2[7]
      || result == v2[8]
      || result == v2[9]
      || result == v2[10]
      || result == v2[11]
      || result == v2[12]
      || result == v2[13]
      || result == v2[14]
      || result == v2[15]
      || result == v2[16]
      || result == v2[17]
      || result == v2[18]
      || result == v2[19]
      || result == v2[20]
      || result == v2[21]
      || result == v2[22] )
    {
      v5 = 0;
    }
    else
    {
      if ( v15 > 39 )
      {
        v5 = 1;
      }
      else
      {
        v3 = 0;
        while ( result != v16[v3] )
        {
          v4 = v3 <= 38;
          v5 = 1;
          ++v3;
          if ( !v4 )
            goto LABEL_9;
        }
        v5 = 0;
      }
LABEL_9:
      ++v15;
    }
    if ( v5 == 1 )
    {
      v7 = result - 1782;
      if ( (unsigned int)(result - 1809) >= 5 )
      {
        v8 = v7 >= 5;
        if ( v7 >= 5 )
        {
          v7 = result - 1741;
          v8 = (unsigned int)(result - 1754) >= 0xE;
        }
        if ( v8 )
        {
          v9 = v7 >= 7;
          if ( v7 >= 7 )
          {
            v7 = result - 1556;
            v9 = (unsigned int)(result - 1706) >= 7;
          }
          if ( v9 )
          {
            v10 = v7 >= 0xE;
            if ( v7 >= 0xE )
            {
              v7 = result - 1152;
              v10 = (unsigned int)(result - 1301) >= 0xE;
            }
            if ( v10 )
            {
              v11 = v7 >= 6;
              if ( v7 >= 6 )
              {
                v7 = result - 932;
                v11 = (unsigned int)(result - 1118) >= 7;
              }
              if ( v11 )
              {
                v12 = v7 >= 7;
                if ( v7 >= 7 )
                {
                  v7 = result - 848;
                  v12 = (unsigned int)(result - 883) >= 7;
                }
                if ( v12 )
                {
                  v13 = v7 >= 7;
                  if ( v7 >= 7 )
                  {
                    v7 = result - 294;
                    v13 = (unsigned int)(result - 527) >= 7;
                  }
                  if ( v13 )
                  {
                    v14 = v7 >= 7;
                    if ( v7 >= 7 )
                      v14 = (unsigned int)(result - 513) >= 7;
                    if ( v14 )
                      return result;
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}

//----- (003A3B08) --------------------------------------------------------
Int32 __fastcall CAERadioTrackManager::ChooseDJBanterIndex(CAERadioTrackManager *this, Int8 Station)
{
  int v2; // r4
  Int32 result; // r0
  int *v4; // r1
  int v5; // r0
  int v6; // r1
  uint8 v7; // r5
  int (**v8)[24]; // r0
  int (**v9)[24]; // r0
  int (**v10)[24]; // r0

  v2 = Station;
  if ( CAERadioTrackManager::m_nSpecialDJBanterPending == 2 )
  {
    v4 = gnRadioStationSpecificNewsLookup[Station];
    v5 = CAERadioTrackManager::m_nSpecialDJBanterIndex;
LABEL_9:
    result = v4[v5];
    goto LABEL_12;
  }
  if ( CAERadioTrackManager::m_nSpecialDJBanterPending != 1 )
  {
    if ( !CAERadioTrackManager::m_nSpecialDJBanterPending )
    {
      result = gRadioDJBanterBC[Station][0];
      goto LABEL_12;
    }
    goto LABEL_11;
  }
  if ( CAERadioTrackManager::m_nSpecialDJBanterIndex == 1 )
  {
    if ( gRadioDJBanterBO[Station][0] != gRadioDJBanterBO[Station][1] )
      goto LABEL_8;
  }
  else if ( !CAERadioTrackManager::m_nSpecialDJBanterIndex )
  {
LABEL_8:
    v5 = CAERadioTrackManager::m_nSpecialDJBanterIndex;
    v4 = gRadioDJBanterBO[Station];
    goto LABEL_9;
  }
LABEL_11:
  result = -1;
LABEL_12:
  if ( result == 1922 )
    result = -1;
  if ( result < 0 )
  {
    if ( result != -1 )
      return result;
  }
  else if ( result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][0]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][1]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][2]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][3]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][4]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][5]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][6]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][7]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][8]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][9]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][10]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][11]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][12]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][13]
         && result != CAERadioTrackManager::m_nDJBanterIndexHistory[v2][14] )
  {
    return result;
  }
  if ( v2 )
  {
    v6 = CAEAudioUtility::ResolveProbability(0.6);
    result = -1;
    if ( !v6 || CGame::currArea )
      return result;
    v7 = CClock::ms_nGameClockHours;
    if ( CWeather::ForecastWeather(16, 3) || CWeather::ForecastWeather(8, 3) )
    {
      if ( !CAEAudioUtility::ResolveProbability(0.5) )
        goto LABEL_40;
      v8 = &gRadioDJBanterWR_ptr;
    }
    else
    {
      if ( !CWeather::ForecastWeather(0, 3)
        && !CWeather::ForecastWeather(2, 3)
        && !CWeather::ForecastWeather(13, 3)
        && !CWeather::ForecastWeather(6, 3)
        && !CWeather::ForecastWeather(11, 3) )
      {
        CWeather::ForecastWeather(17, 3);
      }
      if ( !CWeather::ForecastWeather(9, 3) || !CAEAudioUtility::ResolveProbability(0.5) )
        goto LABEL_40;
      v8 = &gRadioDJBanterWF_ptr;
    }
    result = CAERadioTrackManager::ChooseDJBanterIndexFromList((CAERadioTrackManager *)v8, v2, (int (*)[2])*v8);
    if ( result != -1 )
      return result;
LABEL_40:
    if ( (unsigned __int8)(v7 - 6) > 2u )
    {
      if ( (unsigned __int8)(v7 - 18) > 2u )
      {
        if ( (unsigned __int8)(v7 - 3) < 0x13u || !CAEAudioUtility::ResolveProbability(0.3) )
          return CAERadioTrackManager::ChooseDJBanterIndexFromList(
                   (CAERadioTrackManager *)&gRadioDJBanterGN_ptr,
                   v2,
                   gRadioDJBanterGN);
        v9 = &gRadioDJBanterTN_ptr;
      }
      else
      {
        if ( !CAEAudioUtility::ResolveProbability(0.3) )
          return CAERadioTrackManager::ChooseDJBanterIndexFromList(
                   (CAERadioTrackManager *)&gRadioDJBanterGN_ptr,
                   v2,
                   gRadioDJBanterGN);
        v9 = &gRadioDJBanterTE_ptr;
      }
    }
    else
    {
      if ( !CAEAudioUtility::ResolveProbability(0.3) )
        return CAERadioTrackManager::ChooseDJBanterIndexFromList(
                 (CAERadioTrackManager *)&gRadioDJBanterGN_ptr,
                 v2,
                 gRadioDJBanterGN);
      v9 = &gRadioDJBanterTM_ptr;
    }
    result = CAERadioTrackManager::ChooseDJBanterIndexFromList((CAERadioTrackManager *)v9, v2, (int (*)[2])*v9);
    if ( result != -1 )
      return result;
    return CAERadioTrackManager::ChooseDJBanterIndexFromList(
             (CAERadioTrackManager *)&gRadioDJBanterGN_ptr,
             v2,
             gRadioDJBanterGN);
  }
  if ( CGameLogic::LaRiotsActiveHere() )
    v10 = &gRadioDJBanterTN_ptr;
  else
    v10 = &gRadioDJBanterGN_ptr;
  return CAERadioTrackManager::ChooseDJBanterIndexFromList((CAERadioTrackManager *)v10, 0, (int (*)[2])*v10);
}
// 676080: using guessed type int (*gRadioDJBanterGN_ptr)[24];
// 677330: using guessed type int (*gRadioDJBanterTE_ptr)[24];
// 677388: using guessed type int (*gRadioDJBanterTM_ptr)[24];
// 677B8C: using guessed type int (*gRadioDJBanterTN_ptr)[24];
// 6797D0: using guessed type int (*gRadioDJBanterWF_ptr)[24];
// 679A1C: using guessed type int (*gRadioDJBanterWR_ptr)[24];

//----- (003A3E58) --------------------------------------------------------
Int8 __fastcall CAERadioTrackManager::ChooseTalkRadioShow(CAERadioTrackManager *this)
{
  char v1; // r0
  int v2; // r5
  _BYTE *v3; // r0
  char v4; // r1
  char v5; // r0
  int v6; // r1
  char v7; // r0
  int v8; // r1
  char v9; // r0
  int v10; // r1
  char v11; // r0
  int v12; // r1
  char v13; // r0
  int v14; // r1
  char v15; // r0
  int v16; // r1
  char v17; // r0
  int v18; // r1
  int v19; // r10
  Int32 v20; // r5
  int v21; // r6
  int v22; // r2
  int v23; // r12
  int v24; // r3
  int v25; // r0
  int v26; // r6
  int v27; // r3
  unsigned int v28; // r1
  unsigned int v29; // r2
  char v31[36]; // [sp+0h] [bp-40h] BYREF

  memset(v31, 255, 0x1Fu);
  if ( CStats::GetStatValue(0x136u) != 0.0 && CStats::GetStatValue(0x137u) == 0.0 )
  {
    v1 = 14;
  }
  else
  {
    if ( CStats::GetStatValue(0x138u) == 0.0 )
    {
      v2 = 0;
      goto LABEL_8;
    }
    v1 = 15;
  }
  v2 = 1;
  v31[0] = v1;
LABEL_8:
  if ( CStats::GetStatValue(0x139u) == 0.0 )
  {
    v3 = (_BYTE *)((unsigned int)v31 | v2);
    v4 = 12;
    goto LABEL_13;
  }
  if ( CStats::GetStatValue(0x139u) != 0.0 && CStats::GetStatValue(0x138u) == 0.0 )
  {
    v3 = (_BYTE *)((unsigned int)v31 | v2);
    v4 = 13;
LABEL_13:
    ++v2;
    *v3 = v4;
  }
  if ( CStats::GetStatValue(0x13Bu) != 0.0 && CStats::GetStatValue(0x13Cu) == 0.0 )
  {
    v31[v2] = 6;
    LOBYTE(v2) = v2 + 1;
  }
  if ( CStats::GetStatValue(0x12Eu) != 0.0 && CStats::GetStatValue(0x13Au) == 0.0 )
  {
    v5 = 3;
  }
  else if ( CStats::GetStatValue(0x13Cu) != 0.0 && CStats::GetStatValue(0x13Du) == 0.0 )
  {
    v5 = 4;
  }
  else
  {
    if ( CStats::GetStatValue(0x13Du) == 0.0 )
      goto LABEL_26;
    v5 = 5;
  }
  v6 = (char)v2;
  LOBYTE(v2) = v2 + 1;
  v31[v6] = v5;
LABEL_26:
  if ( CStats::GetStatValue(0x13Eu) == 0.0 )
  {
    v7 = 7;
  }
  else
  {
    if ( CStats::GetStatValue(0x13Eu) == 0.0 )
      goto LABEL_31;
    v7 = 8;
  }
  v8 = (char)v2;
  LOBYTE(v2) = v2 + 1;
  v31[v8] = v7;
LABEL_31:
  if ( CStats::GetStatValue(0x13Fu) == 0.0 )
  {
    v9 = 9;
  }
  else if ( CStats::GetStatValue(0x13Fu) != 0.0
         && CStats::GetStatValue(0x130u) == 0.0
         && CStats::GetStatValue(0x140u) == 0.0 )
  {
    v9 = 10;
  }
  else
  {
    if ( CStats::GetStatValue(0x140u) == 0.0 )
      goto LABEL_39;
    v9 = 11;
  }
  v10 = (char)v2;
  LOBYTE(v2) = v2 + 1;
  v31[v10] = v9;
LABEL_39:
  if ( CStats::GetStatValue(0x141u) == 0.0 )
  {
    v11 = 27;
  }
  else
  {
    if ( CStats::GetStatValue(0x141u) == 0.0 )
      goto LABEL_44;
    v11 = 28;
  }
  v12 = (char)v2;
  LOBYTE(v2) = v2 + 1;
  v31[v12] = v11;
LABEL_44:
  if ( CStats::GetStatValue(0x142u) == 0.0 )
  {
    v13 = 29;
  }
  else
  {
    if ( CStats::GetStatValue(0x142u) == 0.0 )
      goto LABEL_49;
    v13 = 30;
  }
  v14 = (char)v2;
  LOBYTE(v2) = v2 + 1;
  v31[v14] = v13;
LABEL_49:
  if ( CStats::GetStatValue(0x143u) == 0.0 )
  {
    v15 = 0;
  }
  else if ( CStats::GetStatValue(0x144u) != 0.0 && CStats::GetStatValue(0x145u) == 0.0 )
  {
    v15 = 1;
  }
  else
  {
    if ( CStats::GetStatValue(0x146u) == 0.0 )
      goto LABEL_57;
    v15 = 2;
  }
  v16 = (char)v2;
  LOBYTE(v2) = v2 + 1;
  v31[v16] = v15;
LABEL_57:
  if ( CStats::GetStatValue(0x12Eu) == 0.0 )
  {
    v17 = 16;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x12Eu) != 0.0 && CStats::GetStatValue(0x12Fu) == 0.0 )
  {
    v17 = 17;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x12Fu) != 0.0 && CStats::GetStatValue(0x143u) == 0.0 )
  {
    v17 = 18;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x143u) != 0.0 && CStats::GetStatValue(0x130u) == 0.0 )
  {
    v17 = 19;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x130u) != 0.0 && CStats::GetStatValue(0x131u) == 0.0 )
  {
    v17 = 20;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x131u) != 0.0 && CStats::GetStatValue(0x132u) == 0.0 )
  {
    v17 = 21;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x132u) != 0.0 && CStats::GetStatValue(0x133u) == 0.0 )
  {
    v17 = 22;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x133u) != 0.0 && CStats::GetStatValue(0x134u) == 0.0 )
  {
    v17 = 23;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x134u) != 0.0 && CStats::GetStatValue(0x135u) == 0.0 )
  {
    v17 = 24;
    goto LABEL_89;
  }
  if ( CStats::GetStatValue(0x135u) != 0.0 && CStats::GetStatValue(0xB5u) != 4.0 )
  {
    v17 = 25;
LABEL_89:
    v18 = (char)v2;
    LOBYTE(v2) = v2 + 1;
    v31[v18] = v17;
    goto LABEL_90;
  }
  if ( CStats::GetStatValue(0xB5u) == 4.0 )
  {
    v17 = 26;
    goto LABEL_89;
  }
LABEL_90:
  v19 = (char)v2;
  v20 = (char)v2 - 1;
  v21 = 0;
  while ( 1 )
  {
    v22 = (unsigned __int8)v31[CAEAudioUtility::GetRandomNumberInRange(0, v20)];
    v23 = v21 + 1;
    v24 = 1;
    v25 = (char)v22;
    if ( v21 < gRadioNumMusicTracksPerStation[v19] && v19 >= 2 )
    {
      v26 = 0;
      v27 = 0;
      while ( v22 != (unsigned __int8)CAERadioTrackManager::m_nMusicTrackIndexHistory[v26 + 220] )
      {
        v26 = (char)++v27;
        if ( v20 <= (char)v27 )
        {
          v24 = 1;
          goto LABEL_98;
        }
      }
      v24 = 0;
    }
LABEL_98:
    v28 = (char)v22 - 1809;
    v21 = v23;
    if ( v24 == 1 )
    {
      v29 = (char)v22 - 1782;
      v21 = v23;
      if ( v28 >= 5 )
      {
        v21 = v23;
        if ( v29 >= 5 )
        {
          v21 = v23;
          if ( (unsigned int)(v25 - 1754) >= 0xE )
          {
            v21 = v23;
            if ( (unsigned int)(v25 - 1741) >= 7 )
            {
              v21 = v23;
              if ( (unsigned int)(v25 - 1706) >= 7 )
              {
                v21 = v23;
                if ( (unsigned int)(v25 - 1556) >= 0xE )
                {
                  v21 = v23;
                  if ( (unsigned int)(v25 - 1301) >= 0xE )
                  {
                    v21 = v23;
                    if ( (unsigned int)(v25 - 1152) >= 6 )
                    {
                      v21 = v23;
                      if ( (unsigned int)(v25 - 1118) >= 7 )
                      {
                        v21 = v23;
                        if ( (unsigned int)(v25 - 932) >= 7 )
                        {
                          v21 = v23;
                          if ( (unsigned int)(v25 - 883) >= 7 )
                          {
                            v21 = v23;
                            if ( (unsigned int)(v25 - 848) >= 7 )
                            {
                              v21 = v23;
                              if ( (unsigned int)(v25 - 527) >= 7 )
                              {
                                v21 = v23;
                                if ( (unsigned int)(v25 - 294) >= 7 )
                                {
                                  v21 = v23;
                                  if ( (unsigned int)(v25 - 513) >= 7 )
                                    return v25;
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
// 3A3E58: using guessed type char var_40[36];

//----- (003A4484) --------------------------------------------------------
Int32 __fastcall CAERadioTrackManager::ChooseDJBanterIndexFromList(
        CAERadioTrackManager *this,
        Int8 Station,
        int (*DJBanterList)[2])
{
  int v3; // r9
  int v5; // r0
  Int32 v6; // r5
  Int32 RandomNumberInRange; // r10
  int v8; // r4
  int v9; // r0
  int v10; // r11
  Int32 result; // r0
  int v12; // r2
  int v13; // r1
  int v14; // r2
  bool v15; // cf
  bool v16; // cf
  bool v17; // cf
  bool v18; // cf
  bool v19; // cf
  bool v20; // cf
  bool v21; // cf

  v3 = Station;
  v5 = (*DJBanterList)[2 * Station];
  if ( v5 != 1922 )
  {
    v6 = (*DJBanterList)[2 * Station + 1] - v5;
    RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, v6);
    if ( v6 >= 0 )
    {
      v8 = (*DJBanterList)[2 * v3];
      v9 = 0;
      do
      {
        v10 = v9;
        result = (v9 + RandomNumberInRange) % (v6 + 1) + v8;
        if ( v10 > 14 || (v12 = gRadioDJBanterGN[v3][1] - gRadioDJBanterGN[v3][0], v12 < 2) )
        {
LABEL_11:
          if ( (unsigned int)(result - 1809) >= 5 )
          {
            v15 = (unsigned int)(result - 1782) >= 5;
            if ( (unsigned int)(result - 1782) >= 5 )
              v15 = (unsigned int)(result - 1754) >= 0xE;
            if ( v15 )
            {
              v16 = (unsigned int)(result - 1741) >= 7;
              if ( (unsigned int)(result - 1741) >= 7 )
                v16 = (unsigned int)(result - 1706) >= 7;
              if ( v16 )
              {
                v17 = (unsigned int)(result - 1556) >= 0xE;
                if ( (unsigned int)(result - 1556) >= 0xE )
                  v17 = (unsigned int)(result - 1301) >= 0xE;
                if ( v17 )
                {
                  v18 = (unsigned int)(result - 1152) >= 6;
                  if ( (unsigned int)(result - 1152) >= 6 )
                    v18 = (unsigned int)(result - 1118) >= 7;
                  if ( v18 )
                  {
                    v19 = (unsigned int)(result - 932) >= 7;
                    if ( (unsigned int)(result - 932) >= 7 )
                      v19 = (unsigned int)(result - 883) >= 7;
                    if ( v19 )
                    {
                      v20 = (unsigned int)(result - 848) >= 7;
                      if ( (unsigned int)(result - 848) >= 7 )
                        v20 = (unsigned int)(result - 527) >= 7;
                      if ( v20 )
                      {
                        v21 = (unsigned int)(result - 294) >= 7;
                        if ( (unsigned int)(result - 294) >= 7 )
                          v21 = (unsigned int)(result - 513) >= 7;
                        if ( v21 )
                          return result;
                      }
                    }
                  }
                }
              }
            }
          }
        }
        else
        {
          v13 = v12 - 1;
          if ( v12 > 16 )
            v13 = 15;
          v14 = 0;
          while ( result != CAERadioTrackManager::m_nDJBanterIndexHistory[v3][v14] )
          {
            if ( ++v14 >= v13 )
              goto LABEL_11;
          }
        }
        v9 = v10 + 1;
      }
      while ( v10 < v6 );
    }
  }
  return -1;
}

//----- (003A45C8) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::Reset(CAEScriptAudioEntity *this)
{
  CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 26, 1u);
  this->m_MissionSlotSettings[0].vAudioPosition.x = -1000.0;
  this->m_MissionSlotSettings[0].vAudioPosition.y = -1000.0;
  this->m_MissionSlotSettings[0].vAudioPosition.z = -1000.0;
  this->m_MissionSlotSettings[0].pAttachedPhysical = 0;
  this->m_MissionSlotSettings[0].pSound = 0;
  CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 27, 1u);
  this->m_MissionSlotSettings[1].vAudioPosition.x = -1000.0;
  this->m_MissionSlotSettings[1].vAudioPosition.y = -1000.0;
  this->m_MissionSlotSettings[1].vAudioPosition.z = -1000.0;
  this->m_MissionSlotSettings[1].pAttachedPhysical = 0;
  this->m_MissionSlotSettings[1].pSound = 0;
  CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 28, 1u);
  this->m_MissionSlotSettings[2].vAudioPosition.x = -1000.0;
  this->m_MissionSlotSettings[2].vAudioPosition.y = -1000.0;
  this->m_MissionSlotSettings[2].vAudioPosition.z = -1000.0;
  this->m_MissionSlotSettings[2].pAttachedPhysical = 0;
  this->m_MissionSlotSettings[2].pSound = 0;
  CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 29, 1u);
  this->m_MissionSlotSettings[3].vAudioPosition.x = -1000.0;
  this->m_MissionSlotSettings[3].vAudioPosition.y = -1000.0;
  this->m_MissionSlotSettings[3].vAudioPosition.z = -1000.0;
  this->m_MissionSlotSettings[3].pAttachedPhysical = 0;
  this->m_MissionSlotSettings[3].pSound = 0;
  this->m_pCrane = 0;
  this->m_fMissionSoundEnvelopePhase = 2.0;
  *(_WORD *)&this->m_bMiniGameOneShotTriggered = 0;
}

//----- (003A4654) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::ClearMissionAudio(CAEScriptAudioEntity *this, UInt8 Slot)
{
  int v2; // r4
  int (***v4)(void); // r0

  v2 = Slot;
  if ( Slot <= 3u )
  {
    CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, Slot + 26, 1u);
    v4 = &this->_vptr$CAEAudioEntity + 8 * v2;
    v4[36] = (int (**)(void))-998637568;
    v4[37] = (int (**)(void))-998637568;
    v4[38] = (int (**)(void))-998637568;
    v4[39] = 0;
    v4[40] = 0;
  }
}

//----- (003A4690) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::Service(CAEScriptAudioEntity *this)
{
  CVector v2; // [sp+1Ch] [bp-14h] BYREF

  v2.x = -1000.0;
  v2.y = -1000.0;
  v2.z = -1000.0;
  if ( this->m_pCrane )
  {
    if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1019, this) )
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 40, 44, 0, 1019, &v2, this->m_pCrane, 0.0, 1.0, 0, 2.5);
  }
}

//----- (003A46F8) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::PlayResidentSoundEvent(
        CAEScriptAudioEntity *this,
        Int16 BankSlotID,
        Int16 BankID,
        Int16 SoundID,
        tAudioEvent Event,
        CVector *vPosition,
        CPhysical *pPhysical,
        float fVolumeOffsetdB,
        float fFrequencyScaling,
        Int16 StartPercentage,
        float fRolloff)
{
  CMatrix *m_pMat; // r0
  Int16 v15; // r2
  CSimpleTransform *p_tx; // r3
  RwReal x; // r1
  float y; // r12
  Bool16 v19; // r9
  RwReal z; // r0
  CVector Position; // [sp+0h] [bp-48h]

  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, BankID, BankSlotID) )
    return;
  if ( pPhysical )
  {
    m_pMat = pPhysical->m_pMat;
    v15 = SoundID;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pPhysical->m_transform;
    y = p_tx->m_translate.y;
    x = p_tx->m_translate.x;
    goto LABEL_15;
  }
  p_tx = (CSimpleTransform *)vPosition;
  if ( vPosition->x != -1000.0 || vPosition->y != -1000.0 )
  {
    if ( vPosition->x == 0.0 )
    {
      v15 = SoundID;
      y = vPosition->y;
      if ( y == 0.0 )
        goto LABEL_12;
    }
    else
    {
      y = vPosition->y;
      v15 = SoundID;
    }
    x = vPosition->x;
LABEL_15:
    z = p_tx->m_translate.z;
    v19 = 0;
    goto LABEL_16;
  }
  v15 = SoundID;
LABEL_12:
  v19 = 1;
  y = 1.0;
  x = 0.0;
  z = 0.0;
LABEL_16:
  Position.x = x;
  *(_QWORD *)&Position.y = __PAIR64__(LODWORD(z), LODWORD(y));
  CAESound::Initialise(
    &this->ScratchSound,
    BankSlotID,
    v15,
    this,
    Position,
    (float)CAEAudioEntity::m_pAudioEventVolumes[Event] + fVolumeOffsetdB,
    fRolloff,
    fFrequencyScaling,
    1.0,
    0,
    0,
    0.0,
    0);
  this->ScratchSound.m_Environment = 38;
  this->ScratchSound.m_nPlayTime = StartPercentage;
  CAESound::SetIndividualEnvironment(&this->ScratchSound, 1u, v19);
  if ( pPhysical )
  {
    CAESound::SetIndividualEnvironment(&this->ScratchSound, 0x80u, 1u);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pPhysical);
  }
  this->ScratchSound.m_AudioEvent = Event;
  sub_19F790(&AESoundManager, &this->ScratchSound);
}

//----- (003A486C) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::UpdateParameters(CAEScriptAudioEntity *this, CAESound *pSound, Int16 PlayTime)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d11
  CAESound **p_pSound; // r6
  int v9; // r11
  int v10; // r5
  tAudioEvent m_AudioEvent; // r0
  UInt32 v12; // r9
  int v13; // r0
  CVector *v14; // r1
  CVector *v15; // r3
  int v16; // r0
  float m_fMissionSoundEnvelopePhase; // s2
  float m_EmittedVolume; // s0
  Int16 RandomNumberInRange; // r0
  CVector *vPosition; // [sp+20h] [bp-78h]
  CVector v21; // [sp+2Ch] [bp-6Ch] BYREF

  v21.x = -1000.0;
  v21.y = -1000.0;
  v21.z = -1000.0;
  if ( pSound )
  {
    vPosition = &pSound->m_Position;
    p_pSound = &this->m_MissionSlotSettings[0].pSound;
    v9 = PlayTime + 1;
    v10 = -1;
    v5.n64_u32[0] = 0;
    do
    {
      if ( *p_pSound == pSound )
      {
        if ( !v9 )
        {
          *p_pSound = 0;
          return;
        }
        v13 = (int)*(p_pSound - 1);
        if ( v13 )
        {
          v14 = *(CVector **)(v13 + 20);
          v15 = v14 + 4;
          if ( !v14 )
            v15 = (CVector *)(v13 + 4);
          CAESound::SetPosition(pSound, *v15);
        }
        goto LABEL_47;
      }
      m_AudioEvent = pSound->m_AudioEvent;
      v12 = CTimer::m_snTimeInMilliseconds;
      if ( m_AudioEvent > 1117 )
      {
        if ( m_AudioEvent > 1166 )
        {
          if ( m_AudioEvent != 1177 && m_AudioEvent != 1167 )
            goto LABEL_47;
LABEL_24:
          if ( CTimer::m_snTimeInMilliseconds > this->m_nLastMiniGameLoopTriggerTimeMs + 300 )
            goto LABEL_25;
          goto LABEL_47;
        }
        if ( m_AudioEvent == 1118 )
        {
          v16 = CAEAudioEntity::m_pAudioEventVolumes[1118];
LABEL_29:
          v3.n64_f32[0] = (float)v16;
          m_fMissionSoundEnvelopePhase = this->m_fMissionSoundEnvelopePhase;
          if ( m_fMissionSoundEnvelopePhase == 1.0 )
          {
            v4.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
            if ( v4.n64_f32[0] < v3.n64_f32[0] )
            {
              v4.n64_f32[0] = v4.n64_f32[0] + 0.1;
              v3.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
              LODWORD(pSound->m_EmittedVolume) = v3.n64_u32[0];
            }
          }
          else if ( m_fMissionSoundEnvelopePhase == 2.0 )
          {
            v3.n64_f32[0] = v3.n64_f32[0] + -18.0;
            v4.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
            if ( v4.n64_f32[0] <= v3.n64_f32[0] )
            {
              CAESound::StopSoundAndForget(pSound);
            }
            else
            {
              v4.n64_f32[0] = v4.n64_f32[0] + -0.1;
              v3.n64_u64[0] = vmax_f32(v4, v3).n64_u64[0];
              LODWORD(pSound->m_EmittedVolume) = v3.n64_u32[0];
            }
          }
          goto LABEL_47;
        }
        if ( m_AudioEvent == 1147 && CTimer::m_snTimeInMilliseconds > this->m_nLastMiniGameLoopTriggerTimeMs + 500 )
        {
LABEL_25:
          CAESound::StopSoundAndForget(pSound);
          this->m_nLastMiniGameLoopTriggerTimeMs = 0;
        }
      }
      else
      {
        if ( m_AudioEvent > 1085 )
        {
          if ( m_AudioEvent == 1086 )
          {
            if ( CTimer::m_snTimeInMilliseconds > this->m_nLastMiniGameLoopTriggerTimeMs + 4500 )
            {
              m_EmittedVolume = pSound->m_EmittedVolume;
              if ( m_EmittedVolume <= -40.0 )
              {
                CAESound::StopSoundAndForget(pSound);
                this->m_nLastMiniGameLoopTriggerTimeMs = 0;
              }
              else
              {
                pSound->m_EmittedVolume = m_EmittedVolume + -0.1;
              }
              v3.n64_u32[0] = LODWORD(pSound->m_RelativeFrequency);
              if ( v3.n64_f32[0] > 0.0 )
              {
                v3.n64_f32[0] = v3.n64_f32[0] + -0.001;
                v3.n64_u64[0] = vmax_f32(v3, v5).n64_u64[0];
                LODWORD(pSound->m_RelativeFrequency) = v3.n64_u32[0];
              }
            }
            if ( v12 > this->m_nLastMiniGameLoopTriggerTimeMs + 4800 && !this->m_bMiniGameOneShotTriggered )
            {
              RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(1, 3);
              CAEScriptAudioEntity::PlayMissionBankSound(
                this,
                0x488u,
                &v21,
                0,
                RandomNumberInRange,
                3,
                0,
                0.0,
                2.0,
                1.0);
              this->m_bMiniGameOneShotTriggered = 1;
            }
            goto LABEL_47;
          }
          if ( m_AudioEvent == 1113 )
          {
            v16 = CAEAudioEntity::m_pAudioEventVolumes[1113];
            goto LABEL_29;
          }
          goto LABEL_47;
        }
        if ( m_AudioEvent == 104 )
        {
          if ( CTimer::m_snTimeInMilliseconds <= this->m_nLastMiniGameLoopTriggerTimeMs + 300 )
          {
            pSound->m_EmittedVolume = this->m_fCraneVolume;
            pSound->m_RelativeFrequency = this->m_fCraneFrequencyScaling;
          }
          else
          {
            CAESound::StopSoundAndForget(pSound);
            this->m_nLastMiniGameLoopTriggerTimeMs = 0;
            CAEScriptAudioEntity::PlayResidentSoundEvent(
              this,
              40,
              44,
              2,
              1021,
              vPosition,
              (CPhysical *)pSound->m_pPhysicalEntity,
              -12.0,
              1.0,
              0,
              2.5);
          }
          goto LABEL_47;
        }
        if ( m_AudioEvent == 1042 )
          goto LABEL_24;
      }
LABEL_47:
      ++v10;
      p_pSound += 8;
    }
    while ( v10 < 3 );
  }
}
// 3A4A1C: variable 'v4' is possibly undefined
// 3A4A1C: variable 'v3' is possibly undefined
// 3A4AA2: variable 'v5' is possibly undefined

//----- (003A4B38) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::PlayMissionBankSound(
        CAEScriptAudioEntity *this,
        tAudioEvent Event,
        CVector *vPosition,
        CPhysical *pPhysical,
        Int16 SoundID,
        int Slot,
        int bInhibitOverlap,
        float fVolumeOffsetdB,
        float fRolloff,
        float fFrequencyScaling)
{
  CMatrix *m_pMat; // r0
  Int16 v15; // r2
  Bool16 v16; // r11
  CSimpleTransform *p_tx; // r3
  __int64 v18; // r0
  float z; // r4
  float x; // s2
  CVector v21; // [sp+0h] [bp-68h]

  if ( (Slot & 0xFE) == 2
    && (!bInhibitOverlap || !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, Event, this))
    && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_MissionSlotSettings[Slot].BankID, Slot + 26) )
  {
    if ( pPhysical )
    {
      m_pMat = pPhysical->m_pMat;
      v15 = SoundID;
      v16 = 0;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pPhysical->m_transform;
      v18 = *(_QWORD *)&p_tx->m_translate.x;
      z = p_tx->m_translate.z;
      goto LABEL_26;
    }
    x = vPosition->x;
    if ( vPosition->x == -1000.0 && vPosition->y == -1000.0 || x == 0.0 && vPosition->z == 0.0 )
    {
      v15 = SoundID;
      v16 = 1;
      v18 = 0x3F80000000000000LL;
      z = 0.0;
LABEL_26:
      *(_QWORD *)&v21.x = v18;
      v21.z = z;
      CAESound::Initialise(
        &this->ScratchSound,
        Slot + 26,
        v15,
        this,
        v21,
        (float)CAEAudioEntity::m_pAudioEventVolumes[Event] + fVolumeOffsetdB,
        fRolloff,
        fFrequencyScaling,
        1.0,
        0,
        0,
        0.0,
        0);
      this->ScratchSound.m_Environment = 6;
      CAESound::SetIndividualEnvironment(&this->ScratchSound, 1u, v16);
      if ( pPhysical )
      {
        CAESound::SetIndividualEnvironment(&this->ScratchSound, 0x80u, 1u);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pPhysical);
      }
      this->ScratchSound.m_AudioEvent = Event;
      sub_19F790(&AESoundManager, &this->ScratchSound);
      return;
    }
    *(RwReal *)&v18 = vPosition->x;
    if ( x == -1.0 && vPosition->y == 0.0 )
    {
      v15 = SoundID;
      HIDWORD(v18) = LODWORD(vPosition->y);
      z = vPosition->z;
LABEL_21:
      v16 = 1;
      goto LABEL_26;
    }
    if ( x == 1.0 )
    {
      HIDWORD(v18) = LODWORD(vPosition->y);
      if ( *((float *)&v18 + 1) == 0.0 )
      {
        v15 = SoundID;
        z = vPosition->z;
        if ( z == 0.0 )
          goto LABEL_21;
LABEL_25:
        v16 = 0;
        goto LABEL_26;
      }
      v15 = SoundID;
    }
    else
    {
      v15 = SoundID;
      HIDWORD(v18) = LODWORD(vPosition->y);
    }
    z = vPosition->z;
    goto LABEL_25;
  }
}

//----- (003A4D54) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::PreloadMissionAudio(
        CAEScriptAudioEntity *this,
        UInt8 Slot,
        tAudioEvent ScriptSlotAudioEvent)
{
  int v3; // r4
  char *v5; // r5
  int *v6; // r6
  int v7; // r0
  tAudioEvent pScriptSlotAudioEvent[5]; // [sp+4h] [bp-14h] BYREF

  v3 = Slot;
  pScriptSlotAudioEvent[0] = ScriptSlotAudioEvent;
  if ( Slot <= 3u )
  {
    if ( Slot < 2u )
    {
      if ( this->m_MissionSlotSettings[Slot].pSound )
        return;
    }
    else if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, Slot + 26) )
    {
      return;
    }
    v5 = (char *)this + 32 * v3;
    v6 = (int *)(v5 + 172);
    if ( CAEAudioUtility::GetBankAndSoundFromScriptSlotAudioEvent(
           pScriptSlotAudioEvent,
           (int *)v5 + 42,
           (int *)v5 + 43,
           v3) )
    {
      v7 = *((_DWORD *)v5 + 42);
      if ( *v6 < 0 )
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, v7, v3 + 26);
      else
        CAEAudioHardware::LoadSound(&AEAudioHardware, v7, *v6, v3 + 26);
      *((_DWORD *)v5 + 41) = pScriptSlotAudioEvent[0];
      *((_DWORD *)v5 + 36) = -998637568;
      *((_DWORD *)v5 + 37) = -998637568;
      *((_QWORD *)v5 + 19) = 3296329728LL;
    }
  }
}
// 3A4D54: using guessed type tAudioEvent pScriptSlotAudioEvent[5];

//----- (003A4DFC) --------------------------------------------------------
Bool8 __fastcall CAEScriptAudioEntity::IsMissionAudioSampleFinished(CAEScriptAudioEntity *this, UInt8 Slot)
{
  if ( Slot > 3u )
    return 1;
  if ( Slot < 2u )
    return this->m_MissionSlotSettings[Slot].pSound == 0;
  return CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, Slot + 26) == 0;
}

//----- (003A4E3C) --------------------------------------------------------
UInt8 __fastcall CAEScriptAudioEntity::GetMissionAudioLoadingStatus(CAEScriptAudioEntity *this, UInt8 Slot)
{
  char *v2; // r2
  int v3; // r0
  int v4; // r2

  if ( Slot > 3u )
    return 1;
  v2 = (char *)this + 32 * Slot;
  v3 = *((_DWORD *)v2 + 42);
  if ( v3 < 0 )
    return 1;
  v4 = *((_DWORD *)v2 + 43);
  if ( v4 < 0 )
    return sub_19E1E0(&AEAudioHardware, v3, Slot + 26);
  else
    return sub_19F5DC(&AEAudioHardware, v3, v4, Slot + 26);
}

//----- (003A4E88) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::PlayLoadedMissionAudio(CAEScriptAudioEntity *this, UInt8 Slot)
{
  int v2; // r2
  Int16 *v3; // r11
  unsigned int v4; // r6
  char *v6; // r5
  int v7; // r0
  bool v8; // nf
  int v9; // r0
  float v10; // s0
  int v11; // r0
  Bool16 v12; // r8
  int v13; // r0
  int v14; // r1
  int v15; // r2
  int v16; // r12
  RwReal v17; // lr
  unsigned int v18; // r3
  float v19; // s2
  int *v20; // r0
  Bool16 v21; // r9
  CVector Position; // [sp+0h] [bp-C0h]
  CAESound v23; // [sp+30h] [bp-90h] BYREF

  v4 = Slot;
  v23.m_pPhysicalEntity = 0;
  if ( Slot <= 3u )
  {
    v6 = (char *)this + 32 * Slot;
    v7 = *((_DWORD *)v6 + 42);
    v8 = v7 < 0;
    if ( v7 >= 0 )
    {
      v3 = (Int16 *)(v6 + 172);
      v2 = *((_DWORD *)v6 + 43);
      v8 = v2 < 0;
    }
    if ( !v8 && CAEAudioHardware::GetSoundLoadingStatus(&AEAudioHardware, v7, v2, Slot + 26) == 1 )
    {
      v9 = *((_DWORD *)v6 + 41);
      if ( v9 == 0xFFFF )
      {
        v10 = -100.0;
      }
      else
      {
        v11 = CAEAudioEntity::m_pAudioEventVolumes[v9];
        v10 = (float)v11;
        if ( v4 <= 1 )
        {
          v12 = 1;
          if ( (unsigned __int8)v11 == 128 )
            v10 = 6.0;
LABEL_13:
          v13 = *((_DWORD *)v6 + 39);
          if ( v13 )
          {
            v14 = *(_DWORD *)(v13 + 20);
            v15 = v14 + 48;
            if ( !v14 )
              v15 = v13 + 4;
            v16 = *(_DWORD *)(v15 + 4);
            v17 = *(float *)v15;
            v18 = *(_DWORD *)(v15 + 8);
            goto LABEL_24;
          }
          v19 = *((float *)v6 + 36);
          if ( v19 != -1000.0 || *((float *)v6 + 37) != -1000.0 )
          {
            v20 = (int *)(v6 + 148);
            if ( v19 == 0.0 )
            {
              v16 = *v20;
              if ( *(float *)v20 == 0.0 )
                goto LABEL_21;
            }
            else
            {
              v16 = *v20;
            }
            v17 = *((float *)v6 + 36);
            v18 = *((_DWORD *)v6 + 38);
LABEL_24:
            v21 = 0;
            goto LABEL_25;
          }
LABEL_21:
          v21 = 1;
          v16 = 1065353216;
          v17 = 0.0;
          v18 = 0;
LABEL_25:
          Position.x = v17;
          *(_QWORD *)&Position.y = __PAIR64__(v18, v16);
          CAESound::Initialise(&v23, v4 + 26, *v3, this, Position, v10, 2.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v23.m_Environment = 14;
          CAESound::SetIndividualEnvironment(&v23, 1u, v21);
          CAESound::SetIndividualEnvironment(&v23, 0x100u, v12);
          CAESound::SetIndividualEnvironment(&v23, 0x200u, v12);
          CAESound::SetIndividualEnvironment(&v23, 0x800u, v12);
          *((_DWORD *)v6 + 40) = CAESoundManager::RequestNewSound(&AESoundManager, &v23);
          goto LABEL_26;
        }
      }
      v12 = 0;
      goto LABEL_13;
    }
  }
LABEL_26:
  CAESound::~CAESound(&v23);
}
// 3A4EC8: variable 'v2' is possibly undefined
// 3A4FB2: variable 'v3' is possibly undefined

//----- (003A5040) --------------------------------------------------------
tAudioEvent __fastcall CAEScriptAudioEntity::GetMissionAudioEvent(CAEScriptAudioEntity *this, UInt8 Slot)
{
  return this->m_MissionSlotSettings[Slot].AudioEvent;
}

//----- (003A504C) --------------------------------------------------------
CVector *__fastcall CAEScriptAudioEntity::GetMissionAudioPosition(CAEScriptAudioEntity *this, UInt8 Slot)
{
  char *v2; // r1
  int v3; // r2
  CVector *v4; // r1
  CVector *result; // r0
  float v6; // s0

  v2 = (char *)this + 32 * Slot;
  v3 = *((_DWORD *)v2 + 39);
  if ( v3 )
  {
    v4 = *(CVector **)(v3 + 20);
    result = v4 + 4;
    if ( !v4 )
      return (CVector *)(v3 + 4);
  }
  else
  {
    v6 = *((float *)v2 + 36);
    if ( v6 == -1000.0 && *((float *)v2 + 38) == -1000.0 )
      return 0;
    result = (CVector *)(v2 + 144);
    if ( v6 == 0.0 && *((float *)v2 + 37) == 0.0 )
      return 0;
  }
  return result;
}

//----- (003A50C8) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::SetMissionAudioPosition(
        CAEScriptAudioEntity *this,
        UInt8 Slot,
        CVector *vPosition)
{
  __int64 v3; // d16
  char *v4; // r0

  v3 = *(_QWORD *)&vPosition->x;
  v4 = (char *)this + 32 * Slot;
  *((_DWORD *)v4 + 38) = LODWORD(vPosition->z);
  *((_QWORD *)v4 + 18) = v3;
  *((_DWORD *)v4 + 39) = 0;
}

//----- (003A50E2) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::AttachMissionAudioToPhysical(
        CAEScriptAudioEntity *this,
        UInt8 Slot,
        CPhysical *pPhysical)
{
  int (***v3)(void); // r0

  v3 = &this->_vptr$CAEAudioEntity + 8 * Slot;
  v3[36] = (int (**)(void))-998637568;
  v3[37] = (int (**)(void))-998637568;
  v3[38] = (int (**)(void))-998637568;
  v3[39] = (int (**)(void))pPhysical;
}

//----- (003A50F6) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::ReportMissionAudioEvent(
        CAEScriptAudioEntity *this,
        UInt16 Event,
        CVector *vPosition)
{
  CAEScriptAudioEntity::ProcessMissionAudioEvent(this, Event, vPosition, 0, 0.0, 1.0);
}

//----- (003A5110) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::ProcessMissionAudioEvent(
        CAEScriptAudioEntity *this,
        tAudioEvent Event,
        CVector *vPosition,
        CPhysical *pPhysical,
        float fVolumeOffsetdB,
        float fFrequencyScaling)
{
  CVector *v9; // r6
  CAEDoorAudioEntity *p_m_DoorAudioEntity; // r0
  CMatrix *v11; // r1
  tAudioEvent v12; // r1
  Int16 RandomNumberInRange; // r0
  CMatrix *m_pMat; // r1
  int v15; // r2
  tAudioEvent v16; // r1
  Int16 v17; // r1
  Int16 v18; // r3
  Int16 v19; // r1
  tAudioEvent v20; // r3
  Int16 v21; // r1
  Int16 v22; // r3
  int v23; // r1
  UInt32 v24; // r0
  Int16 v25; // r1
  Int16 v26; // r4
  eWeaponType v27; // r2
  CAEScriptAudioEntity *v28; // r0
  Int16 v29; // r1
  Int16 v30; // r2
  int v31; // r3
  Int16 v32; // r0
  CMatrix *v33; // r1
  int v34; // r0
  bool v35; // zf
  Int16 v36; // r3
  int v37; // r1
  Int16 v38; // r1
  tAudioEvent v39; // r3
  int v40; // [sp+0h] [bp-58h]
  tAudioEvent v41; // [sp+0h] [bp-58h]
  Int16 v42; // [sp+0h] [bp-58h]
  Int16 v43; // [sp+0h] [bp-58h]
  tAudioEvent v44; // [sp+0h] [bp-58h]
  Int16 v45; // [sp+0h] [bp-58h]
  Int16 v46; // [sp+0h] [bp-58h]
  tAudioEvent v47; // [sp+0h] [bp-58h]
  tAudioEvent v48; // [sp+0h] [bp-58h]
  CVector *v49; // [sp+4h] [bp-54h]
  CVector *v50; // [sp+4h] [bp-54h]
  CVector *v51; // [sp+4h] [bp-54h]
  CPhysical *bInhibitOverlap; // [sp+8h] [bp-50h]
  CPhysical *bInhibitOverlapa; // [sp+8h] [bp-50h]
  CPhysical *bInhibitOverlapb; // [sp+8h] [bp-50h]
  int v55; // [sp+Ch] [bp-4Ch]
  int fRolloff; // [sp+10h] [bp-48h]
  Int16 StartPercentage; // [sp+14h] [bp-44h]
  int v58; // [sp+18h] [bp-40h]
  CVector v59; // [sp+1Ch] [bp-3Ch] BYREF
  CVector v60; // 0:r1.12

  v9 = vPosition;
  switch ( Event )
  {
    case 104:
      if ( this->m_bInACrane )
      {
        if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntityAndPhysical(
                &AESoundManager,
                104,
                this,
                pPhysical) )
          CAEScriptAudioEntity::PlayResidentSoundEvent(
            this,
            40,
            44,
            1,
            104,
            v9,
            pPhysical,
            fVolumeOffsetdB,
            fFrequencyScaling,
            0,
            2.5);
        this->m_fCraneVolume = (float)CAEAudioEntity::m_pAudioEventVolumes[Event] + fVolumeOffsetdB;
        this->m_fCraneFrequencyScaling = fFrequencyScaling;
        goto LABEL_196;
      }
      return;
    case 1000:
      CAEVehicleAudioEntity::DisableHelicoptors();
      return;
    case 1001:
      CAEVehicleAudioEntity::EnableHelicoptors();
      return;
    case 1002:
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 2, 39, 64, 1002, vPosition, pPhysical, 0.0, 0.79, 35, 1.0);
      return;
    case 1005:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3EDu, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1006:
      v17 = 1005;
      goto LABEL_233;
    case 1007:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3EFu, vPosition, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1008:
      v17 = 1007;
      goto LABEL_233;
    case 1009:
    case 1148:
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(20, 28);
      v41 = Event;
      goto LABEL_150;
    case 1010:
      v42 = CAEAudioUtility::GetRandomNumberInRange(0, 2);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3F2u, v9, pPhysical, v42, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1011:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3F3u, vPosition, pPhysical, 3, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1012:
      if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1012, this) )
        CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3F4u, v9, pPhysical, 4, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1014:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3F6u, vPosition, pPhysical, 10, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1016:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3F8u, vPosition, pPhysical, 8, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1017:
      v43 = CAEAudioUtility::GetRandomNumberInRange(3, 5);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3F9u, v9, pPhysical, v43, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1018:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x3FAu, vPosition, pPhysical, 7, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1019:
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x2Cu, 40) )
      {
        if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 40) )
          CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 0);
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x2Cu, 40);
      }
      this->m_bInACrane = 1;
      this->m_pCrane = pPhysical;
      return;
    case 1020:
      if ( !this->m_bInACrane
        || CAESoundManager::AreSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, 1020, this, pPhysical) )
      {
        return;
      }
      v44 = 1020;
      v49 = v9;
      bInhibitOverlap = pPhysical;
      v18 = 1;
      goto LABEL_239;
    case 1021:
      if ( !this->m_bInACrane )
        return;
      if ( pPhysical )
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, 1020, this, pPhysical);
      else
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1020, this);
      v44 = 1021;
      v49 = v9;
      bInhibitOverlap = pPhysical;
      v18 = 2;
LABEL_239:
      v30 = 44;
      StartPercentage = 0;
      v58 = 1075838976;
      v28 = this;
      v29 = 40;
      goto LABEL_240;
    case 1022:
      if ( this->m_bInACrane )
      {
        CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 1u);
        CAEScriptAudioEntity::PlayResidentSoundEvent(this, 40, 44, 3, 1022, v9, pPhysical, 0.0, 1.0, 0, 2.5);
        this->m_bInACrane = 0;
        this->m_pCrane = 0;
      }
      return;
    case 1025:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x401u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1026:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x402u, vPosition, pPhysical, 0, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1027:
      v19 = 70;
      v20 = 1027;
      goto LABEL_157;
    case 1028:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0xF2u, 28) )
      {
        v45 = 0;
      }
      else
      {
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x159u, 28) )
          return;
        v45 = 3;
      }
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x404u, v9, pPhysical, v45, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1029:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x405u, vPosition, pPhysical, 2, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1030:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x406u, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1031:
      v46 = CAEAudioUtility::GetRandomNumberInRange(2, 6);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x407u, v9, pPhysical, v46, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1032:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x408u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1033:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x409u, vPosition, pPhysical, 0, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1034:
      if ( pPhysical )
      {
        v21 = 1033;
        goto LABEL_177;
      }
      v17 = 1033;
      goto LABEL_233;
    case 1035:
    case 1153:
      p_m_DoorAudioEntity = &this->m_DoorAudioEntity;
      if ( pPhysical )
      {
        m_pMat = pPhysical->m_pMat;
        v15 = 1065353216;
        goto LABEL_182;
      }
      v37 = 1065353216;
      goto LABEL_235;
    case 1036:
    case 1154:
    case 1166:
      p_m_DoorAudioEntity = &this->m_DoorAudioEntity;
      if ( pPhysical )
      {
        v11 = pPhysical->m_pMat;
        v40 = 1065353216;
        vPosition = (CVector *)&v11->tx;
        if ( !v11 )
          vPosition = &pPhysical->m_transform.m_translate;
        v12 = 160;
LABEL_236:
        CAEDoorAudioEntity::AddAudioEvent(p_m_DoorAudioEntity, v12, vPosition, 0.0, *(float *)&v40);
      }
      else
      {
        CAEDoorAudioEntity::AddAudioEvent(p_m_DoorAudioEntity, 160, vPosition, 0.0, 1.0);
      }
      return;
    case 1039:
      v47 = 1039;
      v50 = vPosition;
      bInhibitOverlapa = pPhysical;
      v55 = 0;
      v22 = 65;
      goto LABEL_144;
    case 1041:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x411u, vPosition, pPhysical, 8, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1042:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x412u, vPosition, pPhysical, 0, 3, 1, 0.0, 2.0, 1.0);
      goto LABEL_196;
    case 1043:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x413u, vPosition, pPhysical, 2, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1044:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x414u, vPosition, pPhysical, 1, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1045:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x415u, vPosition, pPhysical, 5, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1046:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x416u, vPosition, pPhysical, 4, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1047:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x417u, vPosition, pPhysical, 3, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1048:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x418u, vPosition, pPhysical, 7, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1049:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x419u, vPosition, pPhysical, 6, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1050:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x41Au, vPosition, pPhysical, 9, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1051:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x41Bu, vPosition, pPhysical, 10, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1052:
    case 1054:
      v16 = 40;
      goto LABEL_161;
    case 1053:
    case 1055:
      v16 = 14;
      goto LABEL_161;
    case 1056:
      v16 = 44;
      goto LABEL_161;
    case 1057:
      v16 = 45;
      goto LABEL_161;
    case 1058:
    case 1138:
    case 1149:
      v16 = 43;
      goto LABEL_161;
    case 1059:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x423u, vPosition, pPhysical, 5, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1060:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x424u, vPosition, pPhysical, 2, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1061:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x425u, vPosition, pPhysical, 3, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1062:
      v23 = 153;
      goto LABEL_204;
    case 1063:
    case 1069:
    case 1077:
    case 1098:
    case 1143:
    case 1182:
    case 1184:
    case 1186:
    case 1188:
      CAEAmbienceTrackManager::StopSpecialMissionAmbienceTrack(&AEAmbienceTrackManager);
      return;
    case 1064:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x428u, vPosition, pPhysical, 6, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1065:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x429u, vPosition, pPhysical, 0, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1066:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x42Au, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1067:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x42Bu, vPosition, pPhysical, 4, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1068:
      v23 = 150;
      goto LABEL_204;
    case 1070:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x42Eu, vPosition, pPhysical, 6, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1071:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x42Fu, vPosition, pPhysical, 4, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1072:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x430u, vPosition, pPhysical, 2, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1073:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x431u, vPosition, pPhysical, 5, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1074:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x432u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1075:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x433u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 0.79);
      return;
    case 1076:
      v23 = 141;
      goto LABEL_204;
    case 1078:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x436u, vPosition, pPhysical, 3, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1079:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x437u, vPosition, pPhysical, 2, 2, 1, 0.0, 3.0, 1.0);
      return;
    case 1080:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x438u, vPosition, pPhysical, 1, 2, 1, 0.0, 3.0, 1.0);
      return;
    case 1081:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x439u, vPosition, pPhysical, 3, 2, 1, 0.0, 3.0, 1.0);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x439u, v9, pPhysical, 0, 2, 0, 0.0, 3.0, 1.0);
      return;
    case 1082:
      CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1081, this);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x43Au, v9, pPhysical, 4, 2, 1, 0.0, 3.0, 1.0);
      return;
    case 1083:
      v16 = 1;
      goto LABEL_161;
    case 1084:
      v16 = 2;
      goto LABEL_161;
    case 1085:
      v16 = 4;
      goto LABEL_161;
    case 1086:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x43Eu, vPosition, pPhysical, 0, 3, 0, 0.0, 2.0, 1.0);
      v24 = CTimer::m_snTimeInMilliseconds;
      this->m_bMiniGameOneShotTriggered = 0;
      this->m_nLastMiniGameLoopTriggerTimeMs = v24;
      return;
    case 1087:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x43Fu, vPosition, pPhysical, 3, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1088:
      if ( pPhysical )
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, 1089, this, pPhysical);
      else
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1089, this);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x440u, v9, pPhysical, 2, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1089:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x441u, vPosition, pPhysical, 0, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1090:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x442u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1095:
      v44 = 1095;
      v49 = vPosition;
      bInhibitOverlap = pPhysical;
      StartPercentage = 16;
      v58 = 1065353216;
      goto LABEL_152;
    case 1097:
      v23 = 145;
      goto LABEL_204;
    case 1100:
      if ( this->m_nMeshGateTriggerCount )
      {
        v25 = 63;
        v48 = 1100;
        v51 = vPosition;
        bInhibitOverlapb = pPhysical;
        fRolloff = 1065353216;
        goto LABEL_107;
      }
      v38 = 62;
      v39 = 1100;
      goto LABEL_221;
    case 1101:
      if ( this->m_nMeshGateTriggerCount )
      {
        v48 = 1101;
        v51 = vPosition;
        bInhibitOverlapb = pPhysical;
        v25 = 33;
        fRolloff = 1064346583;
LABEL_107:
        CAEScriptAudioEntity::PlayResidentSoundEvent(
          this,
          2,
          39,
          69,
          v48,
          v51,
          bInhibitOverlapb,
          0.0,
          *(float *)&fRolloff,
          v25,
          1.0);
      }
      else
      {
        v38 = 25;
        v39 = 1101;
LABEL_221:
        CAEScriptAudioEntity::PlayResidentSoundEvent(this, 2, 39, 70, v39, vPosition, pPhysical, 0.0, 1.0, v38, 1.0);
      }
      this->m_nMeshGateTriggerCount = (this->m_nMeshGateTriggerCount + 1) % 2;
      return;
    case 1102:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x44Eu, vPosition, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1103:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x44Fu, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1104:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x450u, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1105:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x451u, vPosition, pPhysical, 2, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1107:
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0xA7u, 28) )
      {
        v26 = 3;
      }
      else
      {
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x159u, 28) )
          return;
        v26 = 4;
      }
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x453u, v9, pPhysical, v26, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1108:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x454u, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x454u, v9, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1109:
      CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1108, this);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x455u, v9, pPhysical, 2, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1110:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x456u, vPosition, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1111:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x457u, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1113:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x459u, vPosition, pPhysical, 0, 3, 1, -18.0, 2.0, 1.0);
      goto LABEL_123;
    case 1114:
    case 1119:
      this->m_fMissionSoundEnvelopePhase = 2.0;
      return;
    case 1115:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x45Bu, vPosition, pPhysical, 2, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1116:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x45Cu, vPosition, pPhysical, 3, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1117:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x45Du, vPosition, pPhysical, 7, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1118:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x45Eu, vPosition, pPhysical, 1, 3, 1, -18.0, 2.0, 1.0);
LABEL_123:
      this->m_fMissionSoundEnvelopePhase = 1.0;
      return;
    case 1120:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x460u, vPosition, pPhysical, 0, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1121:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x461u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1122:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x462u, vPosition, pPhysical, 2, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1123:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x463u, vPosition, pPhysical, 4, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1124:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x464u, vPosition, pPhysical, 5, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1125:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x465u, vPosition, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1126:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x466u, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x466u, v9, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1127:
      CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1126, this);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x467u, v9, pPhysical, 2, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1128:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x468u, vPosition, pPhysical, 2, 2, 0, 0.0, 2.0, 1.0);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x468u, v9, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1129:
      if ( pPhysical )
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, 1128, this, pPhysical);
      else
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1128, this);
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x469u, v9, pPhysical, 3, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1130:
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 5, 143, 58, 1130, vPosition, pPhysical, 0.0, 1.0, 0, 1.0);
      v44 = 1130;
      v49 = v9;
      bInhibitOverlap = pPhysical;
      StartPercentage = 0;
      v58 = 1065353216;
      goto LABEL_142;
    case 1131:
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 2, 39, 33, 1131, vPosition, pPhysical, 0.0, 1.0, 0, 1.0);
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 2, 39, 50, 1131, v9, pPhysical, 0.0, 0.79, 22, 1.0);
      return;
    case 1132:
      if ( pPhysical )
      {
        v27 = WEAPONTYPE_CAMERA;
LABEL_168:
        CAudioEngine::ReportWeaponEvent(&AudioEngine, 145, v27, pPhysical);
      }
      else
      {
        CAEScriptAudioEntity::PlayResidentSoundEvent(this, 5, 143, 45, 1132, vPosition, 0, 0.0, 1.0, 0, 1.0);
      }
      return;
    case 1133:
      v16 = 46;
      goto LABEL_161;
    case 1134:
      v16 = 16;
      goto LABEL_161;
    case 1135:
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 5, 143, 34, 1135, vPosition, pPhysical, 5.0, 1.0, 0, 1.0);
      v44 = 1135;
      v49 = v9;
      bInhibitOverlap = pPhysical;
      StartPercentage = 0;
      v58 = 1065353216;
LABEL_142:
      v28 = this;
      v29 = 5;
      v30 = 143;
      v18 = 40;
      goto LABEL_240;
    case 1136:
      v47 = 1136;
      v50 = vPosition;
      bInhibitOverlapa = pPhysical;
      v22 = 82;
      v55 = -1069547520;
LABEL_144:
      CAEScriptAudioEntity::PlayResidentSoundEvent(
        this,
        5,
        143,
        v22,
        v47,
        v50,
        bInhibitOverlapa,
        *(float *)&v55,
        1.0,
        0,
        1.0);
      return;
    case 1137:
      v31 = 1066359849;
      goto LABEL_148;
    case 1139:
      v31 = 1067534254;
LABEL_148:
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, 43, 0.0, *(float *)&v31);
      return;
    case 1140:
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(20, 28);
      v41 = 1140;
LABEL_150:
      CAEScriptAudioEntity::PlayResidentSoundEvent(
        this,
        2,
        39,
        RandomNumberInRange,
        v41,
        v9,
        pPhysical,
        0.0,
        1.0,
        0,
        1.0);
      return;
    case 1141:
      v32 = CAEAudioUtility::GetRandomNumberInRange(20, 28);
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 2, 39, v32, 1141, v9, pPhysical, 0.0, 1.0, 0, 1.0);
      v44 = 1141;
      v49 = v9;
      bInhibitOverlap = pPhysical;
      StartPercentage = 0;
      v58 = 1065353216;
LABEL_152:
      v28 = this;
      v29 = 2;
      v30 = 39;
      v18 = 65;
LABEL_240:
      CAEScriptAudioEntity::PlayResidentSoundEvent(
        v28,
        v29,
        v30,
        v18,
        v44,
        v49,
        bInhibitOverlap,
        0.0,
        1.0,
        StartPercentage,
        *(float *)&v58);
      return;
    case 1142:
      v23 = 160;
      goto LABEL_204;
    case 1144:
      if ( pPhysical )
      {
        CAudioEngine::ReportWaterSplash(&AudioEngine, pPhysical, -6.0, 0);
      }
      else
      {
        v60.x = vPosition->x;
        v60.y = vPosition->y;
        v60.z = v9->z;
        CAudioEngine::ReportWaterSplash(&AudioEngine, v60, -6.0);
      }
      return;
    case 1145:
      v19 = 65;
      v20 = 1145;
LABEL_157:
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 2, 39, 19, v20, vPosition, pPhysical, 0.0, 1.0, v19, 1.0);
      return;
    case 1147:
      if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 1147, this) )
        return;
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 17, 74, 7, 1147, v9, pPhysical, 0.0, 1.0, 0, 1.0);
LABEL_196:
      this->m_nLastMiniGameLoopTriggerTimeMs = CTimer::m_snTimeInMilliseconds;
      return;
    case 1150:
      v16 = 7;
LABEL_161:
      CAudioEngine::ReportFrontendAudioEvent(&AudioEngine, v16, 0.0, 1.0);
      return;
    case 1151:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x47Fu, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1152:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x480u, vPosition, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1155:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x483u, vPosition, pPhysical, 0, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1156:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x484u, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1157:
      if ( !pPhysical )
        return;
      v27 = WEAPONTYPE_M4;
      goto LABEL_168;
    case 1158:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x486u, vPosition, pPhysical, 3, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1159:
      if ( pPhysical )
      {
        v33 = pPhysical->m_pMat;
        vPosition = (CVector *)&v33->tx;
        if ( !v33 )
          vPosition = &pPhysical->m_transform.m_translate;
      }
      CAEExplosionAudioEntity::AddAudioEvent(&this->m_ExplosionAudioEntity, 129, vPosition, 0.0);
      return;
    case 1161:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x489u, vPosition, pPhysical, 1, 2, 0, 0.0, 2.0, 1.0);
      return;
    case 1162:
      if ( pPhysical )
      {
        v21 = 1161;
LABEL_177:
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntityAndPhysical(&AESoundManager, v21, this, pPhysical);
      }
      else
      {
        v17 = 1161;
LABEL_233:
        CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(&AESoundManager, v17, this);
      }
      return;
    case 1163:
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 41, 0, 0, 1163, vPosition, pPhysical, 0.0, 1.0, 0, 1.0);
      return;
    case 1164:
      v59.x = -1.0;
      v59.y = 0.0;
      v59.z = 0.0;
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x48Cu, &v59, 0, 0, 3, 0, 0.0, 2.0, 1.0);
      v59.x = 1.0;
      v59.y = 0.0;
      v59.z = 0.0;
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x48Cu, &v59, 0, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1165:
      p_m_DoorAudioEntity = &this->m_DoorAudioEntity;
      if ( pPhysical )
      {
        v15 = 1061830001;
        m_pMat = pPhysical->m_pMat;
LABEL_182:
        v40 = v15;
        vPosition = (CVector *)&m_pMat->tx;
        v35 = m_pMat == 0;
        v12 = 159;
        if ( v35 )
          vPosition = &pPhysical->m_transform.m_translate;
      }
      else
      {
        v37 = 1061830001;
LABEL_235:
        v40 = v37;
        v12 = 159;
      }
      goto LABEL_236;
    case 1167:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x48Fu, vPosition, pPhysical, 0, 3, 1, 0.0, 2.0, 1.0);
      goto LABEL_196;
    case 1168:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x490u, vPosition, pPhysical, 0, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1169:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x491u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1170:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x492u, vPosition, pPhysical, 6, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1171:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x493u, vPosition, pPhysical, 1, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1172:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x494u, vPosition, pPhysical, 2, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1173:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x495u, vPosition, pPhysical, 5, 3, 0, 0.0, 2.0, 0.67);
      return;
    case 1174:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x496u, vPosition, pPhysical, 5, 3, 0, 0.0, 2.0, 0.79);
      return;
    case 1175:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x497u, vPosition, pPhysical, 5, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1176:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x498u, vPosition, pPhysical, 8, 3, 1, 0.0, 2.0, 0.38);
      return;
    case 1177:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x499u, vPosition, pPhysical, 0, 3, 1, 0.0, 2.0, 1.0);
      goto LABEL_196;
    case 1178:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x49Au, vPosition, pPhysical, 3, 3, 1, 0.0, 2.0, 1.0);
      return;
    case 1179:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x49Bu, vPosition, pPhysical, 4, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1180:
      CAEScriptAudioEntity::PlayMissionBankSound(this, 0x49Cu, vPosition, pPhysical, 7, 3, 0, 0.0, 2.0, 1.0);
      return;
    case 1181:
      v23 = 172;
      goto LABEL_204;
    case 1183:
      v23 = 149;
      goto LABEL_204;
    case 1185:
      v23 = 142;
      goto LABEL_204;
    case 1187:
      v23 = 161;
LABEL_204:
      CAEAmbienceTrackManager::PlaySpecialMissionAmbienceTrack(&AEAmbienceTrackManager, v23);
      return;
    case 1189:
      v34 = CLocalisation::Blood();
      v35 = pPhysical == 0;
      if ( pPhysical )
        v35 = v34 == 0;
      if ( !v35 && (*(_BYTE *)&pPhysical->m_info & 7) == 3 )
        CAEPedAudioEntity::AddAudioEvent((CAEPedAudioEntity *)&pPhysical[1], 119, 0.0, 1.0, pPhysical, 0, 0, 0);
      return;
    case 1190:
      v36 = CAEAudioUtility::GetRandomNumberInRange(78, 80);
      CAEScriptAudioEntity::PlayResidentSoundEvent(this, 5, 143, v36, 1190, v9, pPhysical, 0.0, 1.0, 0, 1.0);
      return;
    default:
      return;
  }
}

//----- (003A72DC) --------------------------------------------------------
void __fastcall CAEScriptAudioEntity::ReportMissionAudioEvent(
        CAEScriptAudioEntity *this,
        UInt16 Event,
        CPhysical *pPhysical,
        float fVolumeOffsetdB,
        float fFrequencyScaling)
{
  CVector vPosition; // [sp+Ch] [bp-14h] BYREF

  vPosition.x = -1000.0;
  vPosition.y = -1000.0;
  vPosition.z = -1000.0;
  CAEScriptAudioEntity::ProcessMissionAudioEvent(this, Event, &vPosition, pPhysical, fVolumeOffsetdB, fFrequencyScaling);
}

//----- (003A7308) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::CAESmoothFadeThread(CAESmoothFadeThread *this)
{
  this->m_currentTime = 0;
  this->m_Thread = 0;
  this->m_nSmoothFades = 0;
  this->m_lastRequest = 0;
  *(_DWORD *)&this->m_bInitialised = 0;
}

//----- (003A7320) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::InitialiseRequestSlots(CAESmoothFadeThread *this)
{
  int i; // r2
  char *v2; // r3

  for ( i = 0; i != 2048; i += 32 )
  {
    v2 = (char *)this + i;
    *((_DWORD *)v2 + 1) = 0;
    *((_DWORD *)v2 + 7) = 0;
  }
}

//----- (003A7334) --------------------------------------------------------
bool __fastcall CAESmoothFadeThread::Initialise(CAESmoothFadeThread *this)
{
  int i; // r2
  char *v2; // r3

  for ( i = 0; i != 2048; i += 32 )
  {
    v2 = (char *)this + i;
    *((_DWORD *)v2 + 1) = 0;
    *((_DWORD *)v2 + 7) = 0;
  }
  this->m_bInitialised = 1;
  this->m_bSmoothFadesDisabled = 1;
  return 1;
}

//----- (003A7354) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::Start(CAESmoothFadeThread *this)
{
  this->m_bActive = 1;
}

//----- (003A735C) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::Stop(CAESmoothFadeThread *this)
{
  this->m_bActive = 0;
}

//----- (003A7364) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::WaitForExit(CAESmoothFadeThread *this)
{
  OSThreadHandle m_Thread; // r0

  m_Thread = this->m_Thread;
  if ( m_Thread )
    sub_196804(m_Thread);
}

//----- (003A7370) --------------------------------------------------------
int __fastcall CAESmoothFadeThread::RequestFade(
        CAESmoothFadeThread *this,
        OALSource *oalSource,
        float finishVolume,
        int duration,
        int a5)
{
  ALint curState; // r0
  ALuint sourceId; // r0
  float Volume; // r0
  int v12; // r12
  float v13; // s0
  int result; // r0
  int m_nSmoothFades; // r3
  AE_FADE_STATE *p_state; // r1
  int v17; // r0
  int v18; // lr
  bool v19; // zf
  char *v20; // r0
  char *v21; // r3
  _BYTE *v22; // r3
  int v23; // t1
  float *v24; // r0

  if ( !this->m_bInitialised || this->m_bSmoothFadesDisabled )
    return 0;
  OALSource::ObtainSource(oalSource);
  curState = oalSource->curState;
  if ( !curState )
  {
    sourceId = oalSource->sourceId;
    oalSource->curState = 4116;
    j_alGetSourcei(sourceId, 4112, &oalSource->curState);
    curState = oalSource->curState;
  }
  if ( curState != 4114 )
    return 0;
  Volume = OALSource::GetVolume(oalSource);
  v13 = Volume;
  if ( Volume == finishVolume || fabsf(Volume - finishVolume) < 0.01 )
  {
    if ( a5 != 1 )
      return 1;
    if ( oalSource->type == OST_Preloop )
      OALSource::UnqueueBuffers(oalSource);
    j_alSourceStop(oalSource->sourceId);
    oalSource->curState = 4116;
    oalSource->posOffset = 0;
    result = 1;
    oalSource->wasStopped = 1;
    return result;
  }
  m_nSmoothFades = this->m_nSmoothFades;
  if ( m_nSmoothFades < 1 )
    return 0;
  p_state = &this->m_fadeRequests[0].state;
  v17 = 0;
  v18 = 0;
  do
  {
    if ( *p_state == AE_FADE_STATE_ACTIVE )
    {
      if ( *((OALSource **)p_state - 6) == oalSource && duration - this->m_currentTime + *((_DWORD *)p_state + 1) > 1 )
        goto LABEL_25;
    }
    else if ( *p_state == AE_FADE_STATE_IDLE )
    {
      v19 = v18 << 31 == 0;
      v18 = 1;
      if ( v19 )
        v12 = v17;
    }
    ++v17;
    p_state += 8;
  }
  while ( v17 < m_nSmoothFades );
  if ( !(v18 << 31) )
    return 0;
  v20 = (char *)this + 32 * v12;
  p_state = (AE_FADE_STATE *)(v20 + 28);
  if ( *((_DWORD *)v20 + 7) != 1 )
  {
    ++g_numSoundChannelsUsed;
    v22 = v20 + 24;
    ++oalSource->refCount;
    *((_DWORD *)v20 + 1) = oalSource;
    v17 = v12;
    goto LABEL_29;
  }
  v17 = v12;
LABEL_25:
  v21 = (char *)this + 32 * v17;
  v23 = (unsigned __int8)v21[24];
  v22 = v21 + 24;
  if ( v23 )
    return 1;
LABEL_29:
  v24 = (float *)((char *)this + 32 * v17);
  v24[2] = v13;
  v24[3] = finishVolume;
  v24[4] = finishVolume - v13;
  v24[5] = v13;
  *v22 = a5;
  if ( duration == -2 )
  {
    LOWORD(duration) = 28;
  }
  else if ( duration == -1 )
  {
    LOWORD(duration) = 30;
  }
  *((_WORD *)v24 + 13) = duration;
  v24[8] = *(float *)&this->m_currentTime;
  result = 1;
  *p_state = AE_FADE_STATE_ACTIVE;
  return result;
}
// 3A7466: variable 'v12' is possibly undefined

//----- (003A74F4) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::CancelFade(CAESmoothFadeThread *this, OALSource *oalSource)
{
  int i; // r2
  char *v3; // lr

  if ( !this->m_bSmoothFadesDisabled )
  {
    for ( i = 0; i != 64; ++i )
    {
      v3 = (char *)this + i * 32;
      if ( this->m_fadeRequests[i].state == AE_FADE_STATE_ACTIVE && *((OALSource **)v3 + 1) == oalSource )
        *((_DWORD *)v3 + 7) = 2;
    }
  }
}

//----- (003A752C) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::SetBufferVolume(CAESmoothFadeThread *this, OALSource *oalSource, float volume)
{
  AE_FADE_STATE *p_state; // r12
  int v4; // r3
  bool v5; // zf
  float v6; // s2

  if ( this->m_bSmoothFadesDisabled )
    goto LABEL_7;
  p_state = &this->m_fadeRequests[0].state;
  v4 = -1;
  while ( 1 )
  {
    v5 = *p_state == AE_FADE_STATE_ACTIVE;
    if ( *p_state == AE_FADE_STATE_ACTIVE )
      v5 = *((_DWORD *)p_state - 6) == (_DWORD)oalSource;
    if ( v5 )
      break;
    ++v4;
    p_state += 8;
    if ( v4 >= 63 )
      goto LABEL_7;
  }
  if ( !*((_BYTE *)p_state - 4) )
  {
    v6 = *((float *)p_state - 4);
    if ( v6 != volume && fabsf(v6 - volume) >= 0.01 )
    {
      *p_state = AE_FADE_STATE_CANCELLED;
LABEL_7:
      sub_195AE4(oalSource, volume);
    }
  }
}

//----- (003A759C) --------------------------------------------------------
DWORD __fastcall CAESmoothFadeThread::SmoothFadeProc(LPVOID param)
{
  while ( *((_BYTE *)param + 2053) )
  {
    CAESmoothFadeThread::Service((CAESmoothFadeThread *)param);
    OS_ThreadSleep(1000);
  }
  return 0;
}

//----- (003A75C0) --------------------------------------------------------
void __fastcall CAESmoothFadeThread::Service(CAESmoothFadeThread *this)
{
  int i; // r11
  float Volume; // r0
  float v4; // s2
  int v5; // r6
  char *v6; // r8
  AE_FADE_STATE state; // r0
  OALSource *v8; // r6
  UInt32 m_currentTime; // r0
  UInt32 v10; // r1
  unsigned int v11; // r9
  unsigned int v12; // r10
  float v13; // s24
  float v14; // r0
  float v15; // r1
  OALBase *v16; // r0

  this->m_currentTime = CAEAudioUtility::GetCurrentTimeInMilliseconds();
  for ( i = 0; i != 64; ++i )
  {
    v6 = (char *)this + i * 32;
    state = this->m_fadeRequests[i].state;
    if ( state == AE_FADE_STATE_CANCELLED )
    {
      --g_numSoundChannelsUsed;
    }
    else
    {
      if ( state != AE_FADE_STATE_ACTIVE )
        continue;
      v8 = (OALSource *)*((_DWORD *)v6 + 1);
      if ( !v8 )
        continue;
      m_currentTime = this->m_currentTime;
      v10 = *((_DWORD *)v6 + 8);
      if ( m_currentTime < v10 )
        continue;
      v11 = *((unsigned __int16 *)v6 + 13);
      v12 = m_currentTime - v10;
      if ( m_currentTime - v10 < v11 )
      {
        v13 = *((float *)v6 + 2);
        v14 = powf(10.0, *((float *)v6 + 4) / 20.0);
        v15 = v13 + (float)(log10f((float)((float)((float)v12 / (float)v11) * (float)(v14 + -1.0)) + 1.0) * 20.0);
        *((float *)v6 + 5) = v15;
        OALSource::SetVolume(v8, v15);
        continue;
      }
      Volume = OALSource::GetVolume(*((OALSource **)v6 + 1));
      if ( v6[24] || (v4 = *((float *)v6 + 5), Volume == v4) || fabsf(Volume - v4) < 0.01 )
      {
        OALSource::SetVolume(*((OALSource **)v6 + 1), *((float *)v6 + 3));
        if ( v6[24] )
        {
          v5 = *((_DWORD *)v6 + 1);
          if ( *(_DWORD *)(v5 + 12) == 2 )
            OALSource::UnqueueBuffers(*((OALSource **)v6 + 1));
          j_alSourceStop(*(_DWORD *)(v5 + 8));
          *(_DWORD *)(v5 + 40) = 4116;
          *(_DWORD *)(v5 + 32) = 0;
          *(_BYTE *)(v5 + 44) = 1;
        }
      }
      --g_numSoundChannelsUsed;
    }
    v16 = (OALBase *)*((_DWORD *)v6 + 1);
    if ( v16 )
      OALBase::Release(v16);
    *((_DWORD *)v6 + 1) = 0;
    *((_DWORD *)v6 + 7) = 0;
  }
}

//----- (003A7758) --------------------------------------------------------
void __fastcall CAESound::CAESound(
        CAESound *this,
        Int16 BankSlotID,
        Int16 SoundID,
        CAEAudioEntity *pAudioEntity,
        CVector Position,
        float Volume,
        float RollOffFactor,
        float RelativeFrequency,
        float Doppler,
        UInt8 FrameDelay,
        UInt16 Environment,
        float FrequencyVariance)
{
  this->m_SoundID = SoundID;
  this->m_BankSlotID = BankSlotID;
  this->m_pAudioEntity = pAudioEntity;
  this->m_pPhysicalEntity = 0;
  this->m_AudioEvent = -1;
  this->m_ClientVariable = -1.0;
  *(_QWORD *)&this->m_PositionLastFrame.x = 0LL;
  *(_QWORD *)&this->m_PositionLastFrame.z = 0LL;
  CAESound::SetPosition(this, Position);
  this->m_Doppler = Doppler;
  this->m_FrameDelay = FrameDelay;
  this->m_Environment = Environment;
  this->m_EmittedVolume = Volume;
  this->m_RollOffFactor = RollOffFactor;
  this->m_RelativeFrequency = RelativeFrequency;
  this->m_FrequencyVariance = FrequencyVariance;
  this->m_bCurrentlyInUse = 1;
  this->m_bPhysicallyPlaying = 0;
  this->m_nPlayTime = 0;
  *(_QWORD *)&this->m_ListenerVolume = 0x3F800000C2C80000LL;
  this->m_fHeadroom = 0.0;
  this->m_nLength = -1;
}

//----- (003A77FC) --------------------------------------------------------
void __fastcall CAESound::SetPosition(CAESound *this, CVector position)
{
  UInt32 m_FramePositionLastUpdated; // lr
  UInt32 v3; // r12
  float y; // s0
  UInt32 *p_m_TimePositionUpdated; // r0
  float v6; // s0
  float v7; // s0
  UInt32 v8; // r1
  CVector *p_m_Position; // lr
  UInt32 m_TimePositionUpdated; // t1
  float v11; // s0
  __int64 v12; // d16
  UInt32 v13; // r5
  float v14; // s2
  float v15; // s6
  float v16; // s0

  m_FramePositionLastUpdated = this->m_FramePositionLastUpdated;
  if ( m_FramePositionLastUpdated )
  {
    v3 = CTimer::m_FrameCounter;
    if ( CTimer::m_FrameCounter == m_FramePositionLastUpdated )
    {
      y = position.y;
      this->m_Position = position;
      LODWORD(position.y) = &TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        LODWORD(position.y) = &TheCamera.m_transform;
      this->m_fDistanceFromCamera = sqrtf(
                                      (float)((float)((float)(position.x - *(float *)LODWORD(position.y))
                                                    * (float)(position.x - *(float *)LODWORD(position.y)))
                                            + (float)((float)(y - *(float *)(LODWORD(position.y) + 4))
                                                    * (float)(y - *(float *)(LODWORD(position.y) + 4))))
                                    + (float)((float)(position.z - *(float *)(LODWORD(position.y) + 8))
                                            * (float)(position.z - *(float *)(LODWORD(position.y) + 8))));
      p_m_TimePositionUpdated = &this->m_TimePositionUpdated;
    }
    else
    {
      p_m_Position = &this->m_Position;
      m_TimePositionUpdated = this->m_TimePositionUpdated;
      p_m_TimePositionUpdated = &this->m_TimePositionUpdated;
      v11 = position.y;
      v12 = *(_QWORD *)&p_m_Position->x;
      *(p_m_TimePositionUpdated - 2) = LODWORD(p_m_Position->z);
      *(p_m_TimePositionUpdated - 5) = LODWORD(position.z);
      v13 = p_m_TimePositionUpdated[2];
      *(p_m_TimePositionUpdated - 6) = LODWORD(position.y);
      *(p_m_TimePositionUpdated - 7) = LODWORD(position.x);
      *((_QWORD *)p_m_TimePositionUpdated - 2) = v12;
      p_m_TimePositionUpdated[3] = v13;
      p_m_TimePositionUpdated[1] = m_TimePositionUpdated;
      LODWORD(position.y) = &TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        LODWORD(position.y) = &TheCamera.m_transform;
      v14 = position.x - *(float *)LODWORD(position.y);
      v15 = *(float *)(LODWORD(position.y) + 8);
      v16 = v11 - *(float *)(LODWORD(position.y) + 4);
      *(p_m_TimePositionUpdated - 1) = v3;
      *((float *)p_m_TimePositionUpdated + 2) = sqrtf(
                                                  (float)((float)(v14 * v14) + (float)(v16 * v16))
                                                + (float)((float)(position.z - v15) * (float)(position.z - v15)));
    }
    *p_m_TimePositionUpdated = CTimer::m_snTimeInMilliseconds;
  }
  else
  {
    this->m_PositionLastFrame = position;
    v6 = position.y;
    this->m_Position = position;
    LODWORD(position.y) = &TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      LODWORD(position.y) = &TheCamera.m_transform;
    v7 = sqrtf(
           (float)((float)((float)(position.x - *(float *)LODWORD(position.y))
                         * (float)(position.x - *(float *)LODWORD(position.y)))
                 + (float)((float)(v6 - *(float *)(LODWORD(position.y) + 4))
                         * (float)(v6 - *(float *)(LODWORD(position.y) + 4))))
         + (float)((float)(position.z - *(float *)(LODWORD(position.y) + 8))
                 * (float)(position.z - *(float *)(LODWORD(position.y) + 8))));
    this->m_fDistanceFromCamera = v7;
    this->m_fDistanceFromCameraLastFrame = v7;
    this->m_FramePositionLastUpdated = CTimer::m_FrameCounter;
    v8 = CTimer::m_snTimeInMilliseconds;
    this->m_TimePositionUpdated = CTimer::m_snTimeInMilliseconds;
    this->m_TimeLastPositionUpdated = v8;
  }
}

//----- (003A79B4) --------------------------------------------------------
void __fastcall CAESound::CAESound(CAESound *this, CAESound *CS)
{
  __int64 v3; // d16
  __int64 v4; // d16
  Int16 m_nLength; // r0
  CEntity *m_pPhysicalEntity; // r0

  this->m_BankSlotID = CS->m_BankSlotID;
  this->m_SoundID = CS->m_SoundID;
  this->m_pAudioEntity = CS->m_pAudioEntity;
  this->m_AudioEvent = CS->m_AudioEvent;
  this->m_ClientVariable = CS->m_ClientVariable;
  this->m_EmittedVolume = CS->m_EmittedVolume;
  this->m_RollOffFactor = CS->m_RollOffFactor;
  this->m_RelativeFrequency = CS->m_RelativeFrequency;
  this->m_FrequencyVariance = CS->m_FrequencyVariance;
  v3 = *(_QWORD *)&CS->m_Position.x;
  this->m_Position.z = CS->m_Position.z;
  *(_QWORD *)&this->m_Position.x = v3;
  v4 = *(_QWORD *)&CS->m_PositionLastFrame.x;
  this->m_PositionLastFrame.z = CS->m_PositionLastFrame.z;
  *(_QWORD *)&this->m_PositionLastFrame.x = v4;
  this->m_FramePositionLastUpdated = CS->m_FramePositionLastUpdated;
  this->m_TimePositionUpdated = CS->m_TimePositionUpdated;
  this->m_TimeLastPositionUpdated = CS->m_TimeLastPositionUpdated;
  this->m_fDistanceFromCamera = CS->m_fDistanceFromCamera;
  this->m_fDistanceFromCameraLastFrame = CS->m_fDistanceFromCameraLastFrame;
  this->m_Doppler = CS->m_Doppler;
  this->m_FrameDelay = CS->m_FrameDelay;
  this->m_Environment = CS->m_Environment;
  this->m_bCurrentlyInUse = CS->m_bCurrentlyInUse;
  this->m_nPlayTime = CS->m_nPlayTime;
  this->m_bPhysicallyPlaying = CS->m_bPhysicallyPlaying;
  this->m_ListenerVolume = CS->m_ListenerVolume;
  this->m_RelativePlaybackFrequency = CS->m_RelativePlaybackFrequency;
  this->m_bRequestedStopped = CS->m_bRequestedStopped;
  this->m_fHeadroom = CS->m_fHeadroom;
  m_nLength = CS->m_nLength;
  this->m_pPhysicalEntity = 0;
  this->m_nLength = m_nLength;
  m_pPhysicalEntity = CS->m_pPhysicalEntity;
  if ( m_pPhysicalEntity )
  {
    this->m_pPhysicalEntity = m_pPhysicalEntity;
    CEntity::RegisterReference(CS->m_pPhysicalEntity, &this->m_pPhysicalEntity);
  }
}

//----- (003A7A6C) --------------------------------------------------------
void __fastcall CAESound::~CAESound(CAESound *this)
{
  CEntity *m_pPhysicalEntity; // r0
  CEntity **p_m_pPhysicalEntity; // r5

  p_m_pPhysicalEntity = &this->m_pPhysicalEntity;
  m_pPhysicalEntity = this->m_pPhysicalEntity;
  if ( m_pPhysicalEntity )
  {
    CEntity::CleanUpOldReference(m_pPhysicalEntity, p_m_pPhysicalEntity);
    *p_m_pPhysicalEntity = 0;
  }
}

//----- (003A7A88) --------------------------------------------------------
void __fastcall CAESound::UnregisterWithPhysicalEntity(CAESound *this)
{
  CEntity *m_pPhysicalEntity; // r0
  CEntity **p_m_pPhysicalEntity; // r4

  p_m_pPhysicalEntity = &this->m_pPhysicalEntity;
  m_pPhysicalEntity = this->m_pPhysicalEntity;
  if ( m_pPhysicalEntity )
  {
    CEntity::CleanUpOldReference(m_pPhysicalEntity, p_m_pPhysicalEntity);
    *p_m_pPhysicalEntity = 0;
  }
}

//----- (003A7AA4) --------------------------------------------------------
CAESound *__fastcall CAESound::operator=(CAESound *this, CAESound *CS)
{
  CEntity *m_pPhysicalEntity; // r0
  CEntity **p_m_pPhysicalEntity; // r6
  __int64 v6; // d16
  __int64 v7; // d16
  Int16 m_nLength; // r0
  CEntity *v9; // r0

  if ( this != CS )
  {
    p_m_pPhysicalEntity = &this->m_pPhysicalEntity;
    m_pPhysicalEntity = this->m_pPhysicalEntity;
    if ( m_pPhysicalEntity )
    {
      CEntity::CleanUpOldReference(m_pPhysicalEntity, &this->m_pPhysicalEntity);
      *p_m_pPhysicalEntity = 0;
    }
    this->m_BankSlotID = CS->m_BankSlotID;
    this->m_SoundID = CS->m_SoundID;
    this->m_pAudioEntity = CS->m_pAudioEntity;
    this->m_AudioEvent = CS->m_AudioEvent;
    this->m_ClientVariable = CS->m_ClientVariable;
    this->m_EmittedVolume = CS->m_EmittedVolume;
    this->m_RollOffFactor = CS->m_RollOffFactor;
    this->m_RelativeFrequency = CS->m_RelativeFrequency;
    this->m_FrequencyVariance = CS->m_FrequencyVariance;
    v6 = *(_QWORD *)&CS->m_Position.x;
    this->m_Position.z = CS->m_Position.z;
    *(_QWORD *)&this->m_Position.x = v6;
    v7 = *(_QWORD *)&CS->m_PositionLastFrame.x;
    this->m_PositionLastFrame.z = CS->m_PositionLastFrame.z;
    *(_QWORD *)&this->m_PositionLastFrame.x = v7;
    this->m_FramePositionLastUpdated = CS->m_FramePositionLastUpdated;
    this->m_TimePositionUpdated = CS->m_TimePositionUpdated;
    this->m_TimeLastPositionUpdated = CS->m_TimeLastPositionUpdated;
    this->m_fDistanceFromCamera = CS->m_fDistanceFromCamera;
    this->m_fDistanceFromCameraLastFrame = CS->m_fDistanceFromCameraLastFrame;
    this->m_Doppler = CS->m_Doppler;
    this->m_FrameDelay = CS->m_FrameDelay;
    this->m_Environment = CS->m_Environment;
    this->m_bCurrentlyInUse = CS->m_bCurrentlyInUse;
    this->m_nPlayTime = CS->m_nPlayTime;
    this->m_bPhysicallyPlaying = CS->m_bPhysicallyPlaying;
    this->m_ListenerVolume = CS->m_ListenerVolume;
    this->m_RelativePlaybackFrequency = CS->m_RelativePlaybackFrequency;
    this->m_bRequestedStopped = CS->m_bRequestedStopped;
    this->m_fHeadroom = CS->m_fHeadroom;
    m_nLength = CS->m_nLength;
    this->m_pPhysicalEntity = 0;
    this->m_nLength = m_nLength;
    v9 = CS->m_pPhysicalEntity;
    if ( v9 )
    {
      *p_m_pPhysicalEntity = v9;
      CEntity::RegisterReference(CS->m_pPhysicalEntity, &this->m_pPhysicalEntity);
    }
  }
  return this;
}

//----- (003A7B78) --------------------------------------------------------
void __fastcall CAESound::Initialise(
        CAESound *this,
        Int16 BankSlotID,
        Int16 SoundID,
        CAEAudioEntity *pAudioEntity,
        CVector Position,
        float Volume,
        float RollOffFactor,
        float RelativeFrequency,
        float Doppler,
        UInt8 FrameDelay,
        UInt16 Environment,
        float FrequencyVariance,
        Int16 PlayTime)
{
  CEntity *m_pPhysicalEntity; // r0
  CEntity **p_m_pPhysicalEntity; // r6

  this->m_SoundID = SoundID;
  this->m_BankSlotID = BankSlotID;
  p_m_pPhysicalEntity = &this->m_pPhysicalEntity;
  m_pPhysicalEntity = this->m_pPhysicalEntity;
  this->m_pAudioEntity = pAudioEntity;
  if ( m_pPhysicalEntity )
  {
    CEntity::CleanUpOldReference(m_pPhysicalEntity, p_m_pPhysicalEntity);
    *p_m_pPhysicalEntity = 0;
  }
  this->m_AudioEvent = -1;
  this->m_ClientVariable = -1.0;
  this->m_EmittedVolume = Volume;
  this->m_RollOffFactor = RollOffFactor;
  this->m_RelativeFrequency = RelativeFrequency;
  this->m_FrequencyVariance = FrequencyVariance;
  *(_QWORD *)&this->m_PositionLastFrame.x = 0LL;
  *(_QWORD *)&this->m_PositionLastFrame.z = 0LL;
  CAESound::SetPosition(this, Position);
  this->m_FrameDelay = FrameDelay;
  this->m_Doppler = Doppler;
  this->m_Environment = Environment;
  this->m_bCurrentlyInUse = 1;
  this->m_nPlayTime = PlayTime;
  this->m_bPhysicallyPlaying = 0;
  this->m_ListenerVolume = -100.0;
  this->m_RelativePlaybackFrequency = 1.0;
  this->m_bRequestedStopped = 0;
  this->m_fHeadroom = 0.0;
  this->m_nLength = -1;
}

//----- (003A7C44) --------------------------------------------------------
void __fastcall CAESound::NewVPSLentry(CAESound *this)
{
  Int16 m_BankSlotID; // r2
  float SoundHeadroom; // r0
  float m_FrequencyVariance; // s0
  float m_RelativeFrequency; // s16

  this->m_bPhysicallyPlaying = 0;
  this->m_bRequestedStopped = 0;
  m_BankSlotID = this->m_BankSlotID;
  *(_DWORD *)&this->m_bCurrentlyInUse = 1;
  SoundHeadroom = CAEAudioHardware::GetSoundHeadroom(&AEAudioHardware, this->m_SoundID, m_BankSlotID);
  m_FrequencyVariance = this->m_FrequencyVariance;
  m_RelativeFrequency = this->m_RelativeFrequency;
  this->m_fHeadroom = SoundHeadroom;
  if ( m_FrequencyVariance > 0.0 && m_FrequencyVariance < m_RelativeFrequency )
    m_RelativeFrequency = m_RelativeFrequency
                        + CAEAudioUtility::GetRandomNumberInRange(
                            COERCE_FLOAT(LODWORD(m_FrequencyVariance) ^ 0x80000000),
                            m_FrequencyVariance);
  this->m_RelativePlaybackFrequency = m_RelativeFrequency;
}

//----- (003A7CAC) --------------------------------------------------------
void __fastcall CAESound::CalculateFrequency(CAESound *this)
{
  float m_FrequencyVariance; // s0
  float m_RelativeFrequency; // s16

  m_FrequencyVariance = this->m_FrequencyVariance;
  m_RelativeFrequency = this->m_RelativeFrequency;
  if ( m_FrequencyVariance > 0.0 && m_FrequencyVariance < m_RelativeFrequency )
    m_RelativeFrequency = m_RelativeFrequency
                        + CAEAudioUtility::GetRandomNumberInRange(
                            COERCE_FLOAT(LODWORD(m_FrequencyVariance) ^ 0x80000000),
                            this->m_FrequencyVariance);
  this->m_RelativePlaybackFrequency = m_RelativeFrequency;
}

//----- (003A7CF0) --------------------------------------------------------
void __fastcall CAESound::UpdateParameters(CAESound *this, Int16 PlayTime)
{
  int v3; // r5
  UInt16 m_Environment; // r0
  CEntity *m_pPhysicalEntity; // r1
  CMatrix *m_pMat; // r0
  CVector *p_tx; // r3
  CAEAudioEntity *m_pAudioEntity; // r0

  v3 = PlayTime;
  m_Environment = this->m_Environment;
  if ( (m_Environment & 0x80) != 0 )
  {
    m_pPhysicalEntity = this->m_pPhysicalEntity;
    if ( m_pPhysicalEntity )
    {
      m_pMat = m_pPhysicalEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pPhysicalEntity->m_transform.m_translate;
      CAESound::SetPosition(this, *p_tx);
      m_Environment = this->m_Environment;
    }
    else
    {
      this->m_bRequestedStopped = 1;
    }
  }
  if ( (m_Environment & 4) != 0 )
  {
    m_pAudioEntity = this->m_pAudioEntity;
    if ( m_pAudioEntity )
    {
      ((void (__fastcall *)(CAEAudioEntity *, CAESound *, int))*m_pAudioEntity->_vptr$CAEAudioEntity)(
        m_pAudioEntity,
        this,
        v3);
      if ( this->m_FrequencyVariance == 0.0 )
        this->m_RelativePlaybackFrequency = this->m_RelativeFrequency;
    }
  }
}

//----- (003A7D4E) --------------------------------------------------------
Bool16 __fastcall CAESound::GetLifespanTiedToPhysicalEntity(CAESound *this)
{
  return (this->m_Environment >> 7) & 1;
}

//----- (003A7D58) --------------------------------------------------------
void __fastcall CAESound::StopSound(CAESound *this)
{
  CEntity *m_pPhysicalEntity; // r0
  CEntity **p_m_pPhysicalEntity; // r4

  p_m_pPhysicalEntity = &this->m_pPhysicalEntity;
  m_pPhysicalEntity = this->m_pPhysicalEntity;
  *((_WORD *)p_m_pPhysicalEntity + 48) = 1;
  if ( m_pPhysicalEntity )
  {
    CEntity::CleanUpOldReference(m_pPhysicalEntity, p_m_pPhysicalEntity);
    *p_m_pPhysicalEntity = 0;
  }
}

//----- (003A7D7A) --------------------------------------------------------
Bool16 __fastcall CAESound::GetRequestUpdates(CAESound *this)
{
  return (this->m_Environment >> 2) & 1;
}

//----- (003A7D84) --------------------------------------------------------
void __fastcall CAESound::UpdateFrequency(CAESound *this)
{
  if ( this->m_FrequencyVariance == 0.0 )
    this->m_RelativePlaybackFrequency = this->m_RelativeFrequency;
}

//----- (003A7D98) --------------------------------------------------------
void __fastcall CAESound::RegisterWithPhysicalEntity(CAESound *this, CEntity *pPhysicalEntity)
{
  CEntity *m_pPhysicalEntity; // r0
  CEntity **p_m_pPhysicalEntity; // r4

  p_m_pPhysicalEntity = &this->m_pPhysicalEntity;
  m_pPhysicalEntity = this->m_pPhysicalEntity;
  if ( m_pPhysicalEntity )
  {
    CEntity::CleanUpOldReference(m_pPhysicalEntity, p_m_pPhysicalEntity);
    *p_m_pPhysicalEntity = 0;
  }
  if ( pPhysicalEntity )
  {
    *p_m_pPhysicalEntity = pPhysicalEntity;
    sub_196050(pPhysicalEntity, p_m_pPhysicalEntity);
  }
}

//----- (003A7DC4) --------------------------------------------------------
void __fastcall CAESound::StopSoundAndForget(CAESound *this)
{
  CEntity *m_pPhysicalEntity; // r0
  CEntity **p_m_pPhysicalEntity; // r4
  __int16 v3; // r1

  p_m_pPhysicalEntity = &this->m_pPhysicalEntity;
  m_pPhysicalEntity = this->m_pPhysicalEntity;
  *((_WORD *)p_m_pPhysicalEntity + 48) = 1;
  v3 = *((_WORD *)p_m_pPhysicalEntity + 39);
  *(p_m_pPhysicalEntity - 1) = 0;
  *((_WORD *)p_m_pPhysicalEntity + 39) = v3 & 0xFFFB;
  if ( m_pPhysicalEntity )
  {
    CEntity::CleanUpOldReference(m_pPhysicalEntity, p_m_pPhysicalEntity);
    *p_m_pPhysicalEntity = 0;
  }
}

//----- (003A7DF6) --------------------------------------------------------
void __fastcall CAESound::SetIndividualEnvironment(CAESound *this, UInt16 environment, Bool16 tf)
{
  UInt16 m_Environment; // r12
  UInt16 v4; // r3

  m_Environment = this->m_Environment;
  v4 = m_Environment & ~environment;
  if ( tf )
    v4 = m_Environment | environment;
  this->m_Environment = v4;
}

//----- (003A7E0C) --------------------------------------------------------
Bool16 __fastcall CAESound::GetUncancellable(CAESound *this)
{
  return (this->m_Environment >> 1) & 1;
}

//----- (003A7E16) --------------------------------------------------------
Bool16 __fastcall CAESound::GetFrontEnd(CAESound *this)
{
  return this->m_Environment & 1;
}

//----- (003A7E20) --------------------------------------------------------
Bool16 __fastcall CAESound::GetUnpausable(CAESound *this)
{
  return (this->m_Environment >> 4) & 1;
}

//----- (003A7E2A) --------------------------------------------------------
Bool16 __fastcall CAESound::GetPlayPhysically(CAESound *this)
{
  return (this->m_Environment >> 3) & 1;
}

//----- (003A7E34) --------------------------------------------------------
Bool16 __fastcall CAESound::GetStartPercentage(CAESound *this)
{
  return (this->m_Environment >> 5) & 1;
}

//----- (003A7E3E) --------------------------------------------------------
Bool16 __fastcall CAESound::GetMusicMastered(CAESound *this)
{
  return (this->m_Environment >> 6) & 1;
}

//----- (003A7E48) --------------------------------------------------------
Bool16 __fastcall CAESound::GetUnduckable(CAESound *this)
{
  return HIBYTE(this->m_Environment) & 1;
}

//----- (003A7E52) --------------------------------------------------------
Bool16 __fastcall CAESound::GetUncompressable(CAESound *this)
{
  return (this->m_Environment >> 9) & 1;
}

//----- (003A7E5C) --------------------------------------------------------
Bool16 __fastcall CAESound::GetRolledOff(CAESound *this)
{
  return (this->m_Environment >> 10) & 1;
}

//----- (003A7E66) --------------------------------------------------------
Bool16 __fastcall CAESound::GetSmoothDucking(CAESound *this)
{
  return (this->m_Environment >> 11) & 1;
}

//----- (003A7E70) --------------------------------------------------------
Bool16 __fastcall CAESound::GetForcedFront(CAESound *this)
{
  return (this->m_Environment >> 12) & 1;
}

//----- (003A7E7A) --------------------------------------------------------
void __fastcall CAESound::SoundHasFinished(CAESound *this)
{
  UInt16 m_Environment; // r0
  CEntity *m_pPhysicalEntity; // r1
  CMatrix *m_pMat; // r0
  CVector *p_tx; // r3
  CAEAudioEntity *m_pAudioEntity; // r0
  CEntity *v7; // r0

  m_Environment = this->m_Environment;
  if ( (m_Environment & 0x80) != 0 )
  {
    m_pPhysicalEntity = this->m_pPhysicalEntity;
    if ( !m_pPhysicalEntity )
    {
      this->m_bRequestedStopped = 1;
      if ( (m_Environment & 4) == 0 )
        goto LABEL_12;
      goto LABEL_7;
    }
    m_pMat = m_pPhysicalEntity->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pPhysicalEntity->m_transform.m_translate;
    CAESound::SetPosition(this, *p_tx);
    m_Environment = this->m_Environment;
  }
  if ( (m_Environment & 4) == 0 )
    goto LABEL_12;
LABEL_7:
  m_pAudioEntity = this->m_pAudioEntity;
  if ( m_pAudioEntity )
  {
    (*(void (__fastcall **)(CAEAudioEntity *, CAESound *, int))m_pAudioEntity->_vptr$CAEAudioEntity)(
      m_pAudioEntity,
      this,
      -1);
    if ( this->m_FrequencyVariance == 0.0 )
      this->m_RelativePlaybackFrequency = this->m_RelativeFrequency;
  }
LABEL_12:
  v7 = this->m_pPhysicalEntity;
  this->m_bCurrentlyInUse = 0;
  if ( v7 )
  {
    CEntity::CleanUpOldReference(v7, &this->m_pPhysicalEntity);
    this->m_pPhysicalEntity = 0;
  }
  *(_DWORD *)&this->m_nPlayTime = 0;
}

//----- (003A7EFC) --------------------------------------------------------
void __fastcall CAESound::UpdatePlayTime(
        CAESound *this,
        Int16 VirtualChannelSoundLength,
        Int16 VirtualChannelSoundLoopStartTime,
        Int16 TimeElapsed)
{
  Int16 v6; // r2
  int v7; // r0
  bool v8; // zf

  this->m_nLength = VirtualChannelSoundLength;
  if ( !this->m_bPhysicallyPlaying )
  {
    v6 = -1;
    if ( this->m_bRequestedStopped )
    {
LABEL_3:
      this->m_nPlayTime = v6;
      return;
    }
    v7 = (int)(float)((float)(this->m_RelativePlaybackFrequency * (float)TimeElapsed) + (float)this->m_nPlayTime);
    this->m_nPlayTime = v7;
    if ( v7 >= VirtualChannelSoundLength )
    {
      v8 = VirtualChannelSoundLength == 0;
      if ( VirtualChannelSoundLength )
        v8 = (unsigned __int16)VirtualChannelSoundLoopStartTime == 0xFFFF;
      if ( !v8 )
        v6 = v7 % VirtualChannelSoundLength + VirtualChannelSoundLoopStartTime;
      goto LABEL_3;
    }
  }
}

//----- (003A7F66) --------------------------------------------------------
void __fastcall CAESound::CalculateVolume(CAESound *this)
{
  float v2; // s16
  float v3; // s16
  float m_EmittedVolume; // s0
  CVector pRelativePosition; // [sp+4h] [bp-1Ch] BYREF

  if ( LOBYTE(this->m_Environment) << 31 )
  {
    m_EmittedVolume = this->m_EmittedVolume;
  }
  else
  {
    CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, &this->m_Position);
    v2 = this->m_EmittedVolume;
    v3 = v2
       + CAEAudioEnvironment::GetDistanceAttenuation(
           sqrtf(
             (float)((float)(pRelativePosition.x * pRelativePosition.x)
                   + (float)(pRelativePosition.y * pRelativePosition.y))
           + (float)(pRelativePosition.z * pRelativePosition.z))
         / this->m_RollOffFactor);
    m_EmittedVolume = v3 + CAEAudioEnvironment::GetDirectionalMikeAttenuation(&pRelativePosition);
  }
  this->m_ListenerVolume = m_EmittedVolume - this->m_fHeadroom;
}

//----- (003A7FEE) --------------------------------------------------------
void __fastcall CAESound::GetRelativePosition(CAESound *this, CVector *pRelativePosition)
{
  CVector *p_m_Position; // r2
  __int64 v3; // d16

  p_m_Position = &this->m_Position;
  if ( LOBYTE(this->m_Environment) << 31 )
  {
    v3 = *(_QWORD *)&p_m_Position->x;
    pRelativePosition->z = this->m_Position.z;
    *(_QWORD *)&pRelativePosition->x = v3;
  }
  else
  {
    sub_18B860(pRelativePosition, p_m_Position);
  }
}

//----- (003A8010) --------------------------------------------------------
float __fastcall CAESound::GetRelativePlaybackFrequencyWithDoppler(CAESound *this)
{
  float m_RelativePlaybackFrequency; // s16

  m_RelativePlaybackFrequency = this->m_RelativePlaybackFrequency;
  if ( !(LOBYTE(this->m_Environment) << 31) )
    return m_RelativePlaybackFrequency
         * CAEAudioEnvironment::GetDopplerRelativeFrequency(
             this->m_fDistanceFromCameraLastFrame,
             this->m_fDistanceFromCamera,
             this->m_TimeLastPositionUpdated,
             this->m_TimePositionUpdated,
             this->m_Doppler);
  return m_RelativePlaybackFrequency;
}

//----- (003A8050) --------------------------------------------------------
float __fastcall CAESound::GetSlowMoFrequencyScalingFactor(CAESound *this)
{
  float v1; // s16

  v1 = 1.0;
  if ( (this->m_Environment & 0x10) == 0
    && CTimer::GetIsSlowMotionActive()
    && TheCamera.Cams[TheCamera.ActiveCam].Mode != 46 )
  {
    return 0.5;
  }
  return v1;
}

//----- (003A8098) --------------------------------------------------------
void __fastcall CAESoundManager::Terminate(CAESoundManager *this)
{
  CAEPhysicallyPlayingSound *m_PhysicallyPlayingSoundList; // r0
  CAEPhysicallyPlayingSound **p_m_PhysicallyPlayingSoundList; // r5
  Int16 *m_ChannelPosition; // r0
  Int16 **p_m_ChannelPosition; // r6
  tSoundReference *m_PrioritisedSoundList; // r0
  tSoundReference **p_m_PrioritisedSoundList; // r4

  m_PhysicallyPlayingSoundList = this->m_PhysicallyPlayingSoundList;
  if ( m_PhysicallyPlayingSoundList )
    operator delete[](&m_PhysicallyPlayingSoundList[-4]);
  p_m_PhysicallyPlayingSoundList = &this->m_PhysicallyPlayingSoundList;
  m_ChannelPosition = this->m_ChannelPosition;
  p_m_ChannelPosition = &this->m_ChannelPosition;
  if ( m_ChannelPosition )
    operator delete[](m_ChannelPosition);
  m_PrioritisedSoundList = this->m_PrioritisedSoundList;
  p_m_PrioritisedSoundList = &this->m_PrioritisedSoundList;
  if ( m_PrioritisedSoundList )
    operator delete[](m_PrioritisedSoundList);
  *p_m_PhysicallyPlayingSoundList = 0;
  *p_m_ChannelPosition = 0;
  *p_m_PrioritisedSoundList = 0;
}

//----- (003A80E2) --------------------------------------------------------
void __fastcall CAESoundManager::Reset(CAESoundManager *this)
{
  Bool16 *p_m_bCurrentlyInUse; // r4
  int v2; // r5
  CEntity *v3; // r0

  p_m_bCurrentlyInUse = &this->m_VirtuallyPlayingSoundList[0].m_bCurrentlyInUse;
  v2 = 300;
  do
  {
    if ( *p_m_bCurrentlyInUse )
    {
      v3 = (CEntity *)*((_DWORD *)p_m_bCurrentlyInUse - 20);
      p_m_bCurrentlyInUse[8] = 1;
      if ( v3 )
      {
        CEntity::CleanUpOldReference(v3, (CEntity **)p_m_bCurrentlyInUse - 20);
        *((_DWORD *)p_m_bCurrentlyInUse - 20) = 0;
      }
    }
    --v2;
    p_m_bCurrentlyInUse += 58;
  }
  while ( v2 );
}

//----- (003A8120) --------------------------------------------------------
void __fastcall CAESoundManager::PauseManually(CAESoundManager *this, Bool8 On)
{
  this->m_bManualPause = On;
}

//----- (003A8128) --------------------------------------------------------
void __fastcall CAESoundManager::Service(CAESoundManager *this)
{
  int v2; // r1
  int v3; // r2
  UInt32 m_TimeLastCalled; // r1
  UInt32 *p_m_TimeLastCalled; // r3
  uint32 v6; // r2
  Bool8 *p_m_GamePausedLastFrame; // r0
  __int16 v8; // r8
  char v9; // r1
  UInt32 *p_m_TimeLastCalledUnpaused; // r3
  UInt32 v11; // r2
  __int16 v12; // r0
  Int16 **p_m_ChannelPosition; // r9
  int v14; // r0
  int i; // r1
  UInt16 *v16; // r3
  int v17; // r6
  bool v18; // zf
  CAEPhysicallyPlayingSound **p_m_PhysicallyPlayingSoundList; // r4
  int v20; // r0
  signed __int16 v21; // r5
  int m_SoundReference; // r1
  int v23; // r5
  int v24; // r6
  int v25; // r3
  int v26; // r1
  int v27; // r4
  int v28; // r0
  int v29; // s2
  float v30; // s0
  int v31; // r0
  int v32; // r0
  __int16 v33; // r2
  char *v34; // r11
  bool v35; // zf
  UInt16 m_AllocatedPhysicalChannels; // r0
  int v37; // r3
  __int16 v38; // r2
  Int16 *p_m_nPlayTime; // r4
  int v40; // r5
  UInt16 *p_m_Environment; // r5
  int v42; // r4
  UInt16 *v43; // r6
  UInt16 v44; // r0
  signed __int16 v45; // r11
  int v46; // r1
  CVector *v47; // r0
  CVector *v48; // r3
  void (__fastcall ***v49)(_DWORD, UInt16 *, _DWORD); // r0
  int v50; // r6
  float v51; // s16
  float v52; // s16
  float v53; // s0
  UInt16 v54; // r1
  tSoundReference **p_m_PrioritisedSoundList; // r11
  int v56; // r6
  int v57; // r3
  __int16 v58; // r12
  tSoundReference v59; // r5
  tSoundReference v60; // r6
  int v61; // r5
  int j; // r1
  float *v63; // r3
  int v64; // r8
  int v65; // r0
  int k; // r6
  float *v67; // r2
  float v68; // s2
  unsigned int v69; // r2
  __int16 v70; // r0
  tSoundReference *v71; // r4
  int v72; // r3
  int v73; // r5
  int v74; // r12
  CAEPhysicallyPlayingSound **v75; // r9
  int v76; // r1
  signed __int16 v77; // r4
  tSoundReference v78; // lr
  int v79; // r6
  int v80; // r2
  CAEPhysicallyPlayingSound **v81; // lr
  int v82; // r1
  int v83; // r8
  int v84; // r9
  int v85; // r2
  int v86; // r0
  CAEPhysicallyPlayingSound *v87; // r6
  tSoundReference v88; // r4
  CAESound *v89; // r5
  UInt16 *v90; // r5
  UInt16 m_Environment; // t1
  float v92; // s20
  UInt16 *v93; // r6
  char *v94; // r5
  __int64 v95; // kr00_8
  float v96; // r0
  float v97; // r1
  float v98; // s0
  float DopplerRelativeFrequency; // s0
  float v100; // s22
  char *v101; // r4
  unsigned int v102; // r0
  float v103; // s20
  CVector *v104; // r1
  __int64 v105; // d16
  CAEPhysicallyPlayingSound **v106; // r2
  signed __int16 v107; // r8
  int v108; // r0
  int v109; // r0
  char *v110; // r11
  Int16 m_AudioHardwareHandle; // r0
  unsigned __int8 *v112; // r9
  UInt16 v113; // r5
  __int16 v114; // r0
  Int16 v115; // r4
  float v116; // s20
  float v117; // s0
  float v118; // s0
  Int16 v119; // r4
  __int16 v120; // r0
  float v121; // s20
  float v122; // s0
  float v123; // s0
  float v124; // s0
  Int16 v125; // r1
  CVector *v126; // r1
  __int64 v127; // d16
  UInt8 *p_m_FrameDelay; // r0
  int v129; // r1
  int v130; // r3
  signed __int8 v131; // r6
  bool v132; // zf
  Bool8 *p_m_bManualPause; // [sp+38h] [bp-60h]
  CVector pPosition; // [sp+40h] [bp-58h] BYREF
  CVector pRelativePosition; // [sp+4Ch] [bp-4Ch] BYREF

  pPosition.y = 0.0;
  pPosition.x = 1.0;
  pPosition.z = 0.0;
  if ( this->m_AllocatedPhysicalChannels )
  {
    v2 = 0;
    v3 = 0;
    do
    {
      ++v3;
      this->m_PrioritisedSoundList[v2] = -1;
      v2 = (__int16)v3;
    }
    while ( (__int16)v3 < (int)this->m_AllocatedPhysicalChannels );
  }
  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 || this->m_bManualPause )
  {
    m_TimeLastCalled = this->m_TimeLastCalled;
    p_m_TimeLastCalled = &this->m_TimeLastCalled;
    v6 = CTimer::m_snTimeInMillisecondsPauseMode;
    p_m_GamePausedLastFrame = &this->m_GamePausedLastFrame;
    if ( this->m_GamePausedLastFrame )
    {
      v8 = CTimer::m_snTimeInMillisecondsPauseMode - m_TimeLastCalled;
      *p_m_TimeLastCalled = CTimer::m_snTimeInMillisecondsPauseMode;
      v9 = 1;
    }
    else
    {
      v8 = 0;
      this->m_TimeLastCalledUnpaused = m_TimeLastCalled;
      v9 = 1;
      *p_m_TimeLastCalled = v6;
    }
  }
  else
  {
    p_m_TimeLastCalledUnpaused = &this->m_TimeLastCalledUnpaused;
    if ( !this->m_GamePausedLastFrame )
      p_m_TimeLastCalledUnpaused = &this->m_TimeLastCalled;
    v11 = *p_m_TimeLastCalledUnpaused;
    v12 = CTimer::m_snTimeInMilliseconds;
    this->m_TimeLastCalled = CTimer::m_snTimeInMilliseconds;
    v8 = v12 - v11;
    p_m_GamePausedLastFrame = &this->m_GamePausedLastFrame;
    v9 = 0;
  }
  *p_m_GamePausedLastFrame = v9;
  CAEAudioHardware::GetChannelPlayTimes(&AEAudioHardware, this->m_AudioHardwareHandle, this->m_ChannelPosition);
  CAEAudioHardware::GetVirtualChannelSoundLengths(&AEAudioHardware, this->m_VirtualChannelSoundLengths);
  CAEAudioHardware::GetVirtualChannelSoundLoopStartTimes(&AEAudioHardware, this->m_VirtualChannelSoundLoopStartTimes);
  p_m_ChannelPosition = &this->m_ChannelPosition;
  v14 = 0;
  for ( i = 17408; i != 17708; ++i )
  {
    v16 = &this->m_AllocatedPhysicalChannels + v14;
    if ( v16[46] )
    {
      v17 = v16[47];
      v18 = v17 == 0;
      if ( v16[47] )
      {
        LOWORD(v17) = v16[45];
        v18 = (v17 & 0x20) == 0;
      }
      if ( !v18 )
      {
        v16[45] = v17 & 0xFFDF;
        if ( !v16[49] )
          v16[48] = (int)(float)((float)(*((__int16 *)&this->m_AllocatedPhysicalChannels + i) * (__int16)v16[48]) / 100.0);
      }
    }
    v14 += 58;
  }
  if ( this->m_AllocatedPhysicalChannels )
  {
    p_m_PhysicallyPlayingSoundList = &this->m_PhysicallyPlayingSoundList;
    v20 = 0;
    v21 = 0;
    do
    {
      m_SoundReference = (unsigned __int16)(*p_m_PhysicallyPlayingSoundList)[v20].m_SoundReference;
      if ( m_SoundReference != 0xFFFF )
      {
        this->m_VirtuallyPlayingSoundList[(__int16)m_SoundReference].m_nPlayTime = (*p_m_ChannelPosition)[v20];
        if ( this->m_VirtuallyPlayingSoundList[(*p_m_PhysicallyPlayingSoundList)[v20].m_SoundReference].m_bRequestedStopped )
          CAEAudioHardware::StopSound(&AEAudioHardware, this->m_AudioHardwareHandle, v21);
      }
      v20 = ++v21;
    }
    while ( v21 < (int)this->m_AllocatedPhysicalChannels );
  }
  v23 = 0;
  v24 = 34816;
  p_m_bManualPause = &this->m_bManualPause;
  v25 = (CTimer::m_UserPause || CTimer::m_CodePause) << 24;
  do
  {
    v34 = (char *)this + v23 * 116;
    v35 = this->m_VirtuallyPlayingSoundList[v23].m_bCurrentlyInUse == 0;
    if ( this->m_VirtuallyPlayingSoundList[v23].m_bCurrentlyInUse )
      v35 = *((unsigned __int16 *)v34 + 47) == 0;
    if ( !v35 && !v34[88] )
    {
      if ( (v25 || *p_m_bManualPause) && (v34[90] & 0x10) == 0 )
      {
        v26 = *(__int16 *)((char *)&this->m_AllocatedPhysicalChannels + v24);
        v27 = *(unsigned __int16 *)((char *)&this->m_VirtuallyPlayingSoundList[5].m_ClientVariable + v24);
        v28 = *((unsigned __int16 *)v34 + 49);
        *((_WORD *)v34 + 58) = v26;
        if ( v28 )
          goto LABEL_46;
        if ( *((_WORD *)v34 + 54) )
          goto LABEL_35;
        v29 = *((__int16 *)v34 + 48);
        v30 = *((float *)v34 + 26) * 0.0;
      }
      else
      {
        v26 = *(__int16 *)((char *)&this->m_AllocatedPhysicalChannels + v24);
        v27 = *(unsigned __int16 *)((char *)&this->m_VirtuallyPlayingSoundList[5].m_ClientVariable + v24);
        v31 = *((unsigned __int16 *)v34 + 49);
        *((_WORD *)v34 + 58) = v26;
        if ( v31 )
          goto LABEL_46;
        if ( *((_WORD *)v34 + 54) )
        {
LABEL_35:
          *((_WORD *)v34 + 48) = -1;
          goto LABEL_46;
        }
        v29 = *((__int16 *)v34 + 48);
        v30 = *((float *)v34 + 26) * (float)v8;
      }
      v32 = (int)(float)(v30 + (float)v29);
      *((_WORD *)v34 + 48) = v32;
      if ( v26 <= v32 )
      {
        v33 = -1;
        if ( v26 )
        {
          v33 = -1;
          if ( v27 != 0xFFFF )
            v33 = v32 % v26 + v27;
        }
        *((_WORD *)v34 + 48) = v33;
      }
    }
LABEL_46:
    v24 += 2;
    ++v23;
  }
  while ( v24 != 35416 );
  m_AllocatedPhysicalChannels = this->m_AllocatedPhysicalChannels;
  if ( this->m_AllocatedPhysicalChannels )
  {
    v37 = 0;
    v38 = 0;
    do
    {
      ++v38;
      if ( (unsigned __int16)(*p_m_ChannelPosition)[v37] == 0xFFFF )
      {
        this->m_PhysicallyPlayingSoundList[v37].m_SoundReference = -1;
        m_AllocatedPhysicalChannels = this->m_AllocatedPhysicalChannels;
      }
      v37 = v38;
    }
    while ( v38 < (int)m_AllocatedPhysicalChannels );
  }
  p_m_nPlayTime = &this->m_VirtuallyPlayingSoundList[0].m_nPlayTime;
  v40 = 300;
  do
  {
    if ( *(p_m_nPlayTime - 2) && !*((_BYTE *)p_m_nPlayTime - 8) && (unsigned __int16)*p_m_nPlayTime == 0xFFFF )
      CAESound::SoundHasFinished((CAESound *)(p_m_nPlayTime - 46));
    --v40;
    p_m_nPlayTime += 58;
  }
  while ( v40 );
  p_m_Environment = &this->m_VirtuallyPlayingSoundList[0].m_Environment;
  v42 = 300;
  v43 = &this->m_VirtuallyPlayingSoundList[0].m_Environment;
  while ( 2 )
  {
    if ( v43[1] )
    {
      v44 = *v43;
      v45 = v43[3];
      if ( (*v43 & 0x80) == 0 )
        goto LABEL_65;
      v46 = *(_DWORD *)(v43 - 39);
      if ( v46 )
      {
        v47 = *(CVector **)(v46 + 20);
        v48 = v47 + 4;
        if ( !v47 )
          v48 = (CVector *)(v46 + 4);
        CAESound::SetPosition((CAESound *)(v43 - 43), *v48);
        v44 = *v43;
LABEL_65:
        if ( (v44 & 4) != 0 )
        {
LABEL_66:
          v49 = *(void (__fastcall ****)(_DWORD, UInt16 *, _DWORD))(v43 - 41);
          if ( v49 )
          {
            (**v49)(v49, v43 - 43, v45);
            if ( *(float *)(v43 - 27) == 0.0 )
              *(_DWORD *)(v43 + 7) = *(_DWORD *)(v43 - 29);
          }
        }
      }
      else
      {
        v43[9] = 1;
        if ( (v44 & 4) != 0 )
          goto LABEL_66;
      }
    }
    --v42;
    v43 += 58;
    if ( v42 )
      continue;
    break;
  }
  v50 = 300;
  do
  {
    if ( p_m_Environment[1] )
    {
      if ( *(unsigned __int8 *)p_m_Environment << 31 )
      {
        v53 = *(float *)(p_m_Environment - 33);
      }
      else
      {
        CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, (CVector *)(p_m_Environment - 25));
        v51 = *(float *)(p_m_Environment - 33);
        v52 = v51
            + CAEAudioEnvironment::GetDistanceAttenuation(
                sqrtf(
                  (float)((float)(pRelativePosition.x * pRelativePosition.x)
                        + (float)(pRelativePosition.y * pRelativePosition.y))
                + (float)(pRelativePosition.z * pRelativePosition.z))
              / *(float *)(p_m_Environment - 31));
        v53 = v52 + CAEAudioEnvironment::GetDirectionalMikeAttenuation(&pRelativePosition);
      }
      *(float *)(p_m_Environment + 5) = v53 - *(float *)(p_m_Environment + 11);
    }
    --v50;
    p_m_Environment += 58;
  }
  while ( v50 );
  v54 = this->m_AllocatedPhysicalChannels;
  p_m_PrioritisedSoundList = &this->m_PrioritisedSoundList;
  if ( this->m_AllocatedPhysicalChannels )
  {
    v56 = 0;
    v57 = 0;
    v58 = 0;
    do
    {
      v59 = this->m_PhysicallyPlayingSoundList[v56].m_SoundReference;
      v60 = v59;
      if ( (unsigned __int16)v59 != 0xFFFF && (this->m_VirtuallyPlayingSoundList[v59].m_Environment & 2) != 0 )
      {
        v61 = v58++;
        (*p_m_PrioritisedSoundList)[v61] = v60;
        v54 = this->m_AllocatedPhysicalChannels;
      }
      v56 = (__int16)++v57;
    }
    while ( (__int16)v57 < (int)v54 );
  }
  else
  {
    v58 = 0;
  }
  for ( j = 0; j != 300; ++j )
  {
    v63 = (float *)(&this->m_AllocatedPhysicalChannels + 58 * j);
    if ( *((_WORD *)v63 + 46) && (!*((_WORD *)v63 + 49) || (*((_BYTE *)v63 + 90) & 2) == 0) && !*((_BYTE *)v63 + 88) )
    {
      v64 = this->m_AllocatedPhysicalChannels;
      v65 = (__int16)(v64 - 1);
      if ( v58 <= v65 )
      {
        LOWORD(v65) = v64 - 1;
        do
        {
          if ( (unsigned __int16)(*p_m_PrioritisedSoundList)[(__int16)v65] != 0xFFFF )
            break;
          v65 = (__int16)(v65 - 1);
        }
        while ( v65 >= v58 );
      }
      for ( k = (__int16)v65; (__int16)v65 >= v58; k = (__int16)v65 )
      {
        v67 = (float *)(&this->m_AllocatedPhysicalChannels + 58 * (*p_m_PrioritisedSoundList)[k]);
        v68 = v67[25];
        v69 = (*((unsigned __int16 *)v67 + 45) >> 3) & 1;
        if ( v63[25] < v68 && ((*((unsigned __int16 *)v63 + 45) >> 3) & 1u) <= v69 )
          break;
        LOWORD(v65) = v65 - 1;
      }
      v70 = v64 - 1;
      if ( v64 - 1 != k )
      {
        v71 = *p_m_PrioritisedSoundList;
        v72 = k + 1;
        while ( 1 )
        {
          v73 = v70;
          if ( v72 >= v70 )
            break;
          --v70;
          v71[v73] = v71[v73 - 1];
          v71 = *p_m_PrioritisedSoundList;
        }
        v71[v72] = j;
      }
    }
  }
  v74 = this->m_AllocatedPhysicalChannels;
  if ( this->m_AllocatedPhysicalChannels )
  {
    v75 = &this->m_PhysicallyPlayingSoundList;
    v76 = 0;
    v77 = 0;
    do
    {
      v78 = (*v75)[v76].m_SoundReference;
      if ( (unsigned __int16)v78 != 0xFFFF )
      {
        if ( v74 << 16 )
        {
          v79 = 0;
          v80 = 0;
          do
          {
            if ( v78 == (*p_m_PrioritisedSoundList)[v79] )
              break;
            v79 = (__int16)++v80;
          }
          while ( (__int16)v80 < (int)(unsigned __int16)v74 );
        }
        else
        {
          v79 = 0;
        }
        if ( v79 == (unsigned __int16)v74 )
        {
          this->m_VirtuallyPlayingSoundList[v78].m_bPhysicallyPlaying = 0;
          (*v75)[v76].m_SoundReference = -1;
          CAEAudioHardware::StopSound(&AEAudioHardware, this->m_AudioHardwareHandle, v77);
        }
        else
        {
          (*p_m_PrioritisedSoundList)[v79] = -1;
        }
      }
      ++v77;
      v74 = this->m_AllocatedPhysicalChannels;
      v76 = v77;
    }
    while ( v77 < v74 );
    if ( this->m_AllocatedPhysicalChannels )
    {
      v81 = &this->m_PhysicallyPlayingSoundList;
      v82 = 0;
      v83 = 0;
      v84 = 0;
      do
      {
        v85 = (unsigned __int16)(*p_m_PrioritisedSoundList)[v82];
        if ( v85 != 0xFFFF )
        {
          v86 = (__int16)v84;
          if ( (__int16)v84 < (int)(unsigned __int16)v74 )
          {
            v87 = *v81;
            while ( (unsigned __int16)v87[v86].m_SoundReference != 0xFFFF )
            {
              v86 = (__int16)++v84;
              if ( (__int16)v84 >= (int)(unsigned __int16)v74 )
                goto LABEL_139;
            }
            v87[v86].m_SoundReference = v85;
            this->m_VirtuallyPlayingSoundList[(*p_m_PrioritisedSoundList)[v82]].m_bPhysicallyPlaying = 1;
            v88 = (*p_m_PrioritisedSoundList)[v82];
            v89 = &this->m_VirtuallyPlayingSoundList[v88];
            m_Environment = v89->m_Environment;
            v90 = &v89->m_Environment;
            LOBYTE(v86) = m_Environment;
            v92 = *(float *)(v90 + 7);
            if ( (m_Environment & 1) == 0 )
            {
              v93 = v90;
              v94 = (char *)this + 116 * v88;
              v95 = *(_QWORD *)(v94 + 68);
              v96 = *((float *)v94 + 20);
              v97 = *((float *)v94 + 19);
              v98 = *((float *)v94 + 21);
              v90 = v93;
              DopplerRelativeFrequency = CAEAudioEnvironment::GetDopplerRelativeFrequency(
                                           v96,
                                           v97,
                                           HIDWORD(v95),
                                           v95,
                                           v98);
              LOWORD(v86) = *v93;
              v92 = v92 * DopplerRelativeFrequency;
            }
            v100 = 1.0;
            if ( (v86 & 0x10) == 0 )
            {
              if ( CTimer::GetIsSlowMotionActive() )
              {
                v100 = 0.5;
                if ( TheCamera.Cams[TheCamera.ActiveCam].Mode == 46 )
                  v100 = 1.0;
              }
              else
              {
                v100 = 1.0;
              }
            }
            v101 = (char *)this + 116 * v88;
            v102 = *v90;
            CAEAudioHardware::PlaySound(
              &AEAudioHardware,
              this->m_AudioHardwareHandle,
              v84,
              *((_WORD *)v101 + 3),
              *((_WORD *)v101 + 2),
              *((__int16 *)v101 + 48),
              (v102 >> 2) & 0x10 | v102 & 1 | (v102 >> 2) & 8 | (v102 >> 6) & 4 | (v102 >> 8) & 2 | (v102 >> 4) & 0x40 | (v102 >> 4) & 0x80 | (v102 >> 4) & 0x100 | (((v102 & 0x11) == 17) << 9),
              *((float *)v101 + 8));
            CAEAudioHardware::SetChannelVolume(
              &AEAudioHardware,
              this->m_AudioHardwareHandle,
              v84,
              *((float *)v101 + 25),
              0);
            v103 = v92 * v100;
            v104 = (CVector *)(v101 + 40);
            if ( *(unsigned __int8 *)v90 << 31 )
            {
              v105 = *(_QWORD *)&v104->x;
              pPosition.z = *((RwReal *)v101 + 12);
              *(_QWORD *)&pPosition.x = v105;
            }
            else
            {
              CAEAudioEnvironment::GetPositionRelativeToCamera(&pPosition, v104);
            }
            CAEAudioHardware::SetChannelPosition(&AEAudioHardware, this->m_AudioHardwareHandle, v84, &pPosition, 0);
            CAEAudioHardware::SetChannelFrequencyScalingFactor(&AEAudioHardware, this->m_AudioHardwareHandle, v84, v103);
            v74 = this->m_AllocatedPhysicalChannels;
            ++v84;
            v81 = &this->m_PhysicallyPlayingSoundList;
          }
        }
LABEL_139:
        v82 = (__int16)++v83;
      }
      while ( (__int16)v83 < (int)(unsigned __int16)v74 );
      if ( v74 << 16 )
      {
        v106 = &this->m_PhysicallyPlayingSoundList;
        v107 = 0;
        v108 = 0;
        while ( 1 )
        {
          v109 = (unsigned __int16)(*v106)[v108].m_SoundReference;
          if ( v109 != 0xFFFF )
          {
            v110 = (char *)this + 116 * (__int16)v109;
            if ( *((_WORD *)v110 + 46) )
              break;
          }
LABEL_171:
          v108 = ++v107;
          if ( v107 >= (int)(unsigned __int16)v74 )
            goto LABEL_172;
        }
        if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 || *p_m_bManualPause )
        {
          m_AudioHardwareHandle = this->m_AudioHardwareHandle;
          v112 = (unsigned __int8 *)(v110 + 90);
          if ( (v110[90] & 0x10) == 0 )
          {
            CAEAudioHardware::SetChannelVolume(&AEAudioHardware, m_AudioHardwareHandle, v107, -100.0, 0);
            CAEAudioHardware::SetChannelFrequencyScalingFactor(&AEAudioHardware, this->m_AudioHardwareHandle, v107, 0.0);
LABEL_167:
            v126 = (CVector *)(v110 + 40);
            if ( *v112 << 31 )
            {
              v127 = *(_QWORD *)&v126->x;
              pPosition.z = *((RwReal *)v110 + 12);
              *(_QWORD *)&pPosition.x = v127;
            }
            else
            {
              CAEAudioEnvironment::GetPositionRelativeToCamera(&pPosition, v126);
            }
            CAEAudioHardware::SetChannelPosition(&AEAudioHardware, this->m_AudioHardwareHandle, v107, &pPosition, 0);
            LOWORD(v74) = this->m_AllocatedPhysicalChannels;
            v106 = &this->m_PhysicallyPlayingSoundList;
            goto LABEL_171;
          }
          v113 = v107;
          CAEAudioHardware::SetChannelVolume(&AEAudioHardware, m_AudioHardwareHandle, v107, *((float *)v110 + 25), 0);
          v114 = *(_WORD *)v112;
          v115 = this->m_AudioHardwareHandle;
          v116 = *((float *)v110 + 26);
          if ( (*(_WORD *)v112 & 1) == 0 )
          {
            v117 = CAEAudioEnvironment::GetDopplerRelativeFrequency(
                     *((float *)v110 + 20),
                     *((float *)v110 + 19),
                     *((_DWORD *)v110 + 18),
                     *((_DWORD *)v110 + 17),
                     *((float *)v110 + 21));
            v114 = *(_WORD *)v112;
            v116 = v116 * v117;
          }
          v118 = 1.0;
          if ( (v114 & 0x10) == 0 )
          {
            if ( CTimer::GetIsSlowMotionActive() )
            {
              v118 = 0.5;
              if ( TheCamera.Cams[TheCamera.ActiveCam].Mode == 46 )
                v118 = 1.0;
            }
            else
            {
              v118 = 1.0;
            }
          }
          v124 = v116 * v118;
          v125 = v115;
        }
        else
        {
          v113 = v107;
          CAEAudioHardware::SetChannelVolume(
            &AEAudioHardware,
            this->m_AudioHardwareHandle,
            v107,
            *((float *)v110 + 25),
            0);
          v119 = this->m_AudioHardwareHandle;
          v112 = (unsigned __int8 *)(v110 + 90);
          v120 = *((_WORD *)v110 + 45);
          v121 = *((float *)v110 + 26);
          if ( (v120 & 1) == 0 )
          {
            v122 = CAEAudioEnvironment::GetDopplerRelativeFrequency(
                     *((float *)v110 + 20),
                     *((float *)v110 + 19),
                     *((_DWORD *)v110 + 18),
                     *((_DWORD *)v110 + 17),
                     *((float *)v110 + 21));
            v120 = *(_WORD *)v112;
            v121 = v121 * v122;
          }
          v123 = 1.0;
          if ( (v120 & 0x10) == 0 )
          {
            if ( CTimer::GetIsSlowMotionActive() )
            {
              v123 = 0.5;
              if ( TheCamera.Cams[TheCamera.ActiveCam].Mode == 46 )
                v123 = 1.0;
            }
            else
            {
              v123 = 1.0;
            }
          }
          v124 = v121 * v123;
          v125 = v119;
        }
        CAEAudioHardware::SetChannelFrequencyScalingFactor(&AEAudioHardware, v125, v113, v124);
        goto LABEL_167;
      }
    }
  }
LABEL_172:
  CAEAudioHardware::Service(&AEAudioHardware);
  p_m_FrameDelay = &this->m_VirtuallyPlayingSoundList[0].m_FrameDelay;
  v129 = 300;
  v130 = (CTimer::m_CodePause || CTimer::m_UserPause) << 24;
  do
  {
    if ( *((_WORD *)p_m_FrameDelay + 2) )
    {
      v131 = *p_m_FrameDelay;
      *((_WORD *)p_m_FrameDelay + 3) = 1;
      if ( v131 >= 1 )
      {
        v132 = v130 == 0;
        if ( !v130 )
          v132 = *p_m_bManualPause == 0;
        if ( v132 || (p_m_FrameDelay[2] & 0x10) != 0 )
          *p_m_FrameDelay = v131 - 1;
      }
    }
    --v129;
    p_m_FrameDelay += 116;
  }
  while ( v129 );
}

//----- (003A8CA4) --------------------------------------------------------
CAESound *__fastcall CAESoundManager::RequestNewSound(CAESoundManager *this, CAESound *pRequestedSound)
{
  int v4; // r5
  char *v5; // r4
  _WORD *v6; // r4
  int v7; // t1
  char *v9; // r10
  CAESound *v10; // r8
  CEntity *v11; // r0
  CEntity **p_m_pPhysicalEntity; // r9
  CEntity *m_pPhysicalEntity; // t1
  char *v14; // r10
  UInt16 v15; // t1
  float SoundHeadroom; // r0
  float v17; // s16
  float v18; // s0

  LOWORD(v4) = 0;
  while ( 1 )
  {
    v5 = (char *)this + 116 * (__int16)v4;
    v7 = *((unsigned __int16 *)v5 + 46);
    v6 = v5 + 92;
    if ( !v7 )
      break;
    v4 = (__int16)(v4 + 1);
    if ( v4 >= 300 )
      return 0;
  }
  v9 = (char *)this + 116 * (__int16)v4;
  v10 = (CAESound *)(v9 + 4);
  CAESound::operator=((CAESound *)(v9 + 4), pRequestedSound);
  m_pPhysicalEntity = pRequestedSound->m_pPhysicalEntity;
  p_m_pPhysicalEntity = &pRequestedSound->m_pPhysicalEntity;
  v11 = m_pPhysicalEntity;
  if ( m_pPhysicalEntity )
  {
    CEntity::CleanUpOldReference(v11, p_m_pPhysicalEntity);
    *p_m_pPhysicalEntity = 0;
  }
  *v6 = 1;
  v15 = *((_WORD *)v9 + 3);
  v14 = v9 + 6;
  *((_WORD *)v14 + 51) = 0;
  *((_WORD *)v14 + 46) = 0;
  *((_WORD *)v14 + 44) = 0;
  SoundHeadroom = CAEAudioHardware::GetSoundHeadroom(&AEAudioHardware, v15, v10->m_BankSlotID);
  v17 = *(float *)(v14 + 26);
  v18 = *(float *)(v14 + 30);
  *(float *)(v14 + 106) = SoundHeadroom;
  if ( v18 > 0.0 && v18 < v17 )
    v17 = v17 + CAEAudioUtility::GetRandomNumberInRange(COERCE_FLOAT(LODWORD(v18) ^ 0x80000000), v18);
  this->m_VirtuallyPlayingSoundList[(__int16)v4].m_RelativePlaybackFrequency = v17;
  CAEAudioHardware::RequestVirtualChannelSoundInfo(&AEAudioHardware, v4, *(_WORD *)v14, v10->m_BankSlotID);
  return v10;
}

//----- (003A8D8C) --------------------------------------------------------
Int16 __fastcall CAESoundManager::AreSoundsPlayingInBankSlot(CAESoundManager *this, Int16 BankSlotID)
{
  Bool16 *p_m_bCurrentlyInUse; // r0
  unsigned __int8 v3; // r12
  int v4; // r2
  Int16 result; // r0

  p_m_bCurrentlyInUse = &this->m_VirtuallyPlayingSoundList[0].m_bCurrentlyInUse;
  v3 = 0;
  v4 = -1;
  do
  {
    if ( *p_m_bCurrentlyInUse && *(p_m_bCurrentlyInUse - 44) == (unsigned __int16)BankSlotID )
    {
      if ( p_m_bCurrentlyInUse[3] )
        return 2;
      v3 = 1;
    }
    ++v4;
    p_m_bCurrentlyInUse += 58;
  }
  while ( v4 <= 298 );
  result = v3;
  if ( v3 )
    return 1;
  return result;
}

//----- (003A8DC8) --------------------------------------------------------
Int16 __fastcall CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(
        CAESoundManager *this,
        Int16 nAudioEvent,
        CAEAudioEntity *pAudioEntity)
{
  Bool16 *p_m_bCurrentlyInUse; // r0
  unsigned __int8 v4; // r12
  int v5; // lr
  int v6; // r3
  bool v7; // zf
  Int16 result; // r0

  p_m_bCurrentlyInUse = &this->m_VirtuallyPlayingSoundList[0].m_bCurrentlyInUse;
  v4 = 0;
  v5 = -1;
  do
  {
    if ( *p_m_bCurrentlyInUse )
    {
      v6 = *((_DWORD *)p_m_bCurrentlyInUse - 19);
      v7 = v6 == nAudioEvent;
      if ( v6 == nAudioEvent )
        v7 = *((_DWORD *)p_m_bCurrentlyInUse - 21) == (_DWORD)pAudioEntity;
      if ( v7 )
      {
        if ( p_m_bCurrentlyInUse[3] )
          return 2;
        v4 = 1;
      }
    }
    ++v5;
    p_m_bCurrentlyInUse += 58;
  }
  while ( v5 <= 298 );
  result = v4;
  if ( v4 )
    return 1;
  return result;
}

//----- (003A8E0E) --------------------------------------------------------
Int16 __fastcall CAESoundManager::AreSoundsOfThisEventPlayingForThisEntityAndPhysical(
        CAESoundManager *this,
        Int16 nAudioEvent,
        CAEAudioEntity *pAudioEntity,
        CPhysical *pPhysical)
{
  Bool16 *p_m_bCurrentlyInUse; // r0
  unsigned __int8 v5; // lr
  int v6; // r12
  CAEAudioEntity *v7; // r4
  bool v8; // zf
  Int16 result; // r0

  p_m_bCurrentlyInUse = &this->m_VirtuallyPlayingSoundList[0].m_bCurrentlyInUse;
  v5 = 0;
  v6 = -1;
  do
  {
    if ( *p_m_bCurrentlyInUse && *((_DWORD *)p_m_bCurrentlyInUse - 19) == nAudioEvent )
    {
      v7 = (CAEAudioEntity *)*((_DWORD *)p_m_bCurrentlyInUse - 21);
      v8 = v7 == pAudioEntity;
      if ( v7 == pAudioEntity )
        v8 = *((_DWORD *)p_m_bCurrentlyInUse - 20) == (_DWORD)pPhysical;
      if ( v8 )
      {
        if ( p_m_bCurrentlyInUse[3] )
          return 2;
        v5 = 1;
      }
    }
    ++v6;
    p_m_bCurrentlyInUse += 58;
  }
  while ( v6 <= 298 );
  result = v5;
  if ( v5 )
    return 1;
  return result;
}

//----- (003A8E60) --------------------------------------------------------
void __fastcall CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntity(
        CAESoundManager *this,
        Int16 nAudioEvent,
        CAEAudioEntity *pAudioEntity)
{
  Bool16 *p_m_bRequestedStopped; // r6
  int v5; // r5
  int v6; // r4
  __int16 v7; // r2
  CEntity *v8; // r0
  int v9; // r0
  bool v10; // zf

  p_m_bRequestedStopped = &this->m_VirtuallyPlayingSoundList[0].m_bRequestedStopped;
  v5 = nAudioEvent;
  v6 = 300;
  do
  {
    if ( *(p_m_bRequestedStopped - 8) )
    {
      v9 = *((_DWORD *)p_m_bRequestedStopped - 23);
      v10 = v9 == v5;
      if ( v9 == v5 )
        v10 = *((_DWORD *)p_m_bRequestedStopped - 25) == (_DWORD)pAudioEntity;
      if ( v10 )
      {
        *p_m_bRequestedStopped = 1;
        v7 = *(p_m_bRequestedStopped - 9);
        *((_DWORD *)p_m_bRequestedStopped - 25) = 0;
        v8 = (CEntity *)*((_DWORD *)p_m_bRequestedStopped - 24);
        *(p_m_bRequestedStopped - 9) = v7 & 0xFFFB;
        if ( v8 )
        {
          CEntity::CleanUpOldReference(v8, (CEntity **)p_m_bRequestedStopped - 24);
          *((_DWORD *)p_m_bRequestedStopped - 24) = 0;
        }
      }
    }
    --v6;
    p_m_bRequestedStopped += 58;
  }
  while ( v6 );
}

//----- (003A8EC8) --------------------------------------------------------
void __fastcall CAESoundManager::CancelSoundsOfThisEventPlayingForThisEntityAndPhysical(
        CAESoundManager *this,
        Int16 nAudioEvent,
        CAEAudioEntity *pAudioEntity,
        CPhysical *pPhysical)
{
  Bool16 *p_m_bRequestedStopped; // r4
  int v7; // r6
  int v8; // r5
  __int16 v9; // r0
  int v10; // r0
  bool v11; // zf

  p_m_bRequestedStopped = &this->m_VirtuallyPlayingSoundList[0].m_bRequestedStopped;
  v7 = nAudioEvent;
  v8 = 300;
  do
  {
    if ( *(p_m_bRequestedStopped - 8) )
    {
      v10 = *((_DWORD *)p_m_bRequestedStopped - 23);
      v11 = v10 == v7;
      if ( v10 == v7 )
        v11 = *((_DWORD *)p_m_bRequestedStopped - 25) == (_DWORD)pAudioEntity;
      if ( v11 && *((CPhysical **)p_m_bRequestedStopped - 24) == pPhysical )
      {
        *p_m_bRequestedStopped = 1;
        v9 = *(p_m_bRequestedStopped - 9);
        *((_DWORD *)p_m_bRequestedStopped - 25) = 0;
        *(p_m_bRequestedStopped - 9) = v9 & 0xFFFB;
        if ( pPhysical )
        {
          CEntity::CleanUpOldReference(pPhysical, (CEntity **)p_m_bRequestedStopped - 24);
          *((_DWORD *)p_m_bRequestedStopped - 24) = 0;
        }
      }
    }
    --v8;
    p_m_bRequestedStopped += 58;
  }
  while ( v8 );
}

//----- (003A8F40) --------------------------------------------------------
void __fastcall CAESoundManager::CancelSoundsInBankSlot(CAESoundManager *this, Int16 BankSlotID, Bool8 Forget)
{
  Bool16 *p_m_bRequestedStopped; // r5
  int v4; // r8
  int v5; // r6
  int v6; // r4
  CEntity *v7; // r0
  CEntity **v8; // r1
  __int16 v9; // r2

  p_m_bRequestedStopped = &this->m_VirtuallyPlayingSoundList[0].m_bRequestedStopped;
  v4 = Forget;
  v5 = 300;
  v6 = (unsigned __int16)BankSlotID;
  do
  {
    if ( *(p_m_bRequestedStopped - 8) && *(p_m_bRequestedStopped - 52) == v6 )
    {
      *p_m_bRequestedStopped = 1;
      if ( v4 )
      {
        v8 = (CEntity **)(p_m_bRequestedStopped - 48);
        v7 = (CEntity *)*((_DWORD *)p_m_bRequestedStopped - 24);
        v9 = *(p_m_bRequestedStopped - 9);
        *((_DWORD *)p_m_bRequestedStopped - 25) = 0;
        *(p_m_bRequestedStopped - 9) = v9 & 0xFFFB;
        if ( !v7 )
          goto LABEL_9;
LABEL_8:
        CEntity::CleanUpOldReference(v7, v8);
        *((_DWORD *)p_m_bRequestedStopped - 24) = 0;
        goto LABEL_9;
      }
      v8 = (CEntity **)(p_m_bRequestedStopped - 48);
      v7 = (CEntity *)*((_DWORD *)p_m_bRequestedStopped - 24);
      if ( v7 )
        goto LABEL_8;
    }
LABEL_9:
    --v5;
    p_m_bRequestedStopped += 58;
  }
  while ( v5 );
}

//----- (003A8FAC) --------------------------------------------------------
void __fastcall CAESoundManager::CancelSoundsOwnedByAudioEntity(
        CAESoundManager *this,
        CAEAudioEntity *pAudioEntity,
        Bool8 Forget)
{
  Bool16 *p_m_bRequestedStopped; // r6
  int v4; // r8
  int v6; // r4
  CEntity *v7; // r0
  CEntity **v8; // r1
  __int16 v9; // r2

  p_m_bRequestedStopped = &this->m_VirtuallyPlayingSoundList[0].m_bRequestedStopped;
  v4 = Forget;
  v6 = 300;
  do
  {
    if ( *(p_m_bRequestedStopped - 8) && *((CAEAudioEntity **)p_m_bRequestedStopped - 25) == pAudioEntity )
    {
      *p_m_bRequestedStopped = 1;
      if ( v4 )
      {
        v8 = (CEntity **)(p_m_bRequestedStopped - 48);
        v7 = (CEntity *)*((_DWORD *)p_m_bRequestedStopped - 24);
        v9 = *(p_m_bRequestedStopped - 9);
        *((_DWORD *)p_m_bRequestedStopped - 25) = 0;
        *(p_m_bRequestedStopped - 9) = v9 & 0xFFFB;
        if ( !v7 )
          goto LABEL_9;
LABEL_8:
        CEntity::CleanUpOldReference(v7, v8);
        *((_DWORD *)p_m_bRequestedStopped - 24) = 0;
        goto LABEL_9;
      }
      v8 = (CEntity **)(p_m_bRequestedStopped - 48);
      v7 = (CEntity *)*((_DWORD *)p_m_bRequestedStopped - 24);
      if ( v7 )
        goto LABEL_8;
    }
LABEL_9:
    --v6;
    p_m_bRequestedStopped += 58;
  }
  while ( v6 );
}

//----- (003A9018) --------------------------------------------------------
tSoundReference __fastcall CAESoundManager::GetVirtualChannelForPhysicalChannel(
        CAESoundManager *this,
        tSoundReference PhysicalChannel)
{
  tSoundReference v2; // r12
  int v3; // r2

  v2 = -1;
  v3 = (unsigned __int16)PhysicalChannel - (unsigned __int16)this->m_AudioHardwareHandle;
  if ( v3 << 16 >= -65535 && (__int16)v3 < (int)this->m_AllocatedPhysicalChannels )
    return this->m_PhysicallyPlayingSoundList[(__int16)v3].m_SoundReference;
  return v2;
}

//----- (003A9046) --------------------------------------------------------
void __fastcall CAESoundManager::~CAESoundManager(CAESoundManager *this)
{
  CEntity **p_m_pPhysicalEntity; // r5
  int i; // r6
  CEntity *v3; // r0

  p_m_pPhysicalEntity = &this->m_VirtuallyPlayingSoundList[299].m_pPhysicalEntity;
  for ( i = 0; i != -8700; i -= 29 )
  {
    v3 = p_m_pPhysicalEntity[i];
    if ( v3 )
    {
      CEntity::CleanUpOldReference(v3, &p_m_pPhysicalEntity[i]);
      p_m_pPhysicalEntity[i] = 0;
    }
  }
}

//----- (003A9084) --------------------------------------------------------
void __fastcall CAEStaticChannel::CAEStaticChannel(
        CAEStaticChannel *this,
        UInt16 channelID,
        UInt32 nSamplesPerSec,
        UInt16 wBitsPerSample)
{
  int v4; // r0

  CAEAudioChannel::CAEAudioChannel((CAEAudioChannel *)this, channelID, nSamplesPerSec, wBitsPerSample);
  *(_BYTE *)(v4 + 43) = 0;
  *(_BYTE *)(v4 + 45) = 0;
  *(_DWORD *)v4 = &off_667860;
}
// 3A9090: variable 'v4' is possibly undefined
// 667860: using guessed type void *off_667860;

//----- (003A90A8) --------------------------------------------------------
void __fastcall CAEStaticChannel::~CAEStaticChannel(CAEStaticChannel *this)
{
  OALSource *oalSource; // r0

  oalSource = this->oalSource;
  this->_vptr$CAEAudioChannel = (int (**)(void))&off_667860;
  if ( oalSource )
  {
    --g_numSoundChannelsUsed;
    OALBase::Release(oalSource);
  }
  this->oalSource = 0;
  sub_1928FC((CAEAudioChannel *)this);
}
// 667860: using guessed type void *;

//----- (003A90E4) --------------------------------------------------------
void __fastcall CAEStaticChannel::~CAEStaticChannel(CAEStaticChannel *this)
{
  OALSource *oalSource; // r0
  void *v3; // r0

  oalSource = this->oalSource;
  this->_vptr$CAEAudioChannel = (int (**)(void))&off_667860;
  if ( oalSource )
  {
    --g_numSoundChannelsUsed;
    OALBase::Release(oalSource);
  }
  this->oalSource = 0;
  CAEAudioChannel::~CAEAudioChannel((CAEAudioChannel *)this);
  sub_191374(v3);
}
// 3A9116: variable 'v3' is possibly undefined
// 667860: using guessed type void *off_667860;

//----- (003A9124) --------------------------------------------------------
void __fastcall CAEStaticChannel::Play(CAEStaticChannel *this, Int16 StartOffsetMs, Int8 SoundFlags, float freqFac)
{
  Bool8 v6; // r0
  OALSource *oalSource; // r5
  ALint v8; // r6

  if ( !this->m_bLooping )
  {
    if ( !StartOffsetMs )
    {
      v6 = 0;
      goto LABEL_8;
    }
    goto LABEL_6;
  }
  v6 = 0;
  if ( StartOffsetMs && !this->m_dwLoopStart )
  {
LABEL_6:
    oalSource = this->oalSource;
    v8 = CAEAudioChannel::ConvertFromMsToBytes((CAEAudioChannel *)this, StartOffsetMs);
    OALSource::ObtainSource(oalSource);
    j_alSourcei(oalSource->sourceId, 4134, v8);
    oalSource->posOffset = v8;
    v6 = 1;
  }
LABEL_8:
  this->m_bPaused = freqFac == 0.0;
  this->m_bNeedFade = v6;
  this->m_bShouldPlay = 1;
}

//----- (003A9190) --------------------------------------------------------
int __fastcall CAEStaticChannel::SetAudioData(
        CAEStaticChannel *this,
        void *buffer,
        UInt32 numBytes,
        UInt16 SoundID,
        Int16 a5,
        int a6,
        UInt32 a7)
{
  UInt32 v7; // r8
  bool v9; // zf
  int v13; // r6
  OALSource *oalSource; // r0
  int v15; // r0
  UInt32 v16; // r6
  UInt32 v17; // r0
  int v18; // r0
  OALSource *v19; // r0
  size_t m_dwTotalBufferBytes; // r6
  OALSource *v21; // r0
  char *v22; // r9
  size_t m_dwLoopStart; // r2
  ALint v24; // r10
  UInt32 v25; // r6
  size_t m_dwLoopLength; // r5
  UInt32 v27; // r11
  UInt32 m_dwLoopSlots; // r8
  int v29; // r0
  int v30; // r0
  int v31; // r5
  UInt32 v32; // r0
  Bool8 v33; // r1
  UInt32 m_dwBufSize; // r1
  __int64 v35; // kr00_8
  OALSource *v36; // r5
  OALSource *v37; // r0

  v9 = numBytes == 0;
  if ( numBytes )
  {
    v7 = a7;
    v9 = a7 == 0;
  }
  v13 = 0;
  if ( !v9 )
  {
    oalSource = this->oalSource;
    if ( oalSource )
    {
      --g_numSoundChannelsUsed;
      OALBase::Release(oalSource);
    }
    this->oalSource = 0;
    this->m_bLooping = 0;
    this->m_bNeedData = 0;
    this->m_bPaused = 0;
    this->m_dwLoopStart = 0;
    this->m_dwLoopEnd = 0;
    this->m_dwLoopSlots = 0;
    v15 = numBytes;
    this->m_pAudioData = buffer;
    this->m_dwBufSize = numBytes;
    this->m_soundID = SoundID;
    this->m_bankSlotID = a5;
    if ( a6 != -1 )
    {
      this->m_bLooping = 1;
      v15 = numBytes;
      this->m_dwLoopStart = 2 * a6;
      this->m_dwLoopEnd = numBytes;
      if ( a6 )
      {
        v16 = numBytes - 2 * a6;
        v17 = 24000;
        if ( numBytes > 0x5DC0 )
          v17 = numBytes;
        v18 = v17 / v16;
        this->m_dwLoopLength = v16;
        this->m_dwLoopSlots = v18 + 1;
        v15 = (v18 + 1) * v16;
      }
    }
    this->m_dwTotalBufferBytes = v15;
    this->m_frequency = v7;
    this->m_originalFrequency = v7;
    v19 = (OALSource *)operator new(0x30u);
    OALSource::OALSource(v19);
    m_dwTotalBufferBytes = this->m_dwTotalBufferBytes;
    this->oalSource = v21;
    v22 = (char *)malloc(m_dwTotalBufferBytes);
    memset(v22, 0, m_dwTotalBufferBytes);
    ++g_numSoundChannelsUsed;
    m_dwLoopStart = this->m_dwLoopStart;
    if ( m_dwLoopStart )
    {
      v24 = m_dwTotalBufferBytes - m_dwLoopStart;
      qmemcpy(&v22[m_dwTotalBufferBytes - m_dwLoopStart], this->m_pAudioData, m_dwLoopStart);
      v25 = this->m_dwLoopStart;
      m_dwLoopLength = this->m_dwLoopLength;
      v27 = this->m_dwTotalBufferBytes;
      m_dwLoopSlots = this->m_dwLoopSlots;
      v29 = v25 / m_dwLoopLength + 1;
      this->m_preLoopSlots = v29;
      this->m_plOffset = v27 - m_dwLoopLength * (unsigned __int16)v29;
      if ( m_dwLoopSlots != (unsigned __int16)v29 )
      {
        qmemcpy(v22, (char *)this->m_pAudioData + v25, m_dwLoopLength);
        if ( this->m_dwLoopSlots - this->m_preLoopSlots >= 2 )
        {
          v30 = 1;
          v31 = 1;
          do
          {
            qmemcpy(
              &v22[this->m_dwLoopLength * v30],
              (char *)this->m_pAudioData + this->m_dwLoopStart,
              this->m_dwLoopLength);
            v30 = (unsigned __int16)++v31;
          }
          while ( this->m_dwLoopSlots - this->m_preLoopSlots > (unsigned __int16)v31 );
        }
        v25 = this->m_dwLoopStart;
      }
      v7 = a7;
      v32 = CAEAudioChannel::ConvertFromBytesToMS((CAEAudioChannel *)this, v25);
      v33 = 1;
      this->m_dwPreLoopTime = v32;
    }
    else
    {
      qmemcpy(v22, this->m_pAudioData, numBytes);
      m_dwBufSize = this->m_dwBufSize;
      if ( m_dwBufSize > numBytes )
        memset(&v22[numBytes], 0, m_dwBufSize - numBytes);
      v24 = 0;
      v33 = 0;
    }
    v35 = *(_QWORD *)&this->oalSource;
    v13 = 1;
    this->m_bNeedData = v33;
    OALSource::SetData((OALSource *)v35, v22, HIDWORD(v35), v7, 1u);
    v36 = this->oalSource;
    OALSource::ObtainSource(v36);
    j_alSourcei(v36->sourceId, 4134, v24);
    v36->posOffset = v24;
    free(v22);
    v37 = this->oalSource;
    this->m_fVol = -100.0;
    OALSource::SetVolume(v37, -100.0);
  }
  return v13;
}
// 3A9228: variable 'v7' is possibly undefined
// 3A9236: variable 'v21' is possibly undefined

//----- (003A9350) --------------------------------------------------------
int __fastcall CAEStaticChannel::SetAudioBuffer(
        CAEStaticChannel *this,
        OALBuffer *buffer,
        UInt16 SoundID,
        Int16 BankSlotID,
        int a5,
        UInt32 a6)
{
  OALSource *oalSource; // r0
  unsigned int bufferSize; // r0
  OALSource *v12; // r0
  OALSource *v13; // r0
  OALSource *v14; // r5
  OALSource *v15; // r0

  if ( !a6 )
    return 0;
  oalSource = this->oalSource;
  if ( oalSource )
  {
    --g_numSoundChannelsUsed;
    OALBase::Release(oalSource);
  }
  this->oalSource = 0;
  this->m_bLooping = 0;
  this->m_bNeedData = 0;
  this->m_bPaused = 0;
  this->m_dwLoopStart = 0;
  this->m_dwLoopEnd = 0;
  this->m_dwLoopSlots = 0;
  this->m_pAudioData = buffer;
  bufferSize = buffer->bufferSize;
  this->m_soundID = SoundID;
  this->m_dwBufSize = bufferSize;
  this->m_bankSlotID = BankSlotID;
  if ( a5 != -1 )
  {
    this->m_bLooping = 1;
    this->m_dwLoopStart = 2 * a5;
    this->m_dwLoopEnd = bufferSize;
  }
  this->m_dwTotalBufferBytes = bufferSize;
  this->m_frequency = a6;
  this->m_originalFrequency = a6;
  v12 = (OALSource *)operator new(0x30u);
  OALSource::OALSource(v12);
  this->oalSource = v13;
  ++g_numSoundChannelsUsed;
  OALSource::SetBuffer(v13, buffer);
  v14 = this->oalSource;
  OALSource::ObtainSource(v14);
  j_alSourcei(v14->sourceId, 4134, 0);
  v14->posOffset = 0;
  v15 = this->oalSource;
  this->m_fVol = -100.0;
  OALSource::SetVolume(v15, -100.0);
  return 1;
}
// 3A93CC: variable 'v13' is possibly undefined

//----- (003A9418) --------------------------------------------------------
void __fastcall CAEStaticChannel::SynchPlayback(CAEStaticChannel *this)
{
  OALSource *oalSource; // r0
  bool v3; // zf
  OALSource *v4; // r6
  int m_bLooping; // r5
  UInt32 v6; // r0

  oalSource = this->oalSource;
  v3 = oalSource == 0;
  if ( oalSource )
    v3 = this->m_bShouldPlay == 0;
  if ( !v3 && !this->m_bPaused )
  {
    if ( this->m_bNeedFade )
    {
      OALSource::SetVolume(oalSource, 0.0);
      if ( !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, this->m_fVol, -2, 0) )
        OALSource::SetVolume(this->oalSource, this->m_fVol);
    }
    v4 = this->oalSource;
    m_bLooping = this->m_bLooping;
    OALSource::ObtainSource(v4);
    if ( v4->type != OST_Preloop )
      j_alSourcei(v4->sourceId, 4103, m_bLooping != 0);
    OALSource::Play(this->oalSource);
    v6 = CTimer::m_snTimeInMilliseconds;
    this->m_bShouldPlay = 0;
    this->m_dwPlayStartTime = v6;
  }
}

//----- (003A94AC) --------------------------------------------------------
void __fastcall CAEStaticChannel::Service(CAEStaticChannel *this)
{
  OALSource *oalSource; // r5
  ALint curState; // r0
  ALuint sourceId; // r0
  OALSource *v5; // r0

  if ( this->oalSource )
  {
    CAEAudioChannel::UpdateStatus((CAEAudioChannel *)this);
    if ( !this->m_bPaused )
    {
      oalSource = this->oalSource;
      OALSource::ObtainSource(oalSource);
      curState = oalSource->curState;
      if ( !curState )
      {
        sourceId = oalSource->sourceId;
        oalSource->curState = 4116;
        j_alGetSourcei(sourceId, 4112, &oalSource->curState);
        curState = oalSource->curState;
      }
      if ( curState != 4114 )
      {
        v5 = this->oalSource;
        if ( v5 )
        {
          --g_numSoundChannelsUsed;
          OALBase::Release(v5);
        }
        this->oalSource = 0;
      }
    }
  }
}

//----- (003A950C) --------------------------------------------------------
Bool8 __fastcall CAEStaticChannel::IsSoundPlaying(CAEStaticChannel *this)
{
  OALSource *oalSource; // r4
  bool v2; // zf
  ALint curState; // r1
  ALuint sourceId; // r0

  oalSource = this->oalSource;
  if ( !oalSource )
    return 0;
  v2 = this->m_bPaused == 0;
  if ( !this->m_bPaused )
    v2 = this->m_bShouldPlay == 0;
  if ( !v2 )
    return 1;
  OALSource::ObtainSource(oalSource);
  curState = oalSource->curState;
  if ( !curState )
  {
    sourceId = oalSource->sourceId;
    oalSource->curState = 4116;
    j_alGetSourcei(sourceId, 4112, &oalSource->curState);
    curState = oalSource->curState;
  }
  return curState == 4114;
}

//----- (003A9558) --------------------------------------------------------
int __fastcall CAEStaticChannel::GetPlayTime(CAEStaticChannel *this)
{
  UInt32 CurrentPlaybackPosition; // r0

  if ( !(*((int (__fastcall **)(CAEStaticChannel *))this->_vptr$CAEAudioChannel + 3))(this) )
    return -1;
  CurrentPlaybackPosition = CAEAudioChannel::GetCurrentPlaybackPosition((CAEAudioChannel *)this);
  return CAEAudioChannel::ConvertFromBytesToMS((CAEAudioChannel *)this, CurrentPlaybackPosition);
}

//----- (003A957E) --------------------------------------------------------
int __fastcall CAEStaticChannel::GetLength(CAEStaticChannel *this)
{
  return CAEAudioChannel::ConvertFromBytesToMS((CAEAudioChannel *)this, this->m_dwBufSize);
}

//----- (003A958C) --------------------------------------------------------
void __fastcall CAEStaticChannel::Stop(CAEStaticChannel *this)
{
  OALSource *oalSource; // r5
  ALint curState; // r0
  ALuint sourceId; // r0
  OALSource *v5; // r5
  OALSource *v6; // r0

  oalSource = this->oalSource;
  if ( oalSource )
  {
    OALSource::ObtainSource(this->oalSource);
    curState = oalSource->curState;
    if ( !curState )
    {
      sourceId = oalSource->sourceId;
      oalSource->curState = 4116;
      j_alGetSourcei(sourceId, 4112, &oalSource->curState);
      curState = oalSource->curState;
    }
    if ( curState == 4114 && !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, -100.0, -1, 1) )
    {
      v5 = this->oalSource;
      if ( v5->type == OST_Preloop )
        OALSource::UnqueueBuffers(this->oalSource);
      j_alSourceStop(v5->sourceId);
      v5->curState = 4116;
      v5->posOffset = 0;
      v5->wasStopped = 1;
    }
    v6 = this->oalSource;
    if ( v6 )
    {
      --g_numSoundChannelsUsed;
      OALBase::Release(v6);
    }
  }
  this->m_bPaused = 0;
  this->oalSource = 0;
}

//----- (003A9628) --------------------------------------------------------
void __fastcall CAEStreamingChannel::CAEStreamingChannel(CAEStreamingChannel *this, UInt16 channelID)
{
  _DWORD *v2; // r0

  CAEAudioChannel::CAEAudioChannel((CAEAudioChannel *)this, channelID, 0xBB80u, 0x10u);
  *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)v2) = 0;
  *(int *)((char *)&elf_hash_chain[20405] + (_DWORD)v2) = 0;
  *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)v2) = -6;
  *(int *)((char *)&elf_hash_chain[20407] + (_DWORD)v2) = 0;
  *(int *)((char *)&elf_hash_chain[20410] + (_DWORD)v2) = 0;
  *(int *)((char *)&elf_hash_chain[20415] + (_DWORD)v2) = 1065353216;
  v2[13] = 0;
  v2[12] = 0;
  *(_DWORD *)((char *)v2 + 47) = 0;
  *(_DWORD *)((char *)v2 + 43) = 0;
  *v2 = &off_667890;
}
// 3A9644: variable 'v2' is possibly undefined
// 10168: using guessed type int elf_hash_chain[22025];
// 667890: using guessed type void *off_667890;

//----- (003A96A0) --------------------------------------------------------
void __fastcall CAEStreamingChannel::~CAEStreamingChannel(CAEStreamingChannel *this)
{
  OALSource *oalSource; // r1
  OALSource *v3; // r5
  OALSource *v4; // r0
  int v5; // r0
  int v6; // r0

  oalSource = this->oalSource;
  this->_vptr$CAEAudioChannel = (int (**)(void))&off_667890;
  if ( !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, oalSource, -100.0, 35, 1) )
  {
    v3 = this->oalSource;
    if ( v3->type == OST_Preloop )
      OALSource::UnqueueBuffers(this->oalSource);
    j_alSourceStop(v3->sourceId);
    v3->curState = 4116;
    v3->posOffset = 0;
    v3->wasStopped = 1;
  }
  v4 = this->oalSource;
  *(int *)((char *)&elf_hash_chain[20410] + (_DWORD)this) = 0;
  *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -5;
  if ( v4 )
    OALBase::Release(v4);
  this->oalSource = 0;
  v5 = *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  if ( v5 )
  {
    (*(void (__fastcall **)(int))(*(_DWORD *)v5 + 28))(v5);
    *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this) = 0;
  }
  v6 = *(int *)((char *)&elf_hash_chain[20405] + (_DWORD)this);
  if ( v6 )
  {
    (*(void (__fastcall **)(int))(*(_DWORD *)v6 + 28))(v6);
    *(int *)((char *)&elf_hash_chain[20405] + (_DWORD)this) = 0;
  }
  sub_1928FC((CAEAudioChannel *)this);
}
// 10168: using guessed type int elf_hash_chain[22025];
// 667890: using guessed type void *;

//----- (003A975C) --------------------------------------------------------
void __fastcall CAEStreamingChannel::~CAEStreamingChannel(CAEStreamingChannel *this)
{
  void *v1; // r0

  CAEStreamingChannel::~CAEStreamingChannel(this);
  sub_191374(v1);
}
// 3A9768: variable 'v1' is possibly undefined

//----- (003A976C) --------------------------------------------------------
int __fastcall CAEStreamingChannel::GetLength(CAEStreamingChannel *this)
{
  int v1; // r0

  v1 = *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  if ( v1 )
    return (*(int (__fastcall **)(int))(*(_DWORD *)v1 + 8))(v1);
  else
    return -1;
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A9786) --------------------------------------------------------
int __fastcall CAEStreamingChannel::UpdatePlayTime(CAEStreamingChannel *this)
{
  int result; // r0
  OALSource *oalSource; // r5
  uint64 CurrentTimeInMilliseconds; // r0
  int v5; // r2
  ALint value[3]; // [sp+4h] [bp-Ch] BYREF

  result = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
  if ( (result | 2) == -1 )
  {
    oalSource = this->oalSource;
    j_alGetSourcei(oalSource->sourceId, 4134, value);
    *(int *)((char *)&elf_hash_chain[20408] + (_DWORD)this) = 500
                                                            * (oalSource->posOffset + value[0])
                                                            / this->m_frequency;
    CurrentTimeInMilliseconds = CAEAudioUtility::GetCurrentTimeInMilliseconds();
    v5 = CurrentTimeInMilliseconds;
    *(int *)((char *)&elf_hash_chain[20413] + (_DWORD)this) = HIDWORD(CurrentTimeInMilliseconds);
    result = *(int *)((char *)&elf_hash_chain[20408] + (_DWORD)this);
    *(int *)((char *)&elf_hash_chain[20412] + (_DWORD)this) = v5;
    if ( result <= 0 )
      return 0;
  }
  else
  {
    *(int *)((char *)&elf_hash_chain[20408] + (_DWORD)this) = result;
  }
  return result;
}
// 10168: using guessed type int elf_hash_chain[22025];
// 3A9786: using guessed type ALint value[3];

//----- (003A97FE) --------------------------------------------------------
int __fastcall CAEStreamingChannel::GetPlayTime(CAEStreamingChannel *this)
{
  int result; // r0
  OALSource *oalSource; // r5
  uint64 CurrentTimeInMilliseconds; // r0
  int v5; // r2
  ALint value[3]; // [sp+4h] [bp-Ch] BYREF

  result = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
  if ( (result | 2) == -1 )
  {
    oalSource = this->oalSource;
    j_alGetSourcei(oalSource->sourceId, 4134, value);
    *(int *)((char *)&elf_hash_chain[20408] + (_DWORD)this) = 500
                                                            * (oalSource->posOffset + value[0])
                                                            / this->m_frequency;
    CurrentTimeInMilliseconds = CAEAudioUtility::GetCurrentTimeInMilliseconds();
    v5 = CurrentTimeInMilliseconds;
    *(int *)((char *)&elf_hash_chain[20413] + (_DWORD)this) = HIDWORD(CurrentTimeInMilliseconds);
    result = *(int *)((char *)&elf_hash_chain[20408] + (_DWORD)this);
    *(int *)((char *)&elf_hash_chain[20412] + (_DWORD)this) = v5;
    if ( result <= 0 )
      return 0;
  }
  return result;
}
// 10168: using guessed type int elf_hash_chain[22025];
// 3A97FE: using guessed type ALint value[3];

//----- (003A9868) --------------------------------------------------------
int __fastcall CAEStreamingChannel::GetActiveTrackID(CAEStreamingChannel *this)
{
  int v1; // r0

  v1 = *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  if ( v1 )
    return (*(int (__fastcall **)(int))(*(_DWORD *)v1 + 32))(v1);
  else
    return -1;
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A9882) --------------------------------------------------------
int __fastcall CAEStreamingChannel::GetPlayingTrackID(CAEStreamingChannel *this)
{
  int v2; // r0
  unsigned int v3; // r1

  v2 = *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  if ( !v2 )
    return -1;
  v3 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) + 5;
  if ( v3 > 4 || v3 == 3 )
    return -1;
  else
    return (*(int (__fastcall **)(int))(*(_DWORD *)v2 + 32))(v2);
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A98B0) --------------------------------------------------------
void __fastcall CAEStreamingChannel::Stop(CAEStreamingChannel *this, bool bUpdateState)
{
  _BOOL4 v3; // r5
  OALSource *oalSource; // r6

  v3 = bUpdateState;
  if ( !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, -100.0, 35, 1) )
  {
    oalSource = this->oalSource;
    if ( oalSource->type == OST_Preloop )
      OALSource::UnqueueBuffers(this->oalSource);
    j_alSourceStop(oalSource->sourceId);
    oalSource->curState = 4116;
    oalSource->posOffset = 0;
    oalSource->wasStopped = 1;
  }
  if ( v3 )
  {
    *(int *)((char *)&elf_hash_chain[20410] + (_DWORD)this) = 0;
    *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -5;
  }
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A9928) --------------------------------------------------------
bool __fastcall CAEStreamingChannel::Initialise(CAEStreamingChannel *this)
{
  OALSource *v2; // r0
  OALSource *v3; // r0

  CAEAudioChannel::SetOriginalFrequency((CAEAudioChannel *)this, 0x5622u);
  this->m_bLooping = 0;
  this->m_pReadBuffer = this->m_ReadBuffer;
  v2 = (OALSource *)operator new(0x30u);
  OALSource::OALSource(v2);
  this->oalSource = v3;
  OALSource::SetStream(v3);
  return 0;
}
// 3A994C: variable 'v3' is possibly undefined

//----- (003A9958) --------------------------------------------------------
int __fastcall CAEStreamingChannel::PrepareStream(
        CAEStreamingChannel *this,
        CAEStreamingDecoder *stream,
        Int8 SoundFlags,
        bool bNeedStop)
{
  OALSource *oalSource; // r1
  int v8; // r2
  OALSource *v9; // r8
  CAEStreamingDecoder **v10; // r8
  int v11; // r0
  unsigned int v12; // r0
  void *v13; // r5
  OALBuffer *v14; // r6
  unsigned int v15; // r0
  unsigned int v16; // r1
  int v17; // r5
  UInt32 v18; // r0
  OALSource *v19; // r6

  if ( !stream )
    return -1;
  oalSource = this->oalSource;
  if ( !oalSource )
    return -1;
  if ( bNeedStop )
  {
    v8 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
    if ( (unsigned int)(v8 + 4) <= 3
      && v8 != -2
      && !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, oalSource, -100.0, 35, 1) )
    {
      v9 = this->oalSource;
      if ( v9->type == OST_Preloop )
        OALSource::UnqueueBuffers(this->oalSource);
      j_alSourceStop(v9->sourceId);
      v9->curState = 4116;
      v9->posOffset = 0;
      v9->wasStopped = 1;
    }
    *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -6;
  }
  v10 = (CAEStreamingDecoder **)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  v11 = *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  if ( v11 )
  {
    (*(void (__fastcall **)(int))(*(_DWORD *)v11 + 28))(v11);
    *v10 = 0;
  }
  *v10 = stream;
  this->m_bLoopTrack = SoundFlags & 1;
  *((_BYTE *)&elf_hash_chain[20414] + (_DWORD)this) = stream->m_pStream->m_size < 0x12000;
  v12 = CAEStreamingChannel::FillBuffer(this, writeBuf, 0x24000u);
  v13 = writeBuf;
  if ( v12 != 147456 )
    memset((char *)writeBuf + v12, 0, 147456 - v12);
  this->m_bNeedToFinish = 0;
  v14 = (OALBuffer *)operator new(0x14u);
  v15 = (*((int (__fastcall **)(CAEStreamingDecoder *))(*v10)->_vptr$CAEStreamingDecoder + 5))(*v10);
  OALBuffer::OALBuffer(v14, v13, 0x24000u, v15, 1u);
  OALSource::QueueBuffer(this->oalSource, v14);
  OALBase::Release(v14);
  v16 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) + 7;
  if ( v16 > 6 || ((1 << v16) & 0x51) == 0 )
    *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -2;
  v17 = 0;
  this->numBuffered = 1;
  this->m_lastSlot = 0;
  v18 = (*((int (__fastcall **)(CAEStreamingDecoder *))(*v10)->_vptr$CAEStreamingDecoder + 5))(*v10);
  CAEAudioChannel::SetOriginalFrequency((CAEAudioChannel *)this, v18);
  v19 = this->oalSource;
  this->m_bNeedSwitch = 0;
  this->m_bSilenced = 0;
  this->m_bShouldStop = 0;
  OALSource::ObtainSource(v19);
  j_alSourcei(v19->sourceId, 4134, 0);
  v19->posOffset = 0;
  return v17;
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A9AFC) --------------------------------------------------------
unsigned int __fastcall CAEStreamingChannel::FillBuffer(CAEStreamingChannel *this, void *pBuf, unsigned int dwSize)
{
  unsigned int v6; // r5
  _DWORD *v7; // r10
  _DWORD *v8; // r11
  int v9; // r4
  int v10; // r0
  unsigned __int16 *v11; // r1
  int v12; // r3
  char *v13; // r9
  unsigned int v14; // r6
  unsigned int v15; // r4
  int v16; // r1
  OALSource *oalSource; // r4
  int v19[8]; // [sp+0h] [bp-20h] BYREF

  v6 = (*(int (__fastcall **)(_DWORD, void *, unsigned int, int *))(**(_DWORD **)((char *)&elf_hash_chain[20404]
                                                                                + (_DWORD)this)
                                                                  + 4))(
         *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this),
         pBuf,
         dwSize,
         v19);
  v7 = (int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  if ( v19[0] )
  {
    if ( this->m_bLoopTrack )
    {
      v19[0] = 0;
      if ( v6 < dwSize )
      {
        do
        {
          (*(void (__fastcall **)(_DWORD, int))(*(_DWORD *)*v7 + 16))(*v7, 1);
          v6 += (*(int (__fastcall **)(_DWORD, char *, unsigned int, int *))(*(_DWORD *)*v7 + 4))(
                  *v7,
                  (char *)pBuf + v6,
                  dwSize - v6,
                  v19);
        }
        while ( v6 < dwSize && !v19[0] );
      }
    }
    else if ( *(int *)((char *)&elf_hash_chain[20405] + (_DWORD)this) )
    {
      v8 = (int *)((char *)&elf_hash_chain[20405] + (_DWORD)this);
      v9 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)*v7 + 20))(*v7);
      if ( v9 == (*(int (__fastcall **)(_DWORD))(*(_DWORD *)*v8 + 20))(*v8) )
      {
        if ( *v7 )
          (*(void (__fastcall **)(_DWORD))(*(_DWORD *)*v7 + 28))(*v7);
        v10 = *v8;
        *v7 = *v8;
        *v8 = 0;
        if ( v6 >= 2 )
        {
          v11 = (unsigned __int16 *)((char *)pBuf + v6 - 2);
          do
          {
            v12 = *v11;
            if ( (v12 & 0xFFFFFF00) <= 0xF800
              && (v12 & 0xFFFFFF00) >= 0x800
              && (unsigned int)(unsigned __int8)v12 - 8 < 0xF1 )
            {
              break;
            }
            v6 -= 2;
            --v11;
          }
          while ( v6 > 1 );
        }
        if ( dwSize - v6 >= 0x480 )
        {
          v13 = (char *)pBuf + v6;
          v14 = (*(int (__fastcall **)(int, char *, unsigned int, int *))(*(_DWORD *)v10 + 4))(
                  v10,
                  v13,
                  1152 * ((dwSize - v6) / 0x480),
                  v19);
          if ( v14 )
          {
            v15 = 0;
            while ( 1 )
            {
              v16 = *(unsigned __int16 *)&v13[v15];
              if ( (v16 & 0xFFFFFF00) <= 0xF800
                && (v16 & 0xFFFFFF00) >= 0x800
                && (unsigned int)(unsigned __int8)v16 - 8 < 0xF1 )
              {
                break;
              }
              v15 += 2;
              if ( v14 <= v15 )
                goto LABEL_28;
            }
            memmove(v13, &v13[v15], v14 - v15);
            v6 = v14 + v6 - v15;
          }
        }
      }
      else
      {
        memset((char *)pBuf + v6, 0, dwSize - v6);
        v6 = dwSize;
        this->m_bSilenced = 1;
      }
    }
    else
    {
      oalSource = this->oalSource;
      OALSource::ObtainSource(oalSource);
      oalSource->curState = 4116;
      oalSource = (OALSource *)((char *)oalSource + 40);
      j_alGetSourcei((ALuint)oalSource[-1].oalBuffer, 4112, (ALint *)oalSource);
      if ( oalSource->_vptr$OALBase != (int (**)(void))((char *)&elf_hash_bucket[965] + 2) )
        *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -4;
    }
  }
LABEL_28:
  if ( *v7 )
    *(int *)((char *)&elf_hash_chain[20407] + (_DWORD)this) = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)*v7 + 12))(*v7);
  return v6;
}
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A9CC4) --------------------------------------------------------
void __fastcall CAEStreamingChannel::Play(
        CAEStreamingChannel *this,
        Int16 StartOffsetMs,
        Int8 SoundFlags,
        float freqFac)
{
  int v6; // r0
  bool v7; // zf
  UInt32 v8; // r0
  _DWORD *v9; // r6
  int v10; // r0
  OALSource *oalSource; // r5

  v6 = *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
  v7 = v6 == 0;
  if ( v6 )
    v7 = this->oalSource == 0;
  if ( !v7 )
  {
    v8 = (*(int (__fastcall **)(int, _DWORD, Int8, _DWORD))(*(_DWORD *)v6 + 20))(
           v6,
           *(_DWORD *)(*(_DWORD *)v6 + 20),
           SoundFlags,
           LODWORD(freqFac));
    CAEAudioChannel::SetOriginalFrequency((CAEAudioChannel *)this, v8);
    v9 = (int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
    v10 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
    if ( v10 != -7 )
    {
      this->m_bLoopTrack = SoundFlags & 1;
      if ( v10 == -5 )
      {
        CAESmoothFadeThread::CancelFade(&AESmoothFadeThread, this->oalSource);
        oalSource = this->oalSource;
        if ( oalSource->type == OST_Preloop )
          OALSource::UnqueueBuffers(this->oalSource);
        j_alSourceStop(oalSource->sourceId);
        oalSource->curState = 4116;
        oalSource->posOffset = 0;
        oalSource->wasStopped = 1;
        *v9 = -6;
      }
    }
    *v9 = -1;
    OALSource::SetVolume(this->oalSource, this->m_fVol);
    sub_1A12BC(this->oalSource);
  }
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A9D6C) --------------------------------------------------------
int __fastcall CAEStreamingChannel::SetNextStream(CAEStreamingChannel *this, CAEStreamingDecoder *stream)
{
  int v4; // r0
  CAEStreamingDecoder **v5; // r5
  int result; // r0

  v4 = *(int *)((char *)&elf_hash_chain[20405] + (_DWORD)this);
  v5 = (CAEStreamingDecoder **)((char *)&elf_hash_chain[20405] + (_DWORD)this);
  if ( v4 )
  {
    (*(void (__fastcall **)(int))(*(_DWORD *)v4 + 28))(v4);
    *v5 = 0;
  }
  result = 0;
  *v5 = stream;
  return result;
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003A9D94) --------------------------------------------------------
void __fastcall CAEStreamingChannel::Service(CAEStreamingChannel *this)
{
  OALSource *oalSource; // r5
  ALint *p_curState; // r5
  int *v4; // r8
  int v5; // r0
  int *p_m_lStoppingFrameCount; // r1
  OALSource *v8; // r5
  OALSource *v9; // r5
  ALint curState; // r0
  ALuint sourceId; // r0
  unsigned int v12; // r0
  int *v13; // r1
  int v14; // r0
  bool v15; // zf
  _DWORD *v16; // r10
  UInt32 v17; // r0
  OALSource *v18; // r5
  unsigned int v19; // r9
  unsigned __int8 *p_m_lastSlot; // r6
  char numBuffered; // r0
  unsigned int v22; // r0
  OALBuffer *v23; // r5
  int v24; // r0
  void *m_pReadBuffer; // r10
  unsigned int v26; // r0
  OALSource *v27; // r5
  CAEStreamingDecoder *v28; // r5
  OALSource *v29; // r6
  OALSource *v30; // r4
  ALint value[7]; // [sp+4h] [bp-1Ch] BYREF

  CAEAudioChannel::UpdateStatus((CAEAudioChannel *)this);
  oalSource = this->oalSource;
  if ( !oalSource
    || (OALSource::ObtainSource(this->oalSource),
        oalSource->curState = 4116,
        p_curState = &oalSource->curState,
        j_alGetSourcei(*(p_curState - 8), 4112, p_curState),
        *p_curState != 4114) )
  {
    v4 = (int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
    v5 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
    if ( v5 == -5 )
    {
      *v4 = -6;
      return;
    }
LABEL_14:
    if ( v5 != -3 )
      goto LABEL_22;
    goto LABEL_15;
  }
  v4 = (int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
  v5 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
  if ( (unsigned int)(v5 + 4) < 2 )
    goto LABEL_14;
  if ( v5 != -1 )
  {
    p_m_lStoppingFrameCount = &this->m_lStoppingFrameCount;
    if ( v5 == -5 )
    {
      if ( (*p_m_lStoppingFrameCount)++ >= 6 )
      {
LABEL_10:
        v8 = this->oalSource;
        if ( v8->type == OST_Preloop )
          OALSource::UnqueueBuffers(this->oalSource);
        j_alSourceStop(v8->sourceId);
        v8->curState = 4116;
        v8->posOffset = 0;
        v8->wasStopped = 1;
      }
    }
    else
    {
      *p_m_lStoppingFrameCount = 0;
      if ( v5 == -6 )
        goto LABEL_10;
    }
    v5 = *v4;
    goto LABEL_14;
  }
  *v4 = -3;
LABEL_15:
  v9 = this->oalSource;
  OALSource::ObtainSource(v9);
  curState = v9->curState;
  if ( !curState )
  {
    sourceId = v9->sourceId;
    v9->curState = 4116;
    j_alGetSourcei(sourceId, 4112, &v9->curState);
    curState = v9->curState;
  }
  if ( curState == 4114 )
  {
    v5 = *v4;
  }
  else
  {
    v5 = -6;
    if ( this->oalSource->wasStopped )
      v5 = -7;
    *v4 = v5;
  }
LABEL_22:
  v12 = v5 + 7;
  if ( v12 <= 4 )
  {
    v13 = &dword_0 + 1;
    v14 = 1 << v12;
    v15 = (v14 & 0x19) == 0;
    if ( (v14 & 0x19) != 0 )
    {
      v13 = &elf_hash_chain[20404];
      v14 = *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this);
      v15 = v14 == 0;
    }
    if ( !v15 )
    {
      v16 = (int *)((char *)v13 + (_DWORD)this);
      if ( (*(int (__fastcall **)(int))(*(_DWORD *)v14 + 20))(v14) != this->m_originalFrequency )
      {
        v17 = (*(int (__fastcall **)(_DWORD))(*(_DWORD *)*v16 + 20))(*v16);
        CAEAudioChannel::SetOriginalFrequency((CAEAudioChannel *)this, v17);
      }
      v18 = this->oalSource;
      j_alGetSourcei(v18->sourceId, 4134, value);
      v19 = (v18->posOffset + value[0]) / 0x24000;
      if ( this->numBuffered == 7 )
      {
        p_m_lastSlot = &this->m_lastSlot;
        numBuffered = 6;
      }
      else
      {
        v22 = CAEStreamingChannel::FillBuffer(this, this->m_pReadBuffer, 0x24000u);
        p_m_lastSlot = &this->m_lastSlot;
        this->m_lastWrittenSlot = this->m_lastSlot;
        if ( v22 != 147456 )
          memset((char *)this->m_pReadBuffer + v22, 0, 147456 - v22);
        v23 = (OALBuffer *)operator new(0x14u);
        v24 = *v16;
        m_pReadBuffer = this->m_pReadBuffer;
        v26 = (*(int (__fastcall **)(int))(*(_DWORD *)v24 + 20))(v24);
        OALBuffer::OALBuffer(v23, m_pReadBuffer, 0x24000u, v26, 1u);
        OALSource::QueueBuffer(this->oalSource, v23);
        OALBase::Release(v23);
        numBuffered = this->numBuffered;
        this->numBuffered = numBuffered + 1;
      }
      if ( *p_m_lastSlot != (unsigned __int8)v19 )
      {
        if ( *v4 == -4 )
        {
          if ( this->m_bShouldStop )
          {
            v27 = this->oalSource;
            if ( v27->type == OST_Preloop )
              OALSource::UnqueueBuffers(this->oalSource);
            j_alSourceStop(v27->sourceId);
            v27->wasStopped = 1;
            v27->curState = 4116;
            v27->posOffset = 0;
            *v4 = -6;
            this->m_bShouldStop = 0;
            return;
          }
          this->m_bShouldStop = 1;
LABEL_42:
          *p_m_lastSlot = v19;
          return;
        }
        if ( this->m_bSilenced )
        {
          *(_WORD *)&this->m_bNeedSwitch = 1;
          goto LABEL_42;
        }
        if ( this->m_bNeedSwitch )
        {
          v28 = *(CAEStreamingDecoder **)((char *)&elf_hash_chain[20405] + (_DWORD)this);
          *(int *)((char *)&elf_hash_chain[20405] + (_DWORD)this) = 0;
          *v4 = -7;
          if ( !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, -100.0, 35, 1) )
          {
            v29 = this->oalSource;
            if ( v29->type == OST_Preloop )
              OALSource::UnqueueBuffers(this->oalSource);
            j_alSourceStop(v29->sourceId);
            v29->curState = 4116;
            v29->posOffset = 0;
            v29->wasStopped = 1;
          }
          CAEStreamingChannel::PrepareStream(this, v28, 0, 0);
          (*((void (__fastcall **)(CAEStreamingChannel *, _DWORD, _DWORD, int))this->_vptr$CAEAudioChannel + 6))(
            this,
            0,
            0,
            1065353216);
        }
        else
        {
          if ( !this->m_bNeedToFinish )
          {
            this->numBuffered = numBuffered;
            goto LABEL_42;
          }
          v30 = this->oalSource;
          OALSource::ObtainSource(v30);
          v30->curState = 4116;
          v30 = (OALSource *)((char *)v30 + 40);
          j_alGetSourcei((ALuint)v30[-1].oalBuffer, 4112, (ALint *)v30);
          if ( v30->_vptr$OALBase != (int (**)(void))((char *)&elf_hash_bucket[965] + 2) )
            *v4 = -4;
        }
      }
    }
  }
}
// 0: using guessed type int dword_0;
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];
// 3A9D94: using guessed type ALint value[7];

//----- (003AA0B0) --------------------------------------------------------
void __fastcall CAEStreamingChannel::SetReady(CAEStreamingChannel *this)
{
  _DWORD *v2; // r6
  int v3; // r0
  OALSource *oalSource; // r5

  v2 = (int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
  v3 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
  if ( v3 != -6 )
  {
    if ( v3 != -5 )
      return;
    CAESmoothFadeThread::CancelFade(&AESmoothFadeThread, this->oalSource);
    oalSource = this->oalSource;
    if ( oalSource->type == OST_Preloop )
      OALSource::UnqueueBuffers(this->oalSource);
    j_alSourceStop(oalSource->sourceId);
    oalSource->curState = 4116;
    oalSource->posOffset = 0;
    oalSource->wasStopped = 1;
    *v2 = -6;
  }
  if ( *(int *)((char *)&elf_hash_chain[20404] + (_DWORD)this) )
    *v2 = -2;
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003AA124) --------------------------------------------------------
Bool8 __fastcall CAEStreamingChannel::IsSoundPlaying(CAEStreamingChannel *this)
{
  int v1; // r0

  v1 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this);
  return (unsigned int)(v1 + 5) <= 4 && v1 != -2 || v1 == -7;
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003AA148) --------------------------------------------------------
void __fastcall CAEStreamingChannel::SetFrequencyScalingFactor(CAEStreamingChannel *this, float fScalingFactor)
{
  int *v2; // r5
  OALSource *oalSource; // r0
  bool v5; // zf
  _DWORD *v6; // r5
  OALSource *v7; // r0
  OALSource *v8; // r6
  int m_bLooping; // r5

  if ( fScalingFactor == 0.0 )
  {
    oalSource = this->oalSource;
    v5 = oalSource == 0;
    if ( oalSource )
    {
      v2 = &elf_hash_chain[20406];
      v5 = *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) == -7;
    }
    if ( !v5 && CAEAudioChannel::IsBufferPlaying((CAEAudioChannel *)this) )
    {
      v6 = (int (***)(void))((char *)&this->_vptr$CAEAudioChannel + (_DWORD)v2);
      if ( !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, -100.0, 35, 1) )
        OALSource::Pause(this->oalSource);
      *v6 = -7;
    }
  }
  else
  {
    CAEAudioChannel::SetFrequency(
      (CAEAudioChannel *)this,
      (unsigned int)(float)((float)this->m_originalFrequency * fScalingFactor));
    if ( *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) == -7 )
    {
      v7 = this->oalSource;
      if ( v7 )
      {
        OALSource::SetVolume(v7, this->m_fVol);
        v8 = this->oalSource;
        m_bLooping = this->m_bLooping;
        OALSource::ObtainSource(v8);
        if ( v8->type != OST_Preloop )
          j_alSourcei(v8->sourceId, 4103, m_bLooping != 0);
        OALSource::Play(this->oalSource);
      }
      wasPlaylistPlaying = 0;
      *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -1;
    }
  }
}
// 3AA190: variable 'v2' is possibly undefined
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003AA234) --------------------------------------------------------
void __fastcall CAEStreamingChannel::Pause(CAEStreamingChannel *this)
{
  OALSource *oalSource; // r5

  if ( this->oalSource && CAEAudioChannel::IsBufferPlaying((CAEAudioChannel *)this) )
  {
    if ( !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, -100.0, 35, 1) )
    {
      oalSource = this->oalSource;
      if ( oalSource->type == OST_Preloop )
        OALSource::UnqueueBuffers(this->oalSource);
      j_alSourceStop(oalSource->sourceId);
      oalSource->curState = 4116;
      oalSource->posOffset = 0;
      oalSource->wasStopped = 1;
    }
    *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -7;
  }
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003AA2A0) --------------------------------------------------------
void __fastcall CAEStreamingChannel::Stop(CAEStreamingChannel *this)
{
  OALSource *oalSource; // r5

  if ( !CAESmoothFadeThread::RequestFade(&AESmoothFadeThread, this->oalSource, -100.0, 35, 1) )
  {
    oalSource = this->oalSource;
    if ( oalSource->type == OST_Preloop )
      OALSource::UnqueueBuffers(this->oalSource);
    j_alSourceStop(oalSource->sourceId);
    oalSource->curState = 4116;
    oalSource->posOffset = 0;
    oalSource->wasStopped = 1;
  }
  *(int *)((char *)&elf_hash_chain[20410] + (_DWORD)this) = 0;
  *(int *)((char *)&elf_hash_chain[20406] + (_DWORD)this) = -5;
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003AA308) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CAEStreamingDecoder::CAEStreamingDecoder(CAEStreamingDecoder *this, CAEDataStream *stream)
{
  CAEStreamingDecoder v3; // r0
  CAEDataStream *v4; // r1

  v3._vptr$CAEStreamingDecoder = (int (**)(void))&off_6678C0;
  *this = v3;
  if ( v3.m_pStream )
    CAEDataStream::Initialise(v4);
}
// 3AA308: variables would overlap: r0.4 and r0.8
// 6678C0: using guessed type void *;

//----- (003AA330) --------------------------------------------------------
void __fastcall CAEStreamingDecoder::~CAEStreamingDecoder(CAEStreamingDecoder *this)
{
  CAEDataStream *m_pStream; // r0
  void *v3; // r0

  m_pStream = this->m_pStream;
  this->_vptr$CAEStreamingDecoder = (int (**)(void))&off_6678C0;
  if ( m_pStream )
  {
    CAEDataStream::~CAEDataStream(m_pStream);
    operator delete(v3);
    this->m_pStream = 0;
  }
}
// 3AA348: variable 'v3' is possibly undefined
// 6678C0: using guessed type void *off_6678C0;

//----- (003AA35E) --------------------------------------------------------
void __fastcall CAEStreamThread::~CAEStreamThread(CAEStreamThread *this)
{
  OSSemaphore m_sem; // r0

  OS_MutexDelete(this->m_mutex);
  OS_MutexDelete(this->m_pauseMutex);
  m_sem = this->m_sem;
  if ( m_sem )
    OS_SemaphoreDelete(m_sem);
}

//----- (003AA380) --------------------------------------------------------
bool __fastcall CAEStreamThread::Initialise(CAEStreamThread *this, CAEStreamingChannel *pStreamingChannel)
{
  bool v4; // r6
  CAEMP3TrackLoader *v5; // r0
  CAEMP3TrackLoader *v6; // r0

  v4 = 1;
  this->m_bNeedService = 0;
  *(_WORD *)&this->m_bInitialised = 1;
  this->m_bInvalidTrack = 0;
  this->m_bShouldStop = 0;
  if ( pStreamingChannel )
  {
    this->m_playingTrackID = CAEStreamingChannel::GetPlayingTrackID(pStreamingChannel);
    this->m_playTime = (*((int (__fastcall **)(CAEStreamingChannel *))pStreamingChannel->_vptr$CAEAudioChannel + 4))(pStreamingChannel);
    this->m_activeTrackID = CAEStreamingChannel::GetActiveTrackID(pStreamingChannel);
    this->m_trackLengthMs = (*((int (__fastcall **)(CAEStreamingChannel *))pStreamingChannel->_vptr$CAEAudioChannel + 5))(pStreamingChannel);
    this->m_bActive = 1;
    this->m_sem = OS_SemaphoreCreate();
    this->m_mutex = OS_MutexCreate("StreamMutex");
    this->m_pauseMutex = OS_MutexCreate("StreamPauseMutex");
    this->m_thread = OS_ThreadLaunch(CAEStreamThread::MainLoop, this, 3u, "StreamThread", 0, 1);
    this->m_pStreamingChannel = pStreamingChannel;
    v5 = (CAEMP3TrackLoader *)operator new(0x24u);
    CAEMP3TrackLoader::CAEMP3TrackLoader(v5);
    this->m_pTrackLoader = v6;
    CAEMP3TrackLoader::Initialise(v6);
    return this->m_bInitialised;
  }
  return v4;
}
// 3AA406: variable 'v6' is possibly undefined

//----- (003AA454) --------------------------------------------------------
unsigned int __fastcall CAEStreamThread::MainLoop(void *pData)
{
  int CurrentTimeInMilliseconds; // r5

  OS_SemaphoreWait(*((OSSemaphore *)pData + 2));
  while ( *((_BYTE *)pData + 25) )
  {
    CurrentTimeInMilliseconds = CAEAudioUtility::GetCurrentTimeInMilliseconds();
    OS_MutexObtain(*((OSMutex *)pData + 1));
    CAEStreamThread::Service((CAEStreamThread *)pData);
    (*(void (__fastcall **)(_DWORD))(**((_DWORD **)pData + 4) + 8))(*((_DWORD *)pData + 4));
    OS_MutexRelease(*((OSMutex *)pData + 1));
    if ( (unsigned int)CAEAudioUtility::GetCurrentTimeInMilliseconds() - CurrentTimeInMilliseconds <= 4 )
      OS_ThreadSleep(5000);
    OS_MutexObtain(*((OSMutex *)pData + 3));
    OS_MutexRelease(*((OSMutex *)pData + 3));
  }
  return 0;
}

//----- (003AA4AA) --------------------------------------------------------
void __fastcall CAEStreamThread::Start(CAEStreamThread *this)
{
  OSSemaphore m_sem; // r1

  m_sem = this->m_sem;
  this->m_bActive = 1;
  sub_19E750(m_sem);
}

//----- (003AA4B6) --------------------------------------------------------
void __fastcall CAEStreamThread::Stop(CAEStreamThread *this)
{
  CAEMP3TrackLoader *m_bInitialised; // r0
  bool v3; // zf
  void *v4; // r0
  OSThreadHandle m_thread; // r0

  m_bInitialised = (CAEMP3TrackLoader *)this->m_bInitialised;
  this->m_bActive = 0;
  v3 = m_bInitialised == 0;
  if ( m_bInitialised )
  {
    m_bInitialised = this->m_pTrackLoader;
    v3 = m_bInitialised == 0;
  }
  if ( !v3 )
  {
    CAEMP3TrackLoader::~CAEMP3TrackLoader(m_bInitialised);
    operator delete(v4);
  }
  m_thread = this->m_thread;
  this->m_bInitialised = 0;
  OS_ThreadClose(m_thread);
  this->m_thread = 0;
}
// 3AA4D0: variable 'v4' is possibly undefined

//----- (003AA4E0) --------------------------------------------------------
void __fastcall CAEStreamThread::Pause(CAEStreamThread *this)
{
  sub_18E1B0(this->m_pauseMutex);
}

//----- (003AA4E6) --------------------------------------------------------
void __fastcall CAEStreamThread::Resume(CAEStreamThread *this)
{
  sub_18CEF0(this->m_pauseMutex);
}

//----- (003AA4EC) --------------------------------------------------------
void __fastcall CAEStreamThread::WaitForExit(CAEStreamThread *this)
{
  OSThreadHandle m_thread; // r0

  m_thread = this->m_thread;
  if ( m_thread )
    sub_196804(m_thread);
}

//----- (003AA4F8) --------------------------------------------------------
void __fastcall CAEStreamThread::Check(CAEStreamThread *this)
{
  OS_MutexObtain(this->m_mutex);
  CAEStreamThread::Service(this);
  (*((void (__fastcall **)(CAEStreamingChannel *))this->m_pStreamingChannel->_vptr$CAEAudioChannel + 2))(this->m_pStreamingChannel);
  sub_18CEF0(this->m_mutex);
}

//----- (003AA51C) --------------------------------------------------------
void __fastcall CAEStreamThread::Service(CAEStreamThread *this)
{
  CAEStreamingChannel *m_pStreamingChannel; // r0
  unsigned int m_trackID; // r8
  unsigned int m_startOffsetMs; // r9
  int m_nextTrackID; // r10
  int v6; // r6
  unsigned __int8 m_trackFlags; // r1
  CAEMP3Decoder *v8; // r5
  CAEMP3TrackLoader **p_m_pTrackLoader; // r11
  CAEDataStream *DataStream; // r0
  int PlayingTrackID; // r0
  CAEStreamingChannel *v12; // r1
  int v13; // r0
  CAEStreamingChannel *v14; // r1
  int ActiveTrackID; // r0
  CAEStreamingChannel *v16; // r1
  int v17; // r0
  CAEStreamingChannel *v18; // r1
  int v19; // r0
  CAEStreamingChannel *v20; // r1
  int v21; // r0
  CAEStreamingChannel *v22; // r1
  int v23; // r0
  _BOOL4 m_bUserTrack; // r1
  int m_playTime; // r5
  CAEMP3Decoder *v26; // r6
  CAEDataStream *v27; // r0
  void (__fastcall *v28)(CAEMP3Decoder *, unsigned int); // r11
  unsigned int v29; // r1
  CAEStreamingDecoder *v30; // r1
  CAEStreamingChannel *v31; // r0
  Int8 v32; // r2
  CAEStreamingDecoder *v33; // r1
  _BOOL4 v34; // r0
  int v35; // [sp+4h] [bp-24h]
  unsigned __int8 v36; // [sp+8h] [bp-20h]

  CAEStreamingChannel::UpdatePlayTime(this->m_pStreamingChannel);
  if ( this->m_bShouldStop )
  {
    m_pStreamingChannel = this->m_pStreamingChannel;
    this->m_bShouldStop = 0;
    (*((void (__fastcall **)(CAEStreamingChannel *))m_pStreamingChannel->_vptr$CAEAudioChannel + 8))(m_pStreamingChannel);
  }
  if ( this->m_bNeedService )
  {
    m_trackID = this->m_trackID;
    m_startOffsetMs = this->m_startOffsetMs;
    m_nextTrackID = this->m_nextTrackID;
    v6 = m_nextTrackID + 1;
    m_trackFlags = this->m_trackFlags;
    this->m_bNeedService = 0;
    v36 = m_trackFlags;
    if ( m_nextTrackID == -1 )
    {
      v35 = 0;
      v8 = 0;
      CAEStreamingChannel::SetNextStream(this->m_pStreamingChannel, 0);
      p_m_pTrackLoader = &this->m_pTrackLoader;
    }
    else
    {
      v8 = (CAEMP3Decoder *)operator new(0x5Cu);
      p_m_pTrackLoader = &this->m_pTrackLoader;
      DataStream = CAEMP3TrackLoader::GetDataStream(this->m_pTrackLoader, m_nextTrackID);
      CAEMP3Decoder::CAEMP3Decoder(v8, DataStream, 0);
      if ( !(*(int (__fastcall **)(CAEMP3Decoder *))v8->_vptr$CAEStreamingDecoder)(v8) )
      {
        (*((void (__fastcall **)(CAEMP3Decoder *))v8->_vptr$CAEStreamingDecoder + 7))(v8);
        v8 = 0;
      }
      if ( CAEStreamingChannel::GetPlayingTrackID(this->m_pStreamingChannel) == m_trackID )
      {
        if ( v8 )
          CAEStreamingChannel::SetNextStream(this->m_pStreamingChannel, v8);
        CAEStreamingChannel::SetReady(this->m_pStreamingChannel);
        if ( !this->m_bInvalidTrack )
          goto LABEL_11;
LABEL_29:
        if ( !v6 )
          m_nextTrackID = m_trackID;
        this->m_activeTrackID = m_nextTrackID;
        this->m_playingTrackID = m_nextTrackID;
        return;
      }
      v35 = m_nextTrackID + 1;
    }
    v26 = (CAEMP3Decoder *)operator new(0x5Cu);
    v27 = CAEMP3TrackLoader::GetDataStream(*p_m_pTrackLoader, m_trackID);
    CAEMP3Decoder::CAEMP3Decoder(v26, v27, 0);
    if ( (*(int (__fastcall **)(CAEMP3Decoder *))v26->_vptr$CAEStreamingDecoder)(v26) == 1 )
    {
      v28 = (void (__fastcall *)(CAEMP3Decoder *, unsigned int))*((_DWORD *)v26->_vptr$CAEStreamingDecoder + 4);
      v29 = m_startOffsetMs % (*((int (__fastcall **)(CAEMP3Decoder *))v26->_vptr$CAEStreamingDecoder + 2))(v26);
      v28(v26, v29);
      if ( v8 )
        v30 = v8;
      else
        v30 = 0;
      CAEStreamingChannel::SetNextStream(this->m_pStreamingChannel, v30);
      v31 = this->m_pStreamingChannel;
      v32 = v36;
      v33 = v26;
    }
    else
    {
      (*((void (__fastcall **)(CAEMP3Decoder *))v26->_vptr$CAEStreamingDecoder + 7))(v26);
      CAEStreamingChannel::SetNextStream(this->m_pStreamingChannel, 0);
      if ( !v8 )
      {
        v34 = 1;
LABEL_28:
        v6 = v35;
        this->m_bInvalidTrack = v34;
        if ( !v34 )
        {
LABEL_11:
          PlayingTrackID = CAEStreamingChannel::GetPlayingTrackID(this->m_pStreamingChannel);
          v12 = this->m_pStreamingChannel;
          this->m_playingTrackID = PlayingTrackID;
          v13 = (*((int (__fastcall **)(CAEStreamingChannel *))v12->_vptr$CAEAudioChannel + 4))(v12);
          v14 = this->m_pStreamingChannel;
          this->m_playTime = v13;
          ActiveTrackID = CAEStreamingChannel::GetActiveTrackID(v14);
          v16 = this->m_pStreamingChannel;
          this->m_activeTrackID = ActiveTrackID;
          this->m_trackLengthMs = (*((int (__fastcall **)(CAEStreamingChannel *))v16->_vptr$CAEAudioChannel + 5))(v16);
          return;
        }
        goto LABEL_29;
      }
      v31 = this->m_pStreamingChannel;
      v32 = v36;
      v33 = v8;
    }
    CAEStreamingChannel::PrepareStream(v31, v33, v32, 1);
    v34 = 0;
    goto LABEL_28;
  }
  if ( !this->m_bInvalidTrack )
  {
    v17 = CAEStreamingChannel::GetPlayingTrackID(this->m_pStreamingChannel);
    v18 = this->m_pStreamingChannel;
    this->m_playingTrackID = v17;
    v19 = (*((int (__fastcall **)(CAEStreamingChannel *))v18->_vptr$CAEAudioChannel + 4))(v18);
    v20 = this->m_pStreamingChannel;
    this->m_playTime = v19;
    v21 = CAEStreamingChannel::GetActiveTrackID(v20);
    v22 = this->m_pStreamingChannel;
    this->m_activeTrackID = v21;
    v23 = (*((int (__fastcall **)(CAEStreamingChannel *))v22->_vptr$CAEAudioChannel + 5))(v22);
    m_bUserTrack = this->m_bUserTrack;
    this->m_trackLengthMs = v23;
    if ( !m_bUserTrack )
    {
      m_playTime = this->m_playTime;
      if ( m_playTime > (*((int (__fastcall **)(CAEStreamingChannel *))this->m_pStreamingChannel->_vptr$CAEAudioChannel
                         + 5))(this->m_pStreamingChannel) )
      {
        if ( *((_BYTE *)&this->m_pStreamingChannel->_vptr$CAEAudioChannel + (unsigned int)&elf_hash_chain[20414]) )
          this->m_bShouldStop = 1;
      }
    }
  }
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003AA6E6) --------------------------------------------------------
void __fastcall CAEStreamThread::PlayTrack(
        CAEStreamThread *this,
        unsigned int TrackID,
        int NextTrackID,
        unsigned int StartOffsetMs,
        unsigned __int8 TrackFlags,
        bool bUserTrack,
        bool bUserNextTrack)
{
  OSMutex m_mutex; // r0

  if ( !IsRemovedTrack(TrackID) )
  {
    OS_MutexObtain(this->m_mutex);
    if ( (*((int (__fastcall **)(CAEStreamingChannel *))this->m_pStreamingChannel->_vptr$CAEAudioChannel + 4))(this->m_pStreamingChannel) == -2 )
      (*((void (__fastcall **)(CAEStreamingChannel *))this->m_pStreamingChannel->_vptr$CAEAudioChannel + 8))(this->m_pStreamingChannel);
    this->m_trackID = TrackID;
    this->m_startOffsetMs = StartOffsetMs;
    this->m_nextTrackID = NextTrackID;
    this->m_trackFlags = TrackFlags;
    this->m_bUserTrack = bUserTrack;
    this->m_bUserNextTrack = bUserNextTrack;
    m_mutex = this->m_mutex;
    this->m_bNeedService = 1;
    sub_18CEF0(m_mutex);
  }
}

//----- (003AA752) --------------------------------------------------------
bool __fastcall CAEStreamThread::IsUserTrack(CAEStreamThread *this)
{
  return this->m_bUserTrack;
}

//----- (003AA756) --------------------------------------------------------
int __fastcall CAEStreamThread::GetTrackPlayTime(CAEStreamThread *this)
{
  CAEStreamingChannel *m_pStreamingChannel; // r0

  if ( this->m_bInvalidTrack )
    return -8;
  m_pStreamingChannel = this->m_pStreamingChannel;
  if ( !m_pStreamingChannel )
    return -8;
  else
    return (*((int (__fastcall **)(CAEStreamingChannel *))m_pStreamingChannel->_vptr$CAEAudioChannel + 4))(m_pStreamingChannel);
}

//----- (003AA76C) --------------------------------------------------------
int __fastcall CAEStreamThread::GetTrackLengthMs(CAEStreamThread *this)
{
  return this->m_trackLengthMs;
}

//----- (003AA770) --------------------------------------------------------
int __fastcall CAEStreamThread::GetActiveTrackID(CAEStreamThread *this)
{
  return this->m_activeTrackID;
}

//----- (003AA774) --------------------------------------------------------
int __fastcall CAEStreamThread::GetPlayingTrackID(CAEStreamThread *this)
{
  return this->m_playingTrackID;
}

//----- (003AA778) --------------------------------------------------------
void __fastcall CAEStreamThread::StopTrack(CAEStreamThread *this)
{
  this->m_bShouldStop = 1;
}

//----- (003AA780) --------------------------------------------------------
void __fastcall CAEStreamTransformer::Initialise(CAEStreamTransformer *this)
{
  *(_QWORD *)this->key = 0xF314A89AA1C43AEALL;
  *(_QWORD *)&this->key[8] = 0xF1FFE89D23D7B048LL;
}

//----- (003AA7A0) --------------------------------------------------------
void __fastcall CAEStreamTransformer::TransformBuffer(
        CAEStreamTransformer *this,
        void *buffer,
        unsigned int bufferSize,
        unsigned int virtualOffset)
{
  unsigned int v4; // lr

  for ( ; bufferSize; buffer = (char *)buffer + 1 )
  {
    v4 = virtualOffset & 0xF;
    --bufferSize;
    ++virtualOffset;
    *(_BYTE *)buffer ^= this->key[v4];
  }
}

//----- (003AA7C8) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::CAETwinLoopSoundEntity(
        CAETwinLoopSoundEntity *this,
        Int16 BankSlotID,
        Int16 FirstSoundID,
        Int16 SecondSoundID,
        CAEAudioEntity *pAudioEntity,
        UInt16 MinSwapTime,
        UInt16 MaxSwapTime,
        Int16 StartPercentFirst,
        Int16 StartPercentSecond)
{
  this->m_BankSlotID = BankSlotID;
  this->m_FirstSoundID = FirstSoundID;
  this->m_SecondSoundID = SecondSoundID;
  this->m_pAudioEntity = pAudioEntity;
  this->m_MinSwapTime = MinSwapTime;
  this->m_MaxSwapTime = MaxSwapTime;
  this->m_pFirstSoundPtr = 0;
  this->m_pSecondSoundPtr = 0;
  this->m_StartPercentFirst = StartPercentFirst;
  this->m_StartPercentSecond = StartPercentSecond;
  *(_DWORD *)&this->m_bCurrentlyInUse = -65535;
  this->ScratchSound.m_pPhysicalEntity = 0;
  this->m_bPlayingFirst = 1;
  this->m_nSecondLength = -1;
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_6678F0;
}
// 6678F0: using guessed type void *off_6678F0;

//----- (003AA834) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::~CAETwinLoopSoundEntity(CAETwinLoopSoundEntity *this)
{
  int m_bCurrentlyInUse; // r1
  CAESound *m_pFirstSoundPtr; // r0
  CAESound *m_pSecondSoundPtr; // r0

  m_bCurrentlyInUse = this->m_bCurrentlyInUse;
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_6678F0;
  if ( m_bCurrentlyInUse )
  {
    m_pFirstSoundPtr = this->m_pFirstSoundPtr;
    if ( m_pFirstSoundPtr )
    {
      CAESound::StopSoundAndForget(m_pFirstSoundPtr);
      this->m_pFirstSoundPtr = 0;
    }
    m_pSecondSoundPtr = this->m_pSecondSoundPtr;
    if ( m_pSecondSoundPtr )
    {
      CAESound::StopSoundAndForget(m_pSecondSoundPtr);
      this->m_pSecondSoundPtr = 0;
    }
    this->m_bCurrentlyInUse = 0;
  }
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->ScratchSound);
}
// 667798: using guessed type void *off_667798;
// 6678F0: using guessed type void *off_6678F0;

//----- (003AA894) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::StopSoundAndForget(CAETwinLoopSoundEntity *this)
{
  CAESound *m_pFirstSoundPtr; // r0
  CAESound *m_pSecondSoundPtr; // r0

  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  if ( m_pFirstSoundPtr )
  {
    CAESound::StopSoundAndForget(m_pFirstSoundPtr);
    this->m_pFirstSoundPtr = 0;
  }
  m_pSecondSoundPtr = this->m_pSecondSoundPtr;
  if ( m_pSecondSoundPtr )
  {
    CAESound::StopSoundAndForget(m_pSecondSoundPtr);
    this->m_pSecondSoundPtr = 0;
  }
  this->m_bCurrentlyInUse = 0;
}

//----- (003AA8C2) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::Initialise(
        CAETwinLoopSoundEntity *this,
        Int16 BankSlotID,
        Int16 FirstSoundID,
        Int16 SecondSoundID,
        CAEAudioEntity *pAudioEntity,
        UInt16 MinSwapTime,
        UInt16 MaxSwapTime,
        Int16 StartPercentFirst,
        Int16 StartPercentSecond)
{
  this->m_FirstSoundID = FirstSoundID;
  this->m_BankSlotID = BankSlotID;
  this->m_SecondSoundID = SecondSoundID;
  this->m_pAudioEntity = pAudioEntity;
  this->m_MinSwapTime = MinSwapTime;
  this->m_MaxSwapTime = MaxSwapTime;
  this->m_bPlayingFirst = 1;
  this->m_nSecondLength = -1;
  this->m_pFirstSoundPtr = 0;
  this->m_pSecondSoundPtr = 0;
  this->m_StartPercentFirst = StartPercentFirst;
  this->m_StartPercentSecond = StartPercentSecond;
  *(_DWORD *)&this->m_bCurrentlyInUse = -65535;
}

//----- (003AA91C) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::UpdateParameters(
        CAETwinLoopSoundEntity *this,
        CAESound *pSound,
        Int16 PlayPosition)
{
  CAESound **p_m_pFirstSoundPtr; // r0
  CAESound *v5; // r3
  CAESound *m_pFirstSoundPtr; // t1
  uint32 v7; // r6
  CAESound *m_pSecondSoundPtr; // r3
  int m_bPlayingFirst; // r12
  CAESound *v10; // r5
  float m_EmittedVolume; // r5
  Bool8 v12; // r2
  Int32 m_MinSwapTime; // r0
  Int32 m_MaxSwapTime; // r1

  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  p_m_pFirstSoundPtr = &this->m_pFirstSoundPtr;
  v5 = m_pFirstSoundPtr;
  if ( PlayPosition != -1 )
  {
    if ( v5 != pSound )
      return;
    goto LABEL_3;
  }
  if ( v5 == pSound )
  {
    v5 = 0;
    *p_m_pFirstSoundPtr = 0;
  }
  if ( this->m_pSecondSoundPtr == pSound )
    this->m_pSecondSoundPtr = 0;
  if ( v5 == pSound )
  {
LABEL_3:
    if ( pSound )
    {
      v7 = CTimer::m_snTimeInMillisecondsPauseMode;
      if ( CTimer::m_snTimeInMillisecondsPauseMode > this->m_SwapTime )
      {
        m_pSecondSoundPtr = this->m_pSecondSoundPtr;
        if ( m_pSecondSoundPtr )
        {
          m_bPlayingFirst = this->m_bPlayingFirst;
          v10 = pSound;
          if ( !this->m_bPlayingFirst )
            v10 = this->m_pSecondSoundPtr;
          m_EmittedVolume = v10->m_EmittedVolume;
          if ( !this->m_bPlayingFirst )
            m_pSecondSoundPtr = pSound;
          m_pSecondSoundPtr->m_EmittedVolume = m_EmittedVolume;
          if ( !m_bPlayingFirst )
            p_m_pFirstSoundPtr = &this->m_pSecondSoundPtr;
          v12 = 0;
          (*p_m_pFirstSoundPtr)->m_EmittedVolume = -100.0;
          m_MinSwapTime = this->m_MinSwapTime;
          m_MaxSwapTime = this->m_MaxSwapTime;
          if ( !m_bPlayingFirst )
            v12 = 1;
          this->m_bPlayingFirst = v12;
          this->m_SwapTime = CAEAudioUtility::GetRandomNumberInRange(m_MinSwapTime, m_MaxSwapTime) + v7;
        }
      }
    }
  }
}

//----- (003AA9BC) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::SwapSounds(CAETwinLoopSoundEntity *this)
{
  CAESound **p_m_pSecondSoundPtr; // r2
  CAESound *m_pSecondSoundPtr; // r3
  CAESound **p_m_pFirstSoundPtr; // r0
  CAESound *v5; // r1
  CAESound *m_pFirstSoundPtr; // t1
  bool v7; // zf
  int m_bPlayingFirst; // r12
  CAESound *v9; // r5
  float m_EmittedVolume; // r5
  Bool8 v11; // r3
  Int32 m_MinSwapTime; // r0
  Int32 m_MaxSwapTime; // r1
  uint32 v14; // r5

  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  p_m_pFirstSoundPtr = &this->m_pFirstSoundPtr;
  v5 = m_pFirstSoundPtr;
  v7 = m_pFirstSoundPtr == 0;
  if ( m_pFirstSoundPtr )
  {
    p_m_pSecondSoundPtr = &this->m_pSecondSoundPtr;
    m_pSecondSoundPtr = this->m_pSecondSoundPtr;
    v7 = m_pSecondSoundPtr == 0;
  }
  if ( !v7 )
  {
    m_bPlayingFirst = this->m_bPlayingFirst;
    v9 = v5;
    if ( !this->m_bPlayingFirst )
      v9 = m_pSecondSoundPtr;
    m_EmittedVolume = v9->m_EmittedVolume;
    if ( !this->m_bPlayingFirst )
      m_pSecondSoundPtr = v5;
    m_pSecondSoundPtr->m_EmittedVolume = m_EmittedVolume;
    if ( !m_bPlayingFirst )
      p_m_pFirstSoundPtr = p_m_pSecondSoundPtr;
    v11 = 0;
    (*p_m_pFirstSoundPtr)->m_EmittedVolume = -100.0;
    m_MinSwapTime = this->m_MinSwapTime;
    m_MaxSwapTime = this->m_MaxSwapTime;
    if ( !m_bPlayingFirst )
      v11 = 1;
    this->m_bPlayingFirst = v11;
    v14 = CTimer::m_snTimeInMillisecondsPauseMode;
    this->m_SwapTime = CAEAudioUtility::GetRandomNumberInRange(m_MinSwapTime, m_MaxSwapTime) + v14;
  }
}
// 3AA9E4: variable 'm_pSecondSoundPtr' is possibly undefined
// 3AA9F2: variable 'p_m_pSecondSoundPtr' is possibly undefined

//----- (003AAA2C) --------------------------------------------------------
Bool8 __fastcall CAETwinLoopSoundEntity::DoSoundsSwitchThisFrame(CAETwinLoopSoundEntity *this)
{
  return CTimer::m_snTimeInMillisecondsPauseMode > this->m_SwapTime;
}

//----- (003AAA48) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::StopSound(CAETwinLoopSoundEntity *this)
{
  CAESound *m_pFirstSoundPtr; // r0
  CAESound *m_pSecondSoundPtr; // r0

  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  if ( m_pFirstSoundPtr )
    CAESound::StopSound(m_pFirstSoundPtr);
  m_pSecondSoundPtr = this->m_pSecondSoundPtr;
  if ( m_pSecondSoundPtr )
    sub_18EA18(m_pSecondSoundPtr);
}

//----- (003AAA6C) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::PlayTwinLoopSound(
        CAETwinLoopSoundEntity *this,
        CVector Position,
        float Volume,
        float RelativeFrequency,
        float RollOffFactor,
        float Doppler,
        UInt16 Environment)
{
  CAESound *m_pFirstSoundPtr; // r0
  RwReal y; // r9
  unsigned __int64 v10; // r10
  CAESound *m_pSecondSoundPtr; // r0
  int m_StartPercentFirst; // r6
  CAESound *v13; // r0
  int m_StartPercentSecond; // r6
  CAESound *v15; // r0
  Int32 m_MinSwapTime; // r2
  Int32 m_MaxSwapTime; // r1
  uint32 v18; // r6
  CVector Positiona; // [sp+0h] [bp-E8h]
  CVector Positionb; // [sp+0h] [bp-E8h]
  CVector v21; // [sp+30h] [bp-B8h] BYREF
  int v22; // [sp+3Ch] [bp-ACh]
  __int16 v23; // [sp+90h] [bp-58h]

  v22 = 0;
  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  y = Position.y;
  v10 = __PAIR64__(LODWORD(Position.z), LODWORD(Position.x));
  if ( m_pFirstSoundPtr )
    CAESound::StopSoundAndForget(m_pFirstSoundPtr);
  m_pSecondSoundPtr = this->m_pSecondSoundPtr;
  if ( m_pSecondSoundPtr )
    CAESound::StopSoundAndForget(m_pSecondSoundPtr);
  m_StartPercentFirst = (unsigned __int16)this->m_StartPercentFirst;
  if ( m_StartPercentFirst == 0xFFFF )
    LOWORD(m_StartPercentFirst) = CAEAudioUtility::GetRandomNumberInRange(0, 99);
  LODWORD(Positiona.x) = v10;
  LODWORD(v21.x) = v10;
  *(RwReal *)&v10 = y;
  *(_QWORD *)&Positiona.y = __PAIR64__(HIDWORD(v10), LODWORD(y));
  CAESound::Initialise(
    (CAESound *)&v21.y,
    this->m_BankSlotID,
    this->m_FirstSoundID,
    this,
    Positiona,
    Volume,
    RollOffFactor,
    RelativeFrequency,
    Doppler,
    0,
    Environment | 0x24,
    0.0,
    0);
  v23 = m_StartPercentFirst;
  v13 = CAESoundManager::RequestNewSound(&AESoundManager, (CAESound *)&v21.y);
  m_StartPercentSecond = (unsigned __int16)this->m_StartPercentSecond;
  this->m_pFirstSoundPtr = v13;
  if ( m_StartPercentSecond == 0xFFFF )
    LOWORD(m_StartPercentSecond) = CAEAudioUtility::GetRandomNumberInRange(0, 99);
  Positionb.x = v21.x;
  *(_QWORD *)&Positionb.y = v10;
  CAESound::Initialise(
    (CAESound *)&v21.y,
    this->m_BankSlotID,
    this->m_SecondSoundID,
    this,
    Positionb,
    -100.0,
    RollOffFactor,
    RelativeFrequency,
    Doppler,
    0,
    Environment | 0x24,
    0.0,
    0);
  v23 = m_StartPercentSecond;
  v15 = CAESoundManager::RequestNewSound(&AESoundManager, (CAESound *)&v21.y);
  m_MinSwapTime = this->m_MinSwapTime;
  m_MaxSwapTime = this->m_MaxSwapTime;
  this->m_pSecondSoundPtr = v15;
  v18 = CTimer::m_snTimeInMillisecondsPauseMode;
  this->m_SwapTime = CAEAudioUtility::GetRandomNumberInRange(m_MinSwapTime, m_MaxSwapTime) + v18;
  this->m_bPlayingFirst = 1;
  CAESound::~CAESound((CAESound *)&v21.y);
}

//----- (003AABC8) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::UpdateTwinLoopSound(
        CAETwinLoopSoundEntity *this,
        CVector Position,
        float Volume,
        float RelativeFrequency)
{
  CAESound *m_pFirstSoundPtr; // r0
  RwReal z; // r8
  RwReal y; // r6
  RwReal x; // r5
  CAESound *m_pSecondSoundPtr; // r0
  CVector v10; // 0:r1.12

  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  z = Position.z;
  y = Position.y;
  x = Position.x;
  if ( m_pFirstSoundPtr )
  {
    CAESound::SetPosition(m_pFirstSoundPtr, Position);
    if ( this->m_bPlayingFirst )
      this->m_pFirstSoundPtr->m_EmittedVolume = Volume;
    this->m_pFirstSoundPtr->m_RelativeFrequency = RelativeFrequency;
  }
  m_pSecondSoundPtr = this->m_pSecondSoundPtr;
  if ( m_pSecondSoundPtr )
  {
    v10.x = x;
    *(_QWORD *)&v10.y = __PAIR64__(LODWORD(z), LODWORD(y));
    CAESound::SetPosition(m_pSecondSoundPtr, v10);
    if ( !this->m_bPlayingFirst )
      this->m_pSecondSoundPtr->m_EmittedVolume = Volume;
    this->m_pSecondSoundPtr->m_RelativeFrequency = RelativeFrequency;
  }
}

//----- (003AAC3E) --------------------------------------------------------
void __fastcall CAETwinLoopSoundEntity::SetEmittedVolume(CAETwinLoopSoundEntity *this, float ev)
{
  CAESound *m_pFirstSoundPtr; // r2
  CAESound *m_pSecondSoundPtr; // r1

  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  if ( m_pFirstSoundPtr && this->m_bPlayingFirst )
    m_pFirstSoundPtr->m_EmittedVolume = ev;
  m_pSecondSoundPtr = this->m_pSecondSoundPtr;
  if ( m_pSecondSoundPtr )
  {
    if ( !this->m_bPlayingFirst )
      m_pSecondSoundPtr->m_EmittedVolume = ev;
  }
}

//----- (003AAC6C) --------------------------------------------------------
float __fastcall CAETwinLoopSoundEntity::GetEmittedVolume(CAETwinLoopSoundEntity *this)
{
  CAESound *m_pFirstSoundPtr; // r1
  bool v2; // zf
  CAESound *m_pSecondSoundPtr; // r1
  int m_EmittedVolume_low; // s0

  m_pFirstSoundPtr = this->m_pFirstSoundPtr;
  v2 = m_pFirstSoundPtr == 0;
  if ( m_pFirstSoundPtr )
    v2 = this->m_bPlayingFirst == 0;
  if ( !v2 )
    return m_pFirstSoundPtr->m_EmittedVolume;
  m_pSecondSoundPtr = this->m_pSecondSoundPtr;
  m_EmittedVolume_low = -1027080192;
  if ( m_pSecondSoundPtr )
  {
    if ( !this->m_bPlayingFirst )
      m_EmittedVolume_low = LODWORD(m_pSecondSoundPtr->m_EmittedVolume);
  }
  return *(float *)&m_EmittedVolume_low;
}

//----- (003AACA8) --------------------------------------------------------
Bool8 __fastcall CAETwinLoopSoundEntity::IsTwinLoopPlaying(CAETwinLoopSoundEntity *this)
{
  return this->m_pFirstSoundPtr || this->m_pSecondSoundPtr != 0;
}

//----- (003AACC0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::CAEVehicleAudioEntity(CAEVehicleAudioEntity *this)
{
  this->ScratchSound.m_pPhysicalEntity = 0;
  this->m_SkidSound.ScratchSound.m_pPhysicalEntity = 0;
  this->m_SkidSound.m_pFirstSoundPtr = 0;
  this->m_SkidSound.m_pSecondSoundPtr = 0;
  this->m_SkidSound.m_bCurrentlyInUse = 0;
  this->m_pGameEntity = 0;
  this->m_bInitialised = 0;
  this->_vptr$CAEAudioEntity = (int (**)(void))&off_6678FC;
  this->m_SkidSound._vptr$CAEAudioEntity = (int (**)(void))&off_6678F0;
}
// 6678F0: using guessed type void *off_6678F0;
// 6678FC: using guessed type void *;

//----- (003AACF8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::AddAudioEvent(
        CAEVehicleAudioEntity *this,
        tAudioEvent AudioEvent,
        float fParam1)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d9
  Int16 v9; // r2
  Int16 v10; // r2
  CEntity *m_pGameEntity; // r1
  CMatrix *m_pMat; // r3
  CVector *p_tx; // r6
  CEntity *v14; // r1
  CMatrix *v15; // r3
  CVector *p_m_translate; // r6
  CEntity *v17; // r1
  CMatrix *v18; // r2
  CVector *v19; // r3
  CEntity *v20; // r1
  CMatrix *v21; // r2
  CVector *v22; // r3
  CEntity *v23; // r1
  CMatrix *v24; // r2
  CVector *v25; // r3
  float v26; // s16
  float v27; // s0
  float v28; // r0
  CEntity *v29; // r1
  float v30; // s2
  CMatrix *v31; // r0
  CVector *v32; // r2
  float v33; // s16
  int m_DummySlot; // r2
  Int16 RandomNumberInRange; // r0
  CEntity *v36; // r2
  CMatrix *v37; // r3
  CVector *v38; // r6
  char v39; // r5
  CEntity *v40; // r0
  CMatrix *v41; // r1
  CVector *v42; // r2
  CEntity *v43; // r1
  CMatrix *v44; // r2
  CVector *v45; // r3
  tAudioEvent v46; // r1
  tAudioEvent v47; // r6
  char v48; // r5
  CEntity *v49; // r0
  float v50; // s2
  CMatrix *v51; // r1
  CVector *v52; // r2
  char v53; // r5
  CEntity *v54; // r0
  CMatrix *v55; // r1
  CVector *v56; // r2
  tAudioEvent v57; // r8
  char v58; // r5
  CEntity *v59; // r0
  int v60; // s0
  CMatrix *v61; // r1
  CVector *v62; // r2
  char v63; // r5
  CEntity *v64; // r0
  CMatrix *v65; // r1
  char v66; // r5
  CEntity *v67; // r0
  CMatrix *v68; // r1
  float v69; // s16
  CEntity *v70; // r0
  CMatrix *v71; // r1
  CVector *v72; // r2
  float v73; // s16
  CEntity *v74; // r0
  CMatrix *v75; // r1
  CVector *v76; // r2
  float v77; // s16
  CEntity *v78; // r0
  CMatrix *v79; // r1
  CVector *v80; // r2
  float v81; // s16
  int VehicleAudioType; // r0
  float v83; // s0
  float v84; // s16
  int v85; // r0
  float v86; // s0
  float v87; // s16
  int v88; // r0
  float v89; // s0
  float v90; // s16
  int v91; // r0
  float v92; // s0
  int v93; // r6
  CEntity *v94; // r0
  CMatrix *v95; // r1
  CVector *v96; // r2
  int *v97; // r0
  float v98; // s0
  Int16 v99; // r0
  CEntity *v100; // r1
  CMatrix *v101; // r2
  CVector *v102; // r3
  CEntity *v103; // r0
  CMatrix *v104; // r1
  CVector *v105; // r2
  tAudioEvent v106; // r11
  Int16 v107; // r0
  CEntity *v108; // r1
  CMatrix *v109; // r2
  CVector *v110; // r3
  Int16 v111; // r0
  CEntity *v112; // r0
  CMatrix *v113; // r1
  CVector *v114; // r2
  Int16 v115; // r0
  CEntity *v116; // r1
  CMatrix *v117; // r2
  CVector *v118; // r3
  CAESound v119; // [sp+2Ch] [bp-A4h] BYREF

  v119.m_pPhysicalEntity = 0;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19)
    && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2)
    && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x1Bu, 3) )
  {
    switch ( AudioEvent )
    {
      case 'N':
      case 'O':
      case 'P':
      case 'Q':
      case 'R':
      case 'S':
        v9 = 42;
        switch ( this->m_VehicleAudioSetting.DoorType )
        {
          case 0:
            v9 = 39;
            break;
          case 1:
            v9 = 41;
            break;
          case 3:
            v9 = 43;
            break;
          case 4:
            break;
          default:
            v9 = 40;
            break;
        }
        m_pGameEntity = this->m_pGameEntity;
        m_pMat = m_pGameEntity->m_pMat;
        p_tx = (CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pGameEntity->m_transform.m_translate;
        CAESound::Initialise(
          &v119,
          19,
          v9,
          this,
          *p_tx,
          (float)CAEAudioEntity::m_pAudioEventVolumes[78],
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
        goto LABEL_21;
      case 'T':
      case 'U':
      case 'V':
      case 'W':
      case 'X':
      case 'Y':
        v10 = 35;
        switch ( this->m_VehicleAudioSetting.DoorType )
        {
          case 0:
            v10 = 32;
            break;
          case 1:
            v10 = 34;
            break;
          case 3:
            v10 = 36;
            break;
          case 4:
            break;
          default:
            v10 = 33;
            break;
        }
        v14 = this->m_pGameEntity;
        v15 = v14->m_pMat;
        p_m_translate = (CVector *)&v15->tx;
        if ( !v15 )
          p_m_translate = &v14->m_transform.m_translate;
        CAESound::Initialise(
          &v119,
          19,
          v10,
          this,
          *p_m_translate,
          (float)CAEAudioEntity::m_pAudioEventVolumes[84],
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
LABEL_21:
        v119.m_FrequencyVariance = 0.02;
        goto LABEL_22;
      case 'Z':
        v17 = this->m_pGameEntity;
        v18 = v17->m_pMat;
        v19 = (CVector *)&v18->tx;
        if ( !v18 )
          v19 = &v17->m_transform.m_translate;
        CAESound::Initialise(
          &v119,
          3,
          0,
          this,
          *v19,
          (float)CAEAudioEntity::m_pAudioEventVolumes[90],
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
        goto LABEL_22;
      case '[':
        v20 = this->m_pGameEntity;
        v21 = v20->m_pMat;
        v22 = (CVector *)&v21->tx;
        if ( !v21 )
          v22 = &v20->m_transform.m_translate;
        CAESound::Initialise(
          &v119,
          2,
          68,
          this,
          *v22,
          (float)CAEAudioEntity::m_pAudioEventVolumes[91],
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
        goto LABEL_22;
      case '\\':
        v23 = this->m_pGameEntity;
        v24 = v23->m_pMat;
        v25 = (CVector *)&v24->tx;
        if ( !v24 )
          v25 = &v23->m_transform.m_translate;
        CAESound::Initialise(
          &v119,
          2,
          53,
          this,
          *v25,
          (float)CAEAudioEntity::m_pAudioEventVolumes[92],
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
        goto LABEL_22;
      case 'c':
        v26 = (float)CAEAudioEntity::m_pAudioEventVolumes[99];
        if ( fParam1 >= 450.0 && CTimer::m_snTimeInMilliseconds >= this->m_TimeSplashLastTriggered + 1500 )
        {
          v5.n64_u32[0] = 0;
          v3.n64_f32[0] = fParam1 / 800.0;
          v4.n64_u32[0] = 1.0;
          v27 = vmax_f32(vmin_f32(v3, v4), v5).n64_f32[0];
          if ( v27 > 0.00001 && CWeather::UnderWaterness < 0.5 )
          {
            v28 = CAEAudioUtility::AudioLog10(v27);
            v29 = this->m_pGameEntity;
            v30 = v28;
            v31 = v29->m_pMat;
            v32 = (CVector *)&v31->tx;
            if ( !v31 )
              v32 = &v29->m_transform.m_translate;
            CAESound::Initialise(
              &v119,
              2,
              66,
              this,
              *v32,
              (float)((float)(v30 * 20.0) + v26) + 0.0,
              1.0,
              1.0,
              1.0,
              0,
              0,
              0.0,
              0);
            CAESoundManager::RequestNewSound(&AESoundManager, &v119);
            this->m_TimeSplashLastTriggered = CTimer::m_snTimeInMilliseconds;
          }
        }
        break;
      case 'd':
        v33 = (float)CAEAudioEntity::m_pAudioEventVolumes[100];
        m_DummySlot = (unsigned __int16)this->m_DummySlot;
        if ( m_DummySlot == 0xFFFF
          || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
        {
          break;
        }
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(3, 5);
        v36 = this->m_pGameEntity;
        v37 = v36->m_pMat;
        v38 = (CVector *)&v37->tx;
        if ( !v37 )
          v38 = &v36->m_transform.m_translate;
        CAESound::Initialise(
          &v119,
          this->m_DummySlot,
          RandomNumberInRange,
          this,
          *v38,
          v33,
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
        v119.m_RelativeFrequency = 1.0;
        v119.m_FrequencyVariance = 0.1;
        v119.m_RollOffFactor = 2.0;
        goto LABEL_22;
      case 'f':
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
          break;
        v39 = CAEAudioEntity::m_pAudioEventVolumes[102];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 102, this) )
          break;
        v40 = this->m_pGameEntity;
        v41 = v40->m_pMat;
        v42 = (CVector *)&v41->tx;
        if ( !v41 )
          v42 = &v40->m_transform.m_translate;
        CAESound::Initialise(&v119, 5, 83, this, *v42, (float)v39, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v119.m_FrequencyVariance = 0.03;
        v119.m_RelativeFrequency = 0.89;
        v119.m_RollOffFactor = 2.0;
        v119.m_Environment = 128;
        CAESound::RegisterWithPhysicalEntity(&v119, this->m_pGameEntity);
        v119.m_AudioEvent = 102;
        goto LABEL_22;
      case 'g':
        v43 = this->m_pGameEntity;
        v44 = v43->m_pMat;
        v45 = (CVector *)&v44->tx;
        if ( !v44 )
          v45 = &v43->m_transform.m_translate;
        CAESound::Initialise(
          &v119,
          19,
          37,
          this,
          *v45,
          (float)CAEAudioEntity::m_pAudioEventVolumes[103],
          1.0,
          1.0,
          1.0,
          0,
          0,
          0.0,
          0);
        v119.m_RollOffFactor = 2.0;
        v119.m_FrequencyVariance = 0.05;
        v46 = 103;
        goto LABEL_53;
      case 'k':
        v47 = 107;
        v48 = CAEAudioEntity::m_pAudioEventVolumes[107];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 107, this) )
          break;
        v49 = this->m_pGameEntity;
        v50 = (float)v48;
        v51 = v49->m_pMat;
        v52 = (CVector *)&v51->tx;
        if ( !v51 )
          v52 = &v49->m_transform.m_translate;
        goto LABEL_73;
      case 'l':
        v47 = 108;
        v53 = CAEAudioEntity::m_pAudioEventVolumes[108];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 108, this) )
          break;
        v54 = this->m_pGameEntity;
        v55 = v54->m_pMat;
        v56 = (CVector *)&v55->tx;
        if ( !v55 )
          v56 = &v54->m_transform.m_translate;
        CAESound::Initialise(&v119, 19, 31, this, *v56, (float)v53 + -3.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        goto LABEL_74;
      case 'm':
        v57 = 109;
        v58 = CAEAudioEntity::m_pAudioEventVolumes[109];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 109, this) )
          break;
        v59 = this->m_pGameEntity;
        v60 = v58;
        v61 = v59->m_pMat;
        v62 = (CVector *)&v61->tx;
        if ( !v61 )
          v62 = &v59->m_transform.m_translate;
        goto LABEL_69;
      case 'n':
        v57 = 110;
        v63 = CAEAudioEntity::m_pAudioEventVolumes[110];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 110, this) )
          break;
        v64 = this->m_pGameEntity;
        v60 = v63;
        v65 = v64->m_pMat;
        v62 = (CVector *)&v65->tx;
        if ( !v65 )
          v62 = &v64->m_transform.m_translate;
LABEL_69:
        CAESound::Initialise(&v119, 19, 44, this, *v62, (float)v60, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v119.m_nPlayTime = 0;
        v119.m_Environment = 32;
        v119.m_FrequencyVariance = 0.05;
        v119.m_RollOffFactor = 2.0;
        v119.m_AudioEvent = v57;
        goto LABEL_22;
      case 'o':
        v47 = 111;
        v66 = CAEAudioEntity::m_pAudioEventVolumes[111];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 111, this) )
          break;
        v67 = this->m_pGameEntity;
        v50 = (float)v66;
        v68 = v67->m_pMat;
        v52 = (CVector *)&v68->tx;
        if ( !v68 )
          v52 = &v67->m_transform.m_translate;
LABEL_73:
        CAESound::Initialise(&v119, 19, 38, this, *v52, v50 + -6.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
LABEL_74:
        v119.m_RollOffFactor = 2.0;
        v119.m_FrequencyVariance = 0.05;
        v119.m_AudioEvent = v47;
        goto LABEL_22;
      case 'q':
        v69 = (float)CAEAudioEntity::m_pAudioEventVolumes[113];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 113, this)
          || CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 114, this)
          || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
        {
          break;
        }
        v70 = this->m_pGameEntity;
        v71 = v70->m_pMat;
        v72 = (CVector *)&v71->tx;
        if ( !v71 )
          v72 = &v70->m_transform.m_translate;
        CAESound::Initialise(&v119, 5, 70, this, *v72, v69, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v119.m_FrequencyVariance = 0.05;
        v119.m_RelativeFrequency = 0.56;
        v119.m_RollOffFactor = 2.0;
        v119.m_Environment = 128;
        CAESound::RegisterWithPhysicalEntity(&v119, this->m_pGameEntity);
        v46 = 113;
        goto LABEL_53;
      case 'r':
        v73 = (float)CAEAudioEntity::m_pAudioEventVolumes[114];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 113, this)
          || CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 114, this)
          || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
        {
          break;
        }
        v74 = this->m_pGameEntity;
        v75 = v74->m_pMat;
        v76 = (CVector *)&v75->tx;
        if ( !v75 )
          v76 = &v74->m_transform.m_translate;
        CAESound::Initialise(&v119, 5, 70, this, *v76, v73, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v119.m_FrequencyVariance = 0.05;
        v119.m_RelativeFrequency = 0.5;
        v119.m_RollOffFactor = 2.0;
        v119.m_Environment = 128;
        CAESound::RegisterWithPhysicalEntity(&v119, this->m_pGameEntity);
        v46 = 114;
        goto LABEL_53;
      case 's':
        v77 = (float)CAEAudioEntity::m_pAudioEventVolumes[115];
        if ( CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 115, this)
          || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x45u, 40) )
        {
          break;
        }
        v78 = this->m_pGameEntity;
        v79 = v78->m_pMat;
        v80 = (CVector *)&v79->tx;
        if ( !v79 )
          v80 = &v78->m_transform.m_translate;
        CAESound::Initialise(&v119, 40, 4, this, *v80, v77, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v119.m_RollOffFactor = 2.0;
        v119.m_FrequencyVariance = 0.05;
        v119.m_Environment = 128;
        CAESound::RegisterWithPhysicalEntity(&v119, this->m_pGameEntity);
        v46 = 115;
LABEL_53:
        v119.m_AudioEvent = v46;
        goto LABEL_22;
      case 'w':
        v81 = (float)CAEAudioEntity::m_pAudioEventVolumes[119];
        VehicleAudioType = this->m_VehicleAudioSetting.VehicleAudioType;
        if ( VehicleAudioType == 2 )
        {
          v83 = -6.0;
        }
        else
        {
          if ( VehicleAudioType != 1 )
            goto LABEL_106;
          v83 = -3.0;
        }
        v81 = v81 + v83;
LABEL_106:
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
          break;
        v93 = CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 119, this);
        v94 = this->m_pGameEntity;
        v95 = v94->m_pMat;
        v96 = (CVector *)&v95->tx;
        if ( !v95 )
          v96 = &v94->m_transform.m_translate;
        CAESound::Initialise(&v119, 2, 29, this, *v96, v81, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v97 = dword_3ABC00;
        if ( !v93 )
          v97 = &dword_3ABC00[1];
        v98 = *(float *)v97;
        v119.m_FrequencyVariance = 0.06;
        v119.m_RelativeFrequency = v98;
        v119.m_RollOffFactor = 1.5;
        v119.m_Environment = 32;
        if ( v93 )
          LOWORD(v93) = 40;
        v119.m_nPlayTime = v93;
        v119.m_AudioEvent = 119;
        goto LABEL_22;
      case 'x':
        v84 = (float)CAEAudioEntity::m_pAudioEventVolumes[120];
        v85 = this->m_VehicleAudioSetting.VehicleAudioType;
        if ( v85 == 2 )
        {
          v86 = -6.0;
        }
        else
        {
          if ( v85 != 1 )
            goto LABEL_116;
          v86 = -3.0;
        }
        v84 = v84 + v86;
LABEL_116:
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
          break;
        v99 = CAEAudioUtility::GetRandomNumberInRange(47, 49);
        v100 = this->m_pGameEntity;
        v101 = v100->m_pMat;
        v102 = (CVector *)&v101->tx;
        if ( !v101 )
          v102 = &v100->m_transform.m_translate;
        CAESound::Initialise(&v119, 2, v99, this, *v102, v84, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v119.m_RelativeFrequency = 1.0;
        v119.m_FrequencyVariance = 0.06;
        v119.m_RollOffFactor = 1.5;
        v119.m_Environment = 32;
        v119.m_nPlayTime = 0;
        v119.m_AudioEvent = 121;
        goto LABEL_22;
      case 'y':
        v87 = (float)CAEAudioEntity::m_pAudioEventVolumes[121];
        v88 = this->m_VehicleAudioSetting.VehicleAudioType;
        if ( v88 == 2 )
        {
          v89 = -6.0;
        }
        else
        {
          if ( v88 != 1 )
            goto LABEL_122;
          v89 = -3.0;
        }
        v87 = v87 + v89;
LABEL_122:
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
          break;
        v103 = this->m_pGameEntity;
        v104 = v103->m_pMat;
        v105 = (CVector *)&v104->tx;
        if ( !v104 )
          v105 = &v103->m_transform.m_translate;
        CAESound::Initialise(&v119, 2, 33, this, *v105, v87 + -2.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v106 = 121;
        v119.m_RelativeFrequency = 1.0;
        v119.m_FrequencyVariance = 0.06;
        v119.m_RollOffFactor = 1.5;
        v119.m_Environment = 32;
        v119.m_nPlayTime = 0;
        v119.m_AudioEvent = 121;
        CAESoundManager::RequestNewSound(&AESoundManager, &v119);
        v107 = CAEAudioUtility::GetRandomNumberInRange(20, 28);
        v108 = this->m_pGameEntity;
        v109 = v108->m_pMat;
        v110 = (CVector *)&v109->tx;
        if ( !v109 )
          v110 = &v108->m_transform.m_translate;
        CAESound::Initialise(&v119, 2, v107, this, *v110, v87, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v119.m_RelativeFrequency = 1.0;
        v119.m_FrequencyVariance = 0.06;
        v119.m_RollOffFactor = 1.5;
        v111 = 55;
        goto LABEL_136;
      case 'z':
        v90 = (float)CAEAudioEntity::m_pAudioEventVolumes[122];
        v91 = this->m_VehicleAudioSetting.VehicleAudioType;
        if ( v91 == 2 )
        {
          v92 = -6.0;
        }
        else
        {
          if ( v91 != 1 )
            goto LABEL_130;
          v92 = -3.0;
        }
        v90 = v90 + v92;
LABEL_130:
        if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
        {
          v112 = this->m_pGameEntity;
          v113 = v112->m_pMat;
          v114 = (CVector *)&v113->tx;
          if ( !v113 )
            v114 = &v112->m_transform.m_translate;
          CAESound::Initialise(&v119, 2, 31, this, *v114, v90 + -2.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v106 = 122;
          v119.m_RelativeFrequency = 1.0;
          v119.m_FrequencyVariance = 0.06;
          v119.m_RollOffFactor = 1.5;
          v119.m_Environment = 32;
          v119.m_nPlayTime = 0;
          v119.m_AudioEvent = 122;
          CAESoundManager::RequestNewSound(&AESoundManager, &v119);
          v115 = CAEAudioUtility::GetRandomNumberInRange(20, 28);
          v116 = this->m_pGameEntity;
          v117 = v116->m_pMat;
          v118 = (CVector *)&v117->tx;
          if ( !v117 )
            v118 = &v116->m_transform.m_translate;
          CAESound::Initialise(&v119, 2, v115, this, *v118, v90, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
          v119.m_RelativeFrequency = 1.0;
          v119.m_FrequencyVariance = 0.06;
          v119.m_RollOffFactor = 1.5;
          v111 = 25;
LABEL_136:
          v119.m_Environment = 32;
          v119.m_nPlayTime = v111;
          v119.m_AudioEvent = v106;
LABEL_22:
          CAESoundManager::RequestNewSound(&AESoundManager, &v119);
        }
        break;
      default:
        break;
    }
  }
  CAESound::~CAESound(&v119);
}
// 3AB046: variable 'v3' is possibly undefined
// 3AB046: variable 'v4' is possibly undefined
// 3AB04A: variable 'v5' is possibly undefined
// 3ABC00: using guessed type int dword_3ABC00[2];

//----- (003ABC64) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::AddAudioEvent(
        CAEVehicleAudioEntity *this,
        tAudioEvent AudioEvent,
        CEntity *pEntity)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  int IsSoundBankLoaded; // r0
  float v9; // s0
  float v10; // s16
  float v11; // s0
  float v12; // s0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    IsSoundBankLoaded = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2);
    if ( pEntity )
    {
      if ( AudioEvent == 93 && IsSoundBankLoaded )
      {
        v4.n64_u32[0] = 0.5625;
        v3.n64_f32[0] = (float)((float)(*(float *)&pEntity[1].m_pRwObject * *(float *)&pEntity[1].m_pRwObject)
                              + (float)(*(float *)&pEntity[1].m_nFlags * *(float *)&pEntity[1].m_nFlags))
                      + (float)(*(float *)&pEntity[1].m_nFlags.bdummy * *(float *)&pEntity[1].m_nFlags.bdummy);
        v9 = vmin_f32(v3, v4).n64_f32[0] / 0.5625;
        v10 = (float)CAEAudioEntity::m_pAudioEventVolumes[93];
        if ( v9 >= 1.0e-10 )
          v11 = CAEAudioUtility::AudioLog10(v9) * 10.0;
        else
          v11 = -100.0;
        v12 = v11 + v10;
        m_pMat = pEntity->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pEntity->m_transform;
        CAESound::Initialise(&this->ScratchSound, 19, 12, this, p_tx->m_translate, v12, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        this->ScratchSound.m_Environment = 132;
        this->ScratchSound.m_RollOffFactor = 0.85;
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pEntity);
        this->ScratchSound.m_AudioEvent = 93;
        sub_19F790(&AESoundManager, &this->ScratchSound);
      }
    }
  }
}
// 3ABCCE: variable 'v3' is possibly undefined
// 3ABCCE: variable 'v4' is possibly undefined

//----- (003ABDA4) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetFlyingMetalVolume(CAEVehicleAudioEntity *this, CPhysical *pPhysical)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float v4; // s0

  v3.n64_u32[0] = 0.5625;
  v2.n64_f32[0] = (float)((float)(pPhysical->m_vecTurnSpeed.x * pPhysical->m_vecTurnSpeed.x)
                        + (float)(pPhysical->m_vecTurnSpeed.y * pPhysical->m_vecTurnSpeed.y))
                + (float)(pPhysical->m_vecTurnSpeed.z * pPhysical->m_vecTurnSpeed.z);
  v4 = vmin_f32(v2, v3).n64_f32[0] / 0.5625;
  if ( v4 >= 1.0e-10 )
    return CAEAudioUtility::AudioLog10(v4) * 10.0;
  else
    return -100.0;
}
// 3ABDC8: variable 'v2' is possibly undefined
// 3ABDC8: variable 'v3' is possibly undefined

//----- (003ABE14) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::UpdateParameters(CAEVehicleAudioEntity *this, CAESound *pSound, Int16 PlayTime)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  tAudioEvent m_AudioEvent; // r1
  float *m_pPhysicalEntity; // r0
  float v10; // s0
  float v11; // s16
  float v12; // s0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3
  CAESound **p_m_SurfaceSoundPtr; // r0
  CAESound *SoundPtr; // r1
  bool v18; // zf
  int VehicleAudioType; // r1
  CEntity *v20; // r0
  CMatrix *v21; // r1
  CVector *p_m_translate; // r3
  CEntity *v23; // r0
  CMatrix *v24; // r1
  CSimpleTransform *p_m_transform; // r2
  __int64 v26; // d16
  CVector v27; // [sp+0h] [bp-28h] BYREF
  CVector v28; // 0:r1.12

  if ( !pSound )
    return;
  m_AudioEvent = pSound->m_AudioEvent;
  if ( m_AudioEvent == 99 )
  {
    if ( (unsigned __int16)PlayTime == 0xFFFF )
      return;
    m_pGameEntity = this->m_pGameEntity;
    m_pMat = m_pGameEntity->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pGameEntity->m_transform.m_translate;
    CAESound::SetPosition(pSound, *p_tx);
    if ( CWeather::UnderWaterness >= 0.5 )
      CAESound::StopSound(pSound);
LABEL_36:
    VehicleAudioType = (unsigned __int8)this->m_VehicleAudioSetting.VehicleAudioType;
    if ( (unsigned __int8)(VehicleAudioType - 4) <= 2u && this->m_EngineSounds[3].SoundPtr == pSound )
    {
      v23 = this->m_pGameEntity;
      if ( VehicleAudioType == 4 )
      {
        (*((void (__fastcall **)(CEntity *, int, CVector *))v23->_vptr$CPlaceable + 26))(v23, 14, &v27);
      }
      else
      {
        v24 = v23->m_pMat;
        p_m_transform = (CSimpleTransform *)&v24->tx;
        if ( !v24 )
          p_m_transform = &v23->m_transform;
        v26 = *(_QWORD *)&p_m_transform->m_translate.x;
        v27.z = p_m_transform->m_translate.z;
        *(_QWORD *)&v27.x = v26;
      }
      v28 = v27;
    }
    else
    {
      v20 = this->m_pGameEntity;
      v21 = v20->m_pMat;
      p_m_translate = (CVector *)&v21->tx;
      if ( !v21 )
        p_m_translate = &v20->m_transform.m_translate;
      v28 = *p_m_translate;
    }
    CAESound::SetPosition(pSound, v28);
    goto LABEL_58;
  }
  if ( m_AudioEvent == 93 )
  {
    m_pPhysicalEntity = (float *)pSound->m_pPhysicalEntity;
    if ( m_pPhysicalEntity )
    {
      v4.n64_u32[0] = 0.5625;
      v3.n64_f32[0] = (float)((float)(m_pPhysicalEntity[21] * m_pPhysicalEntity[21])
                            + (float)(m_pPhysicalEntity[22] * m_pPhysicalEntity[22]))
                    + (float)(m_pPhysicalEntity[23] * m_pPhysicalEntity[23]);
      v10 = vmin_f32(v3, v4).n64_f32[0] / 0.5625;
      v11 = (float)CAEAudioEntity::m_pAudioEventVolumes[93];
      if ( v10 >= 1.0e-10 )
        v12 = CAEAudioUtility::AudioLog10(v10) * 10.0;
      else
        v12 = -100.0;
      pSound->m_EmittedVolume = v12 + v11;
    }
    return;
  }
  if ( (unsigned __int16)PlayTime != 0xFFFF )
    goto LABEL_36;
  if ( this->m_SurfaceSoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_SurfaceSoundPtr;
    goto LABEL_57;
  }
  if ( this->m_RoadNoiseSoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_RoadNoiseSoundPtr;
    goto LABEL_57;
  }
  if ( this->m_FlatTyreSoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_FlatTyreSoundPtr;
    goto LABEL_57;
  }
  if ( this->m_ReverseSoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_ReverseSoundPtr;
    goto LABEL_57;
  }
  if ( this->m_HornSoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_HornSoundPtr;
    goto LABEL_57;
  }
  if ( this->m_SirenSoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_SirenSoundPtr;
    goto LABEL_57;
  }
  if ( this->m_FastSirenSoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_FastSirenSoundPtr;
    goto LABEL_57;
  }
  p_m_SurfaceSoundPtr = &this->m_EngineSounds[0].SoundPtr;
  SoundPtr = this->m_EngineSounds[0].SoundPtr;
  v18 = SoundPtr == pSound;
  if ( SoundPtr != pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[1].SoundPtr;
    v18 = this->m_EngineSounds[1].SoundPtr == pSound;
  }
  if ( !v18 )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[2].SoundPtr;
    v18 = this->m_EngineSounds[2].SoundPtr == pSound;
  }
  if ( v18 )
    goto LABEL_57;
  if ( this->m_EngineSounds[3].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[3].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[4].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[4].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[5].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[5].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[6].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[6].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[7].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[7].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[8].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[8].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[9].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[9].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[10].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[10].SoundPtr;
    goto LABEL_57;
  }
  if ( this->m_EngineSounds[11].SoundPtr == pSound )
  {
    p_m_SurfaceSoundPtr = &this->m_EngineSounds[11].SoundPtr;
LABEL_57:
    *p_m_SurfaceSoundPtr = 0;
  }
LABEL_58:
  if ( (unsigned __int8)this->m_VehicleAudioSetting.VehicleAudioType <= 1u && this->m_EngineSounds[4].SoundPtr == pSound )
  {
    this->m_ACPlayPositionLastFrame = this->m_ACPlayPositionThisFrame;
    this->m_ACPlayPositionThisFrame = PlayTime;
  }
}
// 3ABE74: variable 'v3' is possibly undefined
// 3ABE74: variable 'v4' is possibly undefined

//----- (003AC0B0) --------------------------------------------------------
CVector *__fastcall CAEVehicleAudioEntity::GetAircraftNearPosition(CVector *retstr, CAEVehicleAudioEntity *this)
{
  CEntity *m_pGameEntity; // r0
  CVector *result; // r0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3
  __int64 v7; // d16

  m_pGameEntity = this->m_pGameEntity;
  if ( this->m_VehicleAudioSetting.VehicleAudioType == 4 )
    return (CVector *)(*((int (__fastcall **)(CEntity *, int, CVector *))m_pGameEntity->_vptr$CPlaceable + 26))(
                        m_pGameEntity,
                        14,
                        retstr);
  m_pMat = m_pGameEntity->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &m_pGameEntity->m_transform;
  v7 = *(_QWORD *)&p_tx->m_translate.x;
  result = (CVector *)LODWORD(p_tx->m_translate.z);
  LODWORD(retstr->z) = result;
  *(_QWORD *)&retstr->x = v7;
  return result;
}

//----- (003AC0E4) --------------------------------------------------------
Int16 __fastcall CAEVehicleAudioEntity::RequestBankSlot(Int16 BankId)
{
  int v2; // r5
  Int16 *p_NumberOfUsers; // r0
  Int16 NumberOfUsers; // r1
  Int16 v5; // r6
  int v7; // r0
  int v8; // r1
  tDummyEngineSlot *v9; // r3
  Int16 *v10; // r3
  __int16 v11; // r6
  int v12; // t1
  tDummyEngineSlot *v13; // r3
  int v14; // t1
  tDummyEngineSlot *v15; // r3
  int v16; // t1
  tDummyEngineSlot *v17; // r3
  int v18; // t1
  tDummyEngineSlot *v19; // r3
  int v20; // t1
  tDummyEngineSlot *v21; // r3
  int v22; // t1
  tDummyEngineSlot *v23; // r3
  int v24; // t1
  tDummyEngineSlot *v25; // r3
  int v26; // t1
  tDummyEngineSlot *v27; // r3
  int v28; // t1
  tDummyEngineSlot *v29; // r3
  int v30; // t1
  int v31; // r9

  v2 = (unsigned __int16)BankId;
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers;
  NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId == v2 )
  {
    v5 = 7;
LABEL_21:
    *p_NumberOfUsers = NumberOfUsers + 1;
    return v5;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[1].BankId == v2 )
  {
    v5 = 8;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[2].BankId == v2 )
  {
    v5 = 9;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[3].BankId == v2 )
  {
    v5 = 10;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[4].BankId == v2 )
  {
    v5 = 11;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[5].BankId == v2 )
  {
    v5 = 12;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[6].BankId == v2 )
  {
    v5 = 13;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[7].BankId == v2 )
  {
    v5 = 14;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[8].BankId == v2 )
  {
    v5 = 15;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers;
    goto LABEL_21;
  }
  p_NumberOfUsers = &CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers;
  if ( (unsigned __int16)CAEVehicleAudioEntity::s_DummyEngineSlots[9].BankId == v2 )
  {
    v5 = 16;
    NumberOfUsers = CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers;
    goto LABEL_21;
  }
  LOWORD(v7) = 0;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers > 0 )
    LOWORD(v7) = -1;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers < 1 )
    LOWORD(v7) = 1;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers < 1 )
    LOWORD(v7) = 2;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers < 1 )
    LOWORD(v7) = 3;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers < 1 )
    LOWORD(v7) = 4;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers < 1 )
    LOWORD(v7) = 5;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers < 1 )
    LOWORD(v7) = 6;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers < 1 )
    LOWORD(v7) = 7;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers < 1 )
    LOWORD(v7) = 8;
  v5 = -1;
  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < 1 )
    LOWORD(v7) = 9;
  if ( (unsigned __int16)v7 != 0xFFFF )
  {
    v8 = CAEVehicleAudioEntity::s_NextDummyEngineSlot % 10;
    v9 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v12 = v9->NumberOfUsers;
    v10 = &v9->NumberOfUsers;
    v11 = v12;
    if ( v12 < 1 )
      goto LABEL_55;
    v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 1) % 10;
    v13 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v14 = v13->NumberOfUsers;
    v10 = &v13->NumberOfUsers;
    v11 = v14;
    if ( v14 <= 0 )
      goto LABEL_55;
    v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 2) % 10;
    v15 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v16 = v15->NumberOfUsers;
    v10 = &v15->NumberOfUsers;
    v11 = v16;
    if ( v16 < 1 )
      goto LABEL_55;
    v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 3) % 10;
    v17 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v18 = v17->NumberOfUsers;
    v10 = &v17->NumberOfUsers;
    v11 = v18;
    if ( v18 < 1 )
      goto LABEL_55;
    v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 4) % 10;
    v19 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v20 = v19->NumberOfUsers;
    v10 = &v19->NumberOfUsers;
    v11 = v20;
    if ( v20 < 1 )
      goto LABEL_55;
    v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 5) % 10;
    v21 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v22 = v21->NumberOfUsers;
    v10 = &v21->NumberOfUsers;
    v11 = v22;
    if ( v22 < 1 )
      goto LABEL_55;
    v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 6) % 10;
    v23 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v24 = v23->NumberOfUsers;
    v10 = &v23->NumberOfUsers;
    v11 = v24;
    if ( v24 < 1 )
      goto LABEL_55;
    v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 7) % 10;
    v25 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8];
    v26 = v25->NumberOfUsers;
    v10 = &v25->NumberOfUsers;
    v11 = v26;
    if ( v26 < 1
      || (v8 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 8) % 10,
          v27 = &CAEVehicleAudioEntity::s_DummyEngineSlots[v8],
          v28 = v27->NumberOfUsers,
          v10 = &v27->NumberOfUsers,
          v11 = v28,
          v28 < 1) )
    {
LABEL_55:
      v7 = v8;
    }
    else
    {
      v29 = &CAEVehicleAudioEntity::s_DummyEngineSlots[(CAEVehicleAudioEntity::s_NextDummyEngineSlot + 9) % 10];
      v30 = v29->NumberOfUsers;
      v10 = &v29->NumberOfUsers;
      v11 = v30;
      if ( v30 >= 1 )
      {
LABEL_57:
        v31 = (__int16)v7;
        v5 = v7 + 7;
        CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, v7 + 7, 1u);
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, v2, v5);
        CAEVehicleAudioEntity::s_DummyEngineSlots[v31].BankId = BankId;
        CAEVehicleAudioEntity::s_DummyEngineSlots[v31].NumberOfUsers = 1;
        return v5;
      }
      v7 = (CAEVehicleAudioEntity::s_NextDummyEngineSlot + 9) % 10;
    }
    *v10 = v11 + 1;
    CAEVehicleAudioEntity::s_NextDummyEngineSlot = (v7 + 1) % 10;
    goto LABEL_57;
  }
  return v5;
}

//----- (003AC4B8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::StoppedUsingBankSlot(Int16 AbsoluteBankSlotId)
{
  unsigned int v1; // r0
  __int16 v2; // r2
  char *v3; // r0
  int v4; // r1

  v1 = (AbsoluteBankSlotId << 16) - 458752;
  if ( v1 <= 0x90000 )
  {
    v2 = 0;
    v3 = (char *)CAEVehicleAudioEntity::s_DummyEngineSlots + (v1 >> 14);
    v4 = *((__int16 *)v3 + 1);
    if ( v4 > 0 )
      v2 = v4 - 1;
    *((_WORD *)v3 + 1) = v2;
  }
}

//----- (003AC4E8) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::DoesBankSlotContainThisBank(Int16 AbsoluteBankSlotId, Int16 DummyEngineBank)
{
  unsigned int v2; // r2
  Bool8 result; // r0

  v2 = (AbsoluteBankSlotId << 16) - 458752;
  result = 0;
  if ( v2 <= 0x90000
    && *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v2 >> 14)) == (unsigned __int16)DummyEngineBank )
  {
    return 1;
  }
  return result;
}

//----- (003AC514) --------------------------------------------------------
Int16 __fastcall CAEVehicleAudioEntity::DemandBankSlot(Int16 BankId)
{
  int v2; // r0
  int v3; // r1

  v2 = CAEVehicleAudioEntity::RequestBankSlot(BankId);
  if ( v2 == -1 )
  {
    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
    {
      if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
      {
        if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
        {
          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
          {
            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
            {
              if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
              {
                if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                {
                  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                  {
                    v3 = 0;
                    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                      v3 = 9;
                  }
                  else
                  {
                    v3 = 8;
                  }
                }
                else
                {
                  v3 = 7;
                }
              }
              else
              {
                v3 = 6;
              }
            }
            else
            {
              v3 = 5;
            }
          }
          else
          {
            v3 = 4;
          }
        }
        else
        {
          v3 = 3;
        }
      }
      else
      {
        v3 = 2;
      }
    }
    else
    {
      v3 = 1;
    }
    CAEVehicleAudioEntity::s_DummyEngineSlots[v3].NumberOfUsers = 0;
    LOWORD(v2) = CAEVehicleAudioEntity::RequestBankSlot(BankId);
  }
  return v2;
}

//----- (003AC60C) --------------------------------------------------------
tVehicleAudioSettings *CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio()
{
  return CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio;
}

//----- (003AC61C) --------------------------------------------------------
void CAEVehicleAudioEntity::DisableHelicoptors()
{
  CAEVehicleAudioEntity::s_HelicoptorsDisabled = 1;
}

//----- (003AC62C) --------------------------------------------------------
void CAEVehicleAudioEntity::EnableHelicoptors()
{
  CAEVehicleAudioEntity::s_HelicoptorsDisabled = 0;
}

//----- (003AC640) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::Initialise(CAEVehicleAudioEntity *this, CEntity *pVehicle)
{
  const tVehicleAudioSettings *v4; // r0
  __int64 v5; // d16
  __int64 v6; // d17
  __int64 v7; // d18
  __int64 v8; // d19
  float EngineVolumeOffset; // r0
  Int8 RandomNumberInRange; // r0
  Bool8 v11; // r0
  float v12; // s0
  int VehicleAudioType; // r1
  int v14; // r1
  int DummyBank; // r0
  __int16 v16; // r2
  int v17; // r2
  __int16 v18; // r1
  __int16 v19; // r1
  int m_bInitialised; // r2
  __int16 PlayerBank; // r1
  int v22; // r1
  __int16 v23; // r2
  __int16 v24; // r1

  this->m_pGameEntity = pVehicle;
  this->m_TimeLastServiced = 0;
  this->m_CrzCount = 0.0;
  *(_WORD *)&this->m_State = 0;
  this->m_nSwapStalledTime = 0;
  this->m_TimeSplashLastTriggered = 0;
  this->m_TimeBeforeAllowAccelerate = 0;
  this->m_TimeBeforeAllowCruise = 0;
  *(_DWORD *)&this->m_bPlayerDriven = 0;
  this->m_DummySlot = -1;
  this->m_nRainHitCount = 0;
  this->m_nStallCounter = 0;
  this->m_nStalledCount = 0;
  this->m_bNitroOnLastFrame = 0;
  *(_WORD *)&this->m_bSilentStalled = 0;
  this->m_ACPlayPositionThisFrame = -1;
  this->m_ACPlayPositionLastFrame = -1;
  this->m_ACPlayPositionWhenStopped = 0;
  this->m_ACPlayPercentWhenStopped = 0;
  this->m_FramesAgoACLooped = 0;
  this->m_EngineSounds[0].EngineSoundType = 0;
  this->m_EngineSounds[1].EngineSoundType = 1;
  this->m_EngineSounds[0].SoundPtr = 0;
  this->m_EngineSounds[1].SoundPtr = 0;
  this->m_EngineSounds[2].SoundPtr = 0;
  this->m_EngineSounds[2].EngineSoundType = 2;
  this->m_EngineSounds[3].SoundPtr = 0;
  this->m_EngineSounds[3].EngineSoundType = 3;
  this->m_EngineSounds[4].SoundPtr = 0;
  this->m_EngineSounds[4].EngineSoundType = 4;
  this->m_EngineSounds[5].SoundPtr = 0;
  this->m_EngineSounds[5].EngineSoundType = 5;
  this->m_EngineSounds[6].SoundPtr = 0;
  this->m_EngineSounds[6].EngineSoundType = 6;
  this->m_EngineSounds[7].SoundPtr = 0;
  this->m_EngineSounds[7].EngineSoundType = 7;
  this->m_EngineSounds[8].SoundPtr = 0;
  this->m_EngineSounds[8].EngineSoundType = 8;
  this->m_EngineSounds[9].SoundPtr = 0;
  this->m_EngineSounds[9].EngineSoundType = 9;
  this->m_EngineSounds[10].SoundPtr = 0;
  this->m_EngineSounds[10].EngineSoundType = 10;
  this->m_EngineSounds[11].SoundPtr = 0;
  this->m_EngineSounds[11].EngineSoundType = 11;
  *(_QWORD *)&this->m_CurrentRotorFrequency = 0xC2C80000BF800000LL;
  *(_QWORD *)&this->m_CurrentDummyEngineFrequency = 3212836864LL;
  this->m_SurfaceSoundPtr = 0;
  this->m_SurfaceSoundID = -1;
  this->m_RoadNoiseSoundID = -1;
  this->m_RoadNoiseSoundPtr = 0;
  this->m_FlatTyreSoundID = -1;
  this->m_FlatTyreSoundPtr = 0;
  this->m_ReverseSoundID = -1;
  this->m_ReverseSoundPtr = 0;
  this->m_HornVolume = -100.0;
  this->m_HornSoundPtr = 0;
  this->m_SirenSoundPtr = 0;
  this->m_FastSirenSoundPtr = 0;
  this->m_CurrentNitroRatio = -1.0;
  this->m_fFadeIn = 1.0;
  this->m_fFadeOut = 0.0;
  v4 = &gVehicleAudioSettings[pVehicle->m_nModelIndex];
  v5 = *(_QWORD *)&v4[-400].VehicleAudioType;
  v6 = *(_QWORD *)&v4[-400].BassFactor;
  v7 = *(_QWORD *)&v4[-400].HornType;
  v8 = *(_QWORD *)&v4[-400].DoorType;
  EngineVolumeOffset = v4[-400].EngineVolumeOffset;
  *(_QWORD *)&this->m_VehicleAudioSetting.VehicleAudioType = v5;
  *(_QWORD *)&this->m_VehicleAudioSetting.BassFactor = v6;
  this->m_VehicleAudioSetting.EngineVolumeOffset = EngineVolumeOffset;
  *(_QWORD *)&this->m_VehicleAudioSetting.HornType = v7;
  *(_QWORD *)&this->m_VehicleAudioSetting.DoorType = v8;
  this->m_bUsesSiren = CVehicle::UsesSiren((const CVehicle *)pVehicle);
  if ( this->m_VehicleAudioSetting.RadioType == 2 )
  {
    RandomNumberInRange = 13;
  }
  else
  {
    if ( this->m_VehicleAudioSetting.RadioType )
      goto LABEL_6;
    RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(1, 11);
  }
  this->m_VehicleAudioSetting.RadioStation = RandomNumberInRange;
LABEL_6:
  v11 = 0;
  v12 = (float)CAEAudioEntity::m_pAudioEventVolumes[77];
  this->m_fEventVolume = v12;
  switch ( pVehicle->m_nModelIndex )
  {
    case 0x212:
    case 0x21B:
    case 0x23B:
    case 0x23C:
    case 0x23E:
    case 0x247:
LABEL_8:
      v11 = 1;
      break;
    case 0x213:
    case 0x214:
    case 0x215:
    case 0x216:
    case 0x217:
    case 0x218:
    case 0x219:
    case 0x21A:
    case 0x21C:
    case 0x21D:
    case 0x21E:
    case 0x21F:
    case 0x220:
    case 0x221:
    case 0x222:
    case 0x223:
    case 0x224:
    case 0x225:
    case 0x226:
    case 0x227:
    case 0x228:
    case 0x229:
    case 0x22A:
    case 0x22B:
    case 0x22C:
    case 0x22D:
    case 0x22E:
    case 0x22F:
    case 0x230:
    case 0x231:
    case 0x232:
    case 0x233:
    case 0x234:
    case 0x235:
    case 0x236:
    case 0x237:
    case 0x238:
    case 0x239:
    case 0x23A:
    case 0x23D:
    case 0x23F:
    case 0x240:
    case 0x241:
    case 0x242:
    case 0x243:
    case 0x244:
    case 0x245:
    case 0x246:
      break;
    default:
      switch ( pVehicle->m_nModelIndex )
      {
        case 0x1C0:
        case 0x1C9:
        case 0x1CE:
        case 0x1E5:
          goto LABEL_8;
        default:
          goto LABEL_9;
      }
  }
LABEL_9:
  VehicleAudioType = this->m_VehicleAudioSetting.VehicleAudioType;
  this->m_bSingleGear = v11;
  switch ( VehicleAudioType )
  {
    case 0:
      m_bInitialised = this->m_bInitialised;
      DummyBank = (unsigned __int16)this->m_VehicleAudioSetting.DummyBank;
      PlayerBank = this->m_VehicleAudioSetting.PlayerBank;
      this->m_DummyEngineBank = DummyBank;
      this->m_PlayerEngineBank = PlayerBank;
      this->m_fEventVolume = v12 + -1.5;
      if ( m_bInitialised )
        goto LABEL_24;
      goto LABEL_11;
    case 1:
    case 9:
      v17 = this->m_bInitialised;
      DummyBank = (unsigned __int16)this->m_VehicleAudioSetting.DummyBank;
      v18 = this->m_VehicleAudioSetting.PlayerBank;
      this->m_DummyEngineBank = DummyBank;
      this->m_PlayerEngineBank = v18;
      this->m_fEventVolume = v12 + -1.5;
      if ( !v17 )
        goto LABEL_15;
      goto LABEL_24;
    case 2:
      v22 = this->m_bInitialised;
      DummyBank = (unsigned __int16)this->m_VehicleAudioSetting.DummyBank;
      v23 = this->m_VehicleAudioSetting.PlayerBank;
      this->m_DummyEngineBank = DummyBank;
      this->m_PlayerEngineBank = v23;
      if ( v22 )
        goto LABEL_24;
LABEL_15:
      if ( DummyBank != 0xFFFF )
        goto LABEL_16;
      goto LABEL_24;
    case 3:
    case 8:
      v14 = this->m_bInitialised;
      DummyBank = (unsigned __int16)this->m_VehicleAudioSetting.DummyBank;
      v16 = this->m_VehicleAudioSetting.PlayerBank;
      this->m_DummyEngineBank = DummyBank;
      this->m_PlayerEngineBank = v16;
      if ( v14 )
        goto LABEL_24;
LABEL_11:
      if ( DummyBank != 129 && DummyBank != 0xFFFF )
LABEL_16:
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(DummyBank);
LABEL_24:
      this->m_bInitialised = 1;
      return;
    case 4:
    case 6:
      v19 = this->m_VehicleAudioSetting.PlayerBank;
      this->m_DummyEngineBank = this->m_VehicleAudioSetting.DummyBank;
      this->m_PlayerEngineBank = v19;
      goto LABEL_24;
    case 5:
      DummyBank = (unsigned __int16)this->m_VehicleAudioSetting.DummyBank;
      v24 = this->m_VehicleAudioSetting.PlayerBank;
      this->m_DummyEngineBank = DummyBank;
      this->m_PlayerEngineBank = v24;
      if ( DummyBank == 0xFFFF || this->m_bInitialised )
        goto LABEL_24;
      goto LABEL_16;
    default:
      return;
  }
}

//----- (003AC968) --------------------------------------------------------
tVehicleAudioSettings *__fastcall CAEVehicleAudioEntity::GetVehicleAudioSettings(
        tVehicleAudioSettings *retstr,
        CAEVehicleAudioEntity *this,
        Int16 ModelId)
{
  const tVehicleAudioSettings *v3; // r1
  __int64 v4; // d16
  __int64 v5; // d17
  __int64 v6; // d18
  __int64 v7; // d19
  tVehicleAudioSettings *result; // r0

  v3 = &gVehicleAudioSettings[ModelId];
  v4 = *(_QWORD *)&v3[-400].VehicleAudioType;
  v5 = *(_QWORD *)&v3[-400].BassFactor;
  v6 = *(_QWORD *)&v3[-400].HornType;
  v7 = *(_QWORD *)&v3[-400].DoorType;
  retstr->EngineVolumeOffset = v3[-400].EngineVolumeOffset;
  *(_QWORD *)&retstr->VehicleAudioType = v4;
  *(_QWORD *)&retstr->BassFactor = v5;
  result = (tVehicleAudioSettings *)&retstr->HornType;
  *(_QWORD *)&result->VehicleAudioType = v6;
  *(_QWORD *)&result->BassFactor = v7;
  return result;
}

//----- (003AC99C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::Terminate(CAEVehicleAudioEntity *this)
{
  CAESound **p_SoundPtr; // r5
  int i; // r4
  CAESound *v4; // r0
  int m_PlayerEngineBank; // r1
  int IsSoundBankLoaded; // r0
  bool v7; // zf
  CAESound *m_SurfaceSoundPtr; // r0
  CAESound *m_RoadNoiseSoundPtr; // r0
  CAESound *m_FlatTyreSoundPtr; // r0
  CAESound *m_ReverseSoundPtr; // r0
  CAESound *m_HornSoundPtr; // r0
  CAESound *m_SirenSoundPtr; // r0
  CAESound *m_FastSirenSoundPtr; // r0
  int RadioType; // r0
  bool v16; // zf
  int m_DummySlot; // r0
  unsigned int v18; // r0
  Int16 v19; // r2
  tDummyEngineSlot *v20; // r0
  int NumberOfUsers; // r1
  int m_bPlayerDriven; // r1
  CAESound v23; // [sp+4h] [bp-8Ch] BYREF

  if ( this->m_bInitialised )
  {
    p_SoundPtr = &this->m_EngineSounds[0].SoundPtr;
    for ( i = 0; i != 12; ++i )
    {
      v4 = p_SoundPtr[2 * i];
      if ( v4 )
      {
        CAESound::SetIndividualEnvironment(v4, 4u, 0);
        CAESound::StopSound(p_SoundPtr[2 * i]);
        p_SoundPtr[2 * i] = 0;
      }
    }
    v23.m_pPhysicalEntity = 0;
    if ( (unsigned __int16)this->m_SurfaceSoundID != 0xFFFF )
    {
      if ( this->m_SkidSound.m_bCurrentlyInUse )
        CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_SkidSound);
      this->m_SurfaceSoundID = -1;
    }
    CAESound::~CAESound(&v23);
    v23.m_pPhysicalEntity = 0;
    m_PlayerEngineBank = (unsigned __int16)this->m_PlayerEngineBank;
    if ( m_PlayerEngineBank != 0xFFFF )
    {
      IsSoundBankLoaded = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_PlayerEngineBank, 40);
      v7 = IsSoundBankLoaded == 0;
      if ( IsSoundBankLoaded )
        v7 = (unsigned __int16)this->m_SurfaceSoundID == 0xFFFF;
      if ( !v7 )
      {
        if ( this->m_SkidSound.m_bCurrentlyInUse )
          CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_SkidSound);
        this->m_SurfaceSoundID = -1;
      }
    }
    CAESound::~CAESound(&v23);
    m_SurfaceSoundPtr = this->m_SurfaceSoundPtr;
    if ( m_SurfaceSoundPtr )
    {
      CAESound::SetIndividualEnvironment(m_SurfaceSoundPtr, 4u, 0);
      CAESound::StopSound(this->m_SurfaceSoundPtr);
      this->m_SurfaceSoundID = -1;
      this->m_SurfaceSoundPtr = 0;
    }
    m_RoadNoiseSoundPtr = this->m_RoadNoiseSoundPtr;
    if ( m_RoadNoiseSoundPtr )
    {
      CAESound::SetIndividualEnvironment(m_RoadNoiseSoundPtr, 4u, 0);
      CAESound::StopSound(this->m_RoadNoiseSoundPtr);
      this->m_RoadNoiseSoundID = -1;
      this->m_RoadNoiseSoundPtr = 0;
    }
    m_FlatTyreSoundPtr = this->m_FlatTyreSoundPtr;
    if ( m_FlatTyreSoundPtr )
    {
      CAESound::SetIndividualEnvironment(m_FlatTyreSoundPtr, 4u, 0);
      CAESound::StopSound(this->m_FlatTyreSoundPtr);
      this->m_FlatTyreSoundID = -1;
      this->m_FlatTyreSoundPtr = 0;
    }
    m_ReverseSoundPtr = this->m_ReverseSoundPtr;
    if ( m_ReverseSoundPtr )
    {
      CAESound::SetIndividualEnvironment(m_ReverseSoundPtr, 4u, 0);
      CAESound::StopSound(this->m_ReverseSoundPtr);
      this->m_ReverseSoundID = -1;
      this->m_ReverseSoundPtr = 0;
    }
    m_HornSoundPtr = this->m_HornSoundPtr;
    if ( m_HornSoundPtr )
    {
      CAESound::StopSoundAndForget(m_HornSoundPtr);
      this->m_HornSoundPtr = 0;
    }
    m_SirenSoundPtr = this->m_SirenSoundPtr;
    if ( m_SirenSoundPtr )
    {
      CAESound::StopSoundAndForget(m_SirenSoundPtr);
      this->m_SirenSoundPtr = 0;
    }
    m_FastSirenSoundPtr = this->m_FastSirenSoundPtr;
    if ( m_FastSirenSoundPtr )
    {
      CAESound::StopSoundAndForget(m_FastSirenSoundPtr);
      this->m_FastSirenSoundPtr = 0;
    }
    if ( this->m_bPlayerDriven )
    {
      RadioType = this->m_VehicleAudioSetting.RadioType;
      v16 = RadioType == 0;
      if ( this->m_VehicleAudioSetting.RadioType )
        v16 = RadioType == 2;
      if ( v16 || RadioType == 3 )
        CAudioEngine::StopRadio(&AudioEngine, &this->m_VehicleAudioSetting, 0);
    }
    m_DummySlot = (unsigned __int16)this->m_DummySlot;
    if ( m_DummySlot != 0xFFFF )
    {
      v18 = (m_DummySlot << 16) - 458752;
      if ( v18 <= 0x90000
        && *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v18 >> 14)) == (unsigned __int16)this->m_DummyEngineBank )
      {
        v19 = 0;
        v20 = &CAEVehicleAudioEntity::s_DummyEngineSlots[HIWORD(v18)];
        NumberOfUsers = v20->NumberOfUsers;
        if ( NumberOfUsers > 0 )
          v19 = NumberOfUsers - 1;
        v20->NumberOfUsers = v19;
      }
      this->m_DummySlot = -1;
    }
    this->m_DummyEngineBank = -1;
    m_bPlayerDriven = this->m_bPlayerDriven;
    this->m_pGameEntity = 0;
    this->m_PlayerEngineBank = -1;
    this->m_State = 0;
    if ( m_bPlayerDriven )
    {
      this->m_bPlayerDriven = 0;
      CAEVehicleAudioEntity::s_pPlayerDriver = 0;
    }
    else
    {
      if ( !this->m_bPlayerOnlyAttached )
      {
LABEL_49:
        this->m_bInitialised = 0;
        this->m_bPlayerDriverAboutToExit = 0;
        return;
      }
      this->m_bPlayerOnlyAttached = 0;
    }
    CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = 0;
    CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = 0;
    goto LABEL_49;
  }
}

//----- (003ACBE0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlaySkidSound(
        CAEVehicleAudioEntity *this,
        Int16 SurfaceSoundID,
        float Frequency,
        float VehicleRelativeVolume)
{
  float v7; // s16
  int v8; // r5
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3
  CEntity *v12; // r0
  CMatrix *v13; // r1
  CVector *p_m_translate; // r3
  CAESound v15; // [sp+14h] [bp-9Ch] BYREF

  v15.m_pPhysicalEntity = 0;
  v7 = this->m_fEventVolume + VehicleRelativeVolume;
  v8 = (unsigned __int16)SurfaceSoundID;
  if ( this->m_SurfaceSoundID == SurfaceSoundID )
  {
    if ( (unsigned __int16)SurfaceSoundID != 0xFFFF )
    {
      m_pGameEntity = this->m_pGameEntity;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      CAETwinLoopSoundEntity::UpdateTwinLoopSound(&this->m_SkidSound, *p_tx, v7, Frequency);
    }
  }
  else
  {
    if ( this->m_SkidSound.m_bCurrentlyInUse )
      CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_SkidSound);
    this->m_SurfaceSoundID = SurfaceSoundID;
    if ( v8 != 0xFFFF )
    {
      CAETwinLoopSoundEntity::Initialise(&this->m_SkidSound, 19, SurfaceSoundID, v8 + 1, this, 0xC8u, 0x3E8u, -1, -1);
      v12 = this->m_pGameEntity;
      v13 = v12->m_pMat;
      p_m_translate = (CVector *)&v13->tx;
      if ( !v13 )
        p_m_translate = &v12->m_transform.m_translate;
      CAETwinLoopSoundEntity::PlayTwinLoopSound(&this->m_SkidSound, *p_m_translate, v7, Frequency, 2.5, 1.0, 0);
    }
  }
  CAESound::~CAESound(&v15);
}

//----- (003ACCB8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayTrainBrakeSound(
        CAEVehicleAudioEntity *this,
        Int16 SurfaceSoundID,
        float Frequency,
        float VehicleRelativeVolume)
{
  int m_PlayerEngineBank; // r1
  float v9; // s18
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3
  CEntity *v13; // r0
  CMatrix *v14; // r1
  CVector *p_m_translate; // r3
  CAESound v16; // [sp+14h] [bp-9Ch] BYREF

  v16.m_pPhysicalEntity = 0;
  m_PlayerEngineBank = (unsigned __int16)this->m_PlayerEngineBank;
  if ( m_PlayerEngineBank != 0xFFFF && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_PlayerEngineBank, 40) )
  {
    v9 = this->m_fEventVolume + VehicleRelativeVolume;
    if ( this->m_SurfaceSoundID == SurfaceSoundID )
    {
      if ( (unsigned __int16)SurfaceSoundID != 0xFFFF )
      {
        m_pGameEntity = this->m_pGameEntity;
        m_pMat = m_pGameEntity->m_pMat;
        p_tx = (CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pGameEntity->m_transform.m_translate;
        CAETwinLoopSoundEntity::UpdateTwinLoopSound(&this->m_SkidSound, *p_tx, v9, Frequency);
      }
    }
    else
    {
      if ( this->m_SkidSound.m_bCurrentlyInUse )
        CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_SkidSound);
      this->m_SurfaceSoundID = SurfaceSoundID;
      if ( (unsigned __int16)SurfaceSoundID != 0xFFFF )
      {
        CAETwinLoopSoundEntity::Initialise(
          &this->m_SkidSound,
          40,
          SurfaceSoundID,
          SurfaceSoundID + 1,
          this,
          0xC8u,
          0x3E8u,
          -1,
          -1);
        v13 = this->m_pGameEntity;
        v14 = v13->m_pMat;
        p_m_translate = (CVector *)&v14->tx;
        if ( !v14 )
          p_m_translate = &v13->m_transform.m_translate;
        CAETwinLoopSoundEntity::PlayTwinLoopSound(&this->m_SkidSound, *p_m_translate, v9, Frequency, 3.5, 1.0, 0);
      }
    }
  }
  CAESound::~CAESound(&v16);
}

//----- (003ACDB4) --------------------------------------------------------
Int16 __fastcall CAEVehicleAudioEntity::GetVehicleTypeForAudio(CAEVehicleAudioEntity *this)
{
  bool v1; // zf
  int VehicleAudioTypeForName; // r1
  Int16 result; // r0

  v1 = this->m_bInitialised == 0;
  if ( this->m_bInitialised )
    v1 = this->m_pGameEntity == 0;
  if ( v1 )
    return 2;
  VehicleAudioTypeForName = this->m_VehicleAudioSetting.VehicleAudioTypeForName;
  result = 0;
  switch ( VehicleAudioTypeForName )
  {
    case 0:
    case 1:
    case 2:
    case 4:
    case 5:
    case 9:
    case 10:
    case 14:
    case 22:
    case 23:
    case 31:
    case 38:
      return result;
    case 25:
    case 29:
    case 30:
      result = 1;
      break;
    default:
      return 2;
  }
  return result;
}

//----- (003ACE04) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::Service(CAEVehicleAudioEntity *this)
{
  CEntity *m_pGameEntity; // r5
  int m_bPlayerDriven; // r0
  int RadioType; // r0
  bool v5; // zf
  Bool8 v6; // r6
  const CPed *m_pLastRenderedLink; // r0
  _BOOL4 v8; // r6
  CVehicle *VehicleOfPlayer; // r0
  CEntity *v10; // r5
  char v11; // r2
  CVehicle *v12; // r9
  int v13; // r8
  bool v14; // zf
  bool v15; // zf
  CLink<CEntity *> *v16; // r2
  int v17; // r0
  bool v18; // zf
  bool v19; // zf
  int v20; // r0
  bool v21; // zf
  CPhysical *v22; // r1

  if ( this->m_bInitialised )
  {
    m_pGameEntity = this->m_pGameEntity;
    if ( this->m_bPlayerDriven && CAEVehicleAudioEntity::s_pPlayerDriver && !this->m_bPlayerDriverAboutToExit )
    {
      if ( CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED )
      {
        this->m_bPlayerDriverAboutToExit = 1;
      }
      else
      {
        if ( CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
          goto LABEL_16;
        m_bPlayerDriven = this->m_bPlayerDriven;
        this->m_bPlayerDriverAboutToExit = 1;
        if ( !m_bPlayerDriven )
          goto LABEL_16;
      }
      RadioType = this->m_VehicleAudioSetting.RadioType;
      v5 = RadioType == 0;
      if ( this->m_VehicleAudioSetting.RadioType )
        v5 = RadioType == 2;
      if ( v5 || RadioType == 3 )
        CAudioEngine::StopRadio(&AudioEngine, &this->m_VehicleAudioSetting, 0);
      CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = 0;
      CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = 0;
    }
LABEL_16:
    v6 = 0;
    if ( (*(_BYTE *)&this->m_pGameEntity->m_info & 0xF8) == 40 )
    {
      v6 = 1;
      if ( !this->m_bWreckedVehicle )
        CAEVehicleAudioEntity::JustWreckedVehicle(this);
    }
    this->m_bWreckedVehicle = v6;
    m_pLastRenderedLink = (const CPed *)m_pGameEntity[18].m_pLastRenderedLink;
    v8 = m_pLastRenderedLink && CPed::IsPlayer(m_pLastRenderedLink);
    VehicleOfPlayer = CAEAudioUtility::FindVehicleOfPlayer();
    v10 = this->m_pGameEntity;
    v11 = 0;
    v12 = VehicleOfPlayer;
    if ( !v8 )
      v11 = 1;
    v13 = (unsigned __int8)v11 & (VehicleOfPlayer == v10);
    if ( v8 )
    {
      if ( !this->m_bPlayerDriven )
        CAEVehicleAudioEntity::JustGotInVehicleAsDriver(this);
    }
    else if ( this->m_bPlayerDriven )
    {
      CAEVehicleAudioEntity::JustGotOutOfVehicleAsDriver(this);
    }
    v14 = v13 == 1;
    if ( v13 == 1 )
      v14 = this->m_bPlayerOnlyAttached == 0;
    if ( !v14 || this->m_bPlayerDriven )
    {
      if ( !v8 )
      {
LABEL_47:
        if ( !v8 && v12 != v10 )
        {
          v19 = this->m_bPlayerDriven == 0;
          if ( !this->m_bPlayerDriven )
            v19 = this->m_bPlayerOnlyAttached == 0;
          if ( !v19 )
          {
            v20 = this->m_VehicleAudioSetting.RadioType;
            v21 = v20 == 0;
            if ( this->m_VehicleAudioSetting.RadioType )
              v21 = v20 == 2;
            if ( v21 || v20 == 3 )
              CAudioEngine::StopRadio(&AudioEngine, &this->m_VehicleAudioSetting, 0);
            CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = 0;
            CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = 0;
          }
        }
LABEL_58:
        this->m_bPlayerOnlyAttached = v13;
        v22 = (CPhysical *)this->m_pGameEntity;
        this->m_bPlayerDriven = v8;
        CAEVehicleAudioEntity::ProcessVehicle(this, v22);
        return;
      }
      v15 = this->m_bPlayerDriven == 0;
      if ( !this->m_bPlayerDriven )
        v15 = this->m_bPlayerOnlyAttached == 0;
      if ( !v15 )
        goto LABEL_58;
    }
    v16 = this->m_pGameEntity[18].m_pLastRenderedLink;
    CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = &this->m_VehicleAudioSetting;
    CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = (CPlayerPed *)v16;
    v17 = this->m_VehicleAudioSetting.RadioType;
    v18 = v17 == 0;
    if ( this->m_VehicleAudioSetting.RadioType )
      v18 = v17 == 2;
    if ( v18 || v17 == 3 )
      CAudioEngine::StartRadio(&AudioEngine, &this->m_VehicleAudioSetting);
    goto LABEL_47;
  }
}

//----- (003ACFFC) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayerAboutToExitVehicleAsDriver(CAEVehicleAudioEntity *this)
{
  int m_bPlayerDriven; // r1
  int RadioType; // r2
  bool v3; // zf

  m_bPlayerDriven = this->m_bPlayerDriven;
  this->m_bPlayerDriverAboutToExit = 1;
  if ( m_bPlayerDriven )
  {
    RadioType = this->m_VehicleAudioSetting.RadioType;
    v3 = RadioType == 0;
    if ( this->m_VehicleAudioSetting.RadioType )
      v3 = RadioType == 2;
    if ( v3 || RadioType == 3 )
      CAudioEngine::StopRadio(&AudioEngine, &this->m_VehicleAudioSetting, 0);
    CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = 0;
    CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = 0;
  }
}

//----- (003AD060) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::JustWreckedVehicle(CAEVehicleAudioEntity *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d9
  int RadioType; // r0
  bool v5; // zf
  unsigned int VehicleAudioType; // r0
  int v7; // r0
  int i; // r6
  char *v9; // r4
  __int16 m_nLength; // r5
  CAESound *v11; // r0
  CAESound **v12; // r4
  CAESound *v13; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v15; // r0
  int j; // r6
  char *v17; // r4
  __int16 v18; // r5
  CAESound *v19; // r0
  CAESound **v20; // r4
  CAESound *v21; // t1
  Int16 v22; // r0
  int v23; // r0
  CAESound *m_SurfaceSoundPtr; // r0
  CAESound *m_RoadNoiseSoundPtr; // r0
  CAESound *m_FlatTyreSoundPtr; // r0
  CAESound *m_ReverseSoundPtr; // r0
  CAESound *m_HornSoundPtr; // r0
  CAESound *m_SirenSoundPtr; // r0
  CAESound *m_FastSirenSoundPtr; // r0
  CAESound v31; // [sp+4h] [bp-A4h] BYREF

  if ( this->m_bPlayerDriven )
  {
    RadioType = this->m_VehicleAudioSetting.RadioType;
    v5 = RadioType == 0;
    if ( this->m_VehicleAudioSetting.RadioType )
      v5 = RadioType == 2;
    if ( v5 || RadioType == 3 )
      CAudioEngine::StopRadio(&AudioEngine, &this->m_VehicleAudioSetting, 0);
    CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = 0;
    CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = 0;
  }
  VehicleAudioType = this->m_VehicleAudioSetting.VehicleAudioType;
  if ( VehicleAudioType <= 9 )
  {
    v7 = 1 << VehicleAudioType;
    if ( (v7 & 0x378) != 0 )
    {
      v2.n64_u32[0] = 1.0;
      for ( i = 0; i != 12; ++i )
      {
        while ( 1 )
        {
          v9 = (char *)this + 8 * i;
          m_nLength = -1;
          v13 = (CAESound *)*((_DWORD *)v9 + 58);
          v12 = (CAESound **)(v9 + 232);
          v11 = v13;
          if ( v13 )
          {
            m_nLength = v11->m_nLength;
            CAESound::SetIndividualEnvironment(v11, 4u, 0);
            CAESound::StopSound(*v12);
            *v12 = 0;
          }
          if ( i != 4 )
            break;
          m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( m_nLength < 1 )
          {
            LOWORD(v15) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v15 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v15) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v15;
          i = 5;
        }
      }
    }
    else if ( v7 << 29 )
    {
      v2.n64_u32[0] = 1.0;
      for ( j = 0; j != 12; ++j )
      {
        while ( 1 )
        {
          v17 = (char *)this + 8 * j;
          v18 = -1;
          v21 = (CAESound *)*((_DWORD *)v17 + 58);
          v20 = (CAESound **)(v17 + 232);
          v19 = v21;
          if ( v21 )
          {
            v18 = v19->m_nLength;
            CAESound::SetIndividualEnvironment(v19, 4u, 0);
            CAESound::StopSound(*v20);
            *v20 = 0;
          }
          if ( j != 4 )
            break;
          v22 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v22;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v18 < 1 )
          {
            LOWORD(v23) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)v22 / (float)v18;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v23 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v23) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v23;
          j = 5;
        }
      }
    }
  }
  v31.m_pPhysicalEntity = 0;
  if ( (unsigned __int16)this->m_SurfaceSoundID != 0xFFFF )
  {
    if ( this->m_SkidSound.m_bCurrentlyInUse )
      CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_SkidSound);
    this->m_SurfaceSoundID = -1;
  }
  CAESound::~CAESound(&v31);
  m_SurfaceSoundPtr = this->m_SurfaceSoundPtr;
  if ( m_SurfaceSoundPtr )
  {
    CAESound::SetIndividualEnvironment(m_SurfaceSoundPtr, 4u, 0);
    CAESound::StopSound(this->m_SurfaceSoundPtr);
    this->m_SurfaceSoundID = -1;
    this->m_SurfaceSoundPtr = 0;
  }
  m_RoadNoiseSoundPtr = this->m_RoadNoiseSoundPtr;
  if ( m_RoadNoiseSoundPtr )
  {
    CAESound::SetIndividualEnvironment(m_RoadNoiseSoundPtr, 4u, 0);
    CAESound::StopSound(this->m_RoadNoiseSoundPtr);
    this->m_RoadNoiseSoundID = -1;
    this->m_RoadNoiseSoundPtr = 0;
  }
  m_FlatTyreSoundPtr = this->m_FlatTyreSoundPtr;
  if ( m_FlatTyreSoundPtr )
  {
    CAESound::SetIndividualEnvironment(m_FlatTyreSoundPtr, 4u, 0);
    CAESound::StopSound(this->m_FlatTyreSoundPtr);
    this->m_FlatTyreSoundID = -1;
    this->m_FlatTyreSoundPtr = 0;
  }
  m_ReverseSoundPtr = this->m_ReverseSoundPtr;
  if ( m_ReverseSoundPtr )
  {
    CAESound::SetIndividualEnvironment(m_ReverseSoundPtr, 4u, 0);
    CAESound::StopSound(this->m_ReverseSoundPtr);
    this->m_ReverseSoundID = -1;
    this->m_ReverseSoundPtr = 0;
  }
  m_HornSoundPtr = this->m_HornSoundPtr;
  if ( m_HornSoundPtr )
  {
    CAESound::SetIndividualEnvironment(m_HornSoundPtr, 4u, 0);
    CAESound::StopSound(this->m_HornSoundPtr);
    this->m_HornSoundPtr = 0;
  }
  m_SirenSoundPtr = this->m_SirenSoundPtr;
  if ( m_SirenSoundPtr )
  {
    CAESound::SetIndividualEnvironment(m_SirenSoundPtr, 4u, 0);
    CAESound::StopSound(this->m_SirenSoundPtr);
    this->m_SirenSoundPtr = 0;
  }
  m_FastSirenSoundPtr = this->m_FastSirenSoundPtr;
  if ( m_FastSirenSoundPtr )
  {
    CAESound::SetIndividualEnvironment(m_FastSirenSoundPtr, 4u, 0);
    CAESound::StopSound(this->m_FastSirenSoundPtr);
    this->m_FastSirenSoundPtr = 0;
  }
}
// 3AD144: variable 'v1' is possibly undefined
// 3AD144: variable 'v2' is possibly undefined

//----- (003AD33C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::JustGotInVehicleAsDriver(CAEVehicleAudioEntity *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d9
  CEntity *m_pGameEntity; // r1
  int k; // r5
  char *v6; // r4
  __int16 v7; // r6
  CAESound *v8; // r0
  CAESound **v9; // r4
  CAESound *v10; // t1
  Int16 v11; // r0
  int v12; // r0
  int v13; // r1
  int v14; // r0
  Int16 v15; // r5
  unsigned __int16 v16; // r0
  int v17; // r1
  int m_PlayerEngineBank; // r1
  int m_DummyEngineBank; // r0
  bool v20; // zf
  Int16 v21; // r5
  unsigned __int16 v22; // r0
  int v23; // r1
  int j; // r5
  char *v25; // r4
  __int16 v26; // r6
  CAESound *v27; // r0
  CAESound **v28; // r4
  CAESound *v29; // t1
  Int16 v30; // r0
  int v31; // r0
  int m_DummySlot; // r0
  Int16 v33; // r5
  unsigned __int16 v34; // r0
  int v35; // r2
  Int16 v36; // r5
  unsigned __int16 v37; // r0
  int v38; // r2
  Int16 v39; // r5
  unsigned __int16 v40; // r0
  int v41; // r2
  int m; // r5
  char *v43; // r4
  __int16 v44; // r6
  CAESound *v45; // r0
  CAESound **v46; // r4
  CAESound *v47; // t1
  Int16 v48; // r0
  int v49; // r0
  int v50; // r0
  Int16 v51; // r5
  unsigned __int16 v52; // r0
  int v53; // r1
  int i; // r5
  char *v55; // r4
  __int16 v56; // r6
  CAESound *v57; // r0
  CAESound **v58; // r4
  CAESound *v59; // t1
  Int16 v60; // r0
  int v61; // r0
  int v62; // r6
  char *v63; // r5
  __int16 m_nLength; // r11
  CAESound *v65; // r0
  CAESound **v66; // r5
  CAESound *v67; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v69; // r0

  m_pGameEntity = this->m_pGameEntity;
  this->m_bPlayerDriverAboutToExit = 0;
  CAEVehicleAudioEntity::s_pPlayerDriver = (CPlayerPed *)m_pGameEntity[18].m_pLastRenderedLink;
  switch ( this->m_VehicleAudioSetting.VehicleAudioType )
  {
    case 0:
    case 1:
      this->m_CrzCount = 0.0;
      this->m_AudioGear = 0;
      this->m_ACPlayPositionThisFrame = -1;
      this->m_ACPlayPositionLastFrame = -1;
      this->m_fEventVolume = (float)CAEAudioEntity::m_pAudioEventVolumes[77];
      if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 40) )
        CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 0);
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v20 = m_DummyEngineBank == 0xFFFF;
      if ( m_DummyEngineBank != 0xFFFF )
      {
        m_PlayerEngineBank = (unsigned __int16)this->m_PlayerEngineBank;
        v20 = m_PlayerEngineBank == 0xFFFF;
      }
      if ( v20 )
        return;
      if ( (unsigned __int16)this->m_DummySlot == 0xFFFF )
      {
        v21 = this->m_DummyEngineBank;
        v22 = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
        if ( v22 == 0xFFFF )
        {
          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
          {
            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
            {
              if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
              {
                if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                {
                  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                  {
                    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                    {
                      if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                      {
                        if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                        {
                          v23 = 0;
                          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                            v23 = 9;
                        }
                        else
                        {
                          v23 = 8;
                        }
                      }
                      else
                      {
                        v23 = 7;
                      }
                    }
                    else
                    {
                      v23 = 6;
                    }
                  }
                  else
                  {
                    v23 = 5;
                  }
                }
                else
                {
                  v23 = 4;
                }
              }
              else
              {
                v23 = 3;
              }
            }
            else
            {
              v23 = 2;
            }
          }
          else
          {
            v23 = 1;
          }
          CAEVehicleAudioEntity::s_DummyEngineSlots[v23].NumberOfUsers = 0;
          v22 = CAEVehicleAudioEntity::RequestBankSlot(v21);
        }
        LOWORD(m_PlayerEngineBank) = this->m_PlayerEngineBank;
        this->m_DummySlot = v22;
      }
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_PlayerEngineBank, 40) )
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, this->m_PlayerEngineBank, 40);
      if ( this->m_State == 1 && (unsigned __int16)this->m_DummySlot != 0xFFFF )
      {
        v2.n64_u32[0] = 1.0;
        v62 = 0;
        while ( 1 )
        {
          if ( v62 == 2 )
            goto LABEL_207;
          v63 = (char *)this + 8 * v62;
          m_nLength = -1;
          v67 = (CAESound *)*((_DWORD *)v63 + 58);
          v66 = (CAESound **)(v63 + 232);
          v65 = v67;
          if ( v67 )
          {
            m_nLength = v65->m_nLength;
            CAESound::SetIndividualEnvironment(v65, 4u, 0);
            CAESound::StopSound(*v66);
            *v66 = 0;
          }
          if ( v62 == 4 )
          {
            m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( m_nLength < 1 )
            {
              LOWORD(v69) = 0;
            }
            else
            {
              v1.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
              v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
              v69 = (int)(float)(v1.n64_f32[0] * 100.0);
              if ( v1.n64_f32[0] < 0.0 )
                LOWORD(v69) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v69;
LABEL_207:
            ++v62;
          }
          else if ( ++v62 == 12 )
          {
            this->m_State = 6;
            return;
          }
        }
      }
      v2.n64_u32[0] = 1.0;
      for ( i = 0; i != 12; ++i )
      {
        while ( 1 )
        {
          v55 = (char *)this + 8 * i;
          v56 = -1;
          v59 = (CAESound *)*((_DWORD *)v55 + 58);
          v58 = (CAESound **)(v55 + 232);
          v57 = v59;
          if ( v59 )
          {
            v56 = v57->m_nLength;
            CAESound::SetIndividualEnvironment(v57, 4u, 0);
            CAESound::StopSound(*v58);
            *v58 = 0;
          }
          if ( i != 4 )
            break;
          v60 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v60;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v56 < 1 )
          {
            LOWORD(v61) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)v60 / (float)v56;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v61 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v61) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v61;
          i = 5;
        }
      }
      this->m_State = 0;
      return;
    case 2:
      this->m_fEventVolume = (float)CAEAudioEntity::m_pAudioEventVolumes[77];
      if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 40) )
        CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 0);
      v2.n64_u32[0] = 1.0;
      for ( j = 0; j != 12; ++j )
      {
        while ( 1 )
        {
          v25 = (char *)this + 8 * j;
          v26 = -1;
          v29 = (CAESound *)*((_DWORD *)v25 + 58);
          v28 = (CAESound **)(v25 + 232);
          v27 = v29;
          if ( v29 )
          {
            v26 = v27->m_nLength;
            CAESound::SetIndividualEnvironment(v27, 4u, 0);
            CAESound::StopSound(*v28);
            *v28 = 0;
          }
          if ( j != 4 )
            break;
          v30 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v30;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v26 < 1 )
          {
            LOWORD(v31) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)v30 / (float)v26;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v31 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v31) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v31;
          j = 5;
        }
      }
      if ( (unsigned __int16)this->m_DummySlot == 0xFFFF )
      {
        v39 = this->m_DummyEngineBank;
        v40 = CAEVehicleAudioEntity::RequestBankSlot(v39);
        if ( v40 == 0xFFFF )
        {
          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
          {
            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
            {
              if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
              {
                if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                {
                  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                  {
                    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                    {
                      if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                      {
                        if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                        {
                          v41 = 0;
                          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                            v41 = 9;
                        }
                        else
                        {
                          v41 = 8;
                        }
                      }
                      else
                      {
                        v41 = 7;
                      }
                    }
                    else
                    {
                      v41 = 6;
                    }
                  }
                  else
                  {
                    v41 = 5;
                  }
                }
                else
                {
                  v41 = 4;
                }
              }
              else
              {
                v41 = 3;
              }
            }
            else
            {
              v41 = 2;
            }
          }
          else
          {
            v41 = 1;
          }
          CAEVehicleAudioEntity::s_DummyEngineSlots[v41].NumberOfUsers = 0;
          v40 = CAEVehicleAudioEntity::RequestBankSlot(v39);
        }
        this->m_DummySlot = v40;
      }
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40) )
        goto LABEL_225;
      return;
    case 3:
      m_DummySlot = (unsigned __int16)this->m_DummySlot;
      this->m_fEventVolume = (float)CAEAudioEntity::m_pAudioEventVolumes[77];
      if ( m_DummySlot == 0xFFFF )
      {
        v33 = this->m_DummyEngineBank;
        v34 = CAEVehicleAudioEntity::RequestBankSlot(v33);
        if ( v34 == 0xFFFF )
        {
          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
          {
            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
            {
              if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
              {
                if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                {
                  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                  {
                    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                    {
                      if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                      {
                        if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                        {
                          v35 = 0;
                          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                            v35 = 9;
                        }
                        else
                        {
                          v35 = 8;
                        }
                      }
                      else
                      {
                        v35 = 7;
                      }
                    }
                    else
                    {
                      v35 = 6;
                    }
                  }
                  else
                  {
                    v35 = 5;
                  }
                }
                else
                {
                  v35 = 4;
                }
              }
              else
              {
                v35 = 3;
              }
            }
            else
            {
              v35 = 2;
            }
          }
          else
          {
            v35 = 1;
          }
          CAEVehicleAudioEntity::s_DummyEngineSlots[v35].NumberOfUsers = 0;
          v34 = CAEVehicleAudioEntity::RequestBankSlot(v33);
        }
        this->m_DummySlot = v34;
      }
      return;
    case 4:
    case 5:
    case 6:
      v2.n64_u32[0] = 1.0;
      for ( k = 0; k != 12; ++k )
      {
        while ( 1 )
        {
          v6 = (char *)this + 8 * k;
          v7 = -1;
          v10 = (CAESound *)*((_DWORD *)v6 + 58);
          v9 = (CAESound **)(v6 + 232);
          v8 = v10;
          if ( v10 )
          {
            v7 = v8->m_nLength;
            CAESound::SetIndividualEnvironment(v8, 4u, 0);
            CAESound::StopSound(*v9);
            *v9 = 0;
          }
          if ( k != 4 )
            break;
          v11 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v11;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v7 < 1 )
          {
            LOWORD(v12) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)v11 / (float)v7;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v12 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v12) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v12;
          k = 5;
        }
      }
      v13 = (unsigned __int16)this->m_PlayerEngineBank;
      if ( v13 != 0xFFFF && !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, v13, 40) )
      {
        if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 40) )
          CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 0);
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, this->m_PlayerEngineBank, 40);
      }
      v14 = (unsigned __int16)this->m_DummyEngineBank;
      if ( v14 != 0xFFFF && (unsigned __int16)this->m_DummySlot == 0xFFFF )
      {
        v15 = this->m_DummyEngineBank;
        v16 = CAEVehicleAudioEntity::RequestBankSlot(v14);
        if ( v16 == 0xFFFF )
        {
          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
          {
            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
            {
              if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
              {
                if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                {
                  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                  {
                    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                    {
                      if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                      {
                        if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                        {
                          v17 = 0;
                          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                            v17 = 9;
                        }
                        else
                        {
                          v17 = 8;
                        }
                      }
                      else
                      {
                        v17 = 7;
                      }
                    }
                    else
                    {
                      v17 = 6;
                    }
                  }
                  else
                  {
                    v17 = 5;
                  }
                }
                else
                {
                  v17 = 4;
                }
              }
              else
              {
                v17 = 3;
              }
            }
            else
            {
              v17 = 2;
            }
          }
          else
          {
            v17 = 1;
          }
          CAEVehicleAudioEntity::s_DummyEngineSlots[v17].NumberOfUsers = 0;
          v16 = CAEVehicleAudioEntity::RequestBankSlot(v15);
        }
        this->m_DummySlot = v16;
      }
      this->m_CurrentRotorFrequency = -1.0;
      this->m_CurrentDummyEngineVolume = -100.0;
      return;
    case 8:
      this->m_fEventVolume = (float)CAEAudioEntity::m_pAudioEventVolumes[77];
      if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 40) )
        CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 0);
      if ( (unsigned __int16)this->m_DummySlot == 0xFFFF )
      {
        v36 = this->m_DummyEngineBank;
        v37 = CAEVehicleAudioEntity::RequestBankSlot(v36);
        if ( v37 == 0xFFFF )
        {
          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
          {
            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
            {
              if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
              {
                if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                {
                  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                  {
                    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                    {
                      if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                      {
                        if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                        {
                          v38 = 0;
                          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                            v38 = 9;
                        }
                        else
                        {
                          v38 = 8;
                        }
                      }
                      else
                      {
                        v38 = 7;
                      }
                    }
                    else
                    {
                      v38 = 6;
                    }
                  }
                  else
                  {
                    v38 = 5;
                  }
                }
                else
                {
                  v38 = 4;
                }
              }
              else
              {
                v38 = 3;
              }
            }
            else
            {
              v38 = 2;
            }
          }
          else
          {
            v38 = 1;
          }
          CAEVehicleAudioEntity::s_DummyEngineSlots[v38].NumberOfUsers = 0;
          v37 = CAEVehicleAudioEntity::RequestBankSlot(v36);
        }
        this->m_DummySlot = v37;
      }
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40) )
        goto LABEL_225;
      return;
    case 9:
      this->m_fEventVolume = (float)CAEAudioEntity::m_pAudioEventVolumes[77];
      if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 40) )
        CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 0);
      v2.n64_u32[0] = 1.0;
      for ( m = 0; m != 12; ++m )
      {
        while ( 1 )
        {
          v43 = (char *)this + 8 * m;
          v44 = -1;
          v47 = (CAESound *)*((_DWORD *)v43 + 58);
          v46 = (CAESound **)(v43 + 232);
          v45 = v47;
          if ( v47 )
          {
            v44 = v45->m_nLength;
            CAESound::SetIndividualEnvironment(v45, 4u, 0);
            CAESound::StopSound(*v46);
            *v46 = 0;
          }
          if ( m != 4 )
            break;
          v48 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v48;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v44 < 1 )
          {
            LOWORD(v49) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)v48 / (float)v44;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v49 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v49) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v49;
          m = 5;
        }
      }
      if ( (unsigned __int16)this->m_DummySlot == 0xFFFF )
      {
        v50 = (unsigned __int16)this->m_DummyEngineBank;
        if ( v50 != 0xFFFF )
        {
          v51 = this->m_DummyEngineBank;
          v52 = CAEVehicleAudioEntity::RequestBankSlot(v50);
          if ( v52 == 0xFFFF )
          {
            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[1].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
            {
              if ( CAEVehicleAudioEntity::s_DummyEngineSlots[2].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
              {
                if ( CAEVehicleAudioEntity::s_DummyEngineSlots[3].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                {
                  if ( CAEVehicleAudioEntity::s_DummyEngineSlots[4].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                  {
                    if ( CAEVehicleAudioEntity::s_DummyEngineSlots[5].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                    {
                      if ( CAEVehicleAudioEntity::s_DummyEngineSlots[6].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                      {
                        if ( CAEVehicleAudioEntity::s_DummyEngineSlots[7].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                        {
                          if ( CAEVehicleAudioEntity::s_DummyEngineSlots[8].NumberOfUsers >= CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                          {
                            v53 = 0;
                            if ( CAEVehicleAudioEntity::s_DummyEngineSlots[9].NumberOfUsers < CAEVehicleAudioEntity::s_DummyEngineSlots[0].NumberOfUsers )
                              v53 = 9;
                          }
                          else
                          {
                            v53 = 8;
                          }
                        }
                        else
                        {
                          v53 = 7;
                        }
                      }
                      else
                      {
                        v53 = 6;
                      }
                    }
                    else
                    {
                      v53 = 5;
                    }
                  }
                  else
                  {
                    v53 = 4;
                  }
                }
                else
                {
                  v53 = 3;
                }
              }
              else
              {
                v53 = 2;
              }
            }
            else
            {
              v53 = 1;
            }
            CAEVehicleAudioEntity::s_DummyEngineSlots[v53].NumberOfUsers = 0;
            v52 = CAEVehicleAudioEntity::RequestBankSlot(v51);
          }
          this->m_DummySlot = v52;
        }
      }
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40) )
LABEL_225:
        sub_18AFEC(&AEAudioHardware, this->m_PlayerEngineBank, 40);
      return;
    default:
      return;
  }
}
// 3AD406: variable 'v1' is possibly undefined
// 3AD406: variable 'v2' is possibly undefined
// 3ADCC4: variable 'm_PlayerEngineBank' is possibly undefined

//----- (003AE01C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::JustGotOutOfVehicleAsDriver(CAEVehicleAudioEntity *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d9
  int j; // r5
  char *v5; // r4
  __int16 v6; // r6
  CAESound *v7; // r0
  CAESound **v8; // r4
  CAESound *v9; // t1
  Int16 v10; // r0
  int v11; // r0
  float v12; // s2
  int m_State; // r0
  int v14; // r6
  char *v15; // r8
  __int16 m_nLength; // r5
  CAESound *v17; // r0
  CAESound **v18; // r8
  CAESound *v19; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v21; // r0
  int m_PlayerEngineBank; // r1
  int IsSoundBankLoaded; // r0
  bool v24; // zf
  int i; // r5
  char *v26; // r6
  __int16 v27; // r8
  CAESound *v28; // r0
  CAESound **v29; // r6
  CAESound *v30; // t1
  Int16 v31; // r0
  int v32; // r0
  Int8 v33; // r0
  CAESound *m_ReverseSoundPtr; // r0
  CAESound v35; // [sp+4h] [bp-A4h] BYREF

  this->m_bPlayerDriverAboutToExit = 0;
  switch ( this->m_VehicleAudioSetting.VehicleAudioType )
  {
    case 0:
    case 1:
      v12 = (float)CAEAudioEntity::m_pAudioEventVolumes[77];
      m_State = (unsigned __int8)this->m_State;
      this->m_fFadeIn = 1.0;
      this->m_fFadeOut = 1.0;
      this->m_fEventVolume = v12 + -1.5;
      if ( m_State == 6 )
      {
        v2.n64_u32[0] = 1.0;
        v14 = 0;
        while ( 1 )
        {
          if ( v14 == 2 )
            goto LABEL_16;
          v15 = (char *)this + 8 * v14;
          m_nLength = -1;
          v19 = (CAESound *)*((_DWORD *)v15 + 58);
          v18 = (CAESound **)(v15 + 232);
          v17 = v19;
          if ( v19 )
          {
            m_nLength = v17->m_nLength;
            CAESound::SetIndividualEnvironment(v17, 4u, 0);
            CAESound::StopSound(*v18);
            *v18 = 0;
          }
          if ( v14 == 4 )
          {
            m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( m_nLength < 1 )
            {
              LOWORD(v21) = 0;
            }
            else
            {
              v1.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
              v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
              v21 = (int)(float)(v1.n64_f32[0] * 100.0);
              if ( v1.n64_f32[0] < 0.0 )
                LOWORD(v21) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v21;
LABEL_16:
            ++v14;
          }
          else if ( ++v14 == 12 )
          {
            v33 = 1;
            goto LABEL_52;
          }
        }
      }
      v2.n64_u32[0] = 1.0;
      for ( i = 0; i != 12; ++i )
      {
        while ( 1 )
        {
          v26 = (char *)this + 8 * i;
          v27 = -1;
          v30 = (CAESound *)*((_DWORD *)v26 + 58);
          v29 = (CAESound **)(v26 + 232);
          v28 = v30;
          if ( v30 )
          {
            v27 = v28->m_nLength;
            CAESound::SetIndividualEnvironment(v28, 4u, 0);
            CAESound::StopSound(*v29);
            *v29 = 0;
          }
          if ( i != 4 )
            break;
          v31 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v31;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v27 < 1 )
          {
            LOWORD(v32) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)v31 / (float)v27;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v32 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v32) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v32;
          i = 5;
        }
      }
      if ( this->m_State )
      {
        v33 = 10;
LABEL_52:
        this->m_State = v33;
      }
      v35.m_pPhysicalEntity = 0;
      if ( (unsigned __int16)this->m_ReverseSoundID != 0xFFFF )
      {
        m_ReverseSoundPtr = this->m_ReverseSoundPtr;
        if ( m_ReverseSoundPtr )
        {
          CAESound::SetIndividualEnvironment(m_ReverseSoundPtr, 4u, 0);
          CAESound::StopSound(this->m_ReverseSoundPtr);
          this->m_ReverseSoundPtr = 0;
        }
        this->m_ReverseSoundID = -1;
      }
      CAESound::~CAESound(&v35);
      this->m_AudioGear = 0;
LABEL_58:
      CAEVehicleAudioEntity::s_pPlayerDriver = 0;
      return;
    case 4:
    case 5:
    case 6:
      v2.n64_u32[0] = 1.0;
      for ( j = 0; j != 12; ++j )
      {
        while ( 1 )
        {
          v5 = (char *)this + 8 * j;
          v6 = -1;
          v9 = (CAESound *)*((_DWORD *)v5 + 58);
          v8 = (CAESound **)(v5 + 232);
          v7 = v9;
          if ( v9 )
          {
            v6 = v7->m_nLength;
            CAESound::SetIndividualEnvironment(v7, 4u, 0);
            CAESound::StopSound(*v8);
            *v8 = 0;
          }
          if ( j != 4 )
            break;
          v10 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v10;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v6 < 1 )
          {
            LOWORD(v11) = 0;
          }
          else
          {
            v1.n64_f32[0] = (float)v10 / (float)v6;
            v1.n64_u64[0] = vmin_f32(v1, v2).n64_u64[0];
            v11 = (int)(float)(v1.n64_f32[0] * 100.0);
            if ( v1.n64_f32[0] < 0.0 )
              LOWORD(v11) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v11;
          j = 5;
        }
      }
      this->m_CurrentRotorFrequency = -1.0;
      this->m_CurrentDummyEngineVolume = -100.0;
      goto LABEL_58;
    case 8:
      v35.m_pPhysicalEntity = 0;
      m_PlayerEngineBank = (unsigned __int16)this->m_PlayerEngineBank;
      if ( m_PlayerEngineBank != 0xFFFF )
      {
        IsSoundBankLoaded = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_PlayerEngineBank, 40);
        v24 = IsSoundBankLoaded == 0;
        if ( IsSoundBankLoaded )
          v24 = (unsigned __int16)this->m_SurfaceSoundID == 0xFFFF;
        if ( !v24 )
        {
          if ( this->m_SkidSound.m_bCurrentlyInUse )
            CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_SkidSound);
          this->m_SurfaceSoundID = -1;
        }
      }
      CAESound::~CAESound(&v35);
      goto LABEL_58;
    case 9:
      this->m_fEventVolume = (float)CAEAudioEntity::m_pAudioEventVolumes[77] + -1.5;
      goto LABEL_58;
    default:
      goto LABEL_58;
  }
}
// 3AE0D4: variable 'v1' is possibly undefined
// 3AE0D4: variable 'v2' is possibly undefined

//----- (003AE380) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::TurnOnRadioForVehicle(CAEVehicleAudioEntity *this)
{
  tVehicleAudioSettings *p_m_VehicleAudioSetting; // r1
  CLink<CEntity *> *m_pLastRenderedLink; // r3
  int RadioType; // r0
  bool v4; // zf

  p_m_VehicleAudioSetting = &this->m_VehicleAudioSetting;
  m_pLastRenderedLink = this->m_pGameEntity[18].m_pLastRenderedLink;
  CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = &this->m_VehicleAudioSetting;
  CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = (CPlayerPed *)m_pLastRenderedLink;
  RadioType = this->m_VehicleAudioSetting.RadioType;
  v4 = RadioType == 0;
  if ( RadioType )
    v4 = RadioType == 2;
  if ( v4 || RadioType == 3 )
    sub_197734(&AudioEngine, p_m_VehicleAudioSetting);
}

//----- (003AE3D8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::TurnOffRadioForVehicle(CAEVehicleAudioEntity *this)
{
  int RadioType; // r2
  bool v2; // zf

  RadioType = this->m_VehicleAudioSetting.RadioType;
  v2 = RadioType == 0;
  if ( this->m_VehicleAudioSetting.RadioType )
    v2 = RadioType == 2;
  if ( v2 || RadioType == 3 )
    CAudioEngine::StopRadio(&AudioEngine, &this->m_VehicleAudioSetting, 0);
  CAEVehicleAudioEntity::s_pVehicleAudioSettingsForRadio = 0;
  CAEVehicleAudioEntity::s_pPlayerAttachedForRadio = 0;
}

//----- (003AE428) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessVehicle(CAEVehicleAudioEntity *this, CPhysical *pObject)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  RwReal x; // r0
  float v7; // s0
  RwReal z; // r0
  CEntryInfoList *p_m_listEntryInfo; // r0
  CEntryInfoList *v10; // r0
  CEntryInfoList *v11; // r0
  cVehicleParams *v12; // r1
  float v13; // s16
  float v14; // s0
  float v15; // s0
  CEntryInfoList *v16; // r0
  CEntryInfoList *v17; // r0
  cVehicleParams *v18; // r1
  float v19; // s16
  float v20; // s0
  int m_bPlayerDriven; // r6
  int VehicleAudioType; // r5
  float v23; // r0
  float v24; // s2
  float v25; // s6
  float v26; // s2
  int v27; // r5
  float v28; // r0
  float v29; // s2
  float v30; // s2
  float v31; // s6
  float v32; // s4
  unsigned __int32 v33; // s0
  unsigned __int32 v34; // s0
  unsigned __int32 v35; // s0
  CVehicle *pVehicle; // r6
  float v37; // s16
  float v38; // s0
  Int16 v39; // r8
  float m_fGasPedal; // s2
  UInt32 LastTimeWeStartedTempActReverse; // s4
  cVehicleParams *v42; // r1
  cVehicleParams *v43; // r1
  unsigned __int32 v44; // s0
  unsigned __int32 v45; // s0
  CEntity::CEntityInfo m_info; // r0
  cVehicleParams *v47; // r1
  float v48; // s4
  cVehicleParams *v49; // r1
  cVehicleParams VehicleParams; // [sp+Ch] [bp-64h] BYREF

  VehicleParams.fDistSqr = 0.0;
  memset(&VehicleParams.pTransmission, 0, 20);
  VehicleParams.nSpecificVehicleType = -1;
  VehicleParams.nBaseVehicleType = -1;
  VehicleParams.bDistanceCalculated = 0;
  VehicleParams.fRealRevsRatio = 0.0;
  VehicleParams.fWheelSpin = 0.0;
  memset(&VehicleParams.fSpeedRatio, 0, 14);
  VehicleParams.pVehicle = (CVehicle *)pObject;
  x = pObject[2].m_vecAttachTiltOffset.x;
  if ( x != 0.0 )
    LODWORD(x) += 44;
  *(RwReal *)&VehicleParams.pTransmission = x;
  VehicleParams.nModelIndexMinusOffset = pObject->m_nModelIndex - 400;
  if ( (*(_BYTE *)&pObject->m_info & 0xF8) == 16 )
    v7 = *(float *)&pObject[3].m_pRwObject / 50.0;
  else
    v7 = (float)((float)(pObject->m_vecMoveSpeed.x * pObject->m_pMat->xy)
               + (float)(pObject->m_vecMoveSpeed.y * pObject->m_pMat->yy))
       + (float)(pObject->m_vecMoveSpeed.z * pObject->m_pMat->zy);
  VehicleParams.fSpeed = v7;
  z = pObject[4].m_vecCOM.z;
  VehicleParams.nSpecificVehicleType = (Int32)pObject[4].m_listEntryInfo.m_pHead;
  *(RwReal *)&VehicleParams.nBaseVehicleType = z;
  switch ( this->m_VehicleAudioSetting.VehicleAudioType )
  {
    case 0:
      if ( LODWORD(z) == 9 )
      {
        p_m_listEntryInfo = &pObject[6].m_listEntryInfo;
      }
      else
      {
        if ( z != 0.0 )
          goto LABEL_59;
        p_m_listEntryInfo = (CEntryInfoList *)&pObject[7].m_aCollisionRecordPtrs[5];
      }
      v2.n64_f32[0] = fabsf(pObject[3].m_vecDamageNormal.z);
      LODWORD(v3.n64_u64[0]) = (CEntryInfoList)p_m_listEntryInfo->m_pHead;
      if ( v2.n64_f32[0] <= *(float *)&p_m_listEntryInfo->m_pHead )
      {
        v3.n64_f32[0] = v3.n64_f32[0] + -0.07;
        v33 = vmax_f32(v3, v2).n64_u32[0];
      }
      else
      {
        v3.n64_f32[0] = v3.n64_f32[0] + 0.09;
        v33 = vmin_f32(v3, v2).n64_u32[0];
      }
      p_m_listEntryInfo->m_pHead = (CEntryInfoNode *)v33;
LABEL_59:
      if ( this->m_bWreckedVehicle != 1 )
      {
        CAEVehicleAudioEntity::ProcessVehicleRoadNoise(this, &VehicleParams);
        if ( this->m_bPlayerDriven )
        {
          pVehicle = VehicleParams.pVehicle;
          v37 = 1.0;
          v38 = -100.0;
          v39 = -1;
          if ( (*(_BYTE *)&VehicleParams.pVehicle->m_nVehicleFlags & 0x10) != 0 )
          {
            m_fGasPedal = VehicleParams.pVehicle->m_fGasPedal;
            if ( m_fGasPedal < 0.0 || !VehicleParams.pVehicle->m_nCurrentGear )
            {
              if ( BYTE1(VehicleParams.pVehicle[1].AutoPilot.TempActionFinish) )
              {
                *(float *)&LastTimeWeStartedTempActReverse = VehicleParams.fSpeed
                                                           / VehicleParams.pTransmission->m_fMaxReverseVelocity;
              }
              else
              {
                LastTimeWeStartedTempActReverse = VehicleParams.pVehicle[1].AutoPilot.LastTimeWeStartedTempActReverse;
                if ( BYTE2(VehicleParams.pVehicle[1].AutoPilot.TempActionFinish) )
                {
                  *(float *)&LastTimeWeStartedTempActReverse = *(float *)&LastTimeWeStartedTempActReverse * 0.4;
                  VehicleParams.pVehicle[1].AutoPilot.LastTimeWeStartedTempActReverse = LastTimeWeStartedTempActReverse;
                }
              }
              v48 = fabsf(*(float *)&LastTimeWeStartedTempActReverse);
              v39 = 20;
              v37 = (float)(v48 * 0.2) + 0.75;
              if ( m_fGasPedal < 0.0 )
                v39 = 19;
              if ( v48 > 0.0 )
                v38 = (float)(CAEAudioUtility::AudioLog10(v48) * 20.0) + -6.0;
            }
          }
          CAEVehicleAudioEntity::PlayReverseSound(this, v39, v37, v38);
        }
        else
        {
          pVehicle = VehicleParams.pVehicle;
        }
        if ( (*(_BYTE *)&pVehicle->m_info & 0xF8) != 16 )
        {
          CAEVehicleAudioEntity::ProcessVehicleSkidding(this, &VehicleParams);
          pVehicle = VehicleParams.pVehicle;
        }
        if ( (*(_BYTE *)&pVehicle->m_info & 0xF8) != 16 )
          CAEVehicleAudioEntity::ProcessVehicleFlatTyre(this, &VehicleParams);
        CAEVehicleAudioEntity::ProcessVehicleSirenAlarmHorn(this, &VehicleParams);
        if ( this->m_bPlayerDriven )
          CAEVehicleAudioEntity::ProcessPlayerVehicleEngine(this, &VehicleParams);
        else
          CAEVehicleAudioEntity::ProcessDummyVehicleEngine(this, &VehicleParams);
        if ( (*(_BYTE *)&VehicleParams.pVehicle->m_info & 0xF8) != 16 )
          CAEVehicleAudioEntity::ProcessEngineDamage(this, &VehicleParams);
        CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v49);
        if ( !VehicleParams.pVehicle->m_baseVehicleType )
          CAEVehicleAudioEntity::ProcessNitro(this, &VehicleParams);
        CAEVehicleAudioEntity::ProcessMovingParts(this, &VehicleParams);
        if ( VehicleParams.pVehicle->m_nModelIndex == 532 )
          CAEVehicleAudioEntity::ProcessPlayerCombine(this, &VehicleParams);
        pObject[7].m_nFlags.bdummy = LODWORD(VehicleParams.fSpeed);
      }
      return;
    case 1:
      if ( this->m_bWreckedVehicle == 1 )
        return;
      if ( LODWORD(z) == 9 )
      {
        v10 = &pObject[6].m_listEntryInfo;
      }
      else
      {
        if ( z != 0.0 )
        {
LABEL_81:
          CAEVehicleAudioEntity::ProcessVehicleRoadNoise(this, &VehicleParams);
          if ( (*(_BYTE *)&VehicleParams.pVehicle->m_info & 0xF8) != 16 )
            CAEVehicleAudioEntity::ProcessVehicleSkidding(this, &VehicleParams);
          CAEVehicleAudioEntity::ProcessVehicleSirenAlarmHorn(this, &VehicleParams);
          if ( this->m_bPlayerDriven )
            CAEVehicleAudioEntity::ProcessPlayerVehicleEngine(this, &VehicleParams);
          else
            CAEVehicleAudioEntity::ProcessDummyVehicleEngine(this, &VehicleParams);
          m_info = VehicleParams.pVehicle->m_info;
          v47 = (cVehicleParams *)(*(_BYTE *)&m_info & 0xF8);
          if ( v47 != (cVehicleParams *)&word_10 )
          {
            CAEVehicleAudioEntity::ProcessEngineDamage(this, &VehicleParams);
            m_info = VehicleParams.pVehicle->m_info;
          }
          if ( (*(_BYTE *)&m_info & 0xF8) != 16 )
            CAEVehicleAudioEntity::ProcessVehicleFlatTyre(this, &VehicleParams);
          CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v47);
          goto LABEL_96;
        }
        v10 = (CEntryInfoList *)&pObject[7].m_aCollisionRecordPtrs[5];
      }
      v2.n64_f32[0] = fabsf(pObject[3].m_vecDamageNormal.z);
      LODWORD(v3.n64_u64[0]) = (CEntryInfoList)v10->m_pHead;
      if ( v2.n64_f32[0] <= *(float *)&v10->m_pHead )
      {
        v3.n64_f32[0] = v3.n64_f32[0] + -0.07;
        v44 = vmax_f32(v3, v2).n64_u32[0];
      }
      else
      {
        v3.n64_f32[0] = v3.n64_f32[0] + 0.09;
        v44 = vmin_f32(v3, v2).n64_u32[0];
      }
      v10->m_pHead = (CEntryInfoNode *)v44;
      goto LABEL_81;
    case 2:
      if ( this->m_bWreckedVehicle == 1 )
        return;
      if ( LODWORD(z) == 9 )
      {
        v11 = &pObject[6].m_listEntryInfo;
      }
      else
      {
        if ( z != 0.0 )
          goto LABEL_93;
        v11 = (CEntryInfoList *)&pObject[7].m_aCollisionRecordPtrs[5];
      }
      v2.n64_f32[0] = fabsf(pObject[3].m_vecDamageNormal.z);
      LODWORD(v3.n64_u64[0]) = (CEntryInfoList)v11->m_pHead;
      if ( v2.n64_f32[0] <= *(float *)&v11->m_pHead )
      {
        v3.n64_f32[0] = v3.n64_f32[0] + -0.07;
        v45 = vmax_f32(v3, v2).n64_u32[0];
      }
      else
      {
        v3.n64_f32[0] = v3.n64_f32[0] + 0.09;
        v45 = vmin_f32(v3, v2).n64_u32[0];
      }
      v11->m_pHead = (CEntryInfoNode *)v45;
LABEL_93:
      CAEVehicleAudioEntity::ProcessVehicleSkidding(this, &VehicleParams);
      CAEVehicleAudioEntity::ProcessVehicleSirenAlarmHorn(this, &VehicleParams);
      if ( this->m_bPlayerDriven )
        CAEVehicleAudioEntity::ProcessPlayerBicycle(this, &VehicleParams);
      else
        CAEVehicleAudioEntity::ProcessDummyBicycle(this, &VehicleParams);
LABEL_96:
      pObject[6].m_vecMoveFriction.y = VehicleParams.fSpeed;
      return;
    case 3:
      CAEVehicleAudioEntity::ProcessBoatEngine(this, &VehicleParams);
      CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v12);
      v2.n64_u32[0] = 0.75;
      v3.n64_f32[0] = fabsf(VehicleParams.fSpeed);
      v13 = vmin_f32(v3, v2).n64_f32[0] / 0.75;
      v14 = v13;
      if ( !(LOBYTE(VehicleParams.pVehicle[1].m_transform.m_translate.z) << 31) )
        v14 = 0.0;
      if ( v14 >= 0.00001 )
      {
        VehicleAudioType = (unsigned __int8)this->m_VehicleAudioSetting.VehicleAudioType;
        v23 = CAEAudioUtility::AudioLog10(v14);
        if ( VehicleAudioType == 6 )
          v24 = 12.0;
        else
          v24 = 3.0;
        v15 = (float)(v23 * 20.0) + v24;
      }
      else
      {
        v15 = -100.0;
      }
      v25 = 6.0;
      v26 = v13 * 0.2;
      goto LABEL_45;
    case 4:
      if ( LODWORD(z) == 9 )
      {
        v16 = &pObject[6].m_listEntryInfo;
      }
      else
      {
        if ( z != 0.0 )
          goto LABEL_68;
        v16 = (CEntryInfoList *)&pObject[7].m_aCollisionRecordPtrs[5];
      }
      v2.n64_f32[0] = fabsf(pObject[3].m_vecDamageNormal.z);
      LODWORD(v3.n64_u64[0]) = (CEntryInfoList)v16->m_pHead;
      if ( v2.n64_f32[0] <= *(float *)&v16->m_pHead )
      {
        v3.n64_f32[0] = v3.n64_f32[0] + -0.07;
        v34 = vmax_f32(v3, v2).n64_u32[0];
      }
      else
      {
        v3.n64_f32[0] = v3.n64_f32[0] + 0.09;
        v34 = vmin_f32(v3, v2).n64_u32[0];
      }
      v16->m_pHead = (CEntryInfoNode *)v34;
LABEL_68:
      CAEVehicleAudioEntity::ProcessAircraft(this, &VehicleParams);
      CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v42);
      return;
    case 5:
      if ( LODWORD(z) == 9 )
      {
        v17 = &pObject[6].m_listEntryInfo;
      }
      else
      {
        if ( z != 0.0 )
          goto LABEL_71;
        v17 = (CEntryInfoList *)&pObject[7].m_aCollisionRecordPtrs[5];
      }
      v2.n64_f32[0] = fabsf(pObject[3].m_vecDamageNormal.z);
      LODWORD(v3.n64_u64[0]) = (CEntryInfoList)v17->m_pHead;
      if ( v2.n64_f32[0] <= *(float *)&v17->m_pHead )
      {
        v3.n64_f32[0] = v3.n64_f32[0] + -0.07;
        v35 = vmax_f32(v3, v2).n64_u32[0];
      }
      else
      {
        v3.n64_f32[0] = v3.n64_f32[0] + 0.09;
        v35 = vmin_f32(v3, v2).n64_u32[0];
      }
      v17->m_pHead = (CEntryInfoNode *)v35;
LABEL_71:
      CAEVehicleAudioEntity::ProcessAircraft(this, &VehicleParams);
      CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v43);
      CAEVehicleAudioEntity::ProcessMovingParts(this, &VehicleParams);
      return;
    case 6:
      CAEVehicleAudioEntity::ProcessAircraft(this, &VehicleParams);
      CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v18);
      v2.n64_u32[0] = 0.75;
      v3.n64_f32[0] = fabsf(VehicleParams.fSpeed);
      v19 = vmin_f32(v3, v2).n64_f32[0] / 0.75;
      v20 = v19;
      if ( !(LOBYTE(VehicleParams.pVehicle[1].m_transform.m_translate.z) << 31) )
        v20 = 0.0;
      if ( v20 >= 0.00001 )
      {
        v27 = (unsigned __int8)this->m_VehicleAudioSetting.VehicleAudioType;
        v28 = CAEAudioUtility::AudioLog10(v20);
        if ( v27 == 6 )
          v29 = 12.0;
        else
          v29 = 3.0;
        v15 = (float)(v28 * 20.0) + v29;
      }
      else
      {
        v15 = -100.0;
      }
      v25 = 6.0;
      v26 = v19 * 0.2;
LABEL_45:
      v30 = v26 + 0.8;
      v31 = v15 + v25;
      v32 = v30 * 0.185;
      if ( CWeather::UnderWaterness < 0.5 )
      {
        v31 = v15;
        v32 = v30;
      }
      CAEVehicleAudioEntity::UpdateBoatSound(this, 6, 2, 3, v32, v31);
      return;
    case 8:
      CAEVehicleAudioEntity::ProcessTrainTrackSound(this, &VehicleParams);
      m_bPlayerDriven = this->m_bPlayerDriven;
      CAEVehicleAudioEntity::ProcessDummyTrainEngine(this, &VehicleParams);
      if ( m_bPlayerDriven )
        CAEVehicleAudioEntity::ProcessPlayerTrainBrakes(this, &VehicleParams);
      return;
    case 9:
      CAEVehicleAudioEntity::ProcessSpecialVehicle(this, &VehicleParams);
      return;
    default:
      return;
  }
}
// 3AE56A: variable 'v12' is possibly undefined
// 3AE582: variable 'v3' is possibly undefined
// 3AE582: variable 'v2' is possibly undefined
// 3AE5EA: variable 'v18' is possibly undefined
// 3AE81A: variable 'v42' is possibly undefined
// 3AE854: variable 'v43' is possibly undefined
// 3AE928: variable 'v47' is possibly undefined
// 3AEA48: variable 'v49' is possibly undefined
// 10: using guessed type __int16 word_10;

//----- (003AEAA8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessSpecialVehicle(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  int m_nModelIndex; // r0
  cVehicleParams *v5; // r1
  cVehicleParams *v6; // r1
  cVehicleParams *v7; // r1

  m_nModelIndex = VehicleParams->pVehicle->m_nModelIndex;
  if ( m_nModelIndex > 538 )
  {
    if ( m_nModelIndex >= 584 )
    {
      if ( m_nModelIndex == 584 || m_nModelIndex == 591 )
      {
LABEL_10:
        CAEVehicleAudioEntity::ProcessVehicleRoadNoise(this, VehicleParams);
        CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v5);
      }
    }
    else if ( m_nModelIndex == 539 )
    {
      CAEVehicleAudioEntity::ProcessDummyHovercraft(this, VehicleParams);
      CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v7);
      CAEVehicleAudioEntity::ProcessVehicleSirenAlarmHorn(this, VehicleParams);
    }
    else if ( m_nModelIndex == 564 )
    {
LABEL_7:
      CAEVehicleAudioEntity::ProcessDummyRCCar(this, VehicleParams);
    }
  }
  else
  {
    switch ( VehicleParams->pVehicle->m_nModelIndex )
    {
      case 0x1B3:
      case 0x1C2:
        goto LABEL_10;
      case 0x1B9:
        goto LABEL_7;
      case 0x1C9:
        CAEVehicleAudioEntity::ProcessVehicleRoadNoise(this, VehicleParams);
        CAEVehicleAudioEntity::ProcessVehicleSkidding(this, VehicleParams);
        CAEVehicleAudioEntity::ProcessVehicleFlatTyre(this, VehicleParams);
        CAEVehicleAudioEntity::ProcessVehicleSirenAlarmHorn(this, VehicleParams);
        CAEVehicleAudioEntity::ProcessDummyGolfCart(this, VehicleParams);
        CAEVehicleAudioEntity::ProcessRainOnVehicle(this, v6);
        if ( (*(_BYTE *)&VehicleParams->pVehicle->m_info & 0xF8) != 16 )
          CAEVehicleAudioEntity::ProcessEngineDamage(this, VehicleParams);
        break;
      case 0x1D0:
        CAEVehicleAudioEntity::ProcessDummyRCPlane(this, VehicleParams);
        break;
      case 0x1D1:
      case 0x1F5:
        CAEVehicleAudioEntity::ProcessDummyRCHeli(this, VehicleParams);
        break;
      default:
        return;
    }
  }
}
// 3AEB58: variable 'v5' is possibly undefined
// 3AEB90: variable 'v6' is possibly undefined
// 3AEBAE: variable 'v7' is possibly undefined

//----- (003AEBCC) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessBoatEngine(CAEVehicleAudioEntity *this, cVehicleParams *VehicleParams)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d2
  float32x2_t v4; // d4
  float32x2_t v5; // d5
  int m_DummySlot; // r0
  CVehicle *pVehicle; // r6
  CAESound *SoundPtr; // r0
  CAESound *v11; // r0
  int m_DummyEngineBank; // r0
  unsigned int v13; // r1
  CPad *PadFromPlayer; // r8
  Int16 Brake; // r0
  CVehicle *v16; // r1
  float *p_xx; // r0
  int *v18; // r1
  float v19; // s6
  float v20; // s2
  bool v21; // nf
  float v22; // s2
  bool v23; // fzf
  bool v24; // fnf
  float v25; // s4
  float v26; // s10
  float v27; // s6
  float32x2_t v28; // d4
  float m_CurrentDummyEngineVolume; // s6
  unsigned __int32 Frequency; // s16
  unsigned __int32 v31; // s18
  Int16 v32; // r0

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      pVehicle = VehicleParams->pVehicle;
      if ( (*(_BYTE *)&pVehicle->m_nVehicleFlags & 0x10) != 0 && !this->m_bWreckedVehicle )
      {
        if ( CAEVehicleAudioEntity::s_pPlayerDriver && this->m_bPlayerDriven )
        {
          if ( this->m_bPlayerDriverAboutToExit
            || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
            || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
          {
            Brake = 0;
            VehicleParams->ThisAccel = 0;
          }
          else
          {
            PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
            VehicleParams->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
            Brake = CPad::GetBrake(PadFromPlayer);
          }
          v16 = VehicleParams->pVehicle;
          VehicleParams->ThisBrake = Brake;
        }
        else
        {
          v16 = VehicleParams->pVehicle;
        }
        v3.n64_u32[0] = 1.0;
        p_xx = &v16->m_pMat->xx;
        v18 = dword_3AEE90;
        v19 = pVehicle[1].m_transform.m_translate.x * 3.0;
        v20 = v19;
        if ( v19 > 1.0 )
          v20 = 1.0;
        v21 = v20 < 0.0;
        v22 = 1.0;
        v23 = v19 == 1.0;
        v24 = v19 < 1.0;
        if ( v21 )
          v22 = 0.0;
        if ( v21 )
          v19 = v22;
        if ( !v24 && !v23 )
          v19 = v22;
        if ( (LOBYTE(pVehicle[1].m_transform.m_translate.z) & 2) == 0 )
          v18 = &dword_3AEE90[1];
        v4.n64_f32[0] = 1.0 - (float)(p_xx[10] + (float)((float)(p_xx[8] * 0.0) + (float)(p_xx[9] * 0.0)));
        v28.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
        v25 = v19 * 3.0;
        v26 = *(float *)v18 * v19;
        v27 = v28.n64_f32[0] * 0.1;
        v28.n64_f32[0] = v26 + 0.6;
        v5.n64_u32[0] = LODWORD(this->m_CurrentDummyEngineFrequency);
        v3.n64_f32[0] = v25 + -3.0;
        v28.n64_f32[0] = v27 + v28.n64_f32[0];
        if ( v5.n64_f32[0] < 0.0 )
        {
          LODWORD(this->m_CurrentDummyEngineFrequency) = v28.n64_u32[0];
          v5.n64_u32[0] = v28.n64_u32[0];
        }
        m_CurrentDummyEngineVolume = this->m_CurrentDummyEngineVolume;
        if ( m_CurrentDummyEngineVolume < 0.0 )
        {
          LODWORD(this->m_CurrentDummyEngineVolume) = v3.n64_u32[0];
          m_CurrentDummyEngineVolume = v3.n64_f32[0];
        }
        if ( v28.n64_f32[0] <= v5.n64_f32[0] )
        {
          v5.n64_f32[0] = v5.n64_f32[0] + -0.02;
          Frequency = vmax_f32(v28, v5).n64_u32[0];
        }
        else
        {
          v5.n64_f32[0] = v5.n64_f32[0] + 0.02;
          Frequency = vmin_f32(v28, v5).n64_u32[0];
        }
        if ( v3.n64_f32[0] <= m_CurrentDummyEngineVolume )
        {
          v2.n64_f32[0] = m_CurrentDummyEngineVolume + -3.0;
          v31 = vmax_f32(v3, v2).n64_u32[0];
        }
        else
        {
          v2.n64_f32[0] = m_CurrentDummyEngineVolume + 3.0;
          v31 = vmin_f32(v3, v2).n64_u32[0];
        }
        v32 = this->m_DummySlot;
        if ( CWeather::UnderWaterness >= 0.5 )
        {
          CAEVehicleAudioEntity::UpdateBoatSound(this, 2, v32, 0, 1.0, -100.0);
          CAEVehicleAudioEntity::UpdateBoatSound(this, 3, 19, 28, *(float *)&Frequency, *(float *)&v31 + 6.0);
        }
        else
        {
          CAEVehicleAudioEntity::UpdateBoatSound(this, 2, v32, 0, *(float *)&Frequency, *(float *)&v31);
          CAEVehicleAudioEntity::UpdateBoatSound(this, 3, 19, 28, 1.0, -100.0);
        }
        this->m_CurrentDummyEngineVolume = *(float *)&v31;
        LODWORD(this->m_CurrentDummyEngineFrequency) = Frequency;
      }
      else
      {
        SoundPtr = this->m_EngineSounds[2].SoundPtr;
        if ( SoundPtr )
        {
          CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[2].SoundPtr);
          this->m_EngineSounds[2].SoundPtr = 0;
        }
        v11 = this->m_EngineSounds[3].SoundPtr;
        if ( v11 )
        {
          CAESound::SetIndividualEnvironment(v11, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[3].SoundPtr);
          this->m_EngineSounds[3].SoundPtr = 0;
        }
      }
    }
    else
    {
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v13 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v13 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v13 >> 14)) != m_DummyEngineBank )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
      }
    }
  }
}
// 3AED66: variable 'v4' is possibly undefined
// 3AED66: variable 'v3' is possibly undefined
// 3AEDC8: variable 'v5' is possibly undefined
// 3AEDE8: variable 'v2' is possibly undefined
// 3AEE90: using guessed type int dword_3AEE90[2];

//----- (003AEEB0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessRainOnVehicle(CAEVehicleAudioEntity *this, cVehicleParams *VehicleParams)
{
  float v3; // s16
  Int16 v4; // r0
  Int16 RandomNumberInRange; // r0
  CEntity *m_pGameEntity; // r1
  CMatrix *m_pMat; // r2
  CVector *p_tx; // r3

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x69u, 6) )
  {
    v3 = CAEWeatherAudioEntity::m_sfRainVolume;
    if ( CAEWeatherAudioEntity::m_sfRainVolume > -100.0 )
    {
      v4 = this->m_nRainHitCount + 1;
      this->m_nRainHitCount = v4;
      if ( v4 >= 3 )
      {
        this->m_nRainHitCount = 0;
        RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(12, 15);
        m_pGameEntity = this->m_pGameEntity;
        m_pMat = m_pGameEntity->m_pMat;
        p_tx = (CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pGameEntity->m_transform.m_translate;
        CAESound::Initialise(&this->ScratchSound, 6, RandomNumberInRange, this, *p_tx, v3, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        this->ScratchSound.m_RollOffFactor = 1.0;
        this->ScratchSound.m_FrequencyVariance = 0.1;
        this->ScratchSound.m_AudioEvent = 142;
        sub_19F790(&AESoundManager, &this->ScratchSound);
      }
    }
  }
}

//----- (003AEF88) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessBoatMovingOverWater(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float v5; // s16
  float v6; // s0
  float v7; // s0
  int VehicleAudioType; // r5
  float v9; // r0
  float v10; // s2
  float v11; // s6
  float v12; // s4

  v2.n64_u32[0] = 0.75;
  v3.n64_f32[0] = fabsf(VehicleParams->fSpeed);
  v5 = vmin_f32(v3, v2).n64_f32[0] / 0.75;
  v6 = v5;
  if ( !(LOBYTE(VehicleParams->pVehicle[1].m_transform.m_translate.z) << 31) )
    v6 = 0.0;
  if ( v6 >= 0.00001 )
  {
    VehicleAudioType = (unsigned __int8)this->m_VehicleAudioSetting.VehicleAudioType;
    v9 = CAEAudioUtility::AudioLog10(v6);
    if ( VehicleAudioType == 6 )
      v10 = 12.0;
    else
      v10 = 3.0;
    v7 = (float)(v9 * 20.0) + v10;
  }
  else
  {
    v7 = -100.0;
  }
  v11 = v7 + 6.0;
  v12 = (float)((float)(v5 * 0.2) + 0.8) * 0.185;
  if ( CWeather::UnderWaterness < 0.5 )
  {
    v11 = v7;
    v12 = (float)(v5 * 0.2) + 0.8;
  }
  CAEVehicleAudioEntity::UpdateBoatSound(this, 6, 2, 3, v12, v11);
}
// 3AEFA8: variable 'v3' is possibly undefined
// 3AEFA8: variable 'v2' is possibly undefined

//----- (003AF074) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessTrainTrackSound(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  int m_DummySlot; // r0
  CVehicle *pVehicle; // r5
  float v6; // s16
  float v7; // s2
  float v8; // s0
  int m_DummyEngineBank; // r0
  unsigned int v10; // r1
  __int16 v11; // r0
  float v12; // s18

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      pVehicle = VehicleParams->pVehicle;
      v6 = 6.0;
      if ( this->m_DummyEngineBank == 133 )
        v6 = 10.0;
      if ( BYTE1(pVehicle[1].m_pRwObject) << 31 )
      {
        v7 = 0.0;
        v8 = -100.0;
        if ( !pVehicle )
        {
          v11 = 0;
LABEL_20:
          CAEVehicleAudioEntity::UpdateTrainSound(
            this,
            2,
            this->m_DummySlot,
            2,
            (float)((float)(v7 * 0.4) + 0.8) * gfCarriageFrequencyVariations[v11 % 5],
            v8);
          return;
        }
      }
      else
      {
        v7 = fabsf(pVehicle[1].m_transform.m_translate.x);
        v8 = -100.0;
        if ( v7 >= 0.0 || v7 > 1.0 )
        {
          v12 = 1.0;
          if ( v7 > 1.0 || (v12 = v7, v7 >= 0.00001) )
          {
            v7 = v12;
            v8 = v6 + (float)(CAEAudioUtility::AudioLog10(v12) * 20.0);
          }
        }
        else
        {
          v7 = 0.0;
        }
      }
      v11 = 0;
      do
      {
        pVehicle = *(CVehicle **)&pVehicle[1].m_nScanCode;
        ++v11;
      }
      while ( pVehicle );
      goto LABEL_20;
    }
    m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
    v10 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
    if ( v10 > 0x90000
      || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v10 >> 14)) != m_DummyEngineBank )
    {
      this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
    }
  }
}

//----- (003AF210) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyTrainEngine(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  CPad *Pad; // r8
  int m_DummySlot; // r0
  float v6; // s16
  int m_DummyEngineBank; // r0
  int *v8; // r5
  CVehicle *pVehicle; // r9
  float v10; // s20
  int *v11; // r6
  __int16 m_pRwObject; // r1
  CAESound *SoundPtr; // r0
  int v14; // r0
  unsigned int v15; // r1
  float *p_xx; // r2
  double v17; // d17
  float v18; // s0
  float v19; // s4
  float v20; // s2
  int *v21; // r2
  float v22; // s0
  double v23; // d16
  double v24; // d17
  float v25; // s2
  float x; // s26
  float v27; // s0
  float v28; // s18
  bool v29; // fnf
  int *v30; // r2
  float v31; // s24
  float v32; // s22
  float v33; // s20
  int v34; // r6
  int Accelerate; // r0

  Pad = CPad::GetPad(0);
  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      v6 = 0.0;
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v8 = dword_3AF498;
      pVehicle = VehicleParams->pVehicle;
      v10 = 0.0;
      v11 = dword_3AF4A0;
      if ( m_DummyEngineBank == 133 )
      {
        v8 = &dword_3AF498[1];
        v10 = 11.0;
      }
      m_pRwObject = (__int16)pVehicle[1].m_pRwObject;
      if ( m_DummyEngineBank == 133 )
        v11 = &dword_3AF4A0[1];
      if ( (m_pRwObject & 8) != 0 )
      {
        p_xx = &pVehicle->m_pMat->xx;
        v17 = -0.3;
        v18 = p_xx[4] * 0.0;
        v19 = p_xx[6];
        v20 = p_xx[5] * 0.0;
        v21 = dword_3AF480;
        v22 = v19 + (float)(v18 + v20);
        if ( v22 > -0.3 )
          v17 = v22;
        v23 = 0.3;
        if ( v17 < 0.3 )
          v23 = v17;
        if ( m_DummyEngineBank == 133 )
          v21 = &dword_3AF480[2];
        v24 = *(double *)v21;
        if ( ((int)pVehicle[1].m_pRwObject & 0x100) != 0 )
        {
          v30 = &dword_3AF4A8;
          if ( (m_pRwObject & 0x40) == 0 )
            v30 = &dword_3AF4AC;
          v28 = 0.0;
          x = *(float *)v30;
        }
        else
        {
          v25 = 0.0;
          x = pVehicle[1].m_transform.m_translate.x;
          if ( (m_pRwObject & 0x40) == 0 )
            x = -x;
          v27 = 1.0;
          v28 = fabsf(x);
          if ( v28 > 1.0 )
            v25 = 1.0;
          if ( v28 < 0.0 )
            v27 = v25;
          v29 = v28 < 0.0;
          if ( v28 > 1.0 )
            v28 = v27;
          if ( v29 )
            v28 = v27;
        }
        if ( m_DummyEngineBank == 133 )
          v6 = v10 + (float)(CAEAudioUtility::AudioLog10(v28) * 20.0);
        v32 = *(float *)v8;
        v33 = *(float *)v11;
        if ( *(_BYTE *)&pVehicle->m_info <= 7u )
        {
          if ( fabsf(x) >= 0.001 )
          {
            if ( x <= 0.0 )
              Accelerate = -CPad::GetBrake(Pad);
            else
              Accelerate = CPad::GetAccelerate(Pad);
          }
          else
          {
            v34 = CPad::GetAccelerate(Pad);
            Accelerate = v34 - CPad::GetBrake(Pad);
          }
          v6 = v6 + (float)((float)((float)Accelerate / 255.0) * 3.0);
        }
        v31 = v24 * v23;
        CAEVehicleAudioEntity::UpdateTrainSound(
          this,
          1,
          this->m_DummySlot,
          0,
          (float)(v31 + 1.0) * (float)(v33 + (float)(v32 * v28)),
          v6);
      }
      else
      {
        SoundPtr = this->m_EngineSounds[1].SoundPtr;
        if ( SoundPtr )
        {
          CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
          this->m_EngineSounds[1].SoundPtr = 0;
        }
      }
    }
    else
    {
      v14 = (unsigned __int16)this->m_DummyEngineBank;
      v15 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v15 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v15 >> 14)) != v14 )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(v14);
      }
    }
  }
}
// 3AF480: using guessed type int dword_3AF480[4];
// 3AF498: using guessed type int dword_3AF498[2];
// 3AF4A0: using guessed type int dword_3AF4A0[2];
// 3AF4A8: using guessed type int dword_3AF4A8;
// 3AF4AC: using guessed type int;

//----- (003AF4BC) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerTrainBrakes(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  CPad *Pad; // r0
  CVehicle *pVehicle; // r4
  CPad *v6; // r5
  float v7; // s18
  float v8; // s2
  __int16 m_pRwObject; // r0
  float x; // s20
  float v11; // s4
  float v12; // s0
  float v13; // s16
  int Brake; // r6
  int Accelerate; // s0
  __int16 v16; // r0
  int m_PlayerEngineBank; // r1
  float PiecewiseLinear; // r0
  int IsSoundBankLoaded; // r0
  bool v20; // zf
  float v21; // r0
  CAESound v22; // [sp+4h] [bp-A4h] BYREF

  Pad = CPad::GetPad(0);
  pVehicle = VehicleParams->pVehicle;
  v6 = Pad;
  v7 = 0.0;
  v8 = 1.0;
  m_pRwObject = (__int16)pVehicle[1].m_pRwObject;
  x = 0.0;
  v11 = 0.0;
  if ( (m_pRwObject & 0x100) == 0 )
    x = pVehicle[1].m_transform.m_translate.x;
  if ( (m_pRwObject & 0x40) == 0 )
    x = -x;
  v12 = fabsf(x);
  v13 = v12;
  if ( v12 > 1.0 )
    v11 = 1.0;
  if ( v12 < 0.0 )
    v8 = v11;
  if ( v12 > 1.0 )
    v13 = v8;
  if ( v12 < 0.0 )
    v13 = v8;
  if ( *(_BYTE *)&pVehicle->m_info <= 7u )
  {
    if ( v12 >= 0.001 )
    {
      Brake = CPad::GetBrake(v6);
      if ( x <= 0.0 )
      {
        Accelerate = CPad::GetAccelerate(v6);
      }
      else
      {
        CPad::GetAccelerate(v6);
        Accelerate = Brake;
      }
      v7 = (float)Accelerate;
    }
    else
    {
      CPad::GetAccelerate(v6);
      CPad::GetBrake(v6);
    }
  }
  v16 = (__int16)pVehicle[1].m_pRwObject;
  if ( (v16 & 0x100) != 0 )
  {
    v22.m_pPhysicalEntity = 0;
    m_PlayerEngineBank = (unsigned __int16)this->m_PlayerEngineBank;
    if ( m_PlayerEngineBank != 0xFFFF )
      goto LABEL_28;
    goto LABEL_34;
  }
  if ( (v16 & 8) == 0 )
  {
    v22.m_pPhysicalEntity = 0;
    m_PlayerEngineBank = (unsigned __int16)this->m_PlayerEngineBank;
    if ( m_PlayerEngineBank != 0xFFFF )
      goto LABEL_28;
    goto LABEL_34;
  }
  PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(
                      v13,
                      4,
                      CAEVehicleAudioEntity::ProcessPlayerTrainBrakes(cVehicleParams &)::fTrainBrakeVolume);
  if ( (float)((float)(v7 / 255.0) * PiecewiseLinear) < -100.0 )
  {
    v22.m_pPhysicalEntity = 0;
    m_PlayerEngineBank = (unsigned __int16)this->m_PlayerEngineBank;
    if ( m_PlayerEngineBank != 0xFFFF )
    {
LABEL_28:
      IsSoundBankLoaded = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_PlayerEngineBank, 40);
      v20 = IsSoundBankLoaded == 0;
      if ( IsSoundBankLoaded )
        v20 = (unsigned __int16)this->m_SurfaceSoundID == 0xFFFF;
      if ( !v20 )
      {
        if ( this->m_SkidSound.m_bCurrentlyInUse )
          CAETwinLoopSoundEntity::StopSoundAndForget(&this->m_SkidSound);
        this->m_SurfaceSoundID = -1;
      }
    }
LABEL_34:
    CAESound::~CAESound(&v22);
    return;
  }
  v21 = CAEAudioUtility::AudioLog10((float)(v7 / 255.0) * PiecewiseLinear);
  CAEVehicleAudioEntity::PlayTrainBrakeSound(this, 0, (float)(v13 * 0.32) + 0.68, (float)(v21 * 20.0) + 9.0);
}

//----- (003AF6B0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::UpdateGasPedalAudio(
        CAEVehicleAudioEntity *this,
        CVehicle *pVehicle,
        Int32 nVehicleType)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  UInt32 *p_LastTimeWeStartedTempActReverse; // r0

  if ( nVehicleType == 9 )
  {
    p_LastTimeWeStartedTempActReverse = (UInt32 *)&pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[9];
  }
  else
  {
    if ( nVehicleType )
      return;
    p_LastTimeWeStartedTempActReverse = &pVehicle[1].AutoPilot.LastTimeWeStartedTempActReverse;
  }
  v3.n64_f32[0] = fabsf(pVehicle->m_fGasPedal);
  v4.n64_u32[0] = *p_LastTimeWeStartedTempActReverse;
  if ( v3.n64_f32[0] <= *(float *)p_LastTimeWeStartedTempActReverse )
  {
    v4.n64_f32[0] = v4.n64_f32[0] + -0.07;
    *p_LastTimeWeStartedTempActReverse = vmax_f32(v4, v3).n64_u32[0];
  }
  else
  {
    v4.n64_f32[0] = v4.n64_f32[0] + 0.09;
    *p_LastTimeWeStartedTempActReverse = vmin_f32(v4, v3).n64_u32[0];
  }
}
// 3AF6E6: variable 'v4' is possibly undefined
// 3AF6E6: variable 'v3' is possibly undefined

//----- (003AF70C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessVehicleRoadNoise(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d4
  int32 nBaseVehicleType; // r0
  Int16 v6; // r5
  CVehicle *pVehicle; // r0
  CVehicle **p_pVehicle; // r6
  unsigned __int8 *p_TempActionFinish; // r2
  int v10; // r2
  int m_nModelIndex; // r3
  bool v12; // zf
  bool v13; // zf
  float v14; // s18
  float v15; // s16
  bool v16; // zf
  float fSpeed; // s0
  CEntity *m_pGameEntity; // r2
  CMatrix *m_pMat; // r3
  CSimpleTransform *p_tx; // r4
  CSimpleTransform *p_m_transform; // r2
  float32x2_t v22; // d16
  float v23; // s20
  unsigned __int64 v24; // d2
  float v25; // s2
  float v26; // s22

  nBaseVehicleType = VehicleParams->nBaseVehicleType;
  v6 = -1;
  if ( !nBaseVehicleType )
  {
    p_pVehicle = &VehicleParams->pVehicle;
    pVehicle = VehicleParams->pVehicle;
    p_TempActionFinish = (unsigned __int8 *)&pVehicle[1].AutoPilot.TempActionFinish;
    goto LABEL_5;
  }
  if ( nBaseVehicleType == 9 )
  {
    p_pVehicle = &VehicleParams->pVehicle;
    pVehicle = VehicleParams->pVehicle;
    p_TempActionFinish = (unsigned __int8 *)&pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[8].SoundPtr;
LABEL_5:
    v10 = *p_TempActionFinish;
    goto LABEL_7;
  }
  p_pVehicle = &VehicleParams->pVehicle;
  pVehicle = VehicleParams->pVehicle;
  v10 = 4;
LABEL_7:
  m_nModelIndex = pVehicle->m_nModelIndex;
  v12 = m_nModelIndex == 584;
  if ( m_nModelIndex < 584 )
  {
    v13 = m_nModelIndex == 435;
    if ( m_nModelIndex != 435 )
      v13 = m_nModelIndex == 450;
    if ( !v13 )
      goto LABEL_17;
LABEL_12:
    if ( !v10 )
    {
      v14 = 1.0;
      v15 = -100.0;
      goto LABEL_33;
    }
    goto LABEL_20;
  }
  if ( m_nModelIndex != 584 )
    v12 = m_nModelIndex == 591;
  if ( v12 )
    goto LABEL_12;
LABEL_17:
  v14 = 1.0;
  v16 = v10 == 0;
  v15 = -100.0;
  if ( v10 )
    v16 = VehicleParams->pTransmission == 0;
  if ( !v16 )
  {
LABEL_20:
    fSpeed = VehicleParams->fSpeed;
    v15 = -100.0;
    if ( fSpeed == 0.0 )
    {
      v14 = 1.0;
    }
    else
    {
      v3.n64_u32[0] = 1.0;
      m_pGameEntity = this->m_pGameEntity;
      v2.n64_f32[0] = fabsf(fSpeed);
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform;
      p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
      if ( !TheCamera.m_pMat )
        p_m_transform = &TheCamera.m_transform;
      v2.n64_f32[0] = v2.n64_f32[0] + v2.n64_f32[0];
      v22.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
      LODWORD(v23) = vmin_f32(v2, v3).n64_u32[0];
      v24 = vmul_f32(v22, v22).n64_u64[0];
      v25 = sqrtf(
              (float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                            * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                    + *(float *)&v24)
            + *((float *)&v24 + 1))
          / 72.0;
      v14 = (float)(v25 * 0.5) + 0.75;
      if ( v25 < 1.0 )
        v14 = 1.25;
      if ( SurfaceInfos_c::IsAudioGrass(&g_surfaceInfos, pVehicle->m_LastMaterialToHaveBeenStandingOn)
        || SurfaceInfos_c::IsAudioLongGrass(&g_surfaceInfos, (*p_pVehicle)->m_LastMaterialToHaveBeenStandingOn) )
      {
        v26 = -12.0;
        v6 = 21;
        v14 = v14 * 1.3;
      }
      else
      {
        v26 = -7.5;
        if ( SurfaceInfos_c::IsAudioGravel(&g_surfaceInfos, (*p_pVehicle)->m_LastMaterialToHaveBeenStandingOn) )
        {
          v6 = 22;
        }
        else
        {
          v6 = 22;
          if ( !SurfaceInfos_c::IsAudioSand(&g_surfaceInfos, (*p_pVehicle)->m_LastMaterialToHaveBeenStandingOn) )
          {
            v26 = -7.5;
            if ( !SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, (*p_pVehicle)->m_LastMaterialToHaveBeenStandingOn) )
            {
              v26 = -12.0;
              v6 = 21;
            }
          }
        }
      }
      if ( v23 > 0.00008 )
        v15 = v26 + (float)(CAEAudioUtility::AudioLog10(v23) * 20.0);
    }
  }
LABEL_33:
  CAEVehicleAudioEntity::PlayRoadNoiseSound(this, v6, v14, v15);
}
// 3AF7E4: variable 'v2' is possibly undefined
// 3AF7E4: variable 'v3' is possibly undefined

//----- (003AF914) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessVehicleSkidding(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  float32x2_t v2; // d5
  float32x2_t v3; // d9
  int32 nBaseVehicleType; // r0
  CVehicle *pVehicle; // r12
  float *p_m_fDistanceFromCameraLastFrame; // r1
  float ActualSpeed; // r3
  int SoundPtr_low; // r0
  bool v11; // zf
  float v12; // s0
  char *p_SoundPtr; // r2
  unsigned __int8 v14; // r8
  int v15; // r3
  float v16; // s16
  Int16 v17; // r4
  float v18; // s20
  float v19; // s4
  float v20; // s7
  unsigned int v21; // r5
  float v22; // s10
  float v23; // s8
  int v24; // r0
  int v25; // r4
  bool v26; // zf
  int m_nDriveType; // r4
  float v28; // s2
  float v29; // s0
  float v30; // s0

  nBaseVehicleType = VehicleParams->nBaseVehicleType;
  if ( nBaseVehicleType == 9 )
  {
    pVehicle = VehicleParams->pVehicle;
    v15 = 0;
    v14 = 2;
    SoundPtr_low = LOBYTE(pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[8].SoundPtr);
    v12 = *(float *)&pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[9].EngineSoundType;
    p_m_fDistanceFromCameraLastFrame = &pVehicle[1].m_VehicleAudioEntity.ScratchSound.m_fDistanceFromCameraLastFrame;
    p_SoundPtr = (char *)&pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[9].SoundPtr;
    if ( *(_DWORD *)&pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[10].EngineSoundType != 2 )
      v15 = 1;
  }
  else
  {
    if ( nBaseVehicleType )
      return;
    pVehicle = VehicleParams->pVehicle;
    p_m_fDistanceFromCameraLastFrame = (float *)&pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[6].SoundPtr;
    ActualSpeed = pVehicle[1].AutoPilot.ActualSpeed;
    SoundPtr_low = LOBYTE(pVehicle[1].AutoPilot.TempActionFinish);
    v11 = LODWORD(ActualSpeed) == 2;
    v12 = *(float *)&pVehicle[1].AutoPilot.LastTimeWeStartedTempActReverse;
    p_SoundPtr = (char *)&pVehicle[1].AutoPilot.WhatToTryForReverse;
    if ( LODWORD(ActualSpeed) != 2 )
      v11 = *(_DWORD *)&pVehicle[1].AutoPilot.CruiseSpeed == 2;
    v15 = !v11;
    v14 = 4;
  }
  v3.n64_u32[0] = 1.0;
  v16 = 0.0;
  v17 = -1;
  if ( !SoundPtr_low )
  {
    v18 = 0.0;
    goto LABEL_58;
  }
  v18 = 0.0;
  v17 = -1;
  if ( CTimer::ms_fTimeScale == 0.0 )
    goto LABEL_58;
  v3.n64_u32[0] = 1.0;
  v19 = fabsf(VehicleParams->fSpeed);
  v16 = 0.0;
  v20 = 0.0;
  v21 = 0;
  v2.n64_f32[0] = v19 * 5.0;
  v22 = vmin_f32(v2, v3).n64_f32[0] * 1.2;
  v23 = v19 * 0.75;
  if ( v19 > 1.0 )
    v23 = 0.75;
  do
  {
    v24 = *(_DWORD *)&p_SoundPtr[4 * v21];
    if ( v24 && *p_m_fDistanceFromCameraLastFrame > 0.0 )
    {
      if ( !v15 )
        goto LABEL_23;
      v25 = (unsigned __int8)v21 | 2;
      v26 = v25 == 2;
      if ( v25 == 2 )
        v26 = v24 == 2;
      if ( !v26 )
      {
LABEL_23:
        m_nDriveType = VehicleParams->pTransmission->m_nDriveType;
        if ( m_nDriveType != 52 )
        {
          if ( m_nDriveType != 70 )
          {
            if ( m_nDriveType != 82 )
            {
LABEL_44:
              v16 = v16 + v20;
              goto LABEL_45;
            }
            if ( ((unsigned __int8)v21 | 2) == 3 )
              goto LABEL_27;
LABEL_34:
            if ( v24 != 3 )
            {
              v20 = 0.0;
              if ( v24 == 2 )
              {
                v20 = v23;
                if ( this->m_VehicleAudioSetting.VehicleAudioType == 2 )
                  v20 = v23 * 0.2;
              }
              goto LABEL_44;
            }
            goto LABEL_39;
          }
          if ( ((unsigned __int8)v21 | 2) != 2 )
            goto LABEL_34;
        }
LABEL_27:
        if ( v24 != 3 )
        {
          if ( v24 == 2 )
          {
            v20 = 0.75;
            if ( v19 <= 1.0 )
              v20 = v19 * 0.75;
          }
          else
          {
            v20 = 0.0;
            if ( v24 == 1 )
            {
              v20 = 0.0;
              if ( v12 > 0.4 )
                v20 = (float)((float)(v12 + -0.4) / 0.6) * 0.75;
            }
          }
          goto LABEL_44;
        }
LABEL_39:
        v20 = 0.0;
        if ( v19 > 0.04 )
          v20 = v22;
        goto LABEL_44;
      }
    }
LABEL_45:
    ++v21;
    ++p_m_fDistanceFromCameraLastFrame;
  }
  while ( v21 < v14 );
  if ( v16 <= 0.0 )
  {
    v18 = 0.0;
    v17 = -1;
  }
  else
  {
    if ( this->m_VehicleAudioSetting.VehicleAudioType == 2 )
    {
      v18 = -12.0;
      v17 = 0;
      v3.n64_f32[0] = (float)(v16 * 0.25) + 0.9;
      goto LABEL_58;
    }
    if ( SurfaceInfos_c::IsAudioGrass(&g_surfaceInfos, pVehicle->m_LastMaterialToHaveBeenStandingOn)
      || SurfaceInfos_c::IsAudioLongGrass(&g_surfaceInfos, VehicleParams->pVehicle->m_LastMaterialToHaveBeenStandingOn) )
    {
      v28 = v16 * 0.2;
      v29 = -12.0;
      v17 = 6;
      goto LABEL_54;
    }
    if ( SurfaceInfos_c::IsAudioGravel(&g_surfaceInfos, VehicleParams->pVehicle->m_LastMaterialToHaveBeenStandingOn)
      || SurfaceInfos_c::IsAudioSand(&g_surfaceInfos, VehicleParams->pVehicle->m_LastMaterialToHaveBeenStandingOn)
      || SurfaceInfos_c::IsAudioWater(&g_surfaceInfos, VehicleParams->pVehicle->m_LastMaterialToHaveBeenStandingOn) )
    {
      v28 = v16 * 0.2;
      v29 = -9.0;
      v17 = 8;
LABEL_54:
      v3.n64_f32[0] = v28 + 0.9;
    }
    else
    {
      v17 = 24;
      v3.n64_f32[0] = (float)(v16 * 0.125) + 0.8;
      if ( this->m_VehicleAudioSetting.VehicleAudioType == 1 )
        v3.n64_f32[0] = v3.n64_f32[0] * 1.2;
      v29 = 0.0;
    }
    if ( (this->m_VehicleAudioSetting.VehicleAudioType & 0xFE) == 4 )
      v29 = v29 + 12.0;
    v18 = v29 + 0.0;
  }
LABEL_58:
  if ( (float)(v16 / (float)v14) <= 0.00001 )
  {
    v30 = -100.0;
    v17 = -1;
  }
  else
  {
    v30 = v18 + (float)(CAEAudioUtility::AudioLog10(v16 / (float)v14) * 20.0);
    if ( v30 < -100.0 )
    {
      v17 = -1;
      v30 = -100.0;
    }
  }
  CAEVehicleAudioEntity::PlaySkidSound(this, v17, v3.n64_f32[0], v30);
}
// 3AFA1A: variable 'v2' is possibly undefined
// 3AFA1A: variable 'v3' is possibly undefined

//----- (003AFCB4) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessVehicleSirenAlarmHorn(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  int m_bWreckedVehicle; // r1
  CVehicle *pVehicle; // r0
  int CarAlarmState; // r2
  bool v7; // zf
  Bool8 v8; // r6
  Bool8 v9; // r4
  Bool8 v10; // r5
  CVehicle *v11; // r0
  UInt32 v12; // r1
  bool v13; // zf
  bool v14; // zf
  unsigned int m_cHorn; // r1
  UInt32 v16; // r2
  uint32 v17; // r1

  m_bWreckedVehicle = this->m_bWreckedVehicle;
  if ( this->m_bWreckedVehicle
    || !this->m_bUsesSiren
    || (v11 = VehicleParams->pVehicle, (*((_BYTE *)&v11->m_nVehicleFlags + 5) & 0x80) == 0)
    || (*(_BYTE *)&v11->m_info & 0xF8) == 32 )
  {
    pVehicle = VehicleParams->pVehicle;
    CarAlarmState = pVehicle->CarAlarmState;
    v7 = CarAlarmState == 0;
    if ( pVehicle->CarAlarmState )
      v7 = CarAlarmState == 0xFFFF;
    if ( v7 || (*(_BYTE *)&pVehicle->m_info & 0xF8) == 40 )
    {
      if ( m_bWreckedVehicle )
        goto LABEL_7;
      v14 = CarAlarmState == 0;
      if ( pVehicle->CarAlarmState )
        v14 = CarAlarmState == 0xFFFF;
      if ( !v14 && (*(_BYTE *)&pVehicle->m_info & 0xF8) != 40 )
        goto LABEL_7;
      m_cHorn = pVehicle->m_cHorn;
      if ( !m_cHorn )
        goto LABEL_7;
      if ( *(_BYTE *)&pVehicle->m_info >= 8u )
      {
        if ( m_cHorn >= 0x2D )
        {
          pVehicle->m_cHorn = 44;
          pVehicle = VehicleParams->pVehicle;
          m_cHorn = pVehicle->m_cHorn;
        }
        if ( m_cHorn == 44 )
        {
          VehicleParams->pVehicle->m_nHornPattern = CAEAudioUtility::GetRandomNumberInRange(0, 7);
          pVehicle = VehicleParams->pVehicle;
          m_cHorn = pVehicle->m_cHorn;
        }
        if ( !HornPattern[pVehicle->m_nHornPattern][44 - m_cHorn] )
        {
LABEL_7:
          v8 = 0;
          v9 = 0;
          v10 = 0;
          goto LABEL_33;
        }
      }
      v10 = 1;
      v8 = 0;
    }
    else
    {
      v10 = 0;
      v16 = pVehicle->m_cHorn;
      v8 = 0;
      v17 = CTimer::m_snTimeInMilliseconds;
      if ( CTimer::m_snTimeInMilliseconds > v16 )
      {
        pVehicle->m_cHorn = CTimer::m_snTimeInMilliseconds + 750;
        v16 = VehicleParams->pVehicle->m_cHorn;
      }
      if ( v16 < v17 + 375 )
        v10 = 1;
    }
    v9 = 0;
    goto LABEL_33;
  }
  v12 = v11->m_cHorn;
  v13 = v12 == 0;
  if ( v12 )
    v13 = v11->m_nModelIndex == 423;
  if ( v13 )
  {
    v9 = 1;
    v8 = 0;
    v10 = 0;
  }
  else
  {
    v10 = 0;
    v8 = 1;
    v9 = 1;
  }
LABEL_33:
  CAEVehicleAudioEntity::PlayHornOrSiren(this, v10, v9, v8, VehicleParams);
  this->m_bSirenOn = v9;
  this->m_bHornOn = v10;
  this->m_bFastSirenOn = v8;
}

//----- (003AFE04) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerVehicleEngine(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d8
  double v5; // d16
  CVehicle *pVehicle; // r6
  CPad *PadFromPlayer; // r5
  Int16 Brake; // r0
  float fSpeed; // s18
  cTransmission *pTransmission; // r1
  float v13; // s2
  float v14; // s20
  float v15; // s0
  float v16; // s4
  float v17; // s4
  bool v18; // fzf
  bool v19; // fnf
  CVehicle *v20; // r5
  int m_nCurrentGear; // r0
  float v22; // s2
  bool v23; // nf
  float v24; // s22
  int32 nBaseVehicleType; // r1
  UInt8 v26; // r1
  float *p_m_DummyEngineBank; // r1
  UInt8 v28; // r1
  CVehicle::CVehicleFlags *p_m_nVehicleFlags; // r0
  int v30; // r6
  char *v31; // r5
  __int16 m_nLength; // r4
  CAESound *v33; // r0
  CAESound **v34; // r5
  CAESound *v35; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v37; // r0
  int i; // r5
  int v39; // r0
  char *v40; // r6
  __int16 v41; // r4
  CAESound *v42; // r0
  CAESound **v43; // r6
  CAESound *v44; // t1
  Int16 v45; // r0
  int j; // r5
  int v47; // r0
  char *v48; // r6
  __int16 v49; // r4
  CAESound *v50; // r0
  CAESound **v51; // r6
  CAESound *v52; // t1
  Int16 v53; // r0
  int k; // r5
  int v55; // r0
  char *v56; // r6
  __int16 v57; // r4
  CAESound *v58; // r0
  CAESound **v59; // r6
  CAESound *v60; // t1
  Int16 v61; // r0
  int m; // r5
  int v63; // r0
  char *v64; // r6
  __int16 v65; // r4
  CAESound *v66; // r0
  CAESound **v67; // r6
  CAESound *v68; // t1
  Int16 v69; // r0
  Int8 v70; // r0
  int ThisAccel; // r0
  int v72; // r5
  CAESound *v73; // r0
  __int16 v74; // r4
  Int16 v75; // r0
  float v76; // s0
  int v77; // r0
  int v78; // r0
  float v79; // r0
  CEntity *v80; // r1
  float v81; // s2
  float EngineVolumeOffset; // s0
  float v83; // s4
  CAESound *v84; // r0
  int v85; // r0
  int IsSoundBankLoaded; // r0
  int m_bSingleGear; // r5
  float v88; // s0
  int FreqForPlayerEngineSound; // r2
  float v90; // s0
  int v91; // r0
  float v92; // s0
  CAESound *v93; // r0
  __int16 v94; // r4
  int v95; // r0
  int v96; // r1
  float v97; // s0
  float v98; // s2
  float v99; // s0
  float v100; // s2
  CAESound *v101; // r1
  float v102; // s4
  float v103; // s2
  int v104; // r0
  float v105; // s0
  CAESound *v106; // r0
  int v107; // r0
  float v108; // s0
  CAESound *v109; // r0
  CAESound *v110; // r0
  CAESound *v111; // r0
  float v112; // r2
  float v113; // s0
  float v114; // r0
  float v115; // s0
  float v116; // s2
  CEntity *v117; // r1
  float v118; // s2
  float v119; // s2
  float v120; // s0
  float v121; // s2
  CAESound *v122; // r1
  float v123; // s0
  CAESound *v124; // r0
  __int16 v125; // r4
  Int16 v126; // r0
  float v127; // s0
  int v128; // r0
  CEntity *m_pGameEntity; // r0
  float v130; // s2
  float v131; // s2
  float v132; // s0
  CAEVehicleAudioEntity *v133; // r0
  cVehicleParams *v134; // r1
  CAESound *v135; // r0
  Int16 v136; // r0
  float v137; // s0
  int v138; // r0
  float v139; // r2
  CEntity *v140; // r0
  float v141; // s2
  float v142; // s2
  float v143; // s0
  float v144; // s2
  CVehicle *v145; // r0
  int v146; // r2
  int v147; // r3
  CAEVehicleAudioEntity *v148; // r0
  UInt32 v149; // r1
  int m_FramesAgoACLooped; // r0
  CAESound *v151; // r0
  CAESound *v152; // r0
  float fPrevSpeed; // s2
  float v154; // s4
  float v155; // s18
  CAESound *v156; // r0
  CEntity *v157; // r0
  float v158; // s2
  float v159; // s2
  float v160; // s0
  float v161; // s2
  float v162; // s0
  float v163; // s2
  float v164; // s2
  CAESound *v165; // r0
  CAESound *v166; // r0
  float v167; // r2
  float v168; // s0
  CAESound *v169; // r0
  CAESound *SoundPtr; // r0
  float v171; // r2
  float v172; // s0
  CAESound *v173; // r0
  CAESound *v174; // r0
  CAESound *v175; // r0
  unsigned int v176; // r4
  unsigned int m_AudioGear; // r0
  float v178; // r0
  float v179; // s0
  CEntity *v180; // r1
  float v181; // s2
  float v182; // s2
  float v183; // s2
  int v184; // r0
  bool v185; // nf
  CAESound *v186; // r1
  int v187; // r1
  int NumGears; // r0
  int v189; // r0
  unsigned int v190; // r1
  int v191; // r0
  CVehicle *v192; // r0
  int v193; // r2
  CAESound *v194; // r0
  __int16 v195; // r4
  Int16 v196; // r0
  float v197; // s0
  int v198; // r0
  float v199; // s0
  CEntity *v200; // r0
  float v201; // s2
  float v202; // s2
  float v203; // s0
  float v204; // s2
  CAESound *v205; // r0
  float m_fEventVolume; // s4
  CEntity *v207; // r0
  float v208; // s2
  float v209; // s2
  float v210; // s0
  float v211; // s2
  CEntity *v212; // r0
  float v213; // s2
  float v214; // s2
  float m_CurrentNitroRatio; // s2
  __int16 v216; // r5
  CAESound *v217; // r0
  Int16 v218; // r0
  float v219; // s0
  int v220; // r0
  CAESound *v221; // r0
  float v222; // s0
  float v223; // r2
  UInt8 v224; // r0
  CVehicle *v225; // r0
  int v226; // r2
  float v227; // r0
  float v228; // s0
  float v229; // r2
  float v230; // s0
  CEntity *v231; // r0
  float v232; // s2
  float v233; // s2
  float v234; // s0
  float v235; // s2
  unsigned int RealGear; // r4
  CEntity *v237; // r0
  float v238; // s2
  float v239; // s2
  float v240; // s0
  float v241; // s2
  CEntity *v242; // r1
  float v243; // s2
  float v244; // s2
  float v245; // s2

  pVehicle = vp->pVehicle;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, this->m_DummySlot) )
  {
    if ( !CAEVehicleAudioEntity::s_pPlayerDriver
      || this->m_bPlayerDriverAboutToExit
      || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
      || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
    {
      Brake = 0;
      vp->ThisAccel = 0;
    }
    else
    {
      PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
      vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
      Brake = CPad::GetBrake(PadFromPlayer);
    }
    fSpeed = vp->fSpeed;
    v4.n64_u32[0] = 1.0;
    pTransmission = vp->pTransmission;
    v13 = fabsf(fSpeed);
    vp->ThisBrake = Brake;
    vp->fAbsSpeed = v13;
    v14 = v13 / pTransmission->m_fMaxVelocity;
    v15 = 0.0;
    v16 = v14;
    if ( v14 > 1.0 )
      v16 = 1.0;
    v23 = v16 < 0.0;
    v17 = 1.0;
    v18 = v14 == 1.0;
    v19 = v14 < 1.0;
    if ( v23 )
    {
      v17 = 0.0;
      v14 = 0.0;
    }
    if ( !v19 && !v18 )
      v14 = v17;
    v20 = vp->pVehicle;
    vp->fSpeedRatio = v14;
    m_nCurrentGear = v20->m_nCurrentGear;
    vp->RealGear = m_nCurrentGear;
    vp->bHandbrakeOn = (*(_BYTE *)&v20->m_nVehicleFlags & 0x20) != 0;
    v22 = (float)(v13 - pTransmission->m_GearRatio[m_nCurrentGear].fChangeDownVelocity)
        / (float)(pTransmission->m_GearRatio[m_nCurrentGear].fMaxVelocity
                - pTransmission->m_GearRatio[m_nCurrentGear].fChangeDownVelocity);
    v23 = v22 < 1.0;
    if ( v22 <= 1.0 )
    {
      v5 = 0.0;
      v23 = v22 < 0.0;
    }
    if ( !v23 )
    {
      if ( v22 <= 1.0 )
        v5 = v22;
      else
        v5 = 1.0;
    }
    v24 = v5;
    if ( !m_nCurrentGear )
      v24 = 0.0;
    vp->fRealRevsRatio = v24;
    vp->fWheelSpin = pVehicle->m_fWheelSpinForAudio;
    vp->NumGears = pTransmission->m_nNumberOfGears;
    if ( fSpeed != 0.0 )
      v15 = v20->m_vecMoveSpeed.z / fSpeed;
    nBaseVehicleType = vp->nBaseVehicleType;
    vp->fZOverSpeed = v15;
    if ( nBaseVehicleType == 9 )
    {
      vp->NumDriveWheelsOnGround = BYTE1(v20[1].m_VehicleAudioEntity.m_EngineSounds[8].SoundPtr);
      v28 = BYTE2(v20[1].m_VehicleAudioEntity.m_EngineSounds[8].SoundPtr);
      vp->p_fGasPedalAudioRevs = (float *)&v20[1].m_VehicleAudioEntity.m_EngineSounds[9].EngineSoundType;
      vp->NumDriveWheelsOnGroundLastFrame = v28;
      vp->pWheelState = (tWheelState *)&v20[1].m_VehicleAudioEntity.m_EngineSounds[9].SoundPtr;
      p_m_DummyEngineBank = (float *)&v20[1].m_VehicleAudioEntity.m_DummyEngineBank;
    }
    else
    {
      if ( nBaseVehicleType )
        return;
      vp->NumDriveWheelsOnGround = BYTE1(v20[1].AutoPilot.TempActionFinish);
      v26 = BYTE2(v20[1].AutoPilot.TempActionFinish);
      vp->p_fGasPedalAudioRevs = (float *)&v20[1].AutoPilot.LastTimeWeStartedTempActReverse;
      vp->NumDriveWheelsOnGroundLastFrame = v26;
      vp->pWheelState = (tWheelState *)&v20[1].AutoPilot.WhatToTryForReverse;
      p_m_DummyEngineBank = &v20[1].m_VehicleAudioEntity.m_SkidSound.ScratchSound.m_fDistanceFromCamera;
    }
    vp->fPrevSpeed = *p_m_DummyEngineBank;
    if ( this->m_bSingleGear )
    {
      vp->NumGears = 1;
      vp->RealGear = m_nCurrentGear != 0;
    }
    p_m_nVehicleFlags = &v20->m_nVehicleFlags;
    switch ( this->m_State )
    {
      case 0:
        if ( (*(_BYTE *)p_m_nVehicleFlags & 0x10) == 0 )
        {
          v30 = 0;
          while ( 1 )
          {
            if ( v30 == 9 )
              goto LABEL_33;
            v31 = (char *)this + 8 * v30;
            m_nLength = -1;
            v35 = (CAESound *)*((_DWORD *)v31 + 58);
            v34 = (CAESound **)(v31 + 232);
            v33 = v35;
            if ( v35 )
            {
              m_nLength = v33->m_nLength;
              CAESound::SetIndividualEnvironment(v33, 4u, 0);
              CAESound::StopSound(*v34);
              *v34 = 0;
            }
            if ( v30 == 4 )
            {
              m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
              this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
              this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
              this->m_ACPlayPositionLastFrame = -1;
              this->m_ACPlayPositionThisFrame = -1;
              if ( m_nLength < 1 )
              {
                LOWORD(v37) = 0;
              }
              else
              {
                v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
                v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
                v37 = (int)(float)(v2.n64_f32[0] * 100.0);
                if ( v2.n64_f32[0] < 0.0 )
                  LOWORD(v37) = 0;
              }
              this->m_ACPlayPercentWhenStopped = v37;
LABEL_33:
              ++v30;
            }
            else if ( ++v30 == 12 )
            {
              goto LABEL_97;
            }
          }
        }
        CAEVehicleAudioEntity::AddAudioEvent(this, 103, 0.0);
        ThisAccel = vp->ThisAccel;
        if ( fSpeed < -0.001 )
        {
          if ( ThisAccel >= 151 )
            goto LABEL_184;
LABEL_129:
          FreqForPlayerEngineSound = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 2);
          if ( vp->pVehicle->m_nModelIndex == 457 )
            v90 = -33.0;
          else
            v90 = (float)(vp->fSpeedRatio * 1.5) + -3.0;
          m_pGameEntity = this->m_pGameEntity;
          v130 = v90 + -6.0;
          if ( (m_pGameEntity[17].m_areaCode & 0x40) == 0 )
            v130 = v90;
          v131 = this->m_VehicleAudioSetting.EngineVolumeOffset + v130;
          v132 = v131 + 6.0;
          goto LABEL_287;
        }
        if ( ThisAccel < 1 )
          goto LABEL_243;
        IsSoundBankLoaded = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40);
        if ( vp->fWheelSpin > 5.0
          || !IsSoundBankLoaded
          || vp->ThisBrake > 0
          || vp->bHandbrakeOn
          || !vp->NumDriveWheelsOnGround
          || (m_bSingleGear = this->m_bSingleGear, v88 = vp->fSpeed, !this->m_bSingleGear) && v88 < 0.1 )
        {
          if ( vp->ThisAccel >= 151 )
            goto LABEL_184;
          goto LABEL_129;
        }
        if ( vp->ThisAccel < 151 )
        {
LABEL_243:
          v147 = -1027080192;
          v148 = this;
          FreqForPlayerEngineSound = 1065353216;
          goto LABEL_294;
        }
        if ( vp->RealGear < vp->NumGears && v88 < (float)(vp->fPrevSpeed + 0.001) && vp->fZOverSpeed > 0.2 )
        {
          v145 = vp->pVehicle;
          v146 = *((_DWORD *)&v145->m_nVehicleFlags + 1);
          *(_DWORD *)&v145->m_nVehicleFlags |= 0x20000000u;
          *((_DWORD *)&v145->m_nVehicleFlags + 1) = v146;
          goto LABEL_306;
        }
        SoundPtr = this->m_EngineSounds[5].SoundPtr;
        if ( SoundPtr )
        {
          CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[5].SoundPtr);
          m_bSingleGear = this->m_bSingleGear;
          this->m_EngineSounds[5].SoundPtr = 0;
        }
        v171 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 4);
        if ( m_bSingleGear )
        {
          v172 = -2.0;
LABEL_392:
          v212 = this->m_pGameEntity;
          v213 = v172 + -6.0;
          if ( (v212[17].m_areaCode & 0x40) == 0 )
            v213 = v172;
          v214 = this->m_VehicleAudioSetting.EngineVolumeOffset + v213;
          v203 = v214 + 6.0;
          if ( !*(_DWORD *)&v212[20].RandomSeed )
            v203 = v214;
          if ( this->m_bNitroOnLastFrame )
          {
            m_CurrentNitroRatio = this->m_CurrentNitroRatio;
            if ( m_CurrentNitroRatio <= 1.0 && m_CurrentNitroRatio >= 0.0 )
              v203 = v203 + (float)(m_CurrentNitroRatio * 3.0);
          }
LABEL_400:
          CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(this, 4, v171, v203);
          v70 = 3;
LABEL_296:
          this->m_State = v70;
          return;
        }
        m_AudioGear = this->m_AudioGear;
        goto LABEL_391;
      case 3:
        if ( (*(_BYTE *)p_m_nVehicleFlags & 0x10) == 0 )
        {
          for ( i = 0; i != 12; ++i )
          {
            while ( 1 )
            {
              v40 = (char *)this + 8 * i;
              v41 = -1;
              v44 = (CAESound *)*((_DWORD *)v40 + 58);
              v43 = (CAESound **)(v40 + 232);
              v42 = v44;
              if ( v44 )
              {
                v41 = v42->m_nLength;
                CAESound::SetIndividualEnvironment(v42, 4u, 0);
                CAESound::StopSound(*v43);
                *v43 = 0;
              }
              if ( i != 4 )
                break;
              v45 = this->m_ACPlayPositionThisFrame;
              this->m_ACPlayPositionWhenStopped = v45;
              this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
              this->m_ACPlayPositionLastFrame = -1;
              this->m_ACPlayPositionThisFrame = -1;
              if ( v41 < 1 )
              {
                LOWORD(v39) = 0;
              }
              else
              {
                v2.n64_f32[0] = (float)v45 / (float)v41;
                v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
                v39 = (int)(float)(v2.n64_f32[0] * 100.0);
                if ( v2.n64_f32[0] < 0.0 )
                  LOWORD(v39) = 0;
              }
              this->m_ACPlayPercentWhenStopped = v39;
              i = 5;
            }
          }
          goto LABEL_97;
        }
        v72 = vp->ThisAccel;
        if ( fSpeed < -0.001 )
        {
          v73 = this->m_EngineSounds[4].SoundPtr;
          v74 = -1;
          if ( v73 )
          {
            v74 = v73->m_nLength;
            CAESound::SetIndividualEnvironment(v73, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[4].SoundPtr);
            this->m_EngineSounds[4].SoundPtr = 0;
          }
          v75 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v75;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v74 < 1 )
          {
            LOWORD(v77) = 0;
          }
          else
          {
            v2.n64_f32[0] = (float)v75 / (float)v74;
            v76 = vmin_f32(v2, v4).n64_f32[0];
            v77 = (int)(float)(v76 * 100.0);
            if ( v76 < 0.0 )
              LOWORD(v77) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v77;
          v133 = this;
          v134 = vp;
          if ( v72 < 151 )
            goto LABEL_271;
          goto LABEL_229;
        }
        if ( v72 < 1 )
        {
          v135 = this->m_EngineSounds[4].SoundPtr;
          v94 = -1;
          if ( v135 )
          {
            v94 = v135->m_nLength;
            CAESound::SetIndividualEnvironment(v135, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[4].SoundPtr);
            this->m_EngineSounds[4].SoundPtr = 0;
          }
          goto LABEL_218;
        }
        v91 = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40);
        if ( vp->fWheelSpin <= 5.0 && v91 && vp->ThisBrake <= 0 && !vp->bHandbrakeOn && vp->NumDriveWheelsOnGround )
        {
          v92 = vp->fSpeed;
          if ( !this->m_bSingleGear && v92 < 0.1 )
          {
            v93 = this->m_EngineSounds[4].SoundPtr;
            v94 = -1;
            if ( v93 )
            {
              v94 = v93->m_nLength;
              CAESound::SetIndividualEnvironment(v93, 4u, 0);
              CAESound::StopSound(this->m_EngineSounds[4].SoundPtr);
              this->m_EngineSounds[4].SoundPtr = 0;
            }
LABEL_218:
            v136 = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = v136;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( v94 < 1 )
            {
              LOWORD(v138) = 0;
            }
            else
            {
              v2.n64_f32[0] = (float)v136 / (float)v94;
              v137 = vmin_f32(v2, v4).n64_f32[0];
              v138 = (int)(float)(v137 * 100.0);
              if ( v137 < 0.0 )
                LOWORD(v138) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v138;
            goto LABEL_270;
          }
          if ( vp->ThisAccel < 151 )
          {
            v169 = this->m_EngineSounds[4].SoundPtr;
            v94 = -1;
            if ( v169 )
            {
              v94 = v169->m_nLength;
              CAESound::SetIndividualEnvironment(v169, 4u, 0);
              CAESound::StopSound(this->m_EngineSounds[4].SoundPtr);
              this->m_EngineSounds[4].SoundPtr = 0;
            }
            goto LABEL_218;
          }
          if ( vp->RealGear < vp->NumGears
            && v92 < (float)(vp->fPrevSpeed + 0.001)
            && (vp->fZOverSpeed > 0.2 || CCullZones::DoExtraAirResistanceForPlayer() == 1) )
          {
            v149 = CTimer::m_snTimeInMilliseconds;
            if ( this->m_TimeBeforeAllowCruise >= CTimer::m_snTimeInMilliseconds )
            {
              v216 = -1;
              *(_DWORD *)&vp->pVehicle->m_nVehicleFlags |= 0x20000000u;
              v217 = this->m_EngineSounds[4].SoundPtr;
              if ( v217 )
              {
                v216 = v217->m_nLength;
                CAESound::SetIndividualEnvironment(v217, 4u, 0);
                CAESound::StopSound(this->m_EngineSounds[4].SoundPtr);
                this->m_EngineSounds[4].SoundPtr = 0;
                v149 = CTimer::m_snTimeInMilliseconds;
              }
              this->m_TimeACStopped = v149;
              v218 = this->m_ACPlayPositionThisFrame;
              this->m_ACPlayPositionLastFrame = -1;
              this->m_ACPlayPositionWhenStopped = v218;
              this->m_ACPlayPositionThisFrame = -1;
              if ( v216 < 1 )
              {
                LOWORD(v220) = 0;
              }
              else
              {
                v2.n64_f32[0] = (float)v218 / (float)v216;
                v219 = vmin_f32(v2, v4).n64_f32[0];
                v220 = (int)(float)(v219 * 100.0);
                if ( v219 < 0.0 )
                  LOWORD(v220) = 0;
              }
              this->m_ACPlayPercentWhenStopped = v220;
              v229 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 3);
              if ( this->m_bSingleGear )
                v230 = -2.0;
              else
                v230 = this->m_CrzCount * 0.013333;
              v231 = this->m_pGameEntity;
              v232 = v230 + -6.0;
              if ( (v231[17].m_areaCode & 0x40) == 0 )
                v232 = v230;
              v233 = this->m_VehicleAudioSetting.EngineVolumeOffset + v232;
              v234 = v233 + 6.0;
              if ( !*(_DWORD *)&v231[20].RandomSeed )
                v234 = v233;
              if ( this->m_bNitroOnLastFrame )
              {
                v235 = this->m_CurrentNitroRatio;
                if ( v235 <= 1.0 && v235 >= 0.0 )
                  v234 = v234 + (float)(v235 * 3.0);
              }
              CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(this, 3, v229, v234);
              this->m_TimeBeforeAllowAccelerate = CTimer::m_snTimeInMilliseconds + 2000;
              v70 = 5;
              goto LABEL_296;
            }
          }
          m_FramesAgoACLooped = this->m_FramesAgoACLooped;
          if ( m_FramesAgoACLooped <= 9 )
          {
            this->m_FramesAgoACLooped = m_FramesAgoACLooped + 1;
            goto LABEL_366;
          }
          v184 = this->m_ACPlayPositionThisFrame;
          v185 = v184 < 0;
          if ( v184 >= 0 )
            v185 = this->m_ACPlayPositionLastFrame < 0;
          if ( v185 || (v186 = this->m_EngineSounds[4].SoundPtr) == 0 || v186->m_nLength - 120 >= v184 )
          {
LABEL_366:
            v171 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 4);
            if ( this->m_bSingleGear )
              v199 = -2.0;
            else
              v199 = (float)((float)this->m_AudioGear * 0.4) + -2.0;
            v200 = this->m_pGameEntity;
            v201 = v199 + -6.0;
            if ( (v200[17].m_areaCode & 0x40) == 0 )
              v201 = v199;
            v202 = this->m_VehicleAudioSetting.EngineVolumeOffset + v201;
            v203 = v202 + 6.0;
            if ( !*(_DWORD *)&v200[20].RandomSeed )
              v203 = v202;
            if ( this->m_bNitroOnLastFrame )
            {
              v204 = this->m_CurrentNitroRatio;
              if ( v204 <= 1.0 && v204 >= 0.0 )
                v203 = v203 + (float)(v204 * 3.0);
            }
            v205 = this->m_EngineSounds[4].SoundPtr;
            if ( v205 )
            {
              m_fEventVolume = this->m_fEventVolume;
              v205->m_RelativeFrequency = v171;
              v205->m_EmittedVolume = v203 + m_fEventVolume;
              v70 = 3;
              goto LABEL_296;
            }
            goto LABEL_400;
          }
          this->m_FramesAgoACLooped = 0;
          v187 = this->m_AudioGear;
          NumGears = vp->NumGears;
          if ( v187 + 2 <= NumGears
            || vp->RealGear < NumGears
            && (v189 = CCullZones::DoExtraAirResistanceForPlayer(), v187 = this->m_AudioGear, v189 != 1) )
          {
            v224 = v187 + 1;
            if ( (unsigned int)(v187 + 1) >= 5 )
              v224 = 5;
            this->m_AudioGear = v224;
            v225 = vp->pVehicle;
            v226 = *((_DWORD *)&v225->m_nVehicleFlags + 1);
            *(_DWORD *)&v225->m_nVehicleFlags |= 0x20000000u;
            *((_DWORD *)&v225->m_nVehicleFlags + 1) = v226;
            v227 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 4);
            if ( this->m_bSingleGear )
              v228 = -2.0;
            else
              v228 = (float)((float)this->m_AudioGear * 0.4) + -2.0;
            v242 = this->m_pGameEntity;
            v243 = v228 + -6.0;
            if ( (v242[17].m_areaCode & 0x40) == 0 )
              v243 = v228;
            v244 = this->m_VehicleAudioSetting.EngineVolumeOffset + v243;
            v99 = v244 + 6.0;
            if ( !*(_DWORD *)&v242[20].RandomSeed )
              v99 = v244;
            if ( this->m_bNitroOnLastFrame )
            {
              v245 = this->m_CurrentNitroRatio;
              if ( v245 <= 1.0 && v245 >= 0.0 )
                v99 = v99 + (float)(v245 * 3.0);
            }
            v101 = this->m_EngineSounds[4].SoundPtr;
            if ( v101 )
            {
              v102 = this->m_fEventVolume;
              v103 = v227;
              v70 = 3;
              goto LABEL_162;
            }
            v70 = 3;
            goto LABEL_296;
          }
          v190 = v187 + 1;
          v191 = this->m_bSingleGear;
          if ( v190 >= 5 )
            LOBYTE(v190) = 5;
          this->m_AudioGear = v190;
          if ( !v191 )
          {
            v192 = vp->pVehicle;
            v193 = *((_DWORD *)&v192->m_nVehicleFlags + 1);
            *(_DWORD *)&v192->m_nVehicleFlags |= 0x20000000u;
            *((_DWORD *)&v192->m_nVehicleFlags + 1) = v193;
          }
          v194 = this->m_EngineSounds[4].SoundPtr;
          v195 = -1;
          if ( v194 )
          {
            v195 = v194->m_nLength;
            CAESound::SetIndividualEnvironment(v194, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[4].SoundPtr);
            this->m_EngineSounds[4].SoundPtr = 0;
          }
          v196 = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = v196;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( v195 < 1 )
          {
            LOWORD(v198) = 0;
          }
          else
          {
            v2.n64_f32[0] = (float)v196 / (float)v195;
            v197 = vmin_f32(v2, v4).n64_f32[0];
            v198 = (int)(float)(v197 * 100.0);
            if ( v197 < 0.0 )
              LOWORD(v198) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v198;
LABEL_306:
          v167 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 3);
          if ( this->m_bSingleGear )
            v168 = -2.0;
          else
            v168 = this->m_CrzCount * 0.013333;
          v207 = this->m_pGameEntity;
          v208 = v168 + -6.0;
          if ( (v207[17].m_areaCode & 0x40) == 0 )
            v208 = v168;
          v209 = this->m_VehicleAudioSetting.EngineVolumeOffset + v208;
          v210 = v209 + 6.0;
          if ( !*(_DWORD *)&v207[20].RandomSeed )
            v210 = v209;
          if ( this->m_bNitroOnLastFrame )
          {
            v211 = this->m_CurrentNitroRatio;
            if ( v211 <= 1.0 && v211 >= 0.0 )
              v210 = v210 + (float)(v211 * 3.0);
          }
          CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(this, 3, v167, v210);
          v70 = 5;
          goto LABEL_296;
        }
        v124 = this->m_EngineSounds[4].SoundPtr;
        v125 = -1;
        if ( v124 )
        {
          v125 = v124->m_nLength;
          CAESound::SetIndividualEnvironment(v124, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[4].SoundPtr);
          this->m_EngineSounds[4].SoundPtr = 0;
        }
        v126 = this->m_ACPlayPositionThisFrame;
        this->m_ACPlayPositionWhenStopped = v126;
        this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
        this->m_ACPlayPositionLastFrame = -1;
        this->m_ACPlayPositionThisFrame = -1;
        if ( v125 < 1 )
        {
          LOWORD(v128) = 0;
        }
        else
        {
          v2.n64_f32[0] = (float)v126 / (float)v125;
          v127 = vmin_f32(v2, v4).n64_f32[0];
          v128 = (int)(float)(v127 * 100.0);
          if ( v127 < 0.0 )
            LOWORD(v128) = 0;
        }
        this->m_ACPlayPercentWhenStopped = v128;
LABEL_227:
        if ( vp->ThisAccel >= 151 )
          goto LABEL_228;
LABEL_270:
        v133 = this;
        v134 = vp;
LABEL_271:
        v112 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(v133, v134, 5);
        if ( vp->pVehicle->m_nModelIndex != 457 )
          goto LABEL_189;
LABEL_272:
        v113 = -33.0;
        goto LABEL_273;
      case 4:
        if ( (*(_BYTE *)p_m_nVehicleFlags & 0x10) == 0 )
        {
          for ( j = 0; j != 12; ++j )
          {
            while ( 1 )
            {
              v48 = (char *)this + 8 * j;
              v49 = -1;
              v52 = (CAESound *)*((_DWORD *)v48 + 58);
              v51 = (CAESound **)(v48 + 232);
              v50 = v52;
              if ( v52 )
              {
                v49 = v50->m_nLength;
                CAESound::SetIndividualEnvironment(v50, 4u, 0);
                CAESound::StopSound(*v51);
                *v51 = 0;
              }
              if ( j != 4 )
                break;
              v53 = this->m_ACPlayPositionThisFrame;
              this->m_ACPlayPositionWhenStopped = v53;
              this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
              this->m_ACPlayPositionLastFrame = -1;
              this->m_ACPlayPositionThisFrame = -1;
              if ( v49 < 1 )
              {
                LOWORD(v47) = 0;
              }
              else
              {
                v2.n64_f32[0] = (float)v53 / (float)v49;
                v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
                v47 = (int)(float)(v2.n64_f32[0] * 100.0);
                if ( v2.n64_f32[0] < 0.0 )
                  LOWORD(v47) = 0;
              }
              this->m_ACPlayPercentWhenStopped = v47;
              j = 5;
            }
          }
          goto LABEL_97;
        }
        v78 = vp->ThisAccel;
        if ( fSpeed < -0.001 )
        {
          if ( v78 >= 151 )
          {
            v79 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 1);
            v80 = this->m_pGameEntity;
            v81 = (float)((float)(v24 * 4.0) + -4.0) + -6.0;
            if ( (v80[17].m_areaCode & 0x40) == 0 )
              v81 = (float)(v24 * 4.0) + -4.0;
            EngineVolumeOffset = this->m_VehicleAudioSetting.EngineVolumeOffset;
            v83 = 6.0;
LABEL_154:
            v98 = EngineVolumeOffset + v81;
            v99 = v98 + v83;
            if ( !*(_DWORD *)&v80[20].RandomSeed )
              v99 = v98;
            if ( this->m_bNitroOnLastFrame )
            {
              v100 = this->m_CurrentNitroRatio;
              if ( v100 <= 1.0 && v100 >= 0.0 )
                v99 = v99 + (float)(v100 * 3.0);
            }
            v101 = this->m_EngineSounds[1].SoundPtr;
            if ( v101 )
            {
              v102 = this->m_fEventVolume;
              v103 = v79;
              v70 = 4;
              goto LABEL_162;
            }
            v70 = 4;
            goto LABEL_296;
          }
LABEL_186:
          v111 = this->m_EngineSounds[1].SoundPtr;
          if ( v111 )
          {
            CAESound::SetIndividualEnvironment(v111, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
            this->m_EngineSounds[1].SoundPtr = 0;
            v20 = vp->pVehicle;
          }
          v112 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 5);
          if ( v20->m_nModelIndex == 457 )
            goto LABEL_272;
LABEL_189:
          v113 = (float)(vp->fSpeedRatio * 1.5) + -3.0;
LABEL_273:
          v157 = this->m_pGameEntity;
          v158 = v113 + -6.0;
          if ( (v157[17].m_areaCode & 0x40) == 0 )
            v158 = v113;
          v159 = this->m_VehicleAudioSetting.EngineVolumeOffset + v158;
          v160 = v159 + 6.0;
          if ( !*(_DWORD *)&v157[20].RandomSeed )
            v160 = v159;
          if ( this->m_bNitroOnLastFrame )
          {
            v161 = this->m_CurrentNitroRatio;
            if ( v161 <= 1.0 && v161 >= 0.0 )
              v160 = v160 + (float)(v161 * 3.0);
          }
          CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(this, 5, v112, v160);
          FreqForPlayerEngineSound = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 2);
          if ( vp->pVehicle->m_nModelIndex == 457 )
            v162 = -33.0;
          else
            v162 = (float)(vp->fSpeedRatio * 1.5) + -3.0;
          m_pGameEntity = this->m_pGameEntity;
          v163 = v162 + -6.0;
          if ( (m_pGameEntity[17].m_areaCode & 0x40) == 0 )
            v163 = v162;
          v131 = this->m_VehicleAudioSetting.EngineVolumeOffset + v163;
          v132 = v131 + 6.0;
LABEL_287:
          if ( !*(_DWORD *)&m_pGameEntity[20].RandomSeed )
            v132 = v131;
          if ( this->m_bNitroOnLastFrame )
          {
            v164 = this->m_CurrentNitroRatio;
            if ( v164 <= 1.0 && v164 >= 0.0 )
              v132 = v132 + (float)(v164 * 3.0);
          }
          v147 = LODWORD(v132);
          v148 = this;
LABEL_294:
          CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(
            v148,
            2,
            *(float *)&FreqForPlayerEngineSound,
            *(float *)&v147);
LABEL_295:
          v70 = 6;
          goto LABEL_296;
        }
        if ( v78 < 1 )
          goto LABEL_186;
        v95 = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40);
        if ( vp->fWheelSpin > 5.0
          || !v95
          || vp->ThisBrake > 0
          || vp->bHandbrakeOn
          || !vp->NumDriveWheelsOnGround
          || (v96 = this->m_bSingleGear, v97 = vp->fSpeed, !this->m_bSingleGear) && v97 < 0.1 )
        {
          if ( vp->ThisAccel >= 151 )
          {
            v79 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 1);
            v80 = this->m_pGameEntity;
            v83 = 6.0;
            v81 = (float)((float)(vp->fRealRevsRatio * 4.0) + -4.0) + -6.0;
            if ( (v80[17].m_areaCode & 0x40) == 0 )
              v81 = (float)(vp->fRealRevsRatio * 4.0) + -4.0;
            EngineVolumeOffset = this->m_VehicleAudioSetting.EngineVolumeOffset;
            goto LABEL_154;
          }
LABEL_258:
          v152 = this->m_EngineSounds[1].SoundPtr;
          if ( v152 )
          {
            CAESound::SetIndividualEnvironment(v152, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
            this->m_EngineSounds[1].SoundPtr = 0;
          }
          goto LABEL_270;
        }
        if ( vp->ThisAccel < 151 )
          goto LABEL_258;
        if ( vp->RealGear < vp->NumGears && v97 < (float)(vp->fPrevSpeed + 0.001) && vp->fZOverSpeed > 0.2 )
        {
          *(_DWORD *)&vp->pVehicle->m_nVehicleFlags |= 0x20000000u;
          v151 = this->m_EngineSounds[1].SoundPtr;
          if ( v151 )
          {
            CAESound::SetIndividualEnvironment(v151, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
            this->m_EngineSounds[1].SoundPtr = 0;
          }
          goto LABEL_306;
        }
        v173 = this->m_EngineSounds[1].SoundPtr;
        if ( v173 )
        {
          CAESound::SetIndividualEnvironment(v173, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
          v96 = this->m_bSingleGear;
          this->m_EngineSounds[1].SoundPtr = 0;
        }
        if ( v96 )
          goto LABEL_321;
        goto LABEL_327;
      case 5:
        if ( (*(_BYTE *)p_m_nVehicleFlags & 0x10) == 0 )
        {
          for ( k = 0; k != 12; ++k )
          {
            while ( 1 )
            {
              v56 = (char *)this + 8 * k;
              v57 = -1;
              v60 = (CAESound *)*((_DWORD *)v56 + 58);
              v59 = (CAESound **)(v56 + 232);
              v58 = v60;
              if ( v60 )
              {
                v57 = v58->m_nLength;
                CAESound::SetIndividualEnvironment(v58, 4u, 0);
                CAESound::StopSound(*v59);
                *v59 = 0;
              }
              if ( k != 4 )
                break;
              v61 = this->m_ACPlayPositionThisFrame;
              this->m_ACPlayPositionWhenStopped = v61;
              this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
              this->m_ACPlayPositionLastFrame = -1;
              this->m_ACPlayPositionThisFrame = -1;
              if ( v57 < 1 )
              {
                LOWORD(v55) = 0;
              }
              else
              {
                v2.n64_f32[0] = (float)v61 / (float)v57;
                v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
                v55 = (int)(float)(v2.n64_f32[0] * 100.0);
                if ( v2.n64_f32[0] < 0.0 )
                  LOWORD(v55) = 0;
              }
              this->m_ACPlayPercentWhenStopped = v55;
              k = 5;
            }
          }
          goto LABEL_97;
        }
        if ( fSpeed < -0.001 )
        {
          v84 = this->m_EngineSounds[3].SoundPtr;
          if ( v84 )
          {
            CAESound::SetIndividualEnvironment(v84, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[3].SoundPtr);
            this->m_EngineSounds[3].SoundPtr = 0;
          }
          this->m_CrzCount = 0.0;
          goto LABEL_227;
        }
        if ( vp->ThisAccel < 1 )
          goto LABEL_268;
        v104 = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40);
        if ( vp->fWheelSpin > 5.0
          || !v104
          || vp->ThisBrake > 0
          || vp->bHandbrakeOn
          || !vp->NumDriveWheelsOnGround
          || (v105 = vp->fSpeed, !this->m_bSingleGear) && v105 < 0.1 )
        {
          v106 = this->m_EngineSounds[3].SoundPtr;
          this->m_CrzCount = 0.0;
          if ( v106 )
          {
            CAESound::SetIndividualEnvironment(v106, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[3].SoundPtr);
            this->m_EngineSounds[3].SoundPtr = 0;
          }
          goto LABEL_227;
        }
        if ( vp->ThisAccel < 151 )
        {
LABEL_268:
          v156 = this->m_EngineSounds[3].SoundPtr;
          this->m_CrzCount = 0.0;
          if ( v156 )
          {
            CAESound::SetIndividualEnvironment(v156, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[3].SoundPtr);
            this->m_EngineSounds[3].SoundPtr = 0;
          }
          goto LABEL_270;
        }
        fPrevSpeed = vp->fPrevSpeed;
        if ( v105 > (float)(fPrevSpeed + 0.0015)
          && vp->RealGear < vp->NumGears
          && this->m_TimeBeforeAllowAccelerate >= CTimer::m_snTimeInMilliseconds )
        {
          if ( CCullZones::DoExtraAirResistanceForPlayer() != 1 )
          {
            v221 = this->m_EngineSounds[3].SoundPtr;
            this->m_CrzCount = 0.0;
            if ( v221 )
            {
              CAESound::SetIndividualEnvironment(v221, 4u, 0);
              CAESound::StopSound(this->m_EngineSounds[3].SoundPtr);
              this->m_EngineSounds[3].SoundPtr = 0;
            }
            if ( this->m_bSingleGear )
            {
              this->m_AudioGear = 1;
              v222 = -2.0;
              v223 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 4);
            }
            else
            {
              RealGear = vp->RealGear;
              if ( RealGear <= 1 )
                RealGear = 1;
              if ( RealGear >= this->m_AudioGear )
                RealGear = this->m_AudioGear;
              if ( (int)RealGear >= vp->pTransmission->m_nNumberOfGears - 1 )
                LOBYTE(RealGear) = vp->pTransmission->m_nNumberOfGears - 1;
              this->m_AudioGear = RealGear;
              v223 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 4);
              v222 = (float)((float)(unsigned __int8)RealGear * 0.4) + -2.0;
            }
            v237 = this->m_pGameEntity;
            v238 = v222 + -6.0;
            if ( (v237[17].m_areaCode & 0x40) == 0 )
              v238 = v222;
            v239 = this->m_VehicleAudioSetting.EngineVolumeOffset + v238;
            v240 = v239 + 6.0;
            if ( !*(_DWORD *)&v237[20].RandomSeed )
              v240 = v239;
            if ( this->m_bNitroOnLastFrame )
            {
              v241 = this->m_CurrentNitroRatio;
              if ( v241 <= 1.0 && v241 >= 0.0 )
                v240 = v240 + (float)(v241 * 3.0);
            }
            CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(this, 4, v223, v240);
            this->m_TimeBeforeAllowCruise = CTimer::m_snTimeInMilliseconds + 2000;
            v70 = 3;
            goto LABEL_296;
          }
          v105 = vp->fSpeed;
          fPrevSpeed = vp->fPrevSpeed;
        }
        v154 = fPrevSpeed + -0.05;
        v3.n64_u32[0] = LODWORD(this->m_CrzCount);
        if ( v105 <= v154 )
        {
          v155 = v3.n64_f32[0] + -0.25;
          if ( (float)(v3.n64_f32[0] + -0.25) <= 0.0 )
            v155 = 0.0;
        }
        else
        {
          v3.n64_f32[0] = v3.n64_f32[0] + 1.0;
          v2.n64_u32[0] = 1125515264;
          LODWORD(v155) = vmin_f32(v3, v2).n64_u32[0];
        }
        this->m_CrzCount = v155;
        v178 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 3);
        v179 = -2.0;
        if ( !this->m_bSingleGear )
          v179 = v155 * 0.013333;
        v180 = this->m_pGameEntity;
        v181 = v179 + -6.0;
        if ( (v180[17].m_areaCode & 0x40) == 0 )
          v181 = v179;
        v182 = this->m_VehicleAudioSetting.EngineVolumeOffset + v181;
        v99 = v182 + 6.0;
        if ( !*(_DWORD *)&v180[20].RandomSeed )
          v99 = v182;
        if ( this->m_bNitroOnLastFrame )
        {
          v183 = this->m_CurrentNitroRatio;
          if ( v183 <= 1.0 && v183 >= 0.0 )
            v99 = v99 + (float)(v183 * 3.0);
        }
        v101 = this->m_EngineSounds[3].SoundPtr;
        if ( v101 )
        {
          v102 = this->m_fEventVolume;
          v103 = v178;
          v70 = 5;
LABEL_162:
          v101->m_RelativeFrequency = v103;
          v101->m_EmittedVolume = v99 + v102;
        }
        else
        {
          v70 = 5;
        }
        goto LABEL_296;
      case 6:
        if ( (*(_BYTE *)p_m_nVehicleFlags & 0x10) == 0 )
        {
          for ( m = 0; m != 12; ++m )
          {
            while ( 1 )
            {
              v64 = (char *)this + 8 * m;
              v65 = -1;
              v68 = (CAESound *)*((_DWORD *)v64 + 58);
              v67 = (CAESound **)(v64 + 232);
              v66 = v68;
              if ( v68 )
              {
                v65 = v66->m_nLength;
                CAESound::SetIndividualEnvironment(v66, 4u, 0);
                CAESound::StopSound(*v67);
                *v67 = 0;
              }
              if ( m != 4 )
                break;
              v69 = this->m_ACPlayPositionThisFrame;
              this->m_ACPlayPositionWhenStopped = v69;
              this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
              this->m_ACPlayPositionLastFrame = -1;
              this->m_ACPlayPositionThisFrame = -1;
              if ( v65 < 1 )
              {
                LOWORD(v63) = 0;
              }
              else
              {
                v2.n64_f32[0] = (float)v69 / (float)v65;
                v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
                v63 = (int)(float)(v2.n64_f32[0] * 100.0);
                if ( v2.n64_f32[0] < 0.0 )
                  LOWORD(v63) = 0;
              }
              this->m_ACPlayPercentWhenStopped = v63;
              m = 5;
            }
          }
LABEL_97:
          v70 = 0;
          goto LABEL_296;
        }
        v85 = vp->ThisAccel;
        if ( fSpeed < -0.001 )
        {
          if ( v85 < 151 )
          {
LABEL_190:
            v114 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 2);
            v115 = (float)(v14 * 1.5) + -3.0;
            v116 = -6.0;
            if ( v20->m_nModelIndex == 457 )
              v115 = -33.0;
            goto LABEL_192;
          }
LABEL_182:
          v109 = this->m_EngineSounds[2].SoundPtr;
          if ( v109 )
          {
            CAESound::SetIndividualEnvironment(v109, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[2].SoundPtr);
            this->m_EngineSounds[2].SoundPtr = 0;
          }
LABEL_184:
          v110 = this->m_EngineSounds[5].SoundPtr;
          if ( v110 )
          {
            CAESound::SetIndividualEnvironment(v110, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[5].SoundPtr);
            this->m_EngineSounds[5].SoundPtr = 0;
          }
LABEL_228:
          v133 = this;
          v134 = vp;
LABEL_229:
          v139 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(v133, v134, 1);
          v140 = this->m_pGameEntity;
          v141 = (float)((float)(vp->fRealRevsRatio * 4.0) + -4.0) + -6.0;
          if ( (v140[17].m_areaCode & 0x40) == 0 )
            v141 = (float)(vp->fRealRevsRatio * 4.0) + -4.0;
          v142 = this->m_VehicleAudioSetting.EngineVolumeOffset + v141;
          v143 = v142 + 6.0;
          if ( !*(_DWORD *)&v140[20].RandomSeed )
            v143 = v142;
          if ( this->m_bNitroOnLastFrame )
          {
            v144 = this->m_CurrentNitroRatio;
            if ( v144 <= 1.0 && v144 >= 0.0 )
              v143 = v143 + (float)(v144 * 3.0);
          }
          CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(this, 1, v139, v143);
          v70 = 4;
          goto LABEL_296;
        }
        if ( v85 < 1 )
          goto LABEL_190;
        v107 = CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40);
        if ( vp->fWheelSpin <= 5.0
          && v107
          && vp->ThisBrake <= 0
          && !vp->bHandbrakeOn
          && vp->NumDriveWheelsOnGround
          && ((v108 = vp->fSpeed, this->m_bSingleGear) || v108 >= 0.1) )
        {
          if ( vp->ThisAccel >= 151 )
          {
            if ( vp->RealGear < vp->NumGears && v108 < (float)(vp->fPrevSpeed + 0.001) && vp->fZOverSpeed > 0.2 )
            {
              *(_DWORD *)&vp->pVehicle->m_nVehicleFlags |= 0x20000000u;
              v165 = this->m_EngineSounds[5].SoundPtr;
              if ( v165 )
              {
                CAESound::SetIndividualEnvironment(v165, 4u, 0);
                CAESound::StopSound(this->m_EngineSounds[5].SoundPtr);
                this->m_EngineSounds[5].SoundPtr = 0;
              }
              v166 = this->m_EngineSounds[2].SoundPtr;
              if ( v166 )
              {
                CAESound::SetIndividualEnvironment(v166, 4u, 0);
                CAESound::StopSound(this->m_EngineSounds[2].SoundPtr);
                this->m_EngineSounds[2].SoundPtr = 0;
              }
              goto LABEL_306;
            }
            v174 = this->m_EngineSounds[5].SoundPtr;
            if ( v174 )
            {
              CAESound::SetIndividualEnvironment(v174, 4u, 0);
              CAESound::StopSound(this->m_EngineSounds[5].SoundPtr);
              this->m_EngineSounds[5].SoundPtr = 0;
            }
            v175 = this->m_EngineSounds[2].SoundPtr;
            if ( v175 )
            {
              CAESound::SetIndividualEnvironment(v175, 4u, 0);
              CAESound::StopSound(this->m_EngineSounds[2].SoundPtr);
              this->m_EngineSounds[2].SoundPtr = 0;
            }
            if ( !this->m_bSingleGear )
            {
LABEL_327:
              v176 = vp->RealGear;
              if ( v176 <= 1 )
                v176 = 1;
              if ( v176 >= this->m_AudioGear )
                v176 = this->m_AudioGear;
              if ( (int)v176 >= vp->pTransmission->m_nNumberOfGears - 1 )
                LOBYTE(v176) = vp->pTransmission->m_nNumberOfGears - 1;
              this->m_AudioGear = v176;
              v171 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 4);
              m_AudioGear = (unsigned __int8)v176;
LABEL_391:
              v172 = (float)((float)m_AudioGear * 0.4) + -2.0;
              goto LABEL_392;
            }
LABEL_321:
            this->m_AudioGear = 1;
            v171 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 4);
            v172 = -2.0;
            goto LABEL_392;
          }
        }
        else if ( vp->ThisAccel >= 151 )
        {
          goto LABEL_182;
        }
        v114 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(this, vp, 2);
        if ( vp->pVehicle->m_nModelIndex == 457 )
        {
          v115 = -33.0;
          v116 = -6.0;
        }
        else
        {
          v116 = -6.0;
          v115 = (float)(vp->fSpeedRatio * 1.5) + -3.0;
        }
LABEL_192:
        v117 = this->m_pGameEntity;
        v118 = v115 + v116;
        if ( (v117[17].m_areaCode & 0x40) == 0 )
          v118 = v115;
        v119 = this->m_VehicleAudioSetting.EngineVolumeOffset + v118;
        v120 = v119 + 6.0;
        if ( !*(_DWORD *)&v117[20].RandomSeed )
          v120 = v119;
        if ( this->m_bNitroOnLastFrame )
        {
          v121 = this->m_CurrentNitroRatio;
          if ( v121 <= 1.0 && v121 >= 0.0 )
            v120 = v120 + (float)(v121 * 3.0);
        }
        v122 = this->m_EngineSounds[2].SoundPtr;
        if ( v122 )
        {
          v123 = v120 + this->m_fEventVolume;
          v122->m_RelativeFrequency = v114;
          v122->m_EmittedVolume = v123;
        }
        goto LABEL_295;
      default:
        return;
    }
  }
}
// 3AFF3A: variable 'v5' is possibly undefined
// 3B0088: variable 'v2' is possibly undefined
// 3B0088: variable 'v4' is possibly undefined
// 3B0D66: variable 'v3' is possibly undefined

//----- (003B178C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyVehicleEngine(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  int m_DummySlot; // r0
  float v5; // s0
  Int16 v6; // r1
  int m_DummyEngineBank; // r0
  unsigned int v8; // r1
  cTransmission *pTransmission; // r0
  float v10; // s4
  float v11; // s2

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      if ( (*(_BYTE *)&VehicleParams->pVehicle->m_nVehicleFlags & 0x10) != 0 )
      {
        pTransmission = VehicleParams->pTransmission;
        v5 = 0.0;
        if ( pTransmission )
        {
          v5 = 1.0;
          v10 = fabsf(VehicleParams->fSpeed / pTransmission->m_fMaxVelocity);
          if ( v10 <= 1.0 )
            v5 = v10;
        }
        v6 = 0;
        if ( (*(_BYTE *)&this->m_pGameEntity->m_info & 0xF8) == 32 )
          v5 = 0.0;
        switch ( this->m_State )
        {
          case 0:
          case 1:
          case 0xA:
            v11 = 0.2;
            goto LABEL_18;
          case 2:
            v11 = 0.15;
LABEL_18:
            v6 = 2;
            if ( v5 < v11 )
              v6 = 1;
            break;
          default:
            break;
        }
      }
      else
      {
        v5 = 0.0;
        v6 = 0;
      }
      CAEVehicleAudioEntity::ProcessDummyStateTransition(this, v6, v5, VehicleParams);
    }
    else
    {
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v8 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v8 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v8 >> 14)) != m_DummyEngineBank )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
        this->m_State = 0;
      }
    }
  }
}

//----- (003B18B4) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessEngineDamage(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float m_nHealth; // s0
  _BOOL4 v5; // r0
  int v6; // r9
  cTransmission *pTransmission; // r2
  int VehicleAudioType; // r8
  float v9; // s16
  float v10; // s0
  int m_bWreckedVehicle; // r6
  int v12; // r5
  bool v13; // zf
  CAESound *v14; // r0
  CAESound *SoundPtr; // r0
  float v16; // s4
  float v17; // s6

  m_nHealth = vp->pVehicle->m_nHealth;
  v5 = 1;
  if ( m_nHealth < 250.0 )
  {
    v6 = 1;
  }
  else
  {
    v6 = 1;
    if ( m_nHealth >= 390.0 )
    {
      v6 = 0;
      v5 = m_nHealth < 460.0 || m_nHealth < 650.0;
    }
  }
  pTransmission = vp->pTransmission;
  VehicleAudioType = (unsigned __int8)this->m_VehicleAudioSetting.VehicleAudioType;
  if ( pTransmission )
  {
    v9 = 1.0;
    v10 = fabsf(vp->fSpeed / pTransmission->m_fMaxVelocity);
    if ( v10 <= 1.0 )
      v9 = v10;
  }
  else
  {
    v9 = 0.0;
  }
  m_bWreckedVehicle = this->m_bWreckedVehicle;
  v12 = *(_DWORD *)&this->m_pGameEntity[17].m_nScanCode & 0x40000000;
  if ( !v5 )
    goto LABEL_19;
  v13 = v12 == 0;
  if ( !v12 )
    v13 = m_bWreckedVehicle == 0;
  if ( v13 )
  {
    CAEVehicleAudioEntity::UpdateGenericVehicleSound(
      this,
      9,
      5,
      143,
      28,
      (float)(v9 * 0.2) + 0.9,
      (float)(v9 * 3.0) + -24.0,
      1.0);
    if ( !(v6 | v12) )
    {
LABEL_24:
      SoundPtr = this->m_EngineSounds[10].SoundPtr;
      if ( SoundPtr )
      {
        CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
        CAESound::StopSound(this->m_EngineSounds[10].SoundPtr);
        this->m_EngineSounds[10].SoundPtr = 0;
      }
      return;
    }
  }
  else
  {
LABEL_19:
    v14 = this->m_EngineSounds[9].SoundPtr;
    if ( v14 )
    {
      CAESound::SetIndividualEnvironment(v14, 4u, 0);
      CAESound::StopSound(this->m_EngineSounds[9].SoundPtr);
      this->m_EngineSounds[9].SoundPtr = 0;
    }
    if ( !(v6 | v12) )
      goto LABEL_24;
  }
  if ( m_bWreckedVehicle | VehicleAudioType || (*(_BYTE *)&vp->pVehicle->m_nVehicleFlags & 0x10) == 0 )
    goto LABEL_24;
  v16 = (float)((float)(v9 * 0.3) + 0.9) * 0.7;
  v17 = (float)((float)(v9 * 6.0) + -24.0) + -6.0;
  if ( (*(_DWORD *)&this->m_pGameEntity[17].m_nScanCode & 0x40000000) == 0 )
  {
    v16 = (float)(v9 * 0.3) + 0.9;
    v17 = (float)(v9 * 6.0) + -24.0;
  }
  CAEVehicleAudioEntity::UpdateGenericVehicleSound(this, 10, 19, 138, 2, v16, v17, 2.5);
}

//----- (003B1AA0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessVehicleFlatTyre(
        CAEVehicleAudioEntity *this,
        cVehicleParams *VehicleParams)
{
  float v2; // s16
  int VehicleAudioType; // r0
  float v6; // s18
  Int16 v7; // r6
  CVehicle *v8; // r0
  CVehicle *pVehicle; // r0
  float *p_m_Doppler; // r0
  uint32 WheelStatus; // r0
  CVehicle *v12; // r1
  uint32 v13; // r0
  CVehicle *v14; // r1
  uint32 v15; // r0
  CVehicle *v16; // r1
  float v17; // s0
  float v18; // s2

  v2 = 1.0;
  VehicleAudioType = this->m_VehicleAudioSetting.VehicleAudioType;
  v6 = -100.0;
  v7 = -1;
  if ( (unsigned int)(VehicleAudioType - 1) < 2 )
  {
    pVehicle = VehicleParams->pVehicle;
    if ( pVehicle[1].m_nNoOfStaticFrames == 1
      && pVehicle[1].m_VehicleAudioEntity.ScratchSound.m_fDistanceFromCameraLastFrame > 0.0 )
    {
      goto LABEL_20;
    }
    if ( pVehicle[1].m_nNoOfCollisionRecords != 1 )
      goto LABEL_26;
    p_m_Doppler = &pVehicle[1].m_VehicleAudioEntity.ScratchSound.m_Doppler;
    goto LABEL_19;
  }
  if ( !VehicleAudioType )
  {
    v8 = VehicleParams->pVehicle;
    goto LABEL_11;
  }
  if ( VehicleAudioType == 9 )
  {
    v8 = VehicleParams->pVehicle;
    if ( v8->m_nModelIndex == 457 )
    {
LABEL_11:
      WheelStatus = CDamageManager::GetWheelStatus((const CDamageManager *)&v8[1], 0);
      v12 = VehicleParams->pVehicle;
      if ( WheelStatus == 1 && *(float *)&v12[1].m_VehicleAudioEntity.m_EngineSounds[6].SoundPtr > 0.0 )
        goto LABEL_20;
      v13 = CDamageManager::GetWheelStatus((const CDamageManager *)&v12[1], 1);
      v14 = VehicleParams->pVehicle;
      if ( v13 == 1 && *(float *)&v14[1].m_VehicleAudioEntity.m_EngineSounds[7].EngineSoundType > 0.0 )
        goto LABEL_20;
      v15 = CDamageManager::GetWheelStatus((const CDamageManager *)&v14[1], 2);
      v16 = VehicleParams->pVehicle;
      if ( v15 == 1 && *(float *)&v16[1].m_VehicleAudioEntity.m_EngineSounds[7].SoundPtr > 0.0 )
        goto LABEL_20;
      if ( CDamageManager::GetWheelStatus((const CDamageManager *)&v16[1], 3) != 1 )
        goto LABEL_26;
      p_m_Doppler = (float *)&VehicleParams->pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[8].EngineSoundType;
LABEL_19:
      if ( *p_m_Doppler <= 0.0 )
        goto LABEL_26;
LABEL_20:
      v17 = fabsf(VehicleParams->fSpeed) / (float)(VehicleParams->pTransmission->m_fMaxVelocity * 0.3);
      v18 = 1.0;
      if ( v17 <= 1.0 )
      {
        v2 = (float)(v17 * 0.4) + 1.0;
        if ( v17 <= 0.0 )
        {
LABEL_25:
          v7 = 4;
          goto LABEL_26;
        }
        v18 = v17;
      }
      else
      {
        v2 = 1.4;
      }
      v6 = (float)(CAEAudioUtility::AudioLog10(v18) * 20.0) + -9.0;
      goto LABEL_25;
    }
  }
LABEL_26:
  CAEVehicleAudioEntity::PlayFlatTyreSound(this, v7, v2, v6);
}

//----- (003B1C28) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerBicycle(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d11
  unsigned __int64 v4; // d13
  CVehicle *pVehicle; // r0
  float v8; // s0
  float SoundPtr_low; // s18
  float32x2_t v10; // d2
  float v11; // s16
  float v12; // r0
  CVehicle *v13; // r4
  float v14; // s19
  float v15; // r0
  float v16; // s4
  float v17; // s18
  float Frequency; // s24
  int v19; // r1
  int v20; // r0
  int v21; // r4
  float *v22; // r0
  float v23; // r6
  float m_fEventVolume; // s22
  UInt32 m_TimeLastServiced; // r1

  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, this->m_DummySlot) )
    return;
  pVehicle = vp->pVehicle;
  if ( *(float *)&pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[11].EngineSoundType <= 5.0 )
  {
    v2.n64_f32[0] = CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_VolumeSprintIncrease;
  }
  else
  {
    v2.n64_f32[0] = CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_VolumeSprintIncrease;
    if ( (float)(*(float *)&pVehicle[1].m_VehicleAudioEntity.m_TimeLastServiced
               * CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_fPrevCrankAngle) < 0.0
      && CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_VolumeSprintIncrease == 0.0 )
    {
      v2.n64_u32[0] = 6.0;
      CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_VolumeSprintIncrease = 6.0;
    }
  }
  LODWORD(v4) = 1.0;
  v3.n64_u32[0] = 0;
  v2.n64_f32[0] = v2.n64_f32[0] + -0.7;
  LODWORD(CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_VolumeSprintIncrease) = vmax_f32(v2, v3).n64_u32[0];
  v8 = fabsf(vp->fSpeed / vp->pTransmission->m_fMaxVelocity);
  SoundPtr_low = (float)LOBYTE(pVehicle[1].m_VehicleAudioEntity.m_EngineSounds[8].SoundPtr);
  v10.n64_u64[0] = v4;
  if ( v8 < 1.0 )
    v10.n64_f32[0] = v8;
  v11 = vmax_f32(v10, v3).n64_f32[0];
  v12 = CAEAudioUtility::AudioLog10((float)(SoundPtr_low * 0.25) * v11);
  v13 = vp->pVehicle;
  v14 = v12 * 20.0;
  v15 = sinf(v13[1].m_vecCOM.x);
  v16 = (float)((float)(SoundPtr_low * 0.1) * 0.125) + (float)((float)(v11 * 0.1) + 1.05);
  v17 = (float)(v14 + this->m_fEventVolume) + -8.0;
  Frequency = (float)((float)(COERCE_FLOAT(LODWORD(v15) & 0x7FFFFFFF) * 0.2) + 1.0) * v16;
  if ( LOBYTE(v13[1].m_VehicleAudioEntity.m_SurfaceSoundPtr) )
  {
    if ( v11 >= 0.0 )
    {
      if ( v11 >= 0.1 )
      {
        if ( v11 >= 0.2 )
        {
          if ( v11 >= 0.5 )
          {
            v21 = 1;
            if ( v11 >= 1.0001 )
              goto LABEL_27;
            v20 = 4;
          }
          else
          {
            v20 = 3;
          }
        }
        else
        {
          v20 = 2;
        }
        v19 = 1;
      }
      else
      {
        v19 = 1;
        v20 = 1;
      }
    }
    else
    {
      v19 = 0;
      v20 = 0;
    }
    LODWORD(v4) = 1.0;
    v21 = 1;
    if ( v11 > 1.0 )
      goto LABEL_27;
    if ( v11 >= 0.0 )
    {
      LODWORD(v4) = 0;
      if ( v19 )
      {
        v21 = 1;
        v22 = CAEVehicleAudioEntity::GetBaseVolumeForBicycleTyre(float)::BicycleTyreVol[v20];
        *(float *)&v4 = *(v22 - 1)
                      + (float)((float)((float)(v11 - *(v22 - 2)) / (float)(*v22 - *(v22 - 2)))
                              * (float)(v22[1] - *(v22 - 1)));
      }
      goto LABEL_27;
    }
  }
  else
  {
    v21 = 0;
  }
  LODWORD(v4) = 0;
LABEL_27:
  v23 = CAEAudioUtility::AudioLog10(*(float *)&v4);
  m_fEventVolume = this->m_fEventVolume;
  CAEVehicleAudioEntity::PlayBicycleSound(this, 1, this->m_DummySlot, 0, v17, Frequency);
  CAEVehicleAudioEntity::PlayBicycleSound(
    this,
    2,
    this->m_DummySlot,
    1,
    (float)((float)(v23 * 20.0) + m_fEventVolume) + -15.0,
    (float)(v11 * 0.7) + 0.4);
  if ( !v21 )
  {
    if ( CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_bFreeWheelLastFrame )
      CAEVehicleAudioEntity::PlayBicycleSound(this, 3, this->m_DummySlot, 1, v17, 1.0);
  }
  m_TimeLastServiced = vp->pVehicle[1].m_VehicleAudioEntity.m_TimeLastServiced;
  CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_bFreeWheelLastFrame = v21;
  LODWORD(CAEVehicleAudioEntity::ProcessPlayerBicycle(cVehicleParams &)::s_fPrevCrankAngle) = m_TimeLastServiced;
}
// 3B1CCA: variable 'v2' is possibly undefined
// 3B1CCA: variable 'v3' is possibly undefined
// 3B1CF6: variable 'v4' is possibly undefined

//----- (003B1F24) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyBicycle(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d12
  unsigned __int64 v3; // d13
  int m_DummySlot; // r0
  __int64 v7; // r0
  float v8; // s0
  float v9; // s18
  float32x2_t v10; // d2
  float v11; // s16
  float v12; // r0
  CVehicle *pVehicle; // r5
  float v14; // s19
  float v15; // r0
  float v16; // s4
  float v17; // s18
  float Frequency; // s22
  int v19; // r1
  int v20; // r0
  int m_DummyEngineBank; // r0
  unsigned int v22; // r1
  int v23; // r6
  float *v24; // r0
  float v25; // r5
  float m_fEventVolume; // s24

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot == 0xFFFF )
  {
    LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank);
    this->m_DummySlot = m_DummySlot;
    if ( (unsigned __int16)m_DummySlot == 0xFFFF )
      return;
  }
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
  {
    v7 = *(_QWORD *)&vp->pVehicle;
    LODWORD(v3) = 1.0;
    v8 = fabsf(vp->fSpeed / *(float *)(HIDWORD(v7) + 88));
    v2.n64_u32[0] = 0;
    v9 = (float)*(unsigned __int8 *)(v7 + 2072);
    v10.n64_u64[0] = v3;
    if ( v8 < 1.0 )
      v10.n64_f32[0] = v8;
    v11 = vmax_f32(v10, v2).n64_f32[0];
    v12 = CAEAudioUtility::AudioLog10((float)(v9 * 0.25) * v11);
    pVehicle = vp->pVehicle;
    v14 = v12 * 20.0;
    v15 = sinf(pVehicle[1].m_vecCOM.x);
    v16 = (float)((float)(v9 * 0.1) * 0.125) + (float)((float)(v11 * 0.1) + 1.05);
    v17 = (float)(v14 + this->m_fEventVolume) + -8.0;
    Frequency = (float)((float)(COERCE_FLOAT(LODWORD(v15) & 0x7FFFFFFF) * 0.2) + 1.0) * v16;
    if ( LOBYTE(pVehicle[1].m_VehicleAudioEntity.m_SurfaceSoundPtr) )
    {
      if ( v11 >= 0.0 )
      {
        if ( v11 >= 0.1 )
        {
          if ( v11 >= 0.2 )
          {
            if ( v11 >= 0.5 )
            {
              v23 = 1;
              if ( v11 >= 1.0001 )
                goto LABEL_27;
              v20 = 4;
            }
            else
            {
              v20 = 3;
            }
          }
          else
          {
            v20 = 2;
          }
          v19 = 1;
        }
        else
        {
          v19 = 1;
          v20 = 1;
        }
      }
      else
      {
        v19 = 0;
        v20 = 0;
      }
      LODWORD(v3) = 1.0;
      v23 = 1;
      if ( v11 > 1.0 )
        goto LABEL_27;
      if ( v11 >= 0.0 )
      {
        LODWORD(v3) = 0;
        if ( v19 )
        {
          v23 = 1;
          v24 = CAEVehicleAudioEntity::GetBaseVolumeForBicycleTyre(float)::BicycleTyreVol[v20];
          *(float *)&v3 = *(v24 - 1)
                        + (float)((float)((float)(v11 - *(v24 - 2)) / (float)(*v24 - *(v24 - 2)))
                                * (float)(v24[1] - *(v24 - 1)));
        }
        goto LABEL_27;
      }
    }
    else
    {
      v23 = 0;
    }
    LODWORD(v3) = 0;
LABEL_27:
    v25 = CAEAudioUtility::AudioLog10(*(float *)&v3);
    m_fEventVolume = this->m_fEventVolume;
    CAEVehicleAudioEntity::PlayBicycleSound(this, 1, this->m_DummySlot, 0, v17, Frequency);
    CAEVehicleAudioEntity::PlayBicycleSound(
      this,
      2,
      this->m_DummySlot,
      1,
      (float)((float)(v25 * 20.0) + m_fEventVolume) + -15.0,
      (float)(v11 * 0.7) + 0.4);
    if ( !v23 )
    {
      if ( CAEVehicleAudioEntity::ProcessDummyBicycle(cVehicleParams &)::s_bFreeWheelLastFrame )
        CAEVehicleAudioEntity::PlayBicycleSound(this, 3, this->m_DummySlot, 1, v17, 1.0);
    }
    CAEVehicleAudioEntity::ProcessDummyBicycle(cVehicleParams &)::s_bFreeWheelLastFrame = v23;
    return;
  }
  m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
  v22 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
  if ( v22 > 0x90000
    || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v22 >> 14)) != m_DummyEngineBank )
  {
    this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
    this->m_State = 0;
  }
}
// 3B1F98: variable 'v3' is possibly undefined
// 3B1FAE: variable 'v2' is possibly undefined

//----- (003B21D8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessAircraft(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d3
  float32x2_t v3; // d4
  CVehicle *pVehicle; // r0
  int v7; // r1
  int m_nModelIndex; // r2
  int VehicleAudioType; // r2
  bool v10; // zf
  bool v11; // zf
  int v12; // s4
  int v13; // r2
  float v14; // s12
  int RecordingNumber; // r1
  float v16; // s6
  float v17; // s6
  float v18; // s2
  char v19; // r2
  unsigned int v20; // r0

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    pVehicle = vp->pVehicle;
    v7 = 1;
    m_nModelIndex = pVehicle->m_nModelIndex;
    if ( (unsigned int)(m_nModelIndex - 519) >= 2 && m_nModelIndex != 577 && m_nModelIndex != 592 )
      v7 = 0;
    VehicleAudioType = this->m_VehicleAudioSetting.VehicleAudioType;
    if ( VehicleAudioType == 4 )
    {
      if ( !this->m_bWreckedVehicle )
      {
        v11 = CAEVehicleAudioEntity::s_HelicoptorsDisabled == 0;
        if ( !CAEVehicleAudioEntity::s_HelicoptorsDisabled )
          v11 = this->m_bHelicoptorDisabled == 0;
        if ( v11 )
        {
          if ( this->m_bPlayerDriven )
          {
            CAEVehicleAudioEntity::ProcessPlayerHeli(this, vp);
          }
          else if ( (*(_BYTE *)&pVehicle->m_info & 0xF8) == 24 )
          {
            CAEVehicleAudioEntity::ProcessAIHeli(this, vp);
          }
          else
          {
            CAEVehicleAudioEntity::ProcessDummyHeli(this, vp);
          }
        }
        else
        {
          CAEVehicleAudioEntity::JustWreckedVehicle(this);
        }
      }
    }
    else if ( VehicleAudioType == 6 )
    {
      if ( !this->m_bWreckedVehicle )
      {
        if ( this->m_bPlayerDriven )
          CAEVehicleAudioEntity::ProcessPlayerSeaPlane(this, vp);
        else
          CAEVehicleAudioEntity::ProcessDummySeaPlane(this, vp);
      }
    }
    else
    {
      v10 = VehicleAudioType == 5;
      if ( VehicleAudioType == 5 )
        v10 = this->m_bWreckedVehicle == 0;
      if ( v10 )
      {
        if ( this->m_bPlayerDriven )
        {
          if ( v7 )
            CAEVehicleAudioEntity::ProcessPlayerJet(this, vp);
          else
            CAEVehicleAudioEntity::ProcessPlayerProp(this, vp);
        }
        else if ( v7 )
        {
          v12 = (int)(float)(pVehicle->m_fBrakePedal * 255.0);
          v13 = v12;
          if ( (int)(float)(pVehicle->m_fGasPedal * 255.0) > v12 )
            v13 = (int)(float)(pVehicle->m_fGasPedal * 255.0);
          v3.n64_f32[0] = (float)v13 / 255.0;
          v2.n64_u32[0] = 1.0;
          v14 = vmin_f32(v3, v2).n64_f32[0];
          v3.n64_f32[0] = (float)(v14 * 0.3) + 0.7;
          if ( v14 < 0.0 )
            v3.n64_u32[0] = 1060320051;
          RecordingNumber = pVehicle->AutoPilot.RecordingNumber;
          if ( RecordingNumber <= -1 )
            v3.n64_f32[0] = *(float *)&pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
          v16 = vmin_f32(v3, v2).n64_f32[0];
          if ( v16 >= 0.2 )
            v17 = (float)(v16 + -0.2) / 0.8;
          else
            v17 = 0.0;
          v18 = (float)(int)(float)(pVehicle->m_fGasPedal * 255.0);
          v19 = 0;
          v20 = *(_DWORD *)&pVehicle->m_nVehicleFlags & 0x10;
          if ( RecordingNumber > -1 )
            v19 = 1;
          CAEVehicleAudioEntity::ProcessGenericJet(
            this,
            v19 | (v20 >> 4),
            vp,
            v17,
            v18 / 255.0,
            (float)v12 / 255.0,
            0.0,
            1.0);
        }
        else if ( (*(_BYTE *)&pVehicle->m_info & 0xF8) == 24 || pVehicle->AutoPilot.RecordingNumber >= 0 )
        {
          CAEVehicleAudioEntity::ProcessAIProp(this, vp);
        }
        else
        {
          CAEVehicleAudioEntity::ProcessDummyProp(this, vp);
        }
      }
    }
  }
}
// 3B22D4: variable 'v3' is possibly undefined
// 3B22D4: variable 'v2' is possibly undefined

//----- (003B2428) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessMovingParts(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d8
  CVehicle *pVehicle; // r0
  int m_nModelIndex; // r2
  bool v8; // zf
  bool v9; // zf
  float v10; // s18
  float32x2_t v11; // d0
  unsigned __int32 v12; // s0
  int v13; // r0
  float v14; // s0
  float v15; // s2
  Int16 m_DummySlot; // r5
  float v17; // r0
  float v18; // s2
  float v19; // s0
  Int16 SoundID; // r0
  Int16 v21; // r3
  CAESound *SoundPtr; // r0

  pVehicle = vp->pVehicle;
  m_nModelIndex = pVehicle->m_nModelIndex;
  v8 = m_nModelIndex == 524;
  if ( m_nModelIndex < 524 )
  {
    v9 = m_nModelIndex == 406;
    if ( m_nModelIndex != 406 )
      v9 = m_nModelIndex == 443;
    if ( !v9 && m_nModelIndex != 486 )
      return;
LABEL_11:
    v4.n64_u32[0] = 1.0;
    v10 = (float)(LOWORD(pVehicle[1].m_VehicleAudioEntity.m_SkidSound.ScratchSound.m_pAudioEntity)
                - HIWORD(pVehicle[1].m_VehicleAudioEntity.m_SkidSound.ScratchSound.m_pAudioEntity))
        / 30.0;
    v2.n64_f32[0] = fabsf(v10);
    v3.n64_u32[0] = LODWORD(this->m_fMovingPartSmoothedSpeed);
    v11.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
    if ( v11.n64_f32[0] <= v3.n64_f32[0] )
    {
      v3.n64_f32[0] = v3.n64_f32[0] + -0.2;
      v12 = vmax_f32(v11, v3).n64_u32[0];
    }
    else
    {
      v3.n64_f32[0] = v3.n64_f32[0] + 0.2;
      v12 = vmin_f32(v11, v3).n64_u32[0];
    }
    LODWORD(this->m_fMovingPartSmoothedSpeed) = v12;
    v13 = vp->pVehicle->m_nModelIndex;
    if ( v13 < 486 )
    {
      if ( v13 != 406 )
      {
        if ( v13 != 443 )
          return;
        v14 = CAEAudioUtility::AudioLog10(*(float *)&v12) * 20.0;
        if ( v10 <= 0.0 )
        {
          v15 = 3.0;
          v4.n64_u32[0] = 1061997773;
        }
        else
        {
          v15 = 9.0;
        }
        goto LABEL_37;
      }
      v15 = 20.0;
      v14 = CAEAudioUtility::AudioLog10(*(float *)&v12) * 20.0;
      if ( v10 > 0.0 )
      {
        v4.n64_u32[0] = 1066192077;
        goto LABEL_37;
      }
      v15 = 14.0;
    }
    else
    {
      if ( v13 != 486 )
      {
        if ( v13 == 530 )
        {
          m_DummySlot = this->m_DummySlot;
          v17 = CAEAudioUtility::AudioLog10(*(float *)&v12);
          if ( v10 <= 0.0 )
          {
            v18 = -18.0;
            v4.n64_u32[0] = 1061997773;
          }
          else
          {
            v18 = -6.0;
          }
          v19 = (float)(v17 * 20.0) + v18;
          SoundID = 2;
          v21 = 57;
          goto LABEL_38;
        }
        if ( v13 != 592 )
          return;
        v14 = CAEAudioUtility::AudioLog10(*(float *)&v12) * 20.0;
        if ( v10 <= 0.0 )
        {
          v15 = 21.0;
          v4.n64_u32[0] = 1061997773;
        }
        else
        {
          v15 = 24.0;
        }
LABEL_37:
        v19 = v14 + v15;
        SoundID = 15;
        v21 = 138;
        m_DummySlot = 19;
LABEL_38:
        if ( v19 <= -100.0 )
        {
          SoundPtr = this->m_EngineSounds[11].SoundPtr;
          if ( SoundPtr )
          {
            CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[11].SoundPtr);
            this->m_EngineSounds[11].SoundPtr = 0;
          }
        }
        else
        {
          CAEVehicleAudioEntity::UpdateGenericVehicleSound(this, 11, m_DummySlot, v21, SoundID, v4.n64_f32[0], v19, 1.5);
        }
        return;
      }
      v14 = CAEAudioUtility::AudioLog10(*(float *)&v12) * 20.0;
      if ( v10 > 0.0 )
      {
        v15 = 6.0;
        v4.n64_u32[0] = 1066192077;
        goto LABEL_37;
      }
      v15 = 2.0;
    }
    v4.n64_u32[0] = 1063675494;
    goto LABEL_37;
  }
  if ( m_nModelIndex != 524 )
    v8 = m_nModelIndex == 592;
  if ( v8 || m_nModelIndex == 530 )
    goto LABEL_11;
}
// 3B248E: variable 'v2' is possibly undefined
// 3B248E: variable 'v4' is possibly undefined
// 3B24A4: variable 'v3' is possibly undefined

//----- (003B2648) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessReverseGear(CAEVehicleAudioEntity *this, cVehicleParams *VehicleParams)
{
  CVehicle *pVehicle; // r0
  float v4; // s16
  float v5; // s0
  Int16 v6; // r5
  float m_fGasPedal; // s2
  float v8; // s4
  int v9; // r2
  float *p_LastTimeWeStartedTempActReverse; // r0
  float v11; // s4

  pVehicle = VehicleParams->pVehicle;
  v4 = 1.0;
  v5 = -100.0;
  v6 = -1;
  if ( (*(_BYTE *)&pVehicle->m_nVehicleFlags & 0x10) != 0 )
  {
    m_fGasPedal = pVehicle->m_fGasPedal;
    if ( m_fGasPedal < 0.0 || !pVehicle->m_nCurrentGear )
    {
      if ( BYTE1(pVehicle[1].AutoPilot.TempActionFinish) )
      {
        v8 = VehicleParams->fSpeed / VehicleParams->pTransmission->m_fMaxReverseVelocity;
      }
      else
      {
        v9 = BYTE2(pVehicle[1].AutoPilot.TempActionFinish);
        p_LastTimeWeStartedTempActReverse = (float *)&pVehicle[1].AutoPilot.LastTimeWeStartedTempActReverse;
        v8 = *p_LastTimeWeStartedTempActReverse;
        if ( v9 )
        {
          v8 = v8 * 0.4;
          *p_LastTimeWeStartedTempActReverse = v8;
          m_fGasPedal = VehicleParams->pVehicle->m_fGasPedal;
        }
      }
      v11 = fabsf(v8);
      v6 = 20;
      v4 = (float)(v11 * 0.2) + 0.75;
      if ( m_fGasPedal < 0.0 )
        v6 = 19;
      if ( v11 > 0.0 )
        v5 = (float)(CAEAudioUtility::AudioLog10(v11) * 20.0) + -6.0;
    }
  }
  CAEVehicleAudioEntity::PlayReverseSound(this, v6, v4, v5);
}

//----- (003B2730) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessNitro(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  CVehicle *pVehicle; // r0
  unsigned __int32 v7; // s16
  CAESound *SoundPtr; // r0
  CAESound *v9; // r0
  Bool8 v10; // r0

  pVehicle = vp->pVehicle;
  if ( (pVehicle->hFlagsLocal & 0x80000) == 0
    || *(float *)&pVehicle[1].m_VehicleAudioEntity.m_SkidSound.ScratchSound.m_FramePositionLastUpdated >= 0.0
    || (*(_DWORD *)&pVehicle->m_nVehicleFlags & 0x40000010) != 0x10 )
  {
    if ( this->m_bNitroOnLastFrame )
    {
      SoundPtr = this->m_EngineSounds[7].SoundPtr;
      if ( SoundPtr )
      {
        CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
        CAESound::StopSound(this->m_EngineSounds[7].SoundPtr);
        this->m_EngineSounds[7].SoundPtr = 0;
      }
      v9 = this->m_EngineSounds[8].SoundPtr;
      if ( v9 )
      {
        CAESound::SetIndividualEnvironment(v9, 4u, 0);
        CAESound::StopSound(this->m_EngineSounds[8].SoundPtr);
        this->m_EngineSounds[8].SoundPtr = 0;
      }
    }
    this->m_CurrentNitroRatio = -1.0;
    v10 = 0;
  }
  else
  {
    if ( !this->m_bNitroOnLastFrame )
      CAEVehicleAudioEntity::AddAudioEvent(this, 102, 0.0);
    v2.n64_f32[0] = (float)vp->ThisAccel / 255.0;
    v3.n64_u32[0] = LODWORD(this->m_CurrentNitroRatio);
    if ( v3.n64_f32[0] < 0.0 )
    {
      LODWORD(this->m_CurrentNitroRatio) = v2.n64_u32[0];
      v3.n64_u32[0] = v2.n64_u32[0];
    }
    if ( v2.n64_f32[0] >= v3.n64_f32[0] )
    {
      v3.n64_f32[0] = v3.n64_f32[0] + 0.075;
      v7 = vmin_f32(v2, v3).n64_u32[0];
    }
    else
    {
      v3.n64_f32[0] = v3.n64_f32[0] + -0.085;
      v7 = vmax_f32(v2, v3).n64_u32[0];
    }
    this->m_CurrentNitroRatio = *(float *)&v7;
    CAEVehicleAudioEntity::UpdateGenericVehicleSound(
      this,
      7,
      5,
      143,
      10,
      (float)(*(float *)&v7 * 0.09) + 0.75,
      (float)(*(float *)&v7 * 8.0) + -6.0,
      3.0);
    CAEVehicleAudioEntity::UpdateGenericVehicleSound(
      this,
      8,
      19,
      138,
      26,
      (float)(*(float *)&v7 * 0.2) + 0.8,
      (float)(*(float *)&v7 * 27.0) + -36.0,
      3.0);
    v10 = 1;
  }
  this->m_bNitroOnLastFrame = v10;
}
// 3B27B8: variable 'v2' is possibly undefined
// 3B27B8: variable 'v3' is possibly undefined

//----- (003B28C0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerCombine(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  CAESound *SoundPtr; // r0
  float v8; // r0

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x45u, 40) )
  {
    if ( (*(_BYTE *)&vp->pVehicle->m_nVehicleFlags & 0x10) != 0 )
    {
      v4.n64_u32[0] = 0;
      v2.n64_f32[0] = vp->fSpeed / 0.2;
      v3.n64_u32[0] = 1.0;
      v8 = CAEAudioUtility::AudioLog10(vmax_f32(vmin_f32(v2, v3), v4).n64_f32[0]);
      CAEVehicleAudioEntity::UpdateGenericVehicleSound(this, 11, 40, 69, 3, 1.0, (float)(v8 * 20.0) + -12.0, 2.0);
    }
    else
    {
      SoundPtr = this->m_EngineSounds[11].SoundPtr;
      if ( SoundPtr )
      {
        CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
        CAESound::StopSound(this->m_EngineSounds[11].SoundPtr);
        this->m_EngineSounds[11].SoundPtr = 0;
      }
    }
  }
}
// 3B2918: variable 'v2' is possibly undefined
// 3B2918: variable 'v3' is possibly undefined
// 3B291C: variable 'v4' is possibly undefined

//----- (003B2970) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyStateTransition(
        CAEVehicleAudioEntity *this,
        Int16 NewState,
        float fRatio,
        cVehicleParams *vp)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d10
  float32x2_t v6; // d12
  int m_State; // r0
  CEntity *v11; // r0
  float v12; // s2
  float v13; // s0
  CEntity *v14; // r0
  float32x2_t v15; // d0
  int m_nModelIndex; // r1
  float v17; // s24
  float v18; // s26
  int v19; // r1
  float v20; // s22
  int v21; // r2
  float v22; // s28
  float v23; // s30
  float v24; // s0
  bool v25; // zf
  int v26; // r6
  int v27; // r1
  int v28; // r5
  float v29; // s17
  float v30; // r8
  CEntity *v31; // r0
  int v32; // s2
  float v33; // s30
  float v34; // s17
  float v35; // s19
  float v36; // s28
  CAESound *v37; // r0
  float v38; // s2
  CEntity *v39; // r0
  float v40; // s26
  float v41; // s20
  int v42; // r0
  int v43; // r2
  float v44; // s12
  int v45; // r1
  float v46; // s0
  float v47; // s2
  bool v48; // fnf
  int v49; // r0
  float v50; // s0
  int v51; // r1
  CEntity *m_pGameEntity; // r3
  float v53; // s6
  int v54; // r2
  int v55; // r3
  int v56; // r2
  int v57; // s2
  float v58; // s8
  float v59; // s2
  float v60; // r2
  float v61; // r3
  int v62; // r2
  float v63; // s0
  int v64; // r3
  int v65; // r1
  float v66; // s12
  float v67; // s2
  bool v68; // fnf
  float v69; // s0
  int v70; // r2
  int v71; // r1
  int v72; // r3
  float v73; // s4
  int v74; // r0
  int v75; // r3
  float v76; // s6
  int v77; // s0
  float v78; // s8
  CEntity *v79; // r1
  float v80; // s18
  float v81; // s20
  CAESound *v82; // r0
  __int64 v83; // r0
  float v84; // s30
  int v85; // r6
  float v86; // s17
  float v87; // s19
  float v88; // s4
  float32x2_t v89; // d0
  int v90; // r8
  int v91; // r9
  float v92; // r0
  CEntity *v93; // r0
  float v94; // s2
  float v95; // s19
  int v96; // s2
  float v97; // s17
  float v98; // s21
  CAESound *v99; // r0
  float v100; // s2
  float v101; // s0
  CEntity *v102; // r0
  int v103; // r1
  float v104; // s20
  CAESound *v105; // r0
  CAESound *v106; // r0
  float v107; // s16
  float v108; // s4
  float v109; // s6
  float v110; // s30
  float v111; // s20
  float v112; // r0
  CEntity *v113; // r1
  float v114; // s0
  int v115; // s2
  float v116; // s0
  int v117; // s6
  float v118; // s18
  float v119; // r0
  float v120; // s2
  CAEVehicleAudioEntity *v121; // r0
  Int16 v122; // r1
  float v123; // s22
  float v124; // s2
  float v125; // s8
  float v126; // s10
  float v127; // s24
  float v128; // s2
  float v129; // s4
  float v130; // s6
  int v131; // s4
  float v132; // s2
  int v133; // s10
  float v134; // s20
  float v135; // s0
  CAESound *v136; // r0
  float v137; // s0
  float m_fFadeOut; // s0
  int v139; // r1
  int v140; // r2
  float v141; // s2
  float v142; // s16
  int v143; // r0
  float v144; // s22
  bool v145; // nf
  bool v146; // fnf
  float v147; // s24
  float v148; // s2
  int v149; // r5
  int v150; // r6
  int v151; // r0
  CAESound *v152; // r0
  float v153; // s2
  float v154; // s22
  float v155; // s6
  float v156; // s18
  float PiecewiseLinear; // r0
  float v158; // s24
  float v159; // r0
  CEntity *v160; // r1
  float v161; // s0
  int v162; // s2
  float v163; // s0
  int v164; // s8
  float v165; // s20
  float v166; // r0
  float v167; // s2
  CAESound *SoundPtr; // r0
  int v169; // r1
  int v170; // r2
  float v171; // s0
  float v172; // s0
  float v173; // s16
  float v174; // s18
  bool v175; // fnf
  float v176; // s20
  float v177; // s0
  int v178; // r5
  int v179; // r1
  int v180; // r6
  int v181; // r1
  float v182; // s22
  float v183; // s0
  float v184; // s24
  float v185; // r0
  CEntity *v186; // r2
  int v187; // r1
  int v188; // r2
  int v189; // s6
  float v190; // s0
  float v191; // s0
  float v192; // s18
  float v193; // s20
  float v194; // s0
  float v195; // s16
  float v196; // s2
  float v197; // s8
  float v198; // s10
  float v199; // s26
  float v200; // s28
  float v201; // s16
  float v202; // s0
  float v203; // s0
  CEntity *v204; // r1
  float v205; // s2
  float v206; // s24
  int v207; // s2
  float EngineVolumeOffset; // s26
  float v209; // s22
  CAESound *v210; // r0
  float v211; // s2
  float v212; // s0
  float v213; // s4
  float v214; // s6
  int v215; // s4
  float v216; // s2
  int v217; // s8
  float v218; // s18
  float v219; // s0
  CAESound *v220; // r0
  float v221; // s0

  m_State = (unsigned __int8)this->m_State;
  this->m_TimeLastServiced = CTimer::m_snTimeInMilliseconds;
  switch ( m_State )
  {
    case 0:
    case 10:
      if ( NewState == 2 )
      {
        if ( !m_State )
          CAEVehicleAudioEntity::AddAudioEvent(this, 103, 0.0);
        v42 = 0;
        v43 = 0;
        v44 = 0.0;
        v45 = 0;
        v46 = (float)(fRatio + -0.15) / 0.85;
        v47 = (float)(v46 * 4.5) + -4.5;
        if ( v46 < 1.0 )
          v42 = 1;
        v48 = v46 < 1.0;
        if ( v46 < 0.0 )
          v43 = 1;
        v49 = v42 & v43;
        if ( v49 )
          v44 = -4.5;
        v50 = (float)(v46 * 0.6) + 0.9;
        if ( !v48 )
          v45 = 1;
        v51 = v45 | v43;
        if ( v51 )
          v47 = v44;
        m_pGameEntity = this->m_pGameEntity;
        v53 = v47 + -6.0;
        this->m_State = 2;
        this->m_fFadeIn = 1.0;
        this->m_fFadeOut = 1.0;
        v54 = *(_DWORD *)&m_pGameEntity[17].m_nScanCode;
        v55 = *(_DWORD *)&m_pGameEntity[20].RandomSeed;
        v56 = v54 & 0x40000000;
        if ( !v56 )
          v53 = v47;
        *(float *)&v57 = 1.5;
        if ( v49 )
          *(float *)&v57 = 0.9;
        if ( v51 )
          v50 = *(float *)&v57;
        v58 = v53 + 6.0;
        if ( !v55 )
          v58 = v53;
        v59 = v50 * 0.7;
        if ( !v56 )
          v59 = v50;
        v60 = v59;
        v61 = this->m_VehicleAudioSetting.EngineVolumeOffset + (float)(v58 + 0.0);
        goto LABEL_261;
      }
      if ( NewState != 1 )
        goto LABEL_8;
      if ( !m_State )
        CAEVehicleAudioEntity::AddAudioEvent(this, 103, 0.0);
      v11 = this->m_pGameEntity;
      this->m_State = 1;
      this->m_fFadeIn = 1.0;
      this->m_fFadeOut = 1.0;
      if ( v11->m_nModelIndex == 457 )
      {
        v12 = -33.0;
        v13 = 1.0;
      }
      else
      {
        v62 = 0;
        v63 = fRatio / 0.2;
        v64 = 0;
        v65 = 0;
        v66 = 0.0;
        v67 = (float)((float)(fRatio / 0.2) * 3.0) + -3.0;
        if ( (float)(fRatio / 0.2) < 1.0 )
          v62 = 1;
        v68 = v63 < 1.0;
        v69 = v63 * 0.35;
        if ( (float)(fRatio / 0.2) < 0.0 )
          v64 = 1;
        v70 = v62 & v64;
        if ( v70 )
          v66 = -3.0;
        if ( !v68 )
          v65 = 1;
        v71 = v65 | v64;
        if ( v71 )
          v67 = v66;
        v72 = *(_DWORD *)&v11[17].m_nScanCode;
        v73 = v67 + -6.0;
        v74 = *(_DWORD *)&v11[20].RandomSeed;
        v75 = v72 & 0x40000000;
        if ( !v75 )
          v73 = v67;
        v76 = v69 + 0.85;
        *(float *)&v77 = 1.2;
        if ( v70 )
          *(float *)&v77 = 0.85;
        if ( v71 )
          v76 = *(float *)&v77;
        v78 = v73 + 6.0;
        if ( !v74 )
          v78 = v73;
        v13 = v76 * 0.7;
        if ( !v75 )
          v13 = v76;
        v12 = this->m_VehicleAudioSetting.EngineVolumeOffset + (float)(v78 + 0.0);
      }
      v60 = v13;
      v61 = v12;
      goto LABEL_159;
    case 1:
      if ( NewState == 2 )
      {
        v79 = this->m_pGameEntity;
        this->m_fFadeOut = 0.0;
        this->m_State = 2;
        if ( v79->m_nModelIndex == 457 )
        {
          v80 = -33.0;
          v81 = 1.0;
        }
        else
        {
          v81 = 1.0;
          v153 = 0.0;
          v154 = fRatio / 0.2;
          v155 = 0.0;
          if ( (float)(fRatio / 0.2) < 0.0 )
            v155 = -3.0;
          if ( (float)(fRatio / 0.2) < 1.0 )
            v153 = v155;
          v156 = v153;
          if ( (float)(fRatio / 0.2) < 1.0 )
            v156 = (float)((float)(fRatio / 0.2) * 3.0) + -3.0;
          if ( v154 < 0.0 )
            v156 = v153;
          PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(
                              0.0,
                              5,
                              CAEVehicleAudioEntity::GetVolumeForDummyIdle(float,float)::fIdleVolumeChangeUp);
          v158 = v156 + -6.0;
          v159 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
          v160 = this->m_pGameEntity;
          if ( (v160[17].m_areaCode & 0x40) == 0 )
            v158 = v156;
          v161 = v158 + 6.0;
          if ( !*(_DWORD *)&v160[20].RandomSeed )
            v161 = v158;
          v80 = this->m_VehicleAudioSetting.EngineVolumeOffset + (float)((float)(v159 * 20.0) + v161);
          if ( v160->m_nModelIndex != 457 )
          {
            *(float *)&v162 = 1.2;
            v163 = 1.0;
            v164 = 1067030938;
            if ( v154 < 0.0 )
              v164 = 1062836634;
            if ( v154 < 1.0 )
              v162 = v164;
            v165 = *(float *)&v162;
            if ( v154 < 1.0 )
              v165 = (float)(v154 * 0.35) + 0.85;
            if ( v154 < 0.0 )
              v165 = *(float *)&v162;
            if ( this->m_State == 2 )
            {
              v166 = CAEAudioUtility::GetPiecewiseLinear(
                       this->m_fFadeOut,
                       5,
                       CAEVehicleAudioEntity::GetFrequencyForDummyIdle(float,float)::fIdleFrequencyChangeUp);
              v160 = this->m_pGameEntity;
              v163 = v166;
            }
            v167 = v165 * 0.7;
            if ( (v160[17].m_areaCode & 0x40) == 0 )
              v167 = v165;
            v81 = v163 * v167;
          }
        }
        SoundPtr = this->m_EngineSounds[2].SoundPtr;
        v169 = 0;
        v170 = 0;
        if ( SoundPtr )
        {
          v171 = v80 + this->m_fEventVolume;
          SoundPtr->m_RelativeFrequency = v81;
          SoundPtr->m_EmittedVolume = v171;
        }
        v172 = fRatio + -0.15;
        v173 = 1.0;
        v174 = v172 / 0.85;
        v145 = (float)(v172 / 0.85) < 1.0;
        v175 = (float)(v172 / 0.85) < 0.0;
        v176 = (float)((float)(v172 / 0.85) * 4.5) + -4.5;
        v177 = 0.0;
        if ( v145 )
          v169 = 1;
        if ( v175 )
          v170 = 1;
        v178 = v169 & v170;
        v25 = (v169 & v170) == 0;
        v179 = 0;
        if ( !v25 )
          v177 = -4.5;
        if ( v174 >= 1.0 )
          v179 = 1;
        v180 = v170 | v179;
        if ( v170 | v179 )
          v176 = v177;
        v181 = (unsigned __int8)this->m_State;
        this->m_fFadeIn = 0.0;
        if ( v181 == 2 )
        {
          v182 = 20.0;
          v183 = CAEAudioUtility::GetPiecewiseLinear(
                   0.0,
                   5,
                   CAEVehicleAudioEntity::GetVolumeForDummyRev(float,float)::fRevVolumeChangeUp);
        }
        else
        {
          v182 = 10.0;
          v183 = 1.0;
        }
        v184 = v176 + -6.0;
        v185 = CAEAudioUtility::AudioLog10(v183);
        v186 = this->m_pGameEntity;
        v187 = *(_DWORD *)&v186[17].m_nScanCode;
        v188 = *(_DWORD *)&v186[20].RandomSeed;
        *(float *)&v189 = 1.5;
        if ( (v187 & 0x40000000) == 0 )
          v184 = v176;
        v190 = v184 + 6.0;
        if ( !v188 )
          v190 = v184;
        v191 = (float)(v182 * v185) + v190;
        if ( v178 )
          *(float *)&v189 = 0.9;
        v192 = (float)(v174 * 0.6) + 0.9;
        if ( v180 )
          v192 = *(float *)&v189;
        v193 = this->m_VehicleAudioSetting.EngineVolumeOffset + v191;
        if ( this->m_fFadeIn <= 0.99 && this->m_State == 2 )
        {
          v173 = CAEAudioUtility::GetPiecewiseLinear(
                   this->m_fFadeIn,
                   5,
                   CAEVehicleAudioEntity::GetFrequencyForDummyRev(float,float)::fRevFrequencyChangeUp);
          v187 = *(_DWORD *)&this->m_pGameEntity[17].m_nScanCode;
        }
        v61 = v193;
        v194 = v192 * 0.7;
        if ( (v187 & 0x40000000) == 0 )
          v194 = v192;
        v60 = v173 * v194;
LABEL_261:
        v121 = this;
        v122 = 1;
        goto LABEL_262;
      }
      if ( NewState == 1 )
      {
        v5.n64_u32[0] = 1.0;
        v14 = this->m_pGameEntity;
        v4.n64_f32[0] = this->m_fFadeIn + 0.1;
        this->m_State = 1;
        v15.n64_u64[0] = vmin_f32(v4, v5).n64_u64[0];
        LODWORD(this->m_fFadeIn) = v15.n64_u32[0];
        m_nModelIndex = (unsigned __int16)v14->m_nModelIndex;
        if ( m_nModelIndex == 457 )
        {
          v17 = -33.0;
        }
        else
        {
          v5.n64_u32[0] = 1.0;
          v123 = fRatio / 0.2;
          v124 = 0.0;
          v125 = 0.0;
          v126 = 0.0;
          if ( (float)(fRatio / 0.2) < 0.0 )
            v125 = -3.0;
          if ( (float)(fRatio / 0.2) < 1.0 )
            v126 = v125;
          v127 = v126;
          if ( (float)(fRatio / 0.2) < 1.0 )
            v127 = (float)((float)(fRatio / 0.2) * 3.0) + -3.0;
          if ( v123 < 0.0 )
            v127 = v126;
          if ( v15.n64_f32[0] <= 0.99 )
          {
            v128 = CAEAudioUtility::AudioLog10(v15.n64_f32[0]);
            v14 = this->m_pGameEntity;
            m_nModelIndex = (unsigned __int16)v14->m_nModelIndex;
            v124 = v128 * 10.0;
            v15.n64_u32[0] = LODWORD(this->m_fFadeIn);
          }
          v129 = v127 + -6.0;
          if ( (v14[17].m_areaCode & 0x40) == 0 )
            v129 = v127;
          v130 = v129 + 6.0;
          if ( !*(_DWORD *)&v14[20].RandomSeed )
            v130 = v129;
          v17 = this->m_VehicleAudioSetting.EngineVolumeOffset + (float)(v124 + v130);
          if ( m_nModelIndex != 457 )
          {
            *(float *)&v131 = 1.2;
            v132 = 1.0;
            v133 = 1067030938;
            if ( v123 < 0.0 )
              v133 = 1062836634;
            if ( v123 < 1.0 )
              v131 = v133;
            v134 = *(float *)&v131;
            if ( v123 < 1.0 )
              v134 = (float)(v123 * 0.35) + 0.85;
            if ( v123 < 0.0 )
              v134 = *(float *)&v131;
            if ( this->m_State == 2 )
            {
              v132 = CAEAudioUtility::GetPiecewiseLinear(
                       v15.n64_f32[0],
                       5,
                       CAEVehicleAudioEntity::GetFrequencyForDummyIdle(float,float)::fIdleFrequencyChangeUp);
              v14 = this->m_pGameEntity;
            }
            v135 = v134 * 0.7;
            if ( (v14[17].m_areaCode & 0x40) == 0 )
              v135 = v134;
            v5.n64_f32[0] = v132 * v135;
          }
        }
        v136 = this->m_EngineSounds[2].SoundPtr;
        if ( v136 )
        {
          v137 = v17 + this->m_fEventVolume;
          LODWORD(v136->m_RelativeFrequency) = v5.n64_u32[0];
          v136->m_EmittedVolume = v137;
        }
        v5.n64_u32[0] = 1.0;
        v15.n64_f32[0] = this->m_fFadeOut + 0.1;
        m_fFadeOut = vmin_f32(v15, v5).n64_f32[0];
        this->m_fFadeOut = m_fFadeOut;
        if ( m_fFadeOut < 0.99 )
        {
          v139 = 0;
          v140 = 0;
          v141 = fRatio + -0.15;
          v142 = 0.0;
          v143 = 0;
          v144 = v141 / 0.85;
          v145 = (float)(v141 / 0.85) < 1.0;
          v146 = (float)(v141 / 0.85) < 0.0;
          v147 = (float)((float)(v141 / 0.85) * 4.5) + -4.5;
          v148 = 0.0;
          if ( v145 )
            v139 = 1;
          if ( v146 )
            v140 = 1;
          v149 = v139 & v140;
          if ( (v139 & v140) != 0 )
            v148 = -4.5;
          if ( v144 >= 1.0 )
            v143 = 1;
          v150 = v140 | v143;
          if ( v140 | v143 )
            v147 = v148;
          if ( this->m_State == 2 )
          {
            if ( m_fFadeOut > 0.99 )
            {
              v151 = 0;
LABEL_277:
              v204 = this->m_pGameEntity;
              v205 = v147 + -6.0;
              if ( (v204[17].m_areaCode & 0x40) == 0 )
                v205 = v147;
              v206 = v205 + 6.0;
              if ( !*(_DWORD *)&v204[20].RandomSeed )
                v206 = v205;
              *(float *)&v207 = 1.5;
              if ( v149 )
                *(float *)&v207 = 0.9;
              EngineVolumeOffset = this->m_VehicleAudioSetting.EngineVolumeOffset;
              v209 = (float)(v144 * 0.6) + 0.9;
              if ( v150 )
                v209 = *(float *)&v207;
              if ( m_fFadeOut <= 0.99 && !v151 )
                v5.n64_u32[0] = CAEAudioUtility::GetPiecewiseLinear(
                                  m_fFadeOut,
                                  5,
                                  CAEVehicleAudioEntity::GetFrequencyForDummyRev(float,float)::fRevFrequencyChangeUp);
              v210 = this->m_EngineSounds[1].SoundPtr;
              if ( v210 )
              {
                v211 = v209 * 0.7;
                if ( (*(_DWORD *)&this->m_pGameEntity[17].m_nScanCode & 0x40000000) == 0 )
                  v211 = v209;
                v210->m_EmittedVolume = (float)(EngineVolumeOffset + (float)(v142 + v206)) + this->m_fEventVolume;
                v210->m_RelativeFrequency = v5.n64_f32[0] * v211;
              }
              return;
            }
            v201 = 20.0;
            v202 = CAEAudioUtility::GetPiecewiseLinear(
                     m_fFadeOut,
                     5,
                     CAEVehicleAudioEntity::GetVolumeForDummyRev(float,float)::fRevVolumeChangeUp);
          }
          else
          {
            v201 = 10.0;
            v202 = 1.0 - m_fFadeOut;
          }
          v203 = CAEAudioUtility::AudioLog10(v202);
          v151 = 0;
          v142 = v201 * v203;
          m_fFadeOut = this->m_fFadeOut;
          if ( this->m_State != 2 )
            v151 = 1;
          goto LABEL_277;
        }
      }
      else
      {
        v82 = this->m_EngineSounds[2].SoundPtr;
        this->m_State = 0;
        if ( v82 )
        {
          CAESound::SetIndividualEnvironment(v82, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[2].SoundPtr);
          this->m_EngineSounds[2].SoundPtr = 0;
        }
      }
      v152 = this->m_EngineSounds[1].SoundPtr;
      if ( v152 )
      {
        CAESound::SetIndividualEnvironment(v152, 4u, 0);
        CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
        this->m_EngineSounds[1].SoundPtr = 0;
      }
      return;
    case 2:
      if ( NewState == 2 )
      {
        v6.n64_u32[0] = 1.0;
        v83 = 0LL;
        v84 = 0.0;
        v85 = 0;
        v86 = (float)(fRatio + -0.15) / 0.85;
        v87 = (float)(v86 * 4.5) + -4.5;
        v88 = 0.0;
        if ( v86 < 1.0 )
          LODWORD(v83) = 1;
        v4.n64_f32[0] = this->m_fFadeIn + 0.05;
        v89.n64_u64[0] = vmin_f32(v4, v6).n64_u64[0];
        if ( v86 < 0.0 )
          HIDWORD(v83) = 1;
        v90 = v83 & HIDWORD(v83);
        v25 = ((unsigned int)v83 & HIDWORD(v83)) == 0;
        LODWORD(v83) = 0;
        if ( !v25 )
          v88 = -4.5;
        if ( v86 >= 1.0 )
          LODWORD(v83) = 1;
        v91 = HIDWORD(v83) | v83;
        if ( v83 )
          v87 = v88;
        this->m_State = 2;
        LODWORD(this->m_fFadeIn) = v89.n64_u32[0];
        if ( v89.n64_f32[0] <= 0.99 )
        {
          v92 = CAEAudioUtility::GetPiecewiseLinear(
                  v89.n64_f32[0],
                  5,
                  CAEVehicleAudioEntity::GetVolumeForDummyRev(float,float)::fRevVolumeChangeUp);
          v84 = CAEAudioUtility::AudioLog10(v92) * 20.0;
          v89.n64_u32[0] = LODWORD(this->m_fFadeIn);
          if ( this->m_State != 2 )
            v85 = 1;
        }
        v93 = this->m_pGameEntity;
        v94 = v87 + -6.0;
        if ( (v93[17].m_areaCode & 0x40) == 0 )
          v94 = v87;
        v95 = v94 + 6.0;
        if ( !*(_DWORD *)&v93[20].RandomSeed )
          v95 = v94;
        *(float *)&v96 = 1.5;
        v97 = (float)(v86 * 0.6) + 0.9;
        if ( v90 )
          *(float *)&v96 = 0.9;
        v98 = this->m_VehicleAudioSetting.EngineVolumeOffset;
        if ( v91 )
          v97 = *(float *)&v96;
        if ( v89.n64_f32[0] <= 0.99 && !v85 )
          v6.n64_u32[0] = CAEAudioUtility::GetPiecewiseLinear(
                            v89.n64_f32[0],
                            5,
                            CAEVehicleAudioEntity::GetFrequencyForDummyRev(float,float)::fRevFrequencyChangeUp);
        v99 = this->m_EngineSounds[1].SoundPtr;
        if ( v99 )
        {
          v100 = v97 * 0.7;
          if ( (*(_DWORD *)&this->m_pGameEntity[17].m_nScanCode & 0x40000000) == 0 )
            v100 = v97;
          v99->m_EmittedVolume = (float)(v98 + (float)(v84 + v95)) + this->m_fEventVolume;
          v99->m_RelativeFrequency = v6.n64_f32[0] * v100;
        }
        v6.n64_u32[0] = 1.0;
        v89.n64_f32[0] = this->m_fFadeOut + 0.05;
        v101 = vmin_f32(v89, v6).n64_f32[0];
        this->m_fFadeOut = v101;
        if ( v101 >= 0.99 )
          goto LABEL_128;
        if ( v101 < 0.75 && v101 > 0.65 )
        {
          *(_DWORD *)&vp->pVehicle->m_nVehicleFlags |= 0x20000000u;
          v101 = this->m_fFadeOut;
        }
        v102 = this->m_pGameEntity;
        v103 = (unsigned __int16)v102->m_nModelIndex;
        if ( v103 == 457 )
        {
          v104 = -33.0;
LABEL_313:
          v220 = this->m_EngineSounds[2].SoundPtr;
          if ( v220 )
          {
            v221 = v104 + this->m_fEventVolume;
            LODWORD(v220->m_RelativeFrequency) = v6.n64_u32[0];
            v220->m_EmittedVolume = v221;
          }
          return;
        }
        v6.n64_u32[0] = 1.0;
        v195 = fRatio / 0.2;
        v196 = 0.0;
        v197 = 0.0;
        v198 = 0.0;
        if ( v195 < 0.0 )
          v197 = -3.0;
        if ( v195 < 1.0 )
          v198 = v197;
        v199 = v198;
        if ( v195 < 1.0 )
          v199 = (float)(v195 * 3.0) + -3.0;
        if ( v195 < 0.0 )
          v199 = v198;
        if ( this->m_State == 2 )
        {
          v200 = 20.0;
          v101 = CAEAudioUtility::GetPiecewiseLinear(
                   v101,
                   5,
                   CAEVehicleAudioEntity::GetVolumeForDummyIdle(float,float)::fIdleVolumeChangeUp);
        }
        else
        {
          if ( v101 > 0.99 )
          {
LABEL_295:
            v213 = v199 + -6.0;
            if ( (v102[17].m_areaCode & 0x40) == 0 )
              v213 = v199;
            v214 = v213 + 6.0;
            if ( !*(_DWORD *)&v102[20].RandomSeed )
              v214 = v213;
            v104 = this->m_VehicleAudioSetting.EngineVolumeOffset + (float)(v196 + v214);
            if ( v103 != 457 )
            {
              *(float *)&v215 = 1.2;
              v216 = 1.0;
              v217 = 1067030938;
              if ( v195 < 0.0 )
                v217 = 1062836634;
              if ( v195 < 1.0 )
                v215 = v217;
              v218 = *(float *)&v215;
              if ( v195 < 1.0 )
                v218 = (float)(v195 * 0.35) + 0.85;
              if ( v195 < 0.0 )
                v218 = *(float *)&v215;
              if ( this->m_State == 2 )
              {
                v216 = CAEAudioUtility::GetPiecewiseLinear(
                         v101,
                         5,
                         CAEVehicleAudioEntity::GetFrequencyForDummyIdle(float,float)::fIdleFrequencyChangeUp);
                v102 = this->m_pGameEntity;
              }
              v219 = v218 * 0.7;
              if ( (v102[17].m_areaCode & 0x40) == 0 )
                v219 = v218;
              v6.n64_f32[0] = v216 * v219;
            }
            goto LABEL_313;
          }
          v200 = 10.0;
        }
        v212 = CAEAudioUtility::AudioLog10(v101);
        v102 = this->m_pGameEntity;
        v196 = v200 * v212;
        v101 = this->m_fFadeOut;
        v103 = (unsigned __int16)v102->m_nModelIndex;
        goto LABEL_295;
      }
      if ( NewState != 1 )
      {
        v105 = this->m_EngineSounds[1].SoundPtr;
        this->m_State = 0;
        if ( v105 )
        {
          CAESound::SetIndividualEnvironment(v105, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
          this->m_EngineSounds[1].SoundPtr = 0;
        }
LABEL_128:
        v106 = this->m_EngineSounds[2].SoundPtr;
        if ( v106 )
        {
          CAESound::SetIndividualEnvironment(v106, 4u, 0);
          CAESound::StopSound(this->m_EngineSounds[2].SoundPtr);
          this->m_EngineSounds[2].SoundPtr = 0;
        }
        return;
      }
      v18 = 1.0;
      v19 = 0;
      v20 = 0.0;
      v21 = 0;
      v22 = (float)(fRatio + -0.15) / 0.85;
      v23 = (float)(v22 * 4.5) + -4.5;
      v24 = 0.0;
      if ( v22 < 1.0 )
        v19 = 1;
      if ( v22 < 0.0 )
        v21 = 1;
      v26 = v19 & v21;
      v25 = (v19 & v21) == 0;
      v27 = 0;
      if ( !v25 )
        v24 = -4.5;
      if ( v22 >= 1.0 )
        v27 = 1;
      v28 = v21 | v27;
      if ( v21 | v27 )
        v23 = v24;
      this->m_fFadeOut = 0.0;
      v29 = v23 + -6.0;
      this->m_State = 1;
      v30 = CAEAudioUtility::AudioLog10(1.0);
      v31 = this->m_pGameEntity;
      *(float *)&v32 = 1.5;
      if ( (v31[17].m_areaCode & 0x40) == 0 )
        v29 = v23;
      v33 = v29 + 6.0;
      if ( !*(_DWORD *)&v31[20].RandomSeed )
        v33 = v29;
      if ( v26 )
        *(float *)&v32 = 0.9;
      v34 = (float)(v22 * 0.6) + 0.9;
      v35 = this->m_VehicleAudioSetting.EngineVolumeOffset;
      if ( v28 )
        v34 = *(float *)&v32;
      if ( this->m_fFadeOut <= 0.99 && this->m_State == 2 )
        v18 = CAEAudioUtility::GetPiecewiseLinear(
                this->m_fFadeOut,
                5,
                CAEVehicleAudioEntity::GetFrequencyForDummyRev(float,float)::fRevFrequencyChangeUp);
      v36 = 10.0;
      v37 = this->m_EngineSounds[1].SoundPtr;
      if ( v37 )
      {
        v38 = v34 * 0.7;
        if ( (*(_DWORD *)&this->m_pGameEntity[17].m_nScanCode & 0x40000000) == 0 )
          v38 = v34;
        v37->m_EmittedVolume = (float)(v35 + (float)((float)(v30 * 10.0) + v33)) + this->m_fEventVolume;
        v37->m_RelativeFrequency = v18 * v38;
      }
      v39 = this->m_pGameEntity;
      this->m_fFadeIn = 0.0;
      if ( v39->m_nModelIndex == 457 )
      {
        v40 = 1.0;
        v41 = -33.0;
      }
      else
      {
        v40 = 1.0;
        v107 = fRatio / 0.2;
        v108 = 0.0;
        v109 = 0.0;
        if ( v107 < 0.0 )
          v108 = -3.0;
        if ( v107 < 1.0 )
          v109 = v108;
        v110 = v109;
        if ( v107 < 1.0 )
          v110 = (float)(v107 * 3.0) + -3.0;
        if ( v107 < 0.0 )
          v110 = v109;
        if ( this->m_State == 2 )
        {
          v36 = 20.0;
          v20 = CAEAudioUtility::GetPiecewiseLinear(
                  0.0,
                  5,
                  CAEVehicleAudioEntity::GetVolumeForDummyIdle(float,float)::fIdleVolumeChangeUp);
        }
        v111 = v110 + -6.0;
        v112 = CAEAudioUtility::AudioLog10(v20);
        v113 = this->m_pGameEntity;
        if ( (v113[17].m_areaCode & 0x40) == 0 )
          v111 = v110;
        v114 = v111 + 6.0;
        if ( !*(_DWORD *)&v113[20].RandomSeed )
          v114 = v111;
        v41 = this->m_VehicleAudioSetting.EngineVolumeOffset + (float)((float)(v36 * v112) + v114);
        if ( v113->m_nModelIndex != 457 )
        {
          *(float *)&v115 = 1.2;
          v116 = 1.0;
          v117 = 1067030938;
          if ( v107 < 0.0 )
            v117 = 1062836634;
          if ( v107 < 1.0 )
            v115 = v117;
          v118 = *(float *)&v115;
          if ( v107 < 1.0 )
            v118 = (float)(v107 * 0.35) + 0.85;
          if ( v107 < 0.0 )
            v118 = *(float *)&v115;
          if ( this->m_State == 2 )
          {
            v119 = CAEAudioUtility::GetPiecewiseLinear(
                     this->m_fFadeIn,
                     5,
                     CAEVehicleAudioEntity::GetFrequencyForDummyIdle(float,float)::fIdleFrequencyChangeUp);
            v113 = this->m_pGameEntity;
            v116 = v119;
          }
          v120 = v118 * 0.7;
          if ( (v113[17].m_areaCode & 0x40) == 0 )
            v120 = v118;
          v40 = v116 * v120;
        }
      }
      v60 = v40;
      v61 = v41;
LABEL_159:
      v121 = this;
      v122 = 2;
LABEL_262:
      CAEVehicleAudioEntity::StartVehicleEngineSound(v121, v122, v60, v61);
      return;
    default:
LABEL_8:
      this->m_State = 0;
      return;
  }
}
// 3B2A1E: variable 'v4' is possibly undefined
// 3B2A1E: variable 'v5' is possibly undefined
// 3B2E62: variable 'v6' is possibly undefined

//----- (003B3968) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::IsAccInhibited(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  return !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40)
      || vp->ThisBrake > 0
      || vp->bHandbrakeOn
      || vp->fWheelSpin > 5.0
      || vp->NumDriveWheelsOnGround == 0;
}

//----- (003B39B8) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::IsAccInhibitedBackwards(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float fWheelSpin; // s2
  int NumDriveWheelsOnGround; // r0
  char v4; // r2
  char v5; // r1

  fWheelSpin = vp->fWheelSpin;
  NumDriveWheelsOnGround = vp->NumDriveWheelsOnGround;
  v4 = 0;
  v5 = 0;
  if ( fWheelSpin > 5.0 )
    v4 = 1;
  if ( !NumDriveWheelsOnGround )
    v5 = 1;
  return v4 | v5;
}

//----- (003B39E0) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::IsAccInhibitedForLowSpeed(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float fSpeed; // s2
  char v3; // r2
  char v4; // r1
  int m_bSingleGear; // r0

  fSpeed = vp->fSpeed;
  v3 = 0;
  v4 = 0;
  m_bSingleGear = this->m_bSingleGear;
  if ( fSpeed < 0.1 )
    v3 = 1;
  if ( !m_bSingleGear )
    v4 = 1;
  return v4 & v3;
}

//----- (003B3A0C) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::IsAccInhibitedForTime(CAEVehicleAudioEntity *this)
{
  return this->m_TimeBeforeAllowAccelerate < CTimer::m_snTimeInMilliseconds;
}

//----- (003B3A28) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::InhibitAccForTime(CAEVehicleAudioEntity *this, UInt32 Time)
{
  this->m_TimeBeforeAllowAccelerate = Time + CTimer::m_snTimeInMilliseconds;
}

//----- (003B3A3C) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::IsCrzInhibitedForTime(CAEVehicleAudioEntity *this)
{
  return this->m_TimeBeforeAllowCruise < CTimer::m_snTimeInMilliseconds;
}

//----- (003B3A58) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::InhibitCrzForTime(CAEVehicleAudioEntity *this, UInt32 Time)
{
  this->m_TimeBeforeAllowCruise = Time + CTimer::m_snTimeInMilliseconds;
}

//----- (003B3A6C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::GetAccelAndBrake(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  CPad *PadFromPlayer; // r5

  if ( !CAEVehicleAudioEntity::s_pPlayerDriver
    || this->m_bPlayerDriverAboutToExit
    || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
    || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
  {
    vp->ThisAccel = 0;
    vp->ThisBrake = 0;
  }
  else
  {
    PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
    vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
    vp->ThisBrake = CPad::GetBrake(PadFromPlayer);
  }
}

//----- (003B3AC0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::CancelVehicleEngineSound(CAEVehicleAudioEntity *this, Int16 SoundType)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d2
  int v4; // r5
  char *v6; // r6
  __int16 m_nLength; // r9
  CAESound *v8; // r0
  CAESound **v9; // r6
  CAESound *v10; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  float v12; // s0
  int v13; // r0

  v4 = SoundType;
  v6 = (char *)this + 8 * SoundType;
  m_nLength = -1;
  v10 = (CAESound *)*((_DWORD *)v6 + 58);
  v9 = (CAESound **)(v6 + 232);
  v8 = v10;
  if ( v10 )
    m_nLength = v8->m_nLength;
  if ( (unsigned __int16)SoundType <= 0xBu )
  {
    if ( v8 )
    {
      CAESound::SetIndividualEnvironment(v8, 4u, 0);
      CAESound::StopSound(*v9);
      *v9 = 0;
    }
    if ( v4 == 4 )
    {
      m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
      this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
      this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
      this->m_ACPlayPositionLastFrame = -1;
      this->m_ACPlayPositionThisFrame = -1;
      if ( m_nLength < 1 )
      {
        LOWORD(v13) = 0;
      }
      else
      {
        v3.n64_u32[0] = 1.0;
        v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
        v12 = vmin_f32(v2, v3).n64_f32[0];
        v13 = (int)(float)(v12 * 100.0);
        if ( v12 < 0.0 )
          LOWORD(v13) = 0;
      }
      this->m_ACPlayPercentWhenStopped = v13;
    }
  }
}
// 3B3B44: variable 'v2' is possibly undefined
// 3B3B44: variable 'v3' is possibly undefined

//----- (003B3B7C) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(
        CAEVehicleAudioEntity *this,
        cVehicleParams *vp,
        Int16 SoundType)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  int v6; // r6
  float fZOverSpeed; // s2
  float v9; // s16
  float v10; // s18
  CVehicle *pVehicle; // r4
  float v12; // s0
  float v13; // s2
  float v14; // s2
  float fWheelSpin; // s6
  float v16; // s4
  float v17; // s6
  float v18; // s2
  float v19; // s4
  float v20; // s4
  float v21; // s6
  float fSpeedRatio; // s4
  int v23; // r1
  int v24; // r0
  float v25; // s0
  float m_CurrentNitroRatio; // s4
  float v28; // s6
  float *v29; // r0

  v6 = SoundType;
  fZOverSpeed = vp->fZOverSpeed;
  if ( fZOverSpeed <= 0.0 )
  {
    v9 = 0.15;
    if ( fZOverSpeed > -0.2 )
      v9 = (float)(fZOverSpeed / -0.2) * 0.15;
  }
  else
  {
    v9 = -0.15;
    if ( fZOverSpeed < 0.2 )
      v9 = (float)(fZOverSpeed / 0.2) * -0.15;
  }
  v4.n64_f32[0] = vp->fAbsSpeed / vp->pTransmission->m_GearRatio[1].fChangeUpVelocity;
  v3.n64_u32[0] = 1.0;
  LODWORD(v10) = vmin_f32(v4, v3).n64_u32[0];
  if ( vp->fSpeed < -0.001 )
    v9 = -v9;
  if ( this->m_VehicleAudioSetting.VehicleAudioType == 1 )
  {
    pVehicle = vp->pVehicle;
    v12 = COERCE_FLOAT(COERCE_UNSIGNED_INT(sinf(pVehicle[1].m_vecCOM.x)) & 0x7FFFFFFF) * 0.12;
    v13 = v12 + 0.1;
    if ( (LOBYTE(pVehicle[1].m_vecTurnFriction.z) & 0x20) == 0 )
      v13 = v12;
    v3.n64_f32[0] = (float)(v13 * v10) + 1.0;
  }
  v14 = v9 * v10;
  switch ( v6 )
  {
    case 1:
      fWheelSpin = vp->fWheelSpin;
      if ( fWheelSpin <= 5.0 )
        v16 = (float)(fWheelSpin / 5.0) * 0.2;
      else
        v16 = (float)((float)((float)(fWheelSpin + -5.0) / 5.0) * 0.2) + 0.2;
      v18 = v14 + 1.0;
      v19 = v16 + 1.0;
      goto LABEL_30;
    case 2:
      fSpeedRatio = vp->fSpeedRatio;
      if ( fSpeedRatio >= 0.0 )
      {
        if ( fSpeedRatio >= 0.075 )
        {
          if ( fSpeedRatio >= 0.15 )
          {
            if ( fSpeedRatio >= 0.25 )
            {
              if ( fSpeedRatio >= 1.0001 )
              {
LABEL_46:
                v28 = 1.955;
                goto LABEL_50;
              }
              v24 = 4;
            }
            else
            {
              v24 = 3;
            }
          }
          else
          {
            v24 = 2;
          }
          v23 = 1;
        }
        else
        {
          v23 = 1;
          v24 = 1;
        }
      }
      else
      {
        v23 = 0;
        v24 = 0;
      }
      if ( fSpeedRatio > 1.0 )
        goto LABEL_46;
      v28 = 0.85;
      if ( fSpeedRatio >= 0.0 && v23 )
      {
        v29 = CAEVehicleAudioEntity::GetFreqForIdle(float)::IdleFreqAdj[v24];
        v28 = (float)((float)(*(v29 - 1)
                            + (float)((float)((float)(fSpeedRatio - *(v29 - 2)) / (float)(*v29 - *(v29 - 2)))
                                    * (float)(v29[1] - *(v29 - 1))))
                    * 0.65)
            + 0.85;
      }
LABEL_50:
      v14 = v3.n64_f32[0] * (float)((float)(v14 + 1.0) * v28);
      if ( vp->pVehicle->m_nModelIndex == 457 )
        v14 = 1.0;
LABEL_31:
      v25 = v14 * 0.7;
      if ( (this->m_pGameEntity[17].m_areaCode & 0x40) == 0 )
        v25 = v14;
      if ( this->m_bNitroOnLastFrame )
      {
        m_CurrentNitroRatio = this->m_CurrentNitroRatio;
        if ( m_CurrentNitroRatio <= 1.0 && m_CurrentNitroRatio >= 0.0 )
          return v25 * (float)((float)(m_CurrentNitroRatio * 0.12) + 1.0);
      }
      return v25;
    case 3:
      v17 = 1.0;
      v18 = v14 + 1.0;
      if ( !this->m_bSingleGear )
        v17 = 0.925;
      v19 = (float)((float)(this->m_CrzCount * 0.0021667) + v17) + (float)((float)(vp->fWheelSpin / 5.0) * 0.25);
      goto LABEL_30;
    case 4:
      if ( this->m_bSingleGear )
      {
        v20 = 1.0;
        v21 = (float)(vp->fWheelSpin / 5.0) * 0.25;
      }
      else
      {
        v20 = (float)(vp->fWheelSpin / 5.0) * 0.25;
        v21 = CAEVehicleAudioEntity::GetFreqForPlayerEngineSound(cVehicleParams &,short)::GearFreqAdj[this->m_AudioGear]
            + 1.0;
      }
      v19 = v20 + v21;
      v18 = v14 + 1.0;
      goto LABEL_30;
    case 5:
      v18 = v14 + 1.0;
      v19 = (float)(vp->fSpeedRatio * 0.5) + 0.75;
LABEL_30:
      v14 = v3.n64_f32[0] * (float)(v18 * v19);
      goto LABEL_31;
    default:
      goto LABEL_31;
  }
}
// 3B3C00: variable 'v4' is possibly undefined
// 3B3C00: variable 'v3' is possibly undefined

//----- (003B3EFC) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetVolForPlayerEngineSound(
        CAEVehicleAudioEntity *this,
        cVehicleParams *vp,
        Int16 SoundType)
{
  float v3; // s0
  float v4; // s0
  float fRealRevsRatio; // s2
  float v6; // s4
  float v7; // s0
  CEntity *m_pGameEntity; // r1
  float v9; // s2
  float v10; // s2
  float v11; // s0
  float m_CurrentNitroRatio; // s2

  switch ( SoundType )
  {
    case 1:
      v4 = 4.0;
      fRealRevsRatio = vp->fRealRevsRatio;
      v6 = -4.0;
      goto LABEL_10;
    case 2:
    case 5:
      if ( vp->pVehicle->m_nModelIndex == 457 )
      {
        v3 = -33.0;
        goto LABEL_12;
      }
      v4 = 1.5;
      fRealRevsRatio = vp->fSpeedRatio;
      v6 = -3.0;
LABEL_10:
      v7 = fRealRevsRatio * v4;
      goto LABEL_11;
    case 3:
      if ( this->m_bSingleGear )
        goto LABEL_8;
      v3 = this->m_CrzCount * 0.013333;
      goto LABEL_12;
    case 4:
      if ( this->m_bSingleGear )
      {
LABEL_8:
        v3 = -2.0;
      }
      else
      {
        v6 = -2.0;
        v7 = (float)this->m_AudioGear * 0.4;
LABEL_11:
        v3 = v7 + v6;
      }
LABEL_12:
      m_pGameEntity = this->m_pGameEntity;
      v9 = v3 + -6.0;
      if ( (m_pGameEntity[17].m_areaCode & 0x40) == 0 )
        v9 = v3;
      v10 = this->m_VehicleAudioSetting.EngineVolumeOffset + v9;
      v11 = v10 + 6.0;
      if ( !*(_DWORD *)&m_pGameEntity[20].RandomSeed )
        v11 = v10;
      if ( this->m_bNitroOnLastFrame )
      {
        m_CurrentNitroRatio = this->m_CurrentNitroRatio;
        if ( m_CurrentNitroRatio <= 1.0 && m_CurrentNitroRatio >= 0.0 )
          return v11 + (float)(m_CurrentNitroRatio * 3.0);
      }
      return v11;
    default:
      goto LABEL_12;
  }
}
// 3B3F74: variable 'v3' is possibly undefined

//----- (003B3FF0) --------------------------------------------------------
Int16 __fastcall CAEVehicleAudioEntity::RequestNewPlayerCarEngineSound(
        CAEVehicleAudioEntity *this,
        Int16 SoundType,
        float Frequency,
        float VehicleRelativeVolume)
{
  float32x2_t v4; // d0
  float32x2_t v5; // d1
  float32x2_t v6; // d2
  int m_DummySlot; // r2
  Int16 v10; // r6
  int v12; // r5
  Int16 m_PlayerEngineBank; // r1
  char *v14; // r9
  float m_fEventVolume; // s16
  bool v16; // zf
  CAESound *v17; // r0
  CAESound **v18; // r9
  CAESound *v19; // t1
  int m_nLength; // r11
  Int16 m_ACPlayPositionThisFrame; // r0
  int v22; // r0
  float v23; // s16
  CEntity *m_pGameEntity; // r0
  Int16 v25; // r1
  CMatrix *m_pMat; // r2
  RwReal *p_tx; // r3
  Int16 v28; // r2
  CEntity *v29; // r0
  CMatrix *v30; // r1
  CVector *v31; // r2
  CEntity *v32; // r0
  CMatrix *v33; // r2
  RwReal *p_x; // r3
  CEntity *v35; // r0
  CMatrix *v36; // r1
  CVector *p_m_translate; // r2
  CEntity *v39; // r0
  CMatrix *v40; // r1
  CVector *v41; // r2
  UInt32 m_TimeACStopped; // r0
  CVector v43; // [sp+0h] [bp-D0h]
  CAESound pRequestedSound; // [sp+2Ch] [bp-A4h] BYREF

  pRequestedSound.m_pPhysicalEntity = 0;
  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  v10 = -1;
  v12 = SoundType;
  if ( m_DummySlot == 0xFFFF )
    goto LABEL_34;
  if ( (unsigned int)(SoundType - 3) < 3 )
  {
    LOWORD(m_DummySlot) = 40;
    m_PlayerEngineBank = this->m_PlayerEngineBank;
    goto LABEL_6;
  }
  if ( (unsigned int)(SoundType - 1) <= 1 )
  {
    m_PlayerEngineBank = this->m_DummyEngineBank;
LABEL_6:
    if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_PlayerEngineBank, m_DummySlot) )
      goto LABEL_34;
  }
  v14 = (char *)this + 8 * v12;
  m_fEventVolume = this->m_fEventVolume;
  v16 = v12 == 5;
  v19 = (CAESound *)*((_DWORD *)v14 + 58);
  v18 = (CAESound **)(v14 + 232);
  v17 = v19;
  if ( v12 != 5 )
    v16 = v17 == 0;
  if ( !v16 && (unsigned __int16)v12 <= 0xBu )
  {
    m_nLength = v17->m_nLength;
    CAESound::SetIndividualEnvironment(v17, 4u, 0);
    CAESound::StopSound(*v18);
    *v18 = 0;
    if ( v12 == 4 )
    {
      m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
      this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
      this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
      this->m_ACPlayPositionLastFrame = -1;
      this->m_ACPlayPositionThisFrame = -1;
      if ( m_nLength < 1 )
      {
        LOWORD(v22) = 0;
      }
      else
      {
        v6.n64_u32[0] = 1.0;
        v4.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
        v4.n64_u64[0] = vmin_f32(v4, v6).n64_u64[0];
        v22 = (int)(float)(v4.n64_f32[0] * 100.0);
        if ( v4.n64_f32[0] < 0.0 )
          LOWORD(v22) = 0;
      }
      this->m_ACPlayPercentWhenStopped = v22;
    }
  }
  v23 = m_fEventVolume + VehicleRelativeVolume;
  switch ( v12 )
  {
    case 1:
      m_pGameEntity = this->m_pGameEntity;
      v25 = this->m_DummySlot;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = &m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate.x;
      v43.x = *p_tx;
      v43.y = p_tx[1];
      v43.z = p_tx[2];
      v28 = 0;
      goto LABEL_28;
    case 2:
      v32 = this->m_pGameEntity;
      v25 = this->m_DummySlot;
      v33 = v32->m_pMat;
      p_x = &v33->tx;
      if ( !v33 )
        p_x = &v32->m_transform.m_translate.x;
      v43.x = *p_x;
      v43.y = p_x[1];
      v43.z = p_x[2];
      v28 = 1;
LABEL_28:
      CAESound::Initialise(&pRequestedSound, v25, v28, this, v43, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      goto LABEL_32;
    case 3:
      v35 = this->m_pGameEntity;
      v36 = v35->m_pMat;
      p_m_translate = (CVector *)&v36->tx;
      if ( !v36 )
        p_m_translate = &v35->m_transform.m_translate;
      CAESound::Initialise(&pRequestedSound, 40, 1, this, *p_m_translate, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      goto LABEL_32;
    case 4:
      v39 = this->m_pGameEntity;
      v40 = v39->m_pMat;
      v41 = (CVector *)&v40->tx;
      if ( !v40 )
        v41 = &v39->m_transform.m_translate;
      CAESound::Initialise(&pRequestedSound, 40, 0, this, *v41, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      pRequestedSound.m_RelativeFrequency = Frequency;
      pRequestedSound.m_EmittedVolume = v23;
      pRequestedSound.m_Environment = 36;
      pRequestedSound.m_RollOffFactor = 2.0;
      m_TimeACStopped = this->m_TimeACStopped;
      this->m_FramesAgoACLooped = 0;
      if ( m_TimeACStopped + 1000 > CTimer::m_snTimeInMilliseconds )
      {
        v4.n64_u32[0] = 1148846080;
        v5.n64_f32[0] = (float)(CTimer::m_snTimeInMilliseconds - m_TimeACStopped);
        if ( (float)((float)(1.0 - (float)(vmin_f32(v5, v4).n64_f32[0] / 1000.0))
                   * (float)this->m_ACPlayPercentWhenStopped) >= 80.0 )
        {
          pRequestedSound.m_nPlayTime = 80;
          this->m_FramesAgoACLooped = 11;
        }
        else
        {
          pRequestedSound.m_nPlayTime = 0;
        }
      }
      break;
    case 5:
      v29 = this->m_pGameEntity;
      v30 = v29->m_pMat;
      v31 = (CVector *)&v30->tx;
      if ( !v30 )
        v31 = &v29->m_transform.m_translate;
      CAESound::Initialise(&pRequestedSound, 40, 2, this, *v31, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
LABEL_32:
      pRequestedSound.m_RelativeFrequency = Frequency;
      pRequestedSound.m_EmittedVolume = v23;
      pRequestedSound.m_Environment = 4;
      pRequestedSound.m_RollOffFactor = 2.0;
      break;
    default:
      break;
  }
  v10 = 0;
  *v18 = CAESoundManager::RequestNewSound(&AESoundManager, &pRequestedSound);
LABEL_34:
  CAESound::~CAESound(&pRequestedSound);
  return v10;
}
// 3B40BC: variable 'v4' is possibly undefined
// 3B40BC: variable 'v6' is possibly undefined
// 3B4270: variable 'v5' is possibly undefined

//----- (003B42FC) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::UpdateVehicleEngineSound(
        CAEVehicleAudioEntity *this,
        Int16 SoundType,
        float Frequency,
        float VehicleRelativeVolume)
{
  CAESound *SoundPtr; // r1
  float v5; // s0

  SoundPtr = this->m_EngineSounds[SoundType].SoundPtr;
  if ( SoundPtr )
  {
    v5 = this->m_fEventVolume + VehicleRelativeVolume;
    SoundPtr->m_RelativeFrequency = Frequency;
    SoundPtr->m_EmittedVolume = v5;
  }
}

//----- (003B4324) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::JustFinishedAccelerationLoop(CAEVehicleAudioEntity *this)
{
  int m_FramesAgoACLooped; // r1
  int m_ACPlayPositionThisFrame; // r2
  bool v3; // nf
  CAESound *SoundPtr; // r1
  int v5; // r3
  Bool8 v6; // r1

  m_FramesAgoACLooped = this->m_FramesAgoACLooped;
  if ( m_FramesAgoACLooped <= 9 )
  {
    this->m_FramesAgoACLooped = m_FramesAgoACLooped + 1;
    return 0;
  }
  m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
  v3 = m_ACPlayPositionThisFrame < 0;
  if ( m_ACPlayPositionThisFrame >= 0 )
    v3 = this->m_ACPlayPositionLastFrame < 0;
  if ( v3 )
    return 0;
  SoundPtr = this->m_EngineSounds[4].SoundPtr;
  if ( !SoundPtr )
    return 0;
  v5 = SoundPtr->m_nLength - 120;
  v6 = 0;
  if ( v5 < m_ACPlayPositionThisFrame )
  {
    this->m_FramesAgoACLooped = 0;
    return 1;
  }
  return v6;
}

//----- (003B4368) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetVolumeForDummyIdle(
        CAEVehicleAudioEntity *this,
        float fRatio,
        float fFadeRatio)
{
  CEntity *m_pGameEntity; // r0
  float v6; // s0
  float v7; // s12
  float v8; // s8
  float v9; // s16
  float v10; // s18
  float v11; // s0
  float v12; // s2
  float v13; // s4

  m_pGameEntity = this->m_pGameEntity;
  if ( m_pGameEntity->m_nModelIndex == 457 )
    return -33.0;
  v6 = 0.0;
  v7 = 0.0;
  v8 = 0.0;
  if ( (float)(fRatio / 0.2) < 0.0 )
    v7 = -3.0;
  if ( (float)(fRatio / 0.2) < 1.0 )
    v8 = v7;
  v9 = v8;
  if ( (float)(fRatio / 0.2) < 1.0 )
    v9 = (float)((float)(fRatio / 0.2) * 3.0) + -3.0;
  if ( (float)(fRatio / 0.2) < 0.0 )
    v9 = v8;
  if ( this->m_State == 2 )
  {
    fFadeRatio = CAEAudioUtility::GetPiecewiseLinear(
                   fFadeRatio,
                   5,
                   CAEVehicleAudioEntity::GetVolumeForDummyIdle(float,float)::fIdleVolumeChangeUp);
    v10 = 20.0;
LABEL_15:
    v11 = CAEAudioUtility::AudioLog10(fFadeRatio);
    m_pGameEntity = this->m_pGameEntity;
    v6 = v10 * v11;
    goto LABEL_16;
  }
  if ( fFadeRatio <= 0.99 )
  {
    v10 = 10.0;
    goto LABEL_15;
  }
LABEL_16:
  v12 = v9 + -6.0;
  if ( (m_pGameEntity[17].m_areaCode & 0x40) == 0 )
    v12 = v9;
  v13 = v12 + 6.0;
  if ( !*(_DWORD *)&m_pGameEntity[20].RandomSeed )
    v13 = v12;
  return this->m_VehicleAudioSetting.EngineVolumeOffset + (float)(v6 + v13);
}

//----- (003B447C) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetFrequencyForDummyIdle(
        CAEVehicleAudioEntity *this,
        float fRatio,
        float fFadeRatio)
{
  CEntity *m_pGameEntity; // r0
  int v6; // s4
  float PiecewiseLinear; // s0
  int v8; // s10
  float v9; // s16
  float v10; // s2

  m_pGameEntity = this->m_pGameEntity;
  if ( m_pGameEntity->m_nModelIndex == 457 )
    return 1.0;
  v6 = 1067030938;
  PiecewiseLinear = 1.0;
  v8 = 1067030938;
  if ( (float)(fRatio / 0.2) < 0.0 )
    v8 = 1062836634;
  if ( (float)(fRatio / 0.2) < 1.0 )
    v6 = v8;
  v9 = *(float *)&v6;
  if ( (float)(fRatio / 0.2) < 1.0 )
    v9 = (float)((float)(fRatio / 0.2) * 0.35) + 0.85;
  if ( (float)(fRatio / 0.2) < 0.0 )
    v9 = *(float *)&v6;
  if ( this->m_State == 2 )
  {
    PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(
                        fFadeRatio,
                        5,
                        CAEVehicleAudioEntity::GetFrequencyForDummyIdle(float,float)::fIdleFrequencyChangeUp);
    m_pGameEntity = this->m_pGameEntity;
  }
  v10 = v9 * 0.7;
  if ( (m_pGameEntity[17].m_areaCode & 0x40) == 0 )
    v10 = v9;
  return PiecewiseLinear * v10;
}

//----- (003B4550) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetVolumeForDummyRev(
        CAEVehicleAudioEntity *this,
        float fRatio,
        float fFadeRatio)
{
  float v4; // s4
  float v5; // s0
  float v6; // s10
  float v7; // s12
  float v8; // s16
  float v9; // s18
  float PiecewiseLinear; // s0
  CEntity *m_pGameEntity; // r0
  float v12; // s2
  float v13; // s4

  v4 = (float)(fRatio + -0.15) / 0.85;
  v5 = 0.0;
  v6 = 0.0;
  v7 = 0.0;
  if ( v4 < 0.0 )
    v6 = -4.5;
  if ( v4 < 1.0 )
    v7 = v6;
  v8 = v7;
  if ( v4 < 1.0 )
    v8 = (float)(v4 * 4.5) + -4.5;
  if ( v4 < 0.0 )
    v8 = v7;
  if ( this->m_State == 2 )
  {
    if ( fFadeRatio > 0.99 )
      goto LABEL_14;
    v9 = 20.0;
    PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(
                        fFadeRatio,
                        5,
                        CAEVehicleAudioEntity::GetVolumeForDummyRev(float,float)::fRevVolumeChangeUp);
  }
  else
  {
    v9 = 10.0;
    PiecewiseLinear = 1.0 - fFadeRatio;
  }
  v5 = v9 * CAEAudioUtility::AudioLog10(PiecewiseLinear);
LABEL_14:
  m_pGameEntity = this->m_pGameEntity;
  v12 = v8 + -6.0;
  if ( (m_pGameEntity[17].m_areaCode & 0x40) == 0 )
    v12 = v8;
  v13 = v12 + 6.0;
  if ( !*(_DWORD *)&m_pGameEntity[20].RandomSeed )
    v13 = v12;
  return this->m_VehicleAudioSetting.EngineVolumeOffset + (float)(v5 + v13);
}

//----- (003B4668) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetFrequencyForDummyRev(
        CAEVehicleAudioEntity *this,
        float fRatio,
        float fFadeRatio)
{
  float v3; // s4
  int v5; // s10
  float v6; // s2
  float PiecewiseLinear; // s0
  float v8; // s16
  float v9; // s2

  v3 = 1.5;
  v5 = 1.5;
  v6 = (float)(fRatio + -0.15) / 0.85;
  PiecewiseLinear = 1.0;
  if ( v6 < 0.0 )
    v5 = 1063675494;
  if ( v6 < 1.0 )
    v3 = *(float *)&v5;
  v8 = v3;
  if ( v6 < 1.0 )
    v8 = (float)(v6 * 0.6) + 0.9;
  if ( v6 < 0.0 )
    v8 = v3;
  if ( fFadeRatio <= 0.99 && this->m_State == 2 )
    PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(
                        fFadeRatio,
                        5,
                        CAEVehicleAudioEntity::GetFrequencyForDummyRev(float,float)::fRevFrequencyChangeUp);
  v9 = v8 * 0.7;
  if ( (this->m_pGameEntity[17].m_areaCode & 0x40) == 0 )
    v9 = v8;
  return PiecewiseLinear * v9;
}

//----- (003B4750) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::StartVehicleEngineSound(
        CAEVehicleAudioEntity *this,
        Int16 SoundType,
        float Frequency,
        float Volume)
{
  char *v5; // r5
  float v7; // s16
  int v8; // r0
  CAESound **v9; // r5
  int v10; // t1
  Int16 v11; // r2
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r3
  CVector *p_tx; // r4
  CAESound v15; // [sp+2Ch] [bp-94h] BYREF

  v15.m_pPhysicalEntity = 0;
  v5 = (char *)this + 8 * SoundType;
  v7 = this->m_fEventVolume + Volume;
  v10 = *((_DWORD *)v5 + 58);
  v9 = (CAESound **)(v5 + 232);
  v8 = v10;
  if ( v10 )
  {
    *(float *)(v8 + 20) = v7;
    *(float *)(v8 + 28) = Frequency;
  }
  else
  {
    if ( SoundType == 2 )
    {
      v11 = 1;
    }
    else
    {
      if ( SoundType != 1 )
        goto LABEL_10;
      v11 = 0;
    }
    m_pGameEntity = this->m_pGameEntity;
    m_pMat = m_pGameEntity->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pGameEntity->m_transform.m_translate;
    CAESound::Initialise(&v15, this->m_DummySlot, v11, this, *p_tx, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
    v15.m_RelativeFrequency = Frequency;
    v15.m_EmittedVolume = v7;
    v15.m_Environment = 4;
    v15.m_RollOffFactor = 2.0;
    *v9 = CAESoundManager::RequestNewSound(&AESoundManager, &v15);
  }
LABEL_10:
  CAESound::~CAESound(&v15);
}

//----- (003B4810) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayReverseSound(
        CAEVehicleAudioEntity *this,
        Int16 ReverseSoundID,
        float Frequency,
        float VehicleRelativeVolume)
{
  float v7; // s16
  int v8; // r6
  CAESound *m_ReverseSoundPtr; // r0
  CAESound *v10; // r0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r2
  CAESound v14; // [sp+2Ch] [bp-9Ch] BYREF

  v14.m_pPhysicalEntity = 0;
  v7 = this->m_fEventVolume + VehicleRelativeVolume;
  v8 = (unsigned __int16)ReverseSoundID;
  if ( this->m_ReverseSoundID == ReverseSoundID )
  {
    if ( (unsigned __int16)ReverseSoundID != 0xFFFF )
    {
      m_ReverseSoundPtr = this->m_ReverseSoundPtr;
      if ( m_ReverseSoundPtr )
      {
        m_ReverseSoundPtr->m_RelativeFrequency = Frequency;
        this->m_ReverseSoundPtr->m_EmittedVolume = v7;
      }
    }
  }
  else
  {
    v10 = this->m_ReverseSoundPtr;
    if ( v10 )
    {
      CAESound::SetIndividualEnvironment(v10, 4u, 0);
      CAESound::StopSound(this->m_ReverseSoundPtr);
      this->m_ReverseSoundPtr = 0;
    }
    this->m_ReverseSoundID = ReverseSoundID;
    if ( v8 != 0xFFFF )
    {
      m_pGameEntity = this->m_pGameEntity;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      CAESound::Initialise(&v14, 19, ReverseSoundID, this, *p_tx, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v14.m_RelativeFrequency = Frequency;
      v14.m_EmittedVolume = v7;
      v14.m_Environment = 4;
      this->m_ReverseSoundPtr = CAESoundManager::RequestNewSound(&AESoundManager, &v14);
    }
  }
  CAESound::~CAESound(&v14);
}

//----- (003B48EC) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::DisableHelicoptor(CAEVehicleAudioEntity *this)
{
  this->m_bHelicoptorDisabled = 1;
}

//----- (003B48F4) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::EnableHelicoptor(CAEVehicleAudioEntity *this)
{
  this->m_bHelicoptorDisabled = 0;
}

//----- (003B48FC) --------------------------------------------------------
Bool8 __fastcall CAEVehicleAudioEntity::CopHeli(CAEVehicleAudioEntity *this)
{
  return (unsigned __int16)(this->m_pGameEntity->m_nModelIndex - 487) < 2u;
}

//----- (003B4910) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetFreqForIdle(CAEVehicleAudioEntity *this, float fRatio)
{
  int v3; // r1
  int v4; // r0
  float v6; // s2
  float *v7; // r0

  if ( fRatio >= 0.0 )
  {
    if ( fRatio >= 0.075 )
    {
      if ( fRatio >= 0.15 )
      {
        if ( fRatio >= 0.25 )
        {
          if ( fRatio >= 1.0001 )
            return 1.7;
          v4 = 4;
        }
        else
        {
          v4 = 3;
        }
      }
      else
      {
        v4 = 2;
      }
      v3 = 1;
    }
    else
    {
      v3 = 1;
      v4 = 1;
    }
  }
  else
  {
    v3 = 0;
    v4 = 0;
  }
  if ( fRatio > 1.0 )
    return 1.7;
  v6 = 0.0;
  if ( fRatio >= 0.0 )
  {
    if ( v3 )
    {
      v7 = CAEVehicleAudioEntity::GetFreqForIdle(float)::IdleFreqAdj[v4];
      return *(v7 - 1)
           + (float)((float)((float)(fRatio - *(v7 - 2)) / (float)(*v7 - *(v7 - 2))) * (float)(v7[1] - *(v7 - 1)));
    }
  }
  return v6;
}

//----- (003B49E4) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayRoadNoiseSound(
        CAEVehicleAudioEntity *this,
        Int16 RoadNoiseSoundID,
        float Frequency,
        float VehicleRelativeVolume)
{
  float v7; // s16
  int v8; // r6
  CAESound *m_RoadNoiseSoundPtr; // r0
  CAESound *v10; // r0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r2
  CAESound v14; // [sp+2Ch] [bp-9Ch] BYREF

  v14.m_pPhysicalEntity = 0;
  v7 = this->m_fEventVolume + VehicleRelativeVolume;
  v8 = (unsigned __int16)RoadNoiseSoundID;
  if ( this->m_RoadNoiseSoundID == RoadNoiseSoundID )
  {
    if ( (unsigned __int16)RoadNoiseSoundID != 0xFFFF )
    {
      m_RoadNoiseSoundPtr = this->m_RoadNoiseSoundPtr;
      if ( m_RoadNoiseSoundPtr )
      {
        m_RoadNoiseSoundPtr->m_RelativeFrequency = Frequency;
        this->m_RoadNoiseSoundPtr->m_EmittedVolume = v7;
      }
    }
  }
  else
  {
    v10 = this->m_RoadNoiseSoundPtr;
    if ( v10 )
    {
      CAESound::SetIndividualEnvironment(v10, 4u, 0);
      CAESound::StopSound(this->m_RoadNoiseSoundPtr);
      this->m_RoadNoiseSoundPtr = 0;
    }
    this->m_RoadNoiseSoundID = RoadNoiseSoundID;
    if ( v8 != 0xFFFF )
    {
      m_pGameEntity = this->m_pGameEntity;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      CAESound::Initialise(&v14, 19, RoadNoiseSoundID, this, *p_tx, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v14.m_RelativeFrequency = Frequency;
      v14.m_EmittedVolume = v7;
      v14.m_Environment = 4;
      v14.m_RollOffFactor = 3.0;
      this->m_RoadNoiseSoundPtr = CAESoundManager::RequestNewSound(&AESoundManager, &v14);
    }
  }
  CAESound::~CAESound(&v14);
}

//----- (003B4AC8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayFlatTyreSound(
        CAEVehicleAudioEntity *this,
        Int16 FlatTyreSoundID,
        float Frequency,
        float VehicleRelativeVolume)
{
  float v7; // s16
  int v8; // r6
  CAESound *m_FlatTyreSoundPtr; // r0
  CAESound *v10; // r0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r2
  CAESound v14; // [sp+2Ch] [bp-9Ch] BYREF

  v14.m_pPhysicalEntity = 0;
  v7 = this->m_fEventVolume + VehicleRelativeVolume;
  v8 = (unsigned __int16)FlatTyreSoundID;
  if ( this->m_FlatTyreSoundID == FlatTyreSoundID )
  {
    if ( (unsigned __int16)FlatTyreSoundID != 0xFFFF )
    {
      m_FlatTyreSoundPtr = this->m_FlatTyreSoundPtr;
      if ( m_FlatTyreSoundPtr )
      {
        m_FlatTyreSoundPtr->m_RelativeFrequency = Frequency;
        this->m_FlatTyreSoundPtr->m_EmittedVolume = v7;
      }
    }
  }
  else
  {
    v10 = this->m_FlatTyreSoundPtr;
    if ( v10 )
    {
      CAESound::SetIndividualEnvironment(v10, 4u, 0);
      CAESound::StopSound(this->m_FlatTyreSoundPtr);
      this->m_FlatTyreSoundPtr = 0;
    }
    this->m_FlatTyreSoundID = FlatTyreSoundID;
    if ( v8 != 0xFFFF )
    {
      m_pGameEntity = this->m_pGameEntity;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      CAESound::Initialise(&v14, 19, FlatTyreSoundID, this, *p_tx, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v14.m_RelativeFrequency = Frequency;
      v14.m_EmittedVolume = v7;
      v14.m_Environment = 4;
      v14.m_RollOffFactor = 2.0;
      this->m_FlatTyreSoundPtr = CAESoundManager::RequestNewSound(&AESoundManager, &v14);
    }
  }
  CAESound::~CAESound(&v14);
}

//----- (003B4BAC) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetVehicleDriveWheelSkidValue(
        CAEVehicleAudioEntity *this,
        CVehicle *pVehicle,
        int32 WheelState,
        float fGasPedalAudioRevs,
        cTransmission *pTransmission,
        float fSpeed)
{
  float32x2_t v6; // d0
  float32x2_t v7; // d2
  float v8; // s0
  float v9; // s0
  float v10; // s2

  v8 = 0.0;
  if ( WheelState == 3 )
  {
    v10 = fabsf(fSpeed);
    if ( v10 > 0.04 )
    {
      v7.n64_u32[0] = 1.0;
      v6.n64_f32[0] = v10 * 5.0;
      return vmin_f32(v6, v7).n64_f32[0] * 1.2;
    }
    return v8;
  }
  if ( WheelState == 2 )
  {
    v9 = fabsf(fSpeed);
    if ( v9 <= 1.0 )
      return v9 * 0.75;
    return 0.75;
  }
  if ( WheelState != 1 || fGasPedalAudioRevs <= 0.4 )
    return v8;
  v9 = (float)(fGasPedalAudioRevs + -0.4) / 0.6;
  return v9 * 0.75;
}
// 3B4C06: variable 'v6' is possibly undefined
// 3B4C06: variable 'v7' is possibly undefined

//----- (003B4C58) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetVehicleNonDriveWheelSkidValue(
        CAEVehicleAudioEntity *this,
        CVehicle *pVehicle,
        int32 WheelState,
        cTransmission *pTransmission,
        float fSpeed)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d2
  float v7; // s0
  float v8; // s2
  float v9; // s0
  float v11; // s2

  v7 = 0.0;
  if ( WheelState == 3 )
  {
    v11 = fabsf(fSpeed);
    if ( v11 > 0.04 )
    {
      v6.n64_u32[0] = 1.0;
      v5.n64_f32[0] = v11 * 5.0;
      return vmin_f32(v5, v6).n64_f32[0] * 1.2;
    }
    return v7;
  }
  if ( WheelState != 2 )
    return v7;
  v8 = fabsf(fSpeed);
  v9 = v8 * 0.75;
  if ( v8 > 1.0 )
    v9 = 0.75;
  if ( this->m_VehicleAudioSetting.VehicleAudioType == 2 )
    return v9 * 0.2;
  return v9;
}
// 3B4CC2: variable 'v5' is possibly undefined
// 3B4CC2: variable 'v6' is possibly undefined

//----- (003B4CE0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerJet(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d9
  int RecordingNumber; // r6
  Int16 ThisAccel; // r1
  int Brake; // r0
  float v9; // s4
  float v10; // s0
  double v11; // d16
  double v12; // d17
  float v13; // s20
  float m_nHealth; // s0
  float v15; // s22
  CPad *PadFromPlayer; // r8
  bool v17; // zf
  Int32 *v18; // r1
  Int32 *v19; // r0
  Int32 *v20; // r2
  uint32 v21; // r6
  int m_nStalledCount; // r0
  Int16 v23; // r0
  int m_bSilentStalled; // r1

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    RecordingNumber = vp->pVehicle->AutoPilot.RecordingNumber;
    if ( RecordingNumber > -1
      || !CAEVehicleAudioEntity::s_pPlayerDriver
      || this->m_bPlayerDriverAboutToExit
      || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
      || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
    {
      ThisAccel = 0;
      Brake = 0;
      vp->ThisAccel = 0;
    }
    else
    {
      PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
      vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
      Brake = CPad::GetBrake(PadFromPlayer);
      ThisAccel = vp->ThisAccel;
    }
    if ( ThisAccel <= Brake )
      ThisAccel = Brake;
    v3.n64_u32[0] = 1.0;
    v2.n64_f32[0] = (float)ThisAccel / 255.0;
    v9 = vmin_f32(v2, v3).n64_f32[0];
    v2.n64_f32[0] = (float)(v9 * 0.3) + 0.7;
    if ( v9 < 0.0 )
      v2.n64_u32[0] = 1060320051;
    vp->ThisBrake = Brake;
    if ( RecordingNumber <= -1 )
      v2.n64_f32[0] = *(float *)&vp->pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
    v10 = vmin_f32(v2, v3).n64_f32[0];
    v11 = 0.0;
    if ( v10 >= 0.2 )
      v11 = (float)((float)(v10 + -0.2) / 0.8);
    v12 = 0.2;
    if ( v11 > 0.2 )
      v12 = v11;
    if ( this->m_nStallCounter )
      this->m_nStalledCount = 15;
    m_nHealth = vp->pVehicle->m_nHealth;
    if ( m_nHealth >= 250.0 )
    {
      if ( m_nHealth >= 390.0 )
      {
        if ( m_nHealth >= 460.0 )
        {
          if ( m_nHealth >= 650.0 )
          {
            v15 = 0.0;
LABEL_45:
            v13 = v12;
            CAEVehicleAudioEntity::ProcessGenericJet(
              this,
              (*(_DWORD *)&vp->pVehicle->m_nVehicleFlags & 0x10) != 0,
              vp,
              v13,
              (float)vp->ThisAccel / 255.0,
              (float)vp->ThisBrake / 255.0,
              v15,
              v3.n64_f32[0]);
            return;
          }
          v15 = -6.0;
          v3.n64_u32[0] = 1064514355;
        }
        else
        {
          v15 = -9.0;
          v3.n64_u32[0] = 1063675494;
        }
      }
      else
      {
        v15 = -12.0;
        v3.n64_u32[0] = 1062836634;
      }
    }
    else
    {
      v3.n64_u32[0] = 1061997773;
      v15 = -18.0;
    }
    if ( CTimer::m_snTimeInMilliseconds > this->m_nSwapStalledTime )
    {
      if ( this->m_bSilentStalled )
      {
        this->m_bSilentStalled = 0;
        v17 = CAEAudioUtility::ResolveProbability(0.85) == 0;
        v18 = &AE_MIN_STALL_SHORT_SILENT_TIME;
        v19 = &AE_MIN_STALL_SHORT_PLAYING_TIME;
        if ( v17 )
          v18 = &AE_MAX_STALL_LONG_PLAYING_TIME;
        v20 = &AE_MAX_STALL_SHORT_SILENT_TIME;
      }
      else
      {
        this->m_bSilentStalled = 1;
        v17 = CAEAudioUtility::ResolveProbability(0.95) == 0;
        v18 = &AE_MAX_STALL_SHORT_SILENT_TIME;
        v19 = &AE_MIN_STALL_SHORT_SILENT_TIME;
        if ( v17 )
          v18 = &AE_MAX_STALL_LONG_SILENT_TIME;
        v20 = &AE_MIN_STALL_LONG_SILENT_TIME;
      }
      if ( v17 )
        v19 = v20;
      v21 = CTimer::m_snTimeInMilliseconds;
      this->m_nSwapStalledTime = CAEAudioUtility::GetRandomNumberInRange(*v19, *v18) + v21;
    }
    m_nStalledCount = this->m_nStalledCount;
    if ( m_nStalledCount < 1 )
      v23 = 0;
    else
      v23 = m_nStalledCount - 1;
    m_bSilentStalled = this->m_bSilentStalled;
    this->m_nStalledCount = v23;
    if ( !m_bSilentStalled )
      v15 = 0.0;
    goto LABEL_45;
  }
}
// 3B4D3A: variable 'v2' is possibly undefined
// 3B4D3A: variable 'v3' is possibly undefined

//----- (003B4FD0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerProp(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d2
  float32x2_t v4; // d8
  float32x2_t v5; // d9
  CVehicle *pVehicle; // r1
  int i; // r6
  int v10; // r0
  char *v11; // r4
  __int16 m_nLength; // r5
  CAESound *v13; // r0
  CAESound **v14; // r4
  CAESound *v15; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  float32x2_t v17; // d0
  float PiecewiseLinear; // s20
  CPad *PadFromPlayer; // r8
  Int16 Brake; // r0
  CEntity *m_pGameEntity; // r0
  CSimpleTransform *p_m_transform; // r9
  CSimpleTransform *p_tx; // r3
  CMatrix *m_pMat; // r2
  float *p_x; // r1
  RwReal v26; // s2
  RwReal v27; // s4
  CMatrix *v28; // r0
  int ThisBrake; // r10
  float xy; // s22
  float yy; // s24
  float zy; // s28
  float xx; // s30
  float yx; // s21
  float zx; // s26
  int ThisAccel; // r4
  float v37; // s25
  float v38; // r3
  CEntity *v39; // r0
  CMatrix *v40; // r1
  float *v41; // r2
  int *v42; // r0
  float v43; // s2
  float v44; // s0
  float v45; // s29
  float v46; // s26
  float v47; // s20
  float v48; // r4
  float v49; // r0
  float v50; // s0
  float v51; // r4
  float v52; // s20
  float v53; // r0
  float v54; // s21
  float v55; // s30
  float v56; // s27
  int m_nStalledCount; // r1
  float m_nHealth; // s0
  float v59; // s28
  bool v60; // zf
  Int32 *v61; // r1
  Int32 *v62; // r0
  int *v63; // r2
  uint32 v64; // r4
  Int32 RandomNumberInRange; // r0
  Int16 v66; // r0
  int m_bSilentStalled; // r1
  float m_CurrentRotorFrequency; // s8
  unsigned __int32 Frequency; // s22
  CVehicle *v70; // [sp+Ch] [bp-C4h]
  float v71; // [sp+10h] [bp-C0h]
  float v72; // [sp+14h] [bp-BCh]
  float fRatio; // [sp+18h] [bp-B8h]
  CVector v74; // [sp+1Ch] [bp-B4h] BYREF
  CMatrix v75; // [sp+28h] [bp-A8h] BYREF

  v75.m_pRwMat = 0;
  v75.m_owner = 0;
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40)
    || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    goto LABEL_75;
  }
  pVehicle = vp->pVehicle;
  if ( (*(_BYTE *)&pVehicle->m_nVehicleFlags & 0x10) == 0 )
  {
    v5.n64_u32[0] = 1.0;
    for ( i = 0; i != 12; ++i )
    {
      while ( 1 )
      {
        v11 = (char *)this + 8 * i;
        m_nLength = -1;
        v15 = (CAESound *)*((_DWORD *)v11 + 58);
        v14 = (CAESound **)(v11 + 232);
        v13 = v15;
        if ( v15 )
        {
          m_nLength = v13->m_nLength;
          CAESound::SetIndividualEnvironment(v13, 4u, 0);
          CAESound::StopSound(*v14);
          *v14 = 0;
        }
        if ( i != 4 )
          break;
        m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
        this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
        this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
        this->m_ACPlayPositionLastFrame = -1;
        this->m_ACPlayPositionThisFrame = -1;
        if ( m_nLength < 1 )
        {
          LOWORD(v10) = 0;
        }
        else
        {
          v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
          v2.n64_u64[0] = vmin_f32(v2, v5).n64_u64[0];
          v10 = (int)(float)(v2.n64_f32[0] * 100.0);
          if ( v2.n64_f32[0] < 0.0 )
            LOWORD(v10) = 0;
        }
        this->m_ACPlayPercentWhenStopped = v10;
        i = 5;
      }
    }
    goto LABEL_75;
  }
  v70 = vp->pVehicle;
  v4.n64_u32[0] = 1.0;
  v5.n64_u32[0] = 0;
  v2.n64_f32[0] = *(float *)&pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
  v17.n64_u64[0] = vmax_f32(vmin_f32(v2, v4), v5).n64_u64[0];
  PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v17.n64_f32[0], 3, fPlaneVol);
  fRatio = PiecewiseLinear;
  if ( !CAEVehicleAudioEntity::s_pPlayerDriver
    || this->m_bPlayerDriverAboutToExit
    || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
    || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
  {
    Brake = 0;
    vp->ThisAccel = 0;
  }
  else
  {
    PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
    vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
    Brake = CPad::GetBrake(PadFromPlayer);
  }
  vp->ThisBrake = Brake;
  CMatrix::operator=(&v75, &TheCamera.m_cameraMatrix);
  m_pGameEntity = this->m_pGameEntity;
  p_m_transform = &TheCamera.m_transform;
  p_tx = &TheCamera.m_transform;
  m_pMat = m_pGameEntity->m_pMat;
  if ( TheCamera.m_pMat )
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  p_x = &m_pMat->tx;
  if ( !m_pMat )
    p_x = &m_pGameEntity->m_transform.m_translate.x;
  v26 = p_x[1] - p_tx->m_translate.y;
  v27 = p_x[2] - p_tx->m_translate.z;
  v74.x = *p_x - p_tx->m_translate.x;
  v74.y = v26;
  v74.z = v27;
  CVector::Normalise(&v74);
  v28 = vp->pVehicle->m_pMat;
  ThisBrake = vp->ThisBrake;
  xy = v28->xy;
  yy = v28->yy;
  zy = v28->zy;
  xx = v28->xx;
  yx = v28->yx;
  zx = v28->zx;
  ThisAccel = vp->ThisAccel;
  v37 = (float)((float)((float)((float)(xy * v74.x) + (float)(yy * v74.y)) + (float)(zy * v74.z)) + 1.0) * 0.5;
  v72 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)(v37 * -0.67) + 1.0));
  v71 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)(v37 * 0.5) + 0.5));
  v38 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
  v39 = this->m_pGameEntity;
  if ( TheCamera.m_pMat )
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  v40 = v39->m_pMat;
  v41 = &v40->tx;
  if ( !v40 )
    v41 = &v39->m_transform.m_translate.x;
  v42 = &dword_3B55B0;
  if ( ThisAccel > 0 )
    v42 = &dword_3B55B4;
  v43 = v41[1] - p_m_transform->m_translate.y;
  v44 = sqrtf(
          (float)((float)((float)(*v41 - p_m_transform->m_translate.x) * (float)(*v41 - p_m_transform->m_translate.x))
                + (float)(v43 * v43))
        + (float)((float)(v41[2] - p_m_transform->m_translate.z) * (float)(v41[2] - p_m_transform->m_translate.z)));
  v45 = zx + (float)((float)(xx * 0.0) + (float)(yx * 0.0));
  v46 = *(float *)v42;
  if ( ThisBrake > 0 )
    v46 = *(float *)v42 + -0.05;
  if ( v44 >= 128.0 )
  {
    v48 = v38;
    v49 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
    v38 = v48;
    v50 = v49 * 20.0;
  }
  else
  {
    if ( v44 < 48.0 )
    {
      v47 = -100.0;
      goto LABEL_40;
    }
    v51 = v38;
    v52 = CAEAudioUtility::AudioLog10((float)(v44 + -48.0) / 80.0);
    v53 = CAEAudioUtility::AudioLog10(fRatio);
    v38 = v51;
    v50 = (float)(v52 * 20.0) + (float)(v53 * 20.0);
  }
  v47 = v50 + 8.0;
LABEL_40:
  v54 = (float)((float)(xy * 0.0) + (float)(yy * 0.0)) + zy;
  v55 = fabsf(v45);
  v56 = v38;
  if ( this->m_nStallCounter )
  {
    LOWORD(m_nStalledCount) = 15;
    this->m_nStalledCount = 15;
  }
  else
  {
    m_nStalledCount = this->m_nStalledCount;
    if ( m_nStalledCount < 1 )
      goto LABEL_44;
  }
  if ( !LOBYTE(v70[1].AutoPilot.TempActionFinish) )
  {
    v59 = -12.0;
    v4.n64_u32[0] = 1061997773;
    goto LABEL_53;
  }
LABEL_44:
  m_nHealth = vp->pVehicle->m_nHealth;
  if ( m_nHealth < 250.0 )
  {
    v4.n64_u32[0] = 1061997773;
    v59 = -18.0;
LABEL_53:
    if ( CTimer::m_snTimeInMilliseconds > this->m_nSwapStalledTime )
    {
      if ( this->m_bSilentStalled )
      {
        this->m_bSilentStalled = 0;
        v60 = CAEAudioUtility::ResolveProbability(0.85) == 0;
        v61 = &dword_3B55F4;
        v62 = &dword_3B55FC;
        if ( v60 )
          v61 = &dword_3B55F0;
        v63 = &dword_3B55F8;
      }
      else
      {
        this->m_bSilentStalled = 1;
        v60 = CAEAudioUtility::ResolveProbability(0.95) == 0;
        v61 = &dword_3B55F8;
        v62 = &dword_3B55F4;
        if ( v60 )
          v61 = &dword_3B5600;
        v63 = (int *)&off_3B5604;
      }
      if ( v60 )
        v62 = v63;
      v64 = CTimer::m_snTimeInMilliseconds;
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(*v62, *v61);
      LOWORD(m_nStalledCount) = this->m_nStalledCount;
      this->m_nSwapStalledTime = RandomNumberInRange + v64;
    }
    if ( (__int16)m_nStalledCount < 1 )
      v66 = 0;
    else
      v66 = m_nStalledCount - 1;
    m_bSilentStalled = this->m_bSilentStalled;
    this->m_nStalledCount = v66;
    if ( !m_bSilentStalled )
      v59 = 0.0;
    goto LABEL_69;
  }
  if ( m_nHealth < 390.0 )
  {
    v59 = -12.0;
    v4.n64_u32[0] = 1062836634;
    goto LABEL_53;
  }
  if ( m_nHealth < 460.0 )
  {
    v59 = -9.0;
    v4.n64_u32[0] = 1063675494;
    goto LABEL_53;
  }
  if ( m_nHealth < 650.0 )
  {
    v59 = -6.0;
    v4.n64_u32[0] = 1064514355;
    goto LABEL_53;
  }
  v59 = 0.0;
LABEL_69:
  m_CurrentRotorFrequency = this->m_CurrentRotorFrequency;
  v17.n64_f32[0] = (float)(v46 + (float)((float)((float)(v54 * -0.15) + 1.0) + (float)(v55 * 0.1))) * v4.n64_f32[0];
  if ( m_CurrentRotorFrequency < 0.0 )
  {
    LODWORD(this->m_CurrentRotorFrequency) = v17.n64_u32[0];
    m_CurrentRotorFrequency = (float)(v46 + (float)((float)((float)(v54 * -0.15) + 1.0) + (float)(v55 * 0.1)))
                            * v4.n64_f32[0];
  }
  if ( v17.n64_f32[0] >= m_CurrentRotorFrequency )
  {
    v3.n64_f32[0] = m_CurrentRotorFrequency + 0.0053333;
    Frequency = vmin_f32(v17, v3).n64_u32[0];
  }
  else
  {
    v3.n64_f32[0] = m_CurrentRotorFrequency + -0.0053333;
    Frequency = vmax_f32(v17, v3).n64_u32[0];
  }
  LODWORD(this->m_CurrentRotorFrequency) = Frequency;
  CAEVehicleAudioEntity::PlayAircraftSound(
    this,
    2,
    40,
    0,
    (float)((float)(v72 * 20.0) + 8.0) + v59,
    *(float *)&Frequency);
  CAEVehicleAudioEntity::PlayAircraftSound(
    this,
    4,
    40,
    1,
    (float)((float)(v71 * 20.0) + 8.0) + v59,
    *(float *)&Frequency);
  CAEVehicleAudioEntity::PlayAircraftSound(this, 3, 19, 17, (float)((float)(v56 * 20.0) + 8.0) + v59, 1.0);
  CAEVehicleAudioEntity::PlayAircraftSound(this, 1, 19, 16, v47 + v59, 1.0);
LABEL_75:
  CMatrix::~CMatrix(&v75);
}
// 3B50A8: variable 'v2' is possibly undefined
// 3B50A8: variable 'v5' is possibly undefined
// 3B50F0: variable 'v4' is possibly undefined
// 3B54FE: variable 'v3' is possibly undefined
// 3B55B0: using guessed type int dword_3B55B0;
// 3B55B4: using guessed type int;
// 3B55F0: using guessed type int dword_3B55F0;
// 3B55F4: using guessed type int dword_3B55F4;
// 3B55F8: using guessed type int dword_3B55F8;
// 3B55FC: using guessed type int dword_3B55FC;
// 3B5600: using guessed type int dword_3B5600;
// 3B5604: using guessed type void *off_3B5604;

//----- (003B5620) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyJet(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d3
  float32x2_t v3; // d4
  CVehicle *pVehicle; // r1
  int v6; // s2
  int v7; // s4
  int v8; // r3
  float v9; // s12
  int RecordingNumber; // r2
  float v11; // s6
  float v12; // s6
  char v13; // r4
  unsigned int v14; // r1

  pVehicle = vp->pVehicle;
  v6 = (int)(float)(pVehicle->m_fGasPedal * 255.0);
  v7 = (int)(float)(pVehicle->m_fBrakePedal * 255.0);
  v8 = v7;
  if ( v6 > v7 )
    v8 = (int)(float)(pVehicle->m_fGasPedal * 255.0);
  v3.n64_f32[0] = (float)v8 / 255.0;
  v2.n64_u32[0] = 1.0;
  v9 = vmin_f32(v3, v2).n64_f32[0];
  v3.n64_f32[0] = (float)(v9 * 0.3) + 0.7;
  if ( v9 < 0.0 )
    v3.n64_u32[0] = 1060320051;
  RecordingNumber = pVehicle->AutoPilot.RecordingNumber;
  if ( RecordingNumber <= -1 )
    v3.n64_f32[0] = *(float *)&pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
  v11 = vmin_f32(v3, v2).n64_f32[0];
  if ( v11 >= 0.2 )
    v12 = (float)(v11 + -0.2) / 0.8;
  else
    v12 = 0.0;
  v13 = 0;
  v14 = *(_DWORD *)&pVehicle->m_nVehicleFlags & 0x10;
  if ( RecordingNumber > -1 )
    v13 = 1;
  CAEVehicleAudioEntity::ProcessGenericJet(
    this,
    v13 | (v14 >> 4),
    vp,
    v12,
    (float)v6 / 255.0,
    (float)v7 / 255.0,
    0.0,
    1.0);
}
// 3B566C: variable 'v3' is possibly undefined
// 3B566C: variable 'v2' is possibly undefined

//----- (003B5738) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessAIProp(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d8
  float32x2_t v4; // d9
  int m_DummyEngineBank; // r1
  int m_DummySlot; // r0
  CVehicle *pVehicle; // r0
  int RecordingNumber; // r1
  int i; // r6
  char *v12; // r4
  __int16 m_nLength; // r5
  CAESound *v14; // r0
  CAESound **v15; // r4
  CAESound *v16; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v18; // r0
  int v19; // r0
  unsigned int v20; // r1
  int v21; // r3
  float32x2_t v22; // d2
  float PiecewiseLinear; // r6
  CMatrix *m_pMat; // r0
  float zx; // s4
  float v26; // s22
  float v27; // r0
  float32x2_t v28; // d0
  unsigned __int32 Frequency; // s20
  float v30; // s22
  CEntity *m_pGameEntity; // r1
  CMatrix *v32; // r2
  CSimpleTransform *p_tx; // r5
  CSimpleTransform *p_m_transform; // r1
  float32x2_t v35; // d16
  unsigned __int64 v36; // d1
  float v37; // s0
  float v38; // s16
  float v39; // s0
  float v40; // s24
  CMatrix v41; // [sp+8h] [bp-90h] BYREF

  v41.m_pRwMat = 0;
  v41.m_owner = 0;
  m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
  if ( m_DummyEngineBank == 0xFFFF )
    goto LABEL_46;
  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot == 0xFFFF )
  {
    LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
    this->m_DummySlot = m_DummySlot;
    if ( (unsigned __int16)m_DummySlot == 0xFFFF )
      goto LABEL_46;
    LOWORD(m_DummyEngineBank) = this->m_DummyEngineBank;
  }
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_DummyEngineBank, m_DummySlot) )
  {
    if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
      goto LABEL_46;
    pVehicle = vp->pVehicle;
    RecordingNumber = pVehicle->AutoPilot.RecordingNumber;
    if ( RecordingNumber <= -1 && (*(_DWORD *)&pVehicle->m_nVehicleFlags & 0x10) == 0 )
    {
      v4.n64_u32[0] = 1.0;
      for ( i = 0; i != 12; ++i )
      {
        while ( 1 )
        {
          v12 = (char *)this + 8 * i;
          m_nLength = -1;
          v16 = (CAESound *)*((_DWORD *)v12 + 58);
          v15 = (CAESound **)(v12 + 232);
          v14 = v16;
          if ( v16 )
          {
            m_nLength = v14->m_nLength;
            CAESound::SetIndividualEnvironment(v14, 4u, 0);
            CAESound::StopSound(*v15);
            *v15 = 0;
          }
          if ( i != 4 )
            break;
          m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
          this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
          this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
          this->m_ACPlayPositionLastFrame = -1;
          this->m_ACPlayPositionThisFrame = -1;
          if ( m_nLength < 1 )
          {
            LOWORD(v18) = 0;
          }
          else
          {
            v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
            v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
            v18 = (int)(float)(v2.n64_f32[0] * 100.0);
            if ( v2.n64_f32[0] < 0.0 )
              LOWORD(v18) = 0;
          }
          this->m_ACPlayPercentWhenStopped = v18;
          i = 5;
        }
      }
      goto LABEL_46;
    }
    v4.n64_u32[0] = 1.0;
    v21 = (int)(float)(pVehicle->m_fBrakePedal * 255.0);
    if ( (int)(float)(pVehicle->m_fGasPedal * 255.0) > v21 )
      v21 = (int)(float)(pVehicle->m_fGasPedal * 255.0);
    v2.n64_f32[0] = (float)v21 / 255.0;
    v22.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
    v2.n64_f32[0] = (float)(v22.n64_f32[0] * 0.3) + 0.7;
    if ( v22.n64_f32[0] < 0.0 )
      v2.n64_u32[0] = 1060320051;
    if ( RecordingNumber <= -1 )
      v2.n64_f32[0] = *(float *)&pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
    v3.n64_u32[0] = 0;
    v28.n64_u64[0] = vmax_f32(vmin_f32(v2, v4), v3).n64_u64[0];
    PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v28.n64_f32[0], 3, fPlaneVol);
    m_pMat = vp->pVehicle->m_pMat;
    zx = m_pMat->zx;
    v28.n64_f32[0] = (float)(m_pMat->xx * 0.0) + (float)(m_pMat->yx * 0.0);
    v26 = m_pMat->zy + (float)((float)(m_pMat->xy * 0.0) + (float)(m_pMat->yy * 0.0));
    v27 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
    v28.n64_f32[0] = (float)((float)(v26 * -0.15) + 1.0) + (float)(fabsf(zx + v28.n64_f32[0]) * 0.1);
    v22.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
    if ( v22.n64_f32[0] < 0.0 )
    {
      LODWORD(this->m_CurrentRotorFrequency) = v28.n64_u32[0];
      v22.n64_u32[0] = v28.n64_u32[0];
    }
    if ( v28.n64_f32[0] >= v22.n64_f32[0] )
    {
      v22.n64_f32[0] = v22.n64_f32[0] + 0.0053333;
      Frequency = vmin_f32(v28, v22).n64_u32[0];
    }
    else
    {
      v22.n64_f32[0] = v22.n64_f32[0] + -0.0053333;
      Frequency = vmax_f32(v28, v22).n64_u32[0];
    }
    v30 = (float)(v27 * 20.0) + 8.0;
    m_pGameEntity = this->m_pGameEntity;
    LODWORD(this->m_CurrentRotorFrequency) = Frequency;
    v32 = m_pGameEntity->m_pMat;
    p_tx = (CSimpleTransform *)&v32->tx;
    if ( !v32 )
      p_tx = &m_pGameEntity->m_transform;
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    v35.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_tx->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
    v36 = vmul_f32(v35, v35).n64_u64[0];
    v37 = sqrtf(
            (float)((float)((float)(p_tx->m_translate.x - p_m_transform->m_translate.x)
                          * (float)(p_tx->m_translate.x - p_m_transform->m_translate.x))
                  + *(float *)&v36)
          + *((float *)&v36 + 1));
    if ( v37 >= 128.0 )
    {
      v39 = CAEAudioUtility::AudioLog10(PiecewiseLinear) * 20.0;
    }
    else
    {
      if ( v37 < 48.0 )
      {
        v38 = -100.0;
LABEL_45:
        CAEVehicleAudioEntity::PlayAircraftSound(this, 2, this->m_DummySlot, 1, v30, *(float *)&Frequency);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 1, this->m_DummySlot, 0, v38, 1.0);
        goto LABEL_46;
      }
      v40 = CAEAudioUtility::AudioLog10((float)(v37 + -48.0) / 80.0);
      v39 = (float)(v40 * 20.0) + (float)(CAEAudioUtility::AudioLog10(PiecewiseLinear) * 20.0);
    }
    v38 = v39 + 8.0;
    goto LABEL_45;
  }
  v19 = (unsigned __int16)this->m_DummyEngineBank;
  v20 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
  if ( v20 > 0x90000
    || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v20 >> 14)) != v19 )
  {
    this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(v19);
    this->m_State = 0;
  }
LABEL_46:
  CMatrix::~CMatrix(&v41);
}
// 3B5832: variable 'v2' is possibly undefined
// 3B5832: variable 'v4' is possibly undefined
// 3B591E: variable 'v3' is possibly undefined

//----- (003B5B28) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyProp(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d8
  float32x2_t v6; // d9
  CVehicle *pVehicle; // r0
  int RecordingNumber; // r1
  int i; // r6
  int v12; // r0
  char *v13; // r4
  __int16 m_nLength; // r5
  CAESound *v15; // r0
  CAESound **v16; // r4
  CAESound *v17; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v19; // r2
  int v20; // r3
  float32x2_t v21; // d0
  float PiecewiseLinear; // r4
  CEntity *m_pGameEntity; // r0
  CSimpleTransform *p_m_transform; // r6
  CSimpleTransform *p_tx; // r3
  CMatrix *m_pMat; // r2
  float *p_x; // r1
  RwReal v28; // s2
  RwReal v29; // s4
  CMatrix *v30; // r0
  int ThisBrake; // r9
  float xy; // s20
  float yy; // s22
  float zy; // s28
  float xx; // s24
  float yx; // s26
  float zx; // s30
  int ThisAccel; // r10
  float v39; // s23
  float v40; // r3
  CEntity *v41; // r0
  float v42; // s6
  CMatrix *v43; // r1
  float v44; // s23
  CSimpleTransform *v45; // r2
  int *v46; // r0
  float32x2_t v47; // d16
  float v48; // s24
  unsigned __int64 v49; // d1
  float v50; // s0
  float v51; // s20
  float v52; // r0
  float v53; // r4
  float v54; // r0
  float v55; // s0
  float v56; // r6
  float v57; // s20
  float v58; // r0
  float v59; // s27
  float v60; // s21
  float v61; // s30
  float m_nHealth; // s0
  float v63; // s28
  bool v64; // zf
  Int32 *v65; // r1
  Int32 *v66; // r0
  int *v67; // r2
  uint32 v68; // r4
  int m_nStalledCount; // r0
  Int16 v70; // r0
  int m_bSilentStalled; // r1
  float m_CurrentRotorFrequency; // s8
  unsigned __int32 Frequency; // s22
  float v74; // [sp+Ch] [bp-BCh]
  float v75; // [sp+10h] [bp-B8h]
  CVector v76; // [sp+14h] [bp-B4h] BYREF
  CMatrix v77; // [sp+20h] [bp-A8h] BYREF

  v77.m_pRwMat = 0;
  v77.m_owner = 0;
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19)
    || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40) )
  {
    goto LABEL_72;
  }
  pVehicle = vp->pVehicle;
  RecordingNumber = pVehicle->AutoPilot.RecordingNumber;
  if ( RecordingNumber <= -1 && (*(_DWORD *)&pVehicle->m_nVehicleFlags & 0x10) == 0 )
  {
    v6.n64_u32[0] = 1.0;
    for ( i = 0; i != 12; ++i )
    {
      while ( 1 )
      {
        v13 = (char *)this + 8 * i;
        m_nLength = -1;
        v17 = (CAESound *)*((_DWORD *)v13 + 58);
        v16 = (CAESound **)(v13 + 232);
        v15 = v17;
        if ( v17 )
        {
          m_nLength = v15->m_nLength;
          CAESound::SetIndividualEnvironment(v15, 4u, 0);
          CAESound::StopSound(*v16);
          *v16 = 0;
        }
        if ( i != 4 )
          break;
        m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
        this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
        this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
        this->m_ACPlayPositionLastFrame = -1;
        this->m_ACPlayPositionThisFrame = -1;
        if ( m_nLength < 1 )
        {
          LOWORD(v12) = 0;
        }
        else
        {
          v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
          v2.n64_u64[0] = vmin_f32(v2, v6).n64_u64[0];
          v12 = (int)(float)(v2.n64_f32[0] * 100.0);
          if ( v2.n64_f32[0] < 0.0 )
            LOWORD(v12) = 0;
        }
        this->m_ACPlayPercentWhenStopped = v12;
        i = 5;
      }
    }
    goto LABEL_72;
  }
  v5.n64_u32[0] = 1.0;
  v19 = (int)(float)(pVehicle->m_fGasPedal * 255.0);
  vp->ThisAccel = v19;
  v20 = (int)(float)(pVehicle->m_fBrakePedal * 255.0);
  if ( v19 <= v20 )
    v19 = (int)(float)(pVehicle->m_fBrakePedal * 255.0);
  vp->ThisBrake = v20;
  if ( RecordingNumber <= -1 )
  {
    v2.n64_f32[0] = *(float *)&pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
  }
  else
  {
    v2.n64_f32[0] = (float)v19 / 255.0;
    v3.n64_u32[0] = 0;
    v2.n64_f32[0] = (float)(vmax_f32(vmin_f32(v2, v5), v3).n64_f32[0] * 0.3) + 0.7;
  }
  v6.n64_u32[0] = 0;
  v21.n64_u64[0] = vmax_f32(vmin_f32(v2, v5), v6).n64_u64[0];
  PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v21.n64_f32[0], 3, fPlaneVol);
  CMatrix::operator=(&v77, &TheCamera.m_cameraMatrix);
  m_pGameEntity = this->m_pGameEntity;
  p_m_transform = &TheCamera.m_transform;
  p_tx = &TheCamera.m_transform;
  m_pMat = m_pGameEntity->m_pMat;
  if ( TheCamera.m_pMat )
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  p_x = &m_pMat->tx;
  if ( !m_pMat )
    p_x = &m_pGameEntity->m_transform.m_translate.x;
  v28 = p_x[1] - p_tx->m_translate.y;
  v29 = p_x[2] - p_tx->m_translate.z;
  v76.x = *p_x - p_tx->m_translate.x;
  v76.y = v28;
  v76.z = v29;
  CVector::Normalise(&v76);
  v30 = vp->pVehicle->m_pMat;
  ThisBrake = vp->ThisBrake;
  xy = v30->xy;
  yy = v30->yy;
  zy = v30->zy;
  xx = v30->xx;
  yx = v30->yx;
  zx = v30->zx;
  ThisAccel = vp->ThisAccel;
  v39 = (float)((float)((float)((float)(xy * v76.x) + (float)(yy * v76.y)) + (float)(zy * v76.z)) + 1.0) * 0.5;
  v75 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)(v39 * -0.67) + 1.0));
  v74 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)(v39 * 0.5) + 0.5));
  v40 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
  v41 = this->m_pGameEntity;
  v42 = xx * 0.0;
  if ( TheCamera.m_pMat )
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  v43 = v41->m_pMat;
  v44 = xy * 0.0;
  v45 = (CSimpleTransform *)&v43->tx;
  if ( !v43 )
    v45 = &v41->m_transform;
  v46 = &dword_3B6110;
  if ( ThisAccel > 0 )
    v46 = &dword_3B6114;
  v47.n64_u64[0] = vsub_f32(*(float32x2_t *)&v45->m_translate.y, *(float32x2_t *)&p_m_transform->m_translate.y).n64_u64[0];
  v48 = *(float *)v46;
  v49 = vmul_f32(v47, v47).n64_u64[0];
  v50 = sqrtf(
          (float)((float)((float)(v45->m_translate.x - p_m_transform->m_translate.x)
                        * (float)(v45->m_translate.x - p_m_transform->m_translate.x))
                + *(float *)&v49)
        + *((float *)&v49 + 1));
  if ( ThisBrake > 0 )
    v48 = *(float *)v46 + -0.05;
  if ( v50 >= 128.0 )
  {
    v52 = PiecewiseLinear;
    v53 = v40;
    v54 = CAEAudioUtility::AudioLog10(v52);
    v40 = v53;
    v55 = v54 * 20.0;
  }
  else
  {
    if ( v50 < 48.0 )
    {
      v51 = -100.0;
      goto LABEL_40;
    }
    v56 = v40;
    v57 = CAEAudioUtility::AudioLog10((float)(v50 + -48.0) / 80.0);
    v58 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
    v40 = v56;
    v55 = (float)(v57 * 20.0) + (float)(v58 * 20.0);
  }
  v51 = v55 + 8.0;
LABEL_40:
  if ( this->m_nStallCounter )
    this->m_nStalledCount = 15;
  v59 = v40;
  v60 = (float)(v44 + (float)(yy * 0.0)) + zy;
  v61 = fabsf(zx + (float)(v42 + (float)(yx * 0.0)));
  m_nHealth = vp->pVehicle->m_nHealth;
  if ( m_nHealth < 250.0 )
  {
    v5.n64_u32[0] = 1061997773;
    v63 = -18.0;
LABEL_50:
    if ( CTimer::m_snTimeInMilliseconds > this->m_nSwapStalledTime )
    {
      if ( this->m_bSilentStalled )
      {
        this->m_bSilentStalled = 0;
        v64 = CAEAudioUtility::ResolveProbability(0.85) == 0;
        v65 = &dword_3B6154;
        v66 = &dword_3B615C;
        if ( v64 )
          v65 = &dword_3B6150;
        v67 = &dword_3B6158;
      }
      else
      {
        this->m_bSilentStalled = 1;
        v64 = CAEAudioUtility::ResolveProbability(0.95) == 0;
        v65 = &dword_3B6158;
        v66 = &dword_3B6154;
        if ( v64 )
          v65 = &dword_3B6160;
        v67 = (int *)&off_3B6164;
      }
      if ( v64 )
        v66 = v67;
      v68 = CTimer::m_snTimeInMilliseconds;
      this->m_nSwapStalledTime = CAEAudioUtility::GetRandomNumberInRange(*v66, *v65) + v68;
    }
    m_nStalledCount = this->m_nStalledCount;
    if ( m_nStalledCount < 1 )
      v70 = 0;
    else
      v70 = m_nStalledCount - 1;
    m_bSilentStalled = this->m_bSilentStalled;
    this->m_nStalledCount = v70;
    if ( !m_bSilentStalled )
      v63 = 0.0;
    goto LABEL_66;
  }
  if ( m_nHealth < 390.0 )
  {
    v63 = -12.0;
    v5.n64_u32[0] = 1062836634;
    goto LABEL_50;
  }
  if ( m_nHealth < 460.0 )
  {
    v63 = -9.0;
    v5.n64_u32[0] = 1063675494;
    goto LABEL_50;
  }
  if ( m_nHealth < 650.0 )
  {
    v63 = -6.0;
    v5.n64_u32[0] = 1064514355;
    goto LABEL_50;
  }
  v63 = 0.0;
LABEL_66:
  m_CurrentRotorFrequency = this->m_CurrentRotorFrequency;
  v21.n64_f32[0] = (float)(v48 + (float)((float)((float)(v60 * -0.15) + 1.0) + (float)(v61 * 0.1))) * v5.n64_f32[0];
  if ( m_CurrentRotorFrequency < 0.0 )
  {
    LODWORD(this->m_CurrentRotorFrequency) = v21.n64_u32[0];
    m_CurrentRotorFrequency = (float)(v48 + (float)((float)((float)(v60 * -0.15) + 1.0) + (float)(v61 * 0.1)))
                            * v5.n64_f32[0];
  }
  if ( v21.n64_f32[0] >= m_CurrentRotorFrequency )
  {
    v4.n64_f32[0] = m_CurrentRotorFrequency + 0.0053333;
    Frequency = vmin_f32(v21, v4).n64_u32[0];
  }
  else
  {
    v4.n64_f32[0] = m_CurrentRotorFrequency + -0.0053333;
    Frequency = vmax_f32(v21, v4).n64_u32[0];
  }
  LODWORD(this->m_CurrentRotorFrequency) = Frequency;
  CAEVehicleAudioEntity::PlayAircraftSound(
    this,
    2,
    40,
    0,
    (float)((float)(v75 * 20.0) + 8.0) + v63,
    *(float *)&Frequency);
  CAEVehicleAudioEntity::PlayAircraftSound(
    this,
    4,
    40,
    1,
    (float)((float)(v74 * 20.0) + 8.0) + v63,
    *(float *)&Frequency);
  CAEVehicleAudioEntity::PlayAircraftSound(this, 3, 19, 17, (float)((float)(v59 * 20.0) + 8.0) + v63, 1.0);
  CAEVehicleAudioEntity::PlayAircraftSound(this, 1, 19, 16, v51 + v63, 1.0);
LABEL_72:
  CMatrix::~CMatrix(&v77);
}
// 3B5C0C: variable 'v2' is possibly undefined
// 3B5C0C: variable 'v6' is possibly undefined
// 3B5C7E: variable 'v5' is possibly undefined
// 3B5C8A: variable 'v3' is possibly undefined
// 3B6062: variable 'v4' is possibly undefined
// 3B6110: using guessed type int dword_3B6110;
// 3B6114: using guessed type int;
// 3B6150: using guessed type int dword_3B6150;
// 3B6154: using guessed type int dword_3B6154;
// 3B6158: using guessed type int dword_3B6158;
// 3B615C: using guessed type int dword_3B615C;
// 3B6160: using guessed type int dword_3B6160;
// 3B6164: using guessed type void *off_3B6164;

//----- (003B6180) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerHeli(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d4
  float32x2_t v4; // d9
  float32x2_t v5; // d11
  float32x2_t v6; // d12
  float v9; // s16
  float PiecewiseLinear; // r8
  float v11; // s22
  CPad *PadFromPlayer; // r4
  Int16 Brake; // r0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  RwReal v18; // s2
  RwReal v19; // s4
  CMatrix *v20; // r1
  float v21; // s0
  float v22; // s2
  float zz; // s4
  int *v24; // r1
  float v25; // s2
  float v26; // s4
  float v27; // r9
  float v28; // r5
  float v29; // r4
  double v30; // d16
  double v31; // d16
  unsigned __int32 Frequency; // s16
  double v33; // d16
  CEntity *v34; // r1
  CMatrix *v35; // r2
  float *v36; // r6
  CSimpleTransform *p_m_transform; // r1
  float v38; // s0
  float v39; // s18
  float v40; // s0
  float v41; // s28
  CVector v42; // [sp+Ch] [bp-ACh] BYREF
  CMatrix v43; // [sp+18h] [bp-A0h] BYREF

  v43.m_pRwMat = 0;
  v43.m_owner = 0;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40)
    && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    v4.n64_u32[0] = 1.0;
    v6.n64_u32[0] = 0;
    v2.n64_f32[0] = *(float *)&vp->pVehicle[1].m_VehicleAudioEntity.m_ReverseSoundPtr / 0.22;
    LODWORD(v9) = vmax_f32(vmin_f32(v2, v4), v6).n64_u32[0];
    PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v9, 5, fHeliVol);
    v11 = CAEAudioUtility::GetPiecewiseLinear(v9, 5, fHeliFreq);
    if ( !CAEVehicleAudioEntity::s_pPlayerDriver
      || this->m_bPlayerDriverAboutToExit
      || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
      || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
    {
      Brake = 0;
      vp->ThisAccel = 0;
    }
    else
    {
      PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
      vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
      Brake = CPad::GetBrake(PadFromPlayer);
    }
    vp->ThisBrake = Brake;
    CMatrix::operator=(&v43, &TheCamera.m_cameraMatrix);
    m_pGameEntity = this->m_pGameEntity;
    m_pMat = m_pGameEntity->m_pMat;
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    p_x = &m_pMat->tx;
    if ( !m_pMat )
      p_x = &m_pGameEntity->m_transform.m_translate.x;
    v18 = p_x[1] - p_tx->m_translate.y;
    v19 = p_x[2] - p_tx->m_translate.z;
    v42.x = *p_x - p_tx->m_translate.x;
    v42.y = v18;
    v42.z = v19;
    CVector::Normalise(&v42);
    v20 = vp->pVehicle->m_pMat;
    v21 = (float)((float)((float)(v20->xy * v42.x) + (float)(v20->yy * v42.y)) + (float)(v20->zy * v42.z)) + 1.0;
    v22 = (float)(v20->xz * 0.0) + (float)(v20->yz * 0.0);
    zz = v20->zz;
    v24 = &dword_3B660C;
    if ( vp->ThisAccel > 0 )
      v24 = &dword_3B6610;
    v25 = zz + v22;
    v26 = *(float *)v24;
    if ( vp->ThisBrake > 0 )
      v26 = v26 + -0.05;
    v27 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)((float)(v21 * 0.5) * -0.67) + 1.0));
    v28 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)((float)(v21 * 0.5) * 0.5) + 0.5));
    v29 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
    v5.n64_f32[0] = (float)(v26 + 1.0) * (float)(v11 * (float)((float)((float)((float)(1.0 - v25) * 0.5) * 0.2) + 1.0));
    if ( vp->pVehicle->m_nHealth < 390.0 )
      v5.n64_f32[0] = v5.n64_f32[0] * (float)(CAEAudioUtility::GetRandomNumberInRange(-0.1, 0.1) + 0.75);
    v3.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
    v30 = v9;
    if ( v3.n64_f32[0] < 0.0 )
    {
      LODWORD(this->m_CurrentRotorFrequency) = v5.n64_u32[0];
      v3.n64_u32[0] = v5.n64_u32[0];
    }
    if ( v5.n64_f32[0] >= v3.n64_f32[0] )
    {
      if ( v30 >= 0.63 )
      {
        v3.n64_f32[0] = v3.n64_f32[0] + 0.0053333;
        Frequency = vmin_f32(v5, v3).n64_u32[0];
      }
      else
      {
        v33 = v3.n64_f32[0] + 0.03;
        if ( v33 > v5.n64_f32[0] )
          v33 = v5.n64_f32[0];
        *(float *)&Frequency = v33;
      }
    }
    else if ( v30 >= 0.63 )
    {
      v3.n64_f32[0] = v3.n64_f32[0] + -0.0053333;
      Frequency = vmax_f32(v5, v3).n64_u32[0];
    }
    else
    {
      v31 = v3.n64_f32[0] + -0.03;
      if ( v31 < v5.n64_f32[0] )
        v31 = v5.n64_f32[0];
      *(float *)&Frequency = v31;
    }
    v34 = this->m_pGameEntity;
    this->m_CurrentRotorFrequency = *(float *)&Frequency;
    v35 = v34->m_pMat;
    v36 = &v35->tx;
    if ( !v35 )
      v36 = &v34->m_transform.m_translate.x;
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    v38 = sqrtf(
            (float)((float)((float)(*v36 - p_m_transform->m_translate.x) * (float)(*v36 - p_m_transform->m_translate.x))
                  + (float)((float)(v36[1] - p_m_transform->m_translate.y)
                          * (float)(v36[1] - p_m_transform->m_translate.y)))
          + (float)((float)(v36[2] - p_m_transform->m_translate.z) * (float)(v36[2] - p_m_transform->m_translate.z)));
    if ( v38 >= 128.0 )
    {
      v40 = CAEAudioUtility::AudioLog10(PiecewiseLinear) * 20.0;
    }
    else
    {
      if ( v38 < 48.0 )
      {
        v39 = -100.0;
LABEL_42:
        CAEVehicleAudioEntity::PlayAircraftSound(this, 2, 40, 0, (float)(v27 * 20.0) + 8.0, *(float *)&Frequency);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 4, 40, 1, (float)(v28 * 20.0) + 8.0, *(float *)&Frequency);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 3, 40, 3, (float)(v29 * 20.0) + 2.0, 1.0);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 1, 19, 3, v39, 1.0);
        goto LABEL_43;
      }
      v41 = CAEAudioUtility::AudioLog10((float)(v38 + -48.0) / 80.0);
      v40 = (float)(v41 * 20.0) + (float)(CAEAudioUtility::AudioLog10(PiecewiseLinear) * 20.0);
    }
    v39 = v40 + 8.0;
    goto LABEL_42;
  }
LABEL_43:
  CMatrix::~CMatrix(&v43);
}
// 3B61E8: variable 'v2' is possibly undefined
// 3B61E8: variable 'v4' is possibly undefined
// 3B61EC: variable 'v6' is possibly undefined
// 3B6478: variable 'v5' is possibly undefined
// 3B6478: variable 'v3' is possibly undefined
// 3B660C: using guessed type int dword_3B660C;
// 3B6610: using guessed type int;

//----- (003B663C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessAIHeli(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d8
  float32x2_t v4; // d9
  float32x2_t v7; // d0
  float PiecewiseLinear; // r6
  float v9; // r5
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  RwReal v14; // s2
  RwReal v15; // s4
  CMatrix *v16; // r1
  float xz; // s20
  float zz; // s28
  float yz; // s30
  float v20; // s24
  float v21; // r8
  float v22; // r9
  float v23; // r4
  unsigned __int32 Frequency; // s24
  CEntity *v25; // r1
  CMatrix *v26; // r2
  CSimpleTransform *p_m_transform; // r6
  CSimpleTransform *v28; // r1
  float32x2_t v29; // d16
  unsigned __int64 v30; // d1
  float v31; // s0
  float v32; // s26
  float v33; // s0
  float v34; // s26
  float v35; // r0
  int v36; // r5
  char *v37; // r11
  __int16 m_nLength; // r4
  CAESound *v39; // r0
  CAESound **v40; // r11
  CAESound *v41; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v43; // r0
  float v44; // [sp+0h] [bp-C0h]
  float fRatio; // [sp+8h] [bp-B8h]
  CVector v46; // [sp+Ch] [bp-B4h] BYREF
  CMatrix v47; // [sp+18h] [bp-A8h] BYREF

  v47.m_pRwMat = 0;
  v47.m_owner = 0;
  if ( this->m_PlayerEngineBank == 12 && !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0xDu, 18)
    || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    goto LABEL_44;
  }
  v3.n64_u32[0] = 1.0;
  v4.n64_u32[0] = 0;
  v2.n64_f32[0] = *(float *)&vp->pVehicle[1].m_VehicleAudioEntity.m_ReverseSoundPtr / 0.22;
  v7.n64_u64[0] = vmax_f32(vmin_f32(v2, v3), v4).n64_u64[0];
  PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v7.n64_f32[0], 5, fHeliVol);
  v9 = CAEAudioUtility::GetPiecewiseLinear(v7.n64_f32[0], 5, fHeliFreq);
  CMatrix::operator=(&v47, &TheCamera.m_cameraMatrix);
  m_pGameEntity = this->m_pGameEntity;
  m_pMat = m_pGameEntity->m_pMat;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  p_x = &m_pMat->tx;
  if ( !m_pMat )
    p_x = &m_pGameEntity->m_transform.m_translate.x;
  v14 = p_x[1] - p_tx->m_translate.y;
  v15 = p_x[2] - p_tx->m_translate.z;
  v46.x = *p_x - p_tx->m_translate.x;
  v46.y = v14;
  v46.z = v15;
  CVector::Normalise(&v46);
  v16 = vp->pVehicle->m_pMat;
  xz = v16->xz;
  zz = v16->zz;
  yz = v16->yz;
  v20 = (float)((float)((float)((float)(v16->xy * v46.x) + (float)(v16->yy * v46.y)) + (float)(v16->zy * v46.z)) + 1.0)
      * 0.5;
  v21 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)(1.0 - v20));
  v22 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)(v20 * 0.5) + 0.5));
  fRatio = PiecewiseLinear;
  v23 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
  v4.n64_f32[0] = v9
                * (float)((float)((float)((float)(1.0 - (float)(zz + (float)((float)(xz * 0.0) + (float)(yz * 0.0))))
                                        * 0.5)
                                * 0.2)
                        + 1.0);
  if ( vp->pVehicle->m_nHealth < 390.0 )
    v4.n64_f32[0] = v4.n64_f32[0] * (float)(CAEAudioUtility::GetRandomNumberInRange(-0.1, 0.1) + 0.75);
  v7.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
  if ( v7.n64_f32[0] < 0.0 )
  {
    LODWORD(this->m_CurrentRotorFrequency) = v4.n64_u32[0];
    v7.n64_u32[0] = v4.n64_u32[0];
  }
  if ( v4.n64_f32[0] >= v7.n64_f32[0] )
  {
    v7.n64_f32[0] = v7.n64_f32[0] + 0.0053333;
    Frequency = vmin_f32(v4, v7).n64_u32[0];
  }
  else
  {
    v7.n64_f32[0] = v7.n64_f32[0] + -0.0053333;
    Frequency = vmax_f32(v4, v7).n64_u32[0];
  }
  v25 = this->m_pGameEntity;
  LODWORD(this->m_CurrentRotorFrequency) = Frequency;
  v26 = v25->m_pMat;
  p_m_transform = (CSimpleTransform *)&v26->tx;
  if ( !v26 )
    p_m_transform = &v25->m_transform;
  v28 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    v28 = &TheCamera.m_transform;
  v29.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&v28->m_translate.y).n64_u64[0];
  v30 = vmul_f32(v29, v29).n64_u64[0];
  v31 = sqrtf(
          (float)((float)((float)(p_m_transform->m_translate.x - v28->m_translate.x)
                        * (float)(p_m_transform->m_translate.x - v28->m_translate.x))
                + *(float *)&v30)
        + *((float *)&v30 + 1));
  if ( v31 >= 128.0 )
  {
    v33 = CAEAudioUtility::AudioLog10(fRatio) * 20.0;
  }
  else
  {
    if ( v31 < 48.0 )
    {
      v32 = -100.0;
      goto LABEL_25;
    }
    v34 = CAEAudioUtility::AudioLog10((float)(v31 + -48.0) / 80.0);
    v33 = (float)(v34 * 20.0) + (float)(CAEAudioUtility::AudioLog10(fRatio) * 20.0);
  }
  v32 = v33 + 8.0;
LABEL_25:
  if ( CWeather::UnderWaterness >= 0.5 )
  {
    v36 = 0;
    while ( 1 )
    {
      if ( v36 == 1 )
        goto LABEL_29;
      v37 = (char *)this + 8 * v36;
      m_nLength = -1;
      v41 = (CAESound *)*((_DWORD *)v37 + 58);
      v40 = (CAESound **)(v37 + 232);
      v39 = v41;
      if ( v41 )
      {
        m_nLength = v39->m_nLength;
        CAESound::SetIndividualEnvironment(v39, 4u, 0);
        CAESound::StopSound(*v40);
        *v40 = 0;
      }
      if ( v36 == 4 )
      {
        m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
        this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
        this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
        this->m_ACPlayPositionLastFrame = -1;
        this->m_ACPlayPositionThisFrame = -1;
        if ( m_nLength < 1 )
        {
          LOWORD(v43) = 0;
        }
        else
        {
          v7.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
          v7.n64_u64[0] = vmin_f32(v7, v3).n64_u64[0];
          v43 = (int)(float)(v7.n64_f32[0] * 100.0);
          if ( v7.n64_f32[0] < 0.0 )
            LOWORD(v43) = 0;
        }
        this->m_ACPlayPercentWhenStopped = v43;
LABEL_29:
        ++v36;
      }
      else if ( ++v36 == 12 )
      {
        v44 = (float)(CAEAudioUtility::AudioLog10(fRatio) * 20.0) + 8.0;
        goto LABEL_43;
      }
    }
  }
  if ( this->m_PlayerEngineBank == 12 )
  {
    v35 = CAEAudioUtility::AudioLog10(fRatio);
    CAEVehicleAudioEntity::PlayAircraftSound(
      this,
      2,
      18,
      1,
      (float)((float)(v35 * 20.0) + 8.0) + 6.0,
      *(float *)&Frequency);
    CAEVehicleAudioEntity::PlayAircraftSound(this, 1, 18, 0, v32 + 6.0, 1.0);
  }
  else
  {
    CAEVehicleAudioEntity::PlayAircraftSound(this, 2, 19, 5, (float)(v21 * 20.0) + 8.0, *(float *)&Frequency);
    CAEVehicleAudioEntity::PlayAircraftSound(this, 4, 19, 18, (float)(v22 * 20.0) + 8.0, *(float *)&Frequency);
    CAEVehicleAudioEntity::PlayAircraftSound(this, 3, 19, 23, (float)(v23 * 20.0) + 2.0, 1.0);
    v44 = v32;
LABEL_43:
    CAEVehicleAudioEntity::PlayAircraftSound(this, 1, 19, 3, v44, 1.0);
  }
LABEL_44:
  CMatrix::~CMatrix(&v47);
}
// 3B66AE: variable 'v2' is possibly undefined
// 3B66AE: variable 'v3' is possibly undefined
// 3B66B2: variable 'v4' is possibly undefined

//----- (003B6B28) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyHeli(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d4
  float32x2_t v4; // d9
  float32x2_t v5; // d10
  float v8; // s16
  float PiecewiseLinear; // r8
  float v10; // r9
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  RwReal v15; // s2
  RwReal v16; // s4
  CMatrix *v17; // r1
  float xz; // s22
  float zz; // s30
  float v20; // s26
  float v21; // r10
  float v22; // r5
  float v23; // r6
  float32x2_t v24; // d11
  double v25; // d16
  double v26; // d16
  unsigned __int32 Frequency; // s16
  double v28; // d16
  CEntity *v29; // r1
  float v30; // s22
  CMatrix *v31; // r2
  float *v32; // r6
  CSimpleTransform *p_m_transform; // r1
  float v34; // s0
  float v35; // s18
  float v36; // s0
  float v37; // s28
  CVector v38; // [sp+Ch] [bp-B4h] BYREF
  CMatrix v39; // [sp+18h] [bp-A8h] BYREF

  v39.m_pRwMat = 0;
  v39.m_owner = 0;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40)
    && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    v4.n64_u32[0] = 1.0;
    v5.n64_u32[0] = 0;
    v2.n64_f32[0] = *(float *)&vp->pVehicle[1].m_VehicleAudioEntity.m_ReverseSoundPtr / 0.22;
    LODWORD(v8) = vmax_f32(vmin_f32(v2, v4), v5).n64_u32[0];
    PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v8, 5, fHeliVol);
    v10 = CAEAudioUtility::GetPiecewiseLinear(v8, 5, fHeliFreq);
    CMatrix::operator=(&v39, &TheCamera.m_cameraMatrix);
    m_pGameEntity = this->m_pGameEntity;
    m_pMat = m_pGameEntity->m_pMat;
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    p_x = &m_pMat->tx;
    if ( !m_pMat )
      p_x = &m_pGameEntity->m_transform.m_translate.x;
    v15 = p_x[1] - p_tx->m_translate.y;
    v16 = p_x[2] - p_tx->m_translate.z;
    v38.x = *p_x - p_tx->m_translate.x;
    v38.y = v15;
    v38.z = v16;
    CVector::Normalise(&v38);
    v17 = vp->pVehicle->m_pMat;
    xz = v17->xz;
    zz = v17->zz;
    v24.n64_u32[1] = LODWORD(v17->yz);
    v20 = (float)((float)((float)((float)(v17->xy * v38.x) + (float)(v17->yy * v38.y)) + (float)(v17->zy * v38.z)) + 1.0)
        * 0.5;
    v21 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)(v20 * -0.67) + 1.0));
    v22 = CAEAudioUtility::AudioLog10(PiecewiseLinear * (float)((float)(v20 * 0.5) + 0.5));
    v23 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
    v24.n64_f32[0] = v10
                   * (float)((float)((float)((float)(1.0
                                                   - (float)(zz
                                                           + (float)((float)(xz * 0.0) + (float)(v24.n64_f32[1] * 0.0))))
                                           * 0.5)
                                   * 0.2)
                           + 1.0);
    if ( vp->pVehicle->m_nHealth < 390.0 )
      v24.n64_f32[0] = v24.n64_f32[0] * (float)(CAEAudioUtility::GetRandomNumberInRange(-0.1, 0.1) + 0.75);
    v3.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
    v25 = v8;
    if ( v3.n64_f32[0] < 0.0 )
    {
      LODWORD(this->m_CurrentRotorFrequency) = v24.n64_u32[0];
      v3.n64_u32[0] = v24.n64_u32[0];
    }
    if ( v24.n64_f32[0] >= v3.n64_f32[0] )
    {
      if ( v25 >= 0.63 )
      {
        v3.n64_f32[0] = v3.n64_f32[0] + 0.0053333;
        Frequency = vmin_f32(v24, v3).n64_u32[0];
      }
      else
      {
        v28 = v3.n64_f32[0] + 0.03;
        if ( v28 > v24.n64_f32[0] )
          v28 = v24.n64_f32[0];
        *(float *)&Frequency = v28;
      }
    }
    else if ( v25 >= 0.63 )
    {
      v3.n64_f32[0] = v3.n64_f32[0] + -0.0053333;
      Frequency = vmax_f32(v24, v3).n64_u32[0];
    }
    else
    {
      v26 = v3.n64_f32[0] + -0.03;
      if ( v26 < v24.n64_f32[0] )
        v26 = v24.n64_f32[0];
      *(float *)&Frequency = v26;
    }
    v29 = this->m_pGameEntity;
    this->m_CurrentRotorFrequency = *(float *)&Frequency;
    v30 = (float)(v23 * 20.0) + 2.0;
    v31 = v29->m_pMat;
    v32 = &v31->tx;
    if ( !v31 )
      v32 = &v29->m_transform.m_translate.x;
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    v34 = sqrtf(
            (float)((float)((float)(*v32 - p_m_transform->m_translate.x) * (float)(*v32 - p_m_transform->m_translate.x))
                  + (float)((float)(v32[1] - p_m_transform->m_translate.y)
                          * (float)(v32[1] - p_m_transform->m_translate.y)))
          + (float)((float)(v32[2] - p_m_transform->m_translate.z) * (float)(v32[2] - p_m_transform->m_translate.z)));
    if ( v34 >= 128.0 )
    {
      v36 = CAEAudioUtility::AudioLog10(PiecewiseLinear) * 20.0;
    }
    else
    {
      if ( v34 < 48.0 )
      {
        v35 = -100.0;
LABEL_32:
        CAEVehicleAudioEntity::PlayAircraftSound(this, 2, 40, 0, (float)(v21 * 20.0) + 8.0, *(float *)&Frequency);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 4, 40, 1, (float)(v22 * 20.0) + 8.0, *(float *)&Frequency);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 3, 40, 3, v30, 1.0);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 1, 19, 3, v35, 1.0);
        goto LABEL_33;
      }
      v37 = CAEAudioUtility::AudioLog10((float)(v34 + -48.0) / 80.0);
      v36 = (float)(v37 * 20.0) + (float)(CAEAudioUtility::AudioLog10(PiecewiseLinear) * 20.0);
    }
    v35 = v36 + 8.0;
    goto LABEL_32;
  }
LABEL_33:
  CMatrix::~CMatrix(&v39);
}
// 3B6B90: variable 'v2' is possibly undefined
// 3B6B90: variable 'v4' is possibly undefined
// 3B6B94: variable 'v5' is possibly undefined
// 3B6DB2: variable 'v3' is possibly undefined

//----- (003B6F60) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessPlayerSeaPlane(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d8
  CPad *PadFromPlayer; // r6
  Int16 Brake; // r0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  RwReal v12; // s2
  RwReal v13; // s4
  double v14; // d16
  CMatrix *v15; // r0
  float v16; // s18
  float xy; // s6
  float yy; // s8
  float zy; // s10
  float v20; // s12
  float v21; // s4
  float v22; // s2
  float32x2_t v23; // d4
  float v24; // s10
  double v25; // d10
  float v26; // s12
  float v27; // s10
  double v28; // d17
  int ThisAccel; // r1
  int ThisBrake; // r5
  float v31; // s14
  float v32; // s10
  float v33; // s24
  float v34; // s26
  float v35; // r0
  float v36; // r0
  float v37; // s6
  unsigned __int32 Frequency; // s18
  CEntity *v39; // r1
  CMatrix *v40; // r2
  CSimpleTransform *p_m_transform; // r6
  CSimpleTransform *v42; // r1
  float32x2_t v43; // d16
  unsigned __int64 v44; // d1
  float v45; // s0
  float v46; // s16
  float v47; // r0
  float v48; // s0
  float v49; // r0
  float v50; // r1
  CVector v51; // [sp+Ch] [bp-A4h] BYREF
  CMatrix v52; // [sp+18h] [bp-98h] BYREF

  v52.m_pRwMat = 0;
  v52.m_owner = 0;
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_PlayerEngineBank, 40)
    && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    v3.n64_f32[0] = vp->pVehicle[1].m_transform.m_translate.x / 0.22;
    if ( !CAEVehicleAudioEntity::s_pPlayerDriver
      || this->m_bPlayerDriverAboutToExit
      || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
      || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
    {
      Brake = 0;
      vp->ThisAccel = 0;
    }
    else
    {
      PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
      vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
      Brake = CPad::GetBrake(PadFromPlayer);
    }
    vp->ThisBrake = Brake;
    CMatrix::operator=(&v52, &TheCamera.m_cameraMatrix);
    m_pGameEntity = this->m_pGameEntity;
    m_pMat = m_pGameEntity->m_pMat;
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    p_x = &m_pMat->tx;
    if ( !m_pMat )
      p_x = &m_pGameEntity->m_transform.m_translate.x;
    v12 = p_x[1] - p_tx->m_translate.y;
    v13 = p_x[2] - p_tx->m_translate.z;
    v51.x = *p_x - p_tx->m_translate.x;
    v51.y = v12;
    v51.z = v13;
    CVector::Normalise(&v51);
    v14 = 0.0;
    v15 = vp->pVehicle->m_pMat;
    v16 = 0.0;
    xy = v15->xy;
    yy = v15->yy;
    zy = v15->zy;
    v2.n64_u32[0] = 1.0;
    v20 = (float)((float)((float)(xy * v51.x) + (float)(yy * v51.y)) + (float)(zy * v51.z)) + 1.0;
    v21 = (float)((float)(xy * 0.0) + (float)(yy * 0.0)) + zy;
    v22 = fabsf(v15->zx + (float)((float)(v15->xx * 0.0) + (float)(v15->yx * 0.0)));
    v23.n64_u64[0] = vmin_f32(v3, v2).n64_u64[0];
    v24 = v20 * 0.5;
    if ( v23.n64_f32[0] >= 0.2 )
      v14 = (float)((float)(v23.n64_f32[0] + -0.2) / 0.8);
    v25 = 0.2;
    v26 = v24 * 0.5;
    v27 = 1.0 - v24;
    v28 = 0.2;
    if ( v14 > 0.2 )
      v28 = v14;
    ThisAccel = vp->ThisAccel;
    ThisBrake = vp->ThisBrake;
    v31 = v28;
    v32 = v27 * v31;
    if ( ThisAccel > 0 )
      v16 = 0.1;
    if ( v23.n64_f32[0] > 0.2 )
      v25 = v23.n64_f32[0];
    v33 = CAEAudioUtility::AudioLog10(v32);
    v34 = CAEAudioUtility::AudioLog10((float)(v26 + 0.5) * v31);
    v35 = v28;
    v36 = CAEAudioUtility::AudioLog10(v35);
    if ( ThisBrake > 0 )
      v16 = v16 + -0.05;
    v23.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
    v2.n64_f32[0] = (float)((float)((float)(v21 * -0.15) + 1.0) + (float)(v22 * 0.1)) + v16;
    v37 = v36 * 20.0;
    if ( v23.n64_f32[0] < 0.0 )
    {
      LODWORD(this->m_CurrentRotorFrequency) = v2.n64_u32[0];
      v23.n64_f32[0] = (float)((float)((float)(v21 * -0.15) + 1.0) + (float)(v22 * 0.1)) + v16;
    }
    if ( v2.n64_f32[0] >= v23.n64_f32[0] )
    {
      v23.n64_f32[0] = v23.n64_f32[0] + 0.0053333;
      Frequency = vmin_f32(v2, v23).n64_u32[0];
    }
    else
    {
      v23.n64_f32[0] = v23.n64_f32[0] + -0.0053333;
      Frequency = vmax_f32(v2, v23).n64_u32[0];
    }
    v39 = this->m_pGameEntity;
    LODWORD(this->m_CurrentRotorFrequency) = Frequency;
    v40 = v39->m_pMat;
    p_m_transform = (CSimpleTransform *)&v40->tx;
    if ( !v40 )
      p_m_transform = &v39->m_transform;
    v42 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      v42 = &TheCamera.m_transform;
    v43.n64_u64[0] = vsub_f32(*(float32x2_t *)&p_m_transform->m_translate.y, *(float32x2_t *)&v42->m_translate.y).n64_u64[0];
    v44 = vmul_f32(v43, v43).n64_u64[0];
    v45 = sqrtf(
            (float)((float)((float)(p_m_transform->m_translate.x - v42->m_translate.x)
                          * (float)(p_m_transform->m_translate.x - v42->m_translate.x))
                  + *(float *)&v44)
          + *((float *)&v44 + 1));
    if ( v45 >= 128.0 )
    {
      v47 = v25;
      v48 = CAEAudioUtility::AudioLog10(v47) * 20.0;
    }
    else
    {
      if ( v45 < 48.0 )
      {
        v46 = -100.0;
LABEL_38:
        CAEVehicleAudioEntity::PlayAircraftSound(this, 2, 40, 0, (float)(v33 * 20.0) + 8.0, *(float *)&Frequency);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 4, 40, 1, (float)(v34 * 20.0) + 8.0, *(float *)&Frequency);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 3, 19, 17, v37 + 8.0, 1.0);
        CAEVehicleAudioEntity::PlayAircraftSound(this, 1, 19, 16, v46, 1.0);
        goto LABEL_39;
      }
      v49 = CAEAudioUtility::AudioLog10((float)(v45 + -48.0) / 80.0);
      v50 = v25;
      v48 = (float)(v49 * 20.0) + (float)(CAEAudioUtility::AudioLog10(v50) * 20.0);
    }
    v46 = v48 + 8.0;
    goto LABEL_38;
  }
LABEL_39:
  CMatrix::~CMatrix(&v52);
}
// 3B70CC: variable 'v3' is possibly undefined
// 3B70CC: variable 'v2' is possibly undefined

//----- (003B7380) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummySeaPlane(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d9
  int i; // r5
  char *v8; // r4
  __int16 m_nLength; // r6
  CAESound *v10; // r0
  CAESound **v11; // r4
  CAESound *v12; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v14; // r0
  double v15; // d16
  float v16; // s0
  double v17; // d17
  float v18; // s0
  float v19; // r0
  CMatrix v20; // [sp+8h] [bp-78h] BYREF

  v20.m_pRwMat = 0;
  v20.m_owner = 0;
  if ( (*(_BYTE *)&vp->pVehicle->m_nVehicleFlags & 0x10) != 0 )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
    {
      v15 = 0.0;
      v2.n64_f32[0] = vp->pVehicle[1].m_transform.m_translate.x / 0.22;
      v3.n64_u32[0] = 1.0;
      v16 = vmin_f32(v2, v3).n64_f32[0];
      if ( v16 >= 0.2 )
        v15 = (float)((float)(v16 + -0.2) / 0.8);
      v17 = 0.2;
      if ( v15 > 0.2 )
        v17 = v15;
      v18 = v17;
      v19 = CAEAudioUtility::AudioLog10(v18);
      CAEVehicleAudioEntity::PlayAircraftSound(this, 3, 19, 17, (float)(v19 * 20.0) + 8.0, 1.0);
    }
  }
  else
  {
    v4.n64_u32[0] = 1.0;
    for ( i = 0; i != 12; ++i )
    {
      while ( 1 )
      {
        v8 = (char *)this + 8 * i;
        m_nLength = -1;
        v12 = (CAESound *)*((_DWORD *)v8 + 58);
        v11 = (CAESound **)(v8 + 232);
        v10 = v12;
        if ( v12 )
        {
          m_nLength = v10->m_nLength;
          CAESound::SetIndividualEnvironment(v10, 4u, 0);
          CAESound::StopSound(*v11);
          *v11 = 0;
        }
        if ( i != 4 )
          break;
        m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
        this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
        this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
        this->m_ACPlayPositionLastFrame = -1;
        this->m_ACPlayPositionThisFrame = -1;
        if ( m_nLength < 1 )
        {
          LOWORD(v14) = 0;
        }
        else
        {
          v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
          v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
          v14 = (int)(float)(v2.n64_f32[0] * 100.0);
          if ( v2.n64_f32[0] < 0.0 )
            LOWORD(v14) = 0;
        }
        this->m_ACPlayPercentWhenStopped = v14;
        i = 5;
      }
    }
  }
  CMatrix::~CMatrix(&v20);
}
// 3B7420: variable 'v2' is possibly undefined
// 3B7420: variable 'v4' is possibly undefined
// 3B747A: variable 'v3' is possibly undefined

//----- (003B751C) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessGenericJet(
        CAEVehicleAudioEntity *this,
        int bEngineOn,
        cVehicleParams *vp,
        float fEngineSpeed,
        float fAccelRatio,
        float fBrakeRatio,
        float fStalledVolume,
        float fStalledFrequency)
{
  float32x2_t v8; // d0
  float32x2_t v9; // d1
  float32x2_t v10; // d2
  float32x2_t v11; // d9
  float v16; // s18
  float v17; // s20
  int m_nModelIndex; // r0
  float v19; // s16
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r3
  float *p_x; // r1
  RwReal v24; // s2
  RwReal v25; // s4
  int *v26; // r4
  CMatrix *v27; // r0
  float xy; // s6
  float yy; // s8
  float zy; // s21
  float xx; // s10
  float yx; // s12
  float zx; // s14
  float v34; // s0
  float v35; // s19
  float v36; // s26
  float v37; // s17
  float v38; // s2
  float v39; // r0
  float v40; // s0
  float v41; // s24
  float v42; // s18
  unsigned __int32 v43; // s20
  CAESound *SoundPtr; // r1
  int i; // r6
  char *v46; // r4
  __int16 m_nLength; // r5
  CAESound *v48; // r0
  CAESound **v49; // r4
  CAESound *v50; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v52; // r0
  CVector Position; // [sp+0h] [bp-158h]
  CVector v54; // [sp+30h] [bp-128h] BYREF
  CMatrix v55; // [sp+3Ch] [bp-11Ch] BYREF
  CAESound v56; // [sp+84h] [bp-D4h] BYREF

  v55.m_pRwMat = 0;
  v55.m_owner = 0;
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
    goto LABEL_40;
  v16 = 8.0;
  v17 = 0.0;
  m_nModelIndex = vp->pVehicle->m_nModelIndex;
  if ( (unsigned int)(m_nModelIndex - 519) < 2 )
  {
    v19 = -100.0;
    if ( !bEngineOn )
      goto LABEL_26;
  }
  else if ( m_nModelIndex == 592 )
  {
    v19 = -12.0;
    if ( !bEngineOn )
      goto LABEL_26;
  }
  else if ( m_nModelIndex != 577 || (v16 = 20.0, v17 = 6.0, v19 = -8.0, !bEngineOn) )
  {
LABEL_26:
    v11.n64_u32[0] = 1.0;
    for ( i = 0; i != 12; ++i )
    {
      while ( 1 )
      {
        v46 = (char *)this + 8 * i;
        m_nLength = -1;
        v50 = (CAESound *)*((_DWORD *)v46 + 58);
        v49 = (CAESound **)(v46 + 232);
        v48 = v50;
        if ( v50 )
        {
          m_nLength = v48->m_nLength;
          CAESound::SetIndividualEnvironment(v48, 4u, 0);
          CAESound::StopSound(*v49);
          *v49 = 0;
        }
        if ( i != 4 )
          break;
        m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
        this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
        this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
        this->m_ACPlayPositionLastFrame = -1;
        this->m_ACPlayPositionThisFrame = -1;
        if ( m_nLength < 1 )
        {
          LOWORD(v52) = 0;
        }
        else
        {
          v8.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
          v8.n64_u64[0] = vmin_f32(v8, v11).n64_u64[0];
          v52 = (int)(float)(v8.n64_f32[0] * 100.0);
          if ( v8.n64_f32[0] < 0.0 )
            LOWORD(v52) = 0;
        }
        this->m_ACPlayPercentWhenStopped = v52;
        i = 5;
      }
    }
    goto LABEL_40;
  }
  CMatrix::operator=(&v55, &TheCamera.m_cameraMatrix);
  m_pGameEntity = this->m_pGameEntity;
  m_pMat = m_pGameEntity->m_pMat;
  p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
  if ( !TheCamera.m_pMat )
    p_tx = &TheCamera.m_transform;
  p_x = &m_pMat->tx;
  if ( !m_pMat )
    p_x = &m_pGameEntity->m_transform.m_translate.x;
  v24 = p_x[1] - p_tx->m_translate.y;
  v25 = p_x[2] - p_tx->m_translate.z;
  v54.x = *p_x - p_tx->m_translate.x;
  v54.y = v24;
  v54.z = v25;
  CVector::Normalise(&v54);
  v26 = &dword_3B7900;
  v27 = vp->pVehicle->m_pMat;
  xy = v27->xy;
  yy = v27->yy;
  zy = v27->zy;
  xx = v27->xx;
  yx = v27->yx;
  zx = v27->zx;
  v34 = (float)((float)((float)((float)(xy * v54.x) + (float)(yy * v54.y)) + (float)(zy * v54.z)) + 1.0) * 0.5;
  v35 = CAEAudioUtility::AudioLog10((float)((float)(v34 * -0.67) + 1.0) * fEngineSpeed);
  v36 = CAEAudioUtility::AudioLog10((float)((float)(v34 * 0.5) + 0.5) * fEngineSpeed) * 20.0;
  if ( fAccelRatio > 0.0 )
    v26 = &dword_3B7904;
  v37 = *(float *)v26;
  if ( fBrakeRatio > 0.0 )
    v37 = *(float *)v26 + -0.05;
  v38 = fabsf(zx + (float)((float)(xx * 0.0) + (float)(yx * 0.0))) * 0.1;
  if ( fAccelRatio <= 0.0 )
    v17 = this->m_CurrentDummyEngineVolume + -1.0;
  this->m_CurrentDummyEngineVolume = v17;
  v39 = CAEAudioUtility::AudioLog10(fEngineSpeed);
  v10.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
  v9.n64_f32[0] = (float)(v37
                        + (float)((float)((float)((float)((float)((float)(xy * 0.0) + (float)(yy * 0.0)) + zy) * -0.15)
                                        + 1.0)
                                + v38))
                * fStalledFrequency;
  v40 = v16 + (float)(v35 * 20.0);
  v41 = v16 + v36;
  v42 = v17 + (float)(v39 * 20.0);
  if ( v10.n64_f32[0] < 0.0 )
  {
    LODWORD(this->m_CurrentRotorFrequency) = v9.n64_u32[0];
    v10.n64_u32[0] = v9.n64_u32[0];
  }
  if ( v9.n64_f32[0] >= v10.n64_f32[0] )
  {
    v10.n64_f32[0] = v10.n64_f32[0] + 0.0053333;
    v43 = vmin_f32(v9, v10).n64_u32[0];
  }
  else
  {
    v10.n64_f32[0] = v10.n64_f32[0] + -0.0053333;
    v43 = vmax_f32(v9, v10).n64_u32[0];
  }
  LODWORD(this->m_CurrentRotorFrequency) = v43;
  CAEVehicleAudioEntity::PlayAircraftSound(this, 2, 19, 10, v40, *(float *)&v43);
  CAEVehicleAudioEntity::PlayAircraftSound(this, 4, 19, 11, v41, *(float *)&v43);
  CAEVehicleAudioEntity::PlayAircraftSound(this, 5, 19, 26, v42 + fStalledVolume, 1.0);
  v56.m_pPhysicalEntity = 0;
  SoundPtr = this->m_EngineSounds[7].SoundPtr;
  if ( SoundPtr )
  {
    SoundPtr->m_EmittedVolume = v19;
    this->m_EngineSounds[7].SoundPtr->m_RelativeFrequency = 1.0;
  }
  else
  {
    Position.x = 0.0;
    *(_QWORD *)&Position.y = 1065353216LL;
    CAESound::Initialise(&v56, 19, 14, this, Position, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
    v56.m_EmittedVolume = v19;
    v56.m_RollOffFactor = 50.0;
    v56.m_RelativeFrequency = 1.0;
    v56.m_Environment = 4;
    this->m_EngineSounds[7].SoundPtr = CAESoundManager::RequestNewSound(&AESoundManager, &v56);
  }
  CAESound::~CAESound(&v56);
LABEL_40:
  CMatrix::~CMatrix(&v55);
}
// 3B7760: variable 'v9' is possibly undefined
// 3B7760: variable 'v10' is possibly undefined
// 3B785C: variable 'v8' is possibly undefined
// 3B785C: variable 'v11' is possibly undefined
// 3B7900: using guessed type int dword_3B7900;
// 3B7904: using guessed type int;

//----- (003B7924) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayAircraftSound(
        CAEVehicleAudioEntity *this,
        int SoundType,
        Int16 SlotID,
        Int16 SoundID,
        float Volume,
        float Frequency)
{
  char *v7; // r4
  int v8; // r0
  char *v9; // r4
  int v10; // t1
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r6
  int v14; // r0
  CEntity *v15; // lr
  CMatrix *v16; // r1
  CVector *p_m_translate; // r0
  CEntity *v18; // r0
  CMatrix *v19; // r1
  CVector *v20; // r6
  CEntity *v21; // r0
  CMatrix *v22; // r1
  CVector *v23; // r6
  CEntity *v24; // r0
  CMatrix *v25; // r1
  CVector *v26; // r6
  CVector Position; // [sp+0h] [bp-C0h]
  CAESound pRequestedSound; // [sp+2Ch] [bp-94h] BYREF

  v7 = (char *)this + 8 * SoundType;
  pRequestedSound.m_pPhysicalEntity = 0;
  v10 = *((_DWORD *)v7 + 58);
  v9 = v7 + 232;
  v8 = v10;
  if ( v10 )
  {
    *(float *)(v8 + 20) = Volume;
    *(float *)(*(_DWORD *)v9 + 28) = Frequency;
  }
  else
  {
    switch ( SoundType )
    {
      case 1:
        m_pGameEntity = this->m_pGameEntity;
        m_pMat = m_pGameEntity->m_pMat;
        p_tx = (CVector *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &m_pGameEntity->m_transform.m_translate;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, *p_tx, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v14 = 1086324736;
        goto LABEL_21;
      case 2:
        v15 = this->m_pGameEntity;
        v16 = v15->m_pMat;
        p_m_translate = (CVector *)&v16->tx;
        if ( !v16 )
          p_m_translate = &v15->m_transform.m_translate;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, *p_m_translate, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        goto LABEL_16;
      case 3:
        v18 = this->m_pGameEntity;
        v19 = v18->m_pMat;
        v20 = (CVector *)&v19->tx;
        if ( !v19 )
          v20 = &v18->m_transform.m_translate;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, *v20, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        pRequestedSound.m_Doppler = 0.4;
        pRequestedSound.m_RollOffFactor = 1.0;
        break;
      case 4:
        v21 = this->m_pGameEntity;
        v22 = v21->m_pMat;
        v23 = (CVector *)&v22->tx;
        if ( !v22 )
          v23 = &v21->m_transform.m_translate;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, *v23, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
LABEL_16:
        v14 = 1082130432;
        goto LABEL_21;
      case 5:
        v24 = this->m_pGameEntity;
        v25 = v24->m_pMat;
        v26 = (CVector *)&v25->tx;
        if ( !v25 )
          v26 = &v24->m_transform.m_translate;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, *v26, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v14 = 1083179008;
        goto LABEL_21;
      case 7:
        Position.x = 0.0;
        *(_QWORD *)&Position.y = 1065353216LL;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, Position, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v14 = 1112014848;
LABEL_21:
        LODWORD(pRequestedSound.m_RollOffFactor) = v14;
        break;
      default:
        break;
    }
    pRequestedSound.m_RelativeFrequency = Frequency;
    pRequestedSound.m_EmittedVolume = Volume;
    pRequestedSound.m_Environment = 4;
    *(_DWORD *)v9 = CAESoundManager::RequestNewSound(&AESoundManager, &pRequestedSound);
  }
  CAESound::~CAESound(&pRequestedSound);
}

//----- (003B7B18) --------------------------------------------------------
float __fastcall CAEVehicleAudioEntity::GetBaseVolumeForBicycleTyre(CAEVehicleAudioEntity *this, float fRatio)
{
  int v3; // r1
  int v4; // r0
  float v6; // s2
  float *v7; // r0

  if ( fRatio >= 0.0 )
  {
    if ( fRatio >= 0.1 )
    {
      if ( fRatio >= 0.2 )
      {
        if ( fRatio >= 0.5 )
        {
          if ( fRatio >= 1.0001 )
            return 1.0;
          v4 = 4;
        }
        else
        {
          v4 = 3;
        }
      }
      else
      {
        v4 = 2;
      }
      v3 = 1;
    }
    else
    {
      v3 = 1;
      v4 = 1;
    }
  }
  else
  {
    v3 = 0;
    v4 = 0;
  }
  v6 = 1.0;
  if ( fRatio <= 1.0 )
  {
    v6 = 0.0;
    if ( fRatio >= 0.0 )
    {
      if ( v3 )
      {
        v7 = CAEVehicleAudioEntity::GetBaseVolumeForBicycleTyre(float)::BicycleTyreVol[v4];
        return *(v7 - 1)
             + (float)((float)((float)(fRatio - *(v7 - 2)) / (float)(*v7 - *(v7 - 2))) * (float)(v7[1] - *(v7 - 1)));
      }
    }
  }
  return v6;
}

//----- (003B7BE8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayBicycleSound(
        CAEVehicleAudioEntity *this,
        int SoundType,
        Int16 SlotID,
        Int16 SoundID,
        float Volume,
        float Frequency)
{
  int m_DummySlot; // r2
  Int16 m_PlayerEngineBank; // r1
  char *v12; // r6
  int v13; // r0
  char *v14; // r6
  int v15; // t1
  Int32 RandomNumberInRange; // r0
  CEntity *m_pGameEntity; // r1
  CMatrix *m_pMat; // r2
  CVector *p_tx; // r3
  int v20; // r5
  Int16 v21; // r1
  CEntity *v22; // r0
  CMatrix *v23; // r1
  CVector *v24; // r2
  float v25; // s0
  CEntity *v26; // r0
  CMatrix *v27; // r1
  CVector *p_m_translate; // r2
  CAESound pRequestedSound; // [sp+2Ch] [bp-9Ch] BYREF

  pRequestedSound.m_pPhysicalEntity = 0;
  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot == 0xFFFF )
    goto LABEL_26;
  switch ( SoundType )
  {
    case 3:
      m_PlayerEngineBank = 39;
      LOWORD(m_DummySlot) = 2;
      goto LABEL_8;
    case 2:
      LOWORD(m_DummySlot) = 40;
      m_PlayerEngineBank = this->m_PlayerEngineBank;
LABEL_8:
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, m_PlayerEngineBank, m_DummySlot) )
        goto LABEL_26;
      break;
    case 1:
      m_PlayerEngineBank = this->m_DummyEngineBank;
      goto LABEL_8;
  }
  v12 = (char *)this + 8 * SoundType;
  v15 = *((_DWORD *)v12 + 58);
  v14 = v12 + 232;
  v13 = v15;
  if ( SoundType == 3 )
  {
    if ( !v13 )
    {
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(0, 3);
      m_pGameEntity = this->m_pGameEntity;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      v20 = RandomNumberInRange << 16;
      CAESound::Initialise(
        &pRequestedSound,
        2,
        *(Int16 *)((char *)CAEVehicleAudioEntity::PlayBicycleSound(short,short,short,float,float)::RandomClangValues[0]
                 + (RandomNumberInRange << 16 >> 14)),
        this,
        *p_tx,
        Volume,
        1.0,
        1.0,
        1.0,
        0,
        0,
        0.0,
        0);
      pRequestedSound.m_RelativeFrequency = Frequency;
      v21 = *(Int16 *)((char *)&CAEVehicleAudioEntity::PlayBicycleSound(short,short,short,float,float)::RandomClangValues[0][1]
                     + (v20 >> 14));
      pRequestedSound.m_EmittedVolume = Volume;
      pRequestedSound.m_Environment = 36;
      pRequestedSound.m_nPlayTime = v21;
      goto LABEL_25;
    }
  }
  else
  {
    if ( !v13 )
    {
      if ( SoundType == 2 )
      {
        v26 = this->m_pGameEntity;
        v27 = v26->m_pMat;
        p_m_translate = (CVector *)&v27->tx;
        if ( !v27 )
          p_m_translate = &v26->m_transform.m_translate;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, *p_m_translate, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v25 = 1.5;
      }
      else
      {
        if ( SoundType != 1 )
          goto LABEL_26;
        v22 = this->m_pGameEntity;
        v23 = v22->m_pMat;
        v24 = (CVector *)&v23->tx;
        if ( !v23 )
          v24 = &v22->m_transform.m_translate;
        CAESound::Initialise(&pRequestedSound, SlotID, SoundID, this, *v24, 0.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
        v25 = 2.5;
      }
      pRequestedSound.m_EmittedVolume = Volume;
      pRequestedSound.m_RollOffFactor = v25;
      pRequestedSound.m_RelativeFrequency = Frequency;
      pRequestedSound.m_Environment = 4;
LABEL_25:
      *(_DWORD *)v14 = CAESoundManager::RequestNewSound(&AESoundManager, &pRequestedSound);
      goto LABEL_26;
    }
    *(float *)(v13 + 20) = Volume;
    *(float *)(*(_DWORD *)v14 + 28) = Frequency;
  }
LABEL_26:
  CAESound::~CAESound(&pRequestedSound);
}

//----- (003B7DA8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::GetSirenState(
        CAEVehicleAudioEntity *this,
        Bool8 *pbSirenOn,
        Bool8 *pbFastSirenOn,
        cVehicleParams *VehicleParams)
{
  CVehicle *pVehicle; // r0
  UInt32 m_cHorn; // r1
  bool v6; // zf

  if ( this->m_bWreckedVehicle
    || !this->m_bUsesSiren
    || (*((_BYTE *)&VehicleParams->pVehicle->m_nVehicleFlags + 5) & 0x80) == 0
    || (*pbSirenOn = 1, pVehicle = VehicleParams->pVehicle, (*(_BYTE *)&pVehicle->m_info & 0xF8) == 32) )
  {
    *pbSirenOn = 0;
  }
  else
  {
    m_cHorn = pVehicle->m_cHorn;
    v6 = m_cHorn == 0;
    if ( m_cHorn )
      v6 = pVehicle->m_nModelIndex == 423;
    *pbFastSirenOn = !v6;
  }
}

//----- (003B7DFC) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::GetHornState(
        CAEVehicleAudioEntity *this,
        Bool8 *pbHornOn,
        cVehicleParams *VehicleParams)
{
  CVehicle *pVehicle; // r0
  int CarAlarmState; // r1
  bool v7; // zf
  unsigned int m_cHorn; // r1

  if ( this->m_bWreckedVehicle )
    goto LABEL_2;
  pVehicle = VehicleParams->pVehicle;
  CarAlarmState = pVehicle->CarAlarmState;
  v7 = CarAlarmState == 0;
  if ( pVehicle->CarAlarmState )
    v7 = CarAlarmState == 0xFFFF;
  if ( !v7 && (*(_BYTE *)&pVehicle->m_info & 0xF8) != 40 )
    goto LABEL_2;
  m_cHorn = pVehicle->m_cHorn;
  if ( !m_cHorn )
    goto LABEL_2;
  if ( *(_BYTE *)&pVehicle->m_info < 8u )
    goto LABEL_14;
  if ( m_cHorn >= 0x2D )
  {
    pVehicle->m_cHorn = 44;
    pVehicle = VehicleParams->pVehicle;
    m_cHorn = pVehicle->m_cHorn;
  }
  if ( m_cHorn == 44 )
  {
    VehicleParams->pVehicle->m_nHornPattern = CAEAudioUtility::GetRandomNumberInRange(0, 7);
    pVehicle = VehicleParams->pVehicle;
    m_cHorn = pVehicle->m_cHorn;
  }
  if ( HornPattern[pVehicle->m_nHornPattern][44 - m_cHorn] )
LABEL_14:
    *pbHornOn = 1;
  else
LABEL_2:
    *pbHornOn = 0;
}

//----- (003B7E88) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::PlayHornOrSiren(
        CAEVehicleAudioEntity *this,
        int bHornOn,
        int bSirenOn,
        int bFastSirenOn,
        cVehicleParams *VehicleParams)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d2
  float v10; // s16
  float v11; // s18
  CAESound *HornType; // r0
  CEntity *v13; // r0
  CAESound *p_ScratchSound; // r8
  CMatrix *v15; // r1
  CVector *p_m_translate; // r3
  float HornPitch; // r2
  float v18; // s2
  bool v19; // zf
  CAESound *v20; // r0
  CAESound *m_HornSoundPtr; // r0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3
  int v25; // r0
  _BOOL4 v26; // r1
  int v27; // r2
  bool v28; // zf
  int v29; // r0
  CEntity *v30; // r0
  CMatrix *v31; // r1
  CVector *v32; // r2
  CAESound *v33; // r6
  CAESound *m_SirenSoundPtr; // r0
  CAESound *v35; // r0
  CEntity *v36; // r0
  CMatrix *v37; // r1
  CVector *v38; // r2
  CAESound *m_bFastSirenOn; // r0
  CEntity *v40; // r0
  CMatrix *v41; // r1
  CVector *v42; // r2
  CAESound *v43; // r0
  bool v44; // zf

  v10 = (float)CAEAudioEntity::m_pAudioEventVolumes[97];
  v11 = (float)CAEAudioEntity::m_pAudioEventVolumes[96];
  HornType = (CAESound *)(unsigned __int8)this->m_VehicleAudioSetting.HornType;
  if ( !HornType )
  {
    if ( bHornOn && !this->m_bHornOn )
    {
      m_HornSoundPtr = this->m_HornSoundPtr;
      if ( m_HornSoundPtr )
      {
        CAESound::StopSoundAndForget(m_HornSoundPtr);
        this->m_HornSoundPtr = 0;
      }
      this->m_HornVolume = v11;
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x4Au, 17)
        && !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
      {
        return;
      }
      m_pGameEntity = this->m_pGameEntity;
      p_ScratchSound = &this->ScratchSound;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      CAESound::Initialise(
        &this->ScratchSound,
        17,
        this->m_VehicleAudioSetting.HornType,
        this,
        *p_tx,
        this->m_HornVolume,
        1.0,
        1.0,
        1.0,
        0,
        0,
        0.0,
        0);
      this->ScratchSound.m_Environment = 4;
      this->ScratchSound.m_RollOffFactor = 2.5;
      this->ScratchSound.m_RelativeFrequency = 1.0;
      this->ScratchSound.m_Doppler = 0.17;
LABEL_27:
      v20 = CAESoundManager::RequestNewSound(&AESoundManager, p_ScratchSound);
      goto LABEL_28;
    }
    v6.n64_u32[0] = -1027080192;
    HornType = this->m_HornSoundPtr;
    v5.n64_f32[0] = this->m_HornVolume + -1.5;
    LODWORD(v18) = vmax_f32(v5, v6).n64_u32[0];
    this->m_HornVolume = v18;
    if ( !HornType )
      goto LABEL_29;
    if ( v5.n64_f32[0] > -100.0 )
    {
      HornType->m_EmittedVolume = v18;
      goto LABEL_29;
    }
LABEL_19:
    CAESound::StopSoundAndForget(HornType);
    v20 = 0;
LABEL_28:
    this->m_HornSoundPtr = v20;
    goto LABEL_29;
  }
  if ( bHornOn )
  {
    if ( this->m_bHornOn )
      goto LABEL_29;
    if ( (unsigned __int8)((_BYTE)HornType - 1) > 8u )
      return;
    this->m_HornVolume = this->m_VehicleAudioSetting.EngineVolumeOffset
                       + (float)CAEAudioEntity::m_pAudioEventVolumes[95];
    if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x4Au, 17)
      && !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
    {
      return;
    }
    if ( this->m_HornSoundPtr )
      return;
    v13 = this->m_pGameEntity;
    p_ScratchSound = &this->ScratchSound;
    v15 = v13->m_pMat;
    p_m_translate = (CVector *)&v15->tx;
    if ( !v15 )
      p_m_translate = &v13->m_transform.m_translate;
    CAESound::Initialise(
      &this->ScratchSound,
      17,
      this->m_VehicleAudioSetting.HornType,
      this,
      *p_m_translate,
      this->m_HornVolume,
      1.0,
      1.0,
      1.0,
      0,
      0,
      0.0,
      0);
    this->ScratchSound.m_Environment = 4;
    HornPitch = this->m_VehicleAudioSetting.HornPitch;
    this->ScratchSound.m_Doppler = 0.17;
    this->ScratchSound.m_RollOffFactor = 2.5;
    this->ScratchSound.m_RelativeFrequency = HornPitch;
    goto LABEL_27;
  }
  v19 = this->m_bHornOn == 0;
  if ( this->m_bHornOn )
  {
    HornType = this->m_HornSoundPtr;
    v19 = HornType == 0;
  }
  if ( !v19 )
    goto LABEL_19;
LABEL_29:
  v25 = 0;
  if ( this->m_bSirenOn )
    v26 = this->m_bFastSirenOn == 0;
  else
    v26 = 0;
  v27 = bFastSirenOn;
  if ( !bSirenOn )
    v25 = 1;
  if ( bFastSirenOn )
    v27 = 1;
  v29 = v25 | v27;
  v28 = v29 == 0;
  if ( !v29 )
    v28 = !v26;
  if ( v28 )
  {
    if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x4Au, 17) || this->m_SirenSoundPtr )
      return;
    if ( VehicleParams->pVehicle->m_nModelIndex == 423 )
    {
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x4Fu, 40) )
        return;
      v30 = this->m_pGameEntity;
      v31 = v30->m_pMat;
      v32 = (CVector *)&v31->tx;
      if ( !v31 )
        v32 = &v30->m_transform.m_translate;
      v33 = &this->ScratchSound;
      CAESound::Initialise(&this->ScratchSound, 40, 3, this, *v32, v10, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
    }
    else
    {
      v36 = this->m_pGameEntity;
      v37 = v36->m_pMat;
      v38 = (CVector *)&v37->tx;
      if ( !v37 )
        v38 = &v36->m_transform.m_translate;
      v33 = &this->ScratchSound;
      CAESound::Initialise(&this->ScratchSound, 17, 10, this, *v38, v10, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
    }
    this->ScratchSound.m_Environment = 4;
    this->ScratchSound.m_RollOffFactor = 3.0;
    this->ScratchSound.m_RelativeFrequency = 1.0;
    this->ScratchSound.m_Doppler = 0.25;
    v35 = CAESoundManager::RequestNewSound(&AESoundManager, v33);
    goto LABEL_54;
  }
  if ( (v29 & v26) == 1 )
  {
    m_SirenSoundPtr = this->m_SirenSoundPtr;
    if ( m_SirenSoundPtr )
    {
      CAESound::StopSoundAndForget(m_SirenSoundPtr);
      v35 = 0;
LABEL_54:
      this->m_SirenSoundPtr = v35;
    }
  }
  m_bFastSirenOn = (CAESound *)this->m_bFastSirenOn;
  if ( bFastSirenOn )
  {
    if ( !this->m_bFastSirenOn
      && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x4Au, 17)
      && !this->m_FastSirenSoundPtr )
    {
      v40 = this->m_pGameEntity;
      v41 = v40->m_pMat;
      v42 = (CVector *)&v41->tx;
      if ( !v41 )
        v42 = &v40->m_transform.m_translate;
      CAESound::Initialise(&this->ScratchSound, 17, 11, this, *v42, v10, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      this->ScratchSound.m_Environment = 4;
      this->ScratchSound.m_RollOffFactor = 3.0;
      this->ScratchSound.m_RelativeFrequency = 1.0;
      this->ScratchSound.m_Doppler = 0.25;
      v43 = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      goto LABEL_66;
    }
  }
  else
  {
    v44 = m_bFastSirenOn == 0;
    if ( this->m_bFastSirenOn )
    {
      m_bFastSirenOn = this->m_FastSirenSoundPtr;
      v44 = m_bFastSirenOn == 0;
    }
    if ( !v44 )
    {
      CAESound::StopSoundAndForget(m_bFastSirenOn);
      v43 = 0;
LABEL_66:
      this->m_FastSirenSoundPtr = v43;
    }
  }
}
// 3B7FB0: variable 'v5' is possibly undefined
// 3B7FB0: variable 'v6' is possibly undefined

//----- (003B8280) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::StopGenericEngineSound(CAEVehicleAudioEntity *this, Int16 SoundType)
{
  char *v2; // r4
  CAESound *v3; // r0
  CAESound **v4; // r4
  CAESound *v5; // t1

  v2 = (char *)this + 8 * SoundType;
  v5 = (CAESound *)*((_DWORD *)v2 + 58);
  v4 = (CAESound **)(v2 + 232);
  v3 = v5;
  if ( v5 )
  {
    CAESound::SetIndividualEnvironment(v3, 4u, 0);
    CAESound::StopSound(*v4);
    *v4 = 0;
  }
}

//----- (003B82A8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::UpdateBoatSound(
        CAEVehicleAudioEntity *this,
        int SoundType,
        Int16 SlotID,
        Int16 SoundID,
        float Frequency,
        float Volume)
{
  bool v7; // zf
  char *v10; // r6
  int v11; // r0
  char *v12; // r6
  int v13; // t1
  float v14; // s18
  CEntity *v15; // r0
  CMatrix *v16; // r1
  CVector *v17; // r2
  CAESound *p_ScratchSound; // r5
  float v19; // s0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r2
  CEntity *v23; // r0
  CMatrix *v24; // r1
  CVector *p_m_translate; // r2

  v7 = SoundType == 6;
  if ( SoundType != 6 )
    v7 = this->m_VehicleAudioSetting.VehicleAudioType == 6;
  if ( v7 || (unsigned __int16)this->m_DummySlot != 0xFFFF )
  {
    v10 = (char *)this + 8 * SoundType;
    v13 = *((_DWORD *)v10 + 58);
    v12 = v10 + 232;
    v11 = v13;
    v14 = this->m_fEventVolume + Volume;
    if ( v13 )
    {
      *(float *)(v11 + 20) = v14;
      *(float *)(*(_DWORD *)v12 + 28) = Frequency;
      return;
    }
    if ( SoundType == 6 )
    {
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
        return;
      m_pGameEntity = this->m_pGameEntity;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      p_ScratchSound = &this->ScratchSound;
      CAESound::Initialise(&this->ScratchSound, SlotID, SoundID, this, *p_tx, v14, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v19 = 2.5;
      goto LABEL_22;
    }
    if ( SoundType == 3 )
    {
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
        return;
      v23 = this->m_pGameEntity;
      v24 = v23->m_pMat;
      p_m_translate = (CVector *)&v24->tx;
      if ( !v24 )
        p_m_translate = &v23->m_transform.m_translate;
      p_ScratchSound = &this->ScratchSound;
      CAESound::Initialise(&this->ScratchSound, SlotID, SoundID, this, *p_m_translate, v14, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v19 = 5.0;
      goto LABEL_22;
    }
    if ( SoundType == 2
      && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, this->m_DummySlot) )
    {
      v15 = this->m_pGameEntity;
      v16 = v15->m_pMat;
      v17 = (CVector *)&v16->tx;
      if ( !v16 )
        v17 = &v15->m_transform.m_translate;
      p_ScratchSound = &this->ScratchSound;
      CAESound::Initialise(&this->ScratchSound, SlotID, SoundID, this, *v17, v14, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v19 = 3.5;
LABEL_22:
      this->ScratchSound.m_EmittedVolume = v14;
      this->ScratchSound.m_RollOffFactor = v19;
      this->ScratchSound.m_RelativeFrequency = Frequency;
      this->ScratchSound.m_Environment = 4;
      *(_DWORD *)v12 = CAESoundManager::RequestNewSound(&AESoundManager, p_ScratchSound);
    }
  }
}

//----- (003B8444) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::UpdateTrainSound(
        CAEVehicleAudioEntity *this,
        int SoundType,
        Int16 SlotID,
        Int16 SoundID,
        float Frequency,
        float Volume)
{
  int m_DummySlot; // r2
  char *v10; // r5
  float m_fEventVolume; // s2
  int v12; // r0
  char *v13; // r5
  int v14; // t1
  float v15; // s18
  CEntity *v16; // r0
  CAESound *p_ScratchSound; // r8
  CMatrix *v18; // r1
  CVector *v19; // r2
  int v20; // r0
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r2
  CEntity *v24; // r0
  CMatrix *v25; // r1
  CVector *p_m_translate; // r2

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF )
  {
    v10 = (char *)this + 8 * SoundType;
    m_fEventVolume = this->m_fEventVolume;
    v14 = *((_DWORD *)v10 + 58);
    v13 = v10 + 232;
    v12 = v14;
    v15 = m_fEventVolume + Volume;
    if ( v14 )
    {
      *(float *)(v12 + 20) = v15;
      *(float *)(*(_DWORD *)v13 + 28) = Frequency;
      return;
    }
    if ( SoundType == 3 )
    {
      m_pGameEntity = this->m_pGameEntity;
      p_ScratchSound = &this->ScratchSound;
      m_pMat = m_pGameEntity->m_pMat;
      p_tx = (CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &m_pGameEntity->m_transform.m_translate;
      CAESound::Initialise(
        &this->ScratchSound,
        SlotID,
        SoundID,
        this,
        *p_tx,
        m_fEventVolume + Volume,
        1.0,
        1.0,
        1.0,
        0,
        0,
        0.0,
        0);
      goto LABEL_20;
    }
    if ( SoundType == 2 )
    {
      if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
        return;
      v24 = this->m_pGameEntity;
      p_ScratchSound = &this->ScratchSound;
      v25 = v24->m_pMat;
      p_m_translate = (CVector *)&v25->tx;
      if ( !v25 )
        p_m_translate = &v24->m_transform.m_translate;
      CAESound::Initialise(&this->ScratchSound, SlotID, SoundID, this, *p_m_translate, v15, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      if ( this->m_DummyEngineBank == 133 )
      {
        v20 = 1084227584;
        goto LABEL_21;
      }
LABEL_20:
      v20 = 1083179008;
      goto LABEL_21;
    }
    if ( SoundType == 1 && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      v16 = this->m_pGameEntity;
      p_ScratchSound = &this->ScratchSound;
      v18 = v16->m_pMat;
      v19 = (CVector *)&v18->tx;
      if ( !v18 )
        v19 = &v16->m_transform.m_translate;
      CAESound::Initialise(&this->ScratchSound, SlotID, SoundID, this, *v19, v15, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      if ( this->m_DummyEngineBank == 133 )
      {
        v20 = 1082130432;
LABEL_21:
        LODWORD(this->ScratchSound.m_RollOffFactor) = v20;
        this->ScratchSound.m_RelativeFrequency = Frequency;
        this->ScratchSound.m_EmittedVolume = v15;
        this->ScratchSound.m_Environment = 4;
        *(_DWORD *)v13 = CAESoundManager::RequestNewSound(&AESoundManager, p_ScratchSound);
        return;
      }
      goto LABEL_20;
    }
  }
}

//----- (003B85E8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyRCHeli(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d8
  float32x2_t v6; // d9
  int m_DummySlot; // r0
  int i; // r6
  char *v11; // r4
  __int16 m_nLength; // r5
  CAESound *v13; // r0
  CAESound **v14; // r4
  CAESound *v15; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v17; // r0
  int m_DummyEngineBank; // r0
  unsigned int v19; // r1
  bool v20; // zf
  CPad *PadFromPlayer; // r6
  int Brake; // r0
  int *v23; // r2
  float v24; // s18
  CVehicle *pVehicle; // r1
  double v26; // d16
  float v27; // s20
  float v28; // s0
  float v29; // s6
  bool v30; // nf
  float v31; // s0
  double v32; // d17
  float v33; // s16
  float v34; // r0
  float v35; // s8
  unsigned __int32 v36; // s2
  Int16 v37; // r2

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      if ( this->m_bWreckedVehicle )
      {
        v6.n64_u32[0] = 1.0;
        for ( i = 0; i != 12; ++i )
        {
          while ( 1 )
          {
            v11 = (char *)this + 8 * i;
            m_nLength = -1;
            v15 = (CAESound *)*((_DWORD *)v11 + 58);
            v14 = (CAESound **)(v11 + 232);
            v13 = v15;
            if ( v15 )
            {
              m_nLength = v13->m_nLength;
              CAESound::SetIndividualEnvironment(v13, 4u, 0);
              CAESound::StopSound(*v14);
              *v14 = 0;
            }
            if ( i != 4 )
              break;
            m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( m_nLength < 1 )
            {
              LOWORD(v17) = 0;
            }
            else
            {
              v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
              v2.n64_u64[0] = vmin_f32(v2, v6).n64_u64[0];
              v17 = (int)(float)(v2.n64_f32[0] * 100.0);
              if ( v2.n64_f32[0] < 0.0 )
                LOWORD(v17) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v17;
            i = 5;
          }
        }
      }
      else
      {
        v5.n64_f32[0] = *(float *)&vp->pVehicle[1].m_VehicleAudioEntity.m_ReverseSoundPtr / 0.22;
        v20 = CAEVehicleAudioEntity::s_pPlayerDriver == 0;
        if ( CAEVehicleAudioEntity::s_pPlayerDriver )
          v20 = this->m_bPlayerDriven == 0;
        if ( v20
          || this->m_bPlayerDriverAboutToExit
          || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
          || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
        {
          v24 = 0.0;
          Brake = 0;
          vp->ThisAccel = 0;
        }
        else
        {
          PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
          vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
          Brake = CPad::GetBrake(PadFromPlayer);
          v23 = &dword_3B88D8;
          if ( vp->ThisAccel > 0 )
            v23 = &dword_3B88DC;
          v24 = *(float *)v23;
        }
        pVehicle = vp->pVehicle;
        vp->ThisBrake = Brake;
        v26 = 0.0;
        v27 = 0.2;
        v3.n64_u32[0] = 1.0;
        v28 = (float)((float)(1.0
                            - (float)(pVehicle->m_pMat->zz
                                    + (float)((float)(pVehicle->m_pMat->xz * 0.0) + (float)(pVehicle->m_pMat->yz * 0.0))))
                    * 0.5)
            / 0.07;
        v29 = v28 * 0.2;
        if ( Brake > 0 )
          v24 = -0.05;
        v30 = v28 < 1.0;
        v31 = vmin_f32(v5, v3).n64_f32[0];
        if ( v30 )
          v27 = v29;
        if ( v31 >= 0.2 )
          v26 = (float)((float)(v31 + -0.2) / 0.8);
        v32 = 0.2;
        if ( v26 > 0.2 )
          v32 = v26;
        v33 = v32;
        v34 = CAEAudioUtility::AudioLog10(v33);
        v35 = v27 + (float)((float)(v33 * 0.2) + 0.8);
        v4.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
        v3.n64_f32[0] = v24 + v35;
        if ( v4.n64_f32[0] < 0.0 )
        {
          LODWORD(this->m_CurrentRotorFrequency) = v3.n64_u32[0];
          v4.n64_f32[0] = v24 + v35;
        }
        if ( v3.n64_f32[0] >= v4.n64_f32[0] )
        {
          v4.n64_f32[0] = v4.n64_f32[0] + 0.0053333;
          v36 = vmin_f32(v3, v4).n64_u32[0];
        }
        else
        {
          v4.n64_f32[0] = v4.n64_f32[0] + -0.0053333;
          v36 = vmax_f32(v3, v4).n64_u32[0];
        }
        v37 = this->m_DummySlot;
        LODWORD(this->m_CurrentRotorFrequency) = v36;
        CAEVehicleAudioEntity::PlayAircraftSound(this, 2, v37, 0, (float)(v34 * 20.0) + -6.0, *(float *)&v36);
      }
    }
    else
    {
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v19 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v19 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v19 >> 14)) != m_DummyEngineBank )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
        this->m_State = 0;
      }
    }
  }
}
// 3B86B4: variable 'v2' is possibly undefined
// 3B86B4: variable 'v6' is possibly undefined
// 3B87E4: variable 'v5' is possibly undefined
// 3B87E4: variable 'v3' is possibly undefined
// 3B887E: variable 'v4' is possibly undefined
// 3B88D8: using guessed type int dword_3B88D8;
// 3B88DC: using guessed type int;

//----- (003B8908) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyRCCar(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d9
  int m_DummySlot; // r0
  int i; // r6
  char *v9; // r4
  __int16 m_nLength; // r5
  CAESound *v11; // r0
  CAESound **v12; // r4
  CAESound *v13; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v15; // r0
  int m_DummyEngineBank; // r0
  unsigned int v17; // r1
  float v18; // s0
  float fVolume; // r6
  float PiecewiseLinear; // r0

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      if ( this->m_bWreckedVehicle )
      {
        v4.n64_u32[0] = 1.0;
        for ( i = 0; i != 12; ++i )
        {
          while ( 1 )
          {
            v9 = (char *)this + 8 * i;
            m_nLength = -1;
            v13 = (CAESound *)*((_DWORD *)v9 + 58);
            v12 = (CAESound **)(v9 + 232);
            v11 = v13;
            if ( v13 )
            {
              m_nLength = v11->m_nLength;
              CAESound::SetIndividualEnvironment(v11, 4u, 0);
              CAESound::StopSound(*v12);
              *v12 = 0;
            }
            if ( i != 4 )
              break;
            m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( m_nLength < 1 )
            {
              LOWORD(v15) = 0;
            }
            else
            {
              v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
              v2.n64_u64[0] = vmin_f32(v2, v4).n64_u64[0];
              v15 = (int)(float)(v2.n64_f32[0] * 100.0);
              if ( v2.n64_f32[0] < 0.0 )
                LOWORD(v15) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v15;
            i = 5;
          }
        }
      }
      else
      {
        v3.n64_u32[0] = 1.0;
        v2.n64_f32[0] = fabsf(vp->fSpeed / vp->pTransmission->m_fMaxVelocity);
        LODWORD(v18) = vmin_f32(v2, v3).n64_u32[0];
        fVolume = CAEAudioUtility::GetPiecewiseLinear(v18, 4, fRCCarDummyVolume);
        PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v18, 4, fRCCarDummyFrequency);
        CAEVehicleAudioEntity::UpdateGenericVehicleSound(
          this,
          2,
          this->m_DummySlot,
          this->m_DummyEngineBank,
          0,
          PiecewiseLinear,
          fVolume,
          1.0);
      }
    }
    else
    {
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v17 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v17 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v17 >> 14)) != m_DummyEngineBank )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
        this->m_State = 0;
      }
    }
  }
}
// 3B89D4: variable 'v2' is possibly undefined
// 3B89D4: variable 'v4' is possibly undefined
// 3B8A52: variable 'v3' is possibly undefined

//----- (003B8AB8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyRCPlane(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d8
  float32x2_t v6; // d9
  float32x2_t v7; // d13
  int m_DummySlot; // r0
  int i; // r6
  char *v12; // r4
  __int16 m_nLength; // r5
  CAESound *v14; // r0
  CAESound **v15; // r4
  CAESound *v16; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v18; // r0
  int m_DummyEngineBank; // r0
  unsigned int v20; // r1
  bool v21; // zf
  CPad *PadFromPlayer; // r6
  int Brake; // r0
  int *v24; // r2
  float v25; // s18
  CVehicle *pVehicle; // r1
  double v27; // d16
  float *p_xx; // r1
  float v29; // s24
  float v30; // s22
  float v31; // s0
  double v32; // d17
  float v33; // s0
  float v34; // r0
  unsigned __int32 v35; // s2
  Int16 v36; // r2

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      if ( this->m_bWreckedVehicle )
      {
        v6.n64_u32[0] = 1.0;
        for ( i = 0; i != 12; ++i )
        {
          while ( 1 )
          {
            v12 = (char *)this + 8 * i;
            m_nLength = -1;
            v16 = (CAESound *)*((_DWORD *)v12 + 58);
            v15 = (CAESound **)(v12 + 232);
            v14 = v16;
            if ( v16 )
            {
              m_nLength = v14->m_nLength;
              CAESound::SetIndividualEnvironment(v14, 4u, 0);
              CAESound::StopSound(*v15);
              *v15 = 0;
            }
            if ( i != 4 )
              break;
            m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( m_nLength < 1 )
            {
              LOWORD(v18) = 0;
            }
            else
            {
              v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
              v2.n64_u64[0] = vmin_f32(v2, v6).n64_u64[0];
              v18 = (int)(float)(v2.n64_f32[0] * 100.0);
              if ( v2.n64_f32[0] < 0.0 )
                LOWORD(v18) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v18;
            i = 5;
          }
        }
      }
      else
      {
        v5.n64_f32[0] = *(float *)&vp->pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
        v21 = CAEVehicleAudioEntity::s_pPlayerDriver == 0;
        if ( CAEVehicleAudioEntity::s_pPlayerDriver )
          v21 = this->m_bPlayerDriven == 0;
        if ( v21
          || this->m_bPlayerDriverAboutToExit
          || CAEVehicleAudioEntity::s_pPlayerDriver->m_nPedState == PED_ARRESTED
          || !CPed::IsAlive(CAEVehicleAudioEntity::s_pPlayerDriver) )
        {
          v25 = 0.0;
          Brake = 0;
          vp->ThisAccel = 0;
        }
        else
        {
          PadFromPlayer = CPlayerPed::GetPadFromPlayer(CAEVehicleAudioEntity::s_pPlayerDriver);
          vp->ThisAccel = CPad::GetAccelerate(PadFromPlayer);
          Brake = CPad::GetBrake(PadFromPlayer);
          v24 = &dword_3B8DA8;
          if ( vp->ThisAccel > 0 )
            v24 = &dword_3B8DAC;
          v25 = *(float *)v24;
        }
        pVehicle = vp->pVehicle;
        v7.n64_u32[0] = 1.0;
        vp->ThisBrake = Brake;
        v27 = 0.0;
        p_xx = &pVehicle->m_pMat->xx;
        v29 = p_xx[6] + (float)((float)(p_xx[4] * 0.0) + (float)(p_xx[5] * 0.0));
        if ( Brake > 0 )
          v25 = -0.05;
        v30 = fabsf(p_xx[2] + (float)((float)(*p_xx * 0.0) + (float)(p_xx[1] * 0.0)));
        v31 = vmin_f32(v5, v7).n64_f32[0];
        if ( v31 >= 0.2 )
          v27 = (float)((float)(v31 + -0.2) / 0.8);
        v32 = 0.2;
        if ( v27 > 0.2 )
          v32 = v27;
        v33 = v32;
        v34 = CAEAudioUtility::AudioLog10(v33);
        v4.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
        v3.n64_f32[0] = v25 + (float)((float)((float)(v29 * -0.15) + 1.0) + (float)(v30 * 0.1));
        if ( v4.n64_f32[0] < 0.0 )
        {
          LODWORD(this->m_CurrentRotorFrequency) = v3.n64_u32[0];
          v4.n64_f32[0] = v25 + (float)((float)((float)(v29 * -0.15) + 1.0) + (float)(v30 * 0.1));
        }
        if ( v3.n64_f32[0] >= v4.n64_f32[0] )
        {
          v4.n64_f32[0] = v4.n64_f32[0] + 0.0053333;
          v35 = vmin_f32(v3, v4).n64_u32[0];
        }
        else
        {
          v4.n64_f32[0] = v4.n64_f32[0] + -0.0053333;
          v35 = vmax_f32(v3, v4).n64_u32[0];
        }
        v36 = this->m_DummySlot;
        LODWORD(this->m_CurrentRotorFrequency) = v35;
        CAEVehicleAudioEntity::PlayAircraftSound(this, 2, v36, 0, (float)(v34 * 20.0) + 0.0, *(float *)&v35);
      }
    }
    else
    {
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v20 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v20 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v20 >> 14)) != m_DummyEngineBank )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
        this->m_State = 0;
      }
    }
  }
}
// 3B8B84: variable 'v2' is possibly undefined
// 3B8B84: variable 'v6' is possibly undefined
// 3B8CB4: variable 'v5' is possibly undefined
// 3B8CB4: variable 'v7' is possibly undefined
// 3B8D48: variable 'v3' is possibly undefined
// 3B8D48: variable 'v4' is possibly undefined
// 3B8DA8: using guessed type int dword_3B8DA8;
// 3B8DAC: using guessed type int;

//----- (003B8DD8) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyHovercraft(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d9
  float32x2_t v6; // d10
  CPad *Pad; // r8
  int m_DummySlot; // r0
  CVehicle *pVehicle; // r9
  int i; // r5
  char *v13; // r4
  __int16 m_nLength; // r6
  CAESound *v15; // r0
  CAESound **v16; // r4
  CAESound *v17; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v19; // r0
  int v20; // r0
  unsigned int v21; // r1
  int v22; // s4
  float v23; // s0
  int v24; // s2
  float v25; // s16
  bool v26; // cc
  bool v27; // fnf
  float v28; // s0
  int16 v29; // r6
  int16 v30; // r0
  int *v31; // r1
  int Brake; // r6
  int Accelerate; // r0
  int *v34; // r1
  float v35; // s8
  float32x2_t v36; // d1
  unsigned __int32 v37; // s2
  Int16 m_DummyEngineBank; // r3
  Int16 v39; // r2

  Pad = CPad::GetPad(0);
  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      pVehicle = vp->pVehicle;
      if ( (*(_BYTE *)&pVehicle->m_nVehicleFlags & 0x10) != 0 && !this->m_bWreckedVehicle )
      {
        v6.n64_u32[0] = 1.0;
        v5.n64_u32[0] = 0;
        v22 = 0;
        v23 = fabsf(*(float *)&pVehicle[1].AutoPilot.ConstrainAreaMaxX / 1.5);
        v24 = 1041865114;
        v25 = v23 * 0.15;
        if ( v23 > 1.0 )
          v22 = 1041865114;
        if ( v23 < 0.0 )
          v24 = v22;
        v26 = v23 <= 1.0;
        v27 = v23 < 0.0;
        v28 = 0.0;
        if ( !v26 )
          v25 = *(float *)&v24;
        if ( v27 )
          v25 = *(float *)&v24;
        if ( *(_BYTE *)&pVehicle->m_info <= 7u )
        {
          if ( vp->fSpeed >= 0.001 )
          {
            Brake = CPad::GetBrake(Pad);
            Accelerate = CPad::GetAccelerate(Pad);
            v34 = &dword_3B90A0;
            if ( Accelerate > 0 )
              v34 = &dword_3B90A4;
            v28 = *(float *)v34;
            if ( Brake > 0 )
              v28 = -0.05;
          }
          else
          {
            v29 = CPad::GetAccelerate(Pad);
            v30 = CPad::GetBrake(Pad);
            v31 = &dword_3B90A0;
            if ( (__int16)(v29 - v30) > 0 )
              v31 = &dword_3B90A4;
            v28 = *(float *)v31;
          }
        }
        v3.n64_f32[0] = *(float *)&pVehicle[1].AutoPilot.pObstructingEntity / 0.34;
        v36.n64_u64[0] = vmax_f32(vmin_f32(v3, v6), v5).n64_u64[0];
        v35 = v36.n64_f32[0] * 6.0;
        v4.n64_u32[0] = LODWORD(this->m_CurrentRotorFrequency);
        v36.n64_f32[0] = v28 + (float)(v25 + (float)((float)(v36.n64_f32[0] * 0.35) + 0.8));
        if ( v4.n64_f32[0] < 0.0 )
        {
          LODWORD(this->m_CurrentRotorFrequency) = v36.n64_u32[0];
          v4.n64_u32[0] = v36.n64_u32[0];
        }
        if ( v36.n64_f32[0] >= v4.n64_f32[0] )
        {
          v4.n64_f32[0] = v4.n64_f32[0] + 0.0053333;
          v37 = vmin_f32(v36, v4).n64_u32[0];
        }
        else
        {
          v4.n64_f32[0] = v4.n64_f32[0] + -0.0053333;
          v37 = vmax_f32(v36, v4).n64_u32[0];
        }
        m_DummyEngineBank = this->m_DummyEngineBank;
        v39 = this->m_DummySlot;
        LODWORD(this->m_CurrentRotorFrequency) = v37;
        CAEVehicleAudioEntity::UpdateGenericVehicleSound(
          this,
          1,
          v39,
          m_DummyEngineBank,
          0,
          *(float *)&v37,
          v35 + -12.0,
          3.5);
      }
      else
      {
        v5.n64_u32[0] = 1.0;
        for ( i = 0; i != 12; ++i )
        {
          while ( 1 )
          {
            v13 = (char *)this + 8 * i;
            m_nLength = -1;
            v17 = (CAESound *)*((_DWORD *)v13 + 58);
            v16 = (CAESound **)(v13 + 232);
            v15 = v17;
            if ( v17 )
            {
              m_nLength = v15->m_nLength;
              CAESound::SetIndividualEnvironment(v15, 4u, 0);
              CAESound::StopSound(*v16);
              *v16 = 0;
            }
            if ( i != 4 )
              break;
            m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( m_nLength < 1 )
            {
              LOWORD(v19) = 0;
            }
            else
            {
              v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
              v2.n64_u64[0] = vmin_f32(v2, v5).n64_u64[0];
              v19 = (int)(float)(v2.n64_f32[0] * 100.0);
              if ( v2.n64_f32[0] < 0.0 )
                LOWORD(v19) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v19;
            i = 5;
          }
        }
      }
    }
    else
    {
      v20 = (unsigned __int16)this->m_DummyEngineBank;
      v21 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v21 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v21 >> 14)) != v20 )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(v20);
        this->m_State = 0;
      }
    }
  }
}
// 3B8EB8: variable 'v2' is possibly undefined
// 3B8EB8: variable 'v5' is possibly undefined
// 3B8FF6: variable 'v3' is possibly undefined
// 3B8FF6: variable 'v6' is possibly undefined
// 3B9046: variable 'v4' is possibly undefined
// 3B90A0: using guessed type int dword_3B90A0;
// 3B90A4: using guessed type int;

//----- (003B90D0) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::ProcessDummyGolfCart(CAEVehicleAudioEntity *this, cVehicleParams *vp)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d9
  int m_DummySlot; // r0
  int i; // r6
  char *v8; // r4
  __int16 m_nLength; // r5
  CAESound *v10; // r0
  CAESound **v11; // r4
  CAESound *v12; // t1
  Int16 m_ACPlayPositionThisFrame; // r0
  int v14; // r0
  int m_DummyEngineBank; // r0
  unsigned int v16; // r1
  cTransmission *pTransmission; // r0
  float v18; // s16
  float v19; // s2
  CAESound *SoundPtr; // r0
  float PiecewiseLinear; // r0
  float v22; // r0

  m_DummySlot = (unsigned __int16)this->m_DummySlot;
  if ( m_DummySlot != 0xFFFF
    || (LOWORD(m_DummySlot) = CAEVehicleAudioEntity::RequestBankSlot(this->m_DummyEngineBank),
        this->m_DummySlot = m_DummySlot,
        (unsigned __int16)m_DummySlot != 0xFFFF) )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, this->m_DummyEngineBank, m_DummySlot) )
    {
      if ( (*(_BYTE *)&vp->pVehicle->m_nVehicleFlags & 0x10) != 0 && !this->m_bWreckedVehicle )
      {
        pTransmission = vp->pTransmission;
        v18 = 0.0;
        if ( pTransmission )
        {
          v18 = 1.0;
          v19 = fabsf(vp->fSpeed / pTransmission->m_fMaxVelocity);
          if ( v19 <= 1.0 )
            v18 = v19;
        }
        if ( (*(_BYTE *)&this->m_pGameEntity->m_info & 0xF8) == 32 )
          v18 = 0.0;
        if ( v18 >= 0.05 )
        {
          PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v18, 4, fGolfcartDummyVolume);
          v22 = CAEAudioUtility::AudioLog10(PiecewiseLinear);
          CAEVehicleAudioEntity::UpdateGenericVehicleSound(
            this,
            1,
            this->m_DummySlot,
            this->m_DummyEngineBank,
            0,
            (float)(v18 * 0.35) + 0.85,
            (float)(v22 * 20.0) + -3.0,
            2.0);
        }
        else
        {
          SoundPtr = this->m_EngineSounds[1].SoundPtr;
          if ( SoundPtr )
          {
            CAESound::SetIndividualEnvironment(SoundPtr, 4u, 0);
            CAESound::StopSound(this->m_EngineSounds[1].SoundPtr);
            this->m_EngineSounds[1].SoundPtr = 0;
          }
        }
      }
      else
      {
        v3.n64_u32[0] = 1.0;
        for ( i = 0; i != 12; ++i )
        {
          while ( 1 )
          {
            v8 = (char *)this + 8 * i;
            m_nLength = -1;
            v12 = (CAESound *)*((_DWORD *)v8 + 58);
            v11 = (CAESound **)(v8 + 232);
            v10 = v12;
            if ( v12 )
            {
              m_nLength = v10->m_nLength;
              CAESound::SetIndividualEnvironment(v10, 4u, 0);
              CAESound::StopSound(*v11);
              *v11 = 0;
            }
            if ( i != 4 )
              break;
            m_ACPlayPositionThisFrame = this->m_ACPlayPositionThisFrame;
            this->m_ACPlayPositionWhenStopped = m_ACPlayPositionThisFrame;
            this->m_TimeACStopped = CTimer::m_snTimeInMilliseconds;
            this->m_ACPlayPositionLastFrame = -1;
            this->m_ACPlayPositionThisFrame = -1;
            if ( m_nLength < 1 )
            {
              LOWORD(v14) = 0;
            }
            else
            {
              v2.n64_f32[0] = (float)m_ACPlayPositionThisFrame / (float)m_nLength;
              v2.n64_u64[0] = vmin_f32(v2, v3).n64_u64[0];
              v14 = (int)(float)(v2.n64_f32[0] * 100.0);
              if ( v2.n64_f32[0] < 0.0 )
                LOWORD(v14) = 0;
            }
            this->m_ACPlayPercentWhenStopped = v14;
            i = 5;
          }
        }
      }
    }
    else
    {
      m_DummyEngineBank = (unsigned __int16)this->m_DummyEngineBank;
      v16 = ((unsigned __int16)this->m_DummySlot << 16) - 458752;
      if ( v16 > 0x90000
        || *(unsigned __int16 *)((char *)&CAEVehicleAudioEntity::s_DummyEngineSlots[0].BankId + (v16 >> 14)) != m_DummyEngineBank )
      {
        this->m_DummySlot = CAEVehicleAudioEntity::RequestBankSlot(m_DummyEngineBank);
        this->m_State = 0;
      }
    }
  }
}
// 3B91A6: variable 'v2' is possibly undefined
// 3B91A6: variable 'v3' is possibly undefined

//----- (003B9310) --------------------------------------------------------
void __fastcall CAEVehicleAudioEntity::UpdateGenericVehicleSound(
        CAEVehicleAudioEntity *this,
        int SoundType,
        Int16 SlotID,
        Int16 BankID,
        Int16 SoundID,
        float fFrequency,
        float fVolume,
        float fRollOff)
{
  char *v9; // r6
  float v11; // s18
  int v12; // r0
  char *v13; // r6
  int v14; // t1
  CEntity *m_pGameEntity; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r3

  v9 = (char *)this + 8 * SoundType;
  v11 = this->m_fEventVolume + fVolume;
  v14 = *((_DWORD *)v9 + 58);
  v13 = v9 + 232;
  v12 = v14;
  if ( v14 )
  {
    *(float *)(v12 + 20) = v11;
    *(float *)(*(_DWORD *)v13 + 28) = fFrequency;
  }
  else if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, BankID, SlotID) )
  {
    m_pGameEntity = this->m_pGameEntity;
    m_pMat = m_pGameEntity->m_pMat;
    p_tx = (CVector *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pGameEntity->m_transform.m_translate;
    CAESound::Initialise(&this->ScratchSound, SlotID, SoundID, this, *p_tx, v11, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
    this->ScratchSound.m_EmittedVolume = v11;
    this->ScratchSound.m_RollOffFactor = fRollOff;
    this->ScratchSound.m_RelativeFrequency = fFrequency;
    this->ScratchSound.m_Environment = 4;
    *(_DWORD *)v13 = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
  }
}

//----- (003B93E0) --------------------------------------------------------
void __fastcall CAEWaterCannonAudioEntity::Initialise(CAEWaterCannonAudioEntity *this, CWaterCannon *pWaterCannon)
{
  CVector *p_m_vSplashPosition; // r0

  this->m_pGameEntity = (CEntity *)pWaterCannon;
  *(_WORD *)&this->m_bInitialised = 1;
  p_m_vSplashPosition = &this->m_vSplashPosition;
  *(_QWORD *)&p_m_vSplashPosition->x = 0LL;
  *(_QWORD *)&p_m_vSplashPosition->z = 0LL;
}

//----- (003B93F4) --------------------------------------------------------
void __fastcall CAEWaterCannonAudioEntity::ClearSplashInfo(CAEWaterCannonAudioEntity *this)
{
  CVector *p_m_vSplashPosition; // r0

  this->m_bCurrentlySplashing = 0;
  p_m_vSplashPosition = &this->m_vSplashPosition;
  *(_QWORD *)&p_m_vSplashPosition->x = 0LL;
  *(_QWORD *)&p_m_vSplashPosition->z = 0LL;
}

//----- (003B9406) --------------------------------------------------------
void __fastcall CAEWaterCannonAudioEntity::Terminate(CAEWaterCannonAudioEntity *this)
{
  CAESound *SoundPtr; // r0
  CAESound *v3; // r0
  CAESound *v4; // r0
  CAESound *v5; // r0

  SoundPtr = this->m_WaterCannonSounds[0].SoundPtr;
  if ( SoundPtr )
    CAESound::StopSound(SoundPtr);
  v3 = this->m_WaterCannonSounds[1].SoundPtr;
  if ( v3 )
    CAESound::StopSound(v3);
  v4 = this->m_WaterCannonSounds[2].SoundPtr;
  if ( v4 )
    CAESound::StopSound(v4);
  v5 = this->m_WaterCannonSounds[3].SoundPtr;
  if ( v5 )
    sub_18EA18(v5);
}

//----- (003B9444) --------------------------------------------------------
void __fastcall CAEWaterCannonAudioEntity::UpdateGenericWaterCannonSound(
        CAEWaterCannonAudioEntity *this,
        int bPlaying,
        int SoundType,
        Int16 SlotID,
        Int16 SoundID,
        float fFrequency,
        float fVolume,
        CVector vPosition,
        float fRollOff)
{
  int (***v10)(void); // r6
  CAESound *v11; // r0
  CAESound **v12; // r6
  CAESound *v13; // t1
  CVector v14; // 0:r1.12

  v10 = &this->_vptr$CAEAudioEntity + SoundType;
  v13 = (CAESound *)v10[36];
  v12 = (CAESound **)(v10 + 36);
  v11 = v13;
  if ( bPlaying )
  {
    v14.x = vPosition.x;
    v14.y = vPosition.y;
    if ( v11 )
    {
      v11->m_EmittedVolume = fVolume;
      v14.z = vPosition.z;
      (*v12)->m_RelativeFrequency = fFrequency;
      j_CAESound::SetPosition(*v12, v14);
    }
    else
    {
      CAESound::Initialise(&this->ScratchSound, SlotID, SoundID, this, vPosition, fVolume, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      this->ScratchSound.m_EmittedVolume = fVolume;
      this->ScratchSound.m_RollOffFactor = fRollOff;
      this->ScratchSound.m_RelativeFrequency = fFrequency;
      this->ScratchSound.m_Environment = 4;
      *v12 = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
    }
  }
  else if ( v11 )
  {
    sub_18EA18(v11);
  }
}

//----- (003B950E) --------------------------------------------------------
void __fastcall CAEWaterCannonAudioEntity::UpdateParameters(
        CAEWaterCannonAudioEntity *this,
        CAESound *pSound,
        Int16 PlayTime)
{
  if ( PlayTime == -1 )
  {
    if ( this->m_WaterCannonSounds[0].SoundPtr == pSound )
      this->m_WaterCannonSounds[0].SoundPtr = 0;
    if ( this->m_WaterCannonSounds[1].SoundPtr == pSound )
      this->m_WaterCannonSounds[1].SoundPtr = 0;
    if ( this->m_WaterCannonSounds[2].SoundPtr == pSound )
      this->m_WaterCannonSounds[2].SoundPtr = 0;
    if ( this->m_WaterCannonSounds[3].SoundPtr == pSound )
      this->m_WaterCannonSounds[3].SoundPtr = 0;
  }
}

//----- (003B9550) --------------------------------------------------------
void __fastcall CAEWaterCannonAudioEntity::Service(CAEWaterCannonAudioEntity *this)
{
  CEntity *m_pGameEntity; // r6
  int x_low; // r1
  _BOOL4 v4; // r10
  CAESound *SoundPtr; // r0
  CAESound *v6; // r0
  CAESound *v7; // r0
  CAESound *v8; // r0
  CVector v9; // 0:r1.12
  CVector v10; // 0:r1.12
  CVector m_vSplashPosition; // 0:r1.12
  CVector v12; // 0:r1.12

  if ( this->m_bInitialised )
  {
    m_pGameEntity = this->m_pGameEntity;
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
    {
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
      {
        x_low = SLOWORD(m_pGameEntity->m_transform.m_translate.x);
        if ( *((_BYTE *)&m_pGameEntity[13]._vptr$CPlaceable + x_low) )
          v4 = m_pGameEntity->_vptr$CPlaceable == 0;
        else
          v4 = 1;
        SoundPtr = this->m_WaterCannonSounds[0].SoundPtr;
        if ( v4 )
        {
          if ( SoundPtr )
            CAESound::StopSound(SoundPtr);
        }
        else
        {
          v9 = *(CVector *)((_BYTE *)&m_pGameEntity->m_transform.m_translate.z + x_low);
          if ( SoundPtr )
          {
            SoundPtr->m_EmittedVolume = 6.0;
            this->m_WaterCannonSounds[0].SoundPtr->m_RelativeFrequency = 1.78;
            CAESound::SetPosition(this->m_WaterCannonSounds[0].SoundPtr, v9);
          }
          else
          {
            CAESound::Initialise(&this->ScratchSound, 0, 0, this, v9, 6.0, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
            this->ScratchSound.m_EmittedVolume = 6.0;
            this->ScratchSound.m_RollOffFactor = 2.0;
            this->ScratchSound.m_RelativeFrequency = 1.78;
            this->ScratchSound.m_Environment = 4;
            this->m_WaterCannonSounds[0].SoundPtr = CAESoundManager::RequestNewSound(
                                                      &AESoundManager,
                                                      &this->ScratchSound);
          }
        }
        v6 = this->m_WaterCannonSounds[1].SoundPtr;
        if ( v4 )
        {
          if ( v6 )
            CAESound::StopSound(v6);
        }
        else
        {
          v10 = *(CVector *)((_BYTE *)&m_pGameEntity->m_transform.m_translate.z
                           + SLOWORD(m_pGameEntity->m_transform.m_translate.x));
          if ( v6 )
          {
            v6->m_EmittedVolume = -9.0;
            this->m_WaterCannonSounds[1].SoundPtr->m_RelativeFrequency = 0.5;
            CAESound::SetPosition(this->m_WaterCannonSounds[1].SoundPtr, v10);
          }
          else
          {
            CAESound::Initialise(
              &this->ScratchSound,
              2,
              3,
              this,
              *(CVector *)(&m_pGameEntity->m_transform.m_translate.z
                         + 3 * SLOWORD(m_pGameEntity->m_transform.m_translate.x)),
              -9.0,
              1.0,
              1.0,
              1.0,
              0,
              0,
              0.0,
              0);
            this->ScratchSound.m_EmittedVolume = -9.0;
            this->ScratchSound.m_RollOffFactor = 2.0;
            this->ScratchSound.m_RelativeFrequency = 0.5;
            this->ScratchSound.m_Environment = 4;
            this->m_WaterCannonSounds[1].SoundPtr = CAESoundManager::RequestNewSound(
                                                      &AESoundManager,
                                                      &this->ScratchSound);
          }
        }
        v7 = this->m_WaterCannonSounds[2].SoundPtr;
        if ( this->m_bCurrentlySplashing )
        {
          m_vSplashPosition = this->m_vSplashPosition;
          if ( v7 )
          {
            v7->m_EmittedVolume = -3.0;
            this->m_WaterCannonSounds[2].SoundPtr->m_RelativeFrequency = 1.0;
            CAESound::SetPosition(this->m_WaterCannonSounds[2].SoundPtr, m_vSplashPosition);
          }
          else
          {
            CAESound::Initialise(
              &this->ScratchSound,
              2,
              3,
              this,
              this->m_vSplashPosition,
              -3.0,
              1.0,
              1.0,
              1.0,
              0,
              0,
              0.0,
              0);
            this->ScratchSound.m_EmittedVolume = -3.0;
            this->ScratchSound.m_RollOffFactor = 2.0;
            this->ScratchSound.m_RelativeFrequency = 1.0;
            this->ScratchSound.m_Environment = 4;
            this->m_WaterCannonSounds[2].SoundPtr = CAESoundManager::RequestNewSound(
                                                      &AESoundManager,
                                                      &this->ScratchSound);
          }
        }
        else if ( v7 )
        {
          CAESound::StopSound(v7);
        }
        v8 = this->m_WaterCannonSounds[3].SoundPtr;
        if ( this->m_bCurrentlySplashing )
        {
          v12 = this->m_vSplashPosition;
          if ( v8 )
          {
            v8->m_EmittedVolume = -9.0;
            this->m_WaterCannonSounds[3].SoundPtr->m_RelativeFrequency = 0.5;
            j_CAESound::SetPosition(this->m_WaterCannonSounds[3].SoundPtr, v12);
          }
          else
          {
            CAESound::Initialise(
              &this->ScratchSound,
              2,
              3,
              this,
              this->m_vSplashPosition,
              -9.0,
              1.0,
              1.0,
              1.0,
              0,
              0,
              0.0,
              0);
            this->ScratchSound.m_EmittedVolume = -9.0;
            this->ScratchSound.m_RollOffFactor = 2.0;
            this->ScratchSound.m_RelativeFrequency = 0.5;
            this->ScratchSound.m_Environment = 4;
            this->m_WaterCannonSounds[3].SoundPtr = CAESoundManager::RequestNewSound(
                                                      &AESoundManager,
                                                      &this->ScratchSound);
          }
        }
        else if ( v8 )
        {
          sub_18EA18(v8);
        }
      }
    }
  }
}

//----- (003B982C) --------------------------------------------------------
void __fastcall CAEWaterCannonAudioEntity::SetSplashInfo(
        CAEWaterCannonAudioEntity *this,
        CVector vPosition,
        float fStrength)
{
  this->m_bCurrentlySplashing = 1;
  this->m_vSplashPosition = vPosition;
  this->m_fSplashStrength = fStrength;
}

//----- (003B9848) --------------------------------------------------------
void __fastcall CAEWaveDecoder::CAEWaveDecoder(CAEWaveDecoder *this, CAEDataStream *stream)
{
  int v3; // r0

  CAEStreamingDecoder::CAEStreamingDecoder(this, stream);
  *(_BYTE *)(v3 + 8) = 0;
  *(_DWORD *)(v3 + 12) = stream;
  *(_DWORD *)v3 = &off_667914;
}
// 3B9856: variable 'v3' is possibly undefined
// 667914: using guessed type void *;

//----- (003B986C) --------------------------------------------------------
void __fastcall CAEWaveDecoder::~CAEWaveDecoder(CAEWaveDecoder *this)
{
  void *v1; // r0

  CAEStreamingDecoder::~CAEStreamingDecoder(this);
  sub_191374(v1);
}
// 3B9878: variable 'v1' is possibly undefined

//----- (003B987C) --------------------------------------------------------
int __fastcall CAEWaveDecoder::FillBuffer(CAEWaveDecoder *this, void *dest, unsigned int destSize, int *done)
{
  return sub_1A0C54(this->m_pStream, dest, destSize);
}

//----- (003B9882) --------------------------------------------------------
bool __fastcall CAEWaveDecoder::Initialise(CAEWaveDecoder *this)
{
  CAEDataStream *m_pStream; // r0
  int BitsPerSample; // r0
  bool v4; // zf
  int (**v6)(void); // r0

  m_pStream = this->m_pStream;
  this->m_bInitialised = 0;
  if ( CAEDataStream::FillBuffer(m_pStream, &this->m_header, 0x2Cu) != 44 )
    return this->m_bInitialised;
  BitsPerSample = this->m_header.BitsPerSample;
  v4 = BitsPerSample == 16;
  if ( BitsPerSample == 16 )
    v4 = this->m_header.wChnls == 2;
  if ( !v4 )
    return this->m_bInitialised;
  v6 = this->_vptr$CAEStreamingDecoder;
  this->m_bInitialised = 1;
  if ( ((int (__fastcall *)(CAEWaveDecoder *))v6[2])(this) <= 6999 )
    this->m_bInitialised = 0;
  return this->m_bInitialised;
}

//----- (003B98C8) --------------------------------------------------------
int __fastcall CAEWaveDecoder::GetSampleRate(CAEWaveDecoder *this)
{
  if ( this->m_bInitialised )
    return this->m_header.dwSRate;
  else
    return -1;
}

//----- (003B98D8) --------------------------------------------------------
int __fastcall CAEWaveDecoder::GetStreamLengthMs(CAEWaveDecoder *this)
{
  if ( this->m_bInitialised )
    return (int)(float)((float)((float)this->m_header.dwDataSize / (float)(4 * this->m_header.dwSRate)) * 1000.0);
  else
    return -1;
}

//----- (003B9914) --------------------------------------------------------
int __fastcall CAEWaveDecoder::GetStreamPlayTimeMs(CAEWaveDecoder *this)
{
  if ( this->m_bInitialised )
    return (int)(float)((float)((float)(unsigned int)(CAEDataStream::GetCurrentPosition(this->m_pStream) - 44)
                              / (float)(4 * this->m_header.dwSRate))
                      * 1000.0);
  else
    return -1;
}

//----- (003B995C) --------------------------------------------------------
void __fastcall CAEWaveDecoder::SetCursor(CAEWaveDecoder *this, unsigned int ms)
{
  CAEDataStream *m_pStream; // r2
  int v3; // r0

  if ( this->m_bInitialised )
  {
    m_pStream = this->m_pStream;
    v3 = (int)(float)((float)((float)((float)ms / 1000.0) * (float)(4 * this->m_header.dwSRate)) + 44.0);
    sub_19AC98(m_pStream, v3 % 2 + v3, 0);
  }
}

//----- (003B99B4) --------------------------------------------------------
int __fastcall CAEWaveDecoder::GetStreamID(CAEWaveDecoder *this)
{
  return this->m_pStream->m_ID;
}

//----- (003B99BC) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::UpdateParameters(CAEWeaponAudioEntity *this, CAESound *pSound, Int16 PlayTime)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  UInt32 v8; // r0
  float m_EmittedVolume; // s0
  int m_nChainsawState; // r1

  if ( PlayTime < 0 )
  {
    if ( PlayTime == -1 )
    {
      if ( this->m_pFlameThrowerIdleGasLoopSound == pSound )
      {
        this->m_pFlameThrowerIdleGasLoopSound = 0;
      }
      else if ( pSound->m_AudioEvent == 8 && this->m_nMiniGunState == 2 )
      {
        this->m_nMiniGunState = 3;
      }
    }
  }
  else
  {
    v8 = CTimer::m_snTimeInMilliseconds;
    switch ( pSound->m_AudioEvent )
    {
      case 1:
        if ( CGame::currArea )
          pSound->m_EmittedVolume = pSound->m_EmittedVolume + -1.0;
        break;
      case 2:
        if ( this->m_nLastFlameThrowerFireTimeMs + 300 >= CTimer::m_snTimeInMilliseconds )
        {
          v3.n64_f32[0] = (float)CAEAudioEntity::m_pAudioEventVolumes[145] + -14.0;
          v4.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
          if ( v4.n64_f32[0] < v3.n64_f32[0] )
          {
            v4.n64_f32[0] = v4.n64_f32[0] + 2.0;
            LODWORD(pSound->m_EmittedVolume) = vmin_f32(v4, v3).n64_u32[0];
          }
        }
        else
        {
          CAESound::StopSoundAndForget(pSound);
          this->m_nLastFlameThrowerFireTimeMs = 0;
        }
        break;
      case 3:
        if ( this->m_nLastSprayCanFireTimeMs + 300 < CTimer::m_snTimeInMilliseconds )
        {
          CAESound::StopSoundAndForget(pSound);
          this->m_nLastSprayCanFireTimeMs = 0;
        }
        break;
      case 4:
        if ( this->m_nLastFireExtFireTimeMs + 300 >= CTimer::m_snTimeInMilliseconds )
        {
          v3.n64_u32[0] = 1062836634;
          v4.n64_u32[0] = LODWORD(pSound->m_RelativeFrequency);
          if ( v4.n64_f32[0] < 0.85 )
          {
            v4.n64_f32[0] = v4.n64_f32[0] + 0.01;
            LODWORD(pSound->m_RelativeFrequency) = vmin_f32(v4, v3).n64_u32[0];
          }
        }
        else
        {
          CAESound::StopSoundAndForget(pSound);
          this->m_nLastFireExtFireTimeMs = 0;
        }
        break;
      case 5:
        if ( this->m_nLastMiniGunFireTimeMs + 300 < CTimer::m_snTimeInMilliseconds )
          CAEWeaponAudioEntity::PlayMiniGunStopSound(this, (CPhysical *)pSound->m_pPhysicalEntity);
        if ( (unsigned __int8)this->m_nMiniGunState >= 2u )
        {
          CAESound::StopSoundAndForget(pSound);
          this->m_bMiniGunSpinActive = 0;
        }
        break;
      case 6:
        if ( this->m_nLastMiniGunFireTimeMs + 300 < CTimer::m_snTimeInMilliseconds )
          CAEWeaponAudioEntity::PlayMiniGunStopSound(this, (CPhysical *)pSound->m_pPhysicalEntity);
        if ( this->m_nMiniGunState != 1 )
        {
          CAESound::StopSoundAndForget(pSound);
          this->m_bMiniGunFireActive = 0;
        }
        break;
      case 7:
        if ( this->m_nMiniGunState != 1 )
        {
          m_EmittedVolume = pSound->m_EmittedVolume;
          if ( m_EmittedVolume <= -30.0 )
            goto LABEL_52;
          pSound->m_EmittedVolume = m_EmittedVolume + -1.5;
        }
        break;
      case 9:
        if ( this->m_nLastChainsawEventTimeMs + 300 < CTimer::m_snTimeInMilliseconds )
        {
          this->m_nChainsawState = 4;
          goto LABEL_52;
        }
        if ( this->m_nChainsawState )
          goto LABEL_52;
        break;
      case 0xA:
        m_nChainsawState = (unsigned __int8)this->m_nChainsawState;
        if ( m_nChainsawState == 1 )
        {
          v3.n64_u32[0] = 1.0;
          v4.n64_u32[0] = LODWORD(pSound->m_RelativeFrequency);
          if ( v4.n64_f32[0] < 1.0 )
          {
            v4.n64_f32[0] = v4.n64_f32[0] + 0.03;
            LODWORD(pSound->m_RelativeFrequency) = vmin_f32(v4, v3).n64_u32[0];
          }
          if ( this->m_nLastChainsawEventTimeMs + 300 < v8 )
            CAEWeaponAudioEntity::PlayChainsawStopSound(this, (CPhysical *)pSound->m_pPhysicalEntity);
        }
        else if ( m_nChainsawState == 2 )
        {
          if ( this->m_nLastChainsawEventTimeMs + 400 >= CTimer::m_snTimeInMilliseconds )
          {
            v3.n64_u32[0] = 1062836634;
            v4.n64_u32[0] = LODWORD(pSound->m_RelativeFrequency);
            if ( v4.n64_f32[0] > 0.85 )
            {
              v4.n64_f32[0] = v4.n64_f32[0] + -0.15;
              LODWORD(pSound->m_RelativeFrequency) = vmax_f32(v4, v3).n64_u32[0];
            }
          }
          else
          {
            this->m_nLastChainsawEventTimeMs = CTimer::m_snTimeInMilliseconds;
            this->m_nChainsawState = 1;
          }
        }
        else
        {
LABEL_52:
          sub_1953E8(pSound);
        }
        break;
      case 0xC:
        if ( PlayTime > 1000 && this->m_nChainsawState == 3 )
          this->m_nChainsawState = 0;
        break;
      case 0xD:
        if ( (int)pSound->m_ClientVariable + 820 < (int)CTimer::m_snTimeInMilliseconds )
          pSound->m_RelativeFrequency = 0.84;
        break;
      case 0xE:
        if ( (int)pSound->m_ClientVariable + 2200 < (int)CTimer::m_snTimeInMilliseconds )
          pSound->m_RelativeFrequency = 1.0;
        break;
      default:
        v3.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
        if ( v3.n64_f32[0] > 0.0 )
        {
          v5.n64_u32[0] = 0;
          v3.n64_f32[0] = v3.n64_f32[0] + -2.5;
          LODWORD(pSound->m_EmittedVolume) = vmax_f32(v3, v5).n64_u32[0];
        }
        break;
    }
  }
}
// 3B9B80: variable 'v3' is possibly undefined
// 3B9B80: variable 'v5' is possibly undefined
// 3B9BFC: variable 'v4' is possibly undefined

//----- (003B9CC0) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayMiniGunStopSound(CAEWeaponAudioEntity *this, CPhysical *pParentPhysical)
{
  float v4; // s2
  int *v5; // r1
  int v6; // s4
  Int8 v7; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1

  if ( !pParentPhysical )
  {
    v7 = 3;
LABEL_16:
    this->m_nMiniGunState = v7;
    return;
  }
  if ( this->m_nMiniGunState == 2 )
  {
LABEL_15:
    v7 = 2;
    goto LABEL_16;
  }
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    v4 = 1.0;
    if ( (*(_BYTE *)&pParentPhysical->m_info & 7) == 2 )
    {
      v5 = dword_3B9DD4;
      if ( pParentPhysical[4].m_listEntryInfo.m_pHead == (CEntryInfoNode *)byte_4 )
      {
        v4 = 0.7937;
        v5 = &dword_3B9DD4[1];
      }
      v6 = *v5;
    }
    else
    {
      v6 = 1059648963;
    }
    m_pMat = pParentPhysical->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pParentPhysical->m_transform;
    CAESound::Initialise(
      &this->ScratchSound,
      5,
      63,
      this,
      p_tx->m_translate,
      (float)CAEAudioEntity::m_pAudioEventVolumes[157],
      *(float *)&v6,
      v4,
      1.0,
      0,
      0x84u,
      0.0,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
    this->ScratchSound.m_AudioEvent = 8;
    CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
    goto LABEL_15;
  }
  if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
    sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
}
// 3B9DD4: using guessed type int dword_3B9DD4[2];

//----- (003B9DE8) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayChainsawStopSound(CAEWeaponAudioEntity *this, CPhysical *pParentPhysical)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  Int8 v6; // r0

  if ( pParentPhysical && CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x24u, 40) )
  {
    if ( this->m_nChainsawState != 3 )
    {
      m_pMat = pParentPhysical->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pParentPhysical->m_transform;
      CAESound::Initialise(
        &this->ScratchSound,
        40,
        2,
        this,
        p_tx->m_translate,
        (float)CAEAudioEntity::m_pAudioEventVolumes[154],
        0.66,
        1.0,
        1.0,
        0,
        0x84u,
        0.0,
        0);
      CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
      this->ScratchSound.m_AudioEvent = 12;
      CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
    }
    v6 = 3;
  }
  else
  {
    v6 = 4;
  }
  this->m_nChainsawState = v6;
}

//----- (003B9EB0) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::Initialise(CAEWeaponAudioEntity *this)
{
  *(_WORD *)&this->m_nMiniGunState = 1027;
  if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
    sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
}

//----- (003B9EE8) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::Terminate(CAEWeaponAudioEntity *this)
{
  sub_1946EC(&AESoundManager, this, 1u);
}

//----- (003B9EFC) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::Reset(CAEWeaponAudioEntity *this)
{
  CAESoundManager::CancelSoundsOwnedByAudioEntity(&AESoundManager, this, 1u);
  *(_QWORD *)&this->m_nLastMiniGunFireTimeMs = 0LL;
  *(_QWORD *)&this->m_nLastGunFireTimeMs = 0LL;
  *(_QWORD *)&this->m_nLastFlameThrowerFireTimeMs = 0LL;
  *(_QWORD *)&this->m_nLastFireExtFireTimeMs = 0LL;
  this->m_bMiniGunSpinActive = 0;
  *(_WORD *)&this->m_bMiniGunFireActive = 0;
}

//----- (003B9F34) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::WeaponFire(
        CAEWeaponAudioEntity *this,
        eWeaponType WeaponType,
        CPhysical *pParentPhysical,
        tAudioEvent AudioEvent)
{
  CAEWeaponAudioEntity *v4; // r5
  CPhysical *v5; // r1
  Int16 v6; // r2
  int v7; // lr
  __int16 v8; // r4
  __int16 v9; // r0
  __int16 v10; // r1
  Int16 v11; // r3
  Int16 v12; // [sp+0h] [bp-30h]
  Int16 v13; // [sp+4h] [bp-2Ch]
  Int16 fFrequencyScalingFactor; // [sp+8h] [bp-28h]
  tAudioEvent v15; // [sp+Ch] [bp-24h]
  int fPrimaryFrequencyScalingFactor; // [sp+14h] [bp-1Ch]
  int v17; // [sp+18h] [bp-18h]

  v4 = this;
  if ( pParentPhysical )
  {
    switch ( WeaponType )
    {
      case WEAPONTYPE_PISTOL:
        v7 = 1068827861;
        v12 = 6;
        v13 = 7;
        fFrequencyScalingFactor = 8;
        v15 = AudioEvent;
        goto LABEL_18;
      case WEAPONTYPE_PISTOL_SILENCED:
        CAEWeaponAudioEntity::PlayGunSounds(this, pParentPhysical, 76, 77, 24, 24, -1, AudioEvent, -7.0, 1.0, 1.0);
        return;
      case WEAPONTYPE_DESERT_EAGLE:
        v7 = 1064411511;
        v8 = 8;
        v9 = 7;
        v10 = 6;
        goto LABEL_17;
      case WEAPONTYPE_SHOTGUN:
      case WEAPONTYPE_SPAS12_SHOTGUN:
        v12 = 21;
        v13 = 22;
        fFrequencyScalingFactor = 23;
        v15 = AudioEvent;
        fPrimaryFrequencyScalingFactor = 1065353216;
        v17 = 1065353216;
        goto LABEL_10;
      case WEAPONTYPE_SAWNOFF_SHOTGUN:
        v12 = 21;
        v13 = 22;
        fFrequencyScalingFactor = 23;
        v15 = AudioEvent;
        fPrimaryFrequencyScalingFactor = 1061892076;
        v17 = 1064178811;
LABEL_10:
        v5 = pParentPhysical;
        v6 = 73;
        v11 = 74;
        goto LABEL_22;
      case WEAPONTYPE_MICRO_UZI:
        v12 = 0;
        v13 = 1;
        fFrequencyScalingFactor = 2;
        v15 = AudioEvent;
        goto LABEL_13;
      case WEAPONTYPE_MP5:
        v12 = 17;
        v13 = 18;
        fFrequencyScalingFactor = 2;
        v15 = AudioEvent;
LABEL_13:
        fPrimaryFrequencyScalingFactor = 1065353216;
        v17 = 1065353216;
        goto LABEL_15;
      case WEAPONTYPE_AK47:
      case WEAPONTYPE_M4:
        v12 = 3;
        v13 = 4;
        fFrequencyScalingFactor = 5;
        v5 = pParentPhysical;
        v6 = 33;
        v15 = AudioEvent;
        fPrimaryFrequencyScalingFactor = 1065353216;
        v17 = 1065353216;
        goto LABEL_21;
      case WEAPONTYPE_TEC9:
        v12 = 0;
        v13 = 1;
        fFrequencyScalingFactor = 2;
        v15 = AudioEvent;
        fPrimaryFrequencyScalingFactor = 1067533583;
        v17 = 1065353216;
LABEL_15:
        v5 = pParentPhysical;
        v6 = 29;
        v11 = 30;
        goto LABEL_22;
      case WEAPONTYPE_COUNTRYRIFLE:
        v7 = 1063507722;
        v8 = 23;
        v9 = 27;
        v10 = 26;
LABEL_17:
        v12 = v10;
        v13 = v9;
        fFrequencyScalingFactor = v8;
        v15 = AudioEvent;
LABEL_18:
        fPrimaryFrequencyScalingFactor = v7;
        v17 = 1065353216;
        goto LABEL_20;
      case WEAPONTYPE_SNIPERRIFLE:
        v12 = 26;
        v13 = 27;
        fFrequencyScalingFactor = 23;
        v15 = AudioEvent;
        fPrimaryFrequencyScalingFactor = 1065353216;
        v17 = 1065353216;
LABEL_20:
        v5 = pParentPhysical;
        this = v4;
        v6 = 52;
LABEL_21:
        v11 = 53;
LABEL_22:
        CAEWeaponAudioEntity::PlayGunSounds(
          this,
          v5,
          v6,
          v11,
          v12,
          v13,
          fFrequencyScalingFactor,
          v15,
          0.0,
          *(float *)&fPrimaryFrequencyScalingFactor,
          *(float *)&v17);
        break;
      case WEAPONTYPE_FLAMETHROWER:
        if ( !this->m_nLastFlameThrowerFireTimeMs )
          CAEWeaponAudioEntity::PlayFlameThrowerSounds(this, pParentPhysical, 83, 26, AudioEvent, -14.0, 1.0);
        v4->m_nLastFlameThrowerFireTimeMs = CTimer::m_snTimeInMilliseconds;
        break;
      case WEAPONTYPE_MINIGUN:
        CAEWeaponAudioEntity::PlayMiniGunFireSounds(this, pParentPhysical, AudioEvent);
        break;
      case WEAPONTYPE_DETONATOR:
        CAEWeaponAudioEntity::PlayGunSounds(this, pParentPhysical, 49, -1, -1, -1, -1, AudioEvent, -14.0, 1.0, 1.0);
        break;
      case WEAPONTYPE_SPRAYCAN:
        if ( !this->m_nLastSprayCanFireTimeMs )
          CAEWeaponAudioEntity::PlayWeaponLoopSound(this, pParentPhysical, 28, AudioEvent, -20.0, 1.0, 3);
        v4->m_nLastSprayCanFireTimeMs = CTimer::m_snTimeInMilliseconds;
        break;
      case WEAPONTYPE_EXTINGUISHER:
        if ( !this->m_nLastFireExtFireTimeMs )
          CAEWeaponAudioEntity::PlayWeaponLoopSound(this, pParentPhysical, 9, AudioEvent, -20.0, 0.7937, 4);
        v4->m_nLastFireExtFireTimeMs = CTimer::m_snTimeInMilliseconds;
        break;
      case WEAPONTYPE_CAMERA:
        CAEWeaponAudioEntity::PlayCameraSound(this, pParentPhysical, AudioEvent, -14.0);
        break;
      case WEAPONTYPE_NIGHTVISION:
      case WEAPONTYPE_INFRARED:
        CAEWeaponAudioEntity::PlayGoggleSound(this, 64, AudioEvent);
        break;
      default:
        return;
    }
  }
}

//----- (003BA20C) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayGunSounds(
        CAEWeaponAudioEntity *this,
        CPhysical *pParentPhysical,
        Int16 DryFireID,
        Int16 SubID,
        Int16 MainLeftID,
        Int16 MainRightID,
        Int16 TailID,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fPrimaryFrequencyScalingFactor,
        float fTailFrequencyScalingFactor)
{
  float32x2_t v11; // d0
  float32x2_t v12; // d1
  float v17; // s20
  float v18; // s2
  float v19; // s16
  int v20; // r1
  float v21; // s18
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r2
  bool v24; // zf
  CMatrix *v25; // r0
  CSimpleTransform *p_m_transform; // r2
  bool v27; // zf
  float v28; // s24
  float v29; // s22
  float v30; // s20
  bool v31; // zf
  bool v32; // zf
  CMatrix *v33; // r0
  CSimpleTransform *v34; // r2
  bool v35; // zf
  unsigned __int16 v36; // r4
  CMatrix *v37; // r0
  CSimpleTransform *v38; // r2
  bool v39; // zf
  bool v40; // zf
  float v41; // s20
  int v42; // r8
  float v43; // s16
  float DistanceAttenuation; // s6
  float v45; // s4
  float v46; // s18
  tAudioEvent v47; // r9
  float v48; // s6
  float v49; // s26
  float v50; // s0
  float v51; // s24
  CVector Positiona; // [sp+0h] [bp-88h]
  CVector Positionb; // [sp+0h] [bp-88h]
  CVector Positionc; // [sp+0h] [bp-88h]
  CVector Position; // [sp+0h] [bp-88h]
  CVector pRelativePosition; // [sp+2Ch] [bp-5Ch] BYREF

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    if ( CTimer::m_snTimeInMilliseconds >= this->m_nLastGunFireTimeMs + 25 )
    {
      this->m_nLastGunFireTimeMs = CTimer::m_snTimeInMilliseconds;
      v17 = fPrimaryFrequencyScalingFactor;
      v18 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
      if ( AudioEvent == 149 )
      {
        v19 = 1.6;
        v20 = (this->m_nLastWeaponPlaneFrequencyIndex + 1) % 2;
        this->m_nLastWeaponPlaneFrequencyIndex = v20;
        v17 = (float)(gfWeaponPlaneFrequencyVariations[v20] * 0.7937) * fPrimaryFrequencyScalingFactor;
      }
      else
      {
        v19 = 1.0;
        if ( AudioEvent == 152 )
        {
          v17 = fPrimaryFrequencyScalingFactor * 0.7937;
          v19 = 1.8;
        }
      }
      v21 = v18 + fVolumeOffsetdB;
      if ( (unsigned __int16)DryFireID != 0xFFFF )
      {
        m_pMat = pParentPhysical->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pParentPhysical->m_transform;
        CAESound::Initialise(
          &this->ScratchSound,
          5,
          DryFireID,
          this,
          p_tx->m_translate,
          v18 + fVolumeOffsetdB,
          v19 * 0.66,
          v17,
          1.0,
          0,
          0x84u,
          0.0,
          0);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
        v24 = AudioEvent == 152;
        if ( AudioEvent != 152 )
          v24 = AudioEvent == 150;
        if ( v24 )
          this->ScratchSound.m_AudioEvent = 6;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      }
      if ( (unsigned __int16)SubID != 0xFFFF )
      {
        v25 = pParentPhysical->m_pMat;
        p_m_transform = (CSimpleTransform *)&v25->tx;
        if ( !v25 )
          p_m_transform = &pParentPhysical->m_transform;
        CAESound::Initialise(
          &this->ScratchSound,
          5,
          SubID,
          this,
          p_m_transform->m_translate,
          v18 + fVolumeOffsetdB,
          v19 * 0.9,
          v17,
          1.0,
          0,
          0x84u,
          0.0,
          0);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
        v27 = AudioEvent == 152;
        if ( AudioEvent != 152 )
          v27 = AudioEvent == 150;
        if ( v27 )
          this->ScratchSound.m_AudioEvent = 6;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      }
      v28 = -100.0;
      if ( AudioEvent == 149 || AudioEvent == 152 )
      {
        v29 = v18 + fVolumeOffsetdB;
      }
      else
      {
        CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, pParentPhysical);
        v48 = sqrtf(
                (float)((float)(pRelativePosition.x * pRelativePosition.x)
                      + (float)(pRelativePosition.y * pRelativePosition.y))
              + (float)(pRelativePosition.z * pRelativePosition.z));
        v49 = v48 / (float)(v19 * 1.25);
        if ( v49 <= (float)(5.0 / v19) )
        {
          v29 = v21 + -3.0;
          v28 = (float)(v21 + -3.0) + CAEAudioEnvironment::GetDistanceAttenuation(v48 / (float)(v19 * 1.25));
        }
        else
        {
          v29 = v18 + fVolumeOffsetdB;
          if ( v49 < (float)(12.0 / v19) )
          {
            v50 = (float)((float)(12.0 / v19) - v49) / (float)((float)(12.0 / v19) - (float)(5.0 / v19));
            v51 = log10f(v50 * 0.7071) * 20.0;
            v28 = CAEAudioEnvironment::GetDistanceAttenuation(v49) + (float)(v21 + v51);
            v29 = v21 + (float)(log10f((float)((float)(1.0 - v50) * 0.2929) + 0.7071) * 20.0);
          }
        }
      }
      v30 = v17 * (float)(CAEAudioUtility::GetRandomNumberInRange(-0.02, 0.02) + 1.0);
      if ( (unsigned __int16)MainLeftID != 0xFFFF )
      {
        Positiona.x = -1.0;
        *(_QWORD *)&Positiona.y = 0LL;
        CAESound::Initialise(
          &this->ScratchSound,
          5,
          MainLeftID,
          this,
          Positiona,
          v28,
          v19 * 1.25,
          v30,
          1.0,
          0,
          0x1005u,
          0.0,
          0);
        v31 = AudioEvent == 152;
        if ( AudioEvent != 152 )
          v31 = AudioEvent == 150;
        if ( v31 )
          this->ScratchSound.m_AudioEvent = 6;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      }
      if ( (unsigned __int16)MainRightID != 0xFFFF )
      {
        Positionb.x = 1.0;
        *(_QWORD *)&Positionb.y = 0LL;
        CAESound::Initialise(
          &this->ScratchSound,
          5,
          MainRightID,
          this,
          Positionb,
          v28,
          v19 * 1.25,
          v30,
          1.0,
          0,
          0x1005u,
          0.0,
          0);
        v32 = AudioEvent == 152;
        if ( AudioEvent != 152 )
          v32 = AudioEvent == 150;
        if ( v32 )
          this->ScratchSound.m_AudioEvent = 6;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      }
      if ( (unsigned __int16)MainLeftID != 0xFFFF )
      {
        v33 = pParentPhysical->m_pMat;
        v34 = (CSimpleTransform *)&v33->tx;
        if ( !v33 )
          v34 = &pParentPhysical->m_transform;
        CAESound::Initialise(
          &this->ScratchSound,
          5,
          MainLeftID,
          this,
          v34->m_translate,
          v29,
          v19 * 1.25,
          v30,
          1.0,
          0,
          0x84u,
          0.0,
          0);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
        v35 = AudioEvent == 152;
        if ( AudioEvent != 152 )
          v35 = AudioEvent == 150;
        if ( v35 )
          this->ScratchSound.m_AudioEvent = 6;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
      }
      v36 = TailID;
      if ( (unsigned __int16)MainRightID != 0xFFFF )
      {
        v37 = pParentPhysical->m_pMat;
        v38 = (CSimpleTransform *)&v37->tx;
        if ( !v37 )
          v38 = &pParentPhysical->m_transform;
        CAESound::Initialise(
          &this->ScratchSound,
          5,
          MainRightID,
          this,
          v38->m_translate,
          v29,
          v19 * 1.25,
          v30,
          1.0,
          0,
          0x84u,
          0.0,
          0);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
        v39 = AudioEvent == 152;
        if ( AudioEvent != 152 )
          v39 = AudioEvent == 150;
        if ( v39 )
          this->ScratchSound.m_AudioEvent = 6;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
        v36 = TailID;
      }
      if ( v36 != 0xFFFF )
      {
        v40 = AudioEvent == 149;
        if ( AudioEvent != 149 )
          v40 = AudioEvent == 152;
        if ( !v40 )
        {
          v41 = fTailFrequencyScalingFactor;
          v42 = CAEAudioUtility::ResolveProbability(0.5);
          CAEAudioEnvironment::GetPositionRelativeToCamera(&pRelativePosition, pParentPhysical);
          v43 = v19 * 3.5;
          DistanceAttenuation = CAEAudioEnvironment::GetDistanceAttenuation(
                                  sqrtf(
                                    (float)((float)(pRelativePosition.x * pRelativePosition.x)
                                          + (float)(pRelativePosition.y * pRelativePosition.y))
                                  + (float)(pRelativePosition.z * pRelativePosition.z))
                                / v43);
          v11.n64_u32[0] = 0;
          v45 = fTailFrequencyScalingFactor * 1.1892;
          if ( !v42 )
            v45 = fTailFrequencyScalingFactor;
          v12.n64_f32[0] = (float)(v21 + -20.0) + DistanceAttenuation;
          Positionc.x = -1.0;
          *(_QWORD *)&Positionc.y = 0LL;
          LODWORD(v46) = vmin_f32(v12, v11).n64_u32[0];
          CAESound::Initialise(&this->ScratchSound, 5, v36, this, Positionc, v46, v43, v45, 1.0, 0, 0x1405u, 0.0, 0);
          v47 = 1;
          if ( AudioEvent == 150 )
            v47 = 7;
          this->ScratchSound.m_AudioEvent = v47;
          CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
          *(_QWORD *)&Position.y = 0LL;
          if ( !v42 )
            v41 = fTailFrequencyScalingFactor * 1.1892;
          Position.x = 1.0;
          CAESound::Initialise(&this->ScratchSound, 5, v36, this, Position, v46, v43, v41, 1.0, 0, 0x1405u, 0.0, 0);
          this->ScratchSound.m_AudioEvent = v47;
          CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
        }
      }
    }
  }
  else if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
  {
    CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x8Fu, 5);
  }
}
// 3BA6DA: variable 'v12' is possibly undefined
// 3BA6DA: variable 'v11' is possibly undefined

//----- (003BA88C) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayFlameThrowerSounds(
        CAEWeaponAudioEntity *this,
        CPhysical *pParentPhysical,
        int DryFireID,
        Int16 FlameID,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fFrequencyScalingFactor)
{
  float v11; // s18
  CMatrix *m_pMat; // r0
  float v13; // r12
  CSimpleTransform *p_tx; // r2
  CMatrix *v15; // r0
  CSimpleTransform *p_m_transform; // r2
  UInt16 v17; // r1
  Int16 v18; // r2

  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    if ( CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
      return;
    v17 = 143;
    v18 = 5;
LABEL_15:
    sub_18AFEC(&AEAudioHardware, v17, v18);
    return;
  }
  v11 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent] + fVolumeOffsetdB;
  if ( DryFireID != -1 )
  {
    m_pMat = pParentPhysical->m_pMat;
    LOWORD(v13) = -10486;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pParentPhysical->m_transform;
    HIWORD(v13) = 15523;
    CAESound::Initialise(
      &this->ScratchSound,
      5,
      DryFireID,
      this,
      p_tx->m_translate,
      v11 + -6.0,
      0.66,
      fFrequencyScalingFactor,
      1.0,
      0,
      0x84u,
      v13,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
    CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
  }
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19) )
  {
    v17 = 138;
    v18 = 19;
    goto LABEL_15;
  }
  if ( (unsigned __int16)FlameID != 0xFFFF )
  {
    v15 = pParentPhysical->m_pMat;
    p_m_transform = (CSimpleTransform *)&v15->tx;
    if ( !v15 )
      p_m_transform = &pParentPhysical->m_transform;
    CAESound::Initialise(
      &this->ScratchSound,
      19,
      FlameID,
      this,
      p_m_transform->m_translate,
      v11 + -20.0,
      2.0,
      fFrequencyScalingFactor * 0.7937,
      1.0,
      0,
      0x84u,
      0.0,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
    this->ScratchSound.m_AudioEvent = 2;
    sub_19F790(&AESoundManager, &this->ScratchSound);
  }
}

//----- (003BAA4C) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayWeaponLoopSound(
        CAEWeaponAudioEntity *this,
        CPhysical *pParentPhysical,
        Int16 LoopSoundID,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fFrequencyScalingFactor,
        int SoundCategory)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    m_pMat = pParentPhysical->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pParentPhysical->m_transform;
    CAESound::Initialise(
      &this->ScratchSound,
      5,
      LoopSoundID,
      this,
      p_tx->m_translate,
      (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent] + fVolumeOffsetdB,
      1.0,
      fFrequencyScalingFactor,
      1.0,
      0,
      0xA4u,
      0.0,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
    this->ScratchSound.m_AudioEvent = SoundCategory;
    sub_19F790(&AESoundManager, &this->ScratchSound);
  }
  else if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
  {
    sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
  }
}

//----- (003BAB3C) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayCameraSound(
        CAEWeaponAudioEntity *this,
        CPhysical *pParentPhysical,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    m_pMat = pParentPhysical->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pParentPhysical->m_transform;
    CAESound::Initialise(
      &this->ScratchSound,
      5,
      45,
      this,
      p_tx->m_translate,
      (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent] + fVolumeOffsetdB,
      0.66,
      1.0,
      1.0,
      0,
      0x90u,
      0.0,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
    sub_19F790(&AESoundManager, &this->ScratchSound);
  }
  else if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
  {
    sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
  }
}

//----- (003BAC28) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayMiniGunFireSounds(
        CAEWeaponAudioEntity *this,
        CPhysical *pParentPhysical,
        tAudioEvent AudioEvent)
{
  Int8 v5; // r6
  tAudioEvent v6; // lr
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2

  switch ( AudioEvent )
  {
    case 145:
    case 150:
      v5 = 1;
      if ( this->m_bMiniGunFireActive )
        goto LABEL_13;
      v6 = 150;
      goto LABEL_6;
    case 149:
      v5 = 1;
      if ( !this->m_bMiniGunFireActive )
      {
        v6 = 152;
LABEL_6:
        CAEWeaponAudioEntity::PlayGunSounds(this, pParentPhysical, 15, 16, 11, 12, 13, v6, 0.0, 1.0, 1.0);
        this->m_bMiniGunFireActive = 1;
      }
      goto LABEL_13;
    case 151:
      if ( this->m_bMiniGunSpinActive )
      {
        v5 = 0;
      }
      else
      {
        if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
        {
          if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
            sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
          return;
        }
        m_pMat = pParentPhysical->m_pMat;
        v5 = 0;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &pParentPhysical->m_transform;
        CAESound::Initialise(
          &this->ScratchSound,
          5,
          14,
          this,
          p_tx->m_translate,
          (float)CAEAudioEntity::m_pAudioEventVolumes[151],
          0.66,
          1.0,
          0.0,
          0,
          0x84u,
          0.0,
          0);
        CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
        this->ScratchSound.m_AudioEvent = 5;
        CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
        this->m_bMiniGunSpinActive = 1;
      }
LABEL_13:
      this->m_nMiniGunState = v5;
LABEL_14:
      this->m_nLastMiniGunFireTimeMs = CTimer::m_snTimeInMilliseconds;
      return;
    default:
      goto LABEL_14;
  }
}

//----- (003BAD94) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayGoggleSound(
        CAEWeaponAudioEntity *this,
        __int16 SoundID,
        tAudioEvent AudioEvent)
{
  char v5; // r5
  float v6; // s18
  float v7; // s16
  int v8; // r9
  float v9; // s0
  CVector Positiona; // [sp+0h] [bp-70h]
  CVector Position; // [sp+0h] [bp-70h]

  v5 = CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    v6 = 1.0;
    v7 = (float)v5 + -9.0;
    v8 = CAEAudioUtility::ResolveProbability(0.5);
    v9 = 1.1892;
    if ( !v8 )
      v9 = 1.0;
    Positiona.x = -1.0;
    *(_QWORD *)&Positiona.y = 0LL;
    CAESound::Initialise(&this->ScratchSound, 5, SoundID, this, Positiona, v7, 1.0, v9, 1.0, 0, 0, 0.0, 0);
    this->ScratchSound.m_Environment = 4097;
    CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
    *(_QWORD *)&Position.y = 0LL;
    if ( !v8 )
      v6 = 1.1892;
    Position.x = 1.0;
    CAESound::Initialise(&this->ScratchSound, 5, SoundID, this, Position, v7, 1.0, v6, 1.0, 0, 0, 0.0, 0);
    this->ScratchSound.m_Environment = 4097;
    sub_19F790(&AESoundManager, &this->ScratchSound);
  }
  else if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
  {
    sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
  }
}

//----- (003BAEEC) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::WeaponReload(
        CAEWeaponAudioEntity *this,
        eWeaponType WeaponType,
        CPhysical *pParentPhysical,
        tAudioEvent AudioEvent)
{
  Int16 v8; // r2
  float v9; // s0
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r3

  if ( pParentPhysical )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
    {
      switch ( WeaponType )
      {
        case WEAPONTYPE_PISTOL:
        case WEAPONTYPE_PISTOL_SILENCED:
          v9 = 0.0;
          v8 = 66;
          goto LABEL_24;
        case WEAPONTYPE_DESERT_EAGLE:
          v9 = 0.0;
          v8 = 51;
          goto LABEL_24;
        case WEAPONTYPE_SHOTGUN:
        case WEAPONTYPE_SPAS12_SHOTGUN:
          v8 = 72;
          v9 = 0.0;
          if ( AudioEvent == 146 )
            v8 = 71;
          goto LABEL_26;
        case WEAPONTYPE_SAWNOFF_SHOTGUN:
          v9 = 0.0;
          v8 = 70;
          if ( AudioEvent == 146 )
            v8 = 69;
          goto LABEL_26;
        case WEAPONTYPE_MICRO_UZI:
        case WEAPONTYPE_MP5:
        case WEAPONTYPE_TEC9:
          v8 = 85;
          v9 = 0.0;
          if ( AudioEvent == 146 )
            v8 = 84;
          goto LABEL_26;
        case WEAPONTYPE_AK47:
        case WEAPONTYPE_M4:
          v8 = 32;
          v9 = 0.0;
          if ( AudioEvent == 146 )
            v8 = 31;
          goto LABEL_26;
        case WEAPONTYPE_COUNTRYRIFLE:
          if ( AudioEvent != 146 )
            return;
          v9 = -6.0;
          v8 = 32;
          goto LABEL_26;
        case WEAPONTYPE_SNIPERRIFLE:
          v9 = 0.0;
          v8 = 32;
LABEL_24:
          if ( AudioEvent == 146 )
            v8 = 55;
LABEL_26:
          m_pMat = pParentPhysical->m_pMat;
          p_tx = (CSimpleTransform *)&m_pMat->tx;
          if ( !m_pMat )
            p_tx = &pParentPhysical->m_transform;
          CAESound::Initialise(
            &this->ScratchSound,
            5,
            v8,
            this,
            p_tx->m_translate,
            v9 + (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent],
            0.66,
            1.0,
            1.0,
            0,
            0x80u,
            0.0,
            0);
          CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
          sub_19F790(&AESoundManager, &this->ScratchSound);
          break;
        default:
          return;
      }
    }
    else if ( !CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
    {
      sub_18AFEC(&AEAudioHardware, 0x8Fu, 5);
    }
  }
}

//----- (003BB04C) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::PlayFlameThrowerIdleGasLoop(
        CAEWeaponAudioEntity *this,
        CPhysical *pParentPhysical)
{
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2

  if ( !this->m_pFlameThrowerIdleGasLoopSound )
  {
    m_pMat = pParentPhysical->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pParentPhysical->m_transform;
    CAESound::Initialise(
      &this->ScratchSound,
      5,
      10,
      this,
      p_tx->m_translate,
      (float)CAEAudioEntity::m_pAudioEventVolumes[158],
      0.66,
      1.0,
      1.0,
      0,
      0x84u,
      0.0,
      0);
    CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
    this->m_pFlameThrowerIdleGasLoopSound = CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
  }
}

//----- (003BB0EC) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::StopFlameThrowerIdleGasLoop(CAEWeaponAudioEntity *this)
{
  CAESound *m_pFlameThrowerIdleGasLoopSound; // r0

  m_pFlameThrowerIdleGasLoopSound = this->m_pFlameThrowerIdleGasLoopSound;
  if ( m_pFlameThrowerIdleGasLoopSound )
  {
    CAESound::StopSoundAndForget(m_pFlameThrowerIdleGasLoopSound);
    this->m_pFlameThrowerIdleGasLoopSound = 0;
  }
}

//----- (003BB108) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::ReportChainsawEvent(
        CAEWeaponAudioEntity *this,
        CPhysical *pParentPhysical,
        tAudioEvent AudioEvent)
{
  CPlayerPed *PlayerPed; // r0
  float v7; // s16
  CMatrix *v8; // r0
  CSimpleTransform *p_m_transform; // r1
  Int8 v10; // r1
  unsigned int m_nChainsawState; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1

  if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x24u, 40) )
  {
    if ( !FindPlayerPed(-1) || (PlayerPed = FindPlayerPed(-1), !CPed::GetHoldingTask(PlayerPed)) )
    {
      v7 = (float)CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
      if ( AudioEvent == 155 )
      {
        if ( (unsigned __int8)(this->m_nChainsawState - 1) > 1u )
          return;
        v10 = 2;
        goto LABEL_25;
      }
      if ( AudioEvent == 154 )
      {
        m_nChainsawState = (unsigned __int8)this->m_nChainsawState;
        if ( m_nChainsawState <= 3 && m_nChainsawState != 2 )
        {
          if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 10, this) )
          {
            m_pMat = pParentPhysical->m_pMat;
            p_tx = (CSimpleTransform *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &pParentPhysical->m_transform;
            CAESound::Initialise(
              &this->ScratchSound,
              40,
              0,
              this,
              p_tx->m_translate,
              v7,
              1.25,
              1.0,
              0.0,
              0,
              0x84u,
              0.0,
              0);
            CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
            this->ScratchSound.m_AudioEvent = 10;
            CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
          }
          v10 = 1;
          goto LABEL_25;
        }
      }
      else if ( AudioEvent == 153 && ((unsigned __int8)this->m_nChainsawState | 4) == 4 )
      {
        if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 9, this) )
        {
          v8 = pParentPhysical->m_pMat;
          p_m_transform = (CSimpleTransform *)&v8->tx;
          if ( !v8 )
            p_m_transform = &pParentPhysical->m_transform;
          CAESound::Initialise(
            &this->ScratchSound,
            40,
            1,
            this,
            p_m_transform->m_translate,
            v7,
            0.66,
            1.0,
            0.0,
            0,
            0x84u,
            0.0,
            0);
          CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
          this->ScratchSound.m_AudioEvent = 9;
          CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
        }
        v10 = 0;
LABEL_25:
        this->m_nChainsawState = v10;
        this->m_nLastChainsawEventTimeMs = CTimer::m_snTimeInMilliseconds;
      }
    }
  }
  else
  {
    if ( CAESoundManager::AreSoundsPlayingInBankSlot(&AESoundManager, 40) )
      CAESoundManager::CancelSoundsInBankSlot(&AESoundManager, 40, 0);
    sub_18AFEC(&AEAudioHardware, 0x24u, 40);
  }
}

//----- (003BB314) --------------------------------------------------------
void __fastcall CAEWeaponAudioEntity::ReportStealthKill(
        CAEWeaponAudioEntity *this,
        eWeaponType WeaponType,
        CPhysical *pParentPhysical,
        tAudioEvent AudioEvent)
{
  CSimpleTransform *p_m_transform; // r5
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  int v10; // s2
  CMatrix *v11; // r0
  UInt16 v12; // r1
  Int16 v13; // r2

  if ( WeaponType != WEAPONTYPE_KNIFE )
    return;
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5) )
  {
    if ( CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
      return;
    v12 = 143;
    v13 = 5;
    goto LABEL_14;
  }
  p_m_transform = &pParentPhysical->m_transform;
  m_pMat = pParentPhysical->m_pMat;
  p_tx = &pParentPhysical->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  v10 = CAEAudioEntity::m_pAudioEventVolumes[AudioEvent];
  CAESound::Initialise(
    &this->ScratchSound,
    5,
    81,
    this,
    p_tx->m_translate,
    (float)v10 + -6.0,
    1.0,
    0.0,
    1.0,
    0,
    0x84u,
    0.0,
    0);
  CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
  this->ScratchSound.m_AudioEvent = 13;
  this->ScratchSound.m_ClientVariable = (float)CTimer::m_snTimeInMilliseconds;
  CAESoundManager::RequestNewSound(&AESoundManager, &this->ScratchSound);
  if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2) )
  {
    if ( CAudioEngine::IsLoadingTuneActive(&AudioEngine) )
      return;
    v12 = 39;
    v13 = 2;
LABEL_14:
    sub_18AFEC(&AEAudioHardware, v12, v13);
    return;
  }
  v11 = pParentPhysical->m_pMat;
  if ( v11 )
    p_m_transform = (CSimpleTransform *)&v11->tx;
  CAESound::Initialise(
    &this->ScratchSound,
    2,
    47,
    this,
    p_m_transform->m_translate,
    (float)v10,
    1.0,
    0.0,
    1.0,
    0,
    0x84u,
    0.0,
    0);
  CAESound::RegisterWithPhysicalEntity(&this->ScratchSound, pParentPhysical);
  this->ScratchSound.m_AudioEvent = 14;
  this->ScratchSound.m_ClientVariable = (float)CTimer::m_snTimeInMilliseconds;
  sub_19F790(&AESoundManager, &this->ScratchSound);
}

//----- (003BB4D0) --------------------------------------------------------
void CAEWeatherAudioEntity::StaticReset()
{
  CAEWeatherAudioEntity::m_sfRainVolume = -100.0;
  if ( CAEWeatherAudioEntity::m_sRainSoundL.m_bCurrentlyInUse )
    CAETwinLoopSoundEntity::StopSoundAndForget(&CAEWeatherAudioEntity::m_sRainSoundL);
  if ( CAEWeatherAudioEntity::m_sRainSoundR.m_bCurrentlyInUse )
    sub_19775C(&CAEWeatherAudioEntity::m_sRainSoundR);
}

//----- (003BB52C) --------------------------------------------------------
void __fastcall CAEWeatherAudioEntity::Service(CAEWeatherAudioEntity *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d3
  float32x2_t v4; // d8
  float32x2_t v6; // d0
  float v7; // r0
  int v8; // r4
  float v9; // s0
  int v10; // r9
  int v11; // r11
  float v12; // s16
  float RandomNumberInRange; // s18
  bool v14; // zf
  int v15; // r0
  Int16 v16; // r4
  int v17; // r11
  float v18; // s16
  float v19; // s18
  Int16 v20; // r4
  CVector Positionb; // [sp+0h] [bp-D0h]
  CVector Positionc; // [sp+0h] [bp-D0h]
  CVector Positiond; // [sp+0h] [bp-D0h]
  CVector Positione; // [sp+0h] [bp-D0h]
  CVector Position; // [sp+0h] [bp-D0h]
  CVector Positiona; // [sp+0h] [bp-D0h]
  CAESound v27; // [sp+2Ch] [bp-A4h] BYREF
  CVector v28; // 0:r1.12
  CVector v29; // 0:r1.12
  CVector v30; // 0:r1.12
  CVector v31; // 0:r1.12

  v27.m_pPhysicalEntity = 0;
  if ( CGame::currArea == AREA_MAIN_MAP )
  {
    if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 3, this) )
    {
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positionb.x = -0.906;
        *(_QWORD *)&Positionb.y = 1054380917LL;
        CAESound::Initialise(&v27, 0, 0, this, Positionb, -50.0, 1.0, 1.0, 1.0, 0, 0x1005u, 0.0, 0);
        v27.m_AudioEvent = 3;
        CAESoundManager::RequestNewSound(&AESoundManager, &v27);
        Positionc.z = 0.0;
        *(_QWORD *)&Positionc.x = 0x3ED893753F67EF9ELL;
        CAESound::Initialise(&v27, 0, 0, this, Positionc, -50.0, 1.0, 1.0, 1.0, 0, 0x1025u, 0.0, 50);
        v27.m_AudioEvent = 3;
        CAESoundManager::RequestNewSound(&AESoundManager, &v27);
      }
      else
      {
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x3Bu, 0);
      }
    }
    if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 4, this) )
    {
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positiond.x = -0.906;
        *(_QWORD *)&Positiond.y = 1054380917LL;
        CAESound::Initialise(&v27, 0, 29, this, Positiond, -50.0, 1.0, 1.0, 1.0, 0, 0x1005u, 0.0, 0);
        v27.m_AudioEvent = 4;
        CAESoundManager::RequestNewSound(&AESoundManager, &v27);
      }
      else
      {
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x3Bu, 0);
      }
    }
    if ( !CAESoundManager::AreSoundsOfThisEventPlayingForThisEntity(&AESoundManager, 5, this) )
    {
      if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0) )
      {
        Positione.x = 0.906;
        *(_QWORD *)&Positione.y = 1054380917LL;
        CAESound::Initialise(&v27, 0, 30, this, Positione, -50.0, 1.0, 1.0, 1.0, 0, 0x1025u, 0.0, 50);
        v27.m_AudioEvent = 5;
        CAESoundManager::RequestNewSound(&AESoundManager, &v27);
      }
      else
      {
        CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x3Bu, 0);
      }
    }
  }
  v4.n64_u32[0] = -1027080192;
  if ( CWeather::Rain > 0.0
    && !CCullZones::PlayerNoRain()
    && !CCullZones::CamNoRain()
    && CGame::currArea == AREA_MAIN_MAP )
  {
    v3.n64_u32[0] = 0;
    v1.n64_f32[0] = CWeather::Rain + -0.2;
    v2.n64_f32[0] = CAEWeatherAudioEntity::m_sfRainVolume;
    v6.n64_u64[0] = vmax_f32(v1, v3).n64_u64[0];
    v7 = v6.n64_f32[0] / 0.8;
    v6.n64_u32[0] = -1035468800;
    v1.n64_u64[0] = vmax_f32(v2, v6).n64_u64[0];
    CAEWeatherAudioEntity::m_sfRainVolume = v1.n64_f32[0];
    v8 = CAEAudioEntity::m_pAudioEventVolumes[143];
    v4.n64_f32[0] = (float)(log10f(v7) * 20.0) + (float)v8;
  }
  v9 = CAEWeatherAudioEntity::m_sfRainVolume;
  if ( v4.n64_f32[0] < CAEWeatherAudioEntity::m_sfRainVolume )
  {
    v1.n64_f32[0] = CAEWeatherAudioEntity::m_sfRainVolume + -0.5;
    LODWORD(v9) = vmax_f32(v1, v4).n64_u32[0];
LABEL_23:
    CAEWeatherAudioEntity::m_sfRainVolume = v9;
    goto LABEL_24;
  }
  if ( v4.n64_f32[0] > CAEWeatherAudioEntity::m_sfRainVolume )
  {
    v1.n64_f32[0] = CAEWeatherAudioEntity::m_sfRainVolume + 0.5;
    LODWORD(v9) = vmin_f32(v1, v4).n64_u32[0];
    goto LABEL_23;
  }
LABEL_24:
  if ( v4.n64_f32[0] == -100.0 && v9 <= -50.0 )
  {
    CAEWeatherAudioEntity::m_sfRainVolume = -100.0;
    if ( CAEWeatherAudioEntity::m_sRainSoundL.m_bCurrentlyInUse )
      CAETwinLoopSoundEntity::StopSoundAndForget(&CAEWeatherAudioEntity::m_sRainSoundL);
    if ( CAEWeatherAudioEntity::m_sRainSoundR.m_bCurrentlyInUse )
      CAETwinLoopSoundEntity::StopSoundAndForget(&CAEWeatherAudioEntity::m_sRainSoundR);
    goto LABEL_49;
  }
  v10 = 1054380917;
  if ( CAEWeatherAudioEntity::m_sRainSoundL.m_bCurrentlyInUse )
  {
    *(_QWORD *)&v28.y = 1054380917LL;
    v28.x = -0.906;
    CAETwinLoopSoundEntity::UpdateTwinLoopSound(&CAEWeatherAudioEntity::m_sRainSoundL, v28, v9, 1.0);
    if ( CAETwinLoopSoundEntity::DoSoundsSwitchThisFrame(&CAEWeatherAudioEntity::m_sRainSoundL) )
    {
      v11 = (unsigned __int16)CAEWeatherAudioEntity::m_snLastRainDropSoundID;
      v12 = CAEWeatherAudioEntity::m_sfRainVolume + -15.0;
      RandomNumberInRange = CAEAudioUtility::GetRandomNumberInRange(-6.0, 6.0);
      v14 = CAEAudioUtility::ResolveProbability(0.5) == 0;
      v15 = 1054380917;
      if ( v14 )
        v15 = -1093102731;
      Position.x = -0.906;
      *(_QWORD *)&Position.y = (unsigned int)v15;
      v16 = v11 + 1;
      if ( (v11 + 1) << 16 > 720896 )
        v16 = 2;
      CAESound::Initialise(&v27, 6, v16, this, Position, v12 + RandomNumberInRange, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
      v27.m_Environment = 3;
      CAESoundManager::RequestNewSound(&AESoundManager, &v27);
      CAEWeatherAudioEntity::m_snLastRainDropSoundID = v16;
    }
  }
  else
  {
    if ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x69u, 6) )
      goto LABEL_48;
    CAETwinLoopSoundEntity::Initialise(&CAEWeatherAudioEntity::m_sRainSoundL, 6, 1, 0, this, 0x41u, 0x15Eu, 0, 0);
    *(_QWORD *)&v29.y = 1054380917LL;
    v29.x = -0.906;
    CAETwinLoopSoundEntity::PlayTwinLoopSound(
      &CAEWeatherAudioEntity::m_sRainSoundL,
      v29,
      CAEWeatherAudioEntity::m_sfRainVolume,
      1.0,
      1.0,
      1.0,
      0x23u);
  }
  if ( !CAEWeatherAudioEntity::m_sRainSoundR.m_bCurrentlyInUse )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x69u, 6) )
    {
      CAETwinLoopSoundEntity::Initialise(&CAEWeatherAudioEntity::m_sRainSoundR, 6, 0, 1, this, 0x41u, 0x15Eu, 50, 50);
      *(_QWORD *)&v31.y = 1054380917LL;
      v31.x = 0.906;
      CAETwinLoopSoundEntity::PlayTwinLoopSound(
        &CAEWeatherAudioEntity::m_sRainSoundR,
        v31,
        CAEWeatherAudioEntity::m_sfRainVolume,
        1.0,
        1.0,
        1.0,
        0x23u);
      goto LABEL_49;
    }
LABEL_48:
    CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x69u, 6);
    goto LABEL_49;
  }
  *(_QWORD *)&v30.y = 1054380917LL;
  v30.x = 0.906;
  CAETwinLoopSoundEntity::UpdateTwinLoopSound(
    &CAEWeatherAudioEntity::m_sRainSoundR,
    v30,
    CAEWeatherAudioEntity::m_sfRainVolume,
    1.0);
  if ( CAETwinLoopSoundEntity::DoSoundsSwitchThisFrame(&CAEWeatherAudioEntity::m_sRainSoundR) )
  {
    v17 = (unsigned __int16)CAEWeatherAudioEntity::m_snLastRainDropSoundID;
    v18 = CAEWeatherAudioEntity::m_sfRainVolume + -15.0;
    v19 = CAEAudioUtility::GetRandomNumberInRange(-6.0, 6.0);
    if ( !CAEAudioUtility::ResolveProbability(0.5) )
      v10 = -1093102731;
    Positiona.x = 0.906;
    *(_QWORD *)&Positiona.y = (unsigned int)v10;
    v20 = v17 + 1;
    if ( (v17 + 1) << 16 > 720896 )
      v20 = 2;
    CAESound::Initialise(&v27, 6, v20, this, Positiona, v18 + v19, 1.0, 1.0, 1.0, 0, 0, 0.0, 0);
    v27.m_Environment = 3;
    CAESoundManager::RequestNewSound(&AESoundManager, &v27);
    CAEWeatherAudioEntity::m_snLastRainDropSoundID = v20;
  }
LABEL_49:
  CAESound::~CAESound(&v27);
}
// 3BB7AA: variable 'v1' is possibly undefined
// 3BB7AA: variable 'v3' is possibly undefined
// 3BB7BA: variable 'v2' is possibly undefined
// 3BB800: variable 'v4' is possibly undefined

//----- (003BBC08) --------------------------------------------------------
void __fastcall CAEWeatherAudioEntity::UpdateParameters(CAEWeatherAudioEntity *this, CAESound *pSound, Int16 PlayTime)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  float32x2_t v7; // d8
  float32x2_t v8; // d9
  unsigned int v9; // r5
  tAudioEvent m_AudioEvent; // r0
  UInt32 v12; // r6
  int v13; // r4
  float v14; // s0
  unsigned int v15; // r0
  unsigned int v16; // r6
  float v17; // r0
  CSimpleTransform *p_tx; // r2
  float v19; // s0
  float PiecewiseLinear; // s20
  float v21; // r0
  float v22; // s16
  int v23; // r0
  _BOOL4 v24; // r1
  float v25; // s0
  float v26; // s4
  float v27; // s4
  unsigned __int32 v28; // s4
  unsigned __int32 v29; // s0
  CSimpleTransform *p_m_transform; // r3
  float x; // s18
  float y; // s20
  float z; // r5
  CPlayerPed *PlayerPed; // r0
  CPlayerPed *v35; // r8
  CMatrix *m_pMat; // r0
  CSimpleTransform *v37; // r1
  __int64 v38; // d16
  float m_heading; // r6
  float v40; // s22
  float v41; // s0
  float v42; // s8
  float v43; // s4
  float v44; // s0
  float v45; // s2
  CSimpleTransform *v46; // r3
  float v47; // s24
  float v48; // s26
  float v49; // s28
  float v50; // s30
  float *m_pMyVehicle; // r2
  float v52; // s21
  float v53; // s19
  __int64 v54; // d16
  CSimpleTransform *v55; // r3
  float v56; // s24
  float v57; // s26
  float v58; // s28
  float v59; // s30
  float *v60; // r2
  float v61; // s21
  float v62; // s19
  __int64 v63; // d16
  float v64; // r5
  float v65; // s6
  float v66; // s8
  float v67; // s0
  float v68; // s2
  float v69; // s18
  float v70; // s6
  float *v71; // r1
  CEntity **v72; // r0
  float v73; // s6
  float *v74; // r1
  float v75; // r5
  float v76; // s6
  float v77; // s8
  float v78; // s0
  float v79; // s2
  float v80; // s18
  float m_EmittedVolume; // s6
  float v82; // s4
  CVector vecEnd; // [sp+24h] [bp-B4h] BYREF
  CVector vecStart; // [sp+30h] [bp-A8h] BYREF
  CColPoint colPoint; // [sp+40h] [bp-98h] BYREF
  CEntity *refEntityPtr; // [sp+6Ch] [bp-6Ch] BYREF
  CVector v87; // [sp+70h] [bp-68h] BYREF

  v9 = PlayTime;
  if ( PlayTime < 1 )
    return;
  m_AudioEvent = pSound->m_AudioEvent;
  if ( (unsigned int)(m_AudioEvent - 4) < 2 )
  {
    v8.n64_u32[0] = 1.0;
    v7.n64_u32[0] = 0;
    p_tx = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_tx = &TheCamera.m_transform;
    v19 = p_tx->m_translate.z / 500.0;
    if ( v19 > 1.0 || (v4.n64_u32[0] = 0, v19 >= 0.0) )
    {
      v4.n64_u32[0] = 1.0;
      if ( v19 <= 1.0 )
        v4.n64_f32[0] = p_tx->m_translate.z / 500.0;
    }
    PiecewiseLinear = CAEAudioUtility::GetPiecewiseLinear(v4.n64_f32[0], 3, fWindRatioLowerRange);
    v21 = CAEAudioUtility::GetPiecewiseLinear(v4.n64_f32[0], 3, fWindRatioUpperRange);
    v4.n64_f32[0] = CWeather::WindClipped;
    v4.n64_u64[0] = vmax_f32(vmin_f32(v4, v8), v7).n64_u64[0];
    v22 = PiecewiseLinear + (float)((float)(v21 - PiecewiseLinear) * v4.n64_f32[0]);
    v23 = CAEAudioUtility::ResolveProbability(0.07);
    v24 = sbWindOffset;
    if ( v23 )
    {
      v24 = !sbWindOffset;
      sbWindOffset ^= 1u;
    }
    v25 = 1.0;
    v26 = 0.0;
    if ( v24 )
      v26 = 1.0;
    v4.n64_f32[0] = (float)(v22 * 1.2) * v26;
    v27 = (float)(v22 * 21.0) * v26;
    sfWindFreq = v4.n64_f32[0];
    sfWindOffset = v27;
    if ( CGame::currArea )
      goto LABEL_23;
    v5.n64_f32[0] = v27 + -33.0;
    v6.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
    if ( v6.n64_f32[0] >= v5.n64_f32[0] )
    {
      if ( v6.n64_f32[0] <= v5.n64_f32[0] )
        goto LABEL_30;
      v6.n64_f32[0] = v6.n64_f32[0] + -0.6;
      v28 = vmax_f32(v6, v5).n64_u32[0];
    }
    else
    {
      v6.n64_f32[0] = v6.n64_f32[0] + 0.6;
      v28 = vmin_f32(v6, v5).n64_u32[0];
    }
    LODWORD(pSound->m_EmittedVolume) = v28;
LABEL_30:
    if ( sfOldFreqLeft >= v4.n64_f32[0] )
    {
      if ( sfOldFreqLeft <= v4.n64_f32[0] )
      {
        pSound->m_RelativeFrequency = sfOldFreqLeft;
        return;
      }
      if ( (float)(sfOldFreqLeft + -0.1) > 1.0 )
        v25 = sfOldFreqLeft + -0.1;
    }
    else
    {
      v3.n64_f32[0] = sfOldFreqLeft + 0.1;
      LODWORD(v25) = vmin_f32(v3, v4).n64_u32[0];
    }
    sfOldFreqLeft = v25;
    pSound->m_RelativeFrequency = v25;
    return;
  }
  if ( m_AudioEvent == 3 )
  {
    if ( CGame::currArea )
    {
LABEL_23:
      v3.n64_u32[0] = -1035468800;
      v4.n64_u32[0] = LODWORD(pSound->m_EmittedVolume);
      if ( v4.n64_f32[0] <= -50.0 )
      {
        sub_1953E8(pSound);
        return;
      }
      v4.n64_f32[0] = v4.n64_f32[0] + -0.6;
      v29 = vmax_f32(v4, v3).n64_u32[0];
LABEL_45:
      LODWORD(pSound->m_EmittedVolume) = v29;
      return;
    }
    p_m_transform = (CSimpleTransform *)&TheCamera.m_pMat->tx;
    if ( !TheCamera.m_pMat )
      p_m_transform = &TheCamera.m_transform;
    x = p_m_transform->m_translate.x;
    y = p_m_transform->m_translate.y;
    v7.n64_f32[0] = (float)CAEAudioEntity::m_pAudioEventVolumes[144];
    z = *(float *)&byte_8[(_DWORD)p_m_transform];
    PlayerPed = FindPlayerPed(-1);
    v35 = PlayerPed;
    if ( PlayerPed )
    {
      m_pMat = PlayerPed->m_pMat;
      v37 = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        v37 = &v35->m_transform;
      z = v37->m_translate.z;
    }
    if ( TheCamera.m_pMat )
    {
      v38 = *(_QWORD *)&TheCamera.m_pMat->xx;
      v87.z = TheCamera.m_pMat->zx;
      *(_QWORD *)&v87.x = v38;
    }
    else
    {
      v87.z = 0.0;
      m_heading = TheCamera.m_transform.m_heading;
      v87.y = sinf(TheCamera.m_transform.m_heading);
      v87.x = cosf(m_heading);
    }
    v40 = z;
    CVector::Normalise(&v87);
    refEntityPtr = 0;
    v41 = v87.z * 4.0;
    v42 = v87.y * 4.0;
    v43 = v87.x * 4.0;
    if ( pSound->m_Position.x == -0.906 && pSound->m_Position.y == 0.423 )
    {
      vecStart.y = y + v87.y;
      vecEnd.y = y + v42;
      vecStart.x = x + v87.x;
      vecStart.z = v87.z + z;
      vecEnd.x = x + v43;
      vecEnd.z = v41 + z;
      CWorld::ProcessLineOfSight(&vecStart, &vecEnd, &colPoint, &refEntityPtr, 1, 1, 0, 1, 1, 0, 0, 0);
      v44 = 1.0;
      v45 = 0.0;
      if ( refEntityPtr && refEntityPtr != CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityLeft )
      {
        v46 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
        if ( !TheCamera.m_pMat )
          v46 = &TheCamera.m_transform;
        if ( fabsf(v46->m_translate.z - z) < 6.0 )
        {
          v47 = 0.0;
          v48 = 0.0;
          v49 = 0.0;
          v50 = 0.0;
          if ( v35 )
          {
            v48 = 0.0;
            v49 = 0.0;
            v50 = 0.0;
            if ( *((unsigned __int8 *)&v35->m_nPedFlags + 1) << 31 )
            {
              m_pMyVehicle = (float *)v35->m_pMyVehicle;
              v48 = 0.0;
              v49 = 0.0;
              v50 = 0.0;
              if ( m_pMyVehicle )
              {
                v48 = m_pMyVehicle[18];
                v49 = m_pMyVehicle[19];
                v50 = m_pMyVehicle[20];
              }
            }
          }
          v52 = 0.0;
          v53 = 0.0;
          if ( (unsigned __int8)((*(_BYTE *)&refEntityPtr->m_info & 7) - 2) <= 2u )
          {
            v47 = refEntityPtr[1].m_transform.m_translate.z;
            v52 = refEntityPtr[1].m_transform.m_heading;
            v53 = *(float *)&refEntityPtr[1].m_pMat;
          }
          if ( TheCamera.m_pMat )
          {
            v54 = *(_QWORD *)&TheCamera.m_pMat->xy;
            vecStart.z = TheCamera.m_pMat->zy;
            *(_QWORD *)&vecStart.x = v54;
          }
          else
          {
            vecStart.z = 0.0;
            v75 = TheCamera.m_transform.m_heading;
            vecStart.y = cosf(TheCamera.m_transform.m_heading);
            LODWORD(vecStart.x) = COERCE_UNSIGNED_INT(sinf(v75)) ^ 0x80000000;
          }
          CVector::Normalise(&vecStart);
          v76 = (float)((float)(v47 * vecStart.x) + (float)(v52 * vecStart.y)) + (float)(v53 * vecStart.z);
          v77 = (float)((float)(v48 * vecStart.x) + (float)(v49 * vecStart.y)) + (float)(v50 * vecStart.z);
          v78 = sqrtf(
                  (float)((float)((float)(vecStart.z * v77) - (float)(vecStart.z * v76))
                        * (float)((float)(vecStart.z * v77) - (float)(vecStart.z * v76)))
                + (float)((float)((float)((float)(vecStart.x * v77) - (float)(vecStart.x * v76))
                                * (float)((float)(vecStart.x * v77) - (float)(vecStart.x * v76)))
                        + (float)((float)((float)(vecStart.y * v77) - (float)(vecStart.y * v76))
                                * (float)((float)(vecStart.y * v77) - (float)(vecStart.y * v76)))));
          if ( v78 <= 0.35 )
          {
            v44 = 1.0;
            v45 = 0.0;
          }
          else
          {
            v79 = sqrtf(
                    (float)((float)((float)((float)(x + v87.x) - colPoint.m_vecPosition.x)
                                  * (float)((float)(x + v87.x) - colPoint.m_vecPosition.x))
                          + (float)((float)((float)(y + v87.y) - colPoint.m_vecPosition.y)
                                  * (float)((float)(y + v87.y) - colPoint.m_vecPosition.y)))
                  + (float)((float)((float)(v87.z + v40) - colPoint.m_vecPosition.z)
                          * (float)((float)(v87.z + v40) - colPoint.m_vecPosition.z)))
                / -6.0;
            v80 = (float)(v78 + -0.35) / 0.95;
            v44 = (float)(v80 * 1.75) + 1.75;
            v45 = (float)(log10f(v80 * (float)(v79 + 1.0)) * 20.0) + 30.0;
          }
        }
      }
      v5.n64_f32[0] = v45 + v7.n64_f32[0];
      m_EmittedVolume = pSound->m_EmittedVolume;
      if ( m_EmittedVolume < (float)(v45 + v7.n64_f32[0]) )
      {
        v6.n64_f32[0] = m_EmittedVolume + 0.3;
        v71 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueLeft;
        v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityLeft;
        goto LABEL_95;
      }
      if ( m_EmittedVolume <= v5.n64_f32[0] )
      {
        v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityLeft;
        goto LABEL_96;
      }
      v4.n64_f32[0] = m_EmittedVolume + -0.3;
      v5.n64_f32[0] = CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueLeft;
      if ( CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueLeft > 0.0 )
      {
        v6.n64_u32[0] = 1067869798;
        LODWORD(v73) = vmin_f32(v5, v6).n64_u32[0];
        v74 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueLeft;
        v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityLeft;
        goto LABEL_101;
      }
      v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityLeft;
    }
    else
    {
      vecStart.y = y - v87.y;
      vecEnd.y = y - v42;
      vecStart.x = x - v87.x;
      vecStart.z = z - v87.z;
      vecEnd.x = x - v43;
      vecEnd.z = z - v41;
      CWorld::ProcessLineOfSight(&vecStart, &vecEnd, &colPoint, &refEntityPtr, 1, 1, 0, 1, 1, 0, 0, 0);
      v44 = 1.0;
      v45 = 0.0;
      if ( refEntityPtr && refEntityPtr != CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityRight )
      {
        v55 = (CSimpleTransform *)&TheCamera.m_pMat->tx;
        if ( !TheCamera.m_pMat )
          v55 = &TheCamera.m_transform;
        if ( fabsf(v55->m_translate.z - z) < 6.0 )
        {
          v56 = 0.0;
          v57 = 0.0;
          v58 = 0.0;
          v59 = 0.0;
          if ( v35 )
          {
            v57 = 0.0;
            v58 = 0.0;
            v59 = 0.0;
            if ( *((unsigned __int8 *)&v35->m_nPedFlags + 1) << 31 )
            {
              v60 = (float *)v35->m_pMyVehicle;
              v57 = 0.0;
              v58 = 0.0;
              v59 = 0.0;
              if ( v60 )
              {
                v57 = v60[18];
                v58 = v60[19];
                v59 = v60[20];
              }
            }
          }
          v61 = 0.0;
          v62 = 0.0;
          if ( (unsigned __int8)((*(_BYTE *)&refEntityPtr->m_info & 7) - 2) <= 2u )
          {
            v56 = refEntityPtr[1].m_transform.m_translate.z;
            v61 = refEntityPtr[1].m_transform.m_heading;
            v62 = *(float *)&refEntityPtr[1].m_pMat;
          }
          if ( TheCamera.m_pMat )
          {
            v63 = *(_QWORD *)&TheCamera.m_pMat->xy;
            vecStart.z = TheCamera.m_pMat->zy;
            *(_QWORD *)&vecStart.x = v63;
          }
          else
          {
            vecStart.z = 0.0;
            v64 = TheCamera.m_transform.m_heading;
            vecStart.y = cosf(TheCamera.m_transform.m_heading);
            LODWORD(vecStart.x) = COERCE_UNSIGNED_INT(sinf(v64)) ^ 0x80000000;
          }
          CVector::Normalise(&vecStart);
          v65 = (float)((float)(v56 * vecStart.x) + (float)(v61 * vecStart.y)) + (float)(v62 * vecStart.z);
          v66 = (float)((float)(v57 * vecStart.x) + (float)(v58 * vecStart.y)) + (float)(v59 * vecStart.z);
          v67 = sqrtf(
                  (float)((float)((float)(vecStart.z * v66) - (float)(vecStart.z * v65))
                        * (float)((float)(vecStart.z * v66) - (float)(vecStart.z * v65)))
                + (float)((float)((float)((float)(vecStart.x * v66) - (float)(vecStart.x * v65))
                                * (float)((float)(vecStart.x * v66) - (float)(vecStart.x * v65)))
                        + (float)((float)((float)(vecStart.y * v66) - (float)(vecStart.y * v65))
                                * (float)((float)(vecStart.y * v66) - (float)(vecStart.y * v65)))));
          if ( v67 <= 0.35 )
          {
            v44 = 1.0;
            v45 = 0.0;
          }
          else
          {
            v68 = sqrtf(
                    (float)((float)((float)((float)(x + v87.x) - colPoint.m_vecPosition.x)
                                  * (float)((float)(x + v87.x) - colPoint.m_vecPosition.x))
                          + (float)((float)((float)(y + v87.y) - colPoint.m_vecPosition.y)
                                  * (float)((float)(y + v87.y) - colPoint.m_vecPosition.y)))
                  + (float)((float)((float)(v87.z + v40) - colPoint.m_vecPosition.z)
                          * (float)((float)(v87.z + v40) - colPoint.m_vecPosition.z)))
                / -6.0;
            v69 = (float)(v67 + -0.35) / 0.95;
            v44 = (float)(v69 * 1.75) + 1.75;
            v45 = (float)(log10f(v69 * (float)(v68 + 1.0)) * 20.0) + 30.0;
          }
        }
      }
      v5.n64_f32[0] = v45 + v7.n64_f32[0];
      v70 = pSound->m_EmittedVolume;
      if ( v70 < (float)(v45 + v7.n64_f32[0]) )
      {
        v6.n64_f32[0] = v70 + 0.3;
        v71 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueRight;
        v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityRight;
LABEL_95:
        v6.n64_f32[0] = v45 + v6.n64_f32[0];
        LODWORD(pSound->m_EmittedVolume) = vmin_f32(v6, v5).n64_u32[0];
        *v71 = v45;
        goto LABEL_96;
      }
      if ( v70 <= v5.n64_f32[0] )
      {
        v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityRight;
LABEL_96:
        *v72 = refEntityPtr;
        pSound->m_RelativeFrequency = v44;
        return;
      }
      v4.n64_f32[0] = v70 + -0.3;
      v5.n64_f32[0] = CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueRight;
      if ( CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueRight > 0.0 )
      {
        v6.n64_u32[0] = 1067869798;
        LODWORD(v73) = vmin_f32(v5, v6).n64_u32[0];
        v74 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::fCityNoiseVolumeBoostResidueRight;
        v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityRight;
LABEL_101:
        v82 = v5.n64_f32[0] - v73;
        if ( (float)(v4.n64_f32[0] - v73) > (float)(v7.n64_f32[0] - v73) )
          v7.n64_u32[0] = v4.n64_u32[0];
        pSound->m_EmittedVolume = v7.n64_f32[0] - v73;
        *v74 = v82;
        goto LABEL_96;
      }
      v72 = &CAEWeatherAudioEntity::UpdateParameters(CAESound *,short)::pLastEntityRight;
    }
    LODWORD(pSound->m_EmittedVolume) = vmax_f32(v4, v7).n64_u32[0];
    goto LABEL_96;
  }
  if ( m_AudioEvent == 1 )
  {
    v12 = CWeather::LightningDuration;
    v13 = CAEAudioEntity::m_pAudioEventVolumes[141];
    v14 = log10f((float)((float)((float)CWeather::LightningDuration * 0.75) / 20.0) + 0.25) * 20.0;
    v15 = 500 * (1 - v12 / 0x14);
    v8.n64_f32[0] = v14 + (float)v13;
    v16 = v15 + 100;
    if ( v15 + 100 >= v9 )
    {
      pSound->m_EmittedVolume = v8.n64_f32[0] + (float)(log10f((float)(int)v9 / (float)v16) * 20.0);
      return;
    }
    if ( v8.n64_f32[0] > 0.0 && v15 + 300 >= v9 )
    {
      v17 = powf(10.0, v8.n64_f32[0] / 20.0);
      pSound->m_EmittedVolume = log10f(v17 + (float)((float)((float)(1.0 - v17) * (float)(v9 - v16)) / 200.0)) * 20.0;
      return;
    }
    v3.n64_u32[0] = 0;
    v29 = vmin_f32(v8, v3).n64_u32[0];
    goto LABEL_45;
  }
}
// 3BBDAA: variable 'v4' is possibly undefined
// 3BBDAA: variable 'v8' is possibly undefined
// 3BBDAE: variable 'v7' is possibly undefined
// 3BBE36: variable 'v6' is possibly undefined
// 3BBE36: variable 'v5' is possibly undefined
// 3BBE64: variable 'v3' is possibly undefined

//----- (003BC6D4) --------------------------------------------------------
void __fastcall CAEWeatherAudioEntity::AddAudioEvent(CAEWeatherAudioEntity *this, tAudioEvent AudioEvent)
{
  float32x2_t v2; // d1
  float32x2_t v3; // d3
  bool v5; // zf
  int v6; // r0
  float *v7; // r10
  float Volume; // s18
  CVector Position; // [sp+0h] [bp-E0h]
  CVector Positiona; // [sp+0h] [bp-E0h]
  CVector Positionb; // [sp+0h] [bp-E0h]
  CVector Positionc; // [sp+0h] [bp-E0h]
  float v13; // [sp+2Ch] [bp-B4h]
  int v14; // [sp+30h] [bp-B0h]
  CAESound v15; // [sp+34h] [bp-ACh] BYREF

  v5 = AudioEvent == 141;
  v15.m_pPhysicalEntity = 0;
  if ( AudioEvent == 141 )
    v5 = CGame::currArea == AREA_MAIN_MAP;
  if ( v5 && !CCullZones::PlayerNoRain() && !CCullZones::CamNoRain() )
  {
    if ( CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x34u, 4) )
    {
      v14 = CAEAudioEntity::m_pAudioEventVolumes[141];
      v13 = log10f((float)((float)((float)CWeather::LightningDuration * 0.75) / 20.0) + 0.25);
      v6 = (this->m_nLastThunderFrequencyIndex + 1) % 3;
      this->m_nLastThunderFrequencyIndex = v6;
      v7 = &gfThunderFrequencyVariations[v6];
      Position.x = -0.906;
      *(_QWORD *)&Position.y = 1054380917LL;
      CAESound::Initialise(&v15, 4, 4, this, Position, -100.0, 1.0, (float)(*v7 * 0.4) * 0.8909, 1.0, 0, 7u, 0.0, 0);
      v15.m_AudioEvent = 1;
      CAESoundManager::RequestNewSound(&AESoundManager, &v15);
      Positiona.z = 0.0;
      *(_QWORD *)&Positiona.x = 0x3ED893753F67EF9ELL;
      CAESound::Initialise(&v15, 4, 4, this, Positiona, -100.0, 1.0, *v7 * 0.4, 1.0, 0, 7u, 0.0, 0);
      v15.m_AudioEvent = 1;
      CAESoundManager::RequestNewSound(&AESoundManager, &v15);
      v3.n64_u32[0] = 0;
      Positionb.x = -0.906;
      v2.n64_f32[0] = (float)(v13 * 20.0) + (float)v14;
      LODWORD(Volume) = vmin_f32(v2, v3).n64_u32[0];
      *(_QWORD *)&Positionb.y = 1054380917LL;
      CAESound::Initialise(
        &v15,
        4,
        1,
        this,
        Positionb,
        Volume,
        1.0,
        (float)(*v7 * 0.4) * 0.8909,
        1.0,
        0,
        0x407u,
        0.0,
        0);
      v15.m_AudioEvent = 2;
      CAESoundManager::RequestNewSound(&AESoundManager, &v15);
      Positionc.z = 0.0;
      *(_QWORD *)&Positionc.x = 0x3ED893753F67EF9ELL;
      CAESound::Initialise(&v15, 4, 1, this, Positionc, Volume, 1.0, *v7 * 0.4, 1.0, 0, 0x407u, 0.0, 0);
      v15.m_AudioEvent = 2;
      CAESoundManager::RequestNewSound(&AESoundManager, &v15);
    }
    else
    {
      CAEAudioHardware::LoadSoundBank(&AEAudioHardware, 0x34u, 4);
    }
  }
  CAESound::~CAESound(&v15);
}
// 3BC8A2: variable 'v2' is possibly undefined
// 3BC8A2: variable 'v3' is possibly undefined

//----- (003BC964) --------------------------------------------------------
void __fastcall CAudioEngine::Service(CAudioEngine *this)
{
  CAEFrontendAudioEntity *p_m_FrontendAudioEntity; // r5
  int TrackPlayTime; // r5
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  CAEGlobalWeaponAudioEntity *m_pGlobalWeaponAudioEntity; // r0
  int v6; // r1

  p_m_FrontendAudioEntity = &this->m_FrontendAudioEntity;
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 31, 0.0, 1.0);
  if ( !((CTimer::m_UserPause || CTimer::m_CodePause) << 24) )
    CAEFrontendAudioEntity::AddAudioEvent(p_m_FrontendAudioEntity, 36, 0.0, 1.0);
  TrackPlayTime = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
  CAEAudioHardware::GetChannelPlayTimes(&AEAudioHardware, this->m_nAudioStreamClientHandle, 0);
  if ( TrackPlayTime == -4 && this->m_bPlayingMissionCompleteTrack )
  {
    this->m_bStoppingMissionCompleteTrack = 1;
  }
  else if ( TrackPlayTime == -6 )
  {
    if ( this->m_bStoppingMissionCompleteTrack )
    {
      this->m_bStoppingMissionCompleteTrack = 0;
      if ( CAERadioTrackManager::IsVehicleRadioActive(&AERadioTrackManager) )
      {
        PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
        CAERadioTrackManager::StartRadio(&AERadioTrackManager, PlayerVehicleAudioSettingsForRadio);
      }
    }
  }
  CAECutsceneTrackManager::Service(&AECutsceneTrackManager, TrackPlayTime);
  CAEAmbienceTrackManager::Service(&AEAmbienceTrackManager, TrackPlayTime);
  CAERadioTrackManager::Service(&AERadioTrackManager, TrackPlayTime);
  if ( FindPlayerPed(0) )
  {
    m_pGlobalWeaponAudioEntity = this->m_pGlobalWeaponAudioEntity;
    if ( m_pGlobalWeaponAudioEntity )
      CAEGlobalWeaponAudioEntity::ServiceAmbientGunFire(m_pGlobalWeaponAudioEntity);
  }
  CAECollisionAudioEntity::Service(&this->m_CollisionAudioEntity);
  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 )
  {
    CAEAudioHardware::SetMusicFaderScalingFactor(&AEAudioHardware, 1.0);
    CAEAudioHardware::SetEffectsFaderScalingFactor(&AEAudioHardware, 1.0);
  }
  else if ( CCutsceneMgr::ms_running )
  {
    v6 = 0;
    goto LABEL_18;
  }
  v6 = 1065353216;
LABEL_18:
  CAEAudioHardware::SetNonStreamFaderScalingFactor(&AEAudioHardware, *(float *)&v6);
  CAEScriptAudioEntity::Service(&this->m_ScriptAudioEntity);
  CAEPedSpeechAudioEntity::Service();
  CAESoundManager::Service(&AESoundManager);
  sub_196B3C();
}

//----- (003BCAEC) --------------------------------------------------------
void __fastcall CAudioEngine::ReportFrontendAudioEvent(
        CAudioEngine *this,
        tAudioEvent AudioEvent,
        float fVolumeOffsetdB,
        float fFrequencyScaling)
{
  sub_197900(&this->m_FrontendAudioEntity, AudioEvent, fVolumeOffsetdB, fFrequencyScaling);
}

//----- (003BCAF4) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsVehicleRadioActive(CAudioEngine *this)
{
  return sub_19B248(&AERadioTrackManager);
}

//----- (003BCB04) --------------------------------------------------------
void __fastcall CAudioEngine::SetMusicFaderScalingFactor(CAudioEngine *this, float fScalingFactor)
{
  sub_18A7F4(&AEAudioHardware, fScalingFactor);
}

//----- (003BCB14) --------------------------------------------------------
void __fastcall CAudioEngine::SetEffectsFaderScalingFactor(CAudioEngine *this, float fScalingFactor)
{
  sub_1902C0(&AEAudioHardware, fScalingFactor);
}

//----- (003BCB24) --------------------------------------------------------
void __fastcall CAudioEngine::SetNonStreamFaderScalingFactor(CAudioEngine *this, float fScalingFactor)
{
  sub_18B374(&AEAudioHardware, fScalingFactor);
}

//----- (003BCB34) --------------------------------------------------------
void __fastcall CAudioEngine::ServiceLoadingTune(CAudioEngine *this, float fVolume)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d8

  v3.n64_f32[0] = fVolume;
  v2.n64_u32[0] = CAEAudioHardware::GetEffectsFaderScalingFactor(&AEAudioHardware);
  if ( v2.n64_f32[0] < v3.n64_f32[0] )
  {
    v2.n64_f32[0] = v2.n64_f32[0] + 0.005;
    v3.n64_u32[0] = vmin_f32(v2, v3).n64_u32[0];
  }
  CAEAudioHardware::SetEffectsFaderScalingFactor(&AEAudioHardware, v3.n64_f32[0]);
  sub_19113C(&AESoundManager);
}
// 3BCB66: variable 'v2' is possibly undefined
// 3BCB66: variable 'v3' is possibly undefined

//----- (003BCB94) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsLoadingTuneActive(CAudioEngine *this)
{
  return sub_18EAE0(&this->m_FrontendAudioEntity);
}

//----- (003BCB9C) --------------------------------------------------------
bool IsPostLoading()
{
  _BOOL4 v0; // r0

  if ( isPostLoading )
  {
    if ( OS_TimeMS() <= PostLoadingTimer )
    {
      v0 = isPostLoading;
    }
    else
    {
      v0 = 0;
      isPostLoading = 0;
    }
  }
  else
  {
    v0 = 0;
  }
  return (v0 || TheCamera.m_WideScreenOn) << 24
      || CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) != 0;
}

//----- (003BCC10) --------------------------------------------------------
void __fastcall SetPostLoadingTimer(int ms)
{
  isPostLoading = 1;
  PostLoadingTimer = OS_TimeMS() + ms;
}

//----- (003BCC38) --------------------------------------------------------
void __fastcall CAudioEngine::InitialisePostLoading(CAudioEngine *this)
{
  int v2; // r5
  CPhysical *v3; // r0
  int v4; // r0

  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 51, 0.0, 1.0);
  CAudioEngine::Service(&AudioEngine);
  CAECollisionAudioEntity::InitialisePostLoading(&this->m_CollisionAudioEntity);
  v2 = operator new(0xA8u);
  *(_DWORD *)(v2 + 16) = 0;
  *(_BYTE *)(v2 + 126) = 0;
  *(_WORD *)(v2 + 124) = 0;
  *(_DWORD *)v2 = &off_6677E0;
  *(_BYTE *)(v2 + 164) = 0;
  *(_QWORD *)(v2 + 144) = 0LL;
  *(_QWORD *)(v2 + 152) = 0LL;
  *(_QWORD *)(v2 + 132) = 0LL;
  *(_QWORD *)(v2 + 140) = 0LL;
  v3 = (CPhysical *)operator new(0x13Cu);
  CPhysical::CPhysical(v3);
  *(_DWORD *)(v2 + 160) = v4;
  this->m_pGlobalWeaponAudioEntity = (CAEGlobalWeaponAudioEntity *)v2;
  CAEWeaponAudioEntity::Initialise((CAEWeaponAudioEntity *)v2);
  OS_TimeMS();
  while ( !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x27u, 2)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x1Bu, 3)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Au, 19)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0, 41)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x3Bu, 0)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x34u, 4)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x8Fu, 5)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x33u, 31)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x69u, 6)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x4Au, 17)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0x80u, 32)
       || !CAEAudioHardware::IsSoundBankLoaded(&AEAudioHardware, 0xDu, 18) )
  {
    OS_ThreadSleep(20000);
    CAEAudioHardware::Service(&AEAudioHardware);
  }
}
// 3BCCA8: variable 'v4' is possibly undefined
// 6677E0: using guessed type void *off_6677E0;

//----- (003BCE1C) --------------------------------------------------------
void __fastcall CAudioEngine::Reset(CAudioEngine *this)
{
  int TrackPlayTime; // r0
  CAudioEngine *IsAmbienceTrackActive; // r0
  CAEGlobalWeaponAudioEntity *m_pGlobalWeaponAudioEntity; // r0
  int v5; // r0

  CAESoundManager::Service(&AESoundManager);
  if ( CAERadioTrackManager::IsRadioOn(&AERadioTrackManager) )
  {
    CAERadioTrackManager::StopRadio(&AERadioTrackManager, 0, 1u);
    while ( CAERadioTrackManager::IsRadioOn(&AERadioTrackManager) )
    {
      TrackPlayTime = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
      CAERadioTrackManager::Service(&AERadioTrackManager, TrackPlayTime);
      CAEAudioHardware::Service(&AEAudioHardware);
      OS_ThreadSleep(2000);
    }
  }
  else
  {
    IsAmbienceTrackActive = (CAudioEngine *)CAEAmbienceTrackManager::IsAmbienceTrackActive(&AEAmbienceTrackManager);
    if ( IsAmbienceTrackActive )
    {
      CAudioEngine::StopAmbienceTrack(IsAmbienceTrackActive, 1u);
      CAEAmbienceTrackManager::StopSpecialMissionAmbienceTrack(&AEAmbienceTrackManager);
    }
    else if ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
    {
      CAECutsceneTrackManager::StopCutsceneTrack(&AECutsceneTrackManager);
      while ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
      {
        v5 = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
        CAECutsceneTrackManager::Service(&AECutsceneTrackManager, v5);
        CAEAudioHardware::Service(&AEAudioHardware);
        OS_ThreadSleep(2000);
      }
    }
  }
  CAECollisionAudioEntity::Reset(&this->m_CollisionAudioEntity);
  CAERadioTrackManager::Reset(&AERadioTrackManager);
  CAEAmbienceTrackManager::Reset(&AEAmbienceTrackManager);
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 36, 0.0, 1.0);
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 35, 0.0, 1.0);
  CAEFrontendAudioEntity::Reset(&this->m_FrontendAudioEntity);
  CAEScriptAudioEntity::Reset(&this->m_ScriptAudioEntity);
  m_pGlobalWeaponAudioEntity = this->m_pGlobalWeaponAudioEntity;
  if ( m_pGlobalWeaponAudioEntity )
    CAEWeaponAudioEntity::Reset(m_pGlobalWeaponAudioEntity);
  CAEWeatherAudioEntity::StaticReset();
  CAEPedSpeechAudioEntity::Reset();
  CAEPoliceScannerAudioEntity::Reset();
  CAESoundManager::Reset(&AESoundManager);
  CAESoundManager::Service(&AESoundManager);
  CAESoundManager::PauseManually(&AESoundManager, 1u);
  this->m_nActiveRadioStationBeforeCutscene = -1;
  *(_WORD *)&this->m_bPlayingMissionCompleteTrack = 0;
}

//----- (003BCFC4) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsRadioOn(CAudioEngine *this)
{
  return sub_195A58(&AERadioTrackManager);
}

//----- (003BCFD4) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsAmbienceTrackActive(CAudioEngine *this)
{
  return sub_19FD20(&AEAmbienceTrackManager);
}

//----- (003BCFE4) --------------------------------------------------------
void __fastcall CAudioEngine::StopAmbienceTrack(CAudioEngine *this, Bool8 bWaitForFinish)
{
  int v2; // r4
  int TrackPlayTime; // r0

  v2 = bWaitForFinish;
  CAEAmbienceTrackManager::StopAmbienceTrack(&AEAmbienceTrackManager);
  if ( v2 && CAEAmbienceTrackManager::IsAmbienceTrackActive(&AEAmbienceTrackManager) )
  {
    do
    {
      TrackPlayTime = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
      CAEAmbienceTrackManager::Service(&AEAmbienceTrackManager, TrackPlayTime);
      CAEAudioHardware::Service(&AEAudioHardware);
      OS_ThreadSleep(2000);
    }
    while ( CAEAmbienceTrackManager::IsAmbienceTrackActive(&AEAmbienceTrackManager) );
  }
}

//----- (003BD04C) --------------------------------------------------------
void __fastcall CAudioEngine::ResetSoundEffects(CAudioEngine *this)
{
  CAESoundManager::Service(&AESoundManager);
  CAECollisionAudioEntity::Reset(&this->m_CollisionAudioEntity);
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 36, 0.0, 1.0);
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 35, 0.0, 1.0);
  CAEFrontendAudioEntity::Reset(&this->m_FrontendAudioEntity);
  CAEScriptAudioEntity::Reset(&this->m_ScriptAudioEntity);
  CAEWeatherAudioEntity::StaticReset();
  CAEPedSpeechAudioEntity::Reset();
  CAESoundManager::Reset(&AESoundManager);
  CAESoundManager::Service(&AESoundManager);
  j_CAESoundManager::PauseManually(&AESoundManager, 1u);
}

//----- (003BD0C0) --------------------------------------------------------
void __fastcall CAudioEngine::ResetStatistics(CAudioEngine *this)
{
  sub_19A7E8(&AERadioTrackManager);
}

//----- (003BD0D0) --------------------------------------------------------
void __fastcall CAudioEngine::Restart(CAudioEngine *this)
{
  j_CAESoundManager::PauseManually(&AESoundManager, 0);
}

//----- (003BD0E0) --------------------------------------------------------
void __fastcall CAudioEngine::Shutdown(CAudioEngine *this)
{
  CAudioEngine *IsAmbienceTrackActive; // r0
  CAEGlobalWeaponAudioEntity *m_pGlobalWeaponAudioEntity; // r4
  CPhysical *m_pGunFirePhysical; // r0

  if ( CAERadioTrackManager::IsRadioOn(&AERadioTrackManager) )
  {
    CAERadioTrackManager::StopRadio(&AERadioTrackManager, 0, 1u);
  }
  else
  {
    IsAmbienceTrackActive = (CAudioEngine *)CAEAmbienceTrackManager::IsAmbienceTrackActive(&AEAmbienceTrackManager);
    if ( IsAmbienceTrackActive )
    {
      CAudioEngine::StopAmbienceTrack(IsAmbienceTrackActive, 1u);
    }
    else if ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
    {
      CAECutsceneTrackManager::StopCutsceneTrack(&AECutsceneTrackManager);
    }
  }
  CAECollisionAudioEntity::Reset(&this->m_CollisionAudioEntity);
  CAERadioTrackManager::Reset(&AERadioTrackManager);
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 36, 0.0, 1.0);
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 35, 0.0, 1.0);
  CAEFrontendAudioEntity::Reset(&this->m_FrontendAudioEntity);
  CAEScriptAudioEntity::Reset(&this->m_ScriptAudioEntity);
  CAEWeatherAudioEntity::StaticReset();
  CAEPedSpeechAudioEntity::Reset();
  m_pGlobalWeaponAudioEntity = this->m_pGlobalWeaponAudioEntity;
  if ( m_pGlobalWeaponAudioEntity )
  {
    m_pGunFirePhysical = m_pGlobalWeaponAudioEntity->m_pGunFirePhysical;
    m_pGlobalWeaponAudioEntity->_vptr$CAEAudioEntity = (int (**)(void))&off_6677E0;
    if ( m_pGunFirePhysical )
      (*((void (__fastcall **)(CPhysical *))m_pGunFirePhysical->_vptr$CPlaceable + 1))(m_pGunFirePhysical);
    m_pGlobalWeaponAudioEntity->_vptr$CAEAudioEntity = (int (**)(void))&off_667798;
    CAESound::~CAESound(&m_pGlobalWeaponAudioEntity->ScratchSound);
    operator delete(m_pGlobalWeaponAudioEntity);
  }
  CAESoundManager::Reset(&AESoundManager);
  CAESoundManager::Terminate(&AESoundManager);
  CAEAudioHardware::Terminate(&AEAudioHardware);
  if ( CAEAudioEntity::m_pAudioEventVolumes )
    operator delete[](CAEAudioEntity::m_pAudioEventVolumes);
  CAEAudioEntity::m_pAudioEventVolumes = 0;
}
// 667798: using guessed type void *off_667798;
// 6677E0: using guessed type void *;

//----- (003BD218) --------------------------------------------------------
void __fastcall CAudioEngine::SetMusicMasterVolume(CAudioEngine *this, Int8 Volume)
{
  sub_18A71C(&AEAudioHardware, (float)Volume * 0.015625);
}

//----- (003BD240) --------------------------------------------------------
void __fastcall CAudioEngine::SetEffectsMasterVolume(CAudioEngine *this, Int8 Volume)
{
  sub_19F828(&AEAudioHardware, (float)Volume * 0.015625);
}

//----- (003BD268) --------------------------------------------------------
void __fastcall CAudioEngine::SetStreamFaderScalingFactor(CAudioEngine *this, float fScalingFactor)
{
  sub_199A54(&AEAudioHardware, fScalingFactor);
}

//----- (003BD278) --------------------------------------------------------
void __fastcall CAudioEngine::DisableEffectsLoading(CAudioEngine *this)
{
  sub_19CCE8(&AEAudioHardware);
}

//----- (003BD288) --------------------------------------------------------
void __fastcall CAudioEngine::EnableEffectsLoading(CAudioEngine *this)
{
  sub_19F00C(&AEAudioHardware);
}

//----- (003BD298) --------------------------------------------------------
void __fastcall CAudioEngine::ReportCollision(
        CAudioEngine *this,
        CEntity *pEntityA,
        CEntity *pEntityB,
        UInt8 SurfaceA,
        int SurfaceB,
        CVector *vPosition,
        CVector *pvNormal,
        float fImpulseMagnitude,
        float fRelVelSqr,
        int bForceOneShot,
        int bForceLooping)
{
  CAECollisionAudioEntity::ReportCollision(
    &this->m_CollisionAudioEntity,
    pEntityA,
    pEntityB,
    SurfaceA,
    SurfaceB,
    vPosition,
    pvNormal,
    fImpulseMagnitude,
    fRelVelSqr,
    bForceOneShot,
    bForceLooping);
}

//----- (003BD2DA) --------------------------------------------------------
void __fastcall CAudioEngine::ReportBulletHit(
        CAudioEngine *this,
        CEntity *pHitEntity,
        UInt8 HitSurface,
        CVector *vPosition,
        float fAngleOfIncidence)
{
  sub_1914E4(&this->m_CollisionAudioEntity, pHitEntity, HitSurface, vPosition, fAngleOfIncidence);
}

//----- (003BD2E2) --------------------------------------------------------
void __fastcall CAudioEngine::ReportObjectDestruction(CAudioEngine *this, CEntity *pEntity)
{
  sub_194B3C(&this->m_CollisionAudioEntity, pEntity);
}

//----- (003BD2EA) --------------------------------------------------------
void __fastcall CAudioEngine::ReportGlassCollisionEvent(CAudioEngine *this, tAudioEvent AudioEvent, CVector *vPosition)
{
  sub_18A558(&this->m_CollisionAudioEntity, AudioEvent, vPosition, 0);
}

//----- (003BD2F4) --------------------------------------------------------
void __fastcall CAudioEngine::ReportWaterSplash(
        CAudioEngine *this,
        CPhysical *pPhysical,
        float fForcedVolumeOffsetdB,
        Bool8 bForceSplash)
{
  sub_19CB98(&this->m_CollisionAudioEntity, pPhysical, fForcedVolumeOffsetdB, bForceSplash);
}

//----- (003BD2FC) --------------------------------------------------------
void __fastcall CAudioEngine::ReportWaterSplash(CAudioEngine *this, CVector vPosition, float fForcedVolumeOffsetdB)
{
  sub_194ABC(&this->m_CollisionAudioEntity, vPosition, fForcedVolumeOffsetdB);
}

//----- (003BD304) --------------------------------------------------------
void __fastcall CAudioEngine::ReportWeaponEvent(
        CAudioEngine *this,
        tAudioEvent AudioEvent,
        eWeaponType WeaponType,
        CPhysical *pParentPhysical)
{
  sub_1903E4(this->m_pGlobalWeaponAudioEntity, AudioEvent, WeaponType, pParentPhysical);
}

//----- (003BD310) --------------------------------------------------------
void __fastcall CAudioEngine::ReportDoorMovement(CAudioEngine *this, CPhysical *pDoor)
{
  sub_19D3D0(&this->m_GlobalDoorAudioEntity, 163, pDoor);
}

//----- (003BD320) --------------------------------------------------------
void __fastcall CAudioEngine::StartRadio(CAudioEngine *this, Int8 Station, Int8 BassSetting)
{
  if ( !CAECutsceneTrackManager::GetCutsceneTrackStatus(&AECutsceneTrackManager) )
    CAERadioTrackManager::StartRadio(&AERadioTrackManager, Station, BassSetting, 0.0, 0);
}

//----- (003BD35C) --------------------------------------------------------
Int8 __fastcall CAudioEngine::GetBeatTrackStatus(CAudioEngine *this)
{
  return sub_19D6E0(&AECutsceneTrackManager);
}

//----- (003BD36C) --------------------------------------------------------
void __fastcall CAudioEngine::StartRadio(CAudioEngine *this, tVehicleAudioSettings *pSettings)
{
  if ( !CAECutsceneTrackManager::GetCutsceneTrackStatus(&AECutsceneTrackManager) || this->m_bPlayingMissionCompleteTrack )
    sub_18D5D8(&AERadioTrackManager, pSettings);
}

//----- (003BD3A0) --------------------------------------------------------
void __fastcall CAudioEngine::StopRadio(CAudioEngine *this, tVehicleAudioSettings *pSettings, Bool8 bForceStop)
{
  sub_192AC8(&AERadioTrackManager, pSettings, bForceStop);
}

//----- (003BD3B0) --------------------------------------------------------
void __fastcall CAudioEngine::RetuneRadio(CAudioEngine *this, Int8 Station)
{
  if ( !CAECutsceneTrackManager::GetCutsceneTrackStatus(&AECutsceneTrackManager) )
    sub_19C2E0(&AERadioTrackManager, Station);
}

//----- (003BD3E0) --------------------------------------------------------
void __fastcall CAudioEngine::SetRadioAutoRetuneOnOff(CAudioEngine *this, Bool8 On)
{
  sub_18B43C(&AERadioTrackManager, On);
}

//----- (003BD3F0) --------------------------------------------------------
void __fastcall CAudioEngine::SetBassEnhanceOnOff(CAudioEngine *this, Bool8 On)
{
  sub_19FD78(&AERadioTrackManager, On);
}

//----- (003BD400) --------------------------------------------------------
void __fastcall CAudioEngine::SetRadioBassSetting(CAudioEngine *this, Int8 Setting)
{
  sub_189E9C(&AERadioTrackManager, Setting, 1.0);
}

//----- (003BD414) --------------------------------------------------------
void __fastcall CAudioEngine::InitialiseRadioStationID(CAudioEngine *this, Int8 Station)
{
  sub_19C71C(&AERadioTrackManager, Station);
}

//----- (003BD424) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::HasRadioRetuneJustStarted(CAudioEngine *this)
{
  return sub_19E4DC(&AERadioTrackManager);
}

//----- (003BD434) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsRadioRetuneInProgress(CAudioEngine *this)
{
  return sub_19FBAC(&this->m_FrontendAudioEntity);
}

//----- (003BD43C) --------------------------------------------------------
GxtChar *__fastcall CAudioEngine::GetRadioStationName(CAudioEngine *this, Int8 Station)
{
  return sub_197F6C(&AERadioTrackManager, Station);
}

//----- (003BD44C) --------------------------------------------------------
void __fastcall CAudioEngine::GetRadioStationNameKey(CAudioEngine *this, Int8 Station, unsigned __int8 *KeyName)
{
  sub_193390(&AERadioTrackManager, Station, KeyName);
}

//----- (003BD45C) --------------------------------------------------------
Int32 *__fastcall CAudioEngine::GetRadioStationListenTimes(CAudioEngine *this)
{
  return sub_19BBA8(&AERadioTrackManager);
}

//----- (003BD46C) --------------------------------------------------------
void __fastcall CAudioEngine::DisplayRadioStationName(CAudioEngine *this)
{
  sub_1921B4(&AERadioTrackManager);
}

//----- (003BD47C) --------------------------------------------------------
Int8 __fastcall CAudioEngine::GetCurrentRadioStationID(CAudioEngine *this)
{
  return sub_18B0B8(&AERadioTrackManager);
}

//----- (003BD490) --------------------------------------------------------
void __fastcall CAudioEngine::PreloadCutsceneTrack(CAudioEngine *this, Int16 TrackID, Bool8 bWaitForPreload)
{
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  int TrackPlayTime; // r0
  CAudioEngine *IsAmbienceTrackActive; // r0
  int v9; // r0

  if ( CAERadioTrackManager::IsRadioOn(&AERadioTrackManager) )
  {
    this->m_nActiveRadioStationBeforeCutscene = CAERadioTrackManager::GetCurrentRadioStationID(&AERadioTrackManager);
    PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
    CAERadioTrackManager::StopRadio(&AERadioTrackManager, PlayerVehicleAudioSettingsForRadio, 1u);
    CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 35, 0.0, 1.0);
    while ( CAERadioTrackManager::IsRadioOn(&AERadioTrackManager) )
    {
      TrackPlayTime = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
      CAERadioTrackManager::Service(&AERadioTrackManager, TrackPlayTime);
      CAEAudioHardware::Service(&AEAudioHardware);
      OS_ThreadSleep(2000);
    }
  }
  else
  {
    IsAmbienceTrackActive = (CAudioEngine *)CAEAmbienceTrackManager::IsAmbienceTrackActive(&AEAmbienceTrackManager);
    if ( IsAmbienceTrackActive )
    {
      CAudioEngine::StopAmbienceTrack(IsAmbienceTrackActive, 1u);
    }
    else
    {
      if ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
        CAECutsceneTrackManager::StopCutsceneTrack(&AECutsceneTrackManager);
      while ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
      {
        v9 = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
        CAECutsceneTrackManager::Service(&AECutsceneTrackManager, v9);
        CAEAudioHardware::Service(&AEAudioHardware);
        OS_ThreadSleep(2000);
      }
    }
  }
  sub_18D818(&AECutsceneTrackManager, TrackID, bWaitForPreload);
}

//----- (003BD5C0) --------------------------------------------------------
void __fastcall CAudioEngine::PlayPreloadedCutsceneTrack(CAudioEngine *this)
{
  sub_1931E8(&AECutsceneTrackManager);
}

//----- (003BD5D0) --------------------------------------------------------
void __fastcall CAudioEngine::StopCutsceneTrack(CAudioEngine *this, Bool8 bWaitForFinish)
{
  int v3; // r5
  int TrackPlayTime; // r0
  int m_nActiveRadioStationBeforeCutscene; // r5
  int IsVehicleRadioActive; // r0
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0

  v3 = bWaitForFinish;
  CAECutsceneTrackManager::StopCutsceneTrack(&AECutsceneTrackManager);
  if ( v3 )
  {
    while ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
    {
      TrackPlayTime = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
      CAECutsceneTrackManager::Service(&AECutsceneTrackManager, TrackPlayTime);
      CAEAudioHardware::Service(&AEAudioHardware);
      OS_ThreadSleep(2000);
    }
    m_nActiveRadioStationBeforeCutscene = this->m_nActiveRadioStationBeforeCutscene;
    IsVehicleRadioActive = CAERadioTrackManager::IsVehicleRadioActive(&AERadioTrackManager);
    if ( m_nActiveRadioStationBeforeCutscene < 0 )
    {
      if ( IsVehicleRadioActive )
      {
        PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
        CAERadioTrackManager::StartRadio(&AERadioTrackManager, PlayerVehicleAudioSettingsForRadio);
      }
    }
    else
    {
      if ( IsVehicleRadioActive )
        CAERadioTrackManager::StartRadio(&AERadioTrackManager, this->m_nActiveRadioStationBeforeCutscene, 0, 0.0, 0);
      this->m_nActiveRadioStationBeforeCutscene = -1;
    }
  }
  else
  {
    if ( !this->m_bPlayingMissionCompleteTrack )
      return;
    this->m_bStoppingMissionCompleteTrack = 1;
  }
  this->m_bPlayingMissionCompleteTrack = 0;
}

//----- (003BD69C) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsCutsceneTrackActive(CAudioEngine *this)
{
  return sub_195E8C(&AECutsceneTrackManager);
}

//----- (003BD6AC) --------------------------------------------------------
Int8 __fastcall CAudioEngine::GetCutsceneTrackStatus(CAudioEngine *this)
{
  return sub_19D6E0(&AECutsceneTrackManager);
}

//----- (003BD6BC) --------------------------------------------------------
void __fastcall CAudioEngine::PreloadBeatTrack(CAudioEngine *this, Int16 BeatTrack)
{
  tVehicleAudioSettings *PlayerVehicleAudioSettingsForRadio; // r0
  int TrackPlayTime; // r0
  CAudioEngine *IsAmbienceTrackActive; // r0
  int v7; // r0

  if ( CAERadioTrackManager::IsRadioOn(&AERadioTrackManager) )
  {
    this->m_nActiveRadioStationBeforeCutscene = CAERadioTrackManager::GetCurrentRadioStationID(&AERadioTrackManager);
    PlayerVehicleAudioSettingsForRadio = CAEVehicleAudioEntity::StaticGetPlayerVehicleAudioSettingsForRadio();
    CAERadioTrackManager::StopRadio(&AERadioTrackManager, PlayerVehicleAudioSettingsForRadio, 1u);
    CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 35, 0.0, 1.0);
    while ( CAERadioTrackManager::IsRadioOn(&AERadioTrackManager) )
    {
      TrackPlayTime = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
      CAERadioTrackManager::Service(&AERadioTrackManager, TrackPlayTime);
      CAEAudioHardware::Service(&AEAudioHardware);
      OS_ThreadSleep(2000);
    }
  }
  else
  {
    IsAmbienceTrackActive = (CAudioEngine *)CAEAmbienceTrackManager::IsAmbienceTrackActive(&AEAmbienceTrackManager);
    if ( IsAmbienceTrackActive )
    {
      CAudioEngine::StopAmbienceTrack(IsAmbienceTrackActive, 1u);
    }
    else
    {
      if ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
        CAECutsceneTrackManager::StopCutsceneTrack(&AECutsceneTrackManager);
      while ( CAECutsceneTrackManager::IsCutsceneTrackActive(&AECutsceneTrackManager) )
      {
        v7 = CAEAudioHardware::GetTrackPlayTime(&AEAudioHardware);
        CAECutsceneTrackManager::Service(&AECutsceneTrackManager, v7);
        CAEAudioHardware::Service(&AEAudioHardware);
        OS_ThreadSleep(2000);
      }
    }
  }
  sub_19B868(&AECutsceneTrackManager, BeatTrack, 0);
}

//----- (003BD7E8) --------------------------------------------------------
void __fastcall CAudioEngine::PlayPreloadedBeatTrack(CAudioEngine *this, Bool8 bIsMissionComplete)
{
  CAECutsceneTrackManager::PlayPreloadedCutsceneTrack(&AECutsceneTrackManager);
  this->m_bPlayingMissionCompleteTrack = bIsMissionComplete;
}

//----- (003BD804) --------------------------------------------------------
void __fastcall CAudioEngine::StopBeatTrack(CAudioEngine *this)
{
  CAudioEngine::StopCutsceneTrack(this, 1u);
}

//----- (003BD808) --------------------------------------------------------
tBeatInfo *__fastcall CAudioEngine::GetBeatInfo(CAudioEngine *this)
{
  tBeatInfo *p_m_BeatInfo; // r4

  p_m_BeatInfo = &this->m_BeatInfo;
  CAEAudioHardware::GetBeatInfo(&AEAudioHardware, &this->m_BeatInfo);
  return p_m_BeatInfo;
}

//----- (003BD828) --------------------------------------------------------
bool __fastcall CAudioEngine::IsBeatInfoPresent(CAudioEngine *this)
{
  CAEAudioHardware::GetBeatInfo(&AEAudioHardware, &this->m_BeatInfo);
  return this->m_BeatInfo.bBeatInfoPresent != 0;
}

//----- (003BD84C) --------------------------------------------------------
void __fastcall CAudioEngine::PauseBeatTrack(CAudioEngine *this, Bool8 On)
{
  sub_1912DC(&AECutsceneTrackManager, On);
}

//----- (003BD85C) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::DoesAmbienceTrackOverrideRadio(CAudioEngine *this)
{
  return AEAmbienceTrackManager.m_bOverrideRadio;
}

//----- (003BD86C) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsAmbienceRadioActive(CAudioEngine *this)
{
  return sub_193100(&AEAmbienceTrackManager);
}

//----- (003BD87C) --------------------------------------------------------
void __fastcall CAudioEngine::PreloadMissionAudio(CAudioEngine *this, UInt8 Slot, tAudioEvent ScriptSlotAudioEvent)
{
  sub_199438(&this->m_ScriptAudioEntity, Slot, ScriptSlotAudioEvent);
}

//----- (003BD884) --------------------------------------------------------
UInt8 __fastcall CAudioEngine::GetMissionAudioLoadingStatus(CAudioEngine *this, UInt8 Slot)
{
  return j_CAEScriptAudioEntity::GetMissionAudioLoadingStatus(&this->m_ScriptAudioEntity, Slot);
}

//----- (003BD88C) --------------------------------------------------------
void __fastcall CAudioEngine::PlayLoadedMissionAudio(CAudioEngine *this, UInt8 Slot)
{
  sub_18B5F0(&this->m_ScriptAudioEntity, Slot);
}

//----- (003BD894) --------------------------------------------------------
Bool8 __fastcall CAudioEngine::IsMissionAudioSampleFinished(CAudioEngine *this, UInt8 Slot)
{
  return sub_190C40(&this->m_ScriptAudioEntity, Slot);
}

//----- (003BD89C) --------------------------------------------------------
tAudioEvent __fastcall CAudioEngine::GetMissionAudioEvent(CAudioEngine *this, UInt8 Slot)
{
  return sub_18D05C(&this->m_ScriptAudioEntity, Slot);
}

//----- (003BD8A4) --------------------------------------------------------
CVector *__fastcall CAudioEngine::GetMissionAudioPosition(CAudioEngine *this, UInt8 Slot)
{
  return sub_19A0C4(&this->m_ScriptAudioEntity, Slot);
}

//----- (003BD8AC) --------------------------------------------------------
void __fastcall CAudioEngine::ClearMissionAudio(CAudioEngine *this, UInt8 Slot)
{
  sub_1974AC(&this->m_ScriptAudioEntity, Slot);
}

//----- (003BD8B4) --------------------------------------------------------
void __fastcall CAudioEngine::SetMissionAudioPosition(CAudioEngine *this, UInt8 Slot, CVector *vPosition)
{
  sub_18EBD8(&this->m_ScriptAudioEntity, Slot, vPosition);
}

//----- (003BD8BC) --------------------------------------------------------
void __fastcall CAudioEngine::AttachMissionAudioToPed(CAudioEngine *this, UInt8 Slot, CPed *pPed)
{
  sub_19B540(&this->m_ScriptAudioEntity, Slot, pPed);
}

//----- (003BD8C4) --------------------------------------------------------
void __fastcall CAudioEngine::AttachMissionAudioToObject(CAudioEngine *this, UInt8 Slot, CObject *pObject)
{
  sub_19B540(&this->m_ScriptAudioEntity, Slot, pObject);
}

//----- (003BD8CC) --------------------------------------------------------
void __fastcall CAudioEngine::AttachMissionAudioToPhysical(CAudioEngine *this, UInt8 Slot, CPhysical *pPhysical)
{
  sub_19B540(&this->m_ScriptAudioEntity, Slot, pPhysical);
}

//----- (003BD8D4) --------------------------------------------------------
void __fastcall CAudioEngine::ReportMissionAudioEvent(CAudioEngine *this, UInt16 Event, CVector *vPosition)
{
  sub_1A161C(&this->m_ScriptAudioEntity, Event, vPosition);
}

//----- (003BD8DC) --------------------------------------------------------
void __fastcall CAudioEngine::ReportMissionAudioEvent(CAudioEngine *this, UInt16 Event, CObject *pObject)
{
  CAEScriptAudioEntity::ReportMissionAudioEvent(&this->m_ScriptAudioEntity, Event, pObject, 0.0, 1.0);
}

//----- (003BD8F6) --------------------------------------------------------
void __fastcall CAudioEngine::ReportMissionAudioEvent(CAudioEngine *this, UInt16 Event, CPed *pPed)
{
  CAEScriptAudioEntity::ReportMissionAudioEvent(&this->m_ScriptAudioEntity, Event, pPed, 0.0, 1.0);
}

//----- (003BD910) --------------------------------------------------------
void __fastcall CAudioEngine::ReportMissionAudioEvent(CAudioEngine *this, UInt16 Event, CVehicle *pVehicle)
{
  CAEScriptAudioEntity::ReportMissionAudioEvent(&this->m_ScriptAudioEntity, Event, pVehicle, 0.0, 1.0);
}

//----- (003BD92A) --------------------------------------------------------
void __fastcall CAudioEngine::ReportMissionAudioEvent(
        CAudioEngine *this,
        UInt16 Event,
        CPhysical *pPhysical,
        float fVolumeOffsetdB,
        float fFrequencyScaling)
{
  sub_194328(&this->m_ScriptAudioEntity, Event, pPhysical, fVolumeOffsetdB, fFrequencyScaling);
}

//----- (003BD932) --------------------------------------------------------
void __fastcall CAudioEngine::SayPedless(
        CAudioEngine *this,
        tAudioEvent AudioEvent,
        Int16 GlobalSpeechContext,
        CEntity *pEntityAttachedTo,
        UInt32 StartTimeDelay,
        float Probability,
        int OverideSilence,
        Bool8 bForceAudible,
        Bool8 bFrontEnd)
{
  CAEPedlessSpeechAudioEntity::AddSayEvent(
    &this->m_PedlessSpeechAudioEntity,
    AudioEvent,
    GlobalSpeechContext,
    pEntityAttachedTo,
    StartTimeDelay,
    Probability,
    OverideSilence,
    bForceAudible,
    bFrontEnd);
}

//----- (003BD962) --------------------------------------------------------
void __fastcall CAudioEngine::DisablePoliceScanner(CAudioEngine *this, Bool8 bCurtail, Bool8 bInstantCurtail)
{
  sub_195A80(bCurtail, bInstantCurtail);
}

//----- (003BD96E) --------------------------------------------------------
void __fastcall CAudioEngine::StopPoliceScanner(CAudioEngine *this, Bool8 bInstantStop)
{
  sub_1948F4(bInstantStop);
}

//----- (003BD974) --------------------------------------------------------
void __fastcall CAudioEngine::StartLoadingTune(CAudioEngine *this)
{
  CAEFrontendAudioEntity::AddAudioEvent(&this->m_FrontendAudioEntity, 50, 0.0, 1.0);
  sub_19113C(&AESoundManager);
}

//----- (003BD998) --------------------------------------------------------
void __fastcall CAudioEngine::PauseAllSounds(CAudioEngine *this)
{
  sub_194E50(&AEAudioHardware);
}

//----- (003BD9A8) --------------------------------------------------------
void __fastcall CAudioEngine::ResumeAllSounds(CAudioEngine *this)
{
  sub_19C3A4(&AEAudioHardware);
}

//----- (003BD9B8) --------------------------------------------------------
void __fastcall CAudioEngine::~CAudioEngine(CAudioEngine *this)
{
  this->m_GlobalDoorAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->m_GlobalDoorAudioEntity.ScratchSound);
  this->m_PedlessSpeechAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->m_PedlessSpeechAudioEntity.ScratchSound);
  this->m_CollisionAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->m_CollisionAudioEntity.ScratchSound);
  this->m_ScriptAudioEntity.m_ExplosionAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  this->m_ScriptAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667854;
  CAESound::~CAESound(&this->m_ScriptAudioEntity.m_ExplosionAudioEntity.ScratchSound);
  this->m_ScriptAudioEntity.m_DoorAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->m_ScriptAudioEntity.m_DoorAudioEntity.ScratchSound);
  this->m_ScriptAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->m_ScriptAudioEntity.ScratchSound);
  this->m_FrontendAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_6677D4;
  CAETwinLoopSoundEntity::~CAETwinLoopSoundEntity(&this->m_FrontendAudioEntity.m_RadioTuneSoundInPause);
  CAETwinLoopSoundEntity::~CAETwinLoopSoundEntity(&this->m_FrontendAudioEntity.m_RadioTuneSound);
  this->m_FrontendAudioEntity._vptr$CAEAudioEntity = (int (**)(void))&off_667798;
  CAESound::~CAESound(&this->m_FrontendAudioEntity.ScratchSound);
}
// 667798: using guessed type void *off_667798;
// 6677D4: using guessed type void *off_6677D4;
// 667854: using guessed type void *off_667854;

//----- (003BDA5C) --------------------------------------------------------
void CAudioZones::Init()
{
  CAudioZones::m_NumBoxes = 0;
  CAudioZones::m_NumSpheres = 0;
  CAudioZones::m_NumActiveSpheres = 0;
  CAudioZones::m_NumActiveBoxes = 0;
}

//----- (003BDA94) --------------------------------------------------------
void __fastcall CAudioZones::Update(int bForceUpdate, CVector TestCoors)
{
  Int32 v2; // r12
  int v3; // lr
  CVector *p_m_Coors; // r0
  Int32 v5; // r6
  Int32 v6; // r0
  float z; // s0
  float y; // s2
  float x; // s4
  Int16 *p_m_iMinX; // r1
  int v11; // r2
  Int32 v12; // r3

  if ( bForceUpdate
    || (CTimer::m_FrameCounter & 0xF) == 6
    || sqrtf(
         (float)((float)((float)(TestCoors.x - LastUpdateCoors.x) * (float)(TestCoors.x - LastUpdateCoors.x))
               + (float)((float)(TestCoors.y - LastUpdateCoors.y) * (float)(TestCoors.y - LastUpdateCoors.y)))
       + (float)((float)(TestCoors.z - LastUpdateCoors.z) * (float)(TestCoors.z - LastUpdateCoors.z))) >= 20.0 )
  {
    LastUpdateCoors = TestCoors;
    v2 = CAudioZones::m_NumSpheres;
    CAudioZones::m_NumActiveSpheres = 0;
    CAudioZones::m_NumActiveBoxes = 0;
    if ( CAudioZones::m_NumSpheres >= 1 )
    {
      v3 = 0;
      p_m_Coors = &CAudioZones::m_aSpheres[0].m_Coors;
      v5 = 0;
      do
      {
        if ( BYTE2(p_m_Coors[-1].z) << 31
          && v3 <= 9
          && sqrtf(
               (float)((float)((float)(TestCoors.x - p_m_Coors->x) * (float)(TestCoors.x - p_m_Coors->x))
                     + (float)((float)(TestCoors.y - p_m_Coors->y) * (float)(TestCoors.y - p_m_Coors->y)))
             + (float)((float)(TestCoors.z - p_m_Coors->z) * (float)(TestCoors.z - p_m_Coors->z))) < p_m_Coors[1].x )
        {
          CAudioZones::m_NumActiveSpheres = v3 + 1;
          CAudioZones::m_aActiveSpheres[v3++] = v5;
        }
        ++v5;
        p_m_Coors = (CVector *)((char *)p_m_Coors + 28);
      }
      while ( v5 < v2 );
    }
    v6 = CAudioZones::m_NumBoxes;
    if ( CAudioZones::m_NumBoxes >= 1 )
    {
      z = TestCoors.z;
      y = TestCoors.y;
      x = TestCoors.x;
      p_m_iMinX = &CAudioZones::m_aBoxes[0].m_iMinX;
      v11 = 0;
      v12 = 0;
      do
      {
        if ( *((unsigned __int8 *)p_m_iMinX - 2) << 31
          && (float)((float)*p_m_iMinX * 0.125) < x
          && (float)((float)p_m_iMinX[3] * 0.125) > x
          && (float)((float)p_m_iMinX[1] * 0.125) < y
          && (float)((float)p_m_iMinX[4] * 0.125) > y
          && (float)((float)p_m_iMinX[2] * 0.125) < z
          && v11 <= 9
          && (float)((float)p_m_iMinX[5] * 0.125) > z )
        {
          CAudioZones::m_NumActiveBoxes = v11 + 1;
          CAudioZones::m_aActiveBoxes[v11++] = v12;
        }
        ++v12;
        p_m_iMinX += 12;
      }
      while ( v12 < v6 );
    }
  }
}

//----- (003BDCE4) --------------------------------------------------------
void __fastcall CAudioZones::RegisterAudioSphere(
        unsigned __int8 *pName,
        Int32 Sound,
        bool bActive,
        float CoorsX,
        float CoorsY,
        float CoorsZ,
        float Range)
{
  Int16 v7; // r6
  Int32 v10; // r1
  CAudioSphere *v11; // r1
  char v12; // r2

  v7 = Sound;
  strcpy((char *)&CAudioZones::m_aSpheres[CAudioZones::m_NumSpheres], (const char *)pName);
  v10 = CAudioZones::m_NumSpheres++;
  v11 = &CAudioZones::m_aSpheres[v10];
  v11->m_Sound = v7;
  v12 = *((_BYTE *)&v11->CAudioZoneData + 10);
  v11->m_Coors.x = CoorsX;
  v11->m_Coors.y = CoorsY;
  v11->m_Coors.z = CoorsZ;
  v11->m_Range = Range;
  *((_BYTE *)&v11->CAudioZoneData + 10) = v12 & 0xFE | bActive;
}

//----- (003BDD54) --------------------------------------------------------
void __fastcall CAudioZones::RegisterAudioBox(
        unsigned __int8 *pName,
        Int32 Sound,
        bool bActive,
        float MinCoorsX,
        float MinCoorsY,
        float MinCoorsZ,
        float MaxCoorsX,
        float MaxCoorsY,
        float MaxCoorsZ)
{
  Int16 v9; // r9
  int v12; // r0
  CAudioBox *v13; // r1
  char v14; // r2

  v9 = Sound;
  strcpy((char *)&CAudioZones::m_aBoxes[CAudioZones::m_NumBoxes], (const char *)pName);
  v12 = CAudioZones::m_NumBoxes + 1;
  v13 = &CAudioZones::m_aBoxes[CAudioZones::m_NumBoxes];
  v14 = *((_BYTE *)&v13->CAudioZoneData + 10);
  v13->m_Sound = v9;
  CAudioZones::m_NumBoxes = v12;
  v13->m_iMinX = (int)(float)(MinCoorsX * 8.0);
  v13->m_iMinY = (int)(float)(MinCoorsY * 8.0);
  v13->m_iMinZ = (int)(float)(MinCoorsZ * 8.0);
  v13->m_iMaxX = (int)(float)(MaxCoorsX * 8.0);
  v13->m_iMaxY = (int)(float)(MaxCoorsY * 8.0);
  v13->m_iMaxZ = (int)(float)(MaxCoorsZ * 8.0);
  *((_BYTE *)&v13->CAudioZoneData + 10) = v14 & 0xFE | bActive;
}

//----- (003BDE1C) --------------------------------------------------------
void __fastcall CAudioZones::SwitchAudioZone(unsigned __int8 *pName, bool bNewActive)
{
  Int32 v4; // r9
  Int32 v5; // r4
  CAudioSphere *v6; // r6
  Int32 v7; // r9
  Int32 v8; // r4
  CAudioBox *v9; // r6

  v4 = CAudioZones::m_NumSpheres;
  if ( CAudioZones::m_NumSpheres >= 1 )
  {
    v5 = 0;
    v6 = CAudioZones::m_aSpheres;
    do
    {
      if ( !strcasecmp((const char *)pName, (const char *)v6) )
        *((_BYTE *)&v6->CAudioZoneData + 10) = *((_BYTE *)&v6->CAudioZoneData + 10) & 0xFE | bNewActive;
      ++v5;
      ++v6;
    }
    while ( v5 < v4 );
  }
  v7 = CAudioZones::m_NumBoxes;
  if ( CAudioZones::m_NumBoxes >= 1 )
  {
    v8 = 0;
    v9 = CAudioZones::m_aBoxes;
    do
    {
      if ( !strcasecmp((const char *)pName, (const char *)v9) )
        *((_BYTE *)&v9->CAudioZoneData + 10) = *((_BYTE *)&v9->CAudioZoneData + 10) & 0xFE | bNewActive;
      ++v8;
      ++v9;
    }
    while ( v8 < v7 );
  }
}

//----- (003BDEAC) --------------------------------------------------------
void __fastcall CBug::AppendData(CBug *this, void *data, unsigned int size)
{
  unsigned int m_buff_size; // r5
  size_t v7; // r6
  char *v8; // r11
  void *m_buff; // r9

  m_buff_size = this->m_buff_size;
  v7 = m_buff_size + size;
  v8 = (char *)operator new[](m_buff_size + size);
  memset(v8, 0, v7);
  m_buff = this->m_buff;
  qmemcpy(v8, this->m_buff, m_buff_size);
  qmemcpy(&v8[m_buff_size], data, size);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v8;
  this->m_buff_size = m_buff_size + size;
}

//----- (003BDF08) --------------------------------------------------------
void __fastcall CBug::SetField(CBug *this, int id, void *data, unsigned int size)
{
  size_t v5; // r8
  int *v9; // r10
  unsigned int m_buff_size; // r4
  char *v11; // r5
  void *m_buff; // r6

  v5 = size + 8;
  v9 = (int *)operator new[](size + 8);
  *v9 = id;
  v9[1] = size;
  qmemcpy(v9 + 2, data, size);
  m_buff_size = this->m_buff_size;
  v11 = (char *)operator new[](m_buff_size + v5);
  memset(v11, 0, m_buff_size + v5);
  m_buff = this->m_buff;
  qmemcpy(v11, this->m_buff, m_buff_size);
  qmemcpy(&v11[m_buff_size], v9, v5);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v11;
  this->m_buff_size = m_buff_size + v5;
  sub_18E8E0(v9);
}

//----- (003BDF88) --------------------------------------------------------
void __fastcall CBug::ClearBugBuffer(CBug *this)
{
  void *m_buff; // r0

  m_buff = this->m_buff;
  if ( m_buff )
  {
    operator delete[](m_buff);
    this->m_buff = 0;
    this->m_buff_size = 0;
  }
}

//----- (003BDFA2) --------------------------------------------------------
void *__fastcall CBug::GetMessage(CBug *this)
{
  return this->m_buff;
}

//----- (003BDFA6) --------------------------------------------------------
unsigned int __fastcall CBug::GetMessageSize(CBug *this)
{
  return this->m_buff_size;
}

//----- (003BDFAA) --------------------------------------------------------
void __fastcall CBug::SetOwner(CBug *this, const unsigned __int8 *val)
{
  size_t v4; // r5
  size_t v5; // r8
  _DWORD *v6; // r10
  unsigned int m_buff_size; // r4
  char *v8; // r5
  void *m_buff; // r6

  v4 = strlen((const char *)val);
  v5 = v4 + 8;
  v6 = (_DWORD *)operator new[](v4 + 8);
  *v6 = 0;
  v6[1] = v4;
  qmemcpy(v6 + 2, val, v4);
  m_buff_size = this->m_buff_size;
  v8 = (char *)operator new[](m_buff_size + v4 + 8);
  memset(v8, 0, m_buff_size + v5);
  m_buff = this->m_buff;
  qmemcpy(v8, this->m_buff, m_buff_size);
  qmemcpy(&v8[m_buff_size], v6, v5);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v8;
  this->m_buff_size = m_buff_size + v5;
  sub_18E8E0(v6);
}

//----- (003BE030) --------------------------------------------------------
void __fastcall CBug::SetSeverity(CBug *this, const unsigned __int8 *val)
{
  size_t v4; // r5
  size_t v5; // r8
  _DWORD *v6; // r10
  unsigned int m_buff_size; // r4
  char *v8; // r5
  void *m_buff; // r6

  v4 = strlen((const char *)val);
  v5 = v4 + 8;
  v6 = (_DWORD *)operator new[](v4 + 8);
  *v6 = 6;
  v6[1] = v4;
  qmemcpy(v6 + 2, val, v4);
  m_buff_size = this->m_buff_size;
  v8 = (char *)operator new[](m_buff_size + v4 + 8);
  memset(v8, 0, m_buff_size + v5);
  m_buff = this->m_buff;
  qmemcpy(v8, this->m_buff, m_buff_size);
  qmemcpy(&v8[m_buff_size], v6, v5);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v8;
  this->m_buff_size = m_buff_size + v5;
  sub_18E8E0(v6);
}

//----- (003BE0B8) --------------------------------------------------------
void CBug::SetSummary(CBug *this, const unsigned __int8 *val, ...)
{
  size_t v3; // r5
  size_t v4; // r9
  _DWORD *v5; // r10
  unsigned int m_buff_size; // r6
  char *v7; // r4
  void *m_buff; // r5
  unsigned __int8 s[2052]; // [sp+8h] [bp-820h] BYREF
  va_list va; // [sp+830h] [bp+8h] BYREF

  va_start(va, val);
  vsprintf(s, val, va);
  v3 = strlen((const char *)s);
  v4 = v3 + 8;
  v5 = (_DWORD *)operator new[](v3 + 8);
  *v5 = 9;
  v5[1] = v3;
  qmemcpy(v5 + 2, s, v3);
  m_buff_size = this->m_buff_size;
  v7 = (char *)operator new[](m_buff_size + v3 + 8);
  memset(v7, 0, m_buff_size + v3 + 8);
  m_buff = this->m_buff;
  qmemcpy(v7, this->m_buff, m_buff_size);
  qmemcpy(&v7[m_buff_size], v5, v4);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v7;
  this->m_buff_size = m_buff_size + v4;
  operator delete[](v5);
}

//----- (003BE188) --------------------------------------------------------
void __fastcall CBug::SetProduct(CBug *this, const unsigned __int8 *val)
{
  size_t v4; // r5
  size_t v5; // r8
  _DWORD *v6; // r10
  unsigned int m_buff_size; // r4
  char *v8; // r5
  void *m_buff; // r6

  v4 = strlen((const char *)val);
  v5 = v4 + 8;
  v6 = (_DWORD *)operator new[](v4 + 8);
  *v6 = 10;
  v6[1] = v4;
  qmemcpy(v6 + 2, val, v4);
  m_buff_size = this->m_buff_size;
  v8 = (char *)operator new[](m_buff_size + v4 + 8);
  memset(v8, 0, m_buff_size + v5);
  m_buff = this->m_buff;
  qmemcpy(v8, this->m_buff, m_buff_size);
  qmemcpy(&v8[m_buff_size], v6, v5);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v8;
  this->m_buff_size = m_buff_size + v5;
  sub_18E8E0(v6);
}

//----- (003BE210) --------------------------------------------------------
void __fastcall CBug::SetPlatform(CBug *this, unsigned int val)
{
  size_t v3; // r5
  size_t v4; // r9
  _DWORD *v5; // r10
  unsigned int m_buff_size; // r6
  char *v7; // r4
  void *m_buff; // r5
  unsigned __int8 v9[2052]; // [sp+0h] [bp-820h] BYREF

  sprintf(v9, (const unsigned __int8 *)&dword_3BE2D0, val);
  v3 = strlen((const char *)v9);
  v4 = v3 + 8;
  v5 = (_DWORD *)operator new[](v3 + 8);
  *v5 = 11;
  v5[1] = v3;
  qmemcpy(v5 + 2, v9, v3);
  m_buff_size = this->m_buff_size;
  v7 = (char *)operator new[](m_buff_size + v3 + 8);
  memset(v7, 0, m_buff_size + v3 + 8);
  m_buff = this->m_buff;
  qmemcpy(v7, this->m_buff, m_buff_size);
  qmemcpy(&v7[m_buff_size], v5, v4);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v7;
  this->m_buff_size = m_buff_size + v4;
  operator delete[](v5);
}
// 3BE2D0: using guessed type int dword_3BE2D0;

//----- (003BE2D8) --------------------------------------------------------
void __fastcall CBug::SetVersion(CBug *this, unsigned int val)
{
  size_t v3; // r5
  size_t v4; // r9
  _DWORD *v5; // r10
  unsigned int m_buff_size; // r6
  char *v7; // r4
  void *m_buff; // r5
  unsigned __int8 v9[2052]; // [sp+0h] [bp-820h] BYREF

  sprintf(v9, (const unsigned __int8 *)&dword_3BE398, val);
  v3 = strlen((const char *)v9);
  v4 = v3 + 8;
  v5 = (_DWORD *)operator new[](v3 + 8);
  *v5 = 12;
  v5[1] = v3;
  qmemcpy(v5 + 2, v9, v3);
  m_buff_size = this->m_buff_size;
  v7 = (char *)operator new[](m_buff_size + v3 + 8);
  memset(v7, 0, m_buff_size + v3 + 8);
  m_buff = this->m_buff;
  qmemcpy(v7, this->m_buff, m_buff_size);
  qmemcpy(&v7[m_buff_size], v5, v4);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v7;
  this->m_buff_size = m_buff_size + v4;
  operator delete[](v5);
}
// 3BE398: using guessed type int dword_3BE398;

//----- (003BE3A0) --------------------------------------------------------
void __fastcall CBug::SetComponent(CBug *this, unsigned int val)
{
  size_t v3; // r5
  size_t v4; // r9
  _DWORD *v5; // r10
  unsigned int m_buff_size; // r6
  char *v7; // r4
  void *m_buff; // r5
  unsigned __int8 v9[2052]; // [sp+0h] [bp-820h] BYREF

  sprintf(v9, (const unsigned __int8 *)&dword_3BE460, val);
  v3 = strlen((const char *)v9);
  v4 = v3 + 8;
  v5 = (_DWORD *)operator new[](v3 + 8);
  *v5 = 14;
  v5[1] = v3;
  qmemcpy(v5 + 2, v9, v3);
  m_buff_size = this->m_buff_size;
  v7 = (char *)operator new[](m_buff_size + v3 + 8);
  memset(v7, 0, m_buff_size + v3 + 8);
  m_buff = this->m_buff;
  qmemcpy(v7, this->m_buff, m_buff_size);
  qmemcpy(&v7[m_buff_size], v5, v4);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v7;
  this->m_buff_size = m_buff_size + v4;
  operator delete[](v5);
}
// 3BE460: using guessed type int dword_3BE460;

//----- (003BE468) --------------------------------------------------------
void __fastcall CBug::BeginField(CBug *this, const unsigned __int8 *name, const unsigned __int8 *dtype)
{
  size_t v5; // r5
  size_t v6; // r6
  unsigned int v7; // r4
  size_t *v8; // r9
  unsigned int v9; // r10
  _DWORD *v10; // r11
  unsigned int m_buff_size; // r6
  char *v12; // r4
  void *m_buff; // r5

  v5 = strlen((const char *)name);
  v6 = strlen((const char *)dtype);
  v7 = v6 + v5 + 8;
  v8 = (size_t *)operator new[](v7);
  *v8 = v5;
  qmemcpy(v8 + 1, name, v5);
  *(size_t *)((char *)v8 + v5 + 4) = v6;
  qmemcpy((char *)v8 + v5 + 8, dtype, v6);
  v9 = v6 + v5 + 16;
  v10 = (_DWORD *)operator new[](v9);
  *v10 = 17;
  v10[1] = v7;
  qmemcpy(v10 + 2, v8, v7);
  m_buff_size = this->m_buff_size;
  v12 = (char *)operator new[](m_buff_size + v9);
  memset(v12, 0, m_buff_size + v9);
  m_buff = this->m_buff;
  qmemcpy(v12, this->m_buff, m_buff_size);
  qmemcpy(&v12[m_buff_size], v10, v9);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v12;
  this->m_buff_size = m_buff_size + v9;
  operator delete[](v10);
  sub_18E8E0(v8);
}

//----- (003BE538) --------------------------------------------------------
void __fastcall CBug::EndCustomFieldData(CBug *this)
{
  unsigned int m_buff_size; // r6
  char *v3; // r5
  void *m_buff; // r8

  m_buff_size = this->m_buff_size;
  v3 = (char *)operator new[](m_buff_size + 4);
  memset(v3, 0, m_buff_size + 4);
  m_buff = this->m_buff;
  qmemcpy(v3, this->m_buff, m_buff_size);
  *(_DWORD *)&v3[m_buff_size] = 0;
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v3;
  this->m_buff_size = m_buff_size + 4;
}

//----- (003BE584) --------------------------------------------------------
void __fastcall CBug::AddCustomFieldData(CBug *this, void *data, unsigned int size)
{
  size_t v4; // r9
  unsigned int *v7; // r8
  unsigned int m_buff_size; // r5
  char *v9; // r6
  void *m_buff; // r4

  v4 = size + 4;
  v7 = (unsigned int *)operator new[](size + 4);
  *v7 = size;
  qmemcpy(v7 + 1, data, size);
  m_buff_size = this->m_buff_size;
  v9 = (char *)operator new[](m_buff_size + v4);
  memset(v9, 0, m_buff_size + v4);
  m_buff = this->m_buff;
  qmemcpy(v9, this->m_buff, m_buff_size);
  qmemcpy(&v9[m_buff_size], v7, v4);
  if ( m_buff )
  {
    operator delete[](m_buff);
    m_buff_size = this->m_buff_size;
  }
  this->m_buff = v9;
  this->m_buff_size = m_buff_size + v4;
  sub_18E8E0(v7);
}

//----- (003BE5FC) --------------------------------------------------------
void __fastcall CBugstarInterface::CBugstarInterface(CBugstarInterface *this, CBugstarNetwork *network)
{
  this->_vptr$CBugstarInterface = (int (**)(void))&off_66795C;
  this->m_network = network;
}
// 66795C: using guessed type void *;

//----- (003BE614) --------------------------------------------------------
int __fastcall CBugstarInterface::SendMsg(
        CBugstarInterface *this,
        unsigned int msg_id,
        void *data,
        unsigned int data_size)
{
  unsigned int v7; // r1
  unsigned int v9; // [sp+4h] [bp-24h] BYREF
  int v10; // [sp+8h] [bp-20h] BYREF
  int v11[7]; // [sp+Ch] [bp-1Ch] BYREF

  v9 = msg_id;
  v7 = (*((int (__fastcall **)(CBugstarNetwork *, unsigned int, unsigned __int8 *))this->m_network->_vptr$CBugstarNetwork
        + 2))(
         this->m_network,
         this->m_port,
         this->m_target_ip);
  this->m_socket = v7;
  if ( v7 )
  {
    v11[0] = 4;
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, int *, int))this->m_network->_vptr$CBugstarNetwork + 4))(
      this->m_network,
      v7,
      v11,
      4);
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, unsigned int *, int))this->m_network->_vptr$CBugstarNetwork
     + 4))(
      this->m_network,
      this->m_socket,
      &v9,
      v11[0]);
    v10 = 0;
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, int *, int))this->m_network->_vptr$CBugstarNetwork + 4))(
      this->m_network,
      this->m_socket,
      &v10,
      4);
    v11[0] = data_size;
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, int *, int))this->m_network->_vptr$CBugstarNetwork + 4))(
      this->m_network,
      this->m_socket,
      v11,
      4);
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, void *, int))this->m_network->_vptr$CBugstarNetwork + 4))(
      this->m_network,
      this->m_socket,
      data,
      v11[0]);
    v10 = 0;
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, int *, int))this->m_network->_vptr$CBugstarNetwork + 4))(
      this->m_network,
      this->m_socket,
      &v10,
      4);
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int))this->m_network->_vptr$CBugstarNetwork + 3))(
      this->m_network,
      this->m_socket);
    this->m_socket = 0;
  }
  return 0;
}

//----- (003BE6B8) --------------------------------------------------------
void __fastcall CBugstarInterface::SendData(CBugstarInterface *this, void *data, unsigned int size)
{
  int v5; // [sp+0h] [bp-18h] BYREF
  unsigned int v6[5]; // [sp+4h] [bp-14h] BYREF

  v6[0] = size;
  (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, unsigned int *, int))this->m_network->_vptr$CBugstarNetwork
   + 4))(
    this->m_network,
    this->m_socket,
    v6,
    4);
  (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, void *, unsigned int))this->m_network->_vptr$CBugstarNetwork
   + 4))(
    this->m_network,
    this->m_socket,
    data,
    v6[0]);
  v5 = 0;
  (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, int *, int))this->m_network->_vptr$CBugstarNetwork + 4))(
    this->m_network,
    this->m_socket,
    &v5,
    4);
}
// 3BE6B8: using guessed type unsigned int var_14[5];

//----- (003BE700) --------------------------------------------------------
void __fastcall CBugstarInterface::CreateBug(
        CBugstarInterface *this,
        float x,
        float y,
        float z,
        unsigned __int8 *grid,
        unsigned __int8 *owner,
        void *screen,
        unsigned int screen_size)
{
  size_t v8; // r5
  size_t v9; // r6
  _DWORD *v10; // r4
  void *v11; // r5
  size_t v12; // r9
  _DWORD *v13; // r0
  unsigned int m_buff_size; // r8
  _WORD *v15; // r5
  char *v16; // r0
  void *v17; // r6
  char *v18; // r10
  void *m_buff; // r4
  __int64 v20; // d16
  size_t v21; // r6
  size_t v22; // r11
  size_t *v23; // r8
  unsigned int v24; // r5
  size_t v25; // r6
  char *v26; // r0
  void *v27; // r10
  char *v28; // r4
  size_t v29; // r1
  void *v30; // r9
  char *v31; // r5
  size_t v32; // r1
  size_t v33; // r6
  size_t v34; // r4
  size_t *v35; // r8
  unsigned int v36; // r6
  size_t v37; // r5
  char *v38; // r0
  void *v39; // r11
  char *v40; // r9
  size_t v41; // r1
  void *v42; // r10
  char *v43; // r6
  size_t v44; // r1
  size_t v45; // r6
  size_t v46; // r11
  size_t *v47; // r8
  unsigned int v48; // r6
  size_t v49; // r5
  char *v50; // r0
  void *v51; // r9
  char *v52; // r4
  size_t v53; // r1
  void *v54; // r10
  char *v55; // r6
  size_t v56; // r1
  size_t v57; // r4
  size_t v58; // r9
  size_t *v59; // r6
  unsigned int v60; // r11
  unsigned int v61; // r5
  char *v62; // r0
  void *v63; // r8
  char *v64; // r10
  size_t v65; // r1
  void *v66; // r4
  char *v67; // r6
  size_t v68; // r1
  unsigned int *v69; // r8
  unsigned int v70; // r5
  unsigned int v71; // r4
  char *v72; // r0
  void *v73; // r9
  char *v74; // r6
  size_t v75; // r1
  void *v76; // r10
  char *v77; // r6
  size_t v78; // r1
  CBug v83; // [sp+10h] [bp-80h] BYREF
  unsigned __int8 s[68]; // [sp+18h] [bp-78h] BYREF

  v8 = strlen((const char *)owner);
  v9 = v8 + 8;
  v10 = (_DWORD *)operator new[](v8 + 8);
  *v10 = 0;
  v10[1] = v8;
  qmemcpy(v10 + 2, owner, v8);
  v11 = (void *)operator new[](v8 + 8);
  qmemcpy(v11, v10, v9);
  v83.m_buff = v11;
  v83.m_buff_size = v9;
  operator delete[](v10);
  CBug::SetPlatform(&v83, 1u);
  v12 = 10;
  v13 = (_DWORD *)operator new[](0xAu);
  m_buff_size = v83.m_buff_size;
  v15 = v13;
  *v13 = 10;
  v13[1] = 2;
  *((_WORD *)v13 + 4) = 16723;
  v16 = (char *)operator new[](m_buff_size + 10);
  v17 = v16;
  v18 = &v16[m_buff_size];
  if ( m_buff_size > 0xFFFFFFF5 )
    v12 = 0;
  m_buff = v83.m_buff;
  memset(&v16[m_buff_size], 0, v12);
  qmemcpy(v17, m_buff, m_buff_size);
  v20 = *(_QWORD *)v15;
  *((_WORD *)v18 + 4) = v15[4];
  *(_QWORD *)v18 = v20;
  if ( m_buff )
    operator delete[](m_buff);
  v83.m_buff = v17;
  v83.m_buff_size = m_buff_size + 10;
  operator delete[](v15);
  sprintf(s, (const unsigned __int8 *)&dword_3BEBA0, x);
  CBug::BeginField(&v83, "XCoord", "text");
  v21 = strlen((const char *)s);
  v22 = v21 + 4;
  v23 = (size_t *)operator new[](v21 + 4);
  *v23 = v21;
  qmemcpy(v23 + 1, s, v21);
  v24 = v83.m_buff_size;
  v25 = v83.m_buff_size + v22;
  v26 = (char *)operator new[](v83.m_buff_size + v22);
  v27 = v26;
  v28 = &v26[v24];
  v29 = v22;
  if ( v25 <= v24 )
    v29 = 0;
  v30 = v83.m_buff;
  memset(&v26[v24], 0, v29);
  qmemcpy(v27, v30, v24);
  qmemcpy(v28, v23, v22);
  if ( v30 )
    operator delete[](v30);
  operator delete[](v23);
  v31 = (char *)operator new[](v25 + 4);
  v32 = 4;
  if ( v25 > 0xFFFFFFFB )
    v32 = 0;
  memset(&v31[v25], 0, v32);
  qmemcpy(v31, v27, v25);
  *(_DWORD *)&v31[v25] = 0;
  operator delete[](v27);
  v83.m_buff = v31;
  v83.m_buff_size = v25 + 4;
  sprintf(s, (const unsigned __int8 *)&dword_3BEBA0, y);
  CBug::BeginField(&v83, "YCoord", "text");
  v33 = strlen((const char *)s);
  v34 = v33 + 4;
  v35 = (size_t *)operator new[](v33 + 4);
  *v35 = v33;
  qmemcpy(v35 + 1, s, v33);
  v36 = v83.m_buff_size;
  v37 = v83.m_buff_size + v34;
  v38 = (char *)operator new[](v83.m_buff_size + v34);
  v39 = v38;
  v40 = &v38[v36];
  v41 = v34;
  if ( v37 <= v36 )
    v41 = 0;
  v42 = v83.m_buff;
  memset(&v38[v36], 0, v41);
  qmemcpy(v39, v42, v36);
  qmemcpy(v40, v35, v34);
  if ( v42 )
    operator delete[](v42);
  operator delete[](v35);
  v43 = (char *)operator new[](v37 + 4);
  v44 = 4;
  if ( v37 > 0xFFFFFFFB )
    v44 = 0;
  memset(&v43[v37], 0, v44);
  qmemcpy(v43, v39, v37);
  *(_DWORD *)&v43[v37] = 0;
  operator delete[](v39);
  v83.m_buff = v43;
  v83.m_buff_size = v37 + 4;
  sprintf(s, (const unsigned __int8 *)&dword_3BEBA0, z);
  CBug::BeginField(&v83, "ZCoord", "text");
  v45 = strlen((const char *)s);
  v46 = v45 + 4;
  v47 = (size_t *)operator new[](v45 + 4);
  *v47 = v45;
  qmemcpy(v47 + 1, s, v45);
  v48 = v83.m_buff_size;
  v49 = v83.m_buff_size + v46;
  v50 = (char *)operator new[](v83.m_buff_size + v46);
  v51 = v50;
  v52 = &v50[v48];
  v53 = v46;
  if ( v49 <= v48 )
    v53 = 0;
  v54 = v83.m_buff;
  memset(&v50[v48], 0, v53);
  qmemcpy(v51, v54, v48);
  qmemcpy(v52, v47, v46);
  if ( v54 )
    operator delete[](v54);
  operator delete[](v47);
  v55 = (char *)operator new[](v49 + 4);
  v56 = 4;
  if ( v49 > 0xFFFFFFFB )
    v56 = 0;
  memset(&v55[v49], 0, v56);
  qmemcpy(v55, v51, v49);
  *(_DWORD *)&v55[v49] = 0;
  operator delete[](v51);
  v83.m_buff = v55;
  v83.m_buff_size = v49 + 4;
  CBug::BeginField(&v83, "grid", "text");
  v57 = strlen((const char *)grid);
  v58 = v57 + 4;
  v59 = (size_t *)operator new[](v57 + 4);
  *v59 = v57;
  qmemcpy(v59 + 1, grid, v57);
  v60 = v83.m_buff_size;
  v61 = v83.m_buff_size + v57 + 4;
  v62 = (char *)operator new[](v61);
  v63 = v62;
  v64 = &v62[v60];
  v65 = v57 + 4;
  if ( v61 <= v60 )
    v65 = 0;
  v66 = v83.m_buff;
  memset(&v62[v60], 0, v65);
  qmemcpy(v63, v66, v60);
  qmemcpy(v64, v59, v58);
  if ( v66 )
    operator delete[](v66);
  operator delete[](v59);
  v67 = (char *)operator new[](v61 + 4);
  v68 = 4;
  if ( v61 > 0xFFFFFFFB )
    v68 = 0;
  memset(&v67[v61], 0, v68);
  qmemcpy(v67, v63, v61);
  *(_DWORD *)&v67[v61] = 0;
  operator delete[](v63);
  v83.m_buff = v67;
  v83.m_buff_size = v61 + 4;
  CBug::BeginField(&v83, "ScreenShot", "image");
  v69 = (unsigned int *)operator new[](screen_size + 4);
  *v69 = screen_size;
  qmemcpy(v69 + 1, screen, screen_size);
  v70 = v83.m_buff_size;
  v71 = v83.m_buff_size + screen_size + 4;
  v72 = (char *)operator new[](v71);
  v73 = v72;
  v74 = &v72[v70];
  v75 = screen_size + 4;
  if ( v71 <= v70 )
    v75 = 0;
  v76 = v83.m_buff;
  memset(&v72[v70], 0, v75);
  qmemcpy(v73, v76, v70);
  qmemcpy(v74, v69, screen_size + 4);
  if ( v76 )
    operator delete[](v76);
  operator delete[](v69);
  v77 = (char *)operator new[](v71 + 4);
  v78 = 4;
  if ( v71 > 0xFFFFFFFB )
    v78 = 0;
  memset(&v77[v71], 0, v78);
  qmemcpy(v77, v73, v71);
  *(_DWORD *)&v77[v71] = 0;
  operator delete[](v73);
  CBugstarInterface::SendMsg(this, 0, v77, v71 + 4);
  operator delete[](v77);
}
// 3BEBA0: using guessed type int dword_3BEBA0;

//----- (003BEBE8) --------------------------------------------------------
void __fastcall CBugstarInterface::RecvData(CBugstarInterface *this, void **data, unsigned int *size)
{
  unsigned int v6; // r4
  unsigned int v7[7]; // [sp+4h] [bp-1Ch] BYREF

  v7[0] = 0;
  (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, unsigned int *, int))this->m_network->_vptr$CBugstarNetwork
   + 5))(
    this->m_network,
    this->m_socket,
    v7,
    4);
  v6 = v7[0];
  if ( v7[0] )
  {
    *data = (void *)operator new[](v7[0]);
    *size = v6;
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, void **, unsigned int))this->m_network->_vptr$CBugstarNetwork
     + 5))(
      this->m_network,
      this->m_socket,
      data,
      v6);
    (*((void (__fastcall **)(CBugstarNetwork *, unsigned int, unsigned int *, int))this->m_network->_vptr$CBugstarNetwork
     + 5))(
      this->m_network,
      this->m_socket,
      v7,
      4);
    if ( v7[0] )
    {
      if ( *data )
        operator delete(*data);
      *data = 0;
      *size = 0;
    }
  }
}

//----- (003BEC5C) --------------------------------------------------------
void __fastcall CBugstarInterface::ParseParameterLine(CBugstarInterface *this, unsigned __int8 *param)
{
  int v4; // r1
  char *v5; // r0
  int v6; // r6
  int v7; // r2
  int v8; // r1
  unsigned __int8 *m_target_ip; // r0
  unsigned __int8 *v10; // r2
  int v11; // r1
  unsigned __int8 *v12; // r2
  int v13; // r1
  unsigned __int8 *v14; // r2
  int v15; // r1
  unsigned __int8 *v16; // r2
  char v17[100]; // [sp+0h] [bp-78h] BYREF

  puts((const char *)param);
  v4 = *param;
  v5 = v17;
  if ( v4 == 58 )
  {
    v6 = 1;
  }
  else
  {
    v7 = 0;
    do
    {
      v17[v7] = v4;
      v4 = param[++v7];
    }
    while ( v4 != 58 );
    v5 = &v17[v7];
    v6 = v7 + 1;
  }
  *v5 = 0;
  if ( !strcmp(v17, "target_ip") )
  {
    do
      v11 = param[v6++];
    while ( v11 == 32 );
    m_target_ip = this->m_target_ip;
    if ( v11 != 10 )
    {
      v12 = param;
      do
      {
        *m_target_ip++ = v11;
        v11 = (v12++)[v6];
      }
      while ( v11 != 10 );
    }
    goto LABEL_29;
  }
  if ( !strcmp(v17, "target_name") )
  {
    do
      v13 = param[v6++];
    while ( v13 == 32 );
    m_target_ip = this->m_target_name;
    if ( v13 != 10 )
    {
      v14 = param;
      do
      {
        *m_target_ip++ = v13;
        v13 = (v14++)[v6];
      }
      while ( v13 != 10 );
    }
    goto LABEL_29;
  }
  if ( !strcmp(v17, "user_name") )
  {
    do
      v15 = param[v6++];
    while ( v15 == 32 );
    m_target_ip = this->m_user_name;
    if ( v15 != 10 )
    {
      v16 = param;
      do
      {
        *m_target_ip++ = v15;
        v15 = (v16++)[v6];
      }
      while ( v15 != 10 );
    }
    goto LABEL_29;
  }
  if ( !strcmp(v17, "method") )
  {
    do
      v8 = param[v6++];
    while ( v8 == 32 );
    m_target_ip = this->m_method;
    if ( v8 != 10 )
    {
      v10 = param;
      do
      {
        *m_target_ip++ = v8;
        v8 = (v10++)[v6];
      }
      while ( v8 != 10 );
    }
LABEL_29:
    *m_target_ip = 0;
  }
  puts((const char *)param);
}

//----- (003BED9C) --------------------------------------------------------
void __fastcall CBugstarPC::Init(CBugstarPC *this)
{
  int (**v1)(void); // r1

  v1 = this->_vptr$CBugstarInterface;
  this->m_port = 3490;
  v1[4]();
}

//----- (003BEDA8) --------------------------------------------------------
void __fastcall CBugstarPC::ReadConfigData(CBugstarPC *this)
{
  _BYTE *v2; // r5
  FILE *v3; // r6
  _BYTE *v4; // r4
  char v5; // r0
  _BYTE *v6; // r4
  char v7; // r0
  _BYTE *v8; // r4
  char v9; // r0
  _BYTE *v10; // r4
  char v11; // r0

  v2 = (_BYTE *)operator new[](0x64u);
  v3 = fopen("bugstar.cnf", "r");
  if ( v3 )
  {
    v4 = v2;
    do
    {
      v5 = fgetc(v3);
      *v4++ = v5;
    }
    while ( v5 != 10 );
    *v4 = 0;
    (*((void (__fastcall **)(CBugstarPC *, _BYTE *))this->_vptr$CBugstarInterface + 5))(this, v2);
    v6 = v2;
    do
    {
      v7 = fgetc(v3);
      *v6++ = v7;
    }
    while ( v7 != 10 );
    *v6 = 0;
    (*((void (__fastcall **)(CBugstarPC *, _BYTE *))this->_vptr$CBugstarInterface + 5))(this, v2);
    v8 = v2;
    do
    {
      v9 = fgetc(v3);
      *v8++ = v9;
    }
    while ( v9 != 10 );
    *v8 = 0;
    (*((void (__fastcall **)(CBugstarPC *, _BYTE *))this->_vptr$CBugstarInterface + 5))(this, v2);
    v10 = v2;
    do
    {
      v11 = fgetc(v3);
      *v10++ = v11;
    }
    while ( v11 != 10 );
    *v10 = 0;
    (*((void (__fastcall **)(CBugstarPC *, _BYTE *))this->_vptr$CBugstarInterface + 5))(this, v2);
    fclose(v3);
    sub_18E8E0(v2);
  }
}

//----- (003BEE7C) --------------------------------------------------------
void __fastcall CBugstarPC::~CBugstarPC(CBugstarPC *this)
{
  void *v1; // r0

  CBugstarInterface::~CBugstarInterface(this);
  sub_191374(v1);
}
// 3BEE88: variable 'v1' is possibly undefined

//----- (003BEE8C) --------------------------------------------------------
bool __fastcall CAccident::IsFree(const CAccident *this)
{
  CPed *m_pInjuredPed; // r1
  bool result; // r0
  _BOOL4 m_bHealed; // r2

  m_pInjuredPed = this->m_pInjuredPed;
  if ( !this->m_pInjuredPed || this->m_bBeingDealtWith )
    return 0;
  m_bHealed = this->m_bHealed;
  result = 0;
  if ( !m_bHealed && !(*((unsigned __int8 *)&m_pInjuredPed->m_nPhysicalFlags + 1) << 31) )
    return 1;
  return result;
}

//----- (003BEEB0) --------------------------------------------------------
CAccidentManager *GetAccidentManager()
{
  CAccidentManager *result; // r0

  result = GetAccidentManager(void)::spAccidentManager;
  if ( !GetAccidentManager(void)::spAccidentManager )
  {
    result = (CAccidentManager *)operator new(0x80u);
    result->m_accidents[0].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[0].m_bBeingDealtWith = 0;
    result->m_accidents[1].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[1].m_bBeingDealtWith = 0;
    result->m_accidents[2].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[2].m_bBeingDealtWith = 0;
    result->m_accidents[3].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[3].m_bBeingDealtWith = 0;
    result->m_accidents[4].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[4].m_bBeingDealtWith = 0;
    result->m_accidents[5].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[5].m_bBeingDealtWith = 0;
    result->m_accidents[6].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[6].m_bBeingDealtWith = 0;
    result->m_accidents[7].m_pInjuredPed = 0;
    result->m_accidents[7].m_bBeingDealtWith = 0;
    result->m_accidents[8].m_pInjuredPed = 0;
    result->m_accidents[7].m_bHealed = 0;
    result->m_accidents[8].m_bBeingDealtWith = 0;
    result->m_accidents[8].m_bHealed = 0;
    result->m_accidents[9].m_pInjuredPed = 0;
    result->m_accidents[9].m_bBeingDealtWith = 0;
    result->m_accidents[9].m_bHealed = 0;
    result->m_accidents[10].m_pInjuredPed = 0;
    result->m_accidents[10].m_bBeingDealtWith = 0;
    result->m_accidents[10].m_bHealed = 0;
    result->m_accidents[11].m_pInjuredPed = 0;
    result->m_accidents[11].m_bBeingDealtWith = 0;
    result->m_accidents[11].m_bHealed = 0;
    result->m_accidents[12].m_pInjuredPed = 0;
    result->m_accidents[12].m_bBeingDealtWith = 0;
    result->m_accidents[12].m_bHealed = 0;
    result->m_accidents[13].m_pInjuredPed = 0;
    result->m_accidents[13].m_bBeingDealtWith = 0;
    result->m_accidents[13].m_bHealed = 0;
    result->m_accidents[14].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[14].m_bBeingDealtWith = 0;
    result->m_accidents[15].m_pInjuredPed = 0;
    *(_WORD *)&result->m_accidents[15].m_bBeingDealtWith = 0;
    GetAccidentManager(void)::spAccidentManager = result;
  }
  return result;
}

//----- (003BEF4C) --------------------------------------------------------
void __fastcall CAccidentManager::CAccidentManager(CAccidentManager *this)
{
  this->m_accidents[0].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[0].m_bBeingDealtWith = 0;
  this->m_accidents[1].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[1].m_bBeingDealtWith = 0;
  *(_WORD *)&this->m_accidents[2].m_bBeingDealtWith = 0;
  this->m_accidents[2].m_pInjuredPed = 0;
  this->m_accidents[3].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[3].m_bBeingDealtWith = 0;
  this->m_accidents[4].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[4].m_bBeingDealtWith = 0;
  this->m_accidents[5].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[5].m_bBeingDealtWith = 0;
  this->m_accidents[6].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[6].m_bBeingDealtWith = 0;
  *(_WORD *)&this->m_accidents[7].m_bBeingDealtWith = 0;
  this->m_accidents[7].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[8].m_bBeingDealtWith = 0;
  this->m_accidents[8].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[9].m_bBeingDealtWith = 0;
  this->m_accidents[9].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[10].m_bBeingDealtWith = 0;
  this->m_accidents[10].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[11].m_bBeingDealtWith = 0;
  this->m_accidents[11].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[12].m_bBeingDealtWith = 0;
  this->m_accidents[12].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[13].m_bBeingDealtWith = 0;
  this->m_accidents[13].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[14].m_bBeingDealtWith = 0;
  this->m_accidents[14].m_pInjuredPed = 0;
  *(_WORD *)&this->m_accidents[15].m_bBeingDealtWith = 0;
  this->m_accidents[15].m_pInjuredPed = 0;
}

//----- (003BEFA2) --------------------------------------------------------
void __fastcall CAccidentManager::ReportAccident(CAccidentManager *this, CPed *pInjuredPed)
{
  CPed *m_nPedFlags; // r2
  CPed *m_pInjuredPed; // r3
  bool v4; // zf
  int v5; // r4
  CPed *v6; // lr
  int v7; // r12
  CPed *v8; // r2
  int v9; // r3
  CPed *v10; // r2
  int v11; // r3
  CPed *v12; // r2
  int v13; // r3
  CPed *v14; // r2
  int v15; // r3
  CPed *v16; // r2
  int v17; // r3
  CPed *v18; // r2
  int v19; // r3
  CPed *v20; // r2
  int v21; // r3
  CPed *v22; // r2
  int v23; // r3
  CPed *v24; // r2
  int v25; // r3
  CPed *v26; // r2
  int v27; // r3
  CPed *v28; // r2
  int v29; // r3
  CPed *v30; // r2
  int v31; // r3
  CPed *v32; // r2
  CAccident *v33; // r2

  if ( pInjuredPed->CharCreatedBy != 2 )
  {
    m_nPedFlags = (CPed *)pInjuredPed->m_nPedFlags;
    if ( (int)m_nPedFlags <= -1 )
    {
      m_pInjuredPed = this->m_accidents[0].m_pInjuredPed;
      v4 = this->m_accidents[0].m_pInjuredPed == pInjuredPed;
      if ( this->m_accidents[0].m_pInjuredPed != pInjuredPed )
      {
        m_nPedFlags = this->m_accidents[1].m_pInjuredPed;
        v4 = m_nPedFlags == pInjuredPed;
      }
      if ( !v4 )
      {
        v5 = (int)this->m_accidents[0].m_pInjuredPed;
        if ( m_pInjuredPed )
          v5 = -1;
        v6 = this->m_accidents[2].m_pInjuredPed;
        v7 = v5;
        if ( !m_nPedFlags )
          v7 = 1;
        if ( !m_pInjuredPed )
          v7 = v5;
        if ( v6 != pInjuredPed )
        {
          v8 = this->m_accidents[3].m_pInjuredPed;
          if ( !((unsigned int)v6 | ~v7) )
            v7 = 2;
          if ( v8 != pInjuredPed )
          {
            v9 = (unsigned int)v8 | ~v7;
            v10 = this->m_accidents[4].m_pInjuredPed;
            if ( !v9 )
              v7 = 3;
            if ( v10 != pInjuredPed )
            {
              v11 = (unsigned int)v10 | ~v7;
              v12 = this->m_accidents[5].m_pInjuredPed;
              if ( !v11 )
                v7 = 4;
              if ( v12 != pInjuredPed )
              {
                v13 = (unsigned int)v12 | ~v7;
                v14 = this->m_accidents[6].m_pInjuredPed;
                if ( !v13 )
                  v7 = 5;
                if ( v14 != pInjuredPed )
                {
                  v15 = (unsigned int)v14 | ~v7;
                  v16 = this->m_accidents[7].m_pInjuredPed;
                  if ( !v15 )
                    v7 = 6;
                  if ( v16 != pInjuredPed )
                  {
                    v17 = (unsigned int)v16 | ~v7;
                    v18 = this->m_accidents[8].m_pInjuredPed;
                    if ( !v17 )
                      v7 = 7;
                    if ( v18 != pInjuredPed )
                    {
                      v19 = (unsigned int)v18 | ~v7;
                      v20 = this->m_accidents[9].m_pInjuredPed;
                      if ( !v19 )
                        v7 = 8;
                      if ( v20 != pInjuredPed )
                      {
                        v21 = (unsigned int)v20 | ~v7;
                        v22 = this->m_accidents[10].m_pInjuredPed;
                        if ( !v21 )
                          v7 = 9;
                        if ( v22 != pInjuredPed )
                        {
                          v23 = (unsigned int)v22 | ~v7;
                          v24 = this->m_accidents[11].m_pInjuredPed;
                          if ( !v23 )
                            v7 = 10;
                          if ( v24 != pInjuredPed )
                          {
                            v25 = (unsigned int)v24 | ~v7;
                            v26 = this->m_accidents[12].m_pInjuredPed;
                            if ( !v25 )
                              v7 = 11;
                            if ( v26 != pInjuredPed )
                            {
                              v27 = (unsigned int)v26 | ~v7;
                              v28 = this->m_accidents[13].m_pInjuredPed;
                              if ( !v27 )
                                v7 = 12;
                              if ( v28 != pInjuredPed )
                              {
                                v29 = (unsigned int)v28 | ~v7;
                                v30 = this->m_accidents[14].m_pInjuredPed;
                                if ( !v29 )
                                  v7 = 13;
                                if ( v30 != pInjuredPed )
                                {
                                  v31 = (unsigned int)v30 | ~v7;
                                  v32 = this->m_accidents[15].m_pInjuredPed;
                                  if ( !v31 )
                                    v7 = 14;
                                  if ( v32 != pInjuredPed )
                                  {
                                    if ( !((unsigned int)v32 | ~v7) )
                                      v7 = 15;
                                    if ( v7 != -1 )
                                    {
                                      v33 = &this->m_accidents[v7];
                                      v33->m_pInjuredPed = pInjuredPed;
                                      *(_WORD *)&v33->m_bBeingDealtWith = 0;
                                      sub_196050(pInjuredPed, &v33->m_pInjuredPed);
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}

//----- (003BF108) --------------------------------------------------------
int __fastcall CAccidentManager::ComputeNoOfFreeAccidents(const CAccidentManager *this)
{
  int v2; // r2
  int result; // r0
  int v4; // r3
  CPed *m_pInjuredPed; // r1
  CAccident *v6; // r4
  bool v7; // zf

  v2 = 0;
  result = 0;
  do
  {
    while ( 1 )
    {
      v4 = v2++;
      m_pInjuredPed = this->m_accidents[v4].m_pInjuredPed;
      if ( m_pInjuredPed )
      {
        v6 = &this->m_accidents[v4];
        v7 = !v6->m_bBeingDealtWith;
        if ( !v6->m_bBeingDealtWith )
          v7 = !v6->m_bHealed;
        if ( v7 )
          break;
      }
      if ( v2 - 1 >= 15 )
        return result;
    }
    result += ((*(_DWORD *)&m_pInjuredPed->m_nPhysicalFlags >> 8) & 1) == 0;
  }
  while ( v4 < 15 );
  return result;
}

//----- (003BF148) --------------------------------------------------------
CAccident *__fastcall CAccidentManager::GetNearestFreeAccident(
        CAccidentManager *this,
        const CVector *vPos,
        bool bCorpseMustHaveHead)
{
  float32x2_t v3; // d2
  float32x2_t v4; // d16
  CAccident *v5; // lr
  float x; // s0
  int v7; // r8
  float v8; // s2
  int i; // r1
  int v10; // r4
  CPed *m_pInjuredPed; // r5
  CAccident *v12; // r6
  bool v13; // zf
  CMatrix *m_pMat; // r3
  CSimpleTransform *p_tx; // r6
  float32x2_t v16; // d17
  float32x2_t v17; // d3

  v3.n64_u32[0] = 2139095039;
  v4.n64_u64[0] = *(unsigned __int64 *)&vPos->y;
  v5 = 0;
  x = vPos->x;
  v7 = 0;
  do
  {
    v8 = v3.n64_f32[0];
    for ( i = v7; ; ++i )
    {
      v10 = v7++;
      m_pInjuredPed = this->m_accidents[v10].m_pInjuredPed;
      if ( m_pInjuredPed )
      {
        v12 = &this->m_accidents[v10];
        v13 = !v12->m_bBeingDealtWith;
        if ( !v12->m_bBeingDealtWith )
          v13 = !v12->m_bHealed;
        if ( v13
          && !(*((unsigned __int8 *)&m_pInjuredPed->m_nPhysicalFlags + 1) << 31)
          && (!bCorpseMustHaveHead || !(*((unsigned __int8 *)&m_pInjuredPed->m_nPedFlags + 1) >> 7)) )
        {
          break;
        }
      }
      if ( v7 - 1 >= 15 )
        return v5;
    }
    m_pMat = m_pInjuredPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pInjuredPed->m_transform;
    v16.n64_u64[0] = vsub_f32(v4, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
    v17.n64_u64[0] = vmul_f32(v16, v16).n64_u64[0];
    v17.n64_f32[0] = (float)((float)((float)(x - p_tx->m_translate.x) * (float)(x - p_tx->m_translate.x))
                           + v17.n64_f32[0])
                   + v17.n64_f32[1];
    v3.n64_u64[0] = vmin_f32(v17, v3).n64_u64[0];
    if ( v17.n64_f32[0] < v8 )
      v5 = &this->m_accidents[i];
  }
  while ( v10 < 15 );
  return v5;
}
// 3BF1DA: variable 'v3' is possibly undefined

//----- (003BF1FC) --------------------------------------------------------
CAccident *__fastcall CAccidentManager::GetNearestFreeAccidentExceptThisOne(
        CAccidentManager *this,
        const CVector *vPos,
        CAccident *exclude,
        bool bCorpseMustHaveHead)
{
  float32x2_t v4; // d2
  float32x2_t v5; // d16
  CAccident *v6; // lr
  float x; // s0
  int v8; // r9
  float v9; // s2
  CAccident *i; // r4
  int v11; // r5
  CPed *m_pInjuredPed; // r10
  CAccident *v13; // r1
  bool v14; // zf
  char v15; // r1
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r6
  float32x2_t v18; // d17
  float32x2_t v19; // d3

  v4.n64_u32[0] = 2139095039;
  v5.n64_u64[0] = *(unsigned __int64 *)&vPos->y;
  v6 = 0;
  x = vPos->x;
  v8 = 0;
  do
  {
    v9 = v4.n64_f32[0];
    for ( i = &this->m_accidents[v8]; ; ++i )
    {
      v11 = v8++;
      m_pInjuredPed = this->m_accidents[v11].m_pInjuredPed;
      if ( !m_pInjuredPed )
        goto LABEL_7;
      v13 = &this->m_accidents[v11];
      v14 = !v13->m_bBeingDealtWith;
      if ( !v13->m_bBeingDealtWith )
        v14 = !v13->m_bHealed;
      if ( !v14 || *((unsigned __int8 *)&m_pInjuredPed->m_nPhysicalFlags + 1) << 31 )
        goto LABEL_7;
      if ( bCorpseMustHaveHead )
        break;
      if ( !exclude || exclude != i )
        goto LABEL_18;
LABEL_7:
      if ( v8 - 1 >= 15 )
        return v6;
    }
    v15 = (char)exclude;
    if ( exclude )
      v15 = 1;
    if ( *((unsigned __int8 *)&m_pInjuredPed->m_nPedFlags + 1) >> 7 || ((unsigned __int8)v15 & (exclude == i)) != 0 )
      goto LABEL_7;
LABEL_18:
    m_pMat = m_pInjuredPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pInjuredPed->m_transform;
    v18.n64_u64[0] = vsub_f32(v5, *(float32x2_t *)&p_tx->m_translate.y).n64_u64[0];
    v19.n64_u64[0] = vmul_f32(v18, v18).n64_u64[0];
    v19.n64_f32[0] = (float)((float)((float)(x - p_tx->m_translate.x) * (float)(x - p_tx->m_translate.x))
                           + v19.n64_f32[0])
                   + v19.n64_f32[1];
    v4.n64_u64[0] = vmin_f32(v19, v4).n64_u64[0];
    if ( v19.n64_f32[0] < v9 )
      v6 = i;
  }
  while ( v11 < 15 );
  return v6;
}
// 3BF2B8: variable 'v4' is possibly undefined

//----- (003BF2E0) --------------------------------------------------------
CPad *GetCurrentCameraPad()
{
  CPad *result; // r0

  result = currentPad;
  if ( !currentPad )
    return sub_19F85C(0);
  return result;
}

//----- (003BF300) --------------------------------------------------------
void __fastcall CCam::Process(CCam *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d8
  float32x2_t v4; // d10
  char v6; // r0
  CEntity **p_CamTargetEntity; // r8
  CEntity *pTargetEntity; // r0
  CPlayerPed *PlayerPed; // r0
  bool v10; // zf
  _BOOL4 m_bCamLookingAtVector; // r0
  int v12; // r6
  int m_iDoCollisionChecksOnFrameNum; // r1
  int m_iFrameNumWereAt; // r3
  bool v15; // r2
  float ATanOfXY; // s16
  __int64 v17; // d16
  float v18; // s18
  CPlayerPed *v19; // r6
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r1
  __int64 v22; // d16
  CMatrix *v23; // r0
  CEntity *v24; // r5
  CMatrix *v25; // r0
  CPlaceable *v26; // r6
  CMatrix *v27; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v29; // d16
  CPlaceable *v30; // r5
  CMatrix *v31; // r0
  CPlaceable *v32; // r5
  CMatrix *v33; // r1
  float xy; // s16
  CPlaceable *v35; // r5
  CMatrix *v36; // r1
  float v37; // s16
  CPlayerPed *v38; // r0
  CMatrix *v39; // r1
  CSimpleTransform *v40; // r2
  __int64 v41; // d16
  CPlayerPed *v42; // r0
  CPlayerPed *v43; // r0
  CTaskSimpleClimb *TaskClimb; // r5
  CPlayerPed *v45; // r0
  float32x2_t v46; // d16
  unsigned __int64 v47; // d1
  int InputType; // r0
  bool v49; // zf
  CVehicle *PlayerVehicle; // r0
  CPad *v51; // r0
  _BOOL4 IsFlyingRCVehicle; // r0
  bool v53; // zf
  CPlayerPed *v54; // r0
  float v55; // r0
  float v56; // s0
  float v57; // s6
  float v58; // s2
  float z; // r0
  float v60; // s16
  float v61; // s18
  float v62; // s0
  float v63; // s2
  CMatrix *v64; // r0
  CPlaceable *v65; // r5
  CPlaceable *v66; // r5
  CMatrix *v67; // r0
  CPlaceable *v68; // r6
  float x; // s0
  float y; // s2
  float v71; // s4
  float v72; // s4
  float v73; // s2
  float v74; // s0
  int DirectionWasLooking; // r0
  CPad *Pad; // r0
  CPad *v77; // r0
  CPad *v78; // r0
  CMatrix *v79; // r0
  CPlaceable *v80; // r5
  int32 v81; // r1
  int ActiveCam; // r3
  int Mode; // r2
  int m_uiTransitionState; // r5
  const CVehicle *v85; // r0
  _BOOL4 LookRight; // r5
  _BOOL4 v87; // r6
  CPad *v88; // r0
  _BOOL4 LookBehindForPed; // r0
  int v90; // r1
  int32 v91; // r0
  CPad *v92; // r0
  CPad *v93; // r0
  CPad *v94; // r0
  int v95; // r0
  float v96; // r2
  float v97; // r3
  int v98; // r0
  int32 v99; // r0
  float v100; // s4
  float v101; // s10
  float v102; // r0
  float v103; // r1
  float v104; // s16
  CVector *p_Source; // r5
  __int64 v106; // d16
  CCam *v107; // r0
  bool v108; // r1
  __int64 v109; // d16
  RwReal v110; // s4
  RwReal v111; // s2
  __int64 v112; // d16
  float v113; // r6
  float v114; // r0
  float v115; // s22
  float v116; // s24
  float v117; // s26
  float v118; // s28
  float v119; // s6
  float v120; // s30
  float v121; // s4
  float v122; // s0
  float v123; // s0
  float v124; // [sp+0h] [bp-90h]
  CVector ThisCamsTarget; // [sp+10h] [bp-80h] BYREF
  CVector v126; // [sp+20h] [bp-70h] BYREF
  CVector vecTarget; // [sp+30h] [bp-60h] BYREF

  v6 = *((_BYTE *)&g_InterestingEvents + 300) & 0xFE;
  *((_BYTE *)&g_InterestingEvents + 300) &= ~1u;
  if ( TheCamera.Cams[TheCamera.ActiveCam].Mode != 4 )
  {
    gIdleCam.idleTickerFrames = 0;
    *((_BYTE *)&g_InterestingEvents + 300) = v6;
  }
  p_CamTargetEntity = &this->CamTargetEntity;
  if ( !this->CamTargetEntity )
  {
    pTargetEntity = TheCamera.pTargetEntity;
    *p_CamTargetEntity = TheCamera.pTargetEntity;
    CEntity::RegisterReference(pTargetEntity, &this->CamTargetEntity);
  }
  if ( gCrossHair[0].m_type == 1 )
  {
    PlayerPed = FindPlayerPed(-1);
    v10 = PlayerPed == 0;
    if ( PlayerPed )
    {
      PlayerPed = (CPlayerPed *)PlayerPed->m_pMyVehicle;
      v10 = PlayerPed == 0;
    }
    if ( v10 || PlayerPed->m_nModelIndex != 520 )
      CWeaponEffects::ClearCrossHairImmediately(0);
  }
  m_bCamLookingAtVector = this->m_bCamLookingAtVector;
  v12 = 1;
  m_iDoCollisionChecksOnFrameNum = this->m_iDoCollisionChecksOnFrameNum;
  m_iFrameNumWereAt = this->m_iFrameNumWereAt;
  v15 = 0;
  if ( m_iFrameNumWereAt < this->m_iDoCollisionCheckEveryNumOfFrames )
    v12 = m_iFrameNumWereAt + 1;
  this->m_iFrameNumWereAt = v12;
  if ( v12 == m_iDoCollisionChecksOnFrameNum )
    v15 = 1;
  this->m_bCollisionChecksOn = v15;
  if ( m_bCamLookingAtVector )
  {
    ATanOfXY = 0.0;
    v17 = *(_QWORD *)&this->m_cvecCamFixedModeVector.x;
    v18 = 0.0;
    ThisCamsTarget.z = this->m_cvecCamFixedModeVector.z;
    *(_QWORD *)&ThisCamsTarget.x = v17;
    goto LABEL_92;
  }
  v19 = (CPlayerPed *)*p_CamTargetEntity;
  if ( (*(_BYTE *)&(*p_CamTargetEntity)->m_info & 7) == 2 )
  {
    m_pMat = v19->m_pMat;
    p_m_transform = &v19->m_transform;
    if ( m_pMat )
      p_m_transform = (CSimpleTransform *)&m_pMat->tx;
    v22 = *(_QWORD *)&p_m_transform->m_translate.x;
    ThisCamsTarget.z = p_m_transform->m_translate.z;
    *(_QWORD *)&ThisCamsTarget.x = v22;
    v23 = v19->m_pMat;
    if ( !v23 )
    {
      CPlaceable::AllocateMatrix(v19);
      CSimpleTransform::UpdateMatrix(&v19->m_transform, v19->m_pMat);
      v23 = v19->m_pMat;
    }
    if ( v23->xy != 0.0 )
      goto LABEL_37;
    v24 = *p_CamTargetEntity;
    v25 = (*p_CamTargetEntity)->m_pMat;
    if ( !v25 )
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v24->m_transform, v24->m_pMat);
      v25 = v24->m_pMat;
    }
    if ( v25->yy == 0.0 )
    {
      ATanOfXY = 0.0;
    }
    else
    {
LABEL_37:
      v32 = *p_CamTargetEntity;
      v33 = (*p_CamTargetEntity)->m_pMat;
      if ( v33 )
      {
        xy = v33->xy;
      }
      else
      {
        CPlaceable::AllocateMatrix(*p_CamTargetEntity);
        CSimpleTransform::UpdateMatrix(&v32->m_transform, v32->m_pMat);
        v64 = v32->m_pMat;
        v65 = *p_CamTargetEntity;
        xy = v64->xy;
        v33 = (*p_CamTargetEntity)->m_pMat;
        if ( !v33 )
        {
          CPlaceable::AllocateMatrix(*p_CamTargetEntity);
          CSimpleTransform::UpdateMatrix(&v65->m_transform, v65->m_pMat);
          v33 = v65->m_pMat;
        }
      }
      ATanOfXY = CGeneral::GetATanOfXY(xy, v33->yy);
    }
    memset(&vecTarget, 0, sizeof(vecTarget));
    v66 = *p_CamTargetEntity;
    v67 = (*p_CamTargetEntity)->m_pMat;
    if ( v67 )
    {
      vecTarget.x = v67->xy;
    }
    else
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v66->m_transform, v66->m_pMat);
      v68 = *p_CamTargetEntity;
      v67 = (*p_CamTargetEntity)->m_pMat;
      vecTarget.x = v66->m_pMat->xy;
      if ( !v67 )
      {
        CPlaceable::AllocateMatrix(v68);
        CSimpleTransform::UpdateMatrix(&v68->m_transform, v68->m_pMat);
        v67 = v68->m_pMat;
      }
    }
    vecTarget.y = v67->yy;
    CVector::Normalise(&vecTarget);
    x = vecTarget.x;
    y = vecTarget.y;
    v71 = sqrtf((float)(x * x) + (float)(y * y));
    if ( v71 != 0.0 )
    {
      y = vecTarget.y / v71;
      x = vecTarget.x / v71;
      vecTarget.y = vecTarget.y / v71;
      vecTarget.x = vecTarget.x / v71;
    }
    v72 = x * (*p_CamTargetEntity)[1].m_transform.m_translate.z;
    v73 = y * (*p_CamTargetEntity)[1].m_transform.m_heading;
    v1.n64_f32[0] = sqrtf((float)(v72 * v72) + (float)(v73 * v73));
    if ( (float)(v72 + v73) <= 0.0 )
    {
      v1.n64_f32[0] = v1.n64_f32[0] / 1.8;
      v2.n64_u32[0] = 0.5;
      v18 = -vmin_f32(v1, v2).n64_f32[0];
    }
    else
    {
      v18 = 1.0;
      v74 = v1.n64_f32[0] / 0.9;
      if ( v74 <= 1.0 )
        v18 = v74;
    }
    DirectionWasLooking = this->DirectionWasLooking;
    this->SpeedVar = (float)(v18 * 0.105) + (float)(this->SpeedVar * 0.895);
    if ( DirectionWasLooking != 3 )
    {
      Pad = currentPad;
      if ( !currentPad )
        Pad = CPad::GetPad(0);
      if ( !CPad::GetLookBehindForCar(Pad) )
        goto LABEL_87;
      v77 = currentPad;
      if ( !currentPad )
        v77 = CPad::GetPad(0);
      if ( CPad::GetLookLeft(v77, 0) )
        goto LABEL_87;
      v78 = currentPad;
      if ( !currentPad )
        v78 = CPad::GetPad(0);
      if ( CPad::GetLookRight(v78, 0) )
LABEL_87:
        TheCamera.m_bCamDirectlyBehind = 1;
    }
    goto LABEL_92;
  }
  if ( v19 != FindPlayerPed(-1) )
  {
    v26 = *p_CamTargetEntity;
    v27 = (*p_CamTargetEntity)->m_pMat;
    p_tx = (CSimpleTransform *)&v27->tx;
    if ( !v27 )
      p_tx = &v26->m_transform;
    v29 = *(_QWORD *)&p_tx->m_translate.x;
    ThisCamsTarget.z = p_tx->m_translate.z;
    *(_QWORD *)&ThisCamsTarget.x = v29;
    if ( v27 )
      goto LABEL_32;
    goto LABEL_31;
  }
  v38 = FindPlayerPed(-1);
  v39 = v38->m_pMat;
  v40 = (CSimpleTransform *)&v39->tx;
  if ( !v39 )
    v40 = &v38->m_transform;
  v41 = *(_QWORD *)&v40->m_translate.x;
  vecTarget.z = v40->m_translate.z;
  *(_QWORD *)&vecTarget.x = v41;
  v42 = FindPlayerPed(-1);
  if ( CPedIntelligence::GetTaskClimb(v42->m_pPedIntelligence) )
  {
    v43 = FindPlayerPed(-1);
    TaskClimb = CPedIntelligence::GetTaskClimb(v43->m_pPedIntelligence);
    v45 = FindPlayerPed(-1);
    CTaskSimpleClimb::GetCameraTargetPos(TaskClimb, v45, &vecTarget);
  }
  if ( CTimer::ms_fTimeStep < 0.2 )
    goto LABEL_190;
  v46.n64_u64[0] = vsub_f32(*(float32x2_t *)&vecPedPosEst.y, *(float32x2_t *)&vecTarget.y).n64_u64[0];
  v47 = vmul_f32(v46, v46).n64_u64[0];
  if ( (float)((float)((float)((float)(vecPedPosEst.x - vecTarget.x) * (float)(vecPedPosEst.x - vecTarget.x))
                     + *(float *)&v47)
             + *((float *)&v47 + 1)) > 9.0 )
    goto LABEL_190;
  InputType = CHID::GetInputType();
  v49 = InputType == 2;
  if ( InputType == 2 )
    v49 = this->Mode == 4;
  if ( v49 )
    goto LABEL_190;
  if ( FindPlayerPed(-1) && (PlayerVehicle = FindPlayerVehicle(-1, 0)) != 0 )
  {
    if ( (unsigned int)(PlayerVehicle->m_vehicleType - 3) < 2 )
      goto LABEL_190;
    v51 = currentPad;
    if ( !currentPad )
      v51 = CPad::GetPad(0);
    IsFlyingRCVehicle = CPad::IsFlyingRCVehicle(v51);
    if ( TheCamera.m_bCamDirectlyInFront )
      goto LABEL_190;
    v53 = !IsFlyingRCVehicle;
    if ( !IsFlyingRCVehicle )
      v53 = !TheCamera.m_bCamDirectlyBehind;
    if ( !v53 )
      goto LABEL_190;
  }
  else if ( (TheCamera.m_bCamDirectlyInFront || TheCamera.m_bCamDirectlyBehind) << 24 )
  {
LABEL_190:
    v62 = 0.0;
    v61 = vecTarget.x;
    v60 = vecTarget.y;
    v63 = 0.0;
    z = vecTarget.z;
    goto LABEL_191;
  }
  v54 = FindPlayerPed(-1);
  if ( CPedIntelligence::GetTaskFighting(v54->m_pPedIntelligence) && this->Mode == 53 )
  {
    v55 = powf(PLAYERFIGHT_LEVEL_SMOOTHING_CONST, CTimer::ms_fTimeStep);
    v56 = 1.0 - v55;
    v57 = v55 * vecPedPosEst.y;
    v58 = v55 * vecPedPosEst.x;
    z = (float)(v55 * vecPedPosEst.z) + (float)((float)(1.0 - v55) * vecTarget.z);
    v60 = v57 + (float)(v56 * vecTarget.y);
    v61 = v58 + (float)(v56 * vecTarget.x);
    v62 = 0.0;
    v63 = 0.0;
  }
  else
  {
    v3.n64_f32[0] = CTimer::ms_fTimeStep;
    v113 = CTimer::ms_fTimeStep;
    v114 = powf(PLAYERPED_LEVEL_SMOOTHING_CONST_INV, CTimer::ms_fTimeStep);
    v4.n64_u32[0] = 1.0;
    v115 = vecPedPosTrend.x;
    v116 = vecPedPosTrend.y;
    v117 = vecPedPosEst.x;
    v118 = vecPedPosEst.y;
    v119 = 1.0 - (float)(1.0 - v114);
    v120 = 1.0 / vmax_f32(v3, v4).n64_f32[0];
    v121 = v119 * (float)((float)(v3.n64_f32[0] * vecPedPosTrend.x) + vecPedPosEst.x);
    v60 = (float)((float)(1.0 - v114) * vecTarget.y)
        + (float)(v119 * (float)((float)(v3.n64_f32[0] * vecPedPosTrend.y) + vecPedPosEst.y));
    v61 = (float)((float)(1.0 - v114) * vecTarget.x) + v121;
    v122 = powf(PLAYERPED_TREND_SMOOTHING_CONST_INV, v113);
    z = vecTarget.z;
    v123 = 1.0 - v122;
    v63 = (float)((float)(1.0 - v123) * v116) + (float)(v120 * (float)(v123 * (float)(v60 - v118)));
    v62 = (float)((float)(1.0 - v123) * v115) + (float)(v120 * (float)(v123 * (float)(v61 - v117)));
  }
LABEL_191:
  ThisCamsTarget.y = v60;
  ThisCamsTarget.x = v61;
  vecPedPosEst.x = v61;
  vecPedPosEst.y = v60;
  vecPedPosEst.z = z;
  vecPedPosTrend.x = v62;
  vecPedPosTrend.y = v63;
  vecPedPosTrend.z = 0.0;
  ThisCamsTarget.z = z;
  v26 = *p_CamTargetEntity;
  v27 = (*p_CamTargetEntity)->m_pMat;
  if ( !v27 )
  {
LABEL_31:
    CPlaceable::AllocateMatrix(v26);
    CSimpleTransform::UpdateMatrix(&v26->m_transform, v26->m_pMat);
    v27 = v26->m_pMat;
  }
  if ( v27->xy != 0.0 )
    goto LABEL_39;
LABEL_32:
  v30 = *p_CamTargetEntity;
  v31 = (*p_CamTargetEntity)->m_pMat;
  if ( !v31 )
  {
    CPlaceable::AllocateMatrix(*p_CamTargetEntity);
    CSimpleTransform::UpdateMatrix(&v30->m_transform, v30->m_pMat);
    v31 = v30->m_pMat;
  }
  if ( v31->yy == 0.0 )
  {
    ATanOfXY = 0.0;
  }
  else
  {
LABEL_39:
    v35 = *p_CamTargetEntity;
    v36 = (*p_CamTargetEntity)->m_pMat;
    if ( v36 )
    {
      v37 = v36->xy;
    }
    else
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v35->m_transform, v35->m_pMat);
      v79 = v35->m_pMat;
      v80 = *p_CamTargetEntity;
      v37 = v79->xy;
      v36 = (*p_CamTargetEntity)->m_pMat;
      if ( !v36 )
      {
        CPlaceable::AllocateMatrix(*p_CamTargetEntity);
        CSimpleTransform::UpdateMatrix(&v80->m_transform, v80->m_pMat);
        v36 = v80->m_pMat;
      }
    }
    ATanOfXY = CGeneral::GetATanOfXY(v37, v36->yy);
  }
  v18 = 0.0;
  this->SpeedVar = 0.0;
LABEL_92:
  v81 = DirectionIsLooking;
  this->DirectionWasLooking = DirectionIsLooking;
  ActiveCam = TheCamera.ActiveCam;
  DirectionIsLooking = 3;
  if ( &TheCamera.Cams[TheCamera.ActiveCam] == this )
  {
    Mode = (unsigned __int16)this->Mode;
    ActiveCam = (int)&TheCamera;
    m_uiTransitionState = TheCamera.m_uiTransitionState;
    switch ( this->Mode )
    {
      case 3:
      case 0x10:
      case 0x12:
      case 0x16:
        v85 = (const CVehicle *)*p_CamTargetEntity;
        ActiveCam = *(_BYTE *)&(*p_CamTargetEntity)->m_info & 7;
        if ( ActiveCam == 2 )
        {
          if ( v85
            && (CVehicle::GetVehicleAppearance(v85) == APR_HELI
             || CVehicle::GetVehicleAppearance((const CVehicle *)*p_CamTargetEntity) == APR_PLANE) )
          {
            LookRight = 0;
            v87 = 1;
          }
          else
          {
            v92 = currentPad;
            if ( !currentPad )
              v92 = CPad::GetPad(0);
            v87 = !CPad::GetLookLeft(v92, 1);
            v93 = currentPad;
            if ( !currentPad )
              v93 = CPad::GetPad(0);
            LookRight = CPad::GetLookRight(v93, 1);
          }
          v94 = currentPad;
          if ( !currentPad )
            v94 = CPad::GetPad(0);
          if ( CPad::GetLookBehindForCar(v94) )
          {
            v91 = 0;
            TheCamera.m_vecDoingSpecialInterPolation = 0;
            TheCamera.m_uiTransitionState = 0;
            TheCamera.m_bWaitForInterpolToFinish = 0;
            if ( !this->DirectionWasLooking )
              goto LABEL_128;
            goto LABEL_120;
          }
          if ( !v87 )
          {
            TheCamera.m_vecDoingSpecialInterPolation = 0;
            TheCamera.m_uiTransitionState = 0;
            TheCamera.m_bWaitForInterpolToFinish = 0;
            v91 = 1;
            if ( this->DirectionWasLooking != 1 )
              TheCamera.m_bJust_Switched = 1;
            goto LABEL_128;
          }
          if ( LookRight )
          {
            TheCamera.m_vecDoingSpecialInterPolation = 0;
            TheCamera.m_uiTransitionState = 0;
            TheCamera.m_bWaitForInterpolToFinish = 0;
            if ( this->DirectionWasLooking != 2 )
              TheCamera.m_bJust_Switched = 1;
            v91 = 2;
            goto LABEL_128;
          }
          if ( this->DirectionWasLooking != 3 )
            TheCamera.m_bJust_Switched = 1;
          goto LABEL_110;
        }
        if ( Mode == 53 )
          goto LABEL_108;
        if ( Mode == 4 )
          goto LABEL_101;
        break;
      case 4:
LABEL_101:
        if ( (*(_BYTE *)&(*p_CamTargetEntity)->m_info & 7) == 3 )
        {
          v88 = currentPad;
          if ( !currentPad )
            v88 = CPad::GetPad(0);
          LookBehindForPed = CPad::GetLookBehindForPed(v88);
          v90 = this->DirectionWasLooking;
          if ( LookBehindForPed )
          {
            v91 = 0;
            if ( !m_uiTransitionState && v90 )
            {
LABEL_120:
              TheCamera.m_bJust_Switched = 1;
              v91 = 0;
            }
            goto LABEL_128;
          }
          if ( v90 == 3 )
            goto LABEL_110;
          goto LABEL_109;
        }
        break;
      case 0x35:
LABEL_108:
        if ( v81 != 3 )
LABEL_109:
          gCurDistForCam = 1.0;
LABEL_110:
        v91 = 3;
LABEL_128:
        DirectionIsLooking = v91;
        break;
      default:
        break;
    }
  }
  if ( TheCamera.m_bJust_Switched )
  {
    TheCamera.m_bResetOldMatrix = 1;
    gCurDistForCam = 1.0;
  }
  v95 = this->Mode;
  switch ( this->Mode )
  {
    case 3:
    case 0x10:
    case 0x12:
    case 0x16:
    case 0x31:
      break;
    default:
      CPostEffects::m_bSpeedFXUserFlagCurrentFrame = 0;
      break;
  }
  gbFirstPersonRunThisFrame = 0;
  switch ( v95 )
  {
    case 3:
    case 18:
    case 22:
      CCam::Process_FollowCar_SA(
        this,
        &ThisCamsTarget,
        COERCE_FLOAT(&gbFirstPersonRunThisFrame),
        *(float *)&ActiveCam,
        v124,
        0);
      break;
    case 4:
      CHID::GetInputType();
      CCam::Process_FollowPed_SA(this, &ThisCamsTarget, v96, v97, v124, 0);
      break;
    case 7:
    case 34:
    case 45:
    case 46:
      CCam::Process_M16_1stPerson(
        this,
        &ThisCamsTarget,
        COERCE_FLOAT(&gbFirstPersonRunThisFrame),
        *(float *)&ActiveCam,
        v124);
      break;
    case 8:
      v98 = 0;
      goto LABEL_154;
    case 14:
      CCam::Process_WheelCam(this, 0, COERCE_FLOAT(&gbFirstPersonRunThisFrame), *(float *)&ActiveCam, v124);
      break;
    case 15:
      CCam::Process_Fixed(this, &ThisCamsTarget, COERCE_FLOAT(&gbFirstPersonRunThisFrame), *(float *)&ActiveCam, v124);
      break;
    case 16:
      CCam::Process_1stPerson(this, &ThisCamsTarget, ATanOfXY, *(float *)&ActiveCam, v124);
      break;
    case 17:
      CCam::Process_FlyBy(this, &ThisCamsTarget, ATanOfXY, this->SpeedVar, v18);
      break;
    case 29:
      CCam::ProcessPedsDeadBaby(this);
      TheCamera.m_bJustCameOutOfGarage = 0;
      TheCamera.m_bPlayerIsInGarage = 0;
      break;
    case 32:
      CCam::ProcessArrestCamOne(this);
      break;
    case 33:
      break;
    case 35:
      CCam::Process_SpecialFixedForSyphon(
        this,
        &ThisCamsTarget,
        COERCE_FLOAT(&gbFirstPersonRunThisFrame),
        *(float *)&ActiveCam,
        v124);
      break;
    case 39:
    case 40:
    case 41:
    case 42:
    case 43:
    case 52:
      CCam::Process_1rstPersonPedOnPC(this, &ThisCamsTarget, ATanOfXY, *(float *)&ActiveCam, v124);
      break;
    case 44:
      CCam::Process_Editor(this, 0, COERCE_FLOAT(&gbFirstPersonRunThisFrame), *(float *)&ActiveCam, v124);
      break;
    case 47:
      CCam::Process_AttachedCam(this);
      break;
    case 48:
      CCam::Process_Cam_TwoPlayer(this);
      break;
    case 49:
      CCam::Process_Cam_TwoPlayer_InCarAndShooting(this);
      break;
    case 50:
      CCam::Process_Cam_TwoPlayer_Separate_Cars(this);
      break;
    case 51:
      v98 = 1;
LABEL_154:
      CCam::Process_Rocket(this, 0, COERCE_FLOAT(&gbFirstPersonRunThisFrame), *(float *)&ActiveCam, v124, v98);
      break;
    case 53:
    case 55:
    case 65:
      CCam::Process_AimWeapon(
        this,
        &ThisCamsTarget,
        COERCE_FLOAT(&gbFirstPersonRunThisFrame),
        *(float *)&ActiveCam,
        v124);
      break;
    case 54:
      CCam::Process_Cam_TwoPlayer_Separate_Cars_TopDown(this);
      break;
    case 56:
      CCam::Process_DW_HeliChaseCam(this, 0);
      break;
    case 57:
      CCam::Process_DW_CamManCam(this, 0);
      break;
    case 58:
      CCam::Process_DW_BirdyCam(this, 0);
      break;
    case 59:
      CCam::Process_DW_PlaneSpotterCam(this, 0);
      break;
    case 60:
    case 61:
      TheCamera.m_bUseNearClipScript = 0;
      break;
    case 62:
      CCam::Process_DW_PlaneCam1(this, 0);
      break;
    case 63:
      CCam::Process_DW_PlaneCam2(this, 0);
      break;
    case 64:
      CCam::Process_DW_PlaneCam3(this, 0);
      break;
    default:
      this->Source.y = 0.0;
      this->Source.z = 0.0;
      this->Up.x = 0.0;
      this->Up.y = 0.0;
      this->Up.z = 1.0;
      *(_QWORD *)&this->Front.x = 0x3F80000000000000LL;
      *(_QWORD *)&this->Front.z = 0LL;
      break;
  }
  v99 = this->Mode;
  if ( (unsigned __int16)(v99 - 56) >= 9u )
    gDWLastModeForCineyCam = -1;
  gLastCamMode = v99;
  v100 = this->m_cvecTargetCoorsForFudgeInter.z;
  v101 = this->Source.z;
  v102 = this->Source.x - this->m_cvecTargetCoorsForFudgeInter.x;
  v103 = this->Source.y - this->m_cvecTargetCoorsForFudgeInter.y;
  v104 = sqrtf((float)(v102 * v102) + (float)(v103 * v103));
  this->m_fTrueBeta = CGeneral::GetATanOfXY(v102, v103);
  p_Source = &this->Source;
  this->m_fTrueAlpha = CGeneral::GetATanOfXY(v104, v101 - v100);
  if ( !TheCamera.m_uiTransitionState )
    CCam::KeepTrackOfTheSpeed(
      this,
      &this->Source,
      &this->m_cvecTargetCoorsForFudgeInter,
      &this->Up,
      &this->m_fTrueAlpha,
      &this->m_fTrueBeta,
      &this->FOV);
  this->LookingRight = 0;
  *(_WORD *)&this->LookingBehind = 0;
  v106 = *(_QWORD *)&p_Source->x;
  this->SourceBeforeLookBehind.z = this->Source.z;
  *(_QWORD *)&this->SourceBeforeLookBehind.x = v106;
  if ( &TheCamera.Cams[TheCamera.ActiveCam] == this )
  {
    if ( DirectionIsLooking == 2 )
    {
      v107 = this;
      v108 = 1;
    }
    else
    {
      if ( DirectionIsLooking != 1 )
      {
        if ( !DirectionIsLooking )
          CCam::LookBehind(this);
        goto LABEL_176;
      }
      v107 = this;
      v108 = 0;
    }
    CCam::LookRight(v107, v108);
LABEL_176:
    this->DirectionWasLooking = DirectionIsLooking;
  }
  if ( TheCamera.m_bFOVScript )
  {
    this->FOV = TheCamera.m_MyFOV;
    TheCamera.m_bFOVScript = 0;
  }
  if ( TheCamera.m_bVectorMoveScript )
  {
    v109 = *(_QWORD *)&TheCamera.m_VectorMoveScript.x;
    this->Source.z = TheCamera.m_VectorMoveScript.z;
    *(_QWORD *)&p_Source->x = v109;
    TheCamera.m_bVectorMoveScript = 0;
  }
  if ( TheCamera.m_bVectorTrackScript )
  {
    v110 = TheCamera.m_VectorTrackScript.z - this->Source.z;
    v111 = TheCamera.m_VectorTrackScript.y - this->Source.y;
    this->Front.x = TheCamera.m_VectorTrackScript.x - this->Source.x;
    this->Front.y = v111;
    this->Front.z = v110;
    CVector::Normalise(&this->Front);
    this->Up.x = 0.0;
    this->Up.y = 0.0;
    this->Up.z = 1.0;
    CVector::Normalise(&this->Front);
    if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
    {
      this->Front.x = 0.0001;
      this->Front.y = 0.0001;
    }
    CrossProduct(&v126, &this->Front, &this->Up);
    vecTarget = v126;
    CVector::Normalise(&vecTarget);
    CrossProduct(&v126, &vecTarget, &this->Front);
    v112 = *(_QWORD *)&v126.x;
    this->Up.z = v126.z;
    *(_QWORD *)&this->Up.x = v112;
    TheCamera.m_bVectorTrackScript = 0;
  }
}
// 3BF7D4: variable 'v1' is possibly undefined
// 3BF7D4: variable 'v2' is possibly undefined
// 3BFBDE: variable 'ActiveCam' is possibly undefined
// 3BFBDE: variable 'v124' is possibly undefined
// 3BFC20: variable 'v96' is possibly undefined
// 3BFC20: variable 'v97' is possibly undefined
// 3C0060: variable 'v3' is possibly undefined
// 3C0060: variable 'v4' is possibly undefined
// 18: using guessed type int (*off_18)();
// 2E: using guessed type __int16 word_2E;

//----- (003C01DC) --------------------------------------------------------
void __fastcall CIdleCam::IdleCamGeneralProcess(CIdleCam *this)
{
  char v1; // r0

  v1 = *((_BYTE *)&g_InterestingEvents + 300) & 0xFE;
  *((_BYTE *)&g_InterestingEvents + 300) &= ~1u;
  if ( TheCamera.Cams[TheCamera.ActiveCam].Mode != 4 )
  {
    gIdleCam.idleTickerFrames = 0;
    *((_BYTE *)&g_InterestingEvents + 300) = v1;
  }
}

//----- (003C0234) --------------------------------------------------------
bool __fastcall CCam::Using3rdPersonMouseCam(CCam *this)
{
  int InputType; // r0
  bool v3; // zf

  InputType = CHID::GetInputType();
  v3 = InputType == 2;
  if ( InputType == 2 )
    return this->Mode == 4;
  return v3;
}

//----- (003C0250) --------------------------------------------------------
bool __fastcall CCamera::GetCamDirectlyBehind(CCamera *this)
{
  CVehicle *PlayerVehicle; // r0
  CPad *Pad; // r0

  if ( FindPlayerPed(-1) )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    if ( PlayerVehicle )
    {
      if ( (unsigned int)(PlayerVehicle->m_vehicleType - 3) < 2 )
        return 1;
      Pad = currentPad;
      if ( !currentPad )
        Pad = CPad::GetPad(0);
      if ( CPad::IsFlyingRCVehicle(Pad) )
        return 1;
    }
  }
  return this->m_bCamDirectlyBehind;
}

//----- (003C02A0) --------------------------------------------------------
void __fastcall CCam::Process_FollowCar_SA(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired,
        int bScriptSetAngles)
{
  float32x2_t v6; // d0
  float32x2_t v7; // d1
  float32x2_t v8; // d2
  float32x2_t v9; // d3
  float32x2_t v10; // d4
  float32x2_t v11; // d5
  float32x2_t v12; // d8
  float32x2_t v13; // d12
  float32x2_t v14; // d13
  float32x2_t v15; // d14
  CEntity *CamTargetEntity; // r11
  __int64 v18; // d16
  CPad *Pad; // r6
  int v20; // s0
  CLink<CEntity *> *m_pLastRenderedLink; // r0
  int m_nModelIndex; // r0
  unsigned int v23; // r9
  bool v24; // zf
  bool v25; // zf
  int v26; // r10
  float m_fCarZoomSmoothed; // s16
  float fBaseCamDist; // s20
  unsigned __int32 v29; // r0
  int v30; // r0
  float *v31; // r1
  float v32; // s18
  float v33; // s16
  float y; // s0
  CEntity *v35; // r0
  float v36; // s0
  float v37; // s20
  float v38; // s22
  CColModel *ColModel; // r5
  CColModel *v40; // r0
  float v41; // s2
  float v42; // s0
  CColModel *v43; // r0
  int v44; // r1
  float v45; // s0
  int v46; // r0
  float v47; // s4
  float *v48; // r2
  RwReal v49; // s8
  RwReal v50; // s10
  RwReal v51; // r0
  bool v52; // zf
  RwReal x; // r1
  float32x2_t v54; // d10
  float fMinDist; // s22
  float v56; // s2
  float z; // s0
  float *p_xx; // r1
  RwReal v59; // s2
  float v60; // s24
  float v61; // s6
  float v62; // s31
  _BOOL4 ResetStatics; // r1
  RwReal v64; // r0
  bool v65; // zf
  float v66; // s0
  float FOV; // s0
  CVehicle *PlayerVehicle; // r0
  CPad *v69; // r0
  _BOOL4 m_bJustCameOutOfGarage; // r6
  float Alpha; // s18
  float *p_Alpha; // r9
  float Beta; // s0
  CMatrix *m_pMat; // r0
  float m_heading; // s0
  float v76; // r10
  float v77; // r6
  float v78; // s0
  float v79; // s28
  float v80; // r0
  float v81; // s18
  float v82; // s26
  float v83; // s0
  float v84; // s2
  float v85; // s4
  RwReal *p_y; // r4
  RwReal v87; // s10
  RwReal *p_z; // r5
  CVector *p_Front; // r3
  float v90; // s28
  float v91; // s30
  float v92; // s26
  float v93; // s24
  float v94; // s18
  float v95; // r0
  float v96; // s23
  float v97; // s25
  float32x2_t v98; // d9
  float v99; // s24
  float v100; // s0
  float v101; // s4
  float v102; // s0
  float v103; // s22
  float *v104; // r0
  unsigned __int64 v105; // d2
  float32x2_t v106; // d13
  float v107; // s2
  float32x2_t v108; // d3
  float v109; // s4
  bool v110; // nf
  float v111; // s4
  bool v112; // fzf
  bool v113; // fnf
  float32x2_t v114; // d1
  float32x2_t v115; // d2
  bool v116; // fzf
  bool v117; // fnf
  float v118; // s20
  float v119; // s30
  RwReal v120; // r0
  bool v121; // zf
  CMatrix *v122; // r0
  CColModel *v123; // r4
  int v124; // r0
  float v125; // s24
  float v126; // s23
  float v127; // s22
  CMatrix *v128; // r4
  CSimpleTransform *p_tx; // r3
  float v130; // s30
  float v131; // s21
  float v132; // s18
  float v133; // s0
  float v134; // s30
  float v135; // r0
  float v136; // r0
  float v137; // s22
  float v138; // r0
  float v139; // s30
  float xy; // s24
  float yy; // s22
  float v142; // s0
  int p_xy; // r5
  float v144; // r0
  float v145; // s21
  float v146; // s0
  float v147; // s18
  float v148; // s25
  CamFollowPedData *v149; // r0
  float v150; // s20
  CamFollowPedData *v151; // r4
  float v152; // r6
  float v153; // s22
  float v154; // r5
  float v155; // s21
  float v156; // r4
  int v157; // r0
  float v158; // s4
  float v159; // s0
  int v160; // r0
  int v161; // r5
  float v162; // s30
  unsigned int v163; // r10
  float v164; // s28
  float v165; // s21
  int v166; // r4
  float v167; // s29
  int v168; // r0
  CTask *ActiveTask; // r0
  float v170; // s0
  float v171; // s24
  float v172; // s2
  float v173; // s30
  float *v174; // r0
  float v175; // s23
  float v176; // s31
  float v177; // s21
  float v178; // s22
  float v179; // r0
  float v180; // s0
  float v181; // s25
  float32x2_t v182; // d9
  float v183; // s22
  float v184; // s0
  char v185; // r0
  float v186; // s30
  CVehicle *v187; // r0
  CPad *v188; // r0
  float v189; // s0
  float v190; // s4
  float v191; // s28
  float v192; // s21
  float v193; // s18
  CVehicle *v194; // r0
  CPad *v195; // r0
  _BOOL4 m_bCamDirectlyBehind; // r0
  float v197; // s0
  float v198; // s2
  float v199; // s2
  float v200; // s4
  float v201; // s20
  float v202; // s2
  int (**v203)(void); // r0
  unsigned __int8 *p_bdummy; // r0
  float v205; // s18
  float v206; // s0
  char v207; // r0
  float v208; // s0
  float v209; // s0
  float32x2_t v210; // d1
  float v211; // s0
  float v212; // s2
  CVehicle *v213; // r0
  CPad *v214; // r0
  float v215; // s4
  float v216; // s18
  float v217; // s0
  float v218; // s0
  float v219; // s22
  float v220; // r6
  float v221; // r5
  float v222; // s18
  float v223; // s24
  float v224; // s18
  float v225; // r0
  float v226; // s20
  float v227; // s2
  float v228; // s0
  float v229; // s0
  float v230; // s2
  float v231; // s4
  float v232; // s2
  float v233; // s2
  float v234; // s4
  float v235; // s2
  CVector *v236; // r6
  CVector *p_Up; // r9
  __int64 v238; // d16
  float v239; // s22
  float v240; // s19
  float v241; // s18
  RwReal v242; // s2
  RwReal v243; // s4
  __int64 v244; // d16
  __int64 v245; // d16
  float v246; // r0
  float v247; // r4
  float v248; // s21
  float v249; // s23
  float v250; // s21
  float v251; // r0
  char v252; // r0
  float v253; // s2
  float v254; // s0
  CEntity *v255; // r0
  _BOOL4 CanUseCameraHeightSetting; // r0
  bool v257; // zf
  float v258; // s2
  float v259; // s0
  float v260; // s0
  float v261; // s2
  float v262; // s4
  float v263; // s2
  float v264; // s2
  float v265; // s4
  float v266; // s2
  float v267; // s2
  float v268; // s0
  float v269; // s0
  float v270; // s2
  float v271; // s4
  float v272; // s2
  float v273; // s2
  float v274; // s2
  __int64 v275; // d16
  RwReal *v276; // [sp+8h] [bp-E0h]
  RwReal *v277; // [sp+Ch] [bp-DCh]
  float *p_x; // [sp+10h] [bp-D8h]
  float *v279; // [sp+14h] [bp-D4h]
  float v280; // [sp+18h] [bp-D0h]
  float32x2_t v281; // [sp+20h] [bp-C8h]
  CPad *v282; // [sp+28h] [bp-C0h]
  float v283; // [sp+28h] [bp-C0h]
  CVector *v284; // [sp+2Ch] [bp-BCh]
  float v285; // [sp+30h] [bp-B8h]
  int32 v286; // [sp+34h] [bp-B4h]
  unsigned __int64 v287; // [sp+38h] [bp-B0h]
  CVector *v288; // [sp+44h] [bp-A4h]
  RwReal *v289; // [sp+48h] [bp-A0h]
  int v290; // [sp+4Ch] [bp-9Ch]
  float *v291; // [sp+4Ch] [bp-9Ch]
  unsigned int v292; // [sp+50h] [bp-98h]
  RwReal *v293; // [sp+54h] [bp-94h]
  CVector pVecTargetCoords; // [sp+58h] [bp-90h] BYREF
  CVector v2; // [sp+68h] [bp-80h] BYREF
  CVector v296; // [sp+78h] [bp-70h] BYREF

  CamTargetEntity = this->CamTargetEntity;
  if ( !CamTargetEntity || (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
    return;
  v18 = *(_QWORD *)&ThisCamsTarget->x;
  pVecTargetCoords.z = ThisCamsTarget->z;
  *(_QWORD *)&pVecTargetCoords.x = v18;
  Pad = CPad::GetPad(0);
  if ( MobileSettings::settings[10].value )
  {
    v20 = 1067869798;
    if ( CVehicle::CanUseCameraHeightSetting((CVehicle *)CamTargetEntity) )
      v20 = 3.0;
  }
  else
  {
    v20 = 1067869798;
  }
  LODWORD(CARCAM_SET[0].fTargetOffsetZ) = v20;
  m_pLastRenderedLink = CamTargetEntity[18].m_pLastRenderedLink;
  if ( m_pLastRenderedLink && m_pLastRenderedLink[119].m_pNext == (CLink<CEntity *> *)((char *)&dword_0 + 1) )
    Pad = CPad::GetPad(1);
  CCamera::ApplyVehicleCameraTweaks(&TheCamera, (CVehicle *)CamTargetEntity);
  m_nModelIndex = CamTargetEntity->m_nModelIndex;
  v23 = 5;
  if ( m_nModelIndex > 500 )
  {
    if ( m_nModelIndex == 501 )
      goto LABEL_23;
    v25 = m_nModelIndex == 564;
    if ( m_nModelIndex != 564 )
      v25 = m_nModelIndex == 594;
    if ( !v25 )
      goto LABEL_21;
  }
  else
  {
    v24 = m_nModelIndex == 441;
    if ( m_nModelIndex != 441 )
      v24 = m_nModelIndex == 464;
    if ( !v24 )
    {
      if ( m_nModelIndex != 465 )
      {
LABEL_21:
        if ( CamTargetEntity[24]._vptr$CPlaceable == (int (**)(void))byte_9
          || (x = CamTargetEntity[24].m_transform.m_translate.x, LODWORD(x) == 2) )
        {
          v23 = 1;
        }
        else if ( LODWORD(x) == 3 )
        {
          v23 = 2;
        }
        else if ( LODWORD(x) == 4 )
        {
          v23 = 3;
          if ( (unsigned __int16)m_nModelIndex == 539 )
            v23 = 0;
        }
        else
        {
          v23 = 0;
          if ( LODWORD(x) == 5 )
            v23 = 4;
        }
        goto LABEL_24;
      }
LABEL_23:
      v23 = 6;
    }
  }
LABEL_24:
  v26 = 15 * v23;
  m_fCarZoomSmoothed = TheCamera.m_fCarZoomSmoothed;
  fBaseCamDist = CARCAM_SET[v23].fBaseCamDist;
  v29 = CVehicle::GetVehicleAppearance((const CVehicle *)CamTargetEntity) - 1;
  if ( v29 > 4 )
    v30 = 0;
  else
    v30 = dword_616840[v29];
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 0xF8) == 64 )
  {
    v31 = ZmTwoAlphaOffset;
LABEL_31:
    v32 = v31[v30] + 0.0;
    goto LABEL_33;
  }
  if ( (unsigned int)(TheCamera.m_nCarZoom - 1) <= 2 )
  {
    v31 = (float *)off_6679A4[TheCamera.m_nCarZoom - 1];
    goto LABEL_31;
  }
  v32 = 0.0;
LABEL_33:
  v33 = m_fCarZoomSmoothed + fBaseCamDist;
  v13.n64_u32[0] = LODWORD(CEntity::GetColModel(CamTargetEntity)->m_boxBound.m_vecMax.z);
  y = CEntity::GetColModel(CamTargetEntity)->m_boxBound.m_vecMin.y;
  v35 = *(CEntity **)&CamTargetEntity[20].RandomSeed;
  v36 = fabsf(y);
  v37 = v36 + v36;
  if ( !v35 )
  {
    v51 = CamTargetEntity[24].m_transform.m_translate.x;
    v52 = LODWORD(v51) == 9;
    if ( LODWORD(v51) != 9 )
      v52 = LODWORD(v51) == 2;
    if ( !v52 )
    {
      CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos = 0.0;
      goto LABEL_56;
    }
    v6.n64_f32[0] = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos;
    if ( *(_DWORD *)&CamTargetEntity[18].m_nScanCode )
    {
      v7.n64_u32[0] = 1.0;
      if ( CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos < 1.0 )
      {
        v6.n64_f32[0] = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos
                      + (float)(CTimer::ms_fTimeStep * 0.02);
        v6.n64_u64[0] = vmin_f32(v6, v7).n64_u64[0];
LABEL_54:
        CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos = v6.n64_f32[0];
      }
    }
    else if ( CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos > 0.0 )
    {
      v8.n64_u32[0] = 0;
      v6.n64_f32[0] = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos
                    + (float)(CTimer::ms_fTimeStep * -0.02);
      v6.n64_u64[0] = vmax_f32(v6, v8).n64_u64[0];
      goto LABEL_54;
    }
    v13.n64_f32[0] = v13.n64_f32[0] + (float)(v6.n64_f32[0] * 0.4);
    goto LABEL_56;
  }
  v14.n64_u32[0] = 1.0;
  v38 = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos;
  if ( CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos < 1.0 )
  {
    v6.n64_f32[0] = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos
                  + (float)(CTimer::ms_fTimeStep * 0.02);
    LODWORD(v38) = vmin_f32(v6, v14).n64_u32[0];
    CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos = v38;
  }
  ColModel = CEntity::GetColModel(v35);
  v40 = CEntity::GetColModel(*(CEntity **)&CamTargetEntity[20].RandomSeed);
  v41 = ColModel->m_boxBound.m_vecMax.y - v40->m_boxBound.m_vecMin.y;
  v8.n64_f32[0] = ColModel->m_boxBound.m_vecMax.z - v40->m_boxBound.m_vecMin.z;
  v12.n64_f32[1] = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos;
  v42 = (float)((float)(ColModel->m_boxBound.m_vecMax.x - v40->m_boxBound.m_vecMin.x)
              * (float)(ColModel->m_boxBound.m_vecMax.x - v40->m_boxBound.m_vecMin.x))
      + (float)(v41 * v41);
  v43 = CEntity::GetColModel(*(CEntity **)&CamTargetEntity[20].RandomSeed);
  v7.n64_f32[0] = sqrtf(v42 + (float)(v8.n64_f32[0] * v8.n64_f32[0]));
  v44 = *(_DWORD *)&CamTargetEntity[20].RandomSeed;
  v45 = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::sBlendExtraPos * 0.5;
  v8.n64_u32[0] = LODWORD(v43->m_boxBound.m_vecMax.z);
  v46 = *(_DWORD *)(v44 + 20);
  LODWORD(v47) = vmax_f32(v13, v8).n64_u32[0];
  v48 = (float *)(v46 + 48);
  if ( !v46 )
    v48 = (float *)(v44 + 4);
  v8.n64_f32[1] = v38 * 0.5;
  v6.n64_f32[1] = pVecTargetCoords.y * (float)(1.0 - v45);
  v7.n64_f32[1] = (float)(1.0 - v45) * pVecTargetCoords.z;
  v49 = v6.n64_f32[1] + (float)(v45 * v48[1]);
  v50 = v7.n64_f32[1] + (float)(v45 * v48[2]);
  v6.n64_f32[0] = (float)(pVecTargetCoords.x * (float)(1.0 - v45)) + (float)(v45 * *v48);
  v13.n64_f32[0] = v13.n64_f32[0] + (float)(v12.n64_f32[1] * (float)(v47 - v13.n64_f32[0]));
  v37 = v37 + (float)((float)(v38 * 0.5) * v7.n64_f32[0]);
  pVecTargetCoords.y = v49;
  pVecTargetCoords.z = v50;
  LODWORD(pVecTargetCoords.x) = v6.n64_u32[0];
LABEL_56:
  v54.n64_f32[0] = v37 * TheCamera.m_VehicleTweakLenMod;
  fMinDist = CARCAM_SET[v23].fMinDist;
  v12.n64_f32[0] = v33 + v54.n64_f32[0];
  if ( CVehicle::GetVehicleAppearance((const CVehicle *)CamTargetEntity) == APR_HELI
    && (*(_BYTE *)&CamTargetEntity->m_info & 0xF8) != 64 )
  {
    p_xx = &CamTargetEntity->m_pMat->xx;
    v59 = (float)(v13.n64_f32[0] * (float)(fTestShiftHeliCamTarget * p_xx[9])) + pVecTargetCoords.y;
    z = (float)(v13.n64_f32[0] * (float)(fTestShiftHeliCamTarget * p_xx[10])) + pVecTargetCoords.z;
    pVecTargetCoords.x = (float)(v13.n64_f32[0] * (float)(fTestShiftHeliCamTarget * p_xx[8])) + pVecTargetCoords.x;
    pVecTargetCoords.y = v59;
    pVecTargetCoords.z = z;
  }
  else
  {
    v56 = (float)(v13.n64_f32[0] * CARCAM_SET[v23].fTargetOffsetZ) - CARCAM_SET[v23].fBaseCamZ;
    z = pVecTargetCoords.z;
    if ( v56 > 0.0 )
    {
      v12.n64_f32[0] = v12.n64_f32[0] + v56;
      z = v56 + pVecTargetCoords.z;
      pVecTargetCoords.z = v56 + pVecTargetCoords.z;
      v32 = v32 + (float)((float)(v56 * 0.3) / v12.n64_f32[0]);
    }
  }
  v60 = TheCamera.m_VehicleTweakTargetZMod * z;
  v7.n64_u32[0] = LODWORD(CARCAM_SET[v23].fMinFollowDist);
  v61 = v7.n64_f32[0];
  pVecTargetCoords.z = TheCamera.m_VehicleTweakTargetZMod * z;
  v62 = v32 + TheCamera.m_VehicleTweakPitchMod;
  if ( TheCamera.m_nCarZoom == 1 )
    v61 = v7.n64_f32[0] * 0.65;
  if ( v23 < 2 )
    v7.n64_f32[0] = v61;
  ResetStatics = this->ResetStatics;
  v287 = vmax_f32(v12, v7).n64_u64[0];
  this->CA_MIN_DISTANCE = 3.5;
  LODWORD(this->CA_MAX_DISTANCE) = v12.n64_u32[0];
  v286 = v23;
  v282 = Pad;
  v292 = 15 * v23;
  if ( ResetStatics )
  {
    this->FOV = 70.0;
  }
  else
  {
    v64 = CamTargetEntity[24].m_transform.m_translate.x;
    v65 = LODWORD(v64) == 9;
    if ( LODWORD(v64) != 9 )
      v65 = LODWORD(v64) == 0;
    if ( v65 )
    {
      v66 = (float)((float)(CamTargetEntity[1].m_transform.m_translate.z * CamTargetEntity->m_pMat->xy)
                  + (float)(CamTargetEntity[1].m_transform.m_heading * CamTargetEntity->m_pMat->yy))
          + (float)(*(float *)&CamTargetEntity[1].m_pMat * CamTargetEntity->m_pMat->zy);
      if ( v66 > CAR_FOV_START_SPEED )
        this->FOV = this->FOV + (float)((float)(v66 - CAR_FOV_START_SPEED) * CTimer::ms_fTimeStep);
    }
    FOV = this->FOV;
    if ( FOV > 70.0 )
    {
      FOV = (float)((float)(FOV + -70.0) * powf(CAR_FOV_FADE_MULT, CTimer::ms_fTimeStep)) + 70.0;
      this->FOV = FOV;
    }
    if ( FOV <= 100.0 )
    {
      if ( FOV < 70.0 )
        this->FOV = 70.0;
    }
    else
    {
      this->FOV = 100.0;
    }
    if ( !FindPlayerPed(-1) )
      goto LABEL_85;
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    if ( !PlayerVehicle )
      goto LABEL_85;
    if ( (unsigned int)(PlayerVehicle->m_vehicleType - 3) >= 2 )
    {
      v69 = currentPad;
      if ( !currentPad )
        v69 = CPad::GetPad(0);
      if ( !CPad::IsFlyingRCVehicle(v69) )
      {
LABEL_85:
        if ( !((TheCamera.m_bCamDirectlyInFront || TheCamera.m_bCamDirectlyBehind) << 24) )
        {
          v85 = this->m_aTargetHistoryPos[0].x;
          v84 = this->m_aTargetHistoryPos[0].y;
          p_z = &this->m_aTargetHistoryPos[1].z;
          v83 = this->m_aTargetHistoryPos[0].z;
          p_y = &this->Front.y;
          v289 = &this->m_aTargetHistoryPos[1].y;
          v288 = &this->m_aTargetHistoryPos[1];
          v293 = &this->Front.z;
          v277 = &this->m_aTargetHistoryPos[0].z;
          v276 = &this->m_aTargetHistoryPos[0].y;
          p_Front = &this->Front;
          v81 = pVecTargetCoords.x;
          v82 = pVecTargetCoords.y;
          goto LABEL_98;
        }
      }
    }
  }
  this->m_bCollisionChecksOn = 1;
  this->Rotating = 0;
  this->ResetStatics = 0;
  m_bJustCameOutOfGarage = TheCamera.m_bJustCameOutOfGarage;
  TheCamera.m_bResetOldMatrix = 1;
  if ( TheCamera.m_bJustCameOutOfGarage )
    m_bJustCameOutOfGarage = 1;
  v290 = bScriptSetAngles | m_bJustCameOutOfGarage;
  if ( bScriptSetAngles | m_bJustCameOutOfGarage )
  {
    Alpha = this->Alpha;
    p_Alpha = &this->Alpha;
    Beta = this->Beta;
  }
  else
  {
    this->Alpha = 0.0;
    p_Alpha = &this->Alpha;
    m_pMat = CamTargetEntity->m_pMat;
    if ( m_pMat )
      m_heading = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
    else
      m_heading = CamTargetEntity->m_transform.m_heading;
    Beta = m_heading + -1.5708;
    Alpha = 0.0;
    this->Beta = Beta;
    if ( TheCamera.m_bCamDirectlyInFront )
    {
      Beta = Beta + 3.1416;
      this->Beta = Beta;
    }
  }
  v76 = cosf(Beta);
  v77 = cosf(Alpha);
  v78 = sinf(Beta);
  this->AlphaSpeed = 0.0;
  v79 = v77 * v78;
  v80 = sinf(Alpha);
  v9.n64_u32[1] = HIDWORD(v287);
  this->BetaSpeed = 0.0;
  this->Distance = 1000.0;
  this->Front.z = v80;
  this->Front.x = -(float)(v76 * v77);
  this->Front.y = -(float)(v77 * v78);
  v81 = pVecTargetCoords.x;
  v82 = pVecTargetCoords.y;
  v83 = v60 - (float)(*(float *)&v287 * v80);
  v84 = pVecTargetCoords.y + (float)(*(float *)&v287 * v79);
  v85 = pVecTargetCoords.x + (float)(*(float *)&v287 * (float)(v76 * v77));
  p_y = &this->Front.y;
  v9.n64_f32[0] = pVecTargetCoords.x + (float)(v12.n64_f32[0] * (float)(v76 * v77));
  v87 = pVecTargetCoords.y + (float)(v12.n64_f32[0] * v79);
  this->m_nTargetHistoryTime[0] = CTimer::m_snTimeInMilliseconds;
  this->m_aTargetHistoryPos[0].x = v85;
  this->m_aTargetHistoryPos[0].y = v84;
  this->m_aTargetHistoryPos[0].z = v83;
  LODWORD(this->m_aTargetHistoryPos[1].x) = v9.n64_u32[0];
  this->m_aTargetHistoryPos[1].y = v87;
  this->m_aTargetHistoryPos[1].z = v60 - (float)(v12.n64_f32[0] * v80);
  this->m_nCurrentHistoryPoints = 0;
  p_z = &this->m_aTargetHistoryPos[1].z;
  v289 = &this->m_aTargetHistoryPos[1].y;
  v288 = &this->m_aTargetHistoryPos[1];
  v293 = &this->Front.z;
  v277 = &this->m_aTargetHistoryPos[0].z;
  v276 = &this->m_aTargetHistoryPos[0].y;
  if ( !v290 )
    *p_Alpha = -v62;
  v23 = v286;
  p_Front = &this->Front;
  v26 = v292;
LABEL_98:
  p_x = &p_Front->x;
  p_Front->x = v81 - v85;
  *p_y = v82 - v84;
  *v293 = v60 - v83;
  CVector::Normalise(&this->Front);
  v90 = this->Front.x;
  v91 = *p_y;
  v92 = v82 - *v289;
  v93 = v60 - *p_z;
  v94 = v81 - v288->x;
  v95 = atan2f(COERCE_FLOAT(LODWORD(v90) ^ 0x80000000), *p_y);
  v98.n64_u32[1] = LODWORD(CamTargetEntity[1].m_transform.m_translate.z);
  v96 = CamTargetEntity[1].m_transform.m_heading;
  v54.n64_f32[1] = v93 * v93;
  v97 = (float)(v94 * v94) + (float)(v92 * v92);
  v98.n64_f32[0] = (float)(v98.n64_f32[1] * v98.n64_f32[1]) + (float)(v96 * v96);
  v99 = v95 + -1.5708;
  v100 = sqrtf(v98.n64_f32[0]);
  if ( (float)(v95 + -1.5708) < -3.1416 )
    v99 = (float)(v95 + -1.5708) + 6.2832;
  v7.n64_f32[0] = v99;
  if ( v100 > 0.02 )
    v7.n64_f32[0] = atan2f(COERCE_FLOAT(v98.n64_u32[1] ^ 0x80000000), CamTargetEntity[1].m_transform.m_heading)
                  + -1.5708;
  if ( v7.n64_f32[0] <= (float)(v99 + 3.1416) )
  {
    if ( v7.n64_f32[0] >= (float)(v99 + -3.1416) )
      goto LABEL_107;
    v101 = 6.2832;
  }
  else
  {
    v101 = -6.2832;
  }
  v7.n64_f32[0] = v7.n64_f32[0] + v101;
LABEL_107:
  v6.n64_f32[0] = sqrtf(v97 + v54.n64_f32[1]);
  v281.n64_u64[0] = v6.n64_u64[0];
  v102 = *v293;
  v54.n64_f32[0] = fMinDist * v54.n64_f32[0];
  v103 = *(float *)&CamTargetEntity[1].m_pMat;
  v11.n64_u32[0] = 1.0;
  v8.n64_f32[0] = (float)((float)(v90 * v98.n64_f32[1]) + (float)(v91 * v96)) + (float)(*v293 * v103);
  v10.n64_f32[0] = v90 * v8.n64_f32[0];
  v15.n64_f32[0] = CTimer::ms_fTimeStep;
  v104 = &CARCAM_SET[0].fTargetOffsetZ + v26;
  v10.n64_f32[0] = v98.n64_f32[1] - v10.n64_f32[0];
  v98.n64_u32[1] = LODWORD(this->Beta);
  v8.n64_f32[0] = (float)(v104[10] * CTimer::ms_fTimeStep)
                * sqrtf(
                    (float)((float)(v103 - (float)(*v293 * v8.n64_f32[0]))
                          * (float)(v103 - (float)(*v293 * v8.n64_f32[0])))
                  + (float)((float)(v10.n64_f32[0] * v10.n64_f32[0])
                          + (float)((float)(v96 - (float)(v91 * v8.n64_f32[0]))
                                  * (float)(v96 - (float)(v91 * v8.n64_f32[0])))));
  v9.n64_f32[0] = CTimer::ms_fTimeStep * v104[11];
  v10.n64_f32[0] = -v9.n64_f32[0];
  v105 = vmin_f32(v8, v11).n64_u64[0];
  v7.n64_f32[0] = (float)(v7.n64_f32[0] - v99) * *(float *)&v105;
  v106.n64_f32[1] = v99 + vmax_f32(vmin_f32(v7, v9), v10).n64_f32[0];
  if ( v106.n64_f32[1] <= (float)(v98.n64_f32[1] + 3.1416) )
  {
    if ( v106.n64_f32[1] >= (float)(v98.n64_f32[1] + -3.1416) )
      goto LABEL_112;
    v107 = 6.2832;
  }
  else
  {
    v107 = -6.2832;
  }
  v106.n64_f32[1] = v106.n64_f32[1] + v107;
LABEL_112:
  LODWORD(v105) = 1.0;
  v108.n64_u64[0] = v105;
  v109 = *v293;
  if ( v102 > 1.0 )
    v109 = v108.n64_f32[0];
  v110 = v109 < -1.0;
  v111 = v108.n64_f32[0];
  v112 = v102 == v108.n64_f32[0];
  v113 = v102 < v108.n64_f32[0];
  if ( v110 )
  {
    v111 = -1.0;
    v102 = -1.0;
  }
  if ( !v113 && !v112 )
    v102 = v111;
  v114.n64_u64[0] = vmax_f32(v54, v281).n64_u64[0];
  v115.n64_u64[0] = __PAIR64__(v281.n64_u32[1], v12.n64_u32[0]);
  v116 = v12.n64_f32[0] == v54.n64_f32[0];
  v117 = v12.n64_f32[0] < v54.n64_f32[0];
  v118 = asinf(v102);
  if ( v281.n64_f32[0] < v12.n64_f32[0] )
    v115.n64_u32[0] = v114.n64_u32[0];
  if ( !v117 && !v116 )
    v12.n64_u32[0] = v115.n64_u32[0];
  v119 = *(&CARCAM_SET[0].fUpLimit + v26);
  v291 = p_y;
  v279 = p_z;
  if ( (float)(v98.n64_f32[0] + (float)(v103 * v103)) < 0.04
    && (CamTargetEntity[24]._vptr$CPlaceable != (int (**)(void))byte_9
     || LOBYTE(CamTargetEntity[34].m_nFlags.bdummy) >= 4u) )
  {
    v120 = CamTargetEntity[24].m_transform.m_translate.x;
    if ( LODWORD(v120) != 3 )
    {
      v121 = LODWORD(v120) == 4;
      if ( LODWORD(v120) == 4 )
        v121 = LOBYTE(CamTargetEntity[40].m_pMat) == 0;
      if ( !v121 )
      {
        v122 = CamTargetEntity->m_pMat;
        v2.x = 0.0;
        v2.y = 0.0;
        v2.z = 1.0;
        CrossProduct(&v296, (const CVector *)&v122->xy, &v2);
        CVector::Normalise(&v296);
        CrossProduct(&v2, &v296, (const CVector *)&CamTargetEntity->m_pMat->xy);
        CVector::Normalise(&v2);
        if ( (float)((float)((float)(this->Front.x * v2.x) + (float)(*p_y * v2.y)) + (float)(*v293 * v2.z)) > 0.0 )
        {
          v123 = CEntity::GetColModel(CamTargetEntity);
          *(float *)&v124 = COERCE_FLOAT((*((int (__fastcall **)(CEntity *))CamTargetEntity->_vptr$CPlaceable + 54))(CamTargetEntity));
          v125 = v123->m_boxBound.m_vecMin.y;
          v126 = *(float *)&v124;
          v127 = v123->m_boxBound.m_vecMax.x;
          v128 = CamTargetEntity->m_pMat;
          p_tx = (CSimpleTransform *)&v128->tx;
          if ( !v128 )
            p_tx = &CamTargetEntity->m_transform;
          v130 = pVecTargetCoords.z - p_tx->m_translate.z;
          v131 = atan2f(v127, COERCE_FLOAT(LODWORD(v125) ^ 0x80000000));
          v132 = this->Beta;
          if ( v128 )
            v133 = atan2f(COERCE_FLOAT(LODWORD(v128->xy) ^ 0x80000000), v128->yy);
          else
            v133 = CamTargetEntity->m_transform.m_heading;
          v134 = v126 + v130;
          v135 = sinf(v132 - (float)(v133 + -1.5708));
          v136 = asinf(COERCE_FLOAT(LODWORD(v135) & 0x7FFFFFFF));
          v6.n64_f32[0] = v136;
          if ( v136 <= v131 )
          {
            v137 = 1.5 - v125;
          }
          else
          {
            v6.n64_f32[0] = 1.5708 - v136;
            v137 = v127 + 1.2;
            v114.n64_u32[0] = 0;
            v6.n64_u64[0] = vmax_f32(v6, v114).n64_u64[0];
          }
          v138 = cosf(v6.n64_f32[0]);
          v139 = atan2f(v134, (float)(v137 / v138) * 1.2);
          if ( v128 )
          {
            xy = v128->xy;
            yy = v128->yy;
            v142 = atan2f(COERCE_FLOAT(LODWORD(xy) ^ 0x80000000), yy);
            p_xy = (int)&v128->xy;
          }
          else
          {
            p_xy = 16;
            LODWORD(yy) = 1;
            LODWORD(xy) = 2621443;
            v142 = CamTargetEntity->m_transform.m_heading;
          }
          v144 = cosf(v132 - (float)(v142 + -1.5708));
          v145 = *(float *)(p_xy + 8);
          v119 = v139 + (float)(v144 * atan2f(v145, sqrtf((float)(xy * xy) + (float)(yy * yy))));
          if ( !CamTargetEntity[24]._vptr$CPlaceable
            && LOBYTE(CamTargetEntity[40].m_pMat) >= 2u
            && fabsf(
                 (float)((float)(xy * *(float *)&CamTargetEntity[1].m_pRwObject)
                       + (float)(yy * *(float *)&CamTargetEntity[1].m_nFlags))
               + (float)(v145 * *(float *)&CamTargetEntity[1].m_nFlags.bdummy)) < 0.05 )
          {
            if ( v128 )
              v146 = atan2f(COERCE_FLOAT(LODWORD(xy) ^ 0x80000000), yy);
            else
              v146 = CamTargetEntity->m_transform.m_heading;
            v147 = cosf((float)(v132 - (float)(v146 + -1.5708)) + 1.5708);
            v119 = v119
                 + (float)(v147 * atan2f(v128->zx, sqrtf((float)(v128->xx * v128->xx) + (float)(v128->yx * v128->yx))));
          }
        }
      }
    }
  }
  v148 = v119;
  v284 = &this->Front;
  if ( (float)(v118 - v62) <= v119 )
  {
    v148 = v118 - v62;
    v149 = &CARCAM_SET[v292 / 0xF];
    if ( (float)(v118 - v62) < (float)-v149->fDownLimit )
      v148 = -v149->fDownLimit;
  }
  v150 = CTimer::ms_fTimeStep;
  v151 = &CARCAM_SET[v292 / 0xF];
  v152 = powf(v151->fDiffAlphaRate, CTimer::ms_fTimeStep);
  v153 = this->Alpha;
  v106.n64_u32[0] = LODWORD(v151->fDiffAlphaCap);
  v154 = CPad::AimWeaponLeftRight(v282, 0, 0);
  v155 = (float)((float)CPad::AimWeaponUpDown(v282, 0, 0) * 1.2) * 0.0006;
  if ( CHID::GetInputType() == 2 )
    v155 = 0.0;
  v285 = v62;
  v280 = v119;
  if ( CHID::GetInputType() == 1 )
  {
    v156 = CPad::AimWeaponLeftRight(v282, 0, 0);
    v157 = CPad::AimWeaponUpDown(v282, 0, 0);
    v158 = this->FOV / 80.0;
    v155 = CTimer::ms_fTimeStep
         * (float)(v158
                 * (float)((float)((float)((float)((float)MobileSettings::settings[26].value / 100.0) * 0.0004)
                                 + 0.000175)
                         * (float)v157));
    v159 = -(float)(CTimer::ms_fTimeStep
                  * (float)(v158
                          * (float)(v156
                                  * (float)((float)((float)((float)MobileSettings::settings[25].value / 100.0) * 0.0005)
                                          + 0.000175))));
  }
  else
  {
    v159 = (float)(v154 * -1.6) * 0.0006;
  }
  v114.n64_u32[0] = 1.0;
  v160 = CamTargetEntity->m_nModelIndex;
  v161 = 1;
  LODWORD(v162) = vmax_f32(v15, v114).n64_u32[0];
  if ( v160 < 520 )
  {
    if ( v160 == 406 )
    {
      v163 = v292;
    }
    else
    {
      v163 = v292;
      if ( v160 != 443 && v160 != 486 )
      {
LABEL_227:
        if ( CamTargetEntity[24]._vptr$CPlaceable )
          v161 = 0;
        else
          v161 = (BYTE2(CamTargetEntity[15].m_transform.m_translate.z) >> 1) & 1;
      }
    }
  }
  else
  {
    v163 = v292;
    switch ( CamTargetEntity->m_nModelIndex )
    {
      case 0x208:
      case 0x20C:
      case 0x20D:
      case 0x212:
      case 0x213:
      case 0x234:
        break;
      case 0x209:
      case 0x20A:
      case 0x20B:
      case 0x20E:
      case 0x20F:
      case 0x210:
      case 0x211:
      case 0x214:
      case 0x215:
      case 0x216:
      case 0x217:
      case 0x218:
      case 0x219:
      case 0x21A:
      case 0x21B:
      case 0x21C:
      case 0x21D:
      case 0x21E:
      case 0x21F:
      case 0x220:
      case 0x221:
      case 0x222:
      case 0x223:
      case 0x224:
      case 0x225:
      case 0x226:
      case 0x227:
      case 0x228:
      case 0x229:
      case 0x22A:
      case 0x22B:
      case 0x22C:
      case 0x22D:
      case 0x22E:
      case 0x22F:
      case 0x230:
      case 0x231:
      case 0x232:
      case 0x233:
        goto LABEL_227;
      default:
        v163 = v292;
        if ( v160 != 592 )
          goto LABEL_227;
        break;
    }
  }
  v164 = 0.0;
  if ( DirectionIsLooking == 3 )
    v164 = v155;
  v165 = 0.0;
  if ( DirectionIsLooking == 3 )
    v165 = v159;
  if ( v164 > 0.0 )
    v164 = v164 * 0.5;
  if ( CHID::GetInputType() == 2 && !v282->DisablePlayerControls )
  {
    v191 = CPad::NewMouseControllerState.m_AmountMoved.y;
    v192 = -CPad::NewMouseControllerState.m_AmountMoved.x;
    v193 = (float)((float)((float)MobileSettings::settings[31].value / 100.0) * 0.02) + 0.0005;
    if ( !MobileSettings::settings[15].value )
      v191 = -CPad::NewMouseControllerState.m_AmountMoved.y;
    v283 = (float)((float)((float)MobileSettings::settings[32].value / 100.0) * 0.015) + 0.0005;
    if ( !FindPlayerPed(-1) )
      goto LABEL_221;
    v194 = FindPlayerVehicle(-1, 0);
    if ( !v194 )
      goto LABEL_221;
    if ( (unsigned int)(v194->m_vehicleType - 3) < 2 )
      goto LABEL_220;
    v195 = currentPad;
    if ( !currentPad )
      v195 = CPad::GetPad(0);
    if ( CPad::IsFlyingRCVehicle(v195) )
    {
LABEL_220:
      m_bCamDirectlyBehind = 1;
    }
    else
    {
LABEL_221:
      m_bCamDirectlyBehind = TheCamera.m_bCamDirectlyBehind;
      if ( TheCamera.m_bCamDirectlyBehind )
        m_bCamDirectlyBehind = 1;
    }
    v167 = this->Alpha;
    v166 = 1;
    v197 = this->FOV / 80.0;
    if ( m_bCamDirectlyBehind )
    {
      v191 = 0.0;
      v192 = 0.0;
    }
    this->AlphaSpeed = 0.0;
    this->BetaSpeed = 0.0;
    v164 = (float)(v283 * v191) * v197;
    v165 = (float)(v193 * v192) * v197;
  }
  else
  {
    v166 = 0;
    v167 = v148;
  }
  v168 = *(_DWORD *)&CamTargetEntity[18].m_nScanCode;
  if ( v168 )
  {
    if ( CTaskManager::GetActiveTask((const CTaskManager *)(*(_DWORD *)(v168 + 1088) + 4)) )
    {
      ActiveTask = CTaskManager::GetActiveTask((const CTaskManager *)(*(_DWORD *)(*(_DWORD *)&CamTargetEntity[18].m_nScanCode
                                                                                + 1088)
                                                                    + 4));
      if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 1309 )
      {
        if ( BYTE1(CTaskManager::GetActiveTask((const CTaskManager *)(*(_DWORD *)(*(_DWORD *)&CamTargetEntity[18].m_nScanCode
                                                                                + 1088)
                                                                    + 4))[5].m_pParent) << 31 )
        {
          v164 = 0.0;
          if ( this->Alpha < (float)(v280 + -0.1) )
            v164 = CTimer::ms_fTimeStep * 0.0035;
        }
      }
    }
  }
  v170 = (float)(v106.n64_f32[1] - v98.n64_f32[1]) / v162;
  v171 = v106.n64_f32[0];
  v106.n64_f32[0] = v150 * v106.n64_f32[0];
  v98.n64_f32[0] = (float)(1.0 - v152) * (float)(v148 - v153);
  if ( v161 == 1 )
  {
    if ( gLastCamMode == 18 )
    {
      if ( CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gAcquiredAlpha )
        goto LABEL_189;
    }
    else
    {
      CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gAcquiredAlpha = 0;
    }
    v172 = this->Alpha;
    if ( fabsf(v62 + v172) <= 0.05 )
    {
LABEL_189:
      CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gAcquiredAlpha = 1;
      goto LABEL_190;
    }
    v164 = (float)((float)-v62 - v172) * 0.05;
  }
LABEL_190:
  v173 = CTimer::ms_fTimeStep;
  v174 = &CARCAM_SET[0].fTargetOffsetZ + v163;
  v175 = v174[12];
  v176 = v174[9];
  v177 = v165 * v175;
  v178 = v170 + v177;
  v179 = powf(v174[8], CTimer::ms_fTimeStep);
  v180 = v176;
  v181 = v179;
  if ( v178 <= v176 )
  {
    v180 = v178;
    if ( v178 < (float)-v176 )
      v180 = -v176;
  }
  v182.n64_u64[0] = vmin_f32(v98, v106).n64_u64[0];
  v183 = 1.0 - v179;
  v184 = (float)((float)(1.0 - v179) * v180) + (float)(v179 * this->BetaSpeed);
  if ( fabsf(v184) < 0.0001 )
    v184 = 0.0;
  this->BetaSpeed = v184;
  if ( v166 != 1 )
  {
    v177 = v184 * v173;
    v186 = v280;
    goto LABEL_239;
  }
  v185 = `guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta;
  __dmb(0xBu);
  if ( (v185 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta) )
  {
    CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta = this->Beta;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta);
  }
  v186 = v280;
  if ( this->ResetKeyboardStatics )
    CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta = this->Beta;
  if ( !FindPlayerPed(-1) )
    goto LABEL_209;
  v187 = FindPlayerVehicle(-1, 0);
  if ( !v187 )
    goto LABEL_209;
  if ( (unsigned int)(v187->m_vehicleType - 3) >= 2 )
  {
    v188 = currentPad;
    if ( !currentPad )
      v188 = CPad::GetPad(0);
    if ( !CPad::IsFlyingRCVehicle(v188) )
    {
LABEL_209:
      if ( !TheCamera.m_bCamDirectlyBehind )
      {
        v108.n64_u32[0] = 1.0;
        v189 = (float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) / 1000.0;
        v114.n64_f32[0] = v189 * 100.0;
        v114.n64_u64[0] = vmin_f32(v114, v108).n64_u64[0];
        v114.n64_f32[0] = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta
                        + (float)(v177 + (float)(this->BetaSpeed * v114.n64_f32[0]));
        CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta = v114.n64_f32[0];
        if ( v114.n64_f32[0] <= 3.1416 )
        {
          if ( v114.n64_f32[0] >= -3.1416 )
          {
LABEL_234:
            v198 = v114.n64_f32[0] - this->Beta;
            v6.n64_f32[0] = v189 * 12.5;
            if ( v198 > 3.1416 )
              v198 = v198 + -6.2832;
            if ( v198 < -3.1416 )
              v198 = v198 + 6.2832;
            v115.n64_u32[0] = 1.0;
            v6.n64_u64[0] = vmin_f32(v6, v115).n64_u64[0];
            v177 = v198 * v6.n64_f32[0];
            goto LABEL_239;
          }
          v190 = 6.2832;
        }
        else
        {
          v190 = -6.2832;
        }
        v114.n64_f32[0] = v114.n64_f32[0] + v190;
        CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta = v114.n64_f32[0];
        goto LABEL_234;
      }
    }
  }
LABEL_239:
  v199 = v177 + this->Beta;
  this->Beta = v199;
  if ( TheCamera.m_bJustCameOutOfGarage )
  {
    v199 = CGeneral::GetATanOfXY(this->Front.x, *v291) + 3.1416;
    this->Beta = v199;
  }
  v6.n64_f32[0] = -(float)(v150 * v171);
  if ( v199 > 3.1416 )
  {
    v200 = -6.2832;
LABEL_244:
    this->Beta = v199 + v200;
    goto LABEL_245;
  }
  v200 = 6.2832;
  if ( v199 < -3.1416 )
    goto LABEL_244;
LABEL_245:
  v201 = v164 * v175;
  if ( v23 <= 1 )
  {
    v114.n64_u32[1] = v281.n64_u32[1];
    if ( v281.n64_f32[0] >= v12.n64_f32[0] )
    {
      v202 = this->Alpha;
      if ( v167 < v202 )
      {
        v203 = CamTargetEntity[24]._vptr$CPlaceable;
        if ( v203 == (int (**)(void))byte_9 )
        {
          p_bdummy = (unsigned __int8 *)&CamTargetEntity[34].m_nFlags.bdummy;
        }
        else
        {
          if ( v203 )
            goto LABEL_254;
          p_bdummy = (unsigned __int8 *)&CamTargetEntity[40].m_pMat;
        }
        if ( *p_bdummy >= 2u )
          v201 = v201 + (float)((float)(v167 - v202) * 0.075);
      }
    }
  }
LABEL_254:
  LODWORD(v205) = vmax_f32(v182, v6).n64_u32[0];
  v206 = (float)(v183 * v201) + (float)(v181 * this->AlphaSpeed);
  if ( v201 > 0.0 )
    v176 = v176 * 0.5;
  this->AlphaSpeed = v206;
  if ( v206 > v176 || (v176 = -v176, v206 < v176) )
  {
    v206 = v176;
    this->AlphaSpeed = v176;
  }
  if ( fabsf(v206) < 0.0001 )
  {
    this->AlphaSpeed = 0.0;
    v206 = 0.0;
  }
  if ( v166 != 1 )
  {
    v167 = v167 + (float)(v206 * CTimer::ms_fTimeStep);
    v209 = this->Alpha;
    goto LABEL_286;
  }
  v207 = `guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha;
  __dmb(0xBu);
  if ( (v207 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha) )
  {
    CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha = this->Alpha;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha);
  }
  if ( this->ResetKeyboardStatics )
  {
    v208 = this->Alpha;
    CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha = v208;
    this->ResetKeyboardStatics = 0;
  }
  else
  {
    v208 = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha;
  }
  v114.n64_f32[0] = (float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) / 1000.0) * 45.0;
  v115.n64_u32[0] = 1.0;
  v210.n64_u64[0] = vmin_f32(v114, v115).n64_u64[0];
  v211 = v208 + (float)(v201 + (float)(v205 * v210.n64_f32[0]));
  CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha = v211;
  if ( v211 <= 3.1416 )
  {
    if ( v211 >= -3.1416 )
      goto LABEL_274;
    v212 = 6.2832;
  }
  else
  {
    v212 = -6.2832;
  }
  CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha = v211 + v212;
LABEL_274:
  if ( FindPlayerPed(-1) )
  {
    v213 = FindPlayerVehicle(-1, 0);
    if ( v213 )
    {
      if ( (unsigned int)(v213->m_vehicleType - 3) < 2 )
        goto LABEL_287;
      v214 = currentPad;
      if ( !currentPad )
        v214 = CPad::GetPad(0);
      if ( CPad::IsFlyingRCVehicle(v214) )
        goto LABEL_287;
    }
  }
  if ( TheCamera.m_bCamDirectlyBehind )
    goto LABEL_287;
  v209 = this->Alpha;
  v215 = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha - v209;
  if ( (float)(CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha - v209) > 3.1416 )
    v215 = (float)(CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha - v209)
         + -6.2832;
  if ( v215 < -3.1416 )
    v215 = v215 + 6.2832;
  v108.n64_u32[0] = 1.0;
  v210.n64_f32[0] = (float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0) / 1000.0) * 12.5;
  v205 = v215 * vmin_f32(v210, v108).n64_f32[0];
LABEL_286:
  this->Alpha = v205 + v209;
LABEL_287:
  v216 = this->Alpha;
  if ( v216 > v186 || (v186 = -*(&CARCAM_SET[0].fDownLimit + v163), v216 < v186) )
  {
    v216 = v186;
    this->AlphaSpeed = 0.0;
    this->Alpha = v186;
  }
  v217 = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldAlpha;
  if ( fabsf(CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldAlpha - v216) < 0.0001 )
  {
    this->Alpha = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldAlpha;
    v216 = v217;
  }
  v218 = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldBeta;
  CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldAlpha = v216;
  v219 = this->Beta;
  if ( fabsf(CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldBeta - v219) < 0.0001 )
  {
    this->Beta = CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldBeta;
    v219 = v218;
  }
  v220 = v216;
  v221 = cosf(v219);
  v222 = cosf(v216);
  v223 = -(float)(v221 * v222);
  v224 = -(float)(v222 * sinf(v219));
  v225 = sinf(v220);
  v226 = 5.0;
  CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gOldBeta = v219;
  v227 = 5.0;
  *p_x = v223;
  *v291 = v224;
  *v293 = v225;
  v228 = this->Source.x;
  v110 = v228 < 0.0;
  v229 = v228 * 100000.0;
  if ( v110 )
    v227 = -5.0;
  modff((float)(v229 + v227) / 10.0, &v296.x);
  v230 = this->Source.y;
  v231 = 5.0;
  v110 = v230 < 0.0;
  v232 = v230 * 100000.0;
  if ( v110 )
    v231 = -5.0;
  this->Source.x = v296.x / 10000.0;
  modff((float)(v232 + v231) / 10.0, &v296.x);
  v233 = this->Source.z;
  v234 = 5.0;
  v110 = v233 < 0.0;
  v235 = v233 * 100000.0;
  if ( v110 )
    v234 = -5.0;
  this->Source.y = v296.x / 10000.0;
  modff((float)(v235 + v234) / 10.0, &v296.x);
  this->Source.z = v296.x / 10000.0;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  v236 = &this->Front;
  CVector::Normalise(v284);
  p_Up = &this->Up;
  if ( this->Front.x == 0.0 && *v291 == 0.0 )
  {
    v284->x = 0.0001;
    *v291 = 0.0001;
  }
  CrossProduct(&v2, v284, &this->Up);
  v296 = v2;
  CVector::Normalise(&v296);
  CrossProduct(&v2, &v296, v284);
  v238 = *(_QWORD *)&v2.x;
  this->Up.z = v2.z;
  *(_QWORD *)&p_Up->x = v238;
  v239 = pVecTargetCoords.x;
  *(_WORD *)&TheCamera.m_bCamDirectlyBehind = 0;
  v240 = pVecTargetCoords.y;
  v241 = pVecTargetCoords.z;
  v242 = pVecTargetCoords.y - (float)(v12.n64_f32[0] * *v291);
  v243 = pVecTargetCoords.z - (float)(v12.n64_f32[0] * *v293);
  this->Source.x = pVecTargetCoords.x - (float)(v12.n64_f32[0] * this->Front.x);
  this->Source.y = v242;
  this->Source.z = v243;
  v244 = *(_QWORD *)&pVecTargetCoords.x;
  this->m_cvecTargetCoorsForFudgeInter.z = pVecTargetCoords.z;
  *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = v244;
  v245 = *(_QWORD *)&this->m_aTargetHistoryPos[0].x;
  this->m_aTargetHistoryPos[2].z = this->m_aTargetHistoryPos[0].z;
  *(_QWORD *)&this->m_aTargetHistoryPos[2].x = v245;
  v246 = cosf(v285 + v167);
  v247 = this->Beta;
  v248 = v246;
  v249 = cosf(v247) * v246;
  v250 = v248 * sinf(v247);
  v251 = sinf(v285 + v167);
  this->m_aTargetHistoryPos[0].x = (float)(*(float *)&v287 * v249) + v239;
  *v276 = (float)(*(float *)&v287 * v250) + v240;
  *v277 = v241 - (float)(*(float *)&v287 * v251);
  v288->x = v239 + (float)(v12.n64_f32[0] * v249);
  *v289 = v240 + (float)(v12.n64_f32[0] * v250);
  *v279 = v241 - (float)(v12.n64_f32[0] * v251);
  CCamera::SetColVarsVehicle(v286, TheCamera.m_nCarZoom);
  if ( DirectionIsLooking == 3 )
  {
    v252 = 0;
    TheCamera.m_numExtrasEntitysToIgnore = 0;
    CWorld::pIgnoreEntity = CamTargetEntity;
    v253 = 0.01;
    v254 = (float)((float)(CamTargetEntity[1].m_transform.m_translate.z * CamTargetEntity[1].m_transform.m_translate.z)
                 + (float)(CamTargetEntity[1].m_transform.m_heading * CamTargetEntity[1].m_transform.m_heading))
         + (float)(*(float *)&CamTargetEntity[1].m_pMat * *(float *)&CamTargetEntity[1].m_pMat);
    if ( v254 > 0.04 )
      v253 = 1.0;
    CCollision::bCamCollideWithVehicles = 1;
    if ( v254 <= 0.04 )
      v252 = 1;
    CCollision::relVelCamCollisionVehiclesSqr = v253;
    CCollision::bCamCollideWithPeds = v252;
    CCollision::bCamCollideWithObjects = v252;
    v255 = *(CEntity **)&CamTargetEntity[20].RandomSeed;
    if ( v255 )
    {
      TheCamera.m_numExtrasEntitysToIgnore = 1;
      TheCamera.m_pExtrasEntitysToIgnore[0] = v255;
    }
    if ( (CamTargetEntity[17].m_nScanCode & 0x400) != 0 )
      gTopSphereCastTest = 1;
    CanUseCameraHeightSetting = CVehicle::CanUseCameraHeightSetting((CVehicle *)CamTargetEntity);
    v257 = MobileSettings::settings[10].value == 0;
    if ( MobileSettings::settings[10].value )
      v257 = !CanUseCameraHeightSetting;
    if ( v257 )
    {
      CCamera::CameraColDetAndReact((CCamera *)CanUseCameraHeightSetting, &this->Source, &pVecTargetCoords);
    }
    else
    {
      pVecTargetCoords.z = v241 + -0.425;
      CCamera::CameraColDetAndReact((CCamera *)CanUseCameraHeightSetting, &this->Source, &pVecTargetCoords);
      if ( MobileSettings::settings[10].value )
        pVecTargetCoords.z = pVecTargetCoords.z + 0.425;
    }
    CCamera::ImproveNearClip(&TheCamera, (CVehicle *)CamTargetEntity, 0, &this->Source, (int)&pVecTargetCoords);
    v258 = 5.0;
    CWorld::pIgnoreEntity = 0;
    v259 = this->Source.x;
    v110 = v259 < 0.0;
    v260 = v259 * 100000.0;
    if ( v110 )
      v258 = -5.0;
    modff((float)(v260 + v258) / 10.0, &v296.x);
    v261 = this->Source.y;
    v262 = 5.0;
    v110 = v261 < 0.0;
    v263 = v261 * 100000.0;
    if ( v110 )
      v262 = -5.0;
    this->Source.x = v296.x / 10000.0;
    modff((float)(v263 + v262) / 10.0, &v296.x);
    v264 = this->Source.z;
    v265 = 5.0;
    v110 = v264 < 0.0;
    v266 = v264 * 100000.0;
    if ( v110 )
      v265 = -5.0;
    this->Source.y = v296.x / 10000.0;
    modff((float)(v266 + v265) / 10.0, &v296.x);
    this->Source.z = v296.x / 10000.0;
    v236 = &this->Front;
  }
  v267 = 5.0;
  *(_WORD *)&TheCamera.m_bCamDirectlyBehind = 0;
  v268 = this->Source.x;
  v110 = v268 < 0.0;
  v269 = v268 * 100000.0;
  if ( v110 )
    v267 = -5.0;
  modff((float)(v269 + v267) / 10.0, &v296.x);
  v270 = this->Source.y;
  v271 = 5.0;
  v110 = v270 < 0.0;
  v272 = v270 * 100000.0;
  if ( v110 )
    v271 = -5.0;
  this->Source.x = v296.x / 10000.0;
  modff((float)(v272 + v271) / 10.0, &v296.x);
  v273 = this->Source.z;
  v110 = v273 < 0.0;
  v274 = v273 * 100000.0;
  if ( v110 )
    v226 = -5.0;
  this->Source.y = v296.x / 10000.0;
  modff((float)(v274 + v226) / 10.0, &v296.x);
  this->Source.z = v296.x / 10000.0;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(v236);
  if ( this->Front.x == 0.0 && *v291 == 0.0 )
  {
    v236->x = 0.0001;
    *v291 = 0.0001;
  }
  CrossProduct(&v2, v236, &this->Up);
  v296 = v2;
  CVector::Normalise(&v296);
  CrossProduct(&v2, &v296, v236);
  v275 = *(_QWORD *)&v2.x;
  this->Up.z = v2.z;
  *(_QWORD *)&p_Up->x = v275;
  gTargetCoordsForLookingBehind = pVecTargetCoords;
}
// 3C046C: variable 'v6' is possibly undefined
// 3C046C: variable 'v14' is possibly undefined
// 3C04E6: variable 'v13' is possibly undefined
// 3C04E6: variable 'v8' is possibly undefined
// 3C05A4: variable 'v7' is possibly undefined
// 3C079C: variable 'v12' is possibly undefined
// 3C0C28: variable 'v11' is possibly undefined
// 3C0C38: variable 'v9' is possibly undefined
// 3C0C3C: variable 'v10' is possibly undefined
// 3C11B0: variable 'v15' is possibly undefined
// 0: using guessed type int dword_0;
// 10: using guessed type __int16 word_10;
// 14: using guessed type int dword_14;
// 18: using guessed type int (*off_18)();
// 616840: using guessed type _DWORD dword_616840[5];
// 6679A4: using guessed type float (*off_6679A4[6])[5];
// 952E08: using guessed type char CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::gAcquiredAlpha;
// 952E10: using guessed type char `guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetBeta;
// 952E18: using guessed type char `guard variable for'CCam::Process_FollowCar_SA(CVector const&,float,float,float,bool)::fVehicleTargetAlpha;

//----- (003C220C) --------------------------------------------------------
void __fastcall CCam::Process_FollowPedWithMouse(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d2
  float32x2_t v8; // d13
  float32x2_t v9; // d15
  CEntity *CamTargetEntity; // r0
  CPad *Pad; // r0
  int v15; // r8
  float Beta; // s18
  __int64 v17; // d16
  int v18; // r5
  float v19; // s16
  float y; // s20
  float x; // s16
  CPad *v22; // r0
  int v23; // r5
  CPad *v24; // r0
  int v25; // r0
  float v26; // s0
  float v27; // s2
  float v28; // s0
  float v29; // s4
  float v30; // s20
  float v31; // s16
  RwReal v32; // s4
  RwReal v33; // s2
  float v34; // s0
  float Alpha; // s0
  float *p_Alpha; // r6
  float v37; // s2
  float v38; // s4
  float v39; // s22
  float v40; // s20
  float v41; // s24
  CVehicle *PlayerVehicle; // r0
  CPad *v43; // r0
  float v44; // s20
  float v45; // r0
  float v46; // r6
  float v47; // r8
  float v48; // s16
  float v49; // s18
  float v50; // r0
  CVector *p_Source; // r5
  RwReal v52; // s2
  RwReal v53; // s0
  __int64 v54; // d16
  float32x2_t v55; // d16
  float32x2_t v56; // d16
  __int64 v57; // d16
  float v58; // s0
  float v59; // s0
  __int64 v60; // d16
  float v61; // r0
  float v62; // s24
  int v63; // r9
  float v64; // s6
  float v65; // s0
  float v66; // s8
  float v67; // s2
  float z; // s4
  float v69; // s10
  float v70; // s12
  float v71; // s16
  float v72; // s19
  float v73; // s17
  float v74; // s21
  float v75; // s0
  CEntity *v76; // r0
  float v77; // s16
  float v78; // s22
  float v79; // s20
  float v80; // s26
  float v81; // s18
  float v82; // s24
  float Distance; // s28
  float v84; // s30
  CVector *p_Front; // r8
  float v86; // r0
  float v87; // s0
  __int64 v88; // d16
  float v89; // r1
  CMatrix *m_pMat; // r0
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  CMatrix *v93; // r0
  RwMatrix *v94; // r1
  CEntity *refEntityPtr; // [sp+2Ch] [bp-C4h] BYREF
  CColPoint v96; // [sp+30h] [bp-C0h] BYREF
  CVector vecStart; // [sp+60h] [bp-90h] BYREF
  CVector v98; // [sp+70h] [bp-80h] BYREF
  CVector v99; // [sp+80h] [bp-70h] BYREF
  CVector v100; // 0:r0.12
  CVector v101; // 0:r0.12

  CamTargetEntity = this->CamTargetEntity;
  this->FOV = 70.0;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 3 )
    return;
  if ( this->ResetStatics )
  {
    this->m_bCollisionChecksOn = 1;
    this->Rotating = 0;
    Pad = CPad::GetPad(0);
    CPad::ClearMouseHistory(Pad);
    this->ResetStatics = 0;
  }
  v15 = 0;
  if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 6 )
    v15 = 1;
  Beta = TargetOrientation;
  vecStart.z = ThisCamsTarget->z;
  v17 = *(_QWORD *)&ThisCamsTarget->x;
  v18 = 0;
  *(_QWORD *)&vecStart.x = v17;
  v19 = fTranslateCamUp + vecStart.z;
  vecStart.z = fTranslateCamUp + vecStart.z;
  if ( (CPad::GetPad(0)->DisablePlayerControls & 0x20) != 0 )
  {
    v32 = this->Source.z - v19;
    v33 = this->Source.y - vecStart.y;
    v96.m_vecPosition.x = this->Source.x - vecStart.x;
    v96.m_vecPosition.y = v33;
    v96.m_vecPosition.z = v32;
    CVector::Normalise(&v96.m_vecPosition);
    if ( v96.m_vecPosition.z >= -0.9 )
      v34 = atan2f(v96.m_vecPosition.y, v96.m_vecPosition.x);
    else
      v34 = TargetOrientation + 3.1416;
    v30 = 0.0;
    v31 = v34 - this->Beta;
  }
  else
  {
    CPad::GetPad(0);
    y = CPad::NewMouseControllerState.m_AmountMoved.y;
    x = CPad::NewMouseControllerState.m_AmountMoved.x;
    if ( CPad::NewMouseControllerState.m_AmountMoved.x != 0.0 )
      v18 = 1;
    if ( (CPad::NewMouseControllerState.m_AmountMoved.y != 0.0) | v18 && !CPad::GetPad(0)->DisablePlayerControls )
    {
      v28 = this->FOV / 80.0;
      v29 = (float)(x * -2.5) * 0.0025;
      v30 = (float)((float)(y * 4.0) * 0.0015) * v28;
    }
    else
    {
      v22 = CPad::GetPad(0);
      v23 = CPad::LookAroundLeftRight(v22);
      v24 = CPad::GetPad(0);
      v25 = CPad::LookAroundUpDown(v24);
      v26 = this->FOV / 80.0;
      v27 = (float)(fStickSens * (float)v25) * (float)(v26 * 0.042857);
      v28 = (float)(fStickSens * (float)-v23) * (float)(v26 * 0.071429);
      v29 = CTimer::ms_fTimeStep;
      v30 = CTimer::ms_fTimeStep * v27;
    }
    v31 = v29 * v28;
  }
  if ( TheCamera.m_bFading && TheCamera.m_iFadingDirection == 1 )
  {
    if ( CDraw::FadeValue > 0xC8u || CDraw::FadeValue > (unsigned int)nFadeControlThreshhold )
      goto LABEL_26;
  }
  else if ( CDraw::FadeValue > 0xC8u )
  {
    goto LABEL_26;
  }
  if ( (CPad::GetPad(0)->DisablePlayerControls & 0x20) == 0 )
  {
    Alpha = this->Alpha;
    p_Alpha = &this->Alpha;
    goto LABEL_33;
  }
LABEL_26:
  p_Alpha = &this->Alpha;
  v30 = -0.05;
  Alpha = this->Alpha;
  if ( Alpha < (float)(fDefaultAlphaOrient + -0.05) )
  {
    v30 = 0.05;
    goto LABEL_33;
  }
  if ( Alpha < fDefaultAlphaOrient )
    goto LABEL_29;
  if ( Alpha <= (float)(fDefaultAlphaOrient + 0.05) )
  {
    if ( Alpha > fDefaultAlphaOrient )
    {
LABEL_29:
      v30 = fDefaultAlphaOrient - Alpha;
      goto LABEL_33;
    }
    v30 = 0.0;
  }
LABEL_33:
  v5.n64_f32[0] = v30 + Alpha;
  v37 = v31 + this->Beta;
  this->Beta = v37;
  *p_Alpha = v5.n64_f32[0];
  if ( v37 > 3.1416 )
  {
    v38 = -6.2832;
LABEL_37:
    this->Beta = v37 + v38;
    goto LABEL_38;
  }
  if ( v37 < -3.1416 )
  {
    v38 = 6.2832;
    goto LABEL_37;
  }
LABEL_38:
  v6.n64_u32[0] = 1061752795;
  if ( v5.n64_f32[0] > 0.7854 || (v6.n64_u32[0] = -1077415450, v5.n64_f32[0] < -1.5621) )
  {
    v5.n64_u64[0] = v6.n64_u64[0];
    *p_Alpha = v6.n64_f32[0];
  }
  v39 = fAngleDist;
  v40 = fBaseDist;
  if ( v5.n64_f32[0] > 0.0 )
  {
    v7.n64_u32[0] = 1070141403;
    v5.n64_f32[0] = v5.n64_f32[0] * fFalloff;
    v5.n64_u64[0] = vmin_f32(v5, v7).n64_u64[0];
  }
  v41 = cosf(v5.n64_f32[0]);
  if ( TheCamera.m_bUseTransitionBeta )
    this->Beta = this->m_fTransitionBeta;
  if ( FindPlayerPed(-1) )
  {
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    if ( PlayerVehicle )
    {
      if ( (unsigned int)(PlayerVehicle->m_vehicleType - 3) < 2 )
        goto LABEL_52;
      v43 = currentPad;
      if ( !currentPad )
        v43 = CPad::GetPad(0);
      if ( CPad::IsFlyingRCVehicle(v43) )
        goto LABEL_52;
    }
  }
  if ( TheCamera.m_bCamDirectlyBehind )
LABEL_52:
    this->Beta = TheCamera.m_PedOrientForBehindOrInFront + 3.1416;
  if ( TheCamera.m_bCamDirectlyInFront )
    this->Beta = TheCamera.m_PedOrientForBehindOrInFront;
  v44 = v40 + (float)(v39 * v41);
  if ( v15 )
    this->Beta = Beta;
  else
    Beta = this->Beta;
  v45 = cosf(Beta);
  v46 = *p_Alpha;
  v47 = v45;
  v48 = cosf(v46);
  v49 = v48 * sinf(Beta);
  v50 = sinf(v46);
  this->Front.z = v50;
  this->Front.x = -(float)(v47 * v48);
  this->Front.y = -v49;
  p_Source = &this->Source;
  v52 = vecStart.y + (float)(v44 * v49);
  v53 = vecStart.z - (float)(v44 * v50);
  this->Source.x = vecStart.x + (float)(v44 * (float)(v47 * v48));
  this->Source.y = v52;
  this->Source.z = v53;
  v54 = *(_QWORD *)&vecStart.x;
  this->m_cvecTargetCoorsForFudgeInter.z = vecStart.z;
  *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = v54;
  refEntityPtr = 0;
  CWorld::pIgnoreEntity = this->CamTargetEntity;
  if ( CWorld::ProcessLineOfSight(&vecStart, &this->Source, &v96, &refEntityPtr, 1, 1, 1, 1, 0, 0, 1, 0) != 1 )
    goto LABEL_69;
  v55.n64_u64[0] = vsub_f32(*(float32x2_t *)&vecStart.y, *(float32x2_t *)&v96.m_vecPosition.y).n64_u64[0];
  v6.n64_u64[0] = vmul_f32(v55, v55).n64_u64[0];
  v5.n64_f32[0] = sqrtf(
                    (float)((float)((float)(vecStart.x - v96.m_vecPosition.x) * (float)(vecStart.x - v96.m_vecPosition.x))
                          + v6.n64_f32[0])
                  + v6.n64_f32[1]);
  if ( (*(_BYTE *)&refEntityPtr->m_info & 7) == 3 && (float)(v44 - v5.n64_f32[0]) > 0.4 )
  {
    if ( CWorld::ProcessLineOfSight(&v96.m_vecPosition, &this->Source, &v96, &refEntityPtr, 1, 1, 1, 1, 0, 0, 1, 0) != 1 )
    {
      v6.n64_u32[0] = 1063675494;
      v5.n64_f32[0] = (float)(v44 - v5.n64_f32[0]) + -0.35;
      v5.n64_u64[0] = vmin_f32(v5, v6).n64_u64[0];
      goto LABEL_68;
    }
    v56.n64_u64[0] = vsub_f32(*(float32x2_t *)&vecStart.y, *(float32x2_t *)&v96.m_vecPosition.y).n64_u64[0];
    v6.n64_u64[0] = vmul_f32(v56, v56).n64_u64[0];
    v57 = *(_QWORD *)&v96.m_vecPosition.x;
    v58 = (float)(vecStart.x - v96.m_vecPosition.x) * (float)(vecStart.x - v96.m_vecPosition.x);
    this->Source.z = v96.m_vecPosition.z;
    *(_QWORD *)&p_Source->x = v57;
    v59 = sqrtf((float)(v58 + v6.n64_f32[0]) + v6.n64_f32[1]);
    if ( v59 < 0.6 )
    {
      v7.n64_u32[0] = 1028443341;
      v5.n64_f32[0] = v59 + -0.3;
LABEL_66:
      v5.n64_u64[0] = vmax_f32(v5, v7).n64_u64[0];
LABEL_68:
      RwCameraSetNearClipPlane(Scene.camera, v5.n64_f32[0]);
    }
  }
  else
  {
    v60 = *(_QWORD *)&v96.m_vecPosition.x;
    this->Source.z = v96.m_vecPosition.z;
    *(_QWORD *)&p_Source->x = v60;
    if ( v5.n64_f32[0] < 0.6 )
    {
      v7.n64_u32[0] = 1028443341;
      v5.n64_f32[0] = v5.n64_f32[0] + -0.3;
      goto LABEL_66;
    }
  }
LABEL_69:
  CWorld::pIgnoreEntity = 0;
  v61 = tanf((float)((float)(this->FOV * 3.1416) / 180.0) * 0.5);
  v9.n64_u32[0] = LODWORD(Scene.camera->nearPlane);
  v62 = v61 * (float)(CDraw::ms_fAspectRatio * 1.1);
  v100.x = (float)(v9.n64_f32[0] * this->Front.x) + this->Source.x;
  v100.y = (float)(v9.n64_f32[0] * this->Front.y) + this->Source.y;
  v100.z = (float)(v9.n64_f32[0] * this->Front.z) + this->Source.z;
  if ( CWorld::TestSphereAgainstWorld(v100, v9.n64_f32[0] * v62, 0, 1, 1, 0, 1, 0, 0) )
  {
    v8.n64_u32[0] = 1036831949;
    v63 = 0;
    do
    {
      v64 = gaTempSphereColPoints[0].m_vecPosition.x - this->Source.x;
      v65 = this->Front.x;
      v66 = gaTempSphereColPoints[0].m_vecPosition.y - this->Source.y;
      v67 = this->Front.y;
      z = this->Front.z;
      v69 = gaTempSphereColPoints[0].m_vecPosition.z - this->Source.z;
      v5.n64_f32[1] = v69 * z;
      v70 = (float)((float)(v64 * v65) + (float)(v66 * v67)) + (float)(v69 * z);
      v5.n64_f32[0] = sqrtf(
                        (float)((float)(v69 - (float)(z * v70)) * (float)(v69 - (float)(z * v70)))
                      + (float)((float)((float)(v64 - (float)(v65 * v70)) * (float)(v64 - (float)(v65 * v70)))
                              + (float)((float)(v66 - (float)(v67 * v70)) * (float)(v66 - (float)(v67 * v70)))))
                    / v62;
      v71 = vmax_f32(vmin_f32(v9, v5), v8).n64_f32[0];
      if ( v71 < v9.n64_f32[0] )
        RwCameraSetNearClipPlane(Scene.camera, v71);
      if ( v71 == 0.1 )
      {
        v72 = this->Source.x + (float)((float)(vecStart.x - this->Source.x) * 0.3);
        v73 = this->Source.y + (float)((float)(vecStart.y - this->Source.y) * 0.3);
        v74 = this->Source.z + (float)((float)(vecStart.z - this->Source.z) * 0.3);
        this->Source.x = v72;
        this->Source.y = v73;
        this->Source.z = v74;
      }
      else
      {
        v72 = this->Source.x;
        v73 = this->Source.y;
        v74 = this->Source.z;
      }
      v9.n64_u32[0] = LODWORD(Scene.camera->nearPlane);
      v75 = CDraw::ms_fAspectRatio
          * (float)((float)(v9.n64_f32[0] * tanf((float)((float)(this->FOV * 3.1416) / 180.0) * 0.5)) * 1.1);
      v101.x = (float)(v9.n64_f32[0] * this->Front.x) + v72;
      v101.y = (float)(v9.n64_f32[0] * this->Front.y) + v73;
      v101.z = (float)(v9.n64_f32[0] * this->Front.z) + v74;
      v76 = CWorld::TestSphereAgainstWorld(v101, v75, 0, 1, 1, 0, 1, 0, 0);
      if ( v63 > 4 )
        break;
      ++v63;
    }
    while ( v76 );
  }
  v77 = vecStart.x;
  v78 = this->Source.x;
  v79 = vecStart.y;
  v80 = this->Source.y;
  v81 = vecStart.z;
  v82 = this->Source.z;
  Distance = this->Distance;
  v84 = sqrtf(
          (float)((float)((float)(vecStart.x - v78) * (float)(vecStart.x - v78))
                + (float)((float)(vecStart.y - v80) * (float)(vecStart.y - v80)))
        + (float)((float)(vecStart.z - v82) * (float)(vecStart.z - v82)));
  if ( v84 >= Distance )
  {
    v86 = powf(0.92, CTimer::ms_fTimeStep);
    v87 = (float)(Distance * v86) + (float)(v84 * (float)(1.0 - v86));
    this->Distance = v87;
    if ( v84 > 0.05 )
    {
      this->Source.x = v77 + (float)((float)(1.0 / v84) * (float)(v87 * (float)(v78 - v77)));
      this->Source.y = v79 + (float)((float)(1.0 / v84) * (float)(v87 * (float)(v80 - v79)));
      this->Source.z = v81 + (float)((float)(1.0 / v84) * (float)(v87 * (float)(v82 - v81)));
    }
    p_Front = &this->Front;
    v5.n64_f32[0] = v87 - fRangePlayerRadius;
    if ( v5.n64_f32[0] < Scene.camera->nearPlane )
    {
      v6.n64_u32[0] = 1036831949;
      RwCameraSetNearClipPlane(Scene.camera, vmax_f32(v5, v6).n64_f32[0]);
    }
  }
  else
  {
    this->Distance = v84;
    p_Front = &this->Front;
  }
  *(_WORD *)&TheCamera.m_bCamDirectlyBehind = 0;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(p_Front);
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v98, p_Front, &this->Up);
  v99 = v98;
  CVector::Normalise(&v99);
  CrossProduct(&v98, &v99, p_Front);
  v88 = *(_QWORD *)&v98.x;
  this->Up.z = v98.z;
  *(_QWORD *)&this->Up.x = v88;
  if ( TheCamera.m_bFading && TheCamera.m_iFadingDirection == 1 && CDraw::FadeValue >= 0x81u )
  {
    v89 = atan2f(COERCE_FLOAT(LODWORD(this->Front.x) ^ 0x80000000), this->Front.y);
    *(float *)&TheCamera.pTargetEntity[22].m_pLod = v89;
    *(float *)&TheCamera.pTargetEntity[22].numLodChildren = v89;
    m_pMat = TheCamera.pTargetEntity->m_pMat;
    if ( m_pMat )
      CMatrix::SetRotateZOnly(m_pMat, v89);
    else
      TheCamera.pTargetEntity->m_transform.m_heading = v89;
    m_pRwObject = TheCamera.pTargetEntity->m_pRwObject;
    if ( m_pRwObject )
    {
      parent = (char *)m_pRwObject->parent;
      v93 = TheCamera.pTargetEntity->m_pMat;
      v94 = (RwMatrix *)(parent + 16);
      if ( v93 )
        CMatrix::UpdateRwMatrix(v93, v94);
      else
        CSimpleTransform::UpdateRwMatrix(&TheCamera.pTargetEntity->m_transform, v94);
    }
  }
}
// 3C24E4: variable 'v6' is possibly undefined
// 3C2522: variable 'v5' is possibly undefined
// 3C2522: variable 'v7' is possibly undefined
// 3C299E: variable 'v9' is possibly undefined
// 3C29A2: variable 'v8' is possibly undefined
// 18: using guessed type int (*off_18)();
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003C2DA0) --------------------------------------------------------
void __fastcall CCam::Process_FollowPed_SA(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired,
        int a6)
{
  float32x2_t v6; // d0
  float32x2_t v7; // d1
  float32x2_t v8; // d2
  float32x2_t v9; // d3
  float32x2_t v10; // d4
  float32x2_t v11; // d5
  float32x2_t v12; // d6
  float32x2_t v13; // d8
  float32x2_t v14; // d9
  float32x2_t v15; // d13
  float32x2_t v16; // d14
  CEntity *CamTargetEntity; // r0
  CEntity *v20; // r8
  CPad *Pad; // r6
  const CPedIntelligence *y_low; // r4
  __int64 v23; // d16
  eVisibleArea v24; // r2
  int32 m_nPedZoom; // r0
  int v26; // r11
  bool v27; // zf
  float fBaseCamDist; // s16
  char *v29; // r2
  float32x2_t v30; // d10
  float *p_m_fTargetZoomThreeZExtra; // r0
  CTaskSimpleSwim *TaskSwim; // r0
  const CPedIntelligence *v33; // r1
  int m_nSwimState; // r4
  float v35; // s23
  float v36; // s28
  _BOOL4 ResetStatics; // r0
  float FOV; // s2
  float *v39; // r5
  float v40; // s24
  CMatrix *v41; // r0
  CSimpleTransform *p_tx; // r3
  __int64 v43; // d16
  __int64 v44; // d16
  CTaskSimpleDuck *v45; // r0
  float v46; // s4
  float v47; // s0
  float *v48; // r1
  _BOOL4 m_bJustCameOutOfGarage; // r0
  int v50; // r8
  int v51; // r0
  float v52; // s0
  CVehicle *PlayerVehicle; // r0
  CPad *v54; // r0
  RwReal y; // r0
  int v56; // r1
  bool v57; // zf
  int v58; // r1
  int v59; // r2
  bool v60; // zf
  float v61; // s2
  float v62; // s4
  float v63; // s8
  RwReal v64; // s2
  RwReal v65; // s4
  float *v66; // r0
  RwReal v67; // s2
  RwReal v68; // s4
  float v69; // s0
  int v70; // r9
  float v71; // s18
  float v72; // r5
  float v73; // r11
  float v74; // r6
  float v75; // s0
  float v76; // r0
  RwReal v77; // s8
  RwReal v78; // s4
  RwReal v79; // s10
  float v80; // s0
  CPad *v81; // r0
  float x; // s18
  RwReal v83; // s4
  float v84; // s20
  RwReal v85; // s2
  float v86; // r0
  float v87; // s20
  CMatrix *m_pMat; // r0
  float m_heading; // s0
  float v90; // s18
  char v91; // r1
  _BOOL4 v92; // r4
  bool v93; // zf
  float32x2_t v94; // d12
  float32x2_t v95; // d0
  bool v96; // zf
  float *v97; // r0
  RwReal v98; // r0
  float z; // s4
  float32x2_t v100; // d16
  float v101; // s4
  float v102; // s19
  float Beta; // s30
  float v104; // s0
  float v105; // s0
  float v106; // s2
  bool v107; // nf
  float v108; // s2
  bool v109; // fzf
  bool v110; // fnf
  float v111; // r0
  float v112; // s0
  float v113; // s18
  float v114; // s31
  float v115; // r0
  bool v116; // zf
  float32x2_t v117; // d16
  float v118; // s0
  float32x2_t v119; // d16
  float v120; // s22
  float v121; // s31
  float v122; // s0
  float v123; // s20
  int v124; // r5
  int v125; // r9
  float v126; // s24
  float v127; // s27
  float v128; // r4
  float v129; // s18
  float v130; // s25
  float v131; // s18
  int v132; // r0
  float *p_Alpha; // r11
  CPlayerPed *PlayerPed; // r3
  float *p_xx; // r4
  float v136; // s26
  float v137; // s30
  float v138; // s28
  float xy; // s2
  float yy; // s4
  float zy; // s0
  float v142; // r5
  float v143; // s10
  float *p_x; // r0
  float v145; // s10
  float v146; // s6
  float v147; // s18
  float v148; // s0
  CTaskSimpleClimb *TaskClimb; // r0
  CTask *ActiveTask; // r0
  CTaskComplexEnterCar *v151; // r0
  float v152; // r0
  float v153; // s23
  float v154; // s0
  float v155; // s2
  float v156; // s18
  float v157; // s19
  float v158; // s0
  int InputType; // r0
  bool v160; // zf
  float v161; // r5
  int v162; // r0
  float v163; // s4
  float v164; // s0
  float v165; // s2
  float v166; // s0
  char v167; // r0
  bool v168; // zf
  float v169; // s2
  float v170; // s0
  float v171; // s2
  float v172; // s6
  float v173; // s0
  float v174; // s25
  float v175; // s18
  int v176; // r0
  float v177; // s23
  bool v178; // zf
  float32x2_t v179; // d16
  float v180; // s20
  float v181; // s4
  unsigned __int8 m_iFadingDirection; // r0
  float v183; // s0
  int v184; // r0
  float v185; // s2
  char v186; // r0
  float v187; // s0
  float v188; // s0
  float v189; // s2
  float v190; // s6
  float v191; // s0
  float v192; // s0
  float v193; // s2
  CPad *v194; // r11
  float v195; // s22
  float v196; // s18
  float v197; // r4
  float v198; // r9
  float v199; // r6
  RwReal v200; // s20
  CVector *p_Up; // r9
  float v202; // s22
  __int64 v203; // d16
  float v204; // s20
  float v205; // s6
  float v206; // s30
  float v207; // s21
  float v208; // s0
  float v209; // s2
  float v210; // s4
  float v211; // s2
  float v212; // s4
  float v213; // s2
  float v214; // s2
  float v215; // s4
  float v216; // s2
  float v217; // s0
  RwReal v218; // s18
  float v219; // r0
  float v220; // r5
  float v221; // s23
  float v222; // s27
  float v223; // s23
  float v224; // r0
  float v225; // s2
  float v226; // s4
  CTaskSimpleDuck *TaskDuck; // r0
  int *v228; // r0
  float v229; // s2
  float v230; // s0
  float v231; // s0
  RwReal v232; // r1
  float v233; // s2
  float v234; // s4
  float v235; // s2
  float v236; // s2
  float v237; // s4
  float v238; // s2
  int v239; // r0
  CTaskSimpleHoldEntity *TaskHold; // r0
  bool v241; // zf
  int32 v242; // r2
  float v243; // s0
  float v244; // s2
  float v245; // s0
  float v246; // s2
  float v247; // s4
  float v248; // s2
  float v249; // s2
  float v250; // s4
  float v251; // s2
  float v252; // s2
  float v253; // s0
  float v254; // s0
  float v255; // s2
  float v256; // s4
  float v257; // s2
  float v258; // s2
  float v259; // s2
  __int64 v260; // d16
  int32 v261; // r1
  int IsCoopGameGoingOn; // r0
  bool v263; // zf
  CPad *v264; // r0
  int32 lastTimePadTouched; // r5
  CPad *v266; // r0
  float v267; // [sp+24h] [bp-DCh]
  CPlayerPed *v268; // [sp+28h] [bp-D8h]
  float v269; // [sp+2Ch] [bp-D4h]
  float *v270; // [sp+30h] [bp-D0h]
  float Alpha; // [sp+30h] [bp-D0h]
  float v272; // [sp+34h] [bp-CCh]
  float v273; // [sp+38h] [bp-C8h]
  CVector *v274; // [sp+3Ch] [bp-C4h]
  CVector *p_Front; // [sp+3Ch] [bp-C4h]
  unsigned __int64 v276; // [sp+40h] [bp-C0h]
  eVisibleArea v277; // [sp+4Ch] [bp-B4h]
  unsigned __int8 *p_m_heading; // [sp+50h] [bp-B0h]
  CPedIntelligence *v279; // [sp+54h] [bp-ACh]
  float *fBeta; // [sp+58h] [bp-A8h]
  float *fBetaa; // [sp+58h] [bp-A8h]
  float *fBetab; // [sp+58h] [bp-A8h]
  float fStickAlpha; // [sp+64h] [bp-9Ch] BYREF
  float fStickBeta; // [sp+68h] [bp-98h] BYREF
  bool pbTouchInputY; // [sp+6Eh] [bp-92h] BYREF
  bool pbTouchInputX; // [sp+6Fh] [bp-91h] BYREF
  CVector pVecTargetCoords; // [sp+70h] [bp-90h] BYREF
  CVector v288; // [sp+80h] [bp-80h] BYREF
  CVector v289; // [sp+90h] [bp-70h] BYREF

  CamTargetEntity = this->CamTargetEntity;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) == 3 && CPed::IsPlayer((const CPed *)CamTargetEntity) )
  {
    v20 = this->CamTargetEntity;
    Pad = CPad::GetPad(0);
    y_low = (const CPedIntelligence *)LODWORD(v20[18].m_transform.m_translate.y);
    if ( *(_DWORD *)&v20[23].numLodChildren == 1 )
      Pad = CPad::GetPad(1);
    v23 = *(_QWORD *)&ThisCamsTarget->x;
    pVecTargetCoords.z = ThisCamsTarget->z;
    v24 = CGame::currArea;
    *(_QWORD *)&pVecTargetCoords.x = v23;
    m_nPedZoom = TheCamera.m_nPedZoom;
    v277 = CGame::currArea;
    if ( CGame::currArea )
      v24 = AREA_HOTEL;
    v26 = 15 * v24;
    v27 = TheCamera.m_nPedZoom == 3;
    fBaseCamDist = PEDCAM_SET[v24].fBaseCamDist;
    if ( TheCamera.m_nPedZoom == 3 )
      v27 = (LODWORD(v20[19].m_transform.m_heading) & 1) == 0;
    if ( v27 )
    {
      if ( CPedIntelligence::GetUsingParachute(y_low) )
        fBaseCamDist = fBaseCamDist + fBaseCamDist;
      m_nPedZoom = TheCamera.m_nPedZoom;
    }
    p_m_heading = (unsigned __int8 *)&v20[19].m_transform.m_heading;
    v13.n64_f32[0] = fBaseCamDist + TheCamera.m_fPedZoomSmoothed;
    v29 = (char *)PEDCAM_SET + 4 * v26;
    v30.n64_u32[1] = *((_DWORD *)v29 + 2);
    v15.n64_u32[0] = *((_DWORD *)v29 + 3);
    v14.n64_u32[0] = *((_DWORD *)v29 + 4);
    v30.n64_u32[0] = *((_DWORD *)v29 + 13);
    v272 = *((float *)v29 + 14);
    if ( v13.n64_f32[0] > gLastCamDist )
      v15.n64_u32[0] = v13.n64_u32[0];
    gLastCamDist = v13.n64_f32[0];
    v270 = &PEDCAM_SET[0].fTargetOffsetZ + v26;
    switch ( m_nPedZoom )
    {
      case 3:
        p_m_fTargetZoomThreeZExtra = &this->m_fTargetZoomThreeZExtra;
        break;
      case 2:
        if ( v277 )
          p_m_fTargetZoomThreeZExtra = &this->m_fTargetZoomTwoInteriorZExtra;
        else
          p_m_fTargetZoomThreeZExtra = &this->m_fTargetZoomTwoZExtra;
        break;
      case 1:
        p_m_fTargetZoomThreeZExtra = &this->m_fTargetZoomOneZExtra;
        break;
      default:
        goto LABEL_25;
    }
    v30.n64_f32[1] = v30.n64_f32[1] + *p_m_fTargetZoomThreeZExtra;
LABEL_25:
    v279 = (CPedIntelligence *)y_low;
    v273 = v30.n64_f32[0];
    if ( CPedIntelligence::GetTaskSwim(y_low) )
    {
      TaskSwim = CPedIntelligence::GetTaskSwim(y_low);
      v33 = y_low;
      m_nSwimState = (unsigned __int16)TaskSwim->m_nSwimState;
      v35 = 0.5;
      v36 = 1.0;
      if ( CPedIntelligence::GetTaskSwim(v33)->m_nSwimState == 4 )
        v35 = 0.0;
      if ( !m_nSwimState )
        v36 = 0.0;
    }
    else
    {
      v36 = 0.0;
      if ( CPedIntelligence::GetTaskJetPack(y_low) )
      {
        v35 = 0.0;
        if ( !(*p_m_heading << 31) )
        {
          v35 = 3.0;
          v36 = 0.5;
          if ( CPad::GetJetpackHover(Pad) )
          {
            v35 = 0.0;
            v36 = 0.0;
          }
        }
      }
      else
      {
        v35 = 0.0;
      }
    }
    ResetStatics = this->ResetStatics;
    if ( !TheCamera.m_uiTransitionState )
    {
      if ( this->ResetStatics )
      {
        this->FOV = 70.0;
        ResetStatics = 1;
      }
      else
      {
        FOV = this->FOV;
        v8.n64_u32[0] = 1116471296;
        ResetStatics = 0;
        v6.n64_f32[0] = CTimer::ms_fTimeStep + FOV;
        if ( (float)(CTimer::ms_fTimeStep + FOV) >= 70.0 )
        {
          v6.n64_f32[0] = FOV - CTimer::ms_fTimeStep;
          v6.n64_u64[0] = vmax_f32(v6, v8).n64_u64[0];
        }
        LODWORD(this->FOV) = v6.n64_u32[0];
      }
    }
    v276 = vmax_f32(v13, v14).n64_u64[0];
    v39 = &PEDCAM_SET[0].fTargetOffsetZ + v26;
    v40 = *v39 + pVecTargetCoords.z;
    pVecTargetCoords.z = v40;
    if ( !ResetStatics )
    {
      if ( !FindPlayerPed(-1) )
        goto LABEL_64;
      PlayerVehicle = FindPlayerVehicle(-1, 0);
      if ( !PlayerVehicle )
        goto LABEL_64;
      if ( (unsigned int)(PlayerVehicle->m_vehicleType - 3) >= 2 )
      {
        v54 = currentPad;
        if ( !currentPad )
          v54 = CPad::GetPad(0);
        if ( !CPad::IsFlyingRCVehicle(v54) )
        {
LABEL_64:
          if ( !((TheCamera.m_bCamDirectlyInFront || TheCamera.m_bCamDirectlyBehind) << 24) && a6 != 1 )
          {
            y = v20[23].m_transform.m_translate.y;
            if ( y != 0.0 )
            {
              v56 = *(_BYTE *)(LODWORD(y) + 58) & 7;
              v57 = v56 == 2;
              if ( v56 == 2 )
                v57 = *(_DWORD *)(LODWORD(y) + 1444) == 6;
              if ( v57 )
                goto LABEL_74;
              v58 = *(_DWORD *)(LODWORD(y) + 256);
              if ( v58 )
              {
                v59 = *(_BYTE *)(v58 + 58) & 7;
                v60 = v59 == 2;
                if ( v59 == 2 )
                  v60 = *(_DWORD *)(v58 + 1444) == 6;
                if ( v60 )
                {
LABEL_74:
                  v6.n64_u32[0] = *(_DWORD *)(LODWORD(y) + 72);
                  v61 = *(float *)(LODWORD(y) + 76);
                  v62 = *(float *)(LODWORD(y) + 80);
                  v12.n64_u32[0] = 0;
                  v6.n64_u32[1] = LODWORD(this->m_aTargetHistoryPos[1].x);
                  v11.n64_u32[0] = 1008981770;
                  v9.n64_f32[0] = sqrtf(
                                    (float)((float)(v6.n64_f32[0] * v6.n64_f32[0]) + (float)(v61 * v61))
                                  + (float)(v62 * v62));
                  v10.n64_f32[0] = v9.n64_f32[0] + -0.01;
                  v9.n64_u64[0] = vmax_f32(v9, v11).n64_u64[0];
                  v9.n64_f32[0] = vmax_f32(v10, v12).n64_f32[0] / v9.n64_f32[0];
                  v63 = CTimer::ms_fTimeStep;
                  v64 = this->m_aTargetHistoryPos[0].y + (float)(CTimer::ms_fTimeStep * (float)(v61 * v9.n64_f32[0]));
                  v65 = this->m_aTargetHistoryPos[0].z + (float)(CTimer::ms_fTimeStep * (float)(v62 * v9.n64_f32[0]));
                  this->m_aTargetHistoryPos[0].x = this->m_aTargetHistoryPos[0].x
                                                 + (float)(CTimer::ms_fTimeStep * (float)(v6.n64_f32[0] * v9.n64_f32[0]));
                  this->m_aTargetHistoryPos[0].y = v64;
                  this->m_aTargetHistoryPos[0].z = v65;
                  v66 = (float *)LODWORD(v20[23].m_transform.m_translate.y);
                  v67 = (float)((float)(v9.n64_f32[0] * v66[19]) * v63) + this->m_aTargetHistoryPos[1].y;
                  v68 = (float)((float)(v9.n64_f32[0] * v66[20]) * v63) + this->m_aTargetHistoryPos[1].z;
                  this->m_aTargetHistoryPos[1].x = (float)((float)(v9.n64_f32[0] * v66[18]) * v63) + v6.n64_f32[1];
                  this->m_aTargetHistoryPos[1].z = v68;
                  this->m_aTargetHistoryPos[1].y = v67;
                }
              }
            }
LABEL_94:
            x = pVecTargetCoords.x;
            v83 = v40 - this->m_aTargetHistoryPos[0].z;
            v84 = pVecTargetCoords.y;
            v85 = pVecTargetCoords.y - this->m_aTargetHistoryPos[0].y;
            this->Front.x = pVecTargetCoords.x - this->m_aTargetHistoryPos[0].x;
            this->Front.y = v85;
            this->Front.z = v83;
            CVector::Normalise(&this->Front);
            v6.n64_f32[0] = sqrtf(
                              (float)((float)((float)(x - this->m_aTargetHistoryPos[1].x)
                                            * (float)(x - this->m_aTargetHistoryPos[1].x))
                                    + (float)((float)(v84 - this->m_aTargetHistoryPos[1].y)
                                            * (float)(v84 - this->m_aTargetHistoryPos[1].y)))
                            + (float)((float)(v40 - this->m_aTargetHistoryPos[1].z)
                                    * (float)(v40 - this->m_aTargetHistoryPos[1].z)));
            if ( v6.n64_f32[0] < v13.n64_f32[0] && v13.n64_f32[0] > v270[3] )
              v13.n64_u64[0] = vmax_f32(v15, v6).n64_u64[0];
            v86 = atan2f(COERCE_FLOAT(LODWORD(this->Front.x) ^ 0x80000000), this->Front.y);
            v87 = v86 + -1.5708;
            if ( (float)(v86 + -1.5708) < -3.1416 )
              v87 = (float)(v86 + -1.5708) + 6.2832;
            m_pMat = v20->m_pMat;
            if ( m_pMat )
              m_heading = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
            else
              m_heading = v20->m_transform.m_heading;
            v90 = m_heading + -1.5708;
            if ( (float)((float)(m_heading + -1.5708) - v87) <= 3.1416 )
            {
              if ( (float)(v90 - v87) < -3.1416 )
                v90 = v90 + 6.2832;
            }
            else
            {
              v90 = v90 + -6.2832;
            }
            p_Front = &this->Front;
            if ( CPad::GetForceCameraBehindPlayer(Pad) )
            {
              v91 = 1;
            }
            else
            {
              if ( !gForceCamBehindPlayer
                || (float)((float)((float)(v20[1].m_transform.m_translate.z * v20[1].m_transform.m_translate.z)
                                 + (float)(v20[1].m_transform.m_heading * v20[1].m_transform.m_heading))
                         + (float)(*(float *)&v20[1].m_pMat * *(float *)&v20[1].m_pMat)) <= 0.001
                && fabsf(v90 - v87) >= 0.01
                && CPad::AimWeaponLeftRight(Pad, (CPed *)v20, 0) == 0.0
                && !CPad::AimWeaponUpDown(Pad, (CPed *)v20, 0) )
              {
                goto LABEL_115;
              }
              v91 = 0;
            }
            gForceCamBehindPlayer = v91;
LABEL_115:
            v92 = gForceCamBehindPlayer;
            if ( fabsf(v90 - v87) < 2.9671 )
              goto LABEL_121;
            v93 = v36 == 0.0;
            if ( v36 == 0.0 )
              v93 = !gForceCamBehindPlayer;
            if ( v93 )
            {
              v15.n64_u32[0] = 0;
              v92 = 0;
              v94.n64_u64[0] = v15.n64_u64[0];
              v95.n64_u64[0] = v15.n64_u64[0];
            }
            else
            {
LABEL_121:
              v96 = v36 == 0.0;
              v97 = &PEDCAM_SET[0].fTargetOffsetZ + v26;
              v15.n64_f32[0] = CTimer::ms_fTimeStep * v97[11];
              v7.n64_f32[0] = v97[10] * CTimer::ms_fTimeStep;
              if ( v36 == 0.0 )
                v96 = !gForceCamBehindPlayer;
              if ( v96 )
              {
                v98 = v20[23].m_transform.m_translate.y;
                z = v20[1].m_transform.m_translate.z;
                if ( v98 == 0.0 )
                {
                  v101 = (float)((float)(z * z) + (float)(v20[1].m_transform.m_heading * v20[1].m_transform.m_heading))
                       + (float)(*(float *)&v20[1].m_pMat * *(float *)&v20[1].m_pMat);
                }
                else
                {
                  v100.n64_u64[0] = vsub_f32(
                                      *(float32x2_t *)&v20[1].m_transform.m_heading,
                                      *(float32x2_t *)(LODWORD(v98) + 76)).n64_u64[0];
                  v9.n64_u64[0] = vmul_f32(v100, v100).n64_u64[0];
                  v101 = (float)((float)((float)(z - *(float *)(LODWORD(v98) + 72))
                                       * (float)(z - *(float *)(LODWORD(v98) + 72)))
                               + v9.n64_f32[0])
                       + v9.n64_f32[1];
                }
                v9.n64_u32[0] = 1.0;
                v7.n64_f32[0] = v7.n64_f32[0] * sqrtf(v101);
                v94.n64_u64[0] = vmin_f32(v7, v9).n64_u64[0];
              }
              else
              {
                v15.n64_f32[0] = v15.n64_f32[0] + v15.n64_f32[0];
                v9.n64_u32[0] = 1.0;
                v7.n64_f32[0] = v7.n64_f32[0] * 0.5;
                v94.n64_u64[0] = vmin_f32(v7, v9).n64_u64[0];
                if ( v36 != 0.0 )
                {
                  v15.n64_f32[0] = v36 * v15.n64_f32[0];
                  v94.n64_f32[0] = v36 * v94.n64_f32[0];
                }
              }
              v6.n64_f32[0] = (float)(v90 - v87) * v94.n64_f32[0];
              v7.n64_f32[0] = -v15.n64_f32[0];
              v95.n64_u64[0] = vmax_f32(vmin_f32(v6, v15), v7).n64_u64[0];
            }
            v102 = v87 + v95.n64_f32[0];
            Beta = this->Beta;
            if ( (float)(v87 + v95.n64_f32[0]) <= (float)(Beta + 3.1416) )
            {
              if ( v102 >= (float)(Beta + -3.1416) )
                goto LABEL_138;
              v104 = 6.2832;
            }
            else
            {
              v104 = -6.2832;
            }
            v102 = v102 + v104;
LABEL_138:
            v105 = this->Front.z;
            v16.n64_u32[0] = -1.0;
            v106 = v105;
            if ( v105 > 1.0 )
              v106 = 1.0;
            v107 = v106 < -1.0;
            v108 = 1.0;
            v109 = v105 == 1.0;
            v110 = v105 < 1.0;
            if ( v107 )
            {
              v108 = -1.0;
              v105 = -1.0;
            }
            if ( !v110 && !v109 )
              v105 = v108;
            v30.n64_f32[0] = CTimer::ms_fTimeStep;
            v111 = asinf(v105);
            v112 = v90 - v102;
            v113 = v111;
            v95.n64_f32[0] = fabsf(v112);
            if ( v95.n64_f32[0] > 1.5708
              && (float)((float)((float)(v20[1].m_transform.m_translate.z * v20[1].m_transform.m_translate.z)
                               + (float)(v20[1].m_transform.m_heading * v20[1].m_transform.m_heading))
                       + (float)(*(float *)&v20[1].m_pMat * *(float *)&v20[1].m_pMat)) > 0.002 )
            {
              fBetaa = (float *)v13.n64_u32[0];
              v13.n64_u32[0] = 1.0;
              v95.n64_f32[0] = (float)((float)(v95.n64_f32[0] + -1.5708) * 1.2) / 1.5708;
              v95.n64_u64[0] = vmin_f32(v95, v13).n64_u64[0];
              v114 = (float)(v95.n64_f32[0] * -1.2217) + 1.5708;
              v115 = powf(0.9, v30.n64_f32[0]);
              if ( v113 <= v114 )
              {
                if ( v113 < (float)-v114 )
                  v113 = (float)(v113 * v115) - (float)(v114 * (float)(1.0 - v115));
              }
              else
              {
                v113 = (float)(v113 * v115) + (float)(v114 * (float)(1.0 - v115));
              }
              v13.n64_u32[0] = (unsigned __int32)fBetaa;
            }
            if ( v35 != 0.0 )
              goto LABEL_361;
            v116 = !v92;
            v95.n64_u32[0] = 0;
            if ( v92 )
              v116 = *p_m_heading << 31 == 0;
            if ( !v116 )
            {
LABEL_361:
              if ( CPedIntelligence::GetTaskJetPack(v279) )
              {
                v95.n64_u32[0] = -1095583549;
                v16.n64_u32[0] = 1.0;
              }
              else if ( CPedIntelligence::GetTaskSwim(v279) )
              {
                v95.n64_u32[0] = -1098511726;
                v16.n64_u32[0] = 1.0;
              }
              else if ( *p_m_heading << 31 )
              {
                v95.n64_f32[0] = (float)((float)(*(float *)&v20[23].m_pRwObject * v20->m_pMat->xy)
                                       + (float)(*(float *)&v20[23].m_nFlags * v20->m_pMat->yy))
                               + (float)(*(float *)&v20[23].m_nFlags.bdummy * v20->m_pMat->zy);
                v117.n64_u64[0] = vmax_f32(v95, v16).n64_u64[0];
                v16.n64_u32[0] = 1.0;
                v95.n64_u64[0] = vmin_f32(v117, v16).n64_u64[0];
                v95.n64_u32[0] = COERCE_UNSIGNED_INT(asinf(v95.n64_f32[0])) ^ 0x80000000;
              }
              else
              {
                v95.n64_u32[0] = 0;
                v16.n64_u32[0] = 1.0;
              }
              v8.n64_u64[0] = vmin_f32(v94, v16).n64_u64[0];
              v118 = v95.n64_f32[0] - v113;
              v7.n64_f32[0] = v15.n64_f32[0] * 4.0;
              if ( v35 != 0.0 )
                v8.n64_f32[0] = v35 * v8.n64_f32[0];
              v95.n64_f32[0] = v8.n64_f32[0] * v118;
              if ( v35 != 0.0 )
                v7.n64_f32[0] = v35 * v7.n64_f32[0];
              v119.n64_u64[0] = vmin_f32(v95, v7).n64_u64[0];
              v95.n64_f32[0] = -v7.n64_f32[0];
              v95.n64_u64[0] = vmax_f32(v119, v95).n64_u64[0];
            }
            v120 = v273;
            v16.n64_u32[0] = 1.0;
            v121 = v273;
            v122 = (float)(v113 + v95.n64_f32[0]) - v30.n64_f32[1];
            LODWORD(v123) = vmax_f32(v30, v16).n64_u32[0];
            if ( v122 <= v273 )
            {
              v121 = v122;
              if ( v122 < (float)-v272 )
                v121 = -v272;
            }
            v124 = 0;
            v125 = v26;
            Alpha = this->Alpha;
            v126 = CTimer::ms_fTimeStep;
            pbTouchInputX = 0;
            v127 = *(&PEDCAM_SET[0].fDiffAlphaCap + v26);
            v128 = *(&PEDCAM_SET[0].fDiffAlphaRate + v26);
            pbTouchInputY = 0;
            fStickBeta = CPad::AimWeaponLeftRight(Pad, (CPed *)v20, &pbTouchInputX) * -2.6;
            v129 = (float)CPad::AimWeaponUpDown(Pad, (CPed *)v20, &pbTouchInputY);
            v269 = powf(v128, v126);
            fStickAlpha = v129 * 1.95;
            v130 = 6.2832;
            if ( CPedIntelligence::GetTaskUseGun(v279)
              && (CPedIntelligence::GetTaskUseGun(v279)->m_nLastCommand | 1) == 3
              && CPedIntelligence::GetTaskUseGun(v279)->m_pWeaponInfo
              && (CPedIntelligence::GetTaskUseGun(v279)->m_pWeaponInfo->m_nFlags & 2) == 0
              && fabsf((float)CPad::GetPedWalkLeftRight(Pad)) > fabsf(fStickBeta) )
            {
              fStickBeta = (float)-CPad::GetPedWalkLeftRight(Pad);
            }
            v131 = v102 - Beta;
            fBetab = &this->Beta;
            v132 = 0;
            p_Alpha = &this->Alpha;
            if ( fStickBeta != 0.0 )
              v132 = 1;
            if ( fStickAlpha != 0.0 )
              v124 = 1;
            if ( v132 | v124 && !CPad::GetPedWalkLeftRight(Pad) && !CPad::GetPedWalkUpDown(Pad) )
            {
              PlayerPed = FindPlayerPed(0);
              p_xx = &PlayerPed->m_pMat->xx;
              v136 = p_xx[4];
              v137 = p_xx[5];
              v138 = p_xx[6];
              if ( TheCamera.m_pMat )
              {
                xy = TheCamera.m_pMat->xy;
                yy = TheCamera.m_pMat->yy;
                zy = TheCamera.m_pMat->zy;
              }
              else
              {
                v268 = PlayerPed;
                v142 = TheCamera.m_transform.m_heading;
                v267 = sinf(TheCamera.m_transform.m_heading);
                yy = cosf(v142);
                PlayerPed = v268;
                zy = 0.0;
                LODWORD(xy) = LODWORD(v267) ^ 0x80000000;
              }
              v143 = v138 * zy;
              v16.n64_u32[0] = 1.0;
              if ( (float)((float)((float)(v136 * xy) + (float)(v137 * yy)) + v143) > 0.3 )
              {
                p_x = p_xx + 12;
                if ( !p_xx )
                  p_x = &PlayerPed->m_transform.m_translate.x;
                v145 = p_x[2];
                v146 = *p_x;
                v289.y = (float)(yy * 5.0) + p_x[1];
                v289.x = (float)(xy * 5.0) + v146;
                v289.z = (float)(zy * 5.0) + v145;
                IKChainManager_c::LookAt(
                  &g_ikChainMan,
                  "FollowPedSA",
                  PlayerPed,
                  0,
                  1500,
                  -1,
                  &v289,
                  0,
                  0.25,
                  500,
                  3,
                  0);
              }
            }
            v147 = v131 / v123;
            v148 = this->FOV / 80.0;
            fStickBeta = (float)(fStickBeta
                               * (float)((float)(AIMWEAPON_STICK_SENS * AIMWEAPON_STICK_SENS) * fabsf(fStickBeta)))
                       * (float)(v148 * 0.071429);
            fStickAlpha = (float)(fStickAlpha
                                * (float)((float)(AIMWEAPON_STICK_SENS * AIMWEAPON_STICK_SENS) * fabsf(fStickAlpha)))
                        * (float)(v148 * 0.042857);
            if ( CPedIntelligence::GetTaskClimb(v279) )
            {
              TaskClimb = CPedIntelligence::GetTaskClimb(v279);
              CTaskSimpleClimb::GetCameraStickModifier(
                TaskClimb,
                (CPed *)v20,
                &this->Alpha,
                fBetab,
                &fStickAlpha,
                &fStickBeta);
            }
            else
            {
              ActiveTask = CTaskManager::GetActiveTask(&v279->m_taskManager);
              if ( (*((int (__fastcall **)(CTask *))ActiveTask->_vptr$CTask + 5))(ActiveTask) == 701 )
              {
                v151 = (CTaskComplexEnterCar *)CTaskManager::GetActiveTask(&v279->m_taskManager);
                CTaskComplexEnterCar::GetCameraStickModifier(
                  v151,
                  (CPed *)v20,
                  v13.n64_f32[0],
                  &this->Alpha,
                  fBetab,
                  &fStickAlpha,
                  &fStickBeta);
              }
            }
            v152 = powf(*(&PEDCAM_SET[0].fDiffBetaRate + v125), CTimer::ms_fTimeStep);
            v153 = *(&PEDCAM_SET[0].fDiffBetaCap + v125);
            v154 = v147 + fStickBeta;
            v155 = v153;
            v156 = v152;
            if ( v154 <= v153 )
            {
              v155 = v154;
              if ( v154 < (float)-v153 )
                v155 = -v153;
            }
            v157 = 0.0;
            v158 = (float)((float)(v16.n64_f32[0] - v152) * v155) + (float)(v152 * this->BetaSpeed);
            if ( fabsf(v158) < 0.0001 )
              v158 = 0.0;
            this->BetaSpeed = v158;
            InputType = CHID::GetInputType();
            v160 = InputType == 2;
            if ( InputType == 2 )
              v160 = Pad->DisablePlayerControls == 0;
            if ( !v160 )
            {
              if ( CHID::GetInputType() == 1 )
              {
                v161 = CPad::AimWeaponLeftRight(Pad, (CPed *)v20, &pbTouchInputX);
                v162 = CPad::AimWeaponUpDown(Pad, (CPed *)v20, &pbTouchInputY);
                v163 = this->FOV / 80.0;
                v164 = CTimer::ms_fTimeStep;
                v165 = CTimer::ms_fTimeStep
                     * (float)(v163
                             * (float)(v161
                                     * (float)((float)((float)((float)MobileSettings::settings[25].value / 100.0)
                                                     * 0.0008)
                                             + 0.00025)));
                fStickAlpha = CTimer::ms_fTimeStep
                            * (float)((float)((float)((float)((float)((float)MobileSettings::settings[26].value / 100.0)
                                                            * 0.0006)
                                                    + 0.00025)
                                            * (float)v162)
                                    * v163);
                fStickBeta = -v165;
                if ( v165 != -0.0 )
                {
                  v166 = this->Beta - v165;
LABEL_227:
                  this->BetaSpeed = 0.0;
LABEL_228:
                  this->Beta = v166;
LABEL_229:
                  if ( v166 <= 3.1416 )
                  {
                    if ( v166 >= -3.1416 )
                    {
LABEL_233:
                      v174 = (float)(v156 * fStickAlpha) + (float)((float)(v16.n64_f32[0] - v156) * this->AlphaSpeed);
                      this->AlphaSpeed = v174;
                      if ( v174 > v153 || (v153 = -v153, v174 < v153) )
                      {
                        v174 = v153;
                        this->AlphaSpeed = v153;
                      }
                      v175 = 1.0;
                      if ( fabsf(v174) < 0.0001 )
                      {
                        v174 = 0.0;
                        this->AlphaSpeed = 0.0;
                      }
                      if ( !pbTouchInputY )
                        v175 = CTimer::ms_fTimeStep;
                      v176 = CHID::GetInputType();
                      v177 = v30.n64_f32[1];
                      v178 = v176 == 2;
                      if ( v176 == 2 )
                        v178 = Pad->DisablePlayerControls == 0;
                      if ( !v178 )
                      {
                        v8.n64_f32[0] = v126 * v127;
                        v95.n64_f32[0] = (float)(1.0 - v269) * (float)(v121 - Alpha);
                        v179.n64_u64[0] = vmin_f32(v95, v8).n64_u64[0];
                        v95.n64_f32[0] = -(float)(v126 * v127);
                        v180 = vmax_f32(v179, v95).n64_f32[0] + *p_Alpha;
                        *p_Alpha = v180;
                        goto LABEL_274;
                      }
                      v181 = (float)(this->FOV / 80.0)
                           * (float)(CPad::NewMouseControllerState.m_AmountMoved.y
                                   * (float)((float)((float)((float)MobileSettings::settings[32].value / 100.0) * 0.0175)
                                           + 0.0005));
                      if ( !MobileSettings::settings[15].value )
                        v181 = -v181;
                      fStickAlpha = v181;
                      if ( TheCamera.m_bFading )
                      {
                        m_iFadingDirection = TheCamera.m_iFadingDirection;
                        if ( TheCamera.m_iFadingDirection != 1 )
                          m_iFadingDirection = 0;
                        if ( CDraw::FadeValue > 0xC8u || (m_iFadingDirection & (CDraw::FadeValue > 0x2Du)) != 0 )
                        {
LABEL_253:
                          v183 = *p_Alpha;
                          if ( *p_Alpha < (float)(-0.05 - v30.n64_f32[1]) )
                          {
                            *(float *)&v184 = 0.05;
LABEL_255:
                            fStickAlpha = *(float *)&v184;
                            goto LABEL_258;
                          }
                          v185 = -v30.n64_f32[1];
                          if ( v183 >= (float)-v30.n64_f32[1] )
                          {
                            if ( v183 > (float)(0.05 - v30.n64_f32[1]) )
                            {
                              *(float *)&v184 = -0.05;
                              goto LABEL_255;
                            }
                            if ( v183 <= v185 )
                            {
                              *(float *)&v184 = 0.0;
                              goto LABEL_255;
                            }
                          }
                          fStickAlpha = v185 - v183;
                        }
                      }
                      else if ( CDraw::FadeValue >= 0xC9u )
                      {
                        goto LABEL_253;
                      }
LABEL_258:
                      v186 = `guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha;
                      __dmb(0xBu);
                      if ( (v186 & 1) == 0
                        && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha) )
                      {
                        CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha = *p_Alpha;
                        _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha);
                      }
                      if ( this->ResetKeyboardStatics )
                      {
                        v187 = this->Alpha;
                        CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha = v187;
                        this->ResetKeyboardStatics = 0;
                      }
                      else
                      {
                        v187 = CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha;
                      }
                      v188 = fStickAlpha + v187;
                      CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha = v188;
                      if ( v188 <= 3.1416 )
                      {
                        if ( v188 >= -3.1416 )
                        {
LABEL_269:
                          v190 = this->Alpha;
                          v191 = v188 - v190;
                          v7.n64_f32[0] = (float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0)
                                                                             * 1000.0)
                                                / 1000.0)
                                        * 12.5;
                          if ( v191 > 3.1416 )
                            v191 = v191 + -6.2832;
                          if ( v191 < -3.1416 )
                            v191 = v191 + 6.2832;
                          v8.n64_u32[0] = 1.0;
                          this->AlphaSpeed = 0.0;
                          v180 = v190 + (float)(v191 * vmin_f32(v7, v8).n64_f32[0]);
                          this->Alpha = v180;
LABEL_274:
                          if ( v180 > v273 || (v120 = -v272, v180 < (float)-v272) )
                          {
                            v180 = v120;
                            this->AlphaSpeed = 0.0;
                            this->Alpha = v120;
                          }
                          v192 = CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldAlpha;
                          if ( fabsf(CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldAlpha - v180) < 0.0001 )
                          {
                            *p_Alpha = CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldAlpha;
                            v180 = v192;
                          }
                          v193 = CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldBeta;
                          v194 = Pad;
                          CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldAlpha = v180;
                          v195 = *fBetab;
                          v196 = v121 + (float)(v174 * v175);
                          if ( fabsf(CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldBeta - *fBetab) < 0.0001 )
                          {
                            *fBetab = CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldBeta;
                            v195 = v193;
                          }
                          v197 = v180;
                          v198 = cosf(v195);
                          v199 = cosf(v180);
                          v200 = -(float)(v199 * sinf(v195));
                          CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::gOldBeta = v195;
                          this->Front.z = sinf(v197);
                          this->Front.x = -(float)(v198 * v199);
                          this->Front.y = v200;
                          this->Up.x = 0.0;
                          this->Up.y = 0.0;
                          this->Up.z = 1.0;
                          CVector::Normalise(p_Front);
                          p_Up = &this->Up;
                          if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
                          {
                            this->Front.x = 0.0001;
                            this->Front.y = 0.0001;
                          }
                          CrossProduct(&v288, p_Front, &this->Up);
                          v289 = v288;
                          CVector::Normalise(&v289);
                          CrossProduct(&v288, &v289, p_Front);
                          v202 = 5.0;
                          v203 = *(_QWORD *)&v288.x;
                          this->Up.z = v288.z;
                          *(_QWORD *)&p_Up->x = v203;
                          v204 = pVecTargetCoords.x;
                          *(_WORD *)&TheCamera.m_bCamDirectlyBehind = 0;
                          v205 = 5.0;
                          v206 = pVecTargetCoords.y;
                          v207 = pVecTargetCoords.z;
                          v208 = pVecTargetCoords.x - (float)(v13.n64_f32[0] * this->Front.x);
                          v209 = pVecTargetCoords.y - (float)(v13.n64_f32[0] * this->Front.y);
                          v210 = pVecTargetCoords.z - (float)(v13.n64_f32[0] * this->Front.z);
                          if ( v208 < 0.0 )
                            v205 = -5.0;
                          this->Source.x = v208;
                          this->Source.y = v209;
                          this->Source.z = v210;
                          modff((float)((float)(v208 * 100000.0) + v205) / 10.0, &v289.x);
                          v211 = this->Source.y;
                          v212 = 5.0;
                          v107 = v211 < 0.0;
                          v213 = v211 * 100000.0;
                          if ( v107 )
                            v212 = -5.0;
                          this->Source.x = v289.x / 10000.0;
                          modff((float)(v213 + v212) / 10.0, &v289.x);
                          v214 = this->Source.z;
                          v215 = 5.0;
                          v107 = v214 < 0.0;
                          v216 = v214 * 100000.0;
                          if ( v107 )
                            v215 = -5.0;
                          this->Source.y = v289.x / 10000.0;
                          modff((float)(v216 + v215) / 10.0, &v289.x);
                          v217 = v177 + v196;
                          v218 = v289.x / 10000.0;
                          v219 = cosf(v217);
                          v220 = this->Beta;
                          v221 = v219;
                          v222 = cosf(v220) * v219;
                          v223 = v221 * sinf(v220);
                          v224 = sinf(v217);
                          this->Source.z = v218;
                          this->m_aTargetHistoryPos[0].x = (float)(*(float *)&v276 * v222) + v204;
                          this->m_aTargetHistoryPos[0].y = (float)(*(float *)&v276 * v223) + v206;
                          this->m_aTargetHistoryPos[0].z = v207 - (float)(*(float *)&v276 * v224);
                          this->m_aTargetHistoryPos[1].x = v204 + (float)(v13.n64_f32[0] * v222);
                          this->m_aTargetHistoryPos[1].y = v206 + (float)(v13.n64_f32[0] * v223);
                          this->m_aTargetHistoryPos[1].z = v207 - (float)(v13.n64_f32[0] * v224);
                          if ( !CPad::GetForceCameraBehindPlayer(v194) || CPad::AimWeaponLeftRight(v194, 0, 0) == 0.0 )
                          {
LABEL_299:
                            CPedIntelligence::GetTaskDuck(
                              (const CPedIntelligence *)LODWORD(v20[18].m_transform.m_translate.y),
                              1);
                            TaskDuck = CPedIntelligence::GetTaskDuck(
                                         (const CPedIntelligence *)LODWORD(v20[18].m_transform.m_translate.y),
                                         1);
                            if ( TaskDuck && (p_m_heading[3] & 4) != 0 && !TaskDuck->m_bIsAborting )
                            {
                              v228 = dword_3C4CF0;
                              if ( (float)((float)((float)(v20[1].m_transform.m_translate.z
                                                         * v20[1].m_transform.m_translate.z)
                                                 + (float)(v20[1].m_transform.m_heading * v20[1].m_transform.m_heading))
                                         + (float)(*(float *)&v20[1].m_pMat * *(float *)&v20[1].m_pMat)) > 0.000001 )
                                v228 = &dword_3C4CF0[1];
                              v157 = *(float *)v228;
                            }
                            TheCamera.m_duckZMod = TheCamera.m_duckZMod
                                                 + (float)((float)(v157 - TheCamera.m_duckZMod)
                                                         * (float)(CTimer::ms_fTimeStep * 0.1));
                            this->Source.z = this->Source.z + TheCamera.m_duckZMod;
                            v229 = 5.0;
                            pVecTargetCoords.z = TheCamera.m_duckZMod + pVecTargetCoords.z;
                            v230 = this->Source.x;
                            v107 = v230 < 0.0;
                            v231 = v230 * 100000.0;
                            if ( v107 )
                              v229 = -5.0;
                            v232 = pVecTargetCoords.z;
                            *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = *(_QWORD *)&pVecTargetCoords.x;
                            this->m_cvecTargetCoorsForFudgeInter.z = v232;
                            modff((float)(v231 + v229) / 10.0, &v289.x);
                            v233 = this->Source.y;
                            v234 = 5.0;
                            v107 = v233 < 0.0;
                            v235 = v233 * 100000.0;
                            if ( v107 )
                              v234 = -5.0;
                            this->Source.x = v289.x / 10000.0;
                            modff((float)(v235 + v234) / 10.0, &v289.x);
                            v236 = this->Source.z;
                            v237 = 5.0;
                            v107 = v236 < 0.0;
                            v238 = v236 * 100000.0;
                            if ( v107 )
                              v237 = -5.0;
                            this->Source.y = v289.x / 10000.0;
                            modff((float)(v238 + v237) / 10.0, &v289.x);
                            this->Source.z = v289.x / 10000.0;
                            if ( v277 )
                            {
                              v239 = TheCamera.m_nPedZoom + 6;
                              if ( TheCamera.m_nPedZoom + 6 == gCurCamColVars )
                                goto LABEL_316;
                            }
                            else
                            {
                              v239 = TheCamera.m_nPedZoom + 3;
                              if ( TheCamera.m_nPedZoom + 3 == gCurCamColVars )
                                goto LABEL_316;
                            }
                            gCurCamColVars = v239;
                            gCurDistForCam = 1.0;
                            gpCamColVars = &gCamColVars[v239];
LABEL_316:
                            if ( DirectionIsLooking == 3 )
                            {
                              TheCamera.m_numExtrasEntitysToIgnore = 0;
                              TaskHold = CPedIntelligence::GetTaskHold(
                                           (const CPedIntelligence *)LODWORD(v20[18].m_transform.m_translate.y),
                                           0);
                              v241 = TaskHold == 0;
                              if ( TaskHold )
                              {
                                TaskHold = (CTaskSimpleHoldEntity *)TaskHold->m_pHoldEntity;
                                v241 = TaskHold == 0;
                              }
                              if ( !v241 )
                              {
                                v242 = TheCamera.m_numExtrasEntitysToIgnore++;
                                TheCamera.m_pExtrasEntitysToIgnore[v242] = (CEntity *)TaskHold;
                              }
                              CCollision::bCamCollideWithVehicles = 1;
                              CCollision::bCamCollideWithPeds = 1;
                              CCollision::bCamCollideWithObjects = 1;
                              CCamera::CameraColDetAndReact(
                                (CCamera *)&CCollision::bCamCollideWithObjects,
                                &this->Source,
                                &pVecTargetCoords);
                              CCamera::ImproveNearClip(
                                &TheCamera,
                                0,
                                (CPed *)v20,
                                &this->Source,
                                (int)&pVecTargetCoords);
                              v243 = this->Source.x;
                              v244 = 5.0;
                              v107 = v243 < 0.0;
                              v245 = v243 * 100000.0;
                              if ( v107 )
                                v244 = -5.0;
                              modff((float)(v245 + v244) / 10.0, &v289.x);
                              v246 = this->Source.y;
                              v247 = 5.0;
                              v107 = v246 < 0.0;
                              v248 = v246 * 100000.0;
                              if ( v107 )
                                v247 = -5.0;
                              this->Source.x = v289.x / 10000.0;
                              modff((float)(v248 + v247) / 10.0, &v289.x);
                              v249 = this->Source.z;
                              v250 = 5.0;
                              v107 = v249 < 0.0;
                              v251 = v249 * 100000.0;
                              if ( v107 )
                                v250 = -5.0;
                              this->Source.y = v289.x / 10000.0;
                              modff((float)(v251 + v250) / 10.0, &v289.x);
                              this->Source.z = v289.x / 10000.0;
                            }
                            v252 = 5.0;
                            *(_WORD *)&TheCamera.m_bCamDirectlyBehind = 0;
                            v253 = this->Source.x;
                            v107 = v253 < 0.0;
                            v254 = v253 * 100000.0;
                            if ( v107 )
                              v252 = -5.0;
                            modff((float)(v254 + v252) / 10.0, &v289.x);
                            v255 = this->Source.y;
                            v256 = 5.0;
                            v107 = v255 < 0.0;
                            v257 = v255 * 100000.0;
                            if ( v107 )
                              v256 = -5.0;
                            this->Source.x = v289.x / 10000.0;
                            modff((float)(v257 + v256) / 10.0, &v289.x);
                            v258 = this->Source.z;
                            v107 = v258 < 0.0;
                            v259 = v258 * 100000.0;
                            if ( v107 )
                              v202 = -5.0;
                            this->Source.y = v289.x / 10000.0;
                            modff((float)(v259 + v202) / 10.0, &v289.x);
                            this->Source.z = v289.x / 10000.0;
                            this->Up.x = 0.0;
                            this->Up.y = 0.0;
                            this->Up.z = 1.0;
                            CVector::Normalise(p_Front);
                            if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
                            {
                              this->Front.x = 0.0001;
                              this->Front.y = 0.0001;
                            }
                            CrossProduct(&v288, p_Front, &this->Up);
                            v289 = v288;
                            CVector::Normalise(&v289);
                            CrossProduct(&v288, &v289, p_Front);
                            v260 = *(_QWORD *)&v288.x;
                            this->Up.z = v288.z;
                            *(_QWORD *)&p_Up->x = v260;
                            if ( TheCamera.WhoIsInControlOfTheCamera != 1 )
                            {
                              v261 = 0;
                              if ( v277 )
                              {
LABEL_353:
                                gIdleCam.idleTickerFrames = v261;
                                this->ResetStatics = 0;
                                return;
                              }
                              if ( *p_m_heading << 31 )
                              {
                                IsCoopGameGoingOn = CGameLogic::IsCoopGameGoingOn();
                                v263 = (TheCamera.m_bVectorTrackScript
                                     || TheCamera.m_bFOVScript
                                     || TheCamera.m_bVectorMoveScript) << 24 == 0;
                                v261 = 0;
                                if ( !((TheCamera.m_bVectorTrackScript
                                     || TheCamera.m_bFOVScript
                                     || TheCamera.m_bVectorMoveScript) << 24) )
                                  v263 = IsCoopGameGoingOn == 0;
                                if ( !v263 )
                                  goto LABEL_353;
                                if ( (float)((float)((float)(v20[1].m_transform.m_translate.z
                                                           * v20[1].m_transform.m_translate.z)
                                                   + (float)(v20[1].m_transform.m_heading * v20[1].m_transform.m_heading))
                                           + (float)(*(float *)&v20[1].m_pMat * *(float *)&v20[1].m_pMat)) <= 0.0001 )
                                {
                                  v264 = currentPad;
                                  lastTimePadTouched = gIdleCam.lastTimePadTouched;
                                  if ( !currentPad )
                                    v264 = CPad::GetPad(0);
                                  if ( lastTimePadTouched == v264->LastTimeTouched )
                                  {
                                    v261 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0)
                                         + gIdleCam.idleTickerFrames;
                                    goto LABEL_353;
                                  }
                                  v266 = currentPad;
                                  if ( !currentPad )
                                    v266 = CPad::GetPad(0);
                                  gIdleCam.lastTimePadTouched = v266->LastTimeTouched;
                                }
                              }
                            }
                            v261 = 0;
                            goto LABEL_353;
                          }
                          v225 = *fBetab - (float)(*(float *)&v20[22].m_pLod + -1.5708);
                          if ( v225 <= 3.1416 )
                          {
                            if ( v225 >= -3.1416 )
                              goto LABEL_297;
                            v226 = 6.2832;
                          }
                          else
                          {
                            v226 = -6.2832;
                          }
                          v225 = v225 + v226;
LABEL_297:
                          if ( fabsf(v225) < (float)(CTimer::ms_fTimeStep * 0.1) )
                            *(float *)&v20[22].numLodChildren = *fBetab + 1.5708;
                          goto LABEL_299;
                        }
                        v189 = 6.2832;
                      }
                      else
                      {
                        v189 = -6.2832;
                      }
                      v188 = v188 + v189;
                      CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha = v188;
                      goto LABEL_269;
                    }
                  }
                  else
                  {
                    v130 = -6.2832;
                  }
                  *fBetab = v166 + v130;
                  goto LABEL_233;
                }
                v168 = !pbTouchInputX;
              }
              else
              {
                if ( CHID::GetInputType() )
                {
                  v166 = *fBetab;
                  goto LABEL_229;
                }
                v168 = !pbTouchInputX;
                v164 = CTimer::ms_fTimeStep;
              }
              v169 = 1.0;
              if ( v168 )
                v169 = v164;
              v166 = this->Beta + (float)(this->BetaSpeed * v169);
              goto LABEL_228;
            }
            fStickBeta = (float)(this->FOV / -80.0)
                       * (float)(CPad::NewMouseControllerState.m_AmountMoved.x
                               * (float)((float)((float)((float)MobileSettings::settings[31].value / 100.0) * 0.02)
                                       + 0.0005));
            v167 = `guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta;
            __dmb(0xBu);
            if ( (v167 & 1) == 0
              && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta) )
            {
              CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta = *fBetab;
              _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta);
            }
            if ( this->ResetKeyboardStatics )
              CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta = *fBetab;
            v170 = fStickBeta + CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta;
            CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta = v170;
            if ( v170 <= 3.1416 )
            {
              if ( v170 >= -3.1416 )
              {
LABEL_222:
                v172 = this->Beta;
                v173 = v170 - v172;
                if ( v173 > 3.1416 )
                  v173 = v173 + -6.2832;
                if ( v173 < -3.1416 )
                  v173 = v173 + 6.2832;
                v8.n64_u32[0] = 1.0;
                v7.n64_f32[0] = (float)((float)(unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0)
                                      / 1000.0)
                              * 12.5;
                v7.n64_u64[0] = vmin_f32(v7, v8).n64_u64[0];
                v166 = v172 + (float)(v173 * v7.n64_f32[0]);
                goto LABEL_227;
              }
              v171 = 6.2832;
            }
            else
            {
              v171 = -6.2832;
            }
            v170 = v170 + v171;
            CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta = v170;
            goto LABEL_222;
          }
        }
      }
    }
    if ( a6 == 1 )
    {
      v41 = v20->m_pMat;
      p_tx = (CSimpleTransform *)&v41->tx;
      if ( !v41 )
        p_tx = &v20->m_transform;
      v43 = *(_QWORD *)&p_tx->m_translate.x;
      vecPedPosEst.z = p_tx->m_translate.z;
      vecPedPosTrend.x = 0.0;
      vecPedPosTrend.y = 0.0;
      vecPedPosTrend.z = 0.0;
      *(_QWORD *)&vecPedPosEst.x = v43;
      v44 = *(_QWORD *)&p_tx->m_translate.x;
      pVecTargetCoords.z = p_tx->m_translate.z;
      *(_QWORD *)&pVecTargetCoords.x = v44;
      v40 = *v39 + pVecTargetCoords.z;
      pVecTargetCoords.z = v40;
    }
    v274 = (CVector *)Pad;
    TheCamera.m_duckZMod = 0.0;
    TheCamera.m_duckZMod_Aim = 0.0;
    v45 = CPedIntelligence::GetTaskDuck((const CPedIntelligence *)LODWORD(v20[18].m_transform.m_translate.y), 1);
    if ( v45 && (HIBYTE(v20[19].m_transform.m_heading) & 4) != 0 && !v45->m_bIsAborting )
    {
      v46 = *(float *)&v20[1].m_pMat * *(float *)&v20[1].m_pMat;
      v47 = (float)(v20[1].m_transform.m_translate.z * v20[1].m_transform.m_translate.z)
          + (float)(v20[1].m_transform.m_heading * v20[1].m_transform.m_heading);
      TheCamera.m_duckZMod_Aim = -0.35;
      v48 = (float *)&dword_3C3CE4;
      if ( (float)(v47 + v46) > 0.000001 )
        v48 = (float *)&loc_3C3CE8;
      TheCamera.m_duckZMod = *v48;
    }
    fBeta = (float *)v20;
    this->Rotating = 0;
    gForceCamBehindPlayer = 0;
    this->m_bCollisionChecksOn = 1;
    m_bJustCameOutOfGarage = TheCamera.m_bJustCameOutOfGarage;
    if ( TheCamera.m_bJustCameOutOfGarage )
      m_bJustCameOutOfGarage = 1;
    v50 = m_bJustCameOutOfGarage | a6;
    if ( !(m_bJustCameOutOfGarage | a6) )
    {
      v51 = *((_DWORD *)fBeta + 5);
      v52 = v51 ? atan2f(COERCE_FLOAT(*(_DWORD *)(v51 + 16) ^ 0x80000000), *(float *)(v51 + 20)) : fBeta[4];
      v69 = v52 + -1.5708;
      this->Beta = v69;
      if ( TheCamera.m_bCamDirectlyInFront )
        this->Beta = v69 + 3.1416;
    }
    this->AlphaSpeed = 0.0;
    this->BetaSpeed = 0.0;
    this->Distance = 1000.0;
    if ( v13.n64_f32[0] == TheCamera.m_fPedZoomBase )
    {
      v13.n64_u32[0] = LODWORD(TheCamera.m_fPedZoomTotal);
      TheCamera.m_fPedZoomSmoothed = TheCamera.m_fPedZoomTotal;
    }
    if ( v50 == 1 )
    {
      v70 = v26;
      v71 = this->Alpha;
    }
    else
    {
      v70 = v26;
      this->Alpha = 0.0;
      if ( *p_m_heading << 31 )
      {
        v7.n64_u32[0] = -1.0;
        v6.n64_f32[0] = (float)((float)(fBeta[351] * *(float *)(*((_DWORD *)fBeta + 5) + 16))
                              + (float)(fBeta[352] * *(float *)(*((_DWORD *)fBeta + 5) + 20)))
                      + (float)(fBeta[353] * *(float *)(*((_DWORD *)fBeta + 5) + 24));
        v8.n64_u32[0] = 1.0;
        v6.n64_u64[0] = vmin_f32(vmax_f32(v6, v7), v8).n64_u64[0];
        v71 = 0.0 - asinf(v6.n64_f32[0]);
        this->Alpha = v71;
      }
      else
      {
        v71 = 0.0;
      }
    }
    v72 = this->Beta;
    v73 = cosf(v72);
    v74 = cosf(v71);
    v75 = sinf(v72);
    v76 = sinf(v71);
    v9.n64_u32[1] = HIDWORD(v276);
    this->Front.z = v76;
    this->Front.x = -(float)(v73 * v74);
    this->Front.y = -(float)(v74 * v75);
    v77 = pVecTargetCoords.x + (float)(v13.n64_f32[0] * (float)(v73 * v74));
    v78 = pVecTargetCoords.y + (float)(*(float *)&v276 * (float)(v74 * v75));
    v9.n64_f32[0] = pVecTargetCoords.x + (float)(*(float *)&v276 * (float)(v73 * v74));
    v79 = pVecTargetCoords.y + (float)(v13.n64_f32[0] * (float)(v74 * v75));
    this->m_nTargetHistoryTime[0] = CTimer::m_snTimeInMilliseconds;
    LODWORD(this->m_aTargetHistoryPos[0].x) = v9.n64_u32[0];
    this->m_aTargetHistoryPos[0].y = v78;
    this->m_aTargetHistoryPos[0].z = v40 - (float)(*(float *)&v276 * v76);
    this->m_aTargetHistoryPos[1].x = v77;
    this->m_aTargetHistoryPos[1].y = v79;
    this->m_aTargetHistoryPos[1].z = v40 - (float)(v13.n64_f32[0] * v76);
    this->m_nCurrentHistoryPoints = 0;
    if ( !v50 )
      this->Alpha = -v30.n64_f32[1];
    v20 = (CEntity *)fBeta;
    v26 = v70;
    if ( CPedIntelligence::GetTaskSwim(v279) && CPedIntelligence::GetTaskSwim(v279)->m_nSwimState != 4 )
    {
      v80 = -0.2618;
      Pad = (CPad *)v274;
    }
    else
    {
      Pad = (CPad *)v274;
      if ( !CPedIntelligence::GetTaskJetPack(v279) )
      {
LABEL_93:
        v81 = CPad::GetPad(0);
        CPad::ClearMouseHistory(v81);
        goto LABEL_94;
      }
      v80 = -0.34907;
    }
    this->Alpha = v80 + this->Alpha;
    goto LABEL_93;
  }
}
// 3C2FA6: variable 'v6' is possibly undefined
// 3C2FA6: variable 'v8' is possibly undefined
// 3C2FB2: variable 'v13' is possibly undefined
// 3C2FB2: variable 'v14' is possibly undefined
// 3C31D4: variable 'v9' is possibly undefined
// 3C31D4: variable 'v11' is possibly undefined
// 3C31DC: variable 'v10' is possibly undefined
// 3C31DC: variable 'v12' is possibly undefined
// 3C3366: variable 'v7' is possibly undefined
// 3C351A: variable 'v15' is possibly undefined
// 3C3964: variable 'v16' is possibly undefined
// 4C: using guessed type int;
// FC: using guessed type int elf_hash_bucket[16411];
// 3C3CE4: using guessed type int dword_3C3CE4;
// 3C4CF0: using guessed type int dword_3C4CF0[2];
// 952DF8: using guessed type char `guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetBeta;
// 952E00: using guessed type char `guard variable for'CCam::Process_FollowPed_SA(CVector const&,float,float,float,bool)::fPedTargetAlpha;

//----- (003C4E10) --------------------------------------------------------
void __fastcall CCam::Process_M16_1stPerson(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d2
  float32x2_t v8; // d3
  CEntity *CamTargetEntity; // r0
  CEntity **p_CamTargetEntity; // r9
  _BOOL4 v13; // r10
  __int64 v14; // d16
  CEntity *v15; // r0
  float v16; // s0
  float v17; // s0
  float FOV; // r0
  int Mode; // r0
  bool v20; // zf
  Int32 MouseButtonAssociatedWithAction; // r5
  Int32 v22; // r6
  float v23; // s0
  int v24; // r6
  CPad *Pad; // r0
  _BOOL4 v26; // r5
  CPad *v27; // r0
  _BOOL4 v28; // r0
  float *p_FOV; // r0
  float v30; // s4
  float FOVSpeed; // s6
  float v32; // s10
  float v33; // s12
  float v34; // s10
  float v35; // s6
  float32x2_t v36; // d16
  float Beta; // s2
  float v38; // s6
  float v39; // s4
  RwV2d_0 m_AmountMoved; // d8
  float v41; // s16
  float v42; // s18
  unsigned __int64 v43; // d8
  _BOOL4 IsTouched; // r5
  CVector2D v45; // d9
  float v46; // s0
  float v47; // s2
  float v48; // s20
  float v49; // s24
  float v50; // s18
  float v51; // s22
  float v52; // s4
  int v53; // s6
  float v54; // s4
  bool v55; // nf
  int v56; // s0
  float v57; // r0
  float v58; // s2
  float v59; // s0
  float v60; // s18
  float v61; // s2
  float v62; // s0
  float v63; // s6
  float v64; // s4
  float v65; // s6
  float v66; // s16
  float v67; // s20
  float v68; // s0
  Int32 m_nCamBumpedTime; // r5
  unsigned int v70; // r6
  float v71; // r0
  float m_fCamBumpedHorz; // s22
  float m_fCamBumpedVert; // s24
  float v74; // r0
  CPed *v75; // r8
  int *v76; // r1
  float v77; // s16
  int m_nAttachLookDirn; // r0
  CEntity *v79; // r5
  CMatrix *v80; // r0
  float v81; // s20
  CEntity *v82; // r5
  CMatrix *v83; // r0
  CEntity *v84; // r5
  CMatrix *v85; // r0
  RwObject_0 *v86; // r0
  char *v87; // r1
  const CMatrix *v88; // r0
  RwMatrix *v89; // r1
  CEntity *m_pAttachToEntity; // r5
  CMatrix *m_pMat; // r0
  CEntity *v92; // r5
  CMatrix *v93; // r0
  float v94; // s0
  CEntity *v95; // r5
  CMatrix *v96; // r0
  float zx; // s0
  bool v98; // fzf
  bool v99; // fnf
  CEntity *v100; // r5
  CMatrix *v101; // r0
  float v102; // r6
  CEntity *v103; // r0
  CMatrix *v104; // r1
  float m_heading; // s0
  CEntity *v106; // r5
  CMatrix *v107; // r0
  float v108; // s20
  CEntity *v109; // r5
  CMatrix *v110; // r0
  CEntity *v111; // r5
  CMatrix *v112; // r0
  CEntity *v113; // r5
  CMatrix *v114; // r0
  CEntity *v115; // r5
  CMatrix *v116; // r0
  float v117; // s0
  CEntity *v118; // r5
  CMatrix *v119; // r0
  float zy; // s0
  bool v121; // fzf
  bool v122; // fnf
  CEntity *v123; // r5
  CMatrix *v124; // r0
  float v125; // r6
  CEntity *v126; // r0
  CMatrix *v127; // r1
  CVector *p_Source; // r8
  RwReal v129; // s0
  CPed *v130; // r5
  CMatrix *v131; // r0
  CMatrix *v132; // r0
  CMatrix *p_xy; // r0
  CMatrix *v134; // r0
  float v135; // s18
  float v136; // s16
  CMatrix *v137; // r0
  CPed *v138; // r6
  float *v139; // r0
  float v140; // s18
  CPed *v141; // r5
  float Alpha; // s26
  CEntity *v143; // r5
  CMatrix *v144; // r0
  float v145; // r0
  CEntity *v146; // r1
  float v147; // s20
  CMatrix *v148; // r0
  float v149; // s26
  float v150; // s2
  CEntity *v151; // r5
  CMatrix *v152; // r0
  float v153; // r6
  CEntity *v154; // r0
  CMatrix *v155; // r1
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  const CMatrix *v158; // r0
  RwMatrix *v159; // r1
  CEntity *v160; // r0
  int v161; // r1
  bool v162; // zf
  float v163; // s24
  float m_fAttachVerticalLimit; // s22
  float v165; // s28
  __int64 v166; // d16
  CEntity *v167; // r5
  float *p_xx; // r0
  CPed *v169; // r6
  float x; // s0
  float y; // s4
  float z; // s2
  float *v173; // r0
  float v174; // s8
  RwReal v175; // s6
  float v176; // s2
  float m_fAttachHeadingLimit; // s4
  float v178; // s6
  CEntity *v179; // r1
  float v180; // s6
  CAutomobile *v181; // r0
  float v182; // s2
  float v183; // s4
  float v184; // s8
  float v185; // s30
  float v186; // s2
  float v187; // s26
  float v188; // s6
  float v189; // s4
  float HeliRequestedOrientation; // s2
  float v191; // s2
  float v192; // s0
  float v193; // s2
  float v194; // s4
  float v195; // s2
  float v196; // s2
  float v197; // s0
  int v198; // s0
  float v199; // r5
  float v200; // s20
  float v201; // s22
  float v202; // s30
  float v203; // r0
  float v204; // s14
  float32x2_t v205; // d0
  float32x2_t v206; // d1
  CVector *p_Front; // r10
  float v208; // s2
  float v209; // s22
  float v210; // s24
  float v211; // s26
  float v212; // r10
  float v213; // r11
  float v214; // s0
  float v215; // s2
  float v216; // s22
  float v217; // s24
  float v218; // s26
  float v219; // r10
  float v220; // r11
  float v221; // s0
  int v222; // r5
  bool v223; // zf
  RwReal v224; // s2
  RwReal v225; // s4
  __int64 v226; // d16
  float v227; // r0
  CVector2D pVecOut; // [sp+18h] [bp-98h] BYREF
  CVector vecStart; // [sp+20h] [bp-90h] BYREF
  CVector v230; // [sp+30h] [bp-80h] BYREF
  RwV3d_0 posn; // [sp+40h] [bp-70h] BYREF

  CamTargetEntity = this->CamTargetEntity;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 3 )
    return;
  p_CamTargetEntity = &this->CamTargetEntity;
  v13 = CPed::IsPlayer((const CPed *)CamTargetEntity) && LODWORD((*p_CamTargetEntity)[4].m_transform.m_heading) != 0;
  v14 = *(_QWORD *)&ThisCamsTarget->x;
  vecStart.z = ThisCamsTarget->z;
  *(_QWORD *)&vecStart.x = v14;
  if ( this->ResetStatics )
  {
    if ( CHID::GetInputType() != 2 || (v15 = *p_CamTargetEntity, (*p_CamTargetEntity)[30].m_pRwObject != 0 || v13) )
    {
      v15 = *p_CamTargetEntity;
      if ( v13 )
        v16 = CTheScripts::fCameraHeadingWhenPlayerIsAttached;
      else
        v16 = *(float *)&(*p_CamTargetEntity)[22].m_pLod + -1.5708;
      this->Alpha = 0.0;
      this->Beta = v16;
    }
    v17 = *(float *)&v15[22].m_pLod + -1.5708;
    this->ResetStatics = 0;
    this->m_fInitialPlayerOrientation = v17;
    CCam::Process_M16_1stPerson(CVector const&,float,float,float)::FailedTestTwelveFramesAgo = 0;
    this->FOVSpeed = 0.0;
    FOV = this->FOV;
    this->m_bCollisionChecksOn = 1;
    CCam::Process_M16_1stPerson(CVector const&,float,float,float)::TargetFOV = FOV;
    this->BetaSpeed = 0.0;
    this->AlphaSpeed = 0.0;
  }
  Mode = (unsigned __int16)this->Mode;
  v20 = Mode == 46;
  if ( Mode != 46 )
    v20 = Mode == 7;
  if ( !v20 )
  {
    this->FOV = 70.0;
    goto LABEL_44;
  }
  MouseButtonAssociatedWithAction = CControllerConfigManager::GetMouseButtonAssociatedWithAction(
                                      &ControlsManager,
                                      PED_SNIPER_ZOOM_IN);
  v22 = CControllerConfigManager::GetMouseButtonAssociatedWithAction(&ControlsManager, PED_SNIPER_ZOOM_OUT);
  CPad::GetPad(0);
  if ( v22 == 4 && CPad::NewMouseControllerState.m_fWheelMoved > 0.0
    || (CPad::GetPad(0), v22 == 5) && CPad::NewMouseControllerState.m_fWheelMoved < 0.0 )
  {
    CPad::GetPad(0);
    v23 = CCam::Process_M16_1stPerson(CVector const&,float,float,float)::TargetFOV
        * (float)((float)((float)(fabsf(CPad::NewMouseControllerState.m_fWheelMoved) * 7.0) + 10000.0) / 10000.0);
LABEL_22:
    v24 = 1;
    CCam::Process_M16_1stPerson(CVector const&,float,float,float)::TargetFOV = v23;
    goto LABEL_23;
  }
  CPad::GetPad(0);
  if ( MouseButtonAssociatedWithAction == 4 && CPad::NewMouseControllerState.m_fWheelMoved > 0.0
    || (v24 = 0, CPad::GetPad(0), MouseButtonAssociatedWithAction == 5)
    && CPad::NewMouseControllerState.m_fWheelMoved < 0.0 )
  {
    CPad::GetPad(0);
    v23 = CCam::Process_M16_1stPerson(CVector const&,float,float,float)::TargetFOV
        / (float)((float)((float)(fabsf(CPad::NewMouseControllerState.m_fWheelMoved) * 7.0) + 10000.0) / 10000.0);
    goto LABEL_22;
  }
LABEL_23:
  Pad = CPad::GetPad(0);
  v26 = CPad::SniperZoomOut(Pad);
  v27 = CPad::GetPad(0);
  v28 = CPad::SniperZoomIn(v27);
  if ( v24 || !v26 )
  {
    if ( !v28 | v24 )
    {
      v5.n64_u32[0] = LODWORD(this->FOV);
      p_FOV = &this->FOV;
      if ( fabsf(CCam::Process_M16_1stPerson(CVector const&,float,float,float)::TargetFOV - v5.n64_f32[0]) <= 0.5 )
      {
        this->FOVSpeed = 0.0;
      }
      else
      {
        v30 = (float)(CCam::Process_M16_1stPerson(CVector const&,float,float,float)::TargetFOV - v5.n64_f32[0]) * 0.5;
        FOVSpeed = this->FOVSpeed;
        v32 = fabsf(v30 - FOVSpeed) * 0.25;
        v6.n64_f32[0] = CTimer::ms_fTimeStep;
        v33 = -(float)(CTimer::ms_fTimeStep * v32);
        v34 = CTimer::ms_fTimeStep * v32;
        if ( (float)(v30 - FOVSpeed) > 0.0 )
          v33 = v34;
        v35 = FOVSpeed + v33;
        this->FOVSpeed = v35;
        if ( v30 < 0.0 || v30 > 0.0 )
        {
          v35 = v30;
          this->FOVSpeed = v30;
        }
        v7.n64_u32[0] = 10.0;
        v6.n64_u64[0] = vmin_f32(v6, v7).n64_u64[0];
        v5.n64_f32[0] = v5.n64_f32[0] + (float)(v35 * v6.n64_f32[0]);
        *p_FOV = v5.n64_f32[0];
      }
      goto LABEL_41;
    }
    v5.n64_f32[0] = this->FOV / (float)((float)((float)(CTimer::ms_fTimeStep * 255.0) + 10000.0) / 10000.0);
  }
  else
  {
    v5.n64_f32[0] = this->FOV * (float)((float)((float)(CTimer::ms_fTimeStep * 255.0) + 10000.0) / 10000.0);
  }
  this->FOVSpeed = 0.0;
  LODWORD(this->FOV) = v5.n64_u32[0];
  CCam::Process_M16_1stPerson(CVector const&,float,float,float)::TargetFOV = v5.n64_f32[0];
  p_FOV = &this->FOV;
LABEL_41:
  v8.n64_u32[0] = 1116471296;
  v6.n64_u32[0] = 12.0;
  v36.n64_u64[0] = vmin_f32(v5, v8).n64_u64[0];
  if ( this->Mode == 46 )
    v6.n64_u32[0] = 3.0;
  *(_DWORD *)p_FOV = vmax_f32(v36, v6).n64_u32[0];
  *(_QWORD *)&TheCamera.m_BlurBlue = 0xFF000000B4LL;
  *(_QWORD *)&TheCamera.m_BlurRed = 0x1000000B4LL;
  TheCamera.m_motionBlur = 120;
LABEL_44:
  if ( CTheScripts::fCameraHeadingStepWhenPlayerIsAttached > 0.0 && v13 )
  {
    Beta = this->Beta;
    v38 = Beta - CTheScripts::fCameraHeadingWhenPlayerIsAttached;
    if ( (float)(Beta - CTheScripts::fCameraHeadingWhenPlayerIsAttached) < 0.0 )
      v38 = (float)(Beta - CTheScripts::fCameraHeadingWhenPlayerIsAttached) + 6.2832;
    if ( v38 >= CTheScripts::fCameraHeadingStepWhenPlayerIsAttached )
    {
      v39 = -CTheScripts::fCameraHeadingStepWhenPlayerIsAttached;
      if ( v38 > (float)(6.2832 - v38) )
        v39 = CTheScripts::fCameraHeadingStepWhenPlayerIsAttached;
      this->Beta = Beta + v39;
    }
    else
    {
      this->Beta = CTheScripts::fCameraHeadingWhenPlayerIsAttached;
      CTheScripts::fCameraHeadingStepWhenPlayerIsAttached = 0.0;
    }
  }
  CPad::GetPad(0);
  m_AmountMoved = CPad::NewMouseControllerState.m_AmountMoved;
  pVecOut.x = 0.0;
  pVecOut.y = 0.0;
  if ( CHID::GetInputType() )
  {
    if ( CHID::GetInputType() == 1 )
    {
      v41 = 0.0;
      if ( CTouchInterface::IsTouched(WIDGET_PED_MOVE, &pVecOut, 1) )
      {
        if ( CHID::IsPressed(HID_MAPPING_PED_MOVE_X, 0) || (v42 = 0.0, CHID::IsPressed(HID_MAPPING_PED_MOVE_Y, 0)) )
        {
          v42 = -(float)(pVecOut.y * (float)((float)((float)MobileSettings::settings[26].value / 100.0) + 0.3));
          v41 = -(float)(pVecOut.x * (float)((float)((float)MobileSettings::settings[25].value / 100.0) + 0.3));
        }
      }
      else
      {
        v42 = 0.0;
      }
      if ( CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1)
        && (CHID::IsPressed(HID_MAPPING_LOOK_X, 0) || CHID::IsPressed(HID_MAPPING_LOOK_Y, 0)) )
      {
        v42 = -(float)(pVecOut.y * (float)((float)((float)MobileSettings::settings[26].value / 100.0) + 0.3));
        v41 = -(float)(pVecOut.x * (float)((float)((float)MobileSettings::settings[25].value / 100.0) + 0.3));
      }
      goto LABEL_69;
    }
    if ( CHID::GetInputType() == 2 )
    {
      IsTouched = CTouchInterface::IsTouched(WIDGET_PED_MOVE, &pVecOut, 1);
      v45 = pVecOut;
      if ( CPad::GetPad(0)->DisablePlayerControls
        || (IsTouched ? (v43 = vmul_f32((float32x2_t)v45, (float32x2_t)0xBD99999ABD99999ALL).n64_u64[0]) : (v43 = vneg_f32((float32x2_t)m_AmountMoved).n64_u64[0]),
            CPad::GetPad(0)->JustOutOfFrontEnd) )
      {
        v43 = 0LL;
      }
      else if ( CTimer::ms_fTimeStep <= 0.0 )
      {
        v43 = 0LL;
      }
      goto LABEL_86;
    }
LABEL_63:
    v41 = 0.0;
    v42 = 0.0;
LABEL_69:
    v46 = -v42;
    if ( !MobileSettings::settings[15].value )
      v46 = v42;
    if ( v13 )
    {
      v47 = this->FOV / 80.0;
      v48 = CTimer::ms_fTimeStep;
      v49 = (float)(v46 * 0.0078125) * fabsf(v46 * 0.0078125);
      v50 = v47 * 0.034286;
      v51 = CTimer::ms_fTimeStep
          * (float)((float)((float)(v41 * 0.0078125) * fabsf(v41 * 0.0078125)) * (float)(v47 * 0.04));
    }
    else
    {
      v50 = this->FOV / 80.0;
      v48 = CTimer::ms_fTimeStep;
      v52 = (float)((float)MobileSettings::settings[26].value / 100.0) * 0.00075 + 0.000150000007;
      v49 = v46 * v52;
      v51 = CTimer::ms_fTimeStep
          * (float)(v50
                  * (float)(v41
                          * (float)((float)((float)((float)MobileSettings::settings[25].value / 100.0) * 0.001) + 0.00015)));
    }
    v53 = 1061997773;
    v54 = fabsf(v41);
    v55 = fabsf(v46) < 2.0;
    v56 = 1061997773;
    if ( v55 )
      v56 = 0.5;
    if ( v54 < 2.0 )
      v53 = v56;
    v57 = powf(*(float *)&v53, v48);
    v58 = (float)(v57 * this->BetaSpeed) + (float)(v51 * (float)(1.0 - v57));
    v59 = (float)((float)((float)(v50 * v49) * v48) * (float)(1.0 - v57)) + (float)(v57 * this->AlphaSpeed);
    this->BetaSpeed = v58;
    this->AlphaSpeed = v59;
    goto LABEL_92;
  }
  if ( !CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1) )
    goto LABEL_63;
  v43 = vmul_f32((float32x2_t)pVecOut, (float32x2_t)0xBF000000BF000000LL).n64_u64[0];
LABEL_86:
  v60 = -*((float *)&v43 + 1);
  if ( !MobileSettings::settings[15].value )
    v60 = *((float *)&v43 + 1);
  if ( CHID::GetInputType() == 2 )
  {
    v61 = (float)((float)((float)MobileSettings::settings[32].value / 100.0) * 0.006) + 0.0005;
    v62 = (float)((float)((float)MobileSettings::settings[31].value / 100.0) * 0.008) + 0.0005;
  }
  else
  {
    v61 = 0.0015;
    v62 = 0.0025;
  }
  v63 = this->FOV;
  this->AlphaSpeed = 0.0;
  v64 = v63 / 80.0;
  this->BetaSpeed = 0.0;
  v65 = *(float *)&v43 * v62;
  v59 = (float)(v60 * v61) * v64;
  v58 = v65 * v64;
LABEL_92:
  v66 = v58 + this->Beta;
  v67 = v59 + this->Alpha;
  this->Beta = v66;
  this->Alpha = v67;
  if ( v66 > 3.1416 )
  {
    v68 = -6.2832;
LABEL_96:
    v66 = v66 + v68;
    this->Beta = v66;
    goto LABEL_97;
  }
  if ( v66 < -3.1416 )
  {
    v68 = 6.2832;
    goto LABEL_96;
  }
LABEL_97:
  m_nCamBumpedTime = this->m_nCamBumpedTime;
  if ( m_nCamBumpedTime >= 1 )
  {
    v70 = CTimer::m_snTimeInMilliseconds;
    v71 = cosf(
            (float)((float)(CTimer::m_snTimeInMilliseconds - m_nCamBumpedTime) / (float)CCam::CAM_BUMPED_SWING_PERIOD)
          * 6.2832);
    m_fCamBumpedHorz = this->m_fCamBumpedHorz;
    m_fCamBumpedVert = this->m_fCamBumpedVert;
    v67 = v67 + (float)((float)(v71 * CCam::CAM_BUMPED_MOVE_MULT) * m_fCamBumpedVert);
    this->Beta = v66 + (float)((float)(v71 * CCam::CAM_BUMPED_MOVE_MULT) * m_fCamBumpedHorz);
    this->Alpha = v67;
    v74 = powf(CCam::CAM_BUMPED_DAMP_RATE, CTimer::ms_fTimeStep);
    this->m_fCamBumpedHorz = v74 * m_fCamBumpedHorz;
    this->m_fCamBumpedVert = v74 * m_fCamBumpedVert;
    if ( v70 > CCam::CAM_BUMPED_END_TIME + m_nCamBumpedTime )
      this->m_nCamBumpedTime = 0;
  }
  v75 = (CPed *)*p_CamTargetEntity;
  v76 = dword_3C6474;
  if ( (HIBYTE((*p_CamTargetEntity)[19].m_transform.m_heading) & 4) == 0 )
    v76 = &dword_3C6474[1];
  v77 = *(float *)v76;
  if ( v13 )
  {
    m_nAttachLookDirn = v75->m_nAttachLookDirn;
    switch ( m_nAttachLookDirn )
    {
      case 3:
        m_pAttachToEntity = v75->m_pAttachToEntity;
        m_pMat = m_pAttachToEntity->m_pMat;
        if ( !m_pMat )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&m_pAttachToEntity->m_transform, m_pAttachToEntity->m_pMat);
          m_pMat = m_pAttachToEntity->m_pMat;
        }
        if ( m_pMat->zx > 1.0 )
          goto LABEL_129;
        v92 = v75->m_pAttachToEntity;
        v93 = v92->m_pMat;
        if ( !v93 )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v92->m_transform, v92->m_pMat);
          v93 = v92->m_pMat;
        }
        v94 = -1.0;
        if ( v93->zx >= -1.0 )
        {
LABEL_129:
          v95 = v75->m_pAttachToEntity;
          v96 = v95->m_pMat;
          if ( !v96 )
          {
            CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
            CSimpleTransform::UpdateMatrix(&v95->m_transform, v95->m_pMat);
            v96 = v95->m_pMat;
          }
          zx = v96->zx;
          v98 = zx == 1.0;
          v99 = zx < 1.0;
          v94 = 1.0;
          if ( v99 || v98 )
          {
            v100 = v75->m_pAttachToEntity;
            v101 = v100->m_pMat;
            if ( !v101 )
            {
              CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
              CSimpleTransform::UpdateMatrix(&v100->m_transform, v100->m_pMat);
              v101 = v100->m_pMat;
            }
            v94 = v101->zx;
          }
        }
        v102 = asinf(v94);
        v103 = v75->m_pAttachToEntity;
        v104 = v103->m_pMat;
        if ( v104 )
          m_heading = atan2f(COERCE_FLOAT(LODWORD(v104->xy) ^ 0x80000000), v104->yy);
        else
          m_heading = v103->m_transform.m_heading;
        v147 = v102;
        v150 = -3.1416;
        break;
      case 2:
        v106 = v75->m_pAttachToEntity;
        v107 = v106->m_pMat;
        if ( !v107 )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v106->m_transform, v106->m_pMat);
          v107 = v106->m_pMat;
        }
        v108 = -1.0;
        if ( v107->zy < -1.0 )
          goto LABEL_144;
        v109 = v75->m_pAttachToEntity;
        v110 = v109->m_pMat;
        if ( !v110 )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v109->m_transform, v109->m_pMat);
          v110 = v109->m_pMat;
        }
        if ( v110->zy <= 1.0 )
        {
LABEL_144:
          v111 = v75->m_pAttachToEntity;
          v112 = v111->m_pMat;
          if ( !v112 )
          {
            CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
            CSimpleTransform::UpdateMatrix(&v111->m_transform, v111->m_pMat);
            v112 = v111->m_pMat;
          }
          if ( v112->zy >= -1.0 )
          {
            v151 = v75->m_pAttachToEntity;
            v152 = v151->m_pMat;
            if ( !v152 )
            {
              CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
              CSimpleTransform::UpdateMatrix(&v151->m_transform, v151->m_pMat);
              v152 = v151->m_pMat;
            }
            v108 = -v152->zy;
          }
          else
          {
            v108 = 1.0;
          }
        }
        v153 = asinf(v108);
        v154 = v75->m_pAttachToEntity;
        v155 = v154->m_pMat;
        if ( v155 )
          m_heading = atan2f(COERCE_FLOAT(LODWORD(v155->xy) ^ 0x80000000), v155->yy);
        else
          m_heading = v154->m_transform.m_heading;
        v147 = v153;
        v150 = 1.5708;
        break;
      case 1:
        v79 = v75->m_pAttachToEntity;
        v80 = v79->m_pMat;
        if ( !v80 )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v79->m_transform, v79->m_pMat);
          v80 = v79->m_pMat;
        }
        v81 = -1.0;
        if ( v80->zx < -1.0 )
          goto LABEL_112;
        v82 = v75->m_pAttachToEntity;
        v83 = v82->m_pMat;
        if ( !v83 )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v82->m_transform, v82->m_pMat);
          v83 = v82->m_pMat;
        }
        if ( v83->zx <= 1.0 )
        {
LABEL_112:
          v84 = v75->m_pAttachToEntity;
          v85 = v84->m_pMat;
          if ( !v85 )
          {
            CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
            CSimpleTransform::UpdateMatrix(&v84->m_transform, v84->m_pMat);
            v85 = v84->m_pMat;
          }
          if ( v85->zx >= -1.0 )
          {
            v143 = v75->m_pAttachToEntity;
            v144 = v143->m_pMat;
            if ( !v144 )
            {
              CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
              CSimpleTransform::UpdateMatrix(&v143->m_transform, v143->m_pMat);
              v144 = v143->m_pMat;
            }
            v81 = -v144->zx;
          }
          else
          {
            v81 = 1.0;
          }
        }
        v145 = asinf(v81);
        v146 = v75->m_pAttachToEntity;
        v147 = v145;
        v148 = v146->m_pMat;
        if ( v148 )
          v149 = atan2f(COERCE_FLOAT(LODWORD(v148->xy) ^ 0x80000000), v148->yy);
        else
          v149 = v146->m_transform.m_heading;
LABEL_199:
        CPed::PositionAttachedPed(v75);
        m_pRwObject = v75->m_pRwObject;
        if ( m_pRwObject )
        {
          parent = (char *)m_pRwObject->parent;
          v158 = v75->m_pMat;
          v159 = (RwMatrix *)(parent + 16);
          if ( v158 )
            CMatrix::UpdateRwMatrix(v158, v159);
          else
            CSimpleTransform::UpdateRwMatrix(&v75->m_transform, v159);
        }
        CEntity::UpdateRwFrame(v75);
        CEntity::UpdateRpHAnim(v75);
        memset(&posn, 0, sizeof(posn));
        v160 = v75->m_pAttachToEntity;
        v161 = *(_BYTE *)&v160->m_info & 7;
        v162 = v161 == 2;
        if ( v161 == 2 )
          v162 = v160[24]._vptr$CPlaceable == (int (**)(void))byte_9;
        if ( v162 )
        {
          CPed::GetBonePosition((CPed *)*p_CamTargetEntity, &posn, 5u, 1);
          v77 = 0.0;
          m_fAttachVerticalLimit = v75->m_fAttachVerticalLimit;
          v165 = 0.0;
          v163 = m_fAttachVerticalLimit;
        }
        else
        {
          CPed::GetBonePosition((CPed *)*p_CamTargetEntity, &posn, 5u, 1);
          v163 = 1.0472;
          m_fAttachVerticalLimit = 1.4923;
          v165 = 0.1;
        }
        v166 = *(_QWORD *)&posn.x;
        v167 = this->CamTargetEntity;
        this->Source.z = posn.z;
        *(_QWORD *)&this->Source.x = v166;
        p_xx = &v167->m_pMat->xx;
        if ( p_xx )
        {
          v169 = (CPed *)v167;
        }
        else
        {
          CPlaceable::AllocateMatrix(v167);
          CSimpleTransform::UpdateMatrix(&v167->m_transform, v167->m_pMat);
          v169 = (CPed *)*p_CamTargetEntity;
          p_xx = &v167->m_pMat->xx;
        }
        x = (float)(v165 * p_xx[8]) + this->Source.x;
        y = (float)(v165 * p_xx[9]) + this->Source.y;
        z = (float)(v165 * p_xx[10]) + this->Source.z;
        this->Source.x = x;
        this->Source.y = y;
        this->Source.z = z;
        v173 = &v169->m_pMat->xx;
        if ( !v173 )
        {
          CPlaceable::AllocateMatrix(v169);
          CSimpleTransform::UpdateMatrix(&v169->m_transform, v169->m_pMat);
          v173 = &v169->m_pMat->xx;
          x = this->Source.x;
          y = this->Source.y;
          z = this->Source.z;
        }
        v174 = v77 * v173[5];
        v175 = z - (float)(v77 * v173[6]);
        v176 = this->Beta;
        this->Source.x = x - (float)(v77 * v173[4]);
        this->Source.y = y - v174;
        this->Source.z = v175;
        m_fAttachHeadingLimit = v75->m_fAttachHeadingLimit;
        if ( (float)(v149 - v176) <= 3.1416 )
        {
          if ( (float)(v149 - v176) >= -3.1416 )
          {
LABEL_218:
            v179 = v75->m_pAttachToEntity;
            v180 = m_fAttachHeadingLimit * 0.75;
            v181 = 0;
            if ( (*(_BYTE *)&v179->m_info & 7) == 2 && LODWORD(v179[24].m_transform.m_translate.x) == 3 )
              v181 = (CAutomobile *)v75->m_pAttachToEntity;
            v182 = v149 - v176;
            v183 = m_fAttachHeadingLimit * 0.25;
            v184 = CTimer::ms_fTimeStep * 0.05;
            if ( v182 <= v180 )
            {
              if ( v182 >= (float)-v180 )
              {
LABEL_234:
                v191 = v163 * 0.75;
                Alpha = this->Alpha;
                v192 = CTimer::ms_fTimeStep * 0.05;
                if ( Alpha > (float)(v147 + (float)(v163 * 0.75)) && (float)(v147 - Alpha) < (float)-v191 )
                {
                  v193 = fabsf(v191 + (float)(v147 - Alpha));
                  v194 = v192 * v193;
                  if ( v193 > (float)((float)(v163 * 0.25) + (float)(v192 * v193)) )
                    v194 = v193 - (float)(v163 * 0.25);
                  Alpha = Alpha - v194;
                  this->Alpha = Alpha;
                }
                v195 = m_fAttachVerticalLimit * 0.75;
                if ( Alpha < (float)(v147 - (float)(m_fAttachVerticalLimit * 0.75)) && (float)(v147 - Alpha) > v195 )
                {
                  v196 = fabsf((float)(v147 - Alpha) - v195);
                  v197 = v192 * v196;
                  if ( v196 > (float)((float)(m_fAttachVerticalLimit * 0.25) + v197) )
                    v197 = v196 - (float)(m_fAttachVerticalLimit * 0.25);
                  Alpha = v197 + Alpha;
                  this->Alpha = Alpha;
                }
                goto LABEL_244;
              }
              v185 = v180 + v182;
            }
            else
            {
              v185 = v182 - v180;
            }
            v186 = fabsf(v185);
            v187 = v184 * v186;
            v188 = v183 + (float)(v184 * v186);
            v189 = v186 - v183;
            if ( v186 > v188 )
              v187 = v189;
            if ( v181 )
            {
              HeliRequestedOrientation = v181->HeliRequestedOrientation;
              if ( HeliRequestedOrientation > 0.0 )
                CAutomobile::SetHeliOrientation(
                  v181,
                  HeliRequestedOrientation + (float)((float)(v185 * -0.1) * CTimer::ms_fTimeStep));
            }
            if ( v185 != 0.0 )
            {
              if ( v185 < 0.0 )
                v187 = -v187;
              this->Beta = v187 + this->Beta;
            }
            goto LABEL_234;
          }
          v178 = 6.2832;
        }
        else
        {
          v178 = -6.2832;
        }
        v149 = v149 + v178;
        goto LABEL_218;
      default:
        v113 = v75->m_pAttachToEntity;
        v114 = v113->m_pMat;
        if ( !v114 )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v113->m_transform, v113->m_pMat);
          v114 = v113->m_pMat;
        }
        if ( v114->zy > 1.0 )
          goto LABEL_154;
        v115 = v75->m_pAttachToEntity;
        v116 = v115->m_pMat;
        if ( !v116 )
        {
          CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
          CSimpleTransform::UpdateMatrix(&v115->m_transform, v115->m_pMat);
          v116 = v115->m_pMat;
        }
        v117 = -1.0;
        if ( v116->zy >= -1.0 )
        {
LABEL_154:
          v118 = v75->m_pAttachToEntity;
          v119 = v118->m_pMat;
          if ( !v119 )
          {
            CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
            CSimpleTransform::UpdateMatrix(&v118->m_transform, v118->m_pMat);
            v119 = v118->m_pMat;
          }
          zy = v119->zy;
          v121 = zy == 1.0;
          v122 = zy < 1.0;
          v117 = 1.0;
          if ( v122 || v121 )
          {
            v123 = v75->m_pAttachToEntity;
            v124 = v123->m_pMat;
            if ( !v124 )
            {
              CPlaceable::AllocateMatrix(v75->m_pAttachToEntity);
              CSimpleTransform::UpdateMatrix(&v123->m_transform, v123->m_pMat);
              v124 = v123->m_pMat;
            }
            v117 = v124->zy;
          }
        }
        v125 = asinf(v117);
        v126 = v75->m_pAttachToEntity;
        v127 = v126->m_pMat;
        if ( v127 )
          m_heading = atan2f(COERCE_FLOAT(LODWORD(v127->xy) ^ 0x80000000), v127->yy);
        else
          m_heading = v126->m_transform.m_heading;
        v147 = v125;
        v150 = -1.5708;
        break;
    }
    v149 = m_heading + v150;
    goto LABEL_199;
  }
  if ( v67 <= 1.0472 )
  {
    if ( v67 < -1.4923 )
      this->Alpha = -1.4923;
  }
  else
  {
    this->Alpha = 1.0472;
  }
  v86 = v75->m_pRwObject;
  if ( v86 )
  {
    v87 = (char *)v86->parent;
    v88 = v75->m_pMat;
    v89 = (RwMatrix *)(v87 + 16);
    if ( v88 )
      CMatrix::UpdateRwMatrix(v88, v89);
    else
      CSimpleTransform::UpdateRwMatrix(&v75->m_transform, v89);
  }
  CEntity::UpdateRwFrame(this->CamTargetEntity);
  CEntity::UpdateRpHAnim(this->CamTargetEntity);
  memset(&posn, 0, sizeof(posn));
  CPed::GetBonePosition((CPed *)this->CamTargetEntity, &posn, 5u, 1);
  p_Source = &this->Source;
  this->Source.z = posn.z;
  v129 = this->Source.z + 0.1;
  v130 = (CPed *)this->CamTargetEntity;
  *(_QWORD *)&this->Source.x = *(_QWORD *)&posn.x;
  this->Source.z = v129;
  if ( (*((_BYTE *)&v130->m_nPedFlags + 3) & 4) != 0 )
  {
    v134 = v130->m_pMat;
    v135 = fDuckingBackOffset;
    if ( !v134 )
    {
      CPlaceable::AllocateMatrix(v130);
      CSimpleTransform::UpdateMatrix(&v130->m_transform, v130->m_pMat);
      v134 = v130->m_pMat;
      v130 = (CPed *)*p_CamTargetEntity;
    }
    v136 = fDuckingBackOffset;
    p_Source->x = p_Source->x - (float)(v135 * v134->xy);
    v137 = v130->m_pMat;
    if ( v137 )
    {
      v138 = v130;
    }
    else
    {
      CPlaceable::AllocateMatrix(v130);
      CSimpleTransform::UpdateMatrix(&v130->m_transform, v130->m_pMat);
      v138 = (CPed *)*p_CamTargetEntity;
      v137 = v130->m_pMat;
    }
    this->Source.y = this->Source.y - (float)(v136 * v137->yy);
    v139 = &v138->m_pMat->xx;
    v140 = fDuckingRightOffset;
    if ( v139 )
    {
      v141 = v138;
    }
    else
    {
      CPlaceable::AllocateMatrix(v138);
      CSimpleTransform::UpdateMatrix(&v138->m_transform, v138->m_pMat);
      v141 = (CPed *)*p_CamTargetEntity;
      v139 = &v138->m_pMat->xx;
    }
    v77 = fDuckingRightOffset;
    p_Source->x = p_Source->x - (float)(v140 * *v139);
    p_xy = v141->m_pMat;
    if ( !p_xy )
    {
      CPlaceable::AllocateMatrix(v141);
      CSimpleTransform::UpdateMatrix(&v141->m_transform, v141->m_pMat);
      p_xy = v141->m_pMat;
    }
  }
  else
  {
    v131 = v130->m_pMat;
    if ( !v131 )
    {
      CPlaceable::AllocateMatrix(v130);
      CSimpleTransform::UpdateMatrix(&v130->m_transform, v130->m_pMat);
      v131 = v130->m_pMat;
      v130 = (CPed *)*p_CamTargetEntity;
    }
    p_Source->x = p_Source->x - (float)(v77 * v131->xy);
    v132 = v130->m_pMat;
    if ( !v132 )
    {
      CPlaceable::AllocateMatrix(v130);
      CSimpleTransform::UpdateMatrix(&v130->m_transform, v130->m_pMat);
      v132 = v130->m_pMat;
    }
    p_xy = (CMatrix *)&v132->xy;
  }
  this->Source.y = this->Source.y - (float)(v77 * p_xy->yx);
  Alpha = this->Alpha;
LABEL_244:
  *(float *)&v198 = -1.2;
  if ( Alpha < -1.2 || (*(float *)&v198 = 1.2, Alpha > 1.2) )
  {
    Alpha = *(float *)&v198;
    this->Alpha = *(float *)&v198;
  }
  v199 = this->Beta;
  v200 = cosf(v199);
  v201 = cosf(Alpha);
  v202 = v201 * sinf(v199);
  v203 = sinf(Alpha);
  v204 = this->Source.x;
  v205.n64_u32[1] = LODWORD(this->Source.y);
  v206.n64_u32[1] = LODWORD(this->Source.z);
  this->Front.z = v203;
  p_Front = &this->Front;
  this->Front.x = -(float)(v200 * v201);
  this->Front.y = -v202;
  vecStart.z = (float)(v203 * 3.0) + v206.n64_f32[1];
  vecStart.y = (float)(v202 * -3.0) + v205.n64_f32[1];
  vecStart.x = (float)((float)(v200 * v201) * -3.0) + v204;
  this->Source.x = (float)((float)(v200 * v201) * -0.4) + v204;
  this->Source.y = (float)(v202 * -0.4) + v205.n64_f32[1];
  this->Source.z = (float)(v203 * 0.4) + v206.n64_f32[1];
  if ( !this->m_bCollisionChecksOn )
  {
    v222 = CCam::Process_M16_1stPerson(CVector const&,float,float,float)::FailedTestTwelveFramesAgo;
LABEL_256:
    v223 = v222 == 0;
    if ( !v222 )
      v223 = this->Mode == 46;
    if ( v223 )
    {
      v205.n64_u32[0] = 15.0;
      v206.n64_u32[0] = LODWORD(this->FOV);
      RwCameraSetNearClipPlane(
        Scene.camera,
        (float)((float)((float)(15.0 - vmin_f32(v206, v205).n64_f32[0]) * 0.15) + 1.0) * 0.3);
    }
    goto LABEL_261;
  }
  if ( CWorld::GetIsLineOfSightClear(&vecStart, &this->Source, 1, 1, 0, 1, 0, 1, 1) )
  {
    v208 = this->Beta;
    v209 = this->Alpha;
    v210 = this->Source.x;
    v211 = this->Source.y;
    v212 = cosf(v208 + 0.61087);
    v213 = cosf(v209 + -0.34907);
    v214 = sinf(v208 + 0.61087);
    posn.z = (float)(sinf(v209 + -0.34907) * 3.0) + this->Source.z;
    posn.y = (float)((float)(v213 * v214) * 3.0) + v211;
    posn.x = (float)((float)(v212 * v213) * 3.0) + v210;
    if ( CWorld::GetIsLineOfSightClear((const CVector *)&posn, &this->Source, 1, 1, 0, 1, 0, 1, 1) )
    {
      v215 = this->Beta;
      v216 = this->Alpha;
      v217 = this->Source.x;
      v218 = this->Source.y;
      v219 = cosf(v215 + -0.61087);
      v220 = cosf(v216 + -0.34907);
      v221 = sinf(v215 + -0.61087);
      v222 = 0;
      posn.z = (float)(sinf(v216 + -0.34907) * 3.0) + this->Source.z;
      posn.y = (float)((float)(v220 * v221) * 3.0) + v218;
      posn.x = (float)((float)(v219 * v220) * 3.0) + v217;
      p_Front = &this->Front;
      if ( !CWorld::GetIsLineOfSightClear((const CVector *)&posn, &this->Source, 1, 1, 0, 1, 0, 1, 1) )
      {
        RwCameraSetNearClipPlane(Scene.camera, 0.3);
        v222 = 1;
      }
    }
    else
    {
      RwCameraSetNearClipPlane(Scene.camera, 0.3);
      v222 = 1;
      p_Front = &this->Front;
    }
    CCam::Process_M16_1stPerson(CVector const&,float,float,float)::FailedTestTwelveFramesAgo = v222;
    goto LABEL_256;
  }
  RwCameraSetNearClipPlane(Scene.camera, 0.3);
  CCam::Process_M16_1stPerson(CVector const&,float,float,float)::FailedTestTwelveFramesAgo = 1;
LABEL_261:
  v224 = this->Source.y - (float)(this->Front.y * 0.4);
  v225 = this->Source.z - (float)(this->Front.z * 0.4);
  this->Source.x = this->Source.x - (float)(this->Front.x * 0.4);
  this->Source.y = v224;
  this->Source.z = v225;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(p_Front);
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v230, p_Front, &this->Up);
  posn = v230.RwV3d_0;
  CVector::Normalise((CVector *)&posn);
  CrossProduct(&v230, (const CVector *)&posn, p_Front);
  v226 = *(_QWORD *)&v230.x;
  this->Up.z = v230.z;
  *(_QWORD *)&this->Up.x = v226;
  v227 = atan2f(COERCE_FLOAT(LODWORD(this->Front.x) ^ 0x80000000), this->Front.y);
  *(float *)&TheCamera.pTargetEntity[22].m_pLod = v227;
  *(float *)&TheCamera.pTargetEntity[22].numLodChildren = v227;
}
// 3C50A8: variable 'v6' is possibly undefined
// 3C50A8: variable 'v7' is possibly undefined
// 3C5188: variable 'v5' is possibly undefined
// 3C5188: variable 'v8' is possibly undefined
// 3C6474: using guessed type int dword_3C6474[2];

//----- (003C64D0) --------------------------------------------------------
void __fastcall CCam::Process_Rocket(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired,
        int a6)
{
  CEntity *CamTargetEntity; // r2
  _BOOL4 ResetStatics; // r0
  int InputType; // r0
  bool v10; // zf
  float v11; // s2
  float Beta; // r0
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  const CMatrix *m_pMat; // r0
  RwMatrix *v16; // r1
  RwReal v17; // s0
  float v18; // s18
  float v19; // s16
  float v20; // s0
  float v21; // s8
  float v22; // s2
  float v23; // s0
  float x; // s16
  float y; // s18
  float v26; // s2
  float v27; // s0
  float v28; // s8
  float v29; // s4
  float v30; // s6
  float v31; // s8
  float v32; // s0
  float v33; // s4
  float v34; // s0
  float v35; // s16
  float v36; // s2
  int v37; // s2
  float v38; // r8
  float v39; // r9
  float v40; // s0
  __int64 v41; // d16
  float ATanOfXY; // r0
  CPlayerPed *PlayerPed; // r11
  CPlayerPedData *m_pPlayerData; // r10
  CEntity *v45; // r4
  unsigned int v46; // r0
  uint32 v47; // r2
  unsigned int v48; // r0
  int m_nFlags; // r9
  int v50; // r8
  CMatrix *v51; // r0
  CMatrix *v52; // r2
  const CVector *p_tx; // r1
  const CVector *p_m_translate; // r0
  unsigned int IsLineOfSightClear; // r0
  CMatrix *v56; // r0
  CVector *v57; // r3
  uint32 m_FireHSMissilePressedTime; // r0
  uint32 v59; // r1
  unsigned int v60; // r0
  float v61; // s2
  bool v62; // cf
  uint8 v63; // r0
  CVector2D pVecOut; // [sp+18h] [bp-68h] BYREF
  RwV3d_0 posn; // [sp+20h] [bp-60h] BYREF
  CVector v66; // [sp+30h] [bp-50h] BYREF
  CVector v67; // [sp+40h] [bp-40h] BYREF

  CamTargetEntity = this->CamTargetEntity;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 3 )
    goto LABEL_76;
  ResetStatics = this->ResetStatics;
  this->FOV = 70.0;
  if ( ResetStatics )
  {
    InputType = CHID::GetInputType();
    CamTargetEntity = this->CamTargetEntity;
    v10 = InputType == 2;
    if ( InputType == 2 )
      v10 = CamTargetEntity[30].m_pRwObject == 0;
    if ( v10 )
    {
      Beta = this->Beta;
    }
    else
    {
      v11 = *(float *)&CamTargetEntity[22].m_pLod;
      this->Alpha = 0.0;
      Beta = v11 + -1.5708;
      this->Beta = v11 + -1.5708;
    }
    this->ResetStatics = 0;
    this->m_fInitialPlayerOrientation = Beta;
    this->m_bCollisionChecksOn = 1;
  }
  m_pRwObject = CamTargetEntity->m_pRwObject;
  if ( m_pRwObject )
  {
    parent = (char *)m_pRwObject->parent;
    m_pMat = CamTargetEntity->m_pMat;
    v16 = (RwMatrix *)(parent + 16);
    if ( m_pMat )
      CMatrix::UpdateRwMatrix(m_pMat, v16);
    else
      CSimpleTransform::UpdateRwMatrix(&CamTargetEntity->m_transform, v16);
  }
  CEntity::UpdateRwFrame(this->CamTargetEntity);
  CEntity::UpdateRpHAnim(this->CamTargetEntity);
  CPed::GetBonePosition((CPed *)this->CamTargetEntity, &posn, 5u, 1);
  this->Source.z = posn.z;
  v17 = this->Source.z + 0.1;
  *(_QWORD *)&this->Source.x = *(_QWORD *)&posn.x;
  this->Source.z = v17;
  pVecOut.x = 0.0;
  pVecOut.y = 0.0;
  if ( CHID::GetInputType() )
  {
    if ( CHID::GetInputType() == 1 )
    {
      if ( CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1) )
      {
        v18 = -pVecOut.x;
        v19 = -pVecOut.y;
      }
      else
      {
        v19 = 0.0;
        v18 = 0.0;
      }
      if ( CTouchInterface::IsTouched(WIDGET_PED_MOVE, &pVecOut, 1) )
      {
        v19 = -pVecOut.y;
        v18 = -pVecOut.x;
      }
      v28 = -v19;
      if ( !MobileSettings::settings[15].value )
        v28 = v19;
      v29 = this->FOV / 80.0;
      v22 = CTimer::ms_fTimeStep
          * (float)(v29
                  * (float)(v28
                          * (float)((float)((float)((float)MobileSettings::settings[26].value / 100.0) * 0.0003) + 0.0002)));
      v23 = CTimer::ms_fTimeStep
          * (float)(v29
                  * (float)(v18
                          * (float)((float)((float)((float)MobileSettings::settings[25].value / 100.0) * 0.0004) + 0.0002)));
      goto LABEL_35;
    }
    if ( CHID::GetInputType() == 2 )
    {
      CPad::GetPad(0);
      x = CPad::NewMouseControllerState.m_AmountMoved.x;
      y = CPad::NewMouseControllerState.m_AmountMoved.y;
      if ( CTouchInterface::IsTouched(WIDGET_PED_MOVE, &pVecOut, 1) )
      {
        v26 = pVecOut.x * -0.075;
        v27 = pVecOut.y * -0.075;
      }
      else
      {
        v27 = -y;
        v26 = -x;
      }
      v30 = -v27;
      v31 = this->FOV / 80.0;
      if ( !MobileSettings::settings[15].value )
        v30 = v27;
      v32 = (float)((float)MobileSettings::settings[32].value / 100.0) * 0.0075 + 0.000500000024;
      v33 = v30 * v32;
      v23 = v31
          * (float)(v26 * (float)((float)((float)((float)MobileSettings::settings[31].value / 100.0) * 0.01) + 0.0005));
      v22 = v31 * v33;
      goto LABEL_35;
    }
LABEL_24:
    v22 = 0.0;
    v23 = 0.0;
    goto LABEL_35;
  }
  if ( !CTouchInterface::IsTouched(WIDGET_LOOK, &pVecOut, 1) )
    goto LABEL_24;
  v20 = this->FOV / 80.0;
  v21 = -(float)(pVecOut.y * -0.0007);
  if ( !MobileSettings::settings[15].value )
    v21 = pVecOut.y * -0.0007;
  v22 = CTimer::ms_fTimeStep * (float)(v21 * v20);
  v23 = CTimer::ms_fTimeStep * (float)((float)(pVecOut.x * -0.001) * v20);
LABEL_35:
  v34 = v23 + this->Beta;
  v35 = v22 + this->Alpha;
  this->Beta = v34;
  this->Alpha = v35;
  if ( v34 > 3.1416 )
  {
    v36 = -6.2832;
LABEL_39:
    v34 = v34 + v36;
    this->Beta = v34;
    goto LABEL_40;
  }
  if ( v34 < -3.1416 )
  {
    v36 = 6.2832;
    goto LABEL_39;
  }
LABEL_40:
  *(float *)&v37 = 1.0472;
  if ( v35 > 1.0472 || (*(float *)&v37 = -1.5621, v35 < -1.5621) )
  {
    v35 = *(float *)&v37;
    this->Alpha = *(float *)&v37;
  }
  v38 = cosf(v34);
  v39 = cosf(v35);
  v40 = sinf(v34);
  this->Front.z = sinf(v35);
  this->Front.x = -(float)(v38 * v39);
  this->Front.y = -(float)(v39 * v40);
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(&this->Front);
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v66, &this->Front, &this->Up);
  v67 = v66;
  CVector::Normalise(&v67);
  CrossProduct(&v66, &v67, &this->Front);
  v41 = *(_QWORD *)&v66.x;
  this->Up.z = v66.z;
  *(_QWORD *)&this->Up.x = v41;
  ATanOfXY = CGeneral::GetATanOfXY(this->Front.x, this->Front.y);
  *(float *)&TheCamera.pTargetEntity[22].m_pLod = ATanOfXY + -1.5708;
  *(float *)&TheCamera.pTargetEntity[22].numLodChildren = ATanOfXY + -1.5708;
  if ( a6 == 1 )
  {
    PlayerPed = FindPlayerPed(-1);
    m_pPlayerData = PlayerPed->m_pPlayerData;
    if ( !m_pPlayerData->m_FireHSMissilePressedTime )
      m_pPlayerData->m_FireHSMissilePressedTime = CTimer::m_snTimeInMilliseconds;
    v45 = CWeapon::PickTargetForHeatSeekingMissile(
            this->Source,
            this->Front,
            1.2,
            PlayerPed,
            0,
            m_pPlayerData->m_LastHSMissileTarget);
    if ( v45 )
    {
      v46 = *((_DWORD *)m_pPlayerData + 40);
      v47 = CTimer::m_snTimeInMilliseconds;
      if ( (v46 & 0x7FFFFFFF) == 0 )
        v47 = CTimer::m_snTimeInMilliseconds - 1;
      if ( v47 > 0x3E8 )
      {
        v48 = v46 & 0x80000000;
        if ( CTimer::m_snTimeInMilliseconds > 1 )
          v48 |= 1u;
        *((_DWORD *)m_pPlayerData + 40) = v48;
        m_nFlags = (int)PlayerPed->m_nFlags;
        v50 = (int)v45->m_nFlags;
        *(_DWORD *)&PlayerPed->m_nFlags = m_nFlags & 0xFFFFFFFE;
        v51 = v45->m_pMat;
        *(_DWORD *)&v45->m_nFlags &= ~1u;
        v52 = PlayerPed->m_pMat;
        p_tx = (const CVector *)&v51->tx;
        if ( !v51 )
          p_tx = &v45->m_transform.m_translate;
        p_m_translate = (const CVector *)&v52->tx;
        if ( !v52 )
          p_m_translate = &PlayerPed->m_transform.m_translate;
        IsLineOfSightClear = CWorld::GetIsLineOfSightClear(p_m_translate, p_tx, 1, 1, 0, 1, 0, 1, 0);
        *(_DWORD *)&PlayerPed->m_nFlags = *(_DWORD *)&PlayerPed->m_nFlags & 0xFFFFFFFE | m_nFlags & 1;
        *(_DWORD *)&v45->m_nFlags = *(_DWORD *)&v45->m_nFlags & 0xFFFFFFFE | v50 & 1;
        *((_DWORD *)m_pPlayerData + 40) = *((_DWORD *)m_pPlayerData + 40) & 0x7FFFFFFF | (IsLineOfSightClear << 31);
        goto LABEL_62;
      }
    }
    else
    {
      v46 = *((_DWORD *)m_pPlayerData + 40);
    }
    IsLineOfSightClear = v46 >> 31;
LABEL_62:
    if ( !IsLineOfSightClear )
      v45 = 0;
    if ( v45 )
    {
      if ( v45 != m_pPlayerData->m_LastHSMissileTarget )
        m_pPlayerData->m_FireHSMissilePressedTime = CTimer::m_snTimeInMilliseconds;
      v56 = v45->m_pMat;
      v57 = (CVector *)&v56->tx;
      if ( !v56 )
        v57 = &v45->m_transform.m_translate;
      CWeaponEffects::MarkTarget(0, *v57, 0xFFu, 0xFFu, 0xFFu, 0x64u, 1.3, 1u);
      m_FireHSMissilePressedTime = m_pPlayerData->m_FireHSMissilePressedTime;
      v59 = CTimer::m_snTimeInMilliseconds;
    }
    else
    {
      m_FireHSMissilePressedTime = CTimer::m_snTimeInMilliseconds;
      m_pPlayerData->m_FireHSMissilePressedTime = CTimer::m_snTimeInMilliseconds;
      v59 = m_FireHSMissilePressedTime;
    }
    v60 = v59 - m_FireHSMissilePressedTime;
    v61 = 0.0;
    if ( v60 > 0x5DC )
      v61 = 1.0;
    v62 = v60 >= 0x5DD;
    v63 = 0;
    if ( !v62 )
      v63 = -1;
    gCrossHair[0].m_green = v63;
    gCrossHair[0].m_red = -1;
    gCrossHair[0].m_blue = v63;
    gCrossHair[0].clearTargetTimer = 0;
    gCrossHair[0].m_bLockedOn = v61;
    m_pPlayerData->m_LastHSMissileTarget = v45;
  }
LABEL_76:
  RwCameraSetNearClipPlane(Scene.camera, 0.15);
}
// 14: using guessed type int dword_14;
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003C6B88) --------------------------------------------------------
void __fastcall CCam::Process_AimWeapon(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d2
  float32x2_t v8; // d3
  float32x2_t v9; // d5
  float32x2_t v10; // d10
  float32x2_t v11; // d11
  char v14; // r0
  CEntity *CamTargetEntity; // r0
  CEntity *v16; // r9
  CWeaponInfo *m_pWeaponInfo; // r11
  int IsTypeMelee; // r0
  CLink<CEntity *> *m_pLastRenderedLink; // r0
  CEntity *item; // r1
  bool v21; // zf
  int v22; // r0
  bool v23; // zf
  float FOV; // s4
  float v25; // s18
  float v26; // s20
  float v27; // s16
  unsigned __int64 v28; // d13
  float v29; // s18
  float v30; // s20
  float v31; // s16
  RwObject_0 *v32; // r0
  float v33; // s0
  CMatrix *v34; // r1
  float *p_tx; // r2
  float v36; // s8
  RwReal v37; // s2
  char *v38; // r1
  float v39; // s0
  float v40; // s2
  float *v41; // r2
  RwReal v42; // s0
  RwReal v43; // s4
  _BOOL4 ResetStatics; // r4
  float v45; // s0
  CTaskSimpleDuck *TaskDuck; // r0
  float v47; // s4
  float v48; // s0
  float *v49; // r1
  int InputType; // r0
  bool v51; // zf
  float v52; // r0
  int v53; // r1
  bool v54; // zf
  float v55; // s0
  float v56; // s0
  float v57; // s2
  bool v58; // cc
  float Beta; // s2
  float v60; // s6
  float v61; // s4
  __int64 v62; // d16
  float z; // s28
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r2
  float *v66; // r8
  float v67; // s30
  float v68; // s17
  float x; // s19
  float y; // s25
  float32x2_t v71; // d0
  CPad *Pad; // r6
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  void **p_parent; // r2
  __int64 v76; // d16
  float v77; // s0
  float v78; // s2
  float v79; // s28
  CPad *v80; // r0
  CPad *v81; // r0
  float v82; // r6
  CPad *v83; // r0
  float v84; // s30
  float v85; // s17
  float v86; // s2
  float v87; // s0
  float v88; // s6
  float v89; // s26
  float v90; // s4
  float v91; // r0
  float v92; // s17
  float v93; // s25
  float v94; // s30
  float v95; // s19
  float v96; // s27
  float v97; // s29
  float v98; // s28
  float v99; // s30
  float v100; // s2
  float v101; // s0
  float v102; // s4
  float v103; // s28
  float Alpha; // s4
  float v105; // s2
  float v106; // s6
  float v107; // s4
  float v108; // s0
  float *p_Beta; // r6
  float v110; // s28
  int v111; // s8
  float v112; // s6
  int v113; // s4
  float v114; // r0
  float v115; // s2
  float v116; // s28
  float v117; // s26
  CLink<CEntity *> *v118; // r0
  bool v119; // zf
  CLink<CEntity *> *v120; // r0
  int v121; // r0
  int v122; // r2
  signed int v123; // r1
  CPad *v124; // r0
  float v125; // s26
  int Mode; // r0
  float v127; // s24
  bool v128; // zf
  float v129; // s6
  float v130; // s10
  double v131; // d16
  float v132; // s0
  float v133; // s2
  float v134; // s4
  float v135; // s8
  float v136; // s2
  float v137; // s2
  float v138; // s0
  float v139; // s4
  CPad *v140; // r0
  float v141; // s28
  float *p_m_pLod; // r0
  CMatrix *v143; // r0
  RwObject_0 *v144; // r0
  char *v145; // r1
  const CMatrix *v146; // r0
  RwMatrix *v147; // r1
  float v148; // s2
  float v149; // s30
  float v150; // s24
  bool v151; // zf
  int v152; // r0
  float v153; // s0
  float v154; // s4
  float v155; // s2
  bool v156; // nf
  float v157; // s2
  bool v158; // zf
  int v159; // r0
  float v160; // s0
  float v161; // s0
  float32x2_t v162; // d0
  float v163; // s30
  CWeaponInfo *v164; // r4
  float v165; // s17
  float v166; // r6
  float v167; // s28
  float v168; // r8
  float v169; // r11
  float v170; // s0
  float v171; // r0
  float v172; // s26
  RwReal v173; // s2
  RwReal v174; // s0
  CTaskSimpleDuck *v175; // r0
  char *p_m_heading; // r10
  CWeaponInfo *v177; // r8
  CVector *p_Front; // r11
  int *v179; // r1
  RwReal v180; // r0
  int v181; // r0
  SCamColVars *v182; // r0
  CTaskSimpleHoldEntity *TaskHold; // r0
  bool v184; // zf
  int32 v185; // r2
  bool v186; // zf
  CEntity *v187; // r0
  int32 v188; // r2
  float v189; // s0
  RwReal v190; // s2
  RwReal v191; // s4
  RwReal v192; // s0
  __int64 v193; // d16
  float v194; // s0
  RwObject_0 *v195; // r0
  CMatrix *v196; // r1
  char *v197; // r2
  float *p_x; // r3
  float *v199; // r1
  CMatrix *v200; // r0
  RwObject_0 *v201; // r0
  char *v202; // r1
  const CMatrix *v203; // r0
  RwMatrix *v204; // r1
  float *v205; // r5
  float v206; // s16
  float v207; // s0
  float v208; // s16
  float v209; // s0
  int v210; // r0
  float v211; // s2
  float v212; // s0
  float v213; // s4
  float v214; // s2
  float v215; // s2
  CSimpleTransform *v216; // [sp+14h] [bp-B4h]
  CVector *p_Up; // [sp+1Ch] [bp-ACh]
  bool *p_ResetStatics; // [sp+24h] [bp-A4h]
  int v219; // [sp+28h] [bp-A0h]
  CVector v2; // [sp+2Ch] [bp-9Ch] BYREF
  CVector v1; // [sp+38h] [bp-90h] BYREF
  CVector v222; // [sp+48h] [bp-80h] BYREF
  CVector vecStart; // [sp+58h] [bp-70h] BYREF

  v14 = `guard variable for'CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos;
  __dmb(0xBu);
  if ( (v14 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos) )
  {
    CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.x = 0.0;
    CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.y = 0.0;
    CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.z = 0.0;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos);
  }
  CamTargetEntity = this->CamTargetEntity;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) == 3 && CPed::IsPlayer((const CPed *)CamTargetEntity) )
  {
    v16 = this->CamTargetEntity;
    if ( CPedIntelligence::GetTaskUseGun((const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y)) )
      m_pWeaponInfo = CPedIntelligence::GetTaskUseGun((const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y))->m_pWeaponInfo;
    else
      m_pWeaponInfo = CWeaponInfo::GetWeaponInfo(
                        *((eWeaponType *)&v16[24].m_transform.m_translate.x + 7 * SLOBYTE(v16[30].m_pMat)),
                        1);
    if ( BYTE1(v16[19].m_transform.m_heading) << 31 )
    {
      m_pLastRenderedLink = v16[23].m_pLastRenderedLink;
      if ( !m_pLastRenderedLink )
        goto LABEL_20;
      item = m_pLastRenderedLink[120].item;
      v21 = item == (CEntity *)byte_9;
      if ( item != (CEntity *)byte_9 )
        v21 = m_pLastRenderedLink[120].m_pPrev == (CLink<CEntity *> *)((char *)&dword_0 + 2);
      if ( !v21 )
      {
LABEL_20:
        IsTypeMelee = 2;
        goto LABEL_21;
      }
    }
    else if ( !CPedIntelligence::GetTaskJetPack((const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y)) )
    {
      IsTypeMelee = CWeapon::IsTypeMelee((const CWeapon *)&v16[24].m_transform + SLOBYTE(v16[30].m_pMat));
      if ( IsTypeMelee )
        IsTypeMelee = 3;
LABEL_21:
      v219 = IsTypeMelee;
      v22 = *((_DWORD *)&v16[24].m_transform.m_translate.x + 7 * SLOBYTE(v16[30].m_pMat));
      if ( (v22 & 0xFFFFFFFE) == 30 )
      {
        v5.n64_f32[0] = AIMWEAPON_RIFLE1_ZOOM;
      }
      else
      {
        v5.n64_u32[0] = 1116471296;
        if ( v22 == 33 )
          v5.n64_f32[0] = AIMWEAPON_RIFLE2_ZOOM;
      }
      if ( !TheCamera.m_uiTransitionState )
      {
        v23 = !this->ResetStatics;
        if ( this->ResetStatics )
          v23 = v22 == 33;
        if ( v23 )
        {
          FOV = this->FOV;
          v6.n64_f32[0] = CTimer::ms_fTimeStep + FOV;
          if ( v5.n64_f32[0] <= (float)(CTimer::ms_fTimeStep + FOV) )
          {
            v6.n64_f32[0] = FOV - CTimer::ms_fTimeStep;
            v6.n64_u64[0] = vmax_f32(v5, v6).n64_u64[0];
          }
          LODWORD(this->FOV) = v6.n64_u32[0];
        }
        else
        {
          LODWORD(this->FOV) = v5.n64_u32[0];
        }
      }
      if ( m_pWeaponInfo->m_eFireType )
      {
        v25 = (float)(CCamera::m_f3rdPersonCHairMultX + -0.5) + (float)(CCamera::m_f3rdPersonCHairMultX + -0.5);
        v26 = tanf((float)((float)(this->FOV * 0.5) * 3.1416) / 180.0);
        v27 = atanf(v26 * v25);
        LODWORD(v28) = atanf(
                         v26
                       * (float)((float)((float)(0.5 - CCamera::m_f3rdPersonCHairMultY)
                                       + (float)(0.5 - CCamera::m_f3rdPersonCHairMultY))
                               * (float)(1.0 / CDraw::ms_fAspectRatio)));
        CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_TOWARD_TARGET = 0.0;
        p_ResetStatics = &this->ResetStatics;
        if ( !this->ResetStatics )
          goto LABEL_83;
LABEL_57:
        TheCamera.m_duckZMod = 0.0;
        TheCamera.m_duckZMod_Aim = 0.0;
        TaskDuck = CPedIntelligence::GetTaskDuck(
                     (const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y),
                     1);
        if ( TaskDuck && (HIBYTE(v16[19].m_transform.m_heading) & 4) != 0 && !TaskDuck->m_bIsAborting )
        {
          v47 = *(float *)&v16[1].m_pMat * *(float *)&v16[1].m_pMat;
          v48 = (float)(v16[1].m_transform.m_translate.z * v16[1].m_transform.m_translate.z)
              + (float)(v16[1].m_transform.m_heading * v16[1].m_transform.m_heading);
          TheCamera.m_duckZMod_Aim = -0.35;
          v49 = (float *)&dword_3C7B70;
          if ( (float)(v48 + v47) > 0.000001 )
            v49 = (float *)&loc_3C7B74;
          TheCamera.m_duckZMod = *v49;
        }
        this->m_bCollisionChecksOn = 1;
        this->Rotating = 0;
        ACQUIRED_FREEAIM_PEDHEADING = -1001.0;
        ACQUIRED_FREEAIM_INCAR_IDLE_COUNTER = 60000;
        ACQUIRED_FREEAIM_DIRECTION = 1;
        this->BetaSpeed = 0.0;
        this->AlphaSpeed = 0.0;
        InputType = CHID::GetInputType();
        v51 = InputType == 2;
        if ( InputType == 2 )
          v51 = v16[30].m_pRwObject == 0;
        if ( !v51 )
        {
          v52 = AIMWEAPON_SETTINGS[v219][3];
          this->Alpha = v52;
          v53 = BYTE1(v16[19].m_transform.m_heading);
          v54 = v53 << 31 == 0;
          if ( v53 << 31 )
            v54 = v16[23].m_pLastRenderedLink == 0;
          if ( !v54 )
          {
            this->Beta = (float)(*(float *)&v16[22].m_pLod + -1.5708) - v27;
            v56 = 1.0;
            v57 = *(float *)&v16[23].m_pLastRenderedLink[1].m_pNext[2].item;
            v58 = v57 < 1.0;
            if ( v57 <= 1.0 )
              v58 = v57 < -1.0;
            if ( v58 )
            {
              v56 = -1.0;
            }
            else if ( v57 <= 1.0 )
            {
              v56 = *(float *)&v16[23].m_pLastRenderedLink[1].m_pNext[2].item;
            }
            v55 = asinf(v56) + v52;
            goto LABEL_82;
          }
          if ( !v16[30].m_pRwObject )
          {
            this->Beta = v27 + (float)(*(float *)&v16[22].m_pLod + -1.5708);
            if ( LOBYTE(v16[19].m_transform.m_heading) << 31 )
            {
              v6.n64_u32[0] = -1.0;
              v5.n64_f32[0] = (float)((float)(*(float *)&v16[23].m_pRwObject * v16->m_pMat->xy)
                                    + (float)(*(float *)&v16[23].m_nFlags * v16->m_pMat->yy))
                            + (float)(*(float *)&v16[23].m_nFlags.bdummy * v16->m_pMat->zy);
              v7.n64_u32[0] = 1.0;
              v5.n64_u64[0] = vmin_f32(vmax_f32(v5, v6), v7).n64_u64[0];
              v5.n64_f32[0] = v52 - asinf(v5.n64_f32[0]);
              this->Alpha = v5.n64_f32[0];
              if ( *((_DWORD *)&v16[24].m_transform.m_translate.x + 7 * SLOBYTE(v16[30].m_pMat)) == 42 )
              {
                v55 = v5.n64_f32[0] + CWeapon::ms_fExtinguisherAimAngle;
LABEL_82:
                this->Alpha = v55;
              }
            }
          }
        }
LABEL_83:
        if ( CTheScripts::fCameraHeadingStepWhenPlayerIsAttached > 0.0 )
        {
          Beta = this->Beta;
          v60 = Beta - CTheScripts::fCameraHeadingWhenPlayerIsAttached;
          if ( (float)(Beta - CTheScripts::fCameraHeadingWhenPlayerIsAttached) < 0.0 )
            v60 = (float)(Beta - CTheScripts::fCameraHeadingWhenPlayerIsAttached) + 6.2832;
          if ( v60 >= CTheScripts::fCameraHeadingStepWhenPlayerIsAttached )
          {
            v61 = -CTheScripts::fCameraHeadingStepWhenPlayerIsAttached;
            if ( v60 > (float)(6.2832 - v60) )
              v61 = CTheScripts::fCameraHeadingStepWhenPlayerIsAttached;
            this->Beta = Beta + v61;
          }
          else
          {
            this->Beta = CTheScripts::fCameraHeadingWhenPlayerIsAttached;
            CTheScripts::fCameraHeadingStepWhenPlayerIsAttached = 0.0;
          }
        }
        v62 = *(_QWORD *)&ThisCamsTarget->x;
        v1.z = ThisCamsTarget->z;
        z = v1.z;
        *(_QWORD *)&v1.x = v62;
        CEntity::UpdateRpHAnim(v16);
        m_pMat = v16->m_pMat;
        p_m_transform = &v16->m_transform;
        v216 = &v16->m_transform;
        if ( m_pMat )
          p_m_transform = (CSimpleTransform *)&m_pMat->tx;
        v66 = AIMWEAPON_SETTINGS[v219];
        v67 = (float)(p_m_transform->m_translate.z + 0.5) + v66[4];
        v5.n64_u32[0] = LODWORD(this->FOV);
        if ( v5.n64_f32[0] < 70.0 )
        {
          v8.n64_u32[0] = 1.0;
          v6.n64_f32[0] = (float)(70.0 - v5.n64_f32[0]) / (float)(70.0 - AIMWEAPON_RIFLE1_ZOOM);
          v6.n64_u64[0] = vmin_f32(v6, v8).n64_u64[0];
          v67 = v67 + (float)(v6.n64_f32[0] * 0.1);
        }
        v1.z = v67;
        if ( (m_pWeaponInfo->m_nFlags & 2) == 0 )
        {
          if ( CPedClothesDesc::HasVisibleNewHairCut(
                 *(CPedClothesDesc **)(LODWORD(v16[18].m_transform.m_translate.z) + 4),
                 1) )
          {
            v68 = 0.3;
            goto LABEL_102;
          }
          v5.n64_u32[0] = LODWORD(this->FOV);
        }
        if ( v5.n64_f32[0] >= 70.0 )
        {
          v68 = 0.2;
        }
        else
        {
          v7.n64_u32[0] = 1.0;
          v5.n64_f32[0] = (float)(70.0 - v5.n64_f32[0]) / (float)(70.0 - AIMWEAPON_RIFLE2_ZOOM);
          v5.n64_u64[0] = vmin_f32(v5, v7).n64_u64[0];
          v68 = (float)(v5.n64_f32[0] * 0.1) + 0.2;
        }
LABEL_102:
        p_Up = &this->Up;
        CrossProduct(&vecStart, &this->Front, &this->Up);
        v10.n64_u32[0] = 1.0;
        x = vecStart.x;
        y = vecStart.y;
        HIDWORD(v28) = LODWORD(vecStart.z);
        v11.n64_u32[0] = 0;
        v5.n64_f32[0] = (float)((float)(vecStart.x * v16->m_pMat->xx) + (float)(vecStart.y * v16->m_pMat->yx))
                      + (float)(vecStart.z * v16->m_pMat->zx);
        v71.n64_u64[0] = vmax_f32(vmin_f32(v5, v10), v11).n64_u64[0];
        v71.n64_f32[0] = v68 * (float)((float)(acosf(v71.n64_f32[0]) / -1.5708) + 1.0);
        v1.x = v1.x + (float)(x * v71.n64_f32[0]);
        v1.y = v1.y + (float)(y * v71.n64_f32[0]);
        v1.z = (float)(*((float *)&v28 + 1) * v71.n64_f32[0]) + v1.z;
        if ( v16[30].m_pRwObject )
        {
          CTouchInterface::IsTouched(WIDGET_LOOK, 0, 1);
          Pad = CPad::GetPad(0);
          if ( Pad && CPed::IsPlayer((const CPed *)v16) )
          {
            if ( CPad::ShiftTargetLeftJustDown(Pad) )
              CPlayerPed::FindNextWeaponLockOnTarget((CPlayerPed *)v16, (CEntity *)v16[30].m_pRwObject, 1);
            if ( CPad::ShiftTargetRightJustDown(Pad) )
              CPlayerPed::FindNextWeaponLockOnTarget((CPlayerPed *)v16, (CEntity *)v16[30].m_pRwObject, 0);
          }
          memset(&vecStart, 0, sizeof(vecStart));
          m_pRwObject = v16[30].m_pRwObject;
          if ( (m_pRwObject[7].flags & 7) == 3 && m_pWeaponInfo->m_eFireType )
          {
            CPed::GetBonePosition((CPed *)m_pRwObject, &vecStart, 3u, 1);
          }
          else
          {
            parent = (char *)m_pRwObject[2].parent;
            p_parent = (void **)(parent + 48);
            if ( !parent )
              p_parent = &m_pRwObject->parent;
            v76 = *(_QWORD *)p_parent;
            LODWORD(vecStart.z) = p_parent[2];
            *(_QWORD *)&vecStart.x = v76;
          }
          if ( m_pWeaponInfo->m_eFireType == FIRETYPE_MELEE )
            vecStart.z = (float)((float)(v67 - z) * 0.75) + vecStart.z;
          if ( *p_ResetStatics
            || !CPedIntelligence::GetTaskFighting((const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y)) )
          {
            CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos = vecStart;
            v78 = vecStart.y;
            v77 = vecStart.x;
            v79 = vecStart.z;
          }
          else
          {
            v91 = powf(PLAYERFIGHT_LEVEL_SMOOTHING_CONST, CTimer::ms_fTimeStep);
            v77 = (float)(v91 * CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.x)
                + (float)((float)(1.0 - v91) * vecStart.x);
            v79 = (float)(v91 * CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.z)
                + (float)((float)(1.0 - v91) * vecStart.z);
            v78 = (float)(v91 * CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.y)
                + (float)((float)(1.0 - v91) * vecStart.y);
            CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.x = v77;
            CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.y = v78;
            CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.z = v79;
          }
          v92 = v1.x;
          v93 = v1.y;
          v94 = v77 - v1.x;
          v95 = v1.z;
          v96 = v78 - v1.y;
          v97 = v79 - v1.z;
          v98 = atan2f(-(float)(v77 - v1.x), v78 - v1.y);
          *((float *)&v28 + 1) = (float)(v94 * v94) + (float)(v96 * v96);
          v99 = atan2f(v97, sqrtf(*((float *)&v28 + 1)));
          if ( m_pWeaponInfo->m_eFireType )
          {
            v7.n64_f32[0] = *v66;
            v71.n64_f32[0] = sqrtf(
                               (float)((float)((float)(v92 - this->Source.x) * (float)(v92 - this->Source.x))
                                     + (float)((float)(v93 - this->Source.y) * (float)(v93 - this->Source.y)))
                             + (float)((float)(v95 - this->Source.z) * (float)(v95 - this->Source.z)));
            v100 = sqrtf(*((float *)&v28 + 1) + (float)(v97 * v97));
            v101 = (float)(v100 + vmin_f32(v71, v7).n64_f32[0]) / v100;
            v27 = v27 * v101;
            *(float *)&v28 = *(float *)&v28 * v101;
          }
          else
          {
            v99 = v99 * cosf(v27);
          }
          *(float *)&v28 = v99 - *(float *)&v28;
          if ( *(float *)&v28 >= -3.1416 )
          {
            if ( *(float *)&v28 <= 3.1416 )
              goto LABEL_140;
            v102 = -6.2832;
          }
          else
          {
            v102 = 6.2832;
          }
          *(float *)&v28 = *(float *)&v28 + v102;
LABEL_140:
          v103 = (float)(v98 + -1.5708) + v27;
          Alpha = this->Alpha;
          v105 = CTimer::ms_fTimeStep * 0.033;
          if ( fabsf(*(float *)&v28 - Alpha) >= (float)(CTimer::ms_fTimeStep * 0.033) )
          {
            v106 = CTimer::ms_fTimeStep * 0.033;
            if ( (float)(*(float *)&v28 - Alpha) < 0.0 )
              v106 = -v105;
            *(float *)&v28 = Alpha + v106;
          }
          v107 = this->Beta;
          LODWORD(this->Alpha) = v28;
          if ( (float)(v103 - v107) <= 3.1416 )
          {
            if ( (float)(v103 - v107) >= -3.1416 )
            {
LABEL_149:
              p_Beta = &this->Beta;
              if ( fabsf(v103 - v107) >= v105 )
              {
                if ( (float)(v103 - v107) < 0.0 )
                  v105 = -v105;
                v103 = v107 + v105;
              }
              this->AlphaSpeed = 0.0;
              this->Beta = v103;
              this->BetaSpeed = 0.0;
LABEL_242:
              if ( v103 <= 3.1416 )
              {
                if ( v103 >= -3.1416 )
                {
LABEL_247:
                  v161 = AIMWEAPON_SETTINGS[v219][5];
                  if ( *(float *)&v28 > v161 || (v161 = -AIMWEAPON_SETTINGS[v219][6], *(float *)&v28 < v161) )
                  {
                    *(float *)&v28 = v161;
                    this->Alpha = v161;
                  }
                  v162.n64_u64[0] = v28;
                  v163 = *v66;
                  v164 = m_pWeaponInfo;
                  if ( *(float *)&v28 > 0.0 )
                  {
                    v6.n64_u32[0] = 1070141403;
                    v162.n64_f32[0] = *(float *)&v28 * AIMWEAPON_SETTINGS[v219][2];
                    v162.n64_u32[0] = vmin_f32(v162, v6).n64_u32[0];
                  }
                  v166 = v103;
                  v165 = AIMWEAPON_SETTINGS[v219][1];
                  v167 = v165 * cosf(v162.n64_f32[0]);
                  v168 = cosf(v166);
                  v169 = cosf(*(float *)&v28);
                  v170 = sinf(v166);
                  v171 = sinf(*(float *)&v28);
                  this->Front.z = v171;
                  this->Front.x = -(float)(v168 * v169);
                  this->Front.y = -(float)(v169 * v170);
                  v172 = v1.z;
                  v173 = v1.y + (float)((float)(v163 + v167) * (float)(v169 * v170));
                  v174 = v1.z - (float)((float)(v163 + v167) * v171);
                  this->Source.x = v1.x + (float)((float)(v163 + v167) * (float)(v168 * v169));
                  this->Source.y = v173;
                  this->Source.z = v174;
                  CPedIntelligence::GetTaskDuck((const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y), 1);
                  v175 = CPedIntelligence::GetTaskDuck(
                           (const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y),
                           1);
                  if ( v175 )
                  {
                    p_m_heading = (char *)&v16[19].m_transform.m_heading;
                    v177 = v164;
                    p_Front = &this->Front;
                    if ( (HIBYTE(v16[19].m_transform.m_heading) & 4) != 0 )
                    {
                      v179 = &dword_3C86FC;
                      if ( !v175->m_bIsAborting )
                        v179 = &dword_3C8700;
                      v11.n64_u32[0] = *v179;
                    }
                  }
                  else
                  {
                    v177 = v164;
                    p_m_heading = (char *)&v16[19].m_transform.m_heading;
                    p_Front = &this->Front;
                  }
                  TheCamera.m_duckZMod_Aim = TheCamera.m_duckZMod_Aim
                                           + (float)((float)(v11.n64_f32[0] - TheCamera.m_duckZMod_Aim)
                                                   * (float)(CTimer::ms_fTimeStep * 0.13));
                  this->Source.z = this->Source.z + TheCamera.m_duckZMod_Aim;
                  v1.z = TheCamera.m_duckZMod_Aim + v172;
                  v180 = TheCamera.m_duckZMod_Aim + v172;
                  *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = *(_QWORD *)&v1.x;
                  this->m_cvecTargetCoorsForFudgeInter.z = v180;
                  v181 = v219 & 3;
                  switch ( v181 )
                  {
                    case 1:
                      if ( gCurCamColVars == 1 )
                        goto LABEL_270;
                      gCurCamColVars = 1;
                      gCurDistForCam = 1.0;
                      v182 = &gCamColVars[1];
                      break;
                    case 2:
                      if ( gCurCamColVars == 2 )
                        goto LABEL_270;
                      gCurCamColVars = 2;
                      gCurDistForCam = 1.0;
                      v182 = &gCamColVars[2];
                      break;
                    case 3:
                      if ( gCurCamColVars == 3 )
                        goto LABEL_270;
                      gCurCamColVars = 3;
                      gCurDistForCam = 1.0;
                      v182 = &gCamColVars[3];
                      break;
                    default:
                      if ( gCurCamColVars )
                      {
                        gCurCamColVars = 0;
                        gCurDistForCam = 1.0;
                        gpCamColVars = gCamColVars;
                      }
LABEL_270:
                      if ( DirectionIsLooking == 3 )
                      {
                        TheCamera.m_numExtrasEntitysToIgnore = 0;
                        TaskHold = CPedIntelligence::GetTaskHold(
                                     (const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y),
                                     0);
                        v184 = TaskHold == 0;
                        if ( TaskHold )
                        {
                          TaskHold = (CTaskSimpleHoldEntity *)TaskHold->m_pHoldEntity;
                          v184 = TaskHold == 0;
                        }
                        if ( !v184 )
                        {
                          v185 = TheCamera.m_numExtrasEntitysToIgnore++;
                          TheCamera.m_pExtrasEntitysToIgnore[v185] = (CEntity *)TaskHold;
                        }
                        CCollision::bCamCollideWithObjects = 1;
                        CCollision::bCamCollideWithVehicles = 1;
                        CCollision::bCamCollideWithPeds = 1;
                        v187 = (CEntity *)((unsigned __int8)p_m_heading[1] << 31);
                        v186 = v187 == 0;
                        if ( v187 )
                        {
                          v187 = (CEntity *)v16[23].m_pLastRenderedLink;
                          v186 = v187 == 0;
                        }
                        if ( !v186 )
                        {
                          v188 = TheCamera.m_numExtrasEntitysToIgnore++;
                          TheCamera.m_pExtrasEntitysToIgnore[v188] = v187;
                        }
                        CCamera::CameraColDetAndReact((CCamera *)v187, &this->Source, &v1);
                        CCamera::ImproveNearClip(&TheCamera, 0, (CPed *)v16, &this->Source, (int)&v1);
                      }
                      *(_WORD *)&TheCamera.m_bCamDirectlyBehind = 0;
                      if ( CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_TOWARD_TARGET > 0.0
                        && v16[30].m_pRwObject )
                      {
                        v189 = CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_TOWARD_TARGET * 0.5;
                        v190 = (float)((float)((float)(1.0 - v189) * v1.x)
                                     + (float)(v189
                                             * CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.x))
                             - this->Source.x;
                        v191 = (float)((float)((float)(1.0
                                                     - (float)(CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_TOWARD_TARGET
                                                             * 0.5))
                                             * v1.y)
                                     + (float)((float)(CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_TOWARD_TARGET
                                                     * 0.5)
                                             * CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.y))
                             - this->Source.y;
                        v192 = (float)((float)((float)(1.0 - v189) * v1.z)
                                     + (float)(v189
                                             * CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos.z))
                             - this->Source.z;
                        this->Front.x = v190;
                        this->Front.y = v191;
                        this->Front.z = v192;
                        CVector::Normalise(p_Front);
                      }
                      this->Up.x = 0.0;
                      this->Up.y = 0.0;
                      this->Up.z = 1.0;
                      CVector::Normalise(p_Front);
                      if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
                      {
                        this->Front.x = 0.0001;
                        this->Front.y = 0.0001;
                      }
                      CrossProduct(&v222, p_Front, p_Up);
                      vecStart = v222;
                      CVector::Normalise(&vecStart);
                      CrossProduct(&v222, &vecStart, p_Front);
                      v193 = *(_QWORD *)&v222.x;
                      this->Up.z = v222.z;
                      *(_QWORD *)&p_Up->x = v193;
                      if ( (v177->m_nFlags & 2) != 0 && (p_m_heading[3] & 4) == 0
                        || v177->m_eFireType == FIRETYPE_MELEE
                        || (unsigned __int8)p_m_heading[1] << 31 )
                      {
                        goto LABEL_309;
                      }
                      if ( *((_DWORD *)&v16[24].m_transform.m_translate.x + 7 * SLOBYTE(v16[30].m_pMat)) != 41 )
                      {
                        v195 = v16[30].m_pRwObject;
                        if ( v195 )
                        {
                          v196 = v16->m_pMat;
                          v197 = (char *)v195[2].parent;
                          p_x = &v16->m_transform.m_translate.x;
                          if ( v196 )
                            p_x = &v196->tx;
                          v199 = (float *)(v197 + 48);
                          if ( !v197 )
                            v199 = (float *)&v195->parent;
                          v194 = atan2f(-(float)(*v199 - *p_x), v199[1] - p_x[1]);
                          goto LABEL_298;
                        }
                        if ( ACQUIRED_FREEAIM_DIRECTION != 1 )
                        {
LABEL_308:
                          v205 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam);
                          v206 = (float)((float)(0.5 - CCamera::m_f3rdPersonCHairMultY)
                                       + (float)(0.5 - CCamera::m_f3rdPersonCHairMultY))
                               * (float)(1.0 / CDraw::ms_fAspectRatio);
                          v207 = tanf((float)((float)(v205[127] * 0.5) * 3.1416) / 180.0) * v206;
                          v208 = v205[125];
                          *(float *)(LODWORD(TheCamera.pTargetEntity[18].m_transform.m_translate.z) + 84) = -(float)(v208 + atanf(v207));
LABEL_309:
                          *p_ResetStatics = 0;
                          return;
                        }
                      }
                      v194 = atan2f(COERCE_FLOAT(LODWORD(this->Front.x) ^ 0x80000000), this->Front.y) - v27;
LABEL_298:
                      if ( v194 > -100.0 )
                      {
                        v200 = v16->m_pMat;
                        *(float *)&v16[22].numLodChildren = v194 + -0.05;
                        *(float *)&v16[22].m_pLod = v194 + -0.05;
                        if ( v200 )
                          CMatrix::SetRotateZOnly(v200, v194);
                        else
                          v16->m_transform.m_heading = v194;
                        v201 = v16->m_pRwObject;
                        if ( v201 )
                        {
                          v202 = (char *)v201->parent;
                          v203 = v16->m_pMat;
                          v204 = (RwMatrix *)(v202 + 16);
                          if ( v203 )
                            CMatrix::UpdateRwMatrix(v203, v204);
                          else
                            CSimpleTransform::UpdateRwMatrix(v216, v204);
                        }
                      }
                      goto LABEL_308;
                  }
                  gpCamColVars = v182;
                  goto LABEL_270;
                }
                v160 = 6.2832;
              }
              else
              {
                v160 = -6.2832;
              }
              v103 = v103 + v160;
              *p_Beta = v103;
              goto LABEL_247;
            }
            v108 = 6.2832;
          }
          else
          {
            v108 = -6.2832;
          }
          v103 = v103 + v108;
          goto LABEL_149;
        }
        if ( CHID::GetInputType() == 2 )
        {
          v80 = currentPad;
          if ( !currentPad )
            v80 = CPad::GetPad(0);
          if ( !v80->DisablePlayerControls )
          {
            if ( !currentPad )
              CPad::GetPad(0);
            v125 = -CPad::NewMouseControllerState.m_AmountMoved.x;
            Mode = (unsigned __int16)this->Mode;
            v127 = -CPad::NewMouseControllerState.m_AmountMoved.y;
            v128 = Mode == 65;
            if ( Mode != 65 )
              v128 = Mode == 55;
            if ( v128 )
            {
              vecStart.x = 0.0;
              vecStart.y = 0.0;
              if ( CTouchInterface::IsTouched(WIDGET_PED_MOVE, (CVector2D *)&vecStart, 1) )
              {
                v125 = vecStart.x * -0.075;
                v127 = vecStart.y * -0.075;
              }
            }
            p_Beta = &this->Beta;
            v129 = this->Alpha;
            v130 = this->Beta;
            v131 = (float)((float)MobileSettings::settings[32].value / 100.0) * 0.0075 + 0.000500000024;
            v132 = (float)((float)MobileSettings::settings[31].value / 100.0) * 0.01;
            v133 = -v127;
            v134 = this->FOV / 80.0;
            if ( !MobileSettings::settings[15].value )
              v133 = v127;
            this->BetaSpeed = 0.0;
            this->AlphaSpeed = 0.0;
            v135 = v131;
            v103 = v130 + (float)(v134 * (float)(v125 * (float)(v132 + 0.0005)));
            *(float *)&v28 = v129 + (float)(v134 * (float)(v133 * v135));
            this->Beta = v103;
            goto LABEL_241;
          }
        }
        v81 = currentPad;
        if ( !currentPad )
          v81 = CPad::GetPad(0);
        v82 = CPad::AimWeaponLeftRight(v81, (CPed *)v16, 0);
        v83 = currentPad;
        if ( !currentPad )
          v83 = CPad::GetPad(0);
        v84 = (float)CPad::AimWeaponUpDown(v83, (CPed *)v16, 0);
        if ( CHID::GetInputType() )
        {
          v85 = -v82;
          if ( CHID::GetInputType() != 1 )
          {
            v89 = 0.0;
            v110 = 0.0;
            v87 = CTimer::ms_fTimeStep;
LABEL_157:
            v111 = 1061997773;
            v112 = fabsf(v84);
            v113 = 1061997773;
            if ( fabsf(v85) < 2.0 )
              v113 = 0.5;
            if ( v112 < 2.0 )
              v111 = v113;
            v114 = powf(*(float *)&v111, v87);
            v115 = v110 * (float)(1.0 - v114);
            v116 = (float)(v114 * this->BetaSpeed) + (float)(v89 * (float)(1.0 - v114));
            v117 = v115 + (float)(v114 * this->AlphaSpeed);
            this->BetaSpeed = v116;
            this->AlphaSpeed = v117;
            if ( !(BYTE1(v16[19].m_transform.m_heading) << 31) )
              goto LABEL_200;
            v118 = v16[23].m_pLastRenderedLink;
            v119 = v118 == 0;
            if ( v118 )
              v119 = v118[93].m_pNext == (CLink<CEntity *> *)v16;
            if ( !v119 )
              goto LABEL_200;
            v120 = v16[23].m_pLastRenderedLink;
            if ( !v120 || (CEntity *)v120[93].m_pNext != v16 )
              goto LABEL_200;
            v121 = 0;
            v122 = 0;
            v123 = 0;
            if ( v85 != 0.0 )
              v121 = 1;
            if ( v84 != 0.0 )
              v122 = 1;
            if ( !(v121 | v122) )
            {
              v124 = currentPad;
              if ( !currentPad )
                v124 = CPad::GetPad(0);
              if ( CPad::GetWeapon(v124, (CPed *)v16, 1) )
              {
                v123 = ACQUIRED_FREEAIM_INCAR_IDLE_COUNTER;
                goto LABEL_191;
              }
              v123 = (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0)
                   + ACQUIRED_FREEAIM_INCAR_IDLE_COUNTER;
            }
            ACQUIRED_FREEAIM_INCAR_IDLE_COUNTER = v123;
LABEL_191:
            if ( v123 <= ACQUIRED_FREEAIM_STATIC_LIM_A )
            {
              if ( v123 > ACQUIRED_FREEAIM_STATIC_LIM_B )
              {
                v137 = *(float *)&v16[22].m_pLod + -1.5708;
                v138 = this->Beta;
                v139 = (float)(v137 - v27) - v138;
                if ( v139 <= 6.2832 )
                {
                  if ( v139 < -6.2832 )
                    v139 = v139 + 6.2832;
                }
                else
                {
                  v139 = v139 + -6.2832;
                }
                if ( v139 >= 0.5236 )
                {
                  p_Beta = &this->Beta;
                  ACQUIRED_FREEAIM_DIRECTION = 1;
                  goto LABEL_202;
                }
                v141 = v27 + v137;
                ACQUIRED_FREEAIM_INCAR_IDLE_COUNTER = ACQUIRED_FREEAIM_STATIC_LIM_A + 1;
                ACQUIRED_FREEAIM_DIRECTION = 0;
                ACQUIRED_FREEAIM_PEDHEADING = v27 + v137;
LABEL_204:
                p_m_pLod = (float *)&v16[22].m_pLod;
                if ( v141 < -1000.0 )
                {
                  v141 = *p_m_pLod + -1.5708;
                  ACQUIRED_FREEAIM_PEDHEADING = v141;
                }
                if ( (m_pWeaponInfo->m_nFlags & 2) == 0 && m_pWeaponInfo->m_eFireType )
                {
                  *(float *)&v16[22].numLodChildren = v141 + 1.5708;
                  *p_m_pLod = v141 + 1.5708;
                  v143 = v16->m_pMat;
                  if ( v143 )
                    CMatrix::SetRotateZOnly(v143, v141 + 1.5708);
                  else
                    v16->m_transform.m_heading = v141 + 1.5708;
                  v144 = v16->m_pRwObject;
                  if ( v144 )
                  {
                    v145 = (char *)v144->parent;
                    v146 = v16->m_pMat;
                    v147 = (RwMatrix *)(v145 + 16);
                    if ( v146 )
                      CMatrix::UpdateRwMatrix(v146, v147);
                    else
                      CSimpleTransform::UpdateRwMatrix(v216, v147);
                  }
                }
                v148 = v141 - v27;
                v149 = 0.0;
                v150 = AIMWEAPON_FREETARGET_SENS * CTimer::ms_fTimeStep;
                v152 = BYTE1(v16[19].m_transform.m_heading) << 31;
                v151 = v152 == 0;
                if ( v152 )
                {
                  v152 = (int)v16[23].m_pLastRenderedLink;
                  v151 = v152 == 0;
                }
                if ( !v151 && *(CEntity **)(v152 + 1124) == v16 )
                {
                  v150 = v150 * AIMWEAPON_DRIVE_SENS_MULT;
                  v149 = AIMWEAPON_DRIVE_CLOSE_ENOUGH;
                }
                v153 = this->Beta;
                if ( (float)(v148 - v153) <= 3.1416 )
                {
                  if ( (float)(v148 - v153) >= -3.1416 )
                    goto LABEL_225;
                  v154 = 6.2832;
                }
                else
                {
                  v154 = -6.2832;
                }
                v148 = v148 + v154;
LABEL_225:
                v155 = v148 - v153;
                p_Beta = &this->Beta;
                if ( v149 > 0.0 )
                {
                  if ( v155 <= v149 )
                  {
                    if ( v155 >= (float)-v149 )
                      v155 = 0.0;
                    else
                      v155 = v149 + v155;
                  }
                  else
                  {
                    v155 = v155 - v149;
                  }
                }
                if ( fabsf(v155) >= v150 )
                {
                  v156 = v155 < 0.0;
                  v157 = v150;
                  if ( v156 )
                    v157 = -v150;
                  v103 = v157 + v153;
                  *p_Beta = v157 + v153;
                }
                else
                {
                  v103 = v155 + v153;
                  *p_Beta = v155 + v153;
                  ACQUIRED_FREEAIM_DIRECTION = 1;
                }
                v159 = BYTE1(v16[19].m_transform.m_heading) << 31;
                v158 = v159 == 0;
                if ( v159 )
                {
                  v159 = (int)v16[23].m_pLastRenderedLink;
                  v158 = v159 == 0;
                }
                if ( v158 || *(CEntity **)(v159 + 1124) != v16 )
                {
                  *(float *)&v28 = v117 + this->Alpha;
                  goto LABEL_241;
                }
                if ( *(float *)(*(_DWORD *)(v159 + 20) + 24) > 1.0
                  || (v209 = -1.0, *(float *)(*(_DWORD *)(v159 + 20) + 24) >= -1.0) )
                {
                  v210 = *(_DWORD *)(v159 + 20);
                  v209 = 1.0;
                  if ( *(float *)(v210 + 24) <= 1.0 )
                    v209 = *(float *)(v210 + 24);
                }
                v211 = asinf(v209) + AIMWEAPON_SETTINGS[v219][3];
                v212 = this->Alpha;
                if ( (float)(v211 - v212) <= 3.1416 )
                {
                  if ( (float)(v211 - v212) >= -3.1416 )
                    goto LABEL_320;
                  v213 = 6.2832;
                }
                else
                {
                  v213 = -6.2832;
                }
                v211 = v211 + v213;
LABEL_320:
                v214 = v211 - v212;
                if ( v214 <= v149 )
                {
                  if ( v214 >= (float)-v149 )
                    v215 = 0.0;
                  else
                    v215 = v149 + v214;
                }
                else
                {
                  v215 = v214 - v149;
                }
                if ( fabsf(v215) >= v150 )
                {
                  if ( v215 < 0.0 )
                    v150 = -v150;
                  *(float *)&v28 = v150 + v212;
                }
                else
                {
                  *(float *)&v28 = v215 + v212;
                }
                goto LABEL_241;
              }
              ACQUIRED_FREEAIM_DIRECTION = 1;
              v140 = currentPad;
              if ( !currentPad )
                v140 = CPad::GetPad(0);
              if ( CPad::GetWeapon(v140, (CPed *)v16, 1) )
                ACQUIRED_FREEAIM_INCAR_IDLE_COUNTER = 0;
            }
            else
            {
              ACQUIRED_FREEAIM_DIRECTION = 0;
              ACQUIRED_FREEAIM_PEDHEADING = v27 + (float)(*(float *)&v16[22].m_pLod + -1.5708);
            }
LABEL_200:
            if ( ACQUIRED_FREEAIM_DIRECTION == 1 )
            {
              v138 = this->Beta;
              p_Beta = &this->Beta;
LABEL_202:
              v103 = v116 + v138;
              ACQUIRED_FREEAIM_PEDHEADING = -1001.0;
              *(float *)&v28 = v117 + this->Alpha;
              this->Beta = v103;
LABEL_241:
              LODWORD(this->Alpha) = v28;
              goto LABEL_242;
            }
            v141 = ACQUIRED_FREEAIM_PEDHEADING;
            goto LABEL_204;
          }
          v86 = this->FOV;
          v87 = CTimer::ms_fTimeStep;
          v88 = (float)((float)MobileSettings::settings[26].value / 100.0) * 0.0003 + 0.00039999999;
          v89 = CTimer::ms_fTimeStep
              * (float)((float)(v86 / 80.0)
                      * (float)((float)((float)((float)((float)MobileSettings::settings[25].value / 100.0) * 0.0004)
                                      + 0.0004)
                              * v85));
          v90 = v84 * v88;
        }
        else
        {
          v86 = this->FOV;
          v85 = v82 * -0.000625;
          v90 = v84 * 0.000625;
          v87 = CTimer::ms_fTimeStep;
          v84 = v84 * 0.000625;
          v89 = CTimer::ms_fTimeStep * (float)((float)(v82 * -0.000625) * (float)(v86 / 80.0));
        }
        v110 = v87 * (float)(v90 * (float)(v86 / 80.0));
        goto LABEL_157;
      }
      v29 = 3.0;
      v30 = 0.0;
      v31 = 20.0;
      if ( CPedIntelligence::GetTaskFighting((const CPedIntelligence *)LODWORD(v16[18].m_transform.m_translate.y)) )
      {
        if ( (int)v16[18].m_pRwObject <= 3 )
        {
          v32 = v16[30].m_pRwObject;
          if ( v32 )
          {
            if ( CCam::Process_AimWeapon(CVector const&,float,float,float)::sAimWeaponMeleeLOSCounter <= CTimer::ms_fTimeStep )
            {
              if ( CCam::Process_AimWeapon(CVector const&,float,float,float)::sAimWeaponMeleeLOSCounter >= (float)-CTimer::ms_fTimeStep )
              {
                v34 = v16->m_pMat;
                p_tx = &v34->tx;
                if ( !v34 )
                  p_tx = &v16->m_transform.m_translate.x;
                v36 = p_tx[2];
                v37 = *p_tx + 0.0;
                vecStart.y = p_tx[1] + 0.0;
                vecStart.x = v37;
                vecStart.z = v36 + 0.75;
                v38 = (char *)v32[2].parent;
                v39 = *p_tx;
                v40 = p_tx[1];
                v41 = (float *)(v38 + 48);
                if ( !v38 )
                  v41 = (float *)&v32->parent;
                v42 = *v41 - v39;
                v43 = v41[2] - v36;
                v1.y = v41[1] - v40;
                v1.x = v42;
                v1.z = v43;
                v2.x = 0.0;
                v2.y = 0.0;
                v2.z = 1.0;
                CrossProduct(&v222, &v1, &v2);
                v9.n64_u32[0] = 1060320051;
                v8.n64_f32[0] = sqrtf(
                                  (float)((float)(v222.x * v222.x) + (float)(v222.y * v222.y))
                                + (float)(v222.z * v222.z));
                v8.n64_u64[0] = vmax_f32(v8, v9).n64_u64[0];
                v8.n64_f32[0] = 2.0 / v8.n64_f32[0];
                v222.x = v222.x * v8.n64_f32[0];
                v222.y = v222.y * v8.n64_f32[0];
                v222.z = v222.z * v8.n64_f32[0];
                v1.x = vecStart.x + v222.x;
                v1.y = vecStart.y + v222.y;
                v1.z = vecStart.z + v222.z;
                v33 = -100.0;
                if ( CWorld::GetIsLineOfSightClear(&vecStart, &v1, 1, 1, 0, 1, 0, 1, 1) )
                  v33 = 100.0;
              }
              else
              {
                v33 = CCam::Process_AimWeapon(CVector const&,float,float,float)::sAimWeaponMeleeLOSCounter
                    + CTimer::ms_fTimeStep;
              }
            }
            else
            {
              v33 = CCam::Process_AimWeapon(CVector const&,float,float,float)::sAimWeaponMeleeLOSCounter
                  - CTimer::ms_fTimeStep;
            }
            CCam::Process_AimWeapon(CVector const&,float,float,float)::sAimWeaponMeleeLOSCounter = v33;
            if ( v33 >= 0.0 )
            {
              v30 = 1.0;
              v29 = 0.0;
              v31 = 70.0;
            }
          }
        }
      }
      ResetStatics = this->ResetStatics;
      p_ResetStatics = &this->ResetStatics;
      if ( this->ResetStatics )
      {
        v45 = 0.0;
        CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_BETA = v31;
        CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_ALPHA = v29;
      }
      else
      {
        if ( TheCamera.m_uiTransitionState )
        {
          v31 = CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_BETA;
          v29 = CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_ALPHA;
LABEL_56:
          *(float *)&v28 = (float)(v29 * 3.1416) / 180.0;
          v27 = (float)(v31 * 3.1416) / 180.0;
          if ( !ResetStatics )
            goto LABEL_83;
          goto LABEL_57;
        }
        v136 = powf(0.96, CTimer::ms_fTimeStep);
        v29 = (float)(v136 * CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_ALPHA)
            + (float)(v29 * (float)(1.0 - v136));
        v31 = (float)(v31 * (float)(1.0 - v136))
            + (float)(v136 * CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_BETA);
        v45 = (float)(v30 * (float)(1.0 - v136))
            + (float)(v136 * CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_TOWARD_TARGET);
        CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_ALPHA = v29;
        CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_ANGLE_BETA = v31;
      }
      CCam::Process_AimWeapon(CVector const&,float,float,float)::FIGHT_AIM_TOWARD_TARGET = v45;
      goto LABEL_56;
    }
    IsTypeMelee = 1;
    goto LABEL_21;
  }
}
// 3C6CEC: variable 'v5' is possibly undefined
// 3C6CEC: variable 'v6' is possibly undefined
// 3C6EDA: variable 'v8' is possibly undefined
// 3C6EDA: variable 'v9' is possibly undefined
// 3C7164: variable 'v7' is possibly undefined
// 3C73CC: variable 'v10' is possibly undefined
// 3C73D0: variable 'v11' is possibly undefined
// 0: using guessed type int dword_0;
// FC: using guessed type int elf_hash_bucket[16411];
// 3C7B70: using guessed type int dword_3C7B70;
// 3C86FC: using guessed type int dword_3C86FC;
// 3C8700: using guessed type int;
// 952DCC: using guessed type char `guard variable for'CCam::Process_AimWeapon(CVector const&,float,float,float)::vecWeaponTargetPos;
// 952DD8: using guessed type char ACQUIRED_FREEAIM_DIRECTION;

//----- (003C879C) --------------------------------------------------------
bool __fastcall CCam::Process_WheelCam(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  CEntity *CamTargetEntity; // r5
  const CMatrix *m_pMat; // r1
  __int64 v8; // d16
  CEntity *v9; // r5
  float y; // s2
  CMatrix *v11; // r0
  float z; // s4
  float *p_tx; // r1
  float v14; // s0
  CEntity *v15; // r5
  const CMatrix *v16; // r1
  __int64 v17; // d16
  CEntity *v18; // r6
  CMatrix *v19; // r0
  __int64 v20; // d16
  CEntity *v21; // r5
  const CMatrix *v22; // r1
  __int64 v23; // d16
  const CMatrix *v24; // r0
  CEntity *v25; // r6
  CMatrix *v26; // r0
  __int64 v27; // d16
  int v28; // r0
  bool v29; // zf
  int v30; // r0
  bool v31; // zf
  int v32; // r0
  bool v33; // zf
  CVector *p_Front; // r5
  CLink<CEntity *> *m_pLastRenderedLink; // r0
  CEntity *v36; // r6
  float v37; // s16
  float x; // s0
  float v39; // s2
  float v40; // s4
  float *p_xx; // r0
  CEntity *v42; // r5
  CMatrix *v43; // r0
  __int64 v44; // d16
  __int64 v45; // d16
  float v46; // s0
  CEntity *v47; // r5
  CMatrix *v48; // r0
  CSimpleTransform *p_m_transform; // r1
  __int64 v50; // d16
  float *v51; // r0
  RwReal v52; // s2
  RwReal v53; // s4
  RwReal v54; // s0
  float v55; // s0
  float v56; // s4
  float m_heading; // s8
  float v58; // s6
  float v59; // s10
  float v60; // s2
  __int64 v61; // d16
  __int64 v62; // d16
  float v63; // s6
  float v64; // s6
  float v65; // r6
  float v66; // r5
  float v67; // r0
  RwReal v68; // s2
  RwReal v69; // s4
  CEntity *v70; // r0
  CMatrix *v71; // r2
  const CVector *p_m_translate; // r1
  char v73; // r0
  float v75; // s0
  float v76; // s2
  float v77; // s4
  float v78; // s16
  float v79; // s0
  float v80; // s2
  float v81; // s4
  float *v82; // r0
  float v83; // s6
  float v84; // s4
  CEntity *refEntityPtr; // [sp+24h] [bp-84h] BYREF
  CColPoint v86; // [sp+28h] [bp-80h] BYREF
  float pWaterZ; // [sp+58h] [bp-50h] BYREF
  CVector v88; // [sp+5Ch] [bp-4Ch] BYREF
  CVector v2; // [sp+68h] [bp-40h] BYREF
  CVector v; // [sp+78h] [bp-30h] BYREF

  CamTargetEntity = this->CamTargetEntity;
  this->FOV = 70.0;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) == 3 )
  {
    m_pMat = CamTargetEntity->m_pMat;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&CamTargetEntity->m_transform, CamTargetEntity->m_pMat);
      m_pMat = CamTargetEntity->m_pMat;
    }
    v.y = -0.5;
    v.x = -0.3;
    v.z = 0.1;
    Multiply3x3(&v86.m_vecPosition, m_pMat, &v);
    v8 = *(_QWORD *)&v86.m_vecPosition.x;
    this->Source.z = v86.m_vecPosition.z;
    *(_QWORD *)&this->Source.x = v8;
    v9 = this->CamTargetEntity;
    y = this->Source.y;
    v11 = v9->m_pMat;
    z = this->Source.z;
    p_tx = &v11->tx;
    if ( !v11 )
      p_tx = &v9->m_transform.m_translate.x;
    this->Source.x = *p_tx + this->Source.x;
    this->Source.y = p_tx[1] + y;
    v14 = p_tx[2];
    this->Front.x = 1.0;
    this->Front.y = 0.0;
    this->Front.z = 0.0;
    this->Source.z = v14 + z;
  }
  else
  {
    v88.x = CEntity::GetColModel(CamTargetEntity)->m_boxBound.m_vecMin.x;
    v88.y = -2.3;
    v88.z = 0.3;
    v88.x = v88.x - fWheelCamCarXOffset;
    v15 = this->CamTargetEntity;
    v16 = v15->m_pMat;
    if ( !v16 )
    {
      CPlaceable::AllocateMatrix(this->CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v15->m_transform, v15->m_pMat);
      v16 = v15->m_pMat;
    }
    operator*(&v86.m_vecPosition, v16, &v88);
    v17 = *(_QWORD *)&v86.m_vecPosition.x;
    this->Source.z = v86.m_vecPosition.z;
    *(_QWORD *)&this->Source.x = v17;
    v18 = this->CamTargetEntity;
    v19 = v18->m_pMat;
    if ( v19 )
    {
      v9 = this->CamTargetEntity;
    }
    else
    {
      CPlaceable::AllocateMatrix(this->CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v18->m_transform, v18->m_pMat);
      v9 = this->CamTargetEntity;
      v19 = v18->m_pMat;
    }
    v20 = *(_QWORD *)&v19->xy;
    this->Front.z = v19->zy;
    *(_QWORD *)&this->Front.x = v20;
  }
  if ( (*(_BYTE *)&v9->m_info & 7) == 2 )
  {
    if ( CVehicle::GetVehicleAppearance((const CVehicle *)v9) == APR_HELI
      || CVehicle::GetVehicleAppearance((const CVehicle *)this->CamTargetEntity) == APR_PLANE )
    {
      v21 = this->CamTargetEntity;
      v22 = v21->m_pMat;
      if ( v22 )
      {
        v23 = *(_QWORD *)&v22->xx;
        v.z = v22->zx;
        v24 = v22;
        *(_QWORD *)&v.x = v23;
      }
      else
      {
        CPlaceable::AllocateMatrix(this->CamTargetEntity);
        CSimpleTransform::UpdateMatrix(&v21->m_transform, v21->m_pMat);
        v25 = this->CamTargetEntity;
        v26 = v21->m_pMat;
        v22 = v25->m_pMat;
        v27 = *(_QWORD *)&v26->xx;
        v.z = v26->zx;
        *(_QWORD *)&v.x = v27;
        if ( v22 )
        {
          v21 = v25;
          v24 = v22;
        }
        else
        {
          CPlaceable::AllocateMatrix(v25);
          CSimpleTransform::UpdateMatrix(&v25->m_transform, v25->m_pMat);
          v21 = this->CamTargetEntity;
          v24 = v25->m_pMat;
          v22 = v21->m_pMat;
        }
      }
      v61 = *(_QWORD *)&v24->xz;
      v2.z = v24->zz;
      *(_QWORD *)&v2.x = v61;
      v88.x = -1.55;
      if ( !v22 )
      {
        CPlaceable::AllocateMatrix(v21);
        CSimpleTransform::UpdateMatrix(&v21->m_transform, v21->m_pMat);
        v22 = v21->m_pMat;
      }
      operator*(&v86.m_vecPosition, v22, &v88);
LABEL_49:
      v62 = *(_QWORD *)&v86.m_vecPosition.x;
      this->Source.z = v86.m_vecPosition.z;
      *(_QWORD *)&this->Source.x = v62;
      goto LABEL_50;
    }
    v9 = this->CamTargetEntity;
  }
  v28 = *(_BYTE *)&v9->m_info & 7;
  v29 = v28 == 2;
  if ( v28 == 2 )
    v29 = v9[24]._vptr$CPlaceable == (int (**)(void))&byte_5;
  if ( v29 )
  {
    v2.x = 0.0;
    v2.y = 0.0;
    v2.z = 1.0;
    CrossProduct(&v86.m_vecPosition, &this->Front, &v2);
    v = v86.m_vecPosition;
    CVector::Normalise(&v);
    CrossProduct(&v86.m_vecPosition, &v, &this->Front);
    v2 = v86.m_vecPosition;
    CVector::Normalise(&v2);
    memset(&v86, 0, 12);
    m_pLastRenderedLink = this->CamTargetEntity[18].m_pLastRenderedLink;
    if ( m_pLastRenderedLink )
    {
      CPed::GetBonePosition((CPed *)m_pLastRenderedLink, &v86.m_vecPosition, 5u, 1);
      v36 = this->CamTargetEntity;
      v37 = vecWheelCamBoatOffset.y;
      x = (float)(vecWheelCamBoatOffset.x * v.x)
        + (float)((float)(CTimer::ms_fTimeStep * v36[1].m_transform.m_translate.z) + v86.m_vecPosition.x);
      v39 = (float)(vecWheelCamBoatOffset.x * v.y)
          + (float)((float)(CTimer::ms_fTimeStep * v36[1].m_transform.m_heading) + v86.m_vecPosition.y);
      v40 = (float)(vecWheelCamBoatOffset.x * v.z)
          + (float)((float)(CTimer::ms_fTimeStep * *(float *)&v36[1].m_pMat) + v86.m_vecPosition.z);
      v86.m_vecPosition.x = x;
      v86.m_vecPosition.y = v39;
      v86.m_vecPosition.z = v40;
      p_xx = &v36->m_pMat->xx;
      if ( p_xx )
      {
        v42 = v36;
      }
      else
      {
        CPlaceable::AllocateMatrix(v36);
        CSimpleTransform::UpdateMatrix(&v36->m_transform, v36->m_pMat);
        v42 = this->CamTargetEntity;
        p_xx = &v36->m_pMat->xx;
        x = v86.m_vecPosition.x;
        v39 = v86.m_vecPosition.y;
        v40 = v86.m_vecPosition.z;
      }
      v75 = (float)(v37 * p_xx[4]) + x;
      v76 = (float)(v37 * p_xx[5]) + v39;
      v77 = (float)((float)(v37 * p_xx[6]) + v40) + vecWheelCamBoatOffset.z;
      v86.m_vecPosition.y = v76;
      v86.m_vecPosition.x = v75;
      v86.m_vecPosition.z = v77;
      if ( v42->m_nModelIndex == 430 )
      {
        v78 = vecWheelCamBoatOffsetAlt.y;
        v79 = (float)(vecWheelCamBoatOffsetAlt.x * v.x) + v75;
        v80 = (float)(vecWheelCamBoatOffsetAlt.x * v.y) + v76;
        v81 = (float)(vecWheelCamBoatOffsetAlt.x * v.z) + v77;
        v86.m_vecPosition.x = v79;
        v86.m_vecPosition.y = v80;
        v86.m_vecPosition.z = v81;
        v82 = &v42->m_pMat->xx;
        if ( !v82 )
        {
          CPlaceable::AllocateMatrix(v42);
          CSimpleTransform::UpdateMatrix(&v42->m_transform, v42->m_pMat);
          v82 = &v42->m_pMat->xx;
          v79 = v86.m_vecPosition.x;
          v80 = v86.m_vecPosition.y;
          v81 = v86.m_vecPosition.z;
        }
        v83 = v78 * v82[4];
        v84 = v81 - (float)(v78 * v82[6]);
        v86.m_vecPosition.y = v80 - (float)(v78 * v82[5]);
        v86.m_vecPosition.x = v79 - v83;
        v86.m_vecPosition.z = v84 + vecWheelCamBoatOffsetAlt.z;
      }
      goto LABEL_49;
    }
    this->Source.z = this->Source.z + (float)(vecWheelCamBoatOffset.z + vecWheelCamBoatOffset.z);
  }
  else
  {
    v30 = *(_BYTE *)&v9->m_info & 7;
    v31 = v30 == 2;
    if ( v30 == 2 )
      v31 = v9[24]._vptr$CPlaceable == (int (**)(void))byte_9;
    if ( v31 )
    {
      v43 = v9->m_pMat;
      if ( !v43 )
      {
        CPlaceable::AllocateMatrix(v9);
        CSimpleTransform::UpdateMatrix(&v9->m_transform, v9->m_pMat);
        v43 = v9->m_pMat;
      }
      v44 = *(_QWORD *)&v43->xx;
      v.z = v43->zx;
      v2.z = 1.0;
      *(_QWORD *)&v.x = v44;
      v2.x = 0.0;
      v2.y = 0.0;
      CrossProduct(&v86.m_vecPosition, &this->Up, &v);
      v45 = *(_QWORD *)&v86.m_vecPosition.x;
      this->Front.z = v86.m_vecPosition.z;
      *(_QWORD *)&this->Front.x = v45;
      CVector::Normalise(&this->Front);
      v46 = v88.x + (float)(fWheelCamCarXOffset - fWheelCamBikeXOffset);
      v88.x = v46;
      v47 = this->CamTargetEntity;
      v48 = v47->m_pMat;
      p_m_transform = &v47->m_transform;
      if ( v48 )
        p_m_transform = (CSimpleTransform *)&v48->tx;
      v50 = *(_QWORD *)&p_m_transform->m_translate.x;
      this->Source.z = p_m_transform->m_translate.z;
      *(_QWORD *)&this->Source.x = v50;
      v51 = &v47->m_pMat->xx;
      if ( !v51 )
      {
        CPlaceable::AllocateMatrix(v47);
        CSimpleTransform::UpdateMatrix(&v47->m_transform, v47->m_pMat);
        v51 = &v47->m_pMat->xx;
        v46 = v88.x;
      }
      v52 = (float)(v88.z * this->Up.x)
          + (float)((float)(v88.y * this->Front.x) + (float)((float)(v46 * *v51) + this->Source.x));
      v53 = (float)(v88.z * this->Up.z)
          + (float)((float)(v88.y * this->Front.z) + (float)((float)(v46 * v51[2]) + this->Source.z));
      v54 = (float)(v88.z * this->Up.y)
          + (float)((float)(v88.y * this->Front.y) + (float)((float)(v46 * v51[1]) + this->Source.y));
      this->Source.x = v52;
      this->Source.y = v54;
      this->Source.z = v53;
    }
    else
    {
      v32 = *(_BYTE *)&v9->m_info & 7;
      v33 = v32 == 2;
      if ( v32 == 2 )
        v33 = v9[24]._vptr$CPlaceable == (int (**)(void))&byte_6;
      if ( v33 )
      {
        v55 = this->Front.x;
        v56 = this->Front.y;
        m_heading = v9[1].m_transform.m_heading;
        v58 = v9[1].m_transform.m_translate.z * v55;
        v59 = *(float *)&v9[1].m_pMat;
        p_Front = &this->Front;
        v60 = this->Front.z;
        if ( (float)((float)(v58 + (float)(m_heading * v56)) + (float)(v59 * v60)) < 0.0 )
        {
          this->Front.x = -v55;
          this->Front.y = -v56;
          this->Front.z = -v60;
        }
      }
      else
      {
        p_Front = &this->Front;
      }
      v2.x = 0.0;
      v2.y = 0.0;
      v2.z = 1.0;
      CrossProduct(&v86.m_vecPosition, p_Front, &v2);
      v = v86.m_vecPosition;
      CVector::Normalise(&v);
      CrossProduct(&v86.m_vecPosition, &v, p_Front);
      v2 = v86.m_vecPosition;
      CVector::Normalise(&v2);
    }
  }
LABEL_50:
  pWaterZ = 0.0;
  if ( CWaterLevel::GetWaterLevel(this->Source.x, this->Source.y, this->Source.z, &pWaterZ, 1, 0) == 1
    && this->Source.z < (float)(pWaterZ + -0.3) )
  {
    v63 = sqrtf(
            (float)((float)(CTimeCycle::m_CurrentColours.m_fWaterRed * CTimeCycle::m_CurrentColours.m_fWaterRed)
                  + (float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * CTimeCycle::m_CurrentColours.m_fWaterGreen))
          + (float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * CTimeCycle::m_CurrentColours.m_fWaterBlue));
    if ( v63 <= BOAT_UNDERWATER_CAM_COLORMAG_LIMIT )
    {
      TheCamera.m_BlurType = 2;
      TheCamera.m_BlurBlue = (int)CTimeCycle::m_CurrentColours.m_fWaterBlue;
      TheCamera.m_BlurGreen = (int)CTimeCycle::m_CurrentColours.m_fWaterGreen;
      TheCamera.m_BlurRed = (int)CTimeCycle::m_CurrentColours.m_fWaterRed;
      TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
    }
    else
    {
      v64 = BOAT_UNDERWATER_CAM_COLORMAG_LIMIT / v63;
      TheCamera.m_BlurType = 2;
      TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
      TheCamera.m_BlurBlue = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * v64);
      TheCamera.m_BlurGreen = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * v64);
      TheCamera.m_BlurRed = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterRed * v64);
    }
  }
  v65 = cosf((float)(CTimer::m_snTimeInMilliseconds & 0x1FFFF) * 0.000047937) * 0.4;
  v66 = cosf(v65);
  v67 = sinf(v65);
  v68 = (float)(v66 * v2.y) + (float)(v67 * v.y);
  v69 = (float)(v66 * v2.z) + (float)(v67 * v.z);
  this->Up.x = (float)(v66 * v2.x) + (float)(v67 * v.x);
  this->Up.y = v68;
  this->Up.z = v69;
  CVector::Normalise(&this->Up);
  CVector::Normalise(&this->Front);
  refEntityPtr = 0;
  v70 = this->CamTargetEntity;
  CWorld::pIgnoreEntity = v70;
  v71 = v70->m_pMat;
  p_m_translate = (const CVector *)&v71->tx;
  if ( !v71 )
    p_m_translate = &v70->m_transform.m_translate;
  v73 = CWorld::ProcessLineOfSight(&this->Source, p_m_translate, &v86, &refEntityPtr, 1, 0, 0, 1, 0, 0, 1, 0);
  CWorld::pIgnoreEntity = 0;
  return v73 ^ 1;
}
// 5: using guessed type char byte_5;
// 6: using guessed type char byte_6;

//----- (003C901C) --------------------------------------------------------
void __fastcall CCam::Process_Fixed(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  __int64 v7; // d16
  RwReal v8; // s2
  RwReal v9; // s4
  __int64 v10; // d16
  RwReal v11; // s2
  RwReal v12; // s0
  __int64 v13; // d16
  float v14; // s6
  float v15; // s6
  __int64 v16; // d16
  CVector *p_Source; // r4
  CEntity *v18; // r5
  __int64 v19; // d16
  CVector pLookAt; // [sp+10h] [bp-50h] BYREF
  float pDist; // [sp+20h] [bp-40h] BYREF
  RwReal v22; // [sp+24h] [bp-3Ch] BYREF
  CVector v23; // [sp+28h] [bp-38h] BYREF
  CVector anonymous1[4]; // [sp+38h] [bp-28h] BYREF

  if ( this->DirectionWasLooking != 3 )
    this->DirectionWasLooking = 3;
  v7 = *(_QWORD *)&this->m_cvecCamFixedModeSource.x;
  this->Source.z = this->m_cvecCamFixedModeSource.z;
  *(_QWORD *)&this->Source.x = v7;
  v8 = ThisCamsTarget->y - this->Source.y;
  v9 = ThisCamsTarget->z - this->Source.z;
  this->Front.x = ThisCamsTarget->x - this->Source.x;
  this->Front.y = v8;
  this->Front.z = v9;
  CVector::Normalise(&this->Front);
  v10 = *(_QWORD *)&ThisCamsTarget->x;
  this->m_cvecTargetCoorsForFudgeInter.z = ThisCamsTarget->z;
  *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = v10;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(&this->Front);
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v23, &this->Front, &this->Up);
  anonymous1[0] = v23;
  CVector::Normalise(anonymous1);
  CrossProduct(&v23, anonymous1, &this->Front);
  v11 = this->m_cvecCamFixedModeUpOffSet.y + 0.0;
  v12 = this->m_cvecCamFixedModeUpOffSet.z + 1.0;
  this->Up.x = this->m_cvecCamFixedModeUpOffSet.x + 0.0;
  this->Up.y = v11;
  this->Up.z = v12;
  CVector::Normalise(&this->Up);
  CrossProduct(anonymous1, &this->Front, &this->Up);
  CVector::Normalise(anonymous1);
  CrossProduct(&v23, anonymous1, &this->Front);
  v13 = *(_QWORD *)&v23.x;
  this->Up.z = v23.z;
  *(_QWORD *)&this->Up.x = v13;
  this->FOV = 70.0;
  if ( TheCamera.m_bUseSpecialFovTrain )
    this->FOV = TheCamera.m_fFovForTrain;
  v22 = 0.0;
  if ( CWaterLevel::GetWaterLevel(this->Source.x, this->Source.y, this->Source.z, &v22, 1, 0) == 1
    && this->Source.z < v22 )
  {
    v14 = sqrtf(
            (float)((float)(CTimeCycle::m_CurrentColours.m_fWaterRed * CTimeCycle::m_CurrentColours.m_fWaterRed)
                  + (float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * CTimeCycle::m_CurrentColours.m_fWaterGreen))
          + (float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * CTimeCycle::m_CurrentColours.m_fWaterBlue));
    if ( v14 <= BOAT_UNDERWATER_CAM_COLORMAG_LIMIT )
    {
      TheCamera.m_BlurType = 2;
      TheCamera.m_BlurBlue = (int)CTimeCycle::m_CurrentColours.m_fWaterBlue;
      TheCamera.m_BlurGreen = (int)CTimeCycle::m_CurrentColours.m_fWaterGreen;
      TheCamera.m_BlurRed = (int)CTimeCycle::m_CurrentColours.m_fWaterRed;
      TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
    }
    else
    {
      v15 = BOAT_UNDERWATER_CAM_COLORMAG_LIMIT / v14;
      TheCamera.m_BlurType = 2;
      TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
      TheCamera.m_BlurBlue = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * v15);
      TheCamera.m_BlurGreen = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * v15);
      TheCamera.m_BlurRed = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterRed * v15);
    }
  }
  if ( gAllowScriptedFixedCameraCollision )
  {
    pDist = 1.0;
    v16 = *(_QWORD *)&ThisCamsTarget->x;
    p_Source = &this->Source;
    pLookAt.z = ThisCamsTarget->z;
    v18 = CWorld::pIgnoreEntity;
    *(_QWORD *)&pLookAt.x = v16;
    CWorld::pIgnoreEntity = FindPlayerVehicle(-1, 0);
    if ( CCamera::ConeCastCollisionResolve((CCamera *)&pDist, p_Source, &pLookAt, &v23, 2.0, 0.1, &pDist) )
    {
      v19 = *(_QWORD *)&v23.x;
      p_Source->z = v23.z;
      *(_QWORD *)&p_Source->x = v19;
    }
    CWorld::pIgnoreEntity = v18;
  }
}
// 3C901C: using guessed type CVector anonymous_0;

//----- (003C92F8) --------------------------------------------------------
void __fastcall CCam::Process_SpecialFixedForSyphon(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  __int64 v6; // d16
  float m_fSyphonModeTargetZOffSet; // s0
  RwReal v8; // s0
  float x; // s2
  float y; // s4
  RwReal v11; // s0
  RwReal v12; // s4
  RwReal v13; // s2
  __int64 v14; // d16
  __int64 v15; // d16
  RwReal v16; // s2
  RwReal v17; // s4
  __int64 v18; // d16
  CEntity *CamTargetEntity; // r5
  eWeaponType v20; // r4
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  RwObject_0 *m_pRwObject; // r0
  CMatrix *m_pMat; // r6
  float *p_x; // r2
  char *parent; // r1
  float *p_parent; // r3
  float v28; // r0
  RwObject_0 *v29; // r0
  char *v30; // r1
  const CMatrix *v31; // r0
  RwMatrix *v32; // r1
  CVector TheCamPos; // [sp+8h] [bp-40h] BYREF
  CVector v34; // [sp+18h] [bp-30h] BYREF
  CVector v35; // [sp+28h] [bp-20h] BYREF

  v6 = *(_QWORD *)&this->m_cvecCamFixedModeSource.x;
  this->Source.z = this->m_cvecCamFixedModeSource.z;
  *(_QWORD *)&this->Source.x = v6;
  m_fSyphonModeTargetZOffSet = this->m_fSyphonModeTargetZOffSet;
  this->m_cvecTargetCoorsForFudgeInter.z = ThisCamsTarget->z;
  v8 = m_fSyphonModeTargetZOffSet + this->m_cvecTargetCoorsForFudgeInter.z;
  x = this->Source.x;
  y = this->Source.y;
  *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = *(_QWORD *)&ThisCamsTarget->x;
  this->m_cvecTargetCoorsForFudgeInter.z = v8;
  v11 = ThisCamsTarget->x - x;
  v12 = ThisCamsTarget->y - y;
  v13 = ThisCamsTarget->z - this->Source.z;
  this->Front.x = v11;
  this->Front.y = v12;
  this->Front.z = v13;
  v14 = *(_QWORD *)&this->Source.x;
  TheCamPos.z = this->Source.z;
  *(_QWORD *)&TheCamPos.x = v14;
  CCamera::AvoidTheGeometry(&TheCamera, &TheCamPos, &this->m_cvecTargetCoorsForFudgeInter, &this->Source, this->FOV);
  this->Front.z = this->m_fSyphonModeTargetZOffSet + this->Front.z;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(&this->Front);
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v34, &this->Front, &this->Up);
  v35 = v34;
  CVector::Normalise(&v35);
  CrossProduct(&v34, &v35, &this->Front);
  v15 = *(_QWORD *)&v34.x;
  this->Up.z = v34.z;
  *(_QWORD *)&this->Up.x = v15;
  v16 = this->m_cvecCamFixedModeUpOffSet.y + this->Up.y;
  v17 = this->m_cvecCamFixedModeUpOffSet.z + this->Up.z;
  this->Up.x = this->m_cvecCamFixedModeUpOffSet.x + this->Up.x;
  this->Up.y = v16;
  this->Up.z = v17;
  CVector::Normalise(&this->Up);
  CrossProduct(&v35, &this->Up, &this->Front);
  CVector::Normalise(&v35);
  CrossProduct(&v34, &v35, &this->Up);
  v18 = *(_QWORD *)&v34.x;
  this->Front.z = v34.z;
  *(_QWORD *)&this->Front.x = v18;
  CVector::Normalise(&this->Front);
  CamTargetEntity = this->CamTargetEntity;
  this->FOV = 70.0;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) == 3 )
    {
      if ( CamTargetEntity[30].m_pRwObject )
      {
        v20 = *((_DWORD *)&CamTargetEntity[24].m_transform.m_translate.x + 7 * SLOBYTE(CamTargetEntity[30].m_pMat));
        WeaponSkill = CPed::GetWeaponSkill((CPed *)CamTargetEntity);
        WeaponInfo = CWeaponInfo::GetWeaponInfo(v20, WeaponSkill);
        if ( WeaponInfo )
        {
          if ( (WeaponInfo->m_nFlags & 2) == 0 || (HIBYTE(CamTargetEntity[19].m_transform.m_heading) & 4) != 0 )
          {
            if ( WeaponInfo->m_eFireType )
            {
              m_pRwObject = CamTargetEntity[30].m_pRwObject;
              m_pMat = CamTargetEntity->m_pMat;
              p_x = &CamTargetEntity->m_transform.m_translate.x;
              parent = (char *)m_pRwObject[2].parent;
              if ( m_pMat )
                p_x = &m_pMat->tx;
              p_parent = (float *)(parent + 48);
              if ( !parent )
                p_parent = (float *)&m_pRwObject->parent;
              v28 = atan2f(-(float)(*p_parent - *p_x), p_parent[1] - p_x[1]);
              *(float *)&CamTargetEntity[22].m_pLod = v28;
              *(float *)&CamTargetEntity[22].numLodChildren = v28;
              if ( m_pMat )
                CMatrix::SetRotateZOnly(m_pMat, v28);
              else
                CamTargetEntity->m_transform.m_heading = v28;
              v29 = CamTargetEntity->m_pRwObject;
              if ( v29 )
              {
                v30 = (char *)v29->parent;
                v31 = CamTargetEntity->m_pMat;
                v32 = (RwMatrix *)(v30 + 16);
                if ( v31 )
                  CMatrix::UpdateRwMatrix(v31, v32);
                else
                  CSimpleTransform::UpdateRwMatrix(&CamTargetEntity->m_transform, v32);
              }
            }
          }
        }
      }
    }
  }
}

//----- (003C9560) --------------------------------------------------------
void __fastcall CCam::Process_1stPerson(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  CEntity *CamTargetEntity; // r0
  CEntity::CEntityInfo *p_m_info; // r1
  float v8; // s2
  CEntity **p_CamTargetEntity; // r8
  float v10; // s2
  float v11; // s2
  const CVector *v12; // r1
  float v13; // r2
  float v14; // r3
  CEntity *v15; // r0
  int m_heading_low; // r1
  CBike *v17; // r6
  int m_pMat; // r5
  CBaseModelInfo *v19; // r0
  int v20; // r1
  uint32 m_hashKey; // r0
  __int64 v22; // d16
  __int64 v23; // d16
  const CVehicle *v24; // r0
  float y; // s2
  CMatrix *v26; // r1
  float z; // s4
  float *p_tx; // r2
  float v29; // s0
  int32 m_baseVehicleType; // r1
  float v31; // s2
  CPed *pDriver; // r0
  float *v33; // r1
  float v34; // s2
  RwReal v35; // s4
  float x; // s0
  float v37; // s2
  float v38; // s4
  CMatrix *v39; // r2
  _QWORD *p_x; // r6
  int IsUpsideDown; // r0
  int *v42; // r2
  float v43; // s0
  __int64 v44; // d16
  __int64 v45; // d16
  __int64 v46; // d16
  float v47; // s6
  float v48; // s6
  float bCheckPeds; // [sp+0h] [bp-78h]
  CVector vecEnd; // [sp+18h] [bp-60h] BYREF
  CVector vecStart; // [sp+24h] [bp-54h] BYREF
  CVector v52; // [sp+30h] [bp-48h] BYREF
  CVector v; // [sp+40h] [bp-38h] BYREF
  CVector v54; // [sp+50h] [bp-28h] BYREF

  gbFirstPersonRunThisFrame = 1;
  CamTargetEntity = this->CamTargetEntity;
  this->FOV = 70.0;
  if ( CamTargetEntity->m_pRwObject )
  {
    if ( this->ResetStatics )
    {
      this->Alpha = 0.0;
      this->Beta = TargetOrientation;
      this->m_fInitialPlayerOrientation = TargetOrientation;
      p_m_info = &CamTargetEntity->m_info;
      if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) == 3 )
      {
        v8 = *(float *)&CamTargetEntity[22].m_pLod;
        this->Alpha = 0.0;
        this->Beta = v8 + 1.5708;
        this->m_fInitialPlayerOrientation = *(float *)&CamTargetEntity[22].m_pLod + 1.5708;
      }
      CCam::Process_1stPerson(CVector const&,float,float,float)::DontLookThroughWorldFixer = 0.0;
      TheCamera.m_fAvoidTheGeometryProbsTimer = 0.0;
    }
    else
    {
      p_m_info = &CamTargetEntity->m_info;
    }
    if ( (*(_BYTE *)p_m_info & 7) == 3 )
      goto LABEL_50;
    p_CamTargetEntity = &this->CamTargetEntity;
    v10 = CCam::Process_1stPerson(CVector const&,float,float,float)::timeLastWheelieWheelCam;
    if ( CCam::Process_1stPerson(CVector const&,float,float,float)::timeLastWheelieWheelCam > (float)CTimer::m_snTimeInMilliseconds )
    {
      v10 = 0.0;
      CCam::Process_1stPerson(CVector const&,float,float,float)::timeLastWheelieWheelCam = 0.0;
    }
    v11 = (float)CTimer::m_snTimeInMilliseconds - v10;
    if ( v11 < 3000.0
      || CamTargetEntity[24]._vptr$CPlaceable == (int (**)(void))byte_9
      && (SLOBYTE(CamTargetEntity[26].m_transform.m_heading) < 0 || TheCamera.m_fAvoidTheGeometryProbsTimer > 0.0) )
    {
      if ( v11 >= 3000.0 )
        CCam::Process_1stPerson(CVector const&,float,float,float)::timeLastWheelieWheelCam = (float)CTimer::m_snTimeInMilliseconds;
      if ( !CPad::GetPad(0)->NewState.LeftShoulder2 && !CPad::GetPad(0)->NewState.RightShoulder2 )
      {
        if ( CCam::Process_WheelCam(this, v12, v13, v14, bCheckPeds) )
        {
          v15 = *p_CamTargetEntity;
          m_heading_low = SLOBYTE((*p_CamTargetEntity)[26].m_transform.m_heading);
          if ( m_heading_low <= -1 )
          {
            TheCamera.m_fAvoidTheGeometryProbsTimer = 50.0;
          }
          else
          {
            TheCamera.m_fAvoidTheGeometryProbsTimer = TheCamera.m_fAvoidTheGeometryProbsTimer - CTimer::ms_fTimeStep;
            LOBYTE(v15[26].m_transform.m_heading) = m_heading_low | 0x80;
          }
          return;
        }
        CCam::Process_1stPerson(CVector const&,float,float,float)::timeLastWheelieWheelCam = 0.0;
        TheCamera.m_fAvoidTheGeometryProbsTimer = 0.0;
        LOBYTE((*p_CamTargetEntity)[26].m_transform.m_heading) &= ~0x80u;
      }
    }
    v17 = (CBike *)*p_CamTargetEntity;
    m_pMat = (int)(*p_CamTargetEntity)->m_pMat;
    if ( !m_pMat )
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v17->m_transform, v17->m_pMat);
      m_pMat = (int)v17->m_pMat;
      v17 = (CBike *)*p_CamTargetEntity;
    }
    if ( v17->m_baseVehicleType == 9 )
    {
      CBike::CalculateLeanMatrix(v17);
      v17 = (CBike *)*p_CamTargetEntity;
      m_pMat = (int)&(*p_CamTargetEntity)[25].m_transform;
    }
    v19 = CModelInfo::ms_modelInfoPtrs[v17->m_nModelIndex];
    v20 = *(_DWORD *)&v19[1].m_modelName[20];
    m_hashKey = v19[2].m_hashKey;
    if ( v20 != 5 )
      m_hashKey += 48;
    v22 = *(_QWORD *)m_hashKey;
    v.z = *(RwReal *)(m_hashKey + 8);
    v.x = 0.0;
    v.z = v.z + 0.62;
    v.y = *((float *)&v22 + 1) + 0.08;
    this->FOV = 60.0;
    Multiply3x3(&v54, (const CMatrix *)m_pMat, &v);
    v23 = *(_QWORD *)&v54.x;
    this->Source.z = v54.z;
    *(_QWORD *)&this->Source.x = v23;
    v24 = (const CVehicle *)this->CamTargetEntity;
    y = this->Source.y;
    v26 = v24->m_pMat;
    z = this->Source.z;
    p_tx = &v26->tx;
    if ( !v26 )
      p_tx = &v24->m_transform.m_translate.x;
    this->Source.x = *p_tx + this->Source.x;
    this->Source.y = p_tx[1] + y;
    v29 = p_tx[2] + z;
    this->Source.z = v29;
    m_baseVehicleType = v24->m_baseVehicleType;
    if ( m_baseVehicleType == 9 )
    {
      if ( v24->pDriver )
      {
        pDriver = v24->pDriver;
        memset(&v54, 0, sizeof(v54));
        CPed::GetBonePosition(pDriver, &v54, 4u, 1);
        v33 = (float *)this->CamTargetEntity;
        v34 = v33[19];
        v35 = (float)(CTimer::ms_fTimeStep * v33[20]) + v54.z;
        v54.x = (float)(CTimer::ms_fTimeStep * v33[18]) + v54.x;
        v54.y = (float)(CTimer::ms_fTimeStep * v34) + v54.y;
        v54.z = v35;
        this->Source.z = v35 + fBike1stPersonOffsetZ;
        CrossProduct(&v52, &this->Front, &this->Up);
        x = this->Source.x;
        v37 = this->Source.y;
        v38 = this->Source.z;
        vecStart.x = x + v52.x;
        vecStart.y = v37 + v52.y;
        vecEnd.y = v37 - v52.y;
        vecEnd.x = x - v52.x;
        vecStart.z = v38 + v52.z;
        vecEnd.z = v38 - v52.z;
        if ( !CWorld::GetIsLineOfSightClear(&vecStart, &vecEnd, 1, 0, 0, 0, 0, 0, 0) )
        {
          v24 = (const CVehicle *)this->CamTargetEntity;
          v39 = v24->m_pMat;
          p_x = (_QWORD *)&v39->tx;
          if ( !v39 )
            p_x = (_QWORD *)&v24->m_transform.m_translate.x;
          *(_QWORD *)&this->Source.x = *p_x;
          v29 = v54.z + 0.62;
          v31 = fBike1stPersonOffsetZ;
          goto LABEL_40;
        }
        v24 = (const CVehicle *)*p_CamTargetEntity;
      }
    }
    else if ( m_baseVehicleType == 5 )
    {
      v31 = 0.5;
LABEL_40:
      this->Source.z = v29 + v31;
    }
    IsUpsideDown = CVehicle::IsUpsideDown(v24);
    v42 = dword_3C9B30;
    v43 = 0.5;
    if ( !IsUpsideDown )
    {
      v43 = 0.0;
      v42 = &dword_3C9B30[1];
    }
    if ( CCam::Process_1stPerson(CVector const&,float,float,float)::DontLookThroughWorldFixer < v43 )
      v43 = CCam::Process_1stPerson(CVector const&,float,float,float)::DontLookThroughWorldFixer + *(float *)v42;
    CCam::Process_1stPerson(CVector const&,float,float,float)::DontLookThroughWorldFixer = v43;
    this->Source.z = this->Source.z + v43;
    v44 = *(_QWORD *)(m_pMat + 16);
    this->Front.z = *(RwReal *)(m_pMat + 24);
    *(_QWORD *)&this->Front.x = v44;
    CVector::Normalise(&this->Front);
    v45 = *(_QWORD *)(m_pMat + 32);
    this->Up.z = *(RwReal *)(m_pMat + 40);
    *(_QWORD *)&this->Up.x = v45;
    CVector::Normalise(&this->Up);
    CrossProduct(&v52, &this->Front, &this->Up);
    v54 = v52;
    CVector::Normalise(&v54);
    CrossProduct(&v52, &v54, &this->Front);
    v46 = *(_QWORD *)&v52.x;
    this->Up.z = v52.z;
    *(_QWORD *)&this->Up.x = v46;
    CVector::Normalise(&this->Up);
    v52.x = 0.0;
    if ( CWaterLevel::GetWaterLevel(this->Source.x, this->Source.y, this->Source.z, &v52.x, 1, 0) == 1
      && this->Source.z < (float)(v52.x + -0.3) )
    {
      v47 = sqrtf(
              (float)((float)(CTimeCycle::m_CurrentColours.m_fWaterRed * CTimeCycle::m_CurrentColours.m_fWaterRed)
                    + (float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * CTimeCycle::m_CurrentColours.m_fWaterGreen))
            + (float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * CTimeCycle::m_CurrentColours.m_fWaterBlue));
      if ( v47 <= BOAT_UNDERWATER_CAM_COLORMAG_LIMIT )
      {
        TheCamera.m_BlurType = 2;
        TheCamera.m_BlurBlue = (int)CTimeCycle::m_CurrentColours.m_fWaterBlue;
        TheCamera.m_BlurGreen = (int)CTimeCycle::m_CurrentColours.m_fWaterGreen;
        TheCamera.m_BlurRed = (int)CTimeCycle::m_CurrentColours.m_fWaterRed;
        TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
      }
      else
      {
        v48 = BOAT_UNDERWATER_CAM_COLORMAG_LIMIT / v47;
        TheCamera.m_BlurType = 2;
        TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
        TheCamera.m_BlurBlue = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * v48);
        TheCamera.m_BlurGreen = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * v48);
        TheCamera.m_BlurRed = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterRed * v48);
      }
    }
LABEL_50:
    this->ResetStatics = 0;
  }
}
// 3C9676: variable 'v12' is possibly undefined
// 3C9676: variable 'v13' is possibly undefined
// 3C9676: variable 'v14' is possibly undefined
// 3C9676: variable 'bCheckPeds' is possibly undefined
// 3C9B30: using guessed type int dword_3C9B30[2];

//----- (003C9B60) --------------------------------------------------------
void __fastcall CCam::ProcessPedsDeadBaby(CCam *this)
{
  float32x2_t v1; // d0
  float32x2_t d14_0; // d14
  int v4; // r1
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v7; // d16
  float y; // s18
  float x; // s16
  float v10; // s20
  float z; // r9
  CEntity *pTargetEntity; // r6
  CMatrix *v13; // r0
  RwReal v14; // s2
  RwReal v15; // s4
  __int64 v16; // d16
  CEntity *v17; // r6
  CMatrix *v18; // r0
  float v19; // s6
  float v20; // s26
  float v21; // s24
  CEntity *v22; // r10
  float v23; // r0
  float v24; // s0
  float v25; // s22
  float v26; // s28
  float v27; // s30
  float v28; // r0
  __int64 v29; // d16
  __int64 v30; // d16
  CVector v2; // [sp+20h] [bp-98h] BYREF
  CVector TheCamPos; // [sp+30h] [bp-88h] BYREF
  float pWaterZ; // [sp+3Ch] [bp-7Ch] BYREF
  CVector v34; // [sp+40h] [bp-78h] BYREF
  RwV3d_0 posn; // [sp+50h] [bp-68h] BYREF
  CVector v36; // 0:r0.12
  CVector v37; // 0:r0.12

  v4 = *(_BYTE *)&TheCamera.pTargetEntity->m_info & 7;
  if ( v4 == 2 )
  {
    m_pMat = TheCamera.pTargetEntity->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &TheCamera.pTargetEntity->m_transform;
    v7 = *(_QWORD *)&p_tx->m_translate.x;
    posn.z = p_tx->m_translate.z;
    *(_QWORD *)&posn.x = v7;
    posn.z = CEntity::GetColModel(TheCamera.pTargetEntity)->m_boxBound.m_vecMax.z + posn.z;
  }
  else
  {
    if ( v4 != 3 )
      return;
    CPed::GetBonePosition((CPed *)TheCamera.pTargetEntity, &posn, 3u, 1);
  }
  if ( this->ResetStatics )
  {
    y = posn.y;
    x = posn.x;
    v10 = posn.z + DEADCAM_HEIGHT_START;
    TheCamera.m_uiTimeLastChange = CTimer::m_snTimeInMilliseconds;
    pWaterZ = 0.0;
    z = posn.z + DEADCAM_HEIGHT_START;
    if ( CWaterLevel::GetWaterLevelNoWaves(posn.x, posn.y, posn.z + DEADCAM_HEIGHT_START, &pWaterZ, 0, 0)
      && (float)(pWaterZ + 1.5) > v10 )
    {
      z = pWaterZ + 1.5;
      v10 = pWaterZ + 1.5;
    }
    pTargetEntity = TheCamera.pTargetEntity;
    v13 = TheCamera.pTargetEntity->m_pMat;
    if ( !v13 )
    {
      CPlaceable::AllocateMatrix(TheCamera.pTargetEntity);
      CSimpleTransform::UpdateMatrix(&pTargetEntity->m_transform, pTargetEntity->m_pMat);
      v13 = pTargetEntity->m_pMat;
    }
    v2.x = 0.0;
    v2.y = 0.0;
    v2.z = 1.0;
    CrossProduct(&TheCamPos, (const CVector *)&v13->xy, &v2);
    v34.x = TheCamPos.x;
    v34.y = TheCamPos.y;
    v34.z = 0.0;
    CVector::Normalise(&v34);
    v14 = posn.y - y;
    v15 = posn.z - v10;
    this->Front.x = posn.x - x;
    this->Front.y = v14;
    this->Front.z = v15;
    CVector::Normalise(&this->Front);
    CrossProduct(&TheCamPos, &v34, &this->Front);
    v16 = *(_QWORD *)&TheCamPos.x;
    this->Up.z = TheCamPos.z;
    *(_QWORD *)&this->Up.x = v16;
    CVector::Normalise(&this->Up);
    this->ResetStatics = 0;
  }
  else
  {
    z = this->Source.z;
    x = this->Source.x;
    y = this->Source.y;
    v36.x = x + 0.0;
    v36.y = y + 0.0;
    v36.z = z + 0.2;
    if ( !CWorld::TestSphereAgainstWorld(v36, 0.3, TheCamera.pTargetEntity, 1, 1, 0, 1, 0, 1) )
      z = (float)(DEADCAM_HEIGHT_RATE * CTimer::ms_fTimeStep) + z;
    v17 = TheCamera.pTargetEntity;
    v18 = TheCamera.pTargetEntity->m_pMat;
    if ( !v18 )
    {
      CPlaceable::AllocateMatrix(TheCamera.pTargetEntity);
      CSimpleTransform::UpdateMatrix(&v17->m_transform, v17->m_pMat);
      v18 = v17->m_pMat;
    }
    *(_QWORD *)&v2.x = 0LL;
    v2.z = 1.0;
    CrossProduct(&TheCamPos, (const CVector *)&v18->xy, &v2);
    v34.x = TheCamPos.x;
    v34.y = TheCamPos.y;
    v34.z = 0.0;
    CVector::Normalise(&v34);
    d14_0.n64_f32[0] = (float)(CTimer::m_snTimeInMilliseconds - TheCamera.m_uiTimeLastChange);
    v1.n64_u32[0] = 1148846080;
    v19 = sinf(d14_0.n64_f32[0] / DEADCAM_WAFT_RATE) * (float)(vmin_f32(d14_0, v1).n64_f32[0] / 1000.0);
    TheCamPos.z = 0.0;
    v20 = (float)((float)(DEADCAM_WAFT_AMPLITUDE * v34.y) * v19) + posn.y;
    v21 = posn.x + (float)((float)(DEADCAM_WAFT_AMPLITUDE * v34.x) * v19);
    TheCamPos.y = v20 - y;
    TheCamPos.x = v21 - x;
    CVector::Normalise(&TheCamPos);
    v37.x = x + (float)(TheCamPos.x * 0.2);
    v37.y = y + (float)(TheCamPos.y * 0.2);
    v37.z = (float)(TheCamPos.z * 0.2) + z;
    v22 = CWorld::TestSphereAgainstWorld(v37, 0.3, TheCamera.pTargetEntity, 1, 1, 0, 1, 0, 1);
    v1.n64_u32[0] = 1157234688;
    v23 = d14_0.n64_f32[0] / DEADCAM_WAFT_RATE;
    v24 = vmin_f32(d14_0, v1).n64_f32[0] / 2000.0;
    v25 = v24 * (float)(DEADCAM_WAFT_TILT_AMP * v34.x);
    v26 = v24 * (float)(DEADCAM_WAFT_TILT_AMP * v34.z);
    v27 = v24 * (float)(DEADCAM_WAFT_TILT_AMP * v34.y);
    v28 = cosf(v23);
    this->Front.x = (float)(v25 * v28) + 0.0;
    this->Front.y = (float)(v27 * v28) + 0.0;
    this->Front.z = (float)(v26 * v28) + -1.0;
    CVector::Normalise(&this->Front);
    CrossProduct(&v2, &v34, &this->Front);
    v29 = *(_QWORD *)&v2.x;
    this->Up.z = v2.z;
    *(_QWORD *)&this->Up.x = v29;
    CVector::Normalise(&this->Up);
    if ( !v22 )
    {
      y = v20;
      x = v21;
    }
  }
  this->Source.x = x;
  this->Source.y = y;
  this->Source.z = z;
  v30 = *(_QWORD *)&this->Source.x;
  TheCamPos.z = this->Source.z;
  *(_QWORD *)&TheCamPos.x = v30;
  CCamera::AvoidTheGeometry(&TheCamera, &TheCamPos, (const CVector *)&posn, &this->Source, this->FOV);
  TheCamera.m_bMoveCamToAvoidGeom = 0;
}
// 3C9DCA: variable 'd14_0' is possibly undefined
// 3C9DCA: variable 'v1' is possibly undefined
// 2A: using guessed type __int16 word_2A;
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003C9FC4) --------------------------------------------------------
void __fastcall CCam::Process_Cam_TwoPlayer(CCam *this)
{
  CVehicle *m_pMyVehicle; // r2
  float v2; // r3
  float32x2_t v3; // d1
  float32x2_t v4; // d2
  float32x2_t v5; // d4
  float32x2_t v6; // d10
  bool v8; // zf
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r1
  CPlayerPed *pPed; // r0
  bool v12; // zf
  float v13; // r2
  const CVector *v14; // r1
  int v15; // r4
  float Beta; // s16
  int v17; // r5
  float v18; // s2
  CCam *v19; // r0
  int v20; // r10
  uint32 v21; // r0
  CMatrix *v22; // r0
  const CVector *p_m_translate; // r1
  CMatrix *v24; // r0
  const CVector *v25; // r1
  CPlayerPed *v26; // r0
  float v27; // s0
  float v28; // s2
  float v29; // s2
  float v30; // s4
  float v31; // s2
  float v32; // s22
  float v33; // s24
  float v34; // s2
  float v35; // s0
  float v36; // s24
  float fDiffBetaSwing; // s28
  float fDiffBetaSwingCap; // s30
  float v39; // s17
  float v40; // s2
  float v41; // s0
  float v42; // s6
  float v43; // s0
  CCam *v44; // r0
  float v45; // s0
  float v46; // s4
  float v47; // s0
  float v48; // s22
  float v49; // r0
  float fDiffBetaCap; // s24
  float v51; // r6
  CPad *Pad; // r0
  float v53; // r5
  CPad *v54; // r0
  float v55; // r0
  float v56; // s2
  float v57; // s0
  float v58; // s26
  CCam *v59; // r0
  float v60; // s4
  float v61; // s0
  float v62; // r1
  __int64 v63; // d16
  GxtChar *v64; // r0
  __int64 v65; // d16
  CVector *pTarget; // [sp+0h] [bp-D8h]
  CVector refEntityPtr; // [sp+20h] [bp-B8h] BYREF
  CColPoint colPoint; // [sp+30h] [bp-A8h] BYREF
  CVector pLookAt; // [sp+60h] [bp-78h] BYREF
  CVector pSource; // [sp+6Ch] [bp-6Ch] BYREF

  if ( CGameLogic::n2PlayerPedInFocus != 1 )
  {
    if ( !CGameLogic::n2PlayerPedInFocus )
    {
      v8 = *((unsigned __int8 *)&CWorld::Players[0].pPed->m_nPedFlags + 1) << 31 == 0;
      if ( *((unsigned __int8 *)&CWorld::Players[0].pPed->m_nPedFlags + 1) << 31 )
      {
        m_pMyVehicle = CWorld::Players[0].pPed->m_pMyVehicle;
        v8 = m_pMyVehicle == 0;
      }
      if ( v8 )
      {
        m_pMat = CWorld::Players[0].pPed->m_pMat;
        p_tx = (CSimpleTransform *)&m_pMat->tx;
        if ( !m_pMat )
          p_tx = &CWorld::Players[0].pPed->m_transform;
        CCam::Process_FollowPed_SA(this, &p_tx->m_translate, *(float *)&m_pMat, v2, *(float *)&pTarget, 0);
      }
      else
      {
        this->CamTargetEntity = m_pMyVehicle;
        v22 = m_pMyVehicle->m_pMat;
        p_m_translate = (const CVector *)&v22->tx;
        if ( !v22 )
          p_m_translate = &m_pMyVehicle->m_transform.m_translate;
        CCam::Process_FollowCar_SA(this, p_m_translate, *(float *)&m_pMyVehicle, v2, *(float *)&pTarget, 0);
        this->CamTargetEntity = CWorld::Players[0].pPed;
      }
      this->ResetStatics = 0;
      return;
    }
    v15 = 0;
    this->Alpha = -0.5236;
    this->AlphaSpeed = 0.0;
    Beta = this->Beta;
    do
    {
      v17 = v15;
      if ( v15 > 20 )
      {
        if ( v15 == 21 )
        {
          Beta = this->Beta;
          v20 = 1;
          v17 = 21;
        }
        else
        {
          v20 = 0;
        }
        goto LABEL_35;
      }
      ++v15;
      v18 = (float)((unsigned int)(v17 + 1) >> 1) * 0.15;
      if ( (v17 & 1) == 0 )
        v18 = -v18;
      Beta = v18 + this->Beta;
      CCam::Process_Cam_TwoPlayer_CalcSource(this, Beta, &pSource, &pLookAt, &this->m_cvecTargetCoorsForFudgeInter);
    }
    while ( !CCam::Process_Cam_TwoPlayer_TestLOSs(v19, pSource) );
    v20 = 0;
    v21 = CTimer::m_snTimeInMilliseconds;
    gLastTime2PlayerCameraWasOK = CTimer::m_snTimeInMilliseconds;
    if ( v17 < 1 )
      goto LABEL_36;
LABEL_35:
    v21 = CTimer::m_snTimeInMilliseconds;
    gLastTime2PlayerCameraCollided = CTimer::m_snTimeInMilliseconds;
LABEL_36:
    if ( this->ResetStatics )
    {
      this->Beta = Beta;
      v27 = Beta;
    }
    else
    {
      v27 = this->Beta;
    }
    if ( Beta <= (float)(v27 + 3.1416) )
    {
      v29 = Beta;
      if ( Beta >= (float)(v27 + -3.1416) )
      {
LABEL_44:
        v30 = (float)(v29 - v27) * 0.2;
        v31 = 0.1;
        if ( v30 <= 0.1 )
        {
          v31 = v30;
          if ( v30 < -0.1 )
            v31 = -0.1;
        }
        v32 = v31 + v27;
        v33 = 0.0;
        if ( v17 || v21 < gLastTime2PlayerCameraCollided + 1000 )
        {
LABEL_72:
          v45 = this->Beta;
          v3.n64_f32[0] = v32 + v33;
          if ( (float)(v32 + v33) <= (float)(v45 + 3.1416) )
          {
            if ( v3.n64_f32[0] >= (float)(v45 + -3.1416) )
              goto LABEL_77;
            v46 = 6.2832;
          }
          else
          {
            v46 = -6.2832;
          }
          v3.n64_f32[0] = v3.n64_f32[0] + v46;
LABEL_77:
          v47 = v3.n64_f32[0] - v45;
          v6.n64_u32[0] = 1.0;
          v3.n64_f32[0] = CTimer::ms_fTimeStep;
          v48 = v47 / vmax_f32(v3, v6).n64_f32[0];
          v49 = powf(PEDCAM_SET[2].fDiffBetaRate, CTimer::ms_fTimeStep);
          fDiffBetaCap = PEDCAM_SET[2].fDiffBetaCap;
          v51 = v49;
          if ( !v17 && CTimer::m_snTimeInMilliseconds >= gLastTime2PlayerCameraCollided + 1000 )
          {
            Pad = CPad::GetPad(0);
            v53 = CPad::AimWeaponLeftRight(Pad, CWorld::Players[0].pPed, 0);
            CHID::currentInstanceIndex = 1;
            v54 = CPad::GetPad(1);
            v55 = CPad::AimWeaponLeftRight(v54, CWorld::Players[1].pPed, 0);
            CHID::currentInstanceIndex = 0;
            v56 = COERCE_FLOAT(LODWORD(v55) ^ 0x80000000) - v53;
            v57 = 128.0;
            if ( v56 <= 128.0 )
            {
              v57 = COERCE_FLOAT(LODWORD(v55) ^ 0x80000000) - v53;
              if ( v56 < -128.0 )
                v57 = -128.0;
            }
            v58 = (float)(v57 * (float)(fabsf(v57) * (float)(AIMWEAPON_STICK_SENS * AIMWEAPON_STICK_SENS)))
                * (float)((float)(this->FOV / 80.0) * 0.071429);
            if ( v58 <= 0.01 )
            {
              if ( v58 < 0.01 )
                Beta = Beta + -0.15;
            }
            else
            {
              Beta = Beta + 0.15;
            }
            if ( fabsf(v58) > 0.01 )
            {
              CCam::Process_Cam_TwoPlayer_CalcSource(
                this,
                Beta,
                &pSource,
                &pLookAt,
                &this->m_cvecTargetCoorsForFudgeInter);
              if ( !CCam::Process_Cam_TwoPlayer_TestLOSs(v59, pSource) )
              {
                if ( v58 > 0.0 && this->BetaSpeed > 0.0 || v58 < 0.0 && this->BetaSpeed < 0.0 )
                  this->BetaSpeed = 0.0;
                v58 = 0.0;
                gLastTime2PlayerCameraCollided = CTimer::m_snTimeInMilliseconds;
              }
            }
            v48 = v48 + v58;
          }
          if ( v48 <= fDiffBetaCap )
          {
            if ( v48 < (float)-fDiffBetaCap )
              v48 = -fDiffBetaCap;
          }
          else
          {
            v48 = fDiffBetaCap;
          }
          v60 = this->Beta;
          v61 = (float)((float)(1.0 - v51) * v48) + (float)(v51 * this->BetaSpeed);
          this->BetaSpeed = v61;
          v62 = v60 + (float)(v61 * CTimer::ms_fTimeStep);
          this->Beta = v62;
          CCam::Process_Cam_TwoPlayer_CalcSource(
            this,
            v62,
            &this->Source,
            &this->Front,
            &this->m_cvecTargetCoorsForFudgeInter);
          if ( v20 == 1 && CTimer::m_snTimeInMilliseconds - gLastTime2PlayerCameraWasOK > 0x1F4 )
          {
            gCurCamColVars = 5;
            refEntityPtr.x = 0.0;
            if ( CWorld::ProcessLineOfSight(
                   &this->m_cvecTargetCoorsForFudgeInter,
                   &this->Source,
                   &colPoint,
                   (CEntity **)&refEntityPtr,
                   1,
                   0,
                   0,
                   0,
                   0,
                   1,
                   1,
                   0) == 1 )
            {
              v63 = *(_QWORD *)&colPoint.m_vecPosition.x;
              this->Source.z = colPoint.m_vecPosition.z;
              *(_QWORD *)&this->Source.x = v63;
            }
            if ( CTimer::m_snTimeInMilliseconds > CGameLogic::nPrintFocusHelpTimer
              && CGameLogic::nPrintFocusHelpCounter <= 5 )
            {
              v64 = CText::Get(&TheText, "WRN2_2P");
              CHud::SetHelpMessage("WRN2_2P", v64, 0, 0, 0, 0);
              CGameLogic::nPrintFocusHelpTimer = CTimer::m_snTimeInMilliseconds + 60000;
              ++CGameLogic::nPrintFocusHelpCounter;
            }
          }
          this->Up.x = 0.0;
          this->Up.y = 0.0;
          this->Up.z = 1.0;
          CVector::Normalise(&this->Up);
          CrossProduct(&colPoint.m_vecPosition, &this->Up, &this->Front);
          CVector::Normalise(&colPoint.m_vecPosition);
          CrossProduct(&refEntityPtr, &this->Front, &colPoint.m_vecPosition);
          v65 = *(_QWORD *)&refEntityPtr.x;
          this->Up.z = refEntityPtr.z;
          *(_QWORD *)&this->Up.x = v65;
          CVector::Normalise(&this->Up);
          this->ResetStatics = 0;
          this->FOV = 70.0;
          return;
        }
        v34 = CWorld::Players[0].pPed->m_vecMoveSpeed.x + CWorld::Players[1].pPed->m_vecMoveSpeed.x;
        v35 = CWorld::Players[0].pPed->m_vecMoveSpeed.y + CWorld::Players[1].pPed->m_vecMoveSpeed.y;
        v36 = (float)((float)(v34 * v34) + (float)(v35 * v35))
            + (float)((float)(CWorld::Players[0].pPed->m_vecMoveSpeed.z + CWorld::Players[1].pPed->m_vecMoveSpeed.z)
                    * (float)(CWorld::Players[0].pPed->m_vecMoveSpeed.z + CWorld::Players[1].pPed->m_vecMoveSpeed.z));
        if ( v36 <= 0.01 )
        {
          v33 = 0.0;
          goto LABEL_53;
        }
        fDiffBetaSwing = PEDCAM_SET[2].fDiffBetaSwing;
        fDiffBetaSwingCap = PEDCAM_SET[2].fDiffBetaSwingCap;
        v39 = CTimer::ms_fTimeStep;
        v40 = atan2f(
                -(float)(CWorld::Players[0].pPed->m_vecMoveSpeed.x + CWorld::Players[1].pPed->m_vecMoveSpeed.x),
                CWorld::Players[0].pPed->m_vecMoveSpeed.y + CWorld::Players[1].pPed->m_vecMoveSpeed.y)
            + -1.5708;
        v41 = v39 * fDiffBetaSwingCap;
        if ( (float)(v40 - v32) <= 3.1416 )
        {
          if ( (float)(v40 - v32) >= -3.1416 )
          {
LABEL_57:
            v5.n64_u32[0] = 1.0;
            v4.n64_f32[0] = sqrtf(v36) * (float)(fDiffBetaSwing * v39);
            v33 = vmin_f32(v4, v5).n64_f32[0] * (float)(v40 - v32);
            if ( v33 <= v41 )
            {
              v43 = -v41;
              if ( v33 < v43 )
                v33 = v43;
            }
            else
            {
              v33 = v39 * fDiffBetaSwingCap;
            }
            if ( v33 > 0.01 )
            {
              Beta = Beta + 0.15;
              goto LABEL_64;
            }
            if ( v33 >= 0.01 )
              goto LABEL_64;
LABEL_53:
            Beta = Beta + -0.15;
LABEL_64:
            if ( fabsf(v33) > 0.01 )
            {
              CCam::Process_Cam_TwoPlayer_CalcSource(
                this,
                Beta,
                &pSource,
                &pLookAt,
                &this->m_cvecTargetCoorsForFudgeInter);
              if ( !CCam::Process_Cam_TwoPlayer_TestLOSs(v44, pSource) )
              {
                if ( v33 > 0.0 && this->BetaSpeed > 0.0 || v33 < 0.0 && this->BetaSpeed < 0.0 )
                  this->BetaSpeed = 0.0;
                v33 = 0.0;
                gLastTime2PlayerCameraCollided = CTimer::m_snTimeInMilliseconds;
              }
            }
            goto LABEL_72;
          }
          v42 = 6.2832;
        }
        else
        {
          v42 = -6.2832;
        }
        v40 = v40 + v42;
        goto LABEL_57;
      }
      v28 = 6.2832;
    }
    else
    {
      v28 = -6.2832;
    }
    v29 = Beta + v28;
    goto LABEL_44;
  }
  pPed = CWorld::Players[1].pPed;
  v12 = *((unsigned __int8 *)&CWorld::Players[1].pPed->m_nPedFlags + 1) << 31 == 0;
  if ( *((unsigned __int8 *)&CWorld::Players[1].pPed->m_nPedFlags + 1) << 31 )
  {
    m_pMyVehicle = CWorld::Players[1].pPed->m_pMyVehicle;
    v12 = m_pMyVehicle == 0;
  }
  if ( v12 )
  {
    this->CamTargetEntity = CWorld::Players[1].pPed;
    v13 = *(float *)&pPed->m_pMat;
    v14 = (const CVector *)(LODWORD(v13) + 48);
    if ( v13 == 0.0 )
      v14 = &pPed->m_transform.m_translate;
    CCam::Process_FollowPed_SA(this, v14, v13, v2, *(float *)&pTarget, 0);
  }
  else
  {
    this->CamTargetEntity = m_pMyVehicle;
    v24 = m_pMyVehicle->m_pMat;
    v25 = (const CVector *)&v24->tx;
    if ( !v24 )
      v25 = &m_pMyVehicle->m_transform.m_translate;
    CCam::Process_FollowCar_SA(this, v25, *(float *)&m_pMyVehicle, v2, *(float *)&pTarget, 0);
  }
  v26 = CWorld::Players[0].pPed;
  this->ResetStatics = 0;
  this->CamTargetEntity = v26;
}
// 3CA012: variable 'v2' is possibly undefined
// 3CA012: variable 'pTarget' is possibly undefined
// 3CA0B4: variable 'v19' is possibly undefined
// 3CA0EC: variable 'm_pMyVehicle' is possibly undefined
// 3CA2D8: variable 'v4' is possibly undefined
// 3CA2D8: variable 'v5' is possibly undefined
// 3CA338: variable 'v44' is possibly undefined
// 3CA40C: variable 'v3' is possibly undefined
// 3CA40C: variable 'v6' is possibly undefined
// 3CA524: variable 'v59' is possibly undefined
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003CA7C8) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
void __fastcall CCam::Process_Cam_TwoPlayer_InCarAndShooting(CCam *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float32x2_t v3; // d9
  float32x2_t v4; // d12
  CPlayerPed *pPed; // r9
  CVehicle *m_pMyVehicle; // r8
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v10; // d16
  float m_heading; // s16
  CPlayerPed *pDriver; // r5
  CPad *Pad; // r10
  CPlayerInfo *v14; // r1
  int32 m_vehicleType; // r0
  CPed *v16; // r11
  bool v17; // zf
  float v18; // s0
  float FOV; // s0
  float v20; // s0
  float v21; // s18
  float v22; // s20
  float v23; // s2
  float v24; // s0
  eWeaponType m_eWeaponType; // r4
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r3
  CMatrix *v28; // r2
  __int64 *p_m_transform; // r4
  __int64 v30; // kr00_8 OVERLAPPED
  const CVehicle *NearestTargetEntityWithScreenCoors; // r10
  float v32; // s22
  float v33; // r0
  float X_Targetting; // s2
  float v35; // s0
  float v36; // s6
  float v37; // s8
  float v38; // s2
  float Y_Targetting; // s6
  float v40; // s4
  float v41; // s0
  float v42; // s4
  float v43; // s22
  float v44; // s2
  float v45; // s4
  float v46; // s6
  float v47; // s4
  float Alpha; // s6
  float v49; // s4
  float v50; // s8
  float v51; // s6
  float v52; // s0
  float v53; // s4
  float v54; // s6
  float z; // s18
  float v56; // s0
  float v57; // s28
  float v58; // s0
  float v59; // s21
  float *p_xx; // r1
  RwReal v61; // s2
  RwReal v62; // s4
  float y; // s2
  float v64; // s23
  float x; // s0
  float v66; // s17
  float v67; // s28
  float v68; // s30
  float v69; // s27
  float v70; // s29
  float v71; // r1
  float v72; // s31
  float v73; // r0
  float v74; // r0
  float v75; // s0
  float v76; // s0
  float v77; // s2
  float v78; // s23
  float v79; // r0
  float v80; // s2
  float v81; // s4
  float v82; // r0
  float v83; // s16
  float v84; // s2
  int *v85; // r1
  float v86; // r0
  float v87; // r2
  float v88; // s16
  __int64 v89; // d16
  __int64 v90; // d16
  float v91; // r4
  float v92; // s22
  float v93; // s26
  float v94; // s24
  float v95; // r5
  float v96; // r0
  RwReal v97; // s2
  RwReal v98; // s0
  __int64 v99; // d16
  int v100; // r0
  float *p_x; // r1
  float v102; // s2
  float v103; // s6
  float v104; // s4
  float v105; // s16
  CTask *m_pParent; // s22
  int (**v107)(void); // s20
  float v108; // s8
  float v109; // s2
  float v110; // s6
  float v111; // s10
  float v112; // s4
  float v113; // s8
  float v114; // s2
  float v115; // s4
  float v116; // s6
  CPed *v117; // r4
  float v118; // s16
  CMatrix *v119; // r0
  float v120; // s0
  float v121; // s16
  float v122; // s0
  bool v123; // r0
  float v124; // r3
  eWeaponType v125; // r5
  int8 v126; // r0
  __int64 fFOV; // [sp+0h] [bp-100h]
  CWeaponInfo *v128; // [sp+10h] [bp-F0h]
  CPad *v129; // [sp+14h] [bp-ECh]
  CTaskSimpleGangDriveBy v130; // [sp+18h] [bp-E8h] BYREF
  CVector TheCamPos; // [sp+60h] [bp-A0h] BYREF
  float v132; // [sp+70h] [bp-90h] BYREF
  float pTargetScreenX; // [sp+74h] [bp-8Ch] BYREF
  CVector2D pVecOut; // [sp+78h] [bp-88h] BYREF
  CVector TargetCoors; // [sp+80h] [bp-80h] BYREF
  CVector v136; // [sp+90h] [bp-70h] BYREF

  if ( (*(_BYTE *)&this->CamTargetEntity->m_info & 7) == 2 )
  {
    pPed = CWorld::Players[0].pPed;
    m_pMyVehicle = CWorld::Players[0].pPed->m_pMyVehicle;
    m_pMat = m_pMyVehicle->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &m_pMyVehicle->m_transform;
    v10 = *(_QWORD *)&p_tx->m_translate.x;
    TargetCoors.z = p_tx->m_translate.z;
    *(_QWORD *)&TargetCoors.x = v10;
    if ( m_pMat )
      m_heading = atan2f(COERCE_FLOAT(LODWORD(m_pMat->xy) ^ 0x80000000), m_pMat->yy);
    else
      m_heading = m_pMyVehicle->m_transform.m_heading;
    pDriver = (CPlayerPed *)m_pMyVehicle->pDriver;
    Pad = CPad::GetPad(pDriver == pPed);
    v14 = CWorld::Players;
    CHID::currentInstanceIndex = pDriver == pPed;
    currentPad = Pad;
    m_vehicleType = m_pMyVehicle->m_vehicleType;
    if ( pDriver == pPed )
      v14 = &CWorld::Players[1];
    v16 = v14->pPed;
    v17 = m_vehicleType == 9;
    if ( m_vehicleType != 9 )
      v17 = m_vehicleType == 0;
    if ( v17 )
    {
      v18 = (float)((float)(m_pMyVehicle->m_vecMoveSpeed.x * m_pMyVehicle->m_pMat->xy)
                  + (float)(m_pMyVehicle->m_vecMoveSpeed.y * m_pMyVehicle->m_pMat->yy))
          + (float)(m_pMyVehicle->m_vecMoveSpeed.z * m_pMyVehicle->m_pMat->zy);
      if ( v18 > CAR_FOV_START_SPEED )
        this->FOV = this->FOV + (float)((float)(v18 - CAR_FOV_START_SPEED) * CTimer::ms_fTimeStep);
    }
    FOV = this->FOV;
    if ( FOV > 70.0 )
    {
      FOV = (float)((float)(FOV + -70.0) * powf(CAR_FOV_FADE_MULT, CTimer::ms_fTimeStep)) + 70.0;
      this->FOV = FOV;
    }
    if ( FOV <= 100.0 )
    {
      if ( FOV < 70.0 )
        this->FOV = 70.0;
    }
    else
    {
      this->FOV = 100.0;
    }
    pVecOut.x = 0.0;
    pVecOut.y = 0.0;
    v129 = Pad;
    CPad::GetLeftAnalogue(Pad, &pVecOut);
    v20 = this->FOV / 80.0;
    v21 = fabsf(pVecOut.y);
    v22 = fabsf(pVecOut.x);
    v23 = this->X_Targetting
        + (float)(CTimer::ms_fTimeStep * (float)((float)(pVecOut.x * (float)(v22 * 0.000036)) * (float)(v20 * 0.071429)));
    v24 = this->Y_Targetting
        + (float)(CTimer::ms_fTimeStep * (float)((float)(pVecOut.y * (float)(v21 * 0.000036)) * (float)(v20 * 0.042857)));
    this->X_Targetting = v23;
    this->Y_Targetting = v24;
    m_eWeaponType = v16->m_WeaponSlots[v16->m_nCurrentWeapon].m_eWeaponType;
    WeaponSkill = CPed::GetWeaponSkill(v16);
    WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
    v28 = v16->m_pMat;
    v128 = WeaponInfo;
    p_m_transform = (__int64 *)&v28->tx;
    if ( !v28 )
      p_m_transform = (__int64 *)&v16->m_transform;
    v30 = *p_m_transform;
    fFOV = *(__int64 *)((char *)p_m_transform + 4);
    NearestTargetEntityWithScreenCoors = CWeapon::FindNearestTargetEntityWithScreenCoors(
                                           this->X_Targetting,
                                           this->Y_Targetting,
                                           WeaponInfo->m_fWeaponRange + WeaponInfo->m_fWeaponRange,
                                           *(CVector *)&v30,
                                           &pTargetScreenX,
                                           &v132);
    if ( v21 > 0.1 )
      NearestTargetEntityWithScreenCoors = 0;
    if ( v22 > 0.1 )
      NearestTargetEntityWithScreenCoors = 0;
    if ( !v16->m_WeaponSlots[v16->m_nCurrentWeapon].m_nAmmoTotal
      && v16->m_WeaponSlots[v16->m_nCurrentWeapon].m_eWeaponType )
    {
      CPed::SetCurrentWeapon(v16, WEAPONTYPE_UNARMED);
    }
    if ( v21 < 120.0 && NearestTargetEntityWithScreenCoors )
    {
      v32 = CTimer::ms_fTimeStep;
      v33 = powf(0.85, CTimer::ms_fTimeStep);
      X_Targetting = this->X_Targetting;
      v35 = v32 * 0.01;
      v36 = (float)(pTargetScreenX - X_Targetting) * (float)(1.0 - v33);
      v37 = v32 * 0.01;
      if ( v36 <= (float)(v32 * 0.01) )
      {
        v37 = (float)(pTargetScreenX - X_Targetting) * (float)(1.0 - v33);
        if ( v36 < (float)(v32 * -0.01) )
          v37 = v32 * -0.01;
      }
      v38 = v37 + X_Targetting;
      Y_Targetting = this->Y_Targetting;
      this->X_Targetting = v38;
      v40 = (float)(v132 - Y_Targetting) * (float)(1.0 - v33);
      if ( v40 <= v35 )
      {
        v35 = (float)(v132 - Y_Targetting) * (float)(1.0 - v33);
        if ( v40 < (float)(v32 * -0.01) )
          v35 = v32 * -0.01;
      }
      this->Y_Targetting = v35 + Y_Targetting;
    }
    else
    {
      v38 = this->X_Targetting;
    }
    v41 = 0.9;
    if ( v38 <= 0.9 )
    {
      v41 = -0.9;
      if ( v38 >= -0.9 )
      {
        v43 = 0.0;
        v41 = v38;
LABEL_46:
        v44 = 0.9;
        v45 = this->Y_Targetting;
        if ( v45 <= 0.9 )
        {
          v44 = -0.9;
          if ( v45 >= -0.9 )
          {
            v44 = this->Y_Targetting;
            goto LABEL_52;
          }
          v46 = 0.9;
        }
        else
        {
          v46 = -0.9;
        }
        v47 = (float)((float)(v45 + v46) * -0.5) * CTimer::ms_fTimeStep;
        Alpha = this->Alpha;
        this->Y_Targetting = v44;
        this->Alpha = Alpha + v47;
LABEL_52:
        v4.n64_u32[0] = 1.0;
        if ( v22 < 1.0 && !NearestTargetEntityWithScreenCoors )
        {
          v49 = v44 + 0.4;
          v50 = CTimer::ms_fTimeStep * 0.002;
          v51 = sqrtf((float)(v41 * v41) + (float)(v49 * v49));
          if ( v51 >= (float)(CTimer::ms_fTimeStep * 0.002) )
          {
            v53 = (float)(v49 * v50) / v51;
            v54 = v41 - (float)((float)(v41 * v50) / v51);
            v52 = v44 - v53;
            this->X_Targetting = v54;
          }
          else
          {
            v52 = -0.4;
            this->X_Targetting = 0.0;
          }
          this->Y_Targetting = v52;
        }
        z = CEntity::GetColModel(m_pMyVehicle)->m_boxBound.m_vecMax.z;
        v56 = fabsf(CEntity::GetColModel(m_pMyVehicle)->m_boxBound.m_vecMin.y);
        v57 = (float)(v56 + v56) + 0.5;
        if ( CVehicle::GetVehicleAppearance(m_pMyVehicle) == APR_HELI && (*(_BYTE *)&m_pMyVehicle->m_info & 0xF8) != 64 )
        {
          p_xx = &m_pMyVehicle->m_pMat->xx;
          v59 = -0.34907;
          v61 = (float)(z * (float)(fTestShiftHeliCamTarget * p_xx[9])) + TargetCoors.y;
          v62 = (float)(z * (float)(fTestShiftHeliCamTarget * p_xx[10])) + TargetCoors.z;
          TargetCoors.x = (float)(z * (float)(fTestShiftHeliCamTarget * p_xx[8])) + TargetCoors.x;
          TargetCoors.y = v61;
          TargetCoors.z = v62;
        }
        else
        {
          v58 = (float)(z * CARCAM_SET[0].fTargetOffsetZ) - CARCAM_SET[0].fBaseCamZ;
          if ( v58 <= 0.0 )
          {
            v59 = -0.34907;
          }
          else
          {
            v57 = v57 + v58;
            v59 = (float)((float)(v58 * 0.3) / v57) + -0.34907;
            TargetCoors.z = v58 + TargetCoors.z;
          }
        }
        v3.n64_u32[0] = 2.0;
        y = this->Source.y;
        v64 = v57 * 0.9;
        x = this->Source.x;
        v66 = v57 + 2.0;
        this->CA_MIN_DISTANCE = v57 * 0.9;
        this->CA_MAX_DISTANCE = v57 + 2.0;
        v67 = TargetCoors.x;
        v68 = TargetCoors.y;
        v69 = x - TargetCoors.x;
        v70 = y - TargetCoors.y;
        v71 = TargetCoors.y - y;
        v72 = sqrtf((float)(v69 * v69) + (float)(v70 * v70));
        v73 = -(float)(TargetCoors.x - x);
        this->m_fDistanceBeforeChanges = v72;
        v74 = atan2f(v73, v71);
        if ( v72 < 0.002 )
          v72 = 0.002;
        this->Beta = v74 + -1.5708;
        v75 = v66;
        if ( v72 > v66 || (v75 = v64, v72 < v64) )
        {
          v76 = v75 / v72;
          this->Source.x = v67 + (float)(v69 * v76);
          this->Source.y = v68 + (float)(v70 * v76);
        }
        v77 = (float)(m_pMyVehicle->m_vecMoveSpeed.x * m_pMyVehicle->m_vecMoveSpeed.x)
            + (float)(m_pMyVehicle->m_vecMoveSpeed.y * m_pMyVehicle->m_vecMoveSpeed.y);
        v78 = v77 + (float)(m_pMyVehicle->m_vecMoveSpeed.z * m_pMyVehicle->m_vecMoveSpeed.z);
        if ( v78 <= 0.0001 )
        {
          v1.n64_u32[0] = LODWORD(this->Alpha);
        }
        else
        {
          v79 = atan2f(m_pMyVehicle->m_vecMoveSpeed.z, sqrtf(v77));
          v80 = 5.0;
          v1.n64_f32[0] = sqrtf(v78) + -0.01;
          v81 = v79;
          if ( m_pMyVehicle->m_vehicleType == 3 )
            v80 = 3.0;
          v1.n64_f32[0] = v1.n64_f32[0] * v80;
          v1.n64_u64[0] = vmin_f32(v1, v4).n64_u64[0];
          v82 = powf(0.96, CTimer::ms_fTimeStep);
          v1.n64_f32[0] = (float)(v82 * this->Alpha)
                        + (float)((float)(1.0 - v82) * (float)(v59 + (float)(v81 * v1.n64_f32[0])));
          LODWORD(this->Alpha) = v1.n64_u32[0];
        }
        v83 = m_heading + -1.5708;
        v84 = -1.0472;
        v85 = dword_3CB398;
        if ( m_pMyVehicle->m_vehicleType == 3 )
          v85 = &dword_3CB398[1];
        if ( v1.n64_f32[0] < -1.0472 || (v84 = *(float *)v85, v1.n64_f32[0] > *(float *)v85) )
        {
          v1.n64_f32[0] = v84;
          this->Alpha = v84;
        }
        v86 = sinf(v1.n64_f32[0]);
        v87 = v83;
        v88 = TargetCoors.z;
        this->Source.z = TargetCoors.z - (float)(v66 * v86);
        CCam::RotCamIfInFrontCar(this, &TargetCoors, v87);
        v89 = *(_QWORD *)&TargetCoors.x;
        this->m_cvecTargetCoorsForFudgeInter.z = TargetCoors.z;
        *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = v89;
        v90 = *(_QWORD *)&this->Source.x;
        TheCamPos.z = this->Source.z;
        *(_QWORD *)&TheCamPos.x = v90;
        CCamera::AvoidTheGeometry(
          &TheCamera,
          &TheCamPos,
          &this->m_cvecTargetCoorsForFudgeInter,
          &this->Source,
          this->FOV);
        v91 = v43;
        v92 = this->Source.z;
        v93 = this->Source.x - v67;
        v94 = this->Source.y - v68;
        v95 = cosf(v91);
        v96 = sinf(v91);
        this->ResetStatics = 0;
        v97 = v67 + (float)((float)(v93 * v95) + (float)(v94 * v96));
        v98 = v68 + (float)((float)(v94 * v95) - (float)(v93 * v96));
        this->Front.x = v67 - v97;
        this->Front.y = v68 - v98;
        this->Front.z = v88 - v92;
        this->Source.x = v97;
        this->Source.y = v98;
        this->Up.x = 0.0;
        this->Up.y = 0.0;
        this->Up.z = 1.0;
        CVector::Normalise(&this->Front);
        if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
        {
          this->Front.x = 0.0001;
          this->Front.y = 0.0001;
        }
        CrossProduct(&v136, &this->Front, &this->Up);
        *(RwReal *)&v130.m_bIsFinished = v136.z;
        v130.CTaskSimple = *(CTaskSimple *)&v136.x;
        CVector::Normalise((CVector *)&v130);
        CrossProduct(&v136, (const CVector *)&v130, &this->Front);
        v99 = *(_QWORD *)&v136.x;
        this->Up.z = v136.z;
        *(_QWORD *)&this->Up.x = v99;
        if ( !CVehicle::CanPedLeanOut(m_pMyVehicle, v16) )
          CWeapon::Update(&v16->m_WeaponSlots[v16->m_nCurrentWeapon], v16);
        if ( !CPad::GetCarGunFired(
                v129,
                (unsigned int)(m_pMyVehicle->m_vehicleType - 3) < 2,
                (unsigned int)(m_pMyVehicle->m_vehicleType - 3) < 2)
          || CVehicle::CanPedLeanOut(m_pMyVehicle, v16)
          || CWeapon::IsTypeMelee(&v16->m_WeaponSlots[v16->m_nCurrentWeapon])
          || v16->m_WeaponSlots[v16->m_nCurrentWeapon].m_eState )
        {
          goto LABEL_108;
        }
        if ( NearestTargetEntityWithScreenCoors )
        {
          v100 = *(int *)((char *)&dword_14 + (_DWORD)NearestTargetEntityWithScreenCoors);
          v1.n64_u32[0] = LODWORD(this->Source.x);
          p_x = (float *)(v100 + 48);
          v102 = this->Source.y;
          if ( !v100 )
            p_x = &NearestTargetEntityWithScreenCoors->m_transform.m_translate.x;
          v103 = *p_x;
          v104 = p_x[1];
        }
        else
        {
          CrossProduct((CVector *)&v130, &this->Front, &this->Up);
          v105 = this->X_Targetting;
          m_pParent = v130.m_pParent;
          v107 = v130._vptr$CTask;
          v108 = tanf((float)(this->FOV * 0.017453) * 0.5);
          v1.n64_u32[1] = 3.0;
          v1.n64_u32[0] = LODWORD(this->Source.x);
          v109 = (float)(v108 * this->Y_Targetting) / CDraw::ms_fAspectRatio;
          v110 = (float)((float)(v105 * *(float *)&m_pParent) * v108) + this->Front.y;
          v111 = v109 * this->Up.y;
          v112 = this->Front.x + (float)((float)(v105 * *(float *)&v107) * v108);
          v113 = v128->m_fWeaponRange * 3.0;
          v114 = v112 - (float)(this->Up.x * v109);
          v115 = (float)(v110 - v111) * v113;
          v116 = v114 * v113;
          v102 = this->Source.y;
          v104 = v102 + v115;
          v103 = v1.n64_f32[0] + v116;
        }
        v117 = m_pMyVehicle->pPassengers[1];
        v118 = atan2f(-(float)(v103 - v1.n64_f32[0]), v104 - v102);
        v119 = m_pMyVehicle->m_pMat;
        if ( v119 )
          v120 = atan2f(COERCE_FLOAT(LODWORD(v119->xy) ^ 0x80000000), v119->yy);
        else
          v120 = m_pMyVehicle->m_transform.m_heading;
        v121 = v118 - v120;
        if ( v121 <= 3.1416 )
        {
          if ( v121 >= -3.1416 )
          {
LABEL_101:
            v123 = 0;
            LOWORD(v124) = 0;
            if ( v16 != v117 )
              v123 = 1;
            HIWORD(v124) = 17096;
            CTaskSimpleGangDriveBy::CTaskSimpleGangDriveBy(&v130, 0, 0, v124, 100, 8, v123);
            v1.n64_f32[0] = v121 + 0.7854;
            if ( (float)(v121 + 0.7854) < 0.0 )
              v1.n64_f32[0] = (float)(v121 + 0.7854) + 6.2832;
            v125 = v16->m_WeaponSlots[v16->m_nCurrentWeapon].m_eWeaponType;
            v126 = CPed::GetWeaponSkill(v16);
            v130.m_pWeaponInfo = CWeaponInfo::GetWeaponInfo(v125, v126);
            v130.m_nFakeShootDirn = (int)(float)(v1.n64_f32[0] / 1.5708);
            CTaskSimpleGangDriveBy::FireGun(&v130, v16);
            v1.n64_f32[0] = TheCamera.m_fCamShakeForce
                          + (float)((float)(CTimer::m_snTimeInMilliseconds - TheCamera.m_uiCamShakeStart) * -0.001);
            v2.n64_u32[0] = 0;
            if ( vmax_f32(vmin_f32(v1, v3), v2).n64_f32[0] < 0.03 )
            {
              TheCamera.m_uiCamShakeStart = CTimer::m_snTimeInMilliseconds;
              TheCamera.m_fCamShakeForce = 0.03;
            }
            CTaskSimpleGangDriveBy::~CTaskSimpleGangDriveBy(&v130);
LABEL_108:
            currentPad = CPad::GetPad(0);
            CHID::currentInstanceIndex = 0;
            return;
          }
          v122 = 6.2832;
        }
        else
        {
          v122 = -6.2832;
        }
        v121 = v121 + v122;
        goto LABEL_101;
      }
      v42 = 0.9;
    }
    else
    {
      v42 = -0.9;
    }
    v43 = v38 + v42;
    this->X_Targetting = v41;
    goto LABEL_46;
  }
}
// 3CAA1B: failed to expand linear variable kr00_8.8
// 14: using guessed type int dword_14;
// 3CB398: using guessed type int dword_3CB398[2];

//----- (003CB3E0) --------------------------------------------------------
void __fastcall CCam::Process_Cam_TwoPlayer_Separate_Cars(CCam *this)
{
  CVehicle *m_pMyVehicle; // r9
  CVehicle *v3; // r10
  CSimpleTransform *p_m_transform; // r8
  CMatrix *m_pMat; // r0
  CSimpleTransform *v6; // r11
  CMatrix *v7; // r1
  float *p_x; // r2
  float *p_tx; // r0
  float v10; // s4
  float v11; // s10
  RwReal v12; // s0
  float v13; // s16
  float *v14; // r2
  float v15; // s24
  float v16; // s26
  float v17; // s28
  CMatrix *v18; // r1
  CMatrix *v19; // r1
  float v20; // s12
  float v21; // s4
  float v22; // s10
  float *v23; // r2
  float v24; // s18
  float v25; // s20
  float v26; // s30
  float v27; // s17
  float v28; // s19
  RwReal v29; // s2
  float v30; // s22
  float z; // s21
  CMatrix *v32; // r0
  float v33; // s24
  float *v34; // r1
  float v35; // s26
  float v36; // s4
  float v37; // s28
  RwReal v38; // s0
  CMatrix *v39; // r0
  float *v40; // r2
  CMatrix *v41; // r1
  float *v42; // r0
  float CarWeAreFocussingOnI; // s6
  float v44; // s30
  float v45; // r6
  float v46; // s0
  float v47; // s8
  float v48; // s6
  float v49; // s4
  float v50; // s9
  float v51; // s15
  RwReal v52; // s2
  RwReal v53; // s6
  RwReal v54; // s0
  CMatrix *v55; // r0
  __int64 v56; // d16
  RwReal v57; // r0
  CMatrix *v58; // r0
  __int64 v59; // d16
  Int32 CarWeAreFocussingOn; // r0
  CVehicle *v61; // r1
  CVehicle *v62; // r6
  float x; // s18
  float y; // s20
  float v65; // s22
  __int64 v66; // kr00_8
  float v67; // s4
  float v68; // s8
  float v69; // s10
  float v70; // s12
  Int32 v71; // r0
  float v72; // s0
  float v73; // s2
  float v74; // s0
  CVector v75; // [sp+0h] [bp-A8h] BYREF
  CVector v76; // [sp+Ch] [bp-9Ch] BYREF
  CVector v77; // [sp+18h] [bp-90h] BYREF
  CVector v78; // [sp+24h] [bp-84h] BYREF
  CVector v79; // [sp+30h] [bp-78h] BYREF
  CVector v80; // [sp+3Ch] [bp-6Ch] BYREF

  this->FOV = 80.0;
  m_pMyVehicle = CWorld::Players[0].pPed->m_pMyVehicle;
  v3 = CWorld::Players[1].pPed->m_pMyVehicle;
  p_m_transform = &m_pMyVehicle->m_transform;
  m_pMat = m_pMyVehicle->m_pMat;
  v6 = &v3->m_transform;
  v7 = v3->m_pMat;
  p_x = &m_pMyVehicle->m_transform.m_translate.x;
  if ( m_pMat )
    p_x = &m_pMat->tx;
  p_tx = &v3->m_transform.m_translate.x;
  v10 = p_x[2];
  if ( v7 )
    p_tx = &v7->tx;
  v11 = p_tx[2];
  v12 = *p_tx - *p_x;
  v77.y = p_tx[1] - p_x[1];
  v77.x = v12;
  v77.z = v11 - v10;
  CVector::Normalise(&v77);
  v13 = 1.0;
  v14 = &m_pMyVehicle->m_transform.m_translate.x;
  v15 = v77.x * 6.0;
  v16 = v77.y * 6.0;
  v17 = v77.z * 6.0;
  v18 = m_pMyVehicle->m_pMat;
  if ( v18 )
    v14 = &v18->tx;
  v19 = v3->m_pMat;
  v20 = v14[2];
  v21 = *v14;
  v22 = v14[1];
  v23 = &v3->m_transform.m_translate.x;
  v24 = v21 - v15;
  if ( v19 )
    v23 = &v19->tx;
  v25 = v22 - v16;
  v26 = *v23;
  v27 = v23[1];
  v28 = v23[2];
  v29 = *v23 - v24;
  v30 = (float)(v20
              + (float)(CModelInfo::ms_modelInfoPtrs[m_pMyVehicle->m_nModelIndex]->m_pColModel->m_boxBound.m_vecMax.z
                      + 1.0))
      - v17;
  z = CModelInfo::ms_modelInfoPtrs[v3->m_nModelIndex]->m_pColModel->m_boxBound.m_vecMax.z;
  v80.y = v27 - (float)(v22 - v16);
  v80.x = v29;
  v80.z = v28 - v30;
  CVector::Normalise(&v80);
  v32 = m_pMyVehicle->m_pMat;
  v33 = v15 + v26;
  v34 = &m_pMyVehicle->m_transform.m_translate.x;
  v35 = v16 + v27;
  if ( v32 )
    v34 = &v32->tx;
  v36 = v34[2];
  v37 = v17 + (float)(v28 + (float)(z + 1.0));
  v38 = *v34 - v33;
  v79.y = v34[1] - v35;
  v79.x = v38;
  v79.z = v36 - v37;
  CVector::Normalise(&v79);
  v78.y = v33 - v24;
  v78.x = v25 - v35;
  v78.z = 0.0;
  CVector::Normalise(&v78);
  v78.z = -0.1;
  CVector::Normalise(&v78);
  v39 = v3->m_pMat;
  v40 = &v3->m_transform.m_translate.x;
  v41 = m_pMyVehicle->m_pMat;
  if ( v39 )
    v40 = &v39->tx;
  v42 = &m_pMyVehicle->m_transform.m_translate.x;
  if ( v41 )
    v42 = &v41->tx;
  CarWeAreFocussingOnI = this->CarWeAreFocussingOnI;
  v44 = sqrtf(
          (float)((float)((float)(*v42 - *v40) * (float)(*v42 - *v40))
                + (float)((float)(v42[1] - v40[1]) * (float)(v42[1] - v40[1])))
        + (float)((float)(v42[2] - v40[2]) * (float)(v42[2] - v40[2])));
  v45 = sinf(CarWeAreFocussingOnI * 3.1416);
  v46 = (float)(cosf(CarWeAreFocussingOnI * 3.1416) * 0.5) + 0.5;
  v47 = v45 * v78.z;
  v48 = v45 * v78.y;
  v49 = v45 * v78.x;
  v50 = (float)(v45 * v78.y) * v44;
  v51 = (float)(v45 * v78.x) * v44;
  this->Source.z = (float)((float)(v30 * v46) + (float)(v37 * (float)(1.0 - v46)))
                 - (float)((float)((float)(v45 * v78.z) * v44) * 0.75);
  this->Source.y = (float)((float)(v25 * v46) + (float)(v35 * (float)(1.0 - v46))) - (float)(v50 * 0.75);
  this->Source.x = (float)((float)(v24 * v46) + (float)(v33 * (float)(1.0 - v46))) - (float)(v51 * 0.75);
  v52 = (float)((float)(1.0 - v45) * (float)((float)(v46 * v80.z) + (float)((float)(1.0 - v46) * v79.z))) + v47;
  v53 = (float)((float)(1.0 - v45) * (float)((float)(v46 * v80.y) + (float)((float)(1.0 - v46) * v79.y))) + v48;
  v54 = (float)((float)(1.0 - v45) * (float)((float)(v46 * v80.x) + (float)((float)(1.0 - v46) * v79.x))) + v49;
  this->Front.z = v52;
  this->Front.y = v53;
  this->Front.x = v54;
  CVector::Normalise(&this->Front);
  if ( this->CarWeAreFocussingOn )
  {
    v55 = m_pMyVehicle->m_pMat;
    if ( v55 )
      p_m_transform = (CSimpleTransform *)&v55->tx;
    v56 = *(_QWORD *)&p_m_transform->m_translate.x;
    v57 = p_m_transform->m_translate.z;
  }
  else
  {
    v58 = v3->m_pMat;
    if ( v58 )
      v6 = (CSimpleTransform *)&v58->tx;
    v57 = v6->m_translate.z;
    v56 = *(_QWORD *)&v6->m_translate.x;
  }
  this->m_cvecTargetCoorsForFudgeInter.z = v57;
  *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = v56;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(&this->Up);
  CrossProduct(&v76, &this->Up, &this->Front);
  CVector::Normalise(&v76);
  CrossProduct(&v75, &this->Front, &v76);
  v59 = *(_QWORD *)&v75.x;
  this->Up.z = v75.z;
  *(_QWORD *)&this->Up.x = v59;
  CVector::Normalise(&this->Up);
  CarWeAreFocussingOn = this->CarWeAreFocussingOn;
  v61 = CWorld::Players[CarWeAreFocussingOn].pPed->m_pMyVehicle;
  v62 = CWorld::Players[(CarWeAreFocussingOn & 1) == 0].pPed->m_pMyVehicle;
  x = v61->m_vecMoveSpeed.x;
  y = v61->m_vecMoveSpeed.y;
  v65 = v61->m_vecMoveSpeed.z;
  *(_QWORD *)&v75.x = *(_QWORD *)&this->Front.x;
  v75.z = 0.0;
  CVector::Normalise(&v75);
  v66 = *(_QWORD *)&v75.x;
  v67 = (float)((float)(x * v75.x) + (float)(y * v75.y)) + (float)(v65 * v75.z);
  if ( v67 >= -0.13
    || (v68 = -(float)(v75.x * v62->m_vecMoveSpeed.x),
        v69 = v62->m_vecMoveSpeed.y * v75.y,
        v70 = v62->m_vecMoveSpeed.z * v75.z,
        v75.y = -v75.y,
        v75.x = -*(float *)&v66,
        v75.z = -v75.z,
        v67 >= (float)((float)(v68 - v69) - v70)) )
  {
    v71 = this->CarWeAreFocussingOn;
  }
  else
  {
    v71 = (this->CarWeAreFocussingOn & 1) == 0;
    this->CarWeAreFocussingOn = v71;
  }
  v72 = CTimer::ms_fTimeStep * 0.04;
  v73 = this->CarWeAreFocussingOnI;
  if ( v71 )
  {
    v74 = v73 + v72;
    if ( v74 < 1.0 )
      v13 = v74;
  }
  else
  {
    v13 = v73 - v72;
    if ( (float)(v73 - v72) <= 0.0 )
      v13 = 0.0;
  }
  this->CarWeAreFocussingOnI = v13;
}

//----- (003CB8B8) --------------------------------------------------------
void __fastcall CCam::Process_Cam_TwoPlayer_Separate_Cars_TopDown(CCam *this)
{
  float32x2_t v1; // d4
  float32x2_t v2; // d6
  char *pPed; // r3
  char *v4; // r1
  CVehicle *m_pMyVehicle; // lr
  CVehicle *v6; // r12
  int v7; // r2
  int v8; // r4
  float *v9; // r5
  float *v10; // r1
  float v11; // s0
  float v12; // s8
  float v13; // s6
  float v14; // s10
  float v15; // s14
  float v16; // s2
  float v17; // s1
  float v18; // s6
  float v19; // s10
  float v20; // s12
  float v21; // s2
  float v22; // s0
  float v23; // s2
  float v24; // s6
  float m_fCameraHeightMultiplier; // s10
  float v26; // s4
  float v27; // s14
  float v28; // s8
  __int64 v29; // d16
  RwReal z; // r3

  this->FOV = 80.0;
  pPed = (char *)CWorld::Players[0].pPed;
  v4 = (char *)CWorld::Players[1].pPed;
  m_pMyVehicle = CWorld::Players[0].pPed->m_pMyVehicle;
  v6 = CWorld::Players[1].pPed->m_pMyVehicle;
  if ( v6 )
    v4 = (char *)CWorld::Players[1].pPed->m_pMyVehicle;
  v7 = *((_DWORD *)v4 + 5);
  if ( m_pMyVehicle )
    pPed = (char *)CWorld::Players[0].pPed->m_pMyVehicle;
  v8 = *((_DWORD *)pPed + 5);
  v9 = (float *)(v7 + 48);
  if ( !v7 )
    v9 = (float *)(v4 + 4);
  v10 = (float *)(v8 + 48);
  v11 = *v9;
  v12 = v9[1];
  v13 = v9[2];
  if ( !v8 )
    v10 = (float *)(pPed + 4);
  v14 = v10[1];
  v15 = v10[2];
  v16 = v14 - v12;
  v17 = v15 - v13;
  v18 = v15 + v13;
  v19 = v14 + v12;
  v20 = *v10 + v11;
  v21 = (float)((float)((float)(*v10 - v11) * (float)(*v10 - v11)) + (float)(v16 * v16)) + (float)(v17 * v17);
  if ( m_pMyVehicle )
  {
    if ( v6 )
    {
      v22 = 1.0;
      goto LABEL_15;
    }
    goto LABEL_13;
  }
  if ( v6 )
  {
LABEL_13:
    v22 = 0.75;
    goto LABEL_15;
  }
  v22 = 0.45;
LABEL_15:
  v1.n64_f32[0] = sqrtf(v21);
  v23 = v18 * 0.5;
  v24 = v19 * 0.5;
  m_fCameraHeightMultiplier = this->m_fCameraHeightMultiplier;
  v26 = v20 * 0.5;
  v27 = CTimer::ms_fTimeStep * 0.005;
  if ( fabsf(v22 - m_fCameraHeightMultiplier) >= (float)(CTimer::ms_fTimeStep * 0.005) )
  {
    if ( (float)(v22 - m_fCameraHeightMultiplier) < 0.0 )
      v27 = -v27;
    v22 = m_fCameraHeightMultiplier + v27;
  }
  v2.n64_u32[0] = 30.0;
  this->m_fCameraHeightMultiplier = v22;
  v1.n64_f32[0] = v1.n64_f32[0] + 10.0;
  v28 = vmax_f32(v1, v2).n64_f32[0] * v22;
  this->Source.x = v26 + (float)(v28 * -0.0);
  this->Source.y = v24 + (float)(v28 * -0.38942);
  this->Source.z = v23 + (float)(v28 * 0.92106);
  v29 = *(_QWORD *)&this->Source.x;
  this->Front.x = 0.0;
  this->Front.y = 0.38942;
  this->Front.z = -0.92106;
  z = this->Source.z;
  this->Up.x = 0.0;
  this->Up.y = 0.92106;
  this->Up.z = 0.38942;
  this->m_cvecTargetCoorsForFudgeInter.z = z;
  *(_QWORD *)&this->m_cvecTargetCoorsForFudgeInter.x = v29;
}
// 3CB9EC: variable 'v1' is possibly undefined
// 3CB9EC: variable 'v2' is possibly undefined

//----- (003CBA5C) --------------------------------------------------------
void __fastcall CCam::Process_Editor(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  CEntity *CamTargetEntity; // r0
  int LeftStickX; // r5
  float LeftStickY; // s4
  CEntity *v11; // r0
  float v12; // s0
  CMatrix *m_pMat; // r1
  float *p_tx; // r2
  float v15; // s22
  float v16; // s18
  float v17; // s20
  float v18; // s0
  int v19; // s2
  RwReal v20; // s2
  RwReal v21; // s2
  CPad *Pad; // r0
  CVector *p_Source; // r8
  CVehicle *PlayerVehicle; // r0
  CPlayerPed *pPed; // r1
  __int64 v26; // kr00_8
  RwReal z; // r0
  CMatrix *v28; // r6
  RwReal *p_tz; // r1
  float x; // s6
  float y; // s6
  __int64 v32; // d16
  CPad *v33; // r0
  int v34; // r1
  CVector v35; // [sp+30h] [bp-148h] BYREF
  CVector v36; // [sp+40h] [bp-138h] BYREF

  if ( this->ResetStatics )
  {
    this->Source.x = 796.0;
    this->Source.y = -937.0;
    this->Source.z = 40.0;
    CamTargetEntity = this->CamTargetEntity;
    if ( CamTargetEntity )
      CEntity::CleanUpOldReference(CamTargetEntity, &this->CamTargetEntity);
    this->CamTargetEntity = 0;
  }
  this->ResetStatics = 0;
  RwCameraSetNearClipPlane(Scene.camera, 0.3);
  this->FOV = 70.0;
  LeftStickX = CPad::GetPad(1)->NewState.LeftStickX;
  LeftStickY = (float)CPad::GetPad(1)->NewState.LeftStickY;
  v11 = this->CamTargetEntity;
  v12 = this->Alpha + (float)((float)(LeftStickY * 0.017453) / 50.0);
  this->Beta = (float)((float)((float)LeftStickX * 0.02618) / 19.0) + this->Beta;
  this->Alpha = v12;
  if ( v11 )
  {
    m_pMat = v11->m_pMat;
    p_tx = &m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v11->m_transform.m_translate.x;
    v15 = *p_tx;
    v16 = p_tx[1];
    v17 = p_tx[2];
  }
  else
  {
    v15 = this->Source.x + 0.0;
    v16 = this->Source.y + 0.0;
    v17 = this->Source.z + 0.0;
  }
  if ( v12 <= 1.5621 )
  {
    if ( v12 < -1.5621 )
    {
      this->Alpha = -1.5621;
      v18 = CCam::Process_Editor(CVector const&,float,float,float)::Speed;
      goto LABEL_19;
    }
  }
  else
  {
    this->Alpha = 1.5621;
  }
  if ( CPad::GetPad(1)->NewState.ButtonSquare )
  {
    v18 = CCam::Process_Editor(CVector const&,float,float,float)::Speed + 0.1;
  }
  else
  {
    v18 = 0.0;
    if ( CPad::GetPad(1)->NewState.ButtonCross )
      v18 = CCam::Process_Editor(CVector const&,float,float,float)::Speed + -0.1;
  }
  CCam::Process_Editor(CVector const&,float,float,float)::Speed = v18;
LABEL_19:
  v19 = 1116471296;
  if ( v18 > 70.0 || (v19 = -1031012352, v18 < -70.0) )
    LODWORD(CCam::Process_Editor(CVector const&,float,float,float)::Speed) = v19;
  v20 = v16 - this->Source.y;
  v5.n64_f32[0] = v17 - this->Source.z;
  this->Front.x = v15 - this->Source.x;
  this->Front.y = v20;
  LODWORD(this->Front.z) = v5.n64_u32[0];
  CVector::Normalise(&this->Front);
  v5.n64_f32[0] = (float)(CCam::Process_Editor(CVector const&,float,float,float)::Speed * this->Front.z)
                + this->Source.z;
  v6.n64_u32[0] = -1008664576;
  v21 = (float)(CCam::Process_Editor(CVector const&,float,float,float)::Speed * this->Front.y) + this->Source.y;
  this->Source.x = (float)(CCam::Process_Editor(CVector const&,float,float,float)::Speed * this->Front.x)
                 + this->Source.x;
  this->Source.y = v21;
  LODWORD(this->Source.z) = vmax_f32(v5, v6).n64_u32[0];
  Pad = CPad::GetPad(1);
  p_Source = &this->Source;
  if ( Pad->NewState.RightShoulder2 && !Pad->OldState.RightShoulder2 )
  {
    if ( FindPlayerVehicle(-1, 0) )
    {
      PlayerVehicle = FindPlayerVehicle(-1, 0);
      (*((void (__fastcall **)(CVehicle *, _DWORD, _DWORD, _DWORD, _DWORD))PlayerVehicle->_vptr$CPlaceable + 15))(
        PlayerVehicle,
        LODWORD(this->Source.x),
        LODWORD(this->Source.y),
        LODWORD(this->Source.z),
        0);
    }
    else
    {
      pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
      v26 = *(_QWORD *)&this->Source.x;
      z = this->Source.z;
      v28 = pPed->m_pMat;
      if ( v28 )
      {
        LODWORD(v28->tx) = v26;
        pPed->m_pMat->ty = *((float *)&v26 + 1);
        p_tz = &pPed->m_pMat->tz;
      }
      else
      {
        *(_QWORD *)&pPed->m_transform.m_translate.x = v26;
        p_tz = &pPed->m_transform.m_translate.z;
      }
      *p_tz = z;
    }
  }
  x = p_Source->x;
  if ( (float)((float)(p_Source->x / 50.0) + 60.0) > 115.0 )
  {
    do
      x = x + -1.0;
    while ( (float)((float)(x / 50.0) + 60.0) > 115.0 );
    p_Source->x = x;
  }
  if ( (float)((float)(x / 50.0) + 60.0) < 5.0 )
  {
    do
      x = x + 1.0;
    while ( (float)((float)(x / 50.0) + 60.0) < 5.0 );
    p_Source->x = x;
  }
  y = this->Source.y;
  if ( (float)((float)(y / 50.0) + 60.0) > 115.0 )
  {
    do
      y = y + -1.0;
    while ( (float)((float)(y / 50.0) + 60.0) > 115.0 );
    this->Source.y = y;
  }
  if ( (float)((float)(y / 50.0) + 60.0) < 5.0 )
  {
    do
      y = y + 1.0;
    while ( (float)((float)(y / 50.0) + 60.0) < 5.0 );
    this->Source.y = y;
  }
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(&this->Front);
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v35, &this->Front, &this->Up);
  v36 = v35;
  CVector::Normalise(&v36);
  CrossProduct(&v35, &v36, &this->Front);
  v32 = *(_QWORD *)&v35.x;
  this->Up.z = v35.z;
  *(_QWORD *)&this->Up.x = v32;
  v33 = CPad::GetPad(1);
  v34 = 0;
  if ( v33->NewState.ShockButtonL && !v33->OldState.ShockButtonL )
    v34 = 1;
  if ( !v34 && gbBigWhiteDebugLightSwitchedOn )
    CShadows::StoreShadowToBeRendered(
      2u,
      gpShadowExplosionTex,
      &this->Source,
      12.0,
      0.0,
      0.0,
      -12.0,
      128,
      0x80u,
      0x80u,
      0x80u,
      1000.0,
      0,
      1.0,
      0,
      0);
  if ( CHud::m_Wants_To_Draw_Hud )
  {
    sprintf(
      (unsigned __int8 *)&v36,
      "CamX: %0.3f CamY: %0.3f  CamZ:  %0.3f",
      this->Source.x,
      this->Source.y,
      this->Source.z);
    sprintf(
      (unsigned __int8 *)&v36,
      "Frontx: %0.3f, Fronty: %0.3f, Frontz: %0.3f ",
      this->Front.x,
      this->Front.y,
      this->Front.z);
    sprintf(
      (unsigned __int8 *)&v36,
      "LookAT: %0.3f, LookAT: %0.3f, LookAT: %0.3f ",
      (float)(this->Front.x + this->Source.x),
      (float)(this->Front.y + this->Source.y),
      (float)(this->Front.z + this->Source.z));
  }
}
// 3CBC8C: variable 'v5' is possibly undefined
// 3CBC8C: variable 'v6' is possibly undefined

//----- (003CC080) --------------------------------------------------------
void __fastcall CCam::Process_1rstPersonPedOnPC(
        CCam *this,
        const CVector *ThisCamsTarget,
        float TargetOrientation,
        float SpeedVar,
        float SpeedVarDesired)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d2
  char v10; // r0
  CEntity *CamTargetEntity; // r1
  RpClump_0 *m_pRwObject; // r0
  CEntity **p_CamTargetEntity; // r10
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r6
  RwInt32 v15; // r0
  RwInt32 v16; // r5
  RwMatrix *v17; // r5
  bool *p_ResetStatics; // r9
  CEntity *v19; // r0
  float *p_m_pLod; // r0
  float v21; // s2
  float v22; // s2
  __int64 v23; // d16
  RwReal y; // r0
  float z; // s8
  CEntity *v26; // r6
  const CMatrix *m_pMat; // r1
  CPed *v28; // r0
  float v29; // s0
  CEntity *v30; // r5
  float v31; // s16
  CMatrix *v32; // r0
  float v33; // s18
  CMatrix *v34; // r1
  float *p_tx; // r2
  float v36; // s0
  float v37; // s2
  float v38; // s4
  RwReal v39; // s0
  RwReal v40; // s4
  __int64 v41; // d16
  char v42; // r5
  CPad *Pad; // r0
  int v44; // r5
  CPad *v45; // r0
  int v46; // r0
  float v47; // s8
  float v48; // s6
  float v49; // s10
  float v50; // s0
  float v51; // s4
  float v52; // s2
  float v53; // s2
  float v54; // s0
  float v55; // s4
  CPlaceable *v56; // r5
  float m_heading; // r0
  int v58; // r1
  float v59; // s0
  int v60; // r1
  int v61; // r1
  float v62; // s0
  int v63; // r1
  float v64; // s2
  float v65; // s4
  float x; // s4
  float v67; // s4
  float Beta; // r5
  float v69; // r0
  float Alpha; // r6
  float v71; // r8
  float v72; // s18
  float v73; // s20
  float v74; // s18
  float v75; // r0
  RwReal v76; // s4
  RwReal v77; // s0
  float v78; // r1
  RwReal v79; // s4
  RwReal v80; // s2
  __int64 v81; // d16
  float v82; // r1
  CMatrix *v83; // r0
  RwObject_0 *v84; // r0
  char *parent; // r1
  CMatrix *v86; // r0
  RwMatrix *v87; // r1
  CPad *v88; // r0
  _BOOL4 v89; // r5
  CPad *v90; // r0
  _BOOL4 v91; // r0
  float v92; // s0
  float32x2_t v93; // d16
  RwV3d_0 v94; // [sp+0h] [bp-78h] BYREF
  RwV3d_0 scale; // [sp+Ch] [bp-6Ch] BYREF
  RwV3d_0 pointsIn; // [sp+18h] [bp-60h] BYREF
  CVector v97; // [sp+28h] [bp-50h] BYREF
  CVector v98; // [sp+38h] [bp-40h] BYREF

  v10 = `guard variable for'CCam::Process_1rstPersonPedOnPC(CVector const&,float,float,float)::InitialHeadPos;
  __dmb(0xBu);
  if ( (v10 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_1rstPersonPedOnPC(CVector const&,float,float,float)::InitialHeadPos) )
  {
    _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_1rstPersonPedOnPC(CVector const&,float,float,float)::InitialHeadPos);
  }
  if ( this->Mode != 39 )
    this->FOV = 70.0;
  TheCamera.m_1rstPersonRunCloseToAWall = 0;
  CamTargetEntity = this->CamTargetEntity;
  m_pRwObject = (RpClump_0 *)CamTargetEntity->m_pRwObject;
  if ( m_pRwObject )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 3 )
    {
      p_ResetStatics = &this->ResetStatics;
LABEL_88:
      *p_ResetStatics = 0;
      RwCameraSetNearClipPlane(Scene.camera, 0.05);
      return;
    }
    p_CamTargetEntity = &this->CamTargetEntity;
    pointsIn = vecHeadCamOffset.RwV3d_0;
    AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump(m_pRwObject);
    v15 = ConvertPedNode2BoneTag(2);
    v16 = RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, v15);
    v17 = &RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump)[v16];
    TestMatrix(v17);
    RwV3dTransformPoints(&pointsIn, &pointsIn, 1, v17);
    memset(&scale, 0, sizeof(scale));
    RwMatrixScale(v17, &scale, rwCOMBINEPRECONCAT);
    p_ResetStatics = &this->ResetStatics;
    if ( this->ResetStatics )
    {
      v19 = this->CamTargetEntity;
      this->Alpha = 0.0;
      this->Beta = TargetOrientation;
      this->m_fInitialPlayerOrientation = TargetOrientation;
      if ( (*(_BYTE *)&v19->m_info & 7) == 3 )
      {
        p_m_pLod = (float *)&v19[22].m_pLod;
        v21 = *p_m_pLod;
        this->Alpha = 0.0;
        this->Beta = v21 + 1.5708;
        v22 = *p_m_pLod;
        this->m_bCollisionChecksOn = 1;
        this->m_fInitialPlayerOrientation = v22 + 1.5708;
      }
      v23 = *(_QWORD *)&pointsIn.x;
      this->m_vecBufferedPlayerBodyOffset.z = pointsIn.z;
      *(_QWORD *)&this->m_vecBufferedPlayerBodyOffset.x = v23;
      CCam::Process_1rstPersonPedOnPC(CVector const&,float,float,float)::InitialHeadPos = (CVector)pointsIn;
    }
    y = pointsIn.y;
    this->m_vecBufferedPlayerBodyOffset.y = pointsIn.y;
    if ( TheCamera.m_bHeadBob )
    {
      z = this->m_vecBufferedPlayerBodyOffset.z;
      this->m_vecBufferedPlayerBodyOffset.x = (float)(TheCamera.m_fGaitSwayBuffer * this->m_vecBufferedPlayerBodyOffset.x)
                                            + (float)((float)(1.0 - TheCamera.m_fGaitSwayBuffer) * pointsIn.x);
      this->m_vecBufferedPlayerBodyOffset.z = (float)(TheCamera.m_fGaitSwayBuffer * z)
                                            + (float)((float)(1.0 - TheCamera.m_fGaitSwayBuffer) * pointsIn.z);
      v26 = this->CamTargetEntity;
      m_pMat = v26->m_pMat;
      if ( !m_pMat )
      {
        CPlaceable::AllocateMatrix(this->CamTargetEntity);
        CSimpleTransform::UpdateMatrix(&v26->m_transform, v26->m_pMat);
        m_pMat = v26->m_pMat;
      }
      operator*(&v98, m_pMat, &this->m_vecBufferedPlayerBodyOffset);
      pointsIn = v98.RwV3d_0;
      v28 = (CPed *)*p_CamTargetEntity;
    }
    else
    {
      v29 = y;
      v30 = *p_CamTargetEntity;
      v31 = pointsIn.x - CCam::Process_1rstPersonPedOnPC(CVector const&,float,float,float)::InitialHeadPos.x;
      v32 = (*p_CamTargetEntity)->m_pMat;
      v33 = v29 - CCam::Process_1rstPersonPedOnPC(CVector const&,float,float,float)::InitialHeadPos.y;
      if ( !v32 )
      {
        CPlaceable::AllocateMatrix(*p_CamTargetEntity);
        CSimpleTransform::UpdateMatrix(&v30->m_transform, v30->m_pMat);
        v32 = v30->m_pMat;
      }
      *(_QWORD *)&v98.x = *(_QWORD *)&v32->xy;
      v98.z = 0.0;
      CVector::Normalise(&v98);
      v28 = (CPed *)*p_CamTargetEntity;
      v34 = (*p_CamTargetEntity)->m_pMat;
      p_tx = &v34->tx;
      if ( !v34 )
        p_tx = &v28->m_transform.m_translate.x;
      v36 = sqrtf((float)((float)(v31 * v31) + (float)(v33 * v33)) + 0.0);
      v37 = v36 * v98.x;
      v38 = (float)(v36 * v98.z) * 1.23;
      v39 = (float)((float)(v36 * v98.y) * 1.23) + p_tx[1];
      v40 = (float)(v38 + p_tx[2]) + 0.59;
      pointsIn.x = (float)(v37 * 1.23) + *p_tx;
      pointsIn.y = v39;
      pointsIn.z = v40;
    }
    v41 = *(_QWORD *)&pointsIn.x;
    this->Source.z = pointsIn.z;
    *(_QWORD *)&this->Source.x = v41;
    CPed::GetBonePosition(v28, &v94, 3u, 1);
    v42 = 0;
    CPad::GetPad(0);
    if ( CPad::NewMouseControllerState.m_AmountMoved.x == 0.0 )
      v42 = 1;
    if ( ((unsigned __int8)v42 & (CPad::NewMouseControllerState.m_AmountMoved.y == 0.0)) != 0 )
    {
      Pad = CPad::GetPad(0);
      v44 = CPad::LookAroundLeftRight(Pad);
      v45 = CPad::GetPad(0);
      v46 = CPad::LookAroundUpDown(v45);
      v47 = this->FOV / 80.0;
      v48 = 1.0;
      v49 = 1.0;
      if ( v44 > 0 )
        v49 = -1.0;
      if ( v46 < 0 )
        v48 = -1.0;
      v50 = CTimer::ms_fTimeStep;
      v51 = (float)(v47 * 0.071429) * (float)(v48 * (float)((float)((float)((float)v46 / 150.0) * (float)v46) / 150.0));
      v52 = CTimer::ms_fTimeStep
          * (float)((float)(v47 * 0.057143)
                  * (float)(v49 * (float)((float)((float)((float)-v44 / 100.0) * (float)-v44) / 100.0)));
    }
    else
    {
      v50 = this->FOV / 80.0;
      v51 = (float)(CPad::NewMouseControllerState.m_AmountMoved.y * 4.0) * 0.0015;
      v52 = (float)((float)(CPad::NewMouseControllerState.m_AmountMoved.x * -3.0) * 0.0025) * v50;
    }
    v53 = v52 + this->Beta;
    v54 = (float)(v50 * v51) + this->Alpha;
    this->Beta = v53;
    this->Alpha = v54;
    if ( v53 <= 3.1416 )
    {
      if ( v53 >= -3.1416 )
        goto LABEL_36;
      v55 = 6.2832;
    }
    else
    {
      v55 = -6.2832;
    }
    this->Beta = v53 + v55;
LABEL_36:
    if ( v54 <= 1.0472 )
    {
      if ( v54 < -1.5621 )
        this->Alpha = -1.5621;
    }
    else
    {
      this->Alpha = 1.0472;
    }
    if ( !CPed::IsPlayer((const CPed *)*p_CamTargetEntity)
      || (v56 = *p_CamTargetEntity, m_heading = (*p_CamTargetEntity)[4].m_transform.m_heading, m_heading == 0.0) )
    {
LABEL_67:
      Beta = this->Beta;
      v69 = cosf(Beta);
      Alpha = this->Alpha;
      v71 = v69;
      v72 = cosf(Alpha);
      v73 = v71 * v72;
      v74 = v72 * sinf(Beta);
      v75 = sinf(Alpha);
      v76 = (float)((float)(v74 * 3.0) + this->Source.y) - this->Source.y;
      v77 = (float)((float)(v75 * 3.0) + this->Source.z) - this->Source.z;
      this->Front.x = (float)((float)(v73 * 3.0) + this->Source.x) - this->Source.x;
      this->Front.y = v76;
      this->Front.z = v77;
      CVector::Normalise(&this->Front);
      v78 = this->Alpha;
      v79 = (float)(this->Front.y * 0.4) + this->Source.y;
      v80 = (float)(this->Front.z * 0.4) + this->Source.z;
      this->Source.x = (float)(this->Front.x * 0.4) + this->Source.x;
      this->Source.y = v79;
      this->Source.z = v80;
      TheCamera.m_AlphaForPlayerAnim1rstPerson = v78;
      this->Up.x = 0.0;
      this->Up.y = 0.0;
      this->Up.z = 1.0;
      CVector::Normalise(&this->Front);
      if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
      {
        this->Front.x = 0.0001;
        this->Front.y = 0.0001;
      }
      CrossProduct(&v97, &this->Front, &this->Up);
      v98 = v97;
      CVector::Normalise(&v98);
      CrossProduct(&v97, &v98, &this->Front);
      v81 = *(_QWORD *)&v97.x;
      this->Up.z = v97.z;
      *(_QWORD *)&this->Up.x = v81;
      v82 = atan2f(COERCE_FLOAT(LODWORD(this->Front.x) ^ 0x80000000), this->Front.y);
      *(float *)&TheCamera.pTargetEntity[22].m_pLod = v82;
      *(float *)&TheCamera.pTargetEntity[22].numLodChildren = v82;
      v83 = TheCamera.pTargetEntity->m_pMat;
      if ( v83 )
        CMatrix::SetRotateZOnly(v83, v82);
      else
        TheCamera.pTargetEntity->m_transform.m_heading = v82;
      v84 = TheCamera.pTargetEntity->m_pRwObject;
      if ( v84 )
      {
        parent = (char *)v84->parent;
        v86 = TheCamera.pTargetEntity->m_pMat;
        v87 = (RwMatrix *)(parent + 16);
        if ( v86 )
          CMatrix::UpdateRwMatrix(v86, v87);
        else
          CSimpleTransform::UpdateRwMatrix(&TheCamera.pTargetEntity->m_transform, v87);
      }
      if ( this->Mode != 39 )
        goto LABEL_88;
      v88 = CPad::GetPad(0);
      v89 = CPad::SniperZoomOut(v88);
      v90 = CPad::GetPad(0);
      v91 = CPad::SniperZoomIn(v90);
      if ( !v89 && !v91 )
        goto LABEL_85;
      if ( v89 )
      {
        v92 = this->FOV * (float)((float)((float)(CTimer::ms_fTimeStep * 255.0) + 10000.0) / 10000.0);
      }
      else
      {
        if ( !v91 )
        {
LABEL_85:
          v5.n64_u32[0] = 12.0;
          v6.n64_u32[0] = 1116471296;
          *(_QWORD *)&TheCamera.m_BlurBlue = 0xFF000000B4LL;
          *(_QWORD *)&TheCamera.m_BlurRed = 0x1000000B4LL;
          TheCamera.m_motionBlur = 120;
          v7.n64_u32[0] = LODWORD(this->FOV);
          v93.n64_u64[0] = vmin_f32(v7, v6).n64_u64[0];
          if ( this->Mode == 46 )
            v5.n64_u32[0] = 3.0;
          LODWORD(this->FOV) = vmax_f32(v93, v5).n64_u32[0];
          goto LABEL_88;
        }
        v92 = this->FOV / (float)((float)((float)(CTimer::ms_fTimeStep * 255.0) + 10000.0) / 10000.0);
      }
      this->FOV = v92;
      goto LABEL_85;
    }
    switch ( LOWORD(v56[80]._vptr$CPlaceable) )
    {
      case 0:
        v58 = *(_DWORD *)(LODWORD(m_heading) + 20);
        if ( v58 )
          v59 = atan2f(COERCE_FLOAT(*(_DWORD *)(v58 + 16) ^ 0x80000000), *(float *)(v58 + 20));
        else
          v59 = *(float *)(LODWORD(m_heading) + 16);
        v54 = v59 + 1.5708;
        break;
      case 1:
        v60 = *(_DWORD *)(LODWORD(m_heading) + 20);
        if ( v60 )
          v54 = atan2f(COERCE_FLOAT(*(_DWORD *)(v60 + 16) ^ 0x80000000), *(float *)(v60 + 20)) + 3.1416;
        else
          v54 = *(float *)(LODWORD(m_heading) + 16) + 3.1416;
        break;
      case 2:
        v61 = *(_DWORD *)(LODWORD(m_heading) + 20);
        if ( v61 )
          v62 = atan2f(COERCE_FLOAT(*(_DWORD *)(v61 + 16) ^ 0x80000000), *(float *)(v61 + 20));
        else
          v62 = *(float *)(LODWORD(m_heading) + 16);
        v54 = v62 + -1.5708;
        break;
      case 3:
        v63 = *(_DWORD *)(LODWORD(m_heading) + 20);
        if ( v63 )
          v54 = atan2f(COERCE_FLOAT(*(_DWORD *)(v63 + 16) ^ 0x80000000), *(float *)(v63 + 20));
        else
          v54 = *(float *)(LODWORD(m_heading) + 16);
        break;
      default:
        break;
    }
    v64 = this->Beta - v54;
    if ( v64 <= 3.1416 )
    {
      if ( v64 >= -3.1416 )
      {
LABEL_62:
        x = v56[80].m_transform.m_translate.x;
        if ( v64 <= x )
        {
          v67 = -x;
          if ( v64 < v67 )
            v64 = v67;
        }
        else
        {
          v64 = v56[80].m_transform.m_translate.x;
        }
        this->Beta = v54 + v64;
        goto LABEL_67;
      }
      v65 = 6.2832;
    }
    else
    {
      v65 = -6.2832;
    }
    v64 = v64 + v65;
    goto LABEL_62;
  }
}
// 3CC85C: variable 'v7' is possibly undefined
// 3CC85C: variable 'v6' is possibly undefined
// 3CC868: variable 'v5' is possibly undefined
// 952E3C: using guessed type char `guard variable for'CCam::Process_1rstPersonPedOnPC(CVector const&,float,float,float)::InitialHeadPos;

//----- (003CC91C) --------------------------------------------------------
bool __fastcall CCam::ProcessArrestCamOne(CCam *this)
{
  CEntity *pTargetEntity; // r6
  bool result; // r0
  int v4; // r1
  CCam *v5; // r9
  int v6; // r8
  int v7; // r5
  CCopPed *m_ArrestingOfficer; // r6
  int v9; // r12
  int v10; // r1
  CPed *v11; // r0
  CCopPed *v12; // r1
  CLink<CEntity *> *m_pLastRenderedLink; // r0
  CPed *v14; // r6
  int v15; // r1
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v18; // d16
  int v19; // r0
  CPed *v20; // r2
  int v21; // r3
  GxtChar *v22; // r0
  CCam *v23; // r4
  int v24; // r9
  int v25; // r10
  CCopPed *v26; // r5
  int LookOverShoulderPos; // r0
  float v28; // s0
  int32 v29; // r0
  CPedIntelligence *m_pPedIntelligence; // r8
  int v31; // r0
  int v32; // r4
  CTask *ActiveTaskByType; // r5
  CPedIntelligence *v34; // r8
  int v35; // r0
  int v36; // r4
  CTask *v37; // r5
  int v38; // r11
  __int64 v39; // d16
  RwReal v40; // s2
  RwReal v41; // s4
  __int64 v42; // d16
  CMatrix *v43; // r1
  CSimpleTransform *p_m_transform; // r2
  __int64 v45; // d16
  int v46; // r0
  RwReal *p_z; // r5
  __int64 v48; // d16
  RwReal v49; // s2
  RwReal v50; // s4
  float x; // s0
  float y; // s2
  float z; // s4
  __int64 v54; // kr00_8
  RwReal v55; // s0
  RwReal v56; // s2
  float v57; // s0
  float v58; // s2
  float v59; // s8
  float v60; // s6
  float v61; // s4
  float v62; // s20
  RwReal v63; // s2
  RwReal v64; // s4
  __int64 v65; // d16
  float v66; // s4
  float v67; // s6
  float v68; // s2
  float v69; // s0
  float GroundZFor3DCoord; // r0
  __int64 v71; // d16
  RwReal v72; // s4
  RwReal v73; // s2
  __int64 v74; // d16
  CCam *v75; // [sp+24h] [bp-F4h]
  CPed *v76; // [sp+48h] [bp-D0h]
  CVector v77; // [sp+60h] [bp-B8h] BYREF
  CVector v78; // [sp+6Ch] [bp-ACh] BYREF
  CVector TheCamPos; // [sp+78h] [bp-A0h] BYREF
  int v80[6]; // [sp+88h] [bp-90h] BYREF
  RwV3d_0 posn; // [sp+A0h] [bp-78h] BYREF
  CVector vecSource; // [sp+B0h] [bp-68h] BYREF
  CVector v83; // 0:r0.12
  CVector v84; // 0:r0.12

  this->FOV = 45.0;
  memset(v80, 255, sizeof(v80));
  if ( this->ResetStatics )
  {
    pTargetEntity = TheCamera.pTargetEntity;
    result = 0;
    nUsingWhichCamera = 0;
    v4 = *(_BYTE *)&TheCamera.pTargetEntity->m_info & 7;
    if ( v4 != 2 )
    {
      if ( v4 != 3 )
        return result;
      v5 = this;
      v6 = 3;
      v7 = 1;
      CPed::GetBonePosition((CPed *)TheCamera.pTargetEntity, &posn, 3u, 1);
      v76 = (CPed *)pTargetEntity;
      if ( FindPlayerPed(-1) )
      {
        if ( FindPlayerPed(-1)->m_pPlayerData->m_ArrestingOfficer )
        {
          m_ArrestingOfficer = FindPlayerPed(-1)->m_pPlayerData->m_ArrestingOfficer;
          if ( m_ArrestingOfficer )
          {
            v7 = 1;
            if ( (float)((float)((float)rand() * 4.6566e-10) + 0.0) > 0.5 )
            {
              v80[0] = 1;
              v6 = 4;
              v9 = 3;
              v7 = 2;
              v10 = 1;
LABEL_37:
              v21 = 8;
              v19 = 2;
              v20 = (CPed *)(&dword_0 + 3);
              *(_DWORD *)((unsigned int)v80 | (4 * v10)) = v7;
LABEL_38:
              v80[v7] = (int)v20;
              v80[v9] = v19;
              v80[v6] = v21;
              if ( !CHud::m_BigMessage[2][0] )
              {
                v22 = CText::Get(&TheText, "BUSTED");
                CMessages::AddBigMessage(v22, 0x1388u, 2u);
              }
              v23 = v5;
              if ( !nUsingWhichCamera )
              {
                v24 = 0;
                v25 = 0;
                v75 = v23;
                while ( 2 )
                {
                  v38 = v80[v25];
                  if ( v38 >= 1 )
                  {
                    pStoredCopPed = 0;
                    switch ( v38 )
                    {
                      case 1:
                        gTimeDWBustedCamStarted = (float)CTimer::m_snTimeInMilliseconds;
                        if ( !CCam::ProcessDWBustedCam1(v23, m_ArrestingOfficer, 1) )
                          goto LABEL_44;
                        *(_DWORD *)&TheCamera.pTargetEntity->m_nFlags &= ~0x80u;
                        result = 1;
                        nUsingWhichCamera = 1;
                        v23->ResetStatics = 0;
                        return result;
                      case 2:
                        if ( m_ArrestingOfficer )
                        {
                          LookOverShoulderPos = CCam::GetLookOverShoulderPos(
                                                  (CCam *)&vecSource,
                                                  TheCamera.pTargetEntity,
                                                  m_ArrestingOfficer,
                                                  (CVector *)&posn,
                                                  &vecSource);
                          goto LABEL_51;
                        }
                        if ( !v76 )
                          goto LABEL_82;
                        m_pPedIntelligence = v76->m_pPedIntelligence;
                        v31 = 76;
                        do
                        {
                          v32 = v31;
                          m_ArrestingOfficer = (CCopPed *)*((_DWORD *)&m_pPedIntelligence->m_pPed + v31);
                          if ( m_ArrestingOfficer )
                          {
                            ActiveTaskByType = CTaskManager::FindActiveTaskByType(
                                                 &m_ArrestingOfficer->m_pPedIntelligence->m_taskManager,
                                                 1100);
                            if ( ActiveTaskByType )
                            {
                              if ( FindPlayerPed(-1) == (CPlayerPed *)ActiveTaskByType[1]._vptr$CTask )
                              {
                                if ( CCam::GetLookOverShoulderPos(
                                       (CCam *)&vecSource,
                                       TheCamera.pTargetEntity,
                                       m_ArrestingOfficer,
                                       (CVector *)&posn,
                                       &vecSource) == 1 )
                                  goto LABEL_91;
                                v24 = 0;
                              }
                            }
                          }
                          v31 = v32 + 1;
                        }
                        while ( v32 - 76 < 15 );
                        goto LABEL_78;
                      case 3:
                        if ( !m_ArrestingOfficer )
                        {
                          if ( v76 )
                          {
                            v34 = v76->m_pPedIntelligence;
                            v35 = 76;
                            do
                            {
                              v36 = v35;
                              m_ArrestingOfficer = (CCopPed *)*((_DWORD *)&v34->m_pPed + v35);
                              if ( m_ArrestingOfficer )
                              {
                                v37 = CTaskManager::FindActiveTaskByType(
                                        &m_ArrestingOfficer->m_pPedIntelligence->m_taskManager,
                                        1100);
                                if ( v37 )
                                {
                                  if ( FindPlayerPed(-1) == (CPlayerPed *)v37[1]._vptr$CTask )
                                  {
                                    if ( CCam::GetLookOverShoulderPos(
                                           (CCam *)&vecSource,
                                           TheCamera.pTargetEntity,
                                           m_ArrestingOfficer,
                                           (CVector *)&posn,
                                           &vecSource) == 1 )
                                    {
LABEL_91:
                                      pStoredCopPed = m_ArrestingOfficer;
                                      v26 = 0;
                                      v23 = v75;
                                      goto LABEL_52;
                                    }
                                    v24 = 0;
                                  }
                                }
                              }
                              v35 = v36 + 1;
                            }
                            while ( v36 - 76 < 15 );
LABEL_78:
                            m_ArrestingOfficer = 0;
                            v23 = v75;
                            if ( !(v24 << 31) )
                              goto LABEL_57;
                          }
                          else
                          {
LABEL_82:
                            m_ArrestingOfficer = 0;
                            if ( !(v24 << 31) )
                            {
LABEL_57:
                              v24 = 0;
                              v26 = m_ArrestingOfficer;
                              if ( v25 > 4 )
                                break;
                              goto LABEL_89;
                            }
                          }
LABEL_45:
                          v26 = m_ArrestingOfficer;
                          m_ArrestingOfficer = (CCopPed *)pStoredCopPed;
                          if ( pStoredCopPed )
LABEL_52:
                            CEntity::RegisterReference(m_ArrestingOfficer, &pStoredCopPed);
                          nUsingWhichCamera = v38;
                          if ( v38 == 3 )
                          {
                            v28 = (float)((float)((float)rand() * 4.6566e-10) * 5.0) + 0.0;
                            if ( v28 >= 1.0 )
                            {
                              if ( v28 >= 2.0 )
                              {
                                if ( v28 >= 3.0 )
                                {
                                  v29 = 7;
                                  if ( v28 < 4.0 )
                                    v29 = 6;
                                }
                                else
                                {
                                  v29 = 5;
                                }
                              }
                              else
                              {
                                v29 = 4;
                              }
                            }
                            else
                            {
                              v29 = 3;
                            }
                            nUsingWhichCamera = v29;
                          }
                          v24 = 1;
                          goto LABEL_88;
                        }
                        LookOverShoulderPos = CCam::GetLookAlongGroundPos(
                                                (CCam *)&vecSource,
                                                TheCamera.pTargetEntity,
                                                m_ArrestingOfficer,
                                                (CVector *)&posn,
                                                &vecSource.x);
LABEL_51:
                        v26 = 0;
                        v24 = 0;
                        pStoredCopPed = m_ArrestingOfficer;
                        if ( LookOverShoulderPos )
                          goto LABEL_52;
LABEL_88:
                        if ( v25 > 4 )
                          break;
LABEL_89:
                        ++v25;
                        m_ArrestingOfficer = v26;
                        if ( nUsingWhichCamera )
                          break;
                        continue;
                      case 8:
                        if ( !CCam::GetLookFromLampPostPos(
                                (CCam *)&vecSource,
                                (CEntity *)&pStoredCopPed,
                                v20,
                                (CVector *)&posn,
                                &vecSource) )
                          goto LABEL_57;
                        goto LABEL_45;
                      default:
LABEL_44:
                        if ( v24 << 31 )
                          goto LABEL_45;
                        goto LABEL_57;
                    }
                  }
                  break;
                }
              }
              v39 = *(_QWORD *)&vecSource.x;
              v23->Source.z = vecSource.z;
              *(_QWORD *)&v23->Source.x = v39;
              TheCamPos = vecSource;
              CCamera::AvoidTheGeometry(&TheCamera, &TheCamPos, (const CVector *)&posn, &v23->Source, v23->FOV);
              v40 = posn.y - v23->Source.y;
              v41 = posn.z - v23->Source.z;
              v23->Front.x = posn.x - v23->Source.x;
              v23->Front.y = v40;
              v23->Front.z = v41;
              CVector::Normalise(&v23->Front);
              v23->Up.x = 0.0;
              v23->Up.y = 0.0;
              v23->Up.z = 1.0;
              CrossProduct(&v78, &v23->Front, &v23->Up);
              CVector::Normalise(&v78);
              CrossProduct(&v77, &v78, &v23->Front);
              v42 = *(_QWORD *)&v77.x;
              v23->Up.z = v77.z;
              *(_QWORD *)&v23->Up.x = v42;
              if ( nUsingWhichCamera )
                v23->ResetStatics = 0;
              return 1;
            }
            v6 = 3;
            v9 = 2;
LABEL_36:
            v10 = 0;
            goto LABEL_37;
          }
        }
        v6 = 3;
        v9 = 2;
        v7 = 1;
      }
      else
      {
        v9 = 2;
      }
      m_ArrestingOfficer = 0;
      goto LABEL_36;
    }
    m_pLastRenderedLink = TheCamera.pTargetEntity[18].m_pLastRenderedLink;
    if ( m_pLastRenderedLink && CPed::IsPlayer((const CPed *)m_pLastRenderedLink) )
    {
      v14 = (CPed *)pTargetEntity[18].m_pLastRenderedLink;
      CPed::GetBonePosition(v14, &posn, 3u, 1);
    }
    else
    {
      m_pMat = pTargetEntity->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pTargetEntity->m_transform;
      v14 = 0;
      v18 = *(_QWORD *)&p_tx->m_translate.x;
      posn.z = p_tx->m_translate.z;
      *(_QWORD *)&posn.x = v18;
    }
    v76 = v14;
    if ( FindPlayerPed(-1) && FindPlayerPed(-1)->m_pPlayerData->m_ArrestingOfficer )
    {
      v5 = this;
      m_ArrestingOfficer = FindPlayerPed(-1)->m_pPlayerData->m_ArrestingOfficer;
      if ( m_ArrestingOfficer )
      {
        v6 = 2;
        if ( (float)((float)((float)rand() * 4.6566e-10) + 0.0) > 0.65 )
        {
          v80[0] = 2;
          v19 = 3;
          v9 = 2;
          v20 = (CPed *)byte_8;
          v7 = 1;
          v6 = 3;
LABEL_30:
          v21 = 2;
          goto LABEL_38;
        }
        v19 = 3;
        v9 = 1;
        v20 = (CPed *)byte_8;
LABEL_29:
        v7 = 0;
        goto LABEL_30;
      }
    }
    else
    {
      v5 = this;
    }
    v6 = 2;
    v19 = 3;
    v9 = 1;
    v20 = (CPed *)byte_8;
    m_ArrestingOfficer = 0;
    goto LABEL_29;
  }
  v11 = (CPed *)TheCamera.pTargetEntity;
  if ( nUsingWhichCamera != 1 )
  {
    v15 = *(_BYTE *)&TheCamera.pTargetEntity->m_info & 7;
    if ( v15 != 2 )
    {
      if ( v15 != 3 )
        return 0;
      goto LABEL_100;
    }
    if ( TheCamera.pTargetEntity[18].m_pLastRenderedLink )
    {
      if ( CPed::IsPlayer((const CPed *)TheCamera.pTargetEntity[18].m_pLastRenderedLink) )
      {
        v11 = (CPed *)TheCamera.pTargetEntity[18].m_pLastRenderedLink;
LABEL_100:
        CPed::GetBonePosition(v11, &posn, 3u, 1);
        goto LABEL_107;
      }
      v11 = (CPed *)TheCamera.pTargetEntity;
    }
    v43 = v11->m_pMat;
    p_m_transform = (CSimpleTransform *)&v43->tx;
    if ( !v43 )
      p_m_transform = &v11->m_transform;
    v45 = *(_QWORD *)&p_m_transform->m_translate.x;
    posn.z = p_m_transform->m_translate.z;
    *(_QWORD *)&posn.x = v45;
LABEL_107:
    if ( nUsingWhichCamera == 2 && pStoredCopPed )
    {
      v46 = CCam::GetLookOverShoulderPos(
              (CCam *)&vecSource,
              TheCamera.pTargetEntity,
              pStoredCopPed,
              (CVector *)&posn,
              &vecSource);
      p_z = &this->Source.z;
      if ( vecSource.z <= (float)(this->Source.z + (float)(ARRESTCAM_S_ROTATION_UP * CTimer::ms_fTimeStep)) )
      {
        if ( v46 == 1 )
          goto LABEL_129;
      }
      else
      {
        vecSource.z = this->Source.z + (float)(ARRESTCAM_S_ROTATION_UP * CTimer::ms_fTimeStep);
        if ( v46 )
          goto LABEL_129;
      }
LABEL_122:
      v65 = *(_QWORD *)&this->Source.x;
      TheCamPos.z = this->Source.z;
      *(_QWORD *)&TheCamPos.x = v65;
      CCamera::AvoidTheGeometry(&TheCamera, &TheCamPos, (const CVector *)&posn, &this->Source, this->FOV);
      return 1;
    }
    if ( (nUsingWhichCamera & 0xFFFFFFFC) == 4 )
    {
      v48 = *(_QWORD *)&this->Source.x;
      vecSource.z = this->Source.z;
      *(_QWORD *)&vecSource.x = v48;
      v49 = posn.y - this->Source.y;
      v50 = posn.z - this->Source.z;
      this->Front.x = posn.x - this->Source.x;
      this->Front.y = v49;
      this->Front.z = v50;
      CVector::Normalise(&this->Front);
      this->Up.x = 0.0;
      this->Up.y = 0.0;
      this->Up.z = 1.0;
      CrossProduct(&TheCamPos, &this->Front, &this->Up);
      CVector::Normalise(&TheCamPos);
      x = TheCamPos.x;
      if ( (nUsingWhichCamera | 1) == 7 )
      {
        x = -TheCamPos.x;
        y = -TheCamPos.y;
        z = -TheCamPos.z;
        TheCamPos.x = -TheCamPos.x;
        TheCamPos.y = -TheCamPos.y;
        TheCamPos.z = -TheCamPos.z;
      }
      else
      {
        y = TheCamPos.y;
        z = TheCamPos.z;
      }
      v84.y = (float)(y * 0.5) + this->Source.y;
      v84.z = (float)(z * 0.5) + this->Source.z;
      v84.x = (float)(x * 0.5) + this->Source.x;
      if ( CWorld::TestSphereAgainstWorld(v84, 0.4, TheCamera.pTargetEntity, 1, 1, 0, 1, 0, 1) )
        goto LABEL_122;
      p_z = &this->Source.z;
      v66 = (float)((float)(ARRESTCAM_ROTATION_SPEED * TheCamPos.x) * CTimer::ms_fTimeStep) + vecSource.x;
      v67 = (float)((float)(ARRESTCAM_ROTATION_SPEED * TheCamPos.y) * CTimer::ms_fTimeStep) + vecSource.y;
      v68 = (float)((float)(ARRESTCAM_ROTATION_SPEED * TheCamPos.z) * CTimer::ms_fTimeStep) + vecSource.z;
      vecSource.x = v66;
      vecSource.y = v67;
      vecSource.z = v68;
      if ( (nUsingWhichCamera | 2) == 7 )
      {
        v69 = v68 + (float)(ARRESTCAM_ROTATION_UP * CTimer::ms_fTimeStep);
LABEL_128:
        vecSource.z = v69;
        goto LABEL_129;
      }
      LOBYTE(v78.x) = 0;
      GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(v66, v67, v68, (bool *)&v78, 0);
      if ( LOBYTE(v78.x) )
      {
        v69 = GroundZFor3DCoord + ARRESTDIST_ABOVE_GROUND;
        goto LABEL_128;
      }
    }
    else
    {
      if ( nUsingWhichCamera != 8 )
        goto LABEL_122;
      vecSource = this->Source;
      v54 = *(_QWORD *)&vecSource.x;
      v55 = posn.x - vecSource.x;
      v56 = posn.y - vecSource.y;
      this->Front.z = 0.0;
      this->Front.x = v55;
      this->Front.y = v56;
      CVector::Normalise(&this->Front);
      this->Up.x = 0.0;
      this->Up.y = 0.0;
      this->Up.z = 1.0;
      CrossProduct(&TheCamPos, &this->Front, &this->Up);
      CVector::Normalise(&TheCamPos);
      v57 = TheCamPos.x;
      v58 = TheCamPos.y;
      v59 = posn.y - *((float *)&v54 + 1);
      v60 = posn.x;
      v61 = ARRESTCAM_LAMPPOST_ROTATEDIST;
      this->Front.z = 0.0;
      this->Front.x = (float)(v60 - *(float *)&v54) + (float)(v61 * v57);
      this->Front.y = v59 + (float)(v61 * v58);
      CVector::Normalise(&this->Front);
      v62 = vecSource.z;
      v83.x = (float)(this->Front.x * 0.5) + *(float *)&v54;
      v83.y = (float)(this->Front.y * 0.5) + *((float *)&v54 + 1);
      v83.z = (float)(this->Front.z * 0.5) + vecSource.z;
      if ( CWorld::TestSphereAgainstWorld(v83, 0.4, TheCamera.pTargetEntity, 1, 1, 0, 1, 0, 1) )
        goto LABEL_122;
      p_z = &this->Source.z;
      v63 = (float)((float)(ARRESTCAM_LAMPPOST_TRANSLATE * this->Front.y) * CTimer::ms_fTimeStep) + *((float *)&v54 + 1);
      v64 = (float)((float)(ARRESTCAM_LAMPPOST_TRANSLATE * this->Front.z) * CTimer::ms_fTimeStep) + v62;
      vecSource.x = (float)((float)(ARRESTCAM_LAMPPOST_TRANSLATE * this->Front.x) * CTimer::ms_fTimeStep)
                  + *(float *)&v54;
      vecSource.y = v63;
      vecSource.z = v64;
    }
LABEL_129:
    v71 = *(_QWORD *)&vecSource.x;
    this->Source.z = vecSource.z;
    *(_QWORD *)&this->Source.x = v71;
    TheCamPos = vecSource;
    CCamera::AvoidTheGeometry(&TheCamera, &TheCamPos, (const CVector *)&posn, &this->Source, this->FOV);
    v72 = posn.z - *p_z;
    v73 = posn.y - this->Source.y;
    this->Front.x = posn.x - this->Source.x;
    this->Front.y = v73;
    this->Front.z = v72;
    CVector::Normalise(&this->Front);
    this->Up.x = 0.0;
    this->Up.y = 0.0;
    this->Up.z = 1.0;
    CrossProduct(&v78, &this->Front, &this->Up);
    CVector::Normalise(&v78);
    CrossProduct(&v77, &v78, &this->Front);
    v74 = *(_QWORD *)&v77.x;
    this->Up.z = v77.z;
    *(_QWORD *)&this->Up.x = v74;
    return 1;
  }
  *(_DWORD *)&TheCamera.pTargetEntity->m_nFlags &= ~0x80u;
  if ( FindPlayerPed(-1) && FindPlayerPed(-1)->m_pPlayerData->m_ArrestingOfficer )
    v12 = FindPlayerPed(-1)->m_pPlayerData->m_ArrestingOfficer;
  else
    v12 = 0;
  return CCam::ProcessDWBustedCam1(this, v12, 0);
}
// 3CCE80: conditional instruction was optimized away because r6.4!=0
// 3CCD34: variable 'v20' is possibly undefined
// 0: using guessed type int dword_0;

//----- (003CD524) --------------------------------------------------------
void __fastcall CCam::Process_AttachedCam(CCam *this)
{
  CEntity *pAttachedEntity; // r5
  float m_fAttachedCamAngle; // s18
  CMatrix *m_pMat; // r1
  __int64 v5; // d16
  float y; // s2
  CMatrix *v7; // r1
  float z; // s4
  CSimpleTransform *p_tx; // r2
  float v10; // s0
  float v11; // s2
  float v12; // s4
  CEntity *v13; // r5
  CMatrix *v14; // r1
  __int64 v15; // d16
  float v16; // s2
  CMatrix *v17; // r1
  float v18; // s4
  CSimpleTransform *p_m_transform; // r2
  float x; // s6
  RwReal v21; // s0
  RwReal v22; // s0
  RwReal v23; // s2
  float v24; // s8
  RwReal v25; // s6
  float v26; // s2
  float v27; // s4
  CMatrix *v28; // r1
  CSimpleTransform *v29; // r2
  RwReal v30; // s2
  RwReal v31; // s4
  float v32; // s16
  float v33; // s6
  float v34; // s6
  float v35; // r6
  float v36; // r0
  RwReal v37; // s2
  RwReal v38; // s4
  CVector v39; // [sp+8h] [bp-58h] BYREF
  CVector v2; // [sp+18h] [bp-48h] BYREF
  CVector v41; // [sp+28h] [bp-38h] BYREF

  this->FOV = 70.0;
  pAttachedEntity = TheCamera.pAttachedEntity;
  m_fAttachedCamAngle = TheCamera.m_fAttachedCamAngle;
  m_pMat = TheCamera.pAttachedEntity->m_pMat;
  if ( !m_pMat )
  {
    CPlaceable::AllocateMatrix(TheCamera.pAttachedEntity);
    CSimpleTransform::UpdateMatrix(&pAttachedEntity->m_transform, pAttachedEntity->m_pMat);
    m_pMat = pAttachedEntity->m_pMat;
  }
  Multiply3x3(&v41, m_pMat, &TheCamera.m_vecAttachedCamOffset);
  v5 = *(_QWORD *)&v41.x;
  this->Source.z = v41.z;
  *(_QWORD *)&this->Source.x = v5;
  y = this->Source.y;
  v7 = TheCamera.pAttachedEntity->m_pMat;
  z = this->Source.z;
  p_tx = (CSimpleTransform *)&v7->tx;
  if ( !v7 )
    p_tx = &TheCamera.pAttachedEntity->m_transform;
  v10 = p_tx->m_translate.x + this->Source.x;
  this->Source.x = v10;
  v11 = p_tx->m_translate.y + y;
  this->Source.y = v11;
  v12 = p_tx->m_translate.z + z;
  this->Source.z = v12;
  if ( TheCamera.m_bLookingAtVector )
  {
    v13 = TheCamera.pAttachedEntity;
    v14 = TheCamera.pAttachedEntity->m_pMat;
    if ( !v14 )
    {
      CPlaceable::AllocateMatrix(TheCamera.pAttachedEntity);
      CSimpleTransform::UpdateMatrix(&v13->m_transform, v13->m_pMat);
      v14 = v13->m_pMat;
    }
    Multiply3x3(&v41, v14, &TheCamera.m_vecAttachedCamLookAt);
    v15 = *(_QWORD *)&v41.x;
    this->Front.z = v41.z;
    *(_QWORD *)&this->Front.x = v15;
    v16 = this->Front.y;
    v17 = TheCamera.pAttachedEntity->m_pMat;
    v18 = this->Front.z;
    p_m_transform = (CSimpleTransform *)&v17->tx;
    x = this->Source.x;
    if ( !v17 )
      p_m_transform = &TheCamera.pAttachedEntity->m_transform;
    v21 = p_m_transform->m_translate.x + this->Front.x;
    this->Front.x = v21;
    v22 = v21 - x;
    v23 = p_m_transform->m_translate.y + v16;
    v24 = this->Source.y;
    this->Front.y = v23;
    v25 = v23 - v24;
    v26 = p_m_transform->m_translate.z + v18;
    v27 = this->Source.z;
    this->Front.x = v22;
    this->Front.y = v25;
    this->Front.z = v26 - v27;
  }
  else
  {
    v28 = TheCamera.pTargetEntity->m_pMat;
    v29 = (CSimpleTransform *)&v28->tx;
    if ( !v28 )
      v29 = &TheCamera.pTargetEntity->m_transform;
    v30 = v29->m_translate.y - v11;
    v31 = v29->m_translate.z - v12;
    this->Front.x = v29->m_translate.x - v10;
    this->Front.y = v30;
    this->Front.z = v31;
  }
  v32 = (float)(m_fAttachedCamAngle * 3.1416) / 180.0;
  CVector::Normalise(&this->Front);
  v2.x = 0.0;
  v2.y = 0.0;
  v2.z = 1.0;
  CrossProduct(&v39, &this->Front, &v2);
  v41 = v39;
  CVector::Normalise(&v41);
  CrossProduct(&v39, &v41, &this->Front);
  v2 = v39;
  CVector::Normalise(&v2);
  v39.x = 0.0;
  if ( CWaterLevel::GetWaterLevel(this->Source.x, this->Source.y, this->Source.z, &v39.x, 1, 0) == 1
    && this->Source.z < (float)(v39.x + -0.3) )
  {
    v33 = sqrtf(
            (float)((float)(CTimeCycle::m_CurrentColours.m_fWaterRed * CTimeCycle::m_CurrentColours.m_fWaterRed)
                  + (float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * CTimeCycle::m_CurrentColours.m_fWaterGreen))
          + (float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * CTimeCycle::m_CurrentColours.m_fWaterBlue));
    if ( v33 <= BOAT_UNDERWATER_CAM_COLORMAG_LIMIT )
    {
      TheCamera.m_BlurType = 2;
      TheCamera.m_BlurBlue = (int)CTimeCycle::m_CurrentColours.m_fWaterBlue;
      TheCamera.m_BlurGreen = (int)CTimeCycle::m_CurrentColours.m_fWaterGreen;
      TheCamera.m_BlurRed = (int)CTimeCycle::m_CurrentColours.m_fWaterRed;
      TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
    }
    else
    {
      v34 = BOAT_UNDERWATER_CAM_COLORMAG_LIMIT / v33;
      TheCamera.m_BlurType = 2;
      TheCamera.m_motionBlur = BOAT_UNDERWATER_CAM_BLUR;
      TheCamera.m_BlurBlue = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterBlue * v34);
      TheCamera.m_BlurGreen = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterGreen * v34);
      TheCamera.m_BlurRed = (int)(float)(CTimeCycle::m_CurrentColours.m_fWaterRed * v34);
    }
  }
  v35 = cosf(v32);
  v36 = sinf(v32);
  v37 = (float)(v35 * v2.y) + (float)(v36 * v41.y);
  v38 = (float)(v35 * v2.z) + (float)(v36 * v41.z);
  this->Up.x = (float)(v35 * v2.x) + (float)(v36 * v41.x);
  this->Up.y = v37;
  this->Up.z = v38;
  CWorld::pIgnoreEntity = 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003CD8A0) --------------------------------------------------------
bool __fastcall CCam::Process_DW_HeliChaseCam(CCam *this, bool bCheckValid)
{
  bool v3; // r6
  float v4; // s16
  int v5; // s0
  CEntity *CamTargetEntity; // r0
  int v7; // r11
  int v8; // r10
  CHeliCamSettings *v9; // r4
  float x; // s20
  int v11; // r9
  float y; // s22
  int v13; // r5
  float v14; // s24
  float v15; // s0
  int numAttemptsToFindAValidOne; // r0
  float v17; // s20
  float v18; // s22
  CHeliCamSettings *v19; // r0
  float v20; // s24
  float v21; // s26
  float v22; // s28
  int v23; // r1
  float *v24; // r9
  float *v25; // r10
  float v26; // s6
  float v27; // s8
  float v28; // s10
  float v29; // s4
  float v30; // s0
  float v31; // s2
  float v32; // s2
  char v33; // r8
  char v34; // r0
  float v35; // s2
  float heliOutSideOfVehicle; // s0
  bool v37; // zf
  float v38; // s4
  float v39; // s8
  float v40; // s0
  RwReal v41; // s6
  float v42; // s10
  float v43; // s2
  float v44; // s10
  float v45; // s12
  RwReal v46; // s2
  int v47; // r0
  CHeliCamSettings *v49; // r1
  float v50; // s18
  float z; // s0
  float heliSpeedLookInFrontMul; // s6
  float32x2_t v53; // d14
  float v54; // s2
  float v55; // s26
  float32x2_t v56; // d11
  float32x2_t v57; // d0
  unsigned __int64 v58; // d1
  float v59; // s30
  float gLenToCarToPushCameraOut; // s4
  float v61; // s2
  float v62; // s2
  CHeliCamSettings *v63; // r0
  float zoomInTime; // s0
  float zoomFOVEnd; // s24
  float gHeliDistFOVZoomMore; // s2
  float v67; // s0
  float v68; // s0
  float v69; // s2
  CHeliCamSettings *v70; // r6
  bool *p_gbHeliCollided; // r6
  _BOOL4 gbHeliCollided; // t1
  float v73; // s22
  char v74; // r0
  __int64 v76; // d16
  float v77; // s16
  CHeliCamSettings *v78; // r6
  bool *p_gbLockDest; // r6
  _BOOL4 gbLockDest; // t1
  CHeliCamSettings *v81; // r0
  int32 gLockDestTimeOut; // r1
  int v83; // r0
  CHeliCamSettings *v84; // r2
  bool *p_gZoomBackOut; // r2
  _BOOL4 gZoomBackOut; // t1
  bool *v87; // r0
  int v88; // r1
  CHeliCamSettings *v89; // r3
  int32 v90; // r2
  __int64 v91; // d16
  CHeliCamSettings *v92; // r0
  CHeliCamSettings *v93; // r0
  int32 gDefaultFramesOutOfSightBeforeWeLoseTheCar; // r1
  int32 gFramesBeenOutOfSight; // r2
  CHeliCamSettings *v96; // r1
  bool *v97; // r1
  _BOOL4 v98; // t1
  CHeliCamSettings *v99; // r2
  int32 v100; // r1
  float v101; // s0
  float v102; // s0
  float32x2_t v103; // d16
  unsigned __int64 v104; // d1
  float v105; // s0
  float bCheckBuildings; // [sp+4h] [bp-1A4h]
  uint32 v107; // [sp+24h] [bp-184h]
  CCam *v108; // [sp+28h] [bp-180h]
  int v109; // [sp+2Ch] [bp-17Ch]
  bool *p_gbNoZoom; // [sp+4Ch] [bp-15Ch]
  bool *v111; // [sp+50h] [bp-158h]
  CEntity *v112; // [sp+5Ch] [bp-14Ch]
  float *p_y; // [sp+60h] [bp-148h]
  float *p_z; // [sp+64h] [bp-144h]
  float *p_behindStart; // [sp+70h] [bp-138h]
  float *p_heliHeight; // [sp+74h] [bp-134h]
  float *p_heliSpeed; // [sp+84h] [bp-124h]
  float32x2_t *v118; // [sp+88h] [bp-120h]
  CVector *vecEnd; // [sp+8Ch] [bp-11Ch]
  int v120; // [sp+90h] [bp-118h]
  CEntity *refEntityPtr; // [sp+94h] [bp-114h] BYREF
  CColPoint colPoint; // [sp+98h] [bp-110h] BYREF
  CColSphere sph; // [sp+C4h] [bp-E4h] BYREF
  float v124; // [sp+D8h] [bp-D0h] BYREF
  float v125; // [sp+DCh] [bp-CCh] BYREF
  CVector targetAngMotion; // [sp+E0h] [bp-C8h] BYREF
  CVector targetMotion; // [sp+ECh] [bp-BCh] BYREF
  CVector v128; // [sp+F8h] [bp-B0h] BYREF
  CVector v129; // [sp+108h] [bp-A0h] BYREF
  CVector v130; // [sp+114h] [bp-94h] BYREF
  CVector pSrc; // [sp+120h] [bp-88h] BYREF
  CVector dst; // [sp+130h] [bp-78h] BYREF
  CVehicle *pVehicle; // [sp+140h] [bp-68h] BYREF
  CEntity *pEntity; // [sp+144h] [bp-64h] BYREF
  CVector v135; // 0:r0.12
  CVector v136; // 0:r0.12

  v3 = 0;
  TheCamera.m_bUseNearClipScript = 0;
  v4 = 0.0;
  v5 = (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * 0.0);
  CamTargetEntity = this->CamTargetEntity;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
      return 0;
    v7 = v5;
    v118 = (float32x2_t *)&gHCM[v5];
    CCam::GetCoreDataForDWCineyCamMode(
      this,
      &pEntity,
      &pVehicle,
      &dst,
      &pSrc,
      &v130,
      &v129,
      &v128,
      &targetMotion,
      &v125,
      &targetAngMotion,
      &v124,
      &sph);
    v8 = CTimer::m_snTimeInMilliseconds;
    if ( gDWLastModeForCineyCam == 56 && gLastFrameProcessedDWCineyCam >= CTimer::m_FrameCounter - 1 )
    {
LABEL_16:
      if ( gbExitCam[0] )
        return 0;
      v49 = &gHCM[v7];
      v50 = (float)(v8 - gDWCineyCamStartTime) / (float)(gDWCineyCamEndTime - gDWCineyCamStartTime);
      z = v49->heliMoveFrom.z;
      heliSpeedLookInFrontMul = v49->heliSpeedLookInFrontMul;
      v53.n64_u64[0] = vadd_f32(
                         *(float32x2_t *)&v49->heliMoveFrom.x,
                         vmul_n_f32(vsub_f32((float32x2_t)v118->n64_u64[0], *(float32x2_t *)&v49->heliMoveFrom.x), v50)).n64_u64[0];
      v54 = v50 * (float)(v49->heliMoveTo.z - z);
      *(float32x2_t *)&pSrc.x = v53;
      v55 = z + v54;
      v56.n64_u64[0] = vadd_f32(
                         *(float32x2_t *)&dst.x,
                         vadd_f32(
                           *(float32x2_t *)&v128.x,
                           vmul_n_f32(vmul_n_f32(*(float32x2_t *)&v128.x, v125), heliSpeedLookInFrontMul))).n64_u64[0];
      v57.n64_u64[0] = vsub_f32(v56, v53).n64_u64[0];
      pSrc.z = v55;
      *(float32x2_t *)&dst.x = v56;
      v58 = vmul_f32(v57, v57).n64_u64[0];
      v59 = (float)(v128.z + (float)((float)(v125 * v128.z) * heliSpeedLookInFrontMul)) + dst.z;
      gLenToCarToPushCameraOut = v49->gLenToCarToPushCameraOut;
      dst.z = v59;
      v61 = sqrtf(*(float *)&v58 + *((float *)&v58 + 1));
      if ( v61 < gLenToCarToPushCameraOut )
      {
        v62 = 1.0 / v61;
        v53.n64_f32[1] = v56.n64_f32[1] - (float)((float)(v57.n64_f32[1] * v62) * gLenToCarToPushCameraOut);
        v53.n64_f32[0] = v56.n64_f32[0] - (float)(gLenToCarToPushCameraOut * (float)(v57.n64_f32[0] * v62));
        pSrc.y = v53.n64_f32[1];
        pSrc.x = v53.n64_f32[0];
      }
      v63 = &gHCM[v7];
      zoomInTime = v63->zoomInTime;
      zoomFOVEnd = v63->zoomFOVEnd;
      if ( v50 < zoomInTime && !gHCM[v7].gbNoZoom )
        zoomFOVEnd = gHCM[v7].zoomFOVStart
                   + (float)((float)(zoomFOVEnd - gHCM[v7].zoomFOVStart)
                           * (float)((float)(sinf(
                                               (float)((float)(270.0
                                                             - (float)((float)(v50 * (float)(1.0 / zoomInTime)) * 180.0))
                                                     * 3.1416)
                                             / 180.0)
                                           + 1.0)
                                   * 0.5));
      gHeliDistFOVZoomMore = gHCM[v7].gHeliDistFOVZoomMore;
      v67 = sqrtf(
              (float)((float)((float)(v53.n64_f32[0] - v56.n64_f32[0]) * (float)(v53.n64_f32[0] - v56.n64_f32[0]))
                    + (float)((float)(v53.n64_f32[1] - v56.n64_f32[1]) * (float)(v53.n64_f32[1] - v56.n64_f32[1])))
            + (float)((float)(v55 - v59) * (float)(v55 - v59)));
      if ( v67 > gHeliDistFOVZoomMore )
      {
        v68 = (float)(v67 - gHeliDistFOVZoomMore) / (float)(gHCM[v7].gHeliDistFOVZoomMoreMax - gHeliDistFOVZoomMore);
        v69 = 0.0;
        if ( v68 >= 0.0 )
        {
          v69 = 1.0;
          if ( v68 <= 1.0 )
            v69 = v68;
        }
        v4 = (float)(gHCM[v7].gLessFOV
                   * (float)((float)(sinf((float)((float)(270.0 - (float)(v69 * 180.0)) * 3.1416) / 180.0) + 1.0) * 0.5))
           + 0.0;
      }
      v70 = &gHCM[v7];
      gbHeliCollided = v70->gbHeliCollided;
      p_gbHeliCollided = &v70->gbHeliCollided;
      v73 = *((float *)p_gbHeliCollided - 9);
      if ( gbHeliCollided
        || (v136.z = v55, *(float32x2_t *)&v136.x = v53, CWorld::TestSphereAgainstWorld(v136, 15.0, 0, 1, 1, 0, 0, 0, 0)) )
      {
        v74 = `guard variable for'CCam::Process_DW_HeliChaseCam(bool)::SlowPos;
        __dmb(0xBu);
        if ( (v74 & 1) == 0
          && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_HeliChaseCam(bool)::SlowPos) )
        {
          _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_HeliChaseCam(bool)::SlowPos);
        }
        if ( *p_gbHeliCollided )
        {
          if ( CCam::Process_DW_HeliChaseCam(bool)::gTimeSlowTime-- <= -1 )
          {
            v3 = 0;
            pSrc = DWCineyCamLastPos;
            gbExitCam[0] = 1;
            return v3;
          }
        }
        else
        {
          v76 = *(_QWORD *)&pSrc.x;
          *p_gbHeliCollided = 1;
          CCam::Process_DW_HeliChaseCam(bool)::SlowPos.z = pSrc.z;
          *(_QWORD *)&CCam::Process_DW_HeliChaseCam(bool)::SlowPos.x = v76;
          CCam::Process_DW_HeliChaseCam(bool)::gTimeSlowTime = 99;
        }
        pSrc.x = CCam::Process_DW_HeliChaseCam(bool)::SlowPos.x
               + (float)((float)(pSrc.x - CCam::Process_DW_HeliChaseCam(bool)::SlowPos.x) * 0.5);
        pSrc.y = CCam::Process_DW_HeliChaseCam(bool)::SlowPos.y
               + (float)((float)(pSrc.y - CCam::Process_DW_HeliChaseCam(bool)::SlowPos.y) * 0.5);
        pSrc.z = CCam::Process_DW_HeliChaseCam(bool)::SlowPos.z
               + (float)((float)(pSrc.z - CCam::Process_DW_HeliChaseCam(bool)::SlowPos.z) * 0.5);
      }
      v77 = zoomFOVEnd - v4;
      v78 = &gHCM[v7];
      gbLockDest = v78->gbLockDest;
      p_gbLockDest = &v78->gbLockDest;
      if ( gbLockDest )
      {
        v81 = &gHCM[v7];
        dst.z = v81->gLockedDest.z;
        gLockDestTimeOut = v81->gLockDestTimeOut;
        *(_QWORD *)&dst.x = *(_QWORD *)&v81->gLockedDest.x;
        v81->gLockDestTimeOut = gLockDestTimeOut - 1;
        if ( !gLockDestTimeOut )
          goto LABEL_66;
      }
      else
      {
        CWorld::pIgnoreEntity = pEntity;
        v83 = CWorld::ProcessLineOfSight(&dst, &pSrc, &colPoint, &refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
        CWorld::pIgnoreEntity = 0;
        if ( v83 == 1 )
        {
          v84 = &gHCM[v7];
          gZoomBackOut = v84->gZoomBackOut;
          p_gZoomBackOut = &v84->gZoomBackOut;
          v87 = p_gZoomBackOut - 36;
          v88 = *((_DWORD *)p_gZoomBackOut - 9);
          *(p_gZoomBackOut - 8) = 1;
          if ( !gZoomBackOut && v88 < gHCM[v7].gDefaultFramesOutOfSightBeforeWeLoseTheCar / 4 )
          {
            v89 = &gHCM[v7];
            v89->gFOVZoomBackOutFrom = v77;
            *p_gZoomBackOut = 1;
            v90 = v89->gZoomBackOutSpeed + v8;
            v89->gZoomBackOutTimeStart = v8;
            v89->gZoomBackOutTimeEnd = v90;
          }
          *(_DWORD *)v87 = v88 - 1;
          if ( !v88 )
          {
            v91 = *(_QWORD *)&dst.x;
            v92 = &gHCM[v7];
            v92->gLockedDest.z = dst.z;
            *(_QWORD *)&v92->gLockedDest.x = v91;
            *p_gbLockDest = 1;
          }
        }
        else
        {
          v93 = &gHCM[v7];
          gFramesBeenOutOfSight = v93->gFramesBeenOutOfSight;
          gDefaultFramesOutOfSightBeforeWeLoseTheCar = v93->gDefaultFramesOutOfSightBeforeWeLoseTheCar;
          if ( gFramesBeenOutOfSight < gDefaultFramesOutOfSightBeforeWeLoseTheCar )
            gDefaultFramesOutOfSightBeforeWeLoseTheCar = gFramesBeenOutOfSight + 1;
          v93->gFramesBeenOutOfSight = gDefaultFramesOutOfSightBeforeWeLoseTheCar;
        }
      }
      v96 = &gHCM[v7];
      v98 = v96->gZoomBackOut;
      v97 = &v96->gZoomBackOut;
      if ( !v98 )
      {
        if ( v50 < gHCM[v7].timeToZoomOut )
          goto LABEL_61;
        v99 = &gHCM[v7];
        v99->gFOVZoomBackOutFrom = v77;
        *v97 = 1;
        v100 = v99->gZoomBackOutSpeed + v8;
        v99->gZoomBackOutTimeStart = v8;
        v99->gZoomBackOutTimeEnd = v100;
      }
      v101 = (float)((float)v8 - (float)gHCM[v7].gZoomBackOutTimeStart)
           / (float)((float)gHCM[v7].gZoomBackOutTimeEnd - (float)gHCM[v7].gZoomBackOutTimeStart);
      if ( v101 >= 0.0 )
      {
        if ( v101 > 1.0 )
          v102 = 180.0;
        else
          v102 = v101 * 180.0;
      }
      else
      {
        v102 = 0.0;
      }
      v77 = gHCM[v7].gFOVZoomBackOutFrom
          + (float)((float)((float)(sinf((float)((float)(270.0 - v102) * 3.1416) / 180.0) + 1.0) * 0.5)
                  * (float)(gHCM[v7].zoomFOVStart - gHCM[v7].gFOVZoomBackOutFrom));
LABEL_61:
      if ( !gbExitCam[0] )
      {
        v103.n64_u64[0] = vsub_f32(*(float32x2_t *)&dst.y, *(float32x2_t *)&pSrc.y).n64_u64[0];
        v104 = vmul_f32(v103, v103).n64_u64[0];
        v105 = sqrtf(
                 (float)((float)((float)(dst.x - pSrc.x) * (float)(dst.x - pSrc.x)) + *(float *)&v104)
               + *((float *)&v104 + 1));
        if ( v105 >= gMovieCamMinDist[0]
          && v105 <= gMovieCamMaxDist[0]
          && CTimer::m_snTimeInMilliseconds <= gDWCineyCamEndTime )
        {
          CCam::Finalise_DW_CineyCams(this, &pSrc, &dst, v50 * v73, v77, bCheckBuildings, 1.0);
          return 1;
        }
      }
LABEL_66:
      v3 = 0;
      gbExitCam[0] = 1;
      return v3;
    }
    v9 = &gHCM[v5];
    gDWLastModeForCineyCam = 56;
    v3 = 0;
    gDWCineyCamStartTime = CTimer::m_snTimeInMilliseconds;
    gbExitCam[0] = 0;
    gDWCineyCamEndTime = gDWCamMaxDurationMs[0] + CTimer::m_snTimeInMilliseconds;
    v107 = CTimer::m_snTimeInMilliseconds;
    v108 = this;
    v109 = v5;
    v9->heliRollScale = 0.0;
    v9->heliClip = 10.0;
    v9->gHeliDistFOVZoomMore = 100.0;
    v9->gHeliDistFOVZoomMoreMax = 110.0;
    v9->gLessFOV = 10.0;
    v9->gLenToCarToPushCameraOut = 5.0;
    *(_QWORD *)&v9->timeToZoomOut = 0xFA03F400000LL;
    *(_QWORD *)&v9->zoomInTime = 0x428C00003D4CCCCDLL;
    *(_QWORD *)&v9->zoomFOVEnd = 0x3F80000041B00000LL;
    p_heliSpeed = &v9->heliSpeed;
    *(_QWORD *)&v9->heliSpeed = 0x41F0000042480000LL;
    *(_QWORD *)&v9->heliHeight = 0x42480000425C0000LL;
    v9->gRadiusOfSphereAroundHeli = 12.0;
    v9->gZoomOutFOV = 48.0;
    v9->numAttemptsToFindAValidOne = 8;
    v9->gLockDestHeliTimeoutDefault = 30;
    v9->gDefaultFramesOutOfSightBeforeWeLoseTheCar = 60;
    v9->gbLockDest = 0;
    v9->gbHeliCollided = 0;
    v9->gbWeLostTheCar = 0;
    v9->gbNoZoom = 0;
    v9->gFramesBeenOutOfSight = 60;
    p_gbNoZoom = &v9->gbNoZoom;
    v9->gLockDestTimeOut = 30;
    v9->gZoomBackOut = 0;
    v111 = &v9->gZoomBackOut;
    v9->heliSpeed = v9->heliSpeed * (float)((float)((float)((float)rand() * 4.6566e-10) * 1.4) + 0.1);
    v9->behindStart = v9->behindStart * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + 0.5);
    v9->heliHeight = v9->heliHeight * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + 0.5);
    v9->heliOutSideOfVehicle = v9->heliOutSideOfVehicle
                             * (float)((float)((float)((float)rand() * 4.6566e-10) * 0.5) + 0.5);
    v9->zoomInTime = v9->zoomInTime * (float)((float)((float)((float)rand() * 4.6566e-10) * 1.5) + 0.5);
    gHandShaker[0].ang.x = 0.0;
    gHandShaker[0].ang.y = 0.0;
    gHandShaker[0].ang.z = 0.0;
    x = gHandShaker[0].motion.x;
    v11 = rand();
    y = gHandShaker[0].motion.y;
    v13 = rand();
    v14 = gHandShaker[0].motion.z;
    v15 = (float)rand();
    numAttemptsToFindAValidOne = v9->numAttemptsToFindAValidOne;
    gHandShaker[0].vel.x = (float)(x * (float)((float)v11 * 4.6566e-10)) + 0.0;
    gHandShaker[0].vel.y = (float)(y * (float)((float)v13 * 4.6566e-10)) + 0.0;
    gHandShaker[0].vel.z = (float)(v14 * (float)(v15 * 4.6566e-10)) + 0.0;
    if ( numAttemptsToFindAValidOne >= 1 )
    {
      v17 = v128.x;
      p_behindStart = &v9->behindStart;
      p_heliHeight = &v9->heliHeight;
      v18 = v128.y;
      v19 = &gHCM[v109];
      v112 = pEntity;
      v20 = v128.z;
      v21 = v129.x;
      v22 = v129.y;
      p_z = &v19->heliMoveFrom.z;
      vecEnd = &v19->heliMoveFrom;
      p_y = &v19->heliMoveFrom.y;
      v23 = 0;
      v24 = &v19->heliMoveTo.y;
      v25 = &v19->heliMoveTo.z;
      while ( 1 )
      {
        v26 = dst.x;
        v27 = dst.y;
        v28 = dst.z;
        v120 = v23;
        v29 = dst.y - (float)(v18 * *p_behindStart);
        v30 = dst.z - (float)(v20 * *p_behindStart);
        vecEnd->x = dst.x - (float)(v17 * *p_behindStart);
        *p_y = v29;
        v31 = *p_heliSpeed;
        v118->n64_f32[0] = v26 + (float)(v17 * *p_heliSpeed);
        *v24 = (float)(v18 * v31) + v27;
        v32 = *p_heliHeight + (float)((float)(v20 * v31) + v28);
        *p_z = *p_heliHeight + v30;
        *v25 = v32;
        v33 = rand();
        v34 = rand();
        v35 = 1.0;
        heliOutSideOfVehicle = v9->heliOutSideOfVehicle;
        if ( (v33 & 1) != 0 )
          v35 = -1.0;
        v37 = (v34 & 1) == 0;
        v38 = v21 * heliOutSideOfVehicle;
        v39 = v22 * heliOutSideOfVehicle;
        v40 = heliOutSideOfVehicle * 0.0;
        v41 = vecEnd->x + (float)(v35 * v38);
        v42 = v35 * v39;
        v43 = v35 * v40;
        vecEnd->x = v41;
        v135.x = v41;
        v44 = v42 + *p_y;
        v45 = 1.0;
        if ( !v37 )
          v45 = -1.0;
        *p_y = v44;
        v135.y = v44;
        v3 = 0;
        v46 = v43 + *p_z;
        *p_z = v46;
        v135.z = v46;
        v118->n64_f32[0] = v118->n64_f32[0] + (float)(v45 * v38);
        *v24 = (float)(v45 * v39) + *v24;
        *v25 = (float)(v45 * v40) + *v25;
        if ( !CWorld::TestSphereAgainstWorld(v135, v9->gRadiusOfSphereAroundHeli, 0, 1, 1, 0, 0, 0, 0) )
        {
          CWorld::pIgnoreEntity = v112;
          v47 = CWorld::ProcessLineOfSight(&dst, vecEnd, &colPoint, &refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
          CWorld::pIgnoreEntity = 0;
          if ( v47 != 1 )
            break;
        }
        v23 = v120 + 1;
        if ( v120 + 1 >= v9->numAttemptsToFindAValidOne )
          goto LABEL_14;
      }
      *p_gbNoZoom = rand() & 1;
      v7 = v109;
      *v111 = rand() & 1;
      v8 = v107;
      this = v108;
      goto LABEL_16;
    }
LABEL_14:
    v9->gbLockDest = 0;
    v9->gbHeliCollided = 0;
    v9->gbWeLostTheCar = 0;
    *p_gbNoZoom = 0;
    v9->gZoomOutFOV = v9->zoomFOVStart - v9->zoomFOVEnd;
    v9->gFramesBeenOutOfSight = v9->gDefaultFramesOutOfSightBeforeWeLoseTheCar;
    v9->gLockDestTimeOut = v9->gLockDestHeliTimeoutDefault;
    *v111 = 0;
    gbExitCam[0] = 1;
  }
  return v3;
}
// 3CE484: variable 'bCheckBuildings' is possibly undefined
// 9530AC: using guessed type char `guard variable for'CCam::Process_DW_HeliChaseCam(bool)::SlowPos;
// 3CD8A0: using guessed type float var_D0;

//----- (003CE5B0) --------------------------------------------------------
bool __fastcall CCam::Process_DW_CamManCam(CCam *this, bool bCheckValid)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d2
  float32x2_t v4; // d8
  bool result; // r0
  CEntity *CamTargetEntity; // r1
  int32 v8; // r10
  char v9; // r0
  char v10; // r0
  float x; // s16
  int v12; // r0
  float y; // s18
  float v14; // s20
  int v15; // r0
  float z; // s22
  float v17; // s24
  int v18; // r0
  float v19; // s22
  int v20; // r6
  int v21; // r0
  CEntity *v22; // r6
  CMatrix *m_pMat; // r0
  float32x2_t *p_tx; // r1
  float32x2_t v25; // d16
  float v26; // s24
  CColModel *ColModel; // r0
  __int64 v28; // d16
  CPlaceable *v29; // r6
  const CMatrix *v30; // r1
  CEntity *v31; // r0
  float v32; // s0
  CEntity *v33; // r0
  float v34; // s0
  float v35; // s20
  float v36; // s0
  float v37; // s4
  float v38; // s2
  float v39; // s22
  float v40; // s2
  float v41; // s18
  float v42; // s0
  float v43; // s2
  int v44; // r0
  int32 v45; // r1
  int v46; // r2
  float v47; // [sp+4h] [bp-184h]
  int32 v48; // [sp+28h] [bp-160h]
  int v49; // [sp+2Ch] [bp-15Ch]
  CVector v50; // [sp+30h] [bp-158h] BYREF
  CVector Coors; // [sp+3Ch] [bp-14Ch] BYREF
  CVector v; // [sp+48h] [bp-140h] BYREF
  CVector v53; // [sp+58h] [bp-130h] BYREF
  Int16 pNum; // [sp+66h] [bp-122h] BYREF
  CColPoint v55; // [sp+68h] [bp-120h] BYREF
  CColSphere sph; // [sp+A8h] [bp-E0h] BYREF
  float v57; // [sp+BCh] [bp-CCh] BYREF
  float v58; // [sp+C0h] [bp-C8h] BYREF
  CVector targetAngMotion; // [sp+C4h] [bp-C4h] BYREF
  CVector targetMotion; // [sp+D0h] [bp-B8h] BYREF
  CVector v61; // [sp+DCh] [bp-ACh] BYREF
  CVector v62; // [sp+E8h] [bp-A0h] BYREF
  CVector v63; // [sp+F4h] [bp-94h] BYREF
  CVector vecEnd; // [sp+100h] [bp-88h] BYREF
  CVector dst; // [sp+110h] [bp-78h] BYREF
  CVehicle *pVehicle; // [sp+120h] [bp-68h] BYREF
  CEntity *pEntity; // [sp+124h] [bp-64h] BYREF

  result = 0;
  TheCamera.m_bUseNearClipScript = 0;
  CamTargetEntity = this->CamTargetEntity;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
      return 0;
    CCam::GetCoreDataForDWCineyCamMode(
      this,
      &pEntity,
      &pVehicle,
      &dst,
      &vecEnd,
      &v63,
      &v62,
      &v61,
      &targetMotion,
      &v58,
      &targetAngMotion,
      &v57,
      &sph);
    v8 = CTimer::m_snTimeInMilliseconds;
    v9 = `guard variable for'CCam::Process_DW_CamManCam(bool)::persistantLampPostPos;
    __dmb(0xBu);
    if ( (v9 & 1) == 0
      && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_CamManCam(bool)::persistantLampPostPos) )
    {
      _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_CamManCam(bool)::persistantLampPostPos);
    }
    v10 = `guard variable for'CCam::Process_DW_CamManCam(bool)::timeout;
    __dmb(0xBu);
    if ( (v10 & 1) == 0 && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_CamManCam(bool)::timeout) )
    {
      CCam::Process_DW_CamManCam(bool)::timeout = 100;
      _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_CamManCam(bool)::timeout);
    }
    if ( gDWLastModeForCineyCam != 57 || gLastFrameProcessedDWCineyCam < CTimer::m_FrameCounter - 1 )
    {
      CCam::Process_DW_CamManCam(bool)::timeout = 100;
      gDWLastModeForCineyCam = 57;
      gbExitCam[1] = 0;
      gDWCineyCamStartTime = v8;
      gHandShaker[0].ang.x = 0.0;
      gHandShaker[0].ang.y = 0.0;
      gHandShaker[0].ang.z = 0.0;
      x = gHandShaker[0].motion.x;
      gDWCineyCamEndTime = (int32)off_6AA64C + v8;
      v12 = rand();
      y = gHandShaker[0].motion.y;
      v14 = (float)v12;
      v15 = rand();
      z = gHandShaker[0].motion.z;
      v17 = (float)v15;
      v18 = rand();
      gHandShaker[0].vel.x = (float)(x * (float)(v14 * 4.6566e-10)) + 0.0;
      gHandShaker[0].vel.y = (float)(y * (float)(v17 * 4.6566e-10)) + 0.0;
      gHandShaker[0].vel.z = (float)(z * (float)((float)v18 * 4.6566e-10)) + 0.0;
      Coors.x = (float)(v61.x * 50.0) + dst.x;
      Coors.y = (float)(v61.y * 50.0) + dst.y;
      Coors.z = (float)(v61.z * 50.0) + dst.z;
      CWorld::FindObjectsInRange(&Coors, 50.0, 1, &pNum, 15, (CEntity **)&v55, 0, 0, 0, 1, 1);
      if ( pNum < 1 )
        goto LABEL_31;
      v19 = 10000.0;
      v48 = v8;
      LOWORD(v8) = 0;
      v49 = 0;
      do
      {
        v20 = *((_DWORD *)&v55.m_vecPosition.x + (__int16)v8);
        if ( (*(_DWORD *)(v20 + 28) & 0x40004) != 0 )
        {
          v21 = *(_DWORD *)(v20 + 20);
          if ( !v21 )
          {
            CPlaceable::AllocateMatrix(*((CPlaceable **)&v55.m_vecPosition.x + (__int16)v8));
            CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(v20 + 4), *(CMatrix **)(v20 + 20));
            v21 = *(_DWORD *)(v20 + 20);
          }
          if ( *(float *)(v21 + 40) > 0.9 )
          {
            v22 = (CEntity *)*((_DWORD *)&v55.m_vecPosition.x + (__int16)v8);
            if ( bIsLampPost(v22->m_nModelIndex) )
            {
              m_pMat = v22->m_pMat;
              p_tx = (float32x2_t *)&m_pMat->tx;
              if ( !m_pMat )
                p_tx = (float32x2_t *)&v22->m_transform;
              v25.n64_u64[0] = vsub_f32((float32x2_t)p_tx->n64_u64[0], *(float32x2_t *)&dst.x).n64_u64[0];
              v2.n64_u64[0] = vmul_f32(v25, v25).n64_u64[0];
              v26 = sqrtf(v2.n64_f32[0] + v2.n64_f32[1]);
              if ( v26 < v19 && v26 > 5.0 )
              {
                ColModel = CEntity::GetColModel(v22);
                v28 = *(_QWORD *)&ColModel->m_boxBound.m_vecMax.x;
                v29 = (CPlaceable *)*((_DWORD *)&v55.m_vecPosition.x + (__int16)v8);
                v.z = ColModel->m_boxBound.m_vecMax.z;
                *(_QWORD *)&v.x = v28;
                v30 = v29->m_pMat;
                if ( !v30 )
                {
                  CPlaceable::AllocateMatrix(v29);
                  CSimpleTransform::UpdateMatrix(&v29->m_transform, v29->m_pMat);
                  v30 = v29->m_pMat;
                }
                operator*(&v50, v30, &v);
                v.z = v50.z;
                v31 = (CEntity *)*((_DWORD *)&v55.m_vecPosition.x + (__int16)v8);
                *(_QWORD *)&v.x = *(_QWORD *)&v50.x;
                v32 = CEntity::GetColModel(v31)->m_boxBound.m_vecMax.z;
                v33 = (CEntity *)*((_DWORD *)&v55.m_vecPosition.x + (__int16)v8);
                v.z = v.z - v32;
                v34 = CEntity::GetColModel(v33)->m_boxBound.m_vecMin.z * 0.5;
                v53.y = v.y - dst.y;
                v.z = v.z + v34;
                v53.x = v.x - dst.x;
                v53.z = v.z - dst.z;
                CVector::Normalise(&v53);
                v53.x = dst.x + v53.x;
                v53.y = dst.y + v53.y;
                v53.z = dst.z + v53.z;
                if ( CWorld::GetIsLineOfSightClear(&v, &v53, 1, 0, 0, 0, 0, 1, 1) )
                {
                  v19 = v26;
                  v49 = *((_DWORD *)&v55.m_vecPosition.x + (__int16)v8);
                  vecEnd = v;
                  CCam::Process_DW_CamManCam(bool)::persistantLampPostPos = v;
                }
              }
            }
          }
        }
        v8 = (__int16)(v8 + 1);
      }
      while ( v8 < pNum );
      v8 = v48;
      if ( !v49 )
      {
LABEL_31:
        gbExitCam[1] = 1;
        return 0;
      }
    }
    v35 = (float)(v8 - gDWCineyCamStartTime) / (float)(gDWCineyCamEndTime - gDWCineyCamStartTime);
    if ( gbExitCam[1] )
    {
      v36 = vecEnd.x;
      v37 = vecEnd.y;
      v38 = vecEnd.z;
    }
    else
    {
      vecEnd = CCam::Process_DW_CamManCam(bool)::persistantLampPostPos;
      v55.m_vecPosition.x = dst.x - CCam::Process_DW_CamManCam(bool)::persistantLampPostPos.x;
      v55.m_vecPosition.y = dst.y - CCam::Process_DW_CamManCam(bool)::persistantLampPostPos.y;
      v55.m_vecPosition.z = dst.z - CCam::Process_DW_CamManCam(bool)::persistantLampPostPos.z;
      CVector::Normalise(&v55.m_vecPosition);
      v36 = v55.m_vecPosition.x + vecEnd.x;
      v37 = v55.m_vecPosition.y + vecEnd.y;
      v38 = v55.m_vecPosition.z + vecEnd.z;
      vecEnd.x = v55.m_vecPosition.x + vecEnd.x;
      vecEnd.y = v55.m_vecPosition.y + vecEnd.y;
      vecEnd.z = v55.m_vecPosition.z + vecEnd.z;
    }
    v4.n64_u32[0] = 1.0;
    v39 = sqrtf(
            (float)((float)((float)(dst.x - v36) * (float)(dst.x - v36))
                  + (float)((float)(dst.y - v37) * (float)(dst.y - v37)))
          + (float)((float)(dst.z - v38) * (float)(dst.z - v38)));
    v40 = (float)((float)(270.0 - (float)((float)(v39 / 30.0) * 180.0)) * 3.1416) / 180.0;
    if ( (float)(v39 / 30.0) > 1.0 )
      v40 = 1.5708;
    v41 = (float)((float)((float)(sinf(v40) + 1.0) * -0.5) * 55.0) + 70.0;
    if ( v35 < 0.1 )
    {
      v42 = v35 / 0.1;
      if ( (float)(v35 / 0.1) >= 0.0 )
      {
        v43 = 180.0;
        if ( v42 <= 1.0 )
          v43 = v42 * 180.0;
      }
      else
      {
        v43 = 0.0;
      }
      v41 = (float)((float)(v41 + -70.0)
                  * (float)((float)(sinf((float)((float)(270.0 - v43) * 3.1416) / 180.0) + 1.0) * 0.5))
          + 70.0;
    }
    if ( gbExitCam[1]
      || v39 < gMovieCamMinDist[1]
      || v39 > gMovieCamMaxDist[1]
      || CTimer::m_snTimeInMilliseconds > gDWCineyCamEndTime )
    {
      goto LABEL_47;
    }
    CWorld::pIgnoreEntity = pEntity;
    v44 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &v55, (CEntity **)&v53, 1, 1, 0, 0, 0, 0, 0, 0);
    CWorld::pIgnoreEntity = 0;
    v45 = CCam::Process_DW_CamManCam(bool)::timeout;
    if ( v44 == 1 )
    {
      --CCam::Process_DW_CamManCam(bool)::timeout;
      if ( !v45 )
      {
LABEL_47:
        gbExitCam[1] = 1;
        return 0;
      }
    }
    else
    {
      v46 = CCam::Process_DW_CamManCam(bool)::timeout + 1;
      if ( CCam::Process_DW_CamManCam(bool)::timeout > 100 )
        v46 = 100;
      CCam::Process_DW_CamManCam(bool)::timeout = v46;
    }
    v3.n64_u32[0] = 1045220557;
    v2.n64_f32[0] = sqrtf(
                      (float)((float)(targetMotion.x * targetMotion.x) + (float)(targetMotion.y * targetMotion.y))
                    + (float)(targetMotion.z * targetMotion.z))
                  * 8.0;
    CCam::Finalise_DW_CineyCams(this, &vecEnd, &dst, 0.0, v41, v47, vmin_f32(vmax_f32(v2, v3), v4).n64_f32[0]);
    return 1;
  }
  return result;
}
// 3CEC86: variable 'v47' is possibly undefined
// 3CEC7A: variable 'v2' is possibly undefined
// 3CEC7A: variable 'v3' is possibly undefined
// 3CEC7E: variable 'v4' is possibly undefined
// 0: using guessed type int dword_0;
// 6AA64C: using guessed type void *off_6AA64C;
// 9530BC: using guessed type char `guard variable for'CCam::Process_DW_CamManCam(bool)::persistantLampPostPos;
// 9530C4: using guessed type char `guard variable for'CCam::Process_DW_CamManCam(bool)::timeout;
// 3CE5B0: using guessed type float var_CC;
// 3CE5B0: using guessed type float var_C8;

//----- (003CED54) --------------------------------------------------------
bool __fastcall CCam::Process_DW_BirdyCam(CCam *this, bool bCheckValid)
{
  bool result; // r0
  CEntity *CamTargetEntity; // r1
  int32 v5; // r11
  char v6; // r0
  char v7; // r0
  int v8; // r10
  float x; // s18
  int v10; // r0
  float y; // s20
  float v12; // s22
  int v13; // r0
  float z; // s24
  float v15; // s26
  int v16; // r0
  float v17; // s20
  float v18; // s22
  float v19; // s18
  int v20; // r4
  int v21; // r5
  int v22; // r0
  CEntity *v23; // r5
  __int16 v24; // r6
  int v25; // r4
  int v26; // r5
  int v27; // r0
  int v28; // r5
  int v29; // r8
  int v30; // r5
  int v31; // r0
  CEntity *v32; // r6
  CMatrix *m_pMat; // r0
  CColModel *ColModel; // r0
  __int64 v35; // d16
  const CMatrix *v36; // r1
  float v37; // s26
  float v38; // s28
  int v39; // r10
  int v40; // r6
  int v41; // r0
  CColModel *v42; // r0
  __int64 v43; // d16
  const CMatrix *v44; // r1
  float v45; // s26
  float v46; // s28
  int v47; // r0
  float32x2_t v48; // d8
  float32x2_t v49; // d10
  float v50; // s18
  float v51; // s22
  int32 v52; // r6
  int32 v53; // r5
  float v54; // s24
  float32x2_t v55; // d13
  float v56; // s22
  float32x2_t v57; // d10
  float v58; // s2
  float32x2_t v59; // d16
  unsigned __int64 v60; // d1
  float v61; // s0
  int v62; // r0
  int32 v63; // r1
  CCam *v64; // r0
  int v65; // r2
  float v66; // [sp+4h] [bp-95Ch]
  int v67; // [sp+24h] [bp-93Ch]
  CCam *v68; // [sp+28h] [bp-938h]
  CVector v69; // [sp+30h] [bp-930h] BYREF
  CVector v70; // [sp+40h] [bp-920h] BYREF
  CVector Coors; // [sp+4Ch] [bp-914h] BYREF
  CVector vecStart; // [sp+58h] [bp-908h] BYREF
  CVector v; // [sp+68h] [bp-8F8h] BYREF
  CVector vecEnd; // [sp+78h] [bp-8E8h] BYREF
  Int16 v75; // [sp+84h] [bp-8DCh] BYREF
  Int16 pNum[257]; // [sp+86h] [bp-8DAh] BYREF
  CEntity *refEntityPtr[128]; // [sp+288h] [bp-6D8h] BYREF
  CVector v78; // [sp+488h] [bp-4D8h] BYREF
  CColPoint colPoint; // [sp+688h] [bp-2D8h] BYREF
  CColSphere sph; // [sp+888h] [bp-D8h] BYREF
  float targetAngVel; // [sp+89Ch] [bp-C4h] BYREF
  float targetVel; // [sp+8A0h] [bp-C0h] BYREF
  CVector v83; // [sp+8A4h] [bp-BCh] BYREF
  CVector v84; // [sp+8B0h] [bp-B0h] BYREF
  CVector targetForward; // [sp+8BCh] [bp-A4h] BYREF
  CVector v86; // [sp+8C8h] [bp-98h] BYREF
  CVector v87; // [sp+8D4h] [bp-8Ch] BYREF
  CVector pSrc; // [sp+8E0h] [bp-80h] BYREF
  CVector dst; // [sp+8ECh] [bp-74h] BYREF
  CVehicle *pVehicle; // [sp+8F8h] [bp-68h] BYREF
  CEntity *pEntity; // [sp+8FCh] [bp-64h] BYREF

  result = 0;
  TheCamera.m_bUseNearClipScript = 0;
  CamTargetEntity = this->CamTargetEntity;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
      return 0;
    v68 = this;
    CCam::GetCoreDataForDWCineyCamMode(
      this,
      &pEntity,
      &pVehicle,
      &dst,
      &pSrc,
      &v87,
      &v86,
      &targetForward,
      &v84,
      &targetVel,
      &v83,
      &targetAngVel,
      &sph);
    v5 = CTimer::m_snTimeInMilliseconds;
    v6 = `guard variable for'CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy;
    __dmb(0xBu);
    if ( (v6 & 1) == 0
      && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy) )
    {
      _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy);
    }
    v7 = `guard variable for'CCam::Process_DW_BirdyCam(bool)::timeout;
    __dmb(0xBu);
    if ( (v7 & 1) == 0 && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_BirdyCam(bool)::timeout) )
    {
      CCam::Process_DW_BirdyCam(bool)::timeout = 30;
      _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_BirdyCam(bool)::timeout);
    }
    if ( gDWLastModeForCineyCam != 58 || gLastFrameProcessedDWCineyCam < CTimer::m_FrameCounter - 1 )
    {
      LOWORD(v8) = 0;
      CCam::Process_DW_BirdyCam(bool)::timeout = 30;
      gDWLastModeForCineyCam = 58;
      gbExitCam[2] = 0;
      gDWCineyCamStartTime = v5;
      gHandShaker[0].ang.x = 0.0;
      gHandShaker[0].ang.y = 0.0;
      gHandShaker[0].ang.z = 0.0;
      x = gHandShaker[0].motion.x;
      gDWCineyCamEndTime = (int32)off_6AA650 + v5;
      v10 = rand();
      y = gHandShaker[0].motion.y;
      v12 = (float)v10;
      v13 = rand();
      z = gHandShaker[0].motion.z;
      v15 = (float)v13;
      v16 = rand();
      gHandShaker[0].vel.x = (float)(x * (float)(v12 * 4.6566e-10)) + 0.0;
      gHandShaker[0].vel.y = (float)(y * (float)(v15 * 4.6566e-10)) + 0.0;
      v17 = targetForward.y * 50.0;
      v18 = targetForward.z * 50.0;
      gHandShaker[0].vel.z = (float)(z * (float)((float)v16 * 4.6566e-10)) + 0.0;
      v19 = targetForward.x * 50.0;
      Coors.x = (float)(v19 + v19) + dst.x;
      Coors.y = (float)(v17 + v17) + dst.y;
      Coors.z = (float)(v18 + v18) + dst.z;
      CWorld::FindObjectsInRange(&Coors, 50.0, 1, pNum, 127, (CEntity **)&colPoint, 0, 0, 0, 1, 1);
      v70.x = dst.x - v19;
      v70.y = dst.y - v17;
      v70.z = dst.z - v18;
      CWorld::FindObjectsInRange(&v70, 50.0, 1, &v75, 127, (CEntity **)&v78, 0, 0, 0, 1, 1);
      if ( pNum[0] >= 1 )
      {
        LOWORD(v8) = 0;
        v20 = 0;
        do
        {
          v21 = *((_DWORD *)&colPoint.m_vecPosition.x + v20);
          if ( (*(_DWORD *)(v21 + 28) & 0x40004) != 0 )
          {
            v22 = *(_DWORD *)(v21 + 20);
            if ( !v22 )
            {
              CPlaceable::AllocateMatrix(*((CPlaceable **)&colPoint.m_vecPosition.x + v20));
              CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(v21 + 4), *(CMatrix **)(v21 + 20));
              v22 = *(_DWORD *)(v21 + 20);
            }
            if ( *(float *)(v22 + 40) > 0.9 )
            {
              v23 = (CEntity *)*((_DWORD *)&colPoint.m_vecPosition.x + v20);
              if ( bIsLampPost(v23->m_nModelIndex) )
              {
                refEntityPtr[(__int16)v8] = v23;
                LOWORD(v8) = v8 + 1;
              }
            }
          }
          ++v20;
        }
        while ( v20 < pNum[0] );
      }
      v24 = 0;
      if ( v75 >= 1 )
      {
        v25 = 0;
        do
        {
          v26 = *((_DWORD *)&v78.x + v25);
          if ( (*(_DWORD *)(v26 + 28) & 0x40004) != 0 )
          {
            v27 = *(_DWORD *)(v26 + 20);
            if ( !v27 )
            {
              CPlaceable::AllocateMatrix(*((CPlaceable **)&v78.x + v25));
              CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(v26 + 4), *(CMatrix **)(v26 + 20));
              v27 = *(_DWORD *)(v26 + 20);
            }
            if ( *(float *)(v27 + 40) > 0.9 )
            {
              v28 = *((_DWORD *)&v78.x + v25);
              if ( bIsLampPost(*(__int16 *)(v28 + 38)) )
                *(_DWORD *)&pNum[2 * v24++ + 1] = v28;
            }
          }
          ++v25;
        }
        while ( v25 < v75 );
      }
      v8 = (__int16)v8;
      if ( (__int16)v8 < 1 )
      {
LABEL_60:
        gbExitCam[2] = 1;
        v47 = 0;
      }
      else
      {
        v29 = v24;
        v30 = 0;
        v31 = 0;
        v67 = (__int16)v8;
        while ( !(v31 << 31) )
        {
          v32 = refEntityPtr[v30];
          if ( (*(_DWORD *)&v32->m_nFlags & 0x40004) == 0 )
            goto LABEL_52;
          m_pMat = v32->m_pMat;
          if ( !m_pMat )
          {
            CPlaceable::AllocateMatrix(refEntityPtr[v30]);
            CSimpleTransform::UpdateMatrix(&v32->m_transform, v32->m_pMat);
            m_pMat = v32->m_pMat;
          }
          if ( m_pMat->zz <= 0.9 || !bIsLampPost(v32->m_nModelIndex) )
            goto LABEL_52;
          ColModel = CEntity::GetColModel(v32);
          v35 = *(_QWORD *)&ColModel->m_boxBound.m_vecMax.x;
          v.z = ColModel->m_boxBound.m_vecMax.z;
          *(_QWORD *)&v.x = v35;
          v36 = v32->m_pMat;
          if ( !v36 )
          {
            CPlaceable::AllocateMatrix(v32);
            CSimpleTransform::UpdateMatrix(&v32->m_transform, v32->m_pMat);
            v36 = v32->m_pMat;
          }
          operator*(&v69, v36, &v);
          v = v69;
          v37 = CEntity::GetColModel(v32)->m_boxBound.m_vecMax.z;
          v38 = CEntity::GetColModel(v32)->m_boxBound.m_vecMin.z * -0.5;
          v.z = v.z - (float)((float)((float)((float)(v37 + v38) + -1.0) * (float)((float)rand() * 4.6566e-10)) + 1.0);
          vecEnd.x = v.x - dst.x;
          vecEnd.y = v.y - dst.y;
          vecEnd.z = v.z - dst.z;
          CVector::Normalise(&vecEnd);
          vecEnd.x = dst.x + vecEnd.x;
          vecEnd.y = dst.y + vecEnd.y;
          vecEnd.z = dst.z + vecEnd.z;
          if ( v30 < v29 )
          {
            v39 = v30;
            while ( 1 )
            {
              v40 = *(_DWORD *)&pNum[2 * v39 + 1];
              if ( (*(_DWORD *)(v40 + 28) & 0x40004) != 0 )
              {
                v41 = *(_DWORD *)(v40 + 20);
                if ( !v41 )
                {
                  CPlaceable::AllocateMatrix(*(CPlaceable **)&pNum[2 * v39 + 1]);
                  CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(v40 + 4), *(CMatrix **)(v40 + 20));
                  v41 = *(_DWORD *)(v40 + 20);
                }
                if ( *(float *)(v41 + 40) > 0.9 && bIsLampPost(*(__int16 *)(v40 + 38)) )
                {
                  v42 = CEntity::GetColModel((CEntity *)v40);
                  v43 = *(_QWORD *)&v42->m_boxBound.m_vecMax.x;
                  vecStart.z = v42->m_boxBound.m_vecMax.z;
                  *(_QWORD *)&vecStart.x = v43;
                  v44 = *(const CMatrix **)(v40 + 20);
                  if ( !v44 )
                  {
                    CPlaceable::AllocateMatrix((CPlaceable *)v40);
                    CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(v40 + 4), *(CMatrix **)(v40 + 20));
                    v44 = *(const CMatrix **)(v40 + 20);
                  }
                  operator*(&v69, v44, &vecStart);
                  vecStart = v69;
                  v45 = CEntity::GetColModel((CEntity *)v40)->m_boxBound.m_vecMax.z;
                  v46 = CEntity::GetColModel((CEntity *)v40)->m_boxBound.m_vecMin.z * -0.5;
                  vecStart.z = vecStart.z
                             - (float)((float)((float)((float)(v45 + v46) + -1.0) * (float)((float)rand() * 4.6566e-10))
                                     + 1.0);
                  if ( CWorld::GetIsLineOfSightClear(&v, &vecStart, 1, 0, 0, 0, 0, 1, 1)
                    && CWorld::GetIsLineOfSightClear(&vecStart, &vecEnd, 1, 0, 0, 0, 0, 1, 1) )
                  {
                    break;
                  }
                }
              }
              if ( ++v39 >= v29 )
              {
                v31 = 0;
                goto LABEL_51;
              }
            }
            pSrc = v;
            CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[0] = v;
            v31 = 1;
            CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[1] = vecStart;
LABEL_51:
            v8 = v67;
          }
          else
          {
LABEL_52:
            v31 = 0;
          }
          if ( ++v30 >= v8 )
          {
            if ( !v31 )
              goto LABEL_60;
            break;
          }
        }
        v47 = 1;
      }
      if ( v47 != 1 )
        return 0;
    }
    v48.n64_u64[0] = *(unsigned __int64 *)&CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[0].y;
    v49.n64_u64[0] = *(unsigned __int64 *)&CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[1].y;
    v50 = CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[0].x;
    v51 = CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[1].x;
    v52 = gDWCineyCamEndTime;
    v53 = gDWCineyCamStartTime;
    v78.x = CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[1].x
          - CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[0].x;
    v78.y = CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[1].y
          - CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[0].y;
    v78.z = CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[1].z
          - CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy[0].z;
    CVector::Normalise(&v78);
    if ( !gbExitCam[2] )
    {
      v54 = v78.x;
      v55.n64_u64[0] = *(unsigned __int64 *)&v78.y;
      v56 = v51 - v78.x;
      v57.n64_u64[0] = vsub_f32(v49, *(float32x2_t *)&v78.y).n64_u64[0];
      v58 = (float)(sinf(
                      (float)((float)(270.0 - (float)((float)((float)(v5 - v53) / (float)(v52 - v53)) * 180.0)) * 3.1416)
                    / 180.0)
                  + 1.0)
          * 0.5;
      pSrc.x = v56 + (float)((float)((float)(v50 + (float)(v54 + v54)) - v56) * v58);
      *(float32x2_t *)&pSrc.y = vadd_f32(v57, vmul_n_f32(vsub_f32(vadd_f32(v48, vadd_f32(v55, v55)), v57), v58));
      v59.n64_u64[0] = vsub_f32(*(float32x2_t *)&dst.y, *(float32x2_t *)&pSrc.y).n64_u64[0];
      v60 = vmul_f32(v59, v59).n64_u64[0];
      v61 = sqrtf(
              (float)((float)((float)(dst.x - pSrc.x) * (float)(dst.x - pSrc.x)) + *(float *)&v60)
            + *((float *)&v60 + 1));
      if ( v61 >= gMovieCamMinDist[2]
        && v61 <= gMovieCamMaxDist[2]
        && CTimer::m_snTimeInMilliseconds <= gDWCineyCamEndTime )
      {
        CWorld::pIgnoreEntity = pEntity;
        v62 = CWorld::ProcessLineOfSight(&dst, &pSrc, &colPoint, refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
        CWorld::pIgnoreEntity = 0;
        v63 = CCam::Process_DW_BirdyCam(bool)::timeout;
        if ( v62 == 1 )
        {
          --CCam::Process_DW_BirdyCam(bool)::timeout;
          v64 = v68;
          if ( !v63 )
            goto LABEL_64;
        }
        else
        {
          v65 = CCam::Process_DW_BirdyCam(bool)::timeout + 1;
          if ( CCam::Process_DW_BirdyCam(bool)::timeout > 30 )
            v65 = 30;
          CCam::Process_DW_BirdyCam(bool)::timeout = v65;
          v64 = v68;
        }
        CCam::Finalise_DW_CineyCams(v64, &pSrc, &dst, 0.0, 70.0, v66, 0.0);
        return 1;
      }
    }
LABEL_64:
    gbExitCam[2] = 1;
    return 0;
  }
  return result;
}
// 3CF574: variable 'v66' is possibly undefined
// 0: using guessed type int dword_0;
// 6AA650: using guessed type void *off_6AA650;
// 9530E0: using guessed type char `guard variable for'CCam::Process_DW_BirdyCam(bool)::persistantLampPostPosBirdy;
// 9530E8: using guessed type char `guard variable for'CCam::Process_DW_BirdyCam(bool)::timeout;

//----- (003CF614) --------------------------------------------------------
bool __fastcall CCam::Process_DW_PlaneSpotterCam(CCam *this, bool bCheckValid)
{
  bool result; // r0
  CEntity *CamTargetEntity; // r1
  int32 v5; // r9
  char v6; // r0
  int v7; // r10
  CEntity *v8; // r6
  int v9; // r0
  int v10; // r0
  float v11; // s26
  float v12; // s0
  float v13; // s2
  float v14; // s16
  char v15; // r0
  float v16; // s0
  float v17; // s2
  int v18; // r4
  char v19; // r0
  int32 v20; // r0
  int v21; // r2
  float v22; // s0
  float v23; // [sp+4h] [bp-134h]
  CCam *v24; // [sp+24h] [bp-114h]
  CEntity *refEntityPtr; // [sp+2Ch] [bp-10Ch] BYREF
  CColPoint colPoint; // [sp+30h] [bp-108h] BYREF
  CColSphere sph; // [sp+60h] [bp-D8h] BYREF
  float targetAngVel; // [sp+74h] [bp-C4h] BYREF
  float targetVel; // [sp+78h] [bp-C0h] BYREF
  CVector v30; // [sp+7Ch] [bp-BCh] BYREF
  CVector v31; // [sp+88h] [bp-B0h] BYREF
  CVector targetForward; // [sp+94h] [bp-A4h] BYREF
  CVector v33; // [sp+A0h] [bp-98h] BYREF
  CVector v34; // [sp+ACh] [bp-8Ch] BYREF
  CVector vecEnd; // [sp+B8h] [bp-80h] BYREF
  CVector dst; // [sp+C8h] [bp-70h] BYREF
  CVehicle *pVehicle; // [sp+D8h] [bp-60h] BYREF
  CEntity *pEntity; // [sp+DCh] [bp-5Ch] BYREF

  result = 0;
  TheCamera.m_bUseNearClipScript = 0;
  CamTargetEntity = this->CamTargetEntity;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
      return 0;
    v24 = this;
    CCam::GetCoreDataForDWCineyCamMode(
      this,
      &pEntity,
      &pVehicle,
      &dst,
      &vecEnd,
      &v34,
      &v33,
      &targetForward,
      &v31,
      &targetVel,
      &v30,
      &targetAngVel,
      &sph);
    v5 = CTimer::m_snTimeInMilliseconds;
    v6 = `guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation;
    __dmb(0xBu);
    if ( (v6 & 1) == 0
      && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation) )
    {
      _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation);
    }
    if ( gDWLastModeForCineyCam != 59 || gLastFrameProcessedDWCineyCam < CTimer::m_FrameCounter - 1 )
    {
      v7 = -1;
      gDWLastModeForCineyCam = 59;
      gDWCineyCamEndTime = (int32)off_6AA654 + v5;
      v8 = pEntity;
      gDWCineyCamStartTime = v5;
      gbExitCam[3] = 0;
      while ( 1 )
      {
        *(_QWORD *)&vecEnd.x = *(_QWORD *)&dst.x;
        vecEnd.z = dst.z + -100.0;
        vecEnd.x = vecEnd.x + (float)((float)((float)((float)rand() * 4.6566e-10) * 50.0) + 50.0);
        v9 = rand();
        CWorld::pIgnoreEntity = v8;
        vecEnd.y = vecEnd.y + (float)((float)((float)((float)v9 * 4.6566e-10) * 50.0) + 50.0);
        v10 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, &refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
        CWorld::pIgnoreEntity = 0;
        if ( v10 )
          break;
        if ( ++v7 >= 7 )
          goto LABEL_41;
      }
      *(_QWORD *)&CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.x = *(_QWORD *)&colPoint.m_vecPosition.x;
      CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.z = colPoint.m_vecPosition.z + 2.0;
      CCam::Process_DW_PlaneSpotterCam(bool)::gbFOVZoomPlaneSpotter = rand() & 1;
    }
    vecEnd = CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation;
    if ( sqrtf(
           (float)((float)(CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.x - dst.x)
                 * (float)(CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.x - dst.x))
         + (float)((float)(CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.y - dst.y)
                 * (float)(CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.y - dst.y))) >= 5.0 )
    {
      if ( CCam::Process_DW_PlaneSpotterCam(bool)::gbFOVZoomPlaneSpotter )
      {
        v11 = (float)(v5 - gDWCineyCamStartTime) / (float)(gDWCineyCamEndTime - gDWCineyCamStartTime);
        v12 = sqrtf(
                (float)((float)((float)(dst.x - CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.x)
                              * (float)(dst.x - CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.x))
                      + (float)((float)(dst.y - CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.y)
                              * (float)(dst.y - CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation.y)))
              + (float)((float)(dst.z - vecEnd.z) * (float)(dst.z - vecEnd.z)))
            / 100.0;
        v13 = (float)((float)(270.0 - (float)(v12 * 180.0)) * 3.1416) / 180.0;
        if ( v12 > 1.0 )
          v13 = 1.5708;
        v14 = (float)((float)((float)(sinf(v13) + 1.0) * -0.5) * 58.0) + 70.0;
        if ( v11 < 0.1 )
        {
          v15 = `guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::startFOV;
          __dmb(0xBu);
          if ( (v15 & 1) == 0
            && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::startFOV) )
          {
            CCam::Process_DW_PlaneSpotterCam(bool)::startFOV = 70.0;
            _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::startFOV);
          }
          v16 = v11 / 0.1;
          if ( (float)(v11 / 0.1) >= 0.0 )
          {
            v17 = 180.0;
            if ( v16 <= 1.0 )
              v17 = v16 * 180.0;
          }
          else
          {
            v17 = 0.0;
          }
          v14 = CCam::Process_DW_PlaneSpotterCam(bool)::startFOV
              + (float)((float)(v14 - CCam::Process_DW_PlaneSpotterCam(bool)::startFOV)
                      * (float)((float)(sinf((float)((float)(270.0 - v17) * 3.1416) / 180.0) + 1.0) * 0.5));
        }
      }
      else
      {
        v14 = 70.0;
      }
      CWorld::pIgnoreEntity = pEntity;
      v18 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, &refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
      CWorld::pIgnoreEntity = 0;
      v19 = `guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter;
      __dmb(0xBu);
      if ( (v19 & 1) == 0
        && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter) )
      {
        CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter = 100;
        _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter);
      }
      v20 = CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter;
      if ( v18 == 1 )
      {
        --CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter;
        if ( !v20 )
          goto LABEL_41;
      }
      else
      {
        v21 = CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter + 1;
        if ( CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter > 100 )
          v21 = 100;
        CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter = v21;
      }
      if ( !gbExitCam[3] )
      {
        v22 = sqrtf(
                (float)((float)((float)(dst.x - vecEnd.x) * (float)(dst.x - vecEnd.x))
                      + (float)((float)(dst.y - vecEnd.y) * (float)(dst.y - vecEnd.y)))
              + (float)((float)(dst.z - vecEnd.z) * (float)(dst.z - vecEnd.z)));
        if ( v22 >= gMovieCamMinDist[3]
          && v22 <= gMovieCamMaxDist[3]
          && CTimer::m_snTimeInMilliseconds <= gDWCineyCamEndTime )
        {
          CCam::Finalise_DW_CineyCams(v24, &vecEnd, &dst, 0.0, v14, v23, 1.0);
          return 1;
        }
      }
    }
LABEL_41:
    gbExitCam[3] = 1;
    return 0;
  }
  return result;
}
// 3CFAE8: variable 'v23' is possibly undefined
// 0: using guessed type int dword_0;
// 6AA654: using guessed type void *off_6AA654;
// 9530FC: using guessed type char `guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::planeSpotterLocation;
// 953108: using guessed type char `guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::startFOV;
// 953110: using guessed type char `guard variable for'CCam::Process_DW_PlaneSpotterCam(bool)::timeoutPlaneSpotter;

//----- (003CFBD8) --------------------------------------------------------
bool __fastcall CCam::Process_DW_DogFightCam(CCam *this, bool bCheckValid)
{
  TheCamera.m_bUseNearClipScript = 0;
  return 0;
}

//----- (003CFBEC) --------------------------------------------------------
bool __fastcall CCam::Process_DW_FishCam(CCam *this, bool bCheckValid)
{
  TheCamera.m_bUseNearClipScript = 0;
  return 0;
}

//----- (003CFC00) --------------------------------------------------------
bool __fastcall CCam::Process_DW_PlaneCam1(CCam *this, bool bCheckValid)
{
  bool result; // r0
  CEntity *CamTargetEntity; // r1
  int v5; // r11
  int v6; // r0
  int32 v7; // r10
  int32 v8; // r5
  float y; // s22
  float z; // s24
  float x; // s26
  RwReal v12; // s20
  float v13; // s28
  RwReal v14; // s16
  RwReal v15; // s18
  float v16; // s2
  float v17; // s30
  float v18; // s17
  float v19; // s19
  float v20; // r0
  int v21; // r5
  char v22; // r0
  int32 v23; // r0
  int v24; // r2
  float32x2_t v25; // d16
  unsigned __int64 v26; // d1
  float v27; // s0
  float v28; // [sp+4h] [bp-14Ch]
  CEntity *v29; // [sp+24h] [bp-12Ch] BYREF
  CVector v30; // [sp+28h] [bp-128h] BYREF
  CVector refEntityPtr; // [sp+38h] [bp-118h] BYREF
  CColPoint colPoint; // [sp+48h] [bp-108h] BYREF
  CColSphere sph; // [sp+74h] [bp-DCh] BYREF
  float v34; // [sp+88h] [bp-C8h] BYREF
  float v35; // [sp+8Ch] [bp-C4h] BYREF
  CVector targetAngMotion; // [sp+90h] [bp-C0h] BYREF
  CVector targetMotion; // [sp+9Ch] [bp-B4h] BYREF
  CVector v38; // [sp+A8h] [bp-A8h] BYREF
  CVector targetRight; // [sp+B8h] [bp-98h] BYREF
  CVector v40; // [sp+C4h] [bp-8Ch] BYREF
  CVector vecEnd; // [sp+D0h] [bp-80h] BYREF
  CVector dst; // [sp+DCh] [bp-74h] BYREF
  CVehicle *pVehicle; // [sp+E8h] [bp-68h] BYREF
  CEntity *pEntity; // [sp+ECh] [bp-64h] BYREF

  result = 0;
  TheCamera.m_bUseNearClipScript = 0;
  CamTargetEntity = this->CamTargetEntity;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
      return 0;
    CCam::GetCoreDataForDWCineyCamMode(
      this,
      &pEntity,
      &pVehicle,
      &dst,
      &vecEnd,
      &v40,
      &targetRight,
      &v38,
      &targetMotion,
      &v35,
      &targetAngMotion,
      &v34,
      &sph);
    if ( dst.z >= 80.0 )
    {
      v5 = CTimer::m_snTimeInMilliseconds;
      if ( gDWLastModeForCineyCam != 62 || gLastFrameProcessedDWCineyCam < CTimer::m_FrameCounter - 1 )
      {
        gDWLastModeForCineyCam = 62;
        gbExitCam[6] = 0;
        gDWCineyCamEndTime = (int32)off_6AA660 + CTimer::m_snTimeInMilliseconds;
        gDWCineyCamStartTime = CTimer::m_snTimeInMilliseconds;
        CWorld::pIgnoreEntity = pEntity;
        v6 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, (CEntity **)&refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
        CWorld::pIgnoreEntity = 0;
        if ( v6 == 1 )
        {
          gbExitCam[6] = 1;
          return 0;
        }
        CCam::Process_DW_PlaneCam1(bool)::dirMove = 1.0;
        if ( (rand() & 1) != 0 )
          CCam::Process_DW_PlaneCam1(bool)::dirMove = -CCam::Process_DW_PlaneCam1(bool)::dirMove;
        if ( (rand() & 1) != 0 )
          CCam::Process_DW_PlaneCam1(bool)::randSign = -1.0;
LABEL_13:
        refEntityPtr = v38;
        v30 = targetRight;
        v7 = gDWCineyCamEndTime;
        v8 = gDWCineyCamStartTime;
        CVector::Normalise(&refEntityPtr);
        CVector::Normalise(&v30);
        y = v40.y;
        z = v40.z;
        x = v40.x;
        v13 = CCam::Process_DW_PlaneCam1(bool)::dirMove;
        v30.x = CCam::Process_DW_PlaneCam1(bool)::randSign * v30.x;
        v14 = v30.x;
        v16 = (float)((float)(v5 - v8) / (float)(v7 - v8)) + -0.5;
        v30.y = CCam::Process_DW_PlaneCam1(bool)::randSign * v30.y;
        v15 = v30.y;
        v30.z = CCam::Process_DW_PlaneCam1(bool)::randSign * v30.z;
        v12 = v30.z;
        v17 = v16 * (float)(v40.z * -150.0);
        v18 = v16 * (float)(v40.x * -150.0);
        v19 = (float)(v16 * (float)(v40.y * -150.0)) * CCam::Process_DW_PlaneCam1(bool)::dirMove;
        v20 = sinf(
                (float)((float)((float)((float)((float)((float)v5 - (float)gDWCineyCamStartTime)
                                              / (float)((float)gDWCineyCamEndTime - (float)gDWCineyCamStartTime))
                                      * 4.0)
                              * 360.0)
                      * 3.1416)
              / 180.0);
        CWorld::pIgnoreEntity = pEntity;
        vecEnd.y = (float)(v20 * (float)(y * 0.5))
                 + (float)(v19
                         + (float)((float)(y * 15.0)
                                 + (float)((float)(v15 * 30.0) + (float)((float)(refEntityPtr.y * 10.0) + dst.y))));
        vecEnd.x = (float)(v20 * (float)(x * 0.5))
                 + (float)((float)(v18 * v13)
                         + (float)((float)(x * 15.0)
                                 + (float)((float)(v14 * 30.0) + (float)((float)(refEntityPtr.x * 10.0) + dst.x))));
        vecEnd.z = (float)(v20 * (float)(z * 0.5))
                 + (float)((float)(v13 * v17)
                         + (float)((float)(z * 15.0)
                                 + (float)((float)(v12 * 30.0) + (float)((float)(refEntityPtr.z * 10.0) + dst.z))));
        v21 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, &v29, 1, 1, 0, 0, 0, 0, 0, 0);
        CWorld::pIgnoreEntity = 0;
        v22 = `guard variable for'CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1;
        __dmb(0xBu);
        if ( (v22 & 1) == 0
          && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1) )
        {
          CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1 = 100;
          _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1);
        }
        v23 = CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1;
        if ( v21 == 1 )
        {
          --CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1;
          if ( !v23 )
            goto LABEL_27;
        }
        else
        {
          v24 = CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1 + 1;
          if ( CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1 > 100 )
            v24 = 100;
          CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1 = v24;
        }
        if ( !gbExitCam[6] )
        {
          v25.n64_u64[0] = vsub_f32(*(float32x2_t *)&dst.y, *(float32x2_t *)&vecEnd.y).n64_u64[0];
          v26 = vmul_f32(v25, v25).n64_u64[0];
          v27 = sqrtf(
                  (float)((float)((float)(dst.x - vecEnd.x) * (float)(dst.x - vecEnd.x)) + *(float *)&v26)
                + *((float *)&v26 + 1));
          if ( v27 >= gMovieCamMinDist[6]
            && v27 <= gMovieCamMaxDist[6]
            && CTimer::m_snTimeInMilliseconds <= gDWCineyCamEndTime )
          {
            CCam::Finalise_DW_CineyCams(this, &vecEnd, &dst, 0.0, 70.0, v28, 1.0);
            return 1;
          }
        }
        goto LABEL_27;
      }
      if ( (float)(TheCamera.Cams[TheCamera.ActiveCam].Source.z - CCamera::CalculateGroundHeight(&TheCamera, 0)) >= 30.0 )
        goto LABEL_13;
    }
LABEL_27:
    gbExitCam[6] = 1;
    return 0;
  }
  return result;
}
// 3D0088: variable 'v28' is possibly undefined
// 54: using guessed type int dword_54;
// 6AA660: using guessed type void *off_6AA660;
// 95311C: using guessed type char `guard variable for'CCam::Process_DW_PlaneCam1(bool)::timeoutPlaneCam1;
// 3CFC00: using guessed type float var_C8;
// 3CFC00: using guessed type float var_C4;

//----- (003D0150) --------------------------------------------------------
bool __fastcall CCam::Process_DW_PlaneCam2(CCam *this, bool bCheckValid)
{
  bool result; // r0
  CEntity *CamTargetEntity; // r1
  int v5; // r10
  int v6; // r0
  int32 v7; // r11
  int32 v8; // r6
  float v9; // s2
  float v10; // s4
  float v11; // s2
  float v12; // s4
  RwReal y; // s20
  RwReal x; // s18
  RwReal v15; // s22
  RwReal v16; // s26
  RwReal v17; // s28
  float v18; // s0
  float v19; // s17
  float v20; // r0
  int v21; // r5
  char v22; // r0
  int32 v23; // r0
  int v24; // r2
  float32x2_t v25; // d16
  unsigned __int64 v26; // d1
  float v27; // s0
  float v28; // [sp+4h] [bp-14Ch]
  CEntity *v29; // [sp+24h] [bp-12Ch] BYREF
  CVector v30; // [sp+28h] [bp-128h] BYREF
  CVector refEntityPtr; // [sp+38h] [bp-118h] BYREF
  CColPoint colPoint; // [sp+48h] [bp-108h] BYREF
  CColSphere sph; // [sp+74h] [bp-DCh] BYREF
  float v34; // [sp+88h] [bp-C8h] BYREF
  float v35; // [sp+8Ch] [bp-C4h] BYREF
  CVector targetAngMotion; // [sp+90h] [bp-C0h] BYREF
  CVector targetMotion; // [sp+9Ch] [bp-B4h] BYREF
  CVector v38; // [sp+A8h] [bp-A8h] BYREF
  CVector v39; // [sp+B8h] [bp-98h] BYREF
  CVector v40; // [sp+C4h] [bp-8Ch] BYREF
  CVector vecEnd; // [sp+D0h] [bp-80h] BYREF
  CVector dst; // [sp+DCh] [bp-74h] BYREF
  CVehicle *pVehicle; // [sp+E8h] [bp-68h] BYREF
  CEntity *pEntity; // [sp+ECh] [bp-64h] BYREF

  result = 0;
  TheCamera.m_bUseNearClipScript = 0;
  CamTargetEntity = this->CamTargetEntity;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
      return 0;
    CCam::GetCoreDataForDWCineyCamMode(
      this,
      &pEntity,
      &pVehicle,
      &dst,
      &vecEnd,
      &v40,
      &v39,
      &v38,
      &targetMotion,
      &v35,
      &targetAngMotion,
      &v34,
      &sph);
    if ( dst.z >= 80.0 )
    {
      v5 = CTimer::m_snTimeInMilliseconds;
      if ( gDWLastModeForCineyCam != 63 || gLastFrameProcessedDWCineyCam < CTimer::m_FrameCounter - 1 )
      {
        gDWLastModeForCineyCam = 63;
        gbExitCam[7] = 0;
        gDWCineyCamEndTime = (int32)off_6AA664 + CTimer::m_snTimeInMilliseconds;
        gDWCineyCamStartTime = CTimer::m_snTimeInMilliseconds;
        CWorld::pIgnoreEntity = pEntity;
        v6 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, (CEntity **)&refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
        CWorld::pIgnoreEntity = 0;
        if ( v6 == 1 )
        {
          gbExitCam[7] = 1;
          return 0;
        }
        CCam::Process_DW_PlaneCam2(bool)::dirMove2 = 1.0;
        if ( (rand() & 1) != 0 )
          CCam::Process_DW_PlaneCam2(bool)::dirMove2 = -CCam::Process_DW_PlaneCam2(bool)::dirMove2;
        CCam::Process_DW_PlaneCam2(bool)::dirMove3 = 1.0;
        if ( (rand() & 1) != 0 )
          CCam::Process_DW_PlaneCam2(bool)::dirMove3 = -CCam::Process_DW_PlaneCam2(bool)::dirMove3;
        if ( (rand() & 1) != 0 )
          CCam::Process_DW_PlaneCam2(bool)::randSign2 = -1.0;
      }
      refEntityPtr = v38;
      v30 = v39;
      v7 = gDWCineyCamEndTime;
      v8 = gDWCineyCamStartTime;
      CVector::Normalise(&refEntityPtr);
      CVector::Normalise(&v30);
      v9 = (float)(v5 - v8) / (float)(v7 - v8);
      v10 = v9 * -2.0;
      v11 = 1.0 - v9;
      v12 = v10 + 1.0;
      v15 = CCam::Process_DW_PlaneCam2(bool)::dirMove3 * (float)(v12 * refEntityPtr.z);
      v16 = CCam::Process_DW_PlaneCam2(bool)::randSign2 * (float)(v11 * v30.x);
      v17 = CCam::Process_DW_PlaneCam2(bool)::randSign2 * (float)(v11 * v30.z);
      v30.y = CCam::Process_DW_PlaneCam2(bool)::randSign2 * (float)(v11 * v30.y);
      y = v30.y;
      v18 = (float)(CCam::Process_DW_PlaneCam2(bool)::dirMove3 * (float)(v12 * refEntityPtr.y)) * 30.0;
      refEntityPtr.y = CCam::Process_DW_PlaneCam2(bool)::dirMove3 * (float)(v12 * refEntityPtr.y);
      refEntityPtr.x = CCam::Process_DW_PlaneCam2(bool)::dirMove3 * (float)(v12 * refEntityPtr.x);
      x = refEntityPtr.x;
      v19 = v18 + dst.y;
      v20 = sinf(
              (float)((float)((float)((float)((float)((float)v5 - (float)gDWCineyCamStartTime)
                                            / (float)((float)gDWCineyCamEndTime - (float)gDWCineyCamStartTime))
                                    * 4.0)
                            * 360.0)
                    * 3.1416)
            / 180.0);
      v30.z = v17;
      refEntityPtr.z = v15;
      v30.x = v16;
      CWorld::pIgnoreEntity = pEntity;
      vecEnd.z = (float)(v20 * (float)(v40.z * 0.5))
               + (float)((float)(v40.z * 5.0) + (float)((float)(v17 * 30.0) + (float)((float)(v15 * 30.0) + dst.z)));
      vecEnd.y = (float)(v20 * (float)(v40.y * 0.5)) + (float)((float)(v40.y * 5.0) + (float)((float)(y * 30.0) + v19));
      vecEnd.x = (float)(v20 * (float)(v40.x * 0.5))
               + (float)((float)(v40.x * 5.0) + (float)((float)(v16 * 30.0) + (float)((float)(x * 30.0) + dst.x)));
      v21 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, &v29, 1, 1, 0, 0, 0, 0, 0, 0);
      CWorld::pIgnoreEntity = 0;
      v22 = `guard variable for'CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2;
      __dmb(0xBu);
      if ( (v22 & 1) == 0
        && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2) )
      {
        CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2 = 100;
        _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2);
      }
      v23 = CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2;
      if ( v21 == 1 )
      {
        --CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2;
        if ( !v23 )
          goto LABEL_28;
      }
      else
      {
        v24 = CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2 + 1;
        if ( CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2 > 100 )
          v24 = 100;
        CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2 = v24;
      }
      if ( !gbExitCam[7] )
      {
        v25.n64_u64[0] = vsub_f32(*(float32x2_t *)&dst.y, *(float32x2_t *)&vecEnd.y).n64_u64[0];
        v26 = vmul_f32(v25, v25).n64_u64[0];
        v27 = sqrtf(
                (float)((float)((float)(dst.x - vecEnd.x) * (float)(dst.x - vecEnd.x)) + *(float *)&v26)
              + *((float *)&v26 + 1));
        if ( v27 >= gMovieCamMinDist[7]
          && v27 <= gMovieCamMaxDist[7]
          && CTimer::m_snTimeInMilliseconds <= gDWCineyCamEndTime )
        {
          CCam::Finalise_DW_CineyCams(this, &vecEnd, &dst, 0.0, 70.0, v28, 1.0);
          return 1;
        }
      }
    }
LABEL_28:
    gbExitCam[7] = 1;
    return 0;
  }
  return result;
}
// 3D05BC: variable 'v28' is possibly undefined
// 6AA664: using guessed type void *off_6AA664;
// 95312C: using guessed type char `guard variable for'CCam::Process_DW_PlaneCam2(bool)::timeoutPlaneCam2;
// 3D0150: using guessed type float var_C8;
// 3D0150: using guessed type float var_C4;

//----- (003D0680) --------------------------------------------------------
bool __fastcall CCam::Process_DW_PlaneCam3(CCam *this, bool bCheckValid)
{
  bool result; // r0
  CEntity *CamTargetEntity; // r1
  float z; // s0
  CEntity *v6; // r10
  int v7; // r0
  CColModel *m_pColModel; // r0
  float v9; // s2
  int v10; // r10
  char v11; // r0
  int32 v12; // r0
  int v13; // r2
  float32x2_t v14; // d16
  unsigned __int64 v15; // d1
  float v16; // s0
  float v17; // [sp+4h] [bp-E4h]
  CEntity *refEntityPtr; // [sp+24h] [bp-C4h] BYREF
  CColPoint colPoint; // [sp+28h] [bp-C0h] BYREF
  CColSphere sph; // [sp+54h] [bp-94h] BYREF
  float v21; // [sp+68h] [bp-80h] BYREF
  float v22; // [sp+6Ch] [bp-7Ch] BYREF
  CVector targetAngMotion; // [sp+70h] [bp-78h] BYREF
  CVector targetMotion; // [sp+7Ch] [bp-6Ch] BYREF
  CVector v25; // [sp+88h] [bp-60h] BYREF
  CVector targetRight; // [sp+94h] [bp-54h] BYREF
  CVector v27; // [sp+A0h] [bp-48h] BYREF
  CVector vecEnd; // [sp+ACh] [bp-3Ch] BYREF
  CVector dst; // [sp+B8h] [bp-30h] BYREF
  CVehicle *pVehicle; // [sp+C4h] [bp-24h] BYREF
  CEntity *v31; // [sp+C8h] [bp-20h] BYREF

  result = 0;
  TheCamera.m_bUseNearClipScript = 0;
  CamTargetEntity = this->CamTargetEntity;
  if ( CamTargetEntity )
  {
    if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
      return 0;
    CCam::GetCoreDataForDWCineyCamMode(
      this,
      &v31,
      &pVehicle,
      &dst,
      &vecEnd,
      &v27,
      &targetRight,
      &v25,
      &targetMotion,
      &v22,
      &targetAngMotion,
      &v21,
      &sph);
    z = dst.z;
    if ( dst.z >= 80.0 )
    {
      if ( gDWLastModeForCineyCam == 64 && gLastFrameProcessedDWCineyCam >= CTimer::m_FrameCounter - 1 )
      {
        v6 = v31;
      }
      else
      {
        gDWLastModeForCineyCam = 64;
        gDWCineyCamStartTime = CTimer::m_snTimeInMilliseconds;
        gDWCineyCamEndTime = (int32)off_6AA668 + CTimer::m_snTimeInMilliseconds;
        v6 = v31;
        gbExitCam[8] = 0;
        CWorld::pIgnoreEntity = v31;
        v7 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, &refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
        CWorld::pIgnoreEntity = 0;
        if ( v7 == 1 )
        {
          gbExitCam[8] = 1;
          return 0;
        }
        z = dst.z;
      }
      m_pColModel = CModelInfo::ms_modelInfoPtrs[v6->m_nModelIndex]->m_pColModel;
      v9 = m_pColModel->m_boxBound.m_vecMax.y - m_pColModel->m_boxBound.m_vecMin.y;
      CWorld::pIgnoreEntity = v6;
      CCam::Process_DW_PlaneCam3(bool)::fwd1 = (float)(v9 * 0.5) + (float)(v9 * 0.5);
      vecEnd.z = (float)(v27.z * 5.0) + (float)((float)(CCam::Process_DW_PlaneCam3(bool)::fwd1 * v25.z) + z);
      vecEnd.y = (float)(v27.y * 5.0) + (float)((float)(v25.y * CCam::Process_DW_PlaneCam3(bool)::fwd1) + dst.y);
      vecEnd.x = (float)(v27.x * 5.0) + (float)((float)(v25.x * CCam::Process_DW_PlaneCam3(bool)::fwd1) + dst.x);
      v10 = CWorld::ProcessLineOfSight(&dst, &vecEnd, &colPoint, &refEntityPtr, 1, 1, 0, 0, 0, 0, 0, 0);
      CWorld::pIgnoreEntity = 0;
      v11 = `guard variable for'CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3;
      __dmb(0xBu);
      if ( (v11 & 1) == 0
        && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3) )
      {
        CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3 = 100;
        _cxa_guard_release((__guard *)&`guard variable for'CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3);
      }
      v12 = CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3;
      if ( v10 == 1 )
      {
        --CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3;
        if ( !v12 )
          goto LABEL_24;
      }
      else
      {
        v13 = CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3 + 1;
        if ( CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3 > 100 )
          v13 = 100;
        CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3 = v13;
      }
      if ( !gbExitCam[8] )
      {
        v14.n64_u64[0] = vsub_f32(*(float32x2_t *)&dst.y, *(float32x2_t *)&vecEnd.y).n64_u64[0];
        v15 = vmul_f32(v14, v14).n64_u64[0];
        v16 = sqrtf(
                (float)((float)((float)(dst.x - vecEnd.x) * (float)(dst.x - vecEnd.x)) + *(float *)&v15)
              + *((float *)&v15 + 1));
        if ( v16 >= gMovieCamMinDist[8]
          && v16 <= gMovieCamMaxDist[8]
          && CTimer::m_snTimeInMilliseconds <= gDWCineyCamEndTime )
        {
          CCam::Finalise_DW_CineyCams(this, &vecEnd, &dst, 0.0, 70.0, v17, 1.0);
          return 1;
        }
      }
    }
LABEL_24:
    gbExitCam[8] = 1;
    return 0;
  }
  return result;
}
// 3D0952: variable 'v17' is possibly undefined
// 6AA668: using guessed type void *off_6AA668;
// 953134: using guessed type char `guard variable for'CCam::Process_DW_PlaneCam3(bool)::timeoutPlaneCam3;
// 3D0680: using guessed type float var_80;
// 3D0680: using guessed type float var_7C;

//----- (003D09EC) --------------------------------------------------------
void __fastcall CCam::KeepTrackOfTheSpeed(
        CCam *this,
        const CVector *TheSource,
        const CVector *TheTargetToLookAt,
        const CVector *TheUpVector,
        float *a5,
        float *a6,
        float *a7)
{
  char v11; // r0
  __int64 v12; // d16
  char v13; // r0
  __int64 v14; // d16
  char v15; // r0
  __int64 v16; // d16
  char v17; // r0
  char v18; // r0
  char v19; // r0
  __int64 v20; // d16
  __int64 v21; // d16
  __int64 v22; // d16
  RwReal v23; // s0
  RwReal v24; // s2
  RwReal v25; // s0
  RwReal v26; // s2
  RwReal v27; // s0
  RwReal v28; // s2
  float v29; // s4
  float v30; // s4
  __int64 v31; // d16
  __int64 v32; // d16
  __int64 v33; // d16

  v11 = `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource;
  __dmb(0xBu);
  if ( (v11 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource) )
  {
    v12 = *(_QWORD *)&TheSource->x;
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.z = TheSource->z;
    *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.x = v12;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource);
  }
  v13 = `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget;
  __dmb(0xBu);
  if ( (v13 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget) )
  {
    v14 = *(_QWORD *)&TheTargetToLookAt->x;
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.z = TheTargetToLookAt->z;
    *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.x = v14;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget);
  }
  v15 = `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp;
  __dmb(0xBu);
  if ( (v15 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp) )
  {
    v16 = *(_QWORD *)&TheUpVector->x;
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.z = TheUpVector->z;
    *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.x = v16;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp);
  }
  v17 = `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousBeta;
  __dmb(0xBu);
  if ( (v17 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousBeta) )
  {
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousBeta = *a6;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousBeta);
  }
  v18 = `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousAlpha;
  __dmb(0xBu);
  if ( (v18 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousAlpha) )
  {
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousAlpha = *a5;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousAlpha);
  }
  v19 = `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousFov;
  __dmb(0xBu);
  if ( (v19 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousFov) )
  {
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousFov = *a7;
    _cxa_guard_release((__guard *)&`guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousFov);
  }
  if ( TheCamera.m_bJust_Switched )
  {
    v20 = *(_QWORD *)&TheSource->x;
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.z = TheSource->z;
    *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.x = v20;
    v21 = *(_QWORD *)&TheTargetToLookAt->x;
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.z = TheTargetToLookAt->z;
    *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.x = v21;
    v22 = *(_QWORD *)&TheUpVector->x;
    CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.z = TheUpVector->z;
    *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.x = v22;
  }
  v23 = TheSource->x
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.x;
  v24 = TheSource->y
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.y;
  this->m_cvecSourceSpeedOverOneFrame.z = TheSource->z
                                        - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.z;
  this->m_cvecSourceSpeedOverOneFrame.y = v24;
  this->m_cvecSourceSpeedOverOneFrame.x = v23;
  v25 = TheTargetToLookAt->x
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.x;
  v26 = TheTargetToLookAt->y
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.y;
  this->m_cvecTargetSpeedOverOneFrame.z = TheTargetToLookAt->z
                                        - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.z;
  this->m_cvecTargetSpeedOverOneFrame.y = v26;
  this->m_cvecTargetSpeedOverOneFrame.x = v25;
  v27 = TheUpVector->x
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.x;
  v28 = TheUpVector->y
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.y;
  this->m_cvecUpOverOneFrame.z = TheUpVector->z
                               - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.z;
  this->m_cvecUpOverOneFrame.y = v28;
  this->m_cvecUpOverOneFrame.x = v27;
  this->m_fFovSpeedOverOneFrame = *a7
                                - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousFov;
  v29 = *a6
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousBeta;
  this->m_fBetaSpeedOverOneFrame = v29;
  if ( v29 >= 3.1416 )
  {
    do
      v29 = v29 + -6.2832;
    while ( v29 >= 3.1416 );
    this->m_fBetaSpeedOverOneFrame = v29;
  }
  if ( v29 < -3.1416 )
  {
    do
      v29 = v29 + 6.2832;
    while ( v29 < -3.1416 );
    this->m_fBetaSpeedOverOneFrame = v29;
  }
  v30 = *a5
      - CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousAlpha;
  this->m_fAlphaSpeedOverOneFrame = v30;
  if ( v30 >= 3.1416 )
  {
    do
      v30 = v30 + -6.2832;
    while ( v30 >= 3.1416 );
    this->m_fAlphaSpeedOverOneFrame = v30;
  }
  if ( v30 < -3.1416 )
  {
    do
      v30 = v30 + 6.2832;
    while ( v30 < -3.1416 );
    this->m_fAlphaSpeedOverOneFrame = v30;
  }
  v31 = *(_QWORD *)&TheSource->x;
  CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.z = TheSource->z;
  *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource.x = v31;
  v32 = *(_QWORD *)&TheTargetToLookAt->x;
  CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.z = TheTargetToLookAt->z;
  *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget.x = v32;
  v33 = *(_QWORD *)&TheUpVector->x;
  CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.z = TheUpVector->z;
  *(_QWORD *)&CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp.x = v33;
  CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousBeta = *a6;
  CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousAlpha = *a5;
  CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousFov = *a7;
}
// 952D84: using guessed type char `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousSource;
// 952D94: using guessed type char `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousTarget;
// 952DA4: using guessed type char `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousUp;
// 952DAC: using guessed type char `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousBeta;
// 952DB4: using guessed type char `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousAlpha;
// 952DBC: using guessed type char `guard variable for'CCam::KeepTrackOfTheSpeed(CVector const&,CVector const&,CVector const&,float const&,float const&,float const&)::PreviousFov;

//----- (003D0DCC) --------------------------------------------------------
bool __fastcall CCam::LookBehind(CCam *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d2
  unsigned int Mode; // r1
  CEntity *CamTargetEntity; // r6
  int v6; // r2
  CEntity **p_CamTargetEntity; // r11
  CEntity::CEntityInfo m_info; // r0
  int v9; // r8
  _BOOL4 v10; // r9
  bool result; // r0
  CMatrix *m_pMat; // r0
  CVector *p_Front; // r10
  CSimpleTransform *p_m_transform; // r3
  __int64 v15; // d16
  RwReal z; // r0
  float *p_x; // r3
  CMatrix *v18; // r0
  RwReal v19; // s2
  RwReal v20; // s4
  float Beta; // r5
  float v22; // s16
  float v23; // r0
  float v24; // s2
  float v25; // s16
  float x; // s20
  float y; // s22
  float v28; // s18
  float v29; // s0
  RwReal v30; // s2
  RwReal v31; // s4
  RwReal v32; // s0
  int v33; // r5
  float v34; // s26
  float v35; // s24
  float v36; // s6
  float v37; // s2
  float v38; // s0
  float CA_MAX_DISTANCE; // s16
  CMatrix *v40; // r0
  __int64 v41; // d16
  RwReal v42; // s4
  RwReal v43; // s0
  CEntity *v44; // r0
  float v45; // s0
  float v46; // s4
  CEntity *v47; // r0
  CMatrix *v48; // r1
  float *p_tx; // r2
  RwReal v50; // s2
  RwReal v51; // s4
  __int64 v52; // d16
  CVehicle *v53; // r5
  CMatrix *v54; // r0
  __int64 v55; // d16
  const CVehicle *v56; // r0
  float v57; // s2
  float v58; // s4
  float v59; // s6
  RwReal v60; // s8
  RwReal v61; // s10
  __int64 v62; // d16
  RwReal *p_z; // r8
  RwReal *p_y; // r9
  CVector *p_Up; // r6
  CVehicle *v66; // r6
  float *p_xx; // r0
  CVehicle *v68; // r5
  float v69; // s18
  CVehicle *v70; // r5
  CTaskSimpleDuck *TaskDuck; // r0
  int *v72; // r0
  CVehicle *v73; // r0
  CTaskSimpleHoldEntity *TaskHold; // r0
  bool v75; // zf
  int32 v76; // r2
  RwReal v77; // s2
  RwReal v78; // s4
  __int64 v79; // d16
  __int64 v80; // d16
  float v81; // s2
  float v82; // s4
  float v83; // s6
  RwReal v84; // s8
  RwReal v85; // s10
  float v86; // s2
  float v87; // s0
  float v88; // s4
  CMatrix *v89; // r0
  float v90; // s8
  float v91; // s10
  __int64 v92; // d16
  float v93; // s6
  CVector *pSource; // [sp+4h] [bp-94h]
  CVector pVecTargetCoords; // [sp+8h] [bp-90h] BYREF
  CVector v96; // [sp+18h] [bp-80h] BYREF
  CVector v97; // [sp+28h] [bp-70h] BYREF
  CVector v98; // [sp+38h] [bp-60h] BYREF

  Mode = (unsigned __int16)this->Mode;
  if ( Mode <= 0x16 && ((1 << Mode) & (unsigned int)&loc_440008) != 0 )
  {
    CamTargetEntity = this->CamTargetEntity;
    v6 = 0;
    p_CamTargetEntity = &this->CamTargetEntity;
    m_info = CamTargetEntity->m_info;
    if ( (*(_BYTE *)&m_info & 7) == 2 )
      v6 = 1;
  }
  else
  {
    CamTargetEntity = this->CamTargetEntity;
    p_CamTargetEntity = &this->CamTargetEntity;
    v6 = 0;
    m_info = CamTargetEntity->m_info;
  }
  v9 = *(_BYTE *)&m_info & 7;
  v10 = (v9 ^ 2 | Mode ^ 0x10) == 0;
  result = 0;
  if ( v9 == 3 || v6 || v10 )
  {
    m_pMat = CamTargetEntity->m_pMat;
    p_Front = &this->Front;
    p_m_transform = &CamTargetEntity->m_transform;
    if ( m_pMat )
      p_m_transform = (CSimpleTransform *)&m_pMat->tx;
    v15 = *(_QWORD *)&p_m_transform->m_translate.x;
    z = p_m_transform->m_translate.z;
    p_x = &CamTargetEntity->m_transform.m_translate.x;
    v96.z = z;
    *(_QWORD *)&v96.x = v15;
    v18 = CamTargetEntity->m_pMat;
    if ( v18 )
      p_x = &v18->tx;
    v19 = p_x[1] - this->Source.y;
    v20 = p_x[2] - this->Source.z;
    this->Front.x = *p_x - this->Source.x;
    this->Front.y = v19;
    this->Front.z = v20;
    pSource = &this->Source;
    if ( v6 == 1 )
    {
      v96 = gTargetCoordsForLookingBehind;
      this->LookingBehind = 1;
      if ( Mode == 18 )
        CA_MAX_DISTANCE = this->CA_MAX_DISTANCE;
      else
        CA_MAX_DISTANCE = 15.5;
      v40 = CamTargetEntity->m_pMat;
      if ( !v40 )
      {
        CPlaceable::AllocateMatrix(CamTargetEntity);
        CSimpleTransform::UpdateMatrix(&CamTargetEntity->m_transform, CamTargetEntity->m_pMat);
        v40 = CamTargetEntity->m_pMat;
        CamTargetEntity = *p_CamTargetEntity;
      }
      v41 = *(_QWORD *)&v40->xy;
      this->Source.z = v40->zy;
      *(_QWORD *)&pSource->x = v41;
      v42 = (float)(CA_MAX_DISTANCE * this->Source.y) + v96.y;
      v43 = (float)(CA_MAX_DISTANCE * (float)(this->Source.z + 0.2)) + v96.z;
      this->Source.x = (float)(CA_MAX_DISTANCE * this->Source.x) + v96.x;
      this->Source.y = v42;
      this->Source.z = v43;
      CWorld::pIgnoreEntity = CamTargetEntity;
      TheCamera.m_numExtrasEntitysToIgnore = 0;
      pVecTargetCoords = v96;
      v44 = *p_CamTargetEntity;
      v45 = (float)((float)((*p_CamTargetEntity)[1].m_transform.m_translate.z
                          * (*p_CamTargetEntity)[1].m_transform.m_translate.z)
                  + (float)((*p_CamTargetEntity)[1].m_transform.m_heading * (*p_CamTargetEntity)[1].m_transform.m_heading))
          + (float)(*(float *)&(*p_CamTargetEntity)[1].m_pMat * *(float *)&(*p_CamTargetEntity)[1].m_pMat);
      v46 = 0.01;
      if ( v45 > 0.04 )
        v46 = 1.0;
      CCollision::bCamCollideWithVehicles = 1;
      CCollision::relVelCamCollisionVehiclesSqr = v46;
      CCollision::bCamCollideWithPeds = v45 <= 0.04;
      CCollision::bCamCollideWithObjects = v45 <= 0.04;
      v47 = *(CEntity **)&v44[20].RandomSeed;
      if ( v47 )
      {
        TheCamera.m_numExtrasEntitysToIgnore = 1;
        TheCamera.m_pExtrasEntitysToIgnore[0] = v47;
      }
      CCamera::CameraColDetAndReact((CCamera *)v47, pSource, &pVecTargetCoords);
      v48 = (*p_CamTargetEntity)->m_pMat;
      p_tx = &v48->tx;
      if ( !v48 )
        p_tx = &(*p_CamTargetEntity)->m_transform.m_translate.x;
      v50 = p_tx[1] - this->Source.y;
      v51 = p_tx[2] - this->Source.z;
      this->Front.x = *p_tx - this->Source.x;
      this->Front.y = v50;
      this->Front.z = v51;
      this->Up.x = 0.0;
      this->Up.y = 0.0;
      this->Up.z = 1.0;
      CVector::Normalise(&this->Front);
      if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
      {
        this->Front.x = 0.0001;
        this->Front.y = 0.0001;
      }
      CrossProduct(&v97, &this->Front, &this->Up);
      v98 = v97;
      CVector::Normalise(&v98);
      CrossProduct(&v97, &v98, &this->Front);
      v52 = *(_QWORD *)&v97.x;
      this->Up.z = v97.z;
      *(_QWORD *)&this->Up.x = v52;
      CCamera::ImproveNearClip(&TheCamera, (CVehicle *)*p_CamTargetEntity, 0, pSource, (int)&pVecTargetCoords);
      CWorld::pIgnoreEntity = 0;
      if ( !v10 )
      {
LABEL_16:
        if ( v9 == 3 )
        {
LABEL_17:
          Beta = this->Beta;
          v22 = sinf(Beta);
          this->Source.z = 0.0;
          LODWORD(v23) = COERCE_UNSIGNED_INT(cosf(Beta)) ^ 0x80000000;
          this->Source.x = v23;
          this->Source.y = -v22;
          v24 = *(float *)&(*p_CamTargetEntity)[23].m_nFlags * v22;
          v25 = 0.0;
          this->Source.z = (float)(0.0
                                 - (float)((float)((float)(*(float *)&(*p_CamTargetEntity)[23].m_pRwObject * v23) - v24)
                                         + (float)(*(float *)&(*p_CamTargetEntity)[23].m_nFlags.bdummy * 0.0)))
                         + 0.3;
          CVector::Normalise(pSource);
          v2.n64_u32[0] = 1058642330;
          x = v96.x;
          y = v96.y;
          v1.n64_f32[0] = TheCamera.m_fPedZoomSmoothed + 2.0;
          v28 = v96.z;
          v29 = vmax_f32(v1, v2).n64_f32[0];
          v30 = (float)(this->Source.x * v29) + v96.x;
          v31 = (float)(this->Source.y * v29) + v96.y;
          v32 = (float)(this->Source.z * v29) + v96.z;
          this->Source.x = v30;
          this->Source.y = v31;
          this->Source.z = v32;
          v33 = TheCamera.m_nPedZoom - 1;
          v34 = CCam::LookBehind(void)::gLookBackNearZModSource[TheCamera.m_nPedZoom - 1];
          v35 = CCam::LookBehind(void)::gLookBackNearZModTarget[TheCamera.m_nPedZoom - 1];
          if ( CPedIntelligence::GetTaskSwim((const CPedIntelligence *)LODWORD((*p_CamTargetEntity)[18].m_transform.m_translate.y)) )
          {
            v36 = CCam::LookBehind(void)::gScaleWhenLookingBackSwimming[v33];
            v37 = v36 * (float)(y - this->Source.y);
            v38 = CCam::LookBehind(void)::gExtraHeightWhenLookingBackSwimming[v33]
                + (float)(v28 + (float)(v36 * (float)(v28 - this->Source.z)));
            this->Source.x = x + (float)(v36 * (float)(x - this->Source.x));
            this->Source.y = y + v37;
            this->Source.z = v38;
          }
          else
          {
            v38 = this->Source.z;
          }
          v69 = v35 + v28;
          this->Source.z = v34 + v38;
          v96.z = v69;
          v70 = (CVehicle *)*p_CamTargetEntity;
          CPedIntelligence::GetTaskDuck(
            (const CPedIntelligence *)LODWORD((*p_CamTargetEntity)[18].m_transform.m_translate.y),
            1);
          TaskDuck = CPedIntelligence::GetTaskDuck(*(const CPedIntelligence **)&v70->m_upgrades[1], 1);
          if ( TaskDuck && (HIBYTE(v70->pPassengers[7]) & 4) != 0 && !TaskDuck->m_bIsAborting )
          {
            v72 = dword_3D17BC;
            if ( (float)((float)((float)(v70->m_vecMoveSpeed.x * v70->m_vecMoveSpeed.x)
                               + (float)(v70->m_vecMoveSpeed.y * v70->m_vecMoveSpeed.y))
                       + (float)(v70->m_vecMoveSpeed.z * v70->m_vecMoveSpeed.z)) > 0.000001 )
              v72 = &dword_3D17BC[1];
            v25 = *(float *)v72;
          }
          TheCamera.m_duckZMod = TheCamera.m_duckZMod
                               + (float)((float)(v25 - TheCamera.m_duckZMod) * (float)(CTimer::ms_fTimeStep * 0.1));
          this->Source.z = this->Source.z + TheCamera.m_duckZMod;
          v96.z = TheCamera.m_duckZMod + v69;
          v73 = (CVehicle *)*p_CamTargetEntity;
          TheCamera.m_numExtrasEntitysToIgnore = 0;
          if ( v73 )
          {
            TaskHold = CPedIntelligence::GetTaskHold(*(const CPedIntelligence **)&v73->m_upgrades[1], 0);
            v75 = TaskHold == 0;
            if ( TaskHold )
            {
              TaskHold = (CTaskSimpleHoldEntity *)TaskHold->m_pHoldEntity;
              v75 = TaskHold == 0;
            }
            if ( !v75 )
            {
              v76 = TheCamera.m_numExtrasEntitysToIgnore++;
              TheCamera.m_pExtrasEntitysToIgnore[v76] = (CEntity *)TaskHold;
            }
          }
          CCollision::bCamCollideWithVehicles = 1;
          CCollision::bCamCollideWithPeds = 1;
          CCollision::bCamCollideWithObjects = 1;
          CCamera::CameraColDetAndReact((CCamera *)&CCollision::bCamCollideWithObjects, pSource, &v96);
          v77 = v96.y - this->Source.y;
          v78 = v96.z - this->Source.z;
          this->Front.x = v96.x - this->Source.x;
          this->Front.y = v77;
          this->Front.z = v78;
          this->Up.x = 0.0;
          this->Up.y = 0.0;
          this->Up.z = 1.0;
          CVector::Normalise(&this->Front);
          p_z = &this->Up.z;
          p_y = &this->Up.y;
          p_Up = &this->Up;
          if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
          {
            this->Front.x = 0.0001;
            this->Front.y = 0.0001;
          }
          CrossProduct(&v97, &this->Front, &this->Up);
          v98 = v97;
          CVector::Normalise(&v98);
          CrossProduct(&v97, &v98, &this->Front);
          v79 = *(_QWORD *)&v97.x;
          this->Up.z = v97.z;
          *(_QWORD *)&p_Up->x = v79;
          CCamera::ImproveNearClip(&TheCamera, 0, (CPed *)*p_CamTargetEntity, pSource, (int)&v96);
          if ( Scene.camera->nearPlane > 0.05 && TheCamera.m_nPedZoom == 1 )
            RwCameraSetNearClipPlane(Scene.camera, 0.05);
          goto LABEL_65;
        }
LABEL_43:
        p_z = &this->Up.z;
        p_y = &this->Up.y;
        p_Up = &this->Up;
LABEL_65:
        p_Up->x = 0.0;
        *p_y = 0.0;
        *p_z = 1.0;
        CVector::Normalise(&this->Front);
        if ( p_Front->x == 0.0 && this->Front.y == 0.0 )
        {
          this->Front.x = 0.0001;
          this->Front.y = 0.0001;
        }
        CrossProduct(&v97, &this->Front, p_Up);
        v98 = v97;
        CVector::Normalise(&v98);
        CrossProduct(&v97, &v98, p_Front);
        v80 = *(_QWORD *)&v97.x;
        p_Up->z = v97.z;
        result = 1;
        *(_QWORD *)&p_Up->x = v80;
        return result;
      }
    }
    else if ( !v10 )
    {
      goto LABEL_16;
    }
    this->LookingBehind = 1;
    RwCameraSetNearClipPlane(Scene.camera, 0.05);
    v53 = (CVehicle *)*p_CamTargetEntity;
    v54 = (*p_CamTargetEntity)->m_pMat;
    if ( !v54 )
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v53->m_transform, v53->m_pMat);
      v54 = v53->m_pMat;
    }
    v55 = *(_QWORD *)&v54->xy;
    this->Front.z = v54->zy;
    *(_QWORD *)&p_Front->x = v55;
    CVector::Normalise(&this->Front);
    v56 = (const CVehicle *)*p_CamTargetEntity;
    if ( (*p_CamTargetEntity)[24]._vptr$CPlaceable == (int (**)(void))&byte_5 )
      this->Source.z = this->Source.z + -0.5;
    if ( CVehicle::GetVehicleAppearance(v56) == APR_BIKE )
    {
      v57 = this->Front.x;
      v58 = this->Front.y;
      v59 = this->Front.z;
      v1.n64_f32[1] = v58 * 2.3;
      v60 = (float)(v57 * 2.3) + this->Source.x;
      v61 = (float)(v58 * 2.3) + this->Source.y;
      v1.n64_f32[0] = (float)(v59 * 2.3) + this->Source.z;
      this->Front.x = -v57;
      this->Front.y = -v58;
      this->Front.z = -v59;
      this->Source.x = v60;
      this->Source.y = v61;
      LODWORD(this->Source.z) = v1.n64_u32[0];
      this->Up.x = 0.0;
      this->Up.y = 0.0;
      this->Up.z = 1.0;
      CVector::Normalise(&this->Front);
      if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
      {
        this->Front.x = 0.0001;
        this->Front.y = 0.0001;
      }
      CrossProduct(&v97, &this->Front, &this->Up);
      v98 = v97;
      CVector::Normalise(&v98);
      CrossProduct(&v97, &v98, &this->Front);
      v62 = *(_QWORD *)&v97.x;
      this->Up.z = v97.z;
      *(_QWORD *)&this->Up.x = v62;
      if ( v9 == 3 )
        goto LABEL_17;
    }
    else if ( CVehicle::GetVehicleAppearance((const CVehicle *)*p_CamTargetEntity) == APR_HELI )
    {
      v66 = (CVehicle *)*p_CamTargetEntity;
      p_xx = &(*p_CamTargetEntity)->m_pMat->xx;
      if ( p_xx )
      {
        v68 = (CVehicle *)*p_CamTargetEntity;
      }
      else
      {
        CPlaceable::AllocateMatrix(*p_CamTargetEntity);
        CSimpleTransform::UpdateMatrix(&v66->m_transform, v66->m_pMat);
        v68 = (CVehicle *)*p_CamTargetEntity;
        p_xx = &v66->m_pMat->xx;
      }
      v86 = -p_xx[8];
      v87 = -p_xx[9];
      v88 = -p_xx[10];
      this->Front.x = v86;
      this->Front.y = v87;
      this->Front.z = v88;
      v89 = v68->m_pMat;
      if ( !v89 )
      {
        CPlaceable::AllocateMatrix(v68);
        CSimpleTransform::UpdateMatrix(&v68->m_transform, v68->m_pMat);
        v89 = v68->m_pMat;
        v86 = this->Front.x;
        v87 = this->Front.y;
        v88 = this->Front.z;
      }
      v90 = this->Source.y;
      v91 = this->Source.z;
      v92 = *(_QWORD *)&v89->xy;
      v93 = this->Source.x;
      this->Up.z = v89->zy;
      *(_QWORD *)&this->Up.x = v92;
      this->Source.x = (float)(v86 * 0.25) + v93;
      this->Source.y = (float)(v87 * 0.25) + v90;
      this->Source.z = (float)(v88 * 0.25) + v91;
      if ( v9 == 3 )
        goto LABEL_17;
    }
    else
    {
      v81 = this->Front.x;
      v82 = this->Front.y;
      v83 = this->Front.z;
      v1.n64_f32[1] = v82 * 0.25;
      v84 = (float)(v81 * 0.25) + this->Source.x;
      v85 = (float)(v82 * 0.25) + this->Source.y;
      v1.n64_f32[0] = (float)(v83 * 0.25) + this->Source.z;
      this->Front.x = -v81;
      this->Front.y = -v82;
      this->Front.z = -v83;
      this->Source.x = v84;
      this->Source.y = v85;
      LODWORD(this->Source.z) = v1.n64_u32[0];
      if ( v9 == 3 )
        goto LABEL_17;
    }
    goto LABEL_43;
  }
  return result;
}
// 3D0F66: variable 'v1' is possibly undefined
// 3D0F66: variable 'v2' is possibly undefined
// 5: using guessed type char byte_5;
// 3D17BC: using guessed type int dword_3D17BC[2];

//----- (003D17EC) --------------------------------------------------------
bool __fastcall CCam::LookRight(CCam *this, bool bIsRight)
{
  float32x2_t v2; // d0
  float32x2_t v3; // d5
  float32x2_t v4; // d8
  _BOOL4 v6; // r8
  unsigned int Mode; // r0
  CEntity *CamTargetEntity; // r1
  int v9; // r2
  CEntity **p_CamTargetEntity; // r10
  CEntity::CEntityInfo m_info; // r3
  int v12; // r6
  _BOOL4 v13; // r3
  float v14; // s22
  bool v15; // zf
  float CA_MAX_DISTANCE; // s24
  CMatrix *m_pMat; // r2
  float *p_tx; // r3
  float v20; // s16
  float v21; // s20
  float v22; // s18
  CEntity *v23; // r5
  CMatrix *v24; // r0
  __int64 v25; // d16
  float v26; // r5
  float v27; // s22
  float v28; // s0
  CEntity *v29; // r0
  CColModel *ColModel; // r9
  CEntity *v31; // r3
  CPlaceable *v32; // r5
  float v33; // s0
  float v34; // s4
  CEntity *z_low; // r0
  CPlaceable *v36; // r5
  const CSimpleTransform *p_m_transform; // r6
  float *p_xx; // r0
  const CSimpleTransform *v39; // r1
  double v40; // d16
  float *p_x; // r1
  CPlaceable *v42; // r6
  CPed *v43; // r5
  RwObject_0 *m_pRwObject; // r0
  char *parent; // r1
  const CMatrix *v46; // r0
  RwMatrix *v47; // r1
  float v48; // s18
  float v49; // s22
  float v50; // s20
  CPlaceable *v51; // r5
  float *v52; // r1
  CPlaceable *v53; // r0
  float v54; // s6
  float v55; // s4
  float v56; // s0
  float v57; // s2
  CVector *p_m_cvecTargetCoorsForFudgeInter; // r1
  float x; // s2
  float y; // s8
  float v61; // s0
  CMatrix *v62; // r1
  float *v63; // r2
  RwReal v64; // s4
  float v65; // s0
  __int64 v66; // d16
  tBoatHandlingData *BoatPointer; // r0
  float Look_L_R_CamHeight; // s26
  float **v69; // r0
  CPlaceable *v70; // r5
  float *v71; // r1
  float *v72; // r0
  float v73; // s16
  float v74; // s0
  float v75; // s2
  float v76; // s4
  float v77; // s16
  CPlaceable *v78; // r5
  float *v79; // r0
  unsigned int v80; // s0
  unsigned int v81; // s2
  RwReal v82; // s4
  float *v83; // r0
  RwReal v84; // s4
  RwReal v85; // s0
  CMatrix *v86; // r0
  __int64 v87; // d16
  CPlaceable *v88; // r6
  CMatrix *v89; // r0
  __int64 v90; // d16
  CVector *p_Front; // r1
  CVector *p_Up; // r2
  __int64 v93; // d16
  RwReal v94; // s2
  RwReal v95; // s4
  double v96; // [sp+0h] [bp-98h] BYREF
  float z; // [sp+8h] [bp-90h]
  CVector pVecTargetCoords; // [sp+Ch] [bp-8Ch] BYREF
  CVector v99; // [sp+18h] [bp-80h] BYREF
  CVector v100; // [sp+28h] [bp-70h] BYREF
  CVector v101; // [sp+38h] [bp-60h] BYREF

  v6 = bIsRight;
  Mode = (unsigned __int16)this->Mode;
  if ( Mode <= 0x16 && ((1 << Mode) & (unsigned int)&loc_440008) != 0 )
  {
    CamTargetEntity = this->CamTargetEntity;
    v9 = 0;
    p_CamTargetEntity = &this->CamTargetEntity;
    m_info = CamTargetEntity->m_info;
    if ( (*(_BYTE *)&m_info & 7) == 2 )
      v9 = 1;
  }
  else
  {
    CamTargetEntity = this->CamTargetEntity;
    p_CamTargetEntity = &this->CamTargetEntity;
    v9 = 0;
    m_info = CamTargetEntity->m_info;
  }
  v12 = *(_BYTE *)&m_info & 7;
  v13 = (v12 ^ 2 | Mode ^ 0x10) == 0;
  if ( v6 )
  {
    v14 = 1.5708;
    this->LookingRight = 1;
  }
  else
  {
    v14 = -1.5708;
    this->LookingLeft = 1;
  }
  v15 = v12 == 3;
  if ( v12 != 3 )
    v15 = (v9 | v13) == 1;
  if ( !v15 )
    return 0;
  if ( v9 == 1 )
  {
    CA_MAX_DISTANCE = 9.0;
    m_pMat = CamTargetEntity->m_pMat;
    p_tx = &m_pMat->tx;
    if ( !m_pMat )
      p_tx = &CamTargetEntity->m_transform.m_translate.x;
    v20 = *p_tx;
    v21 = p_tx[1];
    v22 = p_tx[2];
    if ( Mode == 22 )
    {
      if ( CamTargetEntity )
      {
        BoatPointer = cHandlingDataMgr::GetBoatPointer(
                        &mod_HandlingManager,
                        *((_BYTE *)&CModelInfo::ms_modelInfoPtrs[CamTargetEntity->m_nModelIndex][1].m_flags + 2));
        if ( BoatPointer )
        {
          Look_L_R_CamHeight = BoatPointer->Look_L_R_CamHeight;
          if ( !CCullZones::Cam1stPersonForPlayer() )
            this->Source.z = v22 + Look_L_R_CamHeight;
        }
      }
    }
    else if ( Mode == 18 )
    {
      CA_MAX_DISTANCE = this->CA_MAX_DISTANCE;
    }
    v23 = *p_CamTargetEntity;
    v24 = (*p_CamTargetEntity)->m_pMat;
    if ( !v24 )
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v23->m_transform, v23->m_pMat);
      v24 = v23->m_pMat;
    }
    v25 = *(_QWORD *)&v24->xy;
    v99.z = v24->zy;
    *(_QWORD *)&v99.x = v25;
    CVector::Normalise(&v99);
    v26 = v14 + CGeneral::GetATanOfXY(v99.x, v99.y);
    v27 = cosf(v26);
    v28 = sinf(v26);
    v29 = this->CamTargetEntity;
    this->Source.x = v20 + (float)(CA_MAX_DISTANCE * v27);
    this->Source.y = v21 + (float)(CA_MAX_DISTANCE * v28);
    pVecTargetCoords.y = v21;
    pVecTargetCoords.x = v20;
    pVecTargetCoords.z = v22;
    ColModel = CEntity::GetColModel(v29);
    v4.n64_u32[0] = LODWORD(this->Source.z);
    v31 = *p_CamTargetEntity;
    TheCamera.m_numExtrasEntitysToIgnore = 0;
    CWorld::pIgnoreEntity = v31;
    v32 = *p_CamTargetEntity;
    v33 = (float)((float)((*p_CamTargetEntity)[1].m_transform.m_translate.z
                        * (*p_CamTargetEntity)[1].m_transform.m_translate.z)
                + (float)((*p_CamTargetEntity)[1].m_transform.m_heading * (*p_CamTargetEntity)[1].m_transform.m_heading))
        + (float)(*(float *)&(*p_CamTargetEntity)[1].m_pMat * *(float *)&(*p_CamTargetEntity)[1].m_pMat);
    v34 = 0.01;
    if ( v33 > 0.04 )
      v34 = 1.0;
    CCollision::bCamCollideWithVehicles = 1;
    CCollision::relVelCamCollisionVehiclesSqr = v34;
    CCollision::bCamCollideWithPeds = v33 <= 0.04;
    CCollision::bCamCollideWithObjects = v33 <= 0.04;
    z_low = (CEntity *)LODWORD(v32[51].m_transform.m_translate.z);
    if ( z_low )
    {
      TheCamera.m_numExtrasEntitysToIgnore = 1;
      TheCamera.m_pExtrasEntitysToIgnore[0] = z_low;
    }
    CCamera::CameraColDetAndReact((CCamera *)z_low, &this->Source, &pVecTargetCoords);
    CWorld::pIgnoreEntity = 0;
    v36 = *p_CamTargetEntity;
    p_m_transform = &(*p_CamTargetEntity)->m_transform;
    p_xx = &(*p_CamTargetEntity)->m_pMat->xx;
    v39 = p_m_transform;
    if ( p_xx )
      v39 = (const CSimpleTransform *)(p_xx + 12);
    v40 = *(double *)&v39->m_translate.x;
    z = v39->m_translate.z;
    v96 = v40;
    if ( v6 )
    {
      if ( !p_xx )
      {
        CPlaceable::AllocateMatrix(v36);
        CSimpleTransform::UpdateMatrix(p_m_transform, v36->m_pMat);
        p_xx = &v36->m_pMat->xx;
      }
      p_x = &ColModel->m_boxBound.m_vecMin.x;
    }
    else
    {
      if ( !p_xx )
      {
        CPlaceable::AllocateMatrix(v36);
        CSimpleTransform::UpdateMatrix(p_m_transform, v36->m_pMat);
        p_xx = &v36->m_pMat->xx;
      }
      p_x = &ColModel->m_boxBound.m_vecMax.x;
    }
    v48 = (float)(*p_x * *p_xx) + *(float *)&v96;
    v49 = (float)(*p_x * p_xx[1]) + *((float *)&v96 + 1);
    v50 = (float)(*p_x * p_xx[2]) + z;
    *(float *)&v96 = v48;
    *((float *)&v96 + 1) = v49;
    z = v50;
    v51 = *p_CamTargetEntity;
    v52 = &(*p_CamTargetEntity)->m_pMat->xx;
    if ( v52 )
    {
      v53 = *p_CamTargetEntity;
    }
    else
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v51->m_transform, v51->m_pMat);
      v53 = *p_CamTargetEntity;
      v52 = &v51->m_pMat->xx;
    }
    v54 = ColModel->m_boxBound.m_vecMax.z;
    v55 = v52[10];
    v56 = v54 * v52[8];
    v57 = v54 * v52[9];
    p_m_cvecTargetCoorsForFudgeInter = (CVector *)&v96;
    *((float *)&v96 + 1) = v57 + v49;
    *(float *)&v96 = v56 + v48;
    z = (float)(v54 * v55) + v50;
    x = this->Source.x;
    y = this->Source.y;
    if ( this->m_cvecTargetCoorsForFudgeInter.z > z )
      p_m_cvecTargetCoorsForFudgeInter = &this->m_cvecTargetCoorsForFudgeInter;
    v2.n64_f32[0] = p_m_cvecTargetCoorsForFudgeInter->z + 0.1;
    v3.n64_u32[0] = LODWORD(this->Source.z);
    LODWORD(v61) = vmax_f32(vmin_f32(v4, v2), v3).n64_u32[0];
    this->Source.z = v61;
    v62 = v53->m_pMat;
    v63 = &v62->tx;
    if ( !v62 )
      v63 = &v53->m_transform.m_translate.x;
    v15 = this->Mode == 22;
    v64 = v63[1] - y;
    v65 = (float)(v63[2] - v61) + 1.1;
    this->Front.x = *v63 - x;
    this->Front.y = v64;
    this->Front.z = v65;
    if ( v15 )
      this->Front.z = v65 + 1.2;
    this->Up.x = 0.0;
    this->Up.y = 0.0;
    this->Up.z = 1.0;
    CVector::Normalise(&this->Front);
    if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
    {
      this->Front.x = 0.0001;
      this->Front.y = 0.0001;
    }
    CrossProduct(&v100, &this->Front, &this->Up);
    v101 = v100;
    CVector::Normalise(&v101);
    CrossProduct(&v100, &v101, &this->Front);
    v66 = *(_QWORD *)&v100.x;
    this->Up.z = v100.z;
    *(_QWORD *)&this->Up.x = v66;
  }
  else if ( v13 )
  {
    if ( v6 )
      this->LookingRight = 1;
    else
      this->LookingLeft = 1;
    RwCameraSetNearClipPlane(Scene.camera, 0.05);
    v42 = *p_CamTargetEntity;
    if ( (*p_CamTargetEntity)[24]._vptr$CPlaceable == (int (**)(void))&byte_5 )
    {
      v43 = (CPed *)v42[46].m_pMat;
      if ( v43 )
      {
        memset(&v101, 0, sizeof(v101));
        CPed::SetPedPositionInCar(v43);
        m_pRwObject = v43->m_pRwObject;
        if ( m_pRwObject )
        {
          parent = (char *)m_pRwObject->parent;
          v46 = v43->m_pMat;
          v47 = (RwMatrix *)(parent + 16);
          if ( v46 )
            CMatrix::UpdateRwMatrix(v46, v47);
          else
            CSimpleTransform::UpdateRwMatrix(&v43->m_transform, v47);
        }
        CEntity::UpdateRwFrame(v43);
        CEntity::UpdateRpHAnim(v43);
        CPed::GetBonePosition(v43, &v101, 4u, 1);
        if ( v6 )
          v69 = &BOAT_1STPERSON_L_OFFSETX_ptr;
        else
          v69 = &BOAT_1STPERSON_R_OFFSETX_ptr;
        v70 = *p_CamTargetEntity;
        v71 = *v69;
        v72 = &(*p_CamTargetEntity)->m_pMat->xx;
        v73 = *v71;
        if ( !v72 )
        {
          CPlaceable::AllocateMatrix(*p_CamTargetEntity);
          CSimpleTransform::UpdateMatrix(&v70->m_transform, v70->m_pMat);
          v72 = &v70->m_pMat->xx;
        }
        v74 = (float)(v73 * *v72) + v101.x;
        v75 = (float)(v73 * v72[1]) + v101.y;
        v76 = (float)(v73 * v72[2]) + v101.z;
        v77 = BOAT_1STPERSON_LR_OFFSETZ;
        v101.x = v74;
        v101.y = v75;
        v101.z = v76;
        v78 = *p_CamTargetEntity;
        v79 = &(*p_CamTargetEntity)->m_pMat->xx;
        if ( v79 )
        {
          v42 = *p_CamTargetEntity;
        }
        else
        {
          CPlaceable::AllocateMatrix(*p_CamTargetEntity);
          CSimpleTransform::UpdateMatrix(&v78->m_transform, v78->m_pMat);
          v42 = *p_CamTargetEntity;
          v79 = &v78->m_pMat->xx;
          v74 = v101.x;
          v75 = v101.y;
          v76 = v101.z;
        }
        *(float *)&v80 = (float)(v77 * v79[8]) + v74;
        *(float *)&v81 = (float)(v77 * v79[9]) + v75;
        v82 = (float)(v77 * v79[10]) + v76;
        *(_QWORD *)&v101.x = __PAIR64__(v81, v80);
        v101.z = v82;
        this->Source.z = v82;
        *(_QWORD *)&this->Source.x = __PAIR64__(v81, v80);
      }
      else
      {
        this->Source.z = this->Source.z + -0.5;
      }
    }
    if ( v42[60]._vptr$CPlaceable != (int (**)(void))byte_9 )
    {
      v83 = &v42->m_pMat->xx;
      if ( !v83 )
      {
        CPlaceable::AllocateMatrix(v42);
        CSimpleTransform::UpdateMatrix(&v42->m_transform, v42->m_pMat);
        v83 = &v42->m_pMat->xx;
        v42 = *p_CamTargetEntity;
      }
      v84 = this->Source.y - (float)(v83[1] * 0.35);
      v85 = this->Source.z - (float)(v83[2] * 0.35);
      this->Source.x = this->Source.x - (float)(*v83 * 0.35);
      this->Source.y = v84;
      this->Source.z = v85;
    }
    v86 = v42->m_pMat;
    if ( !v86 )
    {
      CPlaceable::AllocateMatrix(v42);
      CSimpleTransform::UpdateMatrix(&v42->m_transform, v42->m_pMat);
      v86 = v42->m_pMat;
    }
    v87 = *(_QWORD *)&v86->xz;
    this->Up.z = v86->zz;
    *(_QWORD *)&this->Up.x = v87;
    CVector::Normalise(&this->Up);
    v88 = *p_CamTargetEntity;
    v89 = (*p_CamTargetEntity)->m_pMat;
    if ( !v89 )
    {
      CPlaceable::AllocateMatrix(*p_CamTargetEntity);
      CSimpleTransform::UpdateMatrix(&v88->m_transform, v88->m_pMat);
      v89 = v88->m_pMat;
    }
    v90 = *(_QWORD *)&v89->xy;
    this->Front.z = v89->zy;
    *(_QWORD *)&this->Front.x = v90;
    CVector::Normalise(&this->Front);
    if ( v6 )
    {
      p_Front = &this->Front;
      p_Up = &this->Up;
    }
    else
    {
      p_Front = &this->Up;
      p_Up = &this->Front;
    }
    CrossProduct(&v101, p_Front, p_Up);
    v93 = *(_QWORD *)&v101.x;
    this->Front.z = v101.z;
    *(_QWORD *)&this->Front.x = v93;
    CVector::Normalise(&this->Front);
    if ( CVehicle::GetVehicleAppearance((const CVehicle *)*p_CamTargetEntity) == APR_BIKE )
    {
      v94 = this->Source.y - (float)(this->Front.y * 1.45);
      v95 = this->Source.z - (float)(this->Front.z * 1.45);
      this->Source.x = this->Source.x - (float)(this->Front.x * 1.45);
      this->Source.y = v94;
      this->Source.z = v95;
    }
  }
  return 1;
}
// 3D1B78: variable 'v4' is possibly undefined
// 3D1B78: variable 'v2' is possibly undefined
// 3D1B7C: variable 'v3' is possibly undefined
// 5: using guessed type char byte_5;
// 6768D4: using guessed type float *BOAT_1STPERSON_L_OFFSETX_ptr;
// 678448: using guessed type float *BOAT_1STPERSON_R_OFFSETX_ptr;

//----- (003D1F20) --------------------------------------------------------
void __fastcall CCam::GetVectorsReadyForRW(CCam *this)
{
  CVector *p_Front; // r5
  __int64 v3; // d16
  CVector v4; // [sp+0h] [bp-30h] BYREF
  CVector v5; // [sp+10h] [bp-20h] BYREF

  p_Front = &this->Front;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  CVector::Normalise(&this->Front);
  if ( this->Front.x == 0.0 && this->Front.y == 0.0 )
  {
    this->Front.x = 0.0001;
    this->Front.y = 0.0001;
  }
  CrossProduct(&v4, p_Front, &this->Up);
  v5 = v4;
  CVector::Normalise(&v5);
  CrossProduct(&v4, &v5, p_Front);
  v3 = *(_QWORD *)&v4.x;
  this->Up.z = v4.z;
  *(_QWORD *)&this->Up.x = v3;
}

//----- (003D1FAC) --------------------------------------------------------
bool __fastcall bIsLampPost(int32 idx)
{
  return MI_SINGLESTREETLIGHTS1 == idx
      || MI_SINGLESTREETLIGHTS2 == idx
      || MI_SINGLESTREETLIGHTS3 == idx
      || MI_BOLLARDLIGHT == idx
      || MI_MLAMPPOST == idx
      || MI_STREETLAMP1 == idx
      || MI_STREETLAMP2 == idx
      || MI_TELPOLE02 == idx
      || MI_TRAFFICLIGHTS_MIAMI == idx
      || MI_TRAFFICLIGHTS_TWOVERTICAL == idx
      || MI_TRAFFICLIGHTS_3 == idx
      || MI_TRAFFICLIGHTS_4 == idx
      || MI_TRAFFICLIGHTS_GAY == idx
      || MI_TRAFFICLIGHTS_5 == idx;
}

//----- (003D209C) --------------------------------------------------------
void __fastcall WellBufferMe(
        float TheTarget,
        float *TheValueToChange,
        float *ValueSpeedSoFar,
        float TopSpeed,
        float SpeedStep,
        int IsAnAngle)
{
  float32x2_t v6; // d1
  float32x2_t v7; // d2
  float v8; // s2
  float v9; // s2
  float v10; // s4
  float v11; // s6
  float v12; // s0
  float v13; // s10
  float v14; // s0
  float v15; // s0

  v8 = TheTarget - *TheValueToChange;
  if ( IsAnAngle == 1 )
  {
    for ( ; v8 >= 3.1416; v8 = v8 + -6.2832 )
      ;
    for ( ; v8 < -3.1416; v8 = v8 + 6.2832 )
      ;
  }
  v9 = v8 * TopSpeed;
  v10 = *ValueSpeedSoFar;
  v11 = v9 - *ValueSpeedSoFar;
  v12 = fabsf(v11) * SpeedStep;
  v13 = -(float)(CTimer::ms_fTimeStep * v12);
  v14 = CTimer::ms_fTimeStep * v12;
  if ( v11 > 0.0 )
    v13 = v14;
  v15 = v10 + v13;
  *ValueSpeedSoFar = v10 + v13;
  if ( v9 < 0.0 || v9 > 0.0 )
  {
    v15 = v9;
    *ValueSpeedSoFar = v9;
  }
  v6.n64_u32[0] = 10.0;
  v7.n64_f32[0] = CTimer::ms_fTimeStep;
  *TheValueToChange = *TheValueToChange + (float)(v15 * vmin_f32(v7, v6).n64_f32[0]);
}
// 3D2170: variable 'v7' is possibly undefined
// 3D2170: variable 'v6' is possibly undefined

//----- (003D21A0) --------------------------------------------------------
void __fastcall MakeAngleLessThan180(float *AngleToChange)
{
  float v1; // s0

  v1 = *AngleToChange;
  if ( *AngleToChange >= 3.1416 )
  {
    do
      v1 = v1 + -6.2832;
    while ( v1 >= 3.1416 );
    *AngleToChange = v1;
  }
  if ( v1 < -3.1416 )
  {
    do
      v1 = v1 + 6.2832;
    while ( v1 < -3.1416 );
    *AngleToChange = v1;
  }
}

//----- (003D2200) --------------------------------------------------------
bool __fastcall CCam::GetBoatLook_L_R_HeightOffset(CCam *this, float *HeightOffset)
{
  CEntity *CamTargetEntity; // r0
  tBoatHandlingData *BoatPointer; // r0

  CamTargetEntity = this->CamTargetEntity;
  if ( !CamTargetEntity )
    return 0;
  BoatPointer = cHandlingDataMgr::GetBoatPointer(
                  &mod_HandlingManager,
                  *((_BYTE *)&CModelInfo::ms_modelInfoPtrs[CamTargetEntity->m_nModelIndex][1].m_flags + 2));
  if ( !BoatPointer )
    return 0;
  *HeightOffset = BoatPointer->Look_L_R_CamHeight;
  return 1;
}

//----- (003D2240) --------------------------------------------------------
bool __fastcall CCam::GetWeaponFirstPersonOn(CCam *this)
{
  CEntity *CamTargetEntity; // r0

  CamTargetEntity = this->CamTargetEntity;
  return CamTargetEntity
      && (*(_BYTE *)&CamTargetEntity->m_info & 7) == 3
      && *((_BYTE *)&CamTargetEntity[24].m_pRwObject + 28 * SLOBYTE(CamTargetEntity[30].m_pMat)) != 0;
}

//----- (003D2270) --------------------------------------------------------
void __fastcall CCam::Init(CCam *this)
{
  CPad *Pad; // r0
  uint32 v3; // r10

  gIdleCam.lastIdlePos.x = 0.0;
  gIdleCam.lastIdlePos.y = 0.0;
  gIdleCam.lastIdlePos.z = 0.0;
  gIdleCam.timeIdleCamStarted = -1.0;
  gIdleCam.timeLastTargetSelected = -1.0;
  gIdleCam.timeTargetEntityWasLastVisible = -1.0;
  gIdleCam.curFOV = 70.0;
  gIdleCam.targetLOSCounter = 0;
  gIdleCam.zoomState = 3;
  gIdleCam.zoomFrom = -1.0;
  gIdleCam.zoomTo = -1.0;
  Pad = currentPad;
  gIdleCam.timeZoomStarted = -1.0;
  gIdleCam.timeLastZoomIn = -1.0;
  gIdleCam.slerpTime = 1.0;
  *(_WORD *)&gIdleCam.bForceAZoomOut = 0;
  *(_QWORD *)&gIdleCam.pTarget = 0LL;
  *(_QWORD *)&gIdleCam.positionToSlerpFrom.y = 0LL;
  v3 = CTimer::m_snTimeInMilliseconds;
  gIdleCam.timeSlerpStarted = -1.0;
  if ( !currentPad )
    Pad = CPad::GetPad(0);
  Pad->LastTimeTouched = v3;
  this->Mode = 4;
  this->Front.x = 0.0;
  this->Front.y = 0.0;
  this->Front.z = -1.0;
  this->Up.x = 0.0;
  this->Up.y = 0.0;
  this->Up.z = 1.0;
  this->m_iDoCollisionChecksOnFrameNum = 1;
  this->Rotating = 0;
  this->m_iDoCollisionCheckEveryNumOfFrames = 9;
  this->m_iFrameNumWereAt = 0;
  this->m_fRealGroundDist = 0.0;
  this->AlphaSpeed = 0.0;
  this->m_fCameraHeightMultiplier = 0.75;
  this->m_pLastCarEntered = 0;
  this->m_pLastPedLookedAt = 0;
  this->ResetStatics = 1;
  this->ResetKeyboardStatics = 1;
  this->Beta = 0.0;
  this->BetaSpeed = 0.0;
  this->m_fTilt = 0.0;
  this->m_fTiltSpeed = 0.0;
  *(_WORD *)&this->m_bCollisionChecksOn = 1;
  this->LookingBehind = 0;
  *(_QWORD *)&this->Distance = 1106247680LL;
  *(_QWORD *)&this->CA_MIN_DISTANCE = 0LL;
  *(_QWORD *)&this->m_fCloseInPedHeightOffset = 0LL;
  *(_QWORD *)&this->m_fCloseInCarHeightOffset = 0LL;
  *(_QWORD *)&this->Beta_Targeting = 0LL;
  *(_QWORD *)&this->Y_Targetting = 0LL;
  *(_QWORD *)this->m_nTargetHistoryTime = 0LL;
  *(_QWORD *)&this->m_nTargetHistoryTime[2] = 0LL;
  *(_QWORD *)&this->m_aTargetHistoryPos[2].z = 0LL;
  *(_QWORD *)&this->m_aTargetHistoryPos[3].y = 0LL;
  *(_QWORD *)&this->m_aTargetHistoryPos[1].y = 0LL;
  *(_QWORD *)&this->m_aTargetHistoryPos[2].x = 0LL;
  *(_QWORD *)&this->m_aTargetHistoryPos[0].x = 0LL;
  *(_QWORD *)&this->m_aTargetHistoryPos[0].z = 0LL;
  this->m_fPlayerInFrontSyphonAngleOffSet = 0.34907;
  this->m_fSyphonModeTargetZOffSet = 0.5;
  this->m_fRadiusForDead = 1.5;
  this->LookingRight = 0;
  this->LookingLeft = 0;
  this->m_fCamBumpedHorz = 1.0;
  this->DirectionWasLooking = 3;
  this->LookBehindCamWasInFront = 0;
  this->m_fPedBetweenCameraHeightOffset = 0.0;
  this->m_fDimensionOfHighestNearCar = 0.0;
  this->CarWeAreFocussingOnI = 0.0;
  this->m_fCamBumpedVert = 0.0;
  this->m_nCamBumpedTime = 0;
  this->m_nCurrentHistoryPoints = 0;
  gLastTime2PlayerCameraCollided = 0;
  DirectionIsLooking = 3;
  gLastCamMode = -1;
  gLastTime2PlayerCameraWasOK = 0;
  gbCineyCamMessageDisplayed = 2;
  gPlayerPedVisible = 1;
  TheCamera.m_bForceCinemaCam = 0;
}

//----- (003D2438) --------------------------------------------------------
void __fastcall CIdleCam::Reset(CIdleCam *this, bool bResetControls)
{
  CPad *Pad; // r0
  uint32 v3; // r4

  this->lastIdlePos.x = 0.0;
  this->lastIdlePos.y = 0.0;
  this->lastIdlePos.z = 0.0;
  this->timeIdleCamStarted = -1.0;
  this->timeLastTargetSelected = -1.0;
  this->timeTargetEntityWasLastVisible = -1.0;
  this->curFOV = 70.0;
  this->targetLOSCounter = 0;
  this->zoomState = 3;
  this->zoomFrom = -1.0;
  this->zoomTo = -1.0;
  this->timeZoomStarted = -1.0;
  this->timeLastZoomIn = -1.0;
  this->slerpTime = 1.0;
  *(_WORD *)&this->bForceAZoomOut = 0;
  *(_QWORD *)&this->pTarget = 0LL;
  *(_QWORD *)&this->positionToSlerpFrom.y = 0LL;
  this->timeSlerpStarted = -1.0;
  if ( bResetControls )
  {
    Pad = currentPad;
    v3 = CTimer::m_snTimeInMilliseconds;
    if ( !currentPad )
      Pad = CPad::GetPad(0);
    Pad->LastTimeTouched = v3;
  }
}

//----- (003D24AC) --------------------------------------------------------
void __fastcall CCamera::CameraGenericModeSpecialCases(CCamera *this, CPed *pPed)
{
  CTaskSimpleHoldEntity *TaskHold; // r0
  CEntity *m_pHoldEntity; // r0
  int32 m_numExtrasEntitysToIgnore; // r1

  this->m_numExtrasEntitysToIgnore = 0;
  if ( pPed )
  {
    TaskHold = CPedIntelligence::GetTaskHold(pPed->m_pPedIntelligence, 0);
    if ( TaskHold )
    {
      m_pHoldEntity = TaskHold->m_pHoldEntity;
      if ( m_pHoldEntity )
      {
        m_numExtrasEntitysToIgnore = this->m_numExtrasEntitysToIgnore;
        this->m_numExtrasEntitysToIgnore = m_numExtrasEntitysToIgnore + 1;
        this->m_pExtrasEntitysToIgnore[m_numExtrasEntitysToIgnore] = m_pHoldEntity;
      }
    }
  }
}

//----- (003D24E8) --------------------------------------------------------
void __fastcall CCamera::CameraVehicleModeSpecialCases(CCamera *this, CVehicle *pVehicle)
{
  float v2; // s0
  float v3; // s4
  CVehicle *m_pVehicleBeingTowed; // r1
  int32 m_numExtrasEntitysToIgnore; // r2

  v2 = (float)((float)(pVehicle->m_vecMoveSpeed.x * pVehicle->m_vecMoveSpeed.x)
             + (float)(pVehicle->m_vecMoveSpeed.y * pVehicle->m_vecMoveSpeed.y))
     + (float)(pVehicle->m_vecMoveSpeed.z * pVehicle->m_vecMoveSpeed.z);
  v3 = 0.01;
  if ( v2 > 0.04 )
    v3 = 1.0;
  CCollision::bCamCollideWithVehicles = 1;
  CCollision::relVelCamCollisionVehiclesSqr = v3;
  CCollision::bCamCollideWithPeds = v2 <= 0.04;
  CCollision::bCamCollideWithObjects = v2 <= 0.04;
  m_pVehicleBeingTowed = pVehicle->m_pVehicleBeingTowed;
  if ( m_pVehicleBeingTowed )
  {
    m_numExtrasEntitysToIgnore = this->m_numExtrasEntitysToIgnore;
    this->m_numExtrasEntitysToIgnore = m_numExtrasEntitysToIgnore + 1;
    this->m_pExtrasEntitysToIgnore[m_numExtrasEntitysToIgnore] = m_pVehicleBeingTowed;
  }
}

//----- (003D25A0) --------------------------------------------------------
bool __fastcall CCamera::CameraColDetAndReact(CCamera *this, CVector *pSource, CVector *pVecTargetCoords)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  float32x2_t v7; // d11
  float x; // s0
  float y; // s2
  float v12; // s16
  float z; // s4
  float v14; // s18
  float v15; // s20
  SCamColVars *v16; // r0
  unsigned int v17; // r1
  CEntity *v18; // r6
  int v19; // r2
  bool v20; // zf
  CColModel *m_pColModel; // r2
  CVector *p_pDist; // r6
  float v23; // s0
  float v24; // s4
  float32x2_t v25; // d16
  CCollisionData *m_pColData; // r1
  int m_nNoOfSpheres; // r0
  int v28; // r2
  float v29; // s0
  float *p_z; // r1
  float v31; // s2
  float v32; // s4
  float v33; // s2
  float *p_xx; // r0
  float *p_x; // r1
  float v36; // s26
  float v37; // s28
  float v38; // s24
  float32x2_t v39; // d0
  int *v40; // r0
  char v41; // r8
  float v42; // s4
  float camMinDist; // s2
  bool v44; // r9
  float v45; // s0
  char v46; // r0
  float32x2_t v47; // d16
  unsigned __int64 v48; // d1
  __int64 v49; // d16
  float v50; // s10
  RwReal v51; // s2
  float v53; // [sp+Ch] [bp-64h] BYREF
  float pDist; // [sp+10h] [bp-60h] BYREF
  CVector pDest; // [sp+14h] [bp-5Ch] BYREF

  x = pVecTargetCoords->x;
  y = pVecTargetCoords->y;
  v12 = pSource->x - pVecTargetCoords->x;
  z = pVecTargetCoords->z;
  v14 = pSource->y - y;
  v15 = pSource->z - z;
  v16 = gpCamColVars;
  v17 = gCurCamColVars;
  v7.n64_f32[0] = gpCamColVars->camRad
                * (float)(gRadiusScalarForLengthToVehicle
                        * sqrtf((float)((float)(v12 * v12) + (float)(v14 * v14)) + (float)(v15 * v15)));
  if ( gCurCamColVars >= 0xAu )
  {
    v18 = CWorld::pIgnoreEntity;
    if ( CWorld::pIgnoreEntity )
    {
      v19 = *(_BYTE *)&CWorld::pIgnoreEntity->m_info & 7;
      v20 = v19 == 2;
      if ( v19 == 2 )
        v20 = LODWORD(CWorld::pIgnoreEntity[24].m_transform.m_translate.x) == 0;
      if ( v20 )
      {
        if ( CCamera::CameraColDetAndReact(CVector *,CVector *)::DIST_LOWEST_Z_STORED != CWorld::pIgnoreEntity->m_nModelIndex )
        {
          m_pColData = CEntity::GetColModel(CWorld::pIgnoreEntity)->m_pColData;
          CCamera::CameraColDetAndReact(CVector *,CVector *)::DIST_LOWEST_Z = 100.0;
          if ( m_pColData )
          {
            m_nNoOfSpheres = m_pColData->m_nNoOfSpheres;
            if ( m_nNoOfSpheres >= 1 )
            {
              v28 = 0;
              v29 = 100.0;
              p_z = &m_pColData->m_pSphereArray->m_vecCentre.z;
              do
              {
                v31 = *p_z;
                ++v28;
                v32 = p_z[1];
                p_z += 5;
                v33 = v31 - v32;
                if ( v33 < v29 )
                {
                  CCamera::CameraColDetAndReact(CVector *,CVector *)::DIST_LOWEST_Z = v33;
                  v29 = v33;
                }
              }
              while ( v28 < m_nNoOfSpheres );
            }
          }
          CCamera::CameraColDetAndReact(CVector *,CVector *)::DIST_LOWEST_Z_STORED = v18->m_nModelIndex;
          x = pVecTargetCoords->x;
          y = pVecTargetCoords->y;
          z = pVecTargetCoords->z;
        }
        p_xx = &v18->m_pMat->xx;
        p_x = &v18->m_transform.m_translate.x;
        if ( p_xx )
          p_x = p_xx + 12;
        v36 = x - *p_x;
        v37 = y - p_x[1];
        v38 = z - p_x[2];
        if ( !p_xx )
        {
          CPlaceable::AllocateMatrix(v18);
          CSimpleTransform::UpdateMatrix(&v18->m_transform, v18->m_pMat);
          p_xx = &v18->m_pMat->xx;
        }
        v5.n64_f32[0] = v38 * p_xx[10];
        v3.n64_f32[0] = (float)(v36 * p_xx[8]) + (float)(v37 * p_xx[9]);
        v4.n64_u32[0] = 1045220557;
        v16 = gpCamColVars;
        v17 = gCurCamColVars;
        v3.n64_f32[0] = (float)(v3.n64_f32[0] + v5.n64_f32[0])
                      - CCamera::CameraColDetAndReact(CVector *,CVector *)::DIST_LOWEST_Z;
        v5.n64_u32[0] = LODWORD(gpCamColVars->maxCamRad);
        v25.n64_u64[0] = vmin_f32(v5, vmax_f32(v3, v4)).n64_u64[0];
      }
      else
      {
        m_pColModel = CModelInfo::ms_modelInfoPtrs[CWorld::pIgnoreEntity->m_nModelIndex]->m_pColModel;
        p_pDist = (CVector *)&pDist;
        v4.n64_u64[0] = vmul_f32(
                          vsub_f32(
                            *(float32x2_t *)&m_pColModel->m_boxBound.m_vecMax.x,
                            *(float32x2_t *)&m_pColModel->m_boxBound.m_vecMin.x),
                          (float32x2_t)0x3F0000003F000000LL).n64_u64[0];
        v23 = (float)(m_pColModel->m_boxBound.m_vecMax.z - m_pColModel->m_boxBound.m_vecMin.z) * 0.5;
        v5.n64_u32[0] = v4.n64_u32[1];
        LODWORD(v24) = vmin_f32(v4, v5).n64_u32[0];
        if ( v4.n64_f32[0] < v4.n64_f32[1] )
          p_pDist = &pDest;
        LODWORD(pDest.x) = v4.n64_u32[0];
        v53 = v23;
        pDist = v4.n64_f32[1];
        if ( v24 >= v23 )
          p_pDist = (CVector *)&v53;
        v3.n64_u32[0] = LODWORD(p_pDist->x);
        v4.n64_u32[0] = LODWORD(gpCamColVars->maxCamRad);
        v25.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
      }
      v7.n64_u64[0] = vmin_f32(v25, v7).n64_u64[0];
    }
  }
  v3.n64_u32[0] = LODWORD(v16->maxCamRad);
  v4.n64_u32[0] = 1059481190;
  v39.n64_u64[0] = vmax_f32(vmin_f32(v7, v3), v4).n64_u64[0];
  if ( v17 > 9 )
  {
    camMinDist = v16->camMinDist;
    if ( CWorld::pIgnoreEntity )
    {
      v41 = 0;
      if ( (*(_BYTE *)&CWorld::pIgnoreEntity->m_info & 7) == 2
        && CWorld::pIgnoreEntity[24]._vptr$CPlaceable == (int (**)(void))byte_9 )
      {
        camMinDist = 0.05;
        v41 = 1;
      }
    }
    else
    {
      v41 = 0;
    }
  }
  else
  {
    v40 = dword_3D2A80;
    v41 = 0;
    if ( v17 < 4 )
      v40 = &dword_3D2A80[1];
    v42 = pSource->y - pVecTargetCoords->y;
    camMinDist = *(float *)v40
               / sqrtf(
                   (float)((float)((float)(pSource->x - pVecTargetCoords->x) * (float)(pSource->x - pVecTargetCoords->x))
                         + (float)(v42 * v42))
                 + (float)((float)(pSource->z - pVecTargetCoords->z) * (float)(pSource->z - pVecTargetCoords->z)));
  }
  gLastRadiusUsedInCollisionPreventionOfCamera = v39.n64_f32[0];
  if ( CCamera::ConeCastCollisionResolve(
         (CCamera *)&gLastRadiusUsedInCollisionPreventionOfCamera,
         pSource,
         pVecTargetCoords,
         &pDest,
         v39.n64_f32[0],
         camMinDist,
         &pDist) )
  {
    if ( pDist <= gpCamColVars->distToModClipping )
      RwCameraSetNearClipPlane(Scene.camera, gpCamColVars->clippingDistance);
    v44 = 1;
  }
  else
  {
    v44 = 0;
  }
  v45 = pDist;
  if ( pDist >= gCurDistForCam )
  {
    v46 = `guard variable for'CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached;
    __dmb(0xBu);
    if ( (v46 & 1) == 0
      && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached) )
    {
      CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.x = 0.0;
      CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.y = 0.0;
      CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.z = 0.0;
      _cxa_guard_release((__guard *)&`guard variable for'CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached);
    }
    v47.n64_u64[0] = vsub_f32(
                       *(float32x2_t *)&pSource->y,
                       *(float32x2_t *)&CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.y).n64_u64[0];
    v48 = vmul_f32(v47, v47).n64_u64[0];
    if ( (float)((float)((float)((float)(pSource->x - CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.x)
                               * (float)(pSource->x - CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.x))
                       + *(float *)&v48)
               + *((float *)&v48 + 1)) <= 0.0001 )
    {
      v45 = gCurDistForCam;
    }
    else
    {
      v6.n64_u32[0] = 1028443341;
      v39.n64_f32[0] = (float)(gpCamColVars->speedZoomOut * CTimer::ms_fTimeStep) * (float)(pDist - gCurDistForCam);
      v45 = gCurDistForCam + vmin_f32(v39, v6).n64_f32[0];
      gCurDistForCam = v45;
    }
    v49 = *(_QWORD *)&pSource->x;
    CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.z = pSource->z;
    *(_QWORD *)&CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached.x = v49;
  }
  else
  {
    gCurDistForCam = pDist;
  }
  if ( v45 > 1.0 )
  {
    v45 = 1.0;
    gCurDistForCam = 1.0;
  }
  v50 = pVecTargetCoords->z;
  v51 = (float)(v14 * v45) + pVecTargetCoords->y;
  pSource->x = pVecTargetCoords->x + (float)(v12 * v45);
  pSource->y = v51;
  pSource->z = (float)(v15 * v45) + v50;
  if ( ((gCurDistForCam < 0.5) & (unsigned __int8)v41) == 1 )
    RwCameraSetNearClipPlane(Scene.camera, 0.05);
  return v44;
}
// 3D2696: variable 'v5' is possibly undefined
// 3D26BE: variable 'v3' is possibly undefined
// 3D27BC: variable 'v4' is possibly undefined
// 3D27C4: variable 'v7' is possibly undefined
// 3D297E: variable 'v6' is possibly undefined
// 3D2A80: using guessed type int dword_3D2A80[2];
// 952FB4: using guessed type char `guard variable for'CCamera::CameraColDetAndReact(CVector *,CVector *)::gCamPosCached;

//----- (003D2AD4) --------------------------------------------------------
void __fastcall CCamera::ImproveNearClip(CCamera *this, CVehicle *pVehicle, CPed *pPed, CVector *pSource, int a5)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d2
  float32x2_t v7; // d3
  float32x2_t *p_y; // r10
  float32x2_t *v10; // r11
  float32x2_t v13; // d16
  float32x2_t v15; // d1
  int32 m_vehicleType; // r0
  float32x2_t v17; // d16
  RwCamera_0 *camera; // r0
  float v19; // s0
  float32x2_t v20; // d1
  float v21; // s0
  float v22; // r1
  _BOOL4 UsingParachute; // r5
  CTaskSimpleSwim *TaskSwim; // r0
  int m_nSwimState; // r4
  CPedModelInfo *v26; // r5
  float FOV; // s18
  float v28; // s16
  CCam *v29; // r1
  float v30; // s0
  float x; // s18
  float y; // s20
  float z; // s22
  float v34; // s24
  float v35; // s26
  float v36; // s4
  int v37; // r0
  CColSphere *v38; // r2
  float m_fRadius; // s12
  float32x2_t v40; // d16
  float v41; // s0
  float pNearest; // [sp+8h] [bp-58h] BYREF
  float pWaterZ[21]; // [sp+Ch] [bp-54h] BYREF

  p_y = (float32x2_t *)&pSource->y;
  v10 = (float32x2_t *)(a5 + 4);
  v13.n64_u64[0] = vsub_f32(*(float32x2_t *)&pSource->y, *(float32x2_t *)(a5 + 4)).n64_u64[0];
  v15.n64_u64[0] = vmul_f32(v13, v13).n64_u64[0];
  if ( sqrtf(
         (float)((float)((float)(pSource->x - *(float *)a5) * (float)(pSource->x - *(float *)a5)) + v15.n64_f32[0])
       + v15.n64_f32[1]) > 10.0
    && gCurDistForCam > Scene.camera->nearPlane )
  {
    RwCameraSetNearClipPlane(Scene.camera, gCurDistForCam);
  }
  if ( pVehicle )
  {
    m_vehicleType = pVehicle->m_vehicleType;
    if ( (unsigned int)(m_vehicleType - 3) > 1 )
      goto LABEL_28;
    if ( gCurDistForCam > 0.3 )
    {
      if ( (float)(this->Cams[this->ActiveCam].Source.z - CCamera::CalculateGroundHeight(this, 0)) <= 10.0 )
        goto LABEL_28;
      v17.n64_u64[0] = vsub_f32((float32x2_t)p_y->n64_u64[0], (float32x2_t)v10->n64_u64[0]).n64_u64[0];
      v20.n64_u64[0] = vmul_f32(v17, v17).n64_u64[0];
      camera = Scene.camera;
      v19 = sqrtf(
              (float)((float)((float)(pSource->x - *(float *)a5) * (float)(pSource->x - *(float *)a5)) + v20.n64_f32[0])
            + v20.n64_f32[1]);
      v20.n64_f32[0] = gCurDistForCam * 5.0;
      v5.n64_f32[0] = v19 * 0.1;
      goto LABEL_9;
    }
    if ( m_vehicleType != 3 )
      goto LABEL_28;
LABEL_18:
    v22 = 0.1;
    camera = Scene.camera;
    goto LABEL_27;
  }
  if ( !pPed )
    goto LABEL_28;
  if ( *(_BYTE *)&pPed->m_nPedFlags << 31 )
  {
    v26 = (CPedModelInfo *)CModelInfo::ms_modelInfoPtrs[pPed->m_nModelIndex];
    FOV = TheCamera.Cams[TheCamera.ActiveCam].FOV;
    v28 = gLastRadiusUsedInCollisionPreventionOfCamera;
    CPedModelInfo::AnimatePedColModelSkinnedWorld(v26, (RpClump_0 *)pPed->m_pRwObject);
    v29 = &TheCamera.Cams[this->ActiveCam];
    v30 = FOV * -0.5;
    x = v29->Front.x;
    y = v29->Front.y;
    z = v29->Front.z;
    v34 = z * v29->Source.z;
    v35 = (float)(x * v29->Source.x) + (float)(y * v29->Source.y);
    v36 = sinf((float)((float)(v30 + 90.0) * 3.1416) / 180.0);
    v5.n64_u32[0] = 1232348144;
    v37 = 0;
    do
    {
      v38 = &v26->m_pHitColModel->m_pColData->m_pSphereArray[v37++];
      m_fRadius = v38->m_fRadius;
      v7.n64_f32[0] = (float)((float)((float)((float)(v38->m_vecCentre.x * x) + (float)(v38->m_vecCentre.y * y))
                                    + (float)(v38->m_vecCentre.z * z))
                            - (float)(v35 + v34))
                    - m_fRadius;
      if ( v38->m_data.m_nPieceType == 9 )
        v7.n64_f32[0] = v7.n64_f32[0] - m_fRadius;
      v5.n64_u64[0] = vmin_f32(v7, v5).n64_u64[0];
    }
    while ( v37 != 12 );
    v15.n64_f32[0] = v28 * v36;
    if ( v5.n64_f32[0] <= (float)(v28 * v36) )
    {
      v6.n64_u32[0] = 1017370378;
      v15.n64_u64[0] = v5.n64_u64[0];
      if ( v5.n64_f32[0] < 0.02 )
        v15.n64_u64[0] = v6.n64_u64[0];
    }
    v6.n64_u32[0] = 1050253722;
    camera = Scene.camera;
    v22 = (float)(int)(float)(vmin_f32(v15, v6).n64_f32[0] * 100.0) / 100.0;
    goto LABEL_27;
  }
  UsingParachute = CPedIntelligence::GetUsingParachute(pPed->m_pPedIntelligence);
  TaskSwim = CPedIntelligence::GetTaskSwim(pPed->m_pPedIntelligence);
  if ( TaskSwim )
  {
    m_nSwimState = (unsigned __int16)TaskSwim->m_nSwimState;
    pWaterZ[0] = 0.0;
    if ( (CWaterLevel::GetWaterLevel(pSource->x, pSource->y, pSource->z, pWaterZ, 0, 0) != 1
       || fabsf(pWaterZ[0] - pSource->z) >= 0.3)
      && (m_nSwimState != 4 || TheCamera.m_nPedZoom != 1) )
    {
      goto LABEL_28;
    }
    goto LABEL_18;
  }
  if ( !UsingParachute && !CPedIntelligence::GetTaskJetPack(pPed->m_pPedIntelligence)
    || (float)(this->Cams[this->ActiveCam].Source.z - CCamera::CalculateGroundHeight(this, 0)) <= 10.0 )
  {
    goto LABEL_28;
  }
  v40.n64_u64[0] = vsub_f32((float32x2_t)p_y->n64_u64[0], (float32x2_t)v10->n64_u64[0]).n64_u64[0];
  v20.n64_u64[0] = vmul_f32(v40, v40).n64_u64[0];
  v41 = (float)((float)((float)(pSource->x - *(float *)a5) * (float)(pSource->x - *(float *)a5)) + v20.n64_f32[0])
      + v20.n64_f32[1];
  camera = Scene.camera;
  v20.n64_f32[0] = gCurDistForCam + gCurDistForCam;
  v5.n64_f32[0] = sqrtf(v41) * 0.3;
LABEL_9:
  v21 = vmin_f32(v5, v20).n64_f32[0];
  if ( v21 > camera->nearPlane )
  {
    v22 = v21;
LABEL_27:
    RwCameraSetNearClipPlane(camera, v22);
  }
LABEL_28:
  pNearest = 1000000.0;
  CCollision::CheckPeds(pSource, &this->Cams[this->ActiveCam].Front, &pNearest);
}
// 3D2BFA: variable 'v5' is possibly undefined
// 3D2D7C: variable 'v7' is possibly undefined
// 3D2DA2: variable 'v6' is possibly undefined
// 3D2AD4: using guessed type float pWaterZ[21];

//----- (003D2EFC) --------------------------------------------------------
void __fastcall CCamera::HandleCameraMotionForDucking(
        CCamera *this,
        CPed *pPed,
        CVector *pSource,
        CVector *pTarget,
        int bIsLookingBehind)
{
  CTaskSimpleDuck *TaskDuck; // r0
  float v10; // s0
  int *v11; // r0
  float *p_m_duckZMod; // r0
  float m_duckZMod; // s2

  CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
  TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
  v10 = 0.0;
  if ( TaskDuck && (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 && !TaskDuck->m_bIsAborting )
  {
    v11 = dword_3D2FCC;
    if ( (float)((float)((float)(pPed->m_vecMoveSpeed.x * pPed->m_vecMoveSpeed.x)
                       + (float)(pPed->m_vecMoveSpeed.y * pPed->m_vecMoveSpeed.y))
               + (float)(pPed->m_vecMoveSpeed.z * pPed->m_vecMoveSpeed.z)) > 0.000001 )
      v11 = &dword_3D2FCC[1];
    v10 = *(float *)v11;
  }
  p_m_duckZMod = &this->m_duckZMod;
  m_duckZMod = this->m_duckZMod;
  if ( !bIsLookingBehind )
  {
    m_duckZMod = m_duckZMod + (float)((float)(v10 - m_duckZMod) * (float)(CTimer::ms_fTimeStep * 0.1));
    *p_m_duckZMod = m_duckZMod;
  }
  if ( pSource )
    pSource->z = m_duckZMod + pSource->z;
  if ( pTarget )
    pTarget->z = *p_m_duckZMod + pTarget->z;
}
// 3D2FCC: using guessed type int dword_3D2FCC[2];

//----- (003D2FDC) --------------------------------------------------------
void __fastcall CCamera::CameraPedModeSpecialCases(CCamera *this, CPed *pPed)
{
  CCollision::bCamCollideWithObjects = 1;
  CCollision::bCamCollideWithVehicles = 1;
  CCollision::bCamCollideWithPeds = 1;
}

//----- (003D3004) --------------------------------------------------------
bool __fastcall CCam::LookLeft(CCam *this)
{
  return CCam::LookRight(this, 0);
}

//----- (003D300A) --------------------------------------------------------
float __fastcall FTrunc(float n, int digits)
{
  float v4; // r0
  float v5; // s0
  float v6; // r0
  float iptr[5]; // [sp+4h] [bp-14h] BYREF

  v4 = powf(10.0, (float)(digits + 1));
  v5 = 5.0;
  if ( n < 0.0 )
    v5 = -5.0;
  modff((float)(v5 + (float)(v4 * n)) / 10.0, iptr);
  v6 = powf(10.0, (float)digits);
  return iptr[0] / v6;
}
// 3D300A: using guessed type float iptr[5];

//----- (003D3094) --------------------------------------------------------
void __fastcall VecTrunc(CVector *pV, int digits)
{
  float v4; // r0
  float v5; // s16
  float v6; // s20
  float v7; // s2
  float v8; // s2
  float v9; // s24
  float y; // s0
  bool v11; // nf
  float v12; // s0
  float v13; // s28
  float z; // s2
  float v15; // s2
  float iptr; // [sp+4h] [bp-54h] BYREF
  float v17; // [sp+8h] [bp-50h] BYREF
  float v18[19]; // [sp+Ch] [bp-4Ch] BYREF

  v4 = powf(10.0, (float)(digits + 1));
  v5 = 5.0;
  v6 = v4;
  v7 = 5.0;
  if ( pV->x < 0.0 )
    v7 = -5.0;
  modff((float)(v7 + (float)(pV->x * v4)) / 10.0, &iptr);
  v8 = 5.0;
  v9 = iptr;
  y = pV->y;
  v11 = y < 0.0;
  v12 = v6 * y;
  if ( v11 )
    v8 = -5.0;
  v13 = powf(10.0, (float)digits);
  pV->x = v9 / v13;
  modff((float)(v12 + v8) / 10.0, &v17);
  z = pV->z;
  v11 = z < 0.0;
  v15 = v6 * z;
  if ( v11 )
    v5 = -5.0;
  pV->y = v17 / v13;
  modff((float)(v15 + v5) / 10.0, v18);
  pV->z = v18[0] / v13;
}
// 3D3094: using guessed type float var_4C[19];

//----- (003D3198) --------------------------------------------------------
void __fastcall CCamera::ResetDuckingSystem(CCamera *this, CPed *pPed)
{
  CTaskSimpleDuck *TaskDuck; // r0
  float *v5; // r2

  this->m_duckZMod = 0.0;
  this->m_duckZMod_Aim = 0.0;
  if ( pPed )
  {
    TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
    if ( TaskDuck )
    {
      if ( (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 && !TaskDuck->m_bIsAborting )
      {
        v5 = (float *)sub_3D321C;
        if ( (float)((float)((float)(pPed->m_vecMoveSpeed.x * pPed->m_vecMoveSpeed.x)
                           + (float)(pPed->m_vecMoveSpeed.y * pPed->m_vecMoveSpeed.y))
                   + (float)(pPed->m_vecMoveSpeed.z * pPed->m_vecMoveSpeed.z)) > 0.000001 )
          v5 = (float *)&loc_3D3220;
        this->m_duckZMod = *v5;
        this->m_duckZMod_Aim = -0.35;
      }
    }
  }
}
// 3D321C: using guessed type int sub_3D321C();

//----- (003D3224) --------------------------------------------------------
void __fastcall CCamera::HandleCameraMotionForDuckingDuringAim(
        CCamera *this,
        CPed *pPed,
        CVector *pSource,
        CVector *pTarget,
        int bIsLookingBehind)
{
  CTaskSimpleDuck *TaskDuck; // r0
  float v10; // s0
  int *v11; // r2
  float *p_m_duckZMod_Aim; // r0
  float m_duckZMod_Aim; // s2

  CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
  TaskDuck = CPedIntelligence::GetTaskDuck(pPed->m_pPedIntelligence, 1);
  v10 = 0.0;
  if ( TaskDuck && (*((_BYTE *)&pPed->m_nPedFlags + 3) & 4) != 0 )
  {
    v11 = &dword_3D32C4;
    if ( !TaskDuck->m_bIsAborting )
      v11 = &dword_3D32C8;
    v10 = *(float *)v11;
  }
  p_m_duckZMod_Aim = &this->m_duckZMod_Aim;
  m_duckZMod_Aim = this->m_duckZMod_Aim;
  if ( !bIsLookingBehind )
  {
    m_duckZMod_Aim = m_duckZMod_Aim + (float)((float)(v10 - m_duckZMod_Aim) * (float)(CTimer::ms_fTimeStep * 0.13));
    *p_m_duckZMod_Aim = m_duckZMod_Aim;
  }
  if ( pSource )
    pSource->z = m_duckZMod_Aim + pSource->z;
  if ( pTarget )
    pTarget->z = *p_m_duckZMod_Aim + pTarget->z;
}
// 3D32C4: using guessed type int dword_3D32C4;
// 3D32C8: using guessed type int;

//----- (003D32D4) --------------------------------------------------------
void __fastcall CCamera::SetColVarsAimWeapon(int32 nAimType)
{
  SCamColVars *v1; // r0

  switch ( nAimType )
  {
    case 0:
      if ( gCurCamColVars )
      {
        gCurCamColVars = 0;
        gCurDistForCam = 1.0;
        gpCamColVars = gCamColVars;
      }
      break;
    case 1:
      if ( gCurCamColVars != 1 )
      {
        gCurCamColVars = 1;
        gCurDistForCam = 1.0;
        v1 = &gCamColVars[1];
        goto LABEL_10;
      }
      break;
    case 2:
      if ( gCurCamColVars != 2 )
      {
        gCurCamColVars = 2;
        gCurDistForCam = 1.0;
        v1 = &gCamColVars[2];
        goto LABEL_10;
      }
      break;
    case 3:
      if ( gCurCamColVars != 3 )
      {
        gCurCamColVars = 3;
        gCurDistForCam = 1.0;
        v1 = &gCamColVars[3];
LABEL_10:
        gpCamColVars = v1;
      }
      break;
    default:
      return;
  }
}

//----- (003D3424) --------------------------------------------------------
void __fastcall CCamera::CameraPedAimModeSpecialCases(CCamera *this, CPed *pPed)
{
  CVehicle *m_pMyVehicle; // r1
  int32 m_numExtrasEntitysToIgnore; // r2

  CCollision::bCamCollideWithObjects = 1;
  CCollision::bCamCollideWithVehicles = 1;
  CCollision::bCamCollideWithPeds = 1;
  if ( *((unsigned __int8 *)&pPed->m_nPedFlags + 1) << 31 )
  {
    m_pMyVehicle = pPed->m_pMyVehicle;
    if ( m_pMyVehicle )
    {
      m_numExtrasEntitysToIgnore = this->m_numExtrasEntitysToIgnore;
      this->m_numExtrasEntitysToIgnore = m_numExtrasEntitysToIgnore + 1;
      this->m_pExtrasEntitysToIgnore[m_numExtrasEntitysToIgnore] = m_pMyVehicle;
    }
  }
}

//----- (003D3480) --------------------------------------------------------
float __fastcall CCamera::Find3rdPersonQuickAimPitch(CCamera *this)
{
  float *v1; // r4
  float v2; // s16
  float v3; // s0
  float v4; // s16

  v1 = (float *)((char *)this + 528 * this->ActiveCam);
  v2 = (float)((float)(0.5 - CCamera::m_f3rdPersonCHairMultY) + (float)(0.5 - CCamera::m_f3rdPersonCHairMultY))
     * (float)(1.0 / CDraw::ms_fAspectRatio);
  v3 = tanf((float)((float)(v1[127] * 0.5) * 3.1416) / 180.0) * v2;
  v4 = v1[125];
  return -(float)(v4 + atanf(v3));
}

//----- (003D351C) --------------------------------------------------------
bool __fastcall CIdleCam::IsItTimeForIdleCam(CIdleCam *this)
{
  return 0;
}

//----- (003D3520) --------------------------------------------------------
void __fastcall CIdleCam::Init(CIdleCam *this)
{
  this->timeControlsIdleForIdleToKickIn = 90000.0;
  this->slerpDuration = 2000.0;
  this->degreeShakeIdleCam = 1.0;
  this->shakeBuildUpTime = 3000.0;
  this->durationFOVZoom = 1000.0;
  this->timeBeforeNewZoomIn = 12000.0;
  this->timeMinimumToLookAtSomething = 5000.0;
  this->increaseMinimumTimeFactorforZoomedIn = 2.0;
  this->lastTimePadTouched = 0;
  this->idleTickerFrames = 0;
  this->lastIdlePos.x = 0.0;
  *(_QWORD *)&this->timeToConsiderNonVisibleEntityAsOccluded = 0x40800000453B8000LL;
  *(_QWORD *)&this->distStartFOVZoom = 0x42A0000041700000LL;
  this->lastIdlePos.y = 0.0;
  this->lastIdlePos.z = 0.0;
  this->timeIdleCamStarted = -1.0;
  this->timeLastTargetSelected = -1.0;
  this->timeTargetEntityWasLastVisible = -1.0;
  this->curFOV = 70.0;
  this->targetLOSFramestoReject = 14;
  this->targetLOSCounter = 0;
  this->zoomState = 3;
  this->zoomFrom = -1.0;
  this->zoomTo = -1.0;
  this->timeZoomStarted = -1.0;
  this->zoomNearest = 15.0;
  this->zoomFarthest = 70.0;
  *(_WORD *)&this->bForceAZoomOut = 0;
  this->timeLastZoomIn = -1.0;
  this->slerpTime = 1.0;
  *(_QWORD *)&this->pTarget = 0LL;
  *(_QWORD *)&this->positionToSlerpFrom.y = 0LL;
  this->timeSlerpStarted = -1.0;
}

//----- (003D35E0) --------------------------------------------------------
bool __fastcall CIdleCam::Process(CIdleCam *this)
{
  int32 lastTimePadTouched; // r5
  CPad *Pad; // r0
  CPad *v5; // r0

  lastTimePadTouched = this->lastTimePadTouched;
  Pad = currentPad;
  if ( !currentPad )
    Pad = CPad::GetPad(0);
  if ( lastTimePadTouched == Pad->LastTimeTouched )
  {
    this->idleTickerFrames += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
    return 0;
  }
  else
  {
    v5 = currentPad;
    if ( !currentPad )
      v5 = CPad::GetPad(0);
    *(_QWORD *)&this->lastTimePadTouched = v5->LastTimeTouched;
    return 0;
  }
}

//----- (003D3668) --------------------------------------------------------
void __fastcall CIdleCam::ProcessIdleCamTicker(CIdleCam *this)
{
  int32 lastTimePadTouched; // r5
  CPad *Pad; // r0
  CPad *v4; // r0

  lastTimePadTouched = this->lastTimePadTouched;
  Pad = currentPad;
  if ( !currentPad )
    Pad = CPad::GetPad(0);
  if ( lastTimePadTouched == Pad->LastTimeTouched )
  {
    this->idleTickerFrames += (unsigned int)(float)((float)(CTimer::ms_fTimeStep / 50.0) * 1000.0);
  }
  else
  {
    v4 = currentPad;
    if ( !currentPad )
      v4 = CPad::GetPad(0);
    *(_QWORD *)&this->lastTimePadTouched = v4->LastTimeTouched;
  }
}

//----- (003D36EC) --------------------------------------------------------
void __fastcall CIdleCam::SetTargetPlayer(CIdleCam *this)
{
  CPlayerPed *PlayerPed; // r0

  PlayerPed = FindPlayerPed(-1);
  CIdleCam::SetTarget(this, PlayerPed);
  this->bForceAZoomOut = 1;
}

//----- (003D370C) --------------------------------------------------------
void __fastcall CIdleCam::Run(CIdleCam *this)
{
  unsigned int v2; // r5
  float timeIdleCamStarted; // s16
  float shakeBuildUpTime; // s18
  float v5; // r0
  float v6; // s4
  float v7; // s0
  float v8; // [sp+0h] [bp-20h] BYREF
  float pAngX[7]; // [sp+4h] [bp-1Ch] BYREF

  v2 = CTimer::m_snTimeInMilliseconds;
  CIdleCam::ProcessTargetSelection(this);
  timeIdleCamStarted = this->timeIdleCamStarted;
  shakeBuildUpTime = this->shakeBuildUpTime;
  v5 = CIdleCam::ProcessSlerp(this, pAngX, &v8);
  this->slerpTime = v5;
  CIdleCam::ProcessFOVZoom(this, v5);
  v6 = 1.0;
  v7 = (float)v2 - timeIdleCamStarted;
  if ( v7 < shakeBuildUpTime )
    v6 = v7 / shakeBuildUpTime;
  CIdleCam::FinaliseIdleCamera(this, pAngX[0], v8, v6);
}
// 3D370C: using guessed type float pAngX[7];
// 3D370C: using guessed type float var_20;

//----- (003D3780) --------------------------------------------------------
bool __fastcall CIdleCam::IsTargetValid(CIdleCam *this, CEntity *pTest)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  __int64 v6; // d16
  int v7; // r0
  float v8; // s0
  float z; // s0
  CCam *pCam; // r1
  float32x2_t v11; // d16
  unsigned __int64 v12; // d1
  float v13; // s0
  bool result; // r0
  CEntity *v15; // r8
  _BOOL4 IsLineOfSightClear; // r0
  __int64 v17; // r0
  CVector vecEnd; // [sp+18h] [bp-20h] BYREF

  if ( !pTest )
    return 0;
  if ( FindPlayerPed(-1) == pTest )
    return 1;
  m_pMat = pTest->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pTest->m_transform;
  v6 = *(_QWORD *)&p_tx->m_translate.x;
  vecEnd.z = p_tx->m_translate.z;
  *(_QWORD *)&vecEnd.x = v6;
  if ( (*(_BYTE *)&pTest->m_info & 7) == 3 )
  {
    v7 = *(_DWORD *)&pTest[23].numLodChildren;
    v8 = 0.5;
    if ( v7 == 5 )
      v8 = 0.1;
    if ( v7 == 22 )
      v8 = 0.1;
    z = vecEnd.z + v8;
    vecEnd.z = z;
  }
  else
  {
    z = vecEnd.z;
  }
  pCam = this->pCam;
  v11.n64_u64[0] = vsub_f32(*(float32x2_t *)&pCam->Source.x, *(float32x2_t *)&vecEnd.x).n64_u64[0];
  v12 = vmul_f32(v11, v11).n64_u64[0];
  v13 = sqrtf(
          (float)(*(float *)&v12 + *((float *)&v12 + 1))
        + (float)((float)(pCam->Source.z - z) * (float)(pCam->Source.z - z)));
  if ( v13 < this->distTooClose || v13 > this->distTooFar )
    return 0;
  result = 1;
  if ( this->slerpTime >= 1.0 )
  {
    v15 = CWorld::pIgnoreEntity;
    CWorld::pIgnoreEntity = pTest;
    IsLineOfSightClear = CWorld::GetIsLineOfSightClear(&pCam->Source, &vecEnd, 1, 0, 0, 1, 0, 0, 1);
    CWorld::pIgnoreEntity = v15;
    if ( IsLineOfSightClear )
      return 1;
    v17 = *(_QWORD *)&this->targetLOSFramestoReject;
    this->targetLOSCounter = HIDWORD(v17) + 1;
    return SHIDWORD(v17) <= (int)v17;
  }
  return result;
}

//----- (003D389C) --------------------------------------------------------
void __fastcall CIdleCam::GetLookAtPositionOnTarget(CIdleCam *this, CEntity *pTest, CVector *pVec)
{
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r3
  __int64 v5; // d16
  int v6; // r0
  float v7; // s0

  m_pMat = pTest->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &pTest->m_transform;
  v5 = *(_QWORD *)&p_tx->m_translate.x;
  pVec->z = p_tx->m_translate.z;
  *(_QWORD *)&pVec->x = v5;
  if ( (*(_BYTE *)&pTest->m_info & 7) == 3 )
  {
    v6 = *(_DWORD *)&pTest[23].numLodChildren;
    v7 = 0.5;
    if ( v6 == 5 )
      v7 = 0.1;
    if ( v6 == 22 )
      v7 = 0.1;
    pVec->z = pVec->z + v7;
  }
}

//----- (003D38F0) --------------------------------------------------------
void __fastcall CIdleCam::ProcessTargetSelection(CIdleCam *this)
{
  CPlayerPed *PlayerPed; // r8
  float v3; // s16
  const TInterestingEvent *InterestingEvent; // r0
  const TInterestingEvent *v5; // r6
  CEntity *m_pEntity; // r5
  CEntity *pTarget; // r9
  _BOOL4 IsTargetValid; // r0
  CPlayerPed *v9; // r0
  CEntity *v10; // r1
  CPlayerPed *v11; // r0
  CPlayerPed *v12; // r0
  int32 targetLOSCounter; // r0
  CPlayerPed *v14; // r0
  CPlayerPed *v15; // r0

  PlayerPed = FindPlayerPed(-1);
  v3 = (float)CTimer::m_snTimeInMilliseconds - this->timeLastTargetSelected;
  if ( this->zoomState != 3 && this->targetLOSCounter <= 0 )
    v3 = v3 / this->increaseMinimumTimeFactorforZoomedIn;
  if ( v3 > this->timeMinimumToLookAtSomething )
  {
    CInterestingEvents::InvalidateNonVisibleEvents(&g_InterestingEvents);
    InterestingEvent = CInterestingEvents::GetInterestingEvent(&g_InterestingEvents);
    v5 = InterestingEvent;
    if ( !InterestingEvent )
    {
      if ( this->pTarget )
      {
        if ( CIdleCam::IsTargetValid(this, this->pTarget) || this->pTarget == PlayerPed )
          goto LABEL_20;
      }
      else if ( !PlayerPed )
      {
        goto LABEL_20;
      }
      if ( this->zoomState == 3 )
      {
        v9 = FindPlayerPed(-1);
        CIdleCam::SetTarget(this, v9);
      }
LABEL_19:
      this->bForceAZoomOut = 1;
      goto LABEL_20;
    }
    m_pEntity = InterestingEvent->m_pEntity;
    pTarget = this->pTarget;
    IsTargetValid = CIdleCam::IsTargetValid(this, m_pEntity);
    if ( pTarget != m_pEntity )
    {
      if ( !IsTargetValid )
        goto LABEL_20;
      if ( this->zoomState == 3 )
      {
        CIdleCam::SetTarget(this, m_pEntity);
        goto LABEL_20;
      }
      goto LABEL_19;
    }
    if ( !IsTargetValid )
      CInterestingEvents::InvalidateEvent(&g_InterestingEvents, v5);
  }
LABEL_20:
  v10 = this->pTarget;
  if ( !this->pTarget )
  {
    this->pTarget = PlayerPed;
    this->bForceAZoomOut = 1;
    v11 = FindPlayerPed(-1);
    CIdleCam::SetTarget(this, v11);
    v10 = this->pTarget;
    this->bForceAZoomOut = 1;
  }
  if ( !CIdleCam::IsTargetValid(this, v10) && v3 > this->timeMinimumToLookAtSomething )
  {
    if ( this->zoomState == 3 )
    {
      v12 = FindPlayerPed(-1);
      CIdleCam::SetTarget(this, v12);
    }
    targetLOSCounter = this->targetLOSCounter;
    this->bForceAZoomOut = 1;
    if ( targetLOSCounter >= 1 )
    {
      v14 = FindPlayerPed(-1);
      CIdleCam::SetTarget(this, v14);
      this->bForceAZoomOut = 1;
    }
  }
  if ( this->targetLOSCounter > this->targetLOSFramestoReject )
  {
    v15 = FindPlayerPed(-1);
    CIdleCam::SetTarget(this, v15);
    this->bForceAZoomOut = 1;
  }
}

//----- (003D3A68) --------------------------------------------------------
void __fastcall CIdleCam::SetTarget(CIdleCam *this, CEntity *pEntity)
{
  float v4; // s16
  CEntity *pTarget; // r0
  __int64 v6; // d16
  CCam *pCam; // r1
  RwReal v8; // s2
  RwReal v9; // s4

  v4 = (float)CTimer::m_snTimeInMilliseconds;
  pTarget = this->pTarget;
  if ( pTarget )
  {
    v6 = *(_QWORD *)&this->lastIdlePos.x;
    this->positionToSlerpFrom.z = this->lastIdlePos.z;
    *(_QWORD *)&this->positionToSlerpFrom.x = v6;
    if ( pEntity )
    {
LABEL_3:
      if ( pTarget )
        CEntity::CleanUpOldReference(pTarget, &this->pTarget);
      this->pTarget = pEntity;
      CEntity::RegisterReference(pEntity, &this->pTarget);
      goto LABEL_9;
    }
  }
  else
  {
    pCam = this->pCam;
    v8 = pCam->Source.y + pCam->Front.y;
    v9 = pCam->Source.z + pCam->Front.z;
    this->positionToSlerpFrom.x = pCam->Source.x + pCam->Front.x;
    this->positionToSlerpFrom.y = v8;
    this->positionToSlerpFrom.z = v9;
    if ( pEntity )
      goto LABEL_3;
  }
  if ( pTarget )
  {
    CEntity::CleanUpOldReference(pTarget, &this->pTarget);
    this->pTarget = 0;
  }
LABEL_9:
  this->timeLastTargetSelected = v4;
  this->timeSlerpStarted = v4;
  this->targetLOSCounter = 0;
  this->bHasZoomedIn = 0;
}

//----- (003D3B08) --------------------------------------------------------
float __fastcall CIdleCam::ProcessSlerp(CIdleCam *this, float *pAngX, float *pAngZ)
{
  float32x2_t v3; // d1
  CEntity *pTarget; // r0
  CMatrix *m_pMat; // r2
  float *p_tx; // r3
  float32x2_t v10; // d8
  float x; // s20
  float y; // s22
  float z; // s18
  int v14; // r0
  float v15; // s0
  CCam *pCam; // r0
  float v17; // s26
  float v18; // s28
  float v19; // s30
  float v20; // s19
  float v21; // s24
  float v22; // s2
  float ATanOfXY; // s20
  float v24; // r10
  float v25; // s18
  float v26; // r4
  float v27; // r0
  float v28; // s22
  float v29; // s20
  float v30; // s24
  float v31; // s2
  float v32; // s2
  float v33; // s4
  float v34; // s26
  float v35; // s0
  float result; // r0
  float v37; // s0

  pTarget = this->pTarget;
  m_pMat = pTarget->m_pMat;
  p_tx = &m_pMat->tx;
  v10.n64_f32[0] = (float)CTimer::m_snTimeInMilliseconds;
  if ( !m_pMat )
    p_tx = &pTarget->m_transform.m_translate.x;
  x = *p_tx;
  y = p_tx[1];
  z = p_tx[2];
  if ( (*(_BYTE *)&pTarget->m_info & 7) == 3 )
  {
    v14 = *(_DWORD *)&pTarget[23].numLodChildren;
    v15 = 0.5;
    if ( v14 == 5 )
      v15 = 0.1;
    if ( v14 == 22 )
      v15 = 0.1;
    z = z + v15;
  }
  if ( this->targetLOSCounter >= this->targetLOSFramestoReject )
  {
    x = this->lastIdlePos.x;
    y = this->lastIdlePos.y;
    z = this->lastIdlePos.z;
  }
  pCam = this->pCam;
  v17 = pCam->Source.x;
  v18 = pCam->Source.y;
  v10.n64_f32[1] = this->positionToSlerpFrom.x - v17;
  v19 = pCam->Source.z;
  v20 = this->positionToSlerpFrom.y - v18;
  v21 = this->positionToSlerpFrom.z;
  v22 = x - v17;
  ATanOfXY = CGeneral::GetATanOfXY(v10.n64_f32[1], v20);
  v24 = z - v19;
  v25 = CGeneral::GetATanOfXY(sqrtf((float)(v10.n64_f32[1] * v10.n64_f32[1]) + (float)(v20 * v20)), v21 - v19);
  v26 = CGeneral::GetATanOfXY(v22, y - v18);
  v27 = CGeneral::GetATanOfXY(sqrtf((float)(v22 * v22) + (float)((float)(y - v18) * (float)(y - v18))), v24);
  v28 = v27;
  v29 = ATanOfXY + 3.1416;
  v30 = v26 + 3.1416;
  if ( (float)(v27 - v25) <= 3.1416 )
  {
    if ( (float)(v27 - v25) >= -3.1416 )
      goto LABEL_16;
    v31 = 6.2832;
  }
  else
  {
    v31 = -6.2832;
  }
  v28 = v27 + v31;
LABEL_16:
  if ( (float)(v30 - v29) > 3.1416 )
  {
    v32 = -6.2832;
LABEL_20:
    v30 = v30 + v32;
    goto LABEL_21;
  }
  if ( (float)(v30 - v29) < -3.1416 )
  {
    v32 = 6.2832;
    goto LABEL_20;
  }
LABEL_21:
  v33 = v10.n64_f32[0] - this->timeLastTargetSelected;
  v10.n64_u32[0] = 1.0;
  v3.n64_f32[0] = v33 / this->slerpDuration;
  v34 = vmin_f32(v3, v10).n64_f32[0];
  v35 = sinf((float)((float)(270.0 - (float)(v34 * 180.0)) * 3.1416) / 180.0) + 1.0;
  result = v34;
  v37 = v35 * 0.5;
  *pAngX = v25 + (float)((float)(v28 - v25) * v37);
  *pAngZ = v29 + (float)((float)(v30 - v29) * v37);
  return result;
}
// 3D3C9C: variable 'v3' is possibly undefined

//----- (003D3D1C) --------------------------------------------------------
void __fastcall CIdleCam::ProcessFOVZoom(CIdleCam *this, float t)
{
  float v3; // s16
  CEntity *pTarget; // r0
  float zoomNearest; // s18
  CMatrix *m_pMat; // r1
  float *p_tx; // r3
  int v9; // r2
  float v10; // s4
  int v11; // r1
  float v12; // s8
  CCam *pCam; // r1
  float x; // s8
  float y; // s10
  float z; // s12
  int v17; // r1
  float v18; // s2
  _BOOL4 v19; // r2
  int v20; // r1
  int32 zoomState; // r5
  __int64 v22; // r0
  int v23; // r0
  CEntity *v24; // r6
  CEntity *v25; // r0
  CMatrix *v26; // r1
  CSimpleTransform *p_m_transform; // r2
  __int64 v28; // d16
  int v29; // r0
  float v30; // s0
  __int64 v31; // r0
  __int64 v32; // r0
  float v33; // s0
  float zoomFarthest; // r0
  float zoomFrom; // s18
  float zoomTo; // s22
  CVector vecEnd; // [sp+18h] [bp-40h] BYREF

  v3 = (float)CTimer::m_snTimeInMilliseconds;
  pTarget = this->pTarget;
  zoomNearest = this->zoomNearest;
  if ( pTarget )
  {
    m_pMat = pTarget->m_pMat;
    p_tx = &m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pTarget->m_transform.m_translate.x;
    v9 = *(_BYTE *)&pTarget->m_info & 7;
    v10 = p_tx[2];
    if ( v9 == 3 )
    {
      v11 = *(_DWORD *)&pTarget[23].numLodChildren;
      v12 = 0.5;
      if ( v11 == 5 )
        v12 = 0.1;
      if ( v11 == 22 )
        v12 = 0.1;
      v10 = v10 + v12;
    }
    pCam = this->pCam;
    x = pCam->Source.x;
    y = pCam->Source.y;
    z = pCam->Source.z;
    v17 = 0;
    v18 = sqrtf(
            (float)((float)((float)(x - *p_tx) * (float)(x - *p_tx))
                  + (float)((float)(y - p_tx[1]) * (float)(y - p_tx[1])))
          + (float)((float)(z - v10) * (float)(z - v10)));
    if ( v9 == 3 )
    {
      v19 = *(_DWORD *)&pTarget[23].numLodChildren == 22 || *(_DWORD *)&pTarget[23].numLodChildren == 5;
      if ( v19 )
        zoomNearest = zoomNearest * 0.5;
      if ( v18 < 8.0 && v19 )
      {
        v19 = 1;
        this->bForceAZoomOut = 1;
      }
    }
    else
    {
      v19 = 0;
    }
    if ( v18 > this->distStartFOVZoom )
      v17 = 1;
    v20 = v17 | v19;
  }
  else
  {
    v20 = 0;
  }
  zoomState = this->zoomState;
  if ( t < 1.0 )
    goto LABEL_23;
  if ( v20 != 1 )
  {
    if ( zoomState == 2 )
    {
      v31 = *(_QWORD *)&this->zoomFarthest;
      zoomState = 1;
      this->timeZoomStarted = v3;
      this->zoomState = 1;
      this->zoomFrom = *((float *)&v31 + 1);
      LODWORD(this->zoomTo) = v31;
    }
    goto LABEL_53;
  }
  if ( (float)(v3 - this->timeLastZoomIn) <= this->timeBeforeNewZoomIn )
  {
LABEL_23:
    HIDWORD(v22) = this->zoomState;
    goto LABEL_24;
  }
  if ( pTarget )
  {
    v24 = CWorld::pIgnoreEntity;
    CWorld::pIgnoreEntity = pTarget;
    v25 = this->pTarget;
    v26 = this->pTarget->m_pMat;
    p_m_transform = (CSimpleTransform *)&v26->tx;
    if ( !v26 )
      p_m_transform = &v25->m_transform;
    v28 = *(_QWORD *)&p_m_transform->m_translate.x;
    vecEnd.z = p_m_transform->m_translate.z;
    *(_QWORD *)&vecEnd.x = v28;
    if ( (*(_BYTE *)&v25->m_info & 7) == 3 )
    {
      v29 = *(_DWORD *)&v25[23].numLodChildren;
      v30 = 0.5;
      if ( v29 == 5 )
        v30 = 0.1;
      if ( v29 == 22 )
        v30 = 0.1;
      vecEnd.z = vecEnd.z + v30;
    }
    LODWORD(v22) = !CWorld::GetIsLineOfSightClear(&this->pCam->Source, &vecEnd, 1, 0, 0, 1, 0, 0, 1);
    CWorld::pIgnoreEntity = v24;
    HIDWORD(v22) = this->zoomState;
  }
  else
  {
    LODWORD(v22) = 0;
    HIDWORD(v22) = this->zoomState;
  }
  if ( this->targetLOSCounter >= 11 && HIDWORD(v22) == 2 )
  {
    zoomState = 1;
    this->zoomState = 1;
LABEL_53:
    v23 = 1;
    goto LABEL_54;
  }
  if ( HIDWORD(v22) == 3 )
  {
    HIDWORD(v22) = this->bHasZoomedIn;
    if ( this->bHasZoomedIn )
      HIDWORD(v22) = 1;
    if ( v22 )
    {
      zoomState = 3;
    }
    else
    {
      this->zoomTo = zoomNearest;
      this->zoomState = 0;
      if ( zoomState )
      {
        this->timeZoomStarted = v3;
        this->zoomFrom = this->curFOV;
      }
      zoomState = 0;
    }
    goto LABEL_53;
  }
LABEL_24:
  if ( HIDWORD(v22) == 2 )
  {
    zoomState = 2;
    v23 = 0;
    this->timeLastZoomIn = v3;
  }
  else
  {
    LODWORD(v22) = 1;
    zoomState = HIDWORD(v22);
  }
LABEL_54:
  if ( !this->bForceAZoomOut || v23 )
  {
    this->bForceAZoomOut = 0;
    switch ( zoomState )
    {
      case 0:
        if ( fabsf(this->curFOV - zoomNearest) >= 1.0 )
          goto LABEL_62;
        this->curFOV = zoomNearest;
        this->zoomState = 2;
        zoomFarthest = zoomNearest;
        this->bHasZoomedIn = 1;
        break;
      case 1:
        goto LABEL_57;
      case 2:
        zoomFarthest = zoomNearest;
        this->curFOV = zoomNearest;
        break;
      case 3:
        zoomFarthest = this->zoomFarthest;
        this->curFOV = zoomFarthest;
        break;
      default:
        zoomFarthest = this->curFOV;
        break;
    }
  }
  else
  {
    v32 = *(_QWORD *)&this->zoomFarthest;
    this->timeZoomStarted = v3;
    this->bForceAZoomOut = 0;
    this->zoomState = 1;
    this->zoomFrom = *((float *)&v32 + 1);
    LODWORD(this->zoomTo) = v32;
LABEL_57:
    v33 = this->zoomFarthest;
    if ( fabsf(this->curFOV - v33) >= 1.0 )
    {
LABEL_62:
      zoomFrom = this->zoomFrom;
      zoomTo = this->zoomTo;
      zoomFarthest = zoomFrom
                   + (float)((float)((float)(sinf(
                                               (float)((float)(270.0
                                                             - (float)((float)((float)(v3 - this->timeZoomStarted)
                                                                             / this->durationFOVZoom)
                                                                     * 180.0))
                                                     * 3.1416)
                                             / 180.0)
                                           + 1.0)
                                   * 0.5)
                           * (float)(zoomTo - zoomFrom));
      this->curFOV = zoomFarthest;
    }
    else
    {
      this->curFOV = v33;
      zoomFarthest = v33;
      this->zoomState = 3;
    }
  }
  this->pCam->FOV = zoomFarthest;
}
// 3D3F48: conditional instruction was optimized away because r5.4!=2

//----- (003D4074) --------------------------------------------------------
void __fastcall CIdleCam::FinaliseIdleCamera(CIdleCam *this, float curAngleX, float curAngleZ, float shakeDegree)
{
  float v8; // r9
  float v9; // r10
  float v10; // s0
  float v11; // r0
  CCam *pCam; // r1
  CCam *v13; // r0
  RwReal v14; // s2
  float v15; // r1
  RwReal v16; // s4
  float degreeShakeIdleCam; // s18
  float z; // s20
  CCam *v19; // r0
  __int64 v20; // d16
  CCam *v21; // r6
  CCam *v22; // r0
  __int64 v23; // d16
  CCam *v24; // r0
  CCam *v25; // r0
  __int64 v26; // d16
  CCam *v27; // r0
  CCam *v28; // r0
  CCam *v29; // r0
  __int64 v30; // d16
  CVector v31; // [sp+0h] [bp-60h] BYREF
  CVector v32; // [sp+10h] [bp-50h] BYREF
  CVector v33; // [sp+20h] [bp-40h] BYREF

  v8 = cosf(curAngleZ);
  v9 = cosf(curAngleX);
  v10 = sinf(curAngleZ);
  v11 = sinf(curAngleX);
  pCam = this->pCam;
  pCam->Front.z = v11;
  pCam->Front.x = -(float)(v8 * v9);
  pCam->Front.y = -(float)(v9 * v10);
  CVector::Normalise(&this->pCam->Front);
  v13 = this->pCam;
  v14 = v13->Source.y + v13->Front.y;
  v15 = this->degreeShakeIdleCam * shakeDegree;
  v16 = v13->Source.z + v13->Front.z;
  this->lastIdlePos.x = v13->Source.x + v13->Front.x;
  this->lastIdlePos.y = v14;
  this->lastIdlePos.z = v16;
  CHandShaker::Process(gHandShaker, v15);
  degreeShakeIdleCam = this->degreeShakeIdleCam;
  z = gHandShaker[0].ang.z;
  Multiply3x3(&v33, &this->pCam->Front, &gHandShaker[0].resultMat);
  v19 = this->pCam;
  v20 = *(_QWORD *)&v33.x;
  v19->Front.z = v33.z;
  *(_QWORD *)&v19->Front.x = v20;
  v21 = this->pCam;
  v21->Up.y = 0.0;
  v21->Up.z = cosf((float)(z * degreeShakeIdleCam) * shakeDegree);
  v21->Up.x = sinf((float)(z * degreeShakeIdleCam) * shakeDegree);
  CrossProduct(&v32, &this->pCam->Front, &this->pCam->Up);
  CVector::Normalise(&v32);
  CrossProduct(&v31, &v32, &this->pCam->Front);
  v22 = this->pCam;
  v23 = *(_QWORD *)&v31.x;
  v22->Up.z = v31.z;
  *(_QWORD *)&v22->Up.x = v23;
  v24 = this->pCam;
  if ( v24->Front.x == 0.0 && v24->Front.y == 0.0 )
  {
    v24->Front.x = 0.0001;
    this->pCam->Front.y = 0.0001;
    v24 = this->pCam;
  }
  CrossProduct(&v31, &v24->Front, &v24->Up);
  v32 = v31;
  CVector::Normalise(&v32);
  CrossProduct(&v31, &v32, &this->pCam->Front);
  v25 = this->pCam;
  v26 = *(_QWORD *)&v31.x;
  v25->Up.z = v31.z;
  *(_QWORD *)&v25->Up.x = v26;
  v27 = this->pCam;
  v27->Up.x = 0.0;
  v27->Up.y = 0.0;
  v27->Up.z = 1.0;
  CVector::Normalise(&this->pCam->Front);
  v28 = this->pCam;
  if ( v28->Front.x == 0.0 && v28->Front.y == 0.0 )
  {
    v28->Front.x = 0.0001;
    this->pCam->Front.y = 0.0001;
    v28 = this->pCam;
  }
  CrossProduct(&v31, &v28->Front, &v28->Up);
  v32 = v31;
  CVector::Normalise(&v32);
  CrossProduct(&v31, &v32, &this->pCam->Front);
  v29 = this->pCam;
  v30 = *(_QWORD *)&v31.x;
  v29->Up.z = v31.z;
  *(_QWORD *)&v29->Up.x = v30;
}

//----- (003D42E4) --------------------------------------------------------
void __fastcall CHandShaker::Process(CHandShaker *this, float degree)
{
  float y; // s4
  float z; // s0
  float scaleReactionMin; // s2
  float v7; // s8
  float v8; // s6
  float v9; // s10
  float v10; // s16
  float v11; // s6
  float v12; // s18
  float v13; // s22
  float x; // s24
  int v15; // r0
  float v16; // s26
  float v17; // s28
  int v18; // r0
  float v19; // s30
  float v20; // s6
  float v21; // s8
  float v22; // s10
  float v23; // s2
  RwReal v24; // s0
  float v25; // s16
  float v26; // s18
  float twitchVel; // s18
  int v28; // r0
  float v29; // s22
  float v30; // s24
  int v31; // r0
  float v32; // s26
  float v33; // s28
  int v34; // r0
  float v35; // s0
  float v36; // s2
  float v37; // s4
  float v38; // s6
  float v39; // s0
  float v40; // s2
  float v41; // s4
  float v42; // s6
  float v43; // s8

  y = this->ang.y;
  z = this->ang.z;
  scaleReactionMin = this->scaleReactionMin;
  v7 = fabsf(z / this->lim.z);
  v8 = this->scaleReactionMax - scaleReactionMin;
  v9 = v8 * fabsf(y / this->lim.y);
  v10 = scaleReactionMin + (float)(fabsf(this->ang.x / this->lim.x) * v8);
  if ( this->ang.x > 0.0 && this->vel.x > 0.0 || this->ang.x < 0.0 && this->vel.x < 0.0 )
    v10 = v10 * this->slow.x;
  v11 = v8 * v7;
  v12 = scaleReactionMin + v9;
  if ( y > 0.0 && this->vel.y > 0.0 || y < 0.0 && this->vel.y < 0.0 )
    v12 = v12 * this->slow.y;
  v13 = scaleReactionMin + v11;
  if ( z > 0.0 && this->vel.z > 0.0 || z < 0.0 && this->vel.z < 0.0 )
    v13 = v13 * this->slow.z;
  x = this->motion.x;
  v15 = rand();
  v16 = this->motion.y;
  v17 = (float)v15;
  v18 = rand();
  v19 = this->motion.z;
  v20 = v10 * (float)((float)(x * (float)(v17 * 4.6566e-10)) + 0.0);
  v21 = v12 * (float)((float)(v16 * (float)((float)v18 * 4.6566e-10)) + 0.0);
  v22 = v13 * (float)((float)(v19 * (float)((float)rand() * 4.6566e-10)) + 0.0);
  if ( this->ang.x > 0.0 )
    v20 = -v20;
  if ( this->ang.y > 0.0 )
    v21 = -v21;
  if ( this->ang.z > 0.0 )
    v22 = -v22;
  v23 = this->vel.z;
  v24 = v21 + this->vel.y;
  this->vel.x = v20 + this->vel.x;
  this->vel.y = v24;
  this->vel.z = v22 + v23;
  v25 = (float)(unsigned int)(float)((float)(CTimer::ms_fTimeStepNonClipped / 50.0) * 1000.0) / 33.333;
  v26 = v25 * (float)this->twitchFreq;
  if ( (int)(float)((float)((float)(unsigned __int16)rand() * 0.000015259) * (float)((int)v26 - 1)) == 1 )
  {
    twitchVel = this->twitchVel;
    v28 = rand();
    v29 = this->twitchVel;
    v30 = (float)v28;
    v31 = rand();
    v32 = this->twitchVel;
    v33 = (float)v31;
    v34 = rand();
    v35 = (float)((float)((float)(twitchVel + twitchVel) * (float)(v30 * 4.6566e-10)) - twitchVel) + this->vel.x;
    v36 = (float)((float)((float)(v29 + v29) * (float)(v33 * 4.6566e-10)) - v29) + this->vel.y;
    v37 = (float)((float)((float)(v32 + v32) * (float)((float)v34 * 4.6566e-10)) - v32) + this->vel.z;
    this->vel.x = v35;
    this->vel.y = v36;
    this->vel.z = v37;
  }
  else
  {
    v35 = this->vel.x;
    v36 = this->vel.y;
    v37 = this->vel.z;
  }
  v38 = this->lim.x;
  v39 = (float)(v25 * v35) + this->ang.x;
  v40 = (float)(v25 * v36) + this->ang.y;
  v41 = (float)(v25 * v37) + this->ang.z;
  this->ang.x = v39;
  this->ang.y = v40;
  this->ang.z = v41;
  if ( v39 > v38 || (v38 = -v38, v39 < v38) )
  {
    v39 = v38;
    this->ang.x = v38;
  }
  v42 = this->lim.y;
  if ( v40 > v42 || (v42 = -v42, v40 < v42) )
  {
    v40 = v42;
    this->ang.y = v42;
  }
  v43 = this->lim.z;
  if ( v41 > v43 || (v43 = -v43, v41 < v43) )
  {
    v41 = v43;
    this->ang.z = v43;
  }
  sub_18AA14(&this->resultMat, v39 * degree, v40 * degree, v41 * degree);
}

//----- (003D46A0) --------------------------------------------------------
void __fastcall CIdleCam::VectorToAnglesRotXRotZ(CIdleCam *this, CVector *pV, float *pA, float *pB)
{
  *pB = CGeneral::GetATanOfXY(pV->x, pV->y) + 3.1416;
  *pA = CGeneral::GetATanOfXY(sqrtf((float)(pV->x * pV->x) + (float)(pV->y * pV->y)), pV->z);
}

//----- (003D46F4) --------------------------------------------------------
Bool8 __fastcall CCamera::GetFading(CCamera *this)
{
  return this->m_bFading;
}

//----- (003D46FA) --------------------------------------------------------
int __fastcall CCamera::GetFadingDirection(CCamera *this)
{
  int result; // r0

  if ( !this->m_bFading )
    return 2;
  result = (unsigned __int16)this->m_iFadingDirection;
  if ( result != 1 )
    return 0;
  return result;
}

//----- (003D4714) --------------------------------------------------------
void __fastcall CCamera::SetColVarsPed(int32 nType, int32 nPedZoom)
{
  int v2; // r0

  if ( nType == 1 )
  {
    v2 = nPedZoom + 6;
    if ( nPedZoom + 6 == gCurCamColVars )
      return;
    goto LABEL_6;
  }
  if ( !nType )
  {
    v2 = nPedZoom + 3;
    if ( nPedZoom + 3 != gCurCamColVars )
    {
LABEL_6:
      gCurCamColVars = v2;
      gCurDistForCam = 1.0;
      gpCamColVars = &gCamColVars[v2];
    }
  }
}

//----- (003D47A8) --------------------------------------------------------
void __fastcall CCamera::InitCameraVehicleTweaks(CCamera *this)
{
  _BOOL4 m_bInitedVehicleCamTweaks; // r2

  m_bInitedVehicleCamTweaks = this->m_bInitedVehicleCamTweaks;
  this->m_VehicleTweakLenMod = 1.0;
  this->m_VehicleTweakTargetZMod = 1.0;
  this->m_VehicleTweakPitchMod = 0.0;
  this->m_VehicleTweakLastModelId = -1;
  if ( !m_bInitedVehicleCamTweaks )
  {
    this->m_VehicleTweaks[2].m_ModelId = -1;
    this->m_VehicleTweaks[2].m_LenMod = 1.0;
    this->m_VehicleTweaks[2].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[2].m_PitchMod = 0.0;
    this->m_VehicleTweaks[3].m_ModelId = -1;
    this->m_VehicleTweaks[3].m_LenMod = 1.0;
    this->m_VehicleTweaks[3].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[3].m_PitchMod = 0.0;
    this->m_VehicleTweaks[4].m_ModelId = -1;
    this->m_VehicleTweaks[4].m_LenMod = 1.0;
    this->m_VehicleTweaks[4].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[4].m_PitchMod = 0.0;
    this->m_VehicleTweaks[0].m_ModelId = 501;
    this->m_VehicleTweaks[0].m_LenMod = 1.0;
    this->m_VehicleTweaks[0].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[0].m_PitchMod = 0.179;
    this->m_VehicleTweaks[1].m_ModelId = -1;
    this->m_VehicleTweaks[1].m_LenMod = 1.0;
    this->m_VehicleTweaks[1].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[1].m_PitchMod = 0.0;
    this->m_bInitedVehicleCamTweaks = 1;
  }
}

//----- (003D483A) --------------------------------------------------------
void __fastcall CCamera::ApplyVehicleCameraTweaks(CCamera *this, CVehicle *pVehicle)
{
  _BOOL4 m_bInitedVehicleCamTweaks; // r2
  int m_ModelId; // r2
  CCamera::CVehicleCamTweak *m_VehicleTweaks; // r3
  float m_LenMod; // r1

  if ( this->m_VehicleTweakLastModelId == pVehicle->m_nModelIndex )
    return;
  m_bInitedVehicleCamTweaks = this->m_bInitedVehicleCamTweaks;
  this->m_VehicleTweakLenMod = 1.0;
  this->m_VehicleTweakTargetZMod = 1.0;
  this->m_VehicleTweakPitchMod = 0.0;
  this->m_VehicleTweakLastModelId = -1;
  if ( !m_bInitedVehicleCamTweaks )
  {
    m_ModelId = 501;
    this->m_VehicleTweaks[2].m_ModelId = -1;
    this->m_VehicleTweaks[2].m_LenMod = 1.0;
    this->m_VehicleTweaks[2].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[2].m_PitchMod = 0.0;
    this->m_VehicleTweaks[3].m_ModelId = -1;
    this->m_VehicleTweaks[3].m_LenMod = 1.0;
    this->m_VehicleTweaks[3].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[3].m_PitchMod = 0.0;
    this->m_VehicleTweaks[4].m_ModelId = -1;
    this->m_VehicleTweaks[4].m_LenMod = 1.0;
    this->m_VehicleTweaks[4].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[4].m_PitchMod = 0.0;
    this->m_VehicleTweaks[0].m_ModelId = 501;
    this->m_VehicleTweaks[0].m_LenMod = 1.0;
    this->m_VehicleTweaks[0].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[0].m_PitchMod = 0.179;
    this->m_VehicleTweaks[1].m_ModelId = -1;
    this->m_VehicleTweaks[1].m_LenMod = 1.0;
    this->m_VehicleTweaks[1].m_TargetZMod = 1.0;
    this->m_VehicleTweaks[1].m_PitchMod = 0.0;
    this->m_bInitedVehicleCamTweaks = 1;
LABEL_6:
    m_VehicleTweaks = this->m_VehicleTweaks;
    if ( m_ModelId == pVehicle->m_nModelIndex )
    {
LABEL_19:
      m_LenMod = m_VehicleTweaks->m_LenMod;
      this->m_VehicleTweakLastModelId = m_ModelId;
      this->m_VehicleTweakLenMod = m_LenMod;
      this->m_VehicleTweakTargetZMod = m_VehicleTweaks->m_TargetZMod;
      this->m_VehicleTweakPitchMod = m_VehicleTweaks->m_PitchMod;
      return;
    }
    goto LABEL_7;
  }
  m_ModelId = this->m_VehicleTweaks[0].m_ModelId;
  if ( m_ModelId >= 0 )
    goto LABEL_6;
LABEL_7:
  m_ModelId = this->m_VehicleTweaks[1].m_ModelId;
  if ( m_ModelId >= 0 && m_ModelId == pVehicle->m_nModelIndex )
  {
    m_VehicleTweaks = &this->m_VehicleTweaks[1];
    goto LABEL_19;
  }
  m_ModelId = this->m_VehicleTweaks[2].m_ModelId;
  if ( m_ModelId >= 0 && m_ModelId == pVehicle->m_nModelIndex )
  {
    m_VehicleTweaks = &this->m_VehicleTweaks[2];
    goto LABEL_19;
  }
  m_ModelId = this->m_VehicleTweaks[3].m_ModelId;
  if ( m_ModelId >= 0 && m_ModelId == pVehicle->m_nModelIndex )
  {
    m_VehicleTweaks = &this->m_VehicleTweaks[3];
    goto LABEL_19;
  }
  m_ModelId = this->m_VehicleTweaks[4].m_ModelId;
  if ( m_ModelId >= 0 && m_ModelId == pVehicle->m_nModelIndex )
  {
    m_VehicleTweaks = &this->m_VehicleTweaks[4];
    goto LABEL_19;
  }
}

//----- (003D4958) --------------------------------------------------------
bool __fastcall CCamera::GetArrPosForVehicleType(CCamera *this, int eTypeOfVehicle, int *ArrPosResult)
{
  if ( (unsigned int)(eTypeOfVehicle - 1) > 4 )
    return 0;
  *ArrPosResult = dword_616840[eTypeOfVehicle - 1];
  return 1;
}
// 616840: using guessed type _DWORD dword_616840[5];

//----- (003D4974) --------------------------------------------------------
void __fastcall CCamera::SetColVarsVehicle(int32 nType, int32 nCarZoom)
{
  int v2; // r0

  switch ( nType )
  {
    case 0:
    case 4:
      v2 = nCarZoom + 9;
      if ( nCarZoom + 9 != gCurCamColVars )
        goto LABEL_13;
      break;
    case 1:
      v2 = nCarZoom + 12;
      if ( nCarZoom + 12 != gCurCamColVars )
        goto LABEL_13;
      break;
    case 2:
      v2 = nCarZoom + 15;
      if ( nCarZoom + 15 != gCurCamColVars )
        goto LABEL_13;
      break;
    case 3:
      v2 = nCarZoom + 18;
      if ( nCarZoom + 18 != gCurCamColVars )
        goto LABEL_13;
      break;
    case 5:
      v2 = nCarZoom + 21;
      if ( nCarZoom + 21 != gCurCamColVars )
        goto LABEL_13;
      break;
    case 6:
      v2 = nCarZoom + 24;
      if ( nCarZoom + 24 != gCurCamColVars )
      {
LABEL_13:
        gCurCamColVars = v2;
        gCurDistForCam = 1.0;
        gpCamColVars = &gCamColVars[v2];
      }
      break;
    default:
      return;
  }
}

//----- (003D4AF8) --------------------------------------------------------
void __fastcall CCamera::SetMotionBlur(CCamera *this, int Red, int Green, int Blue, int blur, int Type)
{
  this->m_BlurBlue = Blue;
  this->m_BlurGreen = Green;
  this->m_BlurRed = Red;
  this->m_BlurType = Type;
  this->m_motionBlur = blur;
}

//----- (003D4B0E) --------------------------------------------------------
bool __fastcall CCamera::ConeCastCollisionResolve(
        CCamera *this,
        CVector *pPos,
        CVector *pLookAt,
        CVector *pDest,
        float rad,
        float minDist,
        float *pDist)
{
  _BOOL4 result; // r0
  RwReal v11; // s2
  RwReal v12; // s4
  __int64 v13; // d16
  CColSphere v14; // [sp+8h] [bp-50h] BYREF
  CColSphere v15; // [sp+1Ch] [bp-3Ch] BYREF

  if ( pPos->x == pLookAt->x && pPos->y == pLookAt->y && pPos->z == pLookAt->z )
    return 0;
  CColSphere::Set(&v15, rad, pLookAt, 0, 0, 0xFFu);
  CColSphere::Set(&v14, rad, pPos, 0, 0, 0xFFu);
  result = CCollision::CameraConeCastVsWorldCollision(&v15, &v14, pDist, minDist);
  if ( result )
  {
    v11 = pLookAt->y + (float)((float)(pPos->y - pLookAt->y) * *pDist);
    v12 = pLookAt->z + (float)((float)(pPos->z - pLookAt->z) * *pDist);
    pDest->x = pLookAt->x + (float)((float)(pPos->x - pLookAt->x) * *pDist);
    pDest->y = v11;
    pDest->z = v12;
  }
  else
  {
    v13 = *(_QWORD *)&pPos->x;
    pDest->z = pPos->z;
    *(_QWORD *)&pDest->x = v13;
    *pDist = 1.0;
  }
  return result;
}

//----- (003D4C20) --------------------------------------------------------
bool __fastcall CCam::ProcessDWBustedCam1(CCam *this, CPed *pHandyCopPointer, bool bIsFirstTime)
{
  _BOOL4 v3; // r8
  bool v6; // r4
  bool v7; // zf
  float v8; // s2
  float v9; // s16
  bool v10; // r2
  char v11; // r0
  char v12; // r0
  double v13; // d16
  CMatrix *m_pMat; // r1
  CSimpleTransform *p_tx; // r2
  __int64 v16; // d16
  RpHAnimHierarchy_0 *AnimHierarchyFromSkinClump; // r4
  RwMatrix *MatrixArray; // r6
  RwReal v19; // s2
  RwReal v20; // s4
  RwReal v21; // s6
  RwReal v22; // s10
  RwReal v23; // s0
  __int64 v24; // d16
  CVector *p_Source; // r5
  double v26; // d16
  CVector v28; // [sp+18h] [bp-58h] BYREF
  CVector v29; // [sp+24h] [bp-4Ch] BYREF
  CVector vecEnd; // [sp+30h] [bp-40h] BYREF
  double v31; // [sp+40h] [bp-30h]
  RwReal z; // [sp+48h] [bp-28h]

  v3 = bIsFirstTime;
  if ( bIsFirstTime && (float)((float)((float)rand() * 4.6566e-10) + 0.0) > 0.65 )
    return 0;
  v6 = 0;
  if ( (*(_BYTE *)&TheCamera.pTargetEntity->m_info & 7) == 3 )
  {
    v7 = pHandyCopPointer == 0;
    if ( pHandyCopPointer )
      v7 = TheCamera.pTargetEntity == 0;
    if ( !v7 )
    {
      v8 = (float)((float)CTimer::m_snTimeInMilliseconds - gTimeDWBustedCamStarted) / 1000.0;
      v9 = 1.0;
      if ( v8 <= 1.0 )
      {
        v9 = (float)((float)CTimer::m_snTimeInMilliseconds - gTimeDWBustedCamStarted) / 1000.0;
        if ( v8 < 0.0 )
          v9 = 0.0;
      }
      v10 = !CCam::ProcessDWBustedCam1(CPed *,bool)::bKickOffBustedText;
      if ( v9 < 1.0 )
        v10 = 1;
      CCam::ProcessDWBustedCam1(CPed *,bool)::bKickOffBustedText = v10;
      v11 = `guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetLookAt2;
      __dmb(0xBu);
      if ( (v11 & 1) == 0
        && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetLookAt2) )
      {
        CCam::ProcessDWBustedCam1(CPed *,bool)::offsetLookAt2.x = 0.0;
        CCam::ProcessDWBustedCam1(CPed *,bool)::offsetLookAt2.y = 0.0;
        CCam::ProcessDWBustedCam1(CPed *,bool)::offsetLookAt2.z = 0.0;
        _cxa_guard_release((__guard *)&`guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetLookAt2);
      }
      v12 = `guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2;
      __dmb(0xBu);
      if ( (v12 & 1) == 0
        && _cxa_guard_acquire((__guard *)&`guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2) )
      {
        CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2.x = 0.0;
        CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2.y = 0.0;
        CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2.z = -0.5;
        _cxa_guard_release((__guard *)&`guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2);
      }
      v13 = *(double *)&this->Source.x;
      z = this->Source.z;
      v31 = v13;
      m_pMat = TheCamera.pTargetEntity->m_pMat;
      p_tx = (CSimpleTransform *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &TheCamera.pTargetEntity->m_transform;
      v16 = *(_QWORD *)&p_tx->m_translate.x;
      this->Source.z = p_tx->m_translate.z;
      *(_QWORD *)&this->Source.x = v16;
      this->FOV = 100.0;
      AnimHierarchyFromSkinClump = GetAnimHierarchyFromSkinClump((RpClump_0 *)pHandyCopPointer->m_pRwObject);
      MatrixArray = RpHAnimHierarchyGetMatrixArray(AnimHierarchyFromSkinClump);
      vecEnd = (CVector)MatrixArray[RpHAnimIDGetIndex(AnimHierarchyFromSkinClump, 5)].pos;
      vecEnd.z = (float)(vecEnd.z + -0.06) + (float)(v9 * -0.5);
      v19 = CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2.x + this->Source.x;
      v20 = CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2.y + this->Source.y;
      v21 = CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2.z + this->Source.z;
      v22 = vecEnd.y - v20;
      v23 = vecEnd.z - v21;
      this->Front.x = vecEnd.x - v19;
      this->Front.y = v22;
      this->Front.z = v23;
      this->Source.x = v19;
      this->Source.y = v20;
      this->Source.z = v21;
      CVector::Normalise(&this->Front);
      v6 = 0;
      this->Up.x = 0.0;
      this->Up.y = 0.0;
      this->Up.z = 1.0;
      CrossProduct(&v29, &this->Front, &this->Up);
      CVector::Normalise(&v29);
      CrossProduct(&v28, &v29, &this->Front);
      v24 = *(_QWORD *)&v28.x;
      this->Up.z = v28.z;
      *(_QWORD *)&this->Up.x = v24;
      p_Source = &this->Source;
      if ( v3 )
      {
        if ( !CWorld::GetIsLineOfSightClear(p_Source, &vecEnd, 1, 1, 0, 1, 0, 0, 1) )
          return v6;
      }
      else if ( !CWorld::GetIsLineOfSightClear(p_Source, &vecEnd, 1, 0, 0, 1, 0, 0, 0) )
      {
        v26 = v31;
        p_Source->z = z;
        *(double *)&p_Source->x = v26;
      }
      v6 = 1;
      *(_DWORD *)&TheCamera.pTargetEntity->m_nFlags &= ~0x80u;
    }
  }
  return v6;
}
// 952E80: using guessed type char `guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetLookAt2;
// 952E90: using guessed type char `guard variable for'CCam::ProcessDWBustedCam1(CPed *,bool)::offsetPosAt2;

//----- (003D4F24) --------------------------------------------------------
int __fastcall CCam::GetLookOverShoulderPos(
        CCam *this,
        CEntity *pTargetEntity,
        CPed *pCopPed,
        CVector *vecTarget,
        CVector *vecSource)
{
  bool v5; // zf
  int result; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float x; // s18
  float y; // s20
  RwReal v12; // s0
  float z; // s16
  RwReal v14; // s4
  float v15; // s22
  float v16; // s24
  float v17; // s26
  float v18; // s28
  float v19; // s16
  float v20; // s20
  float v21; // s18
  float v22; // s4
  float v23; // s4
  float v24; // s2
  float v25; // s0
  float v26; // s8
  float v27; // s10
  float v28; // s6
  float v29; // s12
  float v30; // s12
  CVector v2; // [sp+4h] [bp-6Ch] BYREF
  CVector v32; // [sp+10h] [bp-60h] BYREF
  CVector v1; // [sp+1Ch] [bp-54h] BYREF

  v5 = pTargetEntity == 0;
  result = 0;
  if ( pTargetEntity )
    v5 = pCopPed == 0;
  if ( !v5 )
  {
    m_pMat = pCopPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pCopPed->m_transform;
    x = p_tx->m_translate.x;
    y = p_tx->m_translate.y;
    v12 = vecTarget->x - p_tx->m_translate.x;
    z = p_tx->m_translate.z;
    v14 = vecTarget->z - z;
    v1.y = vecTarget->y - y;
    v1.x = v12;
    v1.z = v14;
    v2.x = 0.0;
    v2.y = 0.0;
    v2.z = 1.0;
    CrossProduct(&v32, &v1, &v2);
    CVector::Normalise(&v32);
    v15 = v32.x;
    v16 = v32.y;
    v17 = v32.z;
    v18 = ARRESTDIST_RIGHTOF_COP;
    CVector::Normalise(&v1);
    v19 = z + (float)(v18 * v17);
    v20 = y + (float)(v18 * v16);
    v21 = x + (float)(v18 * v15);
    if ( v1.z >= -0.7071 )
    {
      if ( v1.z <= 0.0 )
      {
LABEL_12:
        v23 = vecTarget->y;
        v24 = vecTarget->z;
        v25 = vecTarget->x;
        v1.x = vecTarget->x - (float)(v21 - (float)(ARRESTDIST_BEHIND_COP * v1.x));
        v27 = v1.x;
        v1.y = v23 - (float)(v20 - (float)(ARRESTDIST_BEHIND_COP * v1.y));
        v26 = v1.y;
        v1.z = v24 - (float)(v19 - (float)(ARRESTDIST_BEHIND_COP * v1.z));
        v28 = v1.z;
        v29 = sqrtf((float)((float)(v27 * v27) + (float)(v26 * v26)) + (float)(v28 * v28));
        if ( v29 < ARRESTDIST_MINFROM_PLAYER && v29 > 0.0 )
        {
          v30 = ARRESTDIST_MINFROM_PLAYER / v29;
          v26 = v30 * v1.y;
          v27 = v1.x * v30;
          v28 = v30 * v1.z;
          v1.y = v30 * v1.y;
          v1.x = v1.x * v30;
          v1.z = v30 * v1.z;
        }
        vecSource->x = v25 - v27;
        vecSource->y = v23 - v26;
        vecSource->z = v24 - v28;
        return 1;
      }
      v1.z = 0.0;
    }
    else
    {
      v1.z = -0.7071;
      v22 = sqrtf((float)(v1.x * v1.x) + (float)(v1.y * v1.y)) / 0.7071;
      if ( v22 > 0.0 )
      {
        v1.y = v1.y / v22;
        v1.x = v1.x / v22;
      }
    }
    CVector::Normalise(&v1);
    goto LABEL_12;
  }
  return result;
}

//----- (003D5120) --------------------------------------------------------
int __fastcall CCam::GetLookAlongGroundPos(
        CCam *this,
        CEntity *pTargetEntity,
        CPed *pCopPed,
        CVector *vecTarget,
        float *a5)
{
  bool v5; // zf
  int result; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_tx; // r1
  float y; // s2
  float v11; // s6
  RwReal v12; // s0
  float v13; // s2
  float v14; // s4
  float v15; // s16
  float v16; // s0
  float v17; // s2
  float v18; // s4
  float v19; // r2
  float GroundZFor3DCoord; // r0
  CVector v2; // [sp+4h] [bp-3Ch] BYREF
  CVector v22; // [sp+10h] [bp-30h] BYREF
  CVector v23; // [sp+1Ch] [bp-24h] BYREF

  v5 = pTargetEntity == 0;
  result = 0;
  if ( pTargetEntity )
    v5 = pCopPed == 0;
  if ( !v5 )
  {
    m_pMat = pCopPed->m_pMat;
    p_tx = (CSimpleTransform *)&m_pMat->tx;
    if ( !m_pMat )
      p_tx = &pCopPed->m_transform;
    y = p_tx->m_translate.y;
    v11 = vecTarget->y;
    v12 = vecTarget->x - p_tx->m_translate.x;
    v23.z = 0.0;
    v23.y = v11 - y;
    v23.x = v12;
    CVector::Normalise(&v23);
    v13 = (float)(ARRESTDIST_ALONG_GROUND * v23.y) + vecTarget->y;
    v14 = (float)(ARRESTDIST_ALONG_GROUND * v23.z) + vecTarget->z;
    *a5 = (float)(ARRESTDIST_ALONG_GROUND * v23.x) + vecTarget->x;
    a5[1] = v13;
    a5[2] = v14;
    v15 = ARRESTDIST_SIDE_GROUND;
    v2.x = 0.0;
    v2.y = 0.0;
    v2.z = 1.0;
    CrossProduct(&v22, &v23, &v2);
    v16 = (float)(v15 * v22.x) + *a5;
    v17 = (float)(v15 * v22.y) + a5[1];
    v18 = (float)(v15 * v22.z) + a5[2];
    *a5 = v16;
    a5[1] = v17;
    a5[2] = v18;
    v19 = vecTarget->z + 5.0;
    a5[2] = v19;
    LOBYTE(v22.x) = 0;
    GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(v16, v17, v19, (bool *)&v22, 0);
    if ( LOBYTE(v22.x) )
      a5[2] = GroundZFor3DCoord + ARRESTDIST_ABOVE_GROUND;
    return 1;
  }
  return result;
}

//----- (003D5278) --------------------------------------------------------
bool __fastcall CCam::GetLookFromLampPostPos(
        CCam *this,
        CEntity *pTargetEntity,
        CPed *pCopPed,
        CVector *vecTarget,
        CVector *vecSource)
{
  float v6; // s20
  int v7; // r11
  CEntity *v8; // r6
  CEntity *v9; // r5
  CMatrix *m_pMat; // r0
  CEntity *v11; // r5
  CMatrix *v12; // r0
  float32x2_t *p_tx; // r1
  float32x2_t v14; // d16
  unsigned __int64 v15; // d0
  float v16; // s22
  CColModel *ColModel; // r0
  __int64 v18; // d16
  CEntity *v19; // r5
  const CMatrix *v20; // r1
  RwReal v21; // s2
  RwReal v22; // s4
  float y; // s8
  float z; // s10
  __int64 v25; // d16
  float v26; // s0
  CVector v28; // [sp+28h] [bp-B0h] BYREF
  CVector v; // [sp+38h] [bp-A0h] BYREF
  CVector v30; // [sp+48h] [bp-90h] BYREF
  Int16 pNum; // [sp+56h] [bp-82h] BYREF
  CEntity *v32[32]; // [sp+58h] [bp-80h] BYREF

  CWorld::FindObjectsInRange(vecTarget, 30.0, 1, &pNum, 15, v32, 0, 0, 0, 1, 1);
  if ( pNum < 1 )
  {
    v8 = 0;
  }
  else
  {
    v6 = 10000.0;
    LOWORD(v7) = 0;
    v8 = 0;
    do
    {
      v9 = v32[(__int16)v7];
      if ( (*(_DWORD *)&v9->m_nFlags & 0x40004) != 0 )
      {
        m_pMat = v9->m_pMat;
        if ( !m_pMat )
        {
          CPlaceable::AllocateMatrix(v32[(__int16)v7]);
          CSimpleTransform::UpdateMatrix(&v9->m_transform, v9->m_pMat);
          m_pMat = v9->m_pMat;
        }
        if ( m_pMat->zz > 0.9 )
        {
          v11 = v32[(__int16)v7];
          if ( bIsLampPost(v11->m_nModelIndex) )
          {
            v12 = v11->m_pMat;
            p_tx = (float32x2_t *)&v12->tx;
            if ( !v12 )
              p_tx = (float32x2_t *)&v11->m_transform;
            v14.n64_u64[0] = vsub_f32((float32x2_t)p_tx->n64_u64[0], *(float32x2_t *)&vecTarget->x).n64_u64[0];
            v15 = vmul_f32(v14, v14).n64_u64[0];
            v16 = sqrtf(*(float *)&v15 + *((float *)&v15 + 1));
            if ( v16 > 5.0 && fabsf(ARRESTCAM_LAMP_BEST_DIST - v16) < v6 )
            {
              ColModel = CEntity::GetColModel(v11);
              v18 = *(_QWORD *)&ColModel->m_boxBound.m_vecMax.x;
              v19 = v32[(__int16)v7];
              v.z = ColModel->m_boxBound.m_vecMax.z;
              *(_QWORD *)&v.x = v18;
              v20 = v19->m_pMat;
              if ( !v20 )
              {
                CPlaceable::AllocateMatrix(v19);
                CSimpleTransform::UpdateMatrix(&v19->m_transform, v19->m_pMat);
                v20 = v19->m_pMat;
              }
              operator*(&v28, v20, &v);
              v = v28;
              v21 = v28.y - vecTarget->y;
              v22 = v28.z - vecTarget->z;
              v30.x = v28.x - vecTarget->x;
              v30.y = v21;
              v30.z = v22;
              CVector::Normalise(&v30);
              y = vecTarget->y;
              z = vecTarget->z;
              v30.x = vecTarget->x + v30.x;
              v30.y = y + v30.y;
              v30.z = z + v30.z;
              if ( CWorld::GetIsLineOfSightClear(&v, &v30, 1, 0, 0, 0, 0, 1, 1) )
              {
                v8 = v32[(__int16)v7];
                v25 = *(_QWORD *)&v.x;
                v26 = ARRESTCAM_LAMP_BEST_DIST - v16;
                vecSource->z = v.z;
                *(_QWORD *)&vecSource->x = v25;
                v6 = fabsf(v26);
              }
            }
          }
        }
      }
      v7 = (__int16)(v7 + 1);
    }
    while ( v7 < pNum );
  }
  return v8 != 0;
}

//----- (003D5494) --------------------------------------------------------
void __fastcall CCamera::AvoidTheGeometry(
        CCamera *this,
        const CVector *TheCamPos,
        const CVector *TheTargetPos,
        CVector *ResultantCameraPos,
        float fFOV)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d8
  char v10; // r4
  float yy; // s0
  int v12; // r0
  float z; // s4
  float xy; // s2
  float v15; // s10
  int v16; // r1
  float v17; // s18
  RwReal *p_y; // r5
  float v20; // s6
  float v21; // s20
  float v22; // s16
  float ATanOfXY; // r11
  float v24; // s18
  float v25; // r5
  float v26; // r4
  float v27; // s0
  RwReal v28; // s2
  RwReal v29; // s0
  __int64 v30; // d16
  float x; // s16
  float y; // s18
  float v33; // s20
  float v34; // s4
  float v35; // s2
  float nearPlane; // s6
  __int64 v37; // d16
  RwReal *v38; // r5
  float v39; // s18
  float v40; // s20
  float32x2_t v41; // d12
  float32x2_t v42; // d11
  float32x2_t v43; // d16
  float v44; // r0
  float v45; // s8
  float v46; // s22
  float v47; // s24
  float v48; // s20
  float v49; // s18
  float v50; // s0
  RwReal *p_z; // r10
  CVector *p_m_vecClearGeometryVec; // r4
  RwCamera_0 *camera; // r0
  float v54; // r1
  float v55; // s18
  float v56; // s20
  float v57; // s22
  float v58; // s24
  float v59; // s4
  float v60; // s0
  float v61; // s1
  float v62; // s6
  CEntity *pTargetEntity; // r6
  float *p_xx; // r0
  float v65; // s0
  float v66; // s0
  CEntity *v67; // r6
  float *v68; // r0
  float m_fAvoidTheGeometryProbsTimer; // s0
  CEntity *v70; // r0
  CMatrix *m_pMat; // r1
  float v72; // s4
  float *p_tx; // r2
  float v74; // s10
  RwReal v75; // s0
  int16 v76; // r0
  float v77; // s2
  float v78; // s8
  float v79; // s10
  float v80; // s8
  float v81; // s4
  RwReal v82; // s4
  RwReal v83; // s0
  RwReal *v84; // [sp+2Ch] [bp-BCh]
  CVector v1; // [sp+30h] [bp-B8h] BYREF
  CVector v86; // [sp+3Ch] [bp-ACh] BYREF
  CVector v2; // [sp+48h] [bp-A0h] BYREF
  CVector v88; // [sp+58h] [bp-90h] BYREF
  CEntity *refEntityPtr; // [sp+64h] [bp-84h] BYREF
  CColPoint colPoint; // [sp+68h] [bp-80h] BYREF
  CVector v91; // [sp+94h] [bp-54h] BYREF
  CVector v92; // 0:r0.12

  v10 = 0;
  yy = TheTargetPos->y - TheCamPos->y;
  v12 = 0;
  z = TheCamPos->z;
  xy = TheTargetPos->x - TheCamPos->x;
  v15 = TheTargetPos->z;
  this->m_vecClearGeometryVec.x = 0.0;
  v16 = 0;
  this->m_vecClearGeometryVec.y = 0.0;
  v17 = v15 - z;
  this->m_vecClearGeometryVec.z = 0.0;
  p_y = &TheTargetPos->y;
  v20 = (float)(xy * xy) + (float)(yy * yy);
  v21 = sqrtf(v20);
  if ( yy == 0.0 )
    v12 = 1;
  v22 = sqrtf(v20 + (float)(v17 * v17));
  if ( xy == 0.0 )
    v16 = 1;
  if ( (v16 & v12) != 0 )
  {
    yy = this->m_cameraMatrix.yy;
    xy = this->m_cameraMatrix.xy;
  }
  ATanOfXY = CGeneral::GetATanOfXY(xy, yy);
  if ( v17 == 0.0 )
    v10 = 1;
  v84 = p_y;
  if ( ((unsigned __int8)v10 & (v21 == 0.0)) != 0 )
    v24 = 0.0;
  else
    v24 = CGeneral::GetATanOfXY(v21, v15 - z);
  v25 = cosf(ATanOfXY);
  v26 = cosf(v24);
  v27 = sinf(ATanOfXY);
  v91.z = sinf(v24);
  v91.y = v26 * v27;
  v91.x = v25 * v26;
  v28 = TheTargetPos->y - (float)(v22 * (float)(v26 * v27));
  v29 = TheTargetPos->z - (float)(v22 * v91.z);
  ResultantCameraPos->x = TheTargetPos->x - (float)(v22 * (float)(v25 * v26));
  ResultantCameraPos->y = v28;
  ResultantCameraPos->z = v29;
  CVector::Normalise(&v91);
  refEntityPtr = 0;
  CWorld::pIgnoreEntity = this->pTargetEntity;
  if ( CWorld::ProcessLineOfSight(TheTargetPos, ResultantCameraPos, &colPoint, &refEntityPtr, 1, 0, 0, 1, 0, 0, 1, 0) == 1 )
  {
    v30 = *(_QWORD *)&colPoint.m_vecPosition.x;
    x = colPoint.m_vecPosition.x;
    y = colPoint.m_vecPosition.y;
    v33 = colPoint.m_vecPosition.z;
    ResultantCameraPos->z = colPoint.m_vecPosition.z;
    *(_QWORD *)&ResultantCameraPos->x = v30;
    if ( bAvoidTest1
      && CWorld::ProcessLineOfSight(ResultantCameraPos, TheTargetPos, &colPoint, &refEntityPtr, 0, 1, 1, 1, 0, 0, 1, 0) == 1 )
    {
      v34 = ResultantCameraPos->y;
      v35 = ResultantCameraPos->z;
      nearPlane = Scene.camera->nearPlane;
      if ( sqrtf(
             (float)((float)((float)(ResultantCameraPos->x - colPoint.m_vecPosition.x)
                           * (float)(ResultantCameraPos->x - colPoint.m_vecPosition.x))
                   + (float)((float)(v34 - colPoint.m_vecPosition.y) * (float)(v34 - colPoint.m_vecPosition.y)))
           + (float)((float)(v35 - colPoint.m_vecPosition.z) * (float)(v35 - colPoint.m_vecPosition.z))) >= nearPlane )
      {
        if ( sqrtf(
               (float)((float)((float)(ResultantCameraPos->x - x) * (float)(ResultantCameraPos->x - x))
                     + (float)((float)(v34 - y) * (float)(v34 - y)))
             + (float)((float)(v35 - v33) * (float)(v35 - v33))) < nearPlane )
        {
          ResultantCameraPos->x = x;
          ResultantCameraPos->y = y;
          ResultantCameraPos->z = v33;
        }
      }
      else
      {
        v37 = *(_QWORD *)&colPoint.m_vecPosition.x;
        ResultantCameraPos->z = colPoint.m_vecPosition.z;
        *(_QWORD *)&ResultantCameraPos->x = v37;
      }
    }
  }
  v38 = &this->m_vecClearGeometryVec.y;
  CWorld::pIgnoreEntity = 0;
  v39 = ResultantCameraPos->x;
  v40 = TheTargetPos->x;
  v41.n64_u64[0] = *(unsigned __int64 *)v84;
  v42.n64_u64[0] = *(unsigned __int64 *)&ResultantCameraPos->y;
  if ( FindPlayerPed(-1) )
  {
    v43.n64_u64[0] = vsub_f32(v41, v42).n64_u64[0];
    v6.n64_u64[0] = vmul_f32(v43, v43).n64_u64[0];
    v5.n64_f32[0] = sqrtf((float)((float)((float)(v40 - v39) * (float)(v40 - v39)) + v6.n64_f32[0]) + v6.n64_f32[1])
                  - fRangePlayerRadius;
    if ( v5.n64_f32[0] < Scene.camera->nearPlane )
    {
      v6.n64_f32[0] = fCloseNearClipLimit;
      RwCameraSetNearClipPlane(Scene.camera, vmax_f32(v5, v6).n64_f32[0]);
    }
  }
  v44 = tanf((float)((float)(fFOV * 3.1416) / 180.0) * 0.5);
  v45 = Scene.camera->nearPlane;
  v46 = (float)(v45 * v91.y) + ResultantCameraPos->y;
  v47 = (float)(v45 * v91.z) + ResultantCameraPos->z;
  v48 = (float)(v45 * v91.x) + ResultantCameraPos->x;
  v49 = v45 * (float)(v44 * (float)(fAvoidTweakFOV * CDraw::ms_fAspectRatio));
  v92.y = v46;
  v92.z = v47;
  v92.x = v48;
  if ( !CWorld::TestSphereAgainstWorld(v92, v49, 0, 1, 0, 0, 1, 0, 1) )
  {
    v55 = 0.0;
    p_z = &this->m_vecClearGeometryVec.z;
    p_m_vecClearGeometryVec = &this->m_vecClearGeometryVec;
    goto LABEL_56;
  }
  v88.x = gaTempSphereColPoints[0].m_vecPosition.x - v48;
  v88.y = gaTempSphereColPoints[0].m_vecPosition.y - v46;
  v88.z = gaTempSphereColPoints[0].m_vecPosition.z - v47;
  v50 = (float)((float)((float)(gaTempSphereColPoints[0].m_vecPosition.x - ResultantCameraPos->x) * v91.x)
              + (float)((float)(gaTempSphereColPoints[0].m_vecPosition.y - ResultantCameraPos->y) * v91.y))
      + (float)((float)(gaTempSphereColPoints[0].m_vecPosition.z - ResultantCameraPos->z) * v91.z);
  if ( v50 <= fCloseNearClipLimit || v50 >= 0.9 )
  {
    p_z = &this->m_vecClearGeometryVec.z;
    p_m_vecClearGeometryVec = &this->m_vecClearGeometryVec;
    if ( v50 >= fCloseNearClipLimit )
      goto LABEL_31;
    v54 = fCloseNearClipLimit;
    camera = Scene.camera;
  }
  else
  {
    p_z = &this->m_vecClearGeometryVec.z;
    p_m_vecClearGeometryVec = &this->m_vecClearGeometryVec;
    camera = Scene.camera;
    if ( v50 >= Scene.camera->nearPlane )
      goto LABEL_31;
    v54 = (float)((float)((float)(gaTempSphereColPoints[0].m_vecPosition.x - ResultantCameraPos->x) * v91.x)
                + (float)((float)(gaTempSphereColPoints[0].m_vecPosition.y - ResultantCameraPos->y) * v91.y))
        + (float)((float)(gaTempSphereColPoints[0].m_vecPosition.z - ResultantCameraPos->z) * v91.z);
  }
  RwCameraSetNearClipPlane(camera, v54);
LABEL_31:
  v56 = v88.x;
  v57 = v88.y;
  v58 = v88.z;
  CVector::Normalise(&v88);
  v2 = gaTempSphereColPoints[0].m_vecNormal;
  CVector::Normalise(&v2);
  v59 = v2.z;
  v6.n64_u32[0] = LODWORD(v2.y);
  v6.n64_f32[1] = v88.z * v2.z;
  v60 = v2.x;
  v61 = v49 - sqrtf((float)((float)(v56 * v56) + (float)(v57 * v57)) + (float)(v58 * v58));
  if ( (float)((float)((float)-(float)(v88.y * v2.y) - (float)(v88.x * v2.x)) - (float)(v88.z * v2.z)) < 0.0 )
  {
    v6.n64_f32[0] = -v2.y;
    v60 = -v2.x;
    v59 = -v2.z;
    v2.y = -v2.y;
    v2.x = -v2.x;
    v2.z = -v2.z;
  }
  v62 = (float)((float)-(float)((float)(v61 * v88.y) * v6.n64_f32[0]) - (float)((float)(v61 * v88.x) * v60))
      - (float)((float)(v61 * v88.z) * v59);
  p_m_vecClearGeometryVec->x = v60 * v62;
  *v38 = v6.n64_f32[0] * v62;
  *p_z = v59 * v62;
  pTargetEntity = this->pTargetEntity;
  if ( !pTargetEntity
    || (*(_BYTE *)&pTargetEntity->m_info & 7) != 3
    || Scene.camera->nearPlane >= (float)(fCloseNearClipLimit + fCloseNearClipLimit) )
  {
    goto LABEL_55;
  }
  p_xx = &pTargetEntity->m_pMat->xx;
  if ( !p_xx )
  {
    CPlaceable::AllocateMatrix(this->pTargetEntity);
    CSimpleTransform::UpdateMatrix(&pTargetEntity->m_transform, pTargetEntity->m_pMat);
    p_xx = &pTargetEntity->m_pMat->xx;
    v60 = v2.x;
    v6.n64_u32[0] = LODWORD(v2.y);
    v59 = v2.z;
  }
  if ( (float)((float)((float)(v60 * p_xx[4]) + (float)(v6.n64_f32[0] * p_xx[5])) + (float)(v59 * p_xx[6])) >= 0.0 )
  {
    v67 = this->pTargetEntity;
    v68 = &v67->m_pMat->xx;
    if ( !v68 )
    {
      CPlaceable::AllocateMatrix(this->pTargetEntity);
      CSimpleTransform::UpdateMatrix(&v67->m_transform, v67->m_pMat);
      v68 = &v67->m_pMat->xx;
      v60 = v2.x;
      v6.n64_u32[0] = LODWORD(v2.y);
      v59 = v2.z;
    }
    if ( (float)((float)((float)(v60 * v68[4]) + (float)(v6.n64_f32[0] * v68[5])) + (float)(v59 * v68[6])) <= 0.5 )
      goto LABEL_49;
    m_fAvoidTheGeometryProbsTimer = this->m_fAvoidTheGeometryProbsTimer;
    if ( m_fAvoidTheGeometryProbsTimer > 0.0 )
    {
      m_fAvoidTheGeometryProbsTimer = 0.0;
      this->m_fAvoidTheGeometryProbsTimer = 0.0;
    }
    v66 = m_fAvoidTheGeometryProbsTimer - CTimer::ms_fTimeStep;
  }
  else
  {
    v65 = this->m_fAvoidTheGeometryProbsTimer;
    if ( v65 < 0.0 )
    {
      v65 = 0.0;
      this->m_fAvoidTheGeometryProbsTimer = 0.0;
    }
    v66 = CTimer::ms_fTimeStep + v65;
  }
  this->m_fAvoidTheGeometryProbsTimer = v66;
LABEL_49:
  if ( !this->m_nAvoidTheGeometryProbsDirn )
  {
    v70 = this->pTargetEntity;
    m_pMat = v70->m_pMat;
    v72 = ResultantCameraPos->z;
    p_tx = &m_pMat->tx;
    if ( !m_pMat )
      p_tx = &v70->m_transform.m_translate.x;
    v74 = p_tx[2];
    v75 = *p_tx - ResultantCameraPos->x;
    v1.y = p_tx[1] - ResultantCameraPos->y;
    v1.x = v75;
    v1.z = v74 - v72;
    CrossProduct(&v86, &v1, &v2);
    v76 = 1;
    if ( v86.z > 0.0 )
      v76 = -1;
    this->m_nAvoidTheGeometryProbsDirn = v76;
  }
LABEL_55:
  v55 = 1.0;
LABEL_56:
  v7.n64_f32[0] = CTimer::ms_fTimeStep;
  this->m_fAvoidTheGeometryProbsTimer = powf(fAvoidProbTimerDamp, CTimer::ms_fTimeStep)
                                      * this->m_fAvoidTheGeometryProbsTimer;
  v77 = (float)(v55 - AvoidTheWallsFraction) * 0.2;
  v78 = fabsf(v77 - AvoidTheWallsFractionSpeed) * 0.05;
  v79 = -(float)(v7.n64_f32[0] * v78);
  v80 = v7.n64_f32[0] * v78;
  if ( (float)(v77 - AvoidTheWallsFractionSpeed) > 0.0 )
    v79 = v80;
  v81 = AvoidTheWallsFractionSpeed + v79;
  AvoidTheWallsFractionSpeed = AvoidTheWallsFractionSpeed + v79;
  if ( v77 < 0.0 || v77 > 0.0 )
  {
    v81 = (float)(v55 - AvoidTheWallsFraction) * 0.2;
    AvoidTheWallsFractionSpeed = v81;
  }
  v6.n64_u32[0] = 10.0;
  AvoidTheWallsFraction = AvoidTheWallsFraction + (float)(v81 * vmin_f32(v7, v6).n64_f32[0]);
  v82 = *v38 * AvoidTheWallsFraction;
  v83 = AvoidTheWallsFraction * *p_z;
  p_m_vecClearGeometryVec->x = p_m_vecClearGeometryVec->x * AvoidTheWallsFraction;
  *v38 = v82;
  *p_z = v83;
  this->m_bMoveCamToAvoidGeom = 1;
}
// 3D5796: variable 'v5' is possibly undefined
// 3D5C4C: variable 'v7' is possibly undefined
// 3D5C4C: variable 'v6' is possibly undefined

//----- (003D5D04) --------------------------------------------------------
void __fastcall CCam::Process_Cam_TwoPlayer_CalcSource(
        CCam *this,
        float Beta,
        CVector *pSource,
        CVector *pLookAt,
        CVector *pTarget)
{
  float v9; // r0
  float Alpha; // r4
  float v11; // r10
  float v12; // r5
  RwReal v13; // s16
  CMatrix *m_pMat; // r2
  CMatrix *v15; // r3
  CSimpleTransform *p_tx; // r6
  CSimpleTransform *p_m_transform; // r1
  float z; // s16
  float v19; // s22
  float v20; // s18
  float v21; // s20
  CMatrix *v22; // r2
  CMatrix *v23; // r3
  CSimpleTransform *v24; // r6
  CSimpleTransform *v25; // r0
  float v26; // s0
  RwReal v27; // s8
  RwReal v28; // s6
  RwReal v29; // s0
  float v30; // s2
  float v31; // s10
  RwReal v32; // s0
  CVector v33; // [sp+0h] [bp-50h] BYREF
  CVector v34; // [sp+Ch] [bp-44h] BYREF

  v9 = cosf(Beta);
  Alpha = this->Alpha;
  v11 = v9;
  v12 = cosf(Alpha);
  v13 = -(float)(v12 * sinf(Beta));
  pLookAt->z = sinf(Alpha);
  pLookAt->x = -(float)(v11 * v12);
  pLookAt->y = v13;
  v34.y = v13;
  v34.x = -(float)(v11 * v12);
  v34.z = 0.0;
  CVector::Normalise(&v34);
  m_pMat = CWorld::Players[1].pPed->m_pMat;
  v15 = CWorld::Players[0].pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &CWorld::Players[1].pPed->m_transform;
  p_m_transform = (CSimpleTransform *)&v15->tx;
  z = p_tx->m_translate.z;
  if ( !v15 )
    p_m_transform = &CWorld::Players[0].pPed->m_transform;
  v19 = p_m_transform->m_translate.x - p_tx->m_translate.x;
  v20 = p_m_transform->m_translate.z;
  v21 = p_m_transform->m_translate.y - p_tx->m_translate.y;
  v33.z = 0.0;
  v33.y = v21;
  v33.x = v19;
  CVector::Normalise(&v33);
  v22 = CWorld::Players[0].pPed->m_pMat;
  v23 = CWorld::Players[1].pPed->m_pMat;
  v24 = (CSimpleTransform *)&v22->tx;
  if ( !v22 )
    v24 = &CWorld::Players[0].pPed->m_transform;
  v25 = (CSimpleTransform *)&v23->tx;
  v26 = (float)((float)((float)((float)(v33.x * v34.x) + (float)(v33.y * v34.y)) + (float)(v33.z * v34.z)) * -0.25)
      + 0.5;
  if ( !v23 )
    v25 = &CWorld::Players[1].pPed->m_transform;
  v27 = (float)(v24->m_translate.y * v26) + (float)((float)(1.0 - v26) * v25->m_translate.y);
  v28 = (float)(v24->m_translate.x * v26) + (float)((float)(1.0 - v26) * v25->m_translate.x);
  v29 = (float)(v26 * v24->m_translate.z) + (float)((float)(1.0 - v26) * v25->m_translate.z);
  v30 = (float)(sqrtf((float)((float)(v19 * v19) + (float)(v21 * v21)) + (float)((float)(v20 - z) * (float)(v20 - z)))
              * 0.67)
      + 7.0;
  pTarget->x = v28;
  pTarget->y = v27;
  pTarget->z = v29;
  v31 = v30 * pLookAt->y;
  v32 = (float)(v30 * 0.1) + (float)(v29 - (float)(v30 * pLookAt->z));
  pSource->x = v28 - (float)(v30 * pLookAt->x);
  pSource->y = v27 - v31;
  pSource->z = v32;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003D5EEC) --------------------------------------------------------
int __fastcall CCam::Process_Cam_TwoPlayer_TestLOSs(CCam *this, CVector TempSource)
{
  int v2; // r4
  CMatrix *m_pMat; // r2
  CSimpleTransform *p_tx; // r1
  CMatrix *v5; // r2
  CSimpleTransform *p_m_transform; // r1
  CEntity *refEntityPtr; // [sp+24h] [bp-44h] BYREF
  CColPoint colPoint; // [sp+28h] [bp-40h] BYREF
  CVector vecStart; // [sp+54h] [bp-14h] BYREF

  v2 = 0;
  vecStart = TempSource;
  gCurCamColVars = 5;
  refEntityPtr = 0;
  m_pMat = CWorld::Players[0].pPed->m_pMat;
  p_tx = (CSimpleTransform *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = &CWorld::Players[0].pPed->m_transform;
  if ( !CWorld::ProcessLineOfSight(&vecStart, &p_tx->m_translate, &colPoint, &refEntityPtr, 1, 0, 0, 0, 0, 1, 1, 0) )
  {
    v5 = CWorld::Players[1].pPed->m_pMat;
    p_m_transform = (CSimpleTransform *)&v5->tx;
    if ( !v5 )
      p_m_transform = &CWorld::Players[1].pPed->m_transform;
    return CWorld::ProcessLineOfSight(
             &vecStart,
             &p_m_transform->m_translate,
             &colPoint,
             &refEntityPtr,
             1,
             0,
             0,
             0,
             0,
             1,
             1,
             0) ^ 1;
  }
  return v2;
}

//----- (003D5F80) --------------------------------------------------------
bool __fastcall CCam::RotCamIfInFrontCar(CCam *this, const CVector *TargetCoors, float TargetOrientation)
{
  float32x2_t v3; // d1
  float32x2_t v4; // d3
  CEntity *CamTargetEntity; // r6
  float *p_xx; // r0
  float z; // s0
  float m_heading; // s2
  float v12; // s24
  float v13; // s16
  float v14; // s22
  float v15; // s18
  float v16; // s20
  float v17; // s4
  float v18; // s0
  float x; // s22
  float y; // s24
  float v21; // s26
  float i; // s28
  CPad *Pad; // r0
  _BOOL4 LookLeft; // r6
  CPad *v25; // r0
  _BOOL4 LookRight; // r5
  CPad *v27; // r0
  CPad *v28; // r0
  CVehicle *PlayerVehicle; // r0
  CPad *v30; // r0
  CVehicle *v31; // r0
  CPad *v32; // r0
  _BOOL4 v33; // r0
  bool v35; // zf
  float Beta; // s0
  float j; // s6
  float v38; // s8
  float BetaSpeed; // s10
  float v40; // s12
  float v41; // s14
  float v42; // s1
  float v43; // s14
  float v44; // s10
  CVehicle *v45; // r0
  CPad *v46; // r0
  float v47; // s22
  float v48; // s24
  RwReal v49; // s26
  float v50; // r0
  float v51; // s0

  CamTargetEntity = this->CamTargetEntity;
  if ( (*(_BYTE *)&CamTargetEntity->m_info & 7) != 2 )
    return 0;
  p_xx = &CamTargetEntity->m_pMat->xx;
  if ( !p_xx )
  {
    CPlaceable::AllocateMatrix(CamTargetEntity);
    CSimpleTransform::UpdateMatrix(&CamTargetEntity->m_transform, CamTargetEntity->m_pMat);
    p_xx = &CamTargetEntity->m_pMat->xx;
  }
  z = CamTargetEntity[1].m_transform.m_translate.z;
  m_heading = CamTargetEntity[1].m_transform.m_heading;
  v12 = p_xx[4] * z;
  v13 = *(float *)&CamTargetEntity[1].m_pMat;
  v14 = p_xx[5] * m_heading;
  v15 = p_xx[6];
  if ( (float)((float)((float)(z * z) + (float)(m_heading * m_heading)) + 0.0) <= 0.0036 )
    v16 = TargetOrientation;
  else
    v16 = atan2f(COERCE_FLOAT(LODWORD(z) ^ 0x80000000), CamTargetEntity[1].m_transform.m_heading) + -1.5708;
  v17 = v12 + v14;
  v18 = v16 - this->Beta;
  x = this->Source.x;
  y = this->Source.y;
  v21 = TargetCoors->x;
  for ( i = TargetCoors->y; v18 > 3.1416; v18 = v18 + -6.2832 )
    ;
  for ( ; v18 < -3.1416; v18 = v18 + 6.2832 )
    ;
  if ( (float)(v17 + (float)(v15 * v13)) > 0.1 && !TheCamera.m_uiTransitionState )
    this->m_bFixingBeta = 1;
  Pad = currentPad;
  if ( !currentPad )
    Pad = CPad::GetPad(0);
  LookLeft = CPad::GetLookLeft(Pad, 1);
  v25 = currentPad;
  if ( !currentPad )
    v25 = CPad::GetPad(0);
  LookRight = CPad::GetLookRight(v25, 1);
  v27 = currentPad;
  if ( !currentPad )
    v27 = CPad::GetPad(0);
  if ( !CPad::GetLookBehindForCar(v27) )
  {
    v28 = currentPad;
    if ( !currentPad )
      v28 = CPad::GetPad(0);
    if ( !CPad::GetLookBehindForPed(v28) && !LookLeft && !LookRight && this->DirectionWasLooking != 3 )
      TheCamera.m_bCamDirectlyBehind = 1;
  }
  if ( !((TheCamera.m_bUseTransitionBeta || this->m_bFixingBeta) << 24) )
  {
    if ( !FindPlayerPed(-1) )
      goto LABEL_80;
    PlayerVehicle = FindPlayerVehicle(-1, 0);
    if ( !PlayerVehicle )
      goto LABEL_80;
    if ( (unsigned int)(PlayerVehicle->m_vehicleType - 3) >= 2 )
    {
      v30 = currentPad;
      if ( !currentPad )
        v30 = CPad::GetPad(0);
      if ( !CPad::IsFlyingRCVehicle(v30) )
      {
LABEL_80:
        if ( !((TheCamera.m_bCamDirectlyInFront || TheCamera.m_bCamDirectlyBehind) << 24) )
          return 0;
      }
    }
  }
  if ( FindPlayerPed(-1) )
  {
    v31 = FindPlayerVehicle(-1, 0);
    if ( v31 )
    {
      if ( (unsigned int)(v31->m_vehicleType - 3) < 2 )
        goto LABEL_41;
      v32 = currentPad;
      if ( !currentPad )
        v32 = CPad::GetPad(0);
      if ( CPad::IsFlyingRCVehicle(v32) )
        goto LABEL_41;
    }
  }
  if ( (TheCamera.m_bUseTransitionBeta || TheCamera.m_bCamDirectlyInFront || TheCamera.m_bCamDirectlyBehind) << 24 )
LABEL_41:
    v33 = &TheCamera.Cams[TheCamera.ActiveCam] == this;
  else
    v33 = 0;
  v35 = !v33;
  if ( !v33 )
    v35 = !this->m_bFixingBeta;
  if ( !v35 )
  {
    Beta = this->Beta;
    for ( j = v16 - Beta; j >= 3.1416; j = j + -6.2832 )
      ;
    for ( ; j < -3.1416; j = j + 6.2832 )
      ;
    v38 = j * 0.1;
    BetaSpeed = this->BetaSpeed;
    v40 = (float)(j * 0.1) - BetaSpeed;
    v41 = fabsf(v40) * 0.003;
    v4.n64_f32[0] = CTimer::ms_fTimeStep;
    v42 = -(float)(CTimer::ms_fTimeStep * v41);
    v43 = CTimer::ms_fTimeStep * v41;
    if ( v40 > 0.0 )
      v42 = v43;
    v44 = BetaSpeed + v42;
    this->BetaSpeed = v44;
    if ( v38 < 0.0 || v38 > 0.0 )
    {
      v44 = v38;
      this->BetaSpeed = v38;
    }
    v3.n64_u32[0] = 10.0;
    this->Beta = Beta + (float)(v44 * vmin_f32(v4, v3).n64_f32[0]);
    if ( FindPlayerPed(-1) )
    {
      v45 = FindPlayerVehicle(-1, 0);
      if ( v45 )
      {
        if ( (unsigned int)(v45->m_vehicleType - 3) < 2 )
          goto LABEL_63;
        v46 = currentPad;
        if ( !currentPad )
          v46 = CPad::GetPad(0);
        if ( CPad::IsFlyingRCVehicle(v46) )
          goto LABEL_63;
      }
    }
    if ( TheCamera.m_bCamDirectlyBehind )
    {
LABEL_63:
      if ( &TheCamera.Cams[TheCamera.ActiveCam] == this )
        this->Beta = v16;
    }
    if ( TheCamera.m_bCamDirectlyInFront && &TheCamera.Cams[TheCamera.ActiveCam] == this )
      this->Beta = v16 + 3.1416;
    v47 = sqrtf((float)((float)(x - v21) * (float)(x - v21)) + (float)((float)(y - i) * (float)(y - i)));
    if ( TheCamera.m_bUseTransitionBeta && &TheCamera.Cams[TheCamera.ActiveCam] == this )
      this->Beta = this->m_fTransitionBeta;
    v48 = this->Beta;
    v49 = (float)(v47 * cosf(v48)) + TargetCoors->x;
    v50 = sinf(v48);
    this->Source.x = v49;
    v51 = v16 - v48;
    for ( this->Source.y = (float)(v47 * v50) + TargetCoors->y; v51 > 3.1416; v51 = v51 + -6.2832 )
      ;
    for ( ; v51 < -3.1416; v51 = v51 + 6.2832 )
      ;
    if ( fabsf(v51) < 0.034907 )
      this->m_bFixingBeta = 0;
  }
  *(_WORD *)&TheCamera.m_bCamDirectlyBehind = 0;
  return 1;
}
// 3D62D6: variable 'v4' is possibly undefined
// 3D62D6: variable 'v3' is possibly undefined
// 18: using guessed type int (*off_18)();

//----- (003D64D8) --------------------------------------------------------
void __fastcall CamShakeNoPos(CCamera *pCam, float Power)
{
  float32x2_t v2; // d1
  float32x2_t v3; // d2
  float32x2_t v4; // d3

  v3.n64_u32[0] = 2.0;
  v2.n64_f32[0] = pCam->m_fCamShakeForce
                + (float)((float)(CTimer::m_snTimeInMilliseconds - pCam->m_uiCamShakeStart) * -0.001);
  v4.n64_u32[0] = 0;
  if ( vmax_f32(vmin_f32(v2, v3), v4).n64_f32[0] < Power )
  {
    pCam->m_uiCamShakeStart = CTimer::m_snTimeInMilliseconds;
    pCam->m_fCamShakeForce = Power;
  }
}
// 3D6508: variable 'v2' is possibly undefined
// 3D6508: variable 'v3' is possibly undefined
// 3D650C: variable 'v4' is possibly undefined

//----- (003D6530) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
CEntity *__fastcall CCam::Get_TwoPlayer_AimVector(CCam *this, CVector *vecFront)
{
  CVehicle *m_pMyVehicle; // r1
  CPlayerPed *pDriver; // r1
  CPlayerPed *pPed; // r6
  eWeaponType m_eWeaponType; // r4
  int8 WeaponSkill; // r0
  CWeaponInfo *WeaponInfo; // r0
  CMatrix *m_pMat; // r3
  __int64 *p_tx; // r4
  __int64 v12; // kr00_8 OVERLAPPED
  const CVehicle *NearestTargetEntityWithScreenCoors; // r0
  CEntity *v14; // r6
  CMatrix *v15; // r0
  float *p_x; // r1
  float v17; // s4
  float v18; // s2
  float v19; // s0
  float X_Targetting; // s16
  float x; // s18
  float y; // s20
  float z; // s22
  float v24; // r0
  float v25; // s0
  float v26; // s14
  __int64 v28; // [sp+0h] [bp-50h]
  CVector v29; // [sp+14h] [bp-3Ch] BYREF

  m_pMyVehicle = CWorld::Players[0].pPed->m_pMyVehicle;
  if ( m_pMyVehicle )
  {
    pDriver = (CPlayerPed *)m_pMyVehicle->pDriver;
    pPed = CWorld::Players[1].pPed;
    if ( pDriver == CWorld::Players[0].pPed )
      pPed = pDriver;
  }
  else
  {
    pPed = CWorld::Players[0].pPed;
  }
  m_eWeaponType = pPed->m_WeaponSlots[pPed->m_nCurrentWeapon].m_eWeaponType;
  WeaponSkill = CPed::GetWeaponSkill(pPed);
  WeaponInfo = CWeaponInfo::GetWeaponInfo(m_eWeaponType, WeaponSkill);
  m_pMat = pPed->m_pMat;
  p_tx = (__int64 *)&m_pMat->tx;
  if ( !m_pMat )
    p_tx = (__int64 *)&pPed->m_transform;
  v12 = *p_tx;
  v28 = *(__int64 *)((char *)p_tx + 4);
  NearestTargetEntityWithScreenCoors = CWeapon::FindNearestTargetEntityWithScreenCoors(
                                         this->X_Targetting,
                                         this->Y_Targetting,
                                         WeaponInfo->m_fWeaponRange + WeaponInfo->m_fWeaponRange,
                                         *(CVector *)&v12,
                                         0,
                                         0);
  v14 = &NearestTargetEntityWithScreenCoors->CPhysical;
  if ( NearestTargetEntityWithScreenCoors )
  {
    v15 = NearestTargetEntityWithScreenCoors->m_pMat;
    p_x = &v15->tx;
    if ( !v15 )
      p_x = &v14->m_transform.m_translate.x;
    v17 = *p_x - this->Source.x;
    v18 = p_x[1] - this->Source.y;
    v19 = p_x[2] - this->Source.z;
  }
  else
  {
    CrossProduct(&v29, &this->Front, &this->Up);
    X_Targetting = this->X_Targetting;
    x = v29.x;
    y = v29.y;
    z = v29.z;
    v24 = tanf((float)(this->FOV * 0.017453) * 0.5);
    v25 = (float)(v24 * this->Y_Targetting) / CDraw::ms_fAspectRatio;
    v26 = this->Up.x * v25;
    v18 = (float)((float)((float)(X_Targetting * y) * v24) + this->Front.y) - (float)(v25 * this->Up.y);
    v19 = (float)((float)((float)(X_Targetting * z) * v24) + this->Front.z) - (float)(v25 * this->Up.z);
    v17 = (float)(this->Front.x + (float)((float)(X_Targetting * x) * v24)) - v26;
  }
  vecFront->x = v17;
  vecFront->y = v18;
  vecFront->z = v19;
  CVector::Normalise(vecFront);
  return v14;
}
// 3D65A3: failed to expand linear variable kr00_8.8

//----- (003D66D0) --------------------------------------------------------
void __fastcall CCamera::CCamera(CCamera *this)
{
  CPlaceable::CPlaceable(this);
  this->_vptr$CPlaceable = (int (**)(void))&off_66799C;
  CCam::Init(this->Cams);
  CCam::Init(&this->Cams[1]);
  CCam::Init(&this->Cams[2]);
  *(_QWORD *)&this->m_arrPathArray[0].m_arr_PathData = 0LL;
  *(_QWORD *)&this->m_arrPathArray[2].m_arr_PathData = 0LL;
  this->m_cameraMatrix.m_pRwMat = 0;
  this->m_cameraMatrix.m_owner = 0;
  this->m_cameraMatrixOld.m_pRwMat = 0;
  this->m_cameraMatrixOld.m_owner = 0;
  this->m_viewMatrix.m_pRwMat = 0;
  this->m_viewMatrix.m_owner = 0;
  this->m_matInverse.m_pRwMat = 0;
  this->m_matInverse.m_owner = 0;
  this->m_matMirrorInverse.m_pRwMat = 0;
  this->m_matMirrorInverse.m_owner = 0;
  this->m_matMirror.m_pRwMat = 0;
  this->m_matMirror.m_owner = 0;
  this->m_VehicleTweaks[0].m_ModelId = -1;
  this->m_VehicleTweaks[0].m_LenMod = 1.0;
  this->m_VehicleTweaks[0].m_TargetZMod = 1.0;
  this->m_VehicleTweaks[0].m_PitchMod = 0.0;
  this->m_VehicleTweaks[1].m_ModelId = -1;
  this->m_VehicleTweaks[1].m_LenMod = 1.0;
  this->m_VehicleTweaks[1].m_TargetZMod = 1.0;
  this->m_VehicleTweaks[1].m_PitchMod = 0.0;
  this->m_VehicleTweaks[2].m_ModelId = -1;
  this->m_VehicleTweaks[2].m_LenMod = 1.0;
  this->m_VehicleTweaks[2].m_TargetZMod = 1.0;
  this->m_VehicleTweaks[2].m_PitchMod = 0.0;
  this->m_VehicleTweaks[3].m_ModelId = -1;
  this->m_VehicleTweaks[3].m_LenMod = 1.0;
  this->m_VehicleTweaks[3].m_TargetZMod = 1.0;
  this->m_VehicleTweaks[3].m_PitchMod = 0.0;
  *(_QWORD *)&this->m_duckZMod = 0LL;
  *(_QWORD *)&this->m_vectorTrackStartTime = 0xBF800000BF800000LL;
  *(_QWORD *)&this->m_FOVLerpStartTime = 0xBF800000BF800000LL;
  *(_QWORD *)&this->m_FOVLerpStart = 0LL;
  this->m_VehicleTweaks[4].m_ModelId = -1;
  this->m_VehicleTweaks[4].m_LenMod = 1.0;
  this->m_VehicleTweaks[4].m_TargetZMod = 1.0;
  this->m_VehicleTweaks[4].m_PitchMod = 0.0;
  this->m_bMusicFadedOut = 0;
  this->m_CurShakeCam = 1;
  this->m_pMat = &this->m_cameraMatrix;
  this->m_shakeStartTime = -1.0;
  this->m_shakeEndTime = -1.0;
  this->m_bVectorTrackSmoothEnds = 1;
  this->m_bFOVLerpSmoothEnds = 1;
  this->m_bVectorMoveSmoothEnds = 1;
  this->m_vectorMoveStartTime = -1.0;
  this->m_vectorMoveEndTime = -1.0;
  this->m_bVectorTrackScript = 0;
  this->m_bFOVScript = 0;
  *(_DWORD *)&this->m_bVectorMoveScript = 0;
  this->m_sphereMapRadius = 0.0;
}
// 66799C: using guessed type void *;

//----- (003D6830) --------------------------------------------------------
void __fastcall CCamera::InitialiseScriptableComponents(CCamera *this)
{
  float *p_m_FOVLerpStartTime; // r0

  this->m_vectorTrackStartTime = -1.0;
  this->m_vectorTrackEndTime = -1.0;
  this->m_shakeStartTime = -1.0;
  this->m_shakeEndTime = -1.0;
  this->m_bVectorTrackSmoothEnds = 1;
  this->m_bFOVLerpSmoothEnds = 1;
  this->m_bVectorMoveSmoothEnds = 1;
  this->m_vectorMoveStartTime = -1.0;
  this->m_vectorMoveEndTime = -1.0;
  this->m_bVectorTrackScript = 0;
  this->m_bFOVScript = 0;
  *(_DWORD *)&this->m_bVectorMoveScript = 0;
  p_m_FOVLerpStartTime = &this->m_FOVLerpStartTime;
  *(_QWORD *)p_m_FOVLerpStartTime = 0xBF800000BF800000LL;
  *((_QWORD *)p_m_FOVLerpStartTime + 1) = 0LL;
}

//----- (003D6890) --------------------------------------------------------
void __fastcall CCamera::~CCamera(CCamera *this)
{
  this->m_pMat = 0;
  this->_vptr$CPlaceable = (int (**)(void))&off_66799C;
  CMatrix::~CMatrix(&this->m_matMirror);
  CMatrix::~CMatrix(&this->m_matMirrorInverse);
  CMatrix::~CMatrix(&this->m_matInverse);
  CMatrix::~CMatrix(&this->m_viewMatrix);
  CMatrix::~CMatrix(&this->m_cameraMatrixOld);
  CMatrix::~CMatrix(&this->m_cameraMatrix);
  sub_18E218(this);
}
// 66799C: using guessed type void *off_66799C;

//----- (003D68E4) --------------------------------------------------------
void __fastcall CCamera::~CCamera(CCamera *this)
{
  void *v2; // r0

  this->m_pMat = 0;
  this->_vptr$CPlaceable = (int (**)(void))&off_66799C;
  CMatrix::~CMatrix(&this->m_matMirror);
  CMatrix::~CMatrix(&this->m_matMirrorInverse);
  CMatrix::~CMatrix(&this->m_matInverse);
  CMatrix::~CMatrix(&this->m_viewMatrix);
  CMatrix::~CMatrix(&this->m_cameraMatrixOld);
  CMatrix::~CMatrix(&this->m_cameraMatrix);
  CPlaceable::~CPlaceable(this);
  sub_191374(v2);
}
// 3D6932: variable 'v2' is possibly undefined
// 66799C: using guessed type void *off_66799C;

//----- (003D693C) --------------------------------------------------------
void __fastcall CCamera::CamControl(CCamera *this)
{
  float v1; // r6
  __int64 v2; // r8
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  float32x2_t v6; // d8
  float v7; // s18
  float v8; // s20
  float v9; // s22
  bool v11; // r5
  int ActiveCam; // r0
  CEntity *CamTargetEntity; // r0
  bool v14; // zf
  __int64 v15; // r0
  int v16; // r2
  CPad *Pad; // r0
  CPad *v18; // r0
  CPlayerPed *PlayerPed; // r0
  _BOOL4 v20; // r10
  CPlayerPed *v21; // r1
  bool v22; // zf
  bool v23; // zf
  __int16 v24; // r1
  ePedState m_nPedState; // r0
  char v26; // r6
  int v27; // r8
  Int16 v28; // r0
  CVehicle *m_pMyVehicle; // r2
  bool v30; // zf
  Int16 *p_m_ModeForTwoPlayersSameCarShootingAllowed; // r1
  int v32; // r0
  int v33; // r1
  CPlayerPed *pPed; // r0
  CEntity *pTargetEntity; // r0
  int v36; // r1
  bool v37; // zf
  bool m_WideScreenOn; // r0
  CEntity *v39; // r0
  int v40; // r1
  Int16 v41; // r1
  CEntity *v42; // r9
  RwReal v43; // r6
  _BOOL4 v44; // r8
  int v45; // r0
  int v46; // r5
  int v47; // r4
  CTask *ActiveTaskByType; // r0
  CPlayerPed *v49; // r10
  CMatrix *v50; // r0
  int v51; // r1
  CSimpleTransform *v52; // r2
  int v53; // r0
  float32x2_t v54; // d16
  unsigned __int64 v55; // d1
  int v56; // r1
  char *v57; // r2
  __int64 v58; // d16
  CEntity *v59; // r0
  CEntity *v60; // r0
  CCam *v61; // r1
  int v62; // r0
  __int64 v63; // d16
  CCam *v64; // r2
  bool *v65; // r0
  __int64 v66; // d16
  RwReal v67; // r1
  __int64 v68; // d16
  float v69; // r0
  float m_fPedZoomBase; // r1
  CEntity *v71; // r0
  CEntity *v72; // r0
  CPlayerPed *v73; // r0
  int v74; // r9
  ePedState v75; // r0
  Int16 v76; // r1
  _BOOL4 v77; // r2
  int v78; // r1
  bool v79; // zf
  _BOOL4 m_bObbeCinematicCarCamOn; // r0
  _BOOL4 m_bPlayerIsInGarage; // r2
  CEntity *v82; // r0
  RwReal v83; // r4
  CPlayerPed *v84; // r0
  bool v85; // zf
  int32 v86; // r1
  int v87; // r0
  char *v88; // r2
  float *p_m_fTargetZoomGroundThree; // r2
  bool v90; // zf
  float v91; // s2
  _BOOL4 m_bUseScriptZoomValuePed; // r2
  float m_fPedZoomSmoothed; // s6
  float v94; // s4
  float m_fPedZoomValueScript; // s2
  float v96; // s4
  float v97; // s4
  float v98; // s2
  float v99; // s6
  float v100; // s4
  float v101; // s4
  float v102; // s4
  _BOOL4 v103; // r4
  int v104; // r1
  int v105; // r10
  int v106; // r0
  bool v107; // zf
  bool v108; // zf
  int v109; // r0
  _BOOL4 v110; // r1
  unsigned int v111; // r0
  CPad *v112; // r0
  CPad *v113; // r0
  Int16 m_iModeToGoTo; // r1
  __int16 v115; // r0
  int v116; // r0
  CQueuedMode *p_m_iModeToGoTo; // r1
  int v118; // r1
  char *v119; // r2
  __int64 v120; // d16
  CEntity *v121; // r0
  CEntity *v122; // r0
  CCam *v123; // r1
  int v124; // r0
  __int64 v125; // d16
  CCam *v126; // r2
  bool *v127; // r0
  __int64 v128; // d16
  __int64 v129; // d16
  float v130; // r0
  float v131; // r1
  CEntity *v132; // r0
  CTaskSimpleJetPack *TaskJetPack; // r0
  bool v134; // zf
  int v135; // r6
  _BOOL4 v136; // r0
  int v137; // r3
  bool v138; // zf
  float32x2_t *v139; // r1
  int v140; // r3
  CGarage *v141; // r6
  CEntity *v142; // r6
  unsigned __int32 v143; // r6
  int v144; // r4
  unsigned __int32 v145; // r5
  int v146; // r6
  unsigned __int64 v147; // d1
  bool v148; // zf
  int v149; // r1
  char *v150; // r2
  __int64 v151; // d16
  RwReal v152; // r0
  CEntity *v153; // r0
  CEntity *v154; // r0
  CCam *v155; // r1
  int v156; // r0
  __int64 v157; // d16
  CCam *v158; // r2
  bool *v159; // r0
  __int64 v160; // d16
  __int64 v161; // d16
  float v162; // r0
  float v163; // r1
  bool v164; // zf
  CPlayerPed *v165; // r0
  CMatrix *v166; // r1
  float tx; // s16
  float *v168; // r2
  float v169; // s18
  CPlayerPed *v170; // r0
  CMatrix *v171; // r1
  float ty; // s20
  CSimpleTransform *v173; // r2
  float v174; // s22
  CPlayerPed *v175; // r0
  CMatrix *v176; // r2
  CSimpleTransform *v177; // r1
  CEntity *v178; // r0
  float v179; // s0
  bool v180; // zf
  CEntity *v181; // r0
  CEntity *v182; // r1
  bool v183; // zf
  int v184; // r0
  __int64 v185; // r0
  float v186; // r0
  CPlayerPed *v187; // r0
  CMatrix *v188; // r2
  float *v189; // r1
  float v190; // s0
  float v191; // s2
  float *v192; // r1
  float v193; // s6
  RwReal v194; // s0
  float v195; // s2
  float v196; // r0
  CEntity *v197; // r0
  int v198; // r0
  char *v199; // r1
  CEntity *v200; // r0
  CEntity **v201; // r1
  int v202; // r0
  CPlayerPed *v203; // r0
  CPlayerPed *v204; // r0
  _DWORD *TaskHold; // r0
  bool v206; // zf
  unsigned int v207; // r1
  bool v208; // r4
  CPlayerPed *v209; // r0
  bool v210; // zf
  CPlayerPed *v211; // r0
  int v212; // r0
  bool v213; // zf
  int v214; // r0
  bool v215; // zf
  CPlayerPed *v216; // r0
  CEntity *v217; // r1
  int v218; // r0
  int v219; // r10
  CAttributeZone *v220; // r8
  int32 m_nPedZoom; // r0
  int32 v222; // r0
  __int64 v223; // r0
  float v224; // r0
  float v225; // s6
  float v226; // s4
  float v227; // s6
  Int16 v228; // r1
  float v229; // s4
  CPad *v230; // r0
  int v231; // r0
  int32 v232; // r1
  int32 v233; // r2
  float v234; // s4
  float v235; // s4
  float *v236; // r0
  float v237; // s2
  float v238; // s6
  float v239; // s4
  float v240; // s10
  float v241; // s12
  float v242; // s10
  float v243; // s6
  CAttributeZone *ZoneWithStairsAttributeForPlayer; // r6
  CEntity *v245; // r0
  CMatrix *m_pMat; // r1
  CVector *p_tx; // r2
  int IsPointInAGarageCameraZone; // r0
  bool v249; // zf
  _BOOL4 ShouldBeOutside; // r0
  bool v251; // zf
  bool v252; // zf
  bool v253; // zf
  float *p_Duration; // r5
  CPad *v255; // r0
  CPad *v256; // r0
  CPlayerPed *v257; // r0
  CPlayerPed *v258; // r0
  int Mode; // r0
  CEntity *v260; // r0
  CGarage *pToGarageWeAreIn; // r0
  bool v262; // zf
  RwReal v263; // r1
  int v264; // r2
  int v265; // r5
  RwReal v266; // s26
  __int64 *v267; // r0
  CPad *v268; // r0
  CPlayerPed *v269; // r0
  CPad *v270; // r0
  CPlayerPed *v271; // r0
  char *v272; // r1
  int v273; // r2
  CEntity *v274; // r0
  CMatrix *v275; // r1
  CVector *v276; // r2
  int v277; // r0
  bool v278; // zf
  CGarage *v279; // r0
  bool v280; // zf
  CEntity *v281; // r1
  CMatrix *v282; // r2
  float *v283; // r3
  float v284; // s16
  float v285; // s18
  float v286; // s20
  int v287; // r1
  int v288; // r2
  CEntity *v289; // r0
  float v290; // s16
  float v291; // s18
  CMatrix *v292; // r2
  float *p_x; // r1
  float v294; // s20
  float y; // s24
  float v296; // s22
  float x; // s26
  CEntity *m_pEntLockOnTarget; // r5
  char *v299; // r0
  CEntity *v300; // r0
  CMatrix *v301; // r1
  float *v302; // r2
  float v303; // s2
  RwReal v304; // s0
  int Vec1Y; // r0
  int Vec2Y; // r2
  int Vec1X; // r1
  int Vec2X; // r3
  float v309; // s0
  CEntity *v310; // r1
  CMatrix *v311; // r2
  const CVector *v312; // r0
  float v313; // s24
  RwReal v314; // s2
  RwReal v315; // s4
  CEntity *v316; // r1
  CMatrix *v317; // r2
  const CVector *v318; // r0
  RwReal v319; // s2
  RwReal v320; // s4
  int v321; // r6
  float v322; // s2
  float v323; // s16
  float v324; // s20
  float *v325; // r0
  int v326; // r0
  int v327; // r2
  int v328; // r1
  int v329; // r3
  float v330; // s0
  CEntity *v331; // r1
  CMatrix *v332; // r2
  const CVector *v333; // r0
  float v334; // s24
  RwReal v335; // s2
  RwReal v336; // s4
  CEntity *v337; // r1
  CMatrix *v338; // r2
  const CVector *v339; // r0
  RwReal v340; // s2
  RwReal v341; // s4
  int v342; // r0
  CGarage *v343; // r1
  float ATanOfXY; // r8
  int v345; // r0
  int v346; // r0
  CGarage *v347; // r0
  CEntity *v348; // r0
  CMatrix *v349; // r1
  float *v350; // r2
  float v351; // s24
  float v352; // s21
  float v353; // s23
  float v354; // s0
  CEntity *v355; // r0
  CMatrix *v356; // r1
  float *v357; // r2
  float v358; // s26
  float v359; // s28
  float v360; // s30
  float GroundZFor3DCoord; // s19
  CGarage *v362; // r4
  int v363; // r0
  int v364; // r2
  int v365; // r1
  int v366; // r3
  float v367; // s0
  float v368; // s2
  float v369; // s0
  float v370; // s2
  float v371; // s0
  float v372; // s4
  bool v373; // zf
  CPlayerPed *v374; // r0
  CMatrix *v375; // r1
  CSimpleTransform *p_m_transform; // r2
  float v377; // s4
  float v378; // s2
  CGarage *v379; // r0
  float MaxX; // s0
  float v381; // s22
  float v382; // s19
  float v383; // s21
  int v384; // r6
  RwReal *v385; // r0
  float *v386; // r1
  __int64 v387; // d16
  CObject *v388; // r0
  CDummyObject *m_pRelatedDummy; // r6
  CMatrix *v390; // r1
  float *v391; // r2
  float v392; // s23
  float v393; // s25
  __int64 v394; // d16
  float v395; // s4
  float v396; // s2
  float v397; // s0
  CEntity *v398; // r1
  CMatrix *v399; // r2
  float *v400; // r3
  float v401; // s24
  float v402; // s0
  CEntity *v403; // r0
  CMatrix *v404; // r1
  CSimpleTransform *v405; // r2
  float v406; // s20
  float v407; // s22
  float v408; // s26
  float v409; // s28
  float v410; // s30
  float v411; // s17
  int v412; // r6
  RwReal *v413; // r0
  float *v414; // r1
  __int64 v415; // d16
  CObject *v416; // r0
  CDummyObject *v417; // r6
  CMatrix *v418; // r1
  float *v419; // r2
  float v420; // s19
  float v421; // s21
  __int64 v422; // d16
  float v423; // s6
  float v424; // s4
  float v425; // s2
  _BOOL4 v426; // r0
  bool v427; // zf
  bool v428; // zf
  unsigned __int32 v429; // r0
  int v430; // r1
  int32 v431; // r0
  float (**v432)[5]; // r2
  int v433; // r1
  float m_fCarZoomSmoothed; // s6
  float v435; // s4
  float m_fCarZoomValueScript; // s2
  float v437; // s4
  float v438; // s2
  float v439; // s6
  int v440; // s4
  float v441; // s2
  float v442; // s4
  float v443; // s6
  float m_fCarZoomBase; // s4
  float v445; // s6
  float v446; // s2
  float v447; // s6
  float v448; // s6
  float v449; // s6
  float *v450; // r0
  float v451; // s2
  float v452; // s8
  float v453; // s4
  float v454; // s10
  float v455; // s12
  float v456; // s10
  float v457; // s6
  CPad *v458; // r0
  char v459; // r0
  CWidget *v460; // r5
  int v461; // r0
  CEntity *v462; // r0
  CMatrix *v463; // r1
  CSimpleTransform *v464; // r2
  float v465; // s16
  CEntity *v466; // r0
  CMatrix *v467; // r1
  const CVector *p_m_translate; // r6
  float v469; // s18
  float v470; // s0
  float z; // r0
  __int64 v472; // d16
  RwReal v473; // r0
  char v474; // r0
  CWidget *v475; // r5
  int v476; // r0
  int m_nCarZoom; // r0
  int v478; // r0
  int v479; // [sp+24h] [bp-B4h]
  CColPoint v480; // [sp+28h] [bp-B0h] BYREF
  CVector ppDoor1; // [sp+58h] [bp-80h] BYREF
  bool pBool; // [sp+67h] [bp-71h] BYREF
  CObject *v483; // [sp+68h] [bp-70h] BYREF
  CVector ppDoor2[9]; // [sp+6Ch] [bp-6Ch] BYREF

  v11 = 0;
  ActiveCam = this->ActiveCam;
  this->m_bObbeCinematicCarCamOn = 0;
  this->m_bObbeCinematicPedCamOn = 0;
  this->m_bUseTransitionBeta = 0;
  this->m_bUseSpecialFovTrain = 0;
  this->m_bJustCameOutOfGarage = 0;
  this->m_bTargetJustCameOffTrain = 0;
  this->m_bInATunnelAndABigVehicle = 0;
  CamTargetEntity = this->Cams[ActiveCam].CamTargetEntity;
  v14 = CamTargetEntity == 0;
  if ( !CamTargetEntity )
    v14 = this->pTargetEntity == 0;
  if ( v14 )
  {
    pPed = CWorld::Players[CWorld::PlayerInFocus].pPed;
    this->pTargetEntity = pPed;
    CEntity::RegisterReference(pPed, &this->pTargetEntity);
  }
  v15 = *(_QWORD *)&this->m_iCheckCullZoneThisNumFrames;
  v16 = 1;
  if ( SHIDWORD(v15) < (int)v15 )
    v16 = HIDWORD(v15) + 1;
  this->m_iZoneCullFrameNumWereAt = v16;
  if ( v16 == (_DWORD)v15 )
    v11 = 1;
  this->m_bCullZoneChecksOn = v11;
  if ( v16 == (_DWORD)v15 )
    this->m_bFailedCullZoneTestPreviously = CCullZones::CamCloseInForPlayer();
  Pad = currentPad;
  if ( !currentPad )
    Pad = CPad::GetPad(0);
  if ( !Pad->bUsingDebugCamera && this->m_bLookingAtPlayer )
  {
    v18 = currentPad;
    if ( !currentPad )
      v18 = CPad::GetPad(0);
    v18->DisablePlayerControls &= ~1u;
    PlayerPed = FindPlayerPed(-1);
    *(_DWORD *)&PlayerPed->m_nFlags |= 0x80u;
  }
  if ( (CTimer::m_UserPause || CTimer::m_CodePause) << 24 || this->m_bIdleOn )
  {
    v20 = 0;
    goto LABEL_21;
  }
  if ( this->m_bTargetJustBeenOnTrain )
  {
    pTargetEntity = this->pTargetEntity;
    v36 = *(_BYTE *)&pTargetEntity->m_info & 7;
    v37 = v36 == 2;
    if ( v36 == 2 )
      v37 = pTargetEntity[24]._vptr$CPlaceable == (int (**)(void))&byte_6;
    if ( !v37 )
    {
      CCamera::Restore(this);
      m_WideScreenOn = this->m_WideScreenOn;
      *(_WORD *)&this->m_bTargetJustBeenOnTrain = 256;
      this->m_bWantsToSwitchWidescreenOff = m_WideScreenOn;
    }
  }
  v39 = this->pTargetEntity;
  v40 = *(_BYTE *)&v39->m_info & 7;
  if ( v40 == 3 )
  {
    v85 = !this->m_WideScreenOn;
    if ( !this->m_WideScreenOn )
      v85 = !this->m_bFailedCullZoneTestPreviously;
    if ( !v85
      || !this->m_bLookingAtPlayer && this->WhoIsInControlOfTheCamera != 2
      || CGameLogic::IsCoopGameGoingOn()
      || !CPed::IsAlive((const CPed *)this->pTargetEntity) )
    {
      goto LABEL_129;
    }
    switch ( TheCamera.PlayerWeaponMode.Mode )
    {
      case 7:
      case 8:
      case 0x22:
      case 0x2D:
      case 0x2E:
      case 0x33:
      case 0x35:
      case 0x41:
        goto LABEL_129;
      default:
        m_nPedZoom = this->m_nPedZoom;
        if ( m_nPedZoom <= 3 )
        {
          if ( m_nPedZoom > 0 )
          {
LABEL_808:
            v474 = `guard variable for'CCamera::CamControl(void)::nInitialZoom;
            __dmb(0xBu);
            if ( (v474 & 1) == 0
              && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CamControl(void)::nInitialZoom) )
            {
              CCamera::CamControl(void)::nInitialZoom = this->m_nPedZoom;
              _cxa_guard_release((__guard *)&`guard variable for'CCamera::CamControl(void)::nInitialZoom);
            }
            if ( CHID::GetInputType() == 2 )
            {
              if ( CHID::IsReleased(HID_MAPPING_CAMERA_CLOSER) )
              {
                v3.n64_u32[0] = 1.0;
                CCamera::CamControl(void)::fClicks = CHID::GetMappingWeight(HID_MAPPING_CAMERA_CLOSER)
                                                   + CCamera::CamControl(void)::fClicks;
                if ( CCamera::CamControl(void)::fClicks >= 1.0 )
                {
                  v4.n64_f32[0] = (float)(this->m_nPedZoom - 1);
                  v3.n64_u64[0] = vmax_f32(v4, v3).n64_u64[0];
                  this->m_nPedZoom = (int)v3.n64_f32[0];
                  CCamera::CamControl(void)::fClicks = 0.0;
                }
              }
              if ( CHID::IsReleased(HID_MAPPING_CAMERA_FARTHER) )
              {
                CCamera::CamControl(void)::fClicks = CCamera::CamControl(void)::fClicks
                                                   - CHID::GetMappingWeight(HID_MAPPING_CAMERA_FARTHER);
                if ( CCamera::CamControl(void)::fClicks <= -1.0 )
                {
                  v3.n64_u32[0] = 3.0;
                  v4.n64_f32[0] = (float)(this->m_nPedZoom + 1);
                  v3.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
                  this->m_nPedZoom = (int)v3.n64_f32[0];
                  CCamera::CamControl(void)::fClicks = 0.0;
                }
              }
            }
            if ( !CTouchInterface::IsPinchZooming(WIDGET_LOOK, 0, 1) )
            {
              CCamera::CamControl(void)::fInitialDistance = 0.0;
              goto LABEL_129;
            }
            if ( CHID::Implements(HID_MAPPING_CAMERA_CLOSER) && CHID::GetInputType() == 1 )
            {
              this->m_nPedZoom = (this->m_nPedZoom + 1) % 3 + 1;
              goto LABEL_129;
            }
            v475 = CTouchInterface::m_pWidgets[175];
            if ( CTouchInterface::m_pWidgets[175] )
            {
              if ( CCamera::CamControl(void)::fInitialDistance == 0.0 )
              {
                LODWORD(CCamera::CamControl(void)::fInitialDistance) = (*((int (__fastcall **)(CWidget *))CTouchInterface::m_pWidgets[175]->_vptr$CWidget
                                                                        + 6))(CTouchInterface::m_pWidgets[175]);
                CCamera::CamControl(void)::nInitialZoom = this->m_nPedZoom;
              }
              if ( (float)((*((float (__fastcall **)(CWidget *))v475->_vptr$CWidget + 6))(v475)
                         - CCamera::CamControl(void)::fInitialDistance) <= 250.0 )
              {
                if ( (float)((*((float (__fastcall **)(CWidget *))v475->_vptr$CWidget + 6))(v475)
                           - CCamera::CamControl(void)::fInitialDistance) <= 125.0 )
                {
                  if ( (float)((*((float (__fastcall **)(CWidget *))v475->_vptr$CWidget + 6))(v475)
                             - CCamera::CamControl(void)::fInitialDistance) >= -250.0 )
                  {
                    if ( (float)((*((float (__fastcall **)(CWidget *))v475->_vptr$CWidget + 6))(v475)
                               - CCamera::CamControl(void)::fInitialDistance) >= -125.0 )
                    {
                      v478 = this->m_nPedZoom;
                      goto LABEL_842;
                    }
                    v476 = 1;
                  }
                  else
                  {
                    v476 = 2;
                  }
                }
                else
                {
                  v476 = -1;
                }
              }
              else
              {
                v476 = -2;
              }
              v478 = v476 + CCamera::CamControl(void)::nInitialZoom;
              this->m_nPedZoom = v478;
LABEL_842:
              v3.n64_u32[0] = 1.0;
              v4.n64_f32[0] = (float)v478;
              v5.n64_u32[0] = 3.0;
              v3.n64_u64[0] = vmin_f32(vmax_f32(v4, v3), v5).n64_u64[0];
              this->m_nPedZoom = (int)v3.n64_f32[0];
            }
LABEL_129:
            CCamera::CamControl(void)::ReqMode = 4;
            v86 = this->m_nPedZoom;
            if ( v86 == 3 )
            {
              v87 = this->ActiveCam;
              p_m_fTargetZoomGroundThree = &this->Cams[v87].m_fTargetZoomGroundThree;
            }
            else
            {
              v87 = this->ActiveCam;
              v88 = (char *)this + 528 * v87;
              if ( v86 == 1 )
                p_m_fTargetZoomGroundThree = (float *)(v88 + 548);
              else
                p_m_fTargetZoomGroundThree = (float *)(v88 + 552);
            }
            v91 = *p_m_fTargetZoomGroundThree;
            m_bUseScriptZoomValuePed = this->m_bUseScriptZoomValuePed;
            this->m_fPedZoomBase = v91;
            if ( m_bUseScriptZoomValuePed )
            {
              m_fPedZoomSmoothed = this->m_fPedZoomSmoothed;
              v3.n64_f32[0] = CTimer::ms_fTimeStep;
              v94 = CTimer::ms_fTimeStep * 0.12;
              m_fPedZoomValueScript = this->m_fPedZoomValueScript;
              if ( m_fPedZoomSmoothed >= m_fPedZoomValueScript )
              {
                v101 = m_fPedZoomSmoothed - v94;
                if ( m_fPedZoomValueScript <= v101 )
                  m_fPedZoomValueScript = v101;
              }
              else
              {
                v96 = m_fPedZoomSmoothed + v94;
                if ( m_fPedZoomValueScript >= v96 )
                  m_fPedZoomValueScript = v96;
              }
              v102 = 0.0;
              this->m_fPedZoomSmoothed = m_fPedZoomValueScript;
            }
            else
            {
              v97 = this->m_fPedZoomSmoothed;
              if ( this->m_bFailedCullZoneTestPreviously )
              {
                v98 = 0.5;
                v3.n64_f32[0] = CTimer::ms_fTimeStep;
                v99 = CTimer::ms_fTimeStep * 0.12;
                if ( v97 >= 0.5 )
                {
                  v229 = v97 - v99;
                  if ( v229 >= 0.5 )
                    v98 = v229;
                }
                else
                {
                  v98 = 0.5;
                  v100 = v97 + v99;
                  if ( v100 <= 0.5 )
                    v98 = v100;
                }
                v102 = 0.7;
                this->m_fPedZoomSmoothed = v98;
              }
              else
              {
                v3.n64_f32[0] = CTimer::ms_fTimeStep;
                v225 = CTimer::ms_fTimeStep * 0.12;
                if ( v97 >= v91 )
                {
                  v234 = v97 - v225;
                  v227 = v91;
                  if ( v91 <= v234 )
                    v227 = v234;
                }
                else
                {
                  v226 = v97 + v225;
                  v227 = v91;
                  if ( v91 >= v226 )
                    v227 = v226;
                }
                v235 = v227;
                if ( v91 == 0.0 )
                  v235 = v91;
                if ( v86 == 3 )
                  v227 = v235;
                v102 = 0.0;
                this->m_fPedZoomSmoothed = v227;
              }
            }
            v236 = (float *)((char *)this + 528 * v87);
            v237 = v236[106];
            v238 = v236[107];
            v239 = (float)(v102 - v237) * 0.1;
            v240 = fabsf(v239 - v238) * 0.025;
            v241 = -(float)(v3.n64_f32[0] * v240);
            v242 = v3.n64_f32[0] * v240;
            if ( (float)(v239 - v238) > 0.0 )
              v241 = v242;
            v243 = v238 + v241;
            v236[107] = v243;
            if ( v239 < 0.0 || v239 > 0.0 )
            {
              v243 = v239;
              v236[107] = v239;
            }
            v6.n64_u32[0] = 10.0;
            v236[106] = v237 + (float)(v243 * vmin_f32(v3, v6).n64_f32[0]);
            if ( CCullZones::CamStairsForPlayer() == 1 )
            {
              ZoneWithStairsAttributeForPlayer = CCullZones::FindZoneWithStairsAttributeForPlayer();
              v219 = (int)ZoneWithStairsAttributeForPlayer;
              if ( ZoneWithStairsAttributeForPlayer )
                v219 = 1;
            }
            else
            {
              ZoneWithStairsAttributeForPlayer = 0;
              v219 = 0;
            }
            v245 = this->pTargetEntity;
            m_pMat = v245->m_pMat;
            p_tx = (CVector *)&m_pMat->tx;
            if ( !m_pMat )
              p_tx = &v245->m_transform.m_translate;
            IsPointInAGarageCameraZone = CGarages::IsPointInAGarageCameraZone(*p_tx);
            v249 = v219 == 0;
            if ( !v219 )
              v249 = IsPointInAGarageCameraZone == 0;
            if ( v249 )
            {
              if ( this->m_bPlayerIsInGarage )
              {
                this->m_bPlayerIsInGarage = 0;
                this->m_bJustCameOutOfGarage = 1;
              }
              this->m_bGarageFixedCamPositionSet = 0;
LABEL_441:
              p_Duration = &this->PlayerWeaponMode.Duration;
              if ( CWorld::Players[0].pPed )
              {
                CHID::currentInstanceIndex = 0;
                switch ( this->PlayerWeaponMode.Mode )
                {
                  case '-':
                  case '7':
                  case 'A':
                    break;
                  case '.':
                    if ( !FindPlayerPed(-1)->m_pAttachToEntity )
                      goto LABEL_482;
                    break;
                  case '/':
                  case '0':
                  case '1':
                  case '2':
                  case '3':
                  case '4':
                  case '5':
                  case '6':
                  case '8':
                  case '9':
                  case ':':
                  case ';':
                  case '<':
                  case '=':
                  case '>':
                  case '?':
                  case '@':
                    goto LABEL_482;
                  default:
                    if ( this->PlayerWeaponMode.Mode )
                    {
LABEL_482:
                      if ( FindPlayerPed(-1)
                        && ((*((_BYTE *)FindPlayerPed(-1)->m_pPlayerData + 52) & 8) != 0
                         || FindPlayerPed(-1)->m_pEntLockOnTarget) )
                      {
LABEL_486:
                        v268 = currentPad;
                        if ( !currentPad )
                          v268 = CPad::GetPad(0);
                        if ( CPad::GetExitTargeting(v268) )
                        {
                          this->PlayerWeaponMode.MinZoom = -1;
                          this->PlayerWeaponMode.MaxZoom = 1;
                          this->PlayerWeaponMode.Mode = 0;
                          *p_Duration = 0.0;
                          if ( FindPlayerPed(-1) )
                          {
                            if ( FindPlayerPed(-1)->m_nPedState == PED_SNIPER_MODE )
                            {
                              v269 = FindPlayerPed(-1);
                              CPed::SetPedState(v269, PED_IDLE);
                            }
                          }
                        }
                      }
                      else
                      {
                        switch ( this->PlayerWeaponMode.Mode )
                        {
                          case 7:
                          case 8:
                          case 0x22:
                          case 0x2D:
                          case 0x2E:
                          case 0x33:
                          case 0x41:
                            goto LABEL_486;
                          default:
                            goto LABEL_443;
                        }
                      }
                    }
                    break;
                }
              }
LABEL_443:
              if ( CWorld::Players[1].pPed )
              {
                CHID::currentInstanceIndex = 1;
                switch ( this->PlayerWeaponMode.Mode )
                {
                  case '-':
                  case '7':
                  case 'A':
                    break;
                  case '.':
                    if ( !FindPlayerPed(-1)->m_pAttachToEntity )
                      goto LABEL_493;
                    break;
                  case '/':
                  case '0':
                  case '1':
                  case '2':
                  case '3':
                  case '4':
                  case '5':
                  case '6':
                  case '8':
                  case '9':
                  case ':':
                  case ';':
                  case '<':
                  case '=':
                  case '>':
                  case '?':
                  case '@':
                    goto LABEL_493;
                  default:
                    if ( this->PlayerWeaponMode.Mode )
                    {
LABEL_493:
                      if ( FindPlayerPed(-1)
                        && ((*((_BYTE *)FindPlayerPed(-1)->m_pPlayerData + 52) & 8) != 0
                         || FindPlayerPed(-1)->m_pEntLockOnTarget) )
                      {
LABEL_497:
                        v270 = currentPad;
                        if ( !currentPad )
                          v270 = CPad::GetPad(0);
                        if ( CPad::GetExitTargeting(v270) )
                        {
                          this->PlayerWeaponMode.MinZoom = -1;
                          this->PlayerWeaponMode.MaxZoom = 1;
                          this->PlayerWeaponMode.Mode = 0;
                          *p_Duration = 0.0;
                          if ( FindPlayerPed(-1) )
                          {
                            if ( FindPlayerPed(-1)->m_nPedState == PED_SNIPER_MODE )
                            {
                              v271 = FindPlayerPed(-1);
                              CPed::SetPedState(v271, PED_IDLE);
                            }
                          }
                        }
                      }
                      else
                      {
                        switch ( this->PlayerWeaponMode.Mode )
                        {
                          case 7:
                          case 8:
                          case 0x22:
                          case 0x2D:
                          case 0x2E:
                          case 0x33:
                          case 0x41:
                            goto LABEL_497;
                          default:
                            goto LABEL_445;
                        }
                      }
                    }
                    break;
                }
              }
LABEL_445:
              CHID::currentInstanceIndex = 0;
              if ( FindPlayerPed(-1) && !FindPlayerPed(-1)->m_pAttachToEntity )
              {
                v255 = currentPad;
                if ( !currentPad )
                  v255 = CPad::GetPad(0);
                if ( CPad::CycleWeaponLeftJustDown(v255) && !CHID::Implements(HID_MAPPING_PREV_WEAPON) )
                  goto LABEL_455;
                v256 = currentPad;
                if ( !currentPad )
                  v256 = CPad::GetPad(0);
                if ( CPad::CycleWeaponRightJustDown(v256) && !CHID::Implements(HID_MAPPING_NEXT_WEAPON) )
                {
LABEL_455:
                  v257 = FindPlayerPed(-1);
                  CPlayerPed::ClearWeaponTarget(v257);
                  v258 = FindPlayerPed(-1);
                  *((_WORD *)v258->m_pPlayerData + 26) &= ~8u;
                }
              }
              if ( this->m_PlayerMode.Mode )
                CCamera::CamControl(void)::ReqMode = this->m_PlayerMode.Mode;
              Mode = (unsigned __int16)this->PlayerWeaponMode.Mode;
              if ( !this->PlayerWeaponMode.Mode || v219 )
                goto LABEL_755;
              switch ( this->PlayerWeaponMode.Mode )
              {
                case 7:
                case 8:
                case 0x22:
                case 0x2D:
                case 0x2E:
                case 0x33:
                  goto LABEL_461;
                default:
                  v272 = (char *)this + 528 * this->ActiveCam;
                  v273 = *((_DWORD *)v272 + 217);
                  if ( v273 && (*(_BYTE *)(v273 + 58) & 7) == 3 && *(_BYTE *)(v273 + 28 * *(char *)(v273 + 1820) + 1464) )
                  {
LABEL_461:
                    v219 = 0;
                    CCamera::CamControl(void)::ReqMode = this->PlayerWeaponMode.Mode;
                    if ( Mode == 37 || CWorld::Players[CWorld::PlayerInFocus].pPed->m_nPedState != PED_SEEK_CAR )
                      goto LABEL_755;
                    v260 = this->Cams[this->ActiveCam].CamTargetEntity;
                    if ( !v260
                      || (*(_BYTE *)&v260->m_info & 7) != 3
                      || !*((_BYTE *)&v260[24].m_pRwObject + 28 * SLOBYTE(v260[30].m_pMat)) )
                    {
                      v41 = 4;
                      goto LABEL_467;
                    }
                    goto LABEL_507;
                  }
                  if ( CCamera::CamControl(void)::ReqMode == 37 )
                    goto LABEL_507;
                  v289 = this->pTargetEntity;
                  v290 = *((float *)v272 + 185);
                  v291 = *((float *)v272 + 186);
                  v292 = v289->m_pMat;
                  p_x = &v292->tx;
                  if ( !v292 )
                    p_x = &v289->m_transform.m_translate.x;
                  v294 = *p_x;
                  y = this->m_cvecAimingTargetCoors.y;
                  v296 = p_x[1];
                  x = this->m_cvecAimingTargetCoors.x;
                  if ( FindPlayerPed(-1)->m_pEntLockOnTarget
                    && (*(_BYTE *)&FindPlayerPed(-1)->m_pEntLockOnTarget->m_info & 7) == 3 )
                  {
                    m_pEntLockOnTarget = FindPlayerPed(-1)->m_pEntLockOnTarget;
                  }
                  else
                  {
                    m_pEntLockOnTarget = 0;
                  }
                  if ( !FindPlayerPed(-1)->m_pEntLockOnTarget
                    && (*((_BYTE *)FindPlayerPed(-1)->m_pPlayerData + 52) & 8) == 0
                    && !CHID::IsReleased(HID_MAPPING_ATTACK) )
                  {
                    goto LABEL_507;
                  }
                  v321 = 0;
                  v322 = v290 - v294;
                  v323 = x - v294;
                  if ( m_pEntLockOnTarget )
                  {
                    v324 = 0.0;
                    if ( ((int)m_pEntLockOnTarget[18].m_pMat & 0xFFFFFFFE) == 54 )
                    {
                      v324 = 3.0;
                      v321 = 1;
                    }
                  }
                  else
                  {
                    v324 = 0.0;
                  }
                  ATanOfXY = CGeneral::GetATanOfXY(v322, v291 - v296);
                  CGeneral::GetATanOfXY(v323, y - v296);
                  CCamera::CamControl(void)::ReqMode = this->PlayerWeaponMode.Mode;
                  v345 = (unsigned __int16)CCamera::CamControl(void)::ReqMode;
                  if ( CCamera::CamControl(void)::ReqMode != 53 || !v321 )
                    goto LABEL_793;
                  if ( !FindPlayerPed(-1)->m_pEntLockOnTarget )
                    goto LABEL_792;
                  v346 = (unsigned __int16)this->Cams[this->ActiveCam].Mode;
                  if ( this->m_uiTransitionState )
                  {
                    if ( v346 != 35 )
                      goto LABEL_792;
                  }
                  else if ( v346 != 35 )
                  {
                    goto LABEL_790;
                  }
                  if ( (*(_BYTE *)&FindPlayerPed(-1)->m_pEntLockOnTarget->m_info & 7) == 3 )
                    v324 = 4.0;
LABEL_790:
                  if ( sqrtf((float)(v323 * v323) + (float)((float)(y - v296) * (float)(y - v296))) < v324 )
                  {
                    v465 = 5.6;
                    CCamera::CamControl(void)::ReqMode = 35;
                    goto LABEL_795;
                  }
LABEL_792:
                  v345 = (unsigned __int16)CCamera::CamControl(void)::ReqMode;
LABEL_793:
                  if ( v345 != 35 )
                  {
                    v219 = 0;
                    CCamera::CamControl(void)::PlaceForFixedWhenSniperFound = 0;
                    goto LABEL_755;
                  }
                  v465 = 0.0;
LABEL_795:
                  v219 = 0;
                  if ( !CCamera::CamControl(void)::PlaceForFixedWhenSniperFound )
                  {
                    v483 = 0;
                    v466 = this->pTargetEntity;
                    v467 = v466->m_pMat;
                    p_m_translate = (const CVector *)&v467->tx;
                    if ( !v467 )
                      p_m_translate = &v466->m_transform.m_translate;
                    v469 = cosf(ATanOfXY);
                    v470 = sinf(ATanOfXY);
                    z = p_m_translate->z;
                    *(_QWORD *)&ppDoor1.x = *(_QWORD *)&p_m_translate->x;
                    ppDoor1.x = ppDoor1.x + (float)(v465 * v469);
                    ppDoor1.y = ppDoor1.y + (float)(v465 * v470);
                    ppDoor1.z = z + 1.15;
                    if ( CWorld::ProcessLineOfSight(p_m_translate, &ppDoor1, &v480, &v483, 1, 0, 0, 1, 0, 1, 1, 0) == 1 )
                    {
                      v472 = *(_QWORD *)&v480.m_vecPosition.x;
                      v473 = v480.m_vecPosition.z;
                    }
                    else
                    {
                      v473 = ppDoor1.z;
                      v472 = *(_QWORD *)&ppDoor1.x;
                    }
                    this->m_vecFixedModeSource.z = v473;
                    v219 = 0;
                    *(_QWORD *)&this->m_vecFixedModeSource.x = v472;
                    this->m_bGarageFixedCamPositionSet = 0;
                    this->m_vecFixedModeUpOffSet.x = 0.0;
                    this->m_vecFixedModeUpOffSet.y = 0.0;
                    this->m_vecFixedModeUpOffSet.z = 0.0;
                    CCamera::CamControl(void)::PlaceForFixedWhenSniperFound = 1;
                  }
                  goto LABEL_755;
              }
            }
            if ( this->m_bGarageFixedCamPositionSet || !this->m_bLookingAtPlayer )
              goto LABEL_425;
            pToGarageWeAreIn = this->pToGarageWeAreIn;
            v262 = v219 == 0;
            if ( !v219 )
              v262 = pToGarageWeAreIn == 0;
            if ( v262 )
            {
LABEL_425:
              ShouldBeOutside = CGarages::CameraShouldBeOutside();
              v251 = v219 == 0;
              if ( !v219 )
                v251 = !ShouldBeOutside;
              if ( v251 )
                goto LABEL_846;
              v252 = !this->m_bLookingAtPlayer;
              if ( this->m_bLookingAtPlayer )
                v252 = !this->m_bGarageFixedCamPositionSet;
              if ( v252 )
              {
LABEL_846:
                if ( this->m_bPlayerIsInGarage )
                {
                  this->m_bPlayerIsInGarage = 0;
                  this->m_bJustCameOutOfGarage = 1;
                }
                CCamera::CamControl(void)::ReqMode = 4;
              }
              else
              {
                v253 = v219 == 0;
                if ( !v219 )
                  v253 = this->pToGarageWeAreIn == 0;
                if ( !v253 )
                {
                  CCamera::CamControl(void)::ReqMode = 15;
                  this->m_bPlayerIsInGarage = 1;
                }
              }
              goto LABEL_441;
            }
            if ( pToGarageWeAreIn )
            {
              CGarage::FindDoorsWithGarage(pToGarageWeAreIn, (CObject **)&v480, (CObject **)ppDoor2);
              v263 = v480.m_vecPosition.x;
              if ( !LODWORD(v480.m_vecPosition.x) )
              {
                if ( LODWORD(ppDoor2[0].x) )
                {
                  v265 = 2;
                  v266 = 0.0;
                  goto LABEL_602;
                }
                v263 = *(float *)&this->pTargetEntity;
              }
              v264 = *(_DWORD *)(LODWORD(v263) + 20);
              v265 = 1;
              v266 = 0.0;
              v267 = (__int64 *)(v264 + 48);
              if ( !v264 )
                v267 = (__int64 *)(LODWORD(v263) + 4);
              v2 = *v267;
            }
            else
            {
              v299 = (char *)this + 528 * this->ActiveCam;
              v266 = *((float *)v299 + 187);
              v2 = *(_QWORD *)(v299 + 740);
              if ( ZoneWithStairsAttributeForPlayer )
              {
                CZoneDef::FindCenter(&v480.m_vecPosition, &ZoneWithStairsAttributeForPlayer->ZoneDef);
                v300 = this->pTargetEntity;
                v7 = v480.m_vecPosition.x;
                v8 = v480.m_vecPosition.y;
                v301 = v300->m_pMat;
                v9 = v480.m_vecPosition.z;
                v302 = &v301->tx;
                if ( !v301 )
                  v302 = &v300->m_transform.m_translate.x;
                v303 = v302[1];
                v304 = *v302 - v480.m_vecPosition.x;
                v480.m_vecPosition.z = 0.0;
                v480.m_vecPosition.y = v303 - v480.m_vecPosition.y;
                v480.m_vecPosition.x = v304;
                CVector::Normalise(&v480.m_vecPosition);
                Vec1Y = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec1Y;
                Vec2Y = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec2Y;
                Vec1X = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec1X;
                Vec2X = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec2X;
                if ( Vec1Y < 0 )
                  Vec1Y = -Vec1Y;
                if ( Vec2Y < 0 )
                  Vec2Y = -Vec2Y;
                if ( Vec1X < 0 )
                  Vec1X = -Vec1X;
                if ( Vec2X < 0 )
                  Vec2X = -Vec2X;
                if ( Vec2X + Vec1X > Vec2Y + Vec1Y )
                {
                  Vec2Y = Vec2X;
                  Vec1Y = Vec1X;
                }
                v309 = (float)(Vec1Y + Vec2Y);
                v310 = this->pTargetEntity;
                v311 = v310->m_pMat;
                v312 = (const CVector *)&v311->tx;
                v313 = v309 + v309;
                if ( !v311 )
                  v312 = &v310->m_transform.m_translate;
                v314 = v312->y + (float)(v480.m_vecPosition.y * v313);
                v315 = v312->z + (float)(v480.m_vecPosition.z * v313);
                ppDoor2[0].x = v312->x + (float)(v480.m_vecPosition.x * v313);
                ppDoor2[0].y = v314;
                ppDoor2[0].z = v315;
                if ( CWorld::GetIsLineOfSightClear(v312, ppDoor2, 1, 0, 0, 0, 0, 0, 1) )
                  goto LABEL_557;
                v316 = this->pTargetEntity;
                v317 = v316->m_pMat;
                v318 = (const CVector *)&v317->tx;
                if ( !v317 )
                  v318 = &v316->m_transform.m_translate;
                v319 = v318->y - (float)(v313 * v480.m_vecPosition.y);
                v320 = v318->z - (float)(v313 * v480.m_vecPosition.z);
                ppDoor2[0].x = v318->x - (float)(v313 * v480.m_vecPosition.x);
                ppDoor2[0].y = v319;
                ppDoor2[0].z = v320;
                if ( CWorld::GetIsLineOfSightClear(v318, ppDoor2, 1, 0, 0, 0, 0, 0, 1) )
                {
LABEL_557:
                  v266 = ppDoor2[0].z;
                  v2 = *(_QWORD *)&ppDoor2[0].x;
                }
                v265 = 1;
              }
              else
              {
                v265 = 1;
              }
            }
LABEL_602:
            v347 = this->pToGarageWeAreIn;
            if ( v347 )
            {
              v9 = 0.0;
              v7 = (float)(v347->MinX + v347->MaxX) * 0.5;
              v8 = (float)(v347->MinY + v347->MaxY) * 0.5;
            }
            else if ( ZoneWithStairsAttributeForPlayer )
            {
              v266 = 0.0;
            }
            else
            {
              v348 = this->pTargetEntity;
              v266 = 0.0;
              v9 = 0.0;
              v349 = v348->m_pMat;
              v350 = &v349->tx;
              if ( !v349 )
                v350 = &v348->m_transform.m_translate.x;
              v7 = *v350;
              v8 = v350[1];
            }
            v351 = 0.0;
            v352 = *((float *)&v2 + 1);
            v353 = *(float *)&v2;
            v354 = 0.0;
            if ( v265 == 1 )
              v354 = v266;
            ppDoor2[0].y = *((float *)&v2 + 1) - v8;
            ppDoor2[0].x = *(float *)&v2 - v7;
            ppDoor2[0].z = v354 - v9;
            v355 = this->pTargetEntity;
            v356 = v355->m_pMat;
            v357 = &v356->tx;
            if ( !v356 )
              v357 = &v355->m_transform.m_translate.x;
            v358 = *v357;
            v359 = v357[1];
            v360 = v357[2];
            GroundZFor3DCoord = CWorld::FindGroundZFor3DCoord(*v357, v359, v360, (bool *)&v480, 0);
            if ( !LOBYTE(v480.m_vecPosition.x) )
              GroundZFor3DCoord = v360 + -0.2;
            ppDoor2[0].z = 0.0;
            if ( v265 == 1 )
            {
              v362 = this->pToGarageWeAreIn;
              CVector::Normalise(ppDoor2);
              if ( !v219 || v362 )
              {
                v370 = 13.0;
              }
              else
              {
                if ( ZoneWithStairsAttributeForPlayer )
                {
                  v363 = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec1Y;
                  v364 = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec2Y;
                  v365 = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec1X;
                  v366 = ZoneWithStairsAttributeForPlayer->ZoneDef.Vec2X;
                  if ( v363 < 0 )
                    v363 = -v363;
                  if ( v364 < 0 )
                    v364 = -v364;
                  if ( v365 < 0 )
                    v365 = -v365;
                  if ( v366 < 0 )
                    v366 = -v366;
                  if ( v366 + v365 > v364 + v363 )
                  {
                    v364 = v366;
                    v363 = v365;
                  }
                  v367 = (float)((float)(v363 + v364) * 0.7) + 3.75;
                  v353 = ppDoor2[0].x * v367;
                  v352 = ppDoor2[0].y * v367;
                  v368 = v7;
                  v369 = v8;
LABEL_635:
                  v373 = v219 == 0;
                  if ( !v219 )
                    v373 = this->m_nPedZoom == 4;
                  if ( !v373 )
                  {
                    v377 = v369 + v352;
                    v378 = v368 + v353;
                    v379 = this->pToGarageWeAreIn;
                    MaxX = GroundZFor3DCoord + 3.1;
                    goto LABEL_646;
                  }
                  v374 = FindPlayerPed(-1);
                  v375 = v374->m_pMat;
                  p_m_transform = (CSimpleTransform *)&v375->tx;
                  if ( !v375 )
                    p_m_transform = &v374->m_transform;
                  v379 = this->pToGarageWeAreIn;
                  MaxX = v9 + (float)(p_m_transform->m_translate.z + 2.1);
                  if ( v379 )
                  {
                    if ( MaxX > v379->MaxX )
                    {
                      v378 = v7;
                      v377 = v8;
                      MaxX = v379->MaxX;
                      goto LABEL_646;
                    }
                  }
                  else
                  {
                    v379 = 0;
                  }
                  v378 = v7;
                  v377 = v8;
LABEL_646:
                  this->m_vecFixedModeUpOffSet.x = 0.0;
                  this->m_vecFixedModeUpOffSet.y = 0.0;
                  this->m_vecFixedModeUpOffSet.z = 0.0;
                  this->m_bGarageFixedCamPositionSet = 1;
                  this->m_vecFixedModeSource.z = MaxX;
                  this->m_vecFixedModeSource.y = v377;
                  this->m_vecFixedModeSource.x = v378;
                  if ( v379 )
                  {
                    CGarage::FindDoorsWithGarage(v379, (CObject **)&ppDoor1, &v483);
                    v381 = 0.0;
                    v382 = 0.0;
                    v383 = 0.0;
                    if ( LODWORD(ppDoor1.x) )
                    {
                      v384 = *(_DWORD *)(LODWORD(ppDoor1.x) + 376);
                      v385 = *(RwReal **)(v384 + 20);
                      v386 = (float *)(v384 + 4);
                      if ( v385 )
                        v386 = v385 + 12;
                      v381 = *v386;
                      v382 = v386[1];
                      v383 = v386[2];
                      if ( !v385 )
                      {
                        CPlaceable::AllocateMatrix(*(CPlaceable **)(LODWORD(ppDoor1.x) + 376));
                        CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(v384 + 4), *(CMatrix **)(v384 + 20));
                        v385 = *(RwReal **)(v384 + 20);
                      }
                      v387 = *(_QWORD *)v385;
                      v480.m_vecPosition.z = v385[2];
                      *(_QWORD *)&v480.m_vecPosition.x = v387;
                    }
                    v388 = v483;
                    if ( v483 )
                    {
                      m_pRelatedDummy = v483->m_pRelatedDummy;
                      v390 = m_pRelatedDummy->m_pMat;
                      v391 = &m_pRelatedDummy->m_transform.m_translate.x;
                      if ( v390 )
                        v391 = &v390->tx;
                      v351 = *v391;
                      v392 = v391[1];
                      v393 = v391[2];
                      if ( !v390 )
                      {
                        CPlaceable::AllocateMatrix(v483->m_pRelatedDummy);
                        CSimpleTransform::UpdateMatrix(&m_pRelatedDummy->m_transform, m_pRelatedDummy->m_pMat);
                        v390 = m_pRelatedDummy->m_pMat;
                        v388 = v483;
                      }
                      v394 = *(_QWORD *)&v390->xx;
                      v480.m_vecPosition.z = v390->zx;
                      *(_QWORD *)&v480.m_vecPosition.x = v394;
                    }
                    else
                    {
                      v388 = 0;
                      v392 = 0.0;
                      v393 = 0.0;
                    }
                    if ( LODWORD(ppDoor1.x) )
                    {
                      if ( v388 )
                      {
                        v393 = v383 + (float)((float)(v393 - v383) * 0.5);
                        v392 = v382 + (float)((float)(v392 - v382) * 0.5);
                        v351 = v381 + (float)((float)(v351 - v381) * 0.5);
                      }
                      else
                      {
                        v351 = v381;
                        v392 = v382;
                        v393 = v383;
                      }
                    }
                    else if ( !v388 )
                    {
                      v480.m_vecPosition.z = 0.0;
                      v480.m_vecPosition.y = v359 - v8;
                      v480.m_vecPosition.x = v358 - v7;
                      CVector::Normalise(&v480.m_vecPosition);
                      v351 = v358;
                      v392 = v359;
                      v393 = v360;
                    }
                    v395 = v480.m_vecPosition.z * 10.0;
                    v396 = v480.m_vecPosition.y;
                    v397 = v480.m_vecPosition.x * 10.0;
                    this->m_vecFixedModeUpOffSet.x = 0.0;
                    this->m_vecFixedModeUpOffSet.y = 0.0;
                    this->m_vecFixedModeUpOffSet.z = 0.0;
                    this->m_bGarageFixedCamPositionSet = 1;
                    this->m_vecFixedModeSource.y = v392 - (float)(v396 * 10.0);
                    this->m_vecFixedModeSource.x = v351 - v397;
                    this->m_vecFixedModeSource.z = (float)(v393 - v395) + 2.0;
                  }
                  goto LABEL_425;
                }
                v370 = 3.75;
              }
              v371 = ppDoor2[0].y;
              v372 = ppDoor2[0].x;
            }
            else
            {
              CVector::Normalise(ppDoor2);
              v370 = 13.0;
              v371 = ppDoor2[0].y;
              v372 = ppDoor2[0].x;
            }
            v369 = v371 * v370;
            v368 = v372 * v370;
            goto LABEL_635;
          }
          v222 = 3;
        }
        else
        {
          v222 = 1;
        }
        this->m_nPedZoom = v222;
        goto LABEL_808;
    }
  }
  if ( v40 != 2 )
  {
LABEL_507:
    v219 = 0;
    goto LABEL_755;
  }
  if ( v39[24]._vptr$CPlaceable == (int (**)(void))&byte_6 )
  {
    v41 = 3;
LABEL_467:
    CCamera::CamControl(void)::ReqMode = v41;
    v219 = 0;
    goto LABEL_755;
  }
  if ( this->m_WideScreenOn )
    goto LABEL_143;
  if ( !this->m_bFailedCullZoneTestPreviously )
  {
    if ( !this->m_bLookingAtPlayer && this->WhoIsInControlOfTheCamera != 2 || CGameLogic::IsCoopGameGoingOn() )
      goto LABEL_143;
    if ( CHID::GetInputType() == 1 || !CHID::GetInputType() )
    {
      v230 = currentPad;
      if ( !currentPad )
        v230 = CPad::GetPad(0);
      if ( CPad::CycleCameraModeDownJustDown(v230) )
      {
        v231 = CCamera::CamControl(void)::nZoomDir;
        v232 = this->m_nCarZoom + CCamera::CamControl(void)::nZoomDir;
        this->m_nCarZoom = v232;
        if ( v232 < 4 )
        {
          if ( v232 > -1 )
            goto LABEL_760;
          v233 = 1;
        }
        else
        {
          v233 = 2;
        }
        this->m_nCarZoom = v233;
        CCamera::CamControl(void)::nZoomDir = -v231;
      }
    }
LABEL_760:
    if ( CHID::GetInputType() == 2 )
    {
      if ( CHID::IsReleased(HID_MAPPING_CAMERA_CLOSER) )
      {
        CCamera::CamControl(void)::fCarClicks = CHID::GetMappingWeight(HID_MAPPING_CAMERA_CLOSER)
                                              + CCamera::CamControl(void)::fCarClicks;
        if ( CCamera::CamControl(void)::fCarClicks >= 1.0 )
        {
          v3.n64_u32[0] = 0;
          v4.n64_f32[0] = (float)(this->m_nCarZoom - 1);
          v3.n64_u64[0] = vmax_f32(v4, v3).n64_u64[0];
          this->m_nCarZoom = (int)v3.n64_f32[0];
          CCamera::CamControl(void)::fCarClicks = 0.0;
        }
      }
      if ( CHID::IsReleased(HID_MAPPING_CAMERA_FARTHER) )
      {
        CCamera::CamControl(void)::fCarClicks = CCamera::CamControl(void)::fCarClicks
                                              - CHID::GetMappingWeight(HID_MAPPING_CAMERA_FARTHER);
        if ( CCamera::CamControl(void)::fCarClicks <= -1.0 )
        {
          v3.n64_u32[0] = 3.0;
          v4.n64_f32[0] = (float)(this->m_nCarZoom + 1);
          v3.n64_u64[0] = vmin_f32(v4, v3).n64_u64[0];
          this->m_nCarZoom = (int)v3.n64_f32[0];
          CCamera::CamControl(void)::fCarClicks = 0.0;
        }
      }
    }
    if ( !this->m_nCarZoom && this->m_bDisableFirstPersonInCar )
    {
      v458 = currentPad;
      if ( !currentPad )
        v458 = CPad::GetPad(0);
      if ( CPad::CycleCameraModeDownJustDown(v458) )
        this->m_nCarZoom = 1;
    }
    v459 = `guard variable for'CCamera::CamControl(void)::nInitialZoom;
    __dmb(0xBu);
    if ( (v459 & 1) == 0 && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CamControl(void)::nInitialZoom) )
    {
      CCamera::CamControl(void)::nInitialZoom = this->m_nCarZoom;
      _cxa_guard_release((__guard *)&`guard variable for'CCamera::CamControl(void)::nInitialZoom);
    }
    if ( !CTouchInterface::IsPinchZooming(WIDGET_LOOK, 0, 1) )
    {
      CCamera::CamControl(void)::fInitialDistance = 0.0;
      goto LABEL_143;
    }
    if ( CHID::Implements(HID_MAPPING_CAMERA_CLOSER) || (v460 = CTouchInterface::m_pWidgets[175]) == 0 )
    {
LABEL_143:
      if ( !this->m_bFailedCullZoneTestPreviously )
        goto LABEL_362;
      goto LABEL_360;
    }
    if ( CCamera::CamControl(void)::fInitialDistance == 0.0 )
    {
      LODWORD(CCamera::CamControl(void)::fInitialDistance) = (*((int (__fastcall **)(CWidget *))CTouchInterface::m_pWidgets[175]->_vptr$CWidget
                                                              + 6))(CTouchInterface::m_pWidgets[175]);
      CCamera::CamControl(void)::nInitialZoom = this->m_nCarZoom;
    }
    if ( (float)((*((float (__fastcall **)(CWidget *))v460->_vptr$CWidget + 6))(v460)
               - CCamera::CamControl(void)::fInitialDistance) <= 250.0 )
    {
      if ( (float)((*((float (__fastcall **)(CWidget *))v460->_vptr$CWidget + 6))(v460)
                 - CCamera::CamControl(void)::fInitialDistance) <= 125.0 )
      {
        if ( (float)((*((float (__fastcall **)(CWidget *))v460->_vptr$CWidget + 6))(v460)
                   - CCamera::CamControl(void)::fInitialDistance) >= -250.0 )
        {
          if ( (float)((*((float (__fastcall **)(CWidget *))v460->_vptr$CWidget + 6))(v460)
                     - CCamera::CamControl(void)::fInitialDistance) >= -125.0 )
          {
            m_nCarZoom = this->m_nCarZoom;
            goto LABEL_833;
          }
          v461 = 1;
        }
        else
        {
          v461 = 2;
        }
      }
      else
      {
        v461 = -1;
      }
    }
    else
    {
      v461 = -2;
    }
    m_nCarZoom = v461 + CCamera::CamControl(void)::nInitialZoom;
    this->m_nCarZoom = m_nCarZoom;
LABEL_833:
    v3.n64_u32[0] = 1.0;
    v4.n64_f32[0] = (float)m_nCarZoom;
    v5.n64_u32[0] = 3.0;
    v3.n64_u64[0] = vmin_f32(vmax_f32(v4, v3), v5).n64_u64[0];
    this->m_nCarZoom = (int)v3.n64_f32[0];
    goto LABEL_143;
  }
LABEL_360:
  if ( (this->m_nCarZoom | 4) != 4 )
    CCamera::CamControl(void)::ReqMode = 18;
LABEL_362:
  v217 = this->pTargetEntity;
  v218 = (int)v217[24]._vptr$CPlaceable;
  if ( v218 == 5 )
  {
    v218 = 5;
    if ( v217->m_nModelIndex == 460 )
      v218 = 0;
  }
  v219 = 0;
  if ( v218 )
  {
    if ( v218 == 5 )
    {
      v219 = 0;
      v228 = 22;
LABEL_707:
      CCamera::CamControl(void)::ReqMode = v228;
      goto LABEL_708;
    }
    if ( v218 != 9 )
      goto LABEL_708;
    if ( CCullZones::CamStairsForPlayer() == 1 )
    {
      v220 = CCullZones::FindZoneWithStairsAttributeForPlayer();
      v219 = (int)v220;
      if ( v220 )
        v219 = 1;
    }
    else
    {
      v220 = 0;
      v219 = 0;
    }
  }
  else
  {
    v220 = 0;
  }
  v274 = this->pTargetEntity;
  v275 = v274->m_pMat;
  v276 = (CVector *)&v275->tx;
  if ( !v275 )
    v276 = &v274->m_transform.m_translate;
  v277 = CGarages::IsPointInAGarageCameraZone(*v276);
  v278 = v219 == 0;
  if ( !v219 )
    v278 = v277 == 0;
  if ( v278 )
  {
    v219 = 0;
    if ( this->m_bPlayerIsInGarage )
    {
      this->m_bPlayerIsInGarage = 0;
      this->m_bJustCameOutOfGarage = 1;
    }
    this->m_bGarageFixedCamPositionSet = 0;
    goto LABEL_706;
  }
  ppDoor1.x = 0.0;
  v483 = 0;
  if ( !this->m_bGarageFixedCamPositionSet && this->m_bLookingAtPlayer || this->WhoIsInControlOfTheCamera == 2 )
  {
    v279 = this->pToGarageWeAreIn;
    v280 = v220 == 0;
    if ( !v220 )
      v280 = v279 == 0;
    if ( !v280 )
    {
      v281 = this->pTargetEntity;
      v282 = v281->m_pMat;
      v283 = &v282->tx;
      if ( !v282 )
        v283 = &v281->m_transform.m_translate.x;
      v284 = *v283;
      v285 = v283[1];
      v286 = v283[2];
      if ( v279 )
      {
        CGarage::FindDoorsWithGarage(v279, (CObject **)&ppDoor1, &v483);
        if ( !LODWORD(ppDoor1.x) )
        {
          if ( v483 )
          {
            v342 = 2;
          }
          else
          {
            v462 = this->pTargetEntity;
            v463 = v462->m_pMat;
            v464 = (CSimpleTransform *)&v463->tx;
            if ( !v463 )
              v464 = &v462->m_transform;
            v342 = 1;
            v1 = v464->m_translate.y;
            HIDWORD(v2) = LODWORD(v464->m_translate.x);
          }
          goto LABEL_586;
        }
        v287 = *(_DWORD *)(LODWORD(ppDoor1.x) + 20);
        v9 = 0.0;
        v288 = v287 + 48;
        if ( !v287 )
          v288 = LODWORD(ppDoor1.x) + 4;
        v1 = *(float *)(v288 + 4);
        HIDWORD(v2) = *(_DWORD *)v288;
      }
      else
      {
        v325 = (float *)((char *)this + 528 * this->ActiveCam);
        v1 = v325[186];
        *((float *)&v2 + 1) = v325[185];
        v9 = v325[187];
        if ( sqrtf(
               (float)((float)(v284 - *((float *)&v2 + 1)) * (float)(v284 - *((float *)&v2 + 1)))
             + (float)((float)(v285 - v1) * (float)(v285 - v1))) > 15.0 )
        {
          memset(&v480, 0, 12);
          CVector::Normalise(&v480.m_vecPosition);
          v326 = v220->ZoneDef.Vec1Y;
          v327 = v220->ZoneDef.Vec2Y;
          v328 = v220->ZoneDef.Vec1X;
          v329 = v220->ZoneDef.Vec2X;
          if ( v326 < 0 )
            v326 = -v326;
          if ( v327 < 0 )
            v327 = -v327;
          if ( v328 < 0 )
            v328 = -v328;
          if ( v329 < 0 )
            v329 = -v329;
          if ( v329 + v328 > v327 + v326 )
          {
            v327 = v329;
            v326 = v328;
          }
          v330 = (float)(v326 + v327);
          v331 = this->pTargetEntity;
          v332 = v331->m_pMat;
          v333 = (const CVector *)&v332->tx;
          v334 = v330 + v330;
          if ( !v332 )
            v333 = &v331->m_transform.m_translate;
          v335 = v333->y + (float)(v480.m_vecPosition.y * v334);
          v336 = v333->z + (float)(v480.m_vecPosition.z * v334);
          ppDoor2[0].x = v333->x + (float)(v480.m_vecPosition.x * v334);
          ppDoor2[0].y = v335;
          ppDoor2[0].z = v336;
          if ( CWorld::GetIsLineOfSightClear(v333, ppDoor2, 1, 0, 0, 0, 0, 0, 1) )
            goto LABEL_584;
          v337 = this->pTargetEntity;
          v338 = v337->m_pMat;
          v339 = (const CVector *)&v338->tx;
          if ( !v338 )
            v339 = &v337->m_transform.m_translate;
          v340 = v339->y - (float)(v334 * v480.m_vecPosition.y);
          v341 = v339->z - (float)(v334 * v480.m_vecPosition.z);
          ppDoor2[0].x = v339->x - (float)(v334 * v480.m_vecPosition.x);
          ppDoor2[0].y = v340;
          ppDoor2[0].z = v341;
          if ( CWorld::GetIsLineOfSightClear(v339, ppDoor2, 1, 0, 0, 0, 0, 0, 1) )
          {
LABEL_584:
            v9 = ppDoor2[0].z;
            HIDWORD(v2) = LODWORD(ppDoor2[0].x);
            v1 = ppDoor2[0].y;
          }
        }
      }
      v342 = 1;
LABEL_586:
      v343 = this->pToGarageWeAreIn;
      if ( v343 )
      {
        v286 = 0.0;
        v284 = (float)(v343->MinX + v343->MaxX) * 0.5;
        v285 = (float)(v343->MinY + v343->MaxY) * 0.5;
      }
      else if ( v220 )
      {
        v9 = 0.0;
      }
      else
      {
        v398 = this->pTargetEntity;
        v9 = 0.0;
        v286 = 0.0;
        v399 = v398->m_pMat;
        v400 = &v399->tx;
        if ( !v399 )
          v400 = &v398->m_transform.m_translate.x;
        v284 = *v400;
        v285 = v400[1];
      }
      v401 = 0.0;
      v402 = 0.0;
      if ( v342 == 1 )
        v402 = v9;
      ppDoor2[0].y = v1 - v285;
      ppDoor2[0].x = *((float *)&v2 + 1) - v284;
      ppDoor2[0].z = v402 - v286;
      v403 = this->pTargetEntity;
      v404 = v403->m_pMat;
      v405 = (CSimpleTransform *)&v404->tx;
      if ( !v404 )
        v405 = &v403->m_transform;
      v406 = v405->m_translate.x;
      v407 = v405->m_translate.y;
      v408 = v405->m_translate.z;
      CWorld::FindGroundZFor3DCoord(v405->m_translate.x, v407, v408, &pBool, 0);
      ppDoor2[0].z = 0.0;
      CVector::Normalise(ppDoor2);
      v409 = 0.0;
      v410 = 0.0;
      v411 = 0.0;
      if ( LODWORD(ppDoor1.x) )
      {
        v412 = *(_DWORD *)(LODWORD(ppDoor1.x) + 376);
        v413 = *(RwReal **)(v412 + 20);
        v414 = (float *)(v412 + 4);
        if ( v413 )
          v414 = v413 + 12;
        v409 = *v414;
        v410 = v414[1];
        v411 = v414[2];
        if ( !v413 )
        {
          CPlaceable::AllocateMatrix(*(CPlaceable **)(LODWORD(ppDoor1.x) + 376));
          CSimpleTransform::UpdateMatrix((const CSimpleTransform *)(v412 + 4), *(CMatrix **)(v412 + 20));
          v413 = *(RwReal **)(v412 + 20);
        }
        v415 = *(_QWORD *)v413;
        v480.m_vecPosition.z = v413[2];
        *(_QWORD *)&v480.m_vecPosition.x = v415;
      }
      v416 = v483;
      if ( v483 )
      {
        v417 = v483->m_pRelatedDummy;
        v418 = v417->m_pMat;
        v419 = &v417->m_transform.m_translate.x;
        if ( v418 )
          v419 = &v418->tx;
        v401 = *v419;
        v420 = v419[1];
        v421 = v419[2];
        if ( !v418 )
        {
          CPlaceable::AllocateMatrix(v483->m_pRelatedDummy);
          CSimpleTransform::UpdateMatrix(&v417->m_transform, v417->m_pMat);
          v418 = v417->m_pMat;
          v416 = v483;
        }
        v422 = *(_QWORD *)&v418->xx;
        v480.m_vecPosition.z = v418->zx;
        *(_QWORD *)&v480.m_vecPosition.x = v422;
      }
      else
      {
        v416 = 0;
        v420 = 0.0;
        v421 = 0.0;
      }
      if ( LODWORD(ppDoor1.x) )
      {
        if ( v416 )
        {
          v421 = v411 + (float)((float)(v421 - v411) * 0.5);
          v420 = v410 + (float)((float)(v420 - v410) * 0.5);
          v401 = v409 + (float)((float)(v401 - v409) * 0.5);
        }
        else
        {
          v401 = v409;
          v420 = v410;
          v421 = v411;
        }
      }
      else if ( !v416 )
      {
        v480.m_vecPosition.z = 0.0;
        v480.m_vecPosition.y = v407 - v285;
        v480.m_vecPosition.x = v406 - v284;
        CVector::Normalise(&v480.m_vecPosition);
        v401 = v406;
        v420 = v407;
        v421 = v408;
      }
      v423 = v480.m_vecPosition.z;
      v424 = v480.m_vecPosition.y;
      v425 = v480.m_vecPosition.x;
      this->m_vecFixedModeUpOffSet.x = 0.0;
      this->m_vecFixedModeUpOffSet.y = 0.0;
      this->m_vecFixedModeUpOffSet.z = 0.0;
      this->m_bGarageFixedCamPositionSet = 1;
      this->m_vecFixedModeSource.y = v420 - (float)(v424 * 10.0);
      this->m_vecFixedModeSource.x = v401 - (float)(v425 * 10.0);
      this->m_vecFixedModeSource.z = (float)(v421 - (float)(v423 * 10.0)) + 2.0;
    }
  }
  v426 = CGarages::CameraShouldBeOutside();
  v427 = v219 == 0;
  if ( !v219 )
    v427 = !v426;
  if ( v427 || !this->m_bGarageFixedCamPositionSet || !this->m_bLookingAtPlayer && this->WhoIsInControlOfTheCamera != 2 )
  {
    if ( this->m_bPlayerIsInGarage )
    {
      this->m_bPlayerIsInGarage = 0;
      this->m_bJustCameOutOfGarage = 1;
    }
LABEL_706:
    v228 = 18;
    goto LABEL_707;
  }
  v428 = v220 == 0;
  if ( !v220 )
    v428 = this->pToGarageWeAreIn == 0;
  if ( !v428 )
  {
    CCamera::CamControl(void)::ReqMode = 15;
    this->m_bPlayerIsInGarage = 1;
  }
LABEL_708:
  v429 = CVehicle::GetVehicleAppearance((const CVehicle *)this->pTargetEntity) - 1;
  if ( v429 > 4 )
    v430 = 0;
  else
    v430 = dword_616840[v429];
  v431 = this->m_nCarZoom;
  switch ( v431 )
  {
    case 0:
      if ( !this->m_bPlayerIsInGarage )
      {
        this->m_fCarZoomBase = 0.0;
        CCamera::CamControl(void)::ReqMode = 16;
      }
      goto LABEL_719;
    case 1:
      v432 = &ZOOM_ONE_DISTANCE_ptr;
      goto LABEL_717;
    case 2:
      v432 = &ZOOM_TWO_DISTANCE_ptr;
      goto LABEL_717;
    case 3:
      v432 = &ZOOM_THREE_DISTANCE_ptr;
LABEL_717:
      v433 = LODWORD((**v432)[v430]);
      goto LABEL_718;
    case 4:
      if ( this->m_bPlayerIsInGarage )
        goto LABEL_719;
      v433 = 1065353216;
LABEL_718:
      LODWORD(this->m_fCarZoomBase) = v433;
LABEL_719:
      if ( this->m_fCarZoomTotal == 0.0 )
        this->m_fCarZoomTotal = this->m_fCarZoomBase;
      if ( this->m_bUseScriptZoomValueCar )
      {
        m_fCarZoomSmoothed = this->m_fCarZoomSmoothed;
        v3.n64_f32[0] = CTimer::ms_fTimeStep;
        v435 = CTimer::ms_fTimeStep * 0.12;
        m_fCarZoomValueScript = this->m_fCarZoomValueScript;
        if ( m_fCarZoomSmoothed >= m_fCarZoomValueScript )
        {
          v442 = m_fCarZoomSmoothed - v435;
          if ( m_fCarZoomValueScript <= v442 )
            m_fCarZoomValueScript = v442;
        }
        else
        {
          v437 = m_fCarZoomSmoothed + v435;
          if ( m_fCarZoomValueScript >= v437 )
            m_fCarZoomValueScript = v437;
        }
LABEL_748:
        v447 = 0.0;
        this->m_fCarZoomSmoothed = m_fCarZoomValueScript;
        goto LABEL_749;
      }
      v438 = this->m_fCarZoomSmoothed;
      if ( !this->m_bFailedCullZoneTestPreviously )
      {
        v3.n64_f32[0] = CTimer::ms_fTimeStep;
        v443 = CTimer::ms_fTimeStep * 0.12;
        m_fCarZoomBase = this->m_fCarZoomBase;
        if ( v438 >= m_fCarZoomBase )
        {
          v448 = v438 - v443;
          m_fCarZoomValueScript = this->m_fCarZoomBase;
          if ( m_fCarZoomBase <= v448 )
            m_fCarZoomValueScript = v448;
        }
        else
        {
          v445 = v438 + v443;
          m_fCarZoomValueScript = this->m_fCarZoomBase;
          if ( m_fCarZoomBase >= v445 )
            m_fCarZoomValueScript = v445;
        }
        v449 = m_fCarZoomValueScript;
        if ( m_fCarZoomBase == 0.0 )
          v449 = this->m_fCarZoomBase;
        if ( v431 == 3 )
          m_fCarZoomValueScript = v449;
        goto LABEL_748;
      }
      v3.n64_f32[0] = CTimer::ms_fTimeStep;
      v439 = CTimer::ms_fTimeStep * 0.12;
      v440 = -1088002458;
      if ( v438 >= -0.65 )
      {
        v446 = v438 - v439;
        if ( v446 >= -0.65 )
          v440 = LODWORD(v446);
      }
      else
      {
        v441 = v438 + v439;
        v440 = -1088002458;
        if ( v441 <= -0.65 )
          v440 = LODWORD(v441);
      }
      v447 = 0.65;
      LODWORD(this->m_fCarZoomSmoothed) = v440;
LABEL_749:
      v450 = (float *)((char *)this + 528 * this->ActiveCam);
      v451 = v450[108];
      v452 = v450[109];
      v453 = (float)(v447 - v451) * 0.1;
      v454 = fabsf(v453 - v452) * 0.25;
      v455 = -(float)(v3.n64_f32[0] * v454);
      v456 = v3.n64_f32[0] * v454;
      if ( (float)(v453 - v452) > 0.0 )
        v455 = v456;
      v457 = v452 + v455;
      v450[109] = v452 + v455;
      if ( v453 < 0.0 || v453 > 0.0 )
      {
        v457 = v453;
        v450[109] = v453;
      }
      v5.n64_u32[0] = 10.0;
      v450[108] = v451 + (float)(v457 * vmin_f32(v3, v5).n64_f32[0]);
      break;
    default:
      goto LABEL_719;
  }
LABEL_755:
  v20 = v219 != 0;
LABEL_21:
  if ( this->m_bCooperativeCamMode )
  {
    v21 = (CPlayerPed *)CWorld::Players;
    v22 = CWorld::Players[0].pPed == 0;
    if ( CWorld::Players[0].pPed )
    {
      v21 = CWorld::Players[1].pPed;
      v22 = CWorld::Players[1].pPed == 0;
    }
    if ( !v22 )
    {
      v23 = *((unsigned __int8 *)&CWorld::Players[0].pPed->m_nPedFlags + 1) << 31 == 0;
      if ( *((unsigned __int8 *)&CWorld::Players[0].pPed->m_nPedFlags + 1) << 31 )
        v23 = *((unsigned __int8 *)&v21->m_nPedFlags + 1) << 31 == 0;
      if ( v23 )
        goto LABEL_29;
      m_pMyVehicle = CWorld::Players[0].pPed->m_pMyVehicle;
      v30 = m_pMyVehicle == 0;
      if ( m_pMyVehicle )
      {
        v21 = (CPlayerPed *)v21->m_pMyVehicle;
        v30 = v21 == 0;
      }
      if ( v30 )
      {
LABEL_29:
        CCamera::CamControl(void)::ReqMode = this->m_ModeForTwoPlayersNotBothInCar;
      }
      else
      {
        if ( m_pMyVehicle == (CVehicle *)v21 )
        {
          if ( this->m_bAllowShootingWith2PlayersInCar )
            p_m_ModeForTwoPlayersSameCarShootingAllowed = &this->m_ModeForTwoPlayersSameCarShootingAllowed;
          else
            p_m_ModeForTwoPlayersSameCarShootingAllowed = &this->m_ModeForTwoPlayersSameCarShootingNotAllowed;
        }
        else
        {
          p_m_ModeForTwoPlayersSameCarShootingAllowed = &this->m_ModeForTwoPlayersSeparateCars;
        }
        CCamera::CamControl(void)::ReqMode = *p_m_ModeForTwoPlayersSameCarShootingAllowed;
        this->pTargetEntity = CWorld::Players[0].pPed->m_pMyVehicle;
      }
    }
  }
  v24 = CWorld::PlayerInFocus;
  m_nPedState = CWorld::Players[CWorld::PlayerInFocus].pPed->m_nPedState;
  if ( m_nPedState == PED_ARRESTED )
  {
    v26 = 1;
    v27 = 0;
LABEL_34:
    CCamera::CamControl(void)::bPreviouslyArrested = v26;
    goto LABEL_35;
  }
  v26 = 0;
  if ( CCamera::CamControl(void)::bPreviouslyArrested )
  {
    v27 = 1;
    goto LABEL_34;
  }
  v27 = 0;
LABEL_35:
  if ( CCamera::CamControl(void)::LastPedState == 63 )
  {
    CCamera::CamControl(void)::LastPedState = m_nPedState;
    if ( m_nPedState == PED_ARRESTED )
    {
LABEL_37:
      v28 = (unsigned __int8)CCamera::CamControl(void)::ThePickedArrestMode;
      if ( CCamera::CamControl(void)::ThePickedArrestMode )
        v28 = 32;
      CCamera::CamControl(void)::ReqMode = v28;
      goto LABEL_80;
    }
    goto LABEL_45;
  }
  if ( m_nPedState != PED_ARRESTED )
  {
    CCamera::CamControl(void)::LastPedState = m_nPedState;
LABEL_45:
    if ( m_nPedState != PED_DEAD )
      goto LABEL_80;
    goto LABEL_53;
  }
  if ( !this->m_nCarZoom && (*(_BYTE *)&this->pTargetEntity->m_info & 7) == 2 )
  {
    CCamera::CamControl(void)::LastPedState = 63;
    goto LABEL_37;
  }
  CCamera::CamControl(void)::ThePickedArrestMode = 1;
  CCamera::CamControl(void)::ReqMode = 32;
  CCamera::CamControl(void)::LastPedState = 63;
  this->Cams[this->ActiveCam].ResetStatics = 1;
  if ( CWorld::Players[v24].pPed->m_nPedState != PED_DEAD )
    goto LABEL_80;
LABEL_53:
  v32 = this->ActiveCam;
  this->m_bObbeCinematicCarCamOn = 0;
  v33 = (unsigned __int16)this->Cams[v32].Mode;
  if ( v33 == 32 )
  {
    CCamera::CamControl(void)::ReqMode = 32;
  }
  else if ( v33 == 29 )
  {
    CCamera::CamControl(void)::ReqMode = 29;
  }
  else
  {
    v42 = this->pTargetEntity;
    if ( (*(_BYTE *)&v42->m_info & 7) == 3 )
    {
      v479 = v27;
      v43 = v42[18].m_transform.m_translate.y;
      v44 = v20;
      v45 = 76;
      while ( 1 )
      {
        v46 = v45;
        v47 = *(_DWORD *)(LODWORD(v43) + 4 * v45);
        if ( v47 )
        {
          ActiveTaskByType = CTaskManager::FindActiveTaskByType(
                               (const CTaskManager *)(*(_DWORD *)(v47 + 1088) + 4),
                               1100);
          if ( ActiveTaskByType )
          {
            v49 = (CPlayerPed *)ActiveTaskByType[1]._vptr$CTask;
            if ( v49 == FindPlayerPed(-1) )
            {
              v50 = v42->m_pMat;
              v51 = *(_DWORD *)(v47 + 20);
              v52 = (CSimpleTransform *)&v50->tx;
              if ( !v50 )
                v52 = &v42->m_transform;
              v53 = v51 + 48;
              if ( !v51 )
                v53 = v47 + 4;
              v54.n64_u64[0] = vsub_f32(*(float32x2_t *)(v53 + 4), *(float32x2_t *)&v52->m_translate.y).n64_u64[0];
              v55 = vmul_f32(v54, v54).n64_u64[0];
              if ( sqrtf(
                     (float)((float)((float)(*(float *)v53 - v52->m_translate.x)
                                   * (float)(*(float *)v53 - v52->m_translate.x))
                           + *(float *)&v55)
                   + *((float *)&v55 + 1)) < 4.0 )
                break;
            }
          }
        }
        v45 = v46 + 1;
        if ( v46 - 76 >= 15 )
        {
          v20 = v44;
          v32 = this->ActiveCam;
          v27 = v479;
          goto LABEL_79;
        }
      }
      v20 = v44;
      CCamera::CamControl(void)::ReqMode = 32;
      this->Cams[this->ActiveCam].ResetStatics = 1;
      v27 = v479;
    }
    else
    {
LABEL_79:
      CCamera::CamControl(void)::ReqMode = 29;
      this->Cams[v32].ResetStatics = 1;
    }
  }
LABEL_80:
  if ( this->m_bRestoreByJumpCut )
  {
    switch ( CCamera::CamControl(void)::ReqMode )
    {
      case 3:
      case 4:
      case 7:
      case 8:
      case 11:
      case 18:
      case 28:
      case 34:
      case 35:
      case 46:
      case 51:
        break;
      default:
        if ( CHID::GetInputType() != 2 )
        {
          TheCamera.m_bCamDirectlyBehind = 1;
          v84 = FindPlayerPed(-1);
          if ( v84 )
            this->m_PedOrientForBehindOrInFront = CGeneral::GetATanOfXY(v84->m_pMat->xy, v84->m_pMat->yy);
        }
        break;
    }
    CCamera::CamControl(void)::ReqMode = this->m_iModeToGoTo;
    v56 = this->ActiveCam;
    v57 = (char *)this + 528 * v56;
    *((_WORD *)v57 + 191) = CCamera::CamControl(void)::ReqMode;
    this->m_bJust_Switched = 1;
    *((_WORD *)v57 + 189) = 257;
    v58 = *(_QWORD *)&this->m_vecFixedModeVector.x;
    v59 = (CEntity *)*((_DWORD *)v57 + 217);
    *((_DWORD *)v57 + 169) = LODWORD(this->m_vecFixedModeVector.z);
    *(_QWORD *)(v57 + 668) = v58;
    if ( v59 )
    {
      CEntity::CleanUpOldReference(v59, (CEntity **)v57 + 217);
      v56 = this->ActiveCam;
    }
    v60 = this->pTargetEntity;
    v61 = &this->Cams[v56];
    v61->CamTargetEntity = v60;
    CEntity::RegisterReference(v60, &v61->CamTargetEntity);
    v62 = this->ActiveCam;
    v63 = *(_QWORD *)&this->m_vecFixedModeSource.x;
    v64 = &this->Cams[v62];
    v64->m_cvecCamFixedModeSource.z = this->m_vecFixedModeSource.z;
    *(_QWORD *)&v64->m_cvecCamFixedModeSource.x = v63;
    v65 = &this->Cams[0].bBelowMinDist + 16 * (((v62 & 1) == 0) | (32 * ((v62 & 1) == 0)));
    v66 = *(_QWORD *)&this->m_vecFixedModeUpOffSet.x;
    v67 = this->m_vecFixedModeUpOffSet.z;
    v64->m_bCamLookingAtVector = 0;
    v64->m_cvecCamFixedModeUpOffSet.z = v67;
    *(_QWORD *)&v64->m_cvecCamFixedModeUpOffSet.x = v66;
    v68 = *((_QWORD *)v65 + 42);
    v64->m_vecLastAboveWaterCamPosition.z = *((RwReal *)v65 + 86);
    *(_QWORD *)&v64->m_vecLastAboveWaterCamPosition.x = v68;
    this->m_bRestoreByJumpCut = 0;
    v64->ResetStatics = 1;
    v69 = this->m_fCarZoomBase;
    m_fPedZoomBase = this->m_fPedZoomBase;
    this->m_uiTransitionState = 0;
    this->m_vecDoingSpecialInterPolation = 0;
    this->m_fCarZoomSmoothed = v69;
    this->m_fPedZoomSmoothed = m_fPedZoomBase;
  }
  if ( gbModelViewer )
    CCamera::CamControl(void)::ReqMode = 9;
  v71 = this->pTargetEntity;
  if ( v71 )
  {
    if ( (*(_BYTE *)&v71->m_info & 7) == 2 )
    {
      if ( this->m_nCarZoom == 5 )
        this->m_bObbeCinematicCarCamOn = 1;
    }
    else if ( this->m_nPedZoom == 5 )
    {
      this->m_bObbeCinematicPedCamOn = 1;
    }
  }
  if ( FindPlayerVehicle(-1, 0) && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 6 )
    this->m_bObbeCinematicCarCamOn = 1;
  v72 = this->pTargetEntity;
  if ( v72 && (*(_BYTE *)&v72->m_info & 7) == 2 && (v73 = FindPlayerPed(-1)) != 0 && (v73->m_nPedState | 8) == 63 )
  {
    v74 = 0;
    this->m_bObbeCinematicPedCamOn = 0;
    v75 = v73->m_nPedState;
    if ( v75 == PED_DEAD )
    {
      v76 = 29;
    }
    else
    {
      if ( v75 != PED_ARRESTED )
        goto LABEL_105;
      v76 = 32;
    }
    v74 = 0;
    CCamera::CamControl(void)::ReqMode = v76;
  }
  else
  {
    v74 = 1;
  }
LABEL_105:
  if ( this->m_bTargetJustBeenOnTrain )
  {
LABEL_107:
    v74 = 0;
  }
  else
  {
    switch ( CCamera::CamControl(void)::ReqMode )
    {
      case 7:
      case 8:
      case 11:
      case 23:
      case 28:
      case 29:
      case 32:
      case 33:
      case 34:
      case 35:
      case 36:
      case 39:
      case 40:
      case 41:
      case 42:
      case 43:
      case 45:
      case 46:
      case 51:
      case 52:
        goto LABEL_107;
      default:
        if ( this->WhoIsInControlOfTheCamera == 1 )
          goto LABEL_107;
        v90 = !this->m_bJustCameOutOfGarage;
        if ( !this->m_bJustCameOutOfGarage )
          v90 = !this->m_bPlayerIsInGarage;
        if ( !v90 )
          goto LABEL_107;
        if ( this->Cams[this->ActiveCam].Mode == 29 )
          v74 = 0;
        break;
    }
  }
  v77 = 0;
  if ( this->m_bForceCinemaCam )
  {
    v74 = 1;
    this->m_bObbeCinematicCarCamOn = 1;
  }
  v78 = v74 ^ 1;
  v79 = !this->m_bObbeCinematicPedCamOn;
  if ( this->m_bObbeCinematicPedCamOn )
    v79 = v78 == 1;
  if ( v79 )
  {
    m_bObbeCinematicCarCamOn = this->m_bObbeCinematicCarCamOn;
    if ( !this->m_bObbeCinematicCarCamOn )
      v77 = 1;
    if ( v78 | v77 )
    {
      v74 = 0;
      m_bPlayerIsInGarage = this->m_bPlayerIsInGarage;
      bDidWeProcessAnyCinemaCam = 0;
      v77 = m_bPlayerIsInGarage && m_bObbeCinematicCarCamOn;
    }
    else
    {
      v77 = 0;
      CPostEffects::m_bSpeedFXUserFlagCurrentFrame = 0;
      v82 = this->pTargetEntity;
      if ( (*(_BYTE *)&v82->m_info & 7) == 2 )
      {
        v83 = v82[24].m_transform.m_translate.x;
        if ( LODWORD(v83) == 4 )
        {
          CCamera::ProcessObbeCinemaCameraPlane(this);
        }
        else if ( CVehicle::GetVehicleAppearance((const CVehicle *)v82) == APR_HELI )
        {
          CCamera::ProcessObbeCinemaCameraHeli(this);
        }
        else if ( LODWORD(v83) == 6 )
        {
          CCamera::ProcessObbeCinemaCameraTrain(this);
        }
        else if ( LODWORD(v83) == 5 )
        {
          CCamera::ProcessObbeCinemaCameraBoat(this);
        }
        else
        {
          CCamera::ProcessObbeCinemaCameraCar(this);
        }
        v77 = 0;
      }
    }
  }
  if ( !this->m_bLookingAtPlayer )
  {
    v108 = !this->m_bEnable1rstPersonCamCntrlsScript;
    if ( !this->m_bEnable1rstPersonCamCntrlsScript )
      v108 = !this->m_bAllow1rstPersonWeaponsCamera;
    if ( !v108 )
    {
      if ( CCamera::CamControl(void)::ReqMode == 16 )
      {
        v109 = 0;
        v110 = this->Cams[this->ActiveCam].Mode != 16;
        goto LABEL_196;
      }
      v111 = (unsigned __int16)this->PlayerWeaponMode.Mode;
      if ( v111 <= 0x10 && ((1 << v111) & (unsigned int)&elf_hash_chain[6]) != 0 || v111 == 51 )
      {
        v112 = currentPad;
        if ( !currentPad )
          v112 = CPad::GetPad(0);
        if ( CPad::GetTarget(v112, 0) && this->m_bAllow1rstPersonWeaponsCamera )
        {
          v110 = 1;
          v109 = 1;
          goto LABEL_196;
        }
      }
      if ( this->Cams[this->ActiveCam].Mode != this->m_iModeToGoTo )
      {
        this->m_iTypeOfSwitch = 2;
        this->m_bStartInterScript = 1;
        v113 = currentPad;
        if ( !currentPad )
          v113 = CPad::GetPad(0);
        v113->DisablePlayerControls &= ~1u;
      }
    }
    v110 = 0;
    v109 = 0;
LABEL_196:
    if ( this->m_uiTransitionState )
    {
      if ( this->m_bStartInterScript )
      {
        if ( this->m_iTypeOfSwitch == 1 )
        {
          m_iModeToGoTo = this->m_iModeToGoTo;
          CCamera::CamControl(void)::ReqMode = m_iModeToGoTo;
          this->m_vecDoingSpecialInterPolation = 1;
          goto LABEL_323;
        }
        goto LABEL_205;
      }
    }
    else if ( this->m_bStartInterScript )
    {
      if ( this->m_iTypeOfSwitch == 1 )
      {
        m_iModeToGoTo = this->m_iModeToGoTo;
        CCamera::CamControl(void)::ReqMode = m_iModeToGoTo;
        goto LABEL_323;
      }
LABEL_205:
      if ( !v110 && this->m_iTypeOfSwitch != 2 )
        goto LABEL_324;
LABEL_206:
      this->m_vecDoingSpecialInterPolation = 0;
      this->m_uiTransitionState = 0;
      if ( this->m_bEnable1rstPersonCamCntrlsScript && CCamera::CamControl(void)::ReqMode == 16 )
      {
        v115 = 16;
      }
      else
      {
        p_m_iModeToGoTo = (CQueuedMode *)&this->m_iModeToGoTo;
        if ( v109 )
          p_m_iModeToGoTo = &this->PlayerWeaponMode;
        v115 = p_m_iModeToGoTo->Mode;
      }
      v118 = this->ActiveCam;
      v119 = (char *)this + 528 * v118;
      *((_WORD *)v119 + 191) = v115;
      this->m_bJust_Switched = 1;
      v119[378] = 1;
      v120 = *(_QWORD *)&this->m_vecFixedModeVector.x;
      v121 = (CEntity *)*((_DWORD *)v119 + 217);
      *((_DWORD *)v119 + 169) = LODWORD(this->m_vecFixedModeVector.z);
      *(_QWORD *)(v119 + 668) = v120;
      if ( v121 )
      {
        CEntity::CleanUpOldReference(v121, (CEntity **)v119 + 217);
        v118 = this->ActiveCam;
      }
      v122 = this->pTargetEntity;
      v123 = &this->Cams[v118];
      v123->CamTargetEntity = v122;
      CEntity::RegisterReference(v122, &v123->CamTargetEntity);
      v124 = this->ActiveCam;
      v125 = *(_QWORD *)&this->m_vecFixedModeSource.x;
      v126 = &this->Cams[v124];
      v126->m_cvecCamFixedModeSource.z = this->m_vecFixedModeSource.z;
      *(_QWORD *)&v126->m_cvecCamFixedModeSource.x = v125;
      v127 = &this->Cams[0].bBelowMinDist + 16 * (((v124 & 1) == 0) | (32 * ((v124 & 1) == 0)));
      v128 = *(_QWORD *)&this->m_vecFixedModeUpOffSet.x;
      v126->m_cvecCamFixedModeUpOffSet.z = this->m_vecFixedModeUpOffSet.z;
      *(_QWORD *)&v126->m_cvecCamFixedModeUpOffSet.x = v128;
      v126->m_bCamLookingAtVector = this->m_bLookingAtVector;
      v129 = *((_QWORD *)v127 + 42);
      v126->m_vecLastAboveWaterCamPosition.z = *((RwReal *)v127 + 86);
      *(_QWORD *)&v126->m_vecLastAboveWaterCamPosition.x = v129;
      v130 = this->m_fCarZoomBase;
      v131 = this->m_fPedZoomBase;
      this->m_bJust_Switched = 1;
      this->m_fCarZoomSmoothed = v130;
      this->m_fPedZoomSmoothed = v131;
      goto LABEL_324;
    }
    if ( !v110 )
      goto LABEL_324;
    goto LABEL_206;
  }
  v103 = v20;
  v104 = (unsigned __int16)CCamera::CamControl(void)::ReqMode;
  v105 = 1;
  switch ( CCamera::CamControl(void)::ReqMode )
  {
    case 1:
    case 16:
    case 37:
      goto LABEL_220;
    case 15:
      v104 = 15;
      v116 = (unsigned __int16)this->Cams[this->ActiveCam].Mode;
      if ( v116 != 1 )
        v116 = 0;
      v105 = v77 | v116;
      goto LABEL_233;
    case 18:
    case 22:
      v106 = this->Cams[this->ActiveCam].Mode;
      v107 = v106 == 1;
      if ( v106 != 1 )
        v107 = v106 == 37;
      if ( v107 )
      {
        v105 = 1;
      }
      else
      {
        v105 = v77;
        if ( v106 == 16 )
          v105 = 1;
      }
      goto LABEL_220;
    default:
      v105 = v77;
LABEL_220:
      if ( (unsigned int)(unsigned __int16)CCamera::CamControl(void)::ReqMode - 53 > 0xC
        || ((1 << (CCamera::CamControl(void)::ReqMode - 53)) & 0x1005) == 0 )
      {
        goto LABEL_230;
      }
      v132 = this->pTargetEntity;
      if ( !v132 || (*(_BYTE *)&v132->m_info & 7) != 3 )
        goto LABEL_233;
      TaskJetPack = CPedIntelligence::GetTaskJetPack((const CPedIntelligence *)LODWORD(v132[18].m_transform.m_translate.y));
      v104 = (unsigned __int16)CCamera::CamControl(void)::ReqMode;
      if ( CCamera::CamControl(void)::ReqMode != 53 )
        goto LABEL_230;
      v134 = TaskJetPack == 0;
      v104 = 53;
      if ( !TaskJetPack )
        v134 = this->Cams[this->ActiveCam].Mode == 4;
      if ( v134 )
      {
        v105 = (unsigned __int8)v105 & (CHID::GetInputType() != 2);
        v104 = (unsigned __int16)CCamera::CamControl(void)::ReqMode;
LABEL_230:
        if ( v104 == 48 )
        {
          v135 = this->ActiveCam;
          v104 = 48;
          if ( this->Cams[v135].Mode != 49 )
          {
LABEL_244:
            v105 = 1;
            goto LABEL_245;
          }
          v136 = 1;
        }
        else
        {
          v136 = 0;
          if ( v104 == 49 )
          {
LABEL_234:
            v135 = this->ActiveCam;
            v104 = 49;
            if ( this->Cams[v135].Mode == 48 )
            {
LABEL_235:
              if ( v104 != 29 )
              {
LABEL_236:
                if ( this->Cams[v135].Mode == 29 )
                  v105 = 1;
              }
              goto LABEL_249;
            }
            goto LABEL_244;
          }
        }
      }
      else
      {
LABEL_233:
        v136 = v104 == 48;
        if ( v104 == 49 )
          goto LABEL_234;
      }
      v135 = this->ActiveCam;
      v137 = (unsigned __int16)this->Cams[v135].Mode;
      v138 = v137 == 48;
      if ( v137 != 48 )
        v138 = !v136 && v137 == 49;
      if ( v138 )
        goto LABEL_244;
LABEL_245:
      switch ( v104 )
      {
        case 1:
          v212 = (unsigned __int16)this->Cams[v135].Mode;
          v213 = v212 == 37;
          if ( v212 != 37 )
            v213 = v212 == 29;
          if ( v213 )
            v105 = 0;
          goto LABEL_236;
        case 4:
LABEL_301:
          if ( this->Cams[v135].Mode == 53
            && CPed::CanWeRunAndFireWithWeapon((CPed *)this->pTargetEntity)
            && (HIBYTE(this->pTargetEntity[19].m_transform.m_heading) & 4) == 0
            && CHID::GetInputType() == 2 )
          {
            this->m_bJustCameOutOfGarage = 1;
          }
          v135 = this->ActiveCam;
          v184 = (unsigned __int16)this->Cams[v135].Mode;
          switch ( this->Cams[v135].Mode )
          {
            case 1:
            case 7:
            case 8:
            case 0x10:
            case 0x1D:
            case 0x1E:
            case 0x20:
            case 0x21:
            case 0x22:
            case 0x25:
            case 0x27:
            case 0x28:
            case 0x29:
            case 0x2A:
            case 0x2B:
            case 0x2D:
            case 0x2E:
            case 0x33:
            case 0x34:
              goto LABEL_307;
            default:
              if ( v27 != 1 )
                goto LABEL_249;
LABEL_307:
              if ( this->m_bJustCameOutOfGarage )
                goto LABEL_249;
              switch ( this->Cams[v135].Mode )
              {
                case 7:
                case 8:
                case 0x10:
                case 0x22:
                case 0x27:
                case 0x28:
                case 0x29:
                case 0x2A:
                case 0x2B:
                case 0x2D:
                case 0x2E:
                case 0x33:
                case 0x34:
                  v185 = *(_QWORD *)&this->Cams[v135].Front.x;
                  v186 = CGeneral::GetATanOfXY(*(float *)&v185, *((float *)&v185 + 1));
                  *(float *)&this->pTargetEntity[22].m_pLod = v186 + -1.5708;
                  *(float *)&this->pTargetEntity[22].numLodChildren = v186 + -1.5708;
                  v135 = this->ActiveCam;
                  v184 = (unsigned __int16)this->Cams[v135].Mode;
                  break;
                default:
                  break;
              }
              this->m_bUseTransitionBeta = 1;
              if ( v184 == 37 )
              {
                v187 = FindPlayerPed(-1);
                v188 = v187->m_pMat;
                v189 = (float *)((char *)this + 528 * v135);
                v190 = v189[185];
                v191 = v189[186];
                v192 = &v188->tx;
                if ( !v188 )
                  v192 = &v187->m_transform.m_translate.x;
                v193 = v192[1];
                v194 = v190 - *v192;
                v480.m_vecPosition.z = 0.0;
                v480.m_vecPosition.y = v191 - v193;
                v480.m_vecPosition.x = v194;
                CVector::Normalise(&v480.m_vecPosition);
                v195 = v480.m_vecPosition.y;
                if ( v480.m_vecPosition.x == 0.001 && v480.m_vecPosition.y == 0.001 )
                {
                  v195 = 1.0;
                  v480.m_vecPosition.y = 1.0;
                }
                v196 = CGeneral::GetATanOfXY(v480.m_vecPosition.x, v195);
                v135 = this->ActiveCam;
                this->Cams[v135].m_fTransitionBeta = v196;
              }
              else
              {
                v223 = *(_QWORD *)&this->Cams[v135].Front.x;
                v224 = CGeneral::GetATanOfXY(*(float *)&v223, *((float *)&v223 + 1));
                v135 = this->ActiveCam;
                this->Cams[v135].m_fTransitionBeta = v224 + 3.1416;
              }
              break;
          }
          goto LABEL_248;
        case 7:
        case 8:
        case 16:
        case 32:
        case 33:
        case 34:
        case 39:
        case 40:
        case 41:
        case 42:
        case 43:
        case 45:
        case 46:
        case 51:
        case 52:
          if ( (*(_BYTE *)&this->pTargetEntity->m_info & 7) != 3 )
          {
            switch ( v104 )
            {
              case 4:
                goto LABEL_301;
              case 15:
                goto LABEL_317;
              case 29:
              case 32:
              case 33:
              case 38:
                goto LABEL_248;
              default:
                goto LABEL_235;
            }
          }
          goto LABEL_248;
        case 15:
LABEL_317:
          if ( !this->m_bPlayerIsInGarage )
            goto LABEL_236;
          switch ( this->Cams[v135].Mode )
          {
            case 7:
            case 8:
            case 0x22:
            case 0x25:
            case 0x2D:
            case 0x33:
              goto LABEL_319;
            default:
              if ( v103 )
              {
LABEL_319:
                v197 = this->pTargetEntity;
                if ( v197 )
                  v105 |= (*(_BYTE *)&v197->m_info & 7) == 2;
              }
              else
              {
                switch ( this->Cams[v135].Mode )
                {
                  case 0x10:
                  case 0x27:
                  case 0x28:
                  case 0x29:
                  case 0x2A:
                  case 0x2B:
                  case 0x2E:
                  case 0x34:
                    goto LABEL_319;
                  default:
                    goto LABEL_249;
                }
              }
              break;
          }
          break;
        case 29:
        case 38:
LABEL_248:
          v105 = 1;
          break;
        case 37:
          v214 = (unsigned __int16)this->Cams[v135].Mode;
          v215 = v214 == 29;
          if ( v214 != 29 )
            v215 = v214 == 1;
          if ( v215 )
            v105 = 0;
          goto LABEL_236;
        default:
          goto LABEL_235;
      }
LABEL_249:
      v139 = (float32x2_t *)((char *)this + 528 * v135);
      v140 = v139[47].n64_u16[3];
      if ( (unsigned __int16)CCamera::CamControl(void)::ReqMode != v140 )
        v105 |= v139[108].n64_u32[1] == 0;
      if ( this->m_bPlayerIsInGarage )
      {
        v141 = this->pToGarageWeAreIn;
        if ( v141 )
        {
          if ( (unsigned __int8)(v141->Type - 2) <= 2u )
          {
            v142 = this->pTargetEntity;
            if ( (*(_BYTE *)&v142->m_info & 7) == 2 && v142->m_nModelIndex == 423 )
              v105 |= (unsigned __int16)CCamera::CamControl(void)::ReqMode != v140;
          }
        }
        v143 = v139[108].n64_u32[1];
        if ( v143 )
        {
          v144 = *(_DWORD *)(v143 + 20);
          v145 = v144 + 48;
          if ( !v144 )
            v145 = v143 + 4;
          v146 = 0;
          v147 = vmul_f32(
                   vsub_f32(*(float32x2_t *)(v145 + 4), *(float32x2_t *)&this->m_vecFixedModeSource.y),
                   vsub_f32(*(float32x2_t *)(v145 + 4), v139[93])).n64_u64[0];
          if ( (float)((float)((float)((float)(*(float *)v145 - this->m_vecFixedModeSource.x)
                                     * (float)(*(float *)v145 - v139[92].n64_f32[1]))
                             + *(float *)&v147)
                     + *((float *)&v147 + 1)) < 0.0 )
            v146 = 1;
          v105 |= v146;
        }
      }
      v148 = ((this->m_uiTransitionState == 0) | v105) == 0;
      if ( (this->m_uiTransitionState == 0) | v105 )
        v148 = (unsigned __int16)CCamera::CamControl(void)::ReqMode == v140;
      if ( !v148 )
      {
        if ( v105 == 1 )
        {
          if ( !this->m_bPlayerIsInGarage || this->m_bJustCameOutOfGarage )
          {
            switch ( CCamera::CamControl(void)::ReqMode )
            {
              case 4:
              case 7:
              case 8:
              case 11:
              case 16:
              case 28:
              case 34:
              case 35:
              case 46:
              case 51:
                break;
              default:
                if ( CHID::GetInputType() != 2 )
                {
                  TheCamera.m_bCamDirectlyBehind = 1;
                  v216 = FindPlayerPed(-1);
                  if ( v216 )
                    this->m_PedOrientForBehindOrInFront = CGeneral::GetATanOfXY(v216->m_pMat->xy, v216->m_pMat->yy);
                }
                break;
            }
          }
          v149 = this->ActiveCam;
          v150 = (char *)this + 528 * v149;
          *((_WORD *)v150 + 191) = CCamera::CamControl(void)::ReqMode;
          v151 = *(_QWORD *)&this->m_vecFixedModeVector.x;
          v152 = this->m_vecFixedModeVector.z;
          this->m_bJust_Switched = 1;
          *((RwReal *)v150 + 169) = v152;
          v153 = (CEntity *)*((_DWORD *)v150 + 217);
          *(_QWORD *)(v150 + 668) = v151;
          if ( v153 )
          {
            CEntity::CleanUpOldReference(v153, (CEntity **)v150 + 217);
            v149 = this->ActiveCam;
          }
          v154 = this->pTargetEntity;
          v155 = &this->Cams[v149];
          v155->CamTargetEntity = v154;
          CEntity::RegisterReference(v154, &v155->CamTargetEntity);
          v156 = this->ActiveCam;
          v157 = *(_QWORD *)&this->m_vecFixedModeSource.x;
          v158 = &this->Cams[v156];
          v158->m_cvecCamFixedModeSource.z = this->m_vecFixedModeSource.z;
          *(_QWORD *)&v158->m_cvecCamFixedModeSource.x = v157;
          v159 = &this->Cams[0].bBelowMinDist + 16 * (((v156 & 1) == 0) | (32 * ((v156 & 1) == 0)));
          v160 = *(_QWORD *)&this->m_vecFixedModeUpOffSet.x;
          v158->m_cvecCamFixedModeUpOffSet.z = this->m_vecFixedModeUpOffSet.z;
          *(_QWORD *)&v158->m_cvecCamFixedModeUpOffSet.x = v160;
          v158->m_bCamLookingAtVector = this->m_bLookingAtVector;
          v161 = *((_QWORD *)v159 + 42);
          v158->m_vecLastAboveWaterCamPosition.z = *((RwReal *)v159 + 86);
          *(_QWORD *)&v158->m_vecLastAboveWaterCamPosition.x = v161;
          v162 = this->m_fCarZoomBase;
          v163 = this->m_fPedZoomBase;
          this->m_uiTransitionState = 0;
          this->m_vecDoingSpecialInterPolation = 0;
          this->m_bStartInterScript = 0;
          this->m_fCarZoomSmoothed = v162;
          this->m_fPedZoomSmoothed = v163;
          v158->ResetStatics = 1;
          goto LABEL_324;
        }
        if ( this->m_bWaitForInterpolToFinish )
          goto LABEL_324;
        m_iModeToGoTo = CCamera::CamControl(void)::ReqMode;
LABEL_323:
        CCamera::StartTransition(this, m_iModeToGoTo);
        goto LABEL_324;
      }
      v164 = this->m_uiTransitionState == 0;
      if ( this->m_uiTransitionState )
        v164 = (unsigned __int16)CCamera::CamControl(void)::ReqMode == v140;
      if ( v164 )
      {
        if ( CCamera::CamControl(void)::ReqMode == 15 )
        {
          v181 = this->pTargetEntity;
          v182 = (CEntity *)v139[108].n64_u32[1];
          v183 = v181 == v182;
          if ( v181 != v182 )
            v183 = !this->m_bPlayerIsInGarage;
          if ( !v183 )
          {
            m_iModeToGoTo = 15;
            if ( this->m_uiTransitionState )
              this->m_vecDoingSpecialInterPolation = 1;
            goto LABEL_323;
          }
        }
      }
      else
      {
        if ( this->m_bWaitForInterpolToFinish )
          goto LABEL_324;
        if ( !this->m_bLookingAtPlayer )
          goto LABEL_322;
        v165 = FindPlayerPed(-1);
        v166 = v165->m_pMat;
        tx = this->m_cameraMatrix.tx;
        v168 = &v166->tx;
        if ( !v166 )
          v168 = &v165->m_transform.m_translate.x;
        v169 = *v168;
        v170 = FindPlayerPed(-1);
        v171 = v170->m_pMat;
        ty = this->m_cameraMatrix.ty;
        v173 = (CSimpleTransform *)&v171->tx;
        if ( !v171 )
          v173 = &v170->m_transform;
        v174 = v173->m_translate.y;
        v175 = FindPlayerPed(-1);
        v176 = v175->m_pMat;
        v177 = (CSimpleTransform *)&v176->tx;
        if ( !v176 )
          v177 = &v175->m_transform;
        v178 = this->pTargetEntity;
        if ( v178 )
        {
          if ( (*(_BYTE *)&v178->m_info & 7) == 3 )
          {
            v179 = v177->m_translate.z - this->m_cameraMatrix.tz;
            if ( sqrtf(
                   (float)((float)((float)(v169 - tx) * (float)(v169 - tx))
                         + (float)((float)(v174 - ty) * (float)(v174 - ty)))
                 + (float)(v179 * v179)) > 17.5 )
            {
              v180 = CCamera::CamControl(void)::ReqMode == 28;
              if ( CCamera::CamControl(void)::ReqMode != 28 )
                v180 = CCamera::CamControl(void)::ReqMode == 11;
              if ( v180 )
              {
                this->m_bWaitForInterpolToFinish = 1;
                goto LABEL_324;
              }
            }
          }
        }
        if ( !this->m_bWaitForInterpolToFinish )
        {
LABEL_322:
          m_iModeToGoTo = CCamera::CamControl(void)::ReqMode;
          this->m_vecDoingSpecialInterPolation = 1;
          goto LABEL_323;
        }
      }
LABEL_324:
      v198 = this->ActiveCam;
      this->m_bStartInterScript = 0;
      v199 = (char *)this + 528 * v198;
      if ( !*((_DWORD *)v199 + 217) )
      {
        v200 = this->pTargetEntity;
        v201 = (CEntity **)(v199 + 868);
        *v201 = v200;
        CEntity::RegisterReference(v200, v201);
        v198 = this->ActiveCam;
      }
      v202 = (unsigned __int16)this->Cams[v198].Mode;
      if ( v202 != 17 )
      {
        if ( (*(_BYTE *)&this->pTargetEntity->m_info & 7) == 3 )
        {
          switch ( v202 )
          {
            case 7:
            case 8:
            case 16:
            case 34:
            case 45:
            case 46:
            case 51:
              goto LABEL_329;
            default:
              break;
          }
        }
        TaskHold = FindPlayerPed(-1);
        v207 = TaskHold[7] | 0x80;
        goto LABEL_335;
      }
LABEL_329:
      if ( (*(_BYTE *)&FindPlayerPed(-1)->m_nFlags & 0x80) != 0 )
      {
        v203 = FindPlayerPed(-1);
        *(_DWORD *)&v203->m_nFlags &= ~0x80u;
        v204 = FindPlayerPed(-1);
        TaskHold = CPedIntelligence::GetTaskHold(v204->m_pPedIntelligence, 0);
        v206 = TaskHold == 0;
        if ( TaskHold )
        {
          TaskHold = (_DWORD *)TaskHold[2];
          v206 = TaskHold == 0;
        }
        if ( !v206 )
        {
          v207 = TaskHold[7] & 0xFFFFFF7F;
LABEL_335:
          TaskHold[7] = v207;
        }
      }
      if ( this->Cams[this->ActiveCam].Mode == 15 )
      {
        v208 = gPlayerPedVisible;
        v209 = FindPlayerPed(-1);
        *(_DWORD *)&v209->m_nFlags = *(_DWORD *)&v209->m_nFlags & 0xFFFFFF7F | (v208 << 7);
      }
      v210 = v74 == 0;
      if ( !v74 )
        v210 = this->WhoIsInControlOfTheCamera == 2;
      if ( v210 )
      {
        CCamera::RestoreWithJumpCut(this);
        TheCamera.m_bCamDirectlyBehind = 1;
        v211 = FindPlayerPed(-1);
        if ( v211 )
          this->m_PedOrientForBehindOrInFront = CGeneral::GetATanOfXY(v211->m_pMat->xy, v211->m_pMat->yy);
      }
      return;
  }
}
// 3D829A: variable 'v3' is possibly undefined
// 3D829A: variable 'v6' is possibly undefined
// 3D8E3A: variable 'v2' is possibly undefined
// 3D8E5E: variable 'v8' is possibly undefined
// 3D8E62: variable 'v7' is possibly undefined
// 3D8E66: variable 'v9' is possibly undefined
// 3D91B4: variable 'v1' is possibly undefined
// 3D9612: variable 'v5' is possibly undefined
// 3D96A4: variable 'v4' is possibly undefined
// 6: using guessed type char byte_6;
// FC: using guessed type int elf_hash_bucket[16411];
// 10168: using guessed type int elf_hash_chain[22025];
// 616840: using guessed type _DWORD dword_616840[5];
// 677AEC: using guessed type float (*ZOOM_TWO_DISTANCE_ptr)[5];
// 679BEC: using guessed type float (*ZOOM_THREE_DISTANCE_ptr)[5];
// 679F90: using guessed type float (*ZOOM_ONE_DISTANCE_ptr)[5];
// 952EA8: using guessed type char CCamera::CamControl(void)::ThePickedArrestMode;
// 952EA9: using guessed type char CCamera::CamControl(void)::PlaceForFixedWhenSniperFound;
// 952EB8: using guessed type char `guard variable for'CCamera::CamControl(void)::nInitialZoom;
// 952EC4: using guessed type char `guard variable for'CCamera::CamControl(void)::nInitialZoom;

//----- (003D9D68) --------------------------------------------------------
void __fastcall CCamera::Restore(CCamera *this)
{
  CEntity **p_pTargetEntity; // r5
  CEntity *pTargetEntity; // r0
  CEntity *PlayerVehicle; // r0
  CEntity *v5; // r0
  __int16 v6; // r1
  CPlayerInfo *v7; // r0
  ePedState m_nPedState; // r2
  bool v9; // zf
  CEntity *v10; // r0
  CPlayerPed *pPed; // r0
  CEntity *pAttachedEntity; // r0

  this->m_iTypeOfSwitch = 1;
  *(_WORD *)&this->m_bLookingAtPlayer = 1;
  this->m_bUseNearClipScript = 0;
  this->m_iModeObbeCamIsInForCar = 30;
  this->m_fPositionAlongSpline = 0.0;
  this->m_bStartingSpline = 0;
  this->m_bScriptParametersSetForInterPol = 0;
  this->WhoIsInControlOfTheCamera = 0;
  if ( FindPlayerVehicle(-1, 0) )
  {
    p_pTargetEntity = &this->pTargetEntity;
    this->m_iModeToGoTo = 18;
    pTargetEntity = this->pTargetEntity;
    if ( pTargetEntity )
      CEntity::CleanUpOldReference(pTargetEntity, &this->pTargetEntity);
    PlayerVehicle = FindPlayerVehicle(-1, 0);
  }
  else
  {
    p_pTargetEntity = &this->pTargetEntity;
    this->m_iModeToGoTo = 4;
    v5 = this->pTargetEntity;
    if ( v5 )
      CEntity::CleanUpOldReference(v5, &this->pTargetEntity);
    PlayerVehicle = CWorld::Players[CWorld::PlayerInFocus].pPed;
  }
  *p_pTargetEntity = PlayerVehicle;
  CEntity::RegisterReference(PlayerVehicle, p_pTargetEntity);
  v6 = CWorld::PlayerInFocus;
  v7 = &CWorld::Players[CWorld::PlayerInFocus];
  m_nPedState = v7->pPed->m_nPedState;
  if ( m_nPedState == PED_ENTER_CAR )
  {
    this->m_iModeToGoTo = 18;
    m_nPedState = v7->pPed->m_nPedState;
  }
  v9 = m_nPedState == PED_CARJACK;
  if ( m_nPedState != PED_CARJACK )
    v9 = m_nPedState == PED_OPEN_DOOR;
  if ( v9 )
  {
    this->m_iModeToGoTo = 18;
    m_nPedState = v7->pPed->m_nPedState;
  }
  if ( m_nPedState == PED_EXIT_CAR )
  {
    this->m_iModeToGoTo = 4;
    v10 = this->pTargetEntity;
    if ( v10 )
    {
      CEntity::CleanUpOldReference(v10, &this->pTargetEntity);
      v6 = CWorld::PlayerInFocus;
    }
    pPed = CWorld::Players[v6].pPed;
    this->pTargetEntity = pPed;
    CEntity::RegisterReference(pPed, &this->pTargetEntity);
  }
  pAttachedEntity = this->pAttachedEntity;
  if ( pAttachedEntity )
  {
    CEntity::CleanUpOldReference(pAttachedEntity, &this->pAttachedEntity);
    this->pAttachedEntity = 0;
  }
  this->m_bAllow1rstPersonWeaponsCamera = 0;
  this->m_bEnable1rstPersonCamCntrlsScript = 0;
  this->m_bUseScriptZoomValuePed = 0;
  this->m_bUseScriptZoomValueCar = 0;
  this->m_bStartInterScript = 1;
  this->m_bCameraJustRestored = 1;
  this->m_fAvoidTheGeometryProbsTimer = 0.0;
}

//----- (003D9EC8) --------------------------------------------------------
void __fastcall CCamera::SetWideScreenOff(CCamera *this)
{
  this->m_bWantsToSwitchWidescreenOff = this->m_WideScreenOn;
}

//----- (003D9ED2) --------------------------------------------------------
void __fastcall CCamera::SetCamPositionForFixedMode(
        CCamera *this,
        const CVector *CamPosToGoTo,
        const CVector *UpOffsets)
{
  __int64 v3; // d16
  __int64 v4; // d16

  v3 = *(_QWORD *)&CamPosToGoTo->x;
  this->m_vecFixedModeSource.z = CamPosToGoTo->z;
  *(_QWORD *)&this->m_vecFixedModeSource.x = v3;
  v4 = *(_QWORD *)&UpOffsets->x;
  this->m_vecFixedModeUpOffSet.z = UpOffsets->z;
  this->m_bGarageFixedCamPositionSet = 0;
  *(_QWORD *)&this->m_vecFixedModeUpOffSet.x = v4;
}

//----- (003D9F00) --------------------------------------------------------
bool __fastcall CCamera::Using1stPersonWeaponMode(CCamera *this)
{
  int v1; // r1
  bool result; // r0

  v1 = (unsigned __int16)this->PlayerWeaponMode.Mode - 7;
  result = 1;
  switch ( v1 )
  {
    case 0:
    case 1:
    case 27:
    case 38:
    case 39:
    case 44:
    case 58:
      return result;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (003D9F54) --------------------------------------------------------
bool __fastcall CCamera::IsTargetingActive(CCamera *this)
{
  bool result; // r0

  if ( FindPlayerPed(-1)
    && ((*((_BYTE *)FindPlayerPed(-1)->m_pPlayerData + 52) & 8) != 0 || FindPlayerPed(-1)->m_pEntLockOnTarget) )
  {
    return 1;
  }
  result = 1;
  switch ( this->PlayerWeaponMode.Mode )
  {
    case 7:
    case 8:
    case 0x22:
    case 0x2D:
    case 0x2E:
    case 0x33:
    case 0x41:
      return result;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (003D9FDC) --------------------------------------------------------
void __fastcall CCamera::ClearPlayerWeaponMode(CCamera *this)
{
  CPlayerPed *PlayerPed; // r0

  this->PlayerWeaponMode.Duration = 0.0;
  *(_DWORD *)&this->PlayerWeaponMode.MinZoom = (char *)&elf_hash_chain[16293] + 3;
  this->PlayerWeaponMode.Mode = 0;
  if ( FindPlayerPed(-1) )
  {
    if ( FindPlayerPed(-1)->m_nPedState == PED_SNIPER_MODE )
    {
      PlayerPed = FindPlayerPed(-1);
      sub_18D8EC(PlayerPed, PED_IDLE);
    }
  }
}
// 10168: using guessed type int elf_hash_chain[22025];

//----- (003DA028) --------------------------------------------------------
void __fastcall CCamera::SetCameraDirectlyBehindForFollowPed_CamOnAString(CCamera *this)
{
  CPlayerPed *PlayerPed; // r0

  TheCamera.m_bCamDirectlyBehind = 1;
  PlayerPed = FindPlayerPed(-1);
  if ( PlayerPed )
    this->m_PedOrientForBehindOrInFront = CGeneral::GetATanOfXY(PlayerPed->m_pMat->xy, PlayerPed->m_pMat->yy);
}

//----- (003DA05C) --------------------------------------------------------
void __fastcall CCamera::ProcessObbeCinemaCameraPlane(CCamera *this)
{
  float *v2; // r4
  int v3; // r0
  int v4; // r6
  int v5; // r0
  Int32 v6; // r1
  _BOOL4 started; // r0
  const unsigned __int8 *v8; // r5
  GxtChar *v9; // r0
  float pWaterZ[7]; // [sp+Ch] [bp-1Ch] BYREF

  if ( !bDidWeProcessAnyCinemaCam
    && ((CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode = -1, gbCineyCamMessageDisplayed < 1)
     || this->m_bForceCinemaCam
     || (v8 = CINCAM,
         --gbCineyCamMessageDisplayed,
         v9 = CText::Get(&TheText, CINCAM),
         CHud::SetHelpMessage(v8, v9, 1, 0, 0, 0),
         !bDidWeProcessAnyCinemaCam))
    || (v2 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam),
        CWaterLevel::GetWaterLevel(v2[185], v2[186], v2[187], pWaterZ, 1, 0))
    && pWaterZ[0] >= v2[187]
    || CCamera::IsItTimeForNewcam(
         this,
         SequenceOfPlaneCams[CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode],
         CCamera::ProcessObbeCinemaCameraPlane(void)::TimeForNext) )
  {
    v3 = (gCinematicModeSwitchDir + CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode) % 6;
    if ( v3 < 0 )
      v3 = 5;
    CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode = v3;
    if ( !CCamera::TryToStartNewCamMode(this, SequenceOfPlaneCams[v3]) )
    {
      v4 = -1;
      do
      {
        v5 = (CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode + gCinematicModeSwitchDir) % 6;
        if ( v5 < 0 )
          v5 = 5;
        v6 = SequenceOfPlaneCams[v5];
        CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode = v5;
        started = CCamera::TryToStartNewCamMode(this, v6);
        ++v4;
      }
      while ( v4 <= 5 && !started );
      if ( v4 >= 5 )
      {
        CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode = 6;
        if ( this->Cams[this->ActiveCam].Mode == 18 )
          goto LABEL_20;
        CCamera::TryToStartNewCamMode(this, 29);
      }
    }
    CCamera::ProcessObbeCinemaCameraPlane(void)::TimeForNext = CTimer::m_snTimeInMilliseconds;
  }
LABEL_20:
  this->m_iModeObbeCamIsInForCar = CCamera::ProcessObbeCinemaCameraPlane(void)::OldMode;
  bDidWeProcessAnyCinemaCam = 1;
}
// 3DA05C: using guessed type float pWaterZ[7];

//----- (003DA270) --------------------------------------------------------
void __fastcall CCamera::ProcessObbeCinemaCameraHeli(CCamera *this)
{
  float *v2; // r4
  int v3; // r0
  int v4; // r6
  int v5; // r0
  Int32 v6; // r1
  _BOOL4 started; // r0
  const unsigned __int8 *v8; // r5
  GxtChar *v9; // r0
  float pWaterZ[7]; // [sp+Ch] [bp-1Ch] BYREF

  if ( !bDidWeProcessAnyCinemaCam
    && ((CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode = -1, gbCineyCamMessageDisplayed < 1)
     || this->m_bForceCinemaCam
     || (v8 = CINCAM,
         --gbCineyCamMessageDisplayed,
         v9 = CText::Get(&TheText, CINCAM),
         CHud::SetHelpMessage(v8, v9, 1, 0, 0, 0),
         !bDidWeProcessAnyCinemaCam))
    || (v2 = (float *)((char *)&TheCamera + 528 * TheCamera.ActiveCam),
        CWaterLevel::GetWaterLevel(v2[185], v2[186], v2[187], pWaterZ, 1, 0))
    && pWaterZ[0] >= v2[187]
    || CCamera::IsItTimeForNewcam(
         this,
         SequenceOfHeliCams[CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode],
         CCamera::ProcessObbeCinemaCameraHeli(void)::TimeForNext) )
  {
    v3 = (gCinematicModeSwitchDir + CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode) % 7;
    if ( v3 < 0 )
      v3 = 6;
    CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode = v3;
    if ( !CCamera::TryToStartNewCamMode(this, SequenceOfHeliCams[v3]) )
    {
      v4 = -1;
      do
      {
        v5 = (CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode + gCinematicModeSwitchDir) % 7;
        if ( v5 < 0 )
          v5 = 6;
        v6 = SequenceOfHeliCams[v5];
        CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode = v5;
        started = CCamera::TryToStartNewCamMode(this, v6);
        ++v4;
      }
      while ( v4 <= 6 && !started );
      if ( v4 >= 6 )
      {
        CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode = 7;
        if ( this->Cams[this->ActiveCam].Mode == 18 )
          goto LABEL_20;
        CCamera::TryToStartNewCamMode(this, 29);
      }
    }
    CCamera::ProcessObbeCinemaCameraHeli(void)::TimeForNext = CTimer::m_snTimeInMilliseconds;
  }
LABEL_20:
  this->m_iModeObbeCamIsInForCar = CCamera::ProcessObbeCinemaCameraHeli(void)::OldMode;
  bDidWeProcessAnyCinemaCam = 1;
}
// 3DA270: using guessed type float pWaterZ[7];

//----- (003DA484) --------------------------------------------------------
void __fastcall CCamera::ProcessObbeCinemaCameraBoat(CCamera *this)
{
  const unsigned __int8 *v2; // r5
  GxtChar *v3; // r0
  int v4; // r0
  int v5; // r6
  int v6; // r0
  Int32 v7; // r1
  _BOOL4 started; // r0

  if ( !bDidWeProcessAnyCinemaCam
    && ((CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode = -1, gbCineyCamMessageDisplayed < 1)
     || this->m_bForceCinemaCam
     || (v2 = CINCAM,
         --gbCineyCamMessageDisplayed,
         v3 = CText::Get(&TheText, CINCAM),
         CHud::SetHelpMessage(v2, v3, 1, 0, 0, 0),
         !bDidWeProcessAnyCinemaCam))
    || CCamera::IsItTimeForNewcam(
         this,
         SequenceOfBoatCams[CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode],
         CCamera::ProcessObbeCinemaCameraBoat(void)::TimeForNext) )
  {
    v4 = (gCinematicModeSwitchDir + CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode) % 3;
    if ( v4 < 0 )
      v4 = 2;
    CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode = v4;
    if ( !CCamera::TryToStartNewCamMode(this, SequenceOfBoatCams[v4]) )
    {
      v5 = -1;
      do
      {
        v6 = (CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode + gCinematicModeSwitchDir) % 3;
        if ( v6 < 0 )
          v6 = 2;
        v7 = SequenceOfBoatCams[v6];
        CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode = v6;
        started = CCamera::TryToStartNewCamMode(this, v7);
        ++v5;
      }
      while ( v5 <= 2 && !started );
      if ( v5 >= 2 )
      {
        CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode = 3;
        if ( this->Cams[this->ActiveCam].Mode == 18 )
          goto LABEL_19;
        CCamera::TryToStartNewCamMode(this, 29);
      }
    }
    CCamera::ProcessObbeCinemaCameraBoat(void)::TimeForNext = CTimer::m_snTimeInMilliseconds;
  }
LABEL_19:
  this->m_iModeObbeCamIsInForCar = CCamera::ProcessObbeCinemaCameraBoat(void)::OldMode;
  bDidWeProcessAnyCinemaCam = 1;
}

//----- (003DA64C) --------------------------------------------------------
void __fastcall CCamera::ProcessObbeCinemaCameraTrain(CCamera *this)
{
  int v2; // r0
  int v3; // r6
  int v4; // r0
  Int32 v5; // r1
  _BOOL4 started; // r0
  const unsigned __int8 *v7; // r5
  GxtChar *v8; // r0

  if ( !bDidWeProcessAnyCinemaCam
    && ((CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode = -1, gbCineyCamMessageDisplayed < 1)
     || this->m_bForceCinemaCam
     || (v7 = CINCAM,
         --gbCineyCamMessageDisplayed,
         v8 = CText::Get(&TheText, CINCAM),
         CHud::SetHelpMessage(v7, v8, 1, 0, 0, 0),
         !bDidWeProcessAnyCinemaCam))
    || CCamera::IsItTimeForNewcam(
         this,
         SequenceOfTrainCams[CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode],
         CCamera::ProcessObbeCinemaCameraTrain(void)::TimeForNext) )
  {
    v2 = (gCinematicModeSwitchDir + CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode) % 6;
    if ( v2 < 0 )
      v2 = 5;
    CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode = v2;
    if ( CCamera::TryToStartNewCamMode(this, SequenceOfTrainCams[v2]) )
    {
      CCamera::ProcessObbeCinemaCameraTrain(void)::TimeForNext = CTimer::m_snTimeInMilliseconds;
    }
    else
    {
      v3 = -1;
      do
      {
        v4 = (CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode + gCinematicModeSwitchDir) % 6;
        if ( v4 < 0 )
          v4 = 5;
        v5 = SequenceOfTrainCams[v4];
        CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode = v4;
        started = CCamera::TryToStartNewCamMode(this, v5);
        ++v3;
      }
      while ( v3 <= 5 && !started );
      CCamera::ProcessObbeCinemaCameraTrain(void)::TimeForNext = CTimer::m_snTimeInMilliseconds;
      if ( v3 >= 5 )
      {
        CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode = 6;
        CCamera::TryToStartNewCamMode(this, SequenceOfTrainCams[6]);
      }
    }
  }
  this->m_iModeObbeCamIsInForCar = CCamera::ProcessObbeCinemaCameraTrain(void)::OldMode;
  bDidWeProcessAnyCinemaCam = 1;
}

//----- (003DA82C) --------------------------------------------------------
void __fastcall CCamera::ProcessObbeCinemaCameraCar(CCamera *this)
{
  int v2; // r0
  int v3; // r5
  int v4; // r0
  Int32 v5; // r1
  _BOOL4 started; // r0
  const unsigned __int8 *v7; // r5
  GxtChar *v8; // r0

  if ( !bDidWeProcessAnyCinemaCam
    && ((CCamera::ProcessObbeCinemaCameraCar(void)::OldMode = -1, gbCineyCamMessageDisplayed < 1)
     || this->m_bForceCinemaCam
     || (v7 = CINCAM,
         --gbCineyCamMessageDisplayed,
         v8 = CText::Get(&TheText, CINCAM),
         CHud::SetHelpMessage(v7, v8, 1, 0, 0, 0),
         !bDidWeProcessAnyCinemaCam))
    || CCamera::IsItTimeForNewcam(
         this,
         SequenceOfCarCams[CCamera::ProcessObbeCinemaCameraCar(void)::OldMode],
         CCamera::ProcessObbeCinemaCameraCar(void)::TimeForNext) )
  {
    v2 = (gCinematicModeSwitchDir + CCamera::ProcessObbeCinemaCameraCar(void)::OldMode) % 11;
    if ( v2 < 0 )
      v2 = 10;
    CCamera::ProcessObbeCinemaCameraCar(void)::OldMode = v2;
    if ( CCamera::TryToStartNewCamMode(this, SequenceOfCarCams[v2]) )
    {
      CCamera::ProcessObbeCinemaCameraCar(void)::TimeForNext = CTimer::m_snTimeInMilliseconds;
    }
    else
    {
      v3 = -1;
      do
      {
        v4 = (CCamera::ProcessObbeCinemaCameraCar(void)::OldMode + gCinematicModeSwitchDir) % 11;
        if ( v4 < 0 )
          v4 = 10;
        v5 = SequenceOfCarCams[v4];
        CCamera::ProcessObbeCinemaCameraCar(void)::OldMode = v4;
        started = CCamera::TryToStartNewCamMode(this, v5);
        ++v3;
      }
      while ( v3 <= 10 && !started );
      CCamera::ProcessObbeCinemaCameraCar(void)::TimeForNext = CTimer::m_snTimeInMilliseconds;
      if ( v3 >= 10 )
      {
        CCamera::ProcessObbeCinemaCameraCar(void)::OldMode = 11;
        CCamera::TryToStartNewCamMode(this, SequenceOfCarCams[11]);
      }
    }
  }
  this->m_iModeObbeCamIsInForCar = CCamera::ProcessObbeCinemaCameraCar(void)::OldMode;
  bDidWeProcessAnyCinemaCam = 1;
}

//----- (003DAA0C) --------------------------------------------------------
void __fastcall CCamera::DontProcessObbeCinemaCamera(CCamera *this)
{
  bDidWeProcessAnyCinemaCam = 0;
}

//----- (003DAA1C) --------------------------------------------------------
void __fastcall CCamera::StartTransition(CCamera *this, Int16 Mode)
{
  int v3; // r9
  int ActiveCam; // r1
  float *v5; // r2
  unsigned int v6; // r6
  float ATanOfXY; // r0
  CVector *p_m_vecFixedModeVector; // r5
  __int64 v9; // d16
  char *v10; // r2
  CEntity *v11; // r0
  CCam *Cams; // r8
  CEntity *pTargetEntity; // r0
  CCam *v14; // r1
  int v15; // lr
  __int64 v16; // d16
  CCam *v17; // r2
  __int64 v18; // d16
  float xy; // s16
  CMatrix *m_pMat; // r1
  float v21; // r0
  char *v22; // r2
  bool v23; // zf
  float *v24; // r2
  int v25; // r3
  float v26; // r11
  bool v27; // zf
  bool v28; // zf
  char *v29; // r2
  UInt32 v30; // r0
  UInt32 v31; // r11
  _BOOL4 m_vecDoingSpecialInterPolation; // r6
  UInt32 v33; // r0
  RwReal z; // r3
  RwReal v35; // r6
  float m_fAlphaDuringInterPol; // r5
  __int64 v37; // d16
  __int64 v38; // d18
  float *p_m_fBetaDuringInterPol; // r0
  __int64 v40; // d16
  __int64 v41; // d16
  __int64 v42; // d16
  bool m_bLookingAtVector; // r3
  __int64 v44; // d16
  __int64 v45; // d16
  __int64 v46; // d16
  CEntity *v47; // r0
  CEntity *v48; // r0
  CCam *v49; // r1
  int v50; // r1
  UInt32 v51; // r0
  CCam *v52; // r0
  __int64 v53; // d16
  __int64 v54; // d16
  __int64 v55; // d16
  __int64 v56; // kr00_8
  float m_fScriptPercentageInterToCatchUp; // s0
  float m_fScriptPercentageInterToStopMoving; // r0
  UInt32 m_fScriptTimeForInterPolation; // r1
  float *p_m_fFractionInterToStopMoving; // r0
  CCam *v61; // r0
  int v62; // r0
  bool v63; // zf
  float v64; // r0
  float v65; // s0
  CCam *v66; // r0
  float v67; // r0
  float v68; // r0
  float *p_m_fFractionInterToStopCatchUp; // [sp+4h] [bp-34h]

  v3 = Mode;
  ActiveCam = this->ActiveCam;
  v5 = (float *)((char *)this + 528 * ActiveCam);
  v6 = *((unsigned __int16 *)v5 + 191);
  this->m_bItsOkToLookJustAtThePlayer = 0;
  this->m_bUseTransitionBeta = 0;
  this->m_fFractionInterToStopMoving = 0.25;
  this->m_fFractionInterToStopCatchUp = 0.75;
  switch ( *((_WORD *)v5 + 191) )
  {
    case 7:
    case 8:
    case 0x22:
    case 0x27:
    case 0x28:
    case 0x29:
    case 0x2A:
    case 0x2B:
    case 0x2D:
    case 0x2E:
    case 0x33:
    case 0x34:
      if ( (*(_BYTE *)&this->pTargetEntity->m_info & 7) == 3 )
      {
        ATanOfXY = CGeneral::GetATanOfXY(v5[182], v5[183]);
        *(float *)&this->pTargetEntity[22].m_pLod = ATanOfXY + -1.5708;
        *(float *)&this->pTargetEntity[22].numLodChildren = ATanOfXY + -1.5708;
        ActiveCam = this->ActiveCam;
      }
      break;
    default:
      break;
  }
  p_m_vecFixedModeVector = &this->m_vecFixedModeVector;
  v9 = *(_QWORD *)&this->m_vecFixedModeVector.x;
  v10 = (char *)this + 528 * ActiveCam;
  *((_DWORD *)v10 + 169) = LODWORD(this->m_vecFixedModeVector.z);
  *(_QWORD *)(v10 + 668) = v9;
  v11 = (CEntity *)*((_DWORD *)v10 + 217);
  if ( v11 )
  {
    CEntity::CleanUpOldReference(v11, (CEntity **)v10 + 217);
    ActiveCam = this->ActiveCam;
  }
  Cams = this->Cams;
  pTargetEntity = this->pTargetEntity;
  v14 = &this->Cams[ActiveCam];
  v14->CamTargetEntity = pTargetEntity;
  CEntity::RegisterReference(pTargetEntity, &v14->CamTargetEntity);
  v15 = this->ActiveCam;
  v16 = *(_QWORD *)&this->m_vecFixedModeSource.x;
  v17 = &this->Cams[v15];
  v17->m_cvecCamFixedModeSource.z = this->m_vecFixedModeSource.z;
  *(_QWORD *)&v17->m_cvecCamFixedModeSource.x = v16;
  v18 = *(_QWORD *)&this->m_vecFixedModeUpOffSet.x;
  v17->m_cvecCamFixedModeUpOffSet.z = this->m_vecFixedModeUpOffSet.z;
  *(_QWORD *)&v17->m_cvecCamFixedModeUpOffSet.x = v18;
  v17->m_bCamLookingAtVector = this->m_bLookingAtVector;
  switch ( v3 )
  {
    case 3:
    case 22:
      this->Cams[v15].BetaSpeed = 0.0;
      break;
    case 4:
      if ( this->m_bJustCameOutOfGarage )
      {
        v64 = CGeneral::GetATanOfXY(v17->Front.x, v17->Front.y);
        v15 = this->ActiveCam;
        v65 = v64 + 3.1416;
        v66 = &Cams[v15];
        v66->m_fTransitionBeta = 0.0;
        v66->Beta = v65;
      }
      if ( this->m_bTargetJustCameOffTrain )
        this->m_bCamDirectlyInFront = 1;
      if ( this->Cams[v15].Mode == 18 )
      {
        this->m_bUseTransitionBeta = 1;
        v67 = CGeneral::GetATanOfXY(Cams[v15].Front.x, Cams[v15].Front.y);
        v15 = this->ActiveCam;
        Cams[v15].m_fTransitionBeta = (float)(v67 + 3.1416) + 0.95993;
      }
      break;
    case 7:
    case 8:
    case 34:
    case 39:
    case 40:
    case 41:
    case 42:
    case 43:
    case 45:
    case 46:
    case 51:
    case 52:
      if ( FindPlayerVehicle(-1, 0) )
      {
        xy = FindPlayerVehicle(-1, 0)->m_pMat->xy;
        m_pMat = FindPlayerVehicle(-1, 0)->m_pMat;
      }
      else
      {
        m_pMat = CWorld::Players[CWorld::PlayerInFocus].pPed->m_pMat;
        xy = m_pMat->xy;
      }
      v21 = atan2f(xy, m_pMat->yy);
      v15 = this->ActiveCam;
      v22 = (char *)this + 528 * v15;
      *((_DWORD *)v22 + 125) = 0;
      *((float *)v22 + 129) = v21;
      break;
    case 18:
      if ( this->m_bLookingAtPlayer && !this->m_bJustCameOutOfGarage )
      {
        this->m_bUseTransitionBeta = 1;
        v68 = CGeneral::GetATanOfXY(v17->Front.x, v17->Front.y);
        v15 = this->ActiveCam;
        Cams[v15].m_fTransitionBeta = v68;
      }
      break;
    case 29:
      this->Cams[v15].Alpha = 0.2618;
      break;
    default:
      break;
  }
  p_m_fFractionInterToStopCatchUp = &this->m_fFractionInterToStopCatchUp;
  v23 = v3 == 18;
  v24 = (float *)((char *)this + 528 * v15);
  v25 = *((unsigned __int16 *)v24 + 191);
  v26 = v24[129];
  if ( v3 == 18 )
    v23 = v25 == 4;
  if ( v23 )
    goto LABEL_18;
  v27 = v3 == 4;
  if ( v3 == 4 )
    v27 = v25 == 18;
  if ( v27 )
  {
LABEL_18:
    *((_WORD *)v24 + 191) = v3;
  }
  else
  {
    CCam::Init(&Cams[v15]);
    v15 = this->ActiveCam;
    v61 = &Cams[v15];
    v61->Beta = v26;
    v61->Mode = v3;
  }
  v28 = v3 == 11;
  v29 = (char *)this + 528 * v15;
  v29[379] = 1;
  this->m_uiTransitionDuration = 1350;
  if ( v3 == 11 )
    v28 = v6 == 28;
  if ( v28 )
  {
    v30 = 1800;
LABEL_24:
    this->m_uiTransitionDuration = v30;
    v31 = 600;
    goto LABEL_25;
  }
  p_m_fFractionInterToStopMoving = &this->m_fFractionInterToStopMoving;
  if ( v3 == 18 )
  {
    switch ( v6 )
    {
      case 4u:
      case 0xBu:
      case 0x1Cu:
      case 0x23u:
      case 0x35u:
        *p_m_fFractionInterToStopMoving = 0.1;
        *p_m_fFractionInterToStopCatchUp = 0.9;
        v30 = 750;
        goto LABEL_24;
      case 0xFu:
        goto LABEL_44;
      default:
        goto LABEL_45;
    }
  }
  if ( v6 == 15 )
  {
LABEL_44:
    *p_m_fFractionInterToStopMoving = 0.05;
    v62 = 1064514355;
LABEL_51:
    v31 = 600;
    *(_DWORD *)p_m_fFractionInterToStopCatchUp = v62;
    goto LABEL_25;
  }
  if ( v6 == 35 )
  {
    *p_m_fFractionInterToStopMoving = 0.2;
    *p_m_fFractionInterToStopCatchUp = 0.8;
    v30 = 1000;
    goto LABEL_24;
  }
LABEL_45:
  v63 = v6 == 18;
  if ( v6 == 18 )
    v63 = v3 == 4;
  if ( v63 && this->m_bPlayerWasOnBike )
  {
    this->m_uiTransitionDuration = 800;
    *p_m_fFractionInterToStopMoving = 0.02;
    v62 = 1065017672;
    goto LABEL_51;
  }
  switch ( v3 )
  {
    case 4:
    case 11:
    case 28:
    case 35:
      if ( (v6 > 0x1C || ((1 << v6) & 0x10000810) == 0) && v6 != 53 )
        goto LABEL_70;
      v31 = 350;
      *p_m_fFractionInterToStopMoving = 0.1;
      *p_m_fFractionInterToStopCatchUp = 0.9;
      this->m_uiTransitionDuration = 350;
      break;
    case 18:
    case 22:
      if ( v6 - 39 > 0xD || ((1 << (v6 - 39)) & 0x209F) == 0 )
        goto LABEL_70;
      v31 = 600;
      *p_m_fFractionInterToStopMoving = 0.0;
      *p_m_fFractionInterToStopCatchUp = 1.0;
      this->m_uiTransitionDuration = 1;
      break;
    case 53:
      v31 = 350;
      *p_m_fFractionInterToStopMoving = 0.0;
      *p_m_fFractionInterToStopCatchUp = 1.0;
      this->m_uiTransitionDuration = 400;
      break;
    default:
LABEL_70:
      v30 = 1350;
      goto LABEL_24;
  }
LABEL_25:
  this->m_uiTransitionState = 1;
  m_vecDoingSpecialInterPolation = this->m_vecDoingSpecialInterPolation;
  v33 = CTimer::m_snTimeInMilliseconds;
  this->m_uiTransitionJUSTStarted = 1;
  this->m_uiTimeTransitionStart = v33;
  if ( m_vecDoingSpecialInterPolation )
  {
    z = this->TargetDuringInter.z;
    v35 = this->UpDuringInter.z;
    m_fAlphaDuringInterPol = this->m_fAlphaDuringInterPol;
    this->m_cvecStartingSourceForInterPol.z = this->SourceDuringInter.z;
    this->m_cvecStartingTargetForInterPol.z = z;
    this->m_cvecStartingUpForInterPol.z = v35;
    this->m_fStartingAlphaForInterPol = m_fAlphaDuringInterPol;
    p_m_vecFixedModeVector = &this->m_vecFixedModeVector;
    v37 = *(_QWORD *)&this->UpDuringInter.x;
    v38 = *(_QWORD *)&this->TargetDuringInter.x;
    *(_QWORD *)&this->m_cvecStartingSourceForInterPol.x = *(_QWORD *)&this->SourceDuringInter.x;
    *(_QWORD *)&this->m_cvecStartingTargetForInterPol.x = v38;
    *(_QWORD *)&this->m_cvecStartingUpForInterPol.x = v37;
    p_m_fBetaDuringInterPol = &this->m_fBetaDuringInterPol;
  }
  else
  {
    v40 = *(_QWORD *)(v29 + 740);
    this->m_cvecStartingSourceForInterPol.z = *((RwReal *)v29 + 187);
    *(_QWORD *)&this->m_cvecStartingSourceForInterPol.x = v40;
    v41 = *((_QWORD *)v29 + 82);
    this->m_cvecStartingTargetForInterPol.z = *((RwReal *)v29 + 166);
    *(_QWORD *)&this->m_cvecStartingTargetForInterPol.x = v41;
    v42 = *(_QWORD *)(v29 + 764);
    this->m_cvecStartingUpForInterPol.z = *((RwReal *)v29 + 193);
    *(_QWORD *)&this->m_cvecStartingUpForInterPol.x = v42;
    this->m_fStartingAlphaForInterPol = *((float *)v29 + 123);
    p_m_fBetaDuringInterPol = (float *)(v29 + 488);
  }
  m_bLookingAtVector = this->m_bLookingAtVector;
  this->m_fStartingBetaForInterPol = *p_m_fBetaDuringInterPol;
  v29[370] = m_bLookingAtVector;
  v44 = *(_QWORD *)&p_m_vecFixedModeVector->x;
  *((_DWORD *)v29 + 169) = LODWORD(p_m_vecFixedModeVector->z);
  *(_QWORD *)(v29 + 668) = v44;
  v45 = *(_QWORD *)&this->m_vecFixedModeSource.x;
  *((_DWORD *)v29 + 172) = LODWORD(this->m_vecFixedModeSource.z);
  *((_QWORD *)v29 + 85) = v45;
  v46 = *(_QWORD *)&this->m_vecFixedModeUpOffSet.x;
  *((_DWORD *)v29 + 175) = LODWORD(this->m_vecFixedModeUpOffSet.z);
  *(_QWORD *)(v29 + 692) = v46;
  *((_WORD *)v29 + 191) = v3;
  v47 = (CEntity *)*((_DWORD *)v29 + 217);
  if ( v47 )
  {
    CEntity::CleanUpOldReference(v47, (CEntity **)v29 + 217);
    v15 = this->ActiveCam;
  }
  v48 = this->pTargetEntity;
  v49 = &Cams[v15];
  v49->CamTargetEntity = v48;
  CEntity::RegisterReference(v48, &v49->CamTargetEntity);
  v50 = this->ActiveCam;
  this->m_uiTransitionState = 1;
  v51 = CTimer::m_snTimeInMilliseconds;
  this->m_uiTransitionJUSTStarted = 1;
  this->m_uiTimeTransitionStart = v51;
  v52 = &Cams[v50];
  this->m_fStartingFOVForInterPol = v52->FOV;
  v53 = *(_QWORD *)&v52->m_cvecSourceSpeedOverOneFrame.x;
  this->m_cvecSourceSpeedAtStartInter.z = v52->m_cvecSourceSpeedOverOneFrame.z;
  *(_QWORD *)&this->m_cvecSourceSpeedAtStartInter.x = v53;
  v54 = *(_QWORD *)&v52->m_cvecTargetSpeedOverOneFrame.x;
  this->m_cvecTargetSpeedAtStartInter.z = v52->m_cvecTargetSpeedOverOneFrame.z;
  *(_QWORD *)&this->m_cvecTargetSpeedAtStartInter.x = v54;
  v55 = *(_QWORD *)&v52->m_cvecUpOverOneFrame.x;
  this->m_cvecUpSpeedAtStartInter.z = v52->m_cvecUpOverOneFrame.z;
  *(_QWORD *)&this->m_cvecUpSpeedAtStartInter.x = v55;
  v56 = *(_QWORD *)&v52->m_fAlphaSpeedOverOneFrame;
  LODWORD(this->m_fAlphaSpeedAtStartInter) = v56;
  this->m_fBetaSpeedAtStartInter = *((float *)&v56 + 1);
  this->m_fFOVSpeedAtStartInter = v52->m_fFovSpeedOverOneFrame;
  if ( this->m_bLookingAtPlayer )
  {
    m_fScriptPercentageInterToCatchUp = 1.0;
    this->m_fFractionInterToStopMovingTarget = 0.0;
    this->m_uiTransitionDurationTargetCoors = v31;
  }
  else
  {
    if ( this->m_bScriptParametersSetForInterPol )
    {
      m_fScriptPercentageInterToStopMoving = this->m_fScriptPercentageInterToStopMoving;
      m_fScriptTimeForInterPolation = this->m_fScriptTimeForInterPolation;
      m_fScriptPercentageInterToCatchUp = this->m_fScriptPercentageInterToCatchUp;
      this->m_fFractionInterToStopMoving = m_fScriptPercentageInterToStopMoving;
      this->m_fFractionInterToStopCatchUp = m_fScriptPercentageInterToCatchUp;
      this->m_uiTransitionDuration = m_fScriptTimeForInterPolation;
    }
    else
    {
      m_fScriptTimeForInterPolation = this->m_uiTransitionDuration;
      m_fScriptPercentageInterToCatchUp = *p_m_fFractionInterToStopCatchUp;
      m_fScriptPercentageInterToStopMoving = this->m_fFractionInterToStopMoving;
    }
    this->m_fFractionInterToStopMovingTarget = m_fScriptPercentageInterToStopMoving;
    this->m_uiTransitionDurationTargetCoors = m_fScriptTimeForInterPolation;
  }
  this->m_fFractionInterToStopCatchUpTarget = m_fScriptPercentageInterToCatchUp;
}

//----- (003DB14C) --------------------------------------------------------
void __fastcall CCamera::StartTransitionWhenNotFinishedInter(CCamera *this, Int16 Mode)
{
  this->m_vecDoingSpecialInterPolation = 1;
  CCamera::StartTransition(this, Mode);
}

//----- (003DB154) --------------------------------------------------------
void __fastcall CCamera::RestoreWithJumpCut(CCamera *this)
{
  CEntity **p_pTargetEntity; // r5
  CEntity *pTargetEntity; // r0
  CEntity *PlayerVehicle; // r0
  CEntity *v5; // r0
  __int16 v6; // r1
  CPlayerInfo *v7; // r0
  ePedState m_nPedState; // r2
  bool v9; // zf
  CEntity *v10; // r0
  CPlayerPed *pPed; // r0
  CPlayerPed *v12; // r0
  bool v13; // zf
  CVehicle *v14; // r1
  CVehicle *m_pMyVehicle; // r2
  bool v16; // zf
  Int16 *p_m_ModeForTwoPlayersSameCarShootingAllowed; // r1

  this->m_bLookingAtPlayer = 1;
  this->m_bRestoreByJumpCut = 1;
  this->m_bLookingAtVector = 0;
  this->m_iTypeOfSwitch = 2;
  this->WhoIsInControlOfTheCamera = 0;
  this->m_fPositionAlongSpline = 0.0;
  this->m_bStartingSpline = 0;
  this->m_bUseNearClipScript = 0;
  this->m_iModeObbeCamIsInForCar = 30;
  this->m_bScriptParametersSetForInterPol = 0;
  this->m_bCameraJustRestored = 1;
  this->m_bEnable1rstPersonCamCntrlsScript = 0;
  this->m_bAllow1rstPersonWeaponsCamera = 0;
  if ( FindPlayerVehicle(-1, 0) )
  {
    p_pTargetEntity = &this->pTargetEntity;
    this->m_iModeToGoTo = 18;
    pTargetEntity = this->pTargetEntity;
    if ( pTargetEntity )
      CEntity::CleanUpOldReference(pTargetEntity, &this->pTargetEntity);
    PlayerVehicle = FindPlayerVehicle(-1, 0);
  }
  else
  {
    p_pTargetEntity = &this->pTargetEntity;
    this->m_iModeToGoTo = 4;
    v5 = this->pTargetEntity;
    if ( v5 )
      CEntity::CleanUpOldReference(v5, &this->pTargetEntity);
    PlayerVehicle = CWorld::Players[CWorld::PlayerInFocus].pPed;
  }
  *p_pTargetEntity = PlayerVehicle;
  CEntity::RegisterReference(PlayerVehicle, p_pTargetEntity);
  v6 = CWorld::PlayerInFocus;
  v7 = &CWorld::Players[CWorld::PlayerInFocus];
  m_nPedState = v7->pPed->m_nPedState;
  if ( m_nPedState == PED_ENTER_CAR )
  {
    this->m_iModeToGoTo = 18;
    m_nPedState = v7->pPed->m_nPedState;
  }
  v9 = m_nPedState == PED_CARJACK;
  if ( m_nPedState != PED_CARJACK )
    v9 = m_nPedState == PED_OPEN_DOOR;
  if ( v9 )
  {
    this->m_iModeToGoTo = 18;
    m_nPedState = v7->pPed->m_nPedState;
  }
  if ( m_nPedState == PED_EXIT_CAR )
  {
    this->m_iModeToGoTo = 4;
    v10 = this->pTargetEntity;
    if ( v10 )
    {
      CEntity::CleanUpOldReference(v10, &this->pTargetEntity);
      v6 = CWorld::PlayerInFocus;
    }
    pPed = CWorld::Players[v6].pPed;
    this->pTargetEntity = pPed;
    CEntity::RegisterReference(pPed, &this->pTargetEntity);
  }
  if ( this->m_bCooperativeCamMode )
  {
    v12 = CWorld::Players[0].pPed;
    v13 = CWorld::Players[0].pPed == 0;
    if ( CWorld::Players[0].pPed )
      v13 = CWorld::Players[1].pPed == 0;
    if ( !v13 )
    {
      if ( this->pTargetEntity )
      {
        CEntity::CleanUpOldReference(this->pTargetEntity, &this->pTargetEntity);
        v12 = CWorld::Players[0].pPed;
      }
      if ( !(*((unsigned __int8 *)&v12->m_nPedFlags + 1) << 31) )
        goto LABEL_32;
      v14 = (CVehicle *)CWorld::Players[1].pPed;
      if ( !(*((unsigned __int8 *)&CWorld::Players[1].pPed->m_nPedFlags + 1) << 31) )
        goto LABEL_32;
      m_pMyVehicle = v12->m_pMyVehicle;
      v16 = m_pMyVehicle == 0;
      if ( m_pMyVehicle )
      {
        v14 = CWorld::Players[1].pPed->m_pMyVehicle;
        v16 = v14 == 0;
      }
      if ( !v16 )
      {
        if ( m_pMyVehicle == v14 )
        {
          if ( this->m_bAllowShootingWith2PlayersInCar )
            p_m_ModeForTwoPlayersSameCarShootingAllowed = &this->m_ModeForTwoPlayersSameCarShootingAllowed;
          else
            p_m_ModeForTwoPlayersSameCarShootingAllowed = &this->m_ModeForTwoPlayersSameCarShootingNotAllowed;
        }
        else
        {
          p_m_ModeForTwoPlayersSameCarShootingAllowed = &this->m_ModeForTwoPlayersSeparateCars;
        }
        this->m_iModeToGoTo = *p_m_ModeForTwoPlayersSameCarShootingAllowed;
        v12 = (CPlayerPed *)v12->m_pMyVehicle;
      }
      else
      {
LABEL_32:
        this->m_iModeToGoTo = this->m_ModeForTwoPlayersNotBothInCar;
      }
      this->pTargetEntity = v12;
      CEntity::RegisterReference(v12, &this->pTargetEntity);
    }
  }
  *(_WORD *)&this->m_bUseScriptZoomValuePed = 0;
}
// FC: using guessed type int elf_hash_bucket[16411];

//----- (003DB338) --------------------------------------------------------
void __fastcall CCamera::CamShake(CCamera *this, float Power, float xCoor, float yCoor, float zCoor)
{
  float32x2_t v5; // d0
  float32x2_t v6; // d1
  float32x2_t v7; // d2
  float32x2_t v8; // d3
  float *v9; // r3
  float v10; // s0

  v5.n64_f32[0] = yCoor;
  v9 = (float *)((char *)this + 528 * this->ActiveCam);
  v5.n64_f32[0] = sqrtf(
                    (float)((float)(v9[185] - xCoor) * (float)(v9[185] - xCoor))
                  + (float)((float)(v9[186] - v5.n64_f32[0]) * (float)(v9[186] - v5.n64_f32[0])));
  v6.n64_u32[0] = 1120403456;
  v5.n64_f32[0] = sqrtf(
                    (float)((float)(v9[187] - zCoor) * (float)(v9[187] - zCoor))
                  + (float)(v5.n64_f32[0] * v5.n64_f32[0]));
  v6.n64_f32[0] = vmin_f32(v5, v6).n64_f32[0] * -0.01 + 1.0;
  v10 = (float)(v6.n64_f32[0] * 0.35) * Power;
  v7.n64_u32[0] = 2.0;
  v6.n64_f32[0] = (float)(this->m_fCamShakeForce
                        + (float)((float)(CTimer::m_snTimeInMilliseconds - this->m_uiCamShakeStart) * -0.001))
                * v6.n64_f32[0];
  v8.n64_u32[0] = 0;
  if ( v10 > vmax_f32(vmin_f32(v6, v7), v8).n64_f32[0] )
  {
    this->m_uiCamShakeStart = CTimer::m_snTimeInMilliseconds;
    this->m_fCamShakeForce = v10;
  }
}
// 3DB3A0: variable 'v5' is possibly undefined
// 3DB3A0: variable 'v6' is possibly undefined
// 3DB3E8: variable 'v7' is possibly undefined
// 3DB3EC: variable 'v8' is possibly undefined

//----- (003DB424) --------------------------------------------------------
void __fastcall CCamera::GetScreenRect(CCamera *this, CRect *rect)
{
  rect->left = 0.0;
  rect->right = (float)RsGlobal.screenWidth;
  if ( this->m_WideScreenOn )
  {
    rect->top = (float)((float)(this->m_ScreenReductionPercentage / 100.0) * (float)(RsGlobal.screenHeight / 2))
              + (float)((float)((float)RsGlobal.screenHeight / 448.0) * -22.0);
    rect->bottom = (float)((float)RsGlobal.screenHeight
                         - (float)((float)(this->m_ScreenReductionPercentage / 100.0)
                                 * (float)(RsGlobal.screenHeight / 2)))
                 + (float)((float)((float)RsGlobal.screenHeight / 448.0) * -14.0);
  }
  else
  {
    rect->top = 0.0;
    rect->bottom = (float)RsGlobal.screenHeight;
  }
}

//----- (003DB4F0) --------------------------------------------------------
void __fastcall CCamera::DrawBordersForWideScreen(CCamera *this)
{
  float v1; // s16
  CRGBA v2; // [sp+4h] [bp-2Ch] BYREF
  CRect Rectangle; // [sp+8h] [bp-28h] BYREF

  if ( (this->m_BlurType | 2) == 2 )
    this->m_imotionBlurAddAlpha = 80;
  RwRenderStateSet(rwRENDERSTATETEXTURERASTER, 0);
  if ( (float)((float)((float)RsGlobal.screenHeight + (float)((float)RsGlobal.screenWidth * -0.5625)) * 0.5) > 0.0 )
  {
    v1 = (float)((float)RsGlobal.screenHeight + (float)((float)RsGlobal.screenWidth * -0.5625)) * 0.5;
    Rectangle.bottom = 0.0;
    Rectangle.left = 0.0;
    Rectangle.right = (float)RsGlobal.screenWidth;
    Rectangle.top = v1;
    CRGBA::CRGBA(&v2, 0, 0, 0, 0xFFu);
    CSprite2d::DrawRect(&Rectangle, &v2);
    Rectangle.left = 0.0;
    Rectangle.bottom = (float)RsGlobal.screenHeight;
    Rectangle.right = (float)RsGlobal.screenWidth;
    Rectangle.top = (float)RsGlobal.screenHeight - v1;
    CRGBA::CRGBA(&v2, 0, 0, 0, 0xFFu);
    CSprite2d::DrawRect(&Rectangle, &v2);
  }
}

//----- (003DB5D8) --------------------------------------------------------
void __fastcall CCamera::SetMotionBlurAlpha(CCamera *this, int blur)
{
  this->m_imotionBlurAddAlpha = blur;
}

//----- (003DB5E0) --------------------------------------------------------
float __fastcall CCamera::GetCutsceneBarHeight(CCamera *this)
{
  float32x2_t v1; // d0
  float32x2_t v2; // d1
  float result; // r0

  v2.n64_u32[0] = 0;
  v1.n64_f32[0] = (float)((float)RsGlobal.screenHeight + (float)((float)RsGlobal.screenWidth * -0.5625)) * 0.5;
  LODWORD(result) = vmax_f32(v1, v2).n64_u32[0];
  return result;
}
// 3DB60E: variable 'v1' is possibly undefined
// 3DB60E: variable 'v2' is possibly undefined

//----- (003DB620) --------------------------------------------------------
void __fastcall CCamera::Enable1rstPersonCamCntrlsScript(CCamera *this)
{
  this->m_bEnable1rstPersonCamCntrlsScript = 1;
}

//----- (003DB628) --------------------------------------------------------
void __fastcall CCamera::Enable1rstPersonWeaponsCamera(CCamera *this)
{
  this->m_bAllow1rstPersonWeaponsCamera = 1;
}

//----- (003DB630) --------------------------------------------------------
void __fastcall CCamera::Fade(CCamera *this, float FadeOutTime, Int16 OutOrIn)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float32x2_t v5; // d2
  float32x2_t v6; // d3
  bool v7; // zf
  _BOOL4 m_bIgnoreFadingStuffForMusic; // r4
  UInt32 v9; // lr
  float32x2_t v10; // d0
  float v11; // s2

  this->m_iFadingDirection = OutOrIn;
  v7 = OutOrIn == 1;
  this->m_bFading = 1;
  this->m_fTimeToFadeOut = FadeOutTime;
  m_bIgnoreFadingStuffForMusic = this->m_bIgnoreFadingStuffForMusic;
  v9 = CTimer::m_snTimeInMilliseconds;
  this->m_uiFadeTimeStarted = CTimer::m_snTimeInMilliseconds;
  if ( OutOrIn != 1 )
    v7 = !m_bIgnoreFadingStuffForMusic;
  if ( v7 )
  {
    v4.n64_f32[0] = FadeOutTime;
    v3.n64_u32[0] = 1050253722;
    v5.n64_f32[0] = FadeOutTime * 0.3;
    this->m_iMusicFadingDirection = OutOrIn;
    this->m_bMusicFading = 1;
    v10.n64_u64[0] = vmin_f32(vmax_f32(v5, v3), v4).n64_u64[0];
    if ( OutOrIn )
    {
      v11 = 0.0;
    }
    else
    {
      v11 = FadeOutTime - v10.n64_f32[0];
      v6.n64_u32[0] = 0;
      v10.n64_f32[0] = v10.n64_f32[0] + -0.1;
      v10.n64_u32[0] = vmax_f32(v10, v6).n64_u32[0];
    }
    LODWORD(this->m_fTimeToFadeMusic) = v10.n64_u32[0];
    this->m_uiFadeTimeStartedMusic = v9;
    this->m_fTimeToWaitToFadeMusic = v11;
  }
}
// 3DB678: variable 'v5' is possibly undefined
// 3DB678: variable 'v3' is possibly undefined
// 3DB67C: variable 'v4' is possibly undefined
// 3DB698: variable 'v6' is possibly undefined

//----- (003DB6C0) --------------------------------------------------------
void __fastcall CCamera::FinishCutscene(CCamera *this)
{
  int ActiveCam; // r1

  ActiveCam = this->ActiveCam;
  if ( this->Cams[ActiveCam].Mode == 17
    || (ActiveCam = (ActiveCam & 1) == 0, *(&this->Cams[0].Mode + 8 * (ActiveCam | (32 * ActiveCam))) == 17) )
  {
    this->Cams[ActiveCam].m_fTimeElapsedFloat = (float)this->Cams[ActiveCam].m_uiFinishTime;
  }
  this->m_bcutsceneFinished = 1;
  this->m_fPositionAlongSpline = 1.0;
}

//----- (003DB70C) --------------------------------------------------------
void __fastcall CCamera::SetPercentAlongCutScene(CCamera *this, float Percentage)
{
  int ActiveCam; // r2

  ActiveCam = this->ActiveCam;
  if ( this->Cams[ActiveCam].Mode == 17
    || (ActiveCam = (ActiveCam & 1) == 0, *(&this->Cams[0].Mode + 8 * (ActiveCam | (32 * ActiveCam))) == 17) )
  {
    this->Cams[ActiveCam].m_fTimeElapsedFloat = (float)(Percentage / 100.0)
                                              * (float)this->Cams[ActiveCam].m_uiFinishTime;
  }
}

//----- (003DB764) --------------------------------------------------------
float __fastcall CCamera::FindCamFOV(CCamera *this)
{
  return this->Cams[this->ActiveCam].FOV;
}

//----- (003DB778) --------------------------------------------------------
// local variable allocation has failed, the output may be wrong!
int __fastcall CCamera::Find3rdPersonCamTargetVector(
        CCamera *this,
        float fRange,
        CVector vecGunMuzzle,
        CVector *vecSource,
        CVector *vecTarget)
{
  CCam *Cams; // r11
  float y; // r9
  float x; // r8
  CCam *v10; // r6
  float v11; // s18
  float v12; // r0
  __int64 v13; // d16
  float v14; // s2
  float v15; // s0
  CCam *v16; // r1
  __int64 v17; // d16
  CCam *v18; // r1
  float v19; // s22
  float v20; // s0
  RwReal v21; // s4
  RwReal v22; // s2
  RwReal v23; // s0
  const CVector *v24; // r0
  float v25; // s0
  RwReal v26; // s4
  RwReal v27; // s2
  RwReal v28; // s0
  float v29; // s2
  float v30; // s12
  float z; // s4
  float v32; // s1
  float v33; // s6
  RwReal v34; // s0
  RwReal v35; // s2
  RwReal v36; // s4
  RwReal v37; // s2
  RwReal v38; // s4
  CVector v40; // [sp+4h] [bp-4Ch] BYREF

  Cams = this->Cams;
  y = vecGunMuzzle.y;
  x = vecGunMuzzle.x;
  v10 = &this->Cams[this->ActiveCam];
  v11 = CCamera::m_f3rdPersonCHairMultX;
  v12 = tanf((float)((float)(v10->FOV * 0.5) * 3.1416) / 180.0);
  v13 = *(_QWORD *)&v10->Source.x;
  v14 = CDraw::ms_fAspectRatio;
  v15 = CCamera::m_f3rdPersonCHairMultY;
  vecSource->z = v10->Source.z;
  *(_QWORD *)&vecSource->x = v13;
  v16 = &Cams[this->ActiveCam];
  v17 = *(_QWORD *)&v16->Front.x;
  vecTarget->z = v16->Front.z;
  *(_QWORD *)&vecTarget->x = v17;
  v18 = &Cams[this->ActiveCam];
  if ( v18->Mode == 49 )
  {
    CCam::Get_TwoPlayer_AimVector(&this->Cams[this->ActiveCam], vecTarget);
  }
  else
  {
    v19 = v12;
    v20 = v12 * (float)((float)((float)(0.5 - v15) + (float)(0.5 - v15)) * (float)(1.0 / v14));
    v21 = (float)(v20 * v18->Up.y) + vecTarget->y;
    v22 = (float)(v20 * v18->Up.x) + vecTarget->x;
    v23 = (float)(v20 * v18->Up.z) + vecTarget->z;
    vecTarget->x = v22;
    vecTarget->y = v21;
    vecTarget->z = v23;
    v24 = (const CVector *)&Cams[this->ActiveCam];
    CrossProduct(&v40, v24 + 30, v24 + 33);
    v25 = v19 * (float)((float)(v11 + -0.5) + (float)(v11 + -0.5));
    v26 = (float)(v25 * v40.y) + vecTarget->y;
    v27 = (float)(v25 * v40.x) + vecTarget->x;
    v28 = (float)(v25 * v40.z) + vecTarget->z;
    vecTarget->x = v27;
    vecTarget->y = v26;
    vecTarget->z = v28;
    CVector::Normalise(vecTarget);
  }
  v29 = vecSource->y;
  v30 = vecTarget->y;
  z = vecSource->z;
  v32 = vecTarget->z;
  v33 = (float)((float)((float)(x - vecSource->x) * vecTarget->x) + (float)((float)(y - v29) * v30))
      + (float)((float)(vecGunMuzzle.z - z) * v32);
  v34 = vecSource->x + (float)(vecTarget->x * v33);
  v35 = v29 + (float)(v30 * v33);
  v36 = (float)(v32 * v33) + z;
  vecSource->x = v34;
  vecSource->y = v35;
  vecSource->z = v36;
  v37 = (float)(vecTarget->y * fRange) + v35;
  v38 = v36 + (float)(vecTarget->z * fRange);
  vecTarget->x = (float)(vecTarget->x * fRange) + v34;
  vecTarget->y = v37;
  vecTarget->z = v38;
  return 1;
}
// 3DB778: fragmented variable at 0:r2.8,8:^58.4 may be wrong
// 3DB778: variables would overlap: 0:r2.8,8:^58.4 and ^58.4

//----- (003DB9C0) --------------------------------------------------------
UInt32 __fastcall CCamera::GetCutSceneFinishTime(CCamera *this)
{
  int ActiveCam; // r1

  ActiveCam = this->ActiveCam;
  if ( this->Cams[ActiveCam].Mode == 17 )
    return this->Cams[ActiveCam].m_uiFinishTime;
  ActiveCam = (ActiveCam & 1) == 0;
  if ( *(&this->Cams[0].Mode + 8 * (ActiveCam | (32 * ActiveCam))) == 17 )
    return this->Cams[ActiveCam].m_uiFinishTime;
  else
    return 0;
}

//----- (003DB9FC) --------------------------------------------------------
bool8 __fastcall CCamera::Get_Just_Switched_Status(CCamera *this)
{
  return this->m_bJust_Switched;
}

//----- (003DBA04) --------------------------------------------------------
int __fastcall CCamera::GetScreenFadeStatus(CCamera *this)
{
  float m_fFloatingFade; // s2
  int result; // r0

  m_fFloatingFade = this->m_fFloatingFade;
  result = 1;
  if ( m_fFloatingFade == 255.0 )
    result = 2;
  if ( m_fFloatingFade == 0.0 )
    return 0;
  return result;
}

//----- (003DBA30) --------------------------------------------------------
CVector *__fastcall CCamera::GetGameCamPosition(CCamera *this)
{
  return &this->m_vecGameCamPos;
}

//----- (003DBA36) --------------------------------------------------------
bool __fastcall CCamera::GetLookingLRBFirstPerson(CCamera *this)
{
  char *v1; // r0

  v1 = (char *)this + 528 * this->ActiveCam;
  return *((_WORD *)v1 + 191) == 16 && *((_DWORD *)v1 + 100) != 3;
}

//----- (003DBA5A) --------------------------------------------------------
int __fastcall CCamera::GetLookDirection(CCamera *this)
{
  int result; // r0
  bool v2; // zf

  result = (int)this + 528 * this->ActiveCam;
  if ( (unsigned __int16)(((unsigned __int16)(*(_WORD *)(result + 382) - 4) >> 1) | ((*(_WORD *)(result + 382) - 4) << 15)) > 9u )
    return 3;
  v2 = ((1 << ((unsigned __int16)(*(_WORD *)(result + 382) - 4) >> 1)) & 0x2C1) == 0;
  if ( ((1 << ((unsigned __int16)(*(_WORD *)(result + 382) - 4) >> 1)) & 0x2C1) != 0 )
  {
    result = *(_DWORD *)(result + 400);
    v2 = result == 3;
  }
  if ( v2 )
    return 3;
  return result;
}

//----- (003DBA94) --------------------------------------------------------
bool __fastcall CCamera::GetLookingForwardFirstPerson(CCamera *this)
{
  char *v1; // r0
  int v2; // r1
  bool v3; // zf

  v1 = (char *)this + 528 * this->ActiveCam;
  v2 = *((unsigned __int16 *)v1 + 191);
  v3 = v2 == 16;
  if ( v2 == 16 )
    return *((_DWORD *)v1 + 100) == 3;
  return v3;
}

//----- (003DBAB8) --------------------------------------------------------
float __fastcall CCamera::GetPositionAlongSpline(CCamera *this)
{
  return this->m_fPositionAlongSpline;
}

//----- (003DBAC0) --------------------------------------------------------
bool __fastcall CCamera::IsItTimeForNewcam(CCamera *this, Int32 MovieCamMode, Int32 TimeWhenStarted)
{
  float32x2_t v3; // d0
  float32x2_t v4; // d1
  float v8; // s16
  bool v9; // r5
  CPad *Pad; // r0
  int v12; // r0
  float v13; // s0
  int8 v14; // r2
  CVehicle *PlayerVehicle; // r0
  CEntity *pTargetEntity; // r1
  CMatrix *m_pMat; // r3
  const CVector *p_tx; // r0
  float v19; // s16
  float v20; // s18
  float v21; // s22
  const CVector *PlayerSpeed; // r0
  float v23; // s0
  float v24; // s16
  float v25; // s18
  float v26; // s22
  const CVector *v27; // r0
  float v28; // s16
  float v29; // s18
  const CVector *v30; // r0
  float v31; // s16
  float v32; // s18
  const CVector *v33; // r0
  unsigned int v34; // r1
  CVehicle *v35; // r0
  _BOOL4 v36; // r0
  CEntity *v37; // r1
  CMatrix *v38; // r3
  const CVector *p_m_translate; // r0
  float32x2_t v40; // d16
  unsigned __int64 v41; // d0
  float v42; // s0
  float v43; // s2
  float32x2_t v44; // d16
  unsigned __int64 v45; // d1
  float32x2_t v46; // d16
  unsigned __int64 v47; // d0
  float v48; // s0
  CVector v49; // [sp+18h] [bp-50h] BYREF

  if ( MovieCamMode < 0 )
    return 1;
  v8 = (float)CTimer::m_snTimeInMilliseconds - (float)TimeWhenStarted;
  if ( v8 > 20000.0 )
    return 1;
  Pad = CPad::GetPad(0);
  v12 = CPad::CinemaCamera(Pad);
  v13 = fabsf((float)v12);
  if ( v13 <= 32.0 )
  {
    CCamera::IsItTimeForNewcam(int,int)::gRightStickCinematicCameraSwitchReturnedToZero = 0;
  }
  else if ( v13 > 96.0 && !CCamera::IsItTimeForNewcam(int,int)::gRightStickCinematicCameraSwitchReturnedToZero )
  {
    v9 = 1;
    CCamera::IsItTimeForNewcam(int,int)::gRightStickCinematicCameraSwitchReturnedToZero = 1;
    v14 = -1;
    if ( v12 > 0 )
      v14 = 1;
    gCinematicModeSwitchDir = v14;
    return v9;
  }
  switch ( MovieCamMode )
  {
    case 0:
      PlayerVehicle = FindPlayerVehicle(-1, 0);
      if ( !PlayerVehicle )
        goto LABEL_20;
      if ( PlayerVehicle->m_baseVehicleType == 5 && this->pTargetEntity->m_nModelIndex != 460
        || PlayerVehicle->m_nModelIndex == 432 )
      {
        return 1;
      }
      pTargetEntity = this->pTargetEntity;
      v9 = 1;
      m_pMat = pTargetEntity->m_pMat;
      p_tx = (const CVector *)&m_pMat->tx;
      if ( !m_pMat )
        p_tx = &pTargetEntity->m_transform.m_translate;
      if ( !CWorld::GetIsLineOfSightClear(p_tx, &this->Cams[this->ActiveCam].Source, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
LABEL_20:
      if ( CTimer::m_snTimeInMilliseconds <= TimeWhenStarted + 5000 )
        goto LABEL_109;
      return 1;
    case 1:
      if ( v8 > 15000.0
        || FindPlayerVehicle(-1, 0)
        && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5
        && this->pTargetEntity->m_nModelIndex != 460 )
      {
        return 1;
      }
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v19 = v49.x - this->m_vecFixedModeSource.x;
      v20 = v49.y - this->m_vecFixedModeSource.y;
      v21 = sqrtf((float)((float)(v19 * v19) + (float)(v20 * v20)) + 0.0);
      if ( v21 > 40.0 )
      {
        PlayerSpeed = FindPlayerSpeed(-1);
        v23 = 4.5;
        goto LABEL_80;
      }
      v48 = 4.5;
      return v21 < v48;
    case 2:
      if ( v8 > 15000.0
        || FindPlayerVehicle(-1, 0)
        && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5
        && this->pTargetEntity->m_nModelIndex != 460 )
      {
        return 1;
      }
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v24 = v49.x - this->m_vecFixedModeSource.x;
      v25 = v49.y - this->m_vecFixedModeSource.y;
      v26 = sqrtf((float)((float)(v24 * v24) + (float)(v25 * v25)) + 0.0);
      if ( v26 < 2.0 )
      {
        v4.n64_u32[0] = 1028443341;
        this->m_bUseNearClipScript = 1;
        v3.n64_f32[0] = v26 * 0.5;
        LODWORD(this->m_fNearClipScript) = vmax_f32(v3, v4).n64_u32[0];
      }
      if ( v26 <= 29.0 )
      {
        if ( v26 < 2.0 )
          return 1;
      }
      else
      {
        v27 = FindPlayerSpeed(-1);
        v9 = 1;
        if ( v26 < 2.0 || (float)((float)((float)(v24 * v27->x) + (float)(v25 * v27->y)) + (float)(v27->z * 0.0)) > 0.0 )
          return v9;
      }
LABEL_109:
      RwCameraSetNearClipPlane(Scene.camera, 0.15);
      return 0;
    case 3:
      if ( v8 > 15000.0 )
        return 1;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v28 = v49.x - this->m_vecFixedModeSource.x;
      v29 = v49.y - this->m_vecFixedModeSource.y;
      if ( sqrtf((float)((float)(v28 * v28) + (float)(v29 * v29)) + 0.0) <= 48.0 )
        goto LABEL_109;
      v30 = FindPlayerSpeed(-1);
      if ( (float)((float)((float)(v28 * v30->x) + (float)(v29 * v30->y)) + (float)(v30->z * 0.0)) <= 0.0 )
        goto LABEL_109;
      return 1;
    case 4:
    case 6:
      v34 = TimeWhenStarted + 3000;
      return CTimer::m_snTimeInMilliseconds > v34;
    case 5:
      if ( v8 > 15000.0
        || FindPlayerVehicle(-1, 0)
        && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5
        && this->pTargetEntity->m_nModelIndex != 460 )
      {
        return 1;
      }
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v31 = v49.x - this->m_vecFixedModeSource.x;
      v32 = v49.y - this->m_vecFixedModeSource.y;
      if ( sqrtf((float)((float)(v31 * v31) + (float)(v32 * v32)) + 0.0) <= 38.0 )
        return 0;
      v33 = FindPlayerSpeed(-1);
      return (float)((float)((float)(v31 * v33->x) + (float)(v32 * v33->y)) + (float)(v33->z * 0.0)) > 0.0;
    case 7:
      if ( CTimer::m_snTimeInMilliseconds <= TimeWhenStarted + 2000 )
        return 0;
      v35 = FindPlayerVehicle(-1, 0);
      v36 = CEntity::GetIsOnScreen(v35);
      return !v36;
    case 8:
      if ( v8 > 15000.0
        || FindPlayerVehicle(-1, 0)
        && FindPlayerVehicle(-1, 0)->m_baseVehicleType == 5
        && this->pTargetEntity->m_nModelIndex != 460 )
      {
        return 1;
      }
      v37 = this->pTargetEntity;
      v38 = v37->m_pMat;
      p_m_translate = (const CVector *)&v38->tx;
      if ( !v38 )
        p_m_translate = &v37->m_transform.m_translate;
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(p_m_translate, &this->Cams[this->ActiveCam].Source, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      v9 = 1;
      if ( CTimer::m_snTimeInMilliseconds > TimeWhenStarted + 1000 )
        return v9;
      this->m_bUseNearClipScript = 1;
      this->m_fNearClipScript = 0.6;
      return 0;
    case 15:
      if ( v8 > 15000.0 )
        return 1;
      if ( !FindPlayerVehicle(-1, 0) )
        return 0;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v19 = v49.x - this->m_vecFixedModeSource.x;
      v20 = v49.y - this->m_vecFixedModeSource.y;
      v21 = sqrtf((float)((float)(v19 * v19) + (float)(v20 * v20)) + 0.0);
      if ( v21 > 44.0 )
      {
        PlayerSpeed = FindPlayerSpeed(-1);
        v23 = 3.0;
        goto LABEL_80;
      }
      v48 = 3.0;
      return v21 < v48;
    case 16:
      if ( v8 > 15000.0 )
        return 1;
      if ( !FindPlayerVehicle(-1, 0) )
        return 0;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      v40.n64_u64[0] = vsub_f32(*(float32x2_t *)&v49.x, *(float32x2_t *)&this->m_vecFixedModeSource.x).n64_u64[0];
      v41 = vmul_f32(v40, v40).n64_u64[0];
      v42 = sqrtf((float)(*(float *)&v41 + *((float *)&v41 + 1)) + 0.0);
      if ( v42 > 50.0 )
        return v9;
      v43 = 3.0;
LABEL_91:
      if ( v42 >= v43 )
        return 0;
      return v9;
    case 17:
      if ( v8 > 15000.0 )
        return 1;
      if ( !FindPlayerVehicle(-1, 0) )
        return 0;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v19 = v49.x - this->m_vecFixedModeSource.x;
      v20 = v49.y - this->m_vecFixedModeSource.y;
      v21 = sqrtf((float)((float)(v19 * v19) + (float)(v20 * v20)) + 0.0);
      if ( v21 <= 50.0 )
      {
        v48 = 2.0;
        return v21 < v48;
      }
      PlayerSpeed = FindPlayerSpeed(-1);
      v23 = 2.0;
LABEL_80:
      v9 = 1;
      if ( v21 >= v23
        && (float)((float)((float)(v19 * PlayerSpeed->x) + (float)(v20 * PlayerSpeed->y)) + (float)(PlayerSpeed->z * 0.0)) <= 0.0 )
      {
        return 0;
      }
      return v9;
    case 18:
      if ( v8 > 15000.0 )
        return 1;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      v44.n64_u64[0] = vsub_f32(*(float32x2_t *)&v49.y, *(float32x2_t *)&this->m_vecFixedModeSource.y).n64_u64[0];
      v45 = vmul_f32(v44, v44).n64_u64[0];
      v42 = sqrtf(
              (float)((float)((float)(v49.x - this->m_vecFixedModeSource.x)
                            * (float)(v49.x - this->m_vecFixedModeSource.x))
                    + *(float *)&v45)
            + *((float *)&v45 + 1));
      if ( v42 > 57.0 )
        return v9;
      v43 = 1.0;
      goto LABEL_91;
    case 19:
      if ( v8 > 15000.0 )
        return 1;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      if ( !CWorld::GetIsLineOfSightClear(&v49, &this->m_vecFixedModeSource, 1, 0, 0, 0, 0, 0, 0) )
        return v9;
      FindPlayerCoors(&v49, -1);
      v9 = 1;
      v46.n64_u64[0] = vsub_f32(*(float32x2_t *)&v49.x, *(float32x2_t *)&this->m_vecFixedModeSource.x).n64_u64[0];
      v47 = vmul_f32(v46, v46).n64_u64[0];
      v42 = sqrtf((float)(*(float *)&v47 + *((float *)&v47 + 1)) + 0.0);
      if ( v42 > 36.0 )
        return v9;
      v43 = 2.0;
      goto LABEL_91;
    case 20:
      v36 = CCam::Process_DW_HeliChaseCam(&this->Cams[this->ActiveCam], 0);
      return !v36;
    case 21:
      v36 = CCam::Process_DW_CamManCam(&this->Cams[this->ActiveCam], 0);
      return !v36;
    case 22:
      v36 = CCam::Process_DW_BirdyCam(&this->Cams[this->ActiveCam], 0);
      return !v36;
    case 23:
      v36 = CCam::Process_DW_PlaneSpotterCam(&this->Cams[this->ActiveCam], 0);
      return !v36;
    case 24:
    case 25:
      TheCamera.m_bUseNearClipScript = 0;
      return 1;
    case 26:
      v36 = CCam::Process_DW_PlaneCam1(&this->Cams[this->ActiveCam], 0);
      return !v36;
    case 27:
      v36 = CCam::Process_DW_PlaneCam2(&this->Cams[this->ActiveCam], 0);
      return !v36;
    case 28:
      v36 = CCam::Process_DW_PlaneCam3(&this->Cams[this->ActiveCam], 0);
      return !v36;
    case 29:
      v34 = TimeWhenStarted + 5000;
      return CTimer::m_snTimeInMilliseconds > v34;
    default:
      return 0;
  }
}
// 3DBDDC: variable 'v3' is possibly undefined
// 3DBDDC: variable 'v4' is possibly undefined
// 2E: using guessed type __int16 word_2E;
// 952ECD: using guessed type char CCamera::IsItTimeForNewcam(int,int)::gRightStickCinematicCameraSwitchReturnedToZero;

//----- (003DC5BC) --------------------------------------------------------
void __fastcall CCamera::SetNearClipScript(CCamera *this, float NearClipValue)
{
  this->m_bUseNearClipScript = 1;
  this->m_fNearClipScript = NearClipValue;
}

//----- (003DC5C8) --------------------------------------------------------
float __fastcall CCamera::CalculateGroundHeight(CCamera *this, uint32 nBoundBoxPos)
{
  char v4; // r0
  CMatrix *m_pMat; // r0
  CSimpleTransform *p_m_transform; // r6
  CSimpleTransform *p_tx; // r2
  CMatrix *v8; // r4
  CSimpleTransform *v9; // r1
  CColModel *m_pColModel; // r0
  float z; // s0
  float v12; // s2
  CMatrix *v13; // r0
  __int64 v14; // d16
  float *v15; // r1
  CEntity *refEntityPtr; // [sp+20h] [bp-50h] BYREF
  CColPoint colPoint; // [sp+24h] [bp-4Ch] BYREF
  CVector vecStart; // [sp+50h] [bp-20h] BYREF

  v4 = `guard variable for'CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation;
  __dmb(0xBu);
  if ( (v4 & 1) == 0
    && _cxa_guard_acquire((__guard *)&`guard variable for'CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation) )
  {
    CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.x = 0.0;
    CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.y = 0.0;
    CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.z = 0.0;
    _cxa_guard_release((__guard *)&`guard variable for'CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation);
  }
  m_pMat = this->m_pMat;
  p_m_transform = &this->m_transform;
  p_tx = &this->m_transform;
  if ( m_pMat )
    p_tx = (CSimpleTransform *)&m_pMat->tx;
  vecStart = p_tx->m_translate;
  if ( fabsf(CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.x - vecStart.x) > 20.0
    || fabsf(CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.y - vecStart.y) > 20.0
    || fabsf(CCamera::CalculateGroundHeight(unsigned int)::fLastPosnCalcuation.z - vecStart.z) > 20.0 )
  {
    vecStart.z = 1000.0;
    if ( CWorld::ProcessVerticalLine(&vecStart, -1000.0, &colPoint, &refEntityPtr, 1, 0, 0, 0, 1, 0, 0) )
    {
      CCamera::CalculateGroundHeight(unsigned int)::fGroundHeight = colPoint.m_vecPosition.z;
      v8 = refEntityPtr->m_pMat;
      v9 = (CSimpleTransform *)&v8->tx;
      m_pColModel = CModelInfo::ms_modelInfoPtrs[refEntityPtr->m_nModelIndex]->m_pColModel;
      if ( !v8 )
        v9 = &refEntit